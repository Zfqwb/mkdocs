{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-\\.]+"},"docs":[{"location":"","text":"Java Docs nitto \u57fa\u7840\u9762\u8bd5\u9898 \u00b6 1-map\u96c6\u5408\u7684\u904d\u5386\u65b9\u5f0f \u00b6 2-1-HasMap\u7684\u7279\u6027 \u00b6 2-2-HasMap\u96c6\u5408\u7684\u6269\u5c55 \u00b6 3-1-Java\u865a\u62df\u673a\u4e2d\u7684\u5185\u5b58\u6a21\u578b \u00b6 3-2-\u7ebf\u7a0b\u5185\u5b58\u7a7a\u95f4\uff08\u6269\u5c55\uff09 \u00b6 4-\u7b80\u5355\u8bf4\u8bf4Java\u4e2d\u7684\u5f02\u5e38\u5904\u7406\u673a\u5236\u7684\u7b80\u5355\u539f\u7406\u548c\u5e94\u7528\u3002 \u00b6 5-\u521b\u5efa\u7ebf\u7a0b\u7684\u51e0\u79cd\u65b9\u5f0f\uff1f \u00b6 6-\u8c08\u8c08\u4f60\u5bf9\u5783\u573e\u56de\u6536\u673a\u5236\u7684\u4e86\u89e3\uff1f \u00b6 7-\u8bf4\u8bf4HashCode\uff08\uff09\u3001equals\uff08\uff09\u7684\u533a\u522b\uff1f \u00b6 8-String.StirngBuilder\uff0cStringBuffer\u4e09\u8005\u7684\u533a\u522b \u00b6 9-\u662f\u5426\u53ef\u4ee5\u4ece\u4e00\u4e2astatic\u65b9\u6cd5\u5185\u90e8\u53d1\u51fa\u5bf9\u975estatio\u65b9\u6cd5\u7684\u8c03\u7528 \u00b6 10-wait\u65b9\u6cd5\u548csleep\u65b9\u6cd5\u7684\u533a\u522b \u00b6 11-\u95ee\u9898\u6269\u5c55\u5e94\u7528\u573a\u666f \u00b6 12-Strings=new String\uff08xyz\uff09\uff1a\u521b\u5efa\u4e86\u51e0\u4e2aStringobject\uff1f\u662f\u5426\u53ef\u4ee5\u7ee7\u627fString\u7c7b\uff1f \u00b6 13-\u591a\u7ebf\u7a0b\u4e2d\u89e3\u51b3\u540c\u6b65\u95ee\u9898\u7684\u65b9\u5f0f \u00b6 14-Strings=Hello\uff1bs=s+world.\uff1a\u8fd9\u4e24\u884c\u4ee3\u7801\u6267\u884c\u540e\uff0c\u539f\u59cb\u7684String\u5bf9\u8c61\u4e2d\u7684\u5185\u5bb9\u5230\u5e95\u53d8\u4e86\u6ca1\u6709\uff1f \u00b6 15-HaslMap\u548cHashtable\u7684\u533a\u522b \u00b6 16-\u5355\u4f8b\u8bbe\u8ba1\u6a21\u5f0f\u4e2d\u61d2\u6c49\u5f0f\u548c\u997f\u6c49\u5f0f\u7684\u533a\u522b \u00b6 17-\u7c7b\u52a0\u8f7d\u673a\u5236\u6709\u4e86\u89e3\u5417 \u00b6 JavaWeb\u9762\u8bd5\u9898 \u00b6 1-cookie\u548csession\u7684\u533a\u522b\u4e0e\u8054\u7cfb \u00b6 2-\u5728HTTP\u8bf7\u6c42\u4e2d\uff0c\u4ec0\u4e48\u60c5\u51b5\u4e0b\u6211\u4eec\u4f1a\u9009\u62e9post\u65b9\u5f0f\u800c\u975eget\uff1f\u53cd\u4e4b\u4e5f\u662f\u5982\u4f55\u8003\u8651\u7684\uff1f \u00b6 3-JSP\u7684\u4e5d\u5927\u5185\u7f6e\u5bf9\u8c61\u53ca\u4f5c\u7528\u5206\u522b\u662f\u4ec0\u4e48\uff1f \u00b6 4-servlet\u7684\u751f\u547d\u5468\u671f\u53ca\u5e38\u7528\u65b9\u6cd5 \u00b6 5-\u8f6c\u53d1\u548c\u91cd\u5b9a\u5411\u7684\u533a\u522b \u00b6 6-ajax\u4e66\u5199\u65b9\u5f0f\u53ca\u5185\u90e8\u4e3b\u8981\u53c2\u6570\u90fd\u6709\u54ea\u4e9b \u00b6 7-Jquery\u5e38\u7528\u9009\u62e9\u5668\u90fd\u6709\u54ea\u4e9b \u00b6 8-JSP\u548cServlet\u7684\u4e4b\u95f4\u7684\u8054\u7cfb\u53ca\u533a\u522b \u00b6 9-ajax\u63d0\u4ea4\u8bf7\u6c42\u9ed8\u8ba4\u662f\u5f02\u6b65\u8fd8\u662f\u540c\u6b65\u600e\u4e48\u6539\u6210\u540c\u6b65\uff1f \u00b6 10-\u4f60\u7684\u9879\u76ee\u4e2d\u4f7f\u7528\u8fc7\u90a3\u4e9bJSTI\u6807\u7b7e\uff1f \u00b6 11-JSP\u5e38\u7528\u7684\u52a8\u4f5c\u6807\u7b7e\u53ca\u4f5c\u7528 \u00b6 12-JSP\u56db\u5927\u4f5c\u7528\u57df\u53ca\u8bf7\u6c42\u8303\u56f4 \u00b6 13-\u5982\u4f55\u9632\u6b62\u8868\u5355\u91cd\u590d\u63d0\u4ea4\u95ee\u9898 \u00b6 14-\u5206\u522b\u8bf4\u51fahttp\uff0chttps\uff0cftp\uff0ctalnet\u7684\u9ed8\u8ba4\u7aef\u53e3 \u00b6 15-\u5e38\u89c1\u7684http\u8fd4\u56de\u72b6\u6001\u7801\uff08200\uff0c301\uff0c302\uff0c400\uff09 \u00b6 16-TCP\u548cUDP\u533a\u522b\uff0c\u4f60\u5bf9HTTP\u534f\u8bae\u7684\u7406\u89e3 \u00b6 17-json\u6570\u636e\u7684\u683c\u5f0f\u662f\u4ec0\u4e48 \u00b6 \u6846\u67b6\u9762\u8bd5\u9898 \u00b6 1-Spring \u662f\u5982\u4f55\u7ba1\u7406\u4e8b\u52a1\u7684\uff0c\u4e8b\u52a1\u7ba1\u7406\u673a\u5236\uff1f\u4ee5\u53ca\u9694\u79bb\u7ea7\u522b \u00b6 2-Spring AOP\u7684\u5b9e\u73b0\u539f\u7406\uff1f \u00b6 3-IOC\u548cDT\u7684\u5173\u7cfb \u00b6 4-Spring \u4e2d\u7528\u5230\u4e86\u90a3\u4e9b\u8bbe\u8ba1\u6a21\u5f0f\uff1f \u00b6 5-Spring\u4e2dBean\u7684\u4f5c\u7528\u57df\u6709\u54ea\u4e9b\uff1f \u00b6 6-spring\u6846\u67b6\u5b9e\u73b0\u5b9e\u4f8b\u5316\u548c\u4f9d\u8d56\u6ce8\u5165\u7684\u65b9\u5f0f\u5206\u522b\u662f\u4ec0\u4e48\uff1f \u00b6 7-springMVC\u7684\u6267\u884c\u6d41\u7a0b \u00b6 8-spring\u548csprinVC\u4e2d\u7684\u5e38\u7528\u6ce8\u89e3 \u00b6 9-springfVC\u548cstruts2\u7684\u533a\u522b\u6709\u54ea\u4e9b \u00b6 10-springfVC\u4e2d\u7684\u524d\u7aef\u63a7\u5236\u5668\u548c\u5904\u7406\u5668\u6620\u5c04\u5668\u7684\u8bf4\u660e \u00b6 11-springVC\u5982\u4f55\u5b9e\u73b0\u8bf7\u6c42\u53c2\u6570\u7ed1\u5b9a\u7684 \u00b6 12-springMVC\u83b7\u53d6\u8868\u5355\u6570\u636e\u7684\u51e0\u79cd\u65b9\u5f0f \u00b6 13-ssm\u6574\u5408\u6d41\u7a0b\u8bf4\u660e \u00b6 14-mybatis\u548chibernate\u7684\u4f18\u7f3a\u70b9\u5206\u6790 \u00b6 15-mybatis\u4e2d#\u548c$\u4f20\u53c2\u7684\u533a\u522b \u00b6 16-mybatis\u4e2d\u7684\u52a8\u6001sql\u8bed\u53e5\u662f\u4ec0\u4e48\u610f\u601d\uff1f \u00b6 17-mybatis\u6620\u5c04\u914d\u7f6e\u6587\u4ef6\u7684\u7f16\u5199\u89c4\u8303 \u00b6 18-mybatis\u7684\u6267\u884c\u8fc7\u7a0b\u5206\u6790 \u00b6 19-\u8bf4\u8bf4\u4f60\u6bd4\u8f83\u719f\u6089\u7684\u8bbe\u8ba1\u6a21\u5f0f\u53ca\u5e94\u7528\u573a\u666f\uff1f \u00b6 20-\u4e24\u79cd\u52a8\u6001\u4ee3\u7406\u7684\u533a\u522b \u00b6 \u9879\u76ee\u9762\u8bd5\u9898 \u00b6 1-\u7535\u5546\u9879\u76ee\u4e2d\u6709\u6ca1\u6709\u7528\u5230\u591a\u7ebf\u7a0b\uff0c\u54ea\u4e9b\u5730\u65b9\u8981\u7528\u591a\u7ebf\u7a0b\uff1f \u00b6 2-\u65e5\u5fd7\u6587\u4ef6\u7684\u7ba1\u7406\uff0c\u4f60\u4eec\u662f\u600e\u4e48\u505a\u7684\uff1f \u00b6 3-\u4f60\u89c9\u5f97\u5206\u5e03\u5f0f\u5f00\u53d1\u7684\u7f3a\u70b9\u662f\u4ec0\u4e48\uff1f \u00b6 4-\u652f\u4ed8\u63a5\u53e3\u662f\u600e\u4e48\u505a\u7684\uff1f \u00b6 5-so1r\u600e\u4e48\u8bbe\u7f6e\u641c\u7d22\u7ed3\u679c\u6392\u540d\u9760\u524d\uff08\u5f97\u5206\uff09\uff1f \u00b6 6-active@\u5728\u9879\u76ee\u4e2d\u5982\u4f55\u5e94\u7528\u7684\uff1f \u00b6 7-activea\u5982\u679c\u6570\u636e\u63d0\u4ea4\u4e0d\u6210\u529f\u600e\u4e48\u529e\uff1f \u00b6 8-\u5355\u70b9\u767b\u5f55\u7cfb\u7edf\u662f\u600e\u4e48\u505a\u7684\uff1f \u00b6 9-dubbo\u670d\u52a1\u5f00\u53d1\u6d41\u7a0b\uff0c\u8fd0\u884c\u6d41\u7a0b\uff1f \u00b6 10-solr\u8ddf\u6570\u636e\u5e93\u7684\u533a\u522b\uff0c\u4f60\u6e05\u695a\u4e48\uff1f \u00b6 11-\u5e7f\u544a\u6570\u636e\u662f\u600e\u4e48\u7528redis\u7f13\u5b58\u7684\uff1f \u00b6 12-.\u9879\u76ee\u4e2d\u6743\u9650\u662f\u600e\u4e48\u505a\u7684\uff1f \u00b6 13-\u5982\u4f55\u5904\u7406activeQ\u6d88\u606f\u4e22\u5931\u7684\u95ee\u9898 \u00b6 14-token\u5728\u9879\u76ee\u4e2d\u7684\u5e94\u7528\uff1ftoken\u6821\u9a8c\u7684\u8fc7\u7a0b \u00b6 15-so1r\u548c\u6570\u636e\u5e93\u600e\u4e48\u4ea4\u4e92\u7684\uff1f \u00b6 16-redis\u7f13\u5b58\u4e0e\u6570\u636e\u5e93\u540c\u6b65\uff0c\u600e\u4e48\u505a\u7684\uff1f \u00b6 17-fastDFS\u7684\u6267\u884c\u6d41\u7a0b\uff0c\u4f60\u6e05\u695a\u4e48\uff1f \u00b6 18-zookeeper\u96c6\u7fa4\uff0c\u5168\u90e8\u90fd\u6302\u4e86\uff0c\u600e\u4e48\u529e\uff1f \u00b6 19-\u5982\u4f55\u89e3\u51b3\u8d2d\u7269\u8f66\u5185\u5b58\u5927\u5c0f\u7684\u95ee\u9898\uff1f \u00b6 20-springboot\u548cspringoloud\u7684\u5173\u7cfb \u00b6 21-SpringDataJpa\u5982\u4f55\u4f7f\u7528 \u00b6","title":"Home"},{"location":"#_1","text":"","title":"\u57fa\u7840\u9762\u8bd5\u9898"},{"location":"#1-map","text":"","title":"1-map\u96c6\u5408\u7684\u904d\u5386\u65b9\u5f0f"},{"location":"#2-1-hasmap","text":"","title":"2-1-HasMap\u7684\u7279\u6027"},{"location":"#2-2-hasmap","text":"","title":"2-2-HasMap\u96c6\u5408\u7684\u6269\u5c55"},{"location":"#3-1-java","text":"","title":"3-1-Java\u865a\u62df\u673a\u4e2d\u7684\u5185\u5b58\u6a21\u578b"},{"location":"#3-2-","text":"","title":"3-2-\u7ebf\u7a0b\u5185\u5b58\u7a7a\u95f4\uff08\u6269\u5c55\uff09"},{"location":"#4-java","text":"","title":"4-\u7b80\u5355\u8bf4\u8bf4Java\u4e2d\u7684\u5f02\u5e38\u5904\u7406\u673a\u5236\u7684\u7b80\u5355\u539f\u7406\u548c\u5e94\u7528\u3002"},{"location":"#5-","text":"","title":"5-\u521b\u5efa\u7ebf\u7a0b\u7684\u51e0\u79cd\u65b9\u5f0f\uff1f"},{"location":"#6-","text":"","title":"6-\u8c08\u8c08\u4f60\u5bf9\u5783\u573e\u56de\u6536\u673a\u5236\u7684\u4e86\u89e3\uff1f"},{"location":"#7-hashcodeequals","text":"","title":"7-\u8bf4\u8bf4HashCode\uff08\uff09\u3001equals\uff08\uff09\u7684\u533a\u522b\uff1f"},{"location":"#8-stringstirngbuilderstringbuffer","text":"","title":"8-String.StirngBuilder\uff0cStringBuffer\u4e09\u8005\u7684\u533a\u522b"},{"location":"#9-staticstatio","text":"","title":"9-\u662f\u5426\u53ef\u4ee5\u4ece\u4e00\u4e2astatic\u65b9\u6cd5\u5185\u90e8\u53d1\u51fa\u5bf9\u975estatio\u65b9\u6cd5\u7684\u8c03\u7528"},{"location":"#10-waitsleep","text":"","title":"10-wait\u65b9\u6cd5\u548csleep\u65b9\u6cd5\u7684\u533a\u522b"},{"location":"#11-","text":"","title":"11-\u95ee\u9898\u6269\u5c55\u5e94\u7528\u573a\u666f"},{"location":"#12-stringsnew_stringxyzstringobjectstring","text":"","title":"12-Strings=new String\uff08xyz\uff09\uff1a\u521b\u5efa\u4e86\u51e0\u4e2aStringobject\uff1f\u662f\u5426\u53ef\u4ee5\u7ee7\u627fString\u7c7b\uff1f"},{"location":"#13-","text":"","title":"13-\u591a\u7ebf\u7a0b\u4e2d\u89e3\u51b3\u540c\u6b65\u95ee\u9898\u7684\u65b9\u5f0f"},{"location":"#14-stringshellossworldstring","text":"","title":"14-Strings=Hello\uff1bs=s+world.\uff1a\u8fd9\u4e24\u884c\u4ee3\u7801\u6267\u884c\u540e\uff0c\u539f\u59cb\u7684String\u5bf9\u8c61\u4e2d\u7684\u5185\u5bb9\u5230\u5e95\u53d8\u4e86\u6ca1\u6709\uff1f"},{"location":"#15-haslmaphashtable","text":"","title":"15-HaslMap\u548cHashtable\u7684\u533a\u522b"},{"location":"#16-","text":"","title":"16-\u5355\u4f8b\u8bbe\u8ba1\u6a21\u5f0f\u4e2d\u61d2\u6c49\u5f0f\u548c\u997f\u6c49\u5f0f\u7684\u533a\u522b"},{"location":"#17-","text":"","title":"17-\u7c7b\u52a0\u8f7d\u673a\u5236\u6709\u4e86\u89e3\u5417"},{"location":"#javaweb","text":"","title":"JavaWeb\u9762\u8bd5\u9898"},{"location":"#1-cookiesession","text":"","title":"1-cookie\u548csession\u7684\u533a\u522b\u4e0e\u8054\u7cfb"},{"location":"#2-httppostget","text":"","title":"2-\u5728HTTP\u8bf7\u6c42\u4e2d\uff0c\u4ec0\u4e48\u60c5\u51b5\u4e0b\u6211\u4eec\u4f1a\u9009\u62e9post\u65b9\u5f0f\u800c\u975eget\uff1f\u53cd\u4e4b\u4e5f\u662f\u5982\u4f55\u8003\u8651\u7684\uff1f"},{"location":"#3-jsp","text":"","title":"3-JSP\u7684\u4e5d\u5927\u5185\u7f6e\u5bf9\u8c61\u53ca\u4f5c\u7528\u5206\u522b\u662f\u4ec0\u4e48\uff1f"},{"location":"#4-servlet","text":"","title":"4-servlet\u7684\u751f\u547d\u5468\u671f\u53ca\u5e38\u7528\u65b9\u6cd5"},{"location":"#5-_1","text":"","title":"5-\u8f6c\u53d1\u548c\u91cd\u5b9a\u5411\u7684\u533a\u522b"},{"location":"#6-ajax","text":"","title":"6-ajax\u4e66\u5199\u65b9\u5f0f\u53ca\u5185\u90e8\u4e3b\u8981\u53c2\u6570\u90fd\u6709\u54ea\u4e9b"},{"location":"#7-jquery","text":"","title":"7-Jquery\u5e38\u7528\u9009\u62e9\u5668\u90fd\u6709\u54ea\u4e9b"},{"location":"#8-jspservlet","text":"","title":"8-JSP\u548cServlet\u7684\u4e4b\u95f4\u7684\u8054\u7cfb\u53ca\u533a\u522b"},{"location":"#9-ajax","text":"","title":"9-ajax\u63d0\u4ea4\u8bf7\u6c42\u9ed8\u8ba4\u662f\u5f02\u6b65\u8fd8\u662f\u540c\u6b65\u600e\u4e48\u6539\u6210\u540c\u6b65\uff1f"},{"location":"#10-jsti","text":"","title":"10-\u4f60\u7684\u9879\u76ee\u4e2d\u4f7f\u7528\u8fc7\u90a3\u4e9bJSTI\u6807\u7b7e\uff1f"},{"location":"#11-jsp","text":"","title":"11-JSP\u5e38\u7528\u7684\u52a8\u4f5c\u6807\u7b7e\u53ca\u4f5c\u7528"},{"location":"#12-jsp","text":"","title":"12-JSP\u56db\u5927\u4f5c\u7528\u57df\u53ca\u8bf7\u6c42\u8303\u56f4"},{"location":"#13-_1","text":"","title":"13-\u5982\u4f55\u9632\u6b62\u8868\u5355\u91cd\u590d\u63d0\u4ea4\u95ee\u9898"},{"location":"#14-httphttpsftptalnet","text":"","title":"14-\u5206\u522b\u8bf4\u51fahttp\uff0chttps\uff0cftp\uff0ctalnet\u7684\u9ed8\u8ba4\u7aef\u53e3"},{"location":"#15-http200301302400","text":"","title":"15-\u5e38\u89c1\u7684http\u8fd4\u56de\u72b6\u6001\u7801\uff08200\uff0c301\uff0c302\uff0c400\uff09"},{"location":"#16-tcpudphttp","text":"","title":"16-TCP\u548cUDP\u533a\u522b\uff0c\u4f60\u5bf9HTTP\u534f\u8bae\u7684\u7406\u89e3"},{"location":"#17-json","text":"","title":"17-json\u6570\u636e\u7684\u683c\u5f0f\u662f\u4ec0\u4e48"},{"location":"#_2","text":"","title":"\u6846\u67b6\u9762\u8bd5\u9898"},{"location":"#1-spring","text":"","title":"1-Spring \u662f\u5982\u4f55\u7ba1\u7406\u4e8b\u52a1\u7684\uff0c\u4e8b\u52a1\u7ba1\u7406\u673a\u5236\uff1f\u4ee5\u53ca\u9694\u79bb\u7ea7\u522b"},{"location":"#2-spring_aop","text":"","title":"2-Spring AOP\u7684\u5b9e\u73b0\u539f\u7406\uff1f"},{"location":"#3-iocdt","text":"","title":"3-IOC\u548cDT\u7684\u5173\u7cfb"},{"location":"#4-spring","text":"","title":"4-Spring \u4e2d\u7528\u5230\u4e86\u90a3\u4e9b\u8bbe\u8ba1\u6a21\u5f0f\uff1f"},{"location":"#5-springbean","text":"","title":"5-Spring\u4e2dBean\u7684\u4f5c\u7528\u57df\u6709\u54ea\u4e9b\uff1f"},{"location":"#6-spring","text":"","title":"6-spring\u6846\u67b6\u5b9e\u73b0\u5b9e\u4f8b\u5316\u548c\u4f9d\u8d56\u6ce8\u5165\u7684\u65b9\u5f0f\u5206\u522b\u662f\u4ec0\u4e48\uff1f"},{"location":"#7-springmvc","text":"","title":"7-springMVC\u7684\u6267\u884c\u6d41\u7a0b"},{"location":"#8-springsprinvc","text":"","title":"8-spring\u548csprinVC\u4e2d\u7684\u5e38\u7528\u6ce8\u89e3"},{"location":"#9-springfvcstruts2","text":"","title":"9-springfVC\u548cstruts2\u7684\u533a\u522b\u6709\u54ea\u4e9b"},{"location":"#10-springfvc","text":"","title":"10-springfVC\u4e2d\u7684\u524d\u7aef\u63a7\u5236\u5668\u548c\u5904\u7406\u5668\u6620\u5c04\u5668\u7684\u8bf4\u660e"},{"location":"#11-springvc","text":"","title":"11-springVC\u5982\u4f55\u5b9e\u73b0\u8bf7\u6c42\u53c2\u6570\u7ed1\u5b9a\u7684"},{"location":"#12-springmvc","text":"","title":"12-springMVC\u83b7\u53d6\u8868\u5355\u6570\u636e\u7684\u51e0\u79cd\u65b9\u5f0f"},{"location":"#13-ssm","text":"","title":"13-ssm\u6574\u5408\u6d41\u7a0b\u8bf4\u660e"},{"location":"#14-mybatishibernate","text":"","title":"14-mybatis\u548chibernate\u7684\u4f18\u7f3a\u70b9\u5206\u6790"},{"location":"#15-mybatis","text":"","title":"15-mybatis\u4e2d#\u548c$\u4f20\u53c2\u7684\u533a\u522b"},{"location":"#16-mybatissql","text":"","title":"16-mybatis\u4e2d\u7684\u52a8\u6001sql\u8bed\u53e5\u662f\u4ec0\u4e48\u610f\u601d\uff1f"},{"location":"#17-mybatis","text":"","title":"17-mybatis\u6620\u5c04\u914d\u7f6e\u6587\u4ef6\u7684\u7f16\u5199\u89c4\u8303"},{"location":"#18-mybatis","text":"","title":"18-mybatis\u7684\u6267\u884c\u8fc7\u7a0b\u5206\u6790"},{"location":"#19-","text":"","title":"19-\u8bf4\u8bf4\u4f60\u6bd4\u8f83\u719f\u6089\u7684\u8bbe\u8ba1\u6a21\u5f0f\u53ca\u5e94\u7528\u573a\u666f\uff1f"},{"location":"#20-","text":"","title":"20-\u4e24\u79cd\u52a8\u6001\u4ee3\u7406\u7684\u533a\u522b"},{"location":"#_3","text":"","title":"\u9879\u76ee\u9762\u8bd5\u9898"},{"location":"#1-","text":"","title":"1-\u7535\u5546\u9879\u76ee\u4e2d\u6709\u6ca1\u6709\u7528\u5230\u591a\u7ebf\u7a0b\uff0c\u54ea\u4e9b\u5730\u65b9\u8981\u7528\u591a\u7ebf\u7a0b\uff1f"},{"location":"#2-","text":"","title":"2-\u65e5\u5fd7\u6587\u4ef6\u7684\u7ba1\u7406\uff0c\u4f60\u4eec\u662f\u600e\u4e48\u505a\u7684\uff1f"},{"location":"#3-","text":"","title":"3-\u4f60\u89c9\u5f97\u5206\u5e03\u5f0f\u5f00\u53d1\u7684\u7f3a\u70b9\u662f\u4ec0\u4e48\uff1f"},{"location":"#4-","text":"","title":"4-\u652f\u4ed8\u63a5\u53e3\u662f\u600e\u4e48\u505a\u7684\uff1f"},{"location":"#5-so1r","text":"","title":"5-so1r\u600e\u4e48\u8bbe\u7f6e\u641c\u7d22\u7ed3\u679c\u6392\u540d\u9760\u524d\uff08\u5f97\u5206\uff09\uff1f"},{"location":"#6-active","text":"","title":"6-active@\u5728\u9879\u76ee\u4e2d\u5982\u4f55\u5e94\u7528\u7684\uff1f"},{"location":"#7-activea","text":"","title":"7-activea\u5982\u679c\u6570\u636e\u63d0\u4ea4\u4e0d\u6210\u529f\u600e\u4e48\u529e\uff1f"},{"location":"#8-","text":"","title":"8-\u5355\u70b9\u767b\u5f55\u7cfb\u7edf\u662f\u600e\u4e48\u505a\u7684\uff1f"},{"location":"#9-dubbo","text":"","title":"9-dubbo\u670d\u52a1\u5f00\u53d1\u6d41\u7a0b\uff0c\u8fd0\u884c\u6d41\u7a0b\uff1f"},{"location":"#10-solr","text":"","title":"10-solr\u8ddf\u6570\u636e\u5e93\u7684\u533a\u522b\uff0c\u4f60\u6e05\u695a\u4e48\uff1f"},{"location":"#11-redis","text":"","title":"11-\u5e7f\u544a\u6570\u636e\u662f\u600e\u4e48\u7528redis\u7f13\u5b58\u7684\uff1f"},{"location":"#12-","text":"","title":"12-.\u9879\u76ee\u4e2d\u6743\u9650\u662f\u600e\u4e48\u505a\u7684\uff1f"},{"location":"#13-activeq","text":"","title":"13-\u5982\u4f55\u5904\u7406activeQ\u6d88\u606f\u4e22\u5931\u7684\u95ee\u9898"},{"location":"#14-tokentoken","text":"","title":"14-token\u5728\u9879\u76ee\u4e2d\u7684\u5e94\u7528\uff1ftoken\u6821\u9a8c\u7684\u8fc7\u7a0b"},{"location":"#15-so1r","text":"","title":"15-so1r\u548c\u6570\u636e\u5e93\u600e\u4e48\u4ea4\u4e92\u7684\uff1f"},{"location":"#16-redis","text":"","title":"16-redis\u7f13\u5b58\u4e0e\u6570\u636e\u5e93\u540c\u6b65\uff0c\u600e\u4e48\u505a\u7684\uff1f"},{"location":"#17-fastdfs","text":"","title":"17-fastDFS\u7684\u6267\u884c\u6d41\u7a0b\uff0c\u4f60\u6e05\u695a\u4e48\uff1f"},{"location":"#18-zookeeper","text":"","title":"18-zookeeper\u96c6\u7fa4\uff0c\u5168\u90e8\u90fd\u6302\u4e86\uff0c\u600e\u4e48\u529e\uff1f"},{"location":"#19-_1","text":"","title":"19-\u5982\u4f55\u89e3\u51b3\u8d2d\u7269\u8f66\u5185\u5b58\u5927\u5c0f\u7684\u95ee\u9898\uff1f"},{"location":"#20-springbootspringoloud","text":"","title":"20-springboot\u548cspringoloud\u7684\u5173\u7cfb"},{"location":"#21-springdatajpa","text":"","title":"21-SpringDataJpa\u5982\u4f55\u4f7f\u7528"},{"location":"MySQL/","text":"MySQL \u53c2\u8003\u624b\u518c \u00b6 Reference Manual day01 \u00b6 01\u64cd\u4f5c\u6570\u636e\u5e93\u548c\u6570\u636e\u8868 \u00b6 \u67e5\u8be2\u6240\u6709\u6570\u636e\u5e93 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a SHOW DATABASES; */ \u67e5\u8be2\u67d0\u4e2a\u6570\u636e\u5e93\u7684\u521b\u5efa\u8bed\u53e5 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a SHOW CREATE DATABASE \u6570\u636e\u5e93\u540d\u79f0; */ \u521b\u5efa\u6570\u636e\u5e93 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a CREATE DATABASE \u6570\u636e\u5e93\u540d\u79f0; */ \u521b\u5efa\u6570\u636e\u5e93\uff0c\u5224\u65ad\u3001\u5982\u679c\u4e0d\u5b58\u5728\u5219\u521b\u5efa \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a CREATE DATABASE IF NOT EXISTS \u6570\u636e\u5e93\u540d\u79f0; */ \u521b\u5efa\u6570\u636e\u5e93\u3001\u5e76\u6307\u5b9a\u5b57\u7b26\u96c6 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a CREATE DATABASE \u6570\u636e\u5e93\u540d\u79f0 CHARACTER SET \u5b57\u7b26\u96c6\u540d\u79f0; */ \u67e5\u770b\u6570\u636e\u5e93\u7684\u5b57\u7b26\u96c6 \u00b6 SHOW CREATE DATABASE \u6570\u636e\u5e93\u540d\u79f0 ; \u4fee\u6539\u6570\u636e\u5e93\u7684\u5b57\u7b26\u96c6 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a ALTER DATABASE \u6570\u636e\u5e93\u540d\u79f0 CHARACTER SET \u5b57\u7b26\u96c6\u540d\u79f0; */ \u5220\u9664\u6570\u636e\u5e93 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a DROP DATABASE \u6570\u636e\u5e93\u540d\u79f0; */ \u5220\u9664\u6570\u636e\u5e93\uff0c\u5224\u65ad\u3001\u5982\u679c\u5b58\u5728\u5219\u5220\u9664 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a DROP DATABASE IF EXISTS \u6570\u636e\u5e93\u540d\u79f0; */ \u4f7f\u7528\u6570\u636e\u5e93 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a USE \u6570\u636e\u5e93\u540d\u79f0; */ \u67e5\u8be2\u5f53\u524d\u4f7f\u7528\u7684\u6570\u636e\u5e93 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT DATABASE(); */ \u67e5\u8be2\u6240\u6709\u6570\u636e\u8868 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a SHOW TABLES; */ \u67e5\u8be2\u8868\u7ed3\u6784 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a DESC \u8868\u540d; */ \u67e5\u8be2\u6570\u636e\u8868\u7684\u5b57\u7b26\u96c6 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a SHOW TABLE STATUS FROM \u6570\u636e\u5e93\u540d\u79f0 LIKE '\u8868\u540d'; */ \u521b\u5efa\u6570\u636e\u8868 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a CREATE TABLE \u8868\u540d( \u5217\u540d \u6570\u636e\u7c7b\u578b \u7ea6\u675f, \u5217\u540d \u6570\u636e\u7c7b\u578b \u7ea6\u675f, ... \u5217\u540d \u6570\u636e\u7c7b\u578b \u7ea6\u675f ); */ \u4fee\u6539\u8868\u540d \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u65e7\u8868\u540d RENAME TO \u65b0\u8868\u540d; */ \u4fee\u6539\u8868\u7684\u5b57\u7b26\u96c6 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d CHARACTER SET \u5b57\u7b26\u96c6\u540d\u79f0; */ \u7ed9\u8868\u6dfb\u52a0\u5217 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d ADD \u5217\u540d \u6570\u636e\u7c7b\u578b; */ \u4fee\u6539\u8868\u4e2d\u5217\u7684\u6570\u636e\u7c7b\u578b \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d MODIFY \u5217\u540d \u6570\u636e\u7c7b\u578b; */ \u4fee\u6539\u8868\u4e2d\u5217\u7684\u540d\u79f0\u548c\u6570\u636e\u7c7b\u578b \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d CHANGE \u65e7\u5217\u540d \u65b0\u5217\u540d \u6570\u636e\u7c7b\u578b; */ \u5220\u9664\u8868\u4e2d\u7684\u5217 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d DROP \u5217\u540d; */ \u5220\u9664\u8868 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a DROP TABLE \u8868\u540d; */ \u5220\u9664\u8868\uff0c\u5224\u65ad\u3001\u5982\u679c\u5b58\u5728\u5219\u5220\u9664 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a DROP TABLE IF EXISTS \u8868\u540d; */ 02\u8868\u6570\u636e\u7684\u589e\u5220\u6539 \u00b6 \u7ed9\u6307\u5b9a\u5217\u6dfb\u52a0\u6570\u636e \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a INSERT INTO \u8868\u540d(\u5217\u540d1,\u5217\u540d2,...) VALUES (\u503c1,\u503c2,...); */ \u7ed9\u5168\u90e8\u5217\u6dfb\u52a0\u6570\u636e \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a INSERT INTO \u8868\u540d VALUES (\u503c1,\u503c2,\u503c3,...); */ \u6279\u91cf\u6dfb\u52a0\u6240\u6709\u5217\u6570\u636e \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a INSERT INTO \u8868\u540d VALUES (\u503c1,\u503c2,\u503c3,...),(\u503c1,\u503c2,\u503c3,...),(\u503c1,\u503c2,\u503c3,...); */ \u4fee\u6539\u8868\u6570\u636e \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a UPDATE \u8868\u540d SET \u5217\u540d1 = \u503c1,\u5217\u540d2 = \u503c2,... [where \u6761\u4ef6]; */ \u5220\u9664\u8868\u6570\u636e \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a DELETE FROM \u8868\u540d [WHERE \u6761\u4ef6]; */ 03\u8868\u6570\u636e\u7684\u67e5\u8be2 \u00b6 \u67e5\u8be2\u5168\u90e8\u6570\u636e \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT * FROM \u8868\u540d; */ \u67e5\u8be2\u6307\u5b9a\u5217 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d1,\u5217\u540d2,... FROM \u8868\u540d; */ \u53bb\u9664\u91cd\u590d\u67e5\u8be2 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT DISTINCT \u5217\u540d1,\u5217\u540d2,... FROM \u8868\u540d; */ \u8ba1\u7b97\u5217\u7684\u503c \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d1 \u8fd0\u7b97\u7b26(+ - * /) \u5217\u540d2 FROM \u8868\u540d; \u5982\u679c\u67d0\u4e00\u5217\u4e3anull\uff0c\u53ef\u4ee5\u8fdb\u884c\u66ff\u6362 ifnull(\u8868\u8fbe\u5f0f1,\u8868\u8fbe\u5f0f2) \u8868\u8fbe\u5f0f1\uff1a\u60f3\u66ff\u6362\u7684\u5217 \u8868\u8fbe\u5f0f2\uff1a\u60f3\u66ff\u6362\u7684\u503c */ example -- \u67e5\u8be2\u5546\u54c1\u540d\u79f0\u548c\u5e93\u5b58\uff0c\u5e93\u5b58\u6570\u91cf\u5728\u539f\u6709\u57fa\u7840\u4e0a\u52a010 SELECT NAME,stock+10 FROM product; -- \u67e5\u8be2\u5546\u54c1\u540d\u79f0\u548c\u5e93\u5b58\uff0c\u5e93\u5b58\u6570\u91cf\u5728\u539f\u6709\u57fa\u7840\u4e0a\u52a010\u3002\u8fdb\u884cnull\u503c\u5224\u65ad SELECT NAME,IFNULL(stock,0)+10 FROM product; \u8d77\u522b\u540d \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d1,\u5217\u540d2,... AS \u522b\u540d FROM \u8868\u540d; */ as\u53ef\u4ee5\u7701\u7565 \u6761\u4ef6\u67e5\u8be2 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d\u5217\u8868 FROM \u8868\u540d WHERE \u6761\u4ef6; */ example -- \u67e5\u8be2\u5e93\u5b58\u5927\u4e8e20\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE stock > 20; -- \u67e5\u8be2\u54c1\u724c\u4e3a\u534e\u4e3a\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE brand='\u534e\u4e3a'; -- \u67e5\u8be2\u91d1\u989d\u57284000 ~ 6000\u4e4b\u95f4\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE price >= 4000 AND price <= 6000; SELECT * FROM product WHERE price BETWEEN 4000 AND 6000; -- \u67e5\u8be2\u5e93\u5b58\u4e3a14\u300130\u300123\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE stock=14 OR stock=30 OR stock=23; SELECT * FROM product WHERE stock IN(14,30,23); -- \u67e5\u8be2\u5e93\u5b58\u4e3anull\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE stock IS NULL; -- \u67e5\u8be2\u5e93\u5b58\u4e0d\u4e3anull\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE stock IS NOT NULL; -- \u67e5\u8be2\u540d\u79f0\u4ee5\u5c0f\u7c73\u4e3a\u5f00\u5934\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE NAME LIKE '\u5c0f\u7c73%'; -- \u67e5\u8be2\u540d\u79f0\u7b2c\u4e8c\u4e2a\u5b57\u662f\u4e3a\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE NAME LIKE '_\u4e3a%'; -- \u67e5\u8be2\u540d\u79f0\u4e3a\u56db\u4e2a\u5b57\u7b26\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE NAME LIKE '____'; -- \u67e5\u8be2\u540d\u79f0\u4e2d\u5305\u542b\u7535\u8111\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE NAME LIKE '%\u7535\u8111%'; \u805a\u5408\u51fd\u6570 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u51fd\u6570\u540d(\u5217\u540d) FROM \u8868\u540d [WHERE \u6761\u4ef6]; */ example -- \u8ba1\u7b97product\u8868\u4e2d\u603b\u8bb0\u5f55\u6761\u6570 SELECT COUNT(*) FROM product; -- \u83b7\u53d6\u6700\u9ad8\u4ef7\u683c SELECT MAX(price) FROM product; -- \u83b7\u53d6\u6700\u4f4e\u5e93\u5b58 SELECT MIN(stock) FROM product; -- \u83b7\u53d6\u603b\u5e93\u5b58\u6570\u91cf SELECT SUM(stock) FROM product; -- \u83b7\u53d6\u54c1\u724c\u4e3a\u82f9\u679c\u7684\u603b\u5e93\u5b58\u6570\u91cf SELECT SUM(stock) FROM product WHERE brand='\u82f9\u679c'; -- \u83b7\u53d6\u54c1\u724c\u4e3a\u5c0f\u7c73\u7684\u5e73\u5747\u5546\u54c1\u4ef7\u683c SELECT AVG(price) FROM product WHERE brand='\u5c0f\u7c73'; \u6392\u5e8f\u67e5\u8be2 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d [WHERE \u6761\u4ef6] ORDER BY \u5217\u540d1 \u6392\u5e8f\u65b9\u5f0f1,\u5217\u540d2 \u6392\u5e8f\u65b9\u5f0f2; */ example -- \u6309\u7167\u5e93\u5b58\u5347\u5e8f\u6392\u5e8f SELECT * FROM product ORDER BY stock ASC; -- \u67e5\u8be2\u540d\u79f0\u4e2d\u5305\u542b\u624b\u673a\u7684\u5546\u54c1\u4fe1\u606f\u3002\u6309\u7167\u91d1\u989d\u964d\u5e8f\u6392\u5e8f SELECT * FROM product WHERE NAME LIKE '%\u624b\u673a%' ORDER BY price DESC; -- \u6309\u7167\u91d1\u989d\u5347\u5e8f\u6392\u5e8f\uff0c\u5982\u679c\u91d1\u989d\u76f8\u540c\uff0c\u6309\u7167\u5e93\u5b58\u964d\u5e8f\u6392\u5217 SELECT * FROM product ORDER BY price ASC,stock DESC; \u5206\u7ec4\u67e5\u8be2 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d [WHERE \u6761\u4ef6] GROUP BY \u5206\u7ec4\u5217\u540d [HAVING \u5206\u7ec4\u540e\u6761\u4ef6\u8fc7\u6ee4] [ORDER BY \u6392\u5e8f\u5217\u540d \u6392\u5e8f\u65b9\u5f0f]; */ \u5206\u9875\u67e5\u8be2 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d [WHERE \u6761\u4ef6] [GROUP BY \u5206\u7ec4\u5217\u540d] [HAVING \u5206\u7ec4\u540e\u6761\u4ef6\u8fc7\u6ee4] [ORDER BY \u6392\u5e8f\u5217\u540d \u6392\u5e8f\u65b9\u5f0f] LIMIT \u5f53\u524d\u9875\u6570,\u6bcf\u9875\u663e\u793a\u7684\u6761\u6570; LIMIT \u5f53\u524d\u9875\u6570,\u6bcf\u9875\u663e\u793a\u7684\u6761\u6570; \u516c\u5f0f\uff1a\u5f53\u524d\u9875\u6570 = (\u5f53\u524d\u9875\u6570-1) * \u6bcf\u9875\u663e\u793a\u7684\u6761\u6570 */ example -- \u6bcf\u9875\u663e\u793a3\u6761\u6570\u636e -- \u7b2c1\u9875 \u5f53\u524d\u9875\u6570=(1-1) * 3 SELECT * FROM product LIMIT 0,3; -- \u7b2c2\u9875 \u5f53\u524d\u9875\u6570=(2-1) * 3 SELECT * FROM product LIMIT 3,3; -- \u7b2c3\u9875 \u5f53\u524d\u9875\u6570=(3-1) * 3 SELECT * FROM product LIMIT 6,3; 04\u7ea6\u675f \u00b6 \u4e3b\u952e\u7ea6\u675f \u00b6 -- \u521b\u5efa\u5b66\u751f\u8868(\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84) \u7f16\u53f7\u8bbe\u4e3a\u4e3b\u952e CREATE TABLE student( id INT PRIMARY KEY, NAME VARCHAR(30), age INT ); -- \u67e5\u8be2\u5b66\u751f\u8868\u7684\u8be6\u7ec6\u4fe1\u606f DESC student; -- \u6dfb\u52a0\u6570\u636e INSERT INTO student VALUES (1,'\u5f20\u4e09',23); INSERT INTO student VALUES (2,'\u674e\u56db',24); -- \u5220\u9664\u4e3b\u952e ALTER TABLE student DROP PRIMARY KEY; -- \u5efa\u8868\u540e\u5355\u72ec\u6dfb\u52a0\u4e3b\u952e\u7ea6\u675f ALTER TABLE student MODIFY id INT PRIMARY KEY; \u4e3b\u952e\u81ea\u589e\u7ea6\u675f \u00b6 -- \u521b\u5efa\u5b66\u751f\u8868(\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84) \u7f16\u53f7\u8bbe\u4e3a\u4e3b\u952e\u81ea\u589e CREATE TABLE student( id INT PRIMARY KEY AUTO_INCREMENT, NAME VARCHAR(30), age INT ); -- \u67e5\u8be2\u5b66\u751f\u8868\u7684\u8be6\u7ec6\u4fe1\u606f DESC student; -- \u6dfb\u52a0\u6570\u636e INSERT INTO student VALUES (NULL,'\u5f20\u4e09',23),(NULL,'\u674e\u56db',24); -- \u5220\u9664\u81ea\u589e\u7ea6\u675f ALTER TABLE student MODIFY id INT; INSERT INTO student VALUES (NULL,'\u5f20\u4e09',23); -- \u5efa\u8868\u540e\u5355\u72ec\u6dfb\u52a0\u81ea\u589e\u7ea6\u675f ALTER TABLE student MODIFY id INT AUTO_INCREMENT; \u552f\u4e00\u7ea6\u675f \u00b6 -- \u521b\u5efa\u5b66\u751f\u8868(\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84) \u7f16\u53f7\u8bbe\u4e3a\u4e3b\u952e\u81ea\u589e\uff0c\u5e74\u9f84\u8bbe\u4e3a\u552f\u4e00 CREATE TABLE student( id INT PRIMARY KEY AUTO_INCREMENT, NAME VARCHAR(30), age INT UNIQUE ); -- \u67e5\u8be2\u5b66\u751f\u8868\u7684\u8be6\u7ec6\u4fe1\u606f DESC student; -- \u6dfb\u52a0\u6570\u636e INSERT INTO student VALUES (NULL,'\u5f20\u4e09',23); INSERT INTO student VALUES (NULL,'\u674e\u56db',23); -- \u5220\u9664\u552f\u4e00\u7ea6\u675f ALTER TABLE student DROP INDEX age; -- \u5efa\u8868\u540e\u5355\u72ec\u6dfb\u52a0\u552f\u4e00\u7ea6\u675f ALTER TABLE student MODIFY age INT UNIQUE; \u975e\u7a7a\u7ea6\u675f \u00b6 -- \u521b\u5efa\u5b66\u751f\u8868(\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84) \u7f16\u53f7\u8bbe\u4e3a\u4e3b\u952e\u81ea\u589e\uff0c\u59d3\u540d\u8bbe\u4e3a\u975e\u7a7a\uff0c\u5e74\u9f84\u8bbe\u4e3a\u552f\u4e00 CREATE TABLE student( id INT PRIMARY KEY AUTO_INCREMENT, NAME VARCHAR(30) NOT NULL, age INT UNIQUE ); -- \u67e5\u8be2\u5b66\u751f\u8868\u7684\u8be6\u7ec6\u4fe1\u606f DESC student; -- \u6dfb\u52a0\u6570\u636e INSERT INTO student VALUES (NULL,'\u5f20\u4e09',23); -- \u5220\u9664\u975e\u7a7a\u7ea6\u675f ALTER TABLE student MODIFY NAME VARCHAR(30); INSERT INTO student VALUES (NULL,NULL,25); -- \u5efa\u8868\u540e\u5355\u72ec\u6dfb\u52a0\u975e\u7a7a\u7ea6\u675f ALTER TABLE student MODIFY NAME VARCHAR(30) NOT NULL; day02 \u00b6 01\u7ea6\u675f \u00b6 \u5916\u952e\u7ea6\u675f \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a CONSTRAINT \u5916\u952e\u540d FOREIGN KEY (\u672c\u8868\u5916\u952e\u5217\u540d) REFERENCES \u4e3b\u8868\u540d(\u4e3b\u8868\u4e3b\u952e\u5217\u540d) */ \u5220\u9664\u5916\u952e\u7ea6\u675f \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d DROP FOREIGN KEY \u5916\u952e\u540d; */ \u5efa\u8868\u540e\u5355\u72ec\u6dfb\u52a0\u5916\u952e\u7ea6\u675f \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d ADD CONSTRAINT \u5916\u952e\u540d FOREIGN KEY (\u672c\u8868\u5916\u952e\u5217\u540d) REFERENCES \u4e3b\u8868\u540d(\u4e3b\u952e\u5217\u540d); */ \u5916\u952e\u7ea6\u675fexample -- \u521b\u5efadb2\u6570\u636e\u5e93 CREATE DATABASE db2; -- \u4f7f\u7528db2\u6570\u636e\u5e93 USE db2; /* \u5916\u952e\u7ea6\u675f \u6807\u51c6\u8bed\u6cd5\uff1a CONSTRAINT \u5916\u952e\u540d FOREIGN KEY (\u672c\u8868\u5916\u952e\u5217\u540d) REFERENCES \u4e3b\u8868\u540d(\u4e3b\u8868\u4e3b\u952e\u5217\u540d) */ -- \u5efa\u8868\u65f6\u6dfb\u52a0\u5916\u952e\u7ea6\u675f -- \u521b\u5efauser\u7528\u6237\u8868 CREATE TABLE USER( id INT PRIMARY KEY AUTO_INCREMENT, -- id NAME VARCHAR(20) NOT NULL -- \u59d3\u540d ); -- \u6dfb\u52a0\u7528\u6237\u6570\u636e INSERT INTO USER VALUES (NULL,'\u5f20\u4e09'),(NULL,'\u674e\u56db'); -- \u521b\u5efaorderlist\u8ba2\u5355\u8868 CREATE TABLE orderlist( id INT PRIMARY KEY AUTO_INCREMENT, -- id number VARCHAR(20) NOT NULL, -- \u8ba2\u5355\u7f16\u53f7 uid INT, -- \u5916\u952e\u5217 CONSTRAINT ou_fk1 FOREIGN KEY (uid) REFERENCES USER(id) ); -- \u6dfb\u52a0\u8ba2\u5355\u6570\u636e INSERT INTO orderlist VALUES (NULL,'hm001',1),(NULL,'hm002',1), (NULL,'hm003',2),(NULL,'hm004',2); -- \u6dfb\u52a0\u4e00\u4e2a\u8ba2\u5355\uff0c\u4f46\u662f\u6ca1\u6709\u771f\u5b9e\u7528\u6237\u3002\u6dfb\u52a0\u5931\u8d25 INSERT INTO orderlist VALUES (NULL,'hm005',3); -- \u5220\u9664\u674e\u56db\u7528\u6237\u3002\u5220\u9664\u5931\u8d25 DELETE FROM USER WHERE NAME='\u674e\u56db'; /* \u5220\u9664\u5916\u952e\u7ea6\u675f \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d DROP FOREIGN KEY \u5916\u952e\u540d; */ -- \u5220\u9664\u5916\u952e\u7ea6\u675f ALTER TABLE orderlist DROP FOREIGN KEY ou_fk1; /* \u5efa\u8868\u540e\u5355\u72ec\u6dfb\u52a0\u5916\u952e\u7ea6\u675f \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d ADD CONSTRAINT \u5916\u952e\u540d FOREIGN KEY (\u672c\u8868\u5916\u952e\u5217\u540d) REFERENCES \u4e3b\u8868\u540d(\u4e3b\u952e\u5217\u540d); */ -- \u6dfb\u52a0\u5916\u952e\u7ea6\u675f ALTER TABLE orderlist ADD CONSTRAINT ou_fk1 FOREIGN KEY (uid) REFERENCES USER(id); \u5916\u952e\u7ea7\u8054\u64cd\u4f5c \u00b6 /* \u6dfb\u52a0\u5916\u952e\u7ea6\u675f\uff0c\u540c\u65f6\u6dfb\u52a0\u7ea7\u8054\u66f4\u65b0 \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d ADD CONSTRAINT \u5916\u952e\u540d FOREIGN KEY (\u672c\u8868\u5916\u952e\u5217\u540d) REFERENCES \u4e3b\u8868\u540d(\u4e3b\u952e\u5217\u540d) ON UPDATE CASCADE; \u6dfb\u52a0\u5916\u952e\u7ea6\u675f\uff0c\u540c\u65f6\u6dfb\u52a0\u7ea7\u8054\u5220\u9664 \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d ADD CONSTRAINT \u5916\u952e\u540d FOREIGN KEY (\u672c\u8868\u5916\u952e\u5217\u540d) REFERENCES \u4e3b\u8868\u540d(\u4e3b\u952e\u5217\u540d) ON DELETE CASCADE; \u6dfb\u52a0\u5916\u952e\u7ea6\u675f\uff0c\u540c\u65f6\u6dfb\u52a0\u7ea7\u8054\u66f4\u65b0\u548c\u7ea7\u8054\u5220\u9664 \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d ADD CONSTRAINT \u5916\u952e\u540d FOREIGN KEY (\u672c\u8868\u5916\u952e\u5217\u540d) REFERENCES \u4e3b\u8868\u540d(\u4e3b\u952e\u5217\u540d) ON UPDATE CASCADE ON DELETE CASCADE; */ \u5916\u952e\u7ea7\u8054\u64cd\u4f5cexample -- \u5220\u9664\u5916\u952e\u7ea6\u675f ALTER TABLE orderlist DROP FOREIGN KEY ou_fk1; -- \u6dfb\u52a0\u5916\u952e\u7ea6\u675f\uff0c\u540c\u65f6\u6dfb\u52a0\u7ea7\u8054\u66f4\u65b0\u548c\u7ea7\u8054\u5220\u9664 ALTER TABLE orderlist ADD CONSTRAINT ou_fk1 FOREIGN KEY (uid) REFERENCES USER(id) ON UPDATE CASCADE ON DELETE CASCADE; -- \u5c06\u674e\u56db\u8fd9\u4e2a\u7528\u6237\u7684id\u4fee\u6539\u4e3a3,\u8ba2\u5355\u8868\u4e2d\u7684uid\u4e5f\u81ea\u52a8\u4fee\u6539 UPDATE USER SET id=3 WHERE id=2; -- \u5c06\u674e\u56db\u8fd9\u4e2a\u7528\u6237\u5220\u9664,\u8ba2\u5355\u8868\u4e2d\u7684\u8be5\u7528\u6237\u6240\u5c5e\u7684\u8ba2\u5355\u4e5f\u81ea\u52a8\u5220\u9664 DELETE FROM USER WHERE id=3; 02\u591a\u8868\u64cd\u4f5c \u00b6 \u8868\u5173\u7cfb\u4e00\u5bf9\u4e00 \u00b6 -- \u521b\u5efadb3\u6570\u636e\u5e93 CREATE DATABASE db3; -- \u4f7f\u7528db3\u6570\u636e\u5e93 USE db3; -- \u521b\u5efaperson\u8868 CREATE TABLE person( id INT PRIMARY KEY AUTO_INCREMENT, -- \u4e3b\u952eid NAME VARCHAR(20) -- \u59d3\u540d ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO person VALUES (NULL,'\u5f20\u4e09'),(NULL,'\u674e\u56db'); -- \u521b\u5efacard\u8868 CREATE TABLE card( id INT PRIMARY KEY AUTO_INCREMENT, -- \u4e3b\u952eid number VARCHAR(20) UNIQUE NOT NULL, -- \u8eab\u4efd\u8bc1\u53f7 pid INT UNIQUE, -- \u5916\u952e\u5217 CONSTRAINT cp_fk1 FOREIGN KEY (pid) REFERENCES person(id) ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO card VALUES (NULL,'12345',1),(NULL,'56789',2); \u8868\u5173\u7cfb\u4e00\u5bf9\u591a \u00b6 -- \u521b\u5efauser\u8868 CREATE TABLE USER( id INT PRIMARY KEY AUTO_INCREMENT, -- \u4e3b\u952eid NAME VARCHAR(20) -- \u59d3\u540d ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO USER VALUES (NULL,'\u5f20\u4e09'),(NULL,'\u674e\u56db'); -- \u521b\u5efaorderlist\u8868 CREATE TABLE orderlist( id INT PRIMARY KEY AUTO_INCREMENT, -- \u4e3b\u952eid number VARCHAR(20), -- \u8ba2\u5355\u7f16\u53f7 uid INT, -- \u5916\u952e\u5217 CONSTRAINT ou_fk1 FOREIGN KEY (uid) REFERENCES USER(id) ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO orderlist VALUES (NULL,'hm001',1),(NULL,'hm002',1),(NULL,'hm003',2),(NULL,'hm004',2); /* \u5546\u54c1\u5206\u7c7b\u548c\u5546\u54c1 */ -- \u521b\u5efacategory\u8868 CREATE TABLE category( id INT PRIMARY KEY AUTO_INCREMENT, -- \u4e3b\u952eid NAME VARCHAR(10) -- \u5206\u7c7b\u540d\u79f0 ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO category VALUES (NULL,'\u624b\u673a\u6570\u7801'),(NULL,'\u7535\u8111\u529e\u516c'); -- \u521b\u5efaproduct\u8868 CREATE TABLE product( id INT PRIMARY KEY AUTO_INCREMENT, -- \u4e3b\u952eid NAME VARCHAR(30), -- \u5546\u54c1\u540d\u79f0 cid INT, -- \u5916\u952e\u5217 CONSTRAINT pc_fk1 FOREIGN KEY (cid) REFERENCES category(id) ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO product VALUES (NULL,'\u534e\u4e3aP30',1),(NULL,'\u5c0f\u7c73note3',1), (NULL,'\u8054\u60f3\u7535\u8111',2),(NULL,'\u82f9\u679c\u7535\u8111',2); \u8868\u5173\u7cfb\u591a\u5bf9\u591a \u00b6 -- \u521b\u5efastudent\u8868 CREATE TABLE student( id INT PRIMARY KEY AUTO_INCREMENT, -- \u4e3b\u952eid NAME VARCHAR(20) -- \u5b66\u751f\u59d3\u540d ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO student VALUES (NULL,'\u5f20\u4e09'),(NULL,'\u674e\u56db'); -- \u521b\u5efacourse\u8868 CREATE TABLE course( id INT PRIMARY KEY AUTO_INCREMENT, -- \u4e3b\u952eid NAME VARCHAR(10) -- \u8bfe\u7a0b\u540d\u79f0 ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO course VALUES (NULL,'\u8bed\u6587'),(NULL,'\u6570\u5b66'); -- \u521b\u5efa\u4e2d\u95f4\u8868 CREATE TABLE stu_course( id INT PRIMARY KEY AUTO_INCREMENT, -- \u4e3b\u952eid sid INT, -- \u7528\u4e8e\u548cstudent\u8868\u4e2d\u7684id\u8fdb\u884c\u5916\u952e\u5173\u8054 cid INT, -- \u7528\u4e8e\u548ccourse\u8868\u4e2d\u7684id\u8fdb\u884c\u5916\u952e\u5173\u8054 CONSTRAINT sc_fk1 FOREIGN KEY (sid) REFERENCES student(id), -- \u6dfb\u52a0\u5916\u952e\u7ea6\u675f CONSTRAINT sc_fk2 FOREIGN KEY (cid) REFERENCES course(id) -- \u6dfb\u52a0\u5916\u952e\u7ea6\u675f ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO stu_course VALUES (NULL,1,1),(NULL,1,2),(NULL,2,1),(NULL,2,2); \u591a\u8868\u67e5\u8be2\u6570\u636e\u51c6\u5907 \u00b6 -- \u521b\u5efadb4\u6570\u636e\u5e93 CREATE DATABASE db4; -- \u4f7f\u7528db4\u6570\u636e\u5e93 USE db4; -- \u521b\u5efauser\u8868 CREATE TABLE USER( id INT PRIMARY KEY AUTO_INCREMENT, -- \u7528\u6237id NAME VARCHAR(20), -- \u7528\u6237\u59d3\u540d age INT -- \u7528\u6237\u5e74\u9f84 ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO USER VALUES (1,'\u5f20\u4e09',23); INSERT INTO USER VALUES (2,'\u674e\u56db',24); INSERT INTO USER VALUES (3,'\u738b\u4e94',25); INSERT INTO USER VALUES (4,'\u8d75\u516d',26); -- \u8ba2\u5355\u8868 CREATE TABLE orderlist( id INT PRIMARY KEY AUTO_INCREMENT, -- \u8ba2\u5355id number VARCHAR(30), -- \u8ba2\u5355\u7f16\u53f7 uid INT, -- \u5916\u952e\u5b57\u6bb5 CONSTRAINT ou_fk1 FOREIGN KEY (uid) REFERENCES USER(id) ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO orderlist VALUES (1,'hm001',1); INSERT INTO orderlist VALUES (2,'hm002',1); INSERT INTO orderlist VALUES (3,'hm003',2); INSERT INTO orderlist VALUES (4,'hm004',2); INSERT INTO orderlist VALUES (5,'hm005',3); INSERT INTO orderlist VALUES (6,'hm006',3); INSERT INTO orderlist VALUES (7,'hm007',NULL); -- \u5546\u54c1\u5206\u7c7b\u8868 CREATE TABLE category( id INT PRIMARY KEY AUTO_INCREMENT, -- \u5546\u54c1\u5206\u7c7bid NAME VARCHAR(10) -- \u5546\u54c1\u5206\u7c7b\u540d\u79f0 ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO category VALUES (1,'\u624b\u673a\u6570\u7801'); INSERT INTO category VALUES (2,'\u7535\u8111\u529e\u516c'); INSERT INTO category VALUES (3,'\u70df\u9152\u8336\u7cd6'); INSERT INTO category VALUES (4,'\u978b\u9774\u7bb1\u5305'); -- \u5546\u54c1\u8868 CREATE TABLE product( id INT PRIMARY KEY AUTO_INCREMENT, -- \u5546\u54c1id NAME VARCHAR(30), -- \u5546\u54c1\u540d\u79f0 cid INT, -- \u5916\u952e\u5b57\u6bb5 CONSTRAINT cp_fk1 FOREIGN KEY (cid) REFERENCES category(id) ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO product VALUES (1,'\u534e\u4e3a\u624b\u673a',1); INSERT INTO product VALUES (2,'\u5c0f\u7c73\u624b\u673a',1); INSERT INTO product VALUES (3,'\u8054\u60f3\u7535\u8111',2); INSERT INTO product VALUES (4,'\u82f9\u679c\u7535\u8111',2); INSERT INTO product VALUES (5,'\u4e2d\u534e\u9999\u70df',3); INSERT INTO product VALUES (6,'\u7389\u6eaa\u9999\u70df',3); INSERT INTO product VALUES (7,'\u8ba1\u751f\u7528\u54c1',NULL); -- \u4e2d\u95f4\u8868 CREATE TABLE us_pro( upid INT PRIMARY KEY AUTO_INCREMENT, -- \u4e2d\u95f4\u8868id uid INT, -- \u5916\u952e\u5b57\u6bb5\u3002\u9700\u8981\u548c\u7528\u6237\u8868\u7684\u4e3b\u952e\u4ea7\u751f\u5173\u8054 pid INT, -- \u5916\u952e\u5b57\u6bb5\u3002\u9700\u8981\u548c\u5546\u54c1\u8868\u7684\u4e3b\u952e\u4ea7\u751f\u5173\u8054 CONSTRAINT up_fk1 FOREIGN KEY (uid) REFERENCES USER(id), CONSTRAINT up_fk2 FOREIGN KEY (pid) REFERENCES product(id) ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO us_pro VALUES (NULL,1,1); INSERT INTO us_pro VALUES (NULL,1,2); INSERT INTO us_pro VALUES (NULL,1,3); INSERT INTO us_pro VALUES (NULL,1,4); INSERT INTO us_pro VALUES (NULL,1,5); INSERT INTO us_pro VALUES (NULL,1,6); INSERT INTO us_pro VALUES (NULL,1,7); INSERT INTO us_pro VALUES (NULL,2,1); INSERT INTO us_pro VALUES (NULL,2,2); INSERT INTO us_pro VALUES (NULL,2,3); INSERT INTO us_pro VALUES (NULL,2,4); INSERT INTO us_pro VALUES (NULL,2,5); INSERT INTO us_pro VALUES (NULL,2,6); INSERT INTO us_pro VALUES (NULL,2,7); INSERT INTO us_pro VALUES (NULL,3,1); INSERT INTO us_pro VALUES (NULL,3,2); INSERT INTO us_pro VALUES (NULL,3,3); INSERT INTO us_pro VALUES (NULL,3,4); INSERT INTO us_pro VALUES (NULL,3,5); INSERT INTO us_pro VALUES (NULL,3,6); INSERT INTO us_pro VALUES (NULL,3,7); INSERT INTO us_pro VALUES (NULL,4,1); INSERT INTO us_pro VALUES (NULL,4,2); INSERT INTO us_pro VALUES (NULL,4,3); INSERT INTO us_pro VALUES (NULL,4,4); INSERT INTO us_pro VALUES (NULL,4,5); INSERT INTO us_pro VALUES (NULL,4,6); INSERT INTO us_pro VALUES (NULL,4,7); \u5185\u8fde\u63a5\u67e5\u8be2 \u00b6 \u663e\u793a\u5185\u8fde\u63a5 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d1 [INNER] JOIN \u8868\u540d2 ON \u5173\u8054\u6761\u4ef6; */ \u9690\u5f0f\u5185\u8fde\u63a5 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d1,\u8868\u540d2 WHERE \u5173\u8054\u6761\u4ef6; */ \u5916\u8fde\u63a5\u67e5\u8be2 \u00b6 \u5de6\u5916\u8fde\u63a5 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d1 LEFT [OUTER] JOIN \u8868\u540d2 ON \u6761\u4ef6; */ \u53f3\u5916\u8fde\u63a5 \u00b6 /* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d1 RIGHT [OUTER] JOIN \u8868\u540d2 ON \u6761\u4ef6; */ \u5b50\u67e5\u8be2 \u00b6 /* \u7ed3\u679c\u662f\u5355\u884c\u5355\u5217\u7684 \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d WHERE \u5217\u540d=(SELECT \u5217\u540d FROM \u8868\u540d [WHERE \u6761\u4ef6]); */ -- \u67e5\u8be2\u5e74\u9f84\u6700\u9ad8\u7684\u7528\u6237\u59d3\u540d SELECT MAX(age) FROM USER; SELECT NAME,age FROM USER WHERE age=(SELECT MAX(age) FROM USER); /* \u7ed3\u679c\u662f\u591a\u884c\u5355\u5217\u7684 \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d WHERE \u5217\u540d [NOT] IN (SELECT \u5217\u540d FROM \u8868\u540d [WHERE \u6761\u4ef6]); */ -- \u67e5\u8be2\u5f20\u4e09\u548c\u674e\u56db\u7684\u8ba2\u5355\u4fe1\u606f SELECT * FROM orderlist WHERE uid IN (1,2); SELECT id FROM USER WHERE NAME IN ('\u5f20\u4e09','\u674e\u56db'); SELECT * FROM orderlist WHERE uid IN (SELECT id FROM USER WHERE NAME IN ('\u5f20\u4e09','\u674e\u56db')); /* \u7ed3\u679c\u662f\u591a\u884c\u591a\u5217\u7684 \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d [\u522b\u540d],(SELECT \u5217\u540d FROM \u8868\u540d [WHERE \u6761\u4ef6]) [\u522b\u540d] [WHERE \u6761\u4ef6]; */ -- \u67e5\u8be2\u8ba2\u5355\u8868\u4e2did\u5927\u4e8e4\u7684\u8ba2\u5355\u4fe1\u606f\u548c\u6240\u5c5e\u7528\u6237\u4fe1\u606f SELECT * FROM orderlist WHERE id > 4; SELECT u.name, o.number FROM USER u, (SELECT * FROM orderlist WHERE id > 4) o WHERE o.uid=u.id; \u81ea\u5173\u8054\u67e5\u8be2 \u00b6 -- \u521b\u5efa\u5458\u5de5\u8868 CREATE TABLE employee( id INT PRIMARY KEY AUTO_INCREMENT, -- \u5458\u5de5\u7f16\u53f7 NAME VARCHAR(20), -- \u5458\u5de5\u59d3\u540d mgr INT, -- \u4e0a\u7ea7\u7f16\u53f7 salary DOUBLE -- \u5458\u5de5\u5de5\u8d44 ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO employee VALUES (1001,'\u5b59\u609f\u7a7a',1005,9000.00), (1002,'\u732a\u516b\u6212',1005,8000.00), (1003,'\u6c99\u548c\u5c1a',1005,8500.00), (1004,'\u5c0f\u767d\u9f99',1005,7900.00), (1005,'\u5510\u50e7',NULL,15000.00), (1006,'\u6b66\u677e',1009,7600.00), (1007,'\u674e\u9035',1009,7400.00), (1008,'\u6797\u51b2',1009,8100.00), (1009,'\u5b8b\u6c5f',NULL,16000.00); -- \u67e5\u8be2\u6240\u6709\u5458\u5de5\u7684\u59d3\u540d\u53ca\u5176\u76f4\u63a5\u4e0a\u7ea7\u7684\u59d3\u540d\uff0c\u6ca1\u6709\u4e0a\u7ea7\u7684\u5458\u5de5\u4e5f\u9700\u8981\u67e5\u8be2 /* \u5206\u6790 \u5458\u5de5\u4fe1\u606f employee\u8868 \u6761\u4ef6\uff1aemployee.mgr = employee.id \u67e5\u8be2\u5de6\u8868\u7684\u5168\u90e8\u6570\u636e\uff0c\u548c\u5de6\u53f3\u4e24\u5f20\u8868\u6709\u4ea4\u96c6\u90e8\u5206\u6570\u636e\uff0c\u5de6\u5916\u8fde\u63a5 */ SELECT e1.id, e1.name, e1.mgr, e2.id, e2.name FROM employee e1 LEFT OUTER JOIN employee e2 ON e1.mgr = e2.id; \u591a\u8868\u67e5\u8be2\u7ec3\u4e60 \u00b6 -- 1.\u67e5\u8be2\u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84\u3002\u8ba2\u5355\u7f16\u53f7 /* \u5206\u6790 \u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84 user\u8868 \u8ba2\u5355\u7f16\u53f7 orderlist\u8868 \u6761\u4ef6\uff1auser.id=orderlist.uid */ SELECT u.id, u.name, u.age, o.number FROM USER u, orderlist o WHERE u.id=o.uid; -- 2.\u67e5\u8be2\u6240\u6709\u7684\u7528\u6237\u3002\u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84\u3002\u8ba2\u5355\u7f16\u53f7 /* \u5206\u6790 \u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84 user\u8868 \u8ba2\u5355\u7f16\u53f7 orderlist\u8868 \u6761\u4ef6\uff1auser.id=orderlist.uid \u67e5\u8be2\u6240\u6709\u7684\u7528\u6237\uff0c\u5de6\u5916\u8fde\u63a5 */ SELECT u.id, u.name, u.age, o.number FROM USER u LEFT OUTER JOIN orderlist o ON u.id=o.uid; -- 3.\u67e5\u8be2\u6240\u6709\u7684\u8ba2\u5355\u3002\u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84\u3002\u8ba2\u5355\u7f16\u53f7 /* \u5206\u6790 \u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84 user\u8868 \u8ba2\u5355\u7f16\u53f7 orderlist\u8868 \u6761\u4ef6\uff1auser.id=orderlist.uid \u67e5\u8be2\u6240\u6709\u7684\u8ba2\u5355\uff0c\u53f3\u5916\u8fde\u63a5 */ SELECT u.id, u.name, u.age, o.number FROM USER u RIGHT OUTER JOIN orderlist o ON u.id=o.uid; -- 4.\u67e5\u8be2\u7528\u6237\u5e74\u9f84\u5927\u4e8e23\u5c81\u7684\u4fe1\u606f\u3002\u663e\u793a\u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84\u3002\u8ba2\u5355\u7f16\u53f7 /* \u5206\u6790 \u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84 user\u8868 \u8ba2\u5355\u7f16\u53f7 orderlist\u8868 \u6761\u4ef6\uff1auser.id=orderlist.uid AND user.age > 23 */ SELECT u.id, u.name, u.age, o.number FROM USER u, orderlist o WHERE u.id=o.uid AND u.age > 23; -- 5.\u67e5\u8be2\u5f20\u4e09\u548c\u674e\u56db\u7528\u6237\u7684\u4fe1\u606f\u3002\u663e\u793a\u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84\u3002\u8ba2\u5355\u7f16\u53f7 /* \u5206\u6790 \u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84 user\u8868 \u8ba2\u5355\u7f16\u53f7 orderlist\u8868 \u6761\u4ef6\uff1auser.id=orderlist.uid AND user.name IN ('\u5f20\u4e09','\u674e\u56db') */ SELECT u.id, u.name, u.age, o.number FROM USER u, orderlist o WHERE u.id=o.uid AND u.name IN ('\u5f20\u4e09','\u674e\u56db'); -- 6.\u67e5\u8be2\u5546\u54c1\u5206\u7c7b\u7684\u7f16\u53f7\u3001\u5206\u7c7b\u540d\u79f0\u3002\u5206\u7c7b\u4e0b\u7684\u5546\u54c1\u540d\u79f0 /* \u5206\u6790 \u5546\u54c1\u5206\u7c7b\u7684\u7f16\u53f7\u3001\u5206\u7c7b\u540d\u79f0 category\u8868 \u5546\u54c1\u540d\u79f0 product\u8868 \u6761\u4ef6\uff1acategory.id=product.cid */ SELECT c.id, c.name, p.name FROM category c, product p WHERE c.id=p.cid; -- 7.\u67e5\u8be2\u6240\u6709\u7684\u5546\u54c1\u5206\u7c7b\u3002\u5546\u54c1\u5206\u7c7b\u7684\u7f16\u53f7\u3001\u5206\u7c7b\u540d\u79f0\u3002\u5206\u7c7b\u4e0b\u7684\u5546\u54c1\u540d\u79f0 /* \u5206\u6790 \u5546\u54c1\u5206\u7c7b\u7684\u7f16\u53f7\u3001\u5206\u7c7b\u540d\u79f0 category\u8868 \u5546\u54c1\u540d\u79f0 product\u8868 \u6761\u4ef6\uff1acategory.id=product.cid \u67e5\u8be2\u6240\u6709\u7684\u5546\u54c1\u5206\u7c7b\uff0c\u5de6\u5916\u8fde\u63a5 */ SELECT c.id, c.name, p.name FROM category c LEFT OUTER JOIN product p ON c.id=p.cid; -- 8.\u67e5\u8be2\u6240\u6709\u7684\u5546\u54c1\u4fe1\u606f\u3002\u5546\u54c1\u5206\u7c7b\u7684\u7f16\u53f7\u3001\u5206\u7c7b\u540d\u79f0\u3002\u5206\u7c7b\u4e0b\u7684\u5546\u54c1\u540d\u79f0 /* \u5206\u6790 \u5546\u54c1\u5206\u7c7b\u7684\u7f16\u53f7\u3001\u5206\u7c7b\u540d\u79f0 category\u8868 \u5546\u54c1\u540d\u79f0 product\u8868 \u6761\u4ef6\uff1acategory.id=product.cid \u67e5\u8be2\u6240\u6709\u7684\u5546\u54c1\u4fe1\u606f\uff0c\u53f3\u5916\u8fde\u63a5 */ SELECT c.id, c.name, p.name FROM category c RIGHT OUTER JOIN product p ON c.id=p.cid; -- 9.\u67e5\u8be2\u6240\u6709\u7684\u7528\u6237\u548c\u8be5\u7528\u6237\u80fd\u67e5\u770b\u7684\u6240\u6709\u7684\u5546\u54c1\u3002\u663e\u793a\u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84\u3002\u5546\u54c1\u540d\u79f0 /* \u5206\u6790 \u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84 user\u8868 \u5546\u54c1\u540d\u79f0 product\u8868 \u4e2d\u95f4\u8868 us_pro \u6761\u4ef6\uff1aus_pro.uid=user.id AND us_pro.pid=product.id */ SELECT u.id, u.name, u.age, p.name FROM USER u, product p, us_pro up WHERE up.uid=u.id AND up.pid=p.id; -- 10.\u67e5\u8be2\u5f20\u4e09\u548c\u674e\u56db\u8fd9\u4e24\u4e2a\u7528\u6237\u53ef\u4ee5\u770b\u5230\u7684\u5546\u54c1\u3002\u663e\u793a\u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84\u3002\u5546\u54c1\u540d\u79f0 /* \u5206\u6790 \u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84 user\u8868 \u5546\u54c1\u540d\u79f0 product\u8868 \u4e2d\u95f4\u8868 us_pro \u6761\u4ef6\uff1aus_pro.uid=user.id AND us_pro.pid=product.id AND user.name IN ('\u5f20\u4e09','\u674e\u56db') */ SELECT u.id, u.name, u.age, p.name FROM USER u, product p, us_pro up WHERE up.uid=u.id AND up.pid=p.id AND u.name IN ('\u5f20\u4e09','\u674e\u56db'); 03\u89c6\u56fe \u00b6 \u89c6\u56fe_\u6570\u636e\u51c6\u5907 \u00b6 -- \u521b\u5efadb5\u6570\u636e\u5e93 CREATE DATABASE db5; -- \u4f7f\u7528db5\u6570\u636e\u5e93 USE db5; -- \u521b\u5efacountry\u8868 CREATE TABLE country( id INT PRIMARY KEY AUTO_INCREMENT, -- \u56fd\u5bb6id NAME VARCHAR(30) -- \u56fd\u5bb6\u540d\u79f0 ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO country VALUES (NULL,'\u4e2d\u56fd'),(NULL,'\u7f8e\u56fd'),(NULL,'\u4fc4\u7f57\u65af'); -- \u521b\u5efacity\u8868 CREATE TABLE city( id INT PRIMARY KEY AUTO_INCREMENT, -- \u57ce\u5e02id NAME VARCHAR(30), -- \u57ce\u5e02\u540d\u79f0 cid INT, -- \u5916\u952e\u5217\u3002\u5173\u8054country\u8868\u7684\u4e3b\u952e\u5217id CONSTRAINT cc_fk1 FOREIGN KEY (cid) REFERENCES country(id) -- \u6dfb\u52a0\u5916\u952e\u7ea6\u675f ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO city VALUES (NULL,'\u5317\u4eac',1),(NULL,'\u4e0a\u6d77',1),(NULL,'\u7ebd\u7ea6',2),(NULL,'\u83ab\u65af\u79d1',3); \u521b\u5efa\u89c6\u56fe \u00b6 /* \u6807\u51c6\u8bed\u6cd5 CREATE VIEW \u89c6\u56fe\u540d\u79f0 [(\u5217\u540d\u5217\u8868)] AS \u67e5\u8be2\u8bed\u53e5; */ example -- \u521b\u5efacity_country\u89c6\u56fe\uff0c\u4fdd\u5b58\u57ce\u5e02\u548c\u56fd\u5bb6\u7684\u4fe1\u606f(\u4f7f\u7528\u6307\u5b9a\u5217\u540d) CREATE VIEW city_country (city_id,city_name,country_name) AS SELECT c1.id, c1.name, c2.name FROM city c1, country c2 WHERE c1.cid=c2.id; \u67e5\u8be2\u89c6\u56fe \u00b6 /* \u6807\u51c6\u8bed\u6cd5 SELECT * FROM \u89c6\u56fe\u540d\u79f0; */ example -- \u67e5\u8be2\u89c6\u56fe SELECT * FROM city_country; day03 \u00b6 01\u89c6\u56fe \u00b6 \u6570\u636e\u51c6\u5907 \u00b6 -- \u521b\u5efadb7\u6570\u636e\u5e93 CREATE DATABASE db7; -- \u4f7f\u7528db7\u6570\u636e\u5e93 USE db7; -- \u521b\u5efacountry\u8868 CREATE TABLE country( id INT PRIMARY KEY AUTO_INCREMENT, -- \u56fd\u5bb6id country_name VARCHAR(30) -- \u56fd\u5bb6\u540d\u79f0 ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO country VALUES (NULL,'\u4e2d\u56fd'),(NULL,'\u7f8e\u56fd'),(NULL,'\u4fc4\u7f57\u65af'); -- \u521b\u5efacity\u8868 CREATE TABLE city( id INT PRIMARY KEY AUTO_INCREMENT, -- \u57ce\u5e02id city_name VARCHAR(30), -- \u57ce\u5e02\u540d\u79f0 cid INT, -- \u5916\u952e\u5217\u3002\u5173\u8054country\u8868\u7684\u4e3b\u952e\u5217id CONSTRAINT cc_fk1 FOREIGN KEY (cid) REFERENCES country(id) -- \u6dfb\u52a0\u5916\u952e\u7ea6\u675f ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO city VALUES (NULL,'\u5317\u4eac',1),(NULL,'\u4e0a\u6d77',1),(NULL,'\u7ebd\u7ea6',2),(NULL,'\u83ab\u65af\u79d1',3); \u521b\u5efa\u89c6\u56fe \u00b6 /* \u521b\u5efa\u89c6\u56fe \u6807\u51c6\u8bed\u6cd5 CREATE VIEW \u89c6\u56fe\u540d\u79f0 [(\u5217\u540d\u5217\u8868)] AS \u67e5\u8be2\u8bed\u53e5; */ \u67e5\u8be2\u89c6\u56fe \u00b6 \u67e5\u8be2\u89c6\u56fe \u00b6 /* \u6807\u51c6\u8bed\u6cd5 SELECT * FROM \u89c6\u56fe\u540d\u79f0; */ \u67e5\u8be2\u521b\u5efa\u89c6\u56fe\u7684\u8bed\u53e5 \u00b6 /* \u6807\u51c6\u8bed\u6cd5 SHOW CREATE VIEW \u89c6\u56fe\u540d\u79f0; */ \u4fee\u6539\u89c6\u56fe \u00b6 \u4fee\u6539\u89c6\u56fe\u8868\u6570\u636e \u00b6 /* \u6807\u51c6\u8bed\u6cd5 UPDATE \u89c6\u56fe\u540d\u79f0 SET \u5217\u540d=\u503c WHERE \u6761\u4ef6; */ \u4fee\u6539\u89c6\u56fe\u8868\u7ed3\u6784 \u00b6 /* \u4fee\u6539\u89c6\u56fe\u8868\u7ed3\u6784 \u6807\u51c6\u8bed\u6cd5 ALTER VIEW \u89c6\u56fe\u540d\u79f0 [(\u5217\u540d\u5217\u8868)] AS \u67e5\u8be2\u8bed\u53e5; */ \u5220\u9664\u89c6\u56fe \u00b6 /* \u5220\u9664\u89c6\u56fe \u6807\u51c6\u8bed\u6cd5 DROP VIEW [IF EXISTS] \u89c6\u56fe\u540d\u79f0; */ 02\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570 \u00b6 \u6570\u636e\u51c6\u5907 \u00b6 -- \u521b\u5efadb8\u6570\u636e\u5e93 CREATE DATABASE db8; -- \u4f7f\u7528db8\u6570\u636e\u5e93 USE db8; -- \u521b\u5efa\u5b66\u751f\u8868 CREATE TABLE student( id INT PRIMARY KEY AUTO_INCREMENT, -- \u5b66\u751fid NAME VARCHAR(20), -- \u5b66\u751f\u59d3\u540d age INT, -- \u5b66\u751f\u5e74\u9f84 gender VARCHAR(5), -- \u5b66\u751f\u6027\u522b score INT -- \u5b66\u751f\u6210\u7ee9 ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO student VALUES (NULL,'\u5f20\u4e09',23,'\u7537',95),(NULL,'\u674e\u56db',24,'\u7537',98), (NULL,'\u738b\u4e94',25,'\u5973',100),(NULL,'\u8d75\u516d',26,'\u5973',90); -- \u6309\u7167\u6027\u522b\u8fdb\u884c\u5206\u7ec4\uff0c\u67e5\u8be2\u6bcf\u7ec4\u5b66\u751f\u7684\u603b\u6210\u7ee9\u3002\u6309\u7167\u603b\u6210\u7ee9\u7684\u5347\u5e8f\u6392\u5e8f SELECT gender,SUM(score) getSum FROM student GROUP BY gender ORDER BY getSum ASC; \u521b\u5efa\u5b58\u50a8\u8fc7\u7a0b \u00b6 /* -- \u4fee\u6539\u5206\u9694\u7b26\u4e3a $ DELIMITER $ -- \u6807\u51c6\u8bed\u6cd5 CREATE PROCEDURE \u5b58\u50a8\u8fc7\u7a0b\u540d\u79f0 ( \u53c2\u6570 ...) BEGIN sql\u8bed\u53e5 ; END $ -- \u4fee\u6539\u5206\u9694\u7b26\u4e3a\u5206\u53f7 DELIMITER ; */ -- \u521b\u5efastu_group()\u5b58\u50a8\u8fc7\u7a0b\uff0c\u5c01\u88c5 \u5206\u7ec4\u67e5\u8be2\u603b\u6210\u7ee9\uff0c\u5e76\u6309\u7167\u603b\u6210\u7ee9\u5347\u5e8f\u6392\u5e8f\u7684\u529f\u80fd DELIMITER $ CREATE PROCEDURE stu_group () BEGIN SELECT gender , SUM ( score ) getSum FROM student GROUP BY gender ORDER BY getSum ASC ; END $ DELIMITER ; \u8c03\u7528\u5b58\u50a8\u8fc7\u7a0b \u00b6 /* \u8c03\u7528\u5b58\u50a8\u8fc7\u7a0b \u6807\u51c6\u8bed\u6cd5 CALL \u5b58\u50a8\u8fc7\u7a0b\u540d\u79f0(\u5b9e\u9645\u53c2\u6570); */ -- \u8c03\u7528stu_group\u5b58\u50a8\u8fc7\u7a0b CALL stu_group(); \u67e5\u8be2\u6570\u636e\u5e93\u4e2d\u6240\u6709\u7684\u5b58\u50a8\u8fc7\u7a0b \u00b6 /* \u67e5\u8be2\u6570\u636e\u5e93\u4e2d\u6240\u6709\u7684\u5b58\u50a8\u8fc7\u7a0b \u6807\u51c6\u8bed\u6cd5 SELECT name FROM mysql.proc WHERE db='\u6570\u636e\u5e93\u540d\u79f0'; */ -- \u67e5\u770bdb8\u6570\u636e\u5e93\u4e2d\u6240\u6709\u7684\u5b58\u50a8\u8fc7\u7a0b SELECT NAME FROM mysql.proc WHERE db='db8'; \u67e5\u770b\u5b58\u50a8\u8fc7\u7a0b\u7684\u72b6\u6001\u4fe1\u606f \u00b6 /* \u67e5\u770b\u5b58\u50a8\u8fc7\u7a0b\u7684\u72b6\u6001\u4fe1\u606f \u6807\u51c6\u8bed\u6cd5 SHOW PROCEDURE STATUS ; */ -- \u67e5\u770b\u5b58\u50a8\u8fc7\u7a0b\u7684\u72b6\u6001\u4fe1\u606f SHOW PROCEDURE STATUS ; \u67e5\u770b\u5b58\u50a8\u8fc7\u7a0b\u7684\u521b\u5efa\u8bed\u53e5 \u00b6 /* \u67e5\u770b\u5b58\u50a8\u8fc7\u7a0b\u7684\u521b\u5efa\u8bed\u53e5 \u6807\u51c6\u8bed\u6cd5 SHOW CREATE PROCEDURE \u5b58\u50a8\u8fc7\u7a0b\u540d\u79f0 ; */ -- \u67e5\u8be2stu_group\u5b58\u50a8\u8fc7\u7a0b\u7684\u521b\u5efa\u8bed\u53e5 SHOW CREATE PROCEDURE stu_group ; \u5220\u9664\u5b58\u50a8\u8fc7\u7a0b \u00b6 /* \u5220\u9664\u5b58\u50a8\u8fc7\u7a0b \u6807\u51c6\u8bed\u6cd5 DROP PROCEDURE [IF EXISTS] \u5b58\u50a8\u8fc7\u7a0b\u540d\u79f0; */ -- \u5220\u9664stu_group\u5b58\u50a8\u8fc7\u7a0b DROP PROCEDURE IF EXISTS stu_group ; \u5b58\u50a8\u8fc7\u7a0b-\u53d8\u91cf \u00b6 \u5b9a\u4e49\u53d8\u91cf \u00b6 /* \u5b9a\u4e49\u53d8\u91cf \u6807\u51c6\u8bed\u6cd5 DECLARE \u53d8\u91cf\u540d \u6570\u636e\u7c7b\u578b [DEFAULT \u9ed8\u8ba4\u503c]; */ -- \u5b9a\u4e49\u4e00\u4e2aint\u7c7b\u578b\u53d8\u91cf\uff0c\u5e76\u8d4b\u9ed8\u8ba4\u503c\u4e3a10 DELIMITER $ CREATE PROCEDURE pro_test1 () BEGIN -- \u5b9a\u4e49\u53d8\u91cf DECLARE num INT DEFAULT 10 ; -- \u67e5\u8be2\u53d8\u91cf SELECT num ; END $ DELIMITER ; -- \u8c03\u7528pro_test1\u5b58\u50a8\u8fc7\u7a0b CALL pro_test1(); \u53d8\u91cf\u8d4b\u503c-\u65b9\u5f0f\u4e00 \u00b6 /* \u53d8\u91cf\u8d4b\u503c-\u65b9\u5f0f\u4e00 \u6807\u51c6\u8bed\u6cd5 SET \u53d8\u91cf\u540d = \u53d8\u91cf\u503c; */ -- \u5b9a\u4e49\u4e00\u4e2avarchar\u7c7b\u578b\u53d8\u91cf\u5e76\u8d4b\u503c DELIMITER $ CREATE PROCEDURE pro_test2 () BEGIN -- \u5b9a\u4e49\u53d8\u91cf DECLARE NAME VARCHAR ( 10 ); -- \u4e3a\u53d8\u91cf\u8d4b\u503c SET NAME = '\u5b58\u50a8\u8fc7\u7a0b' ; -- \u67e5\u8be2\u53d8\u91cf SELECT NAME ; END $ DELIMITER ; -- \u8c03\u7528pro_test2\u5b58\u50a8\u8fc7\u7a0b CALL pro_test2(); \u53d8\u91cf\u8d4b\u503c-\u65b9\u5f0f\u4e8c /* \u53d8\u91cf\u8d4b\u503c-\u65b9\u5f0f\u4e8c \u6807\u51c6\u8bed\u6cd5 SELECT \u5217\u540d INTO \u53d8\u91cf\u540d FROM \u8868\u540d [WHERE \u6761\u4ef6]; */ -- \u5b9a\u4e49\u4e24\u4e2aint\u53d8\u91cf\uff0c\u7528\u4e8e\u5b58\u50a8\u7537\u5973\u540c\u5b66\u7684\u603b\u5206\u6570 DELIMITER $ CREATE PROCEDURE pro_test3 () BEGIN -- \u5b9a\u4e49\u53d8\u91cf DECLARE men , women INT ; -- \u67e5\u8be2\u7537\u540c\u5b66\u7684\u603b\u5206\u6570\uff0c\u4e3a men\u53d8\u91cf\u8d4b\u503c SELECT SUM ( score ) INTO men FROM student WHERE gender = '\u7537' ; -- \u67e5\u8be2\u5973\u540c\u5b66\u7684\u603b\u5206\u6570\uff0c\u4e3a women\u53d8\u91cf\u8d4b\u503c SELECT SUM ( score ) INTO women FROM student WHERE gender = '\u5973' ; -- \u67e5\u8be2\u53d8\u91cf SELECT men , women ; END $ DELIMITER ; -- \u8c03\u7528pro_test3\u5b58\u50a8\u8fc7\u7a0b CALL pro_test3(); \u5b58\u50a8\u8fc7\u7a0b-if\u8bed\u53e5 \u00b6 /* \u5b58\u50a8\u8fc7\u7a0b - if\u8bed\u53e5 \u6807\u51c6\u8bed\u6cd5 IF \u5224\u65ad\u6761\u4ef6 1 THEN \u6267\u884c\u7684 sql\u8bed\u53e51 ; [ ELSEIF \u5224\u65ad\u6761\u4ef6 2 THEN \u6267\u884c\u7684 sql\u8bed\u53e52 ;] ... [ ELSE \u6267\u884c\u7684 sql\u8bed\u53e5n ;] END IF ; */ / \u5b9a\u4e49\u4e00\u4e2aint\u53d8\u91cf\uff0c\u7528\u4e8e\u5b58\u50a8\u73ed\u7ea7\u603b\u6210\u7ee9 \u5b9a\u4e49\u4e00\u4e2avarchar\u53d8\u91cf\uff0c\u7528\u4e8e\u5b58\u50a8\u5206\u6570\u63cf\u8ff0 \u6839\u636e\u603b\u6210\u7ee9\u5224\u65ad\uff1a 380\u5206\u53ca\u4ee5\u4e0a \u5b66\u4e60\u4f18\u79c0 320 ~ 380 \u5b66\u4e60\u4e0d\u9519 320\u4ee5\u4e0b \u5b66\u4e60\u4e00\u822c / DELIMITER $ CREATE PROCEDURE pro_test4 () BEGIN -- \u5b9a\u4e49\u4fdd\u5b58\u603b\u6210\u7ee9\u7684\u53d8\u91cf DECLARE total INT ; -- \u5b9a\u4e49\u4fdd\u5b58\u5206\u6570\u63cf\u8ff0\u7684\u53d8\u91cf DECLARE description VARCHAR ( 10 ); -- \u4e3a total\u8d4b\u503c SELECT SUM ( score ) INTO total FROM student ; -- \u5224\u65ad\u603b\u6210\u7ee9 IF total >= 380 THEN SET description = '\u5b66\u4e60\u4f18\u79c0' ; ELSEIF total >= 320 AND total < 380 THEN SET description = '\u5b66\u4e60\u4e0d\u9519' ; ELSE SET description = '\u5b66\u4e60\u4e00\u822c' ; END IF ; -- \u67e5\u8be2\u603b\u6210\u7ee9\u548c\u63cf\u8ff0\u4fe1\u606f SELECT total , description ; END $ DELIMITER ; -- \u8c03\u7528pro_test4\u5b58\u50a8\u8fc7\u7a0b CALL pro_test4(); \u5b58\u50a8\u8fc7\u7a0b_\u8f93\u5165\u53c2\u6570 \u00b6 /* \u8f93\u5165\u53c2\u6570 DELIMITER $ -- \u6807\u51c6\u8bed\u6cd5 CREATE PROCEDURE \u5b58\u50a8\u8fc7\u7a0b\u540d\u79f0 ( IN \u53c2\u6570\u540d \u6570\u636e\u7c7b\u578b ) BEGIN \u6267\u884c\u7684 sql\u8bed\u53e5 ; END $ DELIMITER ; */ / \u8f93\u5165\u603b\u6210\u7ee9\u53d8\u91cf\uff0c\u4ee3\u8868\u5b66\u751f\u603b\u6210\u7ee9 \u5b9a\u4e49\u4e00\u4e2avarchar\u53d8\u91cf\uff0c\u7528\u4e8e\u5b58\u50a8\u5206\u6570\u63cf\u8ff0 \u6839\u636e\u603b\u6210\u7ee9\u5224\u65ad\uff1a 380\u5206\u53ca\u4ee5\u4e0a \u5b66\u4e60\u4f18\u79c0 320 ~ 380 \u5b66\u4e60\u4e0d\u9519 320\u4ee5\u4e0b \u5b66\u4e60\u4e00\u822c / DELIMITER $ CREATE PROCEDURE pro_test5 ( IN total INT ) BEGIN -- \u5b9a\u4e49\u5206\u6570\u63cf\u8ff0\u53d8\u91cf DECLARE description VARCHAR ( 10 ); -- \u5224\u65ad\u603b\u6210\u7ee9 IF total >= 380 THEN SET description = '\u5b66\u4e60\u4f18\u79c0' ; ELSEIF total >= 320 AND total < 380 THEN SET description = '\u5b66\u4e60\u4e0d\u9519' ; ELSE SET description = '\u5b66\u4e60\u4e00\u822c' ; END IF ; -- \u67e5\u8be2\u603b\u6210\u7ee9\u548c\u63cf\u8ff0\u4fe1\u606f SELECT total , description ; END $ DELIMITER ; -- \u8c03\u7528pro_test5\u5b58\u50a8\u8fc7\u7a0b CALL pro_test5(310); CALL pro_test5((SELECT SUM(score) FROM student)); \u5b58\u50a8\u8fc7\u7a0b_\u8f93\u51fa\u53c2\u6570 \u00b6 /* \u8f93\u51fa\u53c2\u6570 DELIMITER $ -- \u6807\u51c6\u8bed\u6cd5 CREATE PROCEDURE \u5b58\u50a8\u8fc7\u7a0b\u540d\u79f0 ( OUT \u53c2\u6570\u540d \u6570\u636e\u7c7b\u578b ) BEGIN \u6267\u884c\u7684 sql\u8bed\u53e5 ; END $ DELIMITER ; */ /\u8f93\u5165\u603b\u6210\u7ee9\u53d8\u91cf\uff0c\u4ee3\u8868\u5b66\u751f\u603b\u6210\u7ee9 \u8f93\u51fa\u5206\u6570\u63cf\u8ff0\u53d8\u91cf\uff0c\u4ee3\u8868\u5b66\u751f\u603b\u6210\u7ee9\u7684\u63cf\u8ff0 \u6839\u636e\u603b\u6210\u7ee9\u5224\u65ad\uff1a 380\u5206\u53ca\u4ee5\u4e0a \u5b66\u4e60\u4f18\u79c0 320 ~ 380 \u5b66\u4e60\u4e0d\u9519 320\u4ee5\u4e0b \u5b66\u4e60\u4e00\u822c */ DELIMITER $ CREATE PROCEDURE pro_test6 ( IN total INT , OUT description VARCHAR ( 10 )) BEGIN -- \u5224\u65ad\u603b\u6210\u7ee9 IF total >= 380 THEN SET description = '\u5b66\u4e60\u4f18\u79c0' ; ELSEIF total >= 320 AND total < 380 THEN SET description = '\u5b66\u4e60\u4e0d\u9519' ; ELSE SET description = '\u5b66\u4e60\u4e00\u822c' ; END IF ; END $ DELIMITER ; -- \u8c03\u7528pro_test6\u5b58\u50a8\u8fc7\u7a0b CALL pro_test6 ( 390 , @description ); -- \u67e5\u8be2\u603b\u6210\u7ee9\u63cf\u8ff0\u4fe1\u606f\u53d8\u91cf SELECT @description ; \u5b58\u50a8\u8fc7\u7a0b_case\u8bed\u53e5 \u00b6 /* case\u8bed\u53e5 \u6807\u51c6\u8bed\u6cd5 CASE WHEN \u5224\u65ad\u6761\u4ef6 1 THEN \u6267\u884c sql\u8bed\u53e51 ; [ WHEN \u5224\u65ad\u6761\u4ef6 2 THEN \u6267\u884c sql\u8bed\u53e52 ;] ... [ ELSE \u6267\u884c sql\u8bed\u53e5n ;] END CASE ; */ / \u8f93\u5165\u603b\u6210\u7ee9\u53d8\u91cf\uff0c\u4ee3\u8868\u5b66\u751f\u603b\u6210\u7ee9 \u5b9a\u4e49\u4e00\u4e2avarchar\u53d8\u91cf\uff0c\u7528\u4e8e\u5b58\u50a8\u5206\u6570\u63cf\u8ff0 \u6839\u636e\u603b\u6210\u7ee9\u5224\u65ad\uff1a 380\u5206\u53ca\u4ee5\u4e0a \u5b66\u4e60\u4f18\u79c0 320 ~ 380 \u5b66\u4e60\u4e0d\u9519 320\u4ee5\u4e0b \u5b66\u4e60\u4e00\u822c / DELIMITER $ CREATE PROCEDURE pro_test7 ( IN total INT ) BEGIN -- \u5b9a\u4e49\u603b\u6210\u7ee9\u63cf\u8ff0\u4fe1\u606f\u53d8\u91cf DECLARE description VARCHAR ( 10 ); -- \u5224\u65ad\u603b\u6210\u7ee9 CASE WHEN total >= 380 THEN SET description = '\u5b66\u4e60\u4f18\u79c0' ; WHEN total >= 320 AND total < 380 THEN SET description = '\u5b66\u4e60\u4e0d\u9519' ; ELSE SET description = '\u5b66\u4e60\u4e00\u822c' ; END CASE ; -- \u67e5\u8be2\u603b\u6210\u7ee9\u548c\u63cf\u8ff0\u4fe1\u606f SELECT total , description ; END $ DELIMITER ; -- \u8c03\u7528pro_test7\u5b58\u50a8\u8fc7\u7a0b CALL pro_test7(310); \u5b58\u50a8\u8fc7\u7a0b_while\u5faa\u73af \u00b6 /* while\u5faa\u73af \u6807\u51c6\u8bed\u6cd5 \u521d\u59cb\u5316\u8bed\u53e5 ; WHILE \u6761\u4ef6\u5224\u65ad\u8bed\u53e5 DO \u5faa\u73af\u4f53\u8bed\u53e5 ; \u6761\u4ef6\u63a7\u5236\u8bed\u53e5 ; END WHILE ; */ -- \u8ba1\u7b971~100\u4e4b\u95f4\u7684\u5076\u6570\u548c DELIMITER $ CREATE PROCEDURE pro_test8 () BEGIN -- \u5b9a\u4e49\u6c42\u548c\u53d8\u91cf DECLARE result INT DEFAULT 0 ; -- \u5b9a\u4e49\u521d\u59cb\u5316\u53d8\u91cf DECLARE num INT DEFAULT 1 ; -- while\u5faa\u73af WHILE num <= 100 DO -- \u5224\u65ad num\u662f\u5426\u662f\u5076\u6570 IF num % 2 = 0 THEN -- \u8ba9 num\u548cresult\u8fdb\u884c\u7d2f\u52a0 SET result = result + num ; END IF ; -- \u8ba9 num\u8fdb\u884c\u81ea\u589e SET num = num + 1 ; END WHILE ; -- \u67e5\u8be2\u6c42\u548c\u7ed3\u679c SELECT result ; END $ DELIMITER ; -- \u8c03\u7528pro_test8\u5b58\u50a8\u8fc7\u7a0b CALL pro_test8(); \u5b58\u50a8\u8fc7\u7a0b_repeat\u5faa\u73af \u00b6 /* repeat\u5faa\u73af \u6807\u51c6\u8bed\u6cd5 \u521d\u59cb\u5316\u8bed\u53e5 ; REPEAT \u5faa\u73af\u4f53\u8bed\u53e5 ; \u6761\u4ef6\u63a7\u5236\u8bed\u53e5 ; UNTIL \u6761\u4ef6\u5224\u65ad\u8bed\u53e5 END REPEAT ; */ -- \u8ba1\u7b971~10\u4e4b\u95f4\u7684\u548c DELIMITER $ CREATE PROCEDURE pro_test9 () BEGIN -- \u5b9a\u4e49\u6c42\u548c\u53d8\u91cf DECLARE result INT DEFAULT 0 ; -- \u5b9a\u4e49\u521d\u59cb\u5316\u53d8\u91cf DECLARE num INT DEFAULT 1 ; -- repeat\u5faa\u73af REPEAT -- \u7d2f\u52a0 SET result = result + num ; -- \u8ba9 num + 1 SET num = num + 1 ; -- \u505c\u6b62\u5faa\u73af UNTIL num > 10 END REPEAT ; -- \u67e5\u8be2\u6c42\u548c\u7ed3\u679c SELECT result ; END $ DELIMITER ; -- \u8c03\u7528pro_test9\u5b58\u50a8\u8fc7\u7a0b CALL pro_test9(); \u5b58\u50a8\u8fc7\u7a0b_loop\u5faa\u73af \u00b6 /* loop\u5faa\u73af \u6807\u51c6\u8bed\u6cd5 \u521d\u59cb\u5316\u8bed\u53e5; [ \u5faa\u73af\u540d\u79f0 : ] LOOP \u6761\u4ef6\u5224\u65ad\u8bed\u53e5 [ LEAVE \u5faa\u73af\u540d\u79f0 ; ] \u5faa\u73af\u4f53\u8bed\u53e5; \u6761\u4ef6\u63a7\u5236\u8bed\u53e5; END LOOP \u5faa\u73af\u540d\u79f0; */ -- \u8ba1\u7b971~10\u4e4b\u95f4\u7684\u548c DELIMITER $ CREATE PROCEDURE pro_test10 () BEGIN -- \u5b9a\u4e49\u6c42\u548c\u53d8\u91cf DECLARE result INT DEFAULT 0 ; -- \u5b9a\u4e49\u521d\u59cb\u5316\u53d8\u91cf DECLARE num INT DEFAULT 1 ; -- loop\u5faa\u73af l : LOOP -- \u6761\u4ef6\u5224\u65ad \uff0c \u505c\u6b62\u5faa\u73af IF num > 10 THEN LEAVE l ; END IF ; -- \u7d2f\u52a0 SET result = result + num ; -- \u8ba9num + 1 SET num = num + 1 ; END LOOP l ; -- \u67e5\u8be2\u6c42\u548c\u7ed3\u679c SELECT result ; END $ DELIMITER ; -- \u8c03\u7528pro_test10\u5b58\u50a8\u8fc7\u7a0b CALL pro_test10(); \u5b58\u50a8\u8fc7\u7a0b_\u6e38\u6807 \u00b6 /* \u6e38\u6807 \u6807\u51c6\u8bed\u6cd5 1.\u521b\u5efa\u6e38\u6807\uff1aDECLARE \u6e38\u6807\u540d\u79f0 CURSOR FOR \u67e5\u8be2sql\u8bed\u53e5; 2.\u6253\u5f00\u6e38\u6807\uff1aOPEN \u6e38\u6807\u540d\u79f0; 3.\u4f7f\u7528\u6e38\u6807\uff1aFETCH \u6e38\u6807\u540d\u79f0 INTO \u53d8\u91cf\u540d1,\u53d8\u91cf\u540d2,...; 4.\u5173\u95ed\u6e38\u6807\uff1aCLOSE \u6e38\u6807\u540d\u79f0; */ -- \u521b\u5efastu_score\u8868 CREATE TABLE stu_score( id INT PRIMARY KEY AUTO_INCREMENT, score INT ); -- \u5c06student\u8868\u4e2d\u6240\u6709\u7684\u6210\u7ee9\u4fdd\u5b58\u5230stu_score\u8868\u4e2d DELIMITER $ CREATE PROCEDURE pro_test11 () BEGIN -- \u5b9a\u4e49\u4e00\u4e2a\u4fdd\u5b58\u6210\u7ee9\u7684\u53d8\u91cf DECLARE s_score INT ; -- \u521b\u5efa\u6e38\u6807 DECLARE stu_result CURSOR FOR SELECT score FROM student ; -- \u5f00\u542f\u6e38\u6807 OPEN stu_result ; -- \u4f7f\u7528\u6e38\u6807 -- \u904d\u5386\u7ed3\u679c\uff0c\u62ff\u5230\u7b2c 1 \u884c\u6570\u636e FETCH stu_result INTO s_score ; -- \u5c06\u6570\u636e\u4fdd\u5b58\u5230 stu_score\u8868\u4e2d INSERT INTO stu_score VALUES ( NULL , s_score ); -- \u904d\u5386\u7ed3\u679c\uff0c\u62ff\u5230\u7b2c 2 \u884c\u6570\u636e FETCH stu_result INTO s_score ; -- \u5c06\u6570\u636e\u4fdd\u5b58\u5230 stu_score\u8868\u4e2d INSERT INTO stu_score VALUES ( NULL , s_score ); -- \u904d\u5386\u7ed3\u679c\uff0c\u62ff\u5230\u7b2c 3 \u884c\u6570\u636e FETCH stu_result INTO s_score ; -- \u5c06\u6570\u636e\u4fdd\u5b58\u5230 stu_score\u8868\u4e2d INSERT INTO stu_score VALUES ( NULL , s_score ); -- \u904d\u5386\u7ed3\u679c\uff0c\u62ff\u5230\u7b2c 4 \u884c\u6570\u636e FETCH stu_result INTO s_score ; -- \u5c06\u6570\u636e\u4fdd\u5b58\u5230 stu_score\u8868\u4e2d INSERT INTO stu_score VALUES ( NULL , s_score ); -- \u5173\u95ed\u6e38\u6807 CLOSE stu_result ; END $ DELIMITER ; -- \u8c03\u7528pro_test11\u5b58\u50a8\u8fc7\u7a0b CALL pro_test11(); -- \u67e5\u8be2stu_score\u6570\u636e\u8868 SELECT * FROM stu_score; \u5b58\u50a8\u8fc7\u7a0b_\u6e38\u6807\u4f18\u5316 \u00b6 /* \u5f53\u6e38\u6807\u7ed3\u675f\u540e\uff0c\u4f1a\u81ea\u52a8\u7684\u89e6\u53d1\u4e00\u4e2a\u4e8b\u4ef6\u3002\u5c31\u4ee3\u8868\u6e38\u6807\u5df2\u7ecf\u7ed3\u675f\u4e86\uff01 \u52a0\u6807\u8bb0\u7684\u601d\u60f3\uff1a 1.\u5b9a\u4e49\u4e00\u4e2a\u6807\u8bb0\u53d8\u91cf\uff0c\u9ed8\u8ba4\u503c\u4e3a0\uff08\u610f\u5473\u7740\u6709\u6570\u636e\uff09 2.\u5f53\u6e38\u6807\u7ed3\u675f\u540e\uff0c\u5c06\u6807\u8bb0\u53d8\u91cf\u7684\u503c\u4fee\u6539\u4e3a1\uff08\u610f\u5473\u7740\u6ca1\u6709\u6570\u636e\u4e86\uff09 */ DELIMITER $ CREATE PROCEDURE pro_test12 () BEGIN -- \u5b9a\u4e49\u4e00\u4e2a\u4fdd\u5b58\u6210\u7ee9\u7684\u53d8\u91cf DECLARE s_score INT ; -- \u5b9a\u4e49\u4e00\u4e2a\u6807\u8bb0\u53d8\u91cf\uff0c\u9ed8\u8ba4\u503c\u4e3a 0 \uff08\u610f\u5473\u7740\u6709\u6570\u636e\uff09 DECLARE flag INT DEFAULT 0 ; -- \u521b\u5efa\u6e38\u6807 DECLARE stu_result CURSOR FOR SELECT score FROM student ; -- \u5f53\u6e38\u6807\u7ed3\u675f\u540e\uff0c\u5c06\u6807\u8bb0\u53d8\u91cf\u7684\u503c\u4fee\u6539\u4e3a 1 \uff08\u610f\u5473\u7740\u6ca1\u6709\u6570\u636e\u4e86\uff09 DECLARE EXIT HANDLER FOR NOT FOUND SET flag = 1 ; -- \u5f00\u542f\u6e38\u6807 OPEN stu_result ; -- \u5faa\u73af\u4f7f\u7528\u6e38\u6807 REPEAT -- \u904d\u5386\u7ed3\u679c\uff0c\u62ff\u5230\u6570\u636e FETCH stu_result INTO s_score ; -- \u5c06\u6570\u636e\u4fdd\u5b58\u5230 stu_score\u8868\u4e2d INSERT INTO stu_score VALUES ( NULL , s_score ); -- \u5f53 flag\u7684\u503c\u662f1\u7684\u65f6\u5019 \uff0c\u5c31\u505c\u6b62\u5faa\u73af UNTIL flag = 1 END REPEAT ; -- \u5173\u95ed\u6e38\u6807 CLOSE stu_result ; END $ DELIMITER ; -- \u8c03\u7528pro_test12\u5b58\u50a8\u8fc7\u7a0b CALL pro_test12(); -- \u67e5\u8be2stu_score\u8868 SELECT * FROM stu_score; \u5b58\u50a8\u51fd\u6570 \u00b6 \u521b\u5efa\u5b58\u50a8\u51fd\u6570 \u00b6 /* \u521b\u5efa\u5b58\u50a8\u51fd\u6570 \u6807\u51c6\u8bed\u6cd5 CREATE FUNCTION \u51fd\u6570\u540d\u79f0 ([ \u53c2\u6570 \u6570\u636e\u7c7b\u578b ]) RETURNS \u8fd4\u56de\u503c\u7c7b\u578b BEGIN \u6267\u884c\u7684 sql\u8bed\u53e5 ; RETURN \u7ed3\u679c ; END $ */ -- \u5b9a\u4e49\u5b58\u50a8\u51fd\u6570\uff0c\u83b7\u53d6\u5b66\u751f\u8868\u4e2d\u6210\u7ee9\u5927\u4e8e95\u5206\u7684\u5b66\u751f\u6570\u91cf DELIMITER $ CREATE FUNCTION fun_test1 () RETURNS INT BEGIN -- \u5b9a\u4e49\u4e00\u4e2a\u7edf\u8ba1\u53d8\u91cf DECLARE result INT ; -- \u67e5\u8be2\u6210\u7ee9\u5927\u4e8e 95 \u5206\u7684\u6570\u91cf SELECT COUNT ( * ) INTO result FROM student WHERE score > 95 ; -- \u5c06\u7ed3\u679c\u8fd4\u56de RETURN result ; END $ DELIMITER ; \u8c03\u7528\u51fd\u6570 \u00b6 /* \u8c03\u7528\u51fd\u6570 \u6807\u51c6\u8bed\u6cd5 SELECT \u51fd\u6570\u540d\u79f0(\u5b9e\u9645\u53c2\u6570); */ -- \u8c03\u7528\u51fd\u6570 SELECT fun_test1(); \u5220\u9664\u51fd\u6570 \u00b6 /* \u5220\u9664\u51fd\u6570 \u6807\u51c6\u8bed\u6cd5 DROP FUNCTION \u51fd\u6570\u540d\u79f0; */ -- \u5220\u9664\u51fd\u6570 DROP FUNCTION fun_test1; 03\u89e6\u53d1\u5668 \u00b6 \u89e6\u53d1\u5668\u6570\u636e\u51c6\u5907 \u00b6 -- \u521b\u5efadb9\u6570\u636e\u5e93 CREATE DATABASE db9; -- \u4f7f\u7528db9\u6570\u636e\u5e93 USE db9; -- \u521b\u5efa\u8d26\u6237\u8868account CREATE TABLE account( id INT PRIMARY KEY AUTO_INCREMENT, -- \u8d26\u6237id NAME VARCHAR(20), -- \u59d3\u540d money DOUBLE -- \u4f59\u989d ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO account VALUES (NULL,'\u5f20\u4e09',1000),(NULL,'\u674e\u56db',2000); -- \u521b\u5efa\u65e5\u5fd7\u8868account_log CREATE TABLE account_log( id INT PRIMARY KEY AUTO_INCREMENT, -- \u65e5\u5fd7id operation VARCHAR(20), -- \u64cd\u4f5c\u7c7b\u578b (insert update delete) operation_time DATETIME, -- \u64cd\u4f5c\u65f6\u95f4 operation_id INT, -- \u64cd\u4f5c\u8868\u7684id operation_params VARCHAR(200) -- \u64cd\u4f5c\u53c2\u6570 ); INSERT\u578b\u89e6\u53d1\u5668 \u00b6 /* \u521b\u5efa\u89e6\u53d1\u5668 \u6807\u51c6\u8bed\u6cd5 DELIMITER $ CREATE TRIGGER \u89e6\u53d1\u5668\u540d\u79f0 BEFORE | AFTER INSERT | UPDATE | DELETE ON \u8868\u540d FOR EACH ROW BEGIN \u89e6\u53d1\u5668\u8981\u6267\u884c\u7684\u529f\u80fd ; END $ DELIMITER ; */ -- \u521b\u5efaINSERT\u578b\u89e6\u53d1\u5668\u3002\u7528\u4e8e\u5bf9account\u8868\u65b0\u589e\u6570\u636e\u8fdb\u884c\u65e5\u5fd7\u7684\u8bb0\u5f55 DELIMITER $ CREATE TRIGGER account_insert AFTER INSERT ON account FOR EACH ROW BEGIN INSERT INTO account_log VALUES ( NULL , 'INSERT' , NOW (), new . id , CONCAT ( '\u63d2\u5165\u540e{id=' , new . id , ',name=' , new . name , ',money=' , new . money , '}' )); END $ DELIMITER ; -- \u5411account\u8868\u6765\u6dfb\u52a0\u4e00\u6761\u8bb0\u5f55 INSERT INTO account VALUES (NULL,'\u738b\u4e94',3000); -- \u67e5\u8be2account\u8868 SELECT * FROM account; -- \u67e5\u8be2account_log\u8868 SELECT * FROM account_log; UPDATE\u578b\u89e6\u53d1\u5668 \u00b6 /* \u521b\u5efa\u89e6\u53d1\u5668 \u6807\u51c6\u8bed\u6cd5 DELIMITER $ CREATE TRIGGER \u89e6\u53d1\u5668\u540d\u79f0 BEFORE | AFTER INSERT | UPDATE | DELETE ON \u8868\u540d FOR EACH ROW BEGIN \u89e6\u53d1\u5668\u8981\u6267\u884c\u7684\u529f\u80fd ; END $ DELIMITER ; */ -- \u521b\u5efaUPDATE\u578b\u89e6\u53d1\u5668\u3002\u7528\u4e8e\u5bf9account\u8868\u4fee\u6539\u6570\u636e\u8fdb\u884c\u65e5\u5fd7\u7684\u8bb0\u5f55 DELIMITER $ CREATE TRIGGER account_update AFTER UPDATE ON account FOR EACH ROW BEGIN INSERT INTO account_log VALUES ( NULL , 'UPDATE' , NOW (), new . id , CONCAT ( '\u4fee\u6539\u524d{id=' , old . id , ',name=' , old . name , ',money=' , old . money , '}' , '\u4fee\u6539\u540e{id=' , new . id , ',name=' , new . name , ',money=' , new . money , '}' )); END $ DELIMITER ; -- \u4fee\u6539account\u8868\u4e2d\u674e\u56db\u7684\u91d1\u989d\u4e3a2500 UPDATE account SET money=2500 WHERE NAME='\u674e\u56db'; -- \u67e5\u8be2account\u8868 SELECT * FROM account; -- \u67e5\u8be2account_log\u8868 SELECT * FROM account_log; DELETE\u578b\u89e6\u53d1\u5668 \u00b6 /* \u521b\u5efa\u89e6\u53d1\u5668 \u6807\u51c6\u8bed\u6cd5 DELIMITER $ CREATE TRIGGER \u89e6\u53d1\u5668\u540d\u79f0 BEFORE | AFTER INSERT | UPDATE | DELETE ON \u8868\u540d FOR EACH ROW BEGIN \u89e6\u53d1\u5668\u8981\u6267\u884c\u7684\u529f\u80fd ; END $ DELIMITER ; */ -- \u521b\u5efaDELETE\u578b\u89e6\u53d1\u5668\u3002\u7528\u4e8e\u5bf9account\u8868\u5220\u9664\u6570\u636e\u8fdb\u884c\u65e5\u5fd7\u7684\u8bb0\u5f55 DELIMITER $ CREATE TRIGGER account_delete AFTER DELETE ON account FOR EACH ROW BEGIN INSERT INTO account_log VALUES ( NULL , 'DELETE' , NOW (), old . id , CONCAT ( '\u5220\u9664\u524d{id=' , old . id , ',name=' , old . name , ',money=' , old . money , '}' )); END $ DELIMITER ; -- \u5220\u9664account\u8868\u4e2d\u738b\u4e94 DELETE FROM account WHERE NAME='\u738b\u4e94'; -- \u67e5\u8be2account\u8868 SELECT * FROM account; -- \u67e5\u8be2account_log\u8868 SELECT * FROM account_log; \u67e5\u770b\u89e6\u53d1\u5668 \u00b6 /* \u67e5\u770b\u89e6\u53d1\u5668 \u6807\u51c6\u8bed\u6cd5 SHOW TRIGGERS; */ -- \u67e5\u770b\u89e6\u53d1\u5668 SHOW TRIGGERS ; \u5220\u9664\u89e6\u53d1\u5668 \u00b6 /* \u5220\u9664\u89e6\u53d1\u5668 \u6807\u51c6\u8bed\u6cd5 DROP TRIGGER \u89e6\u53d1\u5668\u540d\u79f0; */ -- \u5220\u9664\u89e6\u53d1\u5668 DROP TRIGGER account_delete; 04\u4e8b\u52a1 \u00b6 \u4e8b\u52a1\u7684\u6570\u636e\u51c6\u5907 \u00b6 -- \u521b\u5efadb10\u6570\u636e\u5e93 CREATE DATABASE db10; -- \u4f7f\u7528db10\u6570\u636e\u5e93 USE db10; -- \u521b\u5efa\u8d26\u6237\u8868 CREATE TABLE account( id INT PRIMARY KEY AUTO_INCREMENT, -- \u8d26\u6237id NAME VARCHAR(20), -- \u8d26\u6237\u540d\u79f0 money DOUBLE -- \u8d26\u6237\u4f59\u989d ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO account VALUES (NULL,'\u5f20\u4e09',1000),(NULL,'\u674e\u56db',1000); \u672a\u7ba1\u7406\u4e8b\u52a1 \u00b6 -- \u5f20\u4e09\u7ed9\u674e\u56db\u8f6c\u8d26500\u5143 -- 1.\u5f20\u4e09\u8d26\u6237-500 UPDATE account SET money=money-500 WHERE NAME='\u5f20\u4e09'; \u51fa\u9519\u4e86... -- 2.\u674e\u56db\u8d26\u6237+500 UPDATE account SET money=money+500 WHERE NAME='\u674e\u56db'; \u7ba1\u7406\u4e8b\u52a1 \u00b6 /* \u5f00\u542f\u4e8b\u52a1\uff1aSTART TRANSACTION; \u56de\u6eda\u4e8b\u52a1\uff1aROLLBACK; \u63d0\u4ea4\u4e8b\u52a1\uff1aCOMMIT; */ -- \u5f20\u4e09\u7ed9\u674e\u56db\u8f6c\u8d26500\u5143 -- 1.\u5f00\u542f\u4e8b\u52a1 START TRANSACTION; -- 2.\u6267\u884c\u8f6c\u8d26\u7684\u64cd\u4f5c UPDATE account SET money=money-500 WHERE NAME='\u5f20\u4e09'; \u51fa\u9519\u4e86... UPDATE account SET money=money+500 WHERE NAME='\u674e\u56db'; -- 3.\u7ed3\u675f\u4e8b\u52a1 -- 3.1\u56de\u6eda\u4e8b\u52a1 ROLLBACK; -- 3.2\u63d0\u4ea4\u4e8b\u52a1 COMMIT; \u4e8b\u52a1\u7684\u63d0\u4ea4\u65b9\u5f0f \u00b6 /* \u4e8b\u52a1\u7684\u63d0\u4ea4\u65b9\u5f0f \u67e5\u8be2\u4e8b\u52a1\u63d0\u4ea4\u65b9\u5f0f\uff1aSELECT @@AUTOCOMMIT; -- 1\u4ee3\u8868\u81ea\u52a8\u63d0\u4ea4 0\u4ee3\u8868\u624b\u52a8\u63d0\u4ea4 \u4fee\u6539\u4e8b\u52a1\u63d0\u4ea4\u65b9\u5f0f\uff1aSET @@AUTOCOMMIT=\u6570\u5b57; */ -- \u67e5\u8be2\u4e8b\u52a1\u7684\u63d0\u4ea4\u65b9\u5f0f SELECT @@autocommit ; UPDATE account SET money = 1000 WHERE NAME = '\u5f20\u4e09' ; COMMIT ; -- \u4fee\u6539\u4e8b\u52a1\u7684\u63d0\u4ea4\u65b9\u5f0f SET @@autocommit = 0 ; \u67e5\u8be2\u548c\u4fee\u6539\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b \u00b6 /* \u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b \u67e5\u8be2\u9694\u79bb\u7ea7\u522b\uff1aSELECT @@TX_ISOLATION; \u4fee\u6539\u9694\u79bb\u7ea7\u522b\uff1aSET GLOBAL TRANSACTION ISOLATION LEVEL \u7ea7\u522b\u5b57\u7b26\u4e32; */ -- \u67e5\u8be2\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b SELECT @@tx_isolation ; -- \u4fee\u6539\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b SET GLOBAL TRANSACTION ISOLATION LEVEL READ UNCOMMITTED; \u810f\u8bfb\u7684\u95ee\u9898\u6f14\u793a\u548c\u89e3\u51b3_\u7a97\u53e31 \u00b6 /* \u810f\u8bfb\u7684\u95ee\u9898\u6f14\u793a\u548c\u89e3\u51b3 \u810f\u8bfb\uff1a\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u8bfb\u53d6\u5230\u4e86\u5176\u4ed6\u4e8b\u52a1\u672a\u63d0\u4ea4\u7684\u6570\u636e */ -- \u8bbe\u7f6e\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u4e3aread uncommitted SET GLOBAL TRANSACTION ISOLATION LEVEL READ UNCOMMITTED; SET GLOBAL TRANSACTION ISOLATION LEVEL READ COMMITTED; -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION; -- \u8f6c\u8d26 UPDATE account SET money = money-500 WHERE NAME='\u5f20\u4e09'; UPDATE account SET money = money+500 WHERE NAME='\u674e\u56db'; -- \u67e5\u8be2account\u8868 SELECT * FROM account; -- \u56de\u6eda ROLLBACK; \u810f\u8bfb\u7684\u95ee\u9898\u6f14\u793a\u548c\u89e3\u51b3_\u7a97\u53e32 \u00b6 -- \u67e5\u8be2\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b SELECT @@tx_isolation ; -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION; -- \u67e5\u8be2account\u8868 SELECT * FROM account; \u4e0d\u53ef\u91cd\u590d\u8bfb\u7684\u95ee\u9898\u6f14\u793a\u548c\u89e3\u51b3_\u7a97\u53e31 \u00b6 /* \u4e0d\u53ef\u91cd\u590d\u8bfb\u7684\u95ee\u9898\u6f14\u793a\u548c\u89e3\u51b3 \u4e0d\u53ef\u91cd\u590d\u8bfb\uff1a\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u8bfb\u53d6\u5230\u4e86\u5176\u4ed6\u4e8b\u52a1\u5df2\u63d0\u4ea4\u7684\u6570\u636e */ -- \u8bbe\u7f6e\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u4e3aread committed SET GLOBAL TRANSACTION ISOLATION LEVEL READ COMMITTED; SET GLOBAL TRANSACTION ISOLATION LEVEL REPEATABLE READ; -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION; -- \u8f6c\u8d26 UPDATE account SET money = money-500 WHERE NAME='\u5f20\u4e09'; UPDATE account SET money = money+500 WHERE NAME='\u674e\u56db'; -- \u67e5\u8be2account\u8868 SELECT * FROM account; -- \u63d0\u4ea4\u4e8b\u52a1 COMMIT; \u4e0d\u53ef\u91cd\u590d\u8bfb\u7684\u95ee\u9898\u6f14\u793a\u548c\u89e3\u51b3_\u7a97\u53e32 \u00b6 -- \u67e5\u8be2\u9694\u79bb\u7ea7\u522b SELECT @@tx_isolation ; -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION; -- \u67e5\u8be2account\u8868 SELECT * FROM account; -- \u63d0\u4ea4\u4e8b\u52a1 COMMIT; \u5e7b\u8bfb\u7684\u95ee\u9898\u6f14\u793a\u548c\u89e3\u51b3_\u7a97\u53e31 \u00b6 /* \u5e7b\u8bfb\u7684\u95ee\u9898\u6f14\u793a\u548c\u89e3\u51b3 \u5e7b\u8bfb\uff1a \u67e5\u8be2\u67d0\u8bb0\u5f55\u662f\u5426\u5b58\u5728\uff0c\u4e0d\u5b58\u5728 \u51c6\u5907\u63d2\u5165\u6b64\u8bb0\u5f55\uff0c\u4f46\u6267\u884c\u63d2\u5165\u65f6\u53d1\u73b0\u6b64\u8bb0\u5f55\u5df2\u5b58\u5728\uff0c\u65e0\u6cd5\u63d2\u5165 \u6216\u67d0\u8bb0\u5f55\u4e0d\u5b58\u5728\u6267\u884c\u5220\u9664\uff0c\u5374\u53d1\u73b0\u5220\u9664\u6210\u529f */ -- \u8bbe\u7f6e\u9694\u79bb\u7ea7\u522b\u4e3arepeatable read SET GLOBAL TRANSACTION ISOLATION LEVEL REPEATABLE READ; SET GLOBAL TRANSACTION ISOLATION LEVEL SERIALIZABLE; -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION; -- \u6dfb\u52a0\u8bb0\u5f55 INSERT INTO account VALUES (4,'\u8d75\u516d',2000); -- \u67e5\u8be2account\u8868 SELECT * FROM account; -- \u63d0\u4ea4\u4e8b\u52a1 COMMIT; \u5e7b\u8bfb\u7684\u95ee\u9898\u6f14\u793a\u548c\u89e3\u51b3_\u7a97\u53e32 \u00b6 -- \u67e5\u8be2\u9694\u79bb\u7ea7\u522b SELECT @@tx_isolation ; -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION; -- \u67e5\u8be2account\u8868 SELECT * FROM account; -- \u6dfb\u52a0 INSERT INTO account VALUES (3,'\u738b\u4e94',2000); day04 \u00b6 01\u5b58\u50a8\u5f15\u64ce \u00b6 \u67e5\u8be2\u6570\u636e\u5e93\u652f\u6301\u7684\u5b58\u50a8\u5f15\u64ce \u00b6 /* \u67e5\u8be2\u6570\u636e\u5e93\u652f\u6301\u7684\u5b58\u50a8\u5f15\u64ce \u6807\u51c6\u8bed\u6cd5 SHOW ENGINES; */ \u67e5\u8be2\u67d0\u4e2a\u6570\u636e\u5e93\u4e2d\u6240\u6709\u6570\u636e\u8868\u7684\u5b58\u50a8\u5f15\u64ce \u00b6 /* \u67e5\u8be2\u67d0\u4e2a\u6570\u636e\u5e93\u4e2d\u6240\u6709\u6570\u636e\u8868\u7684\u5b58\u50a8\u5f15\u64ce \u6807\u51c6\u8bed\u6cd5 SHOW TABLE STATUS FROM \u6570\u636e\u5e93\u540d\u79f0; */ \u67e5\u8be2\u67d0\u4e2a\u6570\u636e\u5e93\u4e2d\u67d0\u4e2a\u8868\u7684\u5b58\u50a8\u5f15\u64ce \u00b6 /* \u67e5\u8be2\u67d0\u4e2a\u6570\u636e\u5e93\u4e2d\u67d0\u4e2a\u8868\u7684\u5b58\u50a8\u5f15\u64ce \u6807\u51c6\u8bed\u6cd5 SHOW TABLE STATUS FROM \u6570\u636e\u5e93\u540d\u79f0 WHERE NAME = '\u6570\u636e\u8868\u540d\u79f0'; */ \u521b\u5efa\u6570\u636e\u8868\u6307\u5b9a\u5b58\u50a8\u5f15\u64ce \u00b6 /* \u521b\u5efa\u6570\u636e\u8868\u6307\u5b9a\u5b58\u50a8\u5f15\u64ce \u6807\u51c6\u8bed\u6cd5 CREATE TABLE \u8868\u540d( \u5217\u540d,\u6570\u636e\u7c7b\u578b, ... )ENGINE = \u5f15\u64ce\u540d\u79f0; */ \u4fee\u6539\u6570\u636e\u8868\u7684\u5b58\u50a8\u5f15\u64ce \u00b6 /* \u4fee\u6539\u6570\u636e\u8868\u7684\u5b58\u50a8\u5f15\u64ce \u6807\u51c6\u8bed\u6cd5 ALTER TABLE \u8868\u540d ENGINE = \u5f15\u64ce\u540d\u79f0; */ -- \u4fee\u6539engine_test\u8868\u7684\u5f15\u64ce\u4e3aInnoDB ALTER TABLE engine_test ENGINE = INNODB; -- \u67e5\u8be2engine_test\u8868\u7684\u5b58\u50a8\u5f15\u64ce SHOW TABLE STATUS FROM db11 WHERE NAME = ' engine_test ' ; 02\u7d22\u5f15 \u00b6 \u7d22\u5f15\u6570\u636e\u51c6\u5907 \u00b6 -- \u521b\u5efadb12\u6570\u636e\u5e93 CREATE DATABASE db12; -- \u4f7f\u7528db12\u6570\u636e\u5e93 USE db12; -- \u521b\u5efastudent\u8868 CREATE TABLE student( id INT PRIMARY KEY AUTO_INCREMENT, NAME VARCHAR(10), age INT, score INT ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO student VALUES (NULL,'\u5f20\u4e09',23,98),(NULL,'\u674e\u56db',24,95), (NULL,'\u738b\u4e94',25,96),(NULL,'\u8d75\u516d',26,94),(NULL,'\u5468\u4e03',27,99); \u521b\u5efa\u548c\u67e5\u8be2\u7d22\u5f15 \u00b6 \u521b\u5efa\u7d22\u5f15 \u00b6 /* \u521b\u5efa\u7d22\u5f15 \u6807\u51c6\u8bed\u6cd5 CREATE [UNIQUE|FULLTEXT] INDEX \u7d22\u5f15\u540d\u79f0 [USING \u7d22\u5f15\u7c7b\u578b] -- \u9ed8\u8ba4\u662fB+TREE ON \u8868\u540d(\u5217\u540d...); */ -- \u4e3astudent\u8868\u4e2d\u7684name\u5217\u521b\u5efa\u4e00\u4e2a\u666e\u901a\u7d22\u5f15 CREATE INDEX idx_name ON student(NAME); -- \u4e3astudent\u8868\u4e2d\u7684age\u5217\u521b\u5efa\u4e00\u4e2a\u552f\u4e00\u7d22\u5f15 CREATE UNIQUE INDEX idx_age ON student(age); \u67e5\u8be2\u7d22\u5f15 \u00b6 /* \u67e5\u8be2\u7d22\u5f15 \u6807\u51c6\u8bed\u6cd5 SHOW INDEX FROM \u8868\u540d; */ -- \u67e5\u8be2student\u8868\u4e2d\u7684\u7d22\u5f15 SHOW INDEX FROM student ; ALTER\u6dfb\u52a0\u7d22\u5f15 \u00b6 /* ALTER\u6dfb\u52a0\u7d22\u5f15 -- \u666e\u901a\u7d22\u5f15 ALTER TABLE \u8868\u540d ADD INDEX \u7d22\u5f15\u540d\u79f0(\u5217\u540d); -- \u7ec4\u5408\u7d22\u5f15 ALTER TABLE \u8868\u540d ADD INDEX \u7d22\u5f15\u540d\u79f0(\u5217\u540d1,\u5217\u540d2,...); -- \u4e3b\u952e\u7d22\u5f15 ALTER TABLE \u8868\u540d ADD PRIMARY KEY(\u4e3b\u952e\u5217\u540d); -- \u5916\u952e\u7d22\u5f15(\u6dfb\u52a0\u5916\u952e\u7ea6\u675f\uff0c\u5c31\u662f\u5916\u952e\u7d22\u5f15) ALTER TABLE \u8868\u540d ADD CONSTRAINT \u5916\u952e\u540d FOREIGN KEY (\u672c\u8868\u5916\u952e\u5217\u540d) REFERENCES \u4e3b\u8868\u540d(\u4e3b\u952e\u5217\u540d); -- \u552f\u4e00\u7d22\u5f15 ALTER TABLE \u8868\u540d ADD UNIQUE \u7d22\u5f15\u540d\u79f0(\u5217\u540d); -- \u5168\u6587\u7d22\u5f15 ALTER TABLE \u8868\u540d ADD FULLTEXT \u7d22\u5f15\u540d\u79f0(\u5217\u540d); */ -- \u4e3astudent\u8868\u4e2dname\u5217\u6dfb\u52a0\u5168\u6587\u7d22\u5f15 ALTER TABLE student ADD FULLTEXT idx_fulltext_name(NAME); -- \u67e5\u8be2student\u8868\u7684\u7d22\u5f15 SHOW INDEX FROM student ; \u5220\u9664\u7d22\u5f15 \u00b6 /* \u5220\u9664\u7d22\u5f15 \u6807\u51c6\u8bed\u6cd5 DROP INDEX \u7d22\u5f15\u540d\u79f0 ON \u8868\u540d; */ -- \u5220\u9664idx_name\u7d22\u5f15 DROP INDEX idx_name ON student; \u7d22\u5f15\u7684\u6548\u7387\u6d4b\u8bd5 \u00b6 -- \u521b\u5efa product\u5546\u54c1\u8868 CREATE TABLE product ( id INT PRIMARY KEY AUTO_INCREMENT , -- \u5546\u54c1 id NAME VARCHAR ( 10 ), -- \u5546\u54c1\u540d\u79f0 price INT -- \u5546\u54c1\u4ef7\u683c ); -- \u5b9a\u4e49\u5b58\u50a8\u51fd\u6570\uff0c\u751f\u6210\u957f\u5ea6\u4e3a 10 \u7684\u968f\u673a\u5b57\u7b26\u4e32\u5e76\u8fd4\u56de DELIMITER $ CREATE FUNCTION rand_string () RETURNS VARCHAR ( 255 ) BEGIN DECLARE big_str VARCHAR ( 100 ) DEFAULT 'abcdefghijklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ' ; DECLARE small_str VARCHAR ( 255 ) DEFAULT '' ; DECLARE i INT DEFAULT 1 ; WHILE i <= 10 DO SET small_str = CONCAT ( small_str , SUBSTRING ( big_str , FLOOR ( 1 + RAND () * 52 ), 1 )); SET i = i + 1 ; END WHILE ; RETURN small_str ; END $ DELIMITER ; -- \u5b9a\u4e49\u5b58\u50a8\u8fc7\u7a0b\uff0c\u6dfb\u52a0 100 \u4e07\u6761\u6570\u636e\u5230 product\u8868\u4e2d DELIMITER $ CREATE PROCEDURE pro_test () BEGIN DECLARE num INT DEFAULT 1 ; WHILE num <= 1000000 DO INSERT INTO product VALUES ( NULL , rand_string (), num ); SET num = num + 1 ; END WHILE ; END $ DELIMITER ; -- \u8c03\u7528\u5b58\u50a8\u8fc7\u7a0b CALL pro_test (); -- \u67e5\u8be2\u603b\u8bb0\u5f55\u6761\u6570 SELECT COUNT ( * ) FROM product ; -- \u67e5\u8be2 product\u8868\u7684\u7d22\u5f15 SHOW INDEX FROM product ; -- \u67e5\u8be2 name\u4e3aOkIKDLVwtG\u7684\u6570\u636e ( 0.049 ) SELECT * FROM product WHERE NAME = 'OkIKDLVwtG' ; -- \u901a\u8fc7 id\u5217\u67e5\u8be2OkIKDLVwtG\u7684\u6570\u636e ( 1 \u6beb\u79d2 ) SELECT * FROM product WHERE id = 999998 ; -- \u4e3a name\u5217\u6dfb\u52a0\u7d22\u5f15 ALTER TABLE product ADD INDEX idx_name ( NAME ); -- \u67e5\u8be2 name\u4e3aOkIKDLVwtG\u7684\u6570\u636e ( 0.001 ) SELECT * FROM product WHERE NAME = 'OkIKDLVwtG' ; /* \u8303\u56f4\u67e5\u8be2 */ -- \u67e5\u8be2\u4ef7\u683c\u4e3a 800 ~ 1000 \u4e4b\u95f4\u7684\u6240\u6709\u6570\u636e ( 0.052 ) SELECT * FROM product WHERE price BETWEEN 800 AND 1000 ; /* \u6392\u5e8f\u67e5\u8be2 */ -- \u67e5\u8be2\u4ef7\u683c\u4e3a 800 ~ 1000 \u4e4b\u95f4\u7684\u6240\u6709\u6570\u636e , \u964d\u5e8f\u6392\u5217 ( 0.083 ) SELECT * FROM product WHERE price BETWEEN 800 AND 1000 ORDER BY price DESC ; -- \u4e3a price\u5217\u6dfb\u52a0\u7d22\u5f15 ALTER TABLE product ADD INDEX idx_price ( price ); -- \u67e5\u8be2\u4ef7\u683c\u4e3a 800 ~ 1000 \u4e4b\u95f4\u7684\u6240\u6709\u6570\u636e ( 0.011 ) SELECT * FROM product WHERE price BETWEEN 800 AND 1000 ; -- \u67e5\u8be2\u4ef7\u683c\u4e3a 800 ~ 1000 \u4e4b\u95f4\u7684\u6240\u6709\u6570\u636e , \u964d\u5e8f\u6392\u5217 ( 0.001 ) SELECT * FROM product WHERE price BETWEEN 800 AND 1000 ORDER BY price DESC ; 03\u9501 \u00b6 InnoDB\u9501\u7684\u6570\u636e\u51c6\u5907 \u00b6 -- \u521b\u5efadb13\u6570\u636e\u5e93 CREATE DATABASE db13; -- \u4f7f\u7528db13\u6570\u636e\u5e93 USE db13; -- \u521b\u5efastudent\u8868 CREATE TABLE student( id INT PRIMARY KEY AUTO_INCREMENT, NAME VARCHAR(10), age INT, score INT ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO student VALUES (NULL,'\u5f20\u4e09',23,99),(NULL,'\u674e\u56db',24,95), (NULL,'\u738b\u4e94',25,98),(NULL,'\u8d75\u516d',26,97); InnoDB\u5171\u4eab\u9501_\u7a97\u53e31 \u00b6 -- \u7a97\u53e31 /* \u5171\u4eab\u9501\uff1a\u6570\u636e\u53ef\u4ee5\u88ab\u591a\u4e2a\u4e8b\u52a1\u67e5\u8be2\uff0c\u4f46\u662f\u4e0d\u80fd\u4fee\u6539 \u521b\u5efa\u9501\u7684\u683c\u5f0f SELECT\u8bed\u53e5 LOCK IN SHARE MODE; */ -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION; -- \u67e5\u8be2id\u4e3a1\u7684\u6570\u636e\u8bb0\u5f55\u3002\u5e76\u4e14\u52a0\u5165\u5171\u4eab\u9501 SELECT * FROM student WHERE id=1 LOCK IN SHARE MODE; -- \u67e5\u8be2\u5206\u6570\u4e3a99\u7684\u6570\u636e\u8bb0\u5f55\u3002\u5e76\u4e14\u52a0\u5165\u5171\u4eab\u9501 SELECT * FROM student WHERE score=99 LOCK IN SHARE MODE; -- \u63d0\u4ea4\u4e8b\u52a1 COMMIT; InnoDB\u5171\u4eab\u9501_\u7a97\u53e32 \u00b6 -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION; -- \u67e5\u8be2id\u4e3a1\u7684\u6570\u636e\u8bb0\u5f55\u3002(\u666e\u901a\u67e5\u8be2\u6ca1\u95ee\u9898) SELECT * FROM student WHERE id=1; -- \u67e5\u8be2id\u4e3a1\u7684\u6570\u636e\u8bb0\u5f55\u3002\u5e76\u4e14\u52a0\u5165\u5171\u4eab\u9501(\u5171\u4eab\u9501\u548c\u5171\u4eab\u9501\u662f\u517c\u5bb9\u7684) SELECT * FROM student WHERE id=1 LOCK IN SHARE MODE; -- \u4fee\u6539id\u4e3a1\u7684\u6570\u636e\u3002\u4fee\u6539\u59d3\u540d\u4e3a\u5f20\u4e09\u4e09(\u4fee\u6539\u5931\u8d25\uff0c\u4f1a\u51fa\u73b0\u9501\u7684\u60c5\u51b5\u3002\u53ea\u6709\u7a97\u53e31\u63d0\u4ea4\u4e8b\u52a1\u540e\uff0c\u624d\u80fd\u4fee\u6539\u6210\u529f) UPDATE student SET NAME='\u5f20\u4e09\u4e09' WHERE id=1; -- \u4fee\u6539id\u4e3a2\u7684\u6570\u636e\u3002\u4fee\u6539\u59d3\u540d\u4e3a\u674e\u56db\u56db(\u4fee\u6539\u6210\u529f\u3002InnoDB\u5f15\u64ce\u9ed8\u8ba4\u662f\u884c\u9501) UPDATE student SET NAME='\u674e\u56db\u56db' WHERE id=2; -- \u4fee\u6539id\u4e3a3\u7684\u6570\u636e\u3002\u4fee\u6539\u59d3\u540d\u4e3a\u738b\u4e94\u4e94(\u6ce8\u610f\uff1aInnoDB\u5f15\u64ce\u5982\u679c\u4e0d\u91c7\u7528\u5e26\u7d22\u5f15\u7684\u5217\uff0c\u5219\u4f1a\u63d0\u5347\u4e3a\u8868\u9501) UPDATE student SET NAME='\u738b\u4e94\u4e94' WHERE id=3; -- \u63d0\u4ea4\u4e8b\u52a1 COMMIT; InnoDB\u6392\u4ed6\u9501_\u7a97\u53e31 \u00b6 -- \u7a97\u53e3 1 /* \u6392\u4ed6\u9501\uff1a\u52a0\u9501\u7684\u6570\u636e\uff0c\u4e0d\u80fd\u88ab\u5176\u4ed6\u4e8b\u52a1\u52a0\u9501\u67e5\u8be2\u6216\u4fee\u6539 \u6392\u4ed6\u9501\u521b\u5efa\u683c\u5f0f SELECT\u8bed\u53e5 FOR UPDATE; */ -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION ; -- \u67e5\u8be2 id \u4e3a 1 \u7684\u6570\u636e\u8bb0\u5f55\u3002\u5e76\u4e14\u52a0\u5165\u6392\u4ed6\u9501 SELECT * FROM student WHERE id = 1 FOR UPDATE ; -- \u63d0\u4ea4\u4e8b\u52a1 COMMIT ; InnoDB\u6392\u4ed6\u9501_\u7a97\u53e32 \u00b6 -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION ; -- \u67e5\u8be2 id \u4e3a 1 \u7684\u6570\u636e\u8bb0\u5f55\u3002 ( \u666e\u901a\u67e5\u8be2\u6ca1\u95ee\u9898 ) SELECT * FROM student WHERE id = 1 ; -- \u67e5\u8be2 id \u4e3a 1 \u7684\u6570\u636e\u8bb0\u5f55\u3002\u5e76\u4e14\u52a0\u5165\u5171\u4eab\u9501 ( \u6392\u4ed6\u9501\u4e0d\u80fd\u548c\u5171\u4eab\u9501\u5171\u5b58 ) SELECT * FROM student WHERE id = 1 LOCK IN SHARE MODE ; -- \u67e5\u8be2 id \u4e3a 1 \u7684\u6570\u636e\u8bb0\u5f55\u3002\u5e76\u4e14\u52a0\u5165\u6392\u4ed6\u9501 ( \u6392\u4ed6\u9501\u548c\u6392\u4ed6\u9501\u4e0d\u80fd\u5171\u5b58 ) SELECT * FROM student WHERE id = 1 FOR UPDATE ; -- \u4fee\u6539 id \u4e3a 1 \u7684\u6570\u636e\u3002\u5c06\u59d3\u540d\u4fee\u6539\u4e3a\u5f20\u4e09\u4e09 ( \u4e0d\u80fd\u4fee\u6539\u3002\u4f1a\u51fa\u73b0\u9501\u7684\u60c5\u51b5\u3002\u53ea\u6709\u7a97\u53e3 1 \u63d0\u4ea4\u4e8b\u52a1\u540e\uff0c\u624d\u80fd\u4fee\u6539\u6210\u529f ) UPDATE student SET NAME = ' \u5f20\u4e09\u4e09 ' WHERE id = 1 ; -- \u63d0\u4ea4\u4e8b\u52a1 COMMIT ; MYISAM\u9501\u7684\u6570\u636e\u51c6\u5907 \u00b6 -- \u521b\u5efaproduct\u8868 CREATE TABLE product( id INT PRIMARY KEY AUTO_INCREMENT, NAME VARCHAR(20), price INT )ENGINE = MYISAM; -- \u6307\u5b9a\u5b58\u50a8\u5f15\u64ce\u4e3aMyISAM -- \u6dfb\u52a0\u6570\u636e INSERT INTO product VALUES (NULL,'\u534e\u4e3a\u624b\u673a',4999),(NULL,'\u5c0f\u7c73\u624b\u673a',2999), (NULL,'\u82f9\u679c',8999),(NULL,'\u4e2d\u5174',1999); MYISAM\u8bfb\u9501_\u7a97\u53e31 \u00b6 /* \u8bfb\u9501\uff1a\u6240\u6709\u8fde\u63a5\u53ea\u80fd\u8bfb\u53d6\u6570\u636e\uff0c\u4e0d\u80fd\u4fee\u6539 \u52a0\u9501 LOCK TABLE \u8868\u540d READ; \u89e3\u9501(\u5c06\u5f53\u524d\u4f1a\u8bdd\u6240\u6709\u7684\u8868\u8fdb\u884c\u89e3\u9501) UNLOCK TABLES; */ -- \u4e3aproduct\u8868\u6dfb\u52a0\u8bfb\u9501 LOCK TABLE product READ; -- \u67e5\u8be2product\u8868(\u67e5\u8be2\u6210\u529f) SELECT * FROM product; -- \u5c06id\u4e3a1\u7684\u4ef7\u683c\u4fee\u6539\u4e3a5999(\u4e0d\u80fd\u4fee\u6539) UPDATE product SET price=5999 WHERE id=1; -- \u89e3\u9501 UNLOCK TABLES; MYISAM\u8bfb\u9501_\u7a97\u53e32 \u00b6 -- \u67e5\u8be2product\u8868(\u67e5\u8be2\u6210\u529f) SELECT * FROM product; -- \u5c06id\u4e3a1\u7684\u4ef7\u683c\u4fee\u6539\u4e3a5999(\u4e0d\u80fd\u4fee\u6539\u3002\u53ea\u6709\u7a97\u53e31\u89e3\u9501\u540e\u624d\u80fd\u4fee\u6539\u6210\u529f) UPDATE product SET price=5999 WHERE id=1; MYISAM\u5199\u9501_\u7a97\u53e31 \u00b6 /* \u5199\u9501\uff1a\u5176\u4ed6\u8fde\u63a5\u4e0d\u80fd\u67e5\u8be2\u548c\u4fee\u6539\u6570\u636e \u52a0\u9501 LOCK TABLE \u8868\u540d WRITE; \u89e3\u9501(\u5c06\u5f53\u524d\u4f1a\u8bdd\u6240\u6709\u7684\u8868\u8fdb\u884c\u89e3\u9501) UNLOCK TABLES; */ -- \u4e3a product\u8868\u6dfb\u52a0\u5199\u9501 LOCK TABLE product WRITE ; -- \u67e5\u8be2 product\u8868 ( \u67e5\u8be2\u6210\u529f ) SELECT * FROM product ; -- \u4fee\u6539 id\u4e3a2\u7684\u4ef7\u683c\u4e3a3999 ( \u4fee\u6539\u6210\u529f ) UPDATE product SET price = 3999 WHERE id = 2 ; -- \u89e3\u9501 UNLOCK TABLES ; MYISAM\u5199\u9501_\u7a97\u53e32 \u00b6 -- \u67e5\u8be2product\u8868\uff08\u67e5\u8be2\u5931\u8d25\u3002\u53ea\u6709\u7a97\u53e31\u89e3\u9501\u540e\uff0c\u624d\u80fd\u67e5\u8be2\u6210\u529f\uff09 SELECT * FROM product; -- \u4fee\u6539id\u4e3a2\u7684\u4ef7\u683c\u4e3a1999(\u4fee\u6539\u5931\u8d25\u3002\u53ea\u6709\u7a97\u53e31\u89e3\u9501\u540e\uff0c\u624d\u80fd\u4fee\u6539\u6210\u529f) UPDATE product SET price=1999 WHERE id=2; \u4e50\u89c2\u9501 \u00b6 -- \u521b\u5efacity\u8868 CREATE TABLE city( id INT PRIMARY KEY AUTO_INCREMENT, -- \u57ce\u5e02id NAME VARCHAR(20), -- \u57ce\u5e02\u540d\u79f0 VERSION INT -- \u7248\u672c\u53f7 ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO city VALUES (NULL,'\u5317\u4eac',1),(NULL,'\u4e0a\u6d77',1),(NULL,'\u5e7f\u5dde',1),(NULL,'\u6df1\u5733',1); -- \u5c06\u5317\u4eac\u4fee\u6539\u4e3a\u5317\u4eac\u5e02 -- 1.\u5c06\u5317\u4eac\u7684\u7248\u672c\u53f7\u8bfb\u53d6\u51fa\u6765 SELECT VERSION FROM city WHERE NAME='\u5317\u4eac'; -- 1 -- 2.\u4fee\u6539\u5317\u4eac\u4e3a\u5317\u4eac\u5e02\uff0c\u7248\u672c\u53f7+1.\u5e76\u5bf9\u6bd4\u7248\u672c\u53f7\u662f\u5426\u76f8\u540c UPDATE city SET NAME='\u5317\u4eac\u5e02',VERSION=VERSION+1 WHERE NAME='\u5317\u4eac' AND VERSION=1; 04\u4e3b\u4ece\u590d\u5236 \u00b6 \u4e3b\u4ece\u590d\u5236_\u4e3b\u670d\u52a1\u5668\u64cd\u4f5c \u00b6 -- \u4e3b\u670d\u52a1\u5668\u521b\u5efadb1\u6570\u636e\u5e93,\u4ece\u670d\u52a1\u5668\u4f1a\u81ea\u52a8\u540c\u6b65 CREATE DATABASE db1; \u4e3b\u4ece\u590d\u5236_\u4ece\u670d\u52a1\u5668\u64cd\u4f5c \u00b6 -- \u4ece\u670d\u52a1\u5668\u521b\u5efadb2\u6570\u636e\u5e93,\u4e3b\u670d\u52a1\u5668\u4e0d\u4f1a\u81ea\u52a8\u540c\u6b65 CREATE DATABASE db2; 05\u8bfb\u5199\u5206\u79bb \u00b6 \u8bfb\u5199\u5206\u79bb_mycat\u64cd\u4f5c \u00b6 -- \u521b\u5efa\u5b66\u751f\u8868 CREATE TABLE student( id INT PRIMARY KEY AUTO_INCREMENT, NAME VARCHAR(10) ); -- \u67e5\u8be2\u5b66\u751f\u8868 SELECT * FROM student; -- \u6dfb\u52a0\u4e24\u6761\u8bb0\u5f55 INSERT INTO student VALUES (NULL,'\u5f20\u4e09'),(NULL,'\u674e\u56db'); -- \u505c\u6b62\u4e3b\u4ece\u590d\u5236\u540e\uff0c\u6dfb\u52a0\u7684\u6570\u636e\u53ea\u4f1a\u4fdd\u5b58\u5230\u4e3b\u670d\u52a1\u5668\u4e0a\u3002 INSERT INTO student VALUES (NULL,'\u738b\u4e94'); \u8bfb\u5199\u5206\u79bb_\u4e3b\u670d\u52a1\u5668\u64cd\u4f5c \u00b6 -- \u4e3b\u670d\u52a1\u5668\uff1a\u67e5\u8be2\u5b66\u751f\u8868\uff0c\u53ef\u4ee5\u770b\u5230\u6570\u636e SELECT * FROM student; \u8bfb\u5199\u5206\u79bb_\u4ece\u670d\u52a1\u5668\u64cd\u4f5c \u00b6 -- \u4ece\u670d\u52a1\u5668\uff1a\u67e5\u8be2\u5b66\u751f\u8868\uff0c\u53ef\u4ee5\u770b\u5230\u6570\u636e(\u56e0\u4e3a\u6709\u4e3b\u4ece\u590d\u5236) SELECT * FROM student; -- \u4ece\u670d\u52a1\u5668\uff1a\u5220\u9664\u4e00\u6761\u8bb0\u5f55\u3002(\u4e3b\u670d\u52a1\u5668\u5e76\u6ca1\u6709\u5220\u9664\uff0cmycat\u4e2d\u95f4\u4ef6\u67e5\u8be2\u7684\u7ed3\u679c\u662f\u4ece\u670d\u52a1\u5668\u7684\u6570\u636e) DELETE FROM student WHERE id=2; 06\u6c34\u5e73\u62c6\u5206 \u00b6 \u6c34\u5e73\u62c6\u5206_mycat\u64cd\u4f5c \u00b6 -- \u521b\u5efa product \u8868 CREATE TABLE product ( id INT PRIMARY KEY AUTO_INCREMENT , NAME VARCHAR ( 20 ) , price INT ) ; -- \u6dfb\u52a0 6 \u6761\u6570\u636e INSERT INTO product ( id , NAME , price ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' \u82f9\u679c\u624b\u673a ' , 6999 ) ; INSERT INTO product ( id , NAME , price ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' \u534e\u4e3a\u624b\u673a ' , 5999 ) ; INSERT INTO product ( id , NAME , price ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' \u4e09\u661f\u624b\u673a ' , 4999 ) ; INSERT INTO product ( id , NAME , price ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' \u5c0f\u7c73\u624b\u673a ' , 3999 ) ; INSERT INTO product ( id , NAME , price ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' \u4e2d\u5174\u624b\u673a ' , 2999 ) ; INSERT INTO product ( id , NAME , price ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' OOPO\u624b\u673a ' , 1999 ) ; -- \u67e5\u8be2 product \u8868 SELECT * FROM product ; \u6c34\u5e73\u62c6\u5206_\u4e3b\u670d\u52a1\u5668\u64cd\u4f5c \u00b6 -- \u5728\u4e0d\u540c\u6570\u636e\u5e93\u4e2d\u67e5\u8be2product\u8868 SELECT * FROM product; \u6c34\u5e73\u62c6\u5206_\u4ece\u670d\u52a1\u5668\u64cd\u4f5c \u00b6 -- \u5728\u4e0d\u540c\u6570\u636e\u5e93\u4e2d\u67e5\u8be2product\u8868 SELECT * FROM product; 07\u5782\u76f4\u62c6\u5206 \u00b6 \u5782\u76f4\u62c6\u5206_mycat\u64cd\u4f5c \u00b6 -- \u521b\u5efa dog \u8868 CREATE TABLE dog ( id INT PRIMARY KEY AUTO_INCREMENT , NAME VARCHAR ( 10 ) ) ; -- \u6dfb\u52a0\u6570\u636e INSERT INTO dog ( id , NAME ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' \u54c8\u58eb\u5947 ' ) ; -- \u67e5\u8be2 dog \u8868 SELECT * FROM dog ; -- \u521b\u5efa cat \u8868 CREATE TABLE cat ( id INT PRIMARY KEY AUTO_INCREMENT , NAME VARCHAR ( 10 ) ) ; -- \u6dfb\u52a0\u6570\u636e INSERT INTO cat ( id , NAME ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' \u6ce2\u65af\u732b ' ) ; -- \u67e5\u8be2 cat \u8868 SELECT * FROM cat ; -- \u521b\u5efa apple \u8868 CREATE TABLE apple ( id INT PRIMARY KEY AUTO_INCREMENT , NAME VARCHAR ( 10 ) ) ; -- \u6dfb\u52a0\u6570\u636e INSERT INTO apple ( id , NAME ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' \u7ea2\u5bcc\u58eb ' ) ; -- \u67e5\u8be2 apple \u8868 SELECT * FROM apple ; -- \u521b\u5efa banana \u8868 CREATE TABLE banana ( id INT PRIMARY KEY AUTO_INCREMENT , NAME VARCHAR ( 10 ) ) ; -- \u6dfb\u52a0\u6570\u636e INSERT INTO banana ( id , NAME ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' \u9999\u8549 ' ) ; -- \u67e5\u8be2 banana \u8868 SELECT * FROM banana ; \u5782\u76f4\u62c6\u5206_\u4e3b\u670d\u52a1\u5668\u64cd\u4f5c \u00b6 -- \u67e5\u8be2dog\u8868 SELECT * FROM dog; -- \u67e5\u8be2cat\u8868 SELECT * FROM cat; -- \u67e5\u8be2apple\u8868 SELECT * FROM apple; -- \u67e5\u8be2banana\u8868 SELECT * FROM banana; \u5782\u76f4\u62c6\u5206_\u4ece\u670d\u52a1\u5668\u64cd\u4f5c \u00b6 -- \u67e5\u8be2dog\u8868 SELECT * FROM dog; -- \u67e5\u8be2cat\u8868 SELECT * FROM cat; -- \u67e5\u8be2apple\u8868 SELECT * FROM apple; -- \u67e5\u8be2banana\u8868 SELECT * FROM banana;","title":"Mysql"},{"location":"MySQL/#mysql","text":"Reference Manual","title":"MySQL \u53c2\u8003\u624b\u518c"},{"location":"MySQL/#day01","text":"","title":"day01"},{"location":"MySQL/#01","text":"","title":"01\u64cd\u4f5c\u6570\u636e\u5e93\u548c\u6570\u636e\u8868"},{"location":"MySQL/#_1","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a SHOW DATABASES; */","title":"\u67e5\u8be2\u6240\u6709\u6570\u636e\u5e93"},{"location":"MySQL/#_2","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a SHOW CREATE DATABASE \u6570\u636e\u5e93\u540d\u79f0; */","title":"\u67e5\u8be2\u67d0\u4e2a\u6570\u636e\u5e93\u7684\u521b\u5efa\u8bed\u53e5"},{"location":"MySQL/#_3","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a CREATE DATABASE \u6570\u636e\u5e93\u540d\u79f0; */","title":"\u521b\u5efa\u6570\u636e\u5e93"},{"location":"MySQL/#_4","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a CREATE DATABASE IF NOT EXISTS \u6570\u636e\u5e93\u540d\u79f0; */","title":"\u521b\u5efa\u6570\u636e\u5e93\uff0c\u5224\u65ad\u3001\u5982\u679c\u4e0d\u5b58\u5728\u5219\u521b\u5efa"},{"location":"MySQL/#_5","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a CREATE DATABASE \u6570\u636e\u5e93\u540d\u79f0 CHARACTER SET \u5b57\u7b26\u96c6\u540d\u79f0; */","title":"\u521b\u5efa\u6570\u636e\u5e93\u3001\u5e76\u6307\u5b9a\u5b57\u7b26\u96c6"},{"location":"MySQL/#_6","text":"SHOW CREATE DATABASE \u6570\u636e\u5e93\u540d\u79f0 ;","title":"\u67e5\u770b\u6570\u636e\u5e93\u7684\u5b57\u7b26\u96c6"},{"location":"MySQL/#_7","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a ALTER DATABASE \u6570\u636e\u5e93\u540d\u79f0 CHARACTER SET \u5b57\u7b26\u96c6\u540d\u79f0; */","title":"\u4fee\u6539\u6570\u636e\u5e93\u7684\u5b57\u7b26\u96c6"},{"location":"MySQL/#_8","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a DROP DATABASE \u6570\u636e\u5e93\u540d\u79f0; */","title":"\u5220\u9664\u6570\u636e\u5e93"},{"location":"MySQL/#_9","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a DROP DATABASE IF EXISTS \u6570\u636e\u5e93\u540d\u79f0; */","title":"\u5220\u9664\u6570\u636e\u5e93\uff0c\u5224\u65ad\u3001\u5982\u679c\u5b58\u5728\u5219\u5220\u9664"},{"location":"MySQL/#_10","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a USE \u6570\u636e\u5e93\u540d\u79f0; */","title":"\u4f7f\u7528\u6570\u636e\u5e93"},{"location":"MySQL/#_11","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT DATABASE(); */","title":"\u67e5\u8be2\u5f53\u524d\u4f7f\u7528\u7684\u6570\u636e\u5e93"},{"location":"MySQL/#_12","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a SHOW TABLES; */","title":"\u67e5\u8be2\u6240\u6709\u6570\u636e\u8868"},{"location":"MySQL/#_13","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a DESC \u8868\u540d; */","title":"\u67e5\u8be2\u8868\u7ed3\u6784"},{"location":"MySQL/#_14","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a SHOW TABLE STATUS FROM \u6570\u636e\u5e93\u540d\u79f0 LIKE '\u8868\u540d'; */","title":"\u67e5\u8be2\u6570\u636e\u8868\u7684\u5b57\u7b26\u96c6"},{"location":"MySQL/#_15","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a CREATE TABLE \u8868\u540d( \u5217\u540d \u6570\u636e\u7c7b\u578b \u7ea6\u675f, \u5217\u540d \u6570\u636e\u7c7b\u578b \u7ea6\u675f, ... \u5217\u540d \u6570\u636e\u7c7b\u578b \u7ea6\u675f ); */","title":"\u521b\u5efa\u6570\u636e\u8868"},{"location":"MySQL/#_16","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u65e7\u8868\u540d RENAME TO \u65b0\u8868\u540d; */","title":"\u4fee\u6539\u8868\u540d"},{"location":"MySQL/#_17","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d CHARACTER SET \u5b57\u7b26\u96c6\u540d\u79f0; */","title":"\u4fee\u6539\u8868\u7684\u5b57\u7b26\u96c6"},{"location":"MySQL/#_18","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d ADD \u5217\u540d \u6570\u636e\u7c7b\u578b; */","title":"\u7ed9\u8868\u6dfb\u52a0\u5217"},{"location":"MySQL/#_19","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d MODIFY \u5217\u540d \u6570\u636e\u7c7b\u578b; */","title":"\u4fee\u6539\u8868\u4e2d\u5217\u7684\u6570\u636e\u7c7b\u578b"},{"location":"MySQL/#_20","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d CHANGE \u65e7\u5217\u540d \u65b0\u5217\u540d \u6570\u636e\u7c7b\u578b; */","title":"\u4fee\u6539\u8868\u4e2d\u5217\u7684\u540d\u79f0\u548c\u6570\u636e\u7c7b\u578b"},{"location":"MySQL/#_21","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d DROP \u5217\u540d; */","title":"\u5220\u9664\u8868\u4e2d\u7684\u5217"},{"location":"MySQL/#_22","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a DROP TABLE \u8868\u540d; */","title":"\u5220\u9664\u8868"},{"location":"MySQL/#_23","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a DROP TABLE IF EXISTS \u8868\u540d; */","title":"\u5220\u9664\u8868\uff0c\u5224\u65ad\u3001\u5982\u679c\u5b58\u5728\u5219\u5220\u9664"},{"location":"MySQL/#02","text":"","title":"02\u8868\u6570\u636e\u7684\u589e\u5220\u6539"},{"location":"MySQL/#_24","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a INSERT INTO \u8868\u540d(\u5217\u540d1,\u5217\u540d2,...) VALUES (\u503c1,\u503c2,...); */","title":"\u7ed9\u6307\u5b9a\u5217\u6dfb\u52a0\u6570\u636e"},{"location":"MySQL/#_25","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a INSERT INTO \u8868\u540d VALUES (\u503c1,\u503c2,\u503c3,...); */","title":"\u7ed9\u5168\u90e8\u5217\u6dfb\u52a0\u6570\u636e"},{"location":"MySQL/#_26","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a INSERT INTO \u8868\u540d VALUES (\u503c1,\u503c2,\u503c3,...),(\u503c1,\u503c2,\u503c3,...),(\u503c1,\u503c2,\u503c3,...); */","title":"\u6279\u91cf\u6dfb\u52a0\u6240\u6709\u5217\u6570\u636e"},{"location":"MySQL/#_27","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a UPDATE \u8868\u540d SET \u5217\u540d1 = \u503c1,\u5217\u540d2 = \u503c2,... [where \u6761\u4ef6]; */","title":"\u4fee\u6539\u8868\u6570\u636e"},{"location":"MySQL/#_28","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a DELETE FROM \u8868\u540d [WHERE \u6761\u4ef6]; */","title":"\u5220\u9664\u8868\u6570\u636e"},{"location":"MySQL/#03","text":"","title":"03\u8868\u6570\u636e\u7684\u67e5\u8be2"},{"location":"MySQL/#_29","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT * FROM \u8868\u540d; */","title":"\u67e5\u8be2\u5168\u90e8\u6570\u636e"},{"location":"MySQL/#_30","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d1,\u5217\u540d2,... FROM \u8868\u540d; */","title":"\u67e5\u8be2\u6307\u5b9a\u5217"},{"location":"MySQL/#_31","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT DISTINCT \u5217\u540d1,\u5217\u540d2,... FROM \u8868\u540d; */","title":"\u53bb\u9664\u91cd\u590d\u67e5\u8be2"},{"location":"MySQL/#_32","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d1 \u8fd0\u7b97\u7b26(+ - * /) \u5217\u540d2 FROM \u8868\u540d; \u5982\u679c\u67d0\u4e00\u5217\u4e3anull\uff0c\u53ef\u4ee5\u8fdb\u884c\u66ff\u6362 ifnull(\u8868\u8fbe\u5f0f1,\u8868\u8fbe\u5f0f2) \u8868\u8fbe\u5f0f1\uff1a\u60f3\u66ff\u6362\u7684\u5217 \u8868\u8fbe\u5f0f2\uff1a\u60f3\u66ff\u6362\u7684\u503c */ example -- \u67e5\u8be2\u5546\u54c1\u540d\u79f0\u548c\u5e93\u5b58\uff0c\u5e93\u5b58\u6570\u91cf\u5728\u539f\u6709\u57fa\u7840\u4e0a\u52a010 SELECT NAME,stock+10 FROM product; -- \u67e5\u8be2\u5546\u54c1\u540d\u79f0\u548c\u5e93\u5b58\uff0c\u5e93\u5b58\u6570\u91cf\u5728\u539f\u6709\u57fa\u7840\u4e0a\u52a010\u3002\u8fdb\u884cnull\u503c\u5224\u65ad SELECT NAME,IFNULL(stock,0)+10 FROM product;","title":"\u8ba1\u7b97\u5217\u7684\u503c"},{"location":"MySQL/#_33","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d1,\u5217\u540d2,... AS \u522b\u540d FROM \u8868\u540d; */ as\u53ef\u4ee5\u7701\u7565","title":"\u8d77\u522b\u540d"},{"location":"MySQL/#_34","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d\u5217\u8868 FROM \u8868\u540d WHERE \u6761\u4ef6; */ example -- \u67e5\u8be2\u5e93\u5b58\u5927\u4e8e20\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE stock > 20; -- \u67e5\u8be2\u54c1\u724c\u4e3a\u534e\u4e3a\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE brand='\u534e\u4e3a'; -- \u67e5\u8be2\u91d1\u989d\u57284000 ~ 6000\u4e4b\u95f4\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE price >= 4000 AND price <= 6000; SELECT * FROM product WHERE price BETWEEN 4000 AND 6000; -- \u67e5\u8be2\u5e93\u5b58\u4e3a14\u300130\u300123\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE stock=14 OR stock=30 OR stock=23; SELECT * FROM product WHERE stock IN(14,30,23); -- \u67e5\u8be2\u5e93\u5b58\u4e3anull\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE stock IS NULL; -- \u67e5\u8be2\u5e93\u5b58\u4e0d\u4e3anull\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE stock IS NOT NULL; -- \u67e5\u8be2\u540d\u79f0\u4ee5\u5c0f\u7c73\u4e3a\u5f00\u5934\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE NAME LIKE '\u5c0f\u7c73%'; -- \u67e5\u8be2\u540d\u79f0\u7b2c\u4e8c\u4e2a\u5b57\u662f\u4e3a\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE NAME LIKE '_\u4e3a%'; -- \u67e5\u8be2\u540d\u79f0\u4e3a\u56db\u4e2a\u5b57\u7b26\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE NAME LIKE '____'; -- \u67e5\u8be2\u540d\u79f0\u4e2d\u5305\u542b\u7535\u8111\u7684\u5546\u54c1\u4fe1\u606f SELECT * FROM product WHERE NAME LIKE '%\u7535\u8111%';","title":"\u6761\u4ef6\u67e5\u8be2"},{"location":"MySQL/#_35","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u51fd\u6570\u540d(\u5217\u540d) FROM \u8868\u540d [WHERE \u6761\u4ef6]; */ example -- \u8ba1\u7b97product\u8868\u4e2d\u603b\u8bb0\u5f55\u6761\u6570 SELECT COUNT(*) FROM product; -- \u83b7\u53d6\u6700\u9ad8\u4ef7\u683c SELECT MAX(price) FROM product; -- \u83b7\u53d6\u6700\u4f4e\u5e93\u5b58 SELECT MIN(stock) FROM product; -- \u83b7\u53d6\u603b\u5e93\u5b58\u6570\u91cf SELECT SUM(stock) FROM product; -- \u83b7\u53d6\u54c1\u724c\u4e3a\u82f9\u679c\u7684\u603b\u5e93\u5b58\u6570\u91cf SELECT SUM(stock) FROM product WHERE brand='\u82f9\u679c'; -- \u83b7\u53d6\u54c1\u724c\u4e3a\u5c0f\u7c73\u7684\u5e73\u5747\u5546\u54c1\u4ef7\u683c SELECT AVG(price) FROM product WHERE brand='\u5c0f\u7c73';","title":"\u805a\u5408\u51fd\u6570"},{"location":"MySQL/#_36","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d [WHERE \u6761\u4ef6] ORDER BY \u5217\u540d1 \u6392\u5e8f\u65b9\u5f0f1,\u5217\u540d2 \u6392\u5e8f\u65b9\u5f0f2; */ example -- \u6309\u7167\u5e93\u5b58\u5347\u5e8f\u6392\u5e8f SELECT * FROM product ORDER BY stock ASC; -- \u67e5\u8be2\u540d\u79f0\u4e2d\u5305\u542b\u624b\u673a\u7684\u5546\u54c1\u4fe1\u606f\u3002\u6309\u7167\u91d1\u989d\u964d\u5e8f\u6392\u5e8f SELECT * FROM product WHERE NAME LIKE '%\u624b\u673a%' ORDER BY price DESC; -- \u6309\u7167\u91d1\u989d\u5347\u5e8f\u6392\u5e8f\uff0c\u5982\u679c\u91d1\u989d\u76f8\u540c\uff0c\u6309\u7167\u5e93\u5b58\u964d\u5e8f\u6392\u5217 SELECT * FROM product ORDER BY price ASC,stock DESC;","title":"\u6392\u5e8f\u67e5\u8be2"},{"location":"MySQL/#_37","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d [WHERE \u6761\u4ef6] GROUP BY \u5206\u7ec4\u5217\u540d [HAVING \u5206\u7ec4\u540e\u6761\u4ef6\u8fc7\u6ee4] [ORDER BY \u6392\u5e8f\u5217\u540d \u6392\u5e8f\u65b9\u5f0f]; */","title":"\u5206\u7ec4\u67e5\u8be2"},{"location":"MySQL/#_38","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d [WHERE \u6761\u4ef6] [GROUP BY \u5206\u7ec4\u5217\u540d] [HAVING \u5206\u7ec4\u540e\u6761\u4ef6\u8fc7\u6ee4] [ORDER BY \u6392\u5e8f\u5217\u540d \u6392\u5e8f\u65b9\u5f0f] LIMIT \u5f53\u524d\u9875\u6570,\u6bcf\u9875\u663e\u793a\u7684\u6761\u6570; LIMIT \u5f53\u524d\u9875\u6570,\u6bcf\u9875\u663e\u793a\u7684\u6761\u6570; \u516c\u5f0f\uff1a\u5f53\u524d\u9875\u6570 = (\u5f53\u524d\u9875\u6570-1) * \u6bcf\u9875\u663e\u793a\u7684\u6761\u6570 */ example -- \u6bcf\u9875\u663e\u793a3\u6761\u6570\u636e -- \u7b2c1\u9875 \u5f53\u524d\u9875\u6570=(1-1) * 3 SELECT * FROM product LIMIT 0,3; -- \u7b2c2\u9875 \u5f53\u524d\u9875\u6570=(2-1) * 3 SELECT * FROM product LIMIT 3,3; -- \u7b2c3\u9875 \u5f53\u524d\u9875\u6570=(3-1) * 3 SELECT * FROM product LIMIT 6,3;","title":"\u5206\u9875\u67e5\u8be2"},{"location":"MySQL/#04","text":"","title":"04\u7ea6\u675f"},{"location":"MySQL/#_39","text":"-- \u521b\u5efa\u5b66\u751f\u8868(\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84) \u7f16\u53f7\u8bbe\u4e3a\u4e3b\u952e CREATE TABLE student( id INT PRIMARY KEY, NAME VARCHAR(30), age INT ); -- \u67e5\u8be2\u5b66\u751f\u8868\u7684\u8be6\u7ec6\u4fe1\u606f DESC student; -- \u6dfb\u52a0\u6570\u636e INSERT INTO student VALUES (1,'\u5f20\u4e09',23); INSERT INTO student VALUES (2,'\u674e\u56db',24); -- \u5220\u9664\u4e3b\u952e ALTER TABLE student DROP PRIMARY KEY; -- \u5efa\u8868\u540e\u5355\u72ec\u6dfb\u52a0\u4e3b\u952e\u7ea6\u675f ALTER TABLE student MODIFY id INT PRIMARY KEY;","title":"\u4e3b\u952e\u7ea6\u675f"},{"location":"MySQL/#_40","text":"-- \u521b\u5efa\u5b66\u751f\u8868(\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84) \u7f16\u53f7\u8bbe\u4e3a\u4e3b\u952e\u81ea\u589e CREATE TABLE student( id INT PRIMARY KEY AUTO_INCREMENT, NAME VARCHAR(30), age INT ); -- \u67e5\u8be2\u5b66\u751f\u8868\u7684\u8be6\u7ec6\u4fe1\u606f DESC student; -- \u6dfb\u52a0\u6570\u636e INSERT INTO student VALUES (NULL,'\u5f20\u4e09',23),(NULL,'\u674e\u56db',24); -- \u5220\u9664\u81ea\u589e\u7ea6\u675f ALTER TABLE student MODIFY id INT; INSERT INTO student VALUES (NULL,'\u5f20\u4e09',23); -- \u5efa\u8868\u540e\u5355\u72ec\u6dfb\u52a0\u81ea\u589e\u7ea6\u675f ALTER TABLE student MODIFY id INT AUTO_INCREMENT;","title":"\u4e3b\u952e\u81ea\u589e\u7ea6\u675f"},{"location":"MySQL/#_41","text":"-- \u521b\u5efa\u5b66\u751f\u8868(\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84) \u7f16\u53f7\u8bbe\u4e3a\u4e3b\u952e\u81ea\u589e\uff0c\u5e74\u9f84\u8bbe\u4e3a\u552f\u4e00 CREATE TABLE student( id INT PRIMARY KEY AUTO_INCREMENT, NAME VARCHAR(30), age INT UNIQUE ); -- \u67e5\u8be2\u5b66\u751f\u8868\u7684\u8be6\u7ec6\u4fe1\u606f DESC student; -- \u6dfb\u52a0\u6570\u636e INSERT INTO student VALUES (NULL,'\u5f20\u4e09',23); INSERT INTO student VALUES (NULL,'\u674e\u56db',23); -- \u5220\u9664\u552f\u4e00\u7ea6\u675f ALTER TABLE student DROP INDEX age; -- \u5efa\u8868\u540e\u5355\u72ec\u6dfb\u52a0\u552f\u4e00\u7ea6\u675f ALTER TABLE student MODIFY age INT UNIQUE;","title":"\u552f\u4e00\u7ea6\u675f"},{"location":"MySQL/#_42","text":"-- \u521b\u5efa\u5b66\u751f\u8868(\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84) \u7f16\u53f7\u8bbe\u4e3a\u4e3b\u952e\u81ea\u589e\uff0c\u59d3\u540d\u8bbe\u4e3a\u975e\u7a7a\uff0c\u5e74\u9f84\u8bbe\u4e3a\u552f\u4e00 CREATE TABLE student( id INT PRIMARY KEY AUTO_INCREMENT, NAME VARCHAR(30) NOT NULL, age INT UNIQUE ); -- \u67e5\u8be2\u5b66\u751f\u8868\u7684\u8be6\u7ec6\u4fe1\u606f DESC student; -- \u6dfb\u52a0\u6570\u636e INSERT INTO student VALUES (NULL,'\u5f20\u4e09',23); -- \u5220\u9664\u975e\u7a7a\u7ea6\u675f ALTER TABLE student MODIFY NAME VARCHAR(30); INSERT INTO student VALUES (NULL,NULL,25); -- \u5efa\u8868\u540e\u5355\u72ec\u6dfb\u52a0\u975e\u7a7a\u7ea6\u675f ALTER TABLE student MODIFY NAME VARCHAR(30) NOT NULL;","title":"\u975e\u7a7a\u7ea6\u675f"},{"location":"MySQL/#day02","text":"","title":"day02"},{"location":"MySQL/#01_1","text":"","title":"01\u7ea6\u675f"},{"location":"MySQL/#_43","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a CONSTRAINT \u5916\u952e\u540d FOREIGN KEY (\u672c\u8868\u5916\u952e\u5217\u540d) REFERENCES \u4e3b\u8868\u540d(\u4e3b\u8868\u4e3b\u952e\u5217\u540d) */","title":"\u5916\u952e\u7ea6\u675f"},{"location":"MySQL/#_44","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d DROP FOREIGN KEY \u5916\u952e\u540d; */","title":"\u5220\u9664\u5916\u952e\u7ea6\u675f"},{"location":"MySQL/#_45","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d ADD CONSTRAINT \u5916\u952e\u540d FOREIGN KEY (\u672c\u8868\u5916\u952e\u5217\u540d) REFERENCES \u4e3b\u8868\u540d(\u4e3b\u952e\u5217\u540d); */ \u5916\u952e\u7ea6\u675fexample -- \u521b\u5efadb2\u6570\u636e\u5e93 CREATE DATABASE db2; -- \u4f7f\u7528db2\u6570\u636e\u5e93 USE db2; /* \u5916\u952e\u7ea6\u675f \u6807\u51c6\u8bed\u6cd5\uff1a CONSTRAINT \u5916\u952e\u540d FOREIGN KEY (\u672c\u8868\u5916\u952e\u5217\u540d) REFERENCES \u4e3b\u8868\u540d(\u4e3b\u8868\u4e3b\u952e\u5217\u540d) */ -- \u5efa\u8868\u65f6\u6dfb\u52a0\u5916\u952e\u7ea6\u675f -- \u521b\u5efauser\u7528\u6237\u8868 CREATE TABLE USER( id INT PRIMARY KEY AUTO_INCREMENT, -- id NAME VARCHAR(20) NOT NULL -- \u59d3\u540d ); -- \u6dfb\u52a0\u7528\u6237\u6570\u636e INSERT INTO USER VALUES (NULL,'\u5f20\u4e09'),(NULL,'\u674e\u56db'); -- \u521b\u5efaorderlist\u8ba2\u5355\u8868 CREATE TABLE orderlist( id INT PRIMARY KEY AUTO_INCREMENT, -- id number VARCHAR(20) NOT NULL, -- \u8ba2\u5355\u7f16\u53f7 uid INT, -- \u5916\u952e\u5217 CONSTRAINT ou_fk1 FOREIGN KEY (uid) REFERENCES USER(id) ); -- \u6dfb\u52a0\u8ba2\u5355\u6570\u636e INSERT INTO orderlist VALUES (NULL,'hm001',1),(NULL,'hm002',1), (NULL,'hm003',2),(NULL,'hm004',2); -- \u6dfb\u52a0\u4e00\u4e2a\u8ba2\u5355\uff0c\u4f46\u662f\u6ca1\u6709\u771f\u5b9e\u7528\u6237\u3002\u6dfb\u52a0\u5931\u8d25 INSERT INTO orderlist VALUES (NULL,'hm005',3); -- \u5220\u9664\u674e\u56db\u7528\u6237\u3002\u5220\u9664\u5931\u8d25 DELETE FROM USER WHERE NAME='\u674e\u56db'; /* \u5220\u9664\u5916\u952e\u7ea6\u675f \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d DROP FOREIGN KEY \u5916\u952e\u540d; */ -- \u5220\u9664\u5916\u952e\u7ea6\u675f ALTER TABLE orderlist DROP FOREIGN KEY ou_fk1; /* \u5efa\u8868\u540e\u5355\u72ec\u6dfb\u52a0\u5916\u952e\u7ea6\u675f \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d ADD CONSTRAINT \u5916\u952e\u540d FOREIGN KEY (\u672c\u8868\u5916\u952e\u5217\u540d) REFERENCES \u4e3b\u8868\u540d(\u4e3b\u952e\u5217\u540d); */ -- \u6dfb\u52a0\u5916\u952e\u7ea6\u675f ALTER TABLE orderlist ADD CONSTRAINT ou_fk1 FOREIGN KEY (uid) REFERENCES USER(id);","title":"\u5efa\u8868\u540e\u5355\u72ec\u6dfb\u52a0\u5916\u952e\u7ea6\u675f"},{"location":"MySQL/#_46","text":"/* \u6dfb\u52a0\u5916\u952e\u7ea6\u675f\uff0c\u540c\u65f6\u6dfb\u52a0\u7ea7\u8054\u66f4\u65b0 \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d ADD CONSTRAINT \u5916\u952e\u540d FOREIGN KEY (\u672c\u8868\u5916\u952e\u5217\u540d) REFERENCES \u4e3b\u8868\u540d(\u4e3b\u952e\u5217\u540d) ON UPDATE CASCADE; \u6dfb\u52a0\u5916\u952e\u7ea6\u675f\uff0c\u540c\u65f6\u6dfb\u52a0\u7ea7\u8054\u5220\u9664 \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d ADD CONSTRAINT \u5916\u952e\u540d FOREIGN KEY (\u672c\u8868\u5916\u952e\u5217\u540d) REFERENCES \u4e3b\u8868\u540d(\u4e3b\u952e\u5217\u540d) ON DELETE CASCADE; \u6dfb\u52a0\u5916\u952e\u7ea6\u675f\uff0c\u540c\u65f6\u6dfb\u52a0\u7ea7\u8054\u66f4\u65b0\u548c\u7ea7\u8054\u5220\u9664 \u6807\u51c6\u8bed\u6cd5\uff1a ALTER TABLE \u8868\u540d ADD CONSTRAINT \u5916\u952e\u540d FOREIGN KEY (\u672c\u8868\u5916\u952e\u5217\u540d) REFERENCES \u4e3b\u8868\u540d(\u4e3b\u952e\u5217\u540d) ON UPDATE CASCADE ON DELETE CASCADE; */ \u5916\u952e\u7ea7\u8054\u64cd\u4f5cexample -- \u5220\u9664\u5916\u952e\u7ea6\u675f ALTER TABLE orderlist DROP FOREIGN KEY ou_fk1; -- \u6dfb\u52a0\u5916\u952e\u7ea6\u675f\uff0c\u540c\u65f6\u6dfb\u52a0\u7ea7\u8054\u66f4\u65b0\u548c\u7ea7\u8054\u5220\u9664 ALTER TABLE orderlist ADD CONSTRAINT ou_fk1 FOREIGN KEY (uid) REFERENCES USER(id) ON UPDATE CASCADE ON DELETE CASCADE; -- \u5c06\u674e\u56db\u8fd9\u4e2a\u7528\u6237\u7684id\u4fee\u6539\u4e3a3,\u8ba2\u5355\u8868\u4e2d\u7684uid\u4e5f\u81ea\u52a8\u4fee\u6539 UPDATE USER SET id=3 WHERE id=2; -- \u5c06\u674e\u56db\u8fd9\u4e2a\u7528\u6237\u5220\u9664,\u8ba2\u5355\u8868\u4e2d\u7684\u8be5\u7528\u6237\u6240\u5c5e\u7684\u8ba2\u5355\u4e5f\u81ea\u52a8\u5220\u9664 DELETE FROM USER WHERE id=3;","title":"\u5916\u952e\u7ea7\u8054\u64cd\u4f5c"},{"location":"MySQL/#02_1","text":"","title":"02\u591a\u8868\u64cd\u4f5c"},{"location":"MySQL/#_47","text":"-- \u521b\u5efadb3\u6570\u636e\u5e93 CREATE DATABASE db3; -- \u4f7f\u7528db3\u6570\u636e\u5e93 USE db3; -- \u521b\u5efaperson\u8868 CREATE TABLE person( id INT PRIMARY KEY AUTO_INCREMENT, -- \u4e3b\u952eid NAME VARCHAR(20) -- \u59d3\u540d ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO person VALUES (NULL,'\u5f20\u4e09'),(NULL,'\u674e\u56db'); -- \u521b\u5efacard\u8868 CREATE TABLE card( id INT PRIMARY KEY AUTO_INCREMENT, -- \u4e3b\u952eid number VARCHAR(20) UNIQUE NOT NULL, -- \u8eab\u4efd\u8bc1\u53f7 pid INT UNIQUE, -- \u5916\u952e\u5217 CONSTRAINT cp_fk1 FOREIGN KEY (pid) REFERENCES person(id) ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO card VALUES (NULL,'12345',1),(NULL,'56789',2);","title":"\u8868\u5173\u7cfb\u4e00\u5bf9\u4e00"},{"location":"MySQL/#_48","text":"-- \u521b\u5efauser\u8868 CREATE TABLE USER( id INT PRIMARY KEY AUTO_INCREMENT, -- \u4e3b\u952eid NAME VARCHAR(20) -- \u59d3\u540d ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO USER VALUES (NULL,'\u5f20\u4e09'),(NULL,'\u674e\u56db'); -- \u521b\u5efaorderlist\u8868 CREATE TABLE orderlist( id INT PRIMARY KEY AUTO_INCREMENT, -- \u4e3b\u952eid number VARCHAR(20), -- \u8ba2\u5355\u7f16\u53f7 uid INT, -- \u5916\u952e\u5217 CONSTRAINT ou_fk1 FOREIGN KEY (uid) REFERENCES USER(id) ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO orderlist VALUES (NULL,'hm001',1),(NULL,'hm002',1),(NULL,'hm003',2),(NULL,'hm004',2); /* \u5546\u54c1\u5206\u7c7b\u548c\u5546\u54c1 */ -- \u521b\u5efacategory\u8868 CREATE TABLE category( id INT PRIMARY KEY AUTO_INCREMENT, -- \u4e3b\u952eid NAME VARCHAR(10) -- \u5206\u7c7b\u540d\u79f0 ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO category VALUES (NULL,'\u624b\u673a\u6570\u7801'),(NULL,'\u7535\u8111\u529e\u516c'); -- \u521b\u5efaproduct\u8868 CREATE TABLE product( id INT PRIMARY KEY AUTO_INCREMENT, -- \u4e3b\u952eid NAME VARCHAR(30), -- \u5546\u54c1\u540d\u79f0 cid INT, -- \u5916\u952e\u5217 CONSTRAINT pc_fk1 FOREIGN KEY (cid) REFERENCES category(id) ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO product VALUES (NULL,'\u534e\u4e3aP30',1),(NULL,'\u5c0f\u7c73note3',1), (NULL,'\u8054\u60f3\u7535\u8111',2),(NULL,'\u82f9\u679c\u7535\u8111',2);","title":"\u8868\u5173\u7cfb\u4e00\u5bf9\u591a"},{"location":"MySQL/#_49","text":"-- \u521b\u5efastudent\u8868 CREATE TABLE student( id INT PRIMARY KEY AUTO_INCREMENT, -- \u4e3b\u952eid NAME VARCHAR(20) -- \u5b66\u751f\u59d3\u540d ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO student VALUES (NULL,'\u5f20\u4e09'),(NULL,'\u674e\u56db'); -- \u521b\u5efacourse\u8868 CREATE TABLE course( id INT PRIMARY KEY AUTO_INCREMENT, -- \u4e3b\u952eid NAME VARCHAR(10) -- \u8bfe\u7a0b\u540d\u79f0 ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO course VALUES (NULL,'\u8bed\u6587'),(NULL,'\u6570\u5b66'); -- \u521b\u5efa\u4e2d\u95f4\u8868 CREATE TABLE stu_course( id INT PRIMARY KEY AUTO_INCREMENT, -- \u4e3b\u952eid sid INT, -- \u7528\u4e8e\u548cstudent\u8868\u4e2d\u7684id\u8fdb\u884c\u5916\u952e\u5173\u8054 cid INT, -- \u7528\u4e8e\u548ccourse\u8868\u4e2d\u7684id\u8fdb\u884c\u5916\u952e\u5173\u8054 CONSTRAINT sc_fk1 FOREIGN KEY (sid) REFERENCES student(id), -- \u6dfb\u52a0\u5916\u952e\u7ea6\u675f CONSTRAINT sc_fk2 FOREIGN KEY (cid) REFERENCES course(id) -- \u6dfb\u52a0\u5916\u952e\u7ea6\u675f ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO stu_course VALUES (NULL,1,1),(NULL,1,2),(NULL,2,1),(NULL,2,2);","title":"\u8868\u5173\u7cfb\u591a\u5bf9\u591a"},{"location":"MySQL/#_50","text":"-- \u521b\u5efadb4\u6570\u636e\u5e93 CREATE DATABASE db4; -- \u4f7f\u7528db4\u6570\u636e\u5e93 USE db4; -- \u521b\u5efauser\u8868 CREATE TABLE USER( id INT PRIMARY KEY AUTO_INCREMENT, -- \u7528\u6237id NAME VARCHAR(20), -- \u7528\u6237\u59d3\u540d age INT -- \u7528\u6237\u5e74\u9f84 ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO USER VALUES (1,'\u5f20\u4e09',23); INSERT INTO USER VALUES (2,'\u674e\u56db',24); INSERT INTO USER VALUES (3,'\u738b\u4e94',25); INSERT INTO USER VALUES (4,'\u8d75\u516d',26); -- \u8ba2\u5355\u8868 CREATE TABLE orderlist( id INT PRIMARY KEY AUTO_INCREMENT, -- \u8ba2\u5355id number VARCHAR(30), -- \u8ba2\u5355\u7f16\u53f7 uid INT, -- \u5916\u952e\u5b57\u6bb5 CONSTRAINT ou_fk1 FOREIGN KEY (uid) REFERENCES USER(id) ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO orderlist VALUES (1,'hm001',1); INSERT INTO orderlist VALUES (2,'hm002',1); INSERT INTO orderlist VALUES (3,'hm003',2); INSERT INTO orderlist VALUES (4,'hm004',2); INSERT INTO orderlist VALUES (5,'hm005',3); INSERT INTO orderlist VALUES (6,'hm006',3); INSERT INTO orderlist VALUES (7,'hm007',NULL); -- \u5546\u54c1\u5206\u7c7b\u8868 CREATE TABLE category( id INT PRIMARY KEY AUTO_INCREMENT, -- \u5546\u54c1\u5206\u7c7bid NAME VARCHAR(10) -- \u5546\u54c1\u5206\u7c7b\u540d\u79f0 ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO category VALUES (1,'\u624b\u673a\u6570\u7801'); INSERT INTO category VALUES (2,'\u7535\u8111\u529e\u516c'); INSERT INTO category VALUES (3,'\u70df\u9152\u8336\u7cd6'); INSERT INTO category VALUES (4,'\u978b\u9774\u7bb1\u5305'); -- \u5546\u54c1\u8868 CREATE TABLE product( id INT PRIMARY KEY AUTO_INCREMENT, -- \u5546\u54c1id NAME VARCHAR(30), -- \u5546\u54c1\u540d\u79f0 cid INT, -- \u5916\u952e\u5b57\u6bb5 CONSTRAINT cp_fk1 FOREIGN KEY (cid) REFERENCES category(id) ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO product VALUES (1,'\u534e\u4e3a\u624b\u673a',1); INSERT INTO product VALUES (2,'\u5c0f\u7c73\u624b\u673a',1); INSERT INTO product VALUES (3,'\u8054\u60f3\u7535\u8111',2); INSERT INTO product VALUES (4,'\u82f9\u679c\u7535\u8111',2); INSERT INTO product VALUES (5,'\u4e2d\u534e\u9999\u70df',3); INSERT INTO product VALUES (6,'\u7389\u6eaa\u9999\u70df',3); INSERT INTO product VALUES (7,'\u8ba1\u751f\u7528\u54c1',NULL); -- \u4e2d\u95f4\u8868 CREATE TABLE us_pro( upid INT PRIMARY KEY AUTO_INCREMENT, -- \u4e2d\u95f4\u8868id uid INT, -- \u5916\u952e\u5b57\u6bb5\u3002\u9700\u8981\u548c\u7528\u6237\u8868\u7684\u4e3b\u952e\u4ea7\u751f\u5173\u8054 pid INT, -- \u5916\u952e\u5b57\u6bb5\u3002\u9700\u8981\u548c\u5546\u54c1\u8868\u7684\u4e3b\u952e\u4ea7\u751f\u5173\u8054 CONSTRAINT up_fk1 FOREIGN KEY (uid) REFERENCES USER(id), CONSTRAINT up_fk2 FOREIGN KEY (pid) REFERENCES product(id) ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO us_pro VALUES (NULL,1,1); INSERT INTO us_pro VALUES (NULL,1,2); INSERT INTO us_pro VALUES (NULL,1,3); INSERT INTO us_pro VALUES (NULL,1,4); INSERT INTO us_pro VALUES (NULL,1,5); INSERT INTO us_pro VALUES (NULL,1,6); INSERT INTO us_pro VALUES (NULL,1,7); INSERT INTO us_pro VALUES (NULL,2,1); INSERT INTO us_pro VALUES (NULL,2,2); INSERT INTO us_pro VALUES (NULL,2,3); INSERT INTO us_pro VALUES (NULL,2,4); INSERT INTO us_pro VALUES (NULL,2,5); INSERT INTO us_pro VALUES (NULL,2,6); INSERT INTO us_pro VALUES (NULL,2,7); INSERT INTO us_pro VALUES (NULL,3,1); INSERT INTO us_pro VALUES (NULL,3,2); INSERT INTO us_pro VALUES (NULL,3,3); INSERT INTO us_pro VALUES (NULL,3,4); INSERT INTO us_pro VALUES (NULL,3,5); INSERT INTO us_pro VALUES (NULL,3,6); INSERT INTO us_pro VALUES (NULL,3,7); INSERT INTO us_pro VALUES (NULL,4,1); INSERT INTO us_pro VALUES (NULL,4,2); INSERT INTO us_pro VALUES (NULL,4,3); INSERT INTO us_pro VALUES (NULL,4,4); INSERT INTO us_pro VALUES (NULL,4,5); INSERT INTO us_pro VALUES (NULL,4,6); INSERT INTO us_pro VALUES (NULL,4,7);","title":"\u591a\u8868\u67e5\u8be2\u6570\u636e\u51c6\u5907"},{"location":"MySQL/#_51","text":"","title":"\u5185\u8fde\u63a5\u67e5\u8be2"},{"location":"MySQL/#_52","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d1 [INNER] JOIN \u8868\u540d2 ON \u5173\u8054\u6761\u4ef6; */","title":"\u663e\u793a\u5185\u8fde\u63a5"},{"location":"MySQL/#_53","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d1,\u8868\u540d2 WHERE \u5173\u8054\u6761\u4ef6; */","title":"\u9690\u5f0f\u5185\u8fde\u63a5"},{"location":"MySQL/#_54","text":"","title":"\u5916\u8fde\u63a5\u67e5\u8be2"},{"location":"MySQL/#_55","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d1 LEFT [OUTER] JOIN \u8868\u540d2 ON \u6761\u4ef6; */","title":"\u5de6\u5916\u8fde\u63a5"},{"location":"MySQL/#_56","text":"/* \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d1 RIGHT [OUTER] JOIN \u8868\u540d2 ON \u6761\u4ef6; */","title":"\u53f3\u5916\u8fde\u63a5"},{"location":"MySQL/#_57","text":"/* \u7ed3\u679c\u662f\u5355\u884c\u5355\u5217\u7684 \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d WHERE \u5217\u540d=(SELECT \u5217\u540d FROM \u8868\u540d [WHERE \u6761\u4ef6]); */ -- \u67e5\u8be2\u5e74\u9f84\u6700\u9ad8\u7684\u7528\u6237\u59d3\u540d SELECT MAX(age) FROM USER; SELECT NAME,age FROM USER WHERE age=(SELECT MAX(age) FROM USER); /* \u7ed3\u679c\u662f\u591a\u884c\u5355\u5217\u7684 \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d WHERE \u5217\u540d [NOT] IN (SELECT \u5217\u540d FROM \u8868\u540d [WHERE \u6761\u4ef6]); */ -- \u67e5\u8be2\u5f20\u4e09\u548c\u674e\u56db\u7684\u8ba2\u5355\u4fe1\u606f SELECT * FROM orderlist WHERE uid IN (1,2); SELECT id FROM USER WHERE NAME IN ('\u5f20\u4e09','\u674e\u56db'); SELECT * FROM orderlist WHERE uid IN (SELECT id FROM USER WHERE NAME IN ('\u5f20\u4e09','\u674e\u56db')); /* \u7ed3\u679c\u662f\u591a\u884c\u591a\u5217\u7684 \u6807\u51c6\u8bed\u6cd5\uff1a SELECT \u5217\u540d FROM \u8868\u540d [\u522b\u540d],(SELECT \u5217\u540d FROM \u8868\u540d [WHERE \u6761\u4ef6]) [\u522b\u540d] [WHERE \u6761\u4ef6]; */ -- \u67e5\u8be2\u8ba2\u5355\u8868\u4e2did\u5927\u4e8e4\u7684\u8ba2\u5355\u4fe1\u606f\u548c\u6240\u5c5e\u7528\u6237\u4fe1\u606f SELECT * FROM orderlist WHERE id > 4; SELECT u.name, o.number FROM USER u, (SELECT * FROM orderlist WHERE id > 4) o WHERE o.uid=u.id;","title":"\u5b50\u67e5\u8be2"},{"location":"MySQL/#_58","text":"-- \u521b\u5efa\u5458\u5de5\u8868 CREATE TABLE employee( id INT PRIMARY KEY AUTO_INCREMENT, -- \u5458\u5de5\u7f16\u53f7 NAME VARCHAR(20), -- \u5458\u5de5\u59d3\u540d mgr INT, -- \u4e0a\u7ea7\u7f16\u53f7 salary DOUBLE -- \u5458\u5de5\u5de5\u8d44 ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO employee VALUES (1001,'\u5b59\u609f\u7a7a',1005,9000.00), (1002,'\u732a\u516b\u6212',1005,8000.00), (1003,'\u6c99\u548c\u5c1a',1005,8500.00), (1004,'\u5c0f\u767d\u9f99',1005,7900.00), (1005,'\u5510\u50e7',NULL,15000.00), (1006,'\u6b66\u677e',1009,7600.00), (1007,'\u674e\u9035',1009,7400.00), (1008,'\u6797\u51b2',1009,8100.00), (1009,'\u5b8b\u6c5f',NULL,16000.00); -- \u67e5\u8be2\u6240\u6709\u5458\u5de5\u7684\u59d3\u540d\u53ca\u5176\u76f4\u63a5\u4e0a\u7ea7\u7684\u59d3\u540d\uff0c\u6ca1\u6709\u4e0a\u7ea7\u7684\u5458\u5de5\u4e5f\u9700\u8981\u67e5\u8be2 /* \u5206\u6790 \u5458\u5de5\u4fe1\u606f employee\u8868 \u6761\u4ef6\uff1aemployee.mgr = employee.id \u67e5\u8be2\u5de6\u8868\u7684\u5168\u90e8\u6570\u636e\uff0c\u548c\u5de6\u53f3\u4e24\u5f20\u8868\u6709\u4ea4\u96c6\u90e8\u5206\u6570\u636e\uff0c\u5de6\u5916\u8fde\u63a5 */ SELECT e1.id, e1.name, e1.mgr, e2.id, e2.name FROM employee e1 LEFT OUTER JOIN employee e2 ON e1.mgr = e2.id;","title":"\u81ea\u5173\u8054\u67e5\u8be2"},{"location":"MySQL/#_59","text":"-- 1.\u67e5\u8be2\u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84\u3002\u8ba2\u5355\u7f16\u53f7 /* \u5206\u6790 \u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84 user\u8868 \u8ba2\u5355\u7f16\u53f7 orderlist\u8868 \u6761\u4ef6\uff1auser.id=orderlist.uid */ SELECT u.id, u.name, u.age, o.number FROM USER u, orderlist o WHERE u.id=o.uid; -- 2.\u67e5\u8be2\u6240\u6709\u7684\u7528\u6237\u3002\u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84\u3002\u8ba2\u5355\u7f16\u53f7 /* \u5206\u6790 \u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84 user\u8868 \u8ba2\u5355\u7f16\u53f7 orderlist\u8868 \u6761\u4ef6\uff1auser.id=orderlist.uid \u67e5\u8be2\u6240\u6709\u7684\u7528\u6237\uff0c\u5de6\u5916\u8fde\u63a5 */ SELECT u.id, u.name, u.age, o.number FROM USER u LEFT OUTER JOIN orderlist o ON u.id=o.uid; -- 3.\u67e5\u8be2\u6240\u6709\u7684\u8ba2\u5355\u3002\u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84\u3002\u8ba2\u5355\u7f16\u53f7 /* \u5206\u6790 \u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84 user\u8868 \u8ba2\u5355\u7f16\u53f7 orderlist\u8868 \u6761\u4ef6\uff1auser.id=orderlist.uid \u67e5\u8be2\u6240\u6709\u7684\u8ba2\u5355\uff0c\u53f3\u5916\u8fde\u63a5 */ SELECT u.id, u.name, u.age, o.number FROM USER u RIGHT OUTER JOIN orderlist o ON u.id=o.uid; -- 4.\u67e5\u8be2\u7528\u6237\u5e74\u9f84\u5927\u4e8e23\u5c81\u7684\u4fe1\u606f\u3002\u663e\u793a\u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84\u3002\u8ba2\u5355\u7f16\u53f7 /* \u5206\u6790 \u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84 user\u8868 \u8ba2\u5355\u7f16\u53f7 orderlist\u8868 \u6761\u4ef6\uff1auser.id=orderlist.uid AND user.age > 23 */ SELECT u.id, u.name, u.age, o.number FROM USER u, orderlist o WHERE u.id=o.uid AND u.age > 23; -- 5.\u67e5\u8be2\u5f20\u4e09\u548c\u674e\u56db\u7528\u6237\u7684\u4fe1\u606f\u3002\u663e\u793a\u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84\u3002\u8ba2\u5355\u7f16\u53f7 /* \u5206\u6790 \u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84 user\u8868 \u8ba2\u5355\u7f16\u53f7 orderlist\u8868 \u6761\u4ef6\uff1auser.id=orderlist.uid AND user.name IN ('\u5f20\u4e09','\u674e\u56db') */ SELECT u.id, u.name, u.age, o.number FROM USER u, orderlist o WHERE u.id=o.uid AND u.name IN ('\u5f20\u4e09','\u674e\u56db'); -- 6.\u67e5\u8be2\u5546\u54c1\u5206\u7c7b\u7684\u7f16\u53f7\u3001\u5206\u7c7b\u540d\u79f0\u3002\u5206\u7c7b\u4e0b\u7684\u5546\u54c1\u540d\u79f0 /* \u5206\u6790 \u5546\u54c1\u5206\u7c7b\u7684\u7f16\u53f7\u3001\u5206\u7c7b\u540d\u79f0 category\u8868 \u5546\u54c1\u540d\u79f0 product\u8868 \u6761\u4ef6\uff1acategory.id=product.cid */ SELECT c.id, c.name, p.name FROM category c, product p WHERE c.id=p.cid; -- 7.\u67e5\u8be2\u6240\u6709\u7684\u5546\u54c1\u5206\u7c7b\u3002\u5546\u54c1\u5206\u7c7b\u7684\u7f16\u53f7\u3001\u5206\u7c7b\u540d\u79f0\u3002\u5206\u7c7b\u4e0b\u7684\u5546\u54c1\u540d\u79f0 /* \u5206\u6790 \u5546\u54c1\u5206\u7c7b\u7684\u7f16\u53f7\u3001\u5206\u7c7b\u540d\u79f0 category\u8868 \u5546\u54c1\u540d\u79f0 product\u8868 \u6761\u4ef6\uff1acategory.id=product.cid \u67e5\u8be2\u6240\u6709\u7684\u5546\u54c1\u5206\u7c7b\uff0c\u5de6\u5916\u8fde\u63a5 */ SELECT c.id, c.name, p.name FROM category c LEFT OUTER JOIN product p ON c.id=p.cid; -- 8.\u67e5\u8be2\u6240\u6709\u7684\u5546\u54c1\u4fe1\u606f\u3002\u5546\u54c1\u5206\u7c7b\u7684\u7f16\u53f7\u3001\u5206\u7c7b\u540d\u79f0\u3002\u5206\u7c7b\u4e0b\u7684\u5546\u54c1\u540d\u79f0 /* \u5206\u6790 \u5546\u54c1\u5206\u7c7b\u7684\u7f16\u53f7\u3001\u5206\u7c7b\u540d\u79f0 category\u8868 \u5546\u54c1\u540d\u79f0 product\u8868 \u6761\u4ef6\uff1acategory.id=product.cid \u67e5\u8be2\u6240\u6709\u7684\u5546\u54c1\u4fe1\u606f\uff0c\u53f3\u5916\u8fde\u63a5 */ SELECT c.id, c.name, p.name FROM category c RIGHT OUTER JOIN product p ON c.id=p.cid; -- 9.\u67e5\u8be2\u6240\u6709\u7684\u7528\u6237\u548c\u8be5\u7528\u6237\u80fd\u67e5\u770b\u7684\u6240\u6709\u7684\u5546\u54c1\u3002\u663e\u793a\u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84\u3002\u5546\u54c1\u540d\u79f0 /* \u5206\u6790 \u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84 user\u8868 \u5546\u54c1\u540d\u79f0 product\u8868 \u4e2d\u95f4\u8868 us_pro \u6761\u4ef6\uff1aus_pro.uid=user.id AND us_pro.pid=product.id */ SELECT u.id, u.name, u.age, p.name FROM USER u, product p, us_pro up WHERE up.uid=u.id AND up.pid=p.id; -- 10.\u67e5\u8be2\u5f20\u4e09\u548c\u674e\u56db\u8fd9\u4e24\u4e2a\u7528\u6237\u53ef\u4ee5\u770b\u5230\u7684\u5546\u54c1\u3002\u663e\u793a\u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84\u3002\u5546\u54c1\u540d\u79f0 /* \u5206\u6790 \u7528\u6237\u7684\u7f16\u53f7\u3001\u59d3\u540d\u3001\u5e74\u9f84 user\u8868 \u5546\u54c1\u540d\u79f0 product\u8868 \u4e2d\u95f4\u8868 us_pro \u6761\u4ef6\uff1aus_pro.uid=user.id AND us_pro.pid=product.id AND user.name IN ('\u5f20\u4e09','\u674e\u56db') */ SELECT u.id, u.name, u.age, p.name FROM USER u, product p, us_pro up WHERE up.uid=u.id AND up.pid=p.id AND u.name IN ('\u5f20\u4e09','\u674e\u56db');","title":"\u591a\u8868\u67e5\u8be2\u7ec3\u4e60"},{"location":"MySQL/#03_1","text":"","title":"03\u89c6\u56fe"},{"location":"MySQL/#_","text":"-- \u521b\u5efadb5\u6570\u636e\u5e93 CREATE DATABASE db5; -- \u4f7f\u7528db5\u6570\u636e\u5e93 USE db5; -- \u521b\u5efacountry\u8868 CREATE TABLE country( id INT PRIMARY KEY AUTO_INCREMENT, -- \u56fd\u5bb6id NAME VARCHAR(30) -- \u56fd\u5bb6\u540d\u79f0 ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO country VALUES (NULL,'\u4e2d\u56fd'),(NULL,'\u7f8e\u56fd'),(NULL,'\u4fc4\u7f57\u65af'); -- \u521b\u5efacity\u8868 CREATE TABLE city( id INT PRIMARY KEY AUTO_INCREMENT, -- \u57ce\u5e02id NAME VARCHAR(30), -- \u57ce\u5e02\u540d\u79f0 cid INT, -- \u5916\u952e\u5217\u3002\u5173\u8054country\u8868\u7684\u4e3b\u952e\u5217id CONSTRAINT cc_fk1 FOREIGN KEY (cid) REFERENCES country(id) -- \u6dfb\u52a0\u5916\u952e\u7ea6\u675f ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO city VALUES (NULL,'\u5317\u4eac',1),(NULL,'\u4e0a\u6d77',1),(NULL,'\u7ebd\u7ea6',2),(NULL,'\u83ab\u65af\u79d1',3);","title":"\u89c6\u56fe_\u6570\u636e\u51c6\u5907"},{"location":"MySQL/#_60","text":"/* \u6807\u51c6\u8bed\u6cd5 CREATE VIEW \u89c6\u56fe\u540d\u79f0 [(\u5217\u540d\u5217\u8868)] AS \u67e5\u8be2\u8bed\u53e5; */ example -- \u521b\u5efacity_country\u89c6\u56fe\uff0c\u4fdd\u5b58\u57ce\u5e02\u548c\u56fd\u5bb6\u7684\u4fe1\u606f(\u4f7f\u7528\u6307\u5b9a\u5217\u540d) CREATE VIEW city_country (city_id,city_name,country_name) AS SELECT c1.id, c1.name, c2.name FROM city c1, country c2 WHERE c1.cid=c2.id;","title":"\u521b\u5efa\u89c6\u56fe"},{"location":"MySQL/#_61","text":"/* \u6807\u51c6\u8bed\u6cd5 SELECT * FROM \u89c6\u56fe\u540d\u79f0; */ example -- \u67e5\u8be2\u89c6\u56fe SELECT * FROM city_country;","title":"\u67e5\u8be2\u89c6\u56fe"},{"location":"MySQL/#day03","text":"","title":"day03"},{"location":"MySQL/#01_2","text":"","title":"01\u89c6\u56fe"},{"location":"MySQL/#_62","text":"-- \u521b\u5efadb7\u6570\u636e\u5e93 CREATE DATABASE db7; -- \u4f7f\u7528db7\u6570\u636e\u5e93 USE db7; -- \u521b\u5efacountry\u8868 CREATE TABLE country( id INT PRIMARY KEY AUTO_INCREMENT, -- \u56fd\u5bb6id country_name VARCHAR(30) -- \u56fd\u5bb6\u540d\u79f0 ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO country VALUES (NULL,'\u4e2d\u56fd'),(NULL,'\u7f8e\u56fd'),(NULL,'\u4fc4\u7f57\u65af'); -- \u521b\u5efacity\u8868 CREATE TABLE city( id INT PRIMARY KEY AUTO_INCREMENT, -- \u57ce\u5e02id city_name VARCHAR(30), -- \u57ce\u5e02\u540d\u79f0 cid INT, -- \u5916\u952e\u5217\u3002\u5173\u8054country\u8868\u7684\u4e3b\u952e\u5217id CONSTRAINT cc_fk1 FOREIGN KEY (cid) REFERENCES country(id) -- \u6dfb\u52a0\u5916\u952e\u7ea6\u675f ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO city VALUES (NULL,'\u5317\u4eac',1),(NULL,'\u4e0a\u6d77',1),(NULL,'\u7ebd\u7ea6',2),(NULL,'\u83ab\u65af\u79d1',3);","title":"\u6570\u636e\u51c6\u5907"},{"location":"MySQL/#_63","text":"/* \u521b\u5efa\u89c6\u56fe \u6807\u51c6\u8bed\u6cd5 CREATE VIEW \u89c6\u56fe\u540d\u79f0 [(\u5217\u540d\u5217\u8868)] AS \u67e5\u8be2\u8bed\u53e5; */","title":"\u521b\u5efa\u89c6\u56fe"},{"location":"MySQL/#_64","text":"","title":"\u67e5\u8be2\u89c6\u56fe"},{"location":"MySQL/#_65","text":"/* \u6807\u51c6\u8bed\u6cd5 SELECT * FROM \u89c6\u56fe\u540d\u79f0; */","title":"\u67e5\u8be2\u89c6\u56fe"},{"location":"MySQL/#_66","text":"/* \u6807\u51c6\u8bed\u6cd5 SHOW CREATE VIEW \u89c6\u56fe\u540d\u79f0; */","title":"\u67e5\u8be2\u521b\u5efa\u89c6\u56fe\u7684\u8bed\u53e5"},{"location":"MySQL/#_67","text":"","title":"\u4fee\u6539\u89c6\u56fe"},{"location":"MySQL/#_68","text":"/* \u6807\u51c6\u8bed\u6cd5 UPDATE \u89c6\u56fe\u540d\u79f0 SET \u5217\u540d=\u503c WHERE \u6761\u4ef6; */","title":"\u4fee\u6539\u89c6\u56fe\u8868\u6570\u636e"},{"location":"MySQL/#_69","text":"/* \u4fee\u6539\u89c6\u56fe\u8868\u7ed3\u6784 \u6807\u51c6\u8bed\u6cd5 ALTER VIEW \u89c6\u56fe\u540d\u79f0 [(\u5217\u540d\u5217\u8868)] AS \u67e5\u8be2\u8bed\u53e5; */","title":"\u4fee\u6539\u89c6\u56fe\u8868\u7ed3\u6784"},{"location":"MySQL/#_70","text":"/* \u5220\u9664\u89c6\u56fe \u6807\u51c6\u8bed\u6cd5 DROP VIEW [IF EXISTS] \u89c6\u56fe\u540d\u79f0; */","title":"\u5220\u9664\u89c6\u56fe"},{"location":"MySQL/#02_2","text":"","title":"02\u5b58\u50a8\u8fc7\u7a0b\u548c\u51fd\u6570"},{"location":"MySQL/#_71","text":"-- \u521b\u5efadb8\u6570\u636e\u5e93 CREATE DATABASE db8; -- \u4f7f\u7528db8\u6570\u636e\u5e93 USE db8; -- \u521b\u5efa\u5b66\u751f\u8868 CREATE TABLE student( id INT PRIMARY KEY AUTO_INCREMENT, -- \u5b66\u751fid NAME VARCHAR(20), -- \u5b66\u751f\u59d3\u540d age INT, -- \u5b66\u751f\u5e74\u9f84 gender VARCHAR(5), -- \u5b66\u751f\u6027\u522b score INT -- \u5b66\u751f\u6210\u7ee9 ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO student VALUES (NULL,'\u5f20\u4e09',23,'\u7537',95),(NULL,'\u674e\u56db',24,'\u7537',98), (NULL,'\u738b\u4e94',25,'\u5973',100),(NULL,'\u8d75\u516d',26,'\u5973',90); -- \u6309\u7167\u6027\u522b\u8fdb\u884c\u5206\u7ec4\uff0c\u67e5\u8be2\u6bcf\u7ec4\u5b66\u751f\u7684\u603b\u6210\u7ee9\u3002\u6309\u7167\u603b\u6210\u7ee9\u7684\u5347\u5e8f\u6392\u5e8f SELECT gender,SUM(score) getSum FROM student GROUP BY gender ORDER BY getSum ASC;","title":"\u6570\u636e\u51c6\u5907"},{"location":"MySQL/#_72","text":"/* -- \u4fee\u6539\u5206\u9694\u7b26\u4e3a $ DELIMITER $ -- \u6807\u51c6\u8bed\u6cd5 CREATE PROCEDURE \u5b58\u50a8\u8fc7\u7a0b\u540d\u79f0 ( \u53c2\u6570 ...) BEGIN sql\u8bed\u53e5 ; END $ -- \u4fee\u6539\u5206\u9694\u7b26\u4e3a\u5206\u53f7 DELIMITER ; */ -- \u521b\u5efastu_group()\u5b58\u50a8\u8fc7\u7a0b\uff0c\u5c01\u88c5 \u5206\u7ec4\u67e5\u8be2\u603b\u6210\u7ee9\uff0c\u5e76\u6309\u7167\u603b\u6210\u7ee9\u5347\u5e8f\u6392\u5e8f\u7684\u529f\u80fd DELIMITER $ CREATE PROCEDURE stu_group () BEGIN SELECT gender , SUM ( score ) getSum FROM student GROUP BY gender ORDER BY getSum ASC ; END $ DELIMITER ;","title":"\u521b\u5efa\u5b58\u50a8\u8fc7\u7a0b"},{"location":"MySQL/#_73","text":"/* \u8c03\u7528\u5b58\u50a8\u8fc7\u7a0b \u6807\u51c6\u8bed\u6cd5 CALL \u5b58\u50a8\u8fc7\u7a0b\u540d\u79f0(\u5b9e\u9645\u53c2\u6570); */ -- \u8c03\u7528stu_group\u5b58\u50a8\u8fc7\u7a0b CALL stu_group();","title":"\u8c03\u7528\u5b58\u50a8\u8fc7\u7a0b"},{"location":"MySQL/#_74","text":"/* \u67e5\u8be2\u6570\u636e\u5e93\u4e2d\u6240\u6709\u7684\u5b58\u50a8\u8fc7\u7a0b \u6807\u51c6\u8bed\u6cd5 SELECT name FROM mysql.proc WHERE db='\u6570\u636e\u5e93\u540d\u79f0'; */ -- \u67e5\u770bdb8\u6570\u636e\u5e93\u4e2d\u6240\u6709\u7684\u5b58\u50a8\u8fc7\u7a0b SELECT NAME FROM mysql.proc WHERE db='db8';","title":"\u67e5\u8be2\u6570\u636e\u5e93\u4e2d\u6240\u6709\u7684\u5b58\u50a8\u8fc7\u7a0b"},{"location":"MySQL/#_75","text":"/* \u67e5\u770b\u5b58\u50a8\u8fc7\u7a0b\u7684\u72b6\u6001\u4fe1\u606f \u6807\u51c6\u8bed\u6cd5 SHOW PROCEDURE STATUS ; */ -- \u67e5\u770b\u5b58\u50a8\u8fc7\u7a0b\u7684\u72b6\u6001\u4fe1\u606f SHOW PROCEDURE STATUS ;","title":"\u67e5\u770b\u5b58\u50a8\u8fc7\u7a0b\u7684\u72b6\u6001\u4fe1\u606f"},{"location":"MySQL/#_76","text":"/* \u67e5\u770b\u5b58\u50a8\u8fc7\u7a0b\u7684\u521b\u5efa\u8bed\u53e5 \u6807\u51c6\u8bed\u6cd5 SHOW CREATE PROCEDURE \u5b58\u50a8\u8fc7\u7a0b\u540d\u79f0 ; */ -- \u67e5\u8be2stu_group\u5b58\u50a8\u8fc7\u7a0b\u7684\u521b\u5efa\u8bed\u53e5 SHOW CREATE PROCEDURE stu_group ;","title":"\u67e5\u770b\u5b58\u50a8\u8fc7\u7a0b\u7684\u521b\u5efa\u8bed\u53e5"},{"location":"MySQL/#_77","text":"/* \u5220\u9664\u5b58\u50a8\u8fc7\u7a0b \u6807\u51c6\u8bed\u6cd5 DROP PROCEDURE [IF EXISTS] \u5b58\u50a8\u8fc7\u7a0b\u540d\u79f0; */ -- \u5220\u9664stu_group\u5b58\u50a8\u8fc7\u7a0b DROP PROCEDURE IF EXISTS stu_group ;","title":"\u5220\u9664\u5b58\u50a8\u8fc7\u7a0b"},{"location":"MySQL/#-","text":"","title":"\u5b58\u50a8\u8fc7\u7a0b-\u53d8\u91cf"},{"location":"MySQL/#_78","text":"/* \u5b9a\u4e49\u53d8\u91cf \u6807\u51c6\u8bed\u6cd5 DECLARE \u53d8\u91cf\u540d \u6570\u636e\u7c7b\u578b [DEFAULT \u9ed8\u8ba4\u503c]; */ -- \u5b9a\u4e49\u4e00\u4e2aint\u7c7b\u578b\u53d8\u91cf\uff0c\u5e76\u8d4b\u9ed8\u8ba4\u503c\u4e3a10 DELIMITER $ CREATE PROCEDURE pro_test1 () BEGIN -- \u5b9a\u4e49\u53d8\u91cf DECLARE num INT DEFAULT 10 ; -- \u67e5\u8be2\u53d8\u91cf SELECT num ; END $ DELIMITER ; -- \u8c03\u7528pro_test1\u5b58\u50a8\u8fc7\u7a0b CALL pro_test1();","title":"\u5b9a\u4e49\u53d8\u91cf"},{"location":"MySQL/#-_1","text":"/* \u53d8\u91cf\u8d4b\u503c-\u65b9\u5f0f\u4e00 \u6807\u51c6\u8bed\u6cd5 SET \u53d8\u91cf\u540d = \u53d8\u91cf\u503c; */ -- \u5b9a\u4e49\u4e00\u4e2avarchar\u7c7b\u578b\u53d8\u91cf\u5e76\u8d4b\u503c DELIMITER $ CREATE PROCEDURE pro_test2 () BEGIN -- \u5b9a\u4e49\u53d8\u91cf DECLARE NAME VARCHAR ( 10 ); -- \u4e3a\u53d8\u91cf\u8d4b\u503c SET NAME = '\u5b58\u50a8\u8fc7\u7a0b' ; -- \u67e5\u8be2\u53d8\u91cf SELECT NAME ; END $ DELIMITER ; -- \u8c03\u7528pro_test2\u5b58\u50a8\u8fc7\u7a0b CALL pro_test2(); \u53d8\u91cf\u8d4b\u503c-\u65b9\u5f0f\u4e8c /* \u53d8\u91cf\u8d4b\u503c-\u65b9\u5f0f\u4e8c \u6807\u51c6\u8bed\u6cd5 SELECT \u5217\u540d INTO \u53d8\u91cf\u540d FROM \u8868\u540d [WHERE \u6761\u4ef6]; */ -- \u5b9a\u4e49\u4e24\u4e2aint\u53d8\u91cf\uff0c\u7528\u4e8e\u5b58\u50a8\u7537\u5973\u540c\u5b66\u7684\u603b\u5206\u6570 DELIMITER $ CREATE PROCEDURE pro_test3 () BEGIN -- \u5b9a\u4e49\u53d8\u91cf DECLARE men , women INT ; -- \u67e5\u8be2\u7537\u540c\u5b66\u7684\u603b\u5206\u6570\uff0c\u4e3a men\u53d8\u91cf\u8d4b\u503c SELECT SUM ( score ) INTO men FROM student WHERE gender = '\u7537' ; -- \u67e5\u8be2\u5973\u540c\u5b66\u7684\u603b\u5206\u6570\uff0c\u4e3a women\u53d8\u91cf\u8d4b\u503c SELECT SUM ( score ) INTO women FROM student WHERE gender = '\u5973' ; -- \u67e5\u8be2\u53d8\u91cf SELECT men , women ; END $ DELIMITER ; -- \u8c03\u7528pro_test3\u5b58\u50a8\u8fc7\u7a0b CALL pro_test3();","title":"\u53d8\u91cf\u8d4b\u503c-\u65b9\u5f0f\u4e00"},{"location":"MySQL/#-if","text":"/* \u5b58\u50a8\u8fc7\u7a0b - if\u8bed\u53e5 \u6807\u51c6\u8bed\u6cd5 IF \u5224\u65ad\u6761\u4ef6 1 THEN \u6267\u884c\u7684 sql\u8bed\u53e51 ; [ ELSEIF \u5224\u65ad\u6761\u4ef6 2 THEN \u6267\u884c\u7684 sql\u8bed\u53e52 ;] ... [ ELSE \u6267\u884c\u7684 sql\u8bed\u53e5n ;] END IF ; */ / \u5b9a\u4e49\u4e00\u4e2aint\u53d8\u91cf\uff0c\u7528\u4e8e\u5b58\u50a8\u73ed\u7ea7\u603b\u6210\u7ee9 \u5b9a\u4e49\u4e00\u4e2avarchar\u53d8\u91cf\uff0c\u7528\u4e8e\u5b58\u50a8\u5206\u6570\u63cf\u8ff0 \u6839\u636e\u603b\u6210\u7ee9\u5224\u65ad\uff1a 380\u5206\u53ca\u4ee5\u4e0a \u5b66\u4e60\u4f18\u79c0 320 ~ 380 \u5b66\u4e60\u4e0d\u9519 320\u4ee5\u4e0b \u5b66\u4e60\u4e00\u822c / DELIMITER $ CREATE PROCEDURE pro_test4 () BEGIN -- \u5b9a\u4e49\u4fdd\u5b58\u603b\u6210\u7ee9\u7684\u53d8\u91cf DECLARE total INT ; -- \u5b9a\u4e49\u4fdd\u5b58\u5206\u6570\u63cf\u8ff0\u7684\u53d8\u91cf DECLARE description VARCHAR ( 10 ); -- \u4e3a total\u8d4b\u503c SELECT SUM ( score ) INTO total FROM student ; -- \u5224\u65ad\u603b\u6210\u7ee9 IF total >= 380 THEN SET description = '\u5b66\u4e60\u4f18\u79c0' ; ELSEIF total >= 320 AND total < 380 THEN SET description = '\u5b66\u4e60\u4e0d\u9519' ; ELSE SET description = '\u5b66\u4e60\u4e00\u822c' ; END IF ; -- \u67e5\u8be2\u603b\u6210\u7ee9\u548c\u63cf\u8ff0\u4fe1\u606f SELECT total , description ; END $ DELIMITER ; -- \u8c03\u7528pro_test4\u5b58\u50a8\u8fc7\u7a0b CALL pro_test4();","title":"\u5b58\u50a8\u8fc7\u7a0b-if\u8bed\u53e5"},{"location":"MySQL/#__1","text":"/* \u8f93\u5165\u53c2\u6570 DELIMITER $ -- \u6807\u51c6\u8bed\u6cd5 CREATE PROCEDURE \u5b58\u50a8\u8fc7\u7a0b\u540d\u79f0 ( IN \u53c2\u6570\u540d \u6570\u636e\u7c7b\u578b ) BEGIN \u6267\u884c\u7684 sql\u8bed\u53e5 ; END $ DELIMITER ; */ / \u8f93\u5165\u603b\u6210\u7ee9\u53d8\u91cf\uff0c\u4ee3\u8868\u5b66\u751f\u603b\u6210\u7ee9 \u5b9a\u4e49\u4e00\u4e2avarchar\u53d8\u91cf\uff0c\u7528\u4e8e\u5b58\u50a8\u5206\u6570\u63cf\u8ff0 \u6839\u636e\u603b\u6210\u7ee9\u5224\u65ad\uff1a 380\u5206\u53ca\u4ee5\u4e0a \u5b66\u4e60\u4f18\u79c0 320 ~ 380 \u5b66\u4e60\u4e0d\u9519 320\u4ee5\u4e0b \u5b66\u4e60\u4e00\u822c / DELIMITER $ CREATE PROCEDURE pro_test5 ( IN total INT ) BEGIN -- \u5b9a\u4e49\u5206\u6570\u63cf\u8ff0\u53d8\u91cf DECLARE description VARCHAR ( 10 ); -- \u5224\u65ad\u603b\u6210\u7ee9 IF total >= 380 THEN SET description = '\u5b66\u4e60\u4f18\u79c0' ; ELSEIF total >= 320 AND total < 380 THEN SET description = '\u5b66\u4e60\u4e0d\u9519' ; ELSE SET description = '\u5b66\u4e60\u4e00\u822c' ; END IF ; -- \u67e5\u8be2\u603b\u6210\u7ee9\u548c\u63cf\u8ff0\u4fe1\u606f SELECT total , description ; END $ DELIMITER ; -- \u8c03\u7528pro_test5\u5b58\u50a8\u8fc7\u7a0b CALL pro_test5(310); CALL pro_test5((SELECT SUM(score) FROM student));","title":"\u5b58\u50a8\u8fc7\u7a0b_\u8f93\u5165\u53c2\u6570"},{"location":"MySQL/#__2","text":"/* \u8f93\u51fa\u53c2\u6570 DELIMITER $ -- \u6807\u51c6\u8bed\u6cd5 CREATE PROCEDURE \u5b58\u50a8\u8fc7\u7a0b\u540d\u79f0 ( OUT \u53c2\u6570\u540d \u6570\u636e\u7c7b\u578b ) BEGIN \u6267\u884c\u7684 sql\u8bed\u53e5 ; END $ DELIMITER ; */ /\u8f93\u5165\u603b\u6210\u7ee9\u53d8\u91cf\uff0c\u4ee3\u8868\u5b66\u751f\u603b\u6210\u7ee9 \u8f93\u51fa\u5206\u6570\u63cf\u8ff0\u53d8\u91cf\uff0c\u4ee3\u8868\u5b66\u751f\u603b\u6210\u7ee9\u7684\u63cf\u8ff0 \u6839\u636e\u603b\u6210\u7ee9\u5224\u65ad\uff1a 380\u5206\u53ca\u4ee5\u4e0a \u5b66\u4e60\u4f18\u79c0 320 ~ 380 \u5b66\u4e60\u4e0d\u9519 320\u4ee5\u4e0b \u5b66\u4e60\u4e00\u822c */ DELIMITER $ CREATE PROCEDURE pro_test6 ( IN total INT , OUT description VARCHAR ( 10 )) BEGIN -- \u5224\u65ad\u603b\u6210\u7ee9 IF total >= 380 THEN SET description = '\u5b66\u4e60\u4f18\u79c0' ; ELSEIF total >= 320 AND total < 380 THEN SET description = '\u5b66\u4e60\u4e0d\u9519' ; ELSE SET description = '\u5b66\u4e60\u4e00\u822c' ; END IF ; END $ DELIMITER ; -- \u8c03\u7528pro_test6\u5b58\u50a8\u8fc7\u7a0b CALL pro_test6 ( 390 , @description ); -- \u67e5\u8be2\u603b\u6210\u7ee9\u63cf\u8ff0\u4fe1\u606f\u53d8\u91cf SELECT @description ;","title":"\u5b58\u50a8\u8fc7\u7a0b_\u8f93\u51fa\u53c2\u6570"},{"location":"MySQL/#_case","text":"/* case\u8bed\u53e5 \u6807\u51c6\u8bed\u6cd5 CASE WHEN \u5224\u65ad\u6761\u4ef6 1 THEN \u6267\u884c sql\u8bed\u53e51 ; [ WHEN \u5224\u65ad\u6761\u4ef6 2 THEN \u6267\u884c sql\u8bed\u53e52 ;] ... [ ELSE \u6267\u884c sql\u8bed\u53e5n ;] END CASE ; */ / \u8f93\u5165\u603b\u6210\u7ee9\u53d8\u91cf\uff0c\u4ee3\u8868\u5b66\u751f\u603b\u6210\u7ee9 \u5b9a\u4e49\u4e00\u4e2avarchar\u53d8\u91cf\uff0c\u7528\u4e8e\u5b58\u50a8\u5206\u6570\u63cf\u8ff0 \u6839\u636e\u603b\u6210\u7ee9\u5224\u65ad\uff1a 380\u5206\u53ca\u4ee5\u4e0a \u5b66\u4e60\u4f18\u79c0 320 ~ 380 \u5b66\u4e60\u4e0d\u9519 320\u4ee5\u4e0b \u5b66\u4e60\u4e00\u822c / DELIMITER $ CREATE PROCEDURE pro_test7 ( IN total INT ) BEGIN -- \u5b9a\u4e49\u603b\u6210\u7ee9\u63cf\u8ff0\u4fe1\u606f\u53d8\u91cf DECLARE description VARCHAR ( 10 ); -- \u5224\u65ad\u603b\u6210\u7ee9 CASE WHEN total >= 380 THEN SET description = '\u5b66\u4e60\u4f18\u79c0' ; WHEN total >= 320 AND total < 380 THEN SET description = '\u5b66\u4e60\u4e0d\u9519' ; ELSE SET description = '\u5b66\u4e60\u4e00\u822c' ; END CASE ; -- \u67e5\u8be2\u603b\u6210\u7ee9\u548c\u63cf\u8ff0\u4fe1\u606f SELECT total , description ; END $ DELIMITER ; -- \u8c03\u7528pro_test7\u5b58\u50a8\u8fc7\u7a0b CALL pro_test7(310);","title":"\u5b58\u50a8\u8fc7\u7a0b_case\u8bed\u53e5"},{"location":"MySQL/#_while","text":"/* while\u5faa\u73af \u6807\u51c6\u8bed\u6cd5 \u521d\u59cb\u5316\u8bed\u53e5 ; WHILE \u6761\u4ef6\u5224\u65ad\u8bed\u53e5 DO \u5faa\u73af\u4f53\u8bed\u53e5 ; \u6761\u4ef6\u63a7\u5236\u8bed\u53e5 ; END WHILE ; */ -- \u8ba1\u7b971~100\u4e4b\u95f4\u7684\u5076\u6570\u548c DELIMITER $ CREATE PROCEDURE pro_test8 () BEGIN -- \u5b9a\u4e49\u6c42\u548c\u53d8\u91cf DECLARE result INT DEFAULT 0 ; -- \u5b9a\u4e49\u521d\u59cb\u5316\u53d8\u91cf DECLARE num INT DEFAULT 1 ; -- while\u5faa\u73af WHILE num <= 100 DO -- \u5224\u65ad num\u662f\u5426\u662f\u5076\u6570 IF num % 2 = 0 THEN -- \u8ba9 num\u548cresult\u8fdb\u884c\u7d2f\u52a0 SET result = result + num ; END IF ; -- \u8ba9 num\u8fdb\u884c\u81ea\u589e SET num = num + 1 ; END WHILE ; -- \u67e5\u8be2\u6c42\u548c\u7ed3\u679c SELECT result ; END $ DELIMITER ; -- \u8c03\u7528pro_test8\u5b58\u50a8\u8fc7\u7a0b CALL pro_test8();","title":"\u5b58\u50a8\u8fc7\u7a0b_while\u5faa\u73af"},{"location":"MySQL/#_repeat","text":"/* repeat\u5faa\u73af \u6807\u51c6\u8bed\u6cd5 \u521d\u59cb\u5316\u8bed\u53e5 ; REPEAT \u5faa\u73af\u4f53\u8bed\u53e5 ; \u6761\u4ef6\u63a7\u5236\u8bed\u53e5 ; UNTIL \u6761\u4ef6\u5224\u65ad\u8bed\u53e5 END REPEAT ; */ -- \u8ba1\u7b971~10\u4e4b\u95f4\u7684\u548c DELIMITER $ CREATE PROCEDURE pro_test9 () BEGIN -- \u5b9a\u4e49\u6c42\u548c\u53d8\u91cf DECLARE result INT DEFAULT 0 ; -- \u5b9a\u4e49\u521d\u59cb\u5316\u53d8\u91cf DECLARE num INT DEFAULT 1 ; -- repeat\u5faa\u73af REPEAT -- \u7d2f\u52a0 SET result = result + num ; -- \u8ba9 num + 1 SET num = num + 1 ; -- \u505c\u6b62\u5faa\u73af UNTIL num > 10 END REPEAT ; -- \u67e5\u8be2\u6c42\u548c\u7ed3\u679c SELECT result ; END $ DELIMITER ; -- \u8c03\u7528pro_test9\u5b58\u50a8\u8fc7\u7a0b CALL pro_test9();","title":"\u5b58\u50a8\u8fc7\u7a0b_repeat\u5faa\u73af"},{"location":"MySQL/#_loop","text":"/* loop\u5faa\u73af \u6807\u51c6\u8bed\u6cd5 \u521d\u59cb\u5316\u8bed\u53e5; [ \u5faa\u73af\u540d\u79f0 : ] LOOP \u6761\u4ef6\u5224\u65ad\u8bed\u53e5 [ LEAVE \u5faa\u73af\u540d\u79f0 ; ] \u5faa\u73af\u4f53\u8bed\u53e5; \u6761\u4ef6\u63a7\u5236\u8bed\u53e5; END LOOP \u5faa\u73af\u540d\u79f0; */ -- \u8ba1\u7b971~10\u4e4b\u95f4\u7684\u548c DELIMITER $ CREATE PROCEDURE pro_test10 () BEGIN -- \u5b9a\u4e49\u6c42\u548c\u53d8\u91cf DECLARE result INT DEFAULT 0 ; -- \u5b9a\u4e49\u521d\u59cb\u5316\u53d8\u91cf DECLARE num INT DEFAULT 1 ; -- loop\u5faa\u73af l : LOOP -- \u6761\u4ef6\u5224\u65ad \uff0c \u505c\u6b62\u5faa\u73af IF num > 10 THEN LEAVE l ; END IF ; -- \u7d2f\u52a0 SET result = result + num ; -- \u8ba9num + 1 SET num = num + 1 ; END LOOP l ; -- \u67e5\u8be2\u6c42\u548c\u7ed3\u679c SELECT result ; END $ DELIMITER ; -- \u8c03\u7528pro_test10\u5b58\u50a8\u8fc7\u7a0b CALL pro_test10();","title":"\u5b58\u50a8\u8fc7\u7a0b_loop\u5faa\u73af"},{"location":"MySQL/#__3","text":"/* \u6e38\u6807 \u6807\u51c6\u8bed\u6cd5 1.\u521b\u5efa\u6e38\u6807\uff1aDECLARE \u6e38\u6807\u540d\u79f0 CURSOR FOR \u67e5\u8be2sql\u8bed\u53e5; 2.\u6253\u5f00\u6e38\u6807\uff1aOPEN \u6e38\u6807\u540d\u79f0; 3.\u4f7f\u7528\u6e38\u6807\uff1aFETCH \u6e38\u6807\u540d\u79f0 INTO \u53d8\u91cf\u540d1,\u53d8\u91cf\u540d2,...; 4.\u5173\u95ed\u6e38\u6807\uff1aCLOSE \u6e38\u6807\u540d\u79f0; */ -- \u521b\u5efastu_score\u8868 CREATE TABLE stu_score( id INT PRIMARY KEY AUTO_INCREMENT, score INT ); -- \u5c06student\u8868\u4e2d\u6240\u6709\u7684\u6210\u7ee9\u4fdd\u5b58\u5230stu_score\u8868\u4e2d DELIMITER $ CREATE PROCEDURE pro_test11 () BEGIN -- \u5b9a\u4e49\u4e00\u4e2a\u4fdd\u5b58\u6210\u7ee9\u7684\u53d8\u91cf DECLARE s_score INT ; -- \u521b\u5efa\u6e38\u6807 DECLARE stu_result CURSOR FOR SELECT score FROM student ; -- \u5f00\u542f\u6e38\u6807 OPEN stu_result ; -- \u4f7f\u7528\u6e38\u6807 -- \u904d\u5386\u7ed3\u679c\uff0c\u62ff\u5230\u7b2c 1 \u884c\u6570\u636e FETCH stu_result INTO s_score ; -- \u5c06\u6570\u636e\u4fdd\u5b58\u5230 stu_score\u8868\u4e2d INSERT INTO stu_score VALUES ( NULL , s_score ); -- \u904d\u5386\u7ed3\u679c\uff0c\u62ff\u5230\u7b2c 2 \u884c\u6570\u636e FETCH stu_result INTO s_score ; -- \u5c06\u6570\u636e\u4fdd\u5b58\u5230 stu_score\u8868\u4e2d INSERT INTO stu_score VALUES ( NULL , s_score ); -- \u904d\u5386\u7ed3\u679c\uff0c\u62ff\u5230\u7b2c 3 \u884c\u6570\u636e FETCH stu_result INTO s_score ; -- \u5c06\u6570\u636e\u4fdd\u5b58\u5230 stu_score\u8868\u4e2d INSERT INTO stu_score VALUES ( NULL , s_score ); -- \u904d\u5386\u7ed3\u679c\uff0c\u62ff\u5230\u7b2c 4 \u884c\u6570\u636e FETCH stu_result INTO s_score ; -- \u5c06\u6570\u636e\u4fdd\u5b58\u5230 stu_score\u8868\u4e2d INSERT INTO stu_score VALUES ( NULL , s_score ); -- \u5173\u95ed\u6e38\u6807 CLOSE stu_result ; END $ DELIMITER ; -- \u8c03\u7528pro_test11\u5b58\u50a8\u8fc7\u7a0b CALL pro_test11(); -- \u67e5\u8be2stu_score\u6570\u636e\u8868 SELECT * FROM stu_score;","title":"\u5b58\u50a8\u8fc7\u7a0b_\u6e38\u6807"},{"location":"MySQL/#__4","text":"/* \u5f53\u6e38\u6807\u7ed3\u675f\u540e\uff0c\u4f1a\u81ea\u52a8\u7684\u89e6\u53d1\u4e00\u4e2a\u4e8b\u4ef6\u3002\u5c31\u4ee3\u8868\u6e38\u6807\u5df2\u7ecf\u7ed3\u675f\u4e86\uff01 \u52a0\u6807\u8bb0\u7684\u601d\u60f3\uff1a 1.\u5b9a\u4e49\u4e00\u4e2a\u6807\u8bb0\u53d8\u91cf\uff0c\u9ed8\u8ba4\u503c\u4e3a0\uff08\u610f\u5473\u7740\u6709\u6570\u636e\uff09 2.\u5f53\u6e38\u6807\u7ed3\u675f\u540e\uff0c\u5c06\u6807\u8bb0\u53d8\u91cf\u7684\u503c\u4fee\u6539\u4e3a1\uff08\u610f\u5473\u7740\u6ca1\u6709\u6570\u636e\u4e86\uff09 */ DELIMITER $ CREATE PROCEDURE pro_test12 () BEGIN -- \u5b9a\u4e49\u4e00\u4e2a\u4fdd\u5b58\u6210\u7ee9\u7684\u53d8\u91cf DECLARE s_score INT ; -- \u5b9a\u4e49\u4e00\u4e2a\u6807\u8bb0\u53d8\u91cf\uff0c\u9ed8\u8ba4\u503c\u4e3a 0 \uff08\u610f\u5473\u7740\u6709\u6570\u636e\uff09 DECLARE flag INT DEFAULT 0 ; -- \u521b\u5efa\u6e38\u6807 DECLARE stu_result CURSOR FOR SELECT score FROM student ; -- \u5f53\u6e38\u6807\u7ed3\u675f\u540e\uff0c\u5c06\u6807\u8bb0\u53d8\u91cf\u7684\u503c\u4fee\u6539\u4e3a 1 \uff08\u610f\u5473\u7740\u6ca1\u6709\u6570\u636e\u4e86\uff09 DECLARE EXIT HANDLER FOR NOT FOUND SET flag = 1 ; -- \u5f00\u542f\u6e38\u6807 OPEN stu_result ; -- \u5faa\u73af\u4f7f\u7528\u6e38\u6807 REPEAT -- \u904d\u5386\u7ed3\u679c\uff0c\u62ff\u5230\u6570\u636e FETCH stu_result INTO s_score ; -- \u5c06\u6570\u636e\u4fdd\u5b58\u5230 stu_score\u8868\u4e2d INSERT INTO stu_score VALUES ( NULL , s_score ); -- \u5f53 flag\u7684\u503c\u662f1\u7684\u65f6\u5019 \uff0c\u5c31\u505c\u6b62\u5faa\u73af UNTIL flag = 1 END REPEAT ; -- \u5173\u95ed\u6e38\u6807 CLOSE stu_result ; END $ DELIMITER ; -- \u8c03\u7528pro_test12\u5b58\u50a8\u8fc7\u7a0b CALL pro_test12(); -- \u67e5\u8be2stu_score\u8868 SELECT * FROM stu_score;","title":"\u5b58\u50a8\u8fc7\u7a0b_\u6e38\u6807\u4f18\u5316"},{"location":"MySQL/#_79","text":"","title":"\u5b58\u50a8\u51fd\u6570"},{"location":"MySQL/#_80","text":"/* \u521b\u5efa\u5b58\u50a8\u51fd\u6570 \u6807\u51c6\u8bed\u6cd5 CREATE FUNCTION \u51fd\u6570\u540d\u79f0 ([ \u53c2\u6570 \u6570\u636e\u7c7b\u578b ]) RETURNS \u8fd4\u56de\u503c\u7c7b\u578b BEGIN \u6267\u884c\u7684 sql\u8bed\u53e5 ; RETURN \u7ed3\u679c ; END $ */ -- \u5b9a\u4e49\u5b58\u50a8\u51fd\u6570\uff0c\u83b7\u53d6\u5b66\u751f\u8868\u4e2d\u6210\u7ee9\u5927\u4e8e95\u5206\u7684\u5b66\u751f\u6570\u91cf DELIMITER $ CREATE FUNCTION fun_test1 () RETURNS INT BEGIN -- \u5b9a\u4e49\u4e00\u4e2a\u7edf\u8ba1\u53d8\u91cf DECLARE result INT ; -- \u67e5\u8be2\u6210\u7ee9\u5927\u4e8e 95 \u5206\u7684\u6570\u91cf SELECT COUNT ( * ) INTO result FROM student WHERE score > 95 ; -- \u5c06\u7ed3\u679c\u8fd4\u56de RETURN result ; END $ DELIMITER ;","title":"\u521b\u5efa\u5b58\u50a8\u51fd\u6570"},{"location":"MySQL/#_81","text":"/* \u8c03\u7528\u51fd\u6570 \u6807\u51c6\u8bed\u6cd5 SELECT \u51fd\u6570\u540d\u79f0(\u5b9e\u9645\u53c2\u6570); */ -- \u8c03\u7528\u51fd\u6570 SELECT fun_test1();","title":"\u8c03\u7528\u51fd\u6570"},{"location":"MySQL/#_82","text":"/* \u5220\u9664\u51fd\u6570 \u6807\u51c6\u8bed\u6cd5 DROP FUNCTION \u51fd\u6570\u540d\u79f0; */ -- \u5220\u9664\u51fd\u6570 DROP FUNCTION fun_test1;","title":"\u5220\u9664\u51fd\u6570"},{"location":"MySQL/#03_2","text":"","title":"03\u89e6\u53d1\u5668"},{"location":"MySQL/#_83","text":"-- \u521b\u5efadb9\u6570\u636e\u5e93 CREATE DATABASE db9; -- \u4f7f\u7528db9\u6570\u636e\u5e93 USE db9; -- \u521b\u5efa\u8d26\u6237\u8868account CREATE TABLE account( id INT PRIMARY KEY AUTO_INCREMENT, -- \u8d26\u6237id NAME VARCHAR(20), -- \u59d3\u540d money DOUBLE -- \u4f59\u989d ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO account VALUES (NULL,'\u5f20\u4e09',1000),(NULL,'\u674e\u56db',2000); -- \u521b\u5efa\u65e5\u5fd7\u8868account_log CREATE TABLE account_log( id INT PRIMARY KEY AUTO_INCREMENT, -- \u65e5\u5fd7id operation VARCHAR(20), -- \u64cd\u4f5c\u7c7b\u578b (insert update delete) operation_time DATETIME, -- \u64cd\u4f5c\u65f6\u95f4 operation_id INT, -- \u64cd\u4f5c\u8868\u7684id operation_params VARCHAR(200) -- \u64cd\u4f5c\u53c2\u6570 );","title":"\u89e6\u53d1\u5668\u6570\u636e\u51c6\u5907"},{"location":"MySQL/#insert","text":"/* \u521b\u5efa\u89e6\u53d1\u5668 \u6807\u51c6\u8bed\u6cd5 DELIMITER $ CREATE TRIGGER \u89e6\u53d1\u5668\u540d\u79f0 BEFORE | AFTER INSERT | UPDATE | DELETE ON \u8868\u540d FOR EACH ROW BEGIN \u89e6\u53d1\u5668\u8981\u6267\u884c\u7684\u529f\u80fd ; END $ DELIMITER ; */ -- \u521b\u5efaINSERT\u578b\u89e6\u53d1\u5668\u3002\u7528\u4e8e\u5bf9account\u8868\u65b0\u589e\u6570\u636e\u8fdb\u884c\u65e5\u5fd7\u7684\u8bb0\u5f55 DELIMITER $ CREATE TRIGGER account_insert AFTER INSERT ON account FOR EACH ROW BEGIN INSERT INTO account_log VALUES ( NULL , 'INSERT' , NOW (), new . id , CONCAT ( '\u63d2\u5165\u540e{id=' , new . id , ',name=' , new . name , ',money=' , new . money , '}' )); END $ DELIMITER ; -- \u5411account\u8868\u6765\u6dfb\u52a0\u4e00\u6761\u8bb0\u5f55 INSERT INTO account VALUES (NULL,'\u738b\u4e94',3000); -- \u67e5\u8be2account\u8868 SELECT * FROM account; -- \u67e5\u8be2account_log\u8868 SELECT * FROM account_log;","title":"INSERT\u578b\u89e6\u53d1\u5668"},{"location":"MySQL/#update","text":"/* \u521b\u5efa\u89e6\u53d1\u5668 \u6807\u51c6\u8bed\u6cd5 DELIMITER $ CREATE TRIGGER \u89e6\u53d1\u5668\u540d\u79f0 BEFORE | AFTER INSERT | UPDATE | DELETE ON \u8868\u540d FOR EACH ROW BEGIN \u89e6\u53d1\u5668\u8981\u6267\u884c\u7684\u529f\u80fd ; END $ DELIMITER ; */ -- \u521b\u5efaUPDATE\u578b\u89e6\u53d1\u5668\u3002\u7528\u4e8e\u5bf9account\u8868\u4fee\u6539\u6570\u636e\u8fdb\u884c\u65e5\u5fd7\u7684\u8bb0\u5f55 DELIMITER $ CREATE TRIGGER account_update AFTER UPDATE ON account FOR EACH ROW BEGIN INSERT INTO account_log VALUES ( NULL , 'UPDATE' , NOW (), new . id , CONCAT ( '\u4fee\u6539\u524d{id=' , old . id , ',name=' , old . name , ',money=' , old . money , '}' , '\u4fee\u6539\u540e{id=' , new . id , ',name=' , new . name , ',money=' , new . money , '}' )); END $ DELIMITER ; -- \u4fee\u6539account\u8868\u4e2d\u674e\u56db\u7684\u91d1\u989d\u4e3a2500 UPDATE account SET money=2500 WHERE NAME='\u674e\u56db'; -- \u67e5\u8be2account\u8868 SELECT * FROM account; -- \u67e5\u8be2account_log\u8868 SELECT * FROM account_log;","title":"UPDATE\u578b\u89e6\u53d1\u5668"},{"location":"MySQL/#delete","text":"/* \u521b\u5efa\u89e6\u53d1\u5668 \u6807\u51c6\u8bed\u6cd5 DELIMITER $ CREATE TRIGGER \u89e6\u53d1\u5668\u540d\u79f0 BEFORE | AFTER INSERT | UPDATE | DELETE ON \u8868\u540d FOR EACH ROW BEGIN \u89e6\u53d1\u5668\u8981\u6267\u884c\u7684\u529f\u80fd ; END $ DELIMITER ; */ -- \u521b\u5efaDELETE\u578b\u89e6\u53d1\u5668\u3002\u7528\u4e8e\u5bf9account\u8868\u5220\u9664\u6570\u636e\u8fdb\u884c\u65e5\u5fd7\u7684\u8bb0\u5f55 DELIMITER $ CREATE TRIGGER account_delete AFTER DELETE ON account FOR EACH ROW BEGIN INSERT INTO account_log VALUES ( NULL , 'DELETE' , NOW (), old . id , CONCAT ( '\u5220\u9664\u524d{id=' , old . id , ',name=' , old . name , ',money=' , old . money , '}' )); END $ DELIMITER ; -- \u5220\u9664account\u8868\u4e2d\u738b\u4e94 DELETE FROM account WHERE NAME='\u738b\u4e94'; -- \u67e5\u8be2account\u8868 SELECT * FROM account; -- \u67e5\u8be2account_log\u8868 SELECT * FROM account_log;","title":"DELETE\u578b\u89e6\u53d1\u5668"},{"location":"MySQL/#_84","text":"/* \u67e5\u770b\u89e6\u53d1\u5668 \u6807\u51c6\u8bed\u6cd5 SHOW TRIGGERS; */ -- \u67e5\u770b\u89e6\u53d1\u5668 SHOW TRIGGERS ;","title":"\u67e5\u770b\u89e6\u53d1\u5668"},{"location":"MySQL/#_85","text":"/* \u5220\u9664\u89e6\u53d1\u5668 \u6807\u51c6\u8bed\u6cd5 DROP TRIGGER \u89e6\u53d1\u5668\u540d\u79f0; */ -- \u5220\u9664\u89e6\u53d1\u5668 DROP TRIGGER account_delete;","title":"\u5220\u9664\u89e6\u53d1\u5668"},{"location":"MySQL/#04_1","text":"","title":"04\u4e8b\u52a1"},{"location":"MySQL/#_86","text":"-- \u521b\u5efadb10\u6570\u636e\u5e93 CREATE DATABASE db10; -- \u4f7f\u7528db10\u6570\u636e\u5e93 USE db10; -- \u521b\u5efa\u8d26\u6237\u8868 CREATE TABLE account( id INT PRIMARY KEY AUTO_INCREMENT, -- \u8d26\u6237id NAME VARCHAR(20), -- \u8d26\u6237\u540d\u79f0 money DOUBLE -- \u8d26\u6237\u4f59\u989d ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO account VALUES (NULL,'\u5f20\u4e09',1000),(NULL,'\u674e\u56db',1000);","title":"\u4e8b\u52a1\u7684\u6570\u636e\u51c6\u5907"},{"location":"MySQL/#_87","text":"-- \u5f20\u4e09\u7ed9\u674e\u56db\u8f6c\u8d26500\u5143 -- 1.\u5f20\u4e09\u8d26\u6237-500 UPDATE account SET money=money-500 WHERE NAME='\u5f20\u4e09'; \u51fa\u9519\u4e86... -- 2.\u674e\u56db\u8d26\u6237+500 UPDATE account SET money=money+500 WHERE NAME='\u674e\u56db';","title":"\u672a\u7ba1\u7406\u4e8b\u52a1"},{"location":"MySQL/#_88","text":"/* \u5f00\u542f\u4e8b\u52a1\uff1aSTART TRANSACTION; \u56de\u6eda\u4e8b\u52a1\uff1aROLLBACK; \u63d0\u4ea4\u4e8b\u52a1\uff1aCOMMIT; */ -- \u5f20\u4e09\u7ed9\u674e\u56db\u8f6c\u8d26500\u5143 -- 1.\u5f00\u542f\u4e8b\u52a1 START TRANSACTION; -- 2.\u6267\u884c\u8f6c\u8d26\u7684\u64cd\u4f5c UPDATE account SET money=money-500 WHERE NAME='\u5f20\u4e09'; \u51fa\u9519\u4e86... UPDATE account SET money=money+500 WHERE NAME='\u674e\u56db'; -- 3.\u7ed3\u675f\u4e8b\u52a1 -- 3.1\u56de\u6eda\u4e8b\u52a1 ROLLBACK; -- 3.2\u63d0\u4ea4\u4e8b\u52a1 COMMIT;","title":"\u7ba1\u7406\u4e8b\u52a1"},{"location":"MySQL/#_89","text":"/* \u4e8b\u52a1\u7684\u63d0\u4ea4\u65b9\u5f0f \u67e5\u8be2\u4e8b\u52a1\u63d0\u4ea4\u65b9\u5f0f\uff1aSELECT @@AUTOCOMMIT; -- 1\u4ee3\u8868\u81ea\u52a8\u63d0\u4ea4 0\u4ee3\u8868\u624b\u52a8\u63d0\u4ea4 \u4fee\u6539\u4e8b\u52a1\u63d0\u4ea4\u65b9\u5f0f\uff1aSET @@AUTOCOMMIT=\u6570\u5b57; */ -- \u67e5\u8be2\u4e8b\u52a1\u7684\u63d0\u4ea4\u65b9\u5f0f SELECT @@autocommit ; UPDATE account SET money = 1000 WHERE NAME = '\u5f20\u4e09' ; COMMIT ; -- \u4fee\u6539\u4e8b\u52a1\u7684\u63d0\u4ea4\u65b9\u5f0f SET @@autocommit = 0 ;","title":"\u4e8b\u52a1\u7684\u63d0\u4ea4\u65b9\u5f0f"},{"location":"MySQL/#_90","text":"/* \u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b \u67e5\u8be2\u9694\u79bb\u7ea7\u522b\uff1aSELECT @@TX_ISOLATION; \u4fee\u6539\u9694\u79bb\u7ea7\u522b\uff1aSET GLOBAL TRANSACTION ISOLATION LEVEL \u7ea7\u522b\u5b57\u7b26\u4e32; */ -- \u67e5\u8be2\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b SELECT @@tx_isolation ; -- \u4fee\u6539\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b SET GLOBAL TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;","title":"\u67e5\u8be2\u548c\u4fee\u6539\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b"},{"location":"MySQL/#_91","text":"/* \u810f\u8bfb\u7684\u95ee\u9898\u6f14\u793a\u548c\u89e3\u51b3 \u810f\u8bfb\uff1a\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u8bfb\u53d6\u5230\u4e86\u5176\u4ed6\u4e8b\u52a1\u672a\u63d0\u4ea4\u7684\u6570\u636e */ -- \u8bbe\u7f6e\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u4e3aread uncommitted SET GLOBAL TRANSACTION ISOLATION LEVEL READ UNCOMMITTED; SET GLOBAL TRANSACTION ISOLATION LEVEL READ COMMITTED; -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION; -- \u8f6c\u8d26 UPDATE account SET money = money-500 WHERE NAME='\u5f20\u4e09'; UPDATE account SET money = money+500 WHERE NAME='\u674e\u56db'; -- \u67e5\u8be2account\u8868 SELECT * FROM account; -- \u56de\u6eda ROLLBACK;","title":"\u810f\u8bfb\u7684\u95ee\u9898\u6f14\u793a\u548c\u89e3\u51b3_\u7a97\u53e31"},{"location":"MySQL/#_92","text":"-- \u67e5\u8be2\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b SELECT @@tx_isolation ; -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION; -- \u67e5\u8be2account\u8868 SELECT * FROM account;","title":"\u810f\u8bfb\u7684\u95ee\u9898\u6f14\u793a\u548c\u89e3\u51b3_\u7a97\u53e32"},{"location":"MySQL/#_93","text":"/* \u4e0d\u53ef\u91cd\u590d\u8bfb\u7684\u95ee\u9898\u6f14\u793a\u548c\u89e3\u51b3 \u4e0d\u53ef\u91cd\u590d\u8bfb\uff1a\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u8bfb\u53d6\u5230\u4e86\u5176\u4ed6\u4e8b\u52a1\u5df2\u63d0\u4ea4\u7684\u6570\u636e */ -- \u8bbe\u7f6e\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u4e3aread committed SET GLOBAL TRANSACTION ISOLATION LEVEL READ COMMITTED; SET GLOBAL TRANSACTION ISOLATION LEVEL REPEATABLE READ; -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION; -- \u8f6c\u8d26 UPDATE account SET money = money-500 WHERE NAME='\u5f20\u4e09'; UPDATE account SET money = money+500 WHERE NAME='\u674e\u56db'; -- \u67e5\u8be2account\u8868 SELECT * FROM account; -- \u63d0\u4ea4\u4e8b\u52a1 COMMIT;","title":"\u4e0d\u53ef\u91cd\u590d\u8bfb\u7684\u95ee\u9898\u6f14\u793a\u548c\u89e3\u51b3_\u7a97\u53e31"},{"location":"MySQL/#_94","text":"-- \u67e5\u8be2\u9694\u79bb\u7ea7\u522b SELECT @@tx_isolation ; -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION; -- \u67e5\u8be2account\u8868 SELECT * FROM account; -- \u63d0\u4ea4\u4e8b\u52a1 COMMIT;","title":"\u4e0d\u53ef\u91cd\u590d\u8bfb\u7684\u95ee\u9898\u6f14\u793a\u548c\u89e3\u51b3_\u7a97\u53e32"},{"location":"MySQL/#_95","text":"/* \u5e7b\u8bfb\u7684\u95ee\u9898\u6f14\u793a\u548c\u89e3\u51b3 \u5e7b\u8bfb\uff1a \u67e5\u8be2\u67d0\u8bb0\u5f55\u662f\u5426\u5b58\u5728\uff0c\u4e0d\u5b58\u5728 \u51c6\u5907\u63d2\u5165\u6b64\u8bb0\u5f55\uff0c\u4f46\u6267\u884c\u63d2\u5165\u65f6\u53d1\u73b0\u6b64\u8bb0\u5f55\u5df2\u5b58\u5728\uff0c\u65e0\u6cd5\u63d2\u5165 \u6216\u67d0\u8bb0\u5f55\u4e0d\u5b58\u5728\u6267\u884c\u5220\u9664\uff0c\u5374\u53d1\u73b0\u5220\u9664\u6210\u529f */ -- \u8bbe\u7f6e\u9694\u79bb\u7ea7\u522b\u4e3arepeatable read SET GLOBAL TRANSACTION ISOLATION LEVEL REPEATABLE READ; SET GLOBAL TRANSACTION ISOLATION LEVEL SERIALIZABLE; -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION; -- \u6dfb\u52a0\u8bb0\u5f55 INSERT INTO account VALUES (4,'\u8d75\u516d',2000); -- \u67e5\u8be2account\u8868 SELECT * FROM account; -- \u63d0\u4ea4\u4e8b\u52a1 COMMIT;","title":"\u5e7b\u8bfb\u7684\u95ee\u9898\u6f14\u793a\u548c\u89e3\u51b3_\u7a97\u53e31"},{"location":"MySQL/#_96","text":"-- \u67e5\u8be2\u9694\u79bb\u7ea7\u522b SELECT @@tx_isolation ; -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION; -- \u67e5\u8be2account\u8868 SELECT * FROM account; -- \u6dfb\u52a0 INSERT INTO account VALUES (3,'\u738b\u4e94',2000);","title":"\u5e7b\u8bfb\u7684\u95ee\u9898\u6f14\u793a\u548c\u89e3\u51b3_\u7a97\u53e32"},{"location":"MySQL/#day04","text":"","title":"day04"},{"location":"MySQL/#01_3","text":"","title":"01\u5b58\u50a8\u5f15\u64ce"},{"location":"MySQL/#_97","text":"/* \u67e5\u8be2\u6570\u636e\u5e93\u652f\u6301\u7684\u5b58\u50a8\u5f15\u64ce \u6807\u51c6\u8bed\u6cd5 SHOW ENGINES; */","title":"\u67e5\u8be2\u6570\u636e\u5e93\u652f\u6301\u7684\u5b58\u50a8\u5f15\u64ce"},{"location":"MySQL/#_98","text":"/* \u67e5\u8be2\u67d0\u4e2a\u6570\u636e\u5e93\u4e2d\u6240\u6709\u6570\u636e\u8868\u7684\u5b58\u50a8\u5f15\u64ce \u6807\u51c6\u8bed\u6cd5 SHOW TABLE STATUS FROM \u6570\u636e\u5e93\u540d\u79f0; */","title":"\u67e5\u8be2\u67d0\u4e2a\u6570\u636e\u5e93\u4e2d\u6240\u6709\u6570\u636e\u8868\u7684\u5b58\u50a8\u5f15\u64ce"},{"location":"MySQL/#_99","text":"/* \u67e5\u8be2\u67d0\u4e2a\u6570\u636e\u5e93\u4e2d\u67d0\u4e2a\u8868\u7684\u5b58\u50a8\u5f15\u64ce \u6807\u51c6\u8bed\u6cd5 SHOW TABLE STATUS FROM \u6570\u636e\u5e93\u540d\u79f0 WHERE NAME = '\u6570\u636e\u8868\u540d\u79f0'; */","title":"\u67e5\u8be2\u67d0\u4e2a\u6570\u636e\u5e93\u4e2d\u67d0\u4e2a\u8868\u7684\u5b58\u50a8\u5f15\u64ce"},{"location":"MySQL/#_100","text":"/* \u521b\u5efa\u6570\u636e\u8868\u6307\u5b9a\u5b58\u50a8\u5f15\u64ce \u6807\u51c6\u8bed\u6cd5 CREATE TABLE \u8868\u540d( \u5217\u540d,\u6570\u636e\u7c7b\u578b, ... )ENGINE = \u5f15\u64ce\u540d\u79f0; */","title":"\u521b\u5efa\u6570\u636e\u8868\u6307\u5b9a\u5b58\u50a8\u5f15\u64ce"},{"location":"MySQL/#_101","text":"/* \u4fee\u6539\u6570\u636e\u8868\u7684\u5b58\u50a8\u5f15\u64ce \u6807\u51c6\u8bed\u6cd5 ALTER TABLE \u8868\u540d ENGINE = \u5f15\u64ce\u540d\u79f0; */ -- \u4fee\u6539engine_test\u8868\u7684\u5f15\u64ce\u4e3aInnoDB ALTER TABLE engine_test ENGINE = INNODB; -- \u67e5\u8be2engine_test\u8868\u7684\u5b58\u50a8\u5f15\u64ce SHOW TABLE STATUS FROM db11 WHERE NAME = ' engine_test ' ;","title":"\u4fee\u6539\u6570\u636e\u8868\u7684\u5b58\u50a8\u5f15\u64ce"},{"location":"MySQL/#02_3","text":"","title":"02\u7d22\u5f15"},{"location":"MySQL/#_102","text":"-- \u521b\u5efadb12\u6570\u636e\u5e93 CREATE DATABASE db12; -- \u4f7f\u7528db12\u6570\u636e\u5e93 USE db12; -- \u521b\u5efastudent\u8868 CREATE TABLE student( id INT PRIMARY KEY AUTO_INCREMENT, NAME VARCHAR(10), age INT, score INT ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO student VALUES (NULL,'\u5f20\u4e09',23,98),(NULL,'\u674e\u56db',24,95), (NULL,'\u738b\u4e94',25,96),(NULL,'\u8d75\u516d',26,94),(NULL,'\u5468\u4e03',27,99);","title":"\u7d22\u5f15\u6570\u636e\u51c6\u5907"},{"location":"MySQL/#_103","text":"","title":"\u521b\u5efa\u548c\u67e5\u8be2\u7d22\u5f15"},{"location":"MySQL/#_104","text":"/* \u521b\u5efa\u7d22\u5f15 \u6807\u51c6\u8bed\u6cd5 CREATE [UNIQUE|FULLTEXT] INDEX \u7d22\u5f15\u540d\u79f0 [USING \u7d22\u5f15\u7c7b\u578b] -- \u9ed8\u8ba4\u662fB+TREE ON \u8868\u540d(\u5217\u540d...); */ -- \u4e3astudent\u8868\u4e2d\u7684name\u5217\u521b\u5efa\u4e00\u4e2a\u666e\u901a\u7d22\u5f15 CREATE INDEX idx_name ON student(NAME); -- \u4e3astudent\u8868\u4e2d\u7684age\u5217\u521b\u5efa\u4e00\u4e2a\u552f\u4e00\u7d22\u5f15 CREATE UNIQUE INDEX idx_age ON student(age);","title":"\u521b\u5efa\u7d22\u5f15"},{"location":"MySQL/#_105","text":"/* \u67e5\u8be2\u7d22\u5f15 \u6807\u51c6\u8bed\u6cd5 SHOW INDEX FROM \u8868\u540d; */ -- \u67e5\u8be2student\u8868\u4e2d\u7684\u7d22\u5f15 SHOW INDEX FROM student ;","title":"\u67e5\u8be2\u7d22\u5f15"},{"location":"MySQL/#alter","text":"/* ALTER\u6dfb\u52a0\u7d22\u5f15 -- \u666e\u901a\u7d22\u5f15 ALTER TABLE \u8868\u540d ADD INDEX \u7d22\u5f15\u540d\u79f0(\u5217\u540d); -- \u7ec4\u5408\u7d22\u5f15 ALTER TABLE \u8868\u540d ADD INDEX \u7d22\u5f15\u540d\u79f0(\u5217\u540d1,\u5217\u540d2,...); -- \u4e3b\u952e\u7d22\u5f15 ALTER TABLE \u8868\u540d ADD PRIMARY KEY(\u4e3b\u952e\u5217\u540d); -- \u5916\u952e\u7d22\u5f15(\u6dfb\u52a0\u5916\u952e\u7ea6\u675f\uff0c\u5c31\u662f\u5916\u952e\u7d22\u5f15) ALTER TABLE \u8868\u540d ADD CONSTRAINT \u5916\u952e\u540d FOREIGN KEY (\u672c\u8868\u5916\u952e\u5217\u540d) REFERENCES \u4e3b\u8868\u540d(\u4e3b\u952e\u5217\u540d); -- \u552f\u4e00\u7d22\u5f15 ALTER TABLE \u8868\u540d ADD UNIQUE \u7d22\u5f15\u540d\u79f0(\u5217\u540d); -- \u5168\u6587\u7d22\u5f15 ALTER TABLE \u8868\u540d ADD FULLTEXT \u7d22\u5f15\u540d\u79f0(\u5217\u540d); */ -- \u4e3astudent\u8868\u4e2dname\u5217\u6dfb\u52a0\u5168\u6587\u7d22\u5f15 ALTER TABLE student ADD FULLTEXT idx_fulltext_name(NAME); -- \u67e5\u8be2student\u8868\u7684\u7d22\u5f15 SHOW INDEX FROM student ;","title":"ALTER\u6dfb\u52a0\u7d22\u5f15"},{"location":"MySQL/#_106","text":"/* \u5220\u9664\u7d22\u5f15 \u6807\u51c6\u8bed\u6cd5 DROP INDEX \u7d22\u5f15\u540d\u79f0 ON \u8868\u540d; */ -- \u5220\u9664idx_name\u7d22\u5f15 DROP INDEX idx_name ON student;","title":"\u5220\u9664\u7d22\u5f15"},{"location":"MySQL/#_107","text":"-- \u521b\u5efa product\u5546\u54c1\u8868 CREATE TABLE product ( id INT PRIMARY KEY AUTO_INCREMENT , -- \u5546\u54c1 id NAME VARCHAR ( 10 ), -- \u5546\u54c1\u540d\u79f0 price INT -- \u5546\u54c1\u4ef7\u683c ); -- \u5b9a\u4e49\u5b58\u50a8\u51fd\u6570\uff0c\u751f\u6210\u957f\u5ea6\u4e3a 10 \u7684\u968f\u673a\u5b57\u7b26\u4e32\u5e76\u8fd4\u56de DELIMITER $ CREATE FUNCTION rand_string () RETURNS VARCHAR ( 255 ) BEGIN DECLARE big_str VARCHAR ( 100 ) DEFAULT 'abcdefghijklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ' ; DECLARE small_str VARCHAR ( 255 ) DEFAULT '' ; DECLARE i INT DEFAULT 1 ; WHILE i <= 10 DO SET small_str = CONCAT ( small_str , SUBSTRING ( big_str , FLOOR ( 1 + RAND () * 52 ), 1 )); SET i = i + 1 ; END WHILE ; RETURN small_str ; END $ DELIMITER ; -- \u5b9a\u4e49\u5b58\u50a8\u8fc7\u7a0b\uff0c\u6dfb\u52a0 100 \u4e07\u6761\u6570\u636e\u5230 product\u8868\u4e2d DELIMITER $ CREATE PROCEDURE pro_test () BEGIN DECLARE num INT DEFAULT 1 ; WHILE num <= 1000000 DO INSERT INTO product VALUES ( NULL , rand_string (), num ); SET num = num + 1 ; END WHILE ; END $ DELIMITER ; -- \u8c03\u7528\u5b58\u50a8\u8fc7\u7a0b CALL pro_test (); -- \u67e5\u8be2\u603b\u8bb0\u5f55\u6761\u6570 SELECT COUNT ( * ) FROM product ; -- \u67e5\u8be2 product\u8868\u7684\u7d22\u5f15 SHOW INDEX FROM product ; -- \u67e5\u8be2 name\u4e3aOkIKDLVwtG\u7684\u6570\u636e ( 0.049 ) SELECT * FROM product WHERE NAME = 'OkIKDLVwtG' ; -- \u901a\u8fc7 id\u5217\u67e5\u8be2OkIKDLVwtG\u7684\u6570\u636e ( 1 \u6beb\u79d2 ) SELECT * FROM product WHERE id = 999998 ; -- \u4e3a name\u5217\u6dfb\u52a0\u7d22\u5f15 ALTER TABLE product ADD INDEX idx_name ( NAME ); -- \u67e5\u8be2 name\u4e3aOkIKDLVwtG\u7684\u6570\u636e ( 0.001 ) SELECT * FROM product WHERE NAME = 'OkIKDLVwtG' ; /* \u8303\u56f4\u67e5\u8be2 */ -- \u67e5\u8be2\u4ef7\u683c\u4e3a 800 ~ 1000 \u4e4b\u95f4\u7684\u6240\u6709\u6570\u636e ( 0.052 ) SELECT * FROM product WHERE price BETWEEN 800 AND 1000 ; /* \u6392\u5e8f\u67e5\u8be2 */ -- \u67e5\u8be2\u4ef7\u683c\u4e3a 800 ~ 1000 \u4e4b\u95f4\u7684\u6240\u6709\u6570\u636e , \u964d\u5e8f\u6392\u5217 ( 0.083 ) SELECT * FROM product WHERE price BETWEEN 800 AND 1000 ORDER BY price DESC ; -- \u4e3a price\u5217\u6dfb\u52a0\u7d22\u5f15 ALTER TABLE product ADD INDEX idx_price ( price ); -- \u67e5\u8be2\u4ef7\u683c\u4e3a 800 ~ 1000 \u4e4b\u95f4\u7684\u6240\u6709\u6570\u636e ( 0.011 ) SELECT * FROM product WHERE price BETWEEN 800 AND 1000 ; -- \u67e5\u8be2\u4ef7\u683c\u4e3a 800 ~ 1000 \u4e4b\u95f4\u7684\u6240\u6709\u6570\u636e , \u964d\u5e8f\u6392\u5217 ( 0.001 ) SELECT * FROM product WHERE price BETWEEN 800 AND 1000 ORDER BY price DESC ;","title":"\u7d22\u5f15\u7684\u6548\u7387\u6d4b\u8bd5"},{"location":"MySQL/#03_3","text":"","title":"03\u9501"},{"location":"MySQL/#innodb","text":"-- \u521b\u5efadb13\u6570\u636e\u5e93 CREATE DATABASE db13; -- \u4f7f\u7528db13\u6570\u636e\u5e93 USE db13; -- \u521b\u5efastudent\u8868 CREATE TABLE student( id INT PRIMARY KEY AUTO_INCREMENT, NAME VARCHAR(10), age INT, score INT ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO student VALUES (NULL,'\u5f20\u4e09',23,99),(NULL,'\u674e\u56db',24,95), (NULL,'\u738b\u4e94',25,98),(NULL,'\u8d75\u516d',26,97);","title":"InnoDB\u9501\u7684\u6570\u636e\u51c6\u5907"},{"location":"MySQL/#innodb_1","text":"-- \u7a97\u53e31 /* \u5171\u4eab\u9501\uff1a\u6570\u636e\u53ef\u4ee5\u88ab\u591a\u4e2a\u4e8b\u52a1\u67e5\u8be2\uff0c\u4f46\u662f\u4e0d\u80fd\u4fee\u6539 \u521b\u5efa\u9501\u7684\u683c\u5f0f SELECT\u8bed\u53e5 LOCK IN SHARE MODE; */ -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION; -- \u67e5\u8be2id\u4e3a1\u7684\u6570\u636e\u8bb0\u5f55\u3002\u5e76\u4e14\u52a0\u5165\u5171\u4eab\u9501 SELECT * FROM student WHERE id=1 LOCK IN SHARE MODE; -- \u67e5\u8be2\u5206\u6570\u4e3a99\u7684\u6570\u636e\u8bb0\u5f55\u3002\u5e76\u4e14\u52a0\u5165\u5171\u4eab\u9501 SELECT * FROM student WHERE score=99 LOCK IN SHARE MODE; -- \u63d0\u4ea4\u4e8b\u52a1 COMMIT;","title":"InnoDB\u5171\u4eab\u9501_\u7a97\u53e31"},{"location":"MySQL/#innodb_2","text":"-- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION; -- \u67e5\u8be2id\u4e3a1\u7684\u6570\u636e\u8bb0\u5f55\u3002(\u666e\u901a\u67e5\u8be2\u6ca1\u95ee\u9898) SELECT * FROM student WHERE id=1; -- \u67e5\u8be2id\u4e3a1\u7684\u6570\u636e\u8bb0\u5f55\u3002\u5e76\u4e14\u52a0\u5165\u5171\u4eab\u9501(\u5171\u4eab\u9501\u548c\u5171\u4eab\u9501\u662f\u517c\u5bb9\u7684) SELECT * FROM student WHERE id=1 LOCK IN SHARE MODE; -- \u4fee\u6539id\u4e3a1\u7684\u6570\u636e\u3002\u4fee\u6539\u59d3\u540d\u4e3a\u5f20\u4e09\u4e09(\u4fee\u6539\u5931\u8d25\uff0c\u4f1a\u51fa\u73b0\u9501\u7684\u60c5\u51b5\u3002\u53ea\u6709\u7a97\u53e31\u63d0\u4ea4\u4e8b\u52a1\u540e\uff0c\u624d\u80fd\u4fee\u6539\u6210\u529f) UPDATE student SET NAME='\u5f20\u4e09\u4e09' WHERE id=1; -- \u4fee\u6539id\u4e3a2\u7684\u6570\u636e\u3002\u4fee\u6539\u59d3\u540d\u4e3a\u674e\u56db\u56db(\u4fee\u6539\u6210\u529f\u3002InnoDB\u5f15\u64ce\u9ed8\u8ba4\u662f\u884c\u9501) UPDATE student SET NAME='\u674e\u56db\u56db' WHERE id=2; -- \u4fee\u6539id\u4e3a3\u7684\u6570\u636e\u3002\u4fee\u6539\u59d3\u540d\u4e3a\u738b\u4e94\u4e94(\u6ce8\u610f\uff1aInnoDB\u5f15\u64ce\u5982\u679c\u4e0d\u91c7\u7528\u5e26\u7d22\u5f15\u7684\u5217\uff0c\u5219\u4f1a\u63d0\u5347\u4e3a\u8868\u9501) UPDATE student SET NAME='\u738b\u4e94\u4e94' WHERE id=3; -- \u63d0\u4ea4\u4e8b\u52a1 COMMIT;","title":"InnoDB\u5171\u4eab\u9501_\u7a97\u53e32"},{"location":"MySQL/#innodb_3","text":"-- \u7a97\u53e3 1 /* \u6392\u4ed6\u9501\uff1a\u52a0\u9501\u7684\u6570\u636e\uff0c\u4e0d\u80fd\u88ab\u5176\u4ed6\u4e8b\u52a1\u52a0\u9501\u67e5\u8be2\u6216\u4fee\u6539 \u6392\u4ed6\u9501\u521b\u5efa\u683c\u5f0f SELECT\u8bed\u53e5 FOR UPDATE; */ -- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION ; -- \u67e5\u8be2 id \u4e3a 1 \u7684\u6570\u636e\u8bb0\u5f55\u3002\u5e76\u4e14\u52a0\u5165\u6392\u4ed6\u9501 SELECT * FROM student WHERE id = 1 FOR UPDATE ; -- \u63d0\u4ea4\u4e8b\u52a1 COMMIT ;","title":"InnoDB\u6392\u4ed6\u9501_\u7a97\u53e31"},{"location":"MySQL/#innodb_4","text":"-- \u5f00\u542f\u4e8b\u52a1 START TRANSACTION ; -- \u67e5\u8be2 id \u4e3a 1 \u7684\u6570\u636e\u8bb0\u5f55\u3002 ( \u666e\u901a\u67e5\u8be2\u6ca1\u95ee\u9898 ) SELECT * FROM student WHERE id = 1 ; -- \u67e5\u8be2 id \u4e3a 1 \u7684\u6570\u636e\u8bb0\u5f55\u3002\u5e76\u4e14\u52a0\u5165\u5171\u4eab\u9501 ( \u6392\u4ed6\u9501\u4e0d\u80fd\u548c\u5171\u4eab\u9501\u5171\u5b58 ) SELECT * FROM student WHERE id = 1 LOCK IN SHARE MODE ; -- \u67e5\u8be2 id \u4e3a 1 \u7684\u6570\u636e\u8bb0\u5f55\u3002\u5e76\u4e14\u52a0\u5165\u6392\u4ed6\u9501 ( \u6392\u4ed6\u9501\u548c\u6392\u4ed6\u9501\u4e0d\u80fd\u5171\u5b58 ) SELECT * FROM student WHERE id = 1 FOR UPDATE ; -- \u4fee\u6539 id \u4e3a 1 \u7684\u6570\u636e\u3002\u5c06\u59d3\u540d\u4fee\u6539\u4e3a\u5f20\u4e09\u4e09 ( \u4e0d\u80fd\u4fee\u6539\u3002\u4f1a\u51fa\u73b0\u9501\u7684\u60c5\u51b5\u3002\u53ea\u6709\u7a97\u53e3 1 \u63d0\u4ea4\u4e8b\u52a1\u540e\uff0c\u624d\u80fd\u4fee\u6539\u6210\u529f ) UPDATE student SET NAME = ' \u5f20\u4e09\u4e09 ' WHERE id = 1 ; -- \u63d0\u4ea4\u4e8b\u52a1 COMMIT ;","title":"InnoDB\u6392\u4ed6\u9501_\u7a97\u53e32"},{"location":"MySQL/#myisam","text":"-- \u521b\u5efaproduct\u8868 CREATE TABLE product( id INT PRIMARY KEY AUTO_INCREMENT, NAME VARCHAR(20), price INT )ENGINE = MYISAM; -- \u6307\u5b9a\u5b58\u50a8\u5f15\u64ce\u4e3aMyISAM -- \u6dfb\u52a0\u6570\u636e INSERT INTO product VALUES (NULL,'\u534e\u4e3a\u624b\u673a',4999),(NULL,'\u5c0f\u7c73\u624b\u673a',2999), (NULL,'\u82f9\u679c',8999),(NULL,'\u4e2d\u5174',1999);","title":"MYISAM\u9501\u7684\u6570\u636e\u51c6\u5907"},{"location":"MySQL/#myisam_1","text":"/* \u8bfb\u9501\uff1a\u6240\u6709\u8fde\u63a5\u53ea\u80fd\u8bfb\u53d6\u6570\u636e\uff0c\u4e0d\u80fd\u4fee\u6539 \u52a0\u9501 LOCK TABLE \u8868\u540d READ; \u89e3\u9501(\u5c06\u5f53\u524d\u4f1a\u8bdd\u6240\u6709\u7684\u8868\u8fdb\u884c\u89e3\u9501) UNLOCK TABLES; */ -- \u4e3aproduct\u8868\u6dfb\u52a0\u8bfb\u9501 LOCK TABLE product READ; -- \u67e5\u8be2product\u8868(\u67e5\u8be2\u6210\u529f) SELECT * FROM product; -- \u5c06id\u4e3a1\u7684\u4ef7\u683c\u4fee\u6539\u4e3a5999(\u4e0d\u80fd\u4fee\u6539) UPDATE product SET price=5999 WHERE id=1; -- \u89e3\u9501 UNLOCK TABLES;","title":"MYISAM\u8bfb\u9501_\u7a97\u53e31"},{"location":"MySQL/#myisam_2","text":"-- \u67e5\u8be2product\u8868(\u67e5\u8be2\u6210\u529f) SELECT * FROM product; -- \u5c06id\u4e3a1\u7684\u4ef7\u683c\u4fee\u6539\u4e3a5999(\u4e0d\u80fd\u4fee\u6539\u3002\u53ea\u6709\u7a97\u53e31\u89e3\u9501\u540e\u624d\u80fd\u4fee\u6539\u6210\u529f) UPDATE product SET price=5999 WHERE id=1;","title":"MYISAM\u8bfb\u9501_\u7a97\u53e32"},{"location":"MySQL/#myisam_3","text":"/* \u5199\u9501\uff1a\u5176\u4ed6\u8fde\u63a5\u4e0d\u80fd\u67e5\u8be2\u548c\u4fee\u6539\u6570\u636e \u52a0\u9501 LOCK TABLE \u8868\u540d WRITE; \u89e3\u9501(\u5c06\u5f53\u524d\u4f1a\u8bdd\u6240\u6709\u7684\u8868\u8fdb\u884c\u89e3\u9501) UNLOCK TABLES; */ -- \u4e3a product\u8868\u6dfb\u52a0\u5199\u9501 LOCK TABLE product WRITE ; -- \u67e5\u8be2 product\u8868 ( \u67e5\u8be2\u6210\u529f ) SELECT * FROM product ; -- \u4fee\u6539 id\u4e3a2\u7684\u4ef7\u683c\u4e3a3999 ( \u4fee\u6539\u6210\u529f ) UPDATE product SET price = 3999 WHERE id = 2 ; -- \u89e3\u9501 UNLOCK TABLES ;","title":"MYISAM\u5199\u9501_\u7a97\u53e31"},{"location":"MySQL/#myisam_4","text":"-- \u67e5\u8be2product\u8868\uff08\u67e5\u8be2\u5931\u8d25\u3002\u53ea\u6709\u7a97\u53e31\u89e3\u9501\u540e\uff0c\u624d\u80fd\u67e5\u8be2\u6210\u529f\uff09 SELECT * FROM product; -- \u4fee\u6539id\u4e3a2\u7684\u4ef7\u683c\u4e3a1999(\u4fee\u6539\u5931\u8d25\u3002\u53ea\u6709\u7a97\u53e31\u89e3\u9501\u540e\uff0c\u624d\u80fd\u4fee\u6539\u6210\u529f) UPDATE product SET price=1999 WHERE id=2;","title":"MYISAM\u5199\u9501_\u7a97\u53e32"},{"location":"MySQL/#_108","text":"-- \u521b\u5efacity\u8868 CREATE TABLE city( id INT PRIMARY KEY AUTO_INCREMENT, -- \u57ce\u5e02id NAME VARCHAR(20), -- \u57ce\u5e02\u540d\u79f0 VERSION INT -- \u7248\u672c\u53f7 ); -- \u6dfb\u52a0\u6570\u636e INSERT INTO city VALUES (NULL,'\u5317\u4eac',1),(NULL,'\u4e0a\u6d77',1),(NULL,'\u5e7f\u5dde',1),(NULL,'\u6df1\u5733',1); -- \u5c06\u5317\u4eac\u4fee\u6539\u4e3a\u5317\u4eac\u5e02 -- 1.\u5c06\u5317\u4eac\u7684\u7248\u672c\u53f7\u8bfb\u53d6\u51fa\u6765 SELECT VERSION FROM city WHERE NAME='\u5317\u4eac'; -- 1 -- 2.\u4fee\u6539\u5317\u4eac\u4e3a\u5317\u4eac\u5e02\uff0c\u7248\u672c\u53f7+1.\u5e76\u5bf9\u6bd4\u7248\u672c\u53f7\u662f\u5426\u76f8\u540c UPDATE city SET NAME='\u5317\u4eac\u5e02',VERSION=VERSION+1 WHERE NAME='\u5317\u4eac' AND VERSION=1;","title":"\u4e50\u89c2\u9501"},{"location":"MySQL/#04_2","text":"","title":"04\u4e3b\u4ece\u590d\u5236"},{"location":"MySQL/#__5","text":"-- \u4e3b\u670d\u52a1\u5668\u521b\u5efadb1\u6570\u636e\u5e93,\u4ece\u670d\u52a1\u5668\u4f1a\u81ea\u52a8\u540c\u6b65 CREATE DATABASE db1;","title":"\u4e3b\u4ece\u590d\u5236_\u4e3b\u670d\u52a1\u5668\u64cd\u4f5c"},{"location":"MySQL/#__6","text":"-- \u4ece\u670d\u52a1\u5668\u521b\u5efadb2\u6570\u636e\u5e93,\u4e3b\u670d\u52a1\u5668\u4e0d\u4f1a\u81ea\u52a8\u540c\u6b65 CREATE DATABASE db2;","title":"\u4e3b\u4ece\u590d\u5236_\u4ece\u670d\u52a1\u5668\u64cd\u4f5c"},{"location":"MySQL/#05","text":"","title":"05\u8bfb\u5199\u5206\u79bb"},{"location":"MySQL/#_mycat","text":"-- \u521b\u5efa\u5b66\u751f\u8868 CREATE TABLE student( id INT PRIMARY KEY AUTO_INCREMENT, NAME VARCHAR(10) ); -- \u67e5\u8be2\u5b66\u751f\u8868 SELECT * FROM student; -- \u6dfb\u52a0\u4e24\u6761\u8bb0\u5f55 INSERT INTO student VALUES (NULL,'\u5f20\u4e09'),(NULL,'\u674e\u56db'); -- \u505c\u6b62\u4e3b\u4ece\u590d\u5236\u540e\uff0c\u6dfb\u52a0\u7684\u6570\u636e\u53ea\u4f1a\u4fdd\u5b58\u5230\u4e3b\u670d\u52a1\u5668\u4e0a\u3002 INSERT INTO student VALUES (NULL,'\u738b\u4e94');","title":"\u8bfb\u5199\u5206\u79bb_mycat\u64cd\u4f5c"},{"location":"MySQL/#__7","text":"-- \u4e3b\u670d\u52a1\u5668\uff1a\u67e5\u8be2\u5b66\u751f\u8868\uff0c\u53ef\u4ee5\u770b\u5230\u6570\u636e SELECT * FROM student;","title":"\u8bfb\u5199\u5206\u79bb_\u4e3b\u670d\u52a1\u5668\u64cd\u4f5c"},{"location":"MySQL/#__8","text":"-- \u4ece\u670d\u52a1\u5668\uff1a\u67e5\u8be2\u5b66\u751f\u8868\uff0c\u53ef\u4ee5\u770b\u5230\u6570\u636e(\u56e0\u4e3a\u6709\u4e3b\u4ece\u590d\u5236) SELECT * FROM student; -- \u4ece\u670d\u52a1\u5668\uff1a\u5220\u9664\u4e00\u6761\u8bb0\u5f55\u3002(\u4e3b\u670d\u52a1\u5668\u5e76\u6ca1\u6709\u5220\u9664\uff0cmycat\u4e2d\u95f4\u4ef6\u67e5\u8be2\u7684\u7ed3\u679c\u662f\u4ece\u670d\u52a1\u5668\u7684\u6570\u636e) DELETE FROM student WHERE id=2;","title":"\u8bfb\u5199\u5206\u79bb_\u4ece\u670d\u52a1\u5668\u64cd\u4f5c"},{"location":"MySQL/#06","text":"","title":"06\u6c34\u5e73\u62c6\u5206"},{"location":"MySQL/#_mycat_1","text":"-- \u521b\u5efa product \u8868 CREATE TABLE product ( id INT PRIMARY KEY AUTO_INCREMENT , NAME VARCHAR ( 20 ) , price INT ) ; -- \u6dfb\u52a0 6 \u6761\u6570\u636e INSERT INTO product ( id , NAME , price ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' \u82f9\u679c\u624b\u673a ' , 6999 ) ; INSERT INTO product ( id , NAME , price ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' \u534e\u4e3a\u624b\u673a ' , 5999 ) ; INSERT INTO product ( id , NAME , price ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' \u4e09\u661f\u624b\u673a ' , 4999 ) ; INSERT INTO product ( id , NAME , price ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' \u5c0f\u7c73\u624b\u673a ' , 3999 ) ; INSERT INTO product ( id , NAME , price ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' \u4e2d\u5174\u624b\u673a ' , 2999 ) ; INSERT INTO product ( id , NAME , price ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' OOPO\u624b\u673a ' , 1999 ) ; -- \u67e5\u8be2 product \u8868 SELECT * FROM product ;","title":"\u6c34\u5e73\u62c6\u5206_mycat\u64cd\u4f5c"},{"location":"MySQL/#__9","text":"-- \u5728\u4e0d\u540c\u6570\u636e\u5e93\u4e2d\u67e5\u8be2product\u8868 SELECT * FROM product;","title":"\u6c34\u5e73\u62c6\u5206_\u4e3b\u670d\u52a1\u5668\u64cd\u4f5c"},{"location":"MySQL/#__10","text":"-- \u5728\u4e0d\u540c\u6570\u636e\u5e93\u4e2d\u67e5\u8be2product\u8868 SELECT * FROM product;","title":"\u6c34\u5e73\u62c6\u5206_\u4ece\u670d\u52a1\u5668\u64cd\u4f5c"},{"location":"MySQL/#07","text":"","title":"07\u5782\u76f4\u62c6\u5206"},{"location":"MySQL/#_mycat_2","text":"-- \u521b\u5efa dog \u8868 CREATE TABLE dog ( id INT PRIMARY KEY AUTO_INCREMENT , NAME VARCHAR ( 10 ) ) ; -- \u6dfb\u52a0\u6570\u636e INSERT INTO dog ( id , NAME ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' \u54c8\u58eb\u5947 ' ) ; -- \u67e5\u8be2 dog \u8868 SELECT * FROM dog ; -- \u521b\u5efa cat \u8868 CREATE TABLE cat ( id INT PRIMARY KEY AUTO_INCREMENT , NAME VARCHAR ( 10 ) ) ; -- \u6dfb\u52a0\u6570\u636e INSERT INTO cat ( id , NAME ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' \u6ce2\u65af\u732b ' ) ; -- \u67e5\u8be2 cat \u8868 SELECT * FROM cat ; -- \u521b\u5efa apple \u8868 CREATE TABLE apple ( id INT PRIMARY KEY AUTO_INCREMENT , NAME VARCHAR ( 10 ) ) ; -- \u6dfb\u52a0\u6570\u636e INSERT INTO apple ( id , NAME ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' \u7ea2\u5bcc\u58eb ' ) ; -- \u67e5\u8be2 apple \u8868 SELECT * FROM apple ; -- \u521b\u5efa banana \u8868 CREATE TABLE banana ( id INT PRIMARY KEY AUTO_INCREMENT , NAME VARCHAR ( 10 ) ) ; -- \u6dfb\u52a0\u6570\u636e INSERT INTO banana ( id , NAME ) VALUES ( NEXT VALUE FOR MYCATSEQ_GLOBAL , ' \u9999\u8549 ' ) ; -- \u67e5\u8be2 banana \u8868 SELECT * FROM banana ;","title":"\u5782\u76f4\u62c6\u5206_mycat\u64cd\u4f5c"},{"location":"MySQL/#__11","text":"-- \u67e5\u8be2dog\u8868 SELECT * FROM dog; -- \u67e5\u8be2cat\u8868 SELECT * FROM cat; -- \u67e5\u8be2apple\u8868 SELECT * FROM apple; -- \u67e5\u8be2banana\u8868 SELECT * FROM banana;","title":"\u5782\u76f4\u62c6\u5206_\u4e3b\u670d\u52a1\u5668\u64cd\u4f5c"},{"location":"MySQL/#__12","text":"-- \u67e5\u8be2dog\u8868 SELECT * FROM dog; -- \u67e5\u8be2cat\u8868 SELECT * FROM cat; -- \u67e5\u8be2apple\u8868 SELECT * FROM apple; -- \u67e5\u8be2banana\u8868 SELECT * FROM banana;","title":"\u5782\u76f4\u62c6\u5206_\u4ece\u670d\u52a1\u5668\u64cd\u4f5c"},{"location":"license/","text":"License \u00b6 MIT License The graduate cap icon made by Freepik from www.flaticon.com is licensed by CC 3.0 BY Support Author \u00b6 Amazon wish list","title":"License"},{"location":"license/#license","text":"MIT License The graduate cap icon made by Freepik from www.flaticon.com is licensed by CC 3.0 BY","title":"License"},{"location":"license/#support_author","text":"Amazon wish list","title":"Support Author"},{"location":"MongoDB/MongoDB/","text":"3\u3001MongoDB\u5feb\u901f\u5165\u95e8 \u00b6 3.1\u3001MongoDB\u7b80\u4ecb \u00b6 MongoDB\u662f\u4e00\u4e2a\u57fa\u4e8e\u5206\u5e03\u5f0f\u6587\u4ef6\u5b58\u50a8\u7684\u6570\u636e\u5e93\u3002\u7531C++\u8bed\u8a00\u7f16\u5199\u3002\u65e8\u5728\u4e3aWEB\u5e94\u7528\u63d0\u4f9b\u53ef\u6269\u5c55\u7684\u9ad8\u6027\u80fd\u6570\u636e\u5b58\u50a8\u89e3\u51b3\u65b9\u6848\u3002 MongoDB\u662f\u4e00\u4e2a\u4ecb\u4e8e\u5173\u7cfb\u6570\u636e\u5e93\u548c\u975e\u5173\u7cfb\u6570\u636e\u5e93\u4e4b\u95f4\u7684\u4ea7\u54c1\uff0c\u662f\u975e\u5173\u7cfb\u6570\u636e\u5e93\u5f53\u4e2d\u529f\u80fd\u6700\u4e30\u5bcc\uff0c\u6700\u50cf\u5173\u7cfb\u6570\u636e\u5e93\u7684\uff0c\u5b83\u652f\u6301\u7684\u6570\u636e\u7ed3\u6784\u975e\u5e38\u677e\u6563\uff0c\u662f\u7c7b\u4f3cjson\u7684bson\u683c\u5f0f\uff0c\u56e0\u6b64\u53ef\u4ee5\u5b58\u50a8\u6bd4\u8f83\u590d\u6742\u7684\u6570\u636e\u7c7b\u578b\u3002 MongoDB\u6700\u5927\u7684\u7279\u70b9\u662f\u5b83\u652f\u6301\u7684\u67e5\u8be2\u8bed\u8a00\u975e\u5e38\u5f3a\u5927\uff0c\u5176\u8bed\u6cd5\u6709\u70b9\u7c7b\u4f3c\u4e8e\u9762\u5411\u5bf9\u8c61\u7684\u67e5\u8be2\u8bed\u8a00\uff0c\u51e0\u4e4e\u53ef\u4ee5\u5b9e\u73b0\u7c7b\u4f3c\u5173\u7cfb\u6570\u636e\u5e93\u5355\u8868\u67e5\u8be2\u7684\u7edd\u5927\u90e8\u5206\u529f\u80fd\uff0c\u800c\u4e14\u8fd8\u652f\u6301\u5bf9\u6570\u636e\u5efa\u7acb\u7d22\u5f15\u3002 \u5b98\u7f51\uff1ahttps://www.mongodb.com 3.2\u3001\u901a\u8fc7docker\u5b89\u88c5MongoDB \u00b6 #\u62c9\u53d6\u955c\u50cf docker pull mongo:4.0.3 #\u521b\u5efa\u5bb9\u5668 docker create --name mongodb-server -p 27018 :27017 -v mongodb-data:/data/db mongo:4.0.3 --auth #\u542f\u52a8\u5bb9\u5668 docker start mongodb-server #\u8fdb\u5165\u5bb9\u5668 docker exec -it mongodb-server /bin/bash #\u8fdb\u5165admin\u6570\u636e\u5e93 mongo use admin #\u6dfb\u52a0\u7ba1\u7406\u5458\uff0c\u5176\u62e5\u6709\u7ba1\u7406\u7528\u6237\u548c\u89d2\u8272\u7684\u6743\u9650 db.createUser ({ user: 'root' , pwd: 'root' , roles: [ { role: \"root\" , db: \"admin\" } ] }) #\u6d4b\u8bd5\uff0c\u53d1\u73b0\u662f\u6ca1\u6709\u6743\u9650\u64cd\u4f5c\u7684 > show dbs 2020 -10-20T09:09:15.543+0000 E QUERY [ js ] Error: listDatabases failed: { \"ok\" : 0 , \"errmsg\" : \"command listDatabases requires authentication\" , \"code\" : 13 , \"codeName\" : \"Unauthorized\" } : #\u8fdb\u884c\u8ba4\u8bc1 mongo -u \"root\" -p \"root\" --authenticationDatabase \"admin\" #\u901a\u8fc7admin\u6dfb\u52a0\u666e\u901a\u7528\u6237 use admin db.createUser ({ user: 'tanhua' , pwd: 'l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV' , roles: [ { role: \"readWrite\" , db: \"tanhua\" } ] }) ; #\u901a\u8fc7tanhua\u7528\u6237\u767b\u5f55\u8fdb\u884c\u6d4b\u8bd5 mongo -u \"tanhua\" -p \"l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV\" --authenticationDatabase \"admin\" #\u6d4b\u8bd5 root@5d848955ff7e:/# mongo -u \"tanhua\" -p \"tanhua123\" --authenticationDatabase \"admin\" MongoDB shell version v4.0.3 connecting to: mongodb://127.0.0.1:27017 Implicit session: session { \"id\" : UUID ( \"6c368269-30f0-4b29-a224-05a38b5847e2\" ) } MongoDB server version: 4 .0.3 > use tanhua switched to db tanhua > db.user.insert ({ id:1,username: 'zhangsan' ,age:20 }) WriteResult ({ \"nInserted\" : 1 }) > db.user.find () { \"_id\" : ObjectId ( \"5f8eb2726e0de0aa9517afd3\" ) , \"id\" : 1 , \"username\" : \"zhangsan\" , \"age\" : 20 } 3.3\u3001MongoDB\u57fa\u672c\u64cd\u4f5c \u00b6 3.3.1\u3001\u57fa\u672c\u6982\u5ff5 \u00b6 \u4e3a\u4e86\u66f4\u597d\u7684\u7406\u89e3\uff0c\u4e0b\u9762\u4e0eSQL\u4e2d\u7684\u6982\u5ff5\u8fdb\u884c\u5bf9\u6bd4\uff1a SQL\u672f\u8bed/\u6982\u5ff5 MongoDB\u672f\u8bed/\u6982\u5ff5 \u89e3\u91ca/\u8bf4\u660e database database \u6570\u636e\u5e93 table collection \u6570\u636e\u5e93\u8868/\u96c6\u5408 row document \u6570\u636e\u8bb0\u5f55\u884c/\u6587\u6863 column field \u6570\u636e\u5b57\u6bb5/\u57df index index \u7d22\u5f15 table joins \u8868\u8fde\u63a5,MongoDB\u4e0d\u652f\u6301 primary key primary key \u4e3b\u952e,MongoDB\u81ea\u52a8\u5c06_id\u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u4e3b\u952e 3.3.2\u3001\u6570\u636e\u5e93\u4ee5\u53ca\u8868\u7684\u64cd\u4f5c \u00b6 #\u67e5\u770b\u6240\u6709\u7684\u6570\u636e\u5e93 > show dbs admin 0 .000GB config 0 .000GB local 0 .000GB #\u901a\u8fc7use\u5173\u952e\u5b57\u5207\u6362\u6570\u636e\u5e93 > use admin switched to db admin #\u521b\u5efa\u6570\u636e\u5e93 #\u8bf4\u660e\uff1a\u5728MongoDB\u4e2d\uff0c\u6570\u636e\u5e93\u662f\u81ea\u52a8\u521b\u5efa\u7684\uff0c\u901a\u8fc7use\u5207\u6362\u5230\u65b0\u6570\u636e\u5e93\u4e2d\uff0c\u8fdb\u884c\u63d2\u5165\u6570\u636e\u5373\u53ef\u81ea\u52a8\u521b\u5efa\u6570\u636e\u5e93 > use testdb switched to db testdb > show dbs #\u5e76\u6ca1\u6709\u521b\u5efa\u6570\u636e\u5e93 admin 0 .000GB config 0 .000GB local 0 .000GB > db.user.insert ({ id:1,name: 'zhangsan' }) #\u63d2\u5165\u6570\u636e WriteResult ({ \"nInserted\" : 1 }) > show dbs admin 0 .000GB config 0 .000GB local 0 .000GB testdb 0 .000GB #\u6570\u636e\u5e93\u81ea\u52a8\u521b\u5efa #\u67e5\u770b\u8868 > show tables user > show collections user > #\u5220\u9664\u96c6\u5408\uff08\u8868\uff09 > db.user.drop () true #\u5982\u679c\u6210\u529f\u5220\u9664\u9009\u5b9a\u96c6\u5408\uff0c\u5219 drop() \u65b9\u6cd5\u8fd4\u56de true\uff0c\u5426\u5219\u8fd4\u56de false\u3002 #\u5220\u9664\u6570\u636e\u5e93 > use testdb #\u5148\u5207\u6362\u5230\u8981\u5220\u9664\u7684\u6570\u636e\u5e93\u4e2d switched to db testdb > db.dropDatabase () #\u5220\u9664\u6570\u636e\u5e93 { \"dropped\" : \"testdb\" , \"ok\" : 1 } > show dbs admin 0 .000GB config 0 .000GB local 0 .000GB 3.3.3\u3001\u65b0\u589e\u6570\u636e \u00b6 \u5728MongoDB\u4e2d\uff0c\u5b58\u50a8\u7684\u6587\u6863\u7ed3\u6784\u662f\u4e00\u79cd\u7c7b\u4f3c\u4e8ejson\u7684\u7ed3\u6784\uff0c\u79f0\u4e4b\u4e3abson\uff08\u5168\u79f0\u4e3a\uff1aBinary JSON\uff09\u3002 #\u63d2\u5165\u6570\u636e #\u8bed\u6cd5\uff1adb.COLLECTION_NAME.insert(document) > db.user.insert ({ id:1,username: 'zhangsan' ,age:20 }) WriteResult ({ \"nInserted\" : 1 }) > db.user.save ({ id:2,username: 'lisi' ,age:25 }) WriteResult ({ \"nInserted\" : 1 }) > db.user.find () #\u67e5\u8be2\u6570\u636e { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"id\" : 1 , \"username\" : \"zhangsan\" , \"age\" : 20 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 } 3.3.4\u3001\u66f4\u65b0\u6570\u636e \u00b6 update() \u65b9\u6cd5\u7528\u4e8e\u66f4\u65b0\u5df2\u5b58\u5728\u7684\u6587\u6863\u3002\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a db.collection.update ( <query>, <update>, [ upsert: <boolean>, multi: <boolean>, writeConcern: <document> ] ) \u53c2\u6570\u8bf4\u660e\uff1a query : update\u7684\u67e5\u8be2\u6761\u4ef6\uff0c\u7c7b\u4f3csql update\u67e5\u8be2\u5185where\u540e\u9762\u7684\u3002 update : update\u7684\u5bf9\u8c61\u548c\u4e00\u4e9b\u66f4\u65b0\u7684\u64cd\u4f5c\u7b26\uff08\u5982 , inc...\uff09\u7b49\uff0c\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3asql update\u67e5\u8be2\u5185set\u540e\u9762\u7684 upsert : \u53ef\u9009\uff0c\u8fd9\u4e2a\u53c2\u6570\u7684\u610f\u601d\u662f\uff0c\u5982\u679c\u4e0d\u5b58\u5728update\u7684\u8bb0\u5f55\uff0c\u662f\u5426\u63d2\u5165objNew,true\u4e3a\u63d2\u5165\uff0c\u9ed8\u8ba4\u662ffalse\uff0c\u4e0d\u63d2\u5165\u3002 multi : \u53ef\u9009\uff0cmongodb \u9ed8\u8ba4\u662ffalse,\u53ea\u66f4\u65b0\u627e\u5230\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u5982\u679c\u8fd9\u4e2a\u53c2\u6570\u4e3atrue,\u5c31\u628a\u6309\u6761\u4ef6\u67e5\u51fa\u6765\u591a\u6761\u8bb0\u5f55\u5168\u90e8\u66f4\u65b0\u3002 writeConcern :\u53ef\u9009\uff0c\u629b\u51fa\u5f02\u5e38\u7684\u7ea7\u522b\u3002 > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"id\" : 1 , \"username\" : \"zhangsan\" , \"age\" : 20 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 } > db.user.update ({ id:1 } , { $set : { age:22 }}) #\u66f4\u65b0\u6570\u636e WriteResult ({ \"nMatched\" : 1 , \"nUpserted\" : 0 , \"nModified\" : 1 }) > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"id\" : 1 , \"username\" : \"zhangsan\" , \"age\" : 22 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 } #\u6ce8\u610f\uff1a\u5982\u679c\u8fd9\u6837\u5199\uff0c\u4f1a\u5220\u9664\u6389\u5176\u4ed6\u7684\u5b57\u6bb5 > db.user.update ({ id:1 } , { age:25 }) WriteResult ({ \"nMatched\" : 1 , \"nUpserted\" : 0 , \"nModified\" : 1 }) > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"age\" : 25 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 } #\u66f4\u65b0\u4e0d\u5b58\u5728\u7684\u5b57\u6bb5\uff0c\u4f1a\u65b0\u589e\u5b57\u6bb5 > db.user.update ({ id:2 } , { $set : { sex:1 }}) #\u66f4\u65b0\u6570\u636e > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"age\" : 25 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 , \"sex\" : 1 } #\u66f4\u65b0\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u9ed8\u8ba4\u4e0d\u4f1a\u65b0\u589e\u6570\u636e > db.user.update ({ id:3 } , { $set : { sex:1 }}) WriteResult ({ \"nMatched\" : 0 , \"nUpserted\" : 0 , \"nModified\" : 0 }) > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"age\" : 25 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 , \"sex\" : 1 } #\u5982\u679c\u8bbe\u7f6e\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3atrue\uff0c\u5c31\u662f\u65b0\u589e\u6570\u636e > db.user.update ({ id:3 } , { $set : { sex:1 }} ,true ) WriteResult ({ \"nMatched\" : 0 , \"nUpserted\" : 1 , \"nModified\" : 0 , \"_id\" : ObjectId ( \"5c08cb281418d073246bc642\" ) }) > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"age\" : 25 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 , \"sex\" : 1 } { \"_id\" : ObjectId ( \"5c08cb281418d073246bc642\" ) , \"id\" : 3 , \"sex\" : 1 } 3.3.5\u3001\u5220\u9664\u6570\u636e \u00b6 \u901a\u8fc7remove()\u65b9\u6cd5\u8fdb\u884c\u5220\u9664\u6570\u636e\uff0c\u8bed\u6cd5\u5982\u4e0b\uff1a db.collection.remove ( <query>, { justOne: <boolean>, writeConcern: <document> } ) \u53c2\u6570\u8bf4\u660e\uff1a query :\uff08\u53ef\u9009\uff09\u5220\u9664\u7684\u6587\u6863\u7684\u6761\u4ef6\u3002 justOne : \uff08\u53ef\u9009\uff09\u5982\u679c\u8bbe\u4e3a true \u6216 1\uff0c\u5219\u53ea\u5220\u9664\u4e00\u4e2a\u6587\u6863\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\u8be5\u53c2\u6570\uff0c\u6216\u4f7f\u7528\u9ed8\u8ba4\u503c false\uff0c\u5219\u5220\u9664\u6240\u6709\u5339\u914d\u6761\u4ef6\u7684\u6587\u6863\u3002 writeConcern :\uff08\u53ef\u9009\uff09\u629b\u51fa\u5f02\u5e38\u7684\u7ea7\u522b\u3002 \u5b9e\u4f8b\uff1a > db.user.remove ({ age:25 }) WriteResult ({ \"nRemoved\" : 2 }) #\u5220\u9664\u4e862\u6761\u6570\u636e #\u63d2\u51654\u6761\u6d4b\u8bd5\u6570\u636e db.user.insert ({ id:1,username: 'zhangsan' ,age:20 }) db.user.insert ({ id:2,username: 'lisi' ,age:21 }) db.user.insert ({ id:3,username: 'wangwu' ,age:22 }) db.user.insert ({ id:4,username: 'zhaoliu' ,age:22 }) > db.user.remove ({ age:22 } ,true ) WriteResult ({ \"nRemoved\" : 1 }) #\u5220\u9664\u4e861\u6761\u6570\u636e #\u5220\u9664\u6240\u6709\u6570\u636e > db.user.remove ({}) #\u8bf4\u660e\uff1a\u4e3a\u4e86\u7b80\u5316\u64cd\u4f5c\uff0c\u5b98\u65b9\u63a8\u8350\u4f7f\u7528deleteOne()\u4e0edeleteMany()\u8fdb\u884c\u5220\u9664\u6570\u636e\u64cd\u4f5c\u3002 db.user.deleteOne ({ id:1 }) db.user.deleteMany ({}) #\u5220\u9664\u6240\u6709\u6570\u636e 3.3.6\u3001\u67e5\u8be2\u6570\u636e \u00b6 MongoDB \u67e5\u8be2\u6570\u636e\u7684\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a db . user . find ( [ query ] , [ fields ] ) query \uff1a\u53ef\u9009\uff0c\u4f7f\u7528\u67e5\u8be2\u64cd\u4f5c\u7b26\u6307\u5b9a\u67e5\u8be2\u6761\u4ef6 fields \uff1a\u53ef\u9009\uff0c\u4f7f\u7528\u6295\u5f71\u64cd\u4f5c\u7b26\u6307\u5b9a\u8fd4\u56de\u7684\u952e\u3002\u67e5\u8be2\u65f6\u8fd4\u56de\u6587\u6863\u4e2d\u6240\u6709\u952e\u503c\uff0c \u53ea\u9700\u7701\u7565\u8be5\u53c2\u6570\u5373\u53ef\uff08\u9ed8\u8ba4\u7701\u7565\uff09\u3002 \u5982\u679c\u4f60\u9700\u8981\u4ee5\u6613\u8bfb\u7684\u65b9\u5f0f\u6765\u8bfb\u53d6\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528 pretty() \u65b9\u6cd5\uff0c\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a >db.col.find().pretty() pretty() \u65b9\u6cd5\u4ee5\u683c\u5f0f\u5316\u7684\u65b9\u5f0f\u6765\u663e\u793a\u6240\u6709\u6587\u6863\u3002 \u6761\u4ef6\u67e5\u8be2\uff1a \u64cd\u4f5c \u683c\u5f0f \u8303\u4f8b RDBMS\u4e2d\u7684\u7c7b\u4f3c\u8bed\u53e5 \u7b49\u4e8e {<key>:<value> } db.col.find({\"by\":\"\u9ed1\u9a6c\u7a0b\u5e8f\u5458\"}).pretty() where by = '\u9ed1\u9a6c\u7a0b\u5e8f\u5458' \u5c0f\u4e8e {<key>:{$lt:<value>}} db.col.find({\"likes\":{$lt:50}}).pretty() where likes < 50 \u5c0f\u4e8e\u6216\u7b49\u4e8e {<key>:{$lte:<value>}} db.col.find({\"likes\":{$lte:50}}).pretty() where likes <= 50 \u5927\u4e8e {<key>:{$gt:<value>}} db.col.find({\"likes\":{$gt:50}}).pretty() where likes > 50 \u5927\u4e8e\u6216\u7b49\u4e8e {<key>:{$gte:<value>}} db.col.find({\"likes\":{$gte:50}}).pretty() where likes >= 50 \u4e0d\u7b49\u4e8e {<key>:{$ne:<value>}} db.col.find({\"likes\":{$ne:50}}).pretty() where likes != 50 \u5b9e\u4f8b\uff1a #\u63d2\u5165\u6d4b\u8bd5\u6570\u636e db.user.insert ({ id:1,username: 'zhangsan' ,age:20 }) db.user.insert ({ id:2,username: 'lisi' ,age:21 }) db.user.insert ({ id:3,username: 'wangwu' ,age:22 }) db.user.insert ({ id:4,username: 'zhaoliu' ,age:22 }) db.user.find () #\u67e5\u8be2\u5168\u90e8\u6570\u636e db.user.find ({} , { id:1,username:1 }) #\u53ea\u67e5\u8be2id\u4e0eusername\u5b57\u6bb5 db.user.find () .count () #\u67e5\u8be2\u6570\u636e\u6761\u6570 db.user.find ({ id:1 }) #\u67e5\u8be2id\u4e3a1\u7684\u6570\u636e db.user.find ({ age: { $lte :21 }}) #\u67e5\u8be2\u5c0f\u4e8e\u7b49\u4e8e21\u7684\u6570\u636e db.user.find ({ age: { $lte :21 } , id: { $gte :2 }}) #and\u67e5\u8be2\uff0cage\u5c0f\u4e8e\u7b49\u4e8e21\u5e76\u4e14id\u5927\u4e8e\u7b49\u4e8e2 db.user.find ({ $or : [{ id:1 } , { id:2 }]}) #\u67e5\u8be2id=1 or id=2 #\u5206\u9875\u67e5\u8be2\uff1aSkip()\u8df3\u8fc7\u51e0\u6761\uff0climit()\u67e5\u8be2\u6761\u6570 db.user.find () .limit ( 2 ) .skip ( 1 ) #\u8df3\u8fc71\u6761\u6570\u636e\uff0c\u67e5\u8be22\u6761\u6570\u636e db.user.find () .sort ({ id:-1 }) #\u6309\u7167age\u5012\u5e8f\u6392\u5e8f\uff0c-1\u4e3a\u5012\u5e8f\uff0c1\u4e3a\u6b63\u5e8f 3.4\u3001\u7d22\u5f15 \u00b6 \u7d22\u5f15\u901a\u5e38\u80fd\u591f\u6781\u5927\u7684\u63d0\u9ad8\u67e5\u8be2\u7684\u6548\u7387\uff0c\u5982\u679c\u6ca1\u6709\u7d22\u5f15\uff0cMongoDB\u5728\u8bfb\u53d6\u6570\u636e\u65f6\u5fc5\u987b\u626b\u63cf\u96c6\u5408\u4e2d\u7684\u6bcf\u4e2a\u6587\u4ef6\u5e76\u9009\u53d6\u90a3\u4e9b\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\u3002 \u8fd9\u79cd\u626b\u63cf\u5168\u96c6\u5408\u7684\u67e5\u8be2\u6548\u7387\u662f\u975e\u5e38\u4f4e\u7684\uff0c\u7279\u522b\u5728\u5904\u7406\u5927\u91cf\u7684\u6570\u636e\u65f6\uff0c\u67e5\u8be2\u53ef\u4ee5\u8981\u82b1\u8d39\u51e0\u5341\u79d2\u751a\u81f3\u51e0\u5206\u949f\uff0c\u8fd9\u5bf9\u7f51\u7ad9\u7684\u6027\u80fd\u662f\u975e\u5e38\u81f4\u547d\u7684\u3002 \u7d22\u5f15\u662f\u7279\u6b8a\u7684\u6570\u636e\u7ed3\u6784\uff0c\u7d22\u5f15\u5b58\u50a8\u5728\u4e00\u4e2a\u6613\u4e8e\u904d\u5386\u8bfb\u53d6\u7684\u6570\u636e\u96c6\u5408\u4e2d\uff0c\u7d22\u5f15\u662f\u5bf9\u6570\u636e\u5e93\u8868\u4e2d\u4e00\u5217\u6216\u591a\u5217\u7684\u503c\u8fdb\u884c\u6392\u5e8f\u7684\u4e00\u79cd\u7ed3\u6784 #\u67e5\u770b\u7d22\u5f15 > db.user.getIndexes () [ { \"v\" : 2 , \"key\" : { \"_id\" : 1 } , \"name\" : \"_id_\" , \"ns\" : \"testdb.user\" } ] #\u8bf4\u660e\uff1a1\u8868\u793a\u5347\u5e8f\u521b\u5efa\u7d22\u5f15\uff0c-1\u8868\u793a\u964d\u5e8f\u521b\u5efa\u7d22\u5f15\u3002 #\u521b\u5efa\u7d22\u5f15 > db.user.createIndex ({ 'age' :1 }) { \"createdCollectionAutomatically\" : false, \"numIndexesBefore\" : 1 , \"numIndexesAfter\" : 2 , \"ok\" : 1 } #\u5220\u9664\u7d22\u5f15 db.user.dropIndex ( \"age_1\" ) #\u6216\u8005\uff0c\u5220\u9664\u9664\u4e86_id\u4e4b\u5916\u7684\u7d22\u5f15 db.user.dropIndexes () #\u521b\u5efa\u8054\u5408\u7d22\u5f15 db.user.createIndex ({ 'age' :1, 'id' :-1 }) #\u67e5\u770b\u7d22\u5f15\u5927\u5c0f\uff0c\u5355\u4f4d\uff1a\u5b57\u8282 db.user.totalIndexSize () 3.5\u3001\u6267\u884c\u8ba1\u5212 \u00b6 MongoDB \u67e5\u8be2\u5206\u6790\u53ef\u4ee5\u786e\u4fdd\u6211\u4eec\u5efa\u8bae\u7684\u7d22\u5f15\u662f\u5426\u6709\u6548\uff0c\u662f\u67e5\u8be2\u8bed\u53e5\u6027\u80fd\u5206\u6790\u7684\u91cd\u8981\u5de5\u5177\u3002 #\u63d2\u51651000\u6761\u6570\u636e for ( var i = 1 ; i< 1000 ; i++ ) db.user.insert ({ id:100+i,username: 'name_' +i,age:10+i }) #\u67e5\u770b\u6267\u884c\u8ba1\u5212 > db.user.find ({ age: { $gt :100 } ,id: { $lt :200 }}) .explain () { \"queryPlanner\" : { \"plannerVersion\" : 1 , \"namespace\" : \"testdb.user\" , \"indexFilterSet\" : false, \"parsedQuery\" : { \" $and \" : [ { \"id\" : { \" $lt \" : 200 } } , { \"age\" : { \" $gt \" : 100 } } ] } , \"winningPlan\" : { #\u6700\u4f73\u6267\u884c\u8ba1\u5212 \"stage\" : \"FETCH\" , #\u67e5\u8be2\u65b9\u5f0f\uff0c\u5e38\u89c1\u7684\u6709COLLSCAN/\u5168\u8868\u626b\u63cf\u3001IXSCAN/\u7d22\u5f15\u626b\u63cf\u3001FETCH/\u6839\u636e\u7d22\u5f15\u53bb\u68c0\u7d22\u6587\u6863\u3001SHARD_MERGE/\u5408\u5e76\u5206\u7247\u7ed3\u679c\u3001IDHACK/\u9488\u5bf9_id\u8fdb\u884c\u67e5\u8be2 \"inputStage\" : { \"stage\" : \"IXSCAN\" , \"keyPattern\" : { \"age\" : 1 , \"id\" : -1 } , \"indexName\" : \"age_1_id_-1\" , \"isMultiKey\" : false, \"multiKeyPaths\" : { \"age\" : [ ] , \"id\" : [ ] } , \"isUnique\" : false, \"isSparse\" : false, \"isPartial\" : false, \"indexVersion\" : 2 , \"direction\" : \"forward\" , \"indexBounds\" : { \"age\" : [ \"(100.0, inf.0]\" ] , \"id\" : [ \"(200.0, -inf.0]\" ] } } } , \"rejectedPlans\" : [ ] } , \"serverInfo\" : { \"host\" : \"c493d5ff750a\" , \"port\" : 27017 , \"version\" : \"4.0.3\" , \"gitVersion\" : \"7ea530946fa7880364d88c8d8b6026bbc9ffa48c\" } , \"ok\" : 1 } #\u6d4b\u8bd5\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15 > db.user.find ({ username: 'zhangsan' }) .explain () { \"queryPlanner\" : { \"plannerVersion\" : 1 , \"namespace\" : \"testdb.user\" , \"indexFilterSet\" : false, \"parsedQuery\" : { \"username\" : { \" $eq \" : \"zhangsan\" } } , \"winningPlan\" : { \"stage\" : \"COLLSCAN\" , #\u5168\u8868\u626b\u63cf \"filter\" : { \"username\" : { \" $eq \" : \"zhangsan\" } } , \"direction\" : \"forward\" } , \"rejectedPlans\" : [ ] } , \"serverInfo\" : { \"host\" : \"c493d5ff750a\" , \"port\" : 27017 , \"version\" : \"4.0.3\" , \"gitVersion\" : \"7ea530946fa7880364d88c8d8b6026bbc9ffa48c\" } , \"ok\" : 1 } 3.6\u3001UI\u5ba2\u6237\u7aef\u5de5\u5177 \u00b6 Robo 3T\u662fMongoDB\u7684\u5ba2\u6237\u7aef\u5de5\u5177\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u64cd\u4f5cMongoDB\u3002 \u67e5\u770b\u6570\u636e\uff1a \u6216\u4f7f\u7528Navicat Premium 15\uff1a 4\u3001SpringBoot\u6574\u5408MongoDB \u00b6 spring-data\u5bf9MongoDB\u505a\u4e86\u652f\u6301\uff0c\u4f7f\u7528spring-data-mongodb\u53ef\u4ee5\u7b80\u5316MongoDB\u7684\u64cd\u4f5c\u3002 \u5730\u5740\uff1ahttps://spring.io/projects/spring-data-mongodb 4.1\u3001\u5bfc\u5165\u4f9d\u8d56 \u00b6 <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <modelVersion> 4.0.0 </modelVersion> <parent> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-parent </artifactId> <version> 2.1.0.RELEASE </version> </parent> <groupId> cn.itcast.mongodb </groupId> <artifactId> itcast-mongodb </artifactId> <version> 1.0-SNAPSHOT </version> <dependencies> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-mongodb </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-test </artifactId> <scope> test </scope> </dependency> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> <optional> true </optional> <version> 1.18.4 </version> </dependency> </dependencies> <build> <plugins> <!-- java\u7f16\u8bd1\u63d2\u4ef6 --> <plugin> <groupId> org.apache.maven.plugins </groupId> <artifactId> maven-compiler-plugin </artifactId> <version> 3.2 </version> <configuration> <source> 1.8 </source> <target> 1.8 </target> <encoding> UTF-8 </encoding> </configuration> </plugin> </plugins> </build> </project> 4.2\u3001\u7f16\u5199application.properties\u914d\u7f6e\u6587\u4ef6 \u00b6 # Spring boot application spring.application.name = itcast-mongodb #\u65e0\u8ba4\u8bc1\u4fe1\u606f\u7684\u914d\u7f6e #spring.data.mongodb.uri=mongodb://192.168.31.81:27017/tanhua #springboot \u914d\u7f6e spring.data.mongodb.username = tanhua spring.data.mongodb.password = l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV spring.data.mongodb.authentication-database = admin spring.data.mongodb.database = tanhua spring.data.mongodb.port = 27018 spring.data.mongodb.host = 192.168.31.81 4.3\u3001\u7f16\u5199\u5b9e\u4f53 \u00b6 package cn.itcast.mongodb.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; @Data @AllArgsConstructor @NoArgsConstructor public class Person { private ObjectId id ; private String name ; private int age ; private Address address ; } package cn.itcast.mongodb.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @AllArgsConstructor @NoArgsConstructor public class Address { private String street ; private String city ; private String zip ; } 4.4\u3001\u7f16\u5199dao \u00b6 package cn.itcast.mongodb.dao ; import cn.itcast.mongodb.pojo.Person ; import com.mongodb.client.result.DeleteResult ; import com.mongodb.client.result.UpdateResult ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; import org.springframework.data.mongodb.core.query.Update ; import org.springframework.stereotype.Component ; import java.util.List ; @Component public class PersonDao { @Autowired private MongoTemplate mongoTemplate ; public void savePerson ( Person person ) { this . mongoTemplate . save ( person ); } public List < Person > queryPersonListByName ( String name ) { Query query = Query . query ( Criteria . where ( \"name\" ). is ( name )); return this . mongoTemplate . find ( query , Person . class ); } public List < Person > queryPersonPageList ( Integer page , Integer rows ) { Query query = new Query (). limit ( rows ). skip (( page - 1 ) * rows ); return this . mongoTemplate . find ( query , Person . class ); } public UpdateResult update ( Person person ) { Query query = Query . query ( Criteria . where ( \"id\" ). is ( person . getId ())); Update update = Update . update ( \"age\" , person . getAge ()); return this . mongoTemplate . updateFirst ( query , update , Person . class ); } public DeleteResult deleteById ( String id ) { Query query = Query . query ( Criteria . where ( \"id\" ). is ( id )); return this . mongoTemplate . remove ( query , Person . class ); } } 4.5\u3001\u7f16\u5199\u542f\u52a8\u7c7b \u00b6 package cn.itcast.mongodb ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; @SpringBootApplication public class MongoApplication { public static void main ( String [] args ) { SpringApplication . run ( MongoApplication . class , args ); } } 4.6\u3001\u7f16\u5199\u5355\u5143\u6d4b\u8bd5 \u00b6 package cn.itcast.mongodb ; import cn.itcast.mongodb.dao.PersonDao ; import cn.itcast.mongodb.pojo.Address ; import cn.itcast.mongodb.pojo.Person ; import org.bson.types.ObjectId ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; import java.util.List ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestPersonDao { @Autowired private PersonDao personDao ; @Test public void testSave () { Person person = new Person ( ObjectId . get (), \"\u5f20\u4e09\" , 20 , new Address ( \"\u4eba\u6c11\u8def\" , \"\u4e0a\u6d77\u5e02\" , \"666666\" )); this . personDao . savePerson ( person ); } @Test public void testQuery () { List < Person > personList = this . personDao . queryPersonListByName ( \"\u5f20\u4e09\" ); for ( Person person : personList ) { System . out . println ( person ); } } @Test public void testQuery2 () { List < Person > personList = this . personDao . queryPersonPageList ( 2 , 2 ); for ( Person person : personList ) { System . out . println ( person ); } } @Test public void testUpdate () { Person person = new Person (); person . setId ( new ObjectId ( \"5c0956ce235e192520086736\" )); person . setAge ( 30 ); this . personDao . update ( person ); } @Test public void testDelete () { this . personDao . deleteById ( \"5c09ca05235e192d8887a389\" ); } }","title":"MongoDB"},{"location":"MongoDB/MongoDB/#3mongodb","text":"","title":"3\u3001MongoDB\u5feb\u901f\u5165\u95e8"},{"location":"MongoDB/MongoDB/#31mongodb","text":"MongoDB\u662f\u4e00\u4e2a\u57fa\u4e8e\u5206\u5e03\u5f0f\u6587\u4ef6\u5b58\u50a8\u7684\u6570\u636e\u5e93\u3002\u7531C++\u8bed\u8a00\u7f16\u5199\u3002\u65e8\u5728\u4e3aWEB\u5e94\u7528\u63d0\u4f9b\u53ef\u6269\u5c55\u7684\u9ad8\u6027\u80fd\u6570\u636e\u5b58\u50a8\u89e3\u51b3\u65b9\u6848\u3002 MongoDB\u662f\u4e00\u4e2a\u4ecb\u4e8e\u5173\u7cfb\u6570\u636e\u5e93\u548c\u975e\u5173\u7cfb\u6570\u636e\u5e93\u4e4b\u95f4\u7684\u4ea7\u54c1\uff0c\u662f\u975e\u5173\u7cfb\u6570\u636e\u5e93\u5f53\u4e2d\u529f\u80fd\u6700\u4e30\u5bcc\uff0c\u6700\u50cf\u5173\u7cfb\u6570\u636e\u5e93\u7684\uff0c\u5b83\u652f\u6301\u7684\u6570\u636e\u7ed3\u6784\u975e\u5e38\u677e\u6563\uff0c\u662f\u7c7b\u4f3cjson\u7684bson\u683c\u5f0f\uff0c\u56e0\u6b64\u53ef\u4ee5\u5b58\u50a8\u6bd4\u8f83\u590d\u6742\u7684\u6570\u636e\u7c7b\u578b\u3002 MongoDB\u6700\u5927\u7684\u7279\u70b9\u662f\u5b83\u652f\u6301\u7684\u67e5\u8be2\u8bed\u8a00\u975e\u5e38\u5f3a\u5927\uff0c\u5176\u8bed\u6cd5\u6709\u70b9\u7c7b\u4f3c\u4e8e\u9762\u5411\u5bf9\u8c61\u7684\u67e5\u8be2\u8bed\u8a00\uff0c\u51e0\u4e4e\u53ef\u4ee5\u5b9e\u73b0\u7c7b\u4f3c\u5173\u7cfb\u6570\u636e\u5e93\u5355\u8868\u67e5\u8be2\u7684\u7edd\u5927\u90e8\u5206\u529f\u80fd\uff0c\u800c\u4e14\u8fd8\u652f\u6301\u5bf9\u6570\u636e\u5efa\u7acb\u7d22\u5f15\u3002 \u5b98\u7f51\uff1ahttps://www.mongodb.com","title":"3.1\u3001MongoDB\u7b80\u4ecb"},{"location":"MongoDB/MongoDB/#32dockermongodb","text":"#\u62c9\u53d6\u955c\u50cf docker pull mongo:4.0.3 #\u521b\u5efa\u5bb9\u5668 docker create --name mongodb-server -p 27018 :27017 -v mongodb-data:/data/db mongo:4.0.3 --auth #\u542f\u52a8\u5bb9\u5668 docker start mongodb-server #\u8fdb\u5165\u5bb9\u5668 docker exec -it mongodb-server /bin/bash #\u8fdb\u5165admin\u6570\u636e\u5e93 mongo use admin #\u6dfb\u52a0\u7ba1\u7406\u5458\uff0c\u5176\u62e5\u6709\u7ba1\u7406\u7528\u6237\u548c\u89d2\u8272\u7684\u6743\u9650 db.createUser ({ user: 'root' , pwd: 'root' , roles: [ { role: \"root\" , db: \"admin\" } ] }) #\u6d4b\u8bd5\uff0c\u53d1\u73b0\u662f\u6ca1\u6709\u6743\u9650\u64cd\u4f5c\u7684 > show dbs 2020 -10-20T09:09:15.543+0000 E QUERY [ js ] Error: listDatabases failed: { \"ok\" : 0 , \"errmsg\" : \"command listDatabases requires authentication\" , \"code\" : 13 , \"codeName\" : \"Unauthorized\" } : #\u8fdb\u884c\u8ba4\u8bc1 mongo -u \"root\" -p \"root\" --authenticationDatabase \"admin\" #\u901a\u8fc7admin\u6dfb\u52a0\u666e\u901a\u7528\u6237 use admin db.createUser ({ user: 'tanhua' , pwd: 'l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV' , roles: [ { role: \"readWrite\" , db: \"tanhua\" } ] }) ; #\u901a\u8fc7tanhua\u7528\u6237\u767b\u5f55\u8fdb\u884c\u6d4b\u8bd5 mongo -u \"tanhua\" -p \"l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV\" --authenticationDatabase \"admin\" #\u6d4b\u8bd5 root@5d848955ff7e:/# mongo -u \"tanhua\" -p \"tanhua123\" --authenticationDatabase \"admin\" MongoDB shell version v4.0.3 connecting to: mongodb://127.0.0.1:27017 Implicit session: session { \"id\" : UUID ( \"6c368269-30f0-4b29-a224-05a38b5847e2\" ) } MongoDB server version: 4 .0.3 > use tanhua switched to db tanhua > db.user.insert ({ id:1,username: 'zhangsan' ,age:20 }) WriteResult ({ \"nInserted\" : 1 }) > db.user.find () { \"_id\" : ObjectId ( \"5f8eb2726e0de0aa9517afd3\" ) , \"id\" : 1 , \"username\" : \"zhangsan\" , \"age\" : 20 }","title":"3.2\u3001\u901a\u8fc7docker\u5b89\u88c5MongoDB"},{"location":"MongoDB/MongoDB/#33mongodb","text":"","title":"3.3\u3001MongoDB\u57fa\u672c\u64cd\u4f5c"},{"location":"MongoDB/MongoDB/#331","text":"\u4e3a\u4e86\u66f4\u597d\u7684\u7406\u89e3\uff0c\u4e0b\u9762\u4e0eSQL\u4e2d\u7684\u6982\u5ff5\u8fdb\u884c\u5bf9\u6bd4\uff1a SQL\u672f\u8bed/\u6982\u5ff5 MongoDB\u672f\u8bed/\u6982\u5ff5 \u89e3\u91ca/\u8bf4\u660e database database \u6570\u636e\u5e93 table collection \u6570\u636e\u5e93\u8868/\u96c6\u5408 row document \u6570\u636e\u8bb0\u5f55\u884c/\u6587\u6863 column field \u6570\u636e\u5b57\u6bb5/\u57df index index \u7d22\u5f15 table joins \u8868\u8fde\u63a5,MongoDB\u4e0d\u652f\u6301 primary key primary key \u4e3b\u952e,MongoDB\u81ea\u52a8\u5c06_id\u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u4e3b\u952e","title":"3.3.1\u3001\u57fa\u672c\u6982\u5ff5"},{"location":"MongoDB/MongoDB/#332","text":"#\u67e5\u770b\u6240\u6709\u7684\u6570\u636e\u5e93 > show dbs admin 0 .000GB config 0 .000GB local 0 .000GB #\u901a\u8fc7use\u5173\u952e\u5b57\u5207\u6362\u6570\u636e\u5e93 > use admin switched to db admin #\u521b\u5efa\u6570\u636e\u5e93 #\u8bf4\u660e\uff1a\u5728MongoDB\u4e2d\uff0c\u6570\u636e\u5e93\u662f\u81ea\u52a8\u521b\u5efa\u7684\uff0c\u901a\u8fc7use\u5207\u6362\u5230\u65b0\u6570\u636e\u5e93\u4e2d\uff0c\u8fdb\u884c\u63d2\u5165\u6570\u636e\u5373\u53ef\u81ea\u52a8\u521b\u5efa\u6570\u636e\u5e93 > use testdb switched to db testdb > show dbs #\u5e76\u6ca1\u6709\u521b\u5efa\u6570\u636e\u5e93 admin 0 .000GB config 0 .000GB local 0 .000GB > db.user.insert ({ id:1,name: 'zhangsan' }) #\u63d2\u5165\u6570\u636e WriteResult ({ \"nInserted\" : 1 }) > show dbs admin 0 .000GB config 0 .000GB local 0 .000GB testdb 0 .000GB #\u6570\u636e\u5e93\u81ea\u52a8\u521b\u5efa #\u67e5\u770b\u8868 > show tables user > show collections user > #\u5220\u9664\u96c6\u5408\uff08\u8868\uff09 > db.user.drop () true #\u5982\u679c\u6210\u529f\u5220\u9664\u9009\u5b9a\u96c6\u5408\uff0c\u5219 drop() \u65b9\u6cd5\u8fd4\u56de true\uff0c\u5426\u5219\u8fd4\u56de false\u3002 #\u5220\u9664\u6570\u636e\u5e93 > use testdb #\u5148\u5207\u6362\u5230\u8981\u5220\u9664\u7684\u6570\u636e\u5e93\u4e2d switched to db testdb > db.dropDatabase () #\u5220\u9664\u6570\u636e\u5e93 { \"dropped\" : \"testdb\" , \"ok\" : 1 } > show dbs admin 0 .000GB config 0 .000GB local 0 .000GB","title":"3.3.2\u3001\u6570\u636e\u5e93\u4ee5\u53ca\u8868\u7684\u64cd\u4f5c"},{"location":"MongoDB/MongoDB/#333","text":"\u5728MongoDB\u4e2d\uff0c\u5b58\u50a8\u7684\u6587\u6863\u7ed3\u6784\u662f\u4e00\u79cd\u7c7b\u4f3c\u4e8ejson\u7684\u7ed3\u6784\uff0c\u79f0\u4e4b\u4e3abson\uff08\u5168\u79f0\u4e3a\uff1aBinary JSON\uff09\u3002 #\u63d2\u5165\u6570\u636e #\u8bed\u6cd5\uff1adb.COLLECTION_NAME.insert(document) > db.user.insert ({ id:1,username: 'zhangsan' ,age:20 }) WriteResult ({ \"nInserted\" : 1 }) > db.user.save ({ id:2,username: 'lisi' ,age:25 }) WriteResult ({ \"nInserted\" : 1 }) > db.user.find () #\u67e5\u8be2\u6570\u636e { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"id\" : 1 , \"username\" : \"zhangsan\" , \"age\" : 20 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 }","title":"3.3.3\u3001\u65b0\u589e\u6570\u636e"},{"location":"MongoDB/MongoDB/#334","text":"update() \u65b9\u6cd5\u7528\u4e8e\u66f4\u65b0\u5df2\u5b58\u5728\u7684\u6587\u6863\u3002\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a db.collection.update ( <query>, <update>, [ upsert: <boolean>, multi: <boolean>, writeConcern: <document> ] ) \u53c2\u6570\u8bf4\u660e\uff1a query : update\u7684\u67e5\u8be2\u6761\u4ef6\uff0c\u7c7b\u4f3csql update\u67e5\u8be2\u5185where\u540e\u9762\u7684\u3002 update : update\u7684\u5bf9\u8c61\u548c\u4e00\u4e9b\u66f4\u65b0\u7684\u64cd\u4f5c\u7b26\uff08\u5982 , inc...\uff09\u7b49\uff0c\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3asql update\u67e5\u8be2\u5185set\u540e\u9762\u7684 upsert : \u53ef\u9009\uff0c\u8fd9\u4e2a\u53c2\u6570\u7684\u610f\u601d\u662f\uff0c\u5982\u679c\u4e0d\u5b58\u5728update\u7684\u8bb0\u5f55\uff0c\u662f\u5426\u63d2\u5165objNew,true\u4e3a\u63d2\u5165\uff0c\u9ed8\u8ba4\u662ffalse\uff0c\u4e0d\u63d2\u5165\u3002 multi : \u53ef\u9009\uff0cmongodb \u9ed8\u8ba4\u662ffalse,\u53ea\u66f4\u65b0\u627e\u5230\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u5982\u679c\u8fd9\u4e2a\u53c2\u6570\u4e3atrue,\u5c31\u628a\u6309\u6761\u4ef6\u67e5\u51fa\u6765\u591a\u6761\u8bb0\u5f55\u5168\u90e8\u66f4\u65b0\u3002 writeConcern :\u53ef\u9009\uff0c\u629b\u51fa\u5f02\u5e38\u7684\u7ea7\u522b\u3002 > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"id\" : 1 , \"username\" : \"zhangsan\" , \"age\" : 20 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 } > db.user.update ({ id:1 } , { $set : { age:22 }}) #\u66f4\u65b0\u6570\u636e WriteResult ({ \"nMatched\" : 1 , \"nUpserted\" : 0 , \"nModified\" : 1 }) > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"id\" : 1 , \"username\" : \"zhangsan\" , \"age\" : 22 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 } #\u6ce8\u610f\uff1a\u5982\u679c\u8fd9\u6837\u5199\uff0c\u4f1a\u5220\u9664\u6389\u5176\u4ed6\u7684\u5b57\u6bb5 > db.user.update ({ id:1 } , { age:25 }) WriteResult ({ \"nMatched\" : 1 , \"nUpserted\" : 0 , \"nModified\" : 1 }) > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"age\" : 25 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 } #\u66f4\u65b0\u4e0d\u5b58\u5728\u7684\u5b57\u6bb5\uff0c\u4f1a\u65b0\u589e\u5b57\u6bb5 > db.user.update ({ id:2 } , { $set : { sex:1 }}) #\u66f4\u65b0\u6570\u636e > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"age\" : 25 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 , \"sex\" : 1 } #\u66f4\u65b0\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u9ed8\u8ba4\u4e0d\u4f1a\u65b0\u589e\u6570\u636e > db.user.update ({ id:3 } , { $set : { sex:1 }}) WriteResult ({ \"nMatched\" : 0 , \"nUpserted\" : 0 , \"nModified\" : 0 }) > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"age\" : 25 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 , \"sex\" : 1 } #\u5982\u679c\u8bbe\u7f6e\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3atrue\uff0c\u5c31\u662f\u65b0\u589e\u6570\u636e > db.user.update ({ id:3 } , { $set : { sex:1 }} ,true ) WriteResult ({ \"nMatched\" : 0 , \"nUpserted\" : 1 , \"nModified\" : 0 , \"_id\" : ObjectId ( \"5c08cb281418d073246bc642\" ) }) > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"age\" : 25 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 , \"sex\" : 1 } { \"_id\" : ObjectId ( \"5c08cb281418d073246bc642\" ) , \"id\" : 3 , \"sex\" : 1 }","title":"3.3.4\u3001\u66f4\u65b0\u6570\u636e"},{"location":"MongoDB/MongoDB/#335","text":"\u901a\u8fc7remove()\u65b9\u6cd5\u8fdb\u884c\u5220\u9664\u6570\u636e\uff0c\u8bed\u6cd5\u5982\u4e0b\uff1a db.collection.remove ( <query>, { justOne: <boolean>, writeConcern: <document> } ) \u53c2\u6570\u8bf4\u660e\uff1a query :\uff08\u53ef\u9009\uff09\u5220\u9664\u7684\u6587\u6863\u7684\u6761\u4ef6\u3002 justOne : \uff08\u53ef\u9009\uff09\u5982\u679c\u8bbe\u4e3a true \u6216 1\uff0c\u5219\u53ea\u5220\u9664\u4e00\u4e2a\u6587\u6863\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\u8be5\u53c2\u6570\uff0c\u6216\u4f7f\u7528\u9ed8\u8ba4\u503c false\uff0c\u5219\u5220\u9664\u6240\u6709\u5339\u914d\u6761\u4ef6\u7684\u6587\u6863\u3002 writeConcern :\uff08\u53ef\u9009\uff09\u629b\u51fa\u5f02\u5e38\u7684\u7ea7\u522b\u3002 \u5b9e\u4f8b\uff1a > db.user.remove ({ age:25 }) WriteResult ({ \"nRemoved\" : 2 }) #\u5220\u9664\u4e862\u6761\u6570\u636e #\u63d2\u51654\u6761\u6d4b\u8bd5\u6570\u636e db.user.insert ({ id:1,username: 'zhangsan' ,age:20 }) db.user.insert ({ id:2,username: 'lisi' ,age:21 }) db.user.insert ({ id:3,username: 'wangwu' ,age:22 }) db.user.insert ({ id:4,username: 'zhaoliu' ,age:22 }) > db.user.remove ({ age:22 } ,true ) WriteResult ({ \"nRemoved\" : 1 }) #\u5220\u9664\u4e861\u6761\u6570\u636e #\u5220\u9664\u6240\u6709\u6570\u636e > db.user.remove ({}) #\u8bf4\u660e\uff1a\u4e3a\u4e86\u7b80\u5316\u64cd\u4f5c\uff0c\u5b98\u65b9\u63a8\u8350\u4f7f\u7528deleteOne()\u4e0edeleteMany()\u8fdb\u884c\u5220\u9664\u6570\u636e\u64cd\u4f5c\u3002 db.user.deleteOne ({ id:1 }) db.user.deleteMany ({}) #\u5220\u9664\u6240\u6709\u6570\u636e","title":"3.3.5\u3001\u5220\u9664\u6570\u636e"},{"location":"MongoDB/MongoDB/#336","text":"MongoDB \u67e5\u8be2\u6570\u636e\u7684\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a db . user . find ( [ query ] , [ fields ] ) query \uff1a\u53ef\u9009\uff0c\u4f7f\u7528\u67e5\u8be2\u64cd\u4f5c\u7b26\u6307\u5b9a\u67e5\u8be2\u6761\u4ef6 fields \uff1a\u53ef\u9009\uff0c\u4f7f\u7528\u6295\u5f71\u64cd\u4f5c\u7b26\u6307\u5b9a\u8fd4\u56de\u7684\u952e\u3002\u67e5\u8be2\u65f6\u8fd4\u56de\u6587\u6863\u4e2d\u6240\u6709\u952e\u503c\uff0c \u53ea\u9700\u7701\u7565\u8be5\u53c2\u6570\u5373\u53ef\uff08\u9ed8\u8ba4\u7701\u7565\uff09\u3002 \u5982\u679c\u4f60\u9700\u8981\u4ee5\u6613\u8bfb\u7684\u65b9\u5f0f\u6765\u8bfb\u53d6\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528 pretty() \u65b9\u6cd5\uff0c\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a >db.col.find().pretty() pretty() \u65b9\u6cd5\u4ee5\u683c\u5f0f\u5316\u7684\u65b9\u5f0f\u6765\u663e\u793a\u6240\u6709\u6587\u6863\u3002 \u6761\u4ef6\u67e5\u8be2\uff1a \u64cd\u4f5c \u683c\u5f0f \u8303\u4f8b RDBMS\u4e2d\u7684\u7c7b\u4f3c\u8bed\u53e5 \u7b49\u4e8e {<key>:<value> } db.col.find({\"by\":\"\u9ed1\u9a6c\u7a0b\u5e8f\u5458\"}).pretty() where by = '\u9ed1\u9a6c\u7a0b\u5e8f\u5458' \u5c0f\u4e8e {<key>:{$lt:<value>}} db.col.find({\"likes\":{$lt:50}}).pretty() where likes < 50 \u5c0f\u4e8e\u6216\u7b49\u4e8e {<key>:{$lte:<value>}} db.col.find({\"likes\":{$lte:50}}).pretty() where likes <= 50 \u5927\u4e8e {<key>:{$gt:<value>}} db.col.find({\"likes\":{$gt:50}}).pretty() where likes > 50 \u5927\u4e8e\u6216\u7b49\u4e8e {<key>:{$gte:<value>}} db.col.find({\"likes\":{$gte:50}}).pretty() where likes >= 50 \u4e0d\u7b49\u4e8e {<key>:{$ne:<value>}} db.col.find({\"likes\":{$ne:50}}).pretty() where likes != 50 \u5b9e\u4f8b\uff1a #\u63d2\u5165\u6d4b\u8bd5\u6570\u636e db.user.insert ({ id:1,username: 'zhangsan' ,age:20 }) db.user.insert ({ id:2,username: 'lisi' ,age:21 }) db.user.insert ({ id:3,username: 'wangwu' ,age:22 }) db.user.insert ({ id:4,username: 'zhaoliu' ,age:22 }) db.user.find () #\u67e5\u8be2\u5168\u90e8\u6570\u636e db.user.find ({} , { id:1,username:1 }) #\u53ea\u67e5\u8be2id\u4e0eusername\u5b57\u6bb5 db.user.find () .count () #\u67e5\u8be2\u6570\u636e\u6761\u6570 db.user.find ({ id:1 }) #\u67e5\u8be2id\u4e3a1\u7684\u6570\u636e db.user.find ({ age: { $lte :21 }}) #\u67e5\u8be2\u5c0f\u4e8e\u7b49\u4e8e21\u7684\u6570\u636e db.user.find ({ age: { $lte :21 } , id: { $gte :2 }}) #and\u67e5\u8be2\uff0cage\u5c0f\u4e8e\u7b49\u4e8e21\u5e76\u4e14id\u5927\u4e8e\u7b49\u4e8e2 db.user.find ({ $or : [{ id:1 } , { id:2 }]}) #\u67e5\u8be2id=1 or id=2 #\u5206\u9875\u67e5\u8be2\uff1aSkip()\u8df3\u8fc7\u51e0\u6761\uff0climit()\u67e5\u8be2\u6761\u6570 db.user.find () .limit ( 2 ) .skip ( 1 ) #\u8df3\u8fc71\u6761\u6570\u636e\uff0c\u67e5\u8be22\u6761\u6570\u636e db.user.find () .sort ({ id:-1 }) #\u6309\u7167age\u5012\u5e8f\u6392\u5e8f\uff0c-1\u4e3a\u5012\u5e8f\uff0c1\u4e3a\u6b63\u5e8f","title":"3.3.6\u3001\u67e5\u8be2\u6570\u636e"},{"location":"MongoDB/MongoDB/#34","text":"\u7d22\u5f15\u901a\u5e38\u80fd\u591f\u6781\u5927\u7684\u63d0\u9ad8\u67e5\u8be2\u7684\u6548\u7387\uff0c\u5982\u679c\u6ca1\u6709\u7d22\u5f15\uff0cMongoDB\u5728\u8bfb\u53d6\u6570\u636e\u65f6\u5fc5\u987b\u626b\u63cf\u96c6\u5408\u4e2d\u7684\u6bcf\u4e2a\u6587\u4ef6\u5e76\u9009\u53d6\u90a3\u4e9b\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\u3002 \u8fd9\u79cd\u626b\u63cf\u5168\u96c6\u5408\u7684\u67e5\u8be2\u6548\u7387\u662f\u975e\u5e38\u4f4e\u7684\uff0c\u7279\u522b\u5728\u5904\u7406\u5927\u91cf\u7684\u6570\u636e\u65f6\uff0c\u67e5\u8be2\u53ef\u4ee5\u8981\u82b1\u8d39\u51e0\u5341\u79d2\u751a\u81f3\u51e0\u5206\u949f\uff0c\u8fd9\u5bf9\u7f51\u7ad9\u7684\u6027\u80fd\u662f\u975e\u5e38\u81f4\u547d\u7684\u3002 \u7d22\u5f15\u662f\u7279\u6b8a\u7684\u6570\u636e\u7ed3\u6784\uff0c\u7d22\u5f15\u5b58\u50a8\u5728\u4e00\u4e2a\u6613\u4e8e\u904d\u5386\u8bfb\u53d6\u7684\u6570\u636e\u96c6\u5408\u4e2d\uff0c\u7d22\u5f15\u662f\u5bf9\u6570\u636e\u5e93\u8868\u4e2d\u4e00\u5217\u6216\u591a\u5217\u7684\u503c\u8fdb\u884c\u6392\u5e8f\u7684\u4e00\u79cd\u7ed3\u6784 #\u67e5\u770b\u7d22\u5f15 > db.user.getIndexes () [ { \"v\" : 2 , \"key\" : { \"_id\" : 1 } , \"name\" : \"_id_\" , \"ns\" : \"testdb.user\" } ] #\u8bf4\u660e\uff1a1\u8868\u793a\u5347\u5e8f\u521b\u5efa\u7d22\u5f15\uff0c-1\u8868\u793a\u964d\u5e8f\u521b\u5efa\u7d22\u5f15\u3002 #\u521b\u5efa\u7d22\u5f15 > db.user.createIndex ({ 'age' :1 }) { \"createdCollectionAutomatically\" : false, \"numIndexesBefore\" : 1 , \"numIndexesAfter\" : 2 , \"ok\" : 1 } #\u5220\u9664\u7d22\u5f15 db.user.dropIndex ( \"age_1\" ) #\u6216\u8005\uff0c\u5220\u9664\u9664\u4e86_id\u4e4b\u5916\u7684\u7d22\u5f15 db.user.dropIndexes () #\u521b\u5efa\u8054\u5408\u7d22\u5f15 db.user.createIndex ({ 'age' :1, 'id' :-1 }) #\u67e5\u770b\u7d22\u5f15\u5927\u5c0f\uff0c\u5355\u4f4d\uff1a\u5b57\u8282 db.user.totalIndexSize ()","title":"3.4\u3001\u7d22\u5f15"},{"location":"MongoDB/MongoDB/#35","text":"MongoDB \u67e5\u8be2\u5206\u6790\u53ef\u4ee5\u786e\u4fdd\u6211\u4eec\u5efa\u8bae\u7684\u7d22\u5f15\u662f\u5426\u6709\u6548\uff0c\u662f\u67e5\u8be2\u8bed\u53e5\u6027\u80fd\u5206\u6790\u7684\u91cd\u8981\u5de5\u5177\u3002 #\u63d2\u51651000\u6761\u6570\u636e for ( var i = 1 ; i< 1000 ; i++ ) db.user.insert ({ id:100+i,username: 'name_' +i,age:10+i }) #\u67e5\u770b\u6267\u884c\u8ba1\u5212 > db.user.find ({ age: { $gt :100 } ,id: { $lt :200 }}) .explain () { \"queryPlanner\" : { \"plannerVersion\" : 1 , \"namespace\" : \"testdb.user\" , \"indexFilterSet\" : false, \"parsedQuery\" : { \" $and \" : [ { \"id\" : { \" $lt \" : 200 } } , { \"age\" : { \" $gt \" : 100 } } ] } , \"winningPlan\" : { #\u6700\u4f73\u6267\u884c\u8ba1\u5212 \"stage\" : \"FETCH\" , #\u67e5\u8be2\u65b9\u5f0f\uff0c\u5e38\u89c1\u7684\u6709COLLSCAN/\u5168\u8868\u626b\u63cf\u3001IXSCAN/\u7d22\u5f15\u626b\u63cf\u3001FETCH/\u6839\u636e\u7d22\u5f15\u53bb\u68c0\u7d22\u6587\u6863\u3001SHARD_MERGE/\u5408\u5e76\u5206\u7247\u7ed3\u679c\u3001IDHACK/\u9488\u5bf9_id\u8fdb\u884c\u67e5\u8be2 \"inputStage\" : { \"stage\" : \"IXSCAN\" , \"keyPattern\" : { \"age\" : 1 , \"id\" : -1 } , \"indexName\" : \"age_1_id_-1\" , \"isMultiKey\" : false, \"multiKeyPaths\" : { \"age\" : [ ] , \"id\" : [ ] } , \"isUnique\" : false, \"isSparse\" : false, \"isPartial\" : false, \"indexVersion\" : 2 , \"direction\" : \"forward\" , \"indexBounds\" : { \"age\" : [ \"(100.0, inf.0]\" ] , \"id\" : [ \"(200.0, -inf.0]\" ] } } } , \"rejectedPlans\" : [ ] } , \"serverInfo\" : { \"host\" : \"c493d5ff750a\" , \"port\" : 27017 , \"version\" : \"4.0.3\" , \"gitVersion\" : \"7ea530946fa7880364d88c8d8b6026bbc9ffa48c\" } , \"ok\" : 1 } #\u6d4b\u8bd5\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15 > db.user.find ({ username: 'zhangsan' }) .explain () { \"queryPlanner\" : { \"plannerVersion\" : 1 , \"namespace\" : \"testdb.user\" , \"indexFilterSet\" : false, \"parsedQuery\" : { \"username\" : { \" $eq \" : \"zhangsan\" } } , \"winningPlan\" : { \"stage\" : \"COLLSCAN\" , #\u5168\u8868\u626b\u63cf \"filter\" : { \"username\" : { \" $eq \" : \"zhangsan\" } } , \"direction\" : \"forward\" } , \"rejectedPlans\" : [ ] } , \"serverInfo\" : { \"host\" : \"c493d5ff750a\" , \"port\" : 27017 , \"version\" : \"4.0.3\" , \"gitVersion\" : \"7ea530946fa7880364d88c8d8b6026bbc9ffa48c\" } , \"ok\" : 1 }","title":"3.5\u3001\u6267\u884c\u8ba1\u5212"},{"location":"MongoDB/MongoDB/#36ui","text":"Robo 3T\u662fMongoDB\u7684\u5ba2\u6237\u7aef\u5de5\u5177\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u64cd\u4f5cMongoDB\u3002 \u67e5\u770b\u6570\u636e\uff1a \u6216\u4f7f\u7528Navicat Premium 15\uff1a","title":"3.6\u3001UI\u5ba2\u6237\u7aef\u5de5\u5177"},{"location":"MongoDB/MongoDB/#4springbootmongodb","text":"spring-data\u5bf9MongoDB\u505a\u4e86\u652f\u6301\uff0c\u4f7f\u7528spring-data-mongodb\u53ef\u4ee5\u7b80\u5316MongoDB\u7684\u64cd\u4f5c\u3002 \u5730\u5740\uff1ahttps://spring.io/projects/spring-data-mongodb","title":"4\u3001SpringBoot\u6574\u5408MongoDB"},{"location":"MongoDB/MongoDB/#41","text":"<?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <modelVersion> 4.0.0 </modelVersion> <parent> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-parent </artifactId> <version> 2.1.0.RELEASE </version> </parent> <groupId> cn.itcast.mongodb </groupId> <artifactId> itcast-mongodb </artifactId> <version> 1.0-SNAPSHOT </version> <dependencies> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-mongodb </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-test </artifactId> <scope> test </scope> </dependency> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> <optional> true </optional> <version> 1.18.4 </version> </dependency> </dependencies> <build> <plugins> <!-- java\u7f16\u8bd1\u63d2\u4ef6 --> <plugin> <groupId> org.apache.maven.plugins </groupId> <artifactId> maven-compiler-plugin </artifactId> <version> 3.2 </version> <configuration> <source> 1.8 </source> <target> 1.8 </target> <encoding> UTF-8 </encoding> </configuration> </plugin> </plugins> </build> </project>","title":"4.1\u3001\u5bfc\u5165\u4f9d\u8d56"},{"location":"MongoDB/MongoDB/#42applicationproperties","text":"# Spring boot application spring.application.name = itcast-mongodb #\u65e0\u8ba4\u8bc1\u4fe1\u606f\u7684\u914d\u7f6e #spring.data.mongodb.uri=mongodb://192.168.31.81:27017/tanhua #springboot \u914d\u7f6e spring.data.mongodb.username = tanhua spring.data.mongodb.password = l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV spring.data.mongodb.authentication-database = admin spring.data.mongodb.database = tanhua spring.data.mongodb.port = 27018 spring.data.mongodb.host = 192.168.31.81","title":"4.2\u3001\u7f16\u5199application.properties\u914d\u7f6e\u6587\u4ef6"},{"location":"MongoDB/MongoDB/#43","text":"package cn.itcast.mongodb.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; @Data @AllArgsConstructor @NoArgsConstructor public class Person { private ObjectId id ; private String name ; private int age ; private Address address ; } package cn.itcast.mongodb.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @AllArgsConstructor @NoArgsConstructor public class Address { private String street ; private String city ; private String zip ; }","title":"4.3\u3001\u7f16\u5199\u5b9e\u4f53"},{"location":"MongoDB/MongoDB/#44dao","text":"package cn.itcast.mongodb.dao ; import cn.itcast.mongodb.pojo.Person ; import com.mongodb.client.result.DeleteResult ; import com.mongodb.client.result.UpdateResult ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; import org.springframework.data.mongodb.core.query.Update ; import org.springframework.stereotype.Component ; import java.util.List ; @Component public class PersonDao { @Autowired private MongoTemplate mongoTemplate ; public void savePerson ( Person person ) { this . mongoTemplate . save ( person ); } public List < Person > queryPersonListByName ( String name ) { Query query = Query . query ( Criteria . where ( \"name\" ). is ( name )); return this . mongoTemplate . find ( query , Person . class ); } public List < Person > queryPersonPageList ( Integer page , Integer rows ) { Query query = new Query (). limit ( rows ). skip (( page - 1 ) * rows ); return this . mongoTemplate . find ( query , Person . class ); } public UpdateResult update ( Person person ) { Query query = Query . query ( Criteria . where ( \"id\" ). is ( person . getId ())); Update update = Update . update ( \"age\" , person . getAge ()); return this . mongoTemplate . updateFirst ( query , update , Person . class ); } public DeleteResult deleteById ( String id ) { Query query = Query . query ( Criteria . where ( \"id\" ). is ( id )); return this . mongoTemplate . remove ( query , Person . class ); } }","title":"4.4\u3001\u7f16\u5199dao"},{"location":"MongoDB/MongoDB/#45","text":"package cn.itcast.mongodb ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; @SpringBootApplication public class MongoApplication { public static void main ( String [] args ) { SpringApplication . run ( MongoApplication . class , args ); } }","title":"4.5\u3001\u7f16\u5199\u542f\u52a8\u7c7b"},{"location":"MongoDB/MongoDB/#46","text":"package cn.itcast.mongodb ; import cn.itcast.mongodb.dao.PersonDao ; import cn.itcast.mongodb.pojo.Address ; import cn.itcast.mongodb.pojo.Person ; import org.bson.types.ObjectId ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; import java.util.List ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestPersonDao { @Autowired private PersonDao personDao ; @Test public void testSave () { Person person = new Person ( ObjectId . get (), \"\u5f20\u4e09\" , 20 , new Address ( \"\u4eba\u6c11\u8def\" , \"\u4e0a\u6d77\u5e02\" , \"666666\" )); this . personDao . savePerson ( person ); } @Test public void testQuery () { List < Person > personList = this . personDao . queryPersonListByName ( \"\u5f20\u4e09\" ); for ( Person person : personList ) { System . out . println ( person ); } } @Test public void testQuery2 () { List < Person > personList = this . personDao . queryPersonPageList ( 2 , 2 ); for ( Person person : personList ) { System . out . println ( person ); } } @Test public void testUpdate () { Person person = new Person (); person . setId ( new ObjectId ( \"5c0956ce235e192520086736\" )); person . setAge ( 30 ); this . personDao . update ( person ); } @Test public void testDelete () { this . personDao . deleteById ( \"5c09ca05235e192d8887a389\" ); } }","title":"4.6\u3001\u7f16\u5199\u5355\u5143\u6d4b\u8bd5"},{"location":"ajax/","text":"1\u3001Ajax\u5feb\u901f\u5165\u95e8 \u00b6 1.1\u3001AJAX\u4ecb\u7ecd \u00b6 AJAX(Asynchronous JavaScript And XML)\uff1a\u5f02\u6b65\u7684 JavaScript \u548c XML\u3002 \u672c\u8eab\u4e0d\u662f\u4e00\u79cd\u65b0\u6280\u672f\uff0c\u800c\u662f\u591a\u4e2a\u6280\u672f\u7efc\u5408\u3002\u7528\u4e8e\u5feb\u901f\u521b\u5efa\u52a8\u6001\u7f51\u9875\u7684\u6280\u672f\u3002 \u4e00\u822c\u7684\u7f51\u9875\u5982\u679c\u9700\u8981\u66f4\u65b0\u5185\u5bb9\uff0c\u5fc5\u9700\u91cd\u65b0\u52a0\u8f7d\u4e2a\u9875\u9762\u3002 \u800c AJAX \u901a\u8fc7\u6d4f\u89c8\u5668\u4e0e\u670d\u52a1\u5668\u8fdb\u884c\u5c11\u91cf\u6570\u636e\u4ea4\u6362\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7f51\u9875\u5b9e\u73b0\u5f02\u6b65\u66f4\u65b0\u3002\u4e5f\u5c31\u662f\u5728\u4e0d\u91cd\u65b0\u52a0\u8f7d\u6574\u4e2a\u9875 \u9762\u7684\u60c5\u51b5\u4e0b\uff0c\u5bf9\u7f51\u9875\u7684\u90e8\u5206\u5185\u5bb9\u8fdb\u884c \u5c40\u90e8\u66f4\u65b0 \u3002 \u200b \u200b 1.2\u3001\u539f\u751fJS\u5b9e\u73b0AJAX \u00b6 \u4ee3\u7801\u5b9e\u73b0 ```java import javax.servlet.ServletException; import javax.servlet.annotation.WebServlet; import javax.servlet.http.HttpServlet; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import java.io.IOException; @WebServlet(\"/userServlet\") public class UserServlet extends HttpServlet { @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { //\u8bbe\u7f6e\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u4e71\u7801 req.setCharacterEncoding(\"UTF-8\"); resp.setContentType(\"text/html;charset=UTF-8\"); //1.\u83b7\u53d6\u8bf7\u6c42\u53c2\u6570 String username = req.getParameter(\"username\"); //\u6a21\u62df\u670d\u52a1\u5668\u5904\u7406\u8bf7\u6c42\u9700\u89815\u79d2\u949f /*try { Thread.sleep(5000); } catch (InterruptedException e) { e.printStackTrace(); }*/ //2.\u5224\u65ad\u59d3\u540d\u662f\u5426\u5df2\u6ce8\u518c if(\"zhangsan\".equals(username)) { resp.getWriter().write(\" <font color= 'red' > \u7528\u6237\u540d\u5df2\u6ce8\u518c </font> \"); }else { resp.getWriter().write(\" <font color= 'green' > \u7528\u6237\u540d\u53ef\u7528 </font> \"); } } @Override protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { doGet(req,resp); } } ``` html\u4ee3\u7801 ```html \u7528\u6237\u6ce8\u518c \u59d3\u540d\uff1a \u5bc6\u7801\uff1a //1.\u4e3a\u59d3\u540d\u7ed1\u5b9a\u5931\u53bb\u7126\u70b9\u4e8b\u4ef6 document.getElementById(\"username\").onblur = function() { //2.\u521b\u5efaXMLHttpRequest\u6838\u5fc3\u5bf9\u8c61 let xmlHttp = new XMLHttpRequest(); //3.\u6253\u5f00\u94fe\u63a5 let username = document.getElementById(\"username\").value; xmlHttp.open(\"GET\",\"userServlet?username=\"+username,true); //xmlHttp.open(\"GET\",\"userServlet?username=\"+username,false); //4.\u53d1\u9001\u8bf7\u6c42 xmlHttp.send(); //5.\u5904\u7406\u54cd\u5e94 xmlHttp.onreadystatechange = function() { //\u5224\u65ad\u8bf7\u6c42\u548c\u54cd\u5e94\u662f\u5426\u6210\u529f if(xmlHttp.readyState == 4 && xmlHttp.status == 200) { //\u5c06\u54cd\u5e94\u7684\u6570\u636e\u663e\u793a\u5230span\u6807\u7b7e document.getElementById(\"uSpan\").innerHTML = xmlHttp.responseText; } } } ``` 1.3\u3001\u539f\u751fJS\u5b9e\u73b0AJAX\u8be6\u89e3 \u00b6 \u6838\u5fc3\u5bf9\u8c61\uff1aXMLHttpRequest \u200b \u7528\u4e8e\u5728\u540e\u53f0\u4e0e\u670d\u52a1\u5668\u4ea4\u6362\u6570\u636e\u3002\u53ef\u4ee5\u5728\u4e0d\u91cd\u65b0\u52a0\u8f7d\u6574\u4e2a\u7f51\u9875\u7684\u60c5\u51b5\u4e0b\uff0c\u5bf9\u7f51\u9875\u7684\u67d0\u90e8\u5206\u8fdb\u884c\u66f4\u65b0\u3002 \u6253\u5f00\u94fe\u63a5\uff1aopen(method,url,async) \u200b method\uff1a\u8bf7\u6c42\u7684\u7c7b\u578b GET \u6216 POST\u3002 \u200b url\uff1a\u8bf7\u6c42\u8d44\u6e90\u7684\u8def\u5f84\u3002 \u200b async\uff1atrue(\u5f02\u6b65) \u6216 false(\u540c\u6b65)\u3002 \u53d1\u9001\u8bf7\u6c42\uff1asend(String params) \u200b params\uff1a\u8bf7\u6c42\u7684\u53c2\u6570(POST \u4e13\u7528)\u3002 \u5904\u7406\u54cd\u5e94\uff1aonreadystatechange \u200b readyState\uff1a0-\u8bf7\u6c42\u672a\u521d\u59cb\u5316\uff0c1-\u670d\u52a1\u5668\u8fde\u63a5\u5df2\u5efa\u7acb\uff0c2-\u8bf7\u6c42\u5df2\u63a5\u6536\uff0c3-\u8bf7\u6c42\u5904\u7406\u4e2d\uff0c4-\u8bf7\u6c42\u5df2\u5b8c\u6210\uff0c\u4e14\u54cd\u5e94\u5df2\u5c31\u7eea\u3002 \u200b status\uff1a200-\u54cd\u5e94\u5df2\u5168\u90e8 OK\u3002 \u83b7\u5f97\u54cd\u5e94\u6570\u636e\u5f62\u5f0f \u200b responseText\uff1a\u83b7\u5f97\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684\u54cd\u5e94\u6570\u636e\u3002 \u200b responseXML\uff1a\u83b7\u5f97 XML \u5f62\u5f0f\u7684\u54cd\u5e94\u6570\u636e\u3002 1.4\u3001JQuery\u7684GET\u65b9\u5f0f\u5b9e\u73b0AJAX \u00b6 \u6838\u5fc3\u8bed\u6cd5\uff1a $.get(url,[data],[callback],[type]); url\uff1a\u8bf7\u6c42\u7684\u8d44\u6e90\u8def\u5f84\u3002 data\uff1a\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7aef\u7684\u8bf7\u6c42\u53c2\u6570\uff0c\u683c\u5f0f\u53ef\u4ee5\u662fkey=value\uff0c\u4e5f\u53ef\u4ee5\u662f js \u5bf9\u8c61\u3002 callback\uff1a\u5f53\u8bf7\u6c42\u6210\u529f\u540e\u7684\u56de\u8c03\u51fd\u6570\uff0c\u53ef\u4ee5\u5728\u51fd\u6570\u4e2d\u7f16\u5199\u6211\u4eec\u7684\u903b\u8f91\u4ee3\u7801\u3002 type\uff1a\u9884\u671f\u7684\u8fd4\u56de\u6570\u636e\u7684\u7c7b\u578b\uff0c\u53d6\u503c\u53ef\u4ee5\u662f xml, html, js, json, text\u7b49\u3002 \u4ee3\u7801\u5b9e\u73b0 ```html \u7528\u6237\u6ce8\u518c \u59d3\u540d\uff1a \u5bc6\u7801\uff1a //1.\u4e3a\u7528\u6237\u540d\u7ed1\u5b9a\u5931\u53bb\u7126\u70b9\u4e8b\u4ef6 $(\"#username\").blur(function () { let username = $(\"#username\").val(); //2.jQuery\u7684GET\u65b9\u5f0f\u5b9e\u73b0AJAX $.get( //\u8bf7\u6c42\u7684\u8d44\u6e90\u8def\u5f84 \"userServlet\", //\u8bf7\u6c42\u53c2\u6570 \"username=\" + username, //\u56de\u8c03\u51fd\u6570 function (data) { //\u5c06\u54cd\u5e94\u7684\u6570\u636e\u663e\u793a\u5230span\u6807\u7b7e $(\"#uSpan\").html(data); }, //\u54cd\u5e94\u6570\u636e\u5f62\u5f0f \"text\" ); }); ``` 1.5\u3001JQuery\u7684POST\u65b9\u5f0f\u5b9e\u73b0AJAX \u00b6 \u6838\u5fc3\u8bed\u6cd5\uff1a $.post(url,[data],[callback],[type]); url\uff1a\u8bf7\u6c42\u7684\u8d44\u6e90\u8def\u5f84\u3002 data\uff1a\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7aef\u7684\u8bf7\u6c42\u53c2\u6570\uff0c\u683c\u5f0f\u53ef\u4ee5\u662fkey=value\uff0c\u4e5f\u53ef\u4ee5\u662f js \u5bf9\u8c61\u3002 callback\uff1a\u5f53\u8bf7\u6c42\u6210\u529f\u540e\u7684\u56de\u8c03\u51fd\u6570\uff0c\u53ef\u4ee5\u5728\u51fd\u6570\u4e2d\u7f16\u5199\u6211\u4eec\u7684\u903b\u8f91\u4ee3\u7801\u3002 type\uff1a\u9884\u671f\u7684\u8fd4\u56de\u6570\u636e\u7684\u7c7b\u578b\uff0c\u53d6\u503c\u53ef\u4ee5\u662f xml, html, js, json, text\u7b49\u3002 \u4ee3\u7801\u5b9e\u73b0 ```html \u7528\u6237\u6ce8\u518c \u59d3\u540d\uff1a \u5bc6\u7801\uff1a //1.\u4e3a\u7528\u6237\u540d\u7ed1\u5b9a\u5931\u53bb\u7126\u70b9\u4e8b\u4ef6 $(\"#username\").blur(function () { let username = $(\"#username\").val(); //2.jQuery\u7684POST\u65b9\u5f0f\u5b9e\u73b0AJAX $.post( //\u8bf7\u6c42\u7684\u8d44\u6e90\u8def\u5f84 \"userServlet\", //\u8bf7\u6c42\u53c2\u6570 \"username=\" + username, //\u56de\u8c03\u51fd\u6570 function (data) { //\u5c06\u54cd\u5e94\u7684\u6570\u636e\u663e\u793a\u5230span\u6807\u7b7e $(\"#uSpan\").html(data); }, //\u54cd\u5e94\u6570\u636e\u5f62\u5f0f \"text\" ); }); ``` 1.6\u3001JQuery\u7684\u901a\u7528\u65b9\u5f0f\u5b9e\u73b0AJAX \u00b6 \u6838\u5fc3\u8bed\u6cd5\uff1a $.ajax({name:value,name:value,\u2026}); url\uff1a\u8bf7\u6c42\u7684\u8d44\u6e90\u8def\u5f84\u3002 async\uff1a\u662f\u5426\u5f02\u6b65\u8bf7\u6c42\uff0ctrue-\u662f\uff0cfalse-\u5426 (\u9ed8\u8ba4\u662f true)\u3002 data\uff1a\u53d1\u9001\u5230\u670d\u52a1\u5668\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u662f\u952e\u503c\u5bf9\u5f62\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u662f js \u5bf9\u8c61\u5f62\u5f0f\u3002 type\uff1a\u8bf7\u6c42\u65b9\u5f0f\uff0cPOST \u6216 GET (\u9ed8\u8ba4\u662f GET)\u3002 dataType\uff1a\u9884\u671f\u7684\u8fd4\u56de\u6570\u636e\u7684\u7c7b\u578b\uff0c\u53d6\u503c\u53ef\u4ee5\u662f xml, html, js, json, text\u7b49\u3002 success\uff1a\u8bf7\u6c42\u6210\u529f\u65f6\u8c03\u7528\u7684\u56de\u8c03\u51fd\u6570\u3002 error\uff1a\u8bf7\u6c42\u5931\u8d25\u65f6\u8c03\u7528\u7684\u56de\u8c03\u51fd\u6570\u3002 \u4ee3\u7801\u5b9e\u73b0 ```html \u7528\u6237\u6ce8\u518c \u59d3\u540d\uff1a \u5bc6\u7801\uff1a //1.\u4e3a\u7528\u6237\u540d\u7ed1\u5b9a\u5931\u53bb\u7126\u70b9\u4e8b\u4ef6 $(\"#username\").blur(function () { let username = $(\"#username\").val(); //2.jQuery\u7684\u901a\u7528\u65b9\u5f0f\u5b9e\u73b0AJAX $.ajax({ //\u8bf7\u6c42\u8d44\u6e90\u8def\u5f84 url:\"userServletxxx\", //\u662f\u5426\u5f02\u6b65 async:true, //\u8bf7\u6c42\u53c2\u6570 data:\"username=\"+username, //\u8bf7\u6c42\u65b9\u5f0f type:\"POST\", //\u6570\u636e\u5f62\u5f0f dataType:\"text\", //\u8bf7\u6c42\u6210\u529f\u540e\u8c03\u7528\u7684\u56de\u8c03\u51fd\u6570 success:function (data) { //\u5c06\u54cd\u5e94\u7684\u6570\u636e\u663e\u793a\u5230span\u6807\u7b7e $(\"#uSpan\").html(data); }, //\u8bf7\u6c42\u5931\u8d25\u540e\u8c03\u7528\u7684\u56de\u8c03\u51fd\u6570 error:function () { alert(\"\u64cd\u4f5c\u5931\u8d25...\"); } }); }); ``` 1.7\u3001\u5c0f\u7ed3 \u00b6 AJAX(Asynchronous JavaScript And XML)\uff1a \u5f02\u6b65\u7684 JavaScript \u548c XML\u3002 \u901a\u8fc7\u6d4f\u89c8\u5668\u4e0e\u670d\u52a1\u5668\u8fdb\u884c\u5c11\u91cf\u6570\u636e\u4ea4\u6362\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7f51\u9875\u5b9e\u73b0\u5f02\u6b65\u66f4\u65b0\u3002\u4e5f\u5c31\u662f\u5728\u4e0d\u91cd\u65b0\u52a0\u8f7d\u6574\u4e2a\u9875\u9762\u7684\u60c5\u51b5\u4e0b\uff0c\u5bf9\u7f51\u9875\u7684\u90e8 \u5206\u5185\u5bb9\u8fdb\u884c\u5c40\u90e8\u66f4\u65b0\u3002 \u540c\u6b65\u548c\u5f02\u6b65 \u540c\u6b65\uff1a\u670d\u52a1\u5668\u7aef\u5728\u5904\u7406\u8fc7\u7a0b\u4e2d\uff0c\u65e0\u6cd5\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\u3002 \u5f02\u6b65\uff1a\u670d\u52a1\u5668\u7aef\u5728\u5904\u7406\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u4ee5\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\u3002 GET \u65b9\u5f0f\u5b9e\u73b0\uff1a $.get(); POST \u65b9\u5f0f\u5b9e\u73b0\uff1a $.post(); url\uff1a\u8bf7\u6c42\u7684\u8d44\u6e90\u8def\u5f84\u3002 data\uff1a\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7aef\u7684\u8bf7\u6c42\u53c2\u6570\uff0c\u683c\u5f0f\u53ef\u4ee5\u662fkey=value\uff0c\u4e5f\u53ef\u4ee5\u662f js \u5bf9\u8c61\u3002 callback\uff1a\u5f53\u8bf7\u6c42\u6210\u529f\u540e\u7684\u56de\u8c03\u51fd\u6570\uff0c\u53ef\u4ee5\u5728\u51fd\u6570\u4e2d\u7f16\u5199\u6211\u4eec\u7684\u903b\u8f91\u4ee3\u7801\u3002 type\uff1a\u9884\u671f\u7684\u8fd4\u56de\u6570\u636e\u7684\u7c7b\u578b\uff0c\u53d6\u503c\u53ef\u4ee5\u662f xml, html, js, json, text\u7b49\u3002 \u901a\u7528\u65b9\u5f0f\u5b9e\u73b0\uff1a $.ajax(); url\uff1a\u8bf7\u6c42\u7684\u8d44\u6e90\u8def\u5f84\u3002 async\uff1a\u662f\u5426\u5f02\u6b65\u8bf7\u6c42\uff0ctrue-\u662f\uff0cfalse-\u5426 (\u9ed8\u8ba4\u662f true)\u3002 data\uff1a\u53d1\u9001\u5230\u670d\u52a1\u5668\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u662f\u952e\u503c\u5bf9\u5f62\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u662f js \u5bf9\u8c61\u5f62\u5f0f\u3002 type\uff1a\u8bf7\u6c42\u65b9\u5f0f\uff0cPOST \u6216 GET (\u9ed8\u8ba4\u662f GET)\u3002 dataType\uff1a\u9884\u671f\u7684\u8fd4\u56de\u6570\u636e\u7684\u7c7b\u578b\uff0c\u53d6\u503c\u53ef\u4ee5\u662f xml, html, js, json, text\u7b49\u3002 success\uff1a\u8bf7\u6c42\u6210\u529f\u65f6\u8c03\u7528\u7684\u56de\u8c03\u51fd\u6570\u3002 error\uff1a\u8bf7\u6c42\u5931\u8d25\u65f6\u8c03\u7528\u7684\u56de\u8c03\u51fd\u6570\u3002 2\u3001JSON\u7684\u5904\u7406 \u00b6 2.1\u3001JSON\u56de\u987e \u00b6 JSON(JavaScript Object Notation)\uff1a\u662f\u4e00\u79cd\u8f7b\u91cf\u7ea7\u7684\u6570\u636e\u4ea4\u6362\u683c\u5f0f\u3002 \u5b83\u662f\u57fa\u4e8e ECMAScript \u89c4\u8303\u7684\u4e00\u4e2a\u5b50\u96c6\uff0c\u91c7\u7528\u5b8c\u5168\u72ec\u7acb\u4e8e\u7f16\u7a0b\u8bed\u8a00\u7684\u6587\u672c\u683c\u5f0f\u6765\u5b58\u50a8\u548c\u8868\u793a\u6570\u636e\u3002 \u7b80\u6d01\u548c\u6e05\u6670\u7684\u5c42\u6b21\u7ed3\u6784\u4f7f\u5f97 JSON \u6210\u4e3a\u7406\u60f3\u7684\u6570\u636e\u4ea4\u6362\u8bed\u8a00\u3002\u6613\u4e8e\u4eba\u9605\u8bfb\u548c\u7f16\u5199\uff0c\u540c\u65f6\u4e5f\u6613\u4e8e\u8ba1\u7b97\u673a\u89e3\u6790\u548c\u751f\u6210\uff0c\u5e76\u6709\u6548\u7684 \u63d0\u5347\u7f51\u7edc\u4f20\u8f93\u6548\u7387\u3002 \u521b\u5efa\u683c\u5f0f \u5e38\u7528\u65b9\u6cd5 2.2\u3001JSON\u8f6c\u6362\u5de5\u5177\u7684\u4ecb\u7ecd \u00b6 \u6211\u4eec\u9664\u4e86\u53ef\u4ee5\u5728 JavaScript \u4e2d\u6765\u4f7f\u7528 JSON \u4ee5\u5916\uff0c\u5728 JAVA \u4e2d\u540c\u6837\u4e5f\u53ef\u4ee5\u4f7f\u7528 JSON\u3002 JSON \u7684\u8f6c\u6362\u5de5\u5177\u662f\u901a\u8fc7 JAVA \u5c01\u88c5\u597d\u7684\u4e00\u4e9b JAR \u5de5\u5177\u5305\u3002 \u53ef\u4ee5\u5c06 JAVA \u5bf9\u8c61\u6216\u96c6\u5408\u8f6c\u6362\u6210 JSON \u683c\u5f0f\u7684\u5b57\u7b26\u4e32\uff0c\u4e5f\u53ef\u4ee5\u5c06 JSON \u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u8f6c\u6210 JAVA \u5bf9\u8c61\u3002 Jackson\uff1a\u5f00\u6e90\u514d\u8d39\u7684 JSON \u8f6c\u6362\u5de5\u5177\uff0cSpringMVC \u8f6c\u6362\u9ed8\u8ba4\u4f7f\u7528 Jackson\u3002 \u5bfc\u5165 jar \u5305\u3002 \u521b\u5efa\u6838\u5fc3\u5bf9\u8c61\u3002 \u8c03\u7528\u65b9\u6cd5\u5b8c\u6210\u8f6c\u6362\u3002 \u5e38\u7528\u7c7b ObjectMapper\u5e38\u7528\u65b9\u6cd5 2.3\u3001JSON\u8f6c\u6362\u7ec3\u4e60 \u00b6 \u5bf9\u8c61\u8f6c JSON, JSON \u8f6c\u5bf9\u8c61\u3002 ```java / JSON\u8f6c\u6362\u5de5\u5177\u7684\u4f7f\u7528 / public class ObjectMapperTest { private ObjectMapper mapper = new ObjectMapper(); / 1.User\u5bf9\u8c61\u8f6cjson, json\u8f6cUser\u5bf9\u8c61 json\u5b57\u7b26\u4e32 = {\"name\":\"\u5f20\u4e09\",\"age\":23} user\u5bf9\u8c61 = User{name='\u5f20\u4e09', age=23} / @Test public void test01() throws Exception{ //User\u5bf9\u8c61\u8f6cjson User user = new User(\"\u5f20\u4e09\",23); String json = mapper.writeValueAsString(user); System.out.println(\"json\u5b57\u7b26\u4e32\uff1a\" + json); //json\u8f6cUser\u5bf9\u8c61 User user2 = mapper.readValue(json, User.class); System.out.println(\"java\u5bf9\u8c61\uff1a\" + user2); } } ``` Map\u8f6c JSON, JSON \u8f6c Map\u3002 ```java / 2.map \u8f6cjson, json\u8f6cmap json\u5b57\u7b26\u4e32 = {\"\u59d3\u540d\":\"\u5f20\u4e09\",\"\u6027\u522b\":\"\u7537\"} map\u5bf9\u8c61 = {\u59d3\u540d=\u5f20\u4e09, \u6027\u522b=\u7537} / @Test public void test02() throws Exception{ //map \u8f6cjson HashMap map = new HashMap<>(); map.put(\"\u59d3\u540d\",\"\u5f20\u4e09\"); map.put(\"\u6027\u522b\",\"\u7537\"); String json = mapper.writeValueAsString(map); System.out.println(\"json\u5b57\u7b26\u4e32\uff1a\" + json); //json\u8f6cmap<String,String> HashMap<String,String> map2 = mapper.readValue(json, HashMap.class); System.out.println(\"java\u5bf9\u8c61\uff1a\" + map2); } ``` Map\u8f6c JSON, JSON \u8f6c Map\u3002 ```java / 3.map \u8f6cjson, json\u8f6cmap json\u5b57\u7b26\u4e32 = {\"\u9ed1\u9a6c\u4e00\u73ed\":{\"name\":\"\u5f20\u4e09\",\"age\":23},\"\u9ed1\u9a6c\u4e8c\u73ed\":{\"name\":\"\u674e\u56db\",\"age\":24}} map\u5bf9\u8c61 = {\u9ed1\u9a6c\u4e00\u73ed=User{name='\u5f20\u4e09', age=23}, \u9ed1\u9a6c\u4e8c\u73ed=User{name='\u674e\u56db', age=24}} / @Test public void test03() throws Exception{ //map \u8f6cjson HashMap map = new HashMap<>(); map.put(\"\u9ed1\u9a6c\u4e00\u73ed\",new User(\"\u5f20\u4e09\",23)); map.put(\"\u9ed1\u9a6c\u4e8c\u73ed\",new User(\"\u674e\u56db\",24)); String json = mapper.writeValueAsString(map); System.out.println(\"json\u5b57\u7b26\u4e32\uff1a\" + json); //json\u8f6cmap<String,User> HashMap<String,User> map2 = mapper.readValue(json,new TypeReference<HashMap<String,User>>(){}); System.out.println(\"java\u5bf9\u8c61\uff1a\" + map2); } ``` List\u8f6c JSON, JSON \u8f6c List\u3002 ```java / 4.List \u8f6cjson, json\u8f6c List json\u5b57\u7b26\u4e32 = [\"\u5f20\u4e09\",\"\u674e\u56db\"] list\u5bf9\u8c61 = [\u5f20\u4e09, \u674e\u56db] / @Test public void test04() throws Exception{ //List \u8f6cjson ArrayList list = new ArrayList<>(); list.add(\"\u5f20\u4e09\"); list.add(\"\u674e\u56db\"); String json = mapper.writeValueAsString(list); System.out.println(\"json\u5b57\u7b26\u4e32\uff1a\" + json); //json\u8f6c List<String> ArrayList<String> list2 = mapper.readValue(json,ArrayList.class); System.out.println(\"java\u5bf9\u8c61\uff1a\" + list2); } ``` List\u8f6c JSON, JSON \u8f6c List\u3002 ```java / 5.List \u8f6cjson, json\u8f6cList json\u5b57\u7b26\u4e32 = [{\"name\":\"\u5f20\u4e09\",\"age\":23},{\"name\":\"\u674e\u56db\",\"age\":24}] list\u5bf9\u8c61 = [User{name='\u5f20\u4e09', age=23}, User{name='\u674e\u56db', age=24}] / @Test public void test05() throws Exception{ //List \u8f6cjson ArrayList list = new ArrayList<>(); list.add(new User(\"\u5f20\u4e09\",23)); list.add(new User(\"\u674e\u56db\",24)); String json = mapper.writeValueAsString(list); System.out.println(\"json\u5b57\u7b26\u4e32\uff1a\" + json); //json\u8f6cList<User> ArrayList<User> list2 = mapper.readValue(json,new TypeReference<ArrayList<User>>(){}); System.out.println(\"java\u5bf9\u8c61\uff1a\" + list2); } ``` 2.4\u3001\u5c0f\u7ed3 \u00b6 Jackson\uff1a \u5f00\u6e90\u514d\u8d39\u7684 JSON \u8f6c\u6362\u5de5\u5177\uff0cSpringMVC \u8f6c\u6362\u9ed8\u8ba4\u4f7f\u7528 Jackson\u3002 \u53ef\u4ee5\u5c06 JAVA \u5bf9\u8c61\u6216\u96c6\u5408\u8f6c\u6362\u6210 JSON \u683c\u5f0f\u7684\u5b57\u7b26\u4e32\uff0c\u4e5f\u53ef\u4ee5\u5c06 JSON \u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u8f6c\u6210 JAVA \u5bf9\u8c61\u3002 \u5e38\u7528\u7c7b 3\u3001\u7efc\u5408\u6848\u4f8b \u641c\u7d22\u8054\u60f3 \u00b6 \u6848\u4f8b\u6548\u679c\u548c\u73af\u5883\u4ecb\u7ecd \u6848\u4f8b\u5206\u6790 \u9875\u9762 \u4e3a\u7528\u6237\u540d\u8f93\u5165\u6846\u7ed1\u5b9a\u9f20\u6807\u70b9\u51fb\u4e8b\u4ef6\u3002 \u83b7\u53d6\u8f93\u5165\u7684\u7528\u6237\u540d\u6570\u636e\u3002 \u5224\u65ad\u7528\u6237\u540d\u662f\u5426\u4e3a\u7a7a\u3002 \u5982\u679c\u4e3a\u7a7a\uff0c\u5219\u5c06\u8054\u60f3\u63d0\u793a\u6846\u9690\u85cf\u3002 \u5982\u679c\u4e0d\u4e3a\u7a7a\uff0c\u5219\u53d1\u9001 AJAX \u8bf7\u6c42\uff0c\u5e76\u5c06\u54cd\u5e94\u7684\u6570\u636e\u663e\u793a\u5230\u8054\u60f3\u6846\u3002 \u63a7\u5236\u5c42 \u83b7\u53d6\u8bf7\u6c42\u53c2\u6570\u3002 \u8c03\u7528\u4e1a\u52a1\u5c42\u7684\u6a21\u7cca\u67e5\u8be2\u65b9\u6cd5\u3002 \u5c06\u8fd4\u56de\u7684\u6570\u636e\u8f6c\u6210 JSON\uff0c\u5e76\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\u3002 \u4ee3\u7801\u5b9e\u73b0 html\u9875\u9762 ```html <!DOCTYPE html> \u7528\u6237\u641c\u7d22","title":"AJAX"},{"location":"ajax/#1ajax","text":"","title":"1\u3001Ajax\u5feb\u901f\u5165\u95e8"},{"location":"ajax/#11ajax","text":"AJAX(Asynchronous JavaScript And XML)\uff1a\u5f02\u6b65\u7684 JavaScript \u548c XML\u3002 \u672c\u8eab\u4e0d\u662f\u4e00\u79cd\u65b0\u6280\u672f\uff0c\u800c\u662f\u591a\u4e2a\u6280\u672f\u7efc\u5408\u3002\u7528\u4e8e\u5feb\u901f\u521b\u5efa\u52a8\u6001\u7f51\u9875\u7684\u6280\u672f\u3002 \u4e00\u822c\u7684\u7f51\u9875\u5982\u679c\u9700\u8981\u66f4\u65b0\u5185\u5bb9\uff0c\u5fc5\u9700\u91cd\u65b0\u52a0\u8f7d\u4e2a\u9875\u9762\u3002 \u800c AJAX \u901a\u8fc7\u6d4f\u89c8\u5668\u4e0e\u670d\u52a1\u5668\u8fdb\u884c\u5c11\u91cf\u6570\u636e\u4ea4\u6362\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7f51\u9875\u5b9e\u73b0\u5f02\u6b65\u66f4\u65b0\u3002\u4e5f\u5c31\u662f\u5728\u4e0d\u91cd\u65b0\u52a0\u8f7d\u6574\u4e2a\u9875 \u9762\u7684\u60c5\u51b5\u4e0b\uff0c\u5bf9\u7f51\u9875\u7684\u90e8\u5206\u5185\u5bb9\u8fdb\u884c \u5c40\u90e8\u66f4\u65b0 \u3002 \u200b \u200b","title":"1.1\u3001AJAX\u4ecb\u7ecd"},{"location":"ajax/#12jsajax","text":"\u4ee3\u7801\u5b9e\u73b0 ```java import javax.servlet.ServletException; import javax.servlet.annotation.WebServlet; import javax.servlet.http.HttpServlet; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import java.io.IOException; @WebServlet(\"/userServlet\") public class UserServlet extends HttpServlet { @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { //\u8bbe\u7f6e\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u4e71\u7801 req.setCharacterEncoding(\"UTF-8\"); resp.setContentType(\"text/html;charset=UTF-8\"); //1.\u83b7\u53d6\u8bf7\u6c42\u53c2\u6570 String username = req.getParameter(\"username\"); //\u6a21\u62df\u670d\u52a1\u5668\u5904\u7406\u8bf7\u6c42\u9700\u89815\u79d2\u949f /*try { Thread.sleep(5000); } catch (InterruptedException e) { e.printStackTrace(); }*/ //2.\u5224\u65ad\u59d3\u540d\u662f\u5426\u5df2\u6ce8\u518c if(\"zhangsan\".equals(username)) { resp.getWriter().write(\" <font color= 'red' > \u7528\u6237\u540d\u5df2\u6ce8\u518c </font> \"); }else { resp.getWriter().write(\" <font color= 'green' > \u7528\u6237\u540d\u53ef\u7528 </font> \"); } } @Override protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { doGet(req,resp); } } ``` html\u4ee3\u7801 ```html \u7528\u6237\u6ce8\u518c \u59d3\u540d\uff1a \u5bc6\u7801\uff1a //1.\u4e3a\u59d3\u540d\u7ed1\u5b9a\u5931\u53bb\u7126\u70b9\u4e8b\u4ef6 document.getElementById(\"username\").onblur = function() { //2.\u521b\u5efaXMLHttpRequest\u6838\u5fc3\u5bf9\u8c61 let xmlHttp = new XMLHttpRequest(); //3.\u6253\u5f00\u94fe\u63a5 let username = document.getElementById(\"username\").value; xmlHttp.open(\"GET\",\"userServlet?username=\"+username,true); //xmlHttp.open(\"GET\",\"userServlet?username=\"+username,false); //4.\u53d1\u9001\u8bf7\u6c42 xmlHttp.send(); //5.\u5904\u7406\u54cd\u5e94 xmlHttp.onreadystatechange = function() { //\u5224\u65ad\u8bf7\u6c42\u548c\u54cd\u5e94\u662f\u5426\u6210\u529f if(xmlHttp.readyState == 4 && xmlHttp.status == 200) { //\u5c06\u54cd\u5e94\u7684\u6570\u636e\u663e\u793a\u5230span\u6807\u7b7e document.getElementById(\"uSpan\").innerHTML = xmlHttp.responseText; } } } ```","title":"1.2\u3001\u539f\u751fJS\u5b9e\u73b0AJAX"},{"location":"ajax/#13jsajax","text":"\u6838\u5fc3\u5bf9\u8c61\uff1aXMLHttpRequest \u200b \u7528\u4e8e\u5728\u540e\u53f0\u4e0e\u670d\u52a1\u5668\u4ea4\u6362\u6570\u636e\u3002\u53ef\u4ee5\u5728\u4e0d\u91cd\u65b0\u52a0\u8f7d\u6574\u4e2a\u7f51\u9875\u7684\u60c5\u51b5\u4e0b\uff0c\u5bf9\u7f51\u9875\u7684\u67d0\u90e8\u5206\u8fdb\u884c\u66f4\u65b0\u3002 \u6253\u5f00\u94fe\u63a5\uff1aopen(method,url,async) \u200b method\uff1a\u8bf7\u6c42\u7684\u7c7b\u578b GET \u6216 POST\u3002 \u200b url\uff1a\u8bf7\u6c42\u8d44\u6e90\u7684\u8def\u5f84\u3002 \u200b async\uff1atrue(\u5f02\u6b65) \u6216 false(\u540c\u6b65)\u3002 \u53d1\u9001\u8bf7\u6c42\uff1asend(String params) \u200b params\uff1a\u8bf7\u6c42\u7684\u53c2\u6570(POST \u4e13\u7528)\u3002 \u5904\u7406\u54cd\u5e94\uff1aonreadystatechange \u200b readyState\uff1a0-\u8bf7\u6c42\u672a\u521d\u59cb\u5316\uff0c1-\u670d\u52a1\u5668\u8fde\u63a5\u5df2\u5efa\u7acb\uff0c2-\u8bf7\u6c42\u5df2\u63a5\u6536\uff0c3-\u8bf7\u6c42\u5904\u7406\u4e2d\uff0c4-\u8bf7\u6c42\u5df2\u5b8c\u6210\uff0c\u4e14\u54cd\u5e94\u5df2\u5c31\u7eea\u3002 \u200b status\uff1a200-\u54cd\u5e94\u5df2\u5168\u90e8 OK\u3002 \u83b7\u5f97\u54cd\u5e94\u6570\u636e\u5f62\u5f0f \u200b responseText\uff1a\u83b7\u5f97\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684\u54cd\u5e94\u6570\u636e\u3002 \u200b responseXML\uff1a\u83b7\u5f97 XML \u5f62\u5f0f\u7684\u54cd\u5e94\u6570\u636e\u3002","title":"1.3\u3001\u539f\u751fJS\u5b9e\u73b0AJAX\u8be6\u89e3"},{"location":"ajax/#14jquerygetajax","text":"\u6838\u5fc3\u8bed\u6cd5\uff1a $.get(url,[data],[callback],[type]); url\uff1a\u8bf7\u6c42\u7684\u8d44\u6e90\u8def\u5f84\u3002 data\uff1a\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7aef\u7684\u8bf7\u6c42\u53c2\u6570\uff0c\u683c\u5f0f\u53ef\u4ee5\u662fkey=value\uff0c\u4e5f\u53ef\u4ee5\u662f js \u5bf9\u8c61\u3002 callback\uff1a\u5f53\u8bf7\u6c42\u6210\u529f\u540e\u7684\u56de\u8c03\u51fd\u6570\uff0c\u53ef\u4ee5\u5728\u51fd\u6570\u4e2d\u7f16\u5199\u6211\u4eec\u7684\u903b\u8f91\u4ee3\u7801\u3002 type\uff1a\u9884\u671f\u7684\u8fd4\u56de\u6570\u636e\u7684\u7c7b\u578b\uff0c\u53d6\u503c\u53ef\u4ee5\u662f xml, html, js, json, text\u7b49\u3002 \u4ee3\u7801\u5b9e\u73b0 ```html \u7528\u6237\u6ce8\u518c \u59d3\u540d\uff1a \u5bc6\u7801\uff1a //1.\u4e3a\u7528\u6237\u540d\u7ed1\u5b9a\u5931\u53bb\u7126\u70b9\u4e8b\u4ef6 $(\"#username\").blur(function () { let username = $(\"#username\").val(); //2.jQuery\u7684GET\u65b9\u5f0f\u5b9e\u73b0AJAX $.get( //\u8bf7\u6c42\u7684\u8d44\u6e90\u8def\u5f84 \"userServlet\", //\u8bf7\u6c42\u53c2\u6570 \"username=\" + username, //\u56de\u8c03\u51fd\u6570 function (data) { //\u5c06\u54cd\u5e94\u7684\u6570\u636e\u663e\u793a\u5230span\u6807\u7b7e $(\"#uSpan\").html(data); }, //\u54cd\u5e94\u6570\u636e\u5f62\u5f0f \"text\" ); }); ```","title":"1.4\u3001JQuery\u7684GET\u65b9\u5f0f\u5b9e\u73b0AJAX"},{"location":"ajax/#15jquerypostajax","text":"\u6838\u5fc3\u8bed\u6cd5\uff1a $.post(url,[data],[callback],[type]); url\uff1a\u8bf7\u6c42\u7684\u8d44\u6e90\u8def\u5f84\u3002 data\uff1a\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7aef\u7684\u8bf7\u6c42\u53c2\u6570\uff0c\u683c\u5f0f\u53ef\u4ee5\u662fkey=value\uff0c\u4e5f\u53ef\u4ee5\u662f js \u5bf9\u8c61\u3002 callback\uff1a\u5f53\u8bf7\u6c42\u6210\u529f\u540e\u7684\u56de\u8c03\u51fd\u6570\uff0c\u53ef\u4ee5\u5728\u51fd\u6570\u4e2d\u7f16\u5199\u6211\u4eec\u7684\u903b\u8f91\u4ee3\u7801\u3002 type\uff1a\u9884\u671f\u7684\u8fd4\u56de\u6570\u636e\u7684\u7c7b\u578b\uff0c\u53d6\u503c\u53ef\u4ee5\u662f xml, html, js, json, text\u7b49\u3002 \u4ee3\u7801\u5b9e\u73b0 ```html \u7528\u6237\u6ce8\u518c \u59d3\u540d\uff1a \u5bc6\u7801\uff1a //1.\u4e3a\u7528\u6237\u540d\u7ed1\u5b9a\u5931\u53bb\u7126\u70b9\u4e8b\u4ef6 $(\"#username\").blur(function () { let username = $(\"#username\").val(); //2.jQuery\u7684POST\u65b9\u5f0f\u5b9e\u73b0AJAX $.post( //\u8bf7\u6c42\u7684\u8d44\u6e90\u8def\u5f84 \"userServlet\", //\u8bf7\u6c42\u53c2\u6570 \"username=\" + username, //\u56de\u8c03\u51fd\u6570 function (data) { //\u5c06\u54cd\u5e94\u7684\u6570\u636e\u663e\u793a\u5230span\u6807\u7b7e $(\"#uSpan\").html(data); }, //\u54cd\u5e94\u6570\u636e\u5f62\u5f0f \"text\" ); }); ```","title":"1.5\u3001JQuery\u7684POST\u65b9\u5f0f\u5b9e\u73b0AJAX"},{"location":"ajax/#16jqueryajax","text":"\u6838\u5fc3\u8bed\u6cd5\uff1a $.ajax({name:value,name:value,\u2026}); url\uff1a\u8bf7\u6c42\u7684\u8d44\u6e90\u8def\u5f84\u3002 async\uff1a\u662f\u5426\u5f02\u6b65\u8bf7\u6c42\uff0ctrue-\u662f\uff0cfalse-\u5426 (\u9ed8\u8ba4\u662f true)\u3002 data\uff1a\u53d1\u9001\u5230\u670d\u52a1\u5668\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u662f\u952e\u503c\u5bf9\u5f62\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u662f js \u5bf9\u8c61\u5f62\u5f0f\u3002 type\uff1a\u8bf7\u6c42\u65b9\u5f0f\uff0cPOST \u6216 GET (\u9ed8\u8ba4\u662f GET)\u3002 dataType\uff1a\u9884\u671f\u7684\u8fd4\u56de\u6570\u636e\u7684\u7c7b\u578b\uff0c\u53d6\u503c\u53ef\u4ee5\u662f xml, html, js, json, text\u7b49\u3002 success\uff1a\u8bf7\u6c42\u6210\u529f\u65f6\u8c03\u7528\u7684\u56de\u8c03\u51fd\u6570\u3002 error\uff1a\u8bf7\u6c42\u5931\u8d25\u65f6\u8c03\u7528\u7684\u56de\u8c03\u51fd\u6570\u3002 \u4ee3\u7801\u5b9e\u73b0 ```html \u7528\u6237\u6ce8\u518c \u59d3\u540d\uff1a \u5bc6\u7801\uff1a //1.\u4e3a\u7528\u6237\u540d\u7ed1\u5b9a\u5931\u53bb\u7126\u70b9\u4e8b\u4ef6 $(\"#username\").blur(function () { let username = $(\"#username\").val(); //2.jQuery\u7684\u901a\u7528\u65b9\u5f0f\u5b9e\u73b0AJAX $.ajax({ //\u8bf7\u6c42\u8d44\u6e90\u8def\u5f84 url:\"userServletxxx\", //\u662f\u5426\u5f02\u6b65 async:true, //\u8bf7\u6c42\u53c2\u6570 data:\"username=\"+username, //\u8bf7\u6c42\u65b9\u5f0f type:\"POST\", //\u6570\u636e\u5f62\u5f0f dataType:\"text\", //\u8bf7\u6c42\u6210\u529f\u540e\u8c03\u7528\u7684\u56de\u8c03\u51fd\u6570 success:function (data) { //\u5c06\u54cd\u5e94\u7684\u6570\u636e\u663e\u793a\u5230span\u6807\u7b7e $(\"#uSpan\").html(data); }, //\u8bf7\u6c42\u5931\u8d25\u540e\u8c03\u7528\u7684\u56de\u8c03\u51fd\u6570 error:function () { alert(\"\u64cd\u4f5c\u5931\u8d25...\"); } }); }); ```","title":"1.6\u3001JQuery\u7684\u901a\u7528\u65b9\u5f0f\u5b9e\u73b0AJAX"},{"location":"ajax/#17","text":"AJAX(Asynchronous JavaScript And XML)\uff1a \u5f02\u6b65\u7684 JavaScript \u548c XML\u3002 \u901a\u8fc7\u6d4f\u89c8\u5668\u4e0e\u670d\u52a1\u5668\u8fdb\u884c\u5c11\u91cf\u6570\u636e\u4ea4\u6362\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7f51\u9875\u5b9e\u73b0\u5f02\u6b65\u66f4\u65b0\u3002\u4e5f\u5c31\u662f\u5728\u4e0d\u91cd\u65b0\u52a0\u8f7d\u6574\u4e2a\u9875\u9762\u7684\u60c5\u51b5\u4e0b\uff0c\u5bf9\u7f51\u9875\u7684\u90e8 \u5206\u5185\u5bb9\u8fdb\u884c\u5c40\u90e8\u66f4\u65b0\u3002 \u540c\u6b65\u548c\u5f02\u6b65 \u540c\u6b65\uff1a\u670d\u52a1\u5668\u7aef\u5728\u5904\u7406\u8fc7\u7a0b\u4e2d\uff0c\u65e0\u6cd5\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\u3002 \u5f02\u6b65\uff1a\u670d\u52a1\u5668\u7aef\u5728\u5904\u7406\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u4ee5\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\u3002 GET \u65b9\u5f0f\u5b9e\u73b0\uff1a $.get(); POST \u65b9\u5f0f\u5b9e\u73b0\uff1a $.post(); url\uff1a\u8bf7\u6c42\u7684\u8d44\u6e90\u8def\u5f84\u3002 data\uff1a\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7aef\u7684\u8bf7\u6c42\u53c2\u6570\uff0c\u683c\u5f0f\u53ef\u4ee5\u662fkey=value\uff0c\u4e5f\u53ef\u4ee5\u662f js \u5bf9\u8c61\u3002 callback\uff1a\u5f53\u8bf7\u6c42\u6210\u529f\u540e\u7684\u56de\u8c03\u51fd\u6570\uff0c\u53ef\u4ee5\u5728\u51fd\u6570\u4e2d\u7f16\u5199\u6211\u4eec\u7684\u903b\u8f91\u4ee3\u7801\u3002 type\uff1a\u9884\u671f\u7684\u8fd4\u56de\u6570\u636e\u7684\u7c7b\u578b\uff0c\u53d6\u503c\u53ef\u4ee5\u662f xml, html, js, json, text\u7b49\u3002 \u901a\u7528\u65b9\u5f0f\u5b9e\u73b0\uff1a $.ajax(); url\uff1a\u8bf7\u6c42\u7684\u8d44\u6e90\u8def\u5f84\u3002 async\uff1a\u662f\u5426\u5f02\u6b65\u8bf7\u6c42\uff0ctrue-\u662f\uff0cfalse-\u5426 (\u9ed8\u8ba4\u662f true)\u3002 data\uff1a\u53d1\u9001\u5230\u670d\u52a1\u5668\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u662f\u952e\u503c\u5bf9\u5f62\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u662f js \u5bf9\u8c61\u5f62\u5f0f\u3002 type\uff1a\u8bf7\u6c42\u65b9\u5f0f\uff0cPOST \u6216 GET (\u9ed8\u8ba4\u662f GET)\u3002 dataType\uff1a\u9884\u671f\u7684\u8fd4\u56de\u6570\u636e\u7684\u7c7b\u578b\uff0c\u53d6\u503c\u53ef\u4ee5\u662f xml, html, js, json, text\u7b49\u3002 success\uff1a\u8bf7\u6c42\u6210\u529f\u65f6\u8c03\u7528\u7684\u56de\u8c03\u51fd\u6570\u3002 error\uff1a\u8bf7\u6c42\u5931\u8d25\u65f6\u8c03\u7528\u7684\u56de\u8c03\u51fd\u6570\u3002","title":"1.7\u3001\u5c0f\u7ed3"},{"location":"ajax/#2json","text":"","title":"2\u3001JSON\u7684\u5904\u7406"},{"location":"ajax/#21json","text":"JSON(JavaScript Object Notation)\uff1a\u662f\u4e00\u79cd\u8f7b\u91cf\u7ea7\u7684\u6570\u636e\u4ea4\u6362\u683c\u5f0f\u3002 \u5b83\u662f\u57fa\u4e8e ECMAScript \u89c4\u8303\u7684\u4e00\u4e2a\u5b50\u96c6\uff0c\u91c7\u7528\u5b8c\u5168\u72ec\u7acb\u4e8e\u7f16\u7a0b\u8bed\u8a00\u7684\u6587\u672c\u683c\u5f0f\u6765\u5b58\u50a8\u548c\u8868\u793a\u6570\u636e\u3002 \u7b80\u6d01\u548c\u6e05\u6670\u7684\u5c42\u6b21\u7ed3\u6784\u4f7f\u5f97 JSON \u6210\u4e3a\u7406\u60f3\u7684\u6570\u636e\u4ea4\u6362\u8bed\u8a00\u3002\u6613\u4e8e\u4eba\u9605\u8bfb\u548c\u7f16\u5199\uff0c\u540c\u65f6\u4e5f\u6613\u4e8e\u8ba1\u7b97\u673a\u89e3\u6790\u548c\u751f\u6210\uff0c\u5e76\u6709\u6548\u7684 \u63d0\u5347\u7f51\u7edc\u4f20\u8f93\u6548\u7387\u3002 \u521b\u5efa\u683c\u5f0f \u5e38\u7528\u65b9\u6cd5","title":"2.1\u3001JSON\u56de\u987e"},{"location":"ajax/#22json","text":"\u6211\u4eec\u9664\u4e86\u53ef\u4ee5\u5728 JavaScript \u4e2d\u6765\u4f7f\u7528 JSON \u4ee5\u5916\uff0c\u5728 JAVA \u4e2d\u540c\u6837\u4e5f\u53ef\u4ee5\u4f7f\u7528 JSON\u3002 JSON \u7684\u8f6c\u6362\u5de5\u5177\u662f\u901a\u8fc7 JAVA \u5c01\u88c5\u597d\u7684\u4e00\u4e9b JAR \u5de5\u5177\u5305\u3002 \u53ef\u4ee5\u5c06 JAVA \u5bf9\u8c61\u6216\u96c6\u5408\u8f6c\u6362\u6210 JSON \u683c\u5f0f\u7684\u5b57\u7b26\u4e32\uff0c\u4e5f\u53ef\u4ee5\u5c06 JSON \u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u8f6c\u6210 JAVA \u5bf9\u8c61\u3002 Jackson\uff1a\u5f00\u6e90\u514d\u8d39\u7684 JSON \u8f6c\u6362\u5de5\u5177\uff0cSpringMVC \u8f6c\u6362\u9ed8\u8ba4\u4f7f\u7528 Jackson\u3002 \u5bfc\u5165 jar \u5305\u3002 \u521b\u5efa\u6838\u5fc3\u5bf9\u8c61\u3002 \u8c03\u7528\u65b9\u6cd5\u5b8c\u6210\u8f6c\u6362\u3002 \u5e38\u7528\u7c7b ObjectMapper\u5e38\u7528\u65b9\u6cd5","title":"2.2\u3001JSON\u8f6c\u6362\u5de5\u5177\u7684\u4ecb\u7ecd"},{"location":"ajax/#23json","text":"\u5bf9\u8c61\u8f6c JSON, JSON \u8f6c\u5bf9\u8c61\u3002 ```java / JSON\u8f6c\u6362\u5de5\u5177\u7684\u4f7f\u7528 / public class ObjectMapperTest { private ObjectMapper mapper = new ObjectMapper(); / 1.User\u5bf9\u8c61\u8f6cjson, json\u8f6cUser\u5bf9\u8c61 json\u5b57\u7b26\u4e32 = {\"name\":\"\u5f20\u4e09\",\"age\":23} user\u5bf9\u8c61 = User{name='\u5f20\u4e09', age=23} / @Test public void test01() throws Exception{ //User\u5bf9\u8c61\u8f6cjson User user = new User(\"\u5f20\u4e09\",23); String json = mapper.writeValueAsString(user); System.out.println(\"json\u5b57\u7b26\u4e32\uff1a\" + json); //json\u8f6cUser\u5bf9\u8c61 User user2 = mapper.readValue(json, User.class); System.out.println(\"java\u5bf9\u8c61\uff1a\" + user2); } } ``` Map\u8f6c JSON, JSON \u8f6c Map\u3002 ```java / 2.map \u8f6cjson, json\u8f6cmap json\u5b57\u7b26\u4e32 = {\"\u59d3\u540d\":\"\u5f20\u4e09\",\"\u6027\u522b\":\"\u7537\"} map\u5bf9\u8c61 = {\u59d3\u540d=\u5f20\u4e09, \u6027\u522b=\u7537} / @Test public void test02() throws Exception{ //map \u8f6cjson HashMap map = new HashMap<>(); map.put(\"\u59d3\u540d\",\"\u5f20\u4e09\"); map.put(\"\u6027\u522b\",\"\u7537\"); String json = mapper.writeValueAsString(map); System.out.println(\"json\u5b57\u7b26\u4e32\uff1a\" + json); //json\u8f6cmap<String,String> HashMap<String,String> map2 = mapper.readValue(json, HashMap.class); System.out.println(\"java\u5bf9\u8c61\uff1a\" + map2); } ``` Map\u8f6c JSON, JSON \u8f6c Map\u3002 ```java / 3.map \u8f6cjson, json\u8f6cmap json\u5b57\u7b26\u4e32 = {\"\u9ed1\u9a6c\u4e00\u73ed\":{\"name\":\"\u5f20\u4e09\",\"age\":23},\"\u9ed1\u9a6c\u4e8c\u73ed\":{\"name\":\"\u674e\u56db\",\"age\":24}} map\u5bf9\u8c61 = {\u9ed1\u9a6c\u4e00\u73ed=User{name='\u5f20\u4e09', age=23}, \u9ed1\u9a6c\u4e8c\u73ed=User{name='\u674e\u56db', age=24}} / @Test public void test03() throws Exception{ //map \u8f6cjson HashMap map = new HashMap<>(); map.put(\"\u9ed1\u9a6c\u4e00\u73ed\",new User(\"\u5f20\u4e09\",23)); map.put(\"\u9ed1\u9a6c\u4e8c\u73ed\",new User(\"\u674e\u56db\",24)); String json = mapper.writeValueAsString(map); System.out.println(\"json\u5b57\u7b26\u4e32\uff1a\" + json); //json\u8f6cmap<String,User> HashMap<String,User> map2 = mapper.readValue(json,new TypeReference<HashMap<String,User>>(){}); System.out.println(\"java\u5bf9\u8c61\uff1a\" + map2); } ``` List\u8f6c JSON, JSON \u8f6c List\u3002 ```java / 4.List \u8f6cjson, json\u8f6c List json\u5b57\u7b26\u4e32 = [\"\u5f20\u4e09\",\"\u674e\u56db\"] list\u5bf9\u8c61 = [\u5f20\u4e09, \u674e\u56db] / @Test public void test04() throws Exception{ //List \u8f6cjson ArrayList list = new ArrayList<>(); list.add(\"\u5f20\u4e09\"); list.add(\"\u674e\u56db\"); String json = mapper.writeValueAsString(list); System.out.println(\"json\u5b57\u7b26\u4e32\uff1a\" + json); //json\u8f6c List<String> ArrayList<String> list2 = mapper.readValue(json,ArrayList.class); System.out.println(\"java\u5bf9\u8c61\uff1a\" + list2); } ``` List\u8f6c JSON, JSON \u8f6c List\u3002 ```java / 5.List \u8f6cjson, json\u8f6cList json\u5b57\u7b26\u4e32 = [{\"name\":\"\u5f20\u4e09\",\"age\":23},{\"name\":\"\u674e\u56db\",\"age\":24}] list\u5bf9\u8c61 = [User{name='\u5f20\u4e09', age=23}, User{name='\u674e\u56db', age=24}] / @Test public void test05() throws Exception{ //List \u8f6cjson ArrayList list = new ArrayList<>(); list.add(new User(\"\u5f20\u4e09\",23)); list.add(new User(\"\u674e\u56db\",24)); String json = mapper.writeValueAsString(list); System.out.println(\"json\u5b57\u7b26\u4e32\uff1a\" + json); //json\u8f6cList<User> ArrayList<User> list2 = mapper.readValue(json,new TypeReference<ArrayList<User>>(){}); System.out.println(\"java\u5bf9\u8c61\uff1a\" + list2); } ```","title":"2.3\u3001JSON\u8f6c\u6362\u7ec3\u4e60"},{"location":"ajax/#24","text":"Jackson\uff1a \u5f00\u6e90\u514d\u8d39\u7684 JSON \u8f6c\u6362\u5de5\u5177\uff0cSpringMVC \u8f6c\u6362\u9ed8\u8ba4\u4f7f\u7528 Jackson\u3002 \u53ef\u4ee5\u5c06 JAVA \u5bf9\u8c61\u6216\u96c6\u5408\u8f6c\u6362\u6210 JSON \u683c\u5f0f\u7684\u5b57\u7b26\u4e32\uff0c\u4e5f\u53ef\u4ee5\u5c06 JSON \u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u8f6c\u6210 JAVA \u5bf9\u8c61\u3002 \u5e38\u7528\u7c7b","title":"2.4\u3001\u5c0f\u7ed3"},{"location":"ajax/#3","text":"\u6848\u4f8b\u6548\u679c\u548c\u73af\u5883\u4ecb\u7ecd \u6848\u4f8b\u5206\u6790 \u9875\u9762 \u4e3a\u7528\u6237\u540d\u8f93\u5165\u6846\u7ed1\u5b9a\u9f20\u6807\u70b9\u51fb\u4e8b\u4ef6\u3002 \u83b7\u53d6\u8f93\u5165\u7684\u7528\u6237\u540d\u6570\u636e\u3002 \u5224\u65ad\u7528\u6237\u540d\u662f\u5426\u4e3a\u7a7a\u3002 \u5982\u679c\u4e3a\u7a7a\uff0c\u5219\u5c06\u8054\u60f3\u63d0\u793a\u6846\u9690\u85cf\u3002 \u5982\u679c\u4e0d\u4e3a\u7a7a\uff0c\u5219\u53d1\u9001 AJAX \u8bf7\u6c42\uff0c\u5e76\u5c06\u54cd\u5e94\u7684\u6570\u636e\u663e\u793a\u5230\u8054\u60f3\u6846\u3002 \u63a7\u5236\u5c42 \u83b7\u53d6\u8bf7\u6c42\u53c2\u6570\u3002 \u8c03\u7528\u4e1a\u52a1\u5c42\u7684\u6a21\u7cca\u67e5\u8be2\u65b9\u6cd5\u3002 \u5c06\u8fd4\u56de\u7684\u6570\u636e\u8f6c\u6210 JSON\uff0c\u5e76\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\u3002 \u4ee3\u7801\u5b9e\u73b0 html\u9875\u9762 ```html <!DOCTYPE html> \u7528\u6237\u641c\u7d22","title":"3\u3001\u7efc\u5408\u6848\u4f8b \u641c\u7d22\u8054\u60f3"},{"location":"docker/1/","text":"\u521d\u8bc6 Docker \u00b6 1.1\u5b89\u88c5docker \u00b6 Docker\u53ef\u4ee5\u8fd0\u884c\u5728MAC\u3001Windows\u3001CentOS\u3001UBUNTU\u7b49\u64cd\u4f5c\u7cfb\u7edf\u4e0a\uff0c\u672c\u8bfe\u7a0b\u57fa\u4e8eCentOS 7 \u5b89\u88c5 Docker\u3002\u5b98\u7f51\uff1ahttps://www.docker.com # 1\u3001yum \u5305\u66f4\u65b0\u5230\u6700\u65b0 yum update # 2\u3001\u5b89\u88c5\u9700\u8981\u7684\u8f6f\u4ef6\u5305\uff0c yum-util \u63d0\u4f9byum-config-manager\u529f\u80fd\uff0c\u53e6\u5916\u4e24\u4e2a\u662fdevicemapper\u9a71\u52a8\u4f9d\u8d56\u7684 yum install -y yum-utils device-mapper-persistent-data lvm2 # 3\u3001 \u8bbe\u7f6eyum\u6e90 yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo # 4\u3001 \u5b89\u88c5docker\uff0c\u51fa\u73b0\u8f93\u5165\u7684\u754c\u9762\u90fd\u6309 y yum install -y docker-ce # 5\u3001 \u67e5\u770bdocker\u7248\u672c\uff0c\u9a8c\u8bc1\u662f\u5426\u9a8c\u8bc1\u6210\u529f docker -v 1.2\u914d\u7f6e Docker \u955c\u50cf\u52a0\u901f\u5668 \u00b6","title":"\u521d\u8bc6 Docker"},{"location":"docker/1/#docker","text":"","title":"\u521d\u8bc6 Docker"},{"location":"docker/1/#11docker","text":"Docker\u53ef\u4ee5\u8fd0\u884c\u5728MAC\u3001Windows\u3001CentOS\u3001UBUNTU\u7b49\u64cd\u4f5c\u7cfb\u7edf\u4e0a\uff0c\u672c\u8bfe\u7a0b\u57fa\u4e8eCentOS 7 \u5b89\u88c5 Docker\u3002\u5b98\u7f51\uff1ahttps://www.docker.com # 1\u3001yum \u5305\u66f4\u65b0\u5230\u6700\u65b0 yum update # 2\u3001\u5b89\u88c5\u9700\u8981\u7684\u8f6f\u4ef6\u5305\uff0c yum-util \u63d0\u4f9byum-config-manager\u529f\u80fd\uff0c\u53e6\u5916\u4e24\u4e2a\u662fdevicemapper\u9a71\u52a8\u4f9d\u8d56\u7684 yum install -y yum-utils device-mapper-persistent-data lvm2 # 3\u3001 \u8bbe\u7f6eyum\u6e90 yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo # 4\u3001 \u5b89\u88c5docker\uff0c\u51fa\u73b0\u8f93\u5165\u7684\u754c\u9762\u90fd\u6309 y yum install -y docker-ce # 5\u3001 \u67e5\u770bdocker\u7248\u672c\uff0c\u9a8c\u8bc1\u662f\u5426\u9a8c\u8bc1\u6210\u529f docker -v","title":"1.1\u5b89\u88c5docker"},{"location":"docker/1/#12_docker","text":"","title":"1.2\u914d\u7f6e Docker \u955c\u50cf\u52a0\u901f\u5668"},{"location":"docker/2/","text":"docker\u547d\u4ee4 \u00b6 2.1 \u8fdb\u7a0b\u76f8\u5173\u547d\u4ee4 \u00b6 \u5173\u4e8e\u8fdb\u7a0b\u76f8\u5173\u7684\u547d\u4ee4 2.1.1 \u542f\u52a8docker\u670d\u52a1 \u00b6 systemctl start docker 2.1.2 \u505c\u6b62docker\u670d\u52a1 \u00b6 systemctl stop docker 2.1.3 \u91cd\u542fdocker\u670d\u52a1 \u00b6 systemctl restart docker 2.1.4 \u67e5\u770bdocker\u670d\u52a1\u72b6\u6001 \u00b6 systemctl status docker 2.1.5 \u5f00\u673a\u542f\u52a8docker\u670d\u52a1 \u00b6 systemctl enable docker 2.2 Docker \u955c\u50cf\u76f8\u5173\u547d\u4ee4 \u00b6 2.2.1 \u67e5\u770b\u955c\u50cf \u00b6 \u67e5\u770b\u672c\u5730\u6240\u6709\u7684\u955c\u50cf docker images docker images \u2013q # \u67e5\u770b\u6240\u7528\u955c\u50cf\u7684id REPOSITORY\uff1a\u955c\u50cf\u540d\u79f0 TAG\uff1a\u955c\u50cf\u6807\u7b7e IMAGE ID\uff1a\u955c\u50cfID CREATED\uff1a\u955c\u50cf\u7684\u521b\u5efa\u65e5\u671f SIZE\uff1a\u955c\u50cf\u5927\u5c0f 2.2.2 \u641c\u7d22\u955c\u50cf \u00b6 \u4ece\u7f51\u7edc\u4e2d\u67e5\u627e\u9700\u8981\u7684\u955c\u50cf docker search \u955c\u50cf\u540d\u79f0 NAME\uff1a\u955c\u50cf\u540d\u79f0 DESCRIPTION\uff1a\u955c\u50cf\u63cf\u8ff0 STARS\uff1a\u7528\u6237\u8bc4\u4ef7\uff0c\u53cd\u5e94\u4e00\u4e2a\u955c\u50cf\u7684\u53d7\u6b22\u8fce\u7a0b\u5ea6 OFFICIAL\uff1a\u662f\u5426\u5b98\u65b9 AUTOMATED\uff1a\u81ea\u52a8\u6784\u5efa\uff0c\u8868\u793a\u8be5\u955c\u50cf\u7531Docker Hub\u81ea\u52a8\u6784\u5efa\u6d41\u7a0b\u521b\u5efa\u7684 2.2.3 \u62c9\u53d6\u955c\u50cf \u00b6 \u4eceDocker\u4ed3\u5e93\u4e0b\u8f7d\u955c\u50cf\u5230\u672c\u5730\uff0c\u955c\u50cf\u540d\u79f0\u683c\u5f0f\u4e3a \u540d\u79f0:\u7248\u672c\u53f7\uff0c\u5982\u679c\u7248\u672c\u53f7\u4e0d\u6307\u5b9a\u5219\u662f\u6700\u65b0\u7684\u7248\u672c\u3002 \u5982\u679c\u4e0d\u77e5\u9053\u955c\u50cf\u7248\u672c\uff0c\u53ef\u4ee5\u53bbdocker hub \u641c\u7d22\u5bf9\u5e94\u955c\u50cf\u67e5\u770b\u3002 docker pull \u955c\u50cf\u540d\u79f0 2.2.4 \u5220\u9664\u955c\u50cf \u00b6 \u5220\u9664\u672c\u5730\u955c\u50cf docker rmi \u955c\u50cfid # \u5220\u9664\u6307\u5b9a\u672c\u5730\u955c\u50cf docker rmi ` docker images -q ` # \u5220\u9664\u6240\u6709\u672c\u5730\u955c\u50cf \u5173\u4e8edocker\u66f4\u591a\u547d\u4ee4\uff0c \u5927\u5bb6\u53ef\u4ee5\u83dc\u9e1f\u6559\u7a0b\u67e5\u770b, \u7f51\u5740\uff1a https://www.runoob.com/docker/docker-command-manual.html 2.3 \u5bb9\u5668\u76f8\u5173\u7684\u547d\u4ee4 \u00b6 2.3.1 \u67e5\u770b\u5bb9\u5668 \u00b6 docker ps # \u67e5\u770b\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668 docker ps -a # \u67e5\u770b\u6240\u6709\u5bb9\u5668\uff0c\u5305\u62ec\u6b63\u5728\u8fd0\u884c\u548c\u505c\u6b62\u7684\u5bb9\u5668 2.3.2 \u521b\u5efa\u5e76\u542f\u52a8\u5bb9\u5668 \u00b6 docker run \u53c2\u6570 \u53c2\u6570\u8bf4\u660e\uff1a \u2022 -i\uff1a\u4fdd\u6301\u5bb9\u5668\u8fd0\u884c\u3002\u901a\u5e38\u4e0e -t \u540c\u65f6\u4f7f\u7528\u3002\u52a0\u5165it\u8fd9\u4e24\u4e2a\u53c2\u6570\u540e\uff0c\u5bb9\u5668\u521b\u5efa\u540e\u81ea\u52a8\u8fdb\u5165\u5bb9\u5668\u4e2d\uff0c\u9000\u51fa\u5bb9\u5668\u540e\uff0c\u5bb9\u5668\u81ea\u52a8\u5173\u95ed\u3002 \u2022 -t\uff1a\u4e3a\u5bb9\u5668\u91cd\u65b0\u5206\u914d\u4e00\u4e2a\u4f2a\u8f93\u5165\u7ec8\u7aef\uff0c\u901a\u5e38\u4e0e -i \u540c\u65f6\u4f7f\u7528\u3002 \u2022 -d\uff1a\u4ee5\u5b88\u62a4\uff08\u540e\u53f0\uff09\u6a21\u5f0f\u8fd0\u884c\u5bb9\u5668\u3002\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\u5728\u540e\u53f0\u8fd0\u884c\uff0c\u9700\u8981\u4f7f\u7528docker exec \u8fdb\u5165\u5bb9\u5668\u3002\u9000\u51fa\u540e\uff0c\u5bb9\u5668\u4e0d\u4f1a\u5173\u95ed\u3002 \u2022 -it \u521b\u5efa\u7684\u5bb9\u5668\u4e00\u822c\u79f0\u4e3a\u4ea4\u4e92\u5f0f\u5bb9\u5668\uff0c-id \u521b\u5efa\u7684\u5bb9\u5668\u4e00\u822c\u79f0\u4e3a\u5b88\u62a4\u5f0f\u5bb9\u5668 \u2022 --name\uff1a\u4e3a\u521b\u5efa\u7684\u5bb9\u5668\u547d\u540d\u3002 1\uff09\u4ea4\u4e92\u5f0f\u5bb9\u5668 \u4ee5 \u4ea4\u4e92\u5f0f \u65b9\u5f0f\u521b\u5efa\u5e76\u542f\u52a8\u5bb9\u5668\uff0c\u542f\u52a8\u5b8c\u6210\u540e\uff0c\u76f4\u63a5\u8fdb\u5165\u5f53\u524d\u5bb9\u5668\u3002\u4f7f\u7528exit\u547d\u4ee4\u9000\u51fa\u5bb9\u5668\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\u4ee5\u6b64\u79cd\u65b9\u5f0f \u542f\u52a8\u5bb9\u5668\uff0c\u5982\u679c\u9000\u51fa\u5bb9\u5668\uff0c\u5219\u5bb9\u5668\u4f1a\u8fdb\u5165 \u505c\u6b62 \u72b6\u6001\u3002 # \u5148\u62c9\u53d6\u4e00\u4e2a\u955c\u50cf\uff1b\u8fd9\u4e00\u6b65\u4e0d\u662f\u6bcf\u6b21\u542f\u52a8\u5bb9\u5668\u90fd\u8981\u505a\u7684\uff0c\u800c\u662f\u56e0\u4e3a\u524d\u9762\u6211\u4eec\u5220\u9664\u4e86\u955c\u50cf\uff0c\u65e0\u955c\u50cf\u53ef\u7528\u6240\u4ee5\u624d\u518d\u62c9\u53d6\u4e00\u4e2a docker pull centos:7 #\u521b\u5efa\u5e76\u542f\u52a8\u540d\u79f0\u4e3a mycentos7 \u7684\u4ea4\u4e92\u5f0f\u5bb9\u5668\uff1b\u4e0b\u9762\u6307\u4ee4\u4e2d\u7684\u955c\u50cf\u540d\u79f0 centos:7 \u4e5f\u53ef\u4ee5\u4f7f\u7528\u955c\u50cfid docker run -it --name = mycentos7 centos:7 /bin/bash 2\uff09\u5b88\u62a4\u5f0f\u5bb9\u5668 \u521b\u5efa\u4e00\u4e2a\u5b88\u62a4\u5f0f\u5bb9\u5668\uff1b\u5982\u679c\u5bf9\u4e8e\u4e00\u4e2a\u9700\u8981\u957f\u671f\u8fd0\u884c\u7684\u5bb9\u5668\u6765\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u5b88\u62a4\u5f0f\u5bb9\u5668\u3002\u547d\u4ee4\u5982\u4e0b\uff08\u5bb9\u5668\u540d\u79f0 \u4e0d\u80fd\u91cd\u590d\uff09\uff1a #\u521b\u5efa\u5e76\u542f\u52a8\u5b88\u62a4\u5f0f\u5bb9\u5668 docker run -di --name = mycentos2 centos:7 #\u767b\u5f55\u8fdb\u5165\u5bb9\u5668\u547d\u4ee4\u4e3a\uff1adocker exec -it container_name (\u6216\u8005 container_id) /bin/bash\uff08exit\u9000\u51fa \u65f6\uff0c\u5bb9\u5668\u4e0d\u4f1a\u505c\u6b62\uff09 docker exec -it mycentos2 /bin/bash 2.3.3 \u8fdb\u5165\u5bb9\u5668 \u00b6 docker exec \u53c2\u6570 # \u9000\u51fa\u5bb9\u5668\uff0c\u5bb9\u5668\u4e0d\u4f1a\u5173\u95ed eg: docker exec -it mycentos2 /bin/bash 2.3.4 \u505c\u6b62\u5bb9\u5668 \u00b6 docker stop \u5bb9\u5668\u540d\u79f0\u6216\u8005\u5bb9\u5668id 2.3.5 \u542f\u52a8\u5bb9\u5668 \u00b6 docker start \u5bb9\u5668\u540d\u79f0\u6216\u8005\u5bb9\u5668id 2.3.6 \u5220\u9664\u5bb9\u5668 \u00b6 #\u5220\u9664\u6307\u5b9a\u5bb9\u5668 docker rm \u5bb9\u5668\u540d\u79f0\u6216\u8005\u5bb9\u5668id # \u5220\u9664\u6240\u6709\u5bb9\u5668\uff1a docker rm ` docker ps -a -q ` \u6ce8\u610f\uff1a\u5982\u679c\u5bb9\u5668\u662f\u8fd0\u884c\u72b6\u6001\u5219\u5220\u9664\u5931\u8d25\uff0c\u9700\u8981\u505c\u6b62\u5bb9\u5668\u624d\u80fd\u5220\u9664 2.3. 7 \u67e5\u770b\u5bb9\u5668\u4fe1\u606f \u00b6 docker inspect \u5bb9\u5668\u540d\u79f0\u6216\u8005\u5bb9\u5668id \u8bf4\u660e\uff1a\u5bb9\u5668\u4e4b\u95f4\u5728\u4e00\u4e2a\u5c40\u57df\u7f51\u5185\uff0clinux\u5bbf\u4e3b\u673a\u5668\u53ef\u4ee5\u4e0e\u5bb9\u5668\u8fdb\u884c\u901a\u4fe1\uff1b\u4f46\u662f\u5916\u90e8\u7684\u7269\u7406\u673a\u7b14\u8bb0\u672c\u662f\u4e0d\u80fd\u4e0e\u5bb9\u5668\u76f4\u63a5\u901a\u4fe1\u7684\uff0c\u5982\u679c\u9700\u8981\u5219\u9700\u8981\u901a\u8fc7\u5bbf\u4e3b\u673a\u5668\u7aef\u53e3\u7684\u4ee3\u7406\u3002","title":"docker\u547d\u4ee4"},{"location":"docker/2/#docker","text":"","title":"docker\u547d\u4ee4"},{"location":"docker/2/#21","text":"\u5173\u4e8e\u8fdb\u7a0b\u76f8\u5173\u7684\u547d\u4ee4","title":"2.1 \u8fdb\u7a0b\u76f8\u5173\u547d\u4ee4"},{"location":"docker/2/#211_docker","text":"systemctl start docker","title":"2.1.1 \u542f\u52a8docker\u670d\u52a1"},{"location":"docker/2/#212_docker","text":"systemctl stop docker","title":"2.1.2 \u505c\u6b62docker\u670d\u52a1"},{"location":"docker/2/#213_docker","text":"systemctl restart docker","title":"2.1.3 \u91cd\u542fdocker\u670d\u52a1"},{"location":"docker/2/#214_docker","text":"systemctl status docker","title":"2.1.4 \u67e5\u770bdocker\u670d\u52a1\u72b6\u6001"},{"location":"docker/2/#215_docker","text":"systemctl enable docker","title":"2.1.5 \u5f00\u673a\u542f\u52a8docker\u670d\u52a1"},{"location":"docker/2/#22_docker","text":"","title":"2.2 Docker \u955c\u50cf\u76f8\u5173\u547d\u4ee4"},{"location":"docker/2/#221","text":"\u67e5\u770b\u672c\u5730\u6240\u6709\u7684\u955c\u50cf docker images docker images \u2013q # \u67e5\u770b\u6240\u7528\u955c\u50cf\u7684id REPOSITORY\uff1a\u955c\u50cf\u540d\u79f0 TAG\uff1a\u955c\u50cf\u6807\u7b7e IMAGE ID\uff1a\u955c\u50cfID CREATED\uff1a\u955c\u50cf\u7684\u521b\u5efa\u65e5\u671f SIZE\uff1a\u955c\u50cf\u5927\u5c0f","title":"2.2.1 \u67e5\u770b\u955c\u50cf"},{"location":"docker/2/#222","text":"\u4ece\u7f51\u7edc\u4e2d\u67e5\u627e\u9700\u8981\u7684\u955c\u50cf docker search \u955c\u50cf\u540d\u79f0 NAME\uff1a\u955c\u50cf\u540d\u79f0 DESCRIPTION\uff1a\u955c\u50cf\u63cf\u8ff0 STARS\uff1a\u7528\u6237\u8bc4\u4ef7\uff0c\u53cd\u5e94\u4e00\u4e2a\u955c\u50cf\u7684\u53d7\u6b22\u8fce\u7a0b\u5ea6 OFFICIAL\uff1a\u662f\u5426\u5b98\u65b9 AUTOMATED\uff1a\u81ea\u52a8\u6784\u5efa\uff0c\u8868\u793a\u8be5\u955c\u50cf\u7531Docker Hub\u81ea\u52a8\u6784\u5efa\u6d41\u7a0b\u521b\u5efa\u7684","title":"2.2.2 \u641c\u7d22\u955c\u50cf"},{"location":"docker/2/#223","text":"\u4eceDocker\u4ed3\u5e93\u4e0b\u8f7d\u955c\u50cf\u5230\u672c\u5730\uff0c\u955c\u50cf\u540d\u79f0\u683c\u5f0f\u4e3a \u540d\u79f0:\u7248\u672c\u53f7\uff0c\u5982\u679c\u7248\u672c\u53f7\u4e0d\u6307\u5b9a\u5219\u662f\u6700\u65b0\u7684\u7248\u672c\u3002 \u5982\u679c\u4e0d\u77e5\u9053\u955c\u50cf\u7248\u672c\uff0c\u53ef\u4ee5\u53bbdocker hub \u641c\u7d22\u5bf9\u5e94\u955c\u50cf\u67e5\u770b\u3002 docker pull \u955c\u50cf\u540d\u79f0","title":"2.2.3 \u62c9\u53d6\u955c\u50cf"},{"location":"docker/2/#224","text":"\u5220\u9664\u672c\u5730\u955c\u50cf docker rmi \u955c\u50cfid # \u5220\u9664\u6307\u5b9a\u672c\u5730\u955c\u50cf docker rmi ` docker images -q ` # \u5220\u9664\u6240\u6709\u672c\u5730\u955c\u50cf \u5173\u4e8edocker\u66f4\u591a\u547d\u4ee4\uff0c \u5927\u5bb6\u53ef\u4ee5\u83dc\u9e1f\u6559\u7a0b\u67e5\u770b, \u7f51\u5740\uff1a https://www.runoob.com/docker/docker-command-manual.html","title":"2.2.4 \u5220\u9664\u955c\u50cf"},{"location":"docker/2/#23","text":"","title":"2.3 \u5bb9\u5668\u76f8\u5173\u7684\u547d\u4ee4"},{"location":"docker/2/#231","text":"docker ps # \u67e5\u770b\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668 docker ps -a # \u67e5\u770b\u6240\u6709\u5bb9\u5668\uff0c\u5305\u62ec\u6b63\u5728\u8fd0\u884c\u548c\u505c\u6b62\u7684\u5bb9\u5668","title":"2.3.1 \u67e5\u770b\u5bb9\u5668"},{"location":"docker/2/#232","text":"docker run \u53c2\u6570 \u53c2\u6570\u8bf4\u660e\uff1a \u2022 -i\uff1a\u4fdd\u6301\u5bb9\u5668\u8fd0\u884c\u3002\u901a\u5e38\u4e0e -t \u540c\u65f6\u4f7f\u7528\u3002\u52a0\u5165it\u8fd9\u4e24\u4e2a\u53c2\u6570\u540e\uff0c\u5bb9\u5668\u521b\u5efa\u540e\u81ea\u52a8\u8fdb\u5165\u5bb9\u5668\u4e2d\uff0c\u9000\u51fa\u5bb9\u5668\u540e\uff0c\u5bb9\u5668\u81ea\u52a8\u5173\u95ed\u3002 \u2022 -t\uff1a\u4e3a\u5bb9\u5668\u91cd\u65b0\u5206\u914d\u4e00\u4e2a\u4f2a\u8f93\u5165\u7ec8\u7aef\uff0c\u901a\u5e38\u4e0e -i \u540c\u65f6\u4f7f\u7528\u3002 \u2022 -d\uff1a\u4ee5\u5b88\u62a4\uff08\u540e\u53f0\uff09\u6a21\u5f0f\u8fd0\u884c\u5bb9\u5668\u3002\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\u5728\u540e\u53f0\u8fd0\u884c\uff0c\u9700\u8981\u4f7f\u7528docker exec \u8fdb\u5165\u5bb9\u5668\u3002\u9000\u51fa\u540e\uff0c\u5bb9\u5668\u4e0d\u4f1a\u5173\u95ed\u3002 \u2022 -it \u521b\u5efa\u7684\u5bb9\u5668\u4e00\u822c\u79f0\u4e3a\u4ea4\u4e92\u5f0f\u5bb9\u5668\uff0c-id \u521b\u5efa\u7684\u5bb9\u5668\u4e00\u822c\u79f0\u4e3a\u5b88\u62a4\u5f0f\u5bb9\u5668 \u2022 --name\uff1a\u4e3a\u521b\u5efa\u7684\u5bb9\u5668\u547d\u540d\u3002 1\uff09\u4ea4\u4e92\u5f0f\u5bb9\u5668 \u4ee5 \u4ea4\u4e92\u5f0f \u65b9\u5f0f\u521b\u5efa\u5e76\u542f\u52a8\u5bb9\u5668\uff0c\u542f\u52a8\u5b8c\u6210\u540e\uff0c\u76f4\u63a5\u8fdb\u5165\u5f53\u524d\u5bb9\u5668\u3002\u4f7f\u7528exit\u547d\u4ee4\u9000\u51fa\u5bb9\u5668\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\u4ee5\u6b64\u79cd\u65b9\u5f0f \u542f\u52a8\u5bb9\u5668\uff0c\u5982\u679c\u9000\u51fa\u5bb9\u5668\uff0c\u5219\u5bb9\u5668\u4f1a\u8fdb\u5165 \u505c\u6b62 \u72b6\u6001\u3002 # \u5148\u62c9\u53d6\u4e00\u4e2a\u955c\u50cf\uff1b\u8fd9\u4e00\u6b65\u4e0d\u662f\u6bcf\u6b21\u542f\u52a8\u5bb9\u5668\u90fd\u8981\u505a\u7684\uff0c\u800c\u662f\u56e0\u4e3a\u524d\u9762\u6211\u4eec\u5220\u9664\u4e86\u955c\u50cf\uff0c\u65e0\u955c\u50cf\u53ef\u7528\u6240\u4ee5\u624d\u518d\u62c9\u53d6\u4e00\u4e2a docker pull centos:7 #\u521b\u5efa\u5e76\u542f\u52a8\u540d\u79f0\u4e3a mycentos7 \u7684\u4ea4\u4e92\u5f0f\u5bb9\u5668\uff1b\u4e0b\u9762\u6307\u4ee4\u4e2d\u7684\u955c\u50cf\u540d\u79f0 centos:7 \u4e5f\u53ef\u4ee5\u4f7f\u7528\u955c\u50cfid docker run -it --name = mycentos7 centos:7 /bin/bash 2\uff09\u5b88\u62a4\u5f0f\u5bb9\u5668 \u521b\u5efa\u4e00\u4e2a\u5b88\u62a4\u5f0f\u5bb9\u5668\uff1b\u5982\u679c\u5bf9\u4e8e\u4e00\u4e2a\u9700\u8981\u957f\u671f\u8fd0\u884c\u7684\u5bb9\u5668\u6765\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u5b88\u62a4\u5f0f\u5bb9\u5668\u3002\u547d\u4ee4\u5982\u4e0b\uff08\u5bb9\u5668\u540d\u79f0 \u4e0d\u80fd\u91cd\u590d\uff09\uff1a #\u521b\u5efa\u5e76\u542f\u52a8\u5b88\u62a4\u5f0f\u5bb9\u5668 docker run -di --name = mycentos2 centos:7 #\u767b\u5f55\u8fdb\u5165\u5bb9\u5668\u547d\u4ee4\u4e3a\uff1adocker exec -it container_name (\u6216\u8005 container_id) /bin/bash\uff08exit\u9000\u51fa \u65f6\uff0c\u5bb9\u5668\u4e0d\u4f1a\u505c\u6b62\uff09 docker exec -it mycentos2 /bin/bash","title":"2.3.2 \u521b\u5efa\u5e76\u542f\u52a8\u5bb9\u5668"},{"location":"docker/2/#233","text":"docker exec \u53c2\u6570 # \u9000\u51fa\u5bb9\u5668\uff0c\u5bb9\u5668\u4e0d\u4f1a\u5173\u95ed eg: docker exec -it mycentos2 /bin/bash","title":"2.3.3 \u8fdb\u5165\u5bb9\u5668"},{"location":"docker/2/#234","text":"docker stop \u5bb9\u5668\u540d\u79f0\u6216\u8005\u5bb9\u5668id","title":"2.3.4 \u505c\u6b62\u5bb9\u5668"},{"location":"docker/2/#235","text":"docker start \u5bb9\u5668\u540d\u79f0\u6216\u8005\u5bb9\u5668id","title":"2.3.5 \u542f\u52a8\u5bb9\u5668"},{"location":"docker/2/#236","text":"#\u5220\u9664\u6307\u5b9a\u5bb9\u5668 docker rm \u5bb9\u5668\u540d\u79f0\u6216\u8005\u5bb9\u5668id # \u5220\u9664\u6240\u6709\u5bb9\u5668\uff1a docker rm ` docker ps -a -q ` \u6ce8\u610f\uff1a\u5982\u679c\u5bb9\u5668\u662f\u8fd0\u884c\u72b6\u6001\u5219\u5220\u9664\u5931\u8d25\uff0c\u9700\u8981\u505c\u6b62\u5bb9\u5668\u624d\u80fd\u5220\u9664","title":"2.3.6 \u5220\u9664\u5bb9\u5668"},{"location":"docker/2/#23_7","text":"docker inspect \u5bb9\u5668\u540d\u79f0\u6216\u8005\u5bb9\u5668id \u8bf4\u660e\uff1a\u5bb9\u5668\u4e4b\u95f4\u5728\u4e00\u4e2a\u5c40\u57df\u7f51\u5185\uff0clinux\u5bbf\u4e3b\u673a\u5668\u53ef\u4ee5\u4e0e\u5bb9\u5668\u8fdb\u884c\u901a\u4fe1\uff1b\u4f46\u662f\u5916\u90e8\u7684\u7269\u7406\u673a\u7b14\u8bb0\u672c\u662f\u4e0d\u80fd\u4e0e\u5bb9\u5668\u76f4\u63a5\u901a\u4fe1\u7684\uff0c\u5982\u679c\u9700\u8981\u5219\u9700\u8981\u901a\u8fc7\u5bbf\u4e3b\u673a\u5668\u7aef\u53e3\u7684\u4ee3\u7406\u3002","title":"2.3. 7 \u67e5\u770b\u5bb9\u5668\u4fe1\u606f"},{"location":"docker/3/","text":"docker\u5bb9\u5668\u7684\u6570\u636e\u5377 \u00b6 3.1 \u6570\u636e\u5377\u6982\u5ff5 \u00b6 \u601d\u8003\uff1a \u2022 Docker \u5bb9\u5668\u5220\u9664\u540e\uff0c\u5728\u5bb9\u5668\u4e2d\u4ea7\u751f\u7684\u6570\u636e\u4e5f\u4f1a\u968f\u4e4b\u9500\u6bc1 \u2022 Docker \u5bb9\u5668\u548c\u5916\u90e8\u673a\u5668\u53ef\u4ee5\u76f4\u63a5\u4ea4\u6362\u6587\u4ef6\u5417\uff1f \u2022 \u5bb9\u5668\u4e4b\u95f4\u60f3\u8981\u8fdb\u884c\u6570\u636e\u4ea4\u4e92\uff1f \u6570\u636e\u5377 \u6570\u636e\u5377\u662f\u5bbf\u4e3b\u673a\u4e2d\u7684\u4e00\u4e2a\u76ee\u5f55\u6216\u6587\u4ef6 \u5f53\u5bb9\u5668\u76ee\u5f55\u548c\u6570\u636e\u5377\u76ee\u5f55\u7ed1\u5b9a\u540e\uff0c\u5bf9\u65b9\u7684\u4fee\u6539\u4f1a\u7acb\u5373\u540c\u6b65 \u4e00\u4e2a\u6570\u636e\u5377\u53ef\u4ee5\u88ab\u591a\u4e2a\u5bb9\u5668\u540c\u65f6\u6302\u8f7d \u4e00\u4e2a\u5bb9\u5668\u4e5f\u53ef\u4ee5\u88ab\u6302\u8f7d\u591a\u4e2a\u6570\u636e\u5377 \u6570\u636e\u5377\u7684\u4f5c\u7528 \u2022 \u5bb9\u5668\u6570\u636e\u6301\u4e45\u5316 \u2022 \u5916\u90e8\u673a\u5668\u548c\u5bb9\u5668\u95f4\u63a5\u901a\u4fe1 \u2022 \u5bb9\u5668\u4e4b\u95f4\u6570\u636e\u4ea4\u6362 3.2 \u914d\u7f6e\u6570\u636e\u5377 \u00b6 \u521b\u5efa\u542f\u52a8\u5bb9\u5668\u65f6\uff0c\u4f7f\u7528 \u2013v \u53c2\u6570 \u8bbe\u7f6e\u6570\u636e\u5377 docker run ... -v \u5bbf\u4e3b\u673a\u76ee\u5f55 ( \u6587\u4ef6 ) :\u5bb9\u5668\u5185\u76ee\u5f55 ( \u6587\u4ef6 ) ... \u6ce8\u610f\u4e8b\u9879\uff1a \u76ee\u5f55\u5fc5\u987b\u662f\u7edd\u5bf9\u8def\u5f84 \u5982\u679c\u76ee\u5f55\u4e0d\u5b58\u5728\uff0c\u4f1a\u81ea\u52a8\u521b\u5efa \u4e00\u4e2a\u5bb9\u5668\u53ef\u4ee5\u6302\u8f7d\u591a\u4e2a\u6570\u636e\u5377 \u4e00\u4e2a\u6570\u636e\u5377\u4e5f\u53ef\u4ee5\u88ab\u591a\u4e2a\u5bb9\u5668\u6302\u8f7d \u4e24\u4e2a\u5bb9\u5668\u53ef\u4ee5\u6302\u8f7d\u540c\u4e00\u4e2a\u5bb9\u5668 \u5728\u5bbf\u4e3b\u673a\u4e2d\u5b9e\u73b0\u4e0e\u5bb9\u5668\u76ee\u5f55\u7684\u6302\u8f7d\uff1a \u6570\u636e\u5377\u7684\u6301\u4e45\u5316\uff1a \u200b \u5f53\u6211\u4eec\u628ac1\u5bb9\u5668\u5220\u9664\u540e\uff0c\u5bbf\u4e3b\u673a\u4e2d\u7684\u6570\u636e\u5377\u4f9d\u7136\u5b58\u5728\u3002 \u6240\u4ee5\u5f53\u6211\u4eec\u91cd\u65b0\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\u7684\u540c\u65f6\u4f9d\u7136\u53ef\u4ee5\u6302\u8f7d\u5bbf\u4e3b\u673a\u4e2d\u7684data\u6587\u4ef6\u5939\uff0c\u5bf9\u5e94data\u91cc\u7684\u6570\u636e\u4f9d\u7136\u540c\u6b65\u5230\u5bb9\u5668\u4e2d\u3002 \u4e00\u4e2a\u5bb9\u5668\u53ef\u4ee5\u6302\u8f7d\u591a\u4e2a\u6570\u636e\u5377 \u591a\u4e2a\u5bb9\u5668\u53ef\u4ee5\u6302\u8f7d\u540c\u4e00\u4e2a\u6570\u636e\u5377 \u5206\u522b\u521b\u5efa\u4e24\u4e2a\u5bb9\u5668\uff0c\u4e24\u4e2a\u5bb9\u5668\u90fd\u6302\u8f7d\u5bbf\u4e3b\u673a\u4e2ddata\u76ee\u5f55\uff0c\u5f53 \u4fee\u6539c3\u5bb9\u5668\u7684data\u76ee\u5f55c4\u4f1a\u5b9e\u73b0\u540c\u6b65\u3002 \u4ece\u800c\u5b9e\u73b0\u4e24\u4e2a\u5bb9\u5668\u4e4b\u95f4\u7684\u4ea4\u4e92\u3002 3.3 \u914d\u7f6e\u6570\u636e\u5377\u5bb9\u5668 \u00b6 \u591a\u5bb9\u5668\u8fdb\u884c\u6570\u636e\u4ea4\u6362 \u591a\u4e2a\u5bb9\u5668\u6302\u8f7d\u540c\u4e00\u4e2a\u6570\u636e\u5377 \u6570\u636e\u5377\u5bb9\u5668 \u6b65\u9aa4\uff1a 1.\u521b\u5efa\u542f\u52a8c3\u6570\u636e\u5377\u5bb9\u5668\uff0c\u4f7f\u7528 \u2013v \u53c2\u6570 \u8bbe\u7f6e\u6570\u636e\u5377 docker run \u2013it --name = c3 -v /volume centos:7 /bin/bash \u521b\u5efa\u542f\u52a8 c1 c2 \u5bb9\u5668\uff0c\u4f7f\u7528 \u2013-volumes-from \u53c2\u6570 \u8bbe\u7f6e\u6570\u636e\u5377 docker run \u2013it --name = c1 --volumes-from c3 centos:7 /bin/bash docker run \u2013it --name = c2 --volumes-from c3 centos:7 /bin/bash 3.4 \u6570\u636e\u5377\u5c0f\u7ed3 \u00b6 \u6570\u636e\u5377\u6982\u5ff5 \u2022\u5bbf\u4e3b\u673a\u7684\u4e00\u4e2a\u76ee\u5f55\u6216\u6587\u4ef6 \u6570\u636e\u5377\u4f5c\u7528 \u2022 \u5bb9\u5668\u6570\u636e\u6301\u4e45\u5316 \u2022 \u5ba2\u6237\u7aef\u548c\u5bb9\u5668\u6570\u636e\u4ea4\u6362 \u2022 \u5bb9\u5668\u95f4\u6570\u636e\u4ea4\u6362 \u6570\u636e\u5377\u5bb9\u5668 \u2022 \u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\uff0c\u6302\u8f7d\u4e00\u4e2a\u76ee\u5f55\uff0c\u8ba9\u5176\u4ed6\u5bb9\u5668\u7ee7\u627f\u81ea\u8be5\u5bb9\u5668( --volume-from )\u3002 \u2022 \u901a\u8fc7\u7b80\u5355\u65b9\u5f0f\u5b9e\u73b0\u6570\u636e\u5377\u914d\u7f6e","title":"docker\u5bb9\u5668\u7684\u6570\u636e\u5377"},{"location":"docker/3/#docker","text":"","title":"docker\u5bb9\u5668\u7684\u6570\u636e\u5377"},{"location":"docker/3/#31","text":"\u601d\u8003\uff1a \u2022 Docker \u5bb9\u5668\u5220\u9664\u540e\uff0c\u5728\u5bb9\u5668\u4e2d\u4ea7\u751f\u7684\u6570\u636e\u4e5f\u4f1a\u968f\u4e4b\u9500\u6bc1 \u2022 Docker \u5bb9\u5668\u548c\u5916\u90e8\u673a\u5668\u53ef\u4ee5\u76f4\u63a5\u4ea4\u6362\u6587\u4ef6\u5417\uff1f \u2022 \u5bb9\u5668\u4e4b\u95f4\u60f3\u8981\u8fdb\u884c\u6570\u636e\u4ea4\u4e92\uff1f \u6570\u636e\u5377 \u6570\u636e\u5377\u662f\u5bbf\u4e3b\u673a\u4e2d\u7684\u4e00\u4e2a\u76ee\u5f55\u6216\u6587\u4ef6 \u5f53\u5bb9\u5668\u76ee\u5f55\u548c\u6570\u636e\u5377\u76ee\u5f55\u7ed1\u5b9a\u540e\uff0c\u5bf9\u65b9\u7684\u4fee\u6539\u4f1a\u7acb\u5373\u540c\u6b65 \u4e00\u4e2a\u6570\u636e\u5377\u53ef\u4ee5\u88ab\u591a\u4e2a\u5bb9\u5668\u540c\u65f6\u6302\u8f7d \u4e00\u4e2a\u5bb9\u5668\u4e5f\u53ef\u4ee5\u88ab\u6302\u8f7d\u591a\u4e2a\u6570\u636e\u5377 \u6570\u636e\u5377\u7684\u4f5c\u7528 \u2022 \u5bb9\u5668\u6570\u636e\u6301\u4e45\u5316 \u2022 \u5916\u90e8\u673a\u5668\u548c\u5bb9\u5668\u95f4\u63a5\u901a\u4fe1 \u2022 \u5bb9\u5668\u4e4b\u95f4\u6570\u636e\u4ea4\u6362","title":"3.1 \u6570\u636e\u5377\u6982\u5ff5"},{"location":"docker/3/#32","text":"\u521b\u5efa\u542f\u52a8\u5bb9\u5668\u65f6\uff0c\u4f7f\u7528 \u2013v \u53c2\u6570 \u8bbe\u7f6e\u6570\u636e\u5377 docker run ... -v \u5bbf\u4e3b\u673a\u76ee\u5f55 ( \u6587\u4ef6 ) :\u5bb9\u5668\u5185\u76ee\u5f55 ( \u6587\u4ef6 ) ... \u6ce8\u610f\u4e8b\u9879\uff1a \u76ee\u5f55\u5fc5\u987b\u662f\u7edd\u5bf9\u8def\u5f84 \u5982\u679c\u76ee\u5f55\u4e0d\u5b58\u5728\uff0c\u4f1a\u81ea\u52a8\u521b\u5efa \u4e00\u4e2a\u5bb9\u5668\u53ef\u4ee5\u6302\u8f7d\u591a\u4e2a\u6570\u636e\u5377 \u4e00\u4e2a\u6570\u636e\u5377\u4e5f\u53ef\u4ee5\u88ab\u591a\u4e2a\u5bb9\u5668\u6302\u8f7d \u4e24\u4e2a\u5bb9\u5668\u53ef\u4ee5\u6302\u8f7d\u540c\u4e00\u4e2a\u5bb9\u5668 \u5728\u5bbf\u4e3b\u673a\u4e2d\u5b9e\u73b0\u4e0e\u5bb9\u5668\u76ee\u5f55\u7684\u6302\u8f7d\uff1a \u6570\u636e\u5377\u7684\u6301\u4e45\u5316\uff1a \u200b \u5f53\u6211\u4eec\u628ac1\u5bb9\u5668\u5220\u9664\u540e\uff0c\u5bbf\u4e3b\u673a\u4e2d\u7684\u6570\u636e\u5377\u4f9d\u7136\u5b58\u5728\u3002 \u6240\u4ee5\u5f53\u6211\u4eec\u91cd\u65b0\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\u7684\u540c\u65f6\u4f9d\u7136\u53ef\u4ee5\u6302\u8f7d\u5bbf\u4e3b\u673a\u4e2d\u7684data\u6587\u4ef6\u5939\uff0c\u5bf9\u5e94data\u91cc\u7684\u6570\u636e\u4f9d\u7136\u540c\u6b65\u5230\u5bb9\u5668\u4e2d\u3002 \u4e00\u4e2a\u5bb9\u5668\u53ef\u4ee5\u6302\u8f7d\u591a\u4e2a\u6570\u636e\u5377 \u591a\u4e2a\u5bb9\u5668\u53ef\u4ee5\u6302\u8f7d\u540c\u4e00\u4e2a\u6570\u636e\u5377 \u5206\u522b\u521b\u5efa\u4e24\u4e2a\u5bb9\u5668\uff0c\u4e24\u4e2a\u5bb9\u5668\u90fd\u6302\u8f7d\u5bbf\u4e3b\u673a\u4e2ddata\u76ee\u5f55\uff0c\u5f53 \u4fee\u6539c3\u5bb9\u5668\u7684data\u76ee\u5f55c4\u4f1a\u5b9e\u73b0\u540c\u6b65\u3002 \u4ece\u800c\u5b9e\u73b0\u4e24\u4e2a\u5bb9\u5668\u4e4b\u95f4\u7684\u4ea4\u4e92\u3002","title":"3.2 \u914d\u7f6e\u6570\u636e\u5377"},{"location":"docker/3/#33","text":"\u591a\u5bb9\u5668\u8fdb\u884c\u6570\u636e\u4ea4\u6362 \u591a\u4e2a\u5bb9\u5668\u6302\u8f7d\u540c\u4e00\u4e2a\u6570\u636e\u5377 \u6570\u636e\u5377\u5bb9\u5668 \u6b65\u9aa4\uff1a 1.\u521b\u5efa\u542f\u52a8c3\u6570\u636e\u5377\u5bb9\u5668\uff0c\u4f7f\u7528 \u2013v \u53c2\u6570 \u8bbe\u7f6e\u6570\u636e\u5377 docker run \u2013it --name = c3 -v /volume centos:7 /bin/bash \u521b\u5efa\u542f\u52a8 c1 c2 \u5bb9\u5668\uff0c\u4f7f\u7528 \u2013-volumes-from \u53c2\u6570 \u8bbe\u7f6e\u6570\u636e\u5377 docker run \u2013it --name = c1 --volumes-from c3 centos:7 /bin/bash docker run \u2013it --name = c2 --volumes-from c3 centos:7 /bin/bash","title":"3.3 \u914d\u7f6e\u6570\u636e\u5377\u5bb9\u5668"},{"location":"docker/3/#34","text":"\u6570\u636e\u5377\u6982\u5ff5 \u2022\u5bbf\u4e3b\u673a\u7684\u4e00\u4e2a\u76ee\u5f55\u6216\u6587\u4ef6 \u6570\u636e\u5377\u4f5c\u7528 \u2022 \u5bb9\u5668\u6570\u636e\u6301\u4e45\u5316 \u2022 \u5ba2\u6237\u7aef\u548c\u5bb9\u5668\u6570\u636e\u4ea4\u6362 \u2022 \u5bb9\u5668\u95f4\u6570\u636e\u4ea4\u6362 \u6570\u636e\u5377\u5bb9\u5668 \u2022 \u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\uff0c\u6302\u8f7d\u4e00\u4e2a\u76ee\u5f55\uff0c\u8ba9\u5176\u4ed6\u5bb9\u5668\u7ee7\u627f\u81ea\u8be5\u5bb9\u5668( --volume-from )\u3002 \u2022 \u901a\u8fc7\u7b80\u5355\u65b9\u5f0f\u5b9e\u73b0\u6570\u636e\u5377\u914d\u7f6e","title":"3.4 \u6570\u636e\u5377\u5c0f\u7ed3"},{"location":"docker/4/","text":"\u4e00\u3001\u90e8\u7f72MySQL \u00b6 \u641c\u7d22mysql\u955c\u50cf docker search mysql \u62c9\u53d6mysql\u955c\u50cf docker pull mysql:5.6 \u521b\u5efa\u5bb9\u5668\uff0c\u8bbe\u7f6e\u7aef\u53e3\u6620\u5c04\u3001\u76ee\u5f55\u6620\u5c04 # \u5728/root\u76ee\u5f55\u4e0b\u521b\u5efamysql\u76ee\u5f55\u7528\u4e8e\u5b58\u50a8mysql\u6570\u636e\u4fe1\u606f mkdir ~/mysql cd ~/mysql docker run -id \\ -p 3306 :3306 \\ --name = c_mysql1 \\ -v $PWD /conf:/etc/mysql/conf.d \\ -v $PWD /logs:/logs \\ -v $PWD /data:/var/lib/mysql \\ -e MYSQL_ROOT_PASSWORD = 123456 \\ mysql:5.6 \u53c2\u6570\u8bf4\u660e\uff1a -p 3307:3306 \uff1a\u5c06\u5bb9\u5668\u7684 3306 \u7aef\u53e3\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u7684 3307 \u7aef\u53e3\u3002 -v $PWD/conf:/etc/mysql/conf.d \uff1a\u5c06\u4e3b\u673a\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 conf/my.cnf \u6302\u8f7d\u5230\u5bb9\u5668\u7684 /etc/mysql/my.cnf\u3002\u914d\u7f6e\u76ee\u5f55 -v $PWD/logs:/logs \uff1a\u5c06\u4e3b\u673a\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 logs \u76ee\u5f55\u6302\u8f7d\u5230\u5bb9\u5668\u7684 /logs\u3002\u65e5\u5fd7\u76ee\u5f55 -v $PWD/data:/var/lib/mysql \uff1a\u5c06\u4e3b\u673a\u5f53\u524d\u76ee\u5f55\u4e0b\u7684data\u76ee\u5f55\u6302\u8f7d\u5230\u5bb9\u5668\u7684 /var/lib/mysql \u3002\u6570\u636e\u76ee\u5f55 -e MYSQL_ROOT_PASSWORD=123456\uff1a \u521d\u59cb\u5316 root \u7528\u6237\u7684\u5bc6\u7801\u3002 \u8fdb\u5165\u5bb9\u5668\uff0c\u64cd\u4f5cmysql docker exec \u2013it c_mysql /bin/bash \u4f7f\u7528\u5916\u90e8\u673a\u5668\u8fde\u63a5\u5bb9\u5668\u4e2d\u7684mysql \u4e8c\u3001\u90e8\u7f72Tomcat \u00b6 \u641c\u7d22tomcat\u955c\u50cf docker search tomcat \u62c9\u53d6tomcat\u955c\u50cf docker pull tomcat \u521b\u5efa\u5bb9\u5668\uff0c\u8bbe\u7f6e\u7aef\u53e3\u6620\u5c04\u3001\u76ee\u5f55\u6620\u5c04 # \u5728/root\u76ee\u5f55\u4e0b\u521b\u5efatomcat\u76ee\u5f55\u7528\u4e8e\u5b58\u50a8tomcat\u6570\u636e\u4fe1\u606f mkdir ~/tomcat cd ~/tomcat docker run -id --name = c_tomcat \\ -p 8080 :8080 \\ -v $PWD :/usr/local/tomcat/webapps \\ tomcat \u53c2\u6570\u8bf4\u660e\uff1a -p 8080:8080\uff1a \u5c06\u5bb9\u5668\u76848080\u7aef\u53e3\u6620\u5c04\u5230\u4e3b\u673a\u76848080\u7aef\u53e3 -v $PWD:/usr/local/tomcat/webapps\uff1a \u5c06\u4e3b\u673a\u4e2d\u5f53\u524d\u76ee\u5f55\u6302\u8f7d\u5230\u5bb9\u5668\u7684webapps \u4f7f\u7528\u5916\u90e8\u673a\u5668\u8bbf\u95eetomcat \u4e09\u3001\u90e8\u7f72Nginx \u00b6 \u641c\u7d22nginx\u955c\u50cf docker search nginx \u62c9\u53d6nginx\u955c\u50cf docker pull nginx \u521b\u5efa\u5bb9\u5668\uff0c\u8bbe\u7f6e\u7aef\u53e3\u6620\u5c04\u3001\u76ee\u5f55\u6620\u5c04 # \u5728/root\u76ee\u5f55\u4e0b\u521b\u5efanginx\u76ee\u5f55\u7528\u4e8e\u5b58\u50a8nginx\u6570\u636e\u4fe1\u606f mkdir ~/nginx cd ~/nginx mkdir conf cd conf # \u5728~/nginx/conf/\u4e0b\u521b\u5efanginx.conf\u6587\u4ef6,\u7c98\u8d34\u4e0b\u9762\u5185\u5bb9 vim nginx.conf user nginx ; worker_processes 1 ; error_log /var/log/nginx/error.log warn ; pid /var/run/nginx.pid ; events { worker_connections 1024 ; } http { include /etc/nginx/mime.types ; default_type application/octet-stream ; log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"' ; access_log /var/log/nginx/access.log main ; sendfile on ; #tcp_nopush on; keepalive_timeout 65 ; #gzip on; include /etc/nginx/conf.d/*.conf ; } docker run -id --name = c_nginx \\ -p 80 :80 \\ -v $PWD /conf/nginx.conf:/etc/nginx/nginx.conf \\ -v $PWD /logs:/var/log/nginx \\ -v $PWD /html:/usr/share/nginx/html \\ nginx \u53c2\u6570\u8bf4\u660e\uff1a -p 80:80 \uff1a\u5c06\u5bb9\u5668\u7684 80\u7aef\u53e3\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u7684 80 \u7aef\u53e3\u3002 -v $PWD/conf/nginx.conf:/etc/nginx/nginx.conf \uff1a\u5c06\u4e3b\u673a\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 /conf/nginx.conf \u6302\u8f7d\u5230\u5bb9\u5668\u7684 :/etc/nginx/nginx.conf\u3002\u914d\u7f6e\u76ee\u5f55 -v $PWD/logs:/var/log/nginx \uff1a\u5c06\u4e3b\u673a\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 logs \u76ee\u5f55\u6302\u8f7d\u5230\u5bb9\u5668\u7684/var/log/nginx\u3002\u65e5\u5fd7\u76ee\u5f55 \u4f7f\u7528\u5916\u90e8\u673a\u5668\u8bbf\u95eenginx \u56db\u3001\u90e8\u7f72Redis \u00b6 \u641c\u7d22redis\u955c\u50cf docker search redis \u62c9\u53d6redis\u955c\u50cf docker pull redis:5.0 \u521b\u5efa\u5bb9\u5668\uff0c\u8bbe\u7f6e\u7aef\u53e3\u6620\u5c04 docker run -id --name = c_redis -p 6379 :6379 redis:5.0 \u4f7f\u7528\u5916\u90e8\u673a\u5668\u8fde\u63a5redis ./redis-cli.exe -h 192 .168.149.135 -p 6379","title":"docker\u90e8\u7f72\u5bb9\u5668"},{"location":"docker/4/#mysql","text":"\u641c\u7d22mysql\u955c\u50cf docker search mysql \u62c9\u53d6mysql\u955c\u50cf docker pull mysql:5.6 \u521b\u5efa\u5bb9\u5668\uff0c\u8bbe\u7f6e\u7aef\u53e3\u6620\u5c04\u3001\u76ee\u5f55\u6620\u5c04 # \u5728/root\u76ee\u5f55\u4e0b\u521b\u5efamysql\u76ee\u5f55\u7528\u4e8e\u5b58\u50a8mysql\u6570\u636e\u4fe1\u606f mkdir ~/mysql cd ~/mysql docker run -id \\ -p 3306 :3306 \\ --name = c_mysql1 \\ -v $PWD /conf:/etc/mysql/conf.d \\ -v $PWD /logs:/logs \\ -v $PWD /data:/var/lib/mysql \\ -e MYSQL_ROOT_PASSWORD = 123456 \\ mysql:5.6 \u53c2\u6570\u8bf4\u660e\uff1a -p 3307:3306 \uff1a\u5c06\u5bb9\u5668\u7684 3306 \u7aef\u53e3\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u7684 3307 \u7aef\u53e3\u3002 -v $PWD/conf:/etc/mysql/conf.d \uff1a\u5c06\u4e3b\u673a\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 conf/my.cnf \u6302\u8f7d\u5230\u5bb9\u5668\u7684 /etc/mysql/my.cnf\u3002\u914d\u7f6e\u76ee\u5f55 -v $PWD/logs:/logs \uff1a\u5c06\u4e3b\u673a\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 logs \u76ee\u5f55\u6302\u8f7d\u5230\u5bb9\u5668\u7684 /logs\u3002\u65e5\u5fd7\u76ee\u5f55 -v $PWD/data:/var/lib/mysql \uff1a\u5c06\u4e3b\u673a\u5f53\u524d\u76ee\u5f55\u4e0b\u7684data\u76ee\u5f55\u6302\u8f7d\u5230\u5bb9\u5668\u7684 /var/lib/mysql \u3002\u6570\u636e\u76ee\u5f55 -e MYSQL_ROOT_PASSWORD=123456\uff1a \u521d\u59cb\u5316 root \u7528\u6237\u7684\u5bc6\u7801\u3002 \u8fdb\u5165\u5bb9\u5668\uff0c\u64cd\u4f5cmysql docker exec \u2013it c_mysql /bin/bash \u4f7f\u7528\u5916\u90e8\u673a\u5668\u8fde\u63a5\u5bb9\u5668\u4e2d\u7684mysql","title":"\u4e00\u3001\u90e8\u7f72MySQL"},{"location":"docker/4/#tomcat","text":"\u641c\u7d22tomcat\u955c\u50cf docker search tomcat \u62c9\u53d6tomcat\u955c\u50cf docker pull tomcat \u521b\u5efa\u5bb9\u5668\uff0c\u8bbe\u7f6e\u7aef\u53e3\u6620\u5c04\u3001\u76ee\u5f55\u6620\u5c04 # \u5728/root\u76ee\u5f55\u4e0b\u521b\u5efatomcat\u76ee\u5f55\u7528\u4e8e\u5b58\u50a8tomcat\u6570\u636e\u4fe1\u606f mkdir ~/tomcat cd ~/tomcat docker run -id --name = c_tomcat \\ -p 8080 :8080 \\ -v $PWD :/usr/local/tomcat/webapps \\ tomcat \u53c2\u6570\u8bf4\u660e\uff1a -p 8080:8080\uff1a \u5c06\u5bb9\u5668\u76848080\u7aef\u53e3\u6620\u5c04\u5230\u4e3b\u673a\u76848080\u7aef\u53e3 -v $PWD:/usr/local/tomcat/webapps\uff1a \u5c06\u4e3b\u673a\u4e2d\u5f53\u524d\u76ee\u5f55\u6302\u8f7d\u5230\u5bb9\u5668\u7684webapps \u4f7f\u7528\u5916\u90e8\u673a\u5668\u8bbf\u95eetomcat","title":"\u4e8c\u3001\u90e8\u7f72Tomcat"},{"location":"docker/4/#nginx","text":"\u641c\u7d22nginx\u955c\u50cf docker search nginx \u62c9\u53d6nginx\u955c\u50cf docker pull nginx \u521b\u5efa\u5bb9\u5668\uff0c\u8bbe\u7f6e\u7aef\u53e3\u6620\u5c04\u3001\u76ee\u5f55\u6620\u5c04 # \u5728/root\u76ee\u5f55\u4e0b\u521b\u5efanginx\u76ee\u5f55\u7528\u4e8e\u5b58\u50a8nginx\u6570\u636e\u4fe1\u606f mkdir ~/nginx cd ~/nginx mkdir conf cd conf # \u5728~/nginx/conf/\u4e0b\u521b\u5efanginx.conf\u6587\u4ef6,\u7c98\u8d34\u4e0b\u9762\u5185\u5bb9 vim nginx.conf user nginx ; worker_processes 1 ; error_log /var/log/nginx/error.log warn ; pid /var/run/nginx.pid ; events { worker_connections 1024 ; } http { include /etc/nginx/mime.types ; default_type application/octet-stream ; log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"' ; access_log /var/log/nginx/access.log main ; sendfile on ; #tcp_nopush on; keepalive_timeout 65 ; #gzip on; include /etc/nginx/conf.d/*.conf ; } docker run -id --name = c_nginx \\ -p 80 :80 \\ -v $PWD /conf/nginx.conf:/etc/nginx/nginx.conf \\ -v $PWD /logs:/var/log/nginx \\ -v $PWD /html:/usr/share/nginx/html \\ nginx \u53c2\u6570\u8bf4\u660e\uff1a -p 80:80 \uff1a\u5c06\u5bb9\u5668\u7684 80\u7aef\u53e3\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u7684 80 \u7aef\u53e3\u3002 -v $PWD/conf/nginx.conf:/etc/nginx/nginx.conf \uff1a\u5c06\u4e3b\u673a\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 /conf/nginx.conf \u6302\u8f7d\u5230\u5bb9\u5668\u7684 :/etc/nginx/nginx.conf\u3002\u914d\u7f6e\u76ee\u5f55 -v $PWD/logs:/var/log/nginx \uff1a\u5c06\u4e3b\u673a\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 logs \u76ee\u5f55\u6302\u8f7d\u5230\u5bb9\u5668\u7684/var/log/nginx\u3002\u65e5\u5fd7\u76ee\u5f55 \u4f7f\u7528\u5916\u90e8\u673a\u5668\u8bbf\u95eenginx","title":"\u4e09\u3001\u90e8\u7f72Nginx"},{"location":"docker/4/#redis","text":"\u641c\u7d22redis\u955c\u50cf docker search redis \u62c9\u53d6redis\u955c\u50cf docker pull redis:5.0 \u521b\u5efa\u5bb9\u5668\uff0c\u8bbe\u7f6e\u7aef\u53e3\u6620\u5c04 docker run -id --name = c_redis -p 6379 :6379 redis:5.0 \u4f7f\u7528\u5916\u90e8\u673a\u5668\u8fde\u63a5redis ./redis-cli.exe -h 192 .168.149.135 -p 6379","title":"\u56db\u3001\u90e8\u7f72Redis"},{"location":"docker/5/","text":"Docerfile \u00b6 \u524d\u9762\u7684\u8bfe\u7a0b\u4e2d\u5df2\u7ecf\u77e5\u9053\u4e86\uff0c\u8981\u83b7\u5f97\u955c\u50cf\uff0c\u53ef\u4ee5\u4eceDocker\u4ed3\u5e93\u4e2d\u8fdb\u884c\u4e0b\u8f7d\u3002\u90a3\u5982\u679c\u6211\u4eec\u60f3\u81ea\u5df1\u5f00\u53d1\u4e00\u4e2a\u955c\u50cf\uff0c\u90a3\u8be5\u5982 \u4f55\u505a\u5462\uff1f\u7b54\u6848\u662f\uff1aDockerfifile Dockerfifile\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\uff0c\u7531\u4e00\u7cfb\u5217\u547d\u4ee4\u548c\u53c2\u6570\u6784\u6210\uff0cDocker\u53ef\u4ee5\u8bfb\u53d6Dockerfifile\u6587\u4ef6\u5e76\u6839\u636eDockerfifile\u6587 \u4ef6\u7684\u63cf\u8ff0\u6765\u6784\u5efa\u955c\u50cf\u3002 \u5173\u952e\u5b57 \u4f5c\u7528 \u5907\u6ce8 FROM \u6307\u5b9a\u7236\u955c\u50cf \u6307\u5b9adockerfile\u57fa\u4e8e\u90a3\u4e2aimage\u6784\u5efa MAINTAINER \u4f5c\u8005\u4fe1\u606f \u7528\u6765\u6807\u660e\u8fd9\u4e2adockerfile\u8c01\u5199\u7684 LABEL \u6807\u7b7e \u7528\u6765\u6807\u660edockerfile\u7684\u6807\u7b7e \u53ef\u4ee5\u4f7f\u7528Label\u4ee3\u66ffMaintainer \u6700\u7ec8\u90fd\u662f\u5728docker image\u57fa\u672c\u4fe1\u606f\u4e2d\u53ef\u4ee5\u67e5\u770b RUN \u6267\u884c\u547d\u4ee4 \u6267\u884c\u4e00\u6bb5\u547d\u4ee4 \u9ed8\u8ba4\u662f/bin/sh \u683c\u5f0f: RUN command \u6216\u8005 RUN [\"command\" , \"param1\",\"param2\"] CMD \u5bb9\u5668\u542f\u52a8\u547d\u4ee4 \u63d0\u4f9b\u542f\u52a8\u5bb9\u5668\u65f6\u5019\u7684\u9ed8\u8ba4\u547d\u4ee4 \u548cENTRYPOINT\u914d\u5408\u4f7f\u7528.\u683c\u5f0f CMD command param1 param2 \u6216\u8005 CMD [\"command\" , \"param1\",\"param2\"] ENTRYPOINT \u5165\u53e3 \u4e00\u822c\u5728\u5236\u4f5c\u4e00\u4e9b\u6267\u884c\u5c31\u5173\u95ed\u7684\u5bb9\u5668\u4e2d\u4f1a\u4f7f\u7528 COPY \u590d\u5236\u6587\u4ef6 build\u7684\u65f6\u5019\u590d\u5236\u6587\u4ef6\u5230image\u4e2d ADD \u6dfb\u52a0\u6587\u4ef6 build\u7684\u65f6\u5019\u6dfb\u52a0\u6587\u4ef6\u5230image\u4e2d \u4e0d\u4ec5\u4ec5\u5c40\u9650\u4e8e\u5f53\u524dbuild\u4e0a\u4e0b\u6587 \u53ef\u4ee5\u6765\u6e90\u4e8e\u8fdc\u7a0b\u670d\u52a1 ENV \u73af\u5883\u53d8\u91cf \u6307\u5b9abuild\u65f6\u5019\u7684\u73af\u5883\u53d8\u91cf \u53ef\u4ee5\u5728\u542f\u52a8\u7684\u5bb9\u5668\u7684\u65f6\u5019 \u901a\u8fc7-e\u8986\u76d6 \u683c\u5f0fENV name=value ARG \u6784\u5efa\u53c2\u6570 \u6784\u5efa\u53c2\u6570 \u53ea\u5728\u6784\u5efa\u7684\u65f6\u5019\u4f7f\u7528\u7684\u53c2\u6570 \u5982\u679c\u6709ENV \u90a3\u4e48ENV\u7684\u76f8\u540c\u540d\u5b57\u7684\u503c\u59cb\u7ec8\u8986\u76d6arg\u7684\u53c2\u6570 VOLUME \u5b9a\u4e49\u5916\u90e8\u53ef\u4ee5\u6302\u8f7d\u7684\u6570\u636e\u5377 \u6307\u5b9abuild\u7684image\u90a3\u4e9b\u76ee\u5f55\u53ef\u4ee5\u542f\u52a8\u7684\u65f6\u5019\u6302\u8f7d\u5230\u6587\u4ef6\u7cfb\u7edf\u4e2d \u542f\u52a8\u5bb9\u5668\u7684\u65f6\u5019\u4f7f\u7528 -v \u7ed1\u5b9a \u683c\u5f0f VOLUME [\"\u76ee\u5f55\"] EXPOSE \u66b4\u9732\u7aef\u53e3 \u5b9a\u4e49\u5bb9\u5668\u8fd0\u884c\u7684\u65f6\u5019\u76d1\u542c\u7684\u7aef\u53e3 \u542f\u52a8\u5bb9\u5668\u7684\u4f7f\u7528-p\u6765\u7ed1\u5b9a\u66b4\u9732\u7aef\u53e3 \u683c\u5f0f: EXPOSE 8080 \u6216\u8005 EXPOSE 8080/udp WORKDIR \u5de5\u4f5c\u76ee\u5f55 \u6307\u5b9a\u5bb9\u5668\u5185\u90e8\u7684\u5de5\u4f5c\u76ee\u5f55 \u5982\u679c\u6ca1\u6709\u521b\u5efa\u5219\u81ea\u52a8\u521b\u5efa \u5982\u679c\u6307\u5b9a/ \u4f7f\u7528\u7684\u662f\u7edd\u5bf9\u5730\u5740 \u5982\u679c\u4e0d\u662f/\u5f00\u5934\u90a3\u4e48\u662f\u5728\u4e0a\u4e00\u6761workdir\u7684\u8def\u5f84\u7684\u76f8\u5bf9\u8def\u5f84 USER \u6307\u5b9a\u6267\u884c\u7528\u6237 \u6307\u5b9abuild\u6216\u8005\u542f\u52a8\u7684\u65f6\u5019 \u7528\u6237 \u5728RUN CMD ENTRYPONT\u6267\u884c\u7684\u65f6\u5019\u7684\u7528\u6237 HEALTHCHECK \u5065\u5eb7\u68c0\u67e5 \u6307\u5b9a\u76d1\u6d4b\u5f53\u524d\u5bb9\u5668\u7684\u5065\u5eb7\u76d1\u6d4b\u7684\u547d\u4ee4 \u57fa\u672c\u4e0a\u6ca1\u7528 \u56e0\u4e3a\u5f88\u591a\u65f6\u5019 \u5e94\u7528\u672c\u8eab\u6709\u5065\u5eb7\u76d1\u6d4b\u673a\u5236 ONBUILD \u89e6\u53d1\u5668 \u5f53\u5b58\u5728ONBUILD\u5173\u952e\u5b57\u7684\u955c\u50cf\u4f5c\u4e3a\u57fa\u7840\u955c\u50cf\u7684\u65f6\u5019 \u5f53\u6267\u884cFROM\u5b8c\u6210\u4e4b\u540e \u4f1a\u6267\u884c ONBUILD\u7684\u547d\u4ee4 \u4f46\u662f\u4e0d\u5f71\u54cd\u5f53\u524d\u955c\u50cf \u7528\u5904\u4e5f\u4e0d\u600e\u4e48\u5927 STOPSIGNAL \u53d1\u9001\u4fe1\u53f7\u91cf\u5230\u5bbf\u4e3b\u673a \u8be5STOPSIGNAL\u6307\u4ee4\u8bbe\u7f6e\u5c06\u53d1\u9001\u5230\u5bb9\u5668\u7684\u7cfb\u7edf\u8c03\u7528\u4fe1\u53f7\u4ee5\u9000\u51fa\u3002 SHELL \u6307\u5b9a\u6267\u884c\u811a\u672c\u7684shell \u6307\u5b9aRUN CMD ENTRYPOINT \u6267\u884c\u547d\u4ee4\u7684\u65f6\u5019 \u4f7f\u7528\u7684shell","title":"Docerfile"},{"location":"docker/5/#docerfile","text":"\u524d\u9762\u7684\u8bfe\u7a0b\u4e2d\u5df2\u7ecf\u77e5\u9053\u4e86\uff0c\u8981\u83b7\u5f97\u955c\u50cf\uff0c\u53ef\u4ee5\u4eceDocker\u4ed3\u5e93\u4e2d\u8fdb\u884c\u4e0b\u8f7d\u3002\u90a3\u5982\u679c\u6211\u4eec\u60f3\u81ea\u5df1\u5f00\u53d1\u4e00\u4e2a\u955c\u50cf\uff0c\u90a3\u8be5\u5982 \u4f55\u505a\u5462\uff1f\u7b54\u6848\u662f\uff1aDockerfifile Dockerfifile\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\uff0c\u7531\u4e00\u7cfb\u5217\u547d\u4ee4\u548c\u53c2\u6570\u6784\u6210\uff0cDocker\u53ef\u4ee5\u8bfb\u53d6Dockerfifile\u6587\u4ef6\u5e76\u6839\u636eDockerfifile\u6587 \u4ef6\u7684\u63cf\u8ff0\u6765\u6784\u5efa\u955c\u50cf\u3002 \u5173\u952e\u5b57 \u4f5c\u7528 \u5907\u6ce8 FROM \u6307\u5b9a\u7236\u955c\u50cf \u6307\u5b9adockerfile\u57fa\u4e8e\u90a3\u4e2aimage\u6784\u5efa MAINTAINER \u4f5c\u8005\u4fe1\u606f \u7528\u6765\u6807\u660e\u8fd9\u4e2adockerfile\u8c01\u5199\u7684 LABEL \u6807\u7b7e \u7528\u6765\u6807\u660edockerfile\u7684\u6807\u7b7e \u53ef\u4ee5\u4f7f\u7528Label\u4ee3\u66ffMaintainer \u6700\u7ec8\u90fd\u662f\u5728docker image\u57fa\u672c\u4fe1\u606f\u4e2d\u53ef\u4ee5\u67e5\u770b RUN \u6267\u884c\u547d\u4ee4 \u6267\u884c\u4e00\u6bb5\u547d\u4ee4 \u9ed8\u8ba4\u662f/bin/sh \u683c\u5f0f: RUN command \u6216\u8005 RUN [\"command\" , \"param1\",\"param2\"] CMD \u5bb9\u5668\u542f\u52a8\u547d\u4ee4 \u63d0\u4f9b\u542f\u52a8\u5bb9\u5668\u65f6\u5019\u7684\u9ed8\u8ba4\u547d\u4ee4 \u548cENTRYPOINT\u914d\u5408\u4f7f\u7528.\u683c\u5f0f CMD command param1 param2 \u6216\u8005 CMD [\"command\" , \"param1\",\"param2\"] ENTRYPOINT \u5165\u53e3 \u4e00\u822c\u5728\u5236\u4f5c\u4e00\u4e9b\u6267\u884c\u5c31\u5173\u95ed\u7684\u5bb9\u5668\u4e2d\u4f1a\u4f7f\u7528 COPY \u590d\u5236\u6587\u4ef6 build\u7684\u65f6\u5019\u590d\u5236\u6587\u4ef6\u5230image\u4e2d ADD \u6dfb\u52a0\u6587\u4ef6 build\u7684\u65f6\u5019\u6dfb\u52a0\u6587\u4ef6\u5230image\u4e2d \u4e0d\u4ec5\u4ec5\u5c40\u9650\u4e8e\u5f53\u524dbuild\u4e0a\u4e0b\u6587 \u53ef\u4ee5\u6765\u6e90\u4e8e\u8fdc\u7a0b\u670d\u52a1 ENV \u73af\u5883\u53d8\u91cf \u6307\u5b9abuild\u65f6\u5019\u7684\u73af\u5883\u53d8\u91cf \u53ef\u4ee5\u5728\u542f\u52a8\u7684\u5bb9\u5668\u7684\u65f6\u5019 \u901a\u8fc7-e\u8986\u76d6 \u683c\u5f0fENV name=value ARG \u6784\u5efa\u53c2\u6570 \u6784\u5efa\u53c2\u6570 \u53ea\u5728\u6784\u5efa\u7684\u65f6\u5019\u4f7f\u7528\u7684\u53c2\u6570 \u5982\u679c\u6709ENV \u90a3\u4e48ENV\u7684\u76f8\u540c\u540d\u5b57\u7684\u503c\u59cb\u7ec8\u8986\u76d6arg\u7684\u53c2\u6570 VOLUME \u5b9a\u4e49\u5916\u90e8\u53ef\u4ee5\u6302\u8f7d\u7684\u6570\u636e\u5377 \u6307\u5b9abuild\u7684image\u90a3\u4e9b\u76ee\u5f55\u53ef\u4ee5\u542f\u52a8\u7684\u65f6\u5019\u6302\u8f7d\u5230\u6587\u4ef6\u7cfb\u7edf\u4e2d \u542f\u52a8\u5bb9\u5668\u7684\u65f6\u5019\u4f7f\u7528 -v \u7ed1\u5b9a \u683c\u5f0f VOLUME [\"\u76ee\u5f55\"] EXPOSE \u66b4\u9732\u7aef\u53e3 \u5b9a\u4e49\u5bb9\u5668\u8fd0\u884c\u7684\u65f6\u5019\u76d1\u542c\u7684\u7aef\u53e3 \u542f\u52a8\u5bb9\u5668\u7684\u4f7f\u7528-p\u6765\u7ed1\u5b9a\u66b4\u9732\u7aef\u53e3 \u683c\u5f0f: EXPOSE 8080 \u6216\u8005 EXPOSE 8080/udp WORKDIR \u5de5\u4f5c\u76ee\u5f55 \u6307\u5b9a\u5bb9\u5668\u5185\u90e8\u7684\u5de5\u4f5c\u76ee\u5f55 \u5982\u679c\u6ca1\u6709\u521b\u5efa\u5219\u81ea\u52a8\u521b\u5efa \u5982\u679c\u6307\u5b9a/ \u4f7f\u7528\u7684\u662f\u7edd\u5bf9\u5730\u5740 \u5982\u679c\u4e0d\u662f/\u5f00\u5934\u90a3\u4e48\u662f\u5728\u4e0a\u4e00\u6761workdir\u7684\u8def\u5f84\u7684\u76f8\u5bf9\u8def\u5f84 USER \u6307\u5b9a\u6267\u884c\u7528\u6237 \u6307\u5b9abuild\u6216\u8005\u542f\u52a8\u7684\u65f6\u5019 \u7528\u6237 \u5728RUN CMD ENTRYPONT\u6267\u884c\u7684\u65f6\u5019\u7684\u7528\u6237 HEALTHCHECK \u5065\u5eb7\u68c0\u67e5 \u6307\u5b9a\u76d1\u6d4b\u5f53\u524d\u5bb9\u5668\u7684\u5065\u5eb7\u76d1\u6d4b\u7684\u547d\u4ee4 \u57fa\u672c\u4e0a\u6ca1\u7528 \u56e0\u4e3a\u5f88\u591a\u65f6\u5019 \u5e94\u7528\u672c\u8eab\u6709\u5065\u5eb7\u76d1\u6d4b\u673a\u5236 ONBUILD \u89e6\u53d1\u5668 \u5f53\u5b58\u5728ONBUILD\u5173\u952e\u5b57\u7684\u955c\u50cf\u4f5c\u4e3a\u57fa\u7840\u955c\u50cf\u7684\u65f6\u5019 \u5f53\u6267\u884cFROM\u5b8c\u6210\u4e4b\u540e \u4f1a\u6267\u884c ONBUILD\u7684\u547d\u4ee4 \u4f46\u662f\u4e0d\u5f71\u54cd\u5f53\u524d\u955c\u50cf \u7528\u5904\u4e5f\u4e0d\u600e\u4e48\u5927 STOPSIGNAL \u53d1\u9001\u4fe1\u53f7\u91cf\u5230\u5bbf\u4e3b\u673a \u8be5STOPSIGNAL\u6307\u4ee4\u8bbe\u7f6e\u5c06\u53d1\u9001\u5230\u5bb9\u5668\u7684\u7cfb\u7edf\u8c03\u7528\u4fe1\u53f7\u4ee5\u9000\u51fa\u3002 SHELL \u6307\u5b9a\u6267\u884c\u811a\u672c\u7684shell \u6307\u5b9aRUN CMD ENTRYPOINT \u6267\u884c\u547d\u4ee4\u7684\u65f6\u5019 \u4f7f\u7528\u7684shell","title":"Docerfile"},{"location":"docker/6/","text":"\u670d\u52a1\u7f16\u6392 \u00b6 6.1 \u670d\u52a1\u7f16\u6392\u6982\u5ff5 \u00b6 \u5fae\u670d\u52a1\u67b6\u6784\u7684\u5e94\u7528\u7cfb\u7edf\u4e2d\u4e00\u822c\u5305\u542b\u82e5\u5e72\u4e2a\u5fae\u670d\u52a1\uff0c\u6bcf\u4e2a\u5fae\u670d\u52a1\u4e00\u822c\u90fd\u4f1a\u90e8\u7f72\u591a\u4e2a\u5b9e\u4f8b\uff0c\u5982\u679c\u6bcf\u4e2a\u5fae\u670d\u52a1\u90fd\u8981\u624b\u52a8\u542f\u505c\uff0c\u7ef4\u62a4\u7684\u5de5\u4f5c\u91cf\u4f1a\u5f88\u5927\u3002 \u8981\u4eceDockerfile build image \u6216\u8005\u53bbdockerhub\u62c9\u53d6image \u8981\u521b\u5efa\u591a\u4e2acontainer \u8981\u7ba1\u7406\u8fd9\u4e9bcontainer\uff08\u542f\u52a8\u505c\u6b62\u5220\u9664\uff09 \u670d\u52a1\u7f16\u6392\uff1a \u6309\u7167\u4e00\u5b9a\u7684\u4e1a\u52a1\u89c4\u5219\u6279\u91cf\u7ba1\u7406\u5bb9\u5668 6.2 Docker Compose \u6982\u8ff0 \u00b6 6.2.1 Docker Compose \u00b6 Docker Compose\u662f\u4e00\u4e2a\u7f16\u6392\u591a\u5bb9\u5668\u5206\u5e03\u5f0f\u90e8\u7f72\u7684\u5de5\u5177\uff0c\u63d0\u4f9b\u547d\u4ee4\u96c6\u7ba1\u7406\u5bb9\u5668\u5316\u5e94\u7528\u7684\u5b8c\u6574\u5f00\u53d1\u5468\u671f\uff0c\u5305\u62ec\u670d\u52a1\u6784\u5efa \uff0c\u542f\u52a8\u548c\u505c\u6b62\u3002\u4f7f\u7528\u6b65\u9aa4\uff1a \u5229\u7528 Dockerfile \u5b9a\u4e49\u8fd0\u884c\u73af\u5883\u955c\u50cf \u4f7f\u7528 docker-compose.yml \u5b9a\u4e49\u7ec4\u6210\u5e94\u7528\u7684\u5404\u670d\u52a1 \u8fd0\u884c docker-compose up \u542f\u52a8\u5e94\u7528 6.2.2 Docker Compose \u5b89\u88c5\u4f7f\u7528 \u00b6 Docker Compose \u00b6 \u4e00\u3001\u5b89\u88c5Docker Compose \u00b6 # Compose\u76ee\u524d\u5df2\u7ecf\u5b8c\u5168\u652f\u6301Linux\u3001Mac OS\u548cWindows\uff0c\u5728\u6211\u4eec\u5b89\u88c5Compose\u4e4b\u524d\uff0c\u9700\u8981\u5148\u5b89\u88c5Docker\u3002\u4e0b\u9762\u6211 \u4eec\u4ee5\u7f16\u8bd1\u597d\u7684\u4e8c\u8fdb\u5236\u5305\u65b9\u5f0f\u5b89\u88c5\u5728Linux\u7cfb\u7edf\u4e2d\u3002 curl -L https://github.com/docker/compose/releases/download/1.22.0/docker-compose- ` uname -s ` - ` uname -m ` -o /usr/local/bin/docker-compose # \u8bbe\u7f6e\u6587\u4ef6\u53ef\u6267\u884c\u6743\u9650 chmod +x /usr/local/bin/docker-compose # \u67e5\u770b\u7248\u672c\u4fe1\u606f docker-compose -version \u4e8c\u3001\u5378\u8f7dDocker Compose \u00b6 # \u4e8c\u8fdb\u5236\u5305\u65b9\u5f0f\u5b89\u88c5\u7684\uff0c\u5220\u9664\u4e8c\u8fdb\u5236\u6587\u4ef6\u5373\u53ef rm /usr/local/bin/docker-compose \u4e09\u3001 \u4f7f\u7528docker compose\u7f16\u6392nginx+springboot\u9879\u76ee \u00b6 \u521b\u5efadocker-compose\u76ee\u5f55 mkdir ~/docker-compose cd ~/docker-compose \u7f16\u5199 docker-compose.yml \u6587\u4ef6 version: '3' services: nginx: image: nginx ports: - 80 :80 links: - app volumes: - ./nginx/conf.d:/etc/nginx/conf.d app: image: app expose: - \"8080\" \u521b\u5efa./nginx/conf.d\u76ee\u5f55 mkdir -p ./nginx/conf.d \u5728./nginx/conf.d\u76ee\u5f55\u4e0b \u7f16\u5199itheima.conf\u6587\u4ef6 server { listen 80 ; access_log off ; location / { proxy_pass http://app:8080 ; } } \u5728~/docker-compose \u76ee\u5f55\u4e0b \u4f7f\u7528docker-compose \u542f\u52a8\u5bb9\u5668 docker-compose up \u6d4b\u8bd5\u8bbf\u95ee http://192.168.149.135/hello","title":"\u670d\u52a1\u7f16\u6392"},{"location":"docker/6/#_1","text":"","title":"\u670d\u52a1\u7f16\u6392"},{"location":"docker/6/#61","text":"\u5fae\u670d\u52a1\u67b6\u6784\u7684\u5e94\u7528\u7cfb\u7edf\u4e2d\u4e00\u822c\u5305\u542b\u82e5\u5e72\u4e2a\u5fae\u670d\u52a1\uff0c\u6bcf\u4e2a\u5fae\u670d\u52a1\u4e00\u822c\u90fd\u4f1a\u90e8\u7f72\u591a\u4e2a\u5b9e\u4f8b\uff0c\u5982\u679c\u6bcf\u4e2a\u5fae\u670d\u52a1\u90fd\u8981\u624b\u52a8\u542f\u505c\uff0c\u7ef4\u62a4\u7684\u5de5\u4f5c\u91cf\u4f1a\u5f88\u5927\u3002 \u8981\u4eceDockerfile build image \u6216\u8005\u53bbdockerhub\u62c9\u53d6image \u8981\u521b\u5efa\u591a\u4e2acontainer \u8981\u7ba1\u7406\u8fd9\u4e9bcontainer\uff08\u542f\u52a8\u505c\u6b62\u5220\u9664\uff09 \u670d\u52a1\u7f16\u6392\uff1a \u6309\u7167\u4e00\u5b9a\u7684\u4e1a\u52a1\u89c4\u5219\u6279\u91cf\u7ba1\u7406\u5bb9\u5668","title":"6.1 \u670d\u52a1\u7f16\u6392\u6982\u5ff5"},{"location":"docker/6/#62_docker_compose","text":"","title":"6.2 Docker Compose \u6982\u8ff0"},{"location":"docker/6/#621_docker_compose","text":"Docker Compose\u662f\u4e00\u4e2a\u7f16\u6392\u591a\u5bb9\u5668\u5206\u5e03\u5f0f\u90e8\u7f72\u7684\u5de5\u5177\uff0c\u63d0\u4f9b\u547d\u4ee4\u96c6\u7ba1\u7406\u5bb9\u5668\u5316\u5e94\u7528\u7684\u5b8c\u6574\u5f00\u53d1\u5468\u671f\uff0c\u5305\u62ec\u670d\u52a1\u6784\u5efa \uff0c\u542f\u52a8\u548c\u505c\u6b62\u3002\u4f7f\u7528\u6b65\u9aa4\uff1a \u5229\u7528 Dockerfile \u5b9a\u4e49\u8fd0\u884c\u73af\u5883\u955c\u50cf \u4f7f\u7528 docker-compose.yml \u5b9a\u4e49\u7ec4\u6210\u5e94\u7528\u7684\u5404\u670d\u52a1 \u8fd0\u884c docker-compose up \u542f\u52a8\u5e94\u7528","title":"6.2.1 Docker Compose"},{"location":"docker/6/#622_docker_compose","text":"","title":"6.2.2  Docker Compose \u5b89\u88c5\u4f7f\u7528"},{"location":"docker/6/#docker_compose","text":"","title":"Docker Compose"},{"location":"docker/6/#docker_compose_1","text":"# Compose\u76ee\u524d\u5df2\u7ecf\u5b8c\u5168\u652f\u6301Linux\u3001Mac OS\u548cWindows\uff0c\u5728\u6211\u4eec\u5b89\u88c5Compose\u4e4b\u524d\uff0c\u9700\u8981\u5148\u5b89\u88c5Docker\u3002\u4e0b\u9762\u6211 \u4eec\u4ee5\u7f16\u8bd1\u597d\u7684\u4e8c\u8fdb\u5236\u5305\u65b9\u5f0f\u5b89\u88c5\u5728Linux\u7cfb\u7edf\u4e2d\u3002 curl -L https://github.com/docker/compose/releases/download/1.22.0/docker-compose- ` uname -s ` - ` uname -m ` -o /usr/local/bin/docker-compose # \u8bbe\u7f6e\u6587\u4ef6\u53ef\u6267\u884c\u6743\u9650 chmod +x /usr/local/bin/docker-compose # \u67e5\u770b\u7248\u672c\u4fe1\u606f docker-compose -version","title":"\u4e00\u3001\u5b89\u88c5Docker Compose"},{"location":"docker/6/#docker_compose_2","text":"# \u4e8c\u8fdb\u5236\u5305\u65b9\u5f0f\u5b89\u88c5\u7684\uff0c\u5220\u9664\u4e8c\u8fdb\u5236\u6587\u4ef6\u5373\u53ef rm /usr/local/bin/docker-compose","title":"\u4e8c\u3001\u5378\u8f7dDocker Compose"},{"location":"docker/6/#docker_composenginxspringboot","text":"\u521b\u5efadocker-compose\u76ee\u5f55 mkdir ~/docker-compose cd ~/docker-compose \u7f16\u5199 docker-compose.yml \u6587\u4ef6 version: '3' services: nginx: image: nginx ports: - 80 :80 links: - app volumes: - ./nginx/conf.d:/etc/nginx/conf.d app: image: app expose: - \"8080\" \u521b\u5efa./nginx/conf.d\u76ee\u5f55 mkdir -p ./nginx/conf.d \u5728./nginx/conf.d\u76ee\u5f55\u4e0b \u7f16\u5199itheima.conf\u6587\u4ef6 server { listen 80 ; access_log off ; location / { proxy_pass http://app:8080 ; } } \u5728~/docker-compose \u76ee\u5f55\u4e0b \u4f7f\u7528docker-compose \u542f\u52a8\u5bb9\u5668 docker-compose up \u6d4b\u8bd5\u8bbf\u95ee http://192.168.149.135/hello","title":"\u4e09\u3001 \u4f7f\u7528docker compose\u7f16\u6392nginx+springboot\u9879\u76ee"},{"location":"docker/7/","text":"\u4e00\u3001\u79c1\u6709\u4ed3\u5e93\u642d\u5efa \u00b6 # 1\u3001\u62c9\u53d6\u79c1\u6709\u4ed3\u5e93\u955c\u50cf docker pull registry # 2\u3001\u542f\u52a8\u79c1\u6709\u4ed3\u5e93\u5bb9\u5668 docker run -id --name = registry -p 5000 :5000 registry # 3\u3001\u6253\u5f00\u6d4f\u89c8\u5668 \u8f93\u5165\u5730\u5740http://\u79c1\u6709\u4ed3\u5e93\u670d\u52a1\u5668ip:5000/v2/_catalog\uff0c\u770b\u5230{\"repositories\":[]} \u8868\u793a\u79c1\u6709\u4ed3\u5e93 \u642d\u5efa\u6210\u529f # 4\u3001\u4fee\u6539daemon.json vim /etc/docker/daemon.json # \u5728\u4e0a\u8ff0\u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e00\u4e2akey\uff0c\u4fdd\u5b58\u9000\u51fa\u3002\u6b64\u6b65\u7528\u4e8e\u8ba9 docker \u4fe1\u4efb\u79c1\u6709\u4ed3\u5e93\u5730\u5740\uff1b\u6ce8\u610f\u5c06\u79c1\u6709\u4ed3\u5e93\u670d\u52a1\u5668ip\u4fee\u6539\u4e3a\u81ea\u5df1\u79c1\u6709\u4ed3\u5e93\u670d\u52a1\u5668\u771f\u5b9eip { \"insecure-registries\" : [ \"\u79c1\u6709\u4ed3\u5e93\u670d\u52a1\u5668ip:5000\" ]} # 5\u3001\u91cd\u542fdocker \u670d\u52a1 systemctl restart docker docker start registry \u4e8c\u3001\u5c06\u955c\u50cf\u4e0a\u4f20\u81f3\u79c1\u6709\u4ed3\u5e93 \u00b6 # 1\u3001\u6807\u8bb0\u955c\u50cf\u4e3a\u79c1\u6709\u4ed3\u5e93\u7684\u955c\u50cf docker tag centos:7 \u79c1\u6709\u4ed3\u5e93\u670d\u52a1\u5668IP:5000/centos:7 # 2\u3001\u4e0a\u4f20\u6807\u8bb0\u7684\u955c\u50cf docker push \u79c1\u6709\u4ed3\u5e93\u670d\u52a1\u5668IP:5000/centos:7 \u4e09\u3001 \u4ece\u79c1\u6709\u4ed3\u5e93\u62c9\u53d6\u955c\u50cf \u00b6 #\u62c9\u53d6\u955c\u50cf docker pull \u79c1\u6709\u4ed3\u5e93\u670d\u52a1\u5668ip:5000/centos:7","title":"\u79c1\u6709\u4ed3\u5e93"},{"location":"docker/7/#_1","text":"# 1\u3001\u62c9\u53d6\u79c1\u6709\u4ed3\u5e93\u955c\u50cf docker pull registry # 2\u3001\u542f\u52a8\u79c1\u6709\u4ed3\u5e93\u5bb9\u5668 docker run -id --name = registry -p 5000 :5000 registry # 3\u3001\u6253\u5f00\u6d4f\u89c8\u5668 \u8f93\u5165\u5730\u5740http://\u79c1\u6709\u4ed3\u5e93\u670d\u52a1\u5668ip:5000/v2/_catalog\uff0c\u770b\u5230{\"repositories\":[]} \u8868\u793a\u79c1\u6709\u4ed3\u5e93 \u642d\u5efa\u6210\u529f # 4\u3001\u4fee\u6539daemon.json vim /etc/docker/daemon.json # \u5728\u4e0a\u8ff0\u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e00\u4e2akey\uff0c\u4fdd\u5b58\u9000\u51fa\u3002\u6b64\u6b65\u7528\u4e8e\u8ba9 docker \u4fe1\u4efb\u79c1\u6709\u4ed3\u5e93\u5730\u5740\uff1b\u6ce8\u610f\u5c06\u79c1\u6709\u4ed3\u5e93\u670d\u52a1\u5668ip\u4fee\u6539\u4e3a\u81ea\u5df1\u79c1\u6709\u4ed3\u5e93\u670d\u52a1\u5668\u771f\u5b9eip { \"insecure-registries\" : [ \"\u79c1\u6709\u4ed3\u5e93\u670d\u52a1\u5668ip:5000\" ]} # 5\u3001\u91cd\u542fdocker \u670d\u52a1 systemctl restart docker docker start registry","title":"\u4e00\u3001\u79c1\u6709\u4ed3\u5e93\u642d\u5efa"},{"location":"docker/7/#_2","text":"# 1\u3001\u6807\u8bb0\u955c\u50cf\u4e3a\u79c1\u6709\u4ed3\u5e93\u7684\u955c\u50cf docker tag centos:7 \u79c1\u6709\u4ed3\u5e93\u670d\u52a1\u5668IP:5000/centos:7 # 2\u3001\u4e0a\u4f20\u6807\u8bb0\u7684\u955c\u50cf docker push \u79c1\u6709\u4ed3\u5e93\u670d\u52a1\u5668IP:5000/centos:7","title":"\u4e8c\u3001\u5c06\u955c\u50cf\u4e0a\u4f20\u81f3\u79c1\u6709\u4ed3\u5e93"},{"location":"docker/7/#_3","text":"#\u62c9\u53d6\u955c\u50cf docker pull \u79c1\u6709\u4ed3\u5e93\u670d\u52a1\u5668ip:5000/centos:7","title":"\u4e09\u3001 \u4ece\u79c1\u6709\u4ed3\u5e93\u62c9\u53d6\u955c\u50cf"},{"location":"dubbo/dubbo/","text":"1-\u4eca\u65e5\u5185\u5bb9 \u00b6 \u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u7684\u76f8\u5173\u6982\u5ff5 dubbo \u6982\u8ff0 dubbo\u5feb\u901f\u5165\u95e8 dubbo\u7684\u9ad8\u7ea7\u7279\u6027 2-\u76f8\u5173\u6982\u5ff5 \u00b6 2.1-\u4e92\u8054\u7f51\u9879\u76ee\u67b6\u6784-\u7279\u70b9 \u00b6 \u4e92\u8054\u7f51\u9879\u76ee\u67b6\u6784-\u7279\u70b9 \u7528\u6237\u591a \u6d41\u91cf\u5927\uff0c\u5e76\u53d1\u9ad8 \u6d77\u91cf\u6570\u636e \u6613\u53d7\u653b\u51fb \u529f\u80fd\u7e41\u7410 \u53d8\u66f4\u5feb \u4f20\u7edf\u9879\u76ee\u548c\u4e92\u8054\u7f51\u9879\u76ee\u7684\u4e0d\u540c \u7528\u6237\u4f53\u9a8c \uff1a \u7f8e\u89c2\u3001\u529f\u80fd\u3001\u901f\u5ea6\u3001\u7a33\u5b9a\u6027 \u8861\u91cf\u4e00\u4e2a\u7f51\u7ad9\u901f\u5ea6\u662f\u5426\u5feb: \u6253\u5f00\u4e00\u4e2a\u65b0\u9875\u9762\u4e00\u77ac\u95f4\u5b8c\u6210;\u9875\u9762\u5185\u8df3\u8f6c\uff0c-\u5239\u90a3\u95f4\u5b8c\u6210\u3002 \u6839\u636e\u4f5b\u7ecf\u300a\u50e7\u8879\u5f8b\u300b\u8bb0\u8f7d:\u4e00 \u5239\u90a3\u8005\u4e3a-\u5ff5,\u4e8c\u5341\u5ff5\u4e3a-\u77ac,\u4e8c\u5341\u77ac\u4e3a-\u5f39 \u6307\uff0c\u4e8c\u5341\u5f39\u6307\u4e3a-\u7f57\u9884\uff0c \u4e8c\u5341\u7f57\u9884\u4e3a-\u987b\u81fe\uff0c\u4e00\u65e5\u4e00\u591c\u6709\u4e09\u5341\u987b\u81fe\u3002 2.2-\u4e92\u8054\u7f51\u9879\u76ee\u67b6\u6784-\u76ee\u6807 \u00b6 \u8861\u91cf\u7f51\u7ad9\u7684\u6027\u80fd\u6307\u6807: \u54cd\u5e94\u65f6\u95f4: \u6307\u6267\u884c\u4e00\u4e2a\u8bf7\u6c42\u4ece\u5f00\u59cb\u5230\u6700\u540e\u6536\u5230\u54cd\u5e94\u6570\u636e\u6240\u82b1\u8d39\u7684\u603b\u4f53\u65f6\u95f4\u3002 \u5e76\u53d1\u6570: \u6307\u7cfb\u7edf\u540c\u65f6\u80fd\u5904\u7406\u7684\u8bf7\u6c42\u6570\u91cf\u3002 \u5e76\u53d1\u8fde\u63a5\u6570: \u6307\u7684\u662f\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u53d1\u8d77\u8bf7\u6c42\uff0c\u5e76\u5efa\u7acb\u4e86TCP\u8fde\u63a5\u3002\u6bcf\u79d2\u949f\u670d\u52a1\u5668\u8fde\u63a5\u7684\u603bTCP\u6570\u91cf \u8bf7\u6c42\u6570: \u4e5f\u79f0\u4e3aQPS(Query Per Second)\u6307\u6bcf\u79d2\u591a\u5c11\u8bf7\u6c42. \u5e76\u53d1\u7528\u6237\u6570: \u5355\u4f4d\u65f6\u95f4\u5185\u6709\u591a\u5c11\u7528\u6237 \u541e\u5410\u91cf: \u6307\u5355\u4f4d\u65f6\u95f4\u5185\u7cfb\u7edf\u80fd\u5904\u7406\u7684\u8bf7\u6c42\u6570\u91cf\u3002 \u25cf QPS : Query Per Second\u6bcf\u79d2\u67e5\u8be2\u6570 \u3002 \u25cf TPS : Transactions Per Second\u6bcf\u79d2\u4e8b\u52a1\u6570 \u3002 \u25cf \u4e00\u4e2a\u4e8b\u52a1\u662f\u6307\u4e00 \u4e2a\u5ba2\u6237\u673a\u5411\u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42\u7136\u540e\u670d\u52a1\u5668\u505a\u51fa\u53cd\u5e94\u7684\u8fc7\u7a0b \u3002 \u5ba2\u6237\u673a\u5728\u53d1\u9001\u8bf7\u6c42\u65f6\u5f00\u59cb\u8ba1\u65f6 \uff0c \u6536\u5230\u670d\u52a1\u5668\u54cd\u5e94\u540e\u7ed3\u675f \u8ba1\u65f6 \uff0c \u4ee5\u6b64\u6765\u8ba1\u7b97\u4f7f\u7528\u7684\u65f6\u95f4\u548c\u5b8c\u6210\u7684\u4e8b\u52a1\u4e2a\u6570 \u3002 \u25cf \u4e00\u4e2a\u9875\u9762\u7684\u4e00\u6b21\u8bbf\u95ee \uff0c \u53ea\u4f1a\u5f62\u6210\u4e00 \u4e2aTPS ; \u4f46-\u6b21\u9875\u9762\u8bf7\u6c42 \uff0c \u53ef\u80fd\u4ea7\u751f\u591a\u6b21\u5bf9\u670d\u52a1\u5668\u7684\u8bf7\u6c42 \uff0c \u5c31\u4f1a\u6709\u591a\u4e2aQPS QPS >= \u5e76\u53d1\u8fde\u63a5\u6570 >= TPS \u5927\u578b\u4e92\u8054\u7f51\u9879\u76ee\u67b6\u6784\u76ee\u6807 : \u200b \u25cf \u9ad8\u6027\u80fd: \u63d0\u4f9b\u5feb\u901f\u7684\u8bbf\u95ee\u4f53\u9a8c\u3002 \u200b \u25cf \u9ad8\u53ef\u7528: \u7f51\u7ad9\u670d\u52a1- \u53ef\u4ee5\u6b63\u5e38\u8bbf\u95ee 2.3-\u96c6\u7fa4\u548c\u5206\u5e03\u5f0f \u00b6 \u96c6\u7fa4\u548c\u5206\u5e03\u5f0f\uff0c \u25cf\u96c6\u7fa4:\u5f88\u591a\u201c\u4eba\u201d\u4e00\u8d77\uff0c\u5e72\u4e00\u6837\u7684\u4e8b\u3002 \u25cf\u4e00\u4e2a\u4e1a\u52a1\u6a21\u5757\uff0c\u90e8\u7f72\u5728\u591a\u53f0\u670d\u52a1\u5668\u4e0a\u3002 \u25cf\u5206\u5e03\u5f0f:\u5f88\u591a\"\u4eba\u201d\u4e00\u8d77\uff0c\u5e72\u4e0d\u6837\u7684\u4e8b\u3002\u8fd9\u4e9b\u4e0d\u4e00\u6837\u7684\u4e8b\uff0c \u5408\u8d77\u6765\u662f\u4e00\u4ef6\u5927\u4e8b\u3002 2.4-\u67b6\u6784\u6f14\u8fdb \u00b6 \u5355\u4f53\u67b6\u6784\uff1a \u4f18\u70b9: \u7b80\u5355:\u5f00\u53d1\u90e8\u7f72\u90fd\u5f88\u65b9\u4fbf\uff0c\u5c0f\u578b\u9879\u76ee\u9996\u9009 \u7f3a\u70b9: \u25cf\u9879\u76ee\u542f\u52a8\u6162 \u25cf\u53ef\u9760\u6027\u5dee \u5782\u76f4\u67b6\u6784\uff1a \u5782\u76f4\u67b6\u6784\u662f\u6307\u5c06\u5355\u4f53\u67b6\u6784\u4e2d\u7684\u591a\u4e2a\u6a21\u5757\u62c6\u5206\u4e3a\u591a\u4e2a\u72ec\u7acb\u7684\u9879\u76ee\u3002\u5f62\u6210\u591a\u4e2a\u72ec\u7acb\u7684\u5355\u4f53\u67b6\u6784\u3002 \u5355\u4f53\u67b6\u6784\u5b58\u5728\u7684\u95ee\u9898: \u9879\u76ee\u542f\u52a8\u6162 \u53ef\u9760\u6027\u5dee \u53ef\u4f38\u7f29\u6027\u5dee \u6269\u5c55\u6027\u548c\u53ef\u7ef4\u62a4\u6027\u5dee \u6027\u80fd\u4f4e \u5782\u76f4\u67b6\u6784\u5b58\u5728\u7684\u95ee\u9898: \u91cd\u590d\u529f\u80fd\u592a\u591a \u5206\u5e03\u5f0f\u67b6\u6784\uff1a \u662f\u6307\u5728\u5782\u76f4\u67b6\u6784\u7684\u57fa\u7840\u4e0a,\u5c06\u516c\u5171\u4e1a\u52a1\u6a21\u5757\u62bd\u53d6\u51fa\u6765,\u4f5c\u4e3a\u72ec\u7acb\u7684\u670d\u52a1\u4f9b\u5176\u4ed6\u8c03\u7528\u8005\u6d88\u8d39\uff0c\u4ee5\u5b9e\u73b0\u670d\u52a1\u7684\u5171\u4eab\u548c\u91cd\u7528\u3002\u5e95\u5c42\u901a\u8fc7RPC\uff08\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\u5b9e\u73b0\uff09 RPC: Remote Procedure Call\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\u3002\u6709\u975e\u5e38\u591a\u7684\u534f\u8bae\u548c\u6280\u672f\u6765\u90fd\u5b9e\u73b0\u4e86RPC\u7684\u8fc7\u7a0b\u3002\u6bd4\u5982: HTTP REST\u98ce\u683c\uff0cJava RMI\u89c4\u8303\u3001WebService SOAP\u534f\u8baeHession\u7b49\u7b49\u3002 \u5782\u76f4\u67b6\u6784\u5b58\u5728\u7684\u95ee\u9898: \u25cf\u91cd\u590d\u529f\u80fd\u592a\u591a \u5206\u5e03\u5f0f\u67b6\u6784\u5b58\u5728\u7684\u95ee\u9898: \u200b \u25cf\u670d\u52a1\u63d0\u4f9b\u65b9- -\u65e6\u4ea7\u751f\u53d8\u66f4,\u6240\u6709\u6d88\u8d39\u65b9\u90fd\u9700\u8981\u53d8\u66f4\u3002 SOA: (Service- Oriented Architecture,\u9762\u5411\u670d\u52a1\u7684\u67b6\u6784) \uff1a\u662f\u4e00\u4e2a\u7ec4\u4ef6\u6a21\u578b,\u5b83\u5c06\u5e94\u7528\u7a0b\u5e8f\u7684\u4e0d\u540c\u529f\u80fd\u5355\u5143(\u79f0\u4e3a\u670d\u52a1)\u8fdb\u884c\u62c6\u5206\uff0c\u5e76\u901a\u8fc7\u8fd9\u4e9b\u670d\u52a1\u4e4b\u95f4\u5b9a\u4e49\u826f\u597d\u7684\u63a5\u53e3\u548c\u5951\u7ea6\u8054\u7cfb\u8d77\u6765\u3002 ESB: (Enterparise Servce Bus) \uff1a\u4f01\u4e1a\u670d\u52a1\u603b\u7ebf,\u670d\u52a1\u4e2d\u4ecb\u3002\u4e3b\u8981\u662f\u63d0\u4f9b\u4e86\u4e00\u4e00\u4e2a\u670d \u52a1\u4e8e\u670d\u52a1\u4e4b\u95f4\u7684\u4ea4\u4e92\u3002ESB\u5305\u542b\u7684\u529f\u80fd\u5982:\u8d1f\u8f7d\u5747\u8861\uff0c\u6d41\u91cf\u63a7\u5236\uff0c\u52a0\u5bc6\u5904\u7406\uff0c\u670d\u52a1 \u7684\u76d1\u63a7\uff0c\u5f02\u5e38\u5904\u7406\uff0c\u76d1\u63a7\u544a\u6025\u7b49\u7b49\u3002 \u5fae\u670d\u52a1\u67b6\u6784\uff1a \u25cf\u5fae\u670d\u52a1\u67b6\u6784\u662f\u5728SOA\u4e0a\u505a\u7684\u5347\u534e,\u5fae\u670d\u52a1\u67b6\u6784\u5f3a\u8c03\u7684\u4e00\u4e2a\u91cd\u70b9\u662f\u201c\u4e1a\u52a1\u9700\u8981\u5f7b\u5e95\u7684\u7ec4\u4ef6\u5316\u548c\u670d\u52a1\u5316\u201d\uff0c\u539f\u6709\u7684\u5355\u4e2a \u4e1a\u52a1\u7cfb\u7edf\u4f1a\u62c6\u5206\u4e3a\u591a\u4e2a\u53ef\u4ee5\u72ec\u7acb\u5f00\u53d1\u3001\u8bbe\u8ba1\u3001\u8fd0\u884c\u7684\u5c0f\u5e94\u7528\u3002\u8fd9\u4e9b\u5c0f\u5e94\u7528\u4e4b\u95f4\u901a\u8fc7\u670d\u52a1\u5b8c\u6210\u4ea4\u4e92\u548c\u96c6\u6210\u3002 \u25cf\u5fae\u670d\u52a1\u67b6\u6784= 80%\u7684SOA\u670d\u52a1\u67b6\u6784\u601d\u60f3+ 100%\u7684\u7ec4\u4ef6\u5316\u67b6\u6784\u601d\u60f3+ 80%\u7684\u9886\u57df\u5efa\u6a21\u601d\u60f3 \u7279\u70b9: \u25cf\u670d\u52a1\u5b9e\u73b0\u7ec4\u4ef6\u5316:\u5f00\u53d1\u8005\u53ef\u4ee5\u81ea\u7531\u9009\u62e9\u5f00\u53d1\u6280\u672f\u3002\u4e5f\u4e0d\u9700\u8981\u534f\u8c03\u5176\u4ed6\u56e2\u961f \u25cf\u670d\u52a1\u4e4b\u95f4\u4ea4\u4e92\u4e00 \u822c\u4f7f\u7528REST API \u25cf\u53bb\u4e2d\u5fc3\u5316:\u6bcf\u4e2a\u5fae\u670d\u52a1\u6709\u81ea\u5df1\u79c1\u6709\u7684\u6570\u636e\u5e93\u6301\u4e45\u5316\u4e1a\u52a1\u6570\u636e \u25cf\u81ea\u52a8\u5316\u90e8\u7f72:\u628a\u5e94\u7528\u62c6\u5206\u6210\u4e3a\u4e00 \u4e2a-\u4e2a\u72ec\u7acb\u7684\u5355\u4e2a\u670d\u52a1,\u65b9\u4fbf\u81ea\u52a8\u5316\u90e8\u7f72\u3001\u6d4b\u8bd5\u3001\u8fd0\u7ef4 3-dubbo \u6982\u8ff0 \u00b6 Dubbo\u6982\u5ff5 \u25cfDubbo\u662f\u963f\u91cc\u5df4\u5df4\u516c\u53f8\u5f00\u6e90\u7684\u4e00\u4e2a\u9ad8\u6027\u80fd\u3001\u8f7b\u91cf\u7ea7\u7684Java RPC\u6846\u67b6\u3002 \u25cf\u81f4\u529b\u4e8e\u63d0\u4f9b\u9ad8\u6027\u80fd\u548c\u900f\u660e\u5316\u7684RPC\u8fdc\u7a0b\u670d\u52a1\u8c03\u7528\u65b9\u6848,\u4ee5\u53caSOA\u670d\u52a1\u6cbb\u7406\u65b9\u6848\u3002 \u25cf\u5b98\u7f51: htp://ubbo.apache.orgo \u8282\u70b9\u89d2\u8272\u8bf4\u660e: . \u25cfProvider: \u66b4\u9732\u670d\u52a1\u7684\u670d\u52a1\u63d0\u4f9b\u65b9 \u25cfContahier: \u670d\u52a1\u8fd0\u884c\u5bb9\u5668 \u25cfConsumer: \u8c03\u7528\u8fdc\u7a0b\u670d\u52a1\u7684\u670d\u52a1\u6d88\u8d39\u65b9 \u25cfRegistry: \u670d\u52a1\u6ce8\u518c\u4e0e\u53d1\u73b0\u7684\u6ce8\u518c\u4e2d\u5fc3 \u25cfMonitor:\u7edf\u8ba1\u670d\u52a1\u7684\u8c03\u7528\u6b21\u6570\u548c\u8c03\u7528\u65f6\u95f4\u7684\u76d1\u63a7\u4e2d\u5fc3 4-dubbo\u5feb\u901f\u5165\u95e8 \u00b6 4.1zookeeper\u5b89\u88c5 \u00b6 \u5b89\u88c5\u6b65\u9aa4\uff1a \u7b2c\u4e00\u6b65\uff1a\u5b89\u88c5 jdk\uff08\u7565\uff09 \u7b2c\u4e8c\u6b65\uff1a\u628a zookeeper \u7684\u538b\u7f29\u5305\uff08zookeeper-3.4.6.tar.gz\uff09\u4e0a\u4f20\u5230 linux \u7cfb\u7edf \u7b2c\u4e09\u6b65\uff1a\u89e3\u538b\u7f29\u538b\u7f29\u5305 tar -zxvf zookeeper-3.4.6.tar.gz \u7b2c\u56db\u6b65\uff1a\u8fdb\u5165zookeeper-3.4.6\u76ee\u5f55\uff0c\u521b\u5efadata\u76ee\u5f55 mkdir data \u7b2c\u4e94\u6b65\uff1a\u8fdb\u5165conf\u76ee\u5f55 \uff0c\u628azoo_sample.cfg \u6539\u540d\u4e3azoo.cfg cd conf mv zoo_sample.cfg zoo.cfg \u7b2c\u516d\u6b65\uff1a\u6253\u5f00zoo.cfg\u6587\u4ef6, \u4fee\u6539data\u5c5e\u6027\uff1a dataDir = /root/zookeeper-3.4.6/data \u8fdb\u5165Zookeeper\u7684bin\u76ee\u5f55\uff0c\u542f\u52a8\u670d\u52a1\u547d\u4ee4 ./zkServer.sh start \u505c\u6b62\u670d\u52a1\u547d\u4ee4 ./zkServer.sh stop \u67e5\u770b\u670d\u52a1\u72b6\u6001\uff1astandalone \u5355\u8282\u70b9 ./zkServer.sh status 4.2spring\u548cspringmvc\u6574\u5408 \u00b6 \u5b9e\u65bd\u6b65\u9aa4\uff1a 1.\u521b\u5efa\u670d\u52a1\u63d0\u4f9b\u8005Provider\u6a21\u5757 2.\u521b\u5efa\u670d\u52a1\u6d88\u8d39\u8005Consumer\u6a21\u5757 3.\u5728\u670d\u52a1\u63d0\u4f9b\u8005\u6a21\u5757\u7f16\u5199UserServicelmpl\u63d0\u4f9b\u670d\u52a1 4.\u5728\u670d\u52a1\u6d88\u8d39\u8005\u4e2d\u7684UserC ontroller\u8fdc\u7a0b\u8c03\u7528 5.UserServicelmpl\u63d0\u4f9b\u7684\u670d\u52a1 6.\u5206\u522b\u542f\u52a8\u4e24\u4e2a\u670d\u52a1\uff0c\u6d4b\u8bd5 Dubbo\u4f5c\u4e3a\u4e00\u4e2aRPC\u6846\u67b6\uff0c\u5176\u6700\u6838\u5fc3\u7684\u529f\u80fd\u5c31\u662f\u8981\u5b9e\u73b0\u8de8\u7f51\u7edc\u7684\u8fdc\u7a0b\u8c03\u7528\u3002\u672c\u5c0f\u8282\u5c31\u662f\u8981\u521b\u5efa\u4e24\u4e2a\u5e94\u7528\uff0c\u4e00\u4e2a\u4f5c\u4e3a\u670d\u52a1\u7684\u63d0\u4f9b\u65b9\uff0c\u4e00\u4e2a\u4f5c\u4e3a\u670d\u52a1\u7684\u6d88\u8d39\u65b9\u3002\u901a\u8fc7Dubbo\u6765\u5b9e\u73b0\u670d\u52a1\u6d88\u8d39\u65b9\u8fdc\u7a0b\u8c03\u7528\u670d\u52a1\u63d0\u4f9b\u65b9\u7684\u65b9\u6cd5\u3002 1 \u670d\u52a1\u63d0\u4f9b\u65b9\u5f00\u53d1 \u5f00\u53d1\u6b65\u9aa4\uff1a \uff081\uff09\u521b\u5efamaven\u5de5\u7a0b\uff08\u6253\u5305\u65b9\u5f0f\u4e3awar\uff09dubbodemo_provider\uff0c\u5728pom.xml\u6587\u4ef6\u4e2d\u5bfc\u5165\u5982\u4e0b\u5750\u6807 <properties> <project.build.sourceEncoding> UTF-8 </project.build.sourceEncoding> <maven.compiler.source> 1.8 </maven.compiler.source> <maven.compiler.target> 1.8 </maven.compiler.target> <spring.version> 5.0.5.RELEASE </spring.version> </properties> <dependencies> <dependency> <groupId> org.springframework </groupId> <artifactId> spring-context </artifactId> <version> ${spring.version} </version> </dependency> <dependency> <groupId> org.springframework </groupId> <artifactId> spring-beans </artifactId> <version> ${spring.version} </version> </dependency> <dependency> <groupId> org.springframework </groupId> <artifactId> spring-webmvc </artifactId> <version> ${spring.version} </version> </dependency> <dependency> <groupId> org.springframework </groupId> <artifactId> spring-jdbc </artifactId> <version> ${spring.version} </version> </dependency> <dependency> <groupId> org.springframework </groupId> <artifactId> spring-aspects </artifactId> <version> ${spring.version} </version> </dependency> <dependency> <groupId> org.springframework </groupId> <artifactId> spring-jms </artifactId> <version> ${spring.version} </version> </dependency> <dependency> <groupId> org.springframework </groupId> <artifactId> spring-context-support </artifactId> <version> ${spring.version} </version> </dependency> <!-- dubbo\u76f8\u5173 --> <dependency> <groupId> com.alibaba </groupId> <artifactId> dubbo </artifactId> <version> 2.6.0 </version> </dependency> <dependency> <groupId> org.apache.zookeeper </groupId> <artifactId> zookeeper </artifactId> <version> 3.4.6 </version> </dependency> <dependency> <groupId> com.github.sgroschupf </groupId> <artifactId> zkclient </artifactId> <version> 0.1 </version> </dependency> <dependency> <groupId> javassist </groupId> <artifactId> javassist </artifactId> <version> 3.12.1.GA </version> </dependency> <dependency> <groupId> com.alibaba </groupId> <artifactId> fastjson </artifactId> <version> 1.2.47 </version> </dependency> </dependencies> <build> <plugins> <plugin> <groupId> org.apache.maven.plugins </groupId> <artifactId> maven-compiler-plugin </artifactId> <version> 2.3.2 </version> <configuration> <source> 1.8 </source> <target> 1.8 </target> </configuration> </plugin> <plugin> <groupId> org.apache.tomcat.maven </groupId> <artifactId> tomcat7-maven-plugin </artifactId> <configuration> <!-- \u6307\u5b9a\u7aef\u53e3 --> <port> 8081 </port> <!-- \u8bf7\u6c42\u8def\u5f84 --> <path> / </path> </configuration> </plugin> </plugins> </build> \uff082\uff09\u914d\u7f6eweb.xml\u6587\u4ef6 <!DOCTYPE web-app PUBLIC \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\" \"http://java.sun.com/dtd/web-app_2_3.dtd\" > <web-app> <display-name> Archetype Created Web Application </display-name> <context-param> <param-name> contextConfigLocation </param-name> <param-value> classpath:applicationContext*.xml </param-value> </context-param> <listener> <listener-class> org.springframework.web.context.ContextLoaderListener </listener-class> </listener> </web-app> \uff083\uff09\u521b\u5efa\u670d\u52a1\u63a5\u53e3 package com.itheima.service ; public interface HelloService { public String sayHello ( String name ); } \uff084\uff09\u521b\u5efa\u670d\u52a1\u5b9e\u73b0\u7c7b \u6ce8\u610f\uff1a \u670d\u52a1\u5b9e\u73b0\u7c7b\u4e0a\u4f7f\u7528\u7684Service\u6ce8\u89e3\u662fDubbo\u63d0\u4f9b\u7684\uff0c\u7528\u4e8e\u5bf9\u5916\u53d1\u5e03\u670d\u52a1 package com.itheima.service.impl ; import com.alibaba.dubbo.config.annotation.Service ; import com.itheima.service.HelloService ; @Service public class HelloServiceImpl implements HelloService { public String sayHello ( String name ) { return \"hello \" + name ; } } tomcat7:run 2 \u670d\u52a1\u6d88\u8d39\u65b9\u5f00\u53d1 \u5f00\u53d1\u6b65\u9aa4\uff1a \uff081\uff09\u521b\u5efamaven\u5de5\u7a0b\uff08\u6253\u5305\u65b9\u5f0f\u4e3awar\uff09dubbodemo_consumer\uff0cpom.xml\u914d\u7f6e\u548c\u4e0a\u9762\u670d\u52a1\u63d0\u4f9b\u8005\u76f8\u540c\uff0c\u53ea\u9700\u8981\u5c06Tomcat\u63d2\u4ef6\u7684\u7aef\u53e3\u53f7\u6539\u4e3a8082\u5373\u53ef \uff082\uff09\u914d\u7f6eweb.xml\u6587\u4ef6 <!DOCTYPE web-app PUBLIC \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\" \"http://java.sun.com/dtd/web-app_2_3.dtd\" > <web-app> <display-name> Archetype Created Web Application </display-name> <servlet> <servlet-name> springmvc </servlet-name> <servlet-class> org.springframework.web.servlet.DispatcherServlet </servlet-class> <!-- \u6307\u5b9a\u52a0\u8f7d\u7684\u914d\u7f6e\u6587\u4ef6 \uff0c\u901a\u8fc7\u53c2\u6570contextConfigLocation\u52a0\u8f7d --> <init-param> <param-name> contextConfigLocation </param-name> <param-value> classpath:applicationContext-web.xml </param-value> </init-param> <load-on-startup> 1 </load-on-startup> </servlet> <servlet-mapping> <servlet-name> springmvc </servlet-name> <url-pattern> *.do </url-pattern> </servlet-mapping> </web-app> \uff083\uff09\u5c06\u670d\u52a1\u63d0\u4f9b\u8005\u5de5\u7a0b\u4e2d\u7684HelloService\u63a5\u53e3\u590d\u5236\u5230\u5f53\u524d\u5de5\u7a0b \uff084\uff09\u7f16\u5199Controller package com.itheima.controller ; import com.alibaba.dubbo.config.annotation.Reference ; import com.itheima.service.HelloService ; import org.springframework.stereotype.Controller ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.ResponseBody ; @Controller @RequestMapping ( \"/demo\" ) public class HelloController { @Reference private HelloService helloService ; @RequestMapping ( \"/hello\" ) @ResponseBody public String getName ( String name ){ //\u8fdc\u7a0b\u8c03\u7528 String result = helloService . sayHello ( name ); System . out . println ( result ); return result ; } } \u6ce8\u610f\uff1aController\u4e2d\u6ce8\u5165HelloService\u4f7f\u7528\u7684\u662fDubbo\u63d0\u4f9b\u7684@Reference\u6ce8\u89e3 4.3\u670d\u52a1\u63d0\u4f9b\u8005 \u00b6 \u5728dubbodemo_provider\u5de5\u7a0b\u4e2dsrc/main/resources\u4e0b\u521b\u5efaapplicationContext-service.xml <?xml version=\"1.0\" encoding=\"UTF-8\"?> <beans xmlns= \"http://www.springframework.org/schema/beans\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xmlns:p= \"http://www.springframework.org/schema/p\" xmlns:context= \"http://www.springframework.org/schema/context\" xmlns:dubbo= \"http://code.alibabatech.com/schema/dubbo\" xmlns:mvc= \"http://www.springframework.org/schema/mvc\" xsi:schemaLocation= \"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd\" > <!-- \u5f53\u524d\u5e94\u7528\u540d\u79f0\uff0c\u7528\u4e8e\u6ce8\u518c\u4e2d\u5fc3\u8ba1\u7b97\u5e94\u7528\u95f4\u4f9d\u8d56\u5173\u7cfb\uff0c\u6ce8\u610f\uff1a\u6d88\u8d39\u8005\u548c\u63d0\u4f9b\u8005\u5e94\u7528\u540d\u4e0d\u8981\u4e00\u6837 --> <dubbo:application name= \"dubbodemo_provider\" /> <!-- \u8fde\u63a5\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3zookeeper ip\u4e3azookeeper\u6240\u5728\u670d\u52a1\u5668\u7684ip\u5730\u5740--> <dubbo:registry address= \"zookeeper://192.168.134.129:2181\" /> <!-- \u6ce8\u518c \u534f\u8bae\u548cport \u7aef\u53e3\u9ed8\u8ba4\u662f20880 --> <dubbo:protocol name= \"dubbo\" port= \"20881\" ></dubbo:protocol> <!-- \u626b\u63cf\u6307\u5b9a\u5305\uff0c\u52a0\u4e0a@Service\u6ce8\u89e3\u7684\u7c7b\u4f1a\u88ab\u53d1\u5e03\u4e3a\u670d\u52a1 --> <dubbo:annotation package= \"com.itheima.service.impl\" /> </beans> 4.4\u670d\u52a1\u6d88\u8d39\u8005 \u00b6 \u5728dubbodemo_consumer\u5de5\u7a0b\u4e2dsrc/main/resources\u4e0b\u521b\u5efaapplicationContext-web.xml <?xml version=\"1.0\" encoding=\"UTF-8\"?> <beans xmlns= \"http://www.springframework.org/schema/beans\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xmlns:p= \"http://www.springframework.org/schema/p\" xmlns:context= \"http://www.springframework.org/schema/context\" xmlns:dubbo= \"http://code.alibabatech.com/schema/dubbo\" xmlns:mvc= \"http://www.springframework.org/schema/mvc\" xsi:schemaLocation= \"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd\" > <!-- \u5f53\u524d\u5e94\u7528\u540d\u79f0\uff0c\u7528\u4e8e\u6ce8\u518c\u4e2d\u5fc3\u8ba1\u7b97\u5e94\u7528\u95f4\u4f9d\u8d56\u5173\u7cfb\uff0c\u6ce8\u610f\uff1a\u6d88\u8d39\u8005\u548c\u63d0\u4f9b\u8005\u5e94\u7528\u540d\u4e0d\u8981\u4e00\u6837 --> <dubbo:application name= \"dubbodemo-consumer\" /> <!-- \u8fde\u63a5\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3zookeeper ip\u4e3azookeeper\u6240\u5728\u670d\u52a1\u5668\u7684ip\u5730\u5740--> <dubbo:registry address= \"zookeeper://192.168.134.129:2181\" /> <!-- \u5305\u626b\u63cf\u7684\u65b9\u5f0f \u5f15\u7528\u670d\u52a1 \u626b\u63cf@Reference --> <dubbo:annotation package= \"com.itheima.controller\" /> </beans> \u8fd0\u884c\u6d4b\u8bd5 tomcat7:run\u542f\u52a8 \u5728\u6d4f\u89c8\u5668\u8f93\u5165http://localhost:8082/demo/hello.do?name=Jack\uff0c\u67e5\u770b\u6d4f\u89c8\u5668\u8f93\u51fa\u7ed3\u679c 5-dubbo\u9ad8\u7ea7\u7279\u6027 \u00b6 5.1dubbo-admin\u5b89\u88c5 \u00b6 dubbo- admin \u25cfdubbo-admin\u7ba1\u7406\u5e73\u53f0\uff0c\u662f\u56fe\u5f62\u5316\u7684\u670d\u52a1\u7ba1\u7406\u9875\u9762 \u25cf\u4ece\u6ce8\u518c\u4e2d\u5fc3\u4e2d\u83b7\u53d6\u5230\u6240\u6709\u7684\u63d0\u4f9b\u8005 /\u6d88\u8d39\u8005\u8fdb\u884c\u914d\u7f6e\u7ba1\u7406 \u25cf\u8def\u7531\u89c4\u5219\u3001\u52a8\u6001\u914d\u7f6e\u3001\u670d\u52a1\u964d\u7ea7\u3001\u8bbf\u95ee\u63a7\u5236\u3001\u6743\u91cd\u8c03\u6574\u3001\u8d1f\u8f7d\u5747\u8861\u7b49\u7ba1\u7406\u529f\u80fd \u25cfdubbo- admin\u662f\u4e00\u4e2a\u524d\u540e\u7aef\u5206\u79bb\u7684\u9879\u76ee\u3002\u524d\u7aef\u4f7f\u7528vue\uff0c\u540e\u7aef\u4f7f\u7528springboot \u25cf\u5b89\u88c5dubbo-admin\u5176\u5b9e\u5c31\u662f\u90e8\u7f72\u8be5\u9879\u76ee \u5177\u4f53\u5b89\u88c5\u53c2\u89c1\uff1adubbo-admin.md 5.2-dubbo-admin\u4f7f\u7528 \u00b6 \u5177\u4f53\u5b89\u88c5\u53c2\u89c1\uff1adubbo-admin.md 5.3\u5e8f\u5217\u5316 \u00b6 dubbo \u5185\u90e8\u5df2\u7ecf\u5c06\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u7684\u8fc7\u7a0b\u5185\u90e8\u5c01\u88c5\u4e86 \u6211\u4eec\u53ea\u9700\u8981\u5728\u5b9a\u4e49pojo\u7c7b\u65f6 \u5b9e\u73b0seriali zable\u63a5\u53e3 \u5373\u53ef \u4e00\u822c\u4f1a\u5b9a\u4e49\u4e00 \u4e2a\u516c\u5171\u7684pojo\u6a21\u5757,\u8ba9\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u90fd\u4f9d\u8d56\u8be5\u6a21\u5757\u3002 User\u5bf9\u8c61\u672a\u5b9e\u73b0seriali zable\u63a5\u53e3 \u9519\u8bef\u4fe1\u606f\uff1a \u89e3\u51b3\u529e\u6cd5\uff1a User implements Serializable 5.4\u5730\u5740\u7f13\u5b58 \u00b6 \u6ce8\u518c\u4e2d\u5fc3\u6302\u4e86\uff0c\u670d\u52a1\u662f\u5426\u53ef\u4ee5\u6b63\u5e38\u8bbf\u95ee\uff1f \u53ef\u4ee5\uff0c\u56e0\u4e3adubbo\u670d\u52a1\u6d88\u8d39\u8005\u5728\u7b2c\u4e00-\u6b21\u8c03\u7528\u65f6\uff0c\u4f1a\u5c06\u670d\u52a1\u63d0\u4f9b\u65b9\u5730\u5740\u7f13\u5b58\u5230\u672c\u5730\uff0c\u4ee5\u540e\u5728\u8c03\u7528\u5219\u4e0d\u4f1a\u8bbf\u95ee\u6ce8\u518c\u4e2d\u5fc3\u3002 \u5f53\u670d\u52a1\u63d0\u4f9b\u8005\u5730\u5740\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u6ce8\u518c\u4e2d\u5fc3\u4f1a\u901a\u77e5\u670d\u52a1\u6d88\u8d39\u8005\u3002 5.5 \u8d85\u65f6 \u00b6 \u670d\u52a1\u6d88\u8d39\u8005\u5728\u8c03\u7528\u670d\u52a1\u63d0\u4f9b\u8005\u7684\u65f6\u5019\u53d1\u751f\u4e86\u963b\u585e\u3001\u7b49\u5f85\u7684\u60c5\u5f62,\u8fd9\u4e2a\u65f6\u5019,\u670d\u52a1\u6d88\u8d39\u8005\u4f1a\u76f4\u7b49\u5f85\u4e0b\u53bb\u3002 \u5728\u67d0\u4e2a\u5cf0\u503c\u65f6\u523b\uff0c\u5927\u91cf\u7684\u8bf7\u6c42\u90fd\u5728\u540c\u65f6\u8bf7\u6c42\u670d\u52a1\u6d88\u8d39\u8005,\u4f1a\u9020\u6210\u7ebf\u7a0b\u7684\u5927\u91cf\u5806\u79ef\uff0c\u52bf\u5fc5\u4f1a\u9020\u6210\u96ea\u5d29\u3002 dubbo\u5229\u7528\u8d85\u65f6\u673a\u5236\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u8bbe\u7f6e-\u4e2a\u8d85\u65f6\u65f6\u95f4, \u5728\u8fd9\u4e2a\u65f6\u95f4\u6bb5\u5185\uff0c\u65e0\u6cd5\u5b8c\u6210\u670d\u52a1\u8bbf\u95ee,\u5219\u81ea\u52a8\u65ad\u5f00\u8fde\u63a5\u3002 \u4f7f\u7528timeout\u5c5e\u6027\u914d\u7f6e\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u503c1000\uff0c\u5355\u4f4d\u6beb\u79d2 //timeout \u8d85\u65f6\u65f6\u95f4 \u5355\u4f4d\u6beb\u79d2 retries \u91cd\u8bd5\u6b21\u6570 @Service ( timeout = 3000 , retries = 0 ) 5.6\u91cd\u8bd5 \u00b6 \u8bbe\u7f6e\u4e86\u8d85\u65f6\u65f6\u95f4\uff0c\u5728\u8fd9\u4e2a\u65f6\u95f4\u6bb5\u5185\uff0c\u65e0\u6cd5\u5b8c\u6210\u670d\u52a1\u8bbf\u95ee,\u5219\u81ea\u52a8\u65ad\u5f00\u8fde\u63a5\u3002 \u5982\u679c\u51fa\u73b0\u7f51\u7edc\u6296\u52a8,\u5219\u8fd9\u4e00-\u6b21\u8bf7\u6c42\u5c31\u4f1a\u5931\u8d25\u3002 Dubbo\u63d0\u4f9b\u91cd\u8bd5\u673a\u5236\u6765\u907f\u514d\u7c7b\u4f3c\u95ee\u9898\u7684\u53d1\u751f\u3002 \u901a\u8fc7retries\u5c5e\u6027\u6765\u8bbe\u7f6e\u91cd\u8bd5\u6b21\u6570\u3002\u9ed8\u8ba4\u4e3a2\u6b21 //timeout \u8d85\u65f6\u65f6\u95f4 \u5355\u4f4d\u6beb\u79d2 retries \u91cd\u8bd5\u6b21\u6570 @Service ( timeout = 3000 , retries = 0 ) 5.7\u591a\u7248\u672c \u00b6 \u7070\u5ea6\u53d1\u5e03: \u5f53\u51fa\u73b0\u65b0\u529f\u80fd\u65f6,\u4f1a\u8ba9\u4e00\u90e8\u5206\u7528\u6237\u5148\u4f7f\u7528\u65b0\u529f\u80fd\uff0c\u7528\u6237\u53cd\u9988\u6ca1\u95ee\u9898\u65f6\uff0c\u518d\u5c06\u6240\u6709\u7528\u6237\u8fc1\u79fb\u5230\u65b0\u529f\u80fd\u3002 dubbo\u4e2d\u4f7f\u7528version\u5c5e\u6027\u6765\u8bbe\u7f6e\u548c\u8c03\u7528\u540c\u4e00\u4e2a\u63a5\u53e3\u7684\u4e0d\u540c\u7248\u672c \u751f\u4ea7\u8005\u914d\u7f6e @Service ( version = \"v2.0\" ) public class UserServiceImp12 implements UserService {...} \u6d88\u8d39\u8005\u914d\u7f6e @Reference ( version = \"v2.0\" ) //\u8fdc\u7a0b\u6ce8\u5165 private UserService userService ; 5.8\u8d1f\u8f7d\u5747\u8861 \u00b6 \u8d1f\u8f7d\u5747\u8861\u7b56\u7565(4\u79cd) : Random: \u6309\u6743\u91cd\u968f\u673a\uff0c\u9ed8\u8ba4\u503c\u3002\u6309\u6743\u91cd\u8bbe\u7f6e\u968f\u673a\u6982\u7387\u3002 RoundRobin: \u6309\u6743\u91cd\u8f6e\u8be2\u3002 LeastActive: \u6700\u5c11\u6d3b\u8dc3\u8c03\u7528\u6570,\u76f8\u540c\u6d3b\u8dc3\u6570\u7684\u968f\u673a\u3002 ConsistentHash: \u4e00 \u81f4\u6027Hash,\u76f8\u540c\u53c2\u6570\u7684\u8bf7\u6c42\u603b\u662f\u53d1\u5230\u540c\u4e00\u63d0\u4f9b\u8005\u3002 \u670d\u52a1\u63d0\u4f9b\u8005\u914d\u7f6e @Service ( weight = 100 ) public class UserServiceImp12 implements UserService {...} application.xml \u914d\u7f6eparameter key \u6d88\u8d39\u8005\u914d\u7f6e //@Reference(loadbalance = \"roundrobin\") //@Reference(loadbalance = \"leastactive\") //@Reference(loadbalance = \"consistenthash\") @Reference ( loadbalance = \"random\" ) //\u9ed8\u8ba4 \u6309\u6743\u91cd\u968f\u673a private UserService userService ; 5.9\u96c6\u7fa4\u5bb9\u9519 \u00b6 \u96c6\u7fa4\u5bb9\u9519\u6a21\u5f0f: Failover Cluster: \u5931\u8d25\u91cd\u8bd5\u3002\u9ed8\u8ba4\u503c\u3002\u5f53\u51fa\u73b0\u5931\u8d25\uff0c\u91cd\u8bd5\u5176\u5b83\u670d\u52a1\u5668\uff0c\u9ed8\u8ba4\u91cd\u8bd52\u6b21\uff0c\u4f7f\u7528retries\u914d\u7f6e\u3002\u4e00\u822c\u7528\u4e8e\u8bfb\u64cd\u4f5c Failfast Cluster : \u5feb\u901f\u5931\u8d25,\u53d1\u8d77-\u6b21\u8c03\u7528\uff0c\u5931\u8d25\u7acb\u5373\u62a5\u9519\u3002\u901a\u5e38\u7528\u4e8e\u5199\u64cd\u4f5c\u3002 Failsafe Cluster: \u5931\u8d25\u5b89\u5168\uff0c\u51fa\u73b0\u5f02\u5e38\u65f6\uff0c\u76f4\u63a5\u5ffd\u7565\u3002\u8fd4\u56de\u4e00\u4e2a\u7a7a\u7ed3\u679c\u3002 Failback Cluster: \u5931\u8d25\u81ea\u52a8\u6062\u590d,\u540e\u53f0\u8bb0\u5f55\u5931\u8d25\u8bf7\u6c42,\u5b9a\u65f6\u91cd\u53d1\u3002 Forking Cluster : \u5e76\u884c\u8c03\u7528\u591a\u4e2a\u670d\u52a1\u5668\uff0c\u53ea\u8981\u4e00\u4e2a\u6210\u529f\u5373\u8fd4\u56de\u3002 Broadcast Cluster: \u5e7f\u64ad\u8c03\u7528\u6240\u6709\u63d0\u4f9b\u8005,\u9010\u4e2a\u8c03\u7528\uff0c\u4efb\u610f\u4e00\u53f0\u62a5\u9519\u5219\u62a5\u9519\u3002 \u6d88\u8d39\u8005\u914d\u7f6e @Reference ( cluster = \"failover\" ) //\u8fdc\u7a0b\u6ce8\u5165 private UserService userService ; 5.10\u670d\u52a1\u964d\u7ea7 \u00b6 \u670d\u52a1\u964d\u7ea7 \uff1a\u5f53\u670d\u52a1\u5668\u538b\u529b\u5267\u589e\u7684\u60c5\u51b5\u4e0b\uff0c\u6839\u636e\u5b9e\u9645\u4e1a\u52a1\u60c5\u51b5\u53ca\u6d41\u91cf\uff0c\u5bf9\u4e00\u4e9b\u670d\u52a1\u548c\u9875\u9762\u6709\u7b56\u7565\u7684\u4e0d\u5904\u7406\u6216\u6362\u79cd\u7b80\u5355\u7684\u65b9\u5f0f\u5904\u7406\uff0c\u4ece\u800c\u91ca\u653e\u670d\u52a1\u5668\u8d44\u6e90\u4ee5\u4fdd\u8bc1 \u6838\u5fc3\u4ea4\u6613 \u6b63\u5e38\u8fd0\u4f5c\u6216\u9ad8\u6548\u8fd0\u4f5c \u670d\u52a1\u964d\u7ea7\u65b9\u5f0f: mock= force:return null \uff1a\u8868\u793a\u6d88\u8d39\u65b9\u5bf9\u8be5\u670d\u52a1\u7684\u65b9\u6cd5\u8c03\u7528\u90fd\u76f4\u63a5\u8fd4\u56denull\u503c,\u4e0d\u53d1\u8d77\u8fdc\u7a0b\u8c03\u7528\u3002\u7528\u6765\u5c4f\u853d\u4e0d\u91cd\u8981\u670d\u52a1\u4e0d\u53ef\u7528\u65f6\u5bf9\u8c03\u7528\u65b9\u7684\u5f71\u54cd\u3002 mock=fail:return null \uff1a\u8868\u793a\u6d88\u8d39\u65b9\u5bf9\u8be5\u670d\u52a1\u7684\u65b9\u6cd5\u8c03\u7528\u5728\u5931\u8d25\u540e\uff0c\u518d\u8fd4\u56denull\u503c,\u4e0d\u629b\u5f02\u5e38\u3002\u7528\u6765\u5bb9\u5fcd\u4e0d\u91cd\u8981\u670d\u52a1\u4e0d\u7a33\u5b9a\u65f6\u5bf9\u8c03\u7528\u65b9\u7684\u5f71\u54cd \u6d88\u8d39\u65b9\u914d\u7f6e //\u8fdc\u7a0b\u6ce8\u5165 @Reference ( mock = \u201c force : return null \")//\u4e0d\u518d\u8c03\u7528userService\u7684\u670d\u52a1 private UserService userService;","title":"\u9879\u76ee\u4e00\u524d\u7f6e\u8bfe-Dubbo"},{"location":"dubbo/dubbo/#1-","text":"\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u7684\u76f8\u5173\u6982\u5ff5 dubbo \u6982\u8ff0 dubbo\u5feb\u901f\u5165\u95e8 dubbo\u7684\u9ad8\u7ea7\u7279\u6027","title":"1-\u4eca\u65e5\u5185\u5bb9"},{"location":"dubbo/dubbo/#2-","text":"","title":"2-\u76f8\u5173\u6982\u5ff5"},{"location":"dubbo/dubbo/#21--","text":"\u4e92\u8054\u7f51\u9879\u76ee\u67b6\u6784-\u7279\u70b9 \u7528\u6237\u591a \u6d41\u91cf\u5927\uff0c\u5e76\u53d1\u9ad8 \u6d77\u91cf\u6570\u636e \u6613\u53d7\u653b\u51fb \u529f\u80fd\u7e41\u7410 \u53d8\u66f4\u5feb \u4f20\u7edf\u9879\u76ee\u548c\u4e92\u8054\u7f51\u9879\u76ee\u7684\u4e0d\u540c \u7528\u6237\u4f53\u9a8c \uff1a \u7f8e\u89c2\u3001\u529f\u80fd\u3001\u901f\u5ea6\u3001\u7a33\u5b9a\u6027 \u8861\u91cf\u4e00\u4e2a\u7f51\u7ad9\u901f\u5ea6\u662f\u5426\u5feb: \u6253\u5f00\u4e00\u4e2a\u65b0\u9875\u9762\u4e00\u77ac\u95f4\u5b8c\u6210;\u9875\u9762\u5185\u8df3\u8f6c\uff0c-\u5239\u90a3\u95f4\u5b8c\u6210\u3002 \u6839\u636e\u4f5b\u7ecf\u300a\u50e7\u8879\u5f8b\u300b\u8bb0\u8f7d:\u4e00 \u5239\u90a3\u8005\u4e3a-\u5ff5,\u4e8c\u5341\u5ff5\u4e3a-\u77ac,\u4e8c\u5341\u77ac\u4e3a-\u5f39 \u6307\uff0c\u4e8c\u5341\u5f39\u6307\u4e3a-\u7f57\u9884\uff0c \u4e8c\u5341\u7f57\u9884\u4e3a-\u987b\u81fe\uff0c\u4e00\u65e5\u4e00\u591c\u6709\u4e09\u5341\u987b\u81fe\u3002","title":"2.1-\u4e92\u8054\u7f51\u9879\u76ee\u67b6\u6784-\u7279\u70b9"},{"location":"dubbo/dubbo/#22--","text":"\u8861\u91cf\u7f51\u7ad9\u7684\u6027\u80fd\u6307\u6807: \u54cd\u5e94\u65f6\u95f4: \u6307\u6267\u884c\u4e00\u4e2a\u8bf7\u6c42\u4ece\u5f00\u59cb\u5230\u6700\u540e\u6536\u5230\u54cd\u5e94\u6570\u636e\u6240\u82b1\u8d39\u7684\u603b\u4f53\u65f6\u95f4\u3002 \u5e76\u53d1\u6570: \u6307\u7cfb\u7edf\u540c\u65f6\u80fd\u5904\u7406\u7684\u8bf7\u6c42\u6570\u91cf\u3002 \u5e76\u53d1\u8fde\u63a5\u6570: \u6307\u7684\u662f\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u53d1\u8d77\u8bf7\u6c42\uff0c\u5e76\u5efa\u7acb\u4e86TCP\u8fde\u63a5\u3002\u6bcf\u79d2\u949f\u670d\u52a1\u5668\u8fde\u63a5\u7684\u603bTCP\u6570\u91cf \u8bf7\u6c42\u6570: \u4e5f\u79f0\u4e3aQPS(Query Per Second)\u6307\u6bcf\u79d2\u591a\u5c11\u8bf7\u6c42. \u5e76\u53d1\u7528\u6237\u6570: \u5355\u4f4d\u65f6\u95f4\u5185\u6709\u591a\u5c11\u7528\u6237 \u541e\u5410\u91cf: \u6307\u5355\u4f4d\u65f6\u95f4\u5185\u7cfb\u7edf\u80fd\u5904\u7406\u7684\u8bf7\u6c42\u6570\u91cf\u3002 \u25cf QPS : Query Per Second\u6bcf\u79d2\u67e5\u8be2\u6570 \u3002 \u25cf TPS : Transactions Per Second\u6bcf\u79d2\u4e8b\u52a1\u6570 \u3002 \u25cf \u4e00\u4e2a\u4e8b\u52a1\u662f\u6307\u4e00 \u4e2a\u5ba2\u6237\u673a\u5411\u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42\u7136\u540e\u670d\u52a1\u5668\u505a\u51fa\u53cd\u5e94\u7684\u8fc7\u7a0b \u3002 \u5ba2\u6237\u673a\u5728\u53d1\u9001\u8bf7\u6c42\u65f6\u5f00\u59cb\u8ba1\u65f6 \uff0c \u6536\u5230\u670d\u52a1\u5668\u54cd\u5e94\u540e\u7ed3\u675f \u8ba1\u65f6 \uff0c \u4ee5\u6b64\u6765\u8ba1\u7b97\u4f7f\u7528\u7684\u65f6\u95f4\u548c\u5b8c\u6210\u7684\u4e8b\u52a1\u4e2a\u6570 \u3002 \u25cf \u4e00\u4e2a\u9875\u9762\u7684\u4e00\u6b21\u8bbf\u95ee \uff0c \u53ea\u4f1a\u5f62\u6210\u4e00 \u4e2aTPS ; \u4f46-\u6b21\u9875\u9762\u8bf7\u6c42 \uff0c \u53ef\u80fd\u4ea7\u751f\u591a\u6b21\u5bf9\u670d\u52a1\u5668\u7684\u8bf7\u6c42 \uff0c \u5c31\u4f1a\u6709\u591a\u4e2aQPS QPS >= \u5e76\u53d1\u8fde\u63a5\u6570 >= TPS \u5927\u578b\u4e92\u8054\u7f51\u9879\u76ee\u67b6\u6784\u76ee\u6807 : \u200b \u25cf \u9ad8\u6027\u80fd: \u63d0\u4f9b\u5feb\u901f\u7684\u8bbf\u95ee\u4f53\u9a8c\u3002 \u200b \u25cf \u9ad8\u53ef\u7528: \u7f51\u7ad9\u670d\u52a1- \u53ef\u4ee5\u6b63\u5e38\u8bbf\u95ee","title":"2.2-\u4e92\u8054\u7f51\u9879\u76ee\u67b6\u6784-\u76ee\u6807"},{"location":"dubbo/dubbo/#23-","text":"\u96c6\u7fa4\u548c\u5206\u5e03\u5f0f\uff0c \u25cf\u96c6\u7fa4:\u5f88\u591a\u201c\u4eba\u201d\u4e00\u8d77\uff0c\u5e72\u4e00\u6837\u7684\u4e8b\u3002 \u25cf\u4e00\u4e2a\u4e1a\u52a1\u6a21\u5757\uff0c\u90e8\u7f72\u5728\u591a\u53f0\u670d\u52a1\u5668\u4e0a\u3002 \u25cf\u5206\u5e03\u5f0f:\u5f88\u591a\"\u4eba\u201d\u4e00\u8d77\uff0c\u5e72\u4e0d\u6837\u7684\u4e8b\u3002\u8fd9\u4e9b\u4e0d\u4e00\u6837\u7684\u4e8b\uff0c \u5408\u8d77\u6765\u662f\u4e00\u4ef6\u5927\u4e8b\u3002","title":"2.3-\u96c6\u7fa4\u548c\u5206\u5e03\u5f0f"},{"location":"dubbo/dubbo/#24-","text":"\u5355\u4f53\u67b6\u6784\uff1a \u4f18\u70b9: \u7b80\u5355:\u5f00\u53d1\u90e8\u7f72\u90fd\u5f88\u65b9\u4fbf\uff0c\u5c0f\u578b\u9879\u76ee\u9996\u9009 \u7f3a\u70b9: \u25cf\u9879\u76ee\u542f\u52a8\u6162 \u25cf\u53ef\u9760\u6027\u5dee \u5782\u76f4\u67b6\u6784\uff1a \u5782\u76f4\u67b6\u6784\u662f\u6307\u5c06\u5355\u4f53\u67b6\u6784\u4e2d\u7684\u591a\u4e2a\u6a21\u5757\u62c6\u5206\u4e3a\u591a\u4e2a\u72ec\u7acb\u7684\u9879\u76ee\u3002\u5f62\u6210\u591a\u4e2a\u72ec\u7acb\u7684\u5355\u4f53\u67b6\u6784\u3002 \u5355\u4f53\u67b6\u6784\u5b58\u5728\u7684\u95ee\u9898: \u9879\u76ee\u542f\u52a8\u6162 \u53ef\u9760\u6027\u5dee \u53ef\u4f38\u7f29\u6027\u5dee \u6269\u5c55\u6027\u548c\u53ef\u7ef4\u62a4\u6027\u5dee \u6027\u80fd\u4f4e \u5782\u76f4\u67b6\u6784\u5b58\u5728\u7684\u95ee\u9898: \u91cd\u590d\u529f\u80fd\u592a\u591a \u5206\u5e03\u5f0f\u67b6\u6784\uff1a \u662f\u6307\u5728\u5782\u76f4\u67b6\u6784\u7684\u57fa\u7840\u4e0a,\u5c06\u516c\u5171\u4e1a\u52a1\u6a21\u5757\u62bd\u53d6\u51fa\u6765,\u4f5c\u4e3a\u72ec\u7acb\u7684\u670d\u52a1\u4f9b\u5176\u4ed6\u8c03\u7528\u8005\u6d88\u8d39\uff0c\u4ee5\u5b9e\u73b0\u670d\u52a1\u7684\u5171\u4eab\u548c\u91cd\u7528\u3002\u5e95\u5c42\u901a\u8fc7RPC\uff08\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\u5b9e\u73b0\uff09 RPC: Remote Procedure Call\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\u3002\u6709\u975e\u5e38\u591a\u7684\u534f\u8bae\u548c\u6280\u672f\u6765\u90fd\u5b9e\u73b0\u4e86RPC\u7684\u8fc7\u7a0b\u3002\u6bd4\u5982: HTTP REST\u98ce\u683c\uff0cJava RMI\u89c4\u8303\u3001WebService SOAP\u534f\u8baeHession\u7b49\u7b49\u3002 \u5782\u76f4\u67b6\u6784\u5b58\u5728\u7684\u95ee\u9898: \u25cf\u91cd\u590d\u529f\u80fd\u592a\u591a \u5206\u5e03\u5f0f\u67b6\u6784\u5b58\u5728\u7684\u95ee\u9898: \u200b \u25cf\u670d\u52a1\u63d0\u4f9b\u65b9- -\u65e6\u4ea7\u751f\u53d8\u66f4,\u6240\u6709\u6d88\u8d39\u65b9\u90fd\u9700\u8981\u53d8\u66f4\u3002 SOA: (Service- Oriented Architecture,\u9762\u5411\u670d\u52a1\u7684\u67b6\u6784) \uff1a\u662f\u4e00\u4e2a\u7ec4\u4ef6\u6a21\u578b,\u5b83\u5c06\u5e94\u7528\u7a0b\u5e8f\u7684\u4e0d\u540c\u529f\u80fd\u5355\u5143(\u79f0\u4e3a\u670d\u52a1)\u8fdb\u884c\u62c6\u5206\uff0c\u5e76\u901a\u8fc7\u8fd9\u4e9b\u670d\u52a1\u4e4b\u95f4\u5b9a\u4e49\u826f\u597d\u7684\u63a5\u53e3\u548c\u5951\u7ea6\u8054\u7cfb\u8d77\u6765\u3002 ESB: (Enterparise Servce Bus) \uff1a\u4f01\u4e1a\u670d\u52a1\u603b\u7ebf,\u670d\u52a1\u4e2d\u4ecb\u3002\u4e3b\u8981\u662f\u63d0\u4f9b\u4e86\u4e00\u4e00\u4e2a\u670d \u52a1\u4e8e\u670d\u52a1\u4e4b\u95f4\u7684\u4ea4\u4e92\u3002ESB\u5305\u542b\u7684\u529f\u80fd\u5982:\u8d1f\u8f7d\u5747\u8861\uff0c\u6d41\u91cf\u63a7\u5236\uff0c\u52a0\u5bc6\u5904\u7406\uff0c\u670d\u52a1 \u7684\u76d1\u63a7\uff0c\u5f02\u5e38\u5904\u7406\uff0c\u76d1\u63a7\u544a\u6025\u7b49\u7b49\u3002 \u5fae\u670d\u52a1\u67b6\u6784\uff1a \u25cf\u5fae\u670d\u52a1\u67b6\u6784\u662f\u5728SOA\u4e0a\u505a\u7684\u5347\u534e,\u5fae\u670d\u52a1\u67b6\u6784\u5f3a\u8c03\u7684\u4e00\u4e2a\u91cd\u70b9\u662f\u201c\u4e1a\u52a1\u9700\u8981\u5f7b\u5e95\u7684\u7ec4\u4ef6\u5316\u548c\u670d\u52a1\u5316\u201d\uff0c\u539f\u6709\u7684\u5355\u4e2a \u4e1a\u52a1\u7cfb\u7edf\u4f1a\u62c6\u5206\u4e3a\u591a\u4e2a\u53ef\u4ee5\u72ec\u7acb\u5f00\u53d1\u3001\u8bbe\u8ba1\u3001\u8fd0\u884c\u7684\u5c0f\u5e94\u7528\u3002\u8fd9\u4e9b\u5c0f\u5e94\u7528\u4e4b\u95f4\u901a\u8fc7\u670d\u52a1\u5b8c\u6210\u4ea4\u4e92\u548c\u96c6\u6210\u3002 \u25cf\u5fae\u670d\u52a1\u67b6\u6784= 80%\u7684SOA\u670d\u52a1\u67b6\u6784\u601d\u60f3+ 100%\u7684\u7ec4\u4ef6\u5316\u67b6\u6784\u601d\u60f3+ 80%\u7684\u9886\u57df\u5efa\u6a21\u601d\u60f3 \u7279\u70b9: \u25cf\u670d\u52a1\u5b9e\u73b0\u7ec4\u4ef6\u5316:\u5f00\u53d1\u8005\u53ef\u4ee5\u81ea\u7531\u9009\u62e9\u5f00\u53d1\u6280\u672f\u3002\u4e5f\u4e0d\u9700\u8981\u534f\u8c03\u5176\u4ed6\u56e2\u961f \u25cf\u670d\u52a1\u4e4b\u95f4\u4ea4\u4e92\u4e00 \u822c\u4f7f\u7528REST API \u25cf\u53bb\u4e2d\u5fc3\u5316:\u6bcf\u4e2a\u5fae\u670d\u52a1\u6709\u81ea\u5df1\u79c1\u6709\u7684\u6570\u636e\u5e93\u6301\u4e45\u5316\u4e1a\u52a1\u6570\u636e \u25cf\u81ea\u52a8\u5316\u90e8\u7f72:\u628a\u5e94\u7528\u62c6\u5206\u6210\u4e3a\u4e00 \u4e2a-\u4e2a\u72ec\u7acb\u7684\u5355\u4e2a\u670d\u52a1,\u65b9\u4fbf\u81ea\u52a8\u5316\u90e8\u7f72\u3001\u6d4b\u8bd5\u3001\u8fd0\u7ef4","title":"2.4-\u67b6\u6784\u6f14\u8fdb"},{"location":"dubbo/dubbo/#3-dubbo","text":"Dubbo\u6982\u5ff5 \u25cfDubbo\u662f\u963f\u91cc\u5df4\u5df4\u516c\u53f8\u5f00\u6e90\u7684\u4e00\u4e2a\u9ad8\u6027\u80fd\u3001\u8f7b\u91cf\u7ea7\u7684Java RPC\u6846\u67b6\u3002 \u25cf\u81f4\u529b\u4e8e\u63d0\u4f9b\u9ad8\u6027\u80fd\u548c\u900f\u660e\u5316\u7684RPC\u8fdc\u7a0b\u670d\u52a1\u8c03\u7528\u65b9\u6848,\u4ee5\u53caSOA\u670d\u52a1\u6cbb\u7406\u65b9\u6848\u3002 \u25cf\u5b98\u7f51: htp://ubbo.apache.orgo \u8282\u70b9\u89d2\u8272\u8bf4\u660e: . \u25cfProvider: \u66b4\u9732\u670d\u52a1\u7684\u670d\u52a1\u63d0\u4f9b\u65b9 \u25cfContahier: \u670d\u52a1\u8fd0\u884c\u5bb9\u5668 \u25cfConsumer: \u8c03\u7528\u8fdc\u7a0b\u670d\u52a1\u7684\u670d\u52a1\u6d88\u8d39\u65b9 \u25cfRegistry: \u670d\u52a1\u6ce8\u518c\u4e0e\u53d1\u73b0\u7684\u6ce8\u518c\u4e2d\u5fc3 \u25cfMonitor:\u7edf\u8ba1\u670d\u52a1\u7684\u8c03\u7528\u6b21\u6570\u548c\u8c03\u7528\u65f6\u95f4\u7684\u76d1\u63a7\u4e2d\u5fc3","title":"3-dubbo \u6982\u8ff0"},{"location":"dubbo/dubbo/#4-dubbo","text":"","title":"4-dubbo\u5feb\u901f\u5165\u95e8"},{"location":"dubbo/dubbo/#41zookeeper","text":"\u5b89\u88c5\u6b65\u9aa4\uff1a \u7b2c\u4e00\u6b65\uff1a\u5b89\u88c5 jdk\uff08\u7565\uff09 \u7b2c\u4e8c\u6b65\uff1a\u628a zookeeper \u7684\u538b\u7f29\u5305\uff08zookeeper-3.4.6.tar.gz\uff09\u4e0a\u4f20\u5230 linux \u7cfb\u7edf \u7b2c\u4e09\u6b65\uff1a\u89e3\u538b\u7f29\u538b\u7f29\u5305 tar -zxvf zookeeper-3.4.6.tar.gz \u7b2c\u56db\u6b65\uff1a\u8fdb\u5165zookeeper-3.4.6\u76ee\u5f55\uff0c\u521b\u5efadata\u76ee\u5f55 mkdir data \u7b2c\u4e94\u6b65\uff1a\u8fdb\u5165conf\u76ee\u5f55 \uff0c\u628azoo_sample.cfg \u6539\u540d\u4e3azoo.cfg cd conf mv zoo_sample.cfg zoo.cfg \u7b2c\u516d\u6b65\uff1a\u6253\u5f00zoo.cfg\u6587\u4ef6, \u4fee\u6539data\u5c5e\u6027\uff1a dataDir = /root/zookeeper-3.4.6/data \u8fdb\u5165Zookeeper\u7684bin\u76ee\u5f55\uff0c\u542f\u52a8\u670d\u52a1\u547d\u4ee4 ./zkServer.sh start \u505c\u6b62\u670d\u52a1\u547d\u4ee4 ./zkServer.sh stop \u67e5\u770b\u670d\u52a1\u72b6\u6001\uff1astandalone \u5355\u8282\u70b9 ./zkServer.sh status","title":"4.1zookeeper\u5b89\u88c5"},{"location":"dubbo/dubbo/#42springspringmvc","text":"\u5b9e\u65bd\u6b65\u9aa4\uff1a 1.\u521b\u5efa\u670d\u52a1\u63d0\u4f9b\u8005Provider\u6a21\u5757 2.\u521b\u5efa\u670d\u52a1\u6d88\u8d39\u8005Consumer\u6a21\u5757 3.\u5728\u670d\u52a1\u63d0\u4f9b\u8005\u6a21\u5757\u7f16\u5199UserServicelmpl\u63d0\u4f9b\u670d\u52a1 4.\u5728\u670d\u52a1\u6d88\u8d39\u8005\u4e2d\u7684UserC ontroller\u8fdc\u7a0b\u8c03\u7528 5.UserServicelmpl\u63d0\u4f9b\u7684\u670d\u52a1 6.\u5206\u522b\u542f\u52a8\u4e24\u4e2a\u670d\u52a1\uff0c\u6d4b\u8bd5 Dubbo\u4f5c\u4e3a\u4e00\u4e2aRPC\u6846\u67b6\uff0c\u5176\u6700\u6838\u5fc3\u7684\u529f\u80fd\u5c31\u662f\u8981\u5b9e\u73b0\u8de8\u7f51\u7edc\u7684\u8fdc\u7a0b\u8c03\u7528\u3002\u672c\u5c0f\u8282\u5c31\u662f\u8981\u521b\u5efa\u4e24\u4e2a\u5e94\u7528\uff0c\u4e00\u4e2a\u4f5c\u4e3a\u670d\u52a1\u7684\u63d0\u4f9b\u65b9\uff0c\u4e00\u4e2a\u4f5c\u4e3a\u670d\u52a1\u7684\u6d88\u8d39\u65b9\u3002\u901a\u8fc7Dubbo\u6765\u5b9e\u73b0\u670d\u52a1\u6d88\u8d39\u65b9\u8fdc\u7a0b\u8c03\u7528\u670d\u52a1\u63d0\u4f9b\u65b9\u7684\u65b9\u6cd5\u3002 1 \u670d\u52a1\u63d0\u4f9b\u65b9\u5f00\u53d1 \u5f00\u53d1\u6b65\u9aa4\uff1a \uff081\uff09\u521b\u5efamaven\u5de5\u7a0b\uff08\u6253\u5305\u65b9\u5f0f\u4e3awar\uff09dubbodemo_provider\uff0c\u5728pom.xml\u6587\u4ef6\u4e2d\u5bfc\u5165\u5982\u4e0b\u5750\u6807 <properties> <project.build.sourceEncoding> UTF-8 </project.build.sourceEncoding> <maven.compiler.source> 1.8 </maven.compiler.source> <maven.compiler.target> 1.8 </maven.compiler.target> <spring.version> 5.0.5.RELEASE </spring.version> </properties> <dependencies> <dependency> <groupId> org.springframework </groupId> <artifactId> spring-context </artifactId> <version> ${spring.version} </version> </dependency> <dependency> <groupId> org.springframework </groupId> <artifactId> spring-beans </artifactId> <version> ${spring.version} </version> </dependency> <dependency> <groupId> org.springframework </groupId> <artifactId> spring-webmvc </artifactId> <version> ${spring.version} </version> </dependency> <dependency> <groupId> org.springframework </groupId> <artifactId> spring-jdbc </artifactId> <version> ${spring.version} </version> </dependency> <dependency> <groupId> org.springframework </groupId> <artifactId> spring-aspects </artifactId> <version> ${spring.version} </version> </dependency> <dependency> <groupId> org.springframework </groupId> <artifactId> spring-jms </artifactId> <version> ${spring.version} </version> </dependency> <dependency> <groupId> org.springframework </groupId> <artifactId> spring-context-support </artifactId> <version> ${spring.version} </version> </dependency> <!-- dubbo\u76f8\u5173 --> <dependency> <groupId> com.alibaba </groupId> <artifactId> dubbo </artifactId> <version> 2.6.0 </version> </dependency> <dependency> <groupId> org.apache.zookeeper </groupId> <artifactId> zookeeper </artifactId> <version> 3.4.6 </version> </dependency> <dependency> <groupId> com.github.sgroschupf </groupId> <artifactId> zkclient </artifactId> <version> 0.1 </version> </dependency> <dependency> <groupId> javassist </groupId> <artifactId> javassist </artifactId> <version> 3.12.1.GA </version> </dependency> <dependency> <groupId> com.alibaba </groupId> <artifactId> fastjson </artifactId> <version> 1.2.47 </version> </dependency> </dependencies> <build> <plugins> <plugin> <groupId> org.apache.maven.plugins </groupId> <artifactId> maven-compiler-plugin </artifactId> <version> 2.3.2 </version> <configuration> <source> 1.8 </source> <target> 1.8 </target> </configuration> </plugin> <plugin> <groupId> org.apache.tomcat.maven </groupId> <artifactId> tomcat7-maven-plugin </artifactId> <configuration> <!-- \u6307\u5b9a\u7aef\u53e3 --> <port> 8081 </port> <!-- \u8bf7\u6c42\u8def\u5f84 --> <path> / </path> </configuration> </plugin> </plugins> </build> \uff082\uff09\u914d\u7f6eweb.xml\u6587\u4ef6 <!DOCTYPE web-app PUBLIC \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\" \"http://java.sun.com/dtd/web-app_2_3.dtd\" > <web-app> <display-name> Archetype Created Web Application </display-name> <context-param> <param-name> contextConfigLocation </param-name> <param-value> classpath:applicationContext*.xml </param-value> </context-param> <listener> <listener-class> org.springframework.web.context.ContextLoaderListener </listener-class> </listener> </web-app> \uff083\uff09\u521b\u5efa\u670d\u52a1\u63a5\u53e3 package com.itheima.service ; public interface HelloService { public String sayHello ( String name ); } \uff084\uff09\u521b\u5efa\u670d\u52a1\u5b9e\u73b0\u7c7b \u6ce8\u610f\uff1a \u670d\u52a1\u5b9e\u73b0\u7c7b\u4e0a\u4f7f\u7528\u7684Service\u6ce8\u89e3\u662fDubbo\u63d0\u4f9b\u7684\uff0c\u7528\u4e8e\u5bf9\u5916\u53d1\u5e03\u670d\u52a1 package com.itheima.service.impl ; import com.alibaba.dubbo.config.annotation.Service ; import com.itheima.service.HelloService ; @Service public class HelloServiceImpl implements HelloService { public String sayHello ( String name ) { return \"hello \" + name ; } } tomcat7:run 2 \u670d\u52a1\u6d88\u8d39\u65b9\u5f00\u53d1 \u5f00\u53d1\u6b65\u9aa4\uff1a \uff081\uff09\u521b\u5efamaven\u5de5\u7a0b\uff08\u6253\u5305\u65b9\u5f0f\u4e3awar\uff09dubbodemo_consumer\uff0cpom.xml\u914d\u7f6e\u548c\u4e0a\u9762\u670d\u52a1\u63d0\u4f9b\u8005\u76f8\u540c\uff0c\u53ea\u9700\u8981\u5c06Tomcat\u63d2\u4ef6\u7684\u7aef\u53e3\u53f7\u6539\u4e3a8082\u5373\u53ef \uff082\uff09\u914d\u7f6eweb.xml\u6587\u4ef6 <!DOCTYPE web-app PUBLIC \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\" \"http://java.sun.com/dtd/web-app_2_3.dtd\" > <web-app> <display-name> Archetype Created Web Application </display-name> <servlet> <servlet-name> springmvc </servlet-name> <servlet-class> org.springframework.web.servlet.DispatcherServlet </servlet-class> <!-- \u6307\u5b9a\u52a0\u8f7d\u7684\u914d\u7f6e\u6587\u4ef6 \uff0c\u901a\u8fc7\u53c2\u6570contextConfigLocation\u52a0\u8f7d --> <init-param> <param-name> contextConfigLocation </param-name> <param-value> classpath:applicationContext-web.xml </param-value> </init-param> <load-on-startup> 1 </load-on-startup> </servlet> <servlet-mapping> <servlet-name> springmvc </servlet-name> <url-pattern> *.do </url-pattern> </servlet-mapping> </web-app> \uff083\uff09\u5c06\u670d\u52a1\u63d0\u4f9b\u8005\u5de5\u7a0b\u4e2d\u7684HelloService\u63a5\u53e3\u590d\u5236\u5230\u5f53\u524d\u5de5\u7a0b \uff084\uff09\u7f16\u5199Controller package com.itheima.controller ; import com.alibaba.dubbo.config.annotation.Reference ; import com.itheima.service.HelloService ; import org.springframework.stereotype.Controller ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.ResponseBody ; @Controller @RequestMapping ( \"/demo\" ) public class HelloController { @Reference private HelloService helloService ; @RequestMapping ( \"/hello\" ) @ResponseBody public String getName ( String name ){ //\u8fdc\u7a0b\u8c03\u7528 String result = helloService . sayHello ( name ); System . out . println ( result ); return result ; } } \u6ce8\u610f\uff1aController\u4e2d\u6ce8\u5165HelloService\u4f7f\u7528\u7684\u662fDubbo\u63d0\u4f9b\u7684@Reference\u6ce8\u89e3","title":"4.2spring\u548cspringmvc\u6574\u5408"},{"location":"dubbo/dubbo/#43","text":"\u5728dubbodemo_provider\u5de5\u7a0b\u4e2dsrc/main/resources\u4e0b\u521b\u5efaapplicationContext-service.xml <?xml version=\"1.0\" encoding=\"UTF-8\"?> <beans xmlns= \"http://www.springframework.org/schema/beans\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xmlns:p= \"http://www.springframework.org/schema/p\" xmlns:context= \"http://www.springframework.org/schema/context\" xmlns:dubbo= \"http://code.alibabatech.com/schema/dubbo\" xmlns:mvc= \"http://www.springframework.org/schema/mvc\" xsi:schemaLocation= \"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd\" > <!-- \u5f53\u524d\u5e94\u7528\u540d\u79f0\uff0c\u7528\u4e8e\u6ce8\u518c\u4e2d\u5fc3\u8ba1\u7b97\u5e94\u7528\u95f4\u4f9d\u8d56\u5173\u7cfb\uff0c\u6ce8\u610f\uff1a\u6d88\u8d39\u8005\u548c\u63d0\u4f9b\u8005\u5e94\u7528\u540d\u4e0d\u8981\u4e00\u6837 --> <dubbo:application name= \"dubbodemo_provider\" /> <!-- \u8fde\u63a5\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3zookeeper ip\u4e3azookeeper\u6240\u5728\u670d\u52a1\u5668\u7684ip\u5730\u5740--> <dubbo:registry address= \"zookeeper://192.168.134.129:2181\" /> <!-- \u6ce8\u518c \u534f\u8bae\u548cport \u7aef\u53e3\u9ed8\u8ba4\u662f20880 --> <dubbo:protocol name= \"dubbo\" port= \"20881\" ></dubbo:protocol> <!-- \u626b\u63cf\u6307\u5b9a\u5305\uff0c\u52a0\u4e0a@Service\u6ce8\u89e3\u7684\u7c7b\u4f1a\u88ab\u53d1\u5e03\u4e3a\u670d\u52a1 --> <dubbo:annotation package= \"com.itheima.service.impl\" /> </beans>","title":"4.3\u670d\u52a1\u63d0\u4f9b\u8005"},{"location":"dubbo/dubbo/#44","text":"\u5728dubbodemo_consumer\u5de5\u7a0b\u4e2dsrc/main/resources\u4e0b\u521b\u5efaapplicationContext-web.xml <?xml version=\"1.0\" encoding=\"UTF-8\"?> <beans xmlns= \"http://www.springframework.org/schema/beans\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xmlns:p= \"http://www.springframework.org/schema/p\" xmlns:context= \"http://www.springframework.org/schema/context\" xmlns:dubbo= \"http://code.alibabatech.com/schema/dubbo\" xmlns:mvc= \"http://www.springframework.org/schema/mvc\" xsi:schemaLocation= \"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd\" > <!-- \u5f53\u524d\u5e94\u7528\u540d\u79f0\uff0c\u7528\u4e8e\u6ce8\u518c\u4e2d\u5fc3\u8ba1\u7b97\u5e94\u7528\u95f4\u4f9d\u8d56\u5173\u7cfb\uff0c\u6ce8\u610f\uff1a\u6d88\u8d39\u8005\u548c\u63d0\u4f9b\u8005\u5e94\u7528\u540d\u4e0d\u8981\u4e00\u6837 --> <dubbo:application name= \"dubbodemo-consumer\" /> <!-- \u8fde\u63a5\u670d\u52a1\u6ce8\u518c\u4e2d\u5fc3zookeeper ip\u4e3azookeeper\u6240\u5728\u670d\u52a1\u5668\u7684ip\u5730\u5740--> <dubbo:registry address= \"zookeeper://192.168.134.129:2181\" /> <!-- \u5305\u626b\u63cf\u7684\u65b9\u5f0f \u5f15\u7528\u670d\u52a1 \u626b\u63cf@Reference --> <dubbo:annotation package= \"com.itheima.controller\" /> </beans> \u8fd0\u884c\u6d4b\u8bd5 tomcat7:run\u542f\u52a8 \u5728\u6d4f\u89c8\u5668\u8f93\u5165http://localhost:8082/demo/hello.do?name=Jack\uff0c\u67e5\u770b\u6d4f\u89c8\u5668\u8f93\u51fa\u7ed3\u679c","title":"4.4\u670d\u52a1\u6d88\u8d39\u8005"},{"location":"dubbo/dubbo/#5-dubbo","text":"","title":"5-dubbo\u9ad8\u7ea7\u7279\u6027"},{"location":"dubbo/dubbo/#51dubbo-admin","text":"dubbo- admin \u25cfdubbo-admin\u7ba1\u7406\u5e73\u53f0\uff0c\u662f\u56fe\u5f62\u5316\u7684\u670d\u52a1\u7ba1\u7406\u9875\u9762 \u25cf\u4ece\u6ce8\u518c\u4e2d\u5fc3\u4e2d\u83b7\u53d6\u5230\u6240\u6709\u7684\u63d0\u4f9b\u8005 /\u6d88\u8d39\u8005\u8fdb\u884c\u914d\u7f6e\u7ba1\u7406 \u25cf\u8def\u7531\u89c4\u5219\u3001\u52a8\u6001\u914d\u7f6e\u3001\u670d\u52a1\u964d\u7ea7\u3001\u8bbf\u95ee\u63a7\u5236\u3001\u6743\u91cd\u8c03\u6574\u3001\u8d1f\u8f7d\u5747\u8861\u7b49\u7ba1\u7406\u529f\u80fd \u25cfdubbo- admin\u662f\u4e00\u4e2a\u524d\u540e\u7aef\u5206\u79bb\u7684\u9879\u76ee\u3002\u524d\u7aef\u4f7f\u7528vue\uff0c\u540e\u7aef\u4f7f\u7528springboot \u25cf\u5b89\u88c5dubbo-admin\u5176\u5b9e\u5c31\u662f\u90e8\u7f72\u8be5\u9879\u76ee \u5177\u4f53\u5b89\u88c5\u53c2\u89c1\uff1adubbo-admin.md","title":"5.1dubbo-admin\u5b89\u88c5"},{"location":"dubbo/dubbo/#52-dubbo-admin","text":"\u5177\u4f53\u5b89\u88c5\u53c2\u89c1\uff1adubbo-admin.md","title":"5.2-dubbo-admin\u4f7f\u7528"},{"location":"dubbo/dubbo/#53","text":"dubbo \u5185\u90e8\u5df2\u7ecf\u5c06\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u7684\u8fc7\u7a0b\u5185\u90e8\u5c01\u88c5\u4e86 \u6211\u4eec\u53ea\u9700\u8981\u5728\u5b9a\u4e49pojo\u7c7b\u65f6 \u5b9e\u73b0seriali zable\u63a5\u53e3 \u5373\u53ef \u4e00\u822c\u4f1a\u5b9a\u4e49\u4e00 \u4e2a\u516c\u5171\u7684pojo\u6a21\u5757,\u8ba9\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u90fd\u4f9d\u8d56\u8be5\u6a21\u5757\u3002 User\u5bf9\u8c61\u672a\u5b9e\u73b0seriali zable\u63a5\u53e3 \u9519\u8bef\u4fe1\u606f\uff1a \u89e3\u51b3\u529e\u6cd5\uff1a User implements Serializable","title":"5.3\u5e8f\u5217\u5316"},{"location":"dubbo/dubbo/#54","text":"\u6ce8\u518c\u4e2d\u5fc3\u6302\u4e86\uff0c\u670d\u52a1\u662f\u5426\u53ef\u4ee5\u6b63\u5e38\u8bbf\u95ee\uff1f \u53ef\u4ee5\uff0c\u56e0\u4e3adubbo\u670d\u52a1\u6d88\u8d39\u8005\u5728\u7b2c\u4e00-\u6b21\u8c03\u7528\u65f6\uff0c\u4f1a\u5c06\u670d\u52a1\u63d0\u4f9b\u65b9\u5730\u5740\u7f13\u5b58\u5230\u672c\u5730\uff0c\u4ee5\u540e\u5728\u8c03\u7528\u5219\u4e0d\u4f1a\u8bbf\u95ee\u6ce8\u518c\u4e2d\u5fc3\u3002 \u5f53\u670d\u52a1\u63d0\u4f9b\u8005\u5730\u5740\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u6ce8\u518c\u4e2d\u5fc3\u4f1a\u901a\u77e5\u670d\u52a1\u6d88\u8d39\u8005\u3002","title":"5.4\u5730\u5740\u7f13\u5b58"},{"location":"dubbo/dubbo/#55","text":"\u670d\u52a1\u6d88\u8d39\u8005\u5728\u8c03\u7528\u670d\u52a1\u63d0\u4f9b\u8005\u7684\u65f6\u5019\u53d1\u751f\u4e86\u963b\u585e\u3001\u7b49\u5f85\u7684\u60c5\u5f62,\u8fd9\u4e2a\u65f6\u5019,\u670d\u52a1\u6d88\u8d39\u8005\u4f1a\u76f4\u7b49\u5f85\u4e0b\u53bb\u3002 \u5728\u67d0\u4e2a\u5cf0\u503c\u65f6\u523b\uff0c\u5927\u91cf\u7684\u8bf7\u6c42\u90fd\u5728\u540c\u65f6\u8bf7\u6c42\u670d\u52a1\u6d88\u8d39\u8005,\u4f1a\u9020\u6210\u7ebf\u7a0b\u7684\u5927\u91cf\u5806\u79ef\uff0c\u52bf\u5fc5\u4f1a\u9020\u6210\u96ea\u5d29\u3002 dubbo\u5229\u7528\u8d85\u65f6\u673a\u5236\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u8bbe\u7f6e-\u4e2a\u8d85\u65f6\u65f6\u95f4, \u5728\u8fd9\u4e2a\u65f6\u95f4\u6bb5\u5185\uff0c\u65e0\u6cd5\u5b8c\u6210\u670d\u52a1\u8bbf\u95ee,\u5219\u81ea\u52a8\u65ad\u5f00\u8fde\u63a5\u3002 \u4f7f\u7528timeout\u5c5e\u6027\u914d\u7f6e\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u503c1000\uff0c\u5355\u4f4d\u6beb\u79d2 //timeout \u8d85\u65f6\u65f6\u95f4 \u5355\u4f4d\u6beb\u79d2 retries \u91cd\u8bd5\u6b21\u6570 @Service ( timeout = 3000 , retries = 0 )","title":"5.5 \u8d85\u65f6"},{"location":"dubbo/dubbo/#56","text":"\u8bbe\u7f6e\u4e86\u8d85\u65f6\u65f6\u95f4\uff0c\u5728\u8fd9\u4e2a\u65f6\u95f4\u6bb5\u5185\uff0c\u65e0\u6cd5\u5b8c\u6210\u670d\u52a1\u8bbf\u95ee,\u5219\u81ea\u52a8\u65ad\u5f00\u8fde\u63a5\u3002 \u5982\u679c\u51fa\u73b0\u7f51\u7edc\u6296\u52a8,\u5219\u8fd9\u4e00-\u6b21\u8bf7\u6c42\u5c31\u4f1a\u5931\u8d25\u3002 Dubbo\u63d0\u4f9b\u91cd\u8bd5\u673a\u5236\u6765\u907f\u514d\u7c7b\u4f3c\u95ee\u9898\u7684\u53d1\u751f\u3002 \u901a\u8fc7retries\u5c5e\u6027\u6765\u8bbe\u7f6e\u91cd\u8bd5\u6b21\u6570\u3002\u9ed8\u8ba4\u4e3a2\u6b21 //timeout \u8d85\u65f6\u65f6\u95f4 \u5355\u4f4d\u6beb\u79d2 retries \u91cd\u8bd5\u6b21\u6570 @Service ( timeout = 3000 , retries = 0 )","title":"5.6\u91cd\u8bd5"},{"location":"dubbo/dubbo/#57","text":"\u7070\u5ea6\u53d1\u5e03: \u5f53\u51fa\u73b0\u65b0\u529f\u80fd\u65f6,\u4f1a\u8ba9\u4e00\u90e8\u5206\u7528\u6237\u5148\u4f7f\u7528\u65b0\u529f\u80fd\uff0c\u7528\u6237\u53cd\u9988\u6ca1\u95ee\u9898\u65f6\uff0c\u518d\u5c06\u6240\u6709\u7528\u6237\u8fc1\u79fb\u5230\u65b0\u529f\u80fd\u3002 dubbo\u4e2d\u4f7f\u7528version\u5c5e\u6027\u6765\u8bbe\u7f6e\u548c\u8c03\u7528\u540c\u4e00\u4e2a\u63a5\u53e3\u7684\u4e0d\u540c\u7248\u672c \u751f\u4ea7\u8005\u914d\u7f6e @Service ( version = \"v2.0\" ) public class UserServiceImp12 implements UserService {...} \u6d88\u8d39\u8005\u914d\u7f6e @Reference ( version = \"v2.0\" ) //\u8fdc\u7a0b\u6ce8\u5165 private UserService userService ;","title":"5.7\u591a\u7248\u672c"},{"location":"dubbo/dubbo/#58","text":"\u8d1f\u8f7d\u5747\u8861\u7b56\u7565(4\u79cd) : Random: \u6309\u6743\u91cd\u968f\u673a\uff0c\u9ed8\u8ba4\u503c\u3002\u6309\u6743\u91cd\u8bbe\u7f6e\u968f\u673a\u6982\u7387\u3002 RoundRobin: \u6309\u6743\u91cd\u8f6e\u8be2\u3002 LeastActive: \u6700\u5c11\u6d3b\u8dc3\u8c03\u7528\u6570,\u76f8\u540c\u6d3b\u8dc3\u6570\u7684\u968f\u673a\u3002 ConsistentHash: \u4e00 \u81f4\u6027Hash,\u76f8\u540c\u53c2\u6570\u7684\u8bf7\u6c42\u603b\u662f\u53d1\u5230\u540c\u4e00\u63d0\u4f9b\u8005\u3002 \u670d\u52a1\u63d0\u4f9b\u8005\u914d\u7f6e @Service ( weight = 100 ) public class UserServiceImp12 implements UserService {...} application.xml \u914d\u7f6eparameter key \u6d88\u8d39\u8005\u914d\u7f6e //@Reference(loadbalance = \"roundrobin\") //@Reference(loadbalance = \"leastactive\") //@Reference(loadbalance = \"consistenthash\") @Reference ( loadbalance = \"random\" ) //\u9ed8\u8ba4 \u6309\u6743\u91cd\u968f\u673a private UserService userService ;","title":"5.8\u8d1f\u8f7d\u5747\u8861"},{"location":"dubbo/dubbo/#59","text":"\u96c6\u7fa4\u5bb9\u9519\u6a21\u5f0f: Failover Cluster: \u5931\u8d25\u91cd\u8bd5\u3002\u9ed8\u8ba4\u503c\u3002\u5f53\u51fa\u73b0\u5931\u8d25\uff0c\u91cd\u8bd5\u5176\u5b83\u670d\u52a1\u5668\uff0c\u9ed8\u8ba4\u91cd\u8bd52\u6b21\uff0c\u4f7f\u7528retries\u914d\u7f6e\u3002\u4e00\u822c\u7528\u4e8e\u8bfb\u64cd\u4f5c Failfast Cluster : \u5feb\u901f\u5931\u8d25,\u53d1\u8d77-\u6b21\u8c03\u7528\uff0c\u5931\u8d25\u7acb\u5373\u62a5\u9519\u3002\u901a\u5e38\u7528\u4e8e\u5199\u64cd\u4f5c\u3002 Failsafe Cluster: \u5931\u8d25\u5b89\u5168\uff0c\u51fa\u73b0\u5f02\u5e38\u65f6\uff0c\u76f4\u63a5\u5ffd\u7565\u3002\u8fd4\u56de\u4e00\u4e2a\u7a7a\u7ed3\u679c\u3002 Failback Cluster: \u5931\u8d25\u81ea\u52a8\u6062\u590d,\u540e\u53f0\u8bb0\u5f55\u5931\u8d25\u8bf7\u6c42,\u5b9a\u65f6\u91cd\u53d1\u3002 Forking Cluster : \u5e76\u884c\u8c03\u7528\u591a\u4e2a\u670d\u52a1\u5668\uff0c\u53ea\u8981\u4e00\u4e2a\u6210\u529f\u5373\u8fd4\u56de\u3002 Broadcast Cluster: \u5e7f\u64ad\u8c03\u7528\u6240\u6709\u63d0\u4f9b\u8005,\u9010\u4e2a\u8c03\u7528\uff0c\u4efb\u610f\u4e00\u53f0\u62a5\u9519\u5219\u62a5\u9519\u3002 \u6d88\u8d39\u8005\u914d\u7f6e @Reference ( cluster = \"failover\" ) //\u8fdc\u7a0b\u6ce8\u5165 private UserService userService ;","title":"5.9\u96c6\u7fa4\u5bb9\u9519"},{"location":"dubbo/dubbo/#510","text":"\u670d\u52a1\u964d\u7ea7 \uff1a\u5f53\u670d\u52a1\u5668\u538b\u529b\u5267\u589e\u7684\u60c5\u51b5\u4e0b\uff0c\u6839\u636e\u5b9e\u9645\u4e1a\u52a1\u60c5\u51b5\u53ca\u6d41\u91cf\uff0c\u5bf9\u4e00\u4e9b\u670d\u52a1\u548c\u9875\u9762\u6709\u7b56\u7565\u7684\u4e0d\u5904\u7406\u6216\u6362\u79cd\u7b80\u5355\u7684\u65b9\u5f0f\u5904\u7406\uff0c\u4ece\u800c\u91ca\u653e\u670d\u52a1\u5668\u8d44\u6e90\u4ee5\u4fdd\u8bc1 \u6838\u5fc3\u4ea4\u6613 \u6b63\u5e38\u8fd0\u4f5c\u6216\u9ad8\u6548\u8fd0\u4f5c \u670d\u52a1\u964d\u7ea7\u65b9\u5f0f: mock= force:return null \uff1a\u8868\u793a\u6d88\u8d39\u65b9\u5bf9\u8be5\u670d\u52a1\u7684\u65b9\u6cd5\u8c03\u7528\u90fd\u76f4\u63a5\u8fd4\u56denull\u503c,\u4e0d\u53d1\u8d77\u8fdc\u7a0b\u8c03\u7528\u3002\u7528\u6765\u5c4f\u853d\u4e0d\u91cd\u8981\u670d\u52a1\u4e0d\u53ef\u7528\u65f6\u5bf9\u8c03\u7528\u65b9\u7684\u5f71\u54cd\u3002 mock=fail:return null \uff1a\u8868\u793a\u6d88\u8d39\u65b9\u5bf9\u8be5\u670d\u52a1\u7684\u65b9\u6cd5\u8c03\u7528\u5728\u5931\u8d25\u540e\uff0c\u518d\u8fd4\u56denull\u503c,\u4e0d\u629b\u5f02\u5e38\u3002\u7528\u6765\u5bb9\u5fcd\u4e0d\u91cd\u8981\u670d\u52a1\u4e0d\u7a33\u5b9a\u65f6\u5bf9\u8c03\u7528\u65b9\u7684\u5f71\u54cd \u6d88\u8d39\u65b9\u914d\u7f6e //\u8fdc\u7a0b\u6ce8\u5165 @Reference ( mock = \u201c force : return null \")//\u4e0d\u518d\u8c03\u7528userService\u7684\u670d\u52a1 private UserService userService;","title":"5.10\u670d\u52a1\u964d\u7ea7"},{"location":"hmtt/seata%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E6%89%8B%E5%86%8C/","text":"\u7531\u4e8eseata\u670d\u52a1\u7aef\u4f7f\u7528\u4e861.3.0\u7684\u7248\u672c\uff0c\u4f46\u662f\u5ba2\u6237\u7aef\u4f7f\u7528\u7684\u662f0.7.1\uff08\u867d\u7136\u76f4\u63a5\u5bfc\u5165\u4e860.9\u4f46\u662f\u6700\u7ec8\u8fd8\u662f\u4f7f\u7528\u76840.7.1\uff09\u3002\u4f1a\u51fa\u73b0\u5185\u5b58\u6cc4\u6f0f\u7b49\u95ee\u9898\uff0c\u6240\u4ee5\u9700\u8981\u5c06\u7248\u672c\u5347\u7ea7\u4e3a1.3.0\uff0c\u5347\u7ea7\u65b9\u5f0f\u5982\u4e0b: 1.\u5728\u7236\u5de5\u7a0b\u4e2d\u6dfb\u52a0\u7248\u672c\u9501\u5b9a <dependency> <groupId> io.seata </groupId> <artifactId> seata-all </artifactId> <version> 1.3.0 </version> </dependency> \u867d\u7136\u5728seata\u5de5\u7a0b\u4e2d\u4f7f\u7528\u4f9d\u8d56\u5f15\u5165\u7684\u65b9\u5f0f\u6307\u5b9a\u4e86\u7248\u672c\u53f7\uff0c\u4f46\u662f\u7531\u4e8e\u5f15\u5165\u4e86spring-cloud-starter-alibaba-seata\uff0c\u57282.1.0release\u7248\u672c\u4e2d\u5df2\u7ecf\u9501\u5b9a\u4e86seata\u4e3a0.7.1\uff0c\u6240\u4ee5\u9700\u8981\u624b\u52a8\u9501\u5b9a\u3002 2.\u4fee\u6539\u6240\u6709\u76f8\u5173\u9879\u76ee\u7684file.conf\uff0c\u4fee\u6539\u5982\u4e0b\u5185\u5bb9 #\u539f\u6765\u662fvgroup_mapping\uff0c\u65b0\u7248\u672c\u4e2d\u4fee\u6539\u4e3avgroupMapping vgroupMapping.leadnews-admin_tx_group = \"default\" \u5176\u4e2dleadnews-admin\u8981\u4fee\u6539\u6210\u5bf9\u5e94\u7684\u670d\u52a1\u540d\u3002","title":"Seata\u7248\u672c\u5347\u7ea7\u624b\u518c"},{"location":"hmtt/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A1%E7%8E%AF%E5%A2%83%E5%90%AF%E5%8A%A8%E6%89%8B%E5%86%8C/","text":"\u4f7f\u7528\u8001\u5e08\u63d0\u4f9b\u7684\u865a\u62df\u673a \u8bbe\u7f6e\u6a21\u5f0f\u4e3anat\u6a21\u5f0f\uff0c\u70b9\u51fb\u7f16\u8f91-\u865a\u62df\u7f51\u7edc\u7f16\u8f91\u5668 \u542f\u52a8\u865a\u62df\u673a\u4e4b\u540e\uff0c\u4fee\u6539\u7528\u6237\u540d\u4e3aroot,\u5bc6\u7801\u4e3aitcast \u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a service zookeeper start service kafka start \u5728WINDOWS\u4e0a\u542f\u52a8seata\uff0c\u8fd0\u884cseata-server.bat \u5728WINDOWS\u4e0a\u542f\u52a8nacos\uff0c\u8fd0\u884cstartup.cmd \u4ee5\u4e0b\u662f\u539f\u59cb\u542f\u52a8\u65b9\u5f0f\uff0c\u76ee\u524d\u5df2\u7ecf\u6dfb\u52a0\u81f3\u670d\u52a1\uff0c\u65e0\u9700\u7406\u4f1a \u00b6 \u542f\u52a8zk: cd zookeeper-3.4.14/bin ./zkServer.sh start \u542f\u52a8kafka\uff1a cd ~ cd kafka_2.12-2.2.1/ vi config/server.properties \u4fee\u6539config\u76ee\u5f55\u4e0b\u7684server.properties\u6587\u4ef6,\u6548\u679c\u5982\u4e0b \u4fee\u6539listeners = PLAINTEXT://\u4f60\u7684\u865a\u62df\u673aIP\u5730\u5740:9092 ~/kafka_2.12-2.2.1/bin/kafka-server-start.sh ~/kafka_2.12-2.2.1/config/server.properties \u95ee\u9898\u8bb0\u5f55 \u00b6 1.2020-10-24 23:56:33.257 [NettyClientSelector_TMROLE_1] ERROR io.netty.util.ResourceLeakDetector - LEAK: ByteBuf.release() was not called before it's garbage-collected. See http://netty.io/wiki/reference-counted-objects.html for more information. \u00b6 Recent access records: Created at: \u9047\u5230\u6b64\u95ee\u9898\uff0c\u76f4\u63a5\u91cd\u542f\u670d\u52a1\u5373\u53ef\uff0cseata\u5e95\u5c42\u4f7f\u7528netty\u5b58\u5728\u4e0d\u7a33\u5b9a\u7684\u5185\u5b58\u6cc4\u6f0f\u3002 2.Centos7\u5f00\u673a\u4e4b\u540e\u8fde\u4e0d\u4e0a\u7f51ens33mtu 1500 qdisc noop state DOWN group default qlen 1000 \u00b6 \u89e3\u51b3\u65b9\u6cd5\uff0c\u5148\u505c\u6b62\u7f51\u5361\uff0c\u8bbe\u7f6edisable\uff0c\u7136\u540e\u542f\u52a8\uff0c\u53d1\u73b0\u7f51\u5361\u542f\u52a8\u4e86\uff1a systemctl stop NetworkManager systemctl disable NetworkManager service network restart","title":"\u9ed1\u9a6c\u5934\u6761\u73af\u5883\u542f\u52a8\u624b\u518c"},{"location":"hmtt/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A1%E7%8E%AF%E5%A2%83%E5%90%AF%E5%8A%A8%E6%89%8B%E5%86%8C/#_1","text":"\u542f\u52a8zk: cd zookeeper-3.4.14/bin ./zkServer.sh start \u542f\u52a8kafka\uff1a cd ~ cd kafka_2.12-2.2.1/ vi config/server.properties \u4fee\u6539config\u76ee\u5f55\u4e0b\u7684server.properties\u6587\u4ef6,\u6548\u679c\u5982\u4e0b \u4fee\u6539listeners = PLAINTEXT://\u4f60\u7684\u865a\u62df\u673aIP\u5730\u5740:9092 ~/kafka_2.12-2.2.1/bin/kafka-server-start.sh ~/kafka_2.12-2.2.1/config/server.properties","title":"\u4ee5\u4e0b\u662f\u539f\u59cb\u542f\u52a8\u65b9\u5f0f\uff0c\u76ee\u524d\u5df2\u7ecf\u6dfb\u52a0\u81f3\u670d\u52a1\uff0c\u65e0\u9700\u7406\u4f1a"},{"location":"hmtt/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A1%E7%8E%AF%E5%A2%83%E5%90%AF%E5%8A%A8%E6%89%8B%E5%86%8C/#_2","text":"","title":"\u95ee\u9898\u8bb0\u5f55"},{"location":"hmtt/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A1%E7%8E%AF%E5%A2%83%E5%90%AF%E5%8A%A8%E6%89%8B%E5%86%8C/#12020-10-24_235633257_nettyclientselector_tmrole_1_error_ionettyutilresourceleakdetector_-_leak_bytebufrelease_was_not_called_before_its_garbage-collected_see_httpnettyiowikireference-counted-objectshtml_for_more_information","text":"Recent access records: Created at: \u9047\u5230\u6b64\u95ee\u9898\uff0c\u76f4\u63a5\u91cd\u542f\u670d\u52a1\u5373\u53ef\uff0cseata\u5e95\u5c42\u4f7f\u7528netty\u5b58\u5728\u4e0d\u7a33\u5b9a\u7684\u5185\u5b58\u6cc4\u6f0f\u3002","title":"1.2020-10-24 23:56:33.257 [NettyClientSelector_TMROLE_1] ERROR io.netty.util.ResourceLeakDetector - LEAK: ByteBuf.release() was not called before it's garbage-collected. See http://netty.io/wiki/reference-counted-objects.html for more information."},{"location":"hmtt/%E9%BB%91%E9%A9%AC%E5%A4%B4%E6%9D%A1%E7%8E%AF%E5%A2%83%E5%90%AF%E5%8A%A8%E6%89%8B%E5%86%8C/#2centos7ens33mtu_1500_qdisc_noop_state_down_group_default_qlen_1000","text":"\u89e3\u51b3\u65b9\u6cd5\uff0c\u5148\u505c\u6b62\u7f51\u5361\uff0c\u8bbe\u7f6edisable\uff0c\u7136\u540e\u542f\u52a8\uff0c\u53d1\u73b0\u7f51\u5361\u542f\u52a8\u4e86\uff1a systemctl stop NetworkManager systemctl disable NetworkManager service network restart","title":"2.Centos7\u5f00\u673a\u4e4b\u540e\u8fde\u4e0d\u4e0a\u7f51ens33mtu 1500 qdisc noop state DOWN group default qlen 1000"},{"location":"hmtt/day01/","text":"01-\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u8bfe\u7a0b\u89c4\u5212 05:27 \u00b6 02-\u4eca\u65e5\u76ee\u6807 01:34 \u00b6 \u80fd\u591f\u63cf\u8ff0\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u6709\u54ea\u4e9b\u4e1a\u52a1 \u80fd\u591f\u4e86\u89e3\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u4f7f\u7528\u5230\u4ec0\u4e48\u6280\u672f \u80fd\u591f\u4e86\u89e3\u9ed1\u9a6c\u5934\u6761\u6570\u636e\u5e93\u8bbe\u8ba1\u8fc7\u7a0b \u80fd\u591f\u638c\u63e1\u521d\u59cb\u5316\u5de5\u7a0b\u7684\u642d\u5efa \uff08\u89c6\u9891\u8001\u5e08\u3001\u7b80\u5316\uff09 \u80fd\u591f\u638c\u63e1\u63a5\u53e3\u5f00\u53d1\u7684\u6d41\u7a0b \u80fd\u591f\u5b8c\u6210\u9891\u9053\u7ba1\u7406\u7684\u529f\u80fd\u5f00\u53d1 \u80fd\u591f\u638c\u63e1\u4f7f\u7528\u63a5\u53e3swagger\u3001postman\u3001knife4j \u521d\u59cb\u5316\u5de5\u7a0b\u7684\u642d\u5efa,\u4f18\u5316\u653e\u5728\u8d44\u6599\uff0cday01\\\u8d44\u6599\\\u521d\u59cb\u5de5\u7a0b\\\u4fee\u6539\u540e 03-\u80cc\u666f\u53ca\u6982\u8ff0 05:19 \u00b6 \u968f\u7740\u667a\u80fd\u624b\u673a\u7684\u666e\u53ca\uff0c\u4eba\u4eec\u66f4\u52a0\u4e60\u60ef\u4e8e\u901a\u8fc7\u624b\u673a\u6765\u770b\u65b0\u95fb\u3002\u7531\u4e8e\u751f\u6d3b\u8282\u594f\u7684\u52a0\u5feb\uff0c\u5f88\u591a\u4eba\u53ea\u80fd\u5229\u7528\u788e\u7247\u65f6\u95f4\u6765\u83b7\u53d6\u4fe1\u606f\uff0c\u56e0\u6b64\uff0c\u5bf9\u4e8e\u79fb\u52a8\u8d44\u8baf\u5ba2\u6237\u7aef\u7684\u9700\u6c42\u4e5f\u8d8a\u6765\u8d8a\u9ad8\u3002\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u6b63\u662f\u5728\u8fd9\u6837\u80cc\u666f\u4e0b\u5f00\u53d1\u51fa\u6765\u3002\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u91c7\u7528\u5f53\u4e0b\u706b\u70ed\u7684\u5fae\u670d\u52a1+\u5927\u6570\u636e\u6280\u672f\u67b6\u6784\u5b9e\u73b0\u3002\u672c\u9879\u76ee\u4e3b\u8981\u7740\u624b\u4e8e\u83b7\u53d6\u6700\u65b0\u6700\u70ed\u65b0\u95fb\u8d44\u8baf\uff0c\u901a\u8fc7\u5927\u6570\u636e\u5206\u6790\u7528\u6237\u559c\u597d\u7cbe\u786e\u63a8\u9001\u54a8\u8be2\u65b0\u95fb \u9879\u76ee\u6982\u8ff0 \u00b6 \u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u662f\u5bf9\u5728\u7ebf\u6559\u80b2\u5e73\u53f0\u4e1a\u52a1\u8fdb\u884c\u5927\u6570\u636e\u7edf\u8ba1\u5206\u6790\u7684\u7cfb\u7edf\u3002\u788e\u7247\u5316\u3001\u5207\u6362\u9891\u7e41\u3001\u793e\u4ea4\u5316\u548c\u4e2a\u6027\u5316\u73b0\u5982\u4eca\u6210\u4e3a\u4eba\u4eec\u9605\u8bfb\u884c\u4e3a\u7684\u6807\u7b7e\u3002\u9ed1\u9a6c\u5934\u6761\u5bf9\u6d77\u91cf\u4fe1\u606f\u8fdb\u884c\u641c\u96c6\uff0c\u901a\u8fc7\u7cfb\u7edf\u8ba1\u7b97\u5206\u7c7b\uff0c\u5206\u6790\u7528\u6237\u7684\u5174\u8da3\u8fdb\u884c\u63a8\u9001\u4ece\u800c\u6ee1\u8db3\u7528\u6237\u7684\u9700\u6c42\u3002 \u9879\u76ee\u672f\u8bed\u5b9a\u4e49 \u00b6 \u9879\u76ee\uff1a\u6cdb\u6307\u9ed1\u9a6c\u5934\u6761\u6574\u4e2a\u9879\u76ee\u6216\u67d0\u4e00\u9879\u76ee\u6a21\u5757 \u5de5\u7a0b\uff1a\u6cdb\u6307\u9ed1\u9a6c\u5934\u6761\u67d0\u4e00\u9879\u76ee\u7684\u6e90\u7801\u5de5\u7a0b \u7528\u6237\uff1a\u6cdb\u6307\u9ed1\u9a6c\u5934\u6761APP\u7528\u6237\u7aef\u7528\u6237 \u81ea\u5a92\u4f53\u4eba\uff1a\u6cdb\u6307\u901a\u8fc7\u9ed1\u9a6c\u81ea\u5a92\u4f53\u7cfb\u7edf\u53d1\u9001\u6587\u7ae0\u7684\u7528\u6237 \u7ba1\u7406\u5458\uff1a\u6cdb\u6307\u9ed1\u9a6c\u5934\u6761\u7ba1\u7406\u7cfb\u7edf\u7684\u4f7f\u7528\u7528\u6237 App\uff1a\u6cdb\u6307\u9ed1\u9a6c\u5934\u6761APP WeMedia\uff1a\u6cdb\u6307\u9ed1\u9a6c\u5934\u6761\u81ea\u5a92\u4f53\u7cfb\u7edf Admin\uff1a\u6cdb\u6307\u9ed1\u9a6c\u5934\u6761\u7ba1\u7406\u7cfb\u7edf 04-\u529f\u80fd\u9700\u6c42\u8bf4\u660e 11:21 \u00b6 day01\\\u8d44\u6599\\\u9879\u76ee\u539f\u578b-HTML(\u4f7f\u7528\u706b\u72d0\u6d4f\u89c8\u5668\u6253\u5f00)\\\u9879\u76ee\u539f\u578b-HTML(\u4f7f\u7528\u706b\u72d0\u6d4f\u89c8\u5668\u6253\u5f00)[\u539f\u578b\u56fe]_\u540e\u53f0_\u9ed1\u9a6c\u5934\u6761_V1.0 05-\u6280\u672f\u67b6\u6784 07:00 \u00b6 Weex+Vue+WebSocket \uff1a\u4f7f\u7528Weex\u8de8\u5e73\u53f0\u5f00\u53d1\u5de5\u5177\uff0c\u6574\u5408\u96c6\u6210VUE\u6846\u67b6\uff0c\u5b8c\u6210\u9ed1\u9a6c\u5934\u6761\u79fb\u52a8\u7aef\u529f\u80fd\u5f00\u53d1\uff0c\u5e76\u96c6\u6210WebSocket\u5b9e\u73b0\u5373\u65f6\u6d88\u606f\uff08\u6587\u7ae0\u63a8\u8350\u3001\u79c1\u4fe1\uff09\u7684\u63a8\u9001 Vue+Echarts \uff1a \u81ea\u5a92\u4f53\u7cfb\u7edf\u4f7f\u7528Vue\u5f00\u53d1\u5173\u952e\uff0c\u96c6\u6210Echarts\u56fe\u8868\u6846\u67b6\uff0c\u5b8c\u6210\u76f8\u5173\u7c89\u4e1d\u753b\u50cf\u3001\u6570\u636e\u5206\u6790\u7b49\u529f\u80fd Vue+Echarts+WebSocket \uff1a \u7ba1\u7406\u7cfb\u7edf\u4e5f\u662f\u4f7f\u7528Vue\u5f00\u53d1\uff0c\u96c6\u6210Echarts\uff0c\u5b8c\u6210\u7f51\u7ad9\u7edf\u8ba1\u3001\u5185\u5bb9\u7edf\u8ba1\u7b49\u529f\u80fd\uff0c\u96c6\u6210WebSocket\uff0c\u5b9e\u73b0\u7cfb\u7edf\u770b\u677f\u5b9e\u65f6\u6570\u636e\u81ea\u52a8\u5316\u66f4\u65b0 Spring-Cloud-Gateway : \u5fae\u670d\u52a1\u4e4b\u524d\u67b6\u8bbe\u7684\u7f51\u5173\u670d\u52a1\uff0c\u5b9e\u73b0\u670d\u52a1\u6ce8\u518c\u4e2d\u7684API\u8bf7\u6c42\u8def\u7531\uff0c\u4ee5\u53ca\u63a7\u5236\u6d41\u901f\u63a7\u5236\u548c\u7194\u65ad\u5904\u7406\u90fd\u662f\u5e38\u7528\u7684\u67b6\u6784\u624b\u6bb5\uff0c\u800c\u8fd9\u4e9b\u529f\u80fdGateway\u5929\u7136\u652f\u6301 PMD&P3C : \u9759\u6001\u4ee3\u7801\u626b\u63cf\u5de5\u5177\uff0c\u5728\u9879\u76ee\u4e2d\u626b\u63cf\u9879\u76ee\u4ee3\u7801\uff0c\u68c0\u67e5\u5f02\u5e38\u70b9\u3001\u4f18\u5316\u70b9\u3001\u4ee3\u7801\u89c4\u8303\u7b49\uff0c\u4e3a\u5f00\u53d1\u56e2\u961f\u63d0\u4f9b\u89c4\u8303\u7edf\u4e00\uff0c\u63d0\u5347\u9879\u76ee\u4ee3\u7801\u8d28\u91cf Junit : \u5728\u6301\u7eed\u96c6\u6210\u601d\u60f3\u4e2d\uff0c\u5355\u5143\u6d4b\u8bd5\u504f\u5411\u81ea\u52a8\u5316\u8fc7\u7a0b\uff0c\u9879\u76ee\u901a\u8fc7Junit+Maven\u7684\u96c6\u6210\u5b9e\u73b0\u8fd9\u79cd\u8fc7\u7a0b \u8fd0\u7528Spring Boot\u5feb\u901f\u5f00\u53d1\u6846\u67b6\uff0c\u6784\u5efa\u9879\u76ee\u5de5\u7a0b\uff1b\u5e76\u7ed3\u5408Spring Cloud\u5168\u5bb6\u6876\u6280\u672f\uff0c\u5b9e\u73b0\u540e\u7aef\u4e2a\u4eba\u4e2d\u5fc3\u3001\u81ea\u5a92\u4f53\u3001\u7ba1\u7406\u4e2d\u5fc3\u7b49\u5fae\u670d\u52a1\u3002 \u8fd0\u7528WebMagic\u722c\u866b\u6280\u672f\uff0c\u5b8c\u5584\u7cfb\u7edf\u5185\u5bb9\u81ea\u52a8\u5316\u91c7\u96c6 \u8fd0\u7528Kafka\u5b8c\u6210\u5185\u90e8\u7cfb\u7edf\u6d88\u606f\u901a\u77e5\uff1b\u4e0e\u5ba2\u6237\u7aef\u7cfb\u7edf\u6d88\u606f\u901a\u77e5\uff1b\u4ee5\u53ca\u5b9e\u65f6\u6570\u636e\u8ba1\u7b97 \u8fd0\u7528MyCat\u6570\u636e\u5e93\u4e2d\u95f4\u4ef6\u8ba1\u7b97\uff0c\u5bf9\u7cfb\u7edf\u6570\u636e\u8fdb\u884c\u5206\u5e93\u5206\u8868\uff0c\u63d0\u5347\u7cfb\u7edf\u6570\u636e\u5c42\u6027\u80fd \u8fd0\u7528Redis\u7f13\u5b58\u6280\u672f\uff0c\u5b9e\u73b0\u70ed\u6570\u636e\u7684\u8ba1\u7b97\uff0cNoSession\u7b49\u529f\u80fd\uff0c\u63d0\u5347\u7cfb\u7edf\u6027\u80fd\u6307\u6807 \u8fd0\u7528Zoookeeper\u6280\u672f\uff0c\u5b8c\u6210\u5927\u6570\u636e\u8282\u70b9\u4e4b\u540e\u7684\u534f\u8c03\u4e0e\u7ba1\u7406\uff0c\u63d0\u5347\u7cfb\u7edf\u5b58\u50a8\u5c42\u9ad8\u53ef\u7528 \u4f7f\u7528Mysql\u5b58\u50a8\u7528\u6237\u6570\u636e\uff0c\u4ee5\u4fdd\u8bc1\u4e0a\u5c42\u6570\u636e\u67e5\u8be2\u7684\u9ad8\u6027\u80fd \u4f7f\u7528Mongo\u5b58\u50a8\u7528\u6237\u70ed\u6570\u636e\uff0c\u4ee5\u4fdd\u8bc1\u7528\u6237\u70ed\u6570\u636e\u9ad8\u6269\u5c55\u548c\u9ad8\u6027\u80fd\u6307\u6807 \u4f7f\u7528FastDFS\u4f5c\u4e3a\u9759\u6001\u8d44\u6e90\u5b58\u50a8\u5668\uff0c\u5728\u5176\u4e0a\u5b9e\u73b0\u70ed\u9759\u6001\u8d44\u6e90\u7f13\u5b58\u3001\u6dd8\u6c70\u7b49\u529f\u80fd \u8fd0\u7528Habse\u6280\u672f\uff0c\u5b58\u50a8\u7cfb\u7edf\u4e2d\u7684\u51b7\u6570\u636e\uff0c\u4fdd\u8bc1\u7cfb\u7edf\u6570\u636e\u7684\u53ef\u9760\u6027 \u8fd0\u7528ES\u641c\u7d22\u6280\u672f\uff0c\u5bf9\u51b7\u6570\u636e\u3001\u6587\u7ae0\u6570\u636e\u5efa\u7acb\u7d22\u5f15\uff0c\u4ee5\u4fdd\u8bc1\u51b7\u6570\u636e\u3001\u6587\u7ae0\u67e5\u8be2\u6027\u80fd \u8fd0\u7528Sqoop\u3001Kettle\u7b49\u5de5\u5177\uff0c\u5b9e\u73b0\u5927\u6570\u636e\u7684\u79bb\u7ebf\u5165\u4ed3\uff1b\u6216\u8005\u6570\u636e\u5907\u4efd\u5230Hadoop \u8fd0\u7528Spark+Hive\u8fdb\u884c\u79bb\u7ebf\u6570\u636e\u5206\u6790\uff0c\u5b9e\u73b0\u7cfb\u7edf\u4e2d\u5404\u7c7b\u7edf\u8ba1\u62a5\u8868 \u8fd0\u7528Spark Streaming + Hive+Kafka\u5b9e\u73b0\u5b9e\u65f6\u6570\u636e\u5206\u6790\u4e0e\u5e94\u7528\uff1b\u6bd4\u5982\u6587\u7ae0\u63a8\u8350 \u8fd0\u7528Neo4j\u77e5\u8bc6\u56fe\u8c31\u6280\u672f\uff0c\u5206\u6790\u6570\u636e\u5173\u7cfb\uff0c\u4ea7\u51fa\u77e5\u8bc6\u7ed3\u679c\uff0c\u5e76\u5e94\u7528\u5230\u4e0a\u5c42\u4e1a\u52a1\u4e2d\uff0c\u4ee5\u5e2e\u52a9\u7528\u6237\u3001\u81ea\u5a92\u4f53\u3001\u8fd0\u8425\u6548\u679c/\u80fd\u529b\u63d0\u5347\u3002\u6bd4\u5982\u7c89\u4e1d\u7b49\u7ea7\u8ba1\u7b97 \u8fd0\u7528AI\u6280\u672f\uff0c\u6765\u5b8c\u6210\u7cfb\u7edf\u81ea\u52a8\u5316\u529f\u80fd\uff0c\u4ee5\u63d0\u5347\u6548\u7387\u53ca\u8282\u7701\u6210\u672c\u3002\u6bd4\u5982\u5b9e\u540d\u8ba4\u8bc1\u81ea\u52a8\u5316 06-\u6570\u636e\u5e93\u8bbe\u8ba1 15:13 \u00b6 day01\\\u8d44\u6599\\\u9ed1\u9a6c\u5934\u6761-\u6570\u636e\u5e93\u89c4\u8303\u8bbe\u8ba1\u8bf4\u660e\u4e66.md \u5bfc\u5165\uff1aday01\\\u8d44\u6599\\sql\u811a\u672c \u5197\u4f59\u8bbe\u8ba1\u5982\u4f55\u4fdd\u8bc1\u6570\u636e\u7684\u4e00\u81f4\u6027\uff1a \u00b6 \u65b9\u6cd5\u4e00\uff1a\u7ebf\u4e0b\u626b\u63cf\u6b63\u53cd\u5197\u4f59\u8868\u5168\u90e8\u6570\u636e \u00b6 \u7ebf\u4e0b\u542f\u52a8\u4e00\u4e2a\u79bb\u7ebf\u7684\u626b\u63cf\u5de5\u5177\uff0c\u4e0d\u505c\u7684\u6bd4\u5bf9\u6b63\u8868T1\u548c\u53cd\u8868T2\uff0c\u5982\u679c\u53d1\u73b0\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u5c31\u8fdb\u884c\u8865\u507f\u4fee\u590d\u3002 \u4f18\u70b9 \u6bd4\u8f83\u7b80\u5355\uff0c\u5f00\u53d1\u4ee3\u4ef7\u5c0f \u7ebf\u4e0a\u670d\u52a1\u65e0\u9700\u4fee\u6539\uff0c\u4fee\u590d\u5de5\u5177\u4e0e\u7ebf\u4e0a\u670d\u52a1\u89e3\u8026 \u7f3a\u70b9 \u626b\u63cf\u6548\u7387\u4f4e\uff0c\u4f1a\u626b\u63cf\u5927\u91cf\u7684\u201c\u5df2\u7ecf\u80fd\u591f\u4fdd\u8bc1\u4e00\u81f4\u201d\u7684\u6570\u636e \u7531\u4e8e\u626b\u63cf\u7684\u6570\u636e\u91cf\u5927\uff0c\u626b\u63cf\u4e00\u8f6e\u7684\u65f6\u95f4\u6bd4\u8f83\u957f\uff0c\u5373\u6570\u636e\u5982\u679c\u4e0d\u4e00\u81f4\uff0c\u4e0d\u4e00\u81f4\u7684\u65f6\u95f4\u7a97\u53e3\u6bd4\u8f83\u957f \u65b9\u6cd5\u4e8c\uff1a\u5b9e\u65f6\u7ebf\u4e0a\u201c\u6d88\u606f\u5bf9\u201d\u68c0\u6d4b \u00b6 \u8fd9\u6b21\u4e0d\u662f\u5199\u65e5\u5fd7\u4e86\uff0c\u800c\u662f\u5411\u6d88\u606f\u603b\u7ebf\u53d1\u9001\u6d88\u606f\uff1b\u8fd9\u6b21\u4e0d\u662f\u9700\u8981\u4e00\u4e2a\u5468\u671f\u626b\u63cf\u7684\u79bb\u7ebf\u5de5\u5177\u4e86\uff0c\u800c\u662f\u4e00\u4e2a\u5b9e\u65f6\u8ba2\u9605\u6d88\u606f\u7684\u670d\u52a1\u4e0d\u505c\u7684\u6536\u6d88\u606f\u3002 \u4f18\u70b9 \u6548\u7387\u9ad8 \u5b9e\u65f6\u6027\u9ad8 \u7f3a\u70b9 \u65b9\u6848\u6bd4\u8f83\u590d\u6742\uff0c\u4e0a\u7ebf\u5f15\u5165\u4e86\u6d88\u606f\u603b\u7ebf\u8fd9\u4e2a\u7ec4\u4ef6 \u7ebf\u4e0b\u591a\u4e86\u4e00\u4e2a\u8ba2\u9605\u603b\u7ebf\u7684\u68c0\u6d4b\u670d\u52a1 07-\u521d\u59cb\u5316\u5de5\u7a0b\u5bfc\u5165\u53ca\u73af\u5883\u8bf4\u660e 08:18 \u00b6 heima-leadnews-common : \u662f\u6574\u4e2a\u5de5\u7a0b\u7684\u914d\u7f6e\u6838\u5fc3\uff0c\u5305\u62ec\u6240\u6709\u96c6\u6210\u4e09\u65b9\u6846\u67b6\u7684\u914d\u7f6e\u5b9a\u4e49\uff0c\u6bd4\u5982redis\u3001kafka\u7b49\u3002\u9664\u6b64\u4e4b\u5916\u8fd8\u5305\u62ec\u9879\u76ee\u6bcf\u4e2a\u6a21\u5757\u53ca\u6574\u4e2a\u9879\u76ee\u7684\u5e38\u91cf\u5b9a\u4e49; heima-leadnews-model \uff1a\u9879\u76ee\u4e2d\u7528\u5230\u7684Dto\u3001Pojo\u3001Mapper\u3001Enums\u5b9a\u4e49\u5de5\u7a0b; heima-leadnews-utils : \u5de5\u7a0b\u516c\u7528\u5de5\u5177\u7c7b\u9879\u76ee\uff0c\u5305\u542b\u52a0\u5bc6/\u89e3\u5bc6\u3001Date\u3001JSON\u7b49\u5de5\u5177\u7c7b; heima-leadnew-apis : \u6574\u4e2a\u9879\u76ee\u5fae\u670d\u52a1\u66b4\u9732\u7684\u63a5\u53e3\u7684\u5b9a\u4e49\u9879\u76ee\uff0c\u6309\u6bcf\u4e2a\u6a21\u5757\u8fdb\u884c\u5b50\u5305\u62c6\u5206; 08-\u524d\u540e\u7aef\u5206\u79bb\u5f00\u53d1 11:26 \u00b6 \u524d\u540e\u7aef\u5206\u79bb\u7684\"\u524d\"\u7279\u6307\u6d4f\u89c8\u5668\u7aef(\u6216\u5ba2\u6237\u7aef)\u3002 Java\u670d\u52a1\u5668\u7aef\u521d\u5b66\u8005\u6700\u5bb9\u6613\u5f15\u8d77\u8bef\u89e3\u7684\u4e00\u4e2a\u6982\u5ff5\u5c31\u662f: JSP\u662f\u524d\u7aef\u6280\u672f\u3002 JSP\u4e00\u5b9a\u4e00\u5b9a\u4e00\u5b9a\u8981\u77e5\u9053\u5168\u79f0\uff1aJava Server Page\u3002\u662f\u8fd0\u884c\u5728\u670d\u52a1\u5668\u7aefJVM\u4e4b\u4e0aServlet\u5bb9\u5668\u91cc\u7684\uff0c\u53ea\u662f\u6267\u884c\u7684\u7ed3\u679c\u662fHTML\uff0c\u54cd\u5e94\u7ed9\u6d4f\u89c8\u5668\u3002 Java EE\u5148\u6709\u7684Servlet\uff0c\u90a3\u65f6\u5019\u5df2\u7ecf\u6709\u4e86ASP(\u540c\u6837\u8981\u77e5\u9053\u662fActive Server Page\u7684\u610f\u601d)\u3002 \u7531\u4e8e\u8981\u5728Servlet\u91cc\u9762\u62fc\u5927\u91cf\u7684HTML\u4ee3\u7801\uff0c\u6240\u4ee5Java\u89c4\u8303\u5b66\u4e60\u4e86ASP\uff0c\u63d0\u51faJSP\u3002Servlet\u662fJava\u4ee3\u7801\u91cc\u6df7\u5165HTML\uff0cJSP\u662fHTML\u4ee3\u7801\u91cc\u6df7\u5165Java\u3002 \u6d4f\u89c8\u5668\u6839\u672c\u4e0d\u5173\u5fc3\u670d\u52a1\u5668\u7aef\u662fJSP\u3001ASP\u3001PHP\uff0c\u6216\u8005\u8fd8\u662f\u539f\u59cb\u7684Servlet\uff0c \u6216\u662f\u9759\u6001\u670d\u52a1\u5668\u4e0a\u7684HTML \uff0c\u53ea\u8981\u8fd4\u56de\u7684\u662f\u5408\u6cd5\u7684HTML\u5c31\u53ef\u4ee5\u3002 \u6240\u4ee5\uff0c\u628aJSP\u4e2d\u9759\u6001\u7684HTML\u90e8\u5206\u62ff\u51fa\u6765\uff0c\u53d8\u6210\u7b80\u5355\u7684HTML\u6587\u4ef6\uff0c\u653e\u5728HTTP\u670d\u52a1\u5668\u4e0a\uff0c\u6d4f\u89c8\u5668\u53ea\u8981\u83b7\u53d6\u5230\u8fd9\u4e9bHTML\u5c31\u53ef\u4ee5\u4e86\u3002\u52a8\u6001\u7684\u6570\u636e\u90e8\u5206\u7528HTML\u91cc\u7684JS\u901a\u8fc7AJAX\u7684\u65b9\u5f0f\u4ece\u670d\u52a1\u5668\u7aef\u83b7\u53d6\uff0c\u7136\u540e\u52a8\u6001\u64cd\u4f5cDom\uff0c\u5b8c\u6210\u52a8\u6001\u5185\u5bb9\u7684\u5c55\u793a\u3002\u8fd9\u6837\u524d\u540e\u7aef\u5c31\u5206\u79bb\u4e86\u3002 \u9759\u6001\u8d44\u6e90\u548c\u6570\u636e\u63a5\u53e3\u88ab\u90e8\u7f72\u5728\u4e24\u4e2a\u4e0d\u540c\u7684\u670d\u52a1\u4e0a\u5c31\u7b97\u524d\u540e\u7aef\u5206\u79bb\uff1f \u9759\u6001\u8d44\u6e90\u548c\u670d\u52a1(\u5b9e\u73b0\u63a5\u53e3\u7684\u4e1a\u52a1\u903b\u8f91)\uff0c\u5728\u5f00\u53d1\u9636\u6bb5\u5c31\u5206\u79bb\u5f00\u53d1\uff0c\u800c\u90e8\u7f72\u9636\u6bb5\u5206\u79bb\u90e8\u7f72\u5728\u4e0d\u540c\u670d\u52a1\u5668\u4e0a\uff0c\u7b97\u662f\u4e25\u683c\u610f\u4e49\u4e0a\u7684\u524d\u540e\u7aef\u5206\u79bb\u3002 \u6709\u4e9b\u5c0f\u578b\u9879\u76ee\uff0c\u5f00\u53d1\u9636\u6bb5\u6ca1\u6709\u5206\u79bb\u5f00\u53d1\uff0c\u4e5f\u5c31\u662f\u8bf4\u524d\u540e\u7aef\u4ee3\u7801\u5728\u4e00\u4e2aProject\u91cc\u3002\u5728\u90e8\u7f72\u9636\u6bb5\u4e5f\u6ca1\u6709\u5206\u79bb\uff0c\u4f8b\u5982\u9759\u6001\u8d44\u6e90\u8fd8\u662f\u653e\u5728Tomcat\u91cc\u3002\u8fd9\u4e9b\u60c5\u51b5\uff0c\u5230\u5e95\u7b97\u4e0d\u7b97\u524d\u540e\u7aef\u5206\u79bb\uff0c\u5173\u952e\u662f\u662f\u5426\"\u4e25\u683c\"\u770b\u5f85\u3002 09-\u540e\u7aef\u5f00\u53d1\u901a\u7528\u89c4\u8303 04:37 \u00b6 \u968f\u7740\u4e1a\u52a1\u7684\u590d\u6742\uff0c\u540c\u4e00\u4e2a\u63a5\u53e3\u53ef\u80fd\u51fa\u73b0\u591a\u4e2a\u7248\u672c\uff0c\u4e3a\u4e86\u65b9\u4fbf\u540e\u671f\u5207\u6362\u548cAB\u6d4b\u8bd5\uff0c\u9700\u8981\u5b9a\u4e49\u63a5\u53e3\u7684\u7248\u672c\u53f7 \u5728\u67d0\u4e00\u4e2a\u5fae\u670d\u52a1\u4e0b\u8bbf\u95eecontroller\u7684\u65f6\u5019\u5728\u5305\u540d\u4e0b\u52a0\u4e00\u4e2a\u7248\u672c\u53f7,\u5982\u4e0b properties com.heima.article.controller.v1 \u5728\u8bbf\u95ee\u5177\u4f53\u7684\u63a5\u53e3\u65b9\u6cd5\u7684url\u6620\u5c04\u7684\u65f6\u5019\u4e5f\u5e94\u8be5\u52a0\u4e0a\u7248\u672c\u8bf4\u660e\uff0c\u5982\u4e0b\uff1a java @RequestMapping ( \"/api/v1/article\" ) \u5bf9\u4e8e\u4e00\u822c\u7684 ABTest \u5b9e\u9a8c\uff0c\u5176\u5b9e\u672c\u8d28\u4e0a\u5c31\u662f\u628a\u5e73\u53f0\u7684\u6d41\u91cf\u5747\u5300\u5206\u4e3a\u51e0\u4e2a\u7ec4\uff0c\u6bcf\u4e2a\u7ec4\u6dfb\u52a0\u4e0d\u540c\u7684\u7b56\u7565\uff0c\u7136\u540e\u6839\u636e\u8fd9\u51e0\u4e2a\u7ec4\u7684\u7528\u6237\u6570\u636e\u6307\u6807\uff0c\u4f8b\u5982\uff1a\u7559\u5b58\u3001\u4eba\u5747\u89c2\u770b\u65f6\u957f\u3001\u57fa\u7840\u4e92\u52a8\u7387\u7b49\u7b49\u6838\u5fc3\u6307\u6807\uff0c\u6700\u7ec8\u9009\u62e9\u4e00\u4e2a\u6700\u597d\u7684\u7ec4\u4e0a\u7ebf\u3002 \u6240\u4ee5\u4f1a\u4fdd\u7559\u591a\u5957\u63a5\u53e3\u7684\u5b9e\u73b0\u6765\u4f5c\u4e3a\u4e0a\u7ebf\u7684\u63a5\u53e3\uff0c\u90a3\u4e48\u524d\u7aef\u5c31\u53ef\u4ee5\u6839\u636e\u7248\u672c\u53f7\uff0c\u627e\u5230\u4e0d\u540c\u7248\u672c\u7684\u63a5\u53e3\u3002 10-\u63a5\u53e3\u901a\u7528\u8bf7\u6c42\u548c\u54cd\u5e94 23:51 \u00b6 \u6982\u5ff5\uff1a VO \uff08View Object\uff09\uff1a\u89c6\u56fe\u5bf9\u8c61\uff0c\u7528\u4e8e\u5c55\u793a\u5c42\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u628a\u67d0\u4e2a\u6307\u5b9a\u9875\u9762\uff08\u6216\u7ec4\u4ef6\uff09\u7684\u6240\u6709\u6570\u636e\u5c01\u88c5\u8d77\u6765\u3002 DTO \uff08Data Transfer Object\uff09\uff1a\u6570\u636e\u4f20\u8f93\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u6982\u5ff5\u6765\u6e90\u4e8eJ2EE\u7684\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u539f\u6765\u7684\u76ee\u7684\u662f\u4e3a\u4e86EJB\u7684\u5206\u5e03\u5f0f\u5e94\u7528\u63d0\u4f9b\u7c97\u7c92\u5ea6\u7684\u6570\u636e\u5b9e\u4f53\uff0c\u4ee5\u51cf\u5c11\u5206\u5e03\u5f0f\u8c03\u7528\u7684\u6b21\u6570\uff0c\u4ece\u800c\u63d0\u9ad8\u5206\u5e03\u5f0f\u8c03\u7528\u7684\u6027\u80fd\u548c\u964d\u4f4e\u7f51\u7edc\u8d1f\u8f7d\uff0c\u4f46\u5728\u8fd9\u91cc\uff0c\u6211\u6cdb\u6307\u7528\u4e8e\u5c55\u793a\u5c42\u4e0e\u670d\u52a1\u5c42\u4e4b\u95f4\u7684\u6570\u636e\u4f20\u8f93\u5bf9\u8c61\u3002 DO \uff08Domain Object\uff09\uff1a\u9886\u57df\u5bf9\u8c61\uff0c\u5c31\u662f\u4ece\u73b0\u5b9e\u4e16\u754c\u4e2d\u62bd\u8c61\u51fa\u6765\u7684\u6709\u5f62\u6216\u65e0\u5f62\u7684\u4e1a\u52a1\u5b9e\u4f53\u3002 PO \uff08Persistent Object\uff09\uff1a\u6301\u4e45\u5316\u5bf9\u8c61\uff0c\u5b83\u8ddf\u6301\u4e45\u5c42\uff08\u901a\u5e38\u662f\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff09\u7684\u6570\u636e\u7ed3\u6784\u5f62\u6210\u4e00\u4e00\u5bf9\u5e94\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u5982\u679c\u6301\u4e45\u5c42\u662f\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u90a3\u4e48\uff0c\u6570\u636e\u8868\u4e2d\u7684\u6bcf\u4e2a\u5b57\u6bb5\uff08\u6216\u82e5\u5e72\u4e2a\uff09\u5c31\u5bf9\u5e94PO\u7684\u4e00\u4e2a\uff08\u6216\u82e5\u5e72\u4e2a\uff09\u5c5e\u6027\u3002 \u6a21\u578b\uff1a \u200b \u4e0b\u9762\u4ee5\u4e00\u4e2a\u65f6\u5e8f\u56fe\u5efa\u7acb\u7b80\u5355\u6a21\u578b\u6765\u63cf\u8ff0\u4e0a\u8ff0\u5bf9\u8c61\u5728\u4e09\u5c42\u67b6\u6784\u5e94\u7528\u4e2d\u7684\u4f4d\u7f6e l \u7528\u6237\u53d1\u51fa\u8bf7\u6c42\uff08\u53ef\u80fd\u662f\u586b\u5199\u8868\u5355\uff09\uff0c\u8868\u5355\u7684\u6570\u636e\u5728\u5c55\u793a\u5c42\u88ab\u5339\u914d\u4e3aVO\u3002 l \u5c55\u793a\u5c42\u628aVO\u8f6c\u6362\u4e3a\u670d\u52a1\u5c42\u5bf9\u5e94\u65b9\u6cd5\u6240\u8981\u6c42\u7684DTO\uff0c\u4f20\u9001\u7ed9\u670d\u52a1\u5c42\u3002 l \u670d\u52a1\u5c42\u9996\u5148\u6839\u636eDTO\u7684\u6570\u636e\u6784\u9020\uff08\u6216\u91cd\u5efa\uff09\u4e00\u4e2aDO\uff0c\u8c03\u7528DO\u7684\u4e1a\u52a1\u65b9\u6cd5\u5b8c\u6210\u5177\u4f53\u4e1a\u52a1\u3002 l \u670d\u52a1\u5c42\u628aDO\u8f6c\u6362\u4e3a\u6301\u4e45\u5c42\u5bf9\u5e94\u7684PO\uff08\u53ef\u4ee5\u4f7f\u7528ORM\u5de5\u5177\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u7528\uff09\uff0c\u8c03\u7528\u6301\u4e45\u5c42\u7684\u6301\u4e45\u5316\u65b9\u6cd5\uff0c\u628aPO\u4f20\u9012\u7ed9\u5b83\uff0c\u5b8c\u6210\u6301\u4e45\u5316\u64cd\u4f5c\u3002 l \u5bf9\u4e8e\u4e00\u4e2a\u9006\u5411\u64cd\u4f5c\uff0c\u5982\u8bfb\u53d6\u6570\u636e\uff0c\u4e5f\u662f\u7528\u7c7b\u4f3c\u7684\u65b9\u5f0f\u8f6c\u6362\u548c\u4f20\u9012\uff0c\u7565\u3002 \u5728ResponseResult\u6dfb\u52a0\u65b9\u6cd5 //\u8fd4\u56dedata\u4e3anull\u6210\u529f\u6d88\u606f public static ResponseResult okResult () { ResponseResult result = setAppHttpCodeEnum ( AppHttpCodeEnum . SUCCESS , AppHttpCodeEnum . SUCCESS . getErrorMessage ()); return result ; } \u8c03\u7528\uff1a return ResponseResult . okResult (); dto:\u524d\u7aef\u53c2\u6570\u63a5\u6536 pojo:\u6570\u636e\u5e93\u5b9e\u4f53\u7c7b vo:\u8fd4\u56de\u7ed9\u524d\u7aef\u5b9e\u4f53 11-\u591a\u73af\u5883\u5207\u6362 05:15 \u00b6 \u5728\u6bcf\u4e00\u4e2a\u5fae\u670d\u52a1\u7684\u5de5\u7a0b\u4e2d\u7684\u6839\u76ee\u5f55\u4e0b\u521b\u5efa\u4e09\u4e2a\u6587\u4ef6\uff0c\u65b9\u4fbf\u5404\u4e2a\u73af\u5883\u7684\u5207\u6362 \uff081\uff09maven_dev.properties \u5b9a\u4e49\u5f00\u53d1\u73af\u5883\u7684\u914d\u7f6e \uff082\uff09maven_prod.properties \u5b9a\u4e49\u751f\u4ea7\u73af\u5883\u7684\u914d\u7f6e \uff083\uff09maven_test.properties \u5b9a\u4e49\u6d4b\u8bd5\u73af\u5883\u7684\u914d\u7f6e\uff0c\u5f00\u53d1\u9636\u6bb5\u4f7f\u7528\u8fd9\u4e2a\u6d4b\u8bd5\u73af\u5883 \u9ed8\u8ba4\u52a0\u8f7d\u7684\u73af\u5883\u4e3atest\uff0c\u5728\u6253\u5305\u7684\u8fc7\u7a0b\u4e2d\u4e5f\u53ef\u4ee5\u6307\u5b9a\u53c2\u6570\u6253\u5305 package -P test/prod/dev \u5177\u4f53\u914d\u7f6e\uff0c\u8bf7\u67e5\u770b\u7236\u5de5\u7a0b\u4e0b\u7684maven\u63d2\u4ef6\u7684profiles\u914d\u7f6e <profiles> <profile> <id> dev </id> <build> <filters> <filter> maven_dev.properties </filter> </filters> </build> </profile> <profile> <id> test </id> <activation> <activeByDefault> true </activeByDefault> </activation> <build> <filters> <filter> maven_test.properties </filter> </filters> </build> </profile> <profile> <id> prod </id> <build> <filters> <filter> maven_prod.properties </filter> </filters> </build> </profile> </profiles> \u6f14\u793a\uff1a\u591a\u73af\u5883\u5207\u6362 maven_test.properties: profiles.name = test test = a application.yml: test: ${ test } \u6267\u884c\u547d\u4ee4: mvn package -P test \u6253\u5305\u5b8c\u4e4b\u540e\u67e5\u770bjar\u5305\u4e2d\u7684application.yml: test : a \u53ef\u4ee5\u770b\u5230\u91cc\u8fb9\u7684\u5360\u4f4d\u7b26\u5df2\u7ecf\u88ab\u66ff\u6362\u4e3a\u4e86a 12-\u9891\u9053\u7ba1\u7406\u9700\u6c42\u5206\u6790 04:44 \u00b6 13-\u5fae\u670d\u52a1\u642d\u5efa 09:11 \u00b6 DAO\u5c42\u76f8\u5173\u4f9d\u8d56\uff0c\u5728model\u5de5\u7a0b\u4e2d\u5df2\u7ecf\u5f15\u5165 logback.xml\u4e2d\u7684\u65e5\u5fd7\u6587\u4ef6\u4f4d\u7f6e\u8bb0\u5f97\u6539\uff0c\u5426\u5219\u65e0\u6cd5\u542f\u52a8 14-\u63a5\u53e3\u5b9a\u4e49 08:22 \u00b6 15-\u529f\u80fd\u5b9e\u73b0 12:18 \u00b6 public ResponseResult findByNameAndPage ( ChannelDto dto ) { //1.\u53c2\u6570\u68c0\u6d4b\uff0c\u8fd9\u4e00\u6b65\u4e3b\u8981\u8fd8\u662f\u9632\u6b62\u53c2\u6570\u4e0d\u662f\u4ececontroller\u4f20\u8fdb\u6765\u7684 if ( dto == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //\u5206\u9875\u53c2\u6570\u68c0\u67e5 dto . checkParam (); //2.\u5b89\u88c5\u540d\u79f0\u6a21\u7cca\u5206\u9875\u67e5\u8be2 Page page = new Page ( dto . getPage (), dto . getSize ()); LambdaQueryWrapper < AdChannel > lambdaQueryWrapper = new LambdaQueryWrapper (); if ( StringUtils . isNotBlank ( dto . getName ())){ //where name like '%abc%' //\u53c2\u65701\uff1a\u4f7f\u7528\u51fd\u6570\u5f0f\u63a5\u53e3AdChannel::getName\u6307\u5b9a\u5c5e\u6027\uff0cmybatis-plus\u4f1a\u4ece\u5c5e\u6027\u4e0a\u53cd\u5c04\u51fa\u5b57\u6bb5\u540d //\u53c2\u65702:like\u7684\u503c lambdaQueryWrapper . like ( AdChannel :: getName , dto . getName ()); } IPage result = page ( page , lambdaQueryWrapper ); //3.\u7ed3\u679c\u5c01\u88c5 ResponseResult responseResult = new PageResponseResult ( dto . getPage (), dto . getSize (),( int ) result . getTotal ()); responseResult . setData ( result . getRecords ()); return responseResult ; } 16-postman 06:10 \u00b6 17-swagger 09:45 \u00b6 package com.heima.admin.config ; import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; import springfox.documentation.builders.ApiInfoBuilder ; import springfox.documentation.builders.PathSelectors ; import springfox.documentation.builders.RequestHandlerSelectors ; import springfox.documentation.service.ApiInfo ; import springfox.documentation.service.Contact ; import springfox.documentation.spi.DocumentationType ; import springfox.documentation.spring.web.plugins.Docket ; import springfox.documentation.swagger2.annotations.EnableSwagger2 ; @Configuration @EnableSwagger2 public class SwaggerConfiguration { @Bean public Docket buildDocket () { return new Docket ( DocumentationType . SWAGGER_2 ) . apiInfo ( buildApiInfo ()) . select () // \u8981\u626b\u63cf\u7684API(Controller)\u57fa\u7840\u5305 . apis ( RequestHandlerSelectors . basePackage ( \"com.heima\" )) . paths ( PathSelectors . any ()) . build (); } private ApiInfo buildApiInfo () { Contact contact = new Contact ( \"\u9ed1\u9a6c\u7a0b\u5e8f\u5458\" , \"\" , \"\" ); return new ApiInfoBuilder () . title ( \"\u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863\" ) . description ( \"\u5e73\u53f0\u7ba1\u7406\u670d\u52a1api\" ) . contact ( contact ) . version ( \"1.0.0\" ). build (); } } \u8bbf\u95ee\u5730\u5740\uff1ahttp://localhost:9001/swagger-ui.html 18-knife4j 05:54 \u00b6 \u5b98\u65b9\u6587\u6863\uff1a https://doc.xiaominfo.com/guide/useful.html \u9879\u76ee\u80cc\u666f\uff1a \u5927\u6982\u662f\u57282017\u5e744\u6708\u4efd,\u6211\u4eec\u56e2\u961f\u6574\u4e2a\u5f00\u53d1\u65b9\u5f0f\u90fd\u51b3\u5b9a\u4f7f\u7528\u524d\u540e\u7aef\u5206\u79bb\u7684\u65b9\u5f0f\u6765\u5408\u4f5c\u5f00\u53d1,\u524d\u540e\u7aef\u5206\u79bb\u5f53\u65f6\u6574\u4e2a\u6280\u672f\u65b9\u6848\u4e5f\u662f\u7531\u6211\u6765\u8d1f\u8d23\u6574\u7406\uff0c\u63a2\u7d22\uff0c\u5982\u4f55\u8ba9\u6574\u4e2a\u56e2\u961f\u66f4\u9ad8\u6548\u7684\u5f00\u53d1\uff0c\u5b8c\u6210\u81ea\u5df1\u7684\u672c\u804c\u5de5\u4f5c.\u4ece\u4e00\u5f00\u59cb\u7684jsonp\uff0c\u5230\u540e\u9762nginx\u53cd\u5411\u4ee3\u7406\uff0c\u8fd9\u91cc\u9762\u6211\u4e5f\u6536\u83b7\u4e86\u5f88\u591a\u4e1c\u897f\uff0c\u4e5f\u5199\u4e86\u4e00\u4e9b\u76f8\u5173\u7684\u535a\u5ba2\u603b\u7ed3\uff0c \u4f46\u6700\u8ba9\u4eba\u5934\u75bc\u7684\u8fd8\u662f\u524d\u540e\u7aef\u5982\u4f55\u9488\u5bf9\u63a5\u53e3\u6765\u5bf9\u63a5\uff0c\u5f53\u65f6\u627e\u4e86\u5f88\u591a\u89e3\u51b3\u65b9\u6848\uff0c\u4e00\u5f00\u59cb\u4f7f\u7528\u7684\u662f\u53eb apidocs \u7684\uff0c\u6709\u4e9b\u7c7b\u4f3c\u4e8e\u5199java\u7684\u6ce8\u91ca\uff0c\u4f7f\u7528\u8d77\u6765\u8fd8\u662f\u4e0d\u9519\u7684\uff0c\u4e0d\u8fc7\u6ca1\u6709\u5728\u7ebf\u751f\u6210\u7684\uff0c\u6587\u6863\u5199\u5b8c\u540e\u9700\u8981\u5355\u72ec\u547d\u4ee4\u6765\u751f\u6210\u4e00\u4e2a\u6587\u6863\uff0c\u633a\u9ebb\u70e6\uff0c\u540e\u6765\u5c31\u653e\u5f03\u4e86 \u6700\u7ec8\u5c31\u8003\u8651\u4f7f\u7528swagger\u6765\u505a\u6587\u6863\u7684\u8fd9\u5757\uff0c\u4f46swagger\u5927\u5bb6\u90fd\u77e5\u9053\uff0cswagger\u7684ui\u867d\u7136\u80fd\u628a\u6587\u6863\u8bf4\u6e05\u695a\uff0c\u4f46\u662f\u4e0d\u600e\u4e48\u597d\u7528\uff0c\u53ef\u80fd\u4e0d\u9002\u5408\u6211\u4eec\u56fd\u4eba\u7684\u773c\u5149\u5427\uff0c\u81f3\u5c11\u6211\u662f\u8fd9\u4e48\u8ba4\u4e3a\u7684\uff0c\u6240\u4ee5\u5f53\u65f6\u4e5f\u5c31\u60f3\u770b\u770bswagger\u7684\u751f\u6210\u65b9\u5f0f\uff0cswagger-bootstrap-ui\u5c31\u56e0\u6b64\u8bde\u751f\u4e86 \u8fd9\u91cc\u8c08\u8c08swagger\uff0c\u867d\u7136\u5f88\u591a\u4eba\u55b7\u4ed6\uff0c\u4e0d\u597d\u7528\uff0c\u57fa\u4e8e\u6ce8\u89e3\uff0c\u4ee3\u7801\u5165\u4fb5\u5f88\u5f3a\uff0c\u7b49\u7b49 \u5f88\u591a\u539f\u56e0\u3002\u4f46\u603b\u4f53\u6765\u770b\uff0cswagger\u53d1\u5c55\u81f3\u4eca\uff0c\u5305\u62ec\u5728\u5404\u4e2a\u8bed\u8a00\uff0cnodeJs\u3001.net\u3001java\u3001php\u7b49\u7b49\uff0c\u5b83\u53ef\u4ee5\u8bf4\u662f\u4e00\u4e2a\u6709\u4e9b\u63a5\u53e3\u89c4\u8303\u7684\u4e1c\u897f\uff0c\u4ece\u5f00\u59cb\uff0c\u5230\u4e00\u6b65\u6b65\u89c4\u8303\uff0c\u5176\u5b9e\u662f\u4e00\u4e2a\u5f88\u8270\u96be\u7684\u8fc7\u7a0b\uff0c\u4efb\u4f55\u4e8b\u7269\uff0c\u90fd\u4e0d\u662f\u5c3d\u5584\u5c3d\u7f8e\u7684\uff0cswagger\u4e5f\u662f\u4e00\u6837\uff0c\u81f3\u5c11\u5b83\u7ed9\u8fd9\u4e48\u591a\u8bed\u8a00\u63d0\u4f9b\u4e86\u4e00\u79cd\u6587\u6863\u751f\u6210\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u5176\u4ef7\u503c\u5c31\u8fdc\u8d85\u5b83\u672c\u8eab\u7684\u7f3a\u70b9 \u5728Java\u91cc\u9762\uff0c\u662fspringfox\u5b9e\u73b0\u4e86swagger\u7684\u63a5\u53e3\u65b9\u5f0f\uff0c\u5176\u4ed6\u8bed\u8a00\u4e5f\u7c7b\u4f3c. \u9119\u4eba\u4e00\u76f4\u89c9\u5f97\u5982\u679c\u524d\u9762\u6709\u4eba\u5f00\u53d1\u51fa\u6765\u8fd9\u4e2a\u4e1c\u897f\uff0c\u800c\u4e14\u7528\u6237\u8303\u56f4\uff0c\u7a33\u5b9a\u6027\u90fd\u76f8\u5bf9\u8f83\u9ad8\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u4e1c\u897f\u4e00\u5b9a\u662f\u6709\u4ed6\u7684\u610f\u4e49\u5b58\u5728\u7684\uff0c\u7ad9\u5728\u5de8\u4eba\u7684\u80a9\u8180\u4e0a\uff0c\u505a\u6b63\u786e\u7684\u4e8b\uff0c\u4e00\u76f4\u662f\u6211\u8ba4\u4e3a\u7b26\u5408\u5b9e\u9645\u60c5\u51b5\u7684,\u8d77\u7801\u4f60\u4e0d\u7528\u81ea\u5df1\u586b\u5751\uff0c\u56e0\u4e3a\uff0c\u505a\u5f00\u6e90\uff0c\u4e00\u4e2a\u60f3\u6cd5\u5728\u5f53\u65f6\uff0c\u53ef\u80fd\u6bd4\u8f83\u65b0\u9896\uff0c\u5173\u6ce8\u5ea6\u5f88\u9ad8\uff0c\u4f46\u662f\u6211\u60f3\uff0c\u5927\u90e8\u5206\u4eba\u90fd\u9003\u79bb\u4e0d\u4e86\u60f0\u6027\uff0c\u7f3a\u5c11\u7684\u662f\u6301\u4e4b\u4ee5\u6052\uff0c\u7279\u522b\u662f\u5728\u4e2d\u56fd\uff0c\u5f88\u591a\u5f00\u6e90\u5176\u5b9e\u90fd\u662f\u4e2a\u4eba\u5728\u505a\uff08\u5305\u62ec\u6211\u81ea\u5df1\u7684\u8fd9\u4e2aswagger-bootstrap-ui\uff09\uff0c\u610f\u8bc6\u4e0a\uff0c\u76f8\u5bf9\u56fd\u5916\u8fd8\u662f\u6bd4\u8f83\u8584\u5f31\u7684,\u800c\u4e14\u8fd8\u6709\u7cbe\u529b\uff0c\u9532\u800c\u4e0d\u820d\uff0c\u4efb\u91cd\u800c\u9053\u8fdc\u77e3~\uff01 \u6240\u4ee5\uff0cswagger-bootstrap-ui\u4ec5\u4ec5\u53ea\u662f\u4e00\u4e2aui\u5305\uff0c\u91cc\u9762\u4e0d\u5305\u62ec\u4efb\u4f55Java\u4ee3\u7801\uff0c\u57fa\u4e8eswagger\uff0c\u5e0c\u671b\u4e3aswagger\u7684\u751f\u6001\u53d1\u5c55\u505a\u4e00\u4efd\u8d21\u732e\u3002 swagger-bootstrap-ui\u5f00\u6e90\u81f3\u4eca\u4e5f\u6709\u4e00\u5e744\u6708\u6709\u4f59\u4e86\uff0c\u4e3a\u81ea\u5df1\u4e00\u76f4\u575a\u6301\u4e0b\u6765\u6253call\uff0c\u4e5f\u4f1a\u4e00\u76f4\u575a\u6301\u4e0b\u53bb\uff0c\u7ee7\u7eed\u7ef4\u62a4\u5b83\uff0c\u4e1c\u897f\u867d\u5c0f,\u4f46\u575a\u6301\u4e0b\u53bb\u603b\u4f1a\u6709\u6536\u83b7. http://localhost:9001/doc.html \u6269\u5c55\uff1a\u5982\u4f55\u5c06swagger\u548cknife4j\u96c6\u6210\u5230\u6240\u6709\u7684\u9879\u76ee\u4e2d\u800c\u4e0d\u9700\u8981\u5355\u72ec\u7f16\u5199\u914d\u7f6e\u7c7b\uff1f \u00b6 \u5728common\u5de5\u7a0b\u4e2dresources\u4e0b\u6dfb\u52a0\u6587\u4ef6META-INF/spring.factories\uff1a \u7f16\u5199\u5185\u5bb9\uff1a # Auto Configure org.springframework.boot.autoconfigure.EnableAutoConfiguration = \\ com.heima.common.knife4j.Swagger2Configuration \u63a5\u4e0b\u6765\u7f16\u5199com.heima.common.knife4j.Swagger2Configuration package com.heima.common.knife4j ; import com.github.xiaoymin.knife4j.spring.annotations.EnableKnife4j ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; import org.springframework.context.annotation.Import ; import springfox.bean.validators.configuration.BeanValidatorPluginsConfiguration ; import springfox.documentation.builders.ApiInfoBuilder ; import springfox.documentation.builders.PathSelectors ; import springfox.documentation.builders.RequestHandlerSelectors ; import springfox.documentation.service.ApiInfo ; import springfox.documentation.spi.DocumentationType ; import springfox.documentation.spring.web.plugins.Docket ; import springfox.documentation.swagger2.annotations.EnableSwagger2 ; @Configuration @EnableSwagger2 @EnableKnife4j @Import ( BeanValidatorPluginsConfiguration . class ) public class Swagger2Configuration { @Bean ( value = \"defaultApi2\" ) public Docket defaultApi2 () { Docket docket = new Docket ( DocumentationType . SWAGGER_2 ) . apiInfo ( apiInfo ()) //\u5206\u7ec4\u540d\u79f0 . groupName ( \"1.0\" ) . select () //\u8fd9\u91cc\u6307\u5b9aController\u626b\u63cf\u5305\u8def\u5f84 . apis ( RequestHandlerSelectors . basePackage ( \"com.heima\" )) . paths ( PathSelectors . any ()) . build (); return docket ; } private ApiInfo apiInfo () { return new ApiInfoBuilder () . title ( \"\u9ed1\u9a6c\u5934\u6761API\u6587\u6863\" ) . description ( \"\u9ed1\u9a6c\u5934\u6761API\u6587\u6863\" ) . version ( \"1.0\" ) . build (); } } 19-\u9891\u9053\u7ba1\u7406-\u65b0\u589e 07:59 \u00b6 @Override public ResponseResult insert ( AdChannel adChannel ) { //1.\u68c0\u67e5\u53c2\u6570 if ( null == adChannel ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u4fdd\u5b58 adChannel . setCreatedTime ( new Date ()); save ( adChannel ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } 20-\u9891\u9053\u7ba1\u7406-\u4fee\u6539 05:13 \u00b6 @Override public ResponseResult update ( AdChannel adChannel ) { //1.\u68c0\u67e5\u53c2\u6570 if ( null == adChannel || adChannel . getId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u4fee\u6539 updateById ( adChannel ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } 21-\u9891\u9053\u7ba1\u7406-\u5220\u9664 05:55 \u00b6 @Override public ResponseResult deleteById ( Integer id ) { //1.\u68c0\u67e5\u53c2\u6570 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u5224\u65ad\u5f53\u524d\u9891\u9053\u662f\u5426\u5b58\u5728 \u548c \u662f\u5426\u6709\u6548 AdChannel adChannel = getById ( id ); if ( adChannel == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST ); } if ( adChannel . getStatus ()){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID , \"\u9891\u9053\u6709\u6548\u4e0d\u80fd\u5220\u9664\" ); } // int i = 10/0; //3.\u5220\u9664\u9891\u9053 removeById ( id ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); }","title":"day01"},{"location":"hmtt/day01/#01-_0527","text":"","title":"01-\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u8bfe\u7a0b\u89c4\u5212 05:27"},{"location":"hmtt/day01/#02-_0134","text":"\u80fd\u591f\u63cf\u8ff0\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u6709\u54ea\u4e9b\u4e1a\u52a1 \u80fd\u591f\u4e86\u89e3\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u4f7f\u7528\u5230\u4ec0\u4e48\u6280\u672f \u80fd\u591f\u4e86\u89e3\u9ed1\u9a6c\u5934\u6761\u6570\u636e\u5e93\u8bbe\u8ba1\u8fc7\u7a0b \u80fd\u591f\u638c\u63e1\u521d\u59cb\u5316\u5de5\u7a0b\u7684\u642d\u5efa \uff08\u89c6\u9891\u8001\u5e08\u3001\u7b80\u5316\uff09 \u80fd\u591f\u638c\u63e1\u63a5\u53e3\u5f00\u53d1\u7684\u6d41\u7a0b \u80fd\u591f\u5b8c\u6210\u9891\u9053\u7ba1\u7406\u7684\u529f\u80fd\u5f00\u53d1 \u80fd\u591f\u638c\u63e1\u4f7f\u7528\u63a5\u53e3swagger\u3001postman\u3001knife4j \u521d\u59cb\u5316\u5de5\u7a0b\u7684\u642d\u5efa,\u4f18\u5316\u653e\u5728\u8d44\u6599\uff0cday01\\\u8d44\u6599\\\u521d\u59cb\u5de5\u7a0b\\\u4fee\u6539\u540e","title":"02-\u4eca\u65e5\u76ee\u6807 01:34"},{"location":"hmtt/day01/#03-_0519","text":"\u968f\u7740\u667a\u80fd\u624b\u673a\u7684\u666e\u53ca\uff0c\u4eba\u4eec\u66f4\u52a0\u4e60\u60ef\u4e8e\u901a\u8fc7\u624b\u673a\u6765\u770b\u65b0\u95fb\u3002\u7531\u4e8e\u751f\u6d3b\u8282\u594f\u7684\u52a0\u5feb\uff0c\u5f88\u591a\u4eba\u53ea\u80fd\u5229\u7528\u788e\u7247\u65f6\u95f4\u6765\u83b7\u53d6\u4fe1\u606f\uff0c\u56e0\u6b64\uff0c\u5bf9\u4e8e\u79fb\u52a8\u8d44\u8baf\u5ba2\u6237\u7aef\u7684\u9700\u6c42\u4e5f\u8d8a\u6765\u8d8a\u9ad8\u3002\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u6b63\u662f\u5728\u8fd9\u6837\u80cc\u666f\u4e0b\u5f00\u53d1\u51fa\u6765\u3002\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u91c7\u7528\u5f53\u4e0b\u706b\u70ed\u7684\u5fae\u670d\u52a1+\u5927\u6570\u636e\u6280\u672f\u67b6\u6784\u5b9e\u73b0\u3002\u672c\u9879\u76ee\u4e3b\u8981\u7740\u624b\u4e8e\u83b7\u53d6\u6700\u65b0\u6700\u70ed\u65b0\u95fb\u8d44\u8baf\uff0c\u901a\u8fc7\u5927\u6570\u636e\u5206\u6790\u7528\u6237\u559c\u597d\u7cbe\u786e\u63a8\u9001\u54a8\u8be2\u65b0\u95fb","title":"03-\u80cc\u666f\u53ca\u6982\u8ff0 05:19"},{"location":"hmtt/day01/#_1","text":"\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u662f\u5bf9\u5728\u7ebf\u6559\u80b2\u5e73\u53f0\u4e1a\u52a1\u8fdb\u884c\u5927\u6570\u636e\u7edf\u8ba1\u5206\u6790\u7684\u7cfb\u7edf\u3002\u788e\u7247\u5316\u3001\u5207\u6362\u9891\u7e41\u3001\u793e\u4ea4\u5316\u548c\u4e2a\u6027\u5316\u73b0\u5982\u4eca\u6210\u4e3a\u4eba\u4eec\u9605\u8bfb\u884c\u4e3a\u7684\u6807\u7b7e\u3002\u9ed1\u9a6c\u5934\u6761\u5bf9\u6d77\u91cf\u4fe1\u606f\u8fdb\u884c\u641c\u96c6\uff0c\u901a\u8fc7\u7cfb\u7edf\u8ba1\u7b97\u5206\u7c7b\uff0c\u5206\u6790\u7528\u6237\u7684\u5174\u8da3\u8fdb\u884c\u63a8\u9001\u4ece\u800c\u6ee1\u8db3\u7528\u6237\u7684\u9700\u6c42\u3002","title":"\u9879\u76ee\u6982\u8ff0"},{"location":"hmtt/day01/#_2","text":"\u9879\u76ee\uff1a\u6cdb\u6307\u9ed1\u9a6c\u5934\u6761\u6574\u4e2a\u9879\u76ee\u6216\u67d0\u4e00\u9879\u76ee\u6a21\u5757 \u5de5\u7a0b\uff1a\u6cdb\u6307\u9ed1\u9a6c\u5934\u6761\u67d0\u4e00\u9879\u76ee\u7684\u6e90\u7801\u5de5\u7a0b \u7528\u6237\uff1a\u6cdb\u6307\u9ed1\u9a6c\u5934\u6761APP\u7528\u6237\u7aef\u7528\u6237 \u81ea\u5a92\u4f53\u4eba\uff1a\u6cdb\u6307\u901a\u8fc7\u9ed1\u9a6c\u81ea\u5a92\u4f53\u7cfb\u7edf\u53d1\u9001\u6587\u7ae0\u7684\u7528\u6237 \u7ba1\u7406\u5458\uff1a\u6cdb\u6307\u9ed1\u9a6c\u5934\u6761\u7ba1\u7406\u7cfb\u7edf\u7684\u4f7f\u7528\u7528\u6237 App\uff1a\u6cdb\u6307\u9ed1\u9a6c\u5934\u6761APP WeMedia\uff1a\u6cdb\u6307\u9ed1\u9a6c\u5934\u6761\u81ea\u5a92\u4f53\u7cfb\u7edf Admin\uff1a\u6cdb\u6307\u9ed1\u9a6c\u5934\u6761\u7ba1\u7406\u7cfb\u7edf","title":"\u9879\u76ee\u672f\u8bed\u5b9a\u4e49"},{"location":"hmtt/day01/#04-_1121","text":"day01\\\u8d44\u6599\\\u9879\u76ee\u539f\u578b-HTML(\u4f7f\u7528\u706b\u72d0\u6d4f\u89c8\u5668\u6253\u5f00)\\\u9879\u76ee\u539f\u578b-HTML(\u4f7f\u7528\u706b\u72d0\u6d4f\u89c8\u5668\u6253\u5f00)[\u539f\u578b\u56fe]_\u540e\u53f0_\u9ed1\u9a6c\u5934\u6761_V1.0","title":"04-\u529f\u80fd\u9700\u6c42\u8bf4\u660e 11:21"},{"location":"hmtt/day01/#05-_0700","text":"Weex+Vue+WebSocket \uff1a\u4f7f\u7528Weex\u8de8\u5e73\u53f0\u5f00\u53d1\u5de5\u5177\uff0c\u6574\u5408\u96c6\u6210VUE\u6846\u67b6\uff0c\u5b8c\u6210\u9ed1\u9a6c\u5934\u6761\u79fb\u52a8\u7aef\u529f\u80fd\u5f00\u53d1\uff0c\u5e76\u96c6\u6210WebSocket\u5b9e\u73b0\u5373\u65f6\u6d88\u606f\uff08\u6587\u7ae0\u63a8\u8350\u3001\u79c1\u4fe1\uff09\u7684\u63a8\u9001 Vue+Echarts \uff1a \u81ea\u5a92\u4f53\u7cfb\u7edf\u4f7f\u7528Vue\u5f00\u53d1\u5173\u952e\uff0c\u96c6\u6210Echarts\u56fe\u8868\u6846\u67b6\uff0c\u5b8c\u6210\u76f8\u5173\u7c89\u4e1d\u753b\u50cf\u3001\u6570\u636e\u5206\u6790\u7b49\u529f\u80fd Vue+Echarts+WebSocket \uff1a \u7ba1\u7406\u7cfb\u7edf\u4e5f\u662f\u4f7f\u7528Vue\u5f00\u53d1\uff0c\u96c6\u6210Echarts\uff0c\u5b8c\u6210\u7f51\u7ad9\u7edf\u8ba1\u3001\u5185\u5bb9\u7edf\u8ba1\u7b49\u529f\u80fd\uff0c\u96c6\u6210WebSocket\uff0c\u5b9e\u73b0\u7cfb\u7edf\u770b\u677f\u5b9e\u65f6\u6570\u636e\u81ea\u52a8\u5316\u66f4\u65b0 Spring-Cloud-Gateway : \u5fae\u670d\u52a1\u4e4b\u524d\u67b6\u8bbe\u7684\u7f51\u5173\u670d\u52a1\uff0c\u5b9e\u73b0\u670d\u52a1\u6ce8\u518c\u4e2d\u7684API\u8bf7\u6c42\u8def\u7531\uff0c\u4ee5\u53ca\u63a7\u5236\u6d41\u901f\u63a7\u5236\u548c\u7194\u65ad\u5904\u7406\u90fd\u662f\u5e38\u7528\u7684\u67b6\u6784\u624b\u6bb5\uff0c\u800c\u8fd9\u4e9b\u529f\u80fdGateway\u5929\u7136\u652f\u6301 PMD&P3C : \u9759\u6001\u4ee3\u7801\u626b\u63cf\u5de5\u5177\uff0c\u5728\u9879\u76ee\u4e2d\u626b\u63cf\u9879\u76ee\u4ee3\u7801\uff0c\u68c0\u67e5\u5f02\u5e38\u70b9\u3001\u4f18\u5316\u70b9\u3001\u4ee3\u7801\u89c4\u8303\u7b49\uff0c\u4e3a\u5f00\u53d1\u56e2\u961f\u63d0\u4f9b\u89c4\u8303\u7edf\u4e00\uff0c\u63d0\u5347\u9879\u76ee\u4ee3\u7801\u8d28\u91cf Junit : \u5728\u6301\u7eed\u96c6\u6210\u601d\u60f3\u4e2d\uff0c\u5355\u5143\u6d4b\u8bd5\u504f\u5411\u81ea\u52a8\u5316\u8fc7\u7a0b\uff0c\u9879\u76ee\u901a\u8fc7Junit+Maven\u7684\u96c6\u6210\u5b9e\u73b0\u8fd9\u79cd\u8fc7\u7a0b \u8fd0\u7528Spring Boot\u5feb\u901f\u5f00\u53d1\u6846\u67b6\uff0c\u6784\u5efa\u9879\u76ee\u5de5\u7a0b\uff1b\u5e76\u7ed3\u5408Spring Cloud\u5168\u5bb6\u6876\u6280\u672f\uff0c\u5b9e\u73b0\u540e\u7aef\u4e2a\u4eba\u4e2d\u5fc3\u3001\u81ea\u5a92\u4f53\u3001\u7ba1\u7406\u4e2d\u5fc3\u7b49\u5fae\u670d\u52a1\u3002 \u8fd0\u7528WebMagic\u722c\u866b\u6280\u672f\uff0c\u5b8c\u5584\u7cfb\u7edf\u5185\u5bb9\u81ea\u52a8\u5316\u91c7\u96c6 \u8fd0\u7528Kafka\u5b8c\u6210\u5185\u90e8\u7cfb\u7edf\u6d88\u606f\u901a\u77e5\uff1b\u4e0e\u5ba2\u6237\u7aef\u7cfb\u7edf\u6d88\u606f\u901a\u77e5\uff1b\u4ee5\u53ca\u5b9e\u65f6\u6570\u636e\u8ba1\u7b97 \u8fd0\u7528MyCat\u6570\u636e\u5e93\u4e2d\u95f4\u4ef6\u8ba1\u7b97\uff0c\u5bf9\u7cfb\u7edf\u6570\u636e\u8fdb\u884c\u5206\u5e93\u5206\u8868\uff0c\u63d0\u5347\u7cfb\u7edf\u6570\u636e\u5c42\u6027\u80fd \u8fd0\u7528Redis\u7f13\u5b58\u6280\u672f\uff0c\u5b9e\u73b0\u70ed\u6570\u636e\u7684\u8ba1\u7b97\uff0cNoSession\u7b49\u529f\u80fd\uff0c\u63d0\u5347\u7cfb\u7edf\u6027\u80fd\u6307\u6807 \u8fd0\u7528Zoookeeper\u6280\u672f\uff0c\u5b8c\u6210\u5927\u6570\u636e\u8282\u70b9\u4e4b\u540e\u7684\u534f\u8c03\u4e0e\u7ba1\u7406\uff0c\u63d0\u5347\u7cfb\u7edf\u5b58\u50a8\u5c42\u9ad8\u53ef\u7528 \u4f7f\u7528Mysql\u5b58\u50a8\u7528\u6237\u6570\u636e\uff0c\u4ee5\u4fdd\u8bc1\u4e0a\u5c42\u6570\u636e\u67e5\u8be2\u7684\u9ad8\u6027\u80fd \u4f7f\u7528Mongo\u5b58\u50a8\u7528\u6237\u70ed\u6570\u636e\uff0c\u4ee5\u4fdd\u8bc1\u7528\u6237\u70ed\u6570\u636e\u9ad8\u6269\u5c55\u548c\u9ad8\u6027\u80fd\u6307\u6807 \u4f7f\u7528FastDFS\u4f5c\u4e3a\u9759\u6001\u8d44\u6e90\u5b58\u50a8\u5668\uff0c\u5728\u5176\u4e0a\u5b9e\u73b0\u70ed\u9759\u6001\u8d44\u6e90\u7f13\u5b58\u3001\u6dd8\u6c70\u7b49\u529f\u80fd \u8fd0\u7528Habse\u6280\u672f\uff0c\u5b58\u50a8\u7cfb\u7edf\u4e2d\u7684\u51b7\u6570\u636e\uff0c\u4fdd\u8bc1\u7cfb\u7edf\u6570\u636e\u7684\u53ef\u9760\u6027 \u8fd0\u7528ES\u641c\u7d22\u6280\u672f\uff0c\u5bf9\u51b7\u6570\u636e\u3001\u6587\u7ae0\u6570\u636e\u5efa\u7acb\u7d22\u5f15\uff0c\u4ee5\u4fdd\u8bc1\u51b7\u6570\u636e\u3001\u6587\u7ae0\u67e5\u8be2\u6027\u80fd \u8fd0\u7528Sqoop\u3001Kettle\u7b49\u5de5\u5177\uff0c\u5b9e\u73b0\u5927\u6570\u636e\u7684\u79bb\u7ebf\u5165\u4ed3\uff1b\u6216\u8005\u6570\u636e\u5907\u4efd\u5230Hadoop \u8fd0\u7528Spark+Hive\u8fdb\u884c\u79bb\u7ebf\u6570\u636e\u5206\u6790\uff0c\u5b9e\u73b0\u7cfb\u7edf\u4e2d\u5404\u7c7b\u7edf\u8ba1\u62a5\u8868 \u8fd0\u7528Spark Streaming + Hive+Kafka\u5b9e\u73b0\u5b9e\u65f6\u6570\u636e\u5206\u6790\u4e0e\u5e94\u7528\uff1b\u6bd4\u5982\u6587\u7ae0\u63a8\u8350 \u8fd0\u7528Neo4j\u77e5\u8bc6\u56fe\u8c31\u6280\u672f\uff0c\u5206\u6790\u6570\u636e\u5173\u7cfb\uff0c\u4ea7\u51fa\u77e5\u8bc6\u7ed3\u679c\uff0c\u5e76\u5e94\u7528\u5230\u4e0a\u5c42\u4e1a\u52a1\u4e2d\uff0c\u4ee5\u5e2e\u52a9\u7528\u6237\u3001\u81ea\u5a92\u4f53\u3001\u8fd0\u8425\u6548\u679c/\u80fd\u529b\u63d0\u5347\u3002\u6bd4\u5982\u7c89\u4e1d\u7b49\u7ea7\u8ba1\u7b97 \u8fd0\u7528AI\u6280\u672f\uff0c\u6765\u5b8c\u6210\u7cfb\u7edf\u81ea\u52a8\u5316\u529f\u80fd\uff0c\u4ee5\u63d0\u5347\u6548\u7387\u53ca\u8282\u7701\u6210\u672c\u3002\u6bd4\u5982\u5b9e\u540d\u8ba4\u8bc1\u81ea\u52a8\u5316","title":"05-\u6280\u672f\u67b6\u6784 07:00"},{"location":"hmtt/day01/#06-_1513","text":"day01\\\u8d44\u6599\\\u9ed1\u9a6c\u5934\u6761-\u6570\u636e\u5e93\u89c4\u8303\u8bbe\u8ba1\u8bf4\u660e\u4e66.md \u5bfc\u5165\uff1aday01\\\u8d44\u6599\\sql\u811a\u672c","title":"06-\u6570\u636e\u5e93\u8bbe\u8ba1 15:13"},{"location":"hmtt/day01/#_3","text":"","title":"\u5197\u4f59\u8bbe\u8ba1\u5982\u4f55\u4fdd\u8bc1\u6570\u636e\u7684\u4e00\u81f4\u6027\uff1a"},{"location":"hmtt/day01/#_4","text":"\u7ebf\u4e0b\u542f\u52a8\u4e00\u4e2a\u79bb\u7ebf\u7684\u626b\u63cf\u5de5\u5177\uff0c\u4e0d\u505c\u7684\u6bd4\u5bf9\u6b63\u8868T1\u548c\u53cd\u8868T2\uff0c\u5982\u679c\u53d1\u73b0\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u5c31\u8fdb\u884c\u8865\u507f\u4fee\u590d\u3002 \u4f18\u70b9 \u6bd4\u8f83\u7b80\u5355\uff0c\u5f00\u53d1\u4ee3\u4ef7\u5c0f \u7ebf\u4e0a\u670d\u52a1\u65e0\u9700\u4fee\u6539\uff0c\u4fee\u590d\u5de5\u5177\u4e0e\u7ebf\u4e0a\u670d\u52a1\u89e3\u8026 \u7f3a\u70b9 \u626b\u63cf\u6548\u7387\u4f4e\uff0c\u4f1a\u626b\u63cf\u5927\u91cf\u7684\u201c\u5df2\u7ecf\u80fd\u591f\u4fdd\u8bc1\u4e00\u81f4\u201d\u7684\u6570\u636e \u7531\u4e8e\u626b\u63cf\u7684\u6570\u636e\u91cf\u5927\uff0c\u626b\u63cf\u4e00\u8f6e\u7684\u65f6\u95f4\u6bd4\u8f83\u957f\uff0c\u5373\u6570\u636e\u5982\u679c\u4e0d\u4e00\u81f4\uff0c\u4e0d\u4e00\u81f4\u7684\u65f6\u95f4\u7a97\u53e3\u6bd4\u8f83\u957f","title":"\u65b9\u6cd5\u4e00\uff1a\u7ebf\u4e0b\u626b\u63cf\u6b63\u53cd\u5197\u4f59\u8868\u5168\u90e8\u6570\u636e"},{"location":"hmtt/day01/#_5","text":"\u8fd9\u6b21\u4e0d\u662f\u5199\u65e5\u5fd7\u4e86\uff0c\u800c\u662f\u5411\u6d88\u606f\u603b\u7ebf\u53d1\u9001\u6d88\u606f\uff1b\u8fd9\u6b21\u4e0d\u662f\u9700\u8981\u4e00\u4e2a\u5468\u671f\u626b\u63cf\u7684\u79bb\u7ebf\u5de5\u5177\u4e86\uff0c\u800c\u662f\u4e00\u4e2a\u5b9e\u65f6\u8ba2\u9605\u6d88\u606f\u7684\u670d\u52a1\u4e0d\u505c\u7684\u6536\u6d88\u606f\u3002 \u4f18\u70b9 \u6548\u7387\u9ad8 \u5b9e\u65f6\u6027\u9ad8 \u7f3a\u70b9 \u65b9\u6848\u6bd4\u8f83\u590d\u6742\uff0c\u4e0a\u7ebf\u5f15\u5165\u4e86\u6d88\u606f\u603b\u7ebf\u8fd9\u4e2a\u7ec4\u4ef6 \u7ebf\u4e0b\u591a\u4e86\u4e00\u4e2a\u8ba2\u9605\u603b\u7ebf\u7684\u68c0\u6d4b\u670d\u52a1","title":"\u65b9\u6cd5\u4e8c\uff1a\u5b9e\u65f6\u7ebf\u4e0a\u201c\u6d88\u606f\u5bf9\u201d\u68c0\u6d4b"},{"location":"hmtt/day01/#07-_0818","text":"heima-leadnews-common : \u662f\u6574\u4e2a\u5de5\u7a0b\u7684\u914d\u7f6e\u6838\u5fc3\uff0c\u5305\u62ec\u6240\u6709\u96c6\u6210\u4e09\u65b9\u6846\u67b6\u7684\u914d\u7f6e\u5b9a\u4e49\uff0c\u6bd4\u5982redis\u3001kafka\u7b49\u3002\u9664\u6b64\u4e4b\u5916\u8fd8\u5305\u62ec\u9879\u76ee\u6bcf\u4e2a\u6a21\u5757\u53ca\u6574\u4e2a\u9879\u76ee\u7684\u5e38\u91cf\u5b9a\u4e49; heima-leadnews-model \uff1a\u9879\u76ee\u4e2d\u7528\u5230\u7684Dto\u3001Pojo\u3001Mapper\u3001Enums\u5b9a\u4e49\u5de5\u7a0b; heima-leadnews-utils : \u5de5\u7a0b\u516c\u7528\u5de5\u5177\u7c7b\u9879\u76ee\uff0c\u5305\u542b\u52a0\u5bc6/\u89e3\u5bc6\u3001Date\u3001JSON\u7b49\u5de5\u5177\u7c7b; heima-leadnew-apis : \u6574\u4e2a\u9879\u76ee\u5fae\u670d\u52a1\u66b4\u9732\u7684\u63a5\u53e3\u7684\u5b9a\u4e49\u9879\u76ee\uff0c\u6309\u6bcf\u4e2a\u6a21\u5757\u8fdb\u884c\u5b50\u5305\u62c6\u5206;","title":"07-\u521d\u59cb\u5316\u5de5\u7a0b\u5bfc\u5165\u53ca\u73af\u5883\u8bf4\u660e  08:18"},{"location":"hmtt/day01/#08-_1126","text":"\u524d\u540e\u7aef\u5206\u79bb\u7684\"\u524d\"\u7279\u6307\u6d4f\u89c8\u5668\u7aef(\u6216\u5ba2\u6237\u7aef)\u3002 Java\u670d\u52a1\u5668\u7aef\u521d\u5b66\u8005\u6700\u5bb9\u6613\u5f15\u8d77\u8bef\u89e3\u7684\u4e00\u4e2a\u6982\u5ff5\u5c31\u662f: JSP\u662f\u524d\u7aef\u6280\u672f\u3002 JSP\u4e00\u5b9a\u4e00\u5b9a\u4e00\u5b9a\u8981\u77e5\u9053\u5168\u79f0\uff1aJava Server Page\u3002\u662f\u8fd0\u884c\u5728\u670d\u52a1\u5668\u7aefJVM\u4e4b\u4e0aServlet\u5bb9\u5668\u91cc\u7684\uff0c\u53ea\u662f\u6267\u884c\u7684\u7ed3\u679c\u662fHTML\uff0c\u54cd\u5e94\u7ed9\u6d4f\u89c8\u5668\u3002 Java EE\u5148\u6709\u7684Servlet\uff0c\u90a3\u65f6\u5019\u5df2\u7ecf\u6709\u4e86ASP(\u540c\u6837\u8981\u77e5\u9053\u662fActive Server Page\u7684\u610f\u601d)\u3002 \u7531\u4e8e\u8981\u5728Servlet\u91cc\u9762\u62fc\u5927\u91cf\u7684HTML\u4ee3\u7801\uff0c\u6240\u4ee5Java\u89c4\u8303\u5b66\u4e60\u4e86ASP\uff0c\u63d0\u51faJSP\u3002Servlet\u662fJava\u4ee3\u7801\u91cc\u6df7\u5165HTML\uff0cJSP\u662fHTML\u4ee3\u7801\u91cc\u6df7\u5165Java\u3002 \u6d4f\u89c8\u5668\u6839\u672c\u4e0d\u5173\u5fc3\u670d\u52a1\u5668\u7aef\u662fJSP\u3001ASP\u3001PHP\uff0c\u6216\u8005\u8fd8\u662f\u539f\u59cb\u7684Servlet\uff0c \u6216\u662f\u9759\u6001\u670d\u52a1\u5668\u4e0a\u7684HTML \uff0c\u53ea\u8981\u8fd4\u56de\u7684\u662f\u5408\u6cd5\u7684HTML\u5c31\u53ef\u4ee5\u3002 \u6240\u4ee5\uff0c\u628aJSP\u4e2d\u9759\u6001\u7684HTML\u90e8\u5206\u62ff\u51fa\u6765\uff0c\u53d8\u6210\u7b80\u5355\u7684HTML\u6587\u4ef6\uff0c\u653e\u5728HTTP\u670d\u52a1\u5668\u4e0a\uff0c\u6d4f\u89c8\u5668\u53ea\u8981\u83b7\u53d6\u5230\u8fd9\u4e9bHTML\u5c31\u53ef\u4ee5\u4e86\u3002\u52a8\u6001\u7684\u6570\u636e\u90e8\u5206\u7528HTML\u91cc\u7684JS\u901a\u8fc7AJAX\u7684\u65b9\u5f0f\u4ece\u670d\u52a1\u5668\u7aef\u83b7\u53d6\uff0c\u7136\u540e\u52a8\u6001\u64cd\u4f5cDom\uff0c\u5b8c\u6210\u52a8\u6001\u5185\u5bb9\u7684\u5c55\u793a\u3002\u8fd9\u6837\u524d\u540e\u7aef\u5c31\u5206\u79bb\u4e86\u3002 \u9759\u6001\u8d44\u6e90\u548c\u6570\u636e\u63a5\u53e3\u88ab\u90e8\u7f72\u5728\u4e24\u4e2a\u4e0d\u540c\u7684\u670d\u52a1\u4e0a\u5c31\u7b97\u524d\u540e\u7aef\u5206\u79bb\uff1f \u9759\u6001\u8d44\u6e90\u548c\u670d\u52a1(\u5b9e\u73b0\u63a5\u53e3\u7684\u4e1a\u52a1\u903b\u8f91)\uff0c\u5728\u5f00\u53d1\u9636\u6bb5\u5c31\u5206\u79bb\u5f00\u53d1\uff0c\u800c\u90e8\u7f72\u9636\u6bb5\u5206\u79bb\u90e8\u7f72\u5728\u4e0d\u540c\u670d\u52a1\u5668\u4e0a\uff0c\u7b97\u662f\u4e25\u683c\u610f\u4e49\u4e0a\u7684\u524d\u540e\u7aef\u5206\u79bb\u3002 \u6709\u4e9b\u5c0f\u578b\u9879\u76ee\uff0c\u5f00\u53d1\u9636\u6bb5\u6ca1\u6709\u5206\u79bb\u5f00\u53d1\uff0c\u4e5f\u5c31\u662f\u8bf4\u524d\u540e\u7aef\u4ee3\u7801\u5728\u4e00\u4e2aProject\u91cc\u3002\u5728\u90e8\u7f72\u9636\u6bb5\u4e5f\u6ca1\u6709\u5206\u79bb\uff0c\u4f8b\u5982\u9759\u6001\u8d44\u6e90\u8fd8\u662f\u653e\u5728Tomcat\u91cc\u3002\u8fd9\u4e9b\u60c5\u51b5\uff0c\u5230\u5e95\u7b97\u4e0d\u7b97\u524d\u540e\u7aef\u5206\u79bb\uff0c\u5173\u952e\u662f\u662f\u5426\"\u4e25\u683c\"\u770b\u5f85\u3002","title":"08-\u524d\u540e\u7aef\u5206\u79bb\u5f00\u53d1 11:26"},{"location":"hmtt/day01/#09-_0437","text":"\u968f\u7740\u4e1a\u52a1\u7684\u590d\u6742\uff0c\u540c\u4e00\u4e2a\u63a5\u53e3\u53ef\u80fd\u51fa\u73b0\u591a\u4e2a\u7248\u672c\uff0c\u4e3a\u4e86\u65b9\u4fbf\u540e\u671f\u5207\u6362\u548cAB\u6d4b\u8bd5\uff0c\u9700\u8981\u5b9a\u4e49\u63a5\u53e3\u7684\u7248\u672c\u53f7 \u5728\u67d0\u4e00\u4e2a\u5fae\u670d\u52a1\u4e0b\u8bbf\u95eecontroller\u7684\u65f6\u5019\u5728\u5305\u540d\u4e0b\u52a0\u4e00\u4e2a\u7248\u672c\u53f7,\u5982\u4e0b properties com.heima.article.controller.v1 \u5728\u8bbf\u95ee\u5177\u4f53\u7684\u63a5\u53e3\u65b9\u6cd5\u7684url\u6620\u5c04\u7684\u65f6\u5019\u4e5f\u5e94\u8be5\u52a0\u4e0a\u7248\u672c\u8bf4\u660e\uff0c\u5982\u4e0b\uff1a java @RequestMapping ( \"/api/v1/article\" ) \u5bf9\u4e8e\u4e00\u822c\u7684 ABTest \u5b9e\u9a8c\uff0c\u5176\u5b9e\u672c\u8d28\u4e0a\u5c31\u662f\u628a\u5e73\u53f0\u7684\u6d41\u91cf\u5747\u5300\u5206\u4e3a\u51e0\u4e2a\u7ec4\uff0c\u6bcf\u4e2a\u7ec4\u6dfb\u52a0\u4e0d\u540c\u7684\u7b56\u7565\uff0c\u7136\u540e\u6839\u636e\u8fd9\u51e0\u4e2a\u7ec4\u7684\u7528\u6237\u6570\u636e\u6307\u6807\uff0c\u4f8b\u5982\uff1a\u7559\u5b58\u3001\u4eba\u5747\u89c2\u770b\u65f6\u957f\u3001\u57fa\u7840\u4e92\u52a8\u7387\u7b49\u7b49\u6838\u5fc3\u6307\u6807\uff0c\u6700\u7ec8\u9009\u62e9\u4e00\u4e2a\u6700\u597d\u7684\u7ec4\u4e0a\u7ebf\u3002 \u6240\u4ee5\u4f1a\u4fdd\u7559\u591a\u5957\u63a5\u53e3\u7684\u5b9e\u73b0\u6765\u4f5c\u4e3a\u4e0a\u7ebf\u7684\u63a5\u53e3\uff0c\u90a3\u4e48\u524d\u7aef\u5c31\u53ef\u4ee5\u6839\u636e\u7248\u672c\u53f7\uff0c\u627e\u5230\u4e0d\u540c\u7248\u672c\u7684\u63a5\u53e3\u3002","title":"09-\u540e\u7aef\u5f00\u53d1\u901a\u7528\u89c4\u8303 04:37"},{"location":"hmtt/day01/#10-_2351","text":"\u6982\u5ff5\uff1a VO \uff08View Object\uff09\uff1a\u89c6\u56fe\u5bf9\u8c61\uff0c\u7528\u4e8e\u5c55\u793a\u5c42\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u628a\u67d0\u4e2a\u6307\u5b9a\u9875\u9762\uff08\u6216\u7ec4\u4ef6\uff09\u7684\u6240\u6709\u6570\u636e\u5c01\u88c5\u8d77\u6765\u3002 DTO \uff08Data Transfer Object\uff09\uff1a\u6570\u636e\u4f20\u8f93\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u6982\u5ff5\u6765\u6e90\u4e8eJ2EE\u7684\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u539f\u6765\u7684\u76ee\u7684\u662f\u4e3a\u4e86EJB\u7684\u5206\u5e03\u5f0f\u5e94\u7528\u63d0\u4f9b\u7c97\u7c92\u5ea6\u7684\u6570\u636e\u5b9e\u4f53\uff0c\u4ee5\u51cf\u5c11\u5206\u5e03\u5f0f\u8c03\u7528\u7684\u6b21\u6570\uff0c\u4ece\u800c\u63d0\u9ad8\u5206\u5e03\u5f0f\u8c03\u7528\u7684\u6027\u80fd\u548c\u964d\u4f4e\u7f51\u7edc\u8d1f\u8f7d\uff0c\u4f46\u5728\u8fd9\u91cc\uff0c\u6211\u6cdb\u6307\u7528\u4e8e\u5c55\u793a\u5c42\u4e0e\u670d\u52a1\u5c42\u4e4b\u95f4\u7684\u6570\u636e\u4f20\u8f93\u5bf9\u8c61\u3002 DO \uff08Domain Object\uff09\uff1a\u9886\u57df\u5bf9\u8c61\uff0c\u5c31\u662f\u4ece\u73b0\u5b9e\u4e16\u754c\u4e2d\u62bd\u8c61\u51fa\u6765\u7684\u6709\u5f62\u6216\u65e0\u5f62\u7684\u4e1a\u52a1\u5b9e\u4f53\u3002 PO \uff08Persistent Object\uff09\uff1a\u6301\u4e45\u5316\u5bf9\u8c61\uff0c\u5b83\u8ddf\u6301\u4e45\u5c42\uff08\u901a\u5e38\u662f\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff09\u7684\u6570\u636e\u7ed3\u6784\u5f62\u6210\u4e00\u4e00\u5bf9\u5e94\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u5982\u679c\u6301\u4e45\u5c42\u662f\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u90a3\u4e48\uff0c\u6570\u636e\u8868\u4e2d\u7684\u6bcf\u4e2a\u5b57\u6bb5\uff08\u6216\u82e5\u5e72\u4e2a\uff09\u5c31\u5bf9\u5e94PO\u7684\u4e00\u4e2a\uff08\u6216\u82e5\u5e72\u4e2a\uff09\u5c5e\u6027\u3002 \u6a21\u578b\uff1a \u200b \u4e0b\u9762\u4ee5\u4e00\u4e2a\u65f6\u5e8f\u56fe\u5efa\u7acb\u7b80\u5355\u6a21\u578b\u6765\u63cf\u8ff0\u4e0a\u8ff0\u5bf9\u8c61\u5728\u4e09\u5c42\u67b6\u6784\u5e94\u7528\u4e2d\u7684\u4f4d\u7f6e l \u7528\u6237\u53d1\u51fa\u8bf7\u6c42\uff08\u53ef\u80fd\u662f\u586b\u5199\u8868\u5355\uff09\uff0c\u8868\u5355\u7684\u6570\u636e\u5728\u5c55\u793a\u5c42\u88ab\u5339\u914d\u4e3aVO\u3002 l \u5c55\u793a\u5c42\u628aVO\u8f6c\u6362\u4e3a\u670d\u52a1\u5c42\u5bf9\u5e94\u65b9\u6cd5\u6240\u8981\u6c42\u7684DTO\uff0c\u4f20\u9001\u7ed9\u670d\u52a1\u5c42\u3002 l \u670d\u52a1\u5c42\u9996\u5148\u6839\u636eDTO\u7684\u6570\u636e\u6784\u9020\uff08\u6216\u91cd\u5efa\uff09\u4e00\u4e2aDO\uff0c\u8c03\u7528DO\u7684\u4e1a\u52a1\u65b9\u6cd5\u5b8c\u6210\u5177\u4f53\u4e1a\u52a1\u3002 l \u670d\u52a1\u5c42\u628aDO\u8f6c\u6362\u4e3a\u6301\u4e45\u5c42\u5bf9\u5e94\u7684PO\uff08\u53ef\u4ee5\u4f7f\u7528ORM\u5de5\u5177\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u7528\uff09\uff0c\u8c03\u7528\u6301\u4e45\u5c42\u7684\u6301\u4e45\u5316\u65b9\u6cd5\uff0c\u628aPO\u4f20\u9012\u7ed9\u5b83\uff0c\u5b8c\u6210\u6301\u4e45\u5316\u64cd\u4f5c\u3002 l \u5bf9\u4e8e\u4e00\u4e2a\u9006\u5411\u64cd\u4f5c\uff0c\u5982\u8bfb\u53d6\u6570\u636e\uff0c\u4e5f\u662f\u7528\u7c7b\u4f3c\u7684\u65b9\u5f0f\u8f6c\u6362\u548c\u4f20\u9012\uff0c\u7565\u3002 \u5728ResponseResult\u6dfb\u52a0\u65b9\u6cd5 //\u8fd4\u56dedata\u4e3anull\u6210\u529f\u6d88\u606f public static ResponseResult okResult () { ResponseResult result = setAppHttpCodeEnum ( AppHttpCodeEnum . SUCCESS , AppHttpCodeEnum . SUCCESS . getErrorMessage ()); return result ; } \u8c03\u7528\uff1a return ResponseResult . okResult (); dto:\u524d\u7aef\u53c2\u6570\u63a5\u6536 pojo:\u6570\u636e\u5e93\u5b9e\u4f53\u7c7b vo:\u8fd4\u56de\u7ed9\u524d\u7aef\u5b9e\u4f53","title":"10-\u63a5\u53e3\u901a\u7528\u8bf7\u6c42\u548c\u54cd\u5e94 23:51"},{"location":"hmtt/day01/#11-_0515","text":"\u5728\u6bcf\u4e00\u4e2a\u5fae\u670d\u52a1\u7684\u5de5\u7a0b\u4e2d\u7684\u6839\u76ee\u5f55\u4e0b\u521b\u5efa\u4e09\u4e2a\u6587\u4ef6\uff0c\u65b9\u4fbf\u5404\u4e2a\u73af\u5883\u7684\u5207\u6362 \uff081\uff09maven_dev.properties \u5b9a\u4e49\u5f00\u53d1\u73af\u5883\u7684\u914d\u7f6e \uff082\uff09maven_prod.properties \u5b9a\u4e49\u751f\u4ea7\u73af\u5883\u7684\u914d\u7f6e \uff083\uff09maven_test.properties \u5b9a\u4e49\u6d4b\u8bd5\u73af\u5883\u7684\u914d\u7f6e\uff0c\u5f00\u53d1\u9636\u6bb5\u4f7f\u7528\u8fd9\u4e2a\u6d4b\u8bd5\u73af\u5883 \u9ed8\u8ba4\u52a0\u8f7d\u7684\u73af\u5883\u4e3atest\uff0c\u5728\u6253\u5305\u7684\u8fc7\u7a0b\u4e2d\u4e5f\u53ef\u4ee5\u6307\u5b9a\u53c2\u6570\u6253\u5305 package -P test/prod/dev \u5177\u4f53\u914d\u7f6e\uff0c\u8bf7\u67e5\u770b\u7236\u5de5\u7a0b\u4e0b\u7684maven\u63d2\u4ef6\u7684profiles\u914d\u7f6e <profiles> <profile> <id> dev </id> <build> <filters> <filter> maven_dev.properties </filter> </filters> </build> </profile> <profile> <id> test </id> <activation> <activeByDefault> true </activeByDefault> </activation> <build> <filters> <filter> maven_test.properties </filter> </filters> </build> </profile> <profile> <id> prod </id> <build> <filters> <filter> maven_prod.properties </filter> </filters> </build> </profile> </profiles> \u6f14\u793a\uff1a\u591a\u73af\u5883\u5207\u6362 maven_test.properties: profiles.name = test test = a application.yml: test: ${ test } \u6267\u884c\u547d\u4ee4: mvn package -P test \u6253\u5305\u5b8c\u4e4b\u540e\u67e5\u770bjar\u5305\u4e2d\u7684application.yml: test : a \u53ef\u4ee5\u770b\u5230\u91cc\u8fb9\u7684\u5360\u4f4d\u7b26\u5df2\u7ecf\u88ab\u66ff\u6362\u4e3a\u4e86a","title":"11-\u591a\u73af\u5883\u5207\u6362 05:15"},{"location":"hmtt/day01/#12-_0444","text":"","title":"12-\u9891\u9053\u7ba1\u7406\u9700\u6c42\u5206\u6790 04:44"},{"location":"hmtt/day01/#13-_0911","text":"DAO\u5c42\u76f8\u5173\u4f9d\u8d56\uff0c\u5728model\u5de5\u7a0b\u4e2d\u5df2\u7ecf\u5f15\u5165 logback.xml\u4e2d\u7684\u65e5\u5fd7\u6587\u4ef6\u4f4d\u7f6e\u8bb0\u5f97\u6539\uff0c\u5426\u5219\u65e0\u6cd5\u542f\u52a8","title":"13-\u5fae\u670d\u52a1\u642d\u5efa 09:11"},{"location":"hmtt/day01/#14-_0822","text":"","title":"14-\u63a5\u53e3\u5b9a\u4e49 08:22"},{"location":"hmtt/day01/#15-_1218","text":"public ResponseResult findByNameAndPage ( ChannelDto dto ) { //1.\u53c2\u6570\u68c0\u6d4b\uff0c\u8fd9\u4e00\u6b65\u4e3b\u8981\u8fd8\u662f\u9632\u6b62\u53c2\u6570\u4e0d\u662f\u4ececontroller\u4f20\u8fdb\u6765\u7684 if ( dto == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //\u5206\u9875\u53c2\u6570\u68c0\u67e5 dto . checkParam (); //2.\u5b89\u88c5\u540d\u79f0\u6a21\u7cca\u5206\u9875\u67e5\u8be2 Page page = new Page ( dto . getPage (), dto . getSize ()); LambdaQueryWrapper < AdChannel > lambdaQueryWrapper = new LambdaQueryWrapper (); if ( StringUtils . isNotBlank ( dto . getName ())){ //where name like '%abc%' //\u53c2\u65701\uff1a\u4f7f\u7528\u51fd\u6570\u5f0f\u63a5\u53e3AdChannel::getName\u6307\u5b9a\u5c5e\u6027\uff0cmybatis-plus\u4f1a\u4ece\u5c5e\u6027\u4e0a\u53cd\u5c04\u51fa\u5b57\u6bb5\u540d //\u53c2\u65702:like\u7684\u503c lambdaQueryWrapper . like ( AdChannel :: getName , dto . getName ()); } IPage result = page ( page , lambdaQueryWrapper ); //3.\u7ed3\u679c\u5c01\u88c5 ResponseResult responseResult = new PageResponseResult ( dto . getPage (), dto . getSize (),( int ) result . getTotal ()); responseResult . setData ( result . getRecords ()); return responseResult ; }","title":"15-\u529f\u80fd\u5b9e\u73b0 12:18"},{"location":"hmtt/day01/#16-postman_0610","text":"","title":"16-postman 06:10"},{"location":"hmtt/day01/#17-swagger_0945","text":"package com.heima.admin.config ; import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; import springfox.documentation.builders.ApiInfoBuilder ; import springfox.documentation.builders.PathSelectors ; import springfox.documentation.builders.RequestHandlerSelectors ; import springfox.documentation.service.ApiInfo ; import springfox.documentation.service.Contact ; import springfox.documentation.spi.DocumentationType ; import springfox.documentation.spring.web.plugins.Docket ; import springfox.documentation.swagger2.annotations.EnableSwagger2 ; @Configuration @EnableSwagger2 public class SwaggerConfiguration { @Bean public Docket buildDocket () { return new Docket ( DocumentationType . SWAGGER_2 ) . apiInfo ( buildApiInfo ()) . select () // \u8981\u626b\u63cf\u7684API(Controller)\u57fa\u7840\u5305 . apis ( RequestHandlerSelectors . basePackage ( \"com.heima\" )) . paths ( PathSelectors . any ()) . build (); } private ApiInfo buildApiInfo () { Contact contact = new Contact ( \"\u9ed1\u9a6c\u7a0b\u5e8f\u5458\" , \"\" , \"\" ); return new ApiInfoBuilder () . title ( \"\u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863\" ) . description ( \"\u5e73\u53f0\u7ba1\u7406\u670d\u52a1api\" ) . contact ( contact ) . version ( \"1.0.0\" ). build (); } } \u8bbf\u95ee\u5730\u5740\uff1ahttp://localhost:9001/swagger-ui.html","title":"17-swagger 09:45"},{"location":"hmtt/day01/#18-knife4j_0554","text":"\u5b98\u65b9\u6587\u6863\uff1a https://doc.xiaominfo.com/guide/useful.html \u9879\u76ee\u80cc\u666f\uff1a \u5927\u6982\u662f\u57282017\u5e744\u6708\u4efd,\u6211\u4eec\u56e2\u961f\u6574\u4e2a\u5f00\u53d1\u65b9\u5f0f\u90fd\u51b3\u5b9a\u4f7f\u7528\u524d\u540e\u7aef\u5206\u79bb\u7684\u65b9\u5f0f\u6765\u5408\u4f5c\u5f00\u53d1,\u524d\u540e\u7aef\u5206\u79bb\u5f53\u65f6\u6574\u4e2a\u6280\u672f\u65b9\u6848\u4e5f\u662f\u7531\u6211\u6765\u8d1f\u8d23\u6574\u7406\uff0c\u63a2\u7d22\uff0c\u5982\u4f55\u8ba9\u6574\u4e2a\u56e2\u961f\u66f4\u9ad8\u6548\u7684\u5f00\u53d1\uff0c\u5b8c\u6210\u81ea\u5df1\u7684\u672c\u804c\u5de5\u4f5c.\u4ece\u4e00\u5f00\u59cb\u7684jsonp\uff0c\u5230\u540e\u9762nginx\u53cd\u5411\u4ee3\u7406\uff0c\u8fd9\u91cc\u9762\u6211\u4e5f\u6536\u83b7\u4e86\u5f88\u591a\u4e1c\u897f\uff0c\u4e5f\u5199\u4e86\u4e00\u4e9b\u76f8\u5173\u7684\u535a\u5ba2\u603b\u7ed3\uff0c \u4f46\u6700\u8ba9\u4eba\u5934\u75bc\u7684\u8fd8\u662f\u524d\u540e\u7aef\u5982\u4f55\u9488\u5bf9\u63a5\u53e3\u6765\u5bf9\u63a5\uff0c\u5f53\u65f6\u627e\u4e86\u5f88\u591a\u89e3\u51b3\u65b9\u6848\uff0c\u4e00\u5f00\u59cb\u4f7f\u7528\u7684\u662f\u53eb apidocs \u7684\uff0c\u6709\u4e9b\u7c7b\u4f3c\u4e8e\u5199java\u7684\u6ce8\u91ca\uff0c\u4f7f\u7528\u8d77\u6765\u8fd8\u662f\u4e0d\u9519\u7684\uff0c\u4e0d\u8fc7\u6ca1\u6709\u5728\u7ebf\u751f\u6210\u7684\uff0c\u6587\u6863\u5199\u5b8c\u540e\u9700\u8981\u5355\u72ec\u547d\u4ee4\u6765\u751f\u6210\u4e00\u4e2a\u6587\u6863\uff0c\u633a\u9ebb\u70e6\uff0c\u540e\u6765\u5c31\u653e\u5f03\u4e86 \u6700\u7ec8\u5c31\u8003\u8651\u4f7f\u7528swagger\u6765\u505a\u6587\u6863\u7684\u8fd9\u5757\uff0c\u4f46swagger\u5927\u5bb6\u90fd\u77e5\u9053\uff0cswagger\u7684ui\u867d\u7136\u80fd\u628a\u6587\u6863\u8bf4\u6e05\u695a\uff0c\u4f46\u662f\u4e0d\u600e\u4e48\u597d\u7528\uff0c\u53ef\u80fd\u4e0d\u9002\u5408\u6211\u4eec\u56fd\u4eba\u7684\u773c\u5149\u5427\uff0c\u81f3\u5c11\u6211\u662f\u8fd9\u4e48\u8ba4\u4e3a\u7684\uff0c\u6240\u4ee5\u5f53\u65f6\u4e5f\u5c31\u60f3\u770b\u770bswagger\u7684\u751f\u6210\u65b9\u5f0f\uff0cswagger-bootstrap-ui\u5c31\u56e0\u6b64\u8bde\u751f\u4e86 \u8fd9\u91cc\u8c08\u8c08swagger\uff0c\u867d\u7136\u5f88\u591a\u4eba\u55b7\u4ed6\uff0c\u4e0d\u597d\u7528\uff0c\u57fa\u4e8e\u6ce8\u89e3\uff0c\u4ee3\u7801\u5165\u4fb5\u5f88\u5f3a\uff0c\u7b49\u7b49 \u5f88\u591a\u539f\u56e0\u3002\u4f46\u603b\u4f53\u6765\u770b\uff0cswagger\u53d1\u5c55\u81f3\u4eca\uff0c\u5305\u62ec\u5728\u5404\u4e2a\u8bed\u8a00\uff0cnodeJs\u3001.net\u3001java\u3001php\u7b49\u7b49\uff0c\u5b83\u53ef\u4ee5\u8bf4\u662f\u4e00\u4e2a\u6709\u4e9b\u63a5\u53e3\u89c4\u8303\u7684\u4e1c\u897f\uff0c\u4ece\u5f00\u59cb\uff0c\u5230\u4e00\u6b65\u6b65\u89c4\u8303\uff0c\u5176\u5b9e\u662f\u4e00\u4e2a\u5f88\u8270\u96be\u7684\u8fc7\u7a0b\uff0c\u4efb\u4f55\u4e8b\u7269\uff0c\u90fd\u4e0d\u662f\u5c3d\u5584\u5c3d\u7f8e\u7684\uff0cswagger\u4e5f\u662f\u4e00\u6837\uff0c\u81f3\u5c11\u5b83\u7ed9\u8fd9\u4e48\u591a\u8bed\u8a00\u63d0\u4f9b\u4e86\u4e00\u79cd\u6587\u6863\u751f\u6210\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u5176\u4ef7\u503c\u5c31\u8fdc\u8d85\u5b83\u672c\u8eab\u7684\u7f3a\u70b9 \u5728Java\u91cc\u9762\uff0c\u662fspringfox\u5b9e\u73b0\u4e86swagger\u7684\u63a5\u53e3\u65b9\u5f0f\uff0c\u5176\u4ed6\u8bed\u8a00\u4e5f\u7c7b\u4f3c. \u9119\u4eba\u4e00\u76f4\u89c9\u5f97\u5982\u679c\u524d\u9762\u6709\u4eba\u5f00\u53d1\u51fa\u6765\u8fd9\u4e2a\u4e1c\u897f\uff0c\u800c\u4e14\u7528\u6237\u8303\u56f4\uff0c\u7a33\u5b9a\u6027\u90fd\u76f8\u5bf9\u8f83\u9ad8\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u4e1c\u897f\u4e00\u5b9a\u662f\u6709\u4ed6\u7684\u610f\u4e49\u5b58\u5728\u7684\uff0c\u7ad9\u5728\u5de8\u4eba\u7684\u80a9\u8180\u4e0a\uff0c\u505a\u6b63\u786e\u7684\u4e8b\uff0c\u4e00\u76f4\u662f\u6211\u8ba4\u4e3a\u7b26\u5408\u5b9e\u9645\u60c5\u51b5\u7684,\u8d77\u7801\u4f60\u4e0d\u7528\u81ea\u5df1\u586b\u5751\uff0c\u56e0\u4e3a\uff0c\u505a\u5f00\u6e90\uff0c\u4e00\u4e2a\u60f3\u6cd5\u5728\u5f53\u65f6\uff0c\u53ef\u80fd\u6bd4\u8f83\u65b0\u9896\uff0c\u5173\u6ce8\u5ea6\u5f88\u9ad8\uff0c\u4f46\u662f\u6211\u60f3\uff0c\u5927\u90e8\u5206\u4eba\u90fd\u9003\u79bb\u4e0d\u4e86\u60f0\u6027\uff0c\u7f3a\u5c11\u7684\u662f\u6301\u4e4b\u4ee5\u6052\uff0c\u7279\u522b\u662f\u5728\u4e2d\u56fd\uff0c\u5f88\u591a\u5f00\u6e90\u5176\u5b9e\u90fd\u662f\u4e2a\u4eba\u5728\u505a\uff08\u5305\u62ec\u6211\u81ea\u5df1\u7684\u8fd9\u4e2aswagger-bootstrap-ui\uff09\uff0c\u610f\u8bc6\u4e0a\uff0c\u76f8\u5bf9\u56fd\u5916\u8fd8\u662f\u6bd4\u8f83\u8584\u5f31\u7684,\u800c\u4e14\u8fd8\u6709\u7cbe\u529b\uff0c\u9532\u800c\u4e0d\u820d\uff0c\u4efb\u91cd\u800c\u9053\u8fdc\u77e3~\uff01 \u6240\u4ee5\uff0cswagger-bootstrap-ui\u4ec5\u4ec5\u53ea\u662f\u4e00\u4e2aui\u5305\uff0c\u91cc\u9762\u4e0d\u5305\u62ec\u4efb\u4f55Java\u4ee3\u7801\uff0c\u57fa\u4e8eswagger\uff0c\u5e0c\u671b\u4e3aswagger\u7684\u751f\u6001\u53d1\u5c55\u505a\u4e00\u4efd\u8d21\u732e\u3002 swagger-bootstrap-ui\u5f00\u6e90\u81f3\u4eca\u4e5f\u6709\u4e00\u5e744\u6708\u6709\u4f59\u4e86\uff0c\u4e3a\u81ea\u5df1\u4e00\u76f4\u575a\u6301\u4e0b\u6765\u6253call\uff0c\u4e5f\u4f1a\u4e00\u76f4\u575a\u6301\u4e0b\u53bb\uff0c\u7ee7\u7eed\u7ef4\u62a4\u5b83\uff0c\u4e1c\u897f\u867d\u5c0f,\u4f46\u575a\u6301\u4e0b\u53bb\u603b\u4f1a\u6709\u6536\u83b7. http://localhost:9001/doc.html","title":"18-knife4j 05:54"},{"location":"hmtt/day01/#swaggerknife4j","text":"\u5728common\u5de5\u7a0b\u4e2dresources\u4e0b\u6dfb\u52a0\u6587\u4ef6META-INF/spring.factories\uff1a \u7f16\u5199\u5185\u5bb9\uff1a # Auto Configure org.springframework.boot.autoconfigure.EnableAutoConfiguration = \\ com.heima.common.knife4j.Swagger2Configuration \u63a5\u4e0b\u6765\u7f16\u5199com.heima.common.knife4j.Swagger2Configuration package com.heima.common.knife4j ; import com.github.xiaoymin.knife4j.spring.annotations.EnableKnife4j ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; import org.springframework.context.annotation.Import ; import springfox.bean.validators.configuration.BeanValidatorPluginsConfiguration ; import springfox.documentation.builders.ApiInfoBuilder ; import springfox.documentation.builders.PathSelectors ; import springfox.documentation.builders.RequestHandlerSelectors ; import springfox.documentation.service.ApiInfo ; import springfox.documentation.spi.DocumentationType ; import springfox.documentation.spring.web.plugins.Docket ; import springfox.documentation.swagger2.annotations.EnableSwagger2 ; @Configuration @EnableSwagger2 @EnableKnife4j @Import ( BeanValidatorPluginsConfiguration . class ) public class Swagger2Configuration { @Bean ( value = \"defaultApi2\" ) public Docket defaultApi2 () { Docket docket = new Docket ( DocumentationType . SWAGGER_2 ) . apiInfo ( apiInfo ()) //\u5206\u7ec4\u540d\u79f0 . groupName ( \"1.0\" ) . select () //\u8fd9\u91cc\u6307\u5b9aController\u626b\u63cf\u5305\u8def\u5f84 . apis ( RequestHandlerSelectors . basePackage ( \"com.heima\" )) . paths ( PathSelectors . any ()) . build (); return docket ; } private ApiInfo apiInfo () { return new ApiInfoBuilder () . title ( \"\u9ed1\u9a6c\u5934\u6761API\u6587\u6863\" ) . description ( \"\u9ed1\u9a6c\u5934\u6761API\u6587\u6863\" ) . version ( \"1.0\" ) . build (); } }","title":"\u6269\u5c55\uff1a\u5982\u4f55\u5c06swagger\u548cknife4j\u96c6\u6210\u5230\u6240\u6709\u7684\u9879\u76ee\u4e2d\u800c\u4e0d\u9700\u8981\u5355\u72ec\u7f16\u5199\u914d\u7f6e\u7c7b\uff1f"},{"location":"hmtt/day01/#19--_0759","text":"@Override public ResponseResult insert ( AdChannel adChannel ) { //1.\u68c0\u67e5\u53c2\u6570 if ( null == adChannel ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u4fdd\u5b58 adChannel . setCreatedTime ( new Date ()); save ( adChannel ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); }","title":"19-\u9891\u9053\u7ba1\u7406-\u65b0\u589e 07:59"},{"location":"hmtt/day01/#20--_0513","text":"@Override public ResponseResult update ( AdChannel adChannel ) { //1.\u68c0\u67e5\u53c2\u6570 if ( null == adChannel || adChannel . getId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u4fee\u6539 updateById ( adChannel ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); }","title":"20-\u9891\u9053\u7ba1\u7406-\u4fee\u6539 05:13"},{"location":"hmtt/day01/#21--_0555","text":"@Override public ResponseResult deleteById ( Integer id ) { //1.\u68c0\u67e5\u53c2\u6570 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u5224\u65ad\u5f53\u524d\u9891\u9053\u662f\u5426\u5b58\u5728 \u548c \u662f\u5426\u6709\u6548 AdChannel adChannel = getById ( id ); if ( adChannel == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST ); } if ( adChannel . getStatus ()){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID , \"\u9891\u9053\u6709\u6548\u4e0d\u80fd\u5220\u9664\" ); } // int i = 10/0; //3.\u5220\u9664\u9891\u9053 removeById ( id ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); }","title":"21-\u9891\u9053\u7ba1\u7406-\u5220\u9664 05:55"},{"location":"hmtt/day02/","text":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 01:20 \u00b6 \u80fd\u591f\u638c\u63e1\u9879\u76ee\u4e2d\u901a\u7528\u5f02\u5e38\u7684\u5904\u7406\u65b9\u5f0f \u80fd\u591f\u4e86\u89e3\u524d\u7aef\u57fa\u7840\u73af\u5883\u642d\u5efa \u80fd\u591f\u5b8c\u6210\u654f\u611f\u8bcd\u7ba1\u7406\u7684\u5f00\u53d1 \u80fd\u591f\u719f\u6089\u5e38\u7528\u5bc6\u7801\u52a0\u5bc6\u65b9\u5f0f \u80fd\u591f\u5b8c\u6210admin\u7aef\u767b\u5f55\u529f\u80fd \u80fd\u591f\u5b8c\u6210nacos\u6ce8\u518c\u4e2d\u5fc3\u7684\u642d\u5efa(windows) 02-\u901a\u7528\u5f02\u5e38\u4ee3\u7801\u7f16\u5199 09:32 \u00b6 package com.heima.common.exception ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import lombok.extern.log4j.Log4j2 ; import org.springframework.web.bind.annotation.ControllerAdvice ; import org.springframework.web.bind.annotation.ExceptionHandler ; import org.springframework.web.bind.annotation.ResponseBody ; @ControllerAdvice //\u63a7\u5236\u5668\u589e\u5f3a @Log4j2 public class ExceptionCatch { //\u6355\u83b7Exception\u6b64\u7c7b\u5f02\u5e38 @ExceptionHandler ( Exception . class ) @ResponseBody public ResponseResult exception ( Exception exception ) { exception . printStackTrace (); //\u8bb0\u5f55\u65e5\u5fd7 log . error ( \"catch exception:{}\" , exception . getMessage ()); //\u8fd4\u56de\u901a\u7528\u5f02\u5e38 return ResponseResult . errorResult ( AppHttpCodeEnum . SERVER_ERROR ); } } \u8be5\u5f02\u5e38\u5904\u7406\u7c7b\u867d\u7136\u6dfb\u52a0\u4e86\uff0c\u4f46\u662f\u65e0\u6cd5\u76f4\u63a5\u88ab\u52a0\u8f7d\uff0c\u9700\u8981\u5728\u5fae\u670d\u52a1\u4e2d\u7f16\u5199\u914d\u7f6e\u7c7b\u4e3b\u52a8\u52a0\u8f7d package com.heima.admin.config ; import org.springframework.context.annotation.ComponentScan ; import org.springframework.context.annotation.Configuration ; @Configuration @ComponentScan ( \"com.heima.common.exception\" ) public class ExceptionCatchConfig { } 03-\u901a\u7528\u5f02\u5e38\u4ee3\u7801\u6d4b\u8bd5 03:38 \u00b6 04-\u524d\u7aef\u76f8\u5173\u77e5\u8bc6 07:38 \u00b6 node.js webpack \uff1a\u627e\u5230JavaScript\u6a21\u5757\u4ee5\u53ca\u5176\u5b83\u7684\u4e00\u4e9b\u6d4f\u89c8\u5668\u4e0d\u80fd\u76f4\u63a5\u8fd0\u884c\u7684\u62d3\u5c55\u8bed\u8a00\uff08Sass\uff0cTypeScript\u7b49\uff09\uff0c\u5e76\u5c06\u5176\u8f6c\u6362\u548c\u6253\u5305\u4e3a\u5408\u9002\u7684\u683c\u5f0f\u4f9b\u6d4f\u89c8\u5668\u4f7f\u7528\u3002\uff08js css\u7b49\uff09 webpack\u57fa\u4e8enode.js\u8fd0\u884c\uff0c\u9996\u5148\u9700\u8981\u5b89\u88c5node.js\u3002(\u987b\u5b89\u88c5) 1.\u5b89\u88c5node-v9.4.0-x64.msi 2. npm install nrm -g --registry=https://registry.npm.taobao.org // \u5b89\u88c5nrm nrm ls // \u67e5\u770b\u955c\u50cf\u6e90 nrm use taobao // \u9009\u62e9\u6dd8\u5b9d\u955c\u50cf\uff0c\u4e5f\u53ef\u4ee5\u9009\u62e9cnpm cnpm\u4e0d\u652f\u6301\u6709\u4e9b\u547d\u4ee4 npm install webpack@3.6.0 -g 05-admin\u524d\u53f0\u7cfb\u7edf\u642d\u5efa 08:45 \u00b6 \u9ad8\u7248\u672c\u4e0b(node 10+)\u542f\u52a8\u62a5\u9519\uff1a 1.npm rebuild node-sass (\u4ecegithub\u4e0a\u53bb\u4e0b\u8f7d\u5bf9\u5e94\u5305) 2.\u91cd\u88c5node \u53ef\u4ee5\u4f7f\u7528vscode\u542f\u52a8\u9879\u76ee 1.\u4f7f\u7528vscode\u6253\u5f00\u524d\u7aef\u6587\u4ef6\u5939\uff08\u6ce8\u610f\u4e00\u5b9a\u8981\u6253\u5f00\u4e4b\u540e\u786e\u8ba4\u5f53\u524d\u6839\u76ee\u5f55\u4e0b\u6709\u6ca1\u6709package.json\uff09 2.\u4e0a\u65b9\u70b9\u51fbterminal-new terminal 3.\u5728\u4e0b\u65b9\u7684\u63a7\u5236\u53f0\u4e2d\u8f93\u5165npm run dev\u542f\u52a8 \u8bbf\u95eehttp://localhost:8080/ 06-\u654f\u611f\u8bcd\u7ba1\u7406-\u9700\u6c42\u5206\u6790\u53ca\u63a5\u53e3\u5b9a\u4e49 05:14 \u00b6 package com.heima.apis.admin ; import com.heima.model.admin.dtos.SensitiveDto ; import com.heima.model.admin.pojos.AdSensitive ; import com.heima.model.common.dtos.ResponseResult ; public interface AdSensitiveControllerApi { /** * \u6839\u636e\u540d\u79f0\u5206\u9875\u67e5\u8be2\u654f\u611f\u8bcd * @param dto * @return */ public ResponseResult list ( SensitiveDto dto ); /** * \u65b0\u589e * @param adSensitive * @return */ public ResponseResult save ( AdSensitive adSensitive ); /** * \u4fee\u6539 * @param adSensitive * @return */ public ResponseResult update ( AdSensitive adSensitive ); /** * \u5220\u9664\u654f\u611f\u8bcd * @param id * @return */ public ResponseResult deleteById ( Integer id ); } 07-\u654f\u611f\u8bcd\u7ba1\u7406-\u5217\u8868\u67e5\u8be2 08:43 \u00b6 @Override public ResponseResult list ( SensitiveDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //\u6821\u9a8cpage size\u5408\u6cd5\u503c dto . checkParam (); //2.\u6839\u636e\u540d\u79f0\u6a21\u7cca\u5206\u9875\u67e5\u8be2 Page page = new Page <> ( dto . getPage (), dto . getSize ()); LambdaQueryWrapper < AdSensitive > lambdaQueryWrapper = new LambdaQueryWrapper (); if ( StringUtils . isNotBlank ( dto . getName ())){ lambdaQueryWrapper . like ( AdSensitive :: getSensitives , dto . getName ()); } IPage result = page ( page , lambdaQueryWrapper ); //3.\u7ed3\u679c\u8fd4\u56de ResponseResult responseResult = new PageResponseResult ( dto . getPage (), dto . getSize (),( int ) result . getTotal ()); responseResult . setData ( result . getRecords ()); return responseResult ; } 08-\u65b0\u589e\u4fee\u6539\u5220\u9664 05:40 \u00b6 @Override public ResponseResult insert ( AdSensitive adSensitive ) { //1.\u53c2\u6570\u68c0\u67e5 if ( adSensitive == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u4fdd\u5b58 adSensitive . setCreatedTime ( new Date ()); save ( adSensitive ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } @Override public ResponseResult update ( AdSensitive adSensitive ) { //1.\u53c2\u6570\u68c0\u67e5 if ( adSensitive == null || adSensitive . getId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u4fee\u6539 updateById ( adSensitive ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } @Override public ResponseResult deleteById ( Integer id ) { //1.\u53c2\u6570\u68c0\u67e5 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u5224\u65ad\u5f53\u524d\u654f\u611f\u8bcd\u662f\u5426\u5b58\u5728 AdSensitive adSensitive = getById ( id ); if ( adSensitive == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST ); } //3.\u5220\u9664\u64cd\u4f5c removeById ( id ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } 09-\u654f\u611f\u8bcd\u529f\u80fd\u4e0e\u524d\u53f0\u7cfb\u7edf\u7efc\u5408\u6d4b\u8bd5 03:26 \u00b6 config/index.js\u4e2d\u58f0\u660e\u4e86\u63a5\u53e3\u5730\u5740\uff1a proxyTable : { '/service_9001' : { target : 'http://localhost:9001/' , // \u6e90\u5730\u5740 changeOrigin : true , // \u6539\u53d8\u6e90 pathRewrite : { '^/service_9001' : '' } }, '/service_9002' : { target : 'http://localhost:9002/' , // \u6e90\u5730\u5740 changeOrigin : true , // \u6539\u53d8\u6e90 pathRewrite : { '^/service_9002' : '' } }, '/server_85/WEBSOCKET' : { target : 'http://localhost:9009/' , // \u6e90\u5730\u5740 changeOrigin : true , // \u6539\u53d8\u6e90 pathRewrite : { '^/server_85/WEBSOCKET' : '' } } 10-\u5e38\u89c1\u7684\u52a0\u5bc6\u65b9\u5f0f 05:43 \u00b6 \u53ef\u9006\u52a0\u5bc6\u7b97\u6cd5 \u00b6 \u5bf9\u79f0\u52a0\u5bc6 \u00b6 \u4e00\u822c\u7528\u4e8e\u4fdd\u5b58\u7528\u6237\u624b\u673a\u53f7\u3001\u8eab\u4efd\u8bc1\u7b49\u654f\u611f\u4f46\u80fd\u89e3\u5bc6\u7684\u4fe1\u606f\u3002 AES\u3001DES\u30013DES\u3001Blowfish\u3001IDEA\u3001RC4\u3001RC5\u3001RC6\u3001HS256 \u975e\u5bf9\u79f0\u52a0\u5bc6 \u00b6 \u4e00\u822c\u7528\u4e8e\u7b7e\u540d\u548c\u8ba4\u8bc1\u3002\u79c1\u94a5\u670d\u52a1\u5668\u4fdd\u5b58, \u7528\u6765\u52a0\u5bc6, \u516c\u94a5\u5ba2\u6237\u62ff\u7740\u7528\u4e8e\u5bf9\u4e8e\u4ee4\u724c\u6216\u8005\u7b7e\u540d\u7684\u89e3\u5bc6\u6216\u8005\u6821\u9a8c\u4f7f\u7528. RSA\u3001DSA\uff08\u6570\u5b57\u7b7e\u540d\u7528\uff09\u3001ECC\uff08\u79fb\u52a8\u8bbe\u5907\u7528\uff09\u3001RS256 (\u91c7\u7528SHA-256 \u7684 RSA \u7b7e\u540d) \u4e0d\u53ef\u9006\u52a0\u5bc6\u7b97\u6cd5 \u00b6 \u4e00\u822c\u7528\u4e8e\u6548\u9a8c\u4e0b\u8f7d\u6587\u4ef6\u6b63\u786e\u6027\uff0c\u4e00\u822c\u5728\u7f51\u7ad9\u4e0a\u4e0b\u8f7d\u6587\u4ef6\u90fd\u80fd\u89c1\u5230\uff1b\u5b58\u50a8\u7528\u6237\u654f\u611f\u4fe1\u606f\uff0c\u5982\u5bc6\u7801\u3001 \u5361\u53f7\u7b49\u4e0d\u53ef\u89e3\u5bc6\u7684\u4fe1\u606f\u3002 MD5\u3001SHA\u3001HMAC Base64 Base64\u662f\u7f51\u7edc\u4e0a\u6700\u5e38\u89c1\u7684\u7528\u4e8e\u4f20\u8f938Bit\u5b57\u8282\u4ee3\u7801\u7684\u7f16\u7801\u65b9\u5f0f\u4e4b\u4e00\u3002Base64\u7f16\u7801\u53ef\u7528\u4e8e\u5728HTTP\u73af\u5883\u4e0b\u4f20\u9012\u8f83\u957f\u7684\u6807\u8bc6\u4fe1\u606f\u3002\u91c7\u7528Base64Base64\u7f16\u7801\u89e3\u7801\u5177\u6709\u4e0d\u53ef\u8bfb\u6027\uff0c\u5373\u6240\u7f16\u7801\u7684\u6570\u636e\u4e0d\u4f1a\u88ab\u4eba\u7528\u8089\u773c\u6240\u76f4\u63a5\u770b\u5230\u3002 \u6ce8\u610f\uff1aBase64\u53ea\u662f\u4e00\u79cd\u7f16\u7801\u65b9\u5f0f\uff0c\u4e0d\u7b97\u52a0\u5bc6\u65b9\u6cd5\u3002 \u5bf9\u8bc1\u4e66\u6765\u8bf4\uff0c\u7279\u522b\u662f\u6839\u8bc1\u4e66\uff0c\u4e00\u822c\u90fd\u662f\u4f5cBase64\u7f16\u7801\u7684\uff0c\u56e0\u4e3a\u5b83\u8981\u5728\u7f51\u4e0a\u88ab\u8bb8\u591a\u4eba\u4e0b\u8f7d\u3002\u7535\u5b50\u90ae\u4ef6\u7684\u9644\u4ef6\u4e00\u822c\u4e5f\u4f5cBase64\u7f16\u7801\u7684\uff0c\u56e0\u4e3a\u4e00\u4e2a\u9644\u4ef6\u6570\u636e\u5f80\u5f80\u662f\u6709\u4e0d\u53ef\u89c1\u5b57\u7b26\u7684\u3002 \u4e00\u4e9b\u8bc1\u4e66\u4e5f\u597d\uff0c\u7535\u5b50\u90ae\u4ef6\u6570\u636e\u4e5f\u597d\uff0c\u90a3\u4e48\u4e3a\u4ec0\u4e48\u8981\u4f5c\u4e00\u4e0b\u8fd9\u6837\u7684\u7f16\u7801\u5462 \u00b6 \u6211\u4eec\u77e5\u9053\u5728\u8ba1\u7b97\u673a\u4e2d\u4efb\u4f55\u6570\u636e\u90fd\u662f\u6309ascii\u7801\u5b58\u50a8\u7684\uff0c\u800cascii\u7801\u7684128\uff5e255\u4e4b\u95f4\u7684\u503c\u662f\u4e0d\u53ef\u89c1\u5b57\u7b26\u3002\u800c\u5728\u7f51\u7edc\u4e0a\u4ea4\u6362\u6570\u636e\u65f6\uff0c\u6bd4\u5982\u8bf4\u4eceA\u5730\u4f20\u5230B\u5730\uff0c\u5f80\u5f80\u8981\u7ecf\u8fc7\u591a\u4e2a\u8def\u7531\u8bbe\u5907\uff0c\u7531\u4e8e\u4e0d\u540c\u7684\u8bbe\u5907\u5bf9\u5b57\u7b26\u7684\u5904\u7406\u65b9\u5f0f\u6709\u4e00\u4e9b\u4e0d\u540c\uff0c\u8fd9\u6837\u90a3\u4e9b\u4e0d\u53ef\u89c1\u5b57\u7b26\u5c31\u6709\u53ef\u80fd\u88ab\u5904\u7406\u9519\u8bef\uff0c\u8fd9\u662f\u4e0d\u5229\u4e8e\u4f20\u8f93\u7684\u3002\u6240\u4ee5\u5c31\u5148\u628a\u6570\u636e\u5148\u505a\u4e00\u4e2aBase64\u7f16\u7801\uff0c\u7edf\u7edf\u53d8\u6210\u53ef\u89c1\u5b57\u7b26\uff0c\u8fd9\u6837\u51fa\u9519\u7684\u53ef\u80fd\u6027\u5c31\u5927\u964d\u4f4e\u4e86\u3002 \u90a3\u4e48Base64\u5230\u5e95\u662f\u600e\u6837\u7f16\u7801\u7684\u5462\uff1f \u00b6 \u7b80\u5355\u6765\u8bf4\uff0c\u4efb\u4f55\u4e00\u4e2a\u6570\u636e\u65e0\u975e\u53ef\u4ee5\u770b\u4f5c\u4e00\u4e2a\u6bd4\u7279\u6d41\uff0c\u598201000100010011101100111010111100011001010\u2026\u2026\u90a3\u4e48\u6211\u4eec\u53d66\u4e2a\u6bd4\u7279\u4e3a\u4e00\u7ec4\uff0c\u8ba1\u7b97\u5b83\u7684ascii\u503c\uff0c\u5f97\u5230\u4e00\u4e2a\u5b57\u7b26\uff0c\u8fd9\u4e2a\u5b57\u7b26\u80af\u5b9a\u662f\u53ef\u89c1\u5b57\u7b26\uff0c\u597d\uff0c\u628a\u5b83\u5bf9\u5e94\u7684\u5b57\u7b26\u5199\u51fa\u6765\uff0c\u518d\u53d66\u4e2a\u6bd4\u7279\uff0c\u8ba1\u7b97\u2026\uff0c\u5982\u6b64\u4e0b\u53bb\uff0c\u76f4\u5230\u6700\u540e\uff0c\u5c31\u5b8c\u6210\u4e86\u7f16\u7801\u3002 \u6807\u51c6base64\u53ea\u670964\u4e2a\u5b57\u7b26\uff08\u82f1\u6587\u5927\u5c0f\u5199\u3001\u6570\u5b57\u548c+\u3001/\uff09\u4ee5\u53ca\u7528\u4f5c\u540e\u7f00\u7b49\u53f7\uff1b base64\u662f\u628a3\u4e2a\u5b57\u8282\u53d8\u62104\u4e2a\u53ef\u6253\u5370\u5b57\u7b26\uff0c\u6240\u4ee5base64\u7f16\u7801\u540e\u7684\u5b57\u7b26\u4e32\u4e00\u5b9a\u80fd\u88ab4\u6574\u9664\uff08\u4e0d\u7b97\u7528\u4f5c\u540e\u7f00\u7684\u7b49\u53f7\uff09\uff1b \u7b49\u53f7\u4e00\u5b9a\u7528\u4f5c\u540e\u7f00\uff0c\u4e14\u6570\u76ee\u4e00\u5b9a\u662f0\u4e2a\u30011\u4e2a\u62162\u4e2a\u3002\u8fd9\u662f\u56e0\u4e3a\u5982\u679c\u539f\u6587\u957f\u5ea6\u4e0d\u80fd\u88ab3\u6574\u9664\uff0cbase64\u8981\u5728\u540e\u9762\u6dfb\u52a0\\0\u51d1\u9f503n\u4f4d\u3002\u4e3a\u4e86\u6b63\u786e\u8fd8\u539f\uff0c\u6dfb\u52a0\u4e86\u51e0\u4e2a\\0\u5c31\u52a0\u4e0a\u51e0\u4e2a\u7b49\u53f7\u3002\u663e\u7136\u6dfb\u52a0\u7b49\u53f7\u7684\u6570\u76ee\u53ea\u80fd\u662f0\u30011\u62162\uff1b \u4e25\u683c\u6765\u8bf4base64\u4e0d\u80fd\u7b97\u662f\u4e00\u79cd\u52a0\u5bc6\uff0c\u53ea\u80fd\u8bf4\u662f\u7f16\u7801\u8f6c\u6362\u3002\u4f7f\u7528base64\u7684\u521d\u8877\u3002\u662f\u4e3a\u4e86\u65b9\u4fbf\u628a\u542b\u6709\u4e0d\u53ef\u89c1\u5b57\u7b26\u4e32\u7684\u4fe1\u606f\u7528\u53ef\u89c1\u5b57\u7b26\u4e32\u8868\u793a\u51fa\u6765\uff0c\u4ee5\u4fbf\u590d\u5236\u7c98\u8d34\uff1b \u6bd4\u5982\u6570\u636e\u5e93\u4e2d\u5c31\u53ef\u4ee5\u5b58\u653e\u56fe\u7247\u4e86\uff0c\u4f7f\u7528base64\u7f16\u7801\u4e4b\u540e\u5199\u5165\u6570\u636e\u5e93\uff0c\u4ee5text\u65b9\u5f0f\u5b58\u653e \u5728\u7ebf\u7f16\u7801\u5de5\u5177\uff1a http://www.jsons.cn/img2base64/ 11-\u5bc6\u7801\u52a0\u5bc6\u53ca\u5bc6\u7801\u52a0\u5bc6\u65b9\u5f0f\u9009\u578b 13:30 \u00b6 package com.heima.password.test ; import com.heima.utils.common.BCrypt ; import com.heima.utils.common.MD5Utils ; import org.apache.commons.lang3.RandomStringUtils ; import org.springframework.util.DigestUtils ; public class MD5Test { public static void main ( String [] args ) { //md5\u52a0\u5bc6 DegestUtils\uff1aspring\u6846\u67b6\u63d0\u4f9b\u7684\u5de5\u5177\u7c7b //String md5Str = DigestUtils.md5DigestAsHex(\"abc\".getBytes()); //System.out.println(md5Str);//900150983cd24fb0d6963f7d28e17f72 //uername:zhangsan password:123 salt:\u968f\u65f6\u5b57\u7b26\u4e32 String salt = RandomStringUtils . randomAlphanumeric ( 10 ); System . out . println ( salt ); String pswd = \"123\" + salt ; String saltPswd = DigestUtils . md5DigestAsHex ( pswd . getBytes ()); System . out . println ( saltPswd ) /* String gensalt = BCrypt.gensalt();//\u8fd9\u4e2a\u662f\u76d0 29\u4e2a\u5b57\u7b26\uff0c\u968f\u673a\u751f\u6210 System.out.println(gensalt); String password = BCrypt.hashpw(\"123456\", gensalt); //\u6839\u636e\u76d0\u5bf9\u5bc6\u7801\u8fdb\u884c\u52a0\u5bc6 System.out.println(password);//\u52a0\u5bc6\u540e\u7684\u5b57\u7b26\u4e32\u524d29\u4f4d\u5c31\u662fd*/ boolean checkpw = BCrypt . checkpw ( \"123456\" , password ); System . out . println ( checkpw ); String abc = MD5Utils . encodeWithSalt ( \"admin\" , \"123abc\" ); System . out . println ( abc ); } } 12-token\u8ba4\u8bc1\u6d41\u7a0b 02:25 \u00b6 HTTP\u8bf7\u6c42 \u65e0\u72b6\u6001\uff1f 13-JWT\u4ecb\u7ecd\u53ca\u751f\u6210\u548c\u89e3\u6790 10:50 \u00b6 Json web token (JWT), \u662f\u4e3a\u4e86\u5728\u7f51\u7edc\u5e94\u7528\u73af\u5883\u95f4\u4f20\u9012\u58f0\u660e\u800c\u6267\u884c\u7684\u4e00\u79cd\u57fa\u4e8eJSON\u7684\u5f00\u653e\u6807\u51c6\uff08 (RFC 7519 ).\u8be5token\u88ab\u8bbe\u8ba1\u4e3a\u7d27\u51d1\u4e14\u5b89\u5168\u7684\uff0c\u7279\u522b\u9002\u7528\u4e8e\u5206\u5e03\u5f0f\u7ad9\u70b9\u7684\u5355\u70b9\u767b\u5f55\uff08SSO\uff09\u573a\u666f\u3002JWT\u7684\u58f0\u660e\u4e00\u822c\u88ab\u7528\u6765\u5728\u8eab\u4efd\u63d0\u4f9b\u8005\u548c\u670d\u52a1\u63d0\u4f9b\u8005\u95f4\u4f20\u9012\u88ab\u8ba4\u8bc1\u7684\u7528\u6237\u8eab\u4efd\u4fe1\u606f\uff0c\u4ee5\u4fbf\u4e8e\u4ece\u8d44\u6e90\u670d\u52a1\u5668\u83b7\u53d6\u8d44\u6e90\uff0c\u4e5f\u53ef\u4ee5\u589e\u52a0\u4e00\u4e9b\u989d\u5916\u7684\u5176\u5b83\u4e1a\u52a1\u903b\u8f91\u6240\u5fc5\u987b\u7684\u58f0\u660e\u4fe1\u606f\uff0c\u8be5token\u4e5f\u53ef\u76f4\u63a5\u88ab\u7528\u4e8e\u8ba4\u8bc1\uff0c\u4e5f\u53ef\u88ab\u52a0\u5bc6\u3002 \u8d77\u6e90 \u00b6 \u8bf4\u8d77JWT\uff0c\u6211\u4eec\u5e94\u8be5\u6765\u8c08\u4e00\u8c08\u57fa\u4e8etoken\u7684\u8ba4\u8bc1\u548c\u4f20\u7edf\u7684session\u8ba4\u8bc1\u7684\u533a\u522b\u3002 \u4f20\u7edf\u7684session\u8ba4\u8bc1 \u00b6 \u6211\u4eec\u77e5\u9053\uff0chttp\u534f\u8bae\u672c\u8eab\u662f\u4e00\u79cd\u65e0\u72b6\u6001\u7684\u534f\u8bae\uff0c\u800c\u8fd9\u5c31\u610f\u5473\u7740\u5982\u679c\u7528\u6237\u5411\u6211\u4eec\u7684\u5e94\u7528\u63d0\u4f9b\u4e86\u7528\u6237\u540d\u548c\u5bc6\u7801\u6765\u8fdb\u884c\u7528\u6237\u8ba4\u8bc1\uff0c\u90a3\u4e48\u4e0b\u4e00\u6b21\u8bf7\u6c42\u65f6\uff0c\u7528\u6237\u8fd8\u8981\u518d\u4e00\u6b21\u8fdb\u884c\u7528\u6237\u8ba4\u8bc1\u624d\u884c\uff0c\u56e0\u4e3a\u6839\u636ehttp\u534f\u8bae\uff0c\u6211\u4eec\u5e76\u4e0d\u80fd\u77e5\u9053\u662f\u54ea\u4e2a\u7528\u6237\u53d1\u51fa\u7684\u8bf7\u6c42\uff0c\u6240\u4ee5\u4e3a\u4e86\u8ba9\u6211\u4eec\u7684\u5e94\u7528\u80fd\u8bc6\u522b\u662f\u54ea\u4e2a\u7528\u6237\u53d1\u51fa\u7684\u8bf7\u6c42\uff0c\u6211\u4eec\u53ea\u80fd\u5728\u670d\u52a1\u5668\u5b58\u50a8\u4e00\u4efd\u7528\u6237\u767b\u5f55\u7684\u4fe1\u606f\uff0c\u8fd9\u4efd\u767b\u5f55\u4fe1\u606f\u4f1a\u5728\u54cd\u5e94\u65f6\u4f20\u9012\u7ed9\u6d4f\u89c8\u5668\uff0c\u544a\u8bc9\u5176\u4fdd\u5b58\u4e3acookie,\u4ee5\u4fbf\u4e0b\u6b21\u8bf7\u6c42\u65f6\u53d1\u9001\u7ed9\u6211\u4eec\u7684\u5e94\u7528\uff0c\u8fd9\u6837\u6211\u4eec\u7684\u5e94\u7528\u5c31\u80fd\u8bc6\u522b\u8bf7\u6c42\u6765\u81ea\u54ea\u4e2a\u7528\u6237\u4e86,\u8fd9\u5c31\u662f\u4f20\u7edf\u7684\u57fa\u4e8esession\u8ba4\u8bc1\u3002 \u4f46\u662f\u8fd9\u79cd\u57fa\u4e8esession\u7684\u8ba4\u8bc1\u4f7f\u5e94\u7528\u672c\u8eab\u5f88\u96be\u5f97\u5230\u6269\u5c55\uff0c\u968f\u7740\u4e0d\u540c\u5ba2\u6237\u7aef\u7528\u6237\u7684\u589e\u52a0\uff0c\u72ec\u7acb\u7684\u670d\u52a1\u5668\u5df2\u65e0\u6cd5\u627f\u8f7d\u66f4\u591a\u7684\u7528\u6237\uff0c\u800c\u8fd9\u65f6\u5019\u57fa\u4e8esession\u8ba4\u8bc1\u5e94\u7528\u7684\u95ee\u9898\u5c31\u4f1a\u66b4\u9732\u51fa\u6765. \u57fa\u4e8esession\u8ba4\u8bc1\u6240\u663e\u9732\u7684\u95ee\u9898 \u00b6 Session : \u6bcf\u4e2a\u7528\u6237\u7ecf\u8fc7\u6211\u4eec\u7684\u5e94\u7528\u8ba4\u8bc1\u4e4b\u540e\uff0c\u6211\u4eec\u7684\u5e94\u7528\u90fd\u8981\u5728\u670d\u52a1\u7aef\u505a\u4e00\u6b21\u8bb0\u5f55\uff0c\u4ee5\u65b9\u4fbf\u7528\u6237\u4e0b\u6b21\u8bf7\u6c42\u7684\u9274\u522b\uff0c\u901a\u5e38\u800c\u8a00session\u90fd\u662f\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u800c\u968f\u7740\u8ba4\u8bc1\u7528\u6237\u7684\u589e\u591a\uff0c\u670d\u52a1\u7aef\u7684\u5f00\u9500\u4f1a\u660e\u663e\u589e\u5927\u3002 \u6269\u5c55\u6027 : \u7528\u6237\u8ba4\u8bc1\u4e4b\u540e\uff0c\u670d\u52a1\u7aef\u505a\u8ba4\u8bc1\u8bb0\u5f55\uff0c\u5982\u679c\u8ba4\u8bc1\u7684\u8bb0\u5f55\u88ab\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u7684\u8bdd\uff0c\u8fd9\u610f\u5473\u7740\u7528\u6237\u4e0b\u6b21\u8bf7\u6c42\u8fd8\u5fc5\u987b\u8981\u8bf7\u6c42\u5728\u8fd9\u53f0\u670d\u52a1\u5668\u4e0a,\u8fd9\u6837\u624d\u80fd\u62ff\u5230\u6388\u6743\u7684\u8d44\u6e90\uff0c\u8fd9\u6837\u5728\u5206\u5e03\u5f0f\u7684\u5e94\u7528\u4e0a\uff0c\u76f8\u5e94\u7684\u9650\u5236\u4e86\u8d1f\u8f7d\u5747\u8861\u5668\u7684\u80fd\u529b\u3002\u8fd9\u4e5f\u610f\u5473\u7740\u9650\u5236\u4e86\u5e94\u7528\u7684\u6269\u5c55\u80fd\u529b\u3002 CSRF : \u56e0\u4e3a\u662f\u57fa\u4e8ecookie\u6765\u8fdb\u884c\u7528\u6237\u8bc6\u522b\u7684, cookie\u5982\u679c\u88ab\u622a\u83b7\uff0c\u7528\u6237\u5c31\u4f1a\u5f88\u5bb9\u6613\u53d7\u5230\u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020\u7684\u653b\u51fb\u3002 \u57fa\u4e8etoken\u7684\u9274\u6743\u673a\u5236 \u00b6 \u57fa\u4e8etoken\u7684\u9274\u6743\u673a\u5236\u7c7b\u4f3c\u4e8ehttp\u534f\u8bae\u4e5f\u662f\u65e0\u72b6\u6001\u7684\uff0c\u5b83\u4e0d\u9700\u8981\u5728\u670d\u52a1\u7aef\u53bb\u4fdd\u7559\u7528\u6237\u7684\u8ba4\u8bc1\u4fe1\u606f\u6216\u8005\u4f1a\u8bdd\u4fe1\u606f\u3002\u8fd9\u5c31\u610f\u5473\u7740\u57fa\u4e8etoken\u8ba4\u8bc1\u673a\u5236\u7684\u5e94\u7528\u4e0d\u9700\u8981\u53bb\u8003\u8651\u7528\u6237\u5728\u54ea\u4e00\u53f0\u670d\u52a1\u5668\u767b\u5f55\u4e86\uff0c\u8fd9\u5c31\u4e3a\u5e94\u7528\u7684\u6269\u5c55\u63d0\u4f9b\u4e86\u4fbf\u5229\u3002 \u6d41\u7a0b\u4e0a\u662f\u8fd9\u6837\u7684\uff1a \u7528\u6237\u4f7f\u7528\u7528\u6237\u540d\u5bc6\u7801\u6765\u8bf7\u6c42\u670d\u52a1\u5668 \u670d\u52a1\u5668\u8fdb\u884c\u9a8c\u8bc1\u7528\u6237\u7684\u4fe1\u606f \u670d\u52a1\u5668\u901a\u8fc7\u9a8c\u8bc1\u53d1\u9001\u7ed9\u7528\u6237\u4e00\u4e2atoken \u5ba2\u6237\u7aef\u5b58\u50a8token\uff0c\u5e76\u5728\u6bcf\u6b21\u8bf7\u6c42\u65f6\u9644\u9001\u4e0a\u8fd9\u4e2atoken\u503c \u670d\u52a1\u7aef\u9a8c\u8bc1token\u503c\uff0c\u5e76\u8fd4\u56de\u6570\u636e \u8fd9\u4e2atoken\u5fc5\u987b\u8981\u5728\u6bcf\u6b21\u8bf7\u6c42\u65f6\u4f20\u9012\u7ed9\u670d\u52a1\u7aef\uff0c\u5b83\u5e94\u8be5\u4fdd\u5b58\u5728\u8bf7\u6c42\u5934\u91cc\uff0c \u53e6\u5916\uff0c\u670d\u52a1\u7aef\u8981\u652f\u6301 CORS(\u8de8\u6765\u6e90\u8d44\u6e90\u5171\u4eab) \u7b56\u7565\uff0c\u4e00\u822c\u6211\u4eec\u5728\u670d\u52a1\u7aef\u8fd9\u4e48\u505a\u5c31\u53ef\u4ee5\u4e86 Access-Control-Allow-Origin: * \u3002 \u90a3\u4e48\u6211\u4eec\u73b0\u5728\u56de\u5230JWT\u7684\u4e3b\u9898\u4e0a\u3002 JWT\u957f\u4ec0\u4e48\u6837\uff1f \u00b6 JWT\u662f\u7531\u4e09\u6bb5\u4fe1\u606f\u6784\u6210\u7684\uff0c\u5c06\u8fd9\u4e09\u6bb5\u4fe1\u606f\u6587\u672c\u7528 . \u94fe\u63a5\u4e00\u8d77\u5c31\u6784\u6210\u4e86Jwt\u5b57\u7b26\u4e32\u3002\u5c31\u50cf\u8fd9\u6837: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9 . eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9 . TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ JWT\u7684\u6784\u6210 \u00b6 \u7b2c\u4e00\u90e8\u5206\u6211\u4eec\u79f0\u5b83\u4e3a\u5934\u90e8\uff08header),\u7b2c\u4e8c\u90e8\u5206\u6211\u4eec\u79f0\u5176\u4e3a\u8f7d\u8377\uff08payload, \u7c7b\u4f3c\u4e8e\u98de\u673a\u4e0a\u627f\u8f7d\u7684\u7269\u54c1)\uff0c\u7b2c\u4e09\u90e8\u5206\u662f\u7b7e\u8bc1\uff08signature). header \u00b6 jwt\u7684\u5934\u90e8\u627f\u8f7d\u4e24\u90e8\u5206\u4fe1\u606f\uff1a \u58f0\u660e\u7c7b\u578b\uff0c\u8fd9\u91cc\u662fjwt \u58f0\u660e\u52a0\u5bc6\u7684\u7b97\u6cd5 \u901a\u5e38\u76f4\u63a5\u4f7f\u7528 HMAC SHA256 \u5b8c\u6574\u7684\u5934\u90e8\u5c31\u50cf\u4e0b\u9762\u8fd9\u6837\u7684JSON\uff1a { 'typ' : 'JWT' , 'alg' : 'HS256' } \u7136\u540e\u5c06\u5934\u90e8\u8fdb\u884cbase64\u52a0\u5bc6\uff08\u8be5\u52a0\u5bc6\u662f\u53ef\u4ee5\u5bf9\u79f0\u89e3\u5bc6\u7684),\u6784\u6210\u4e86\u7b2c\u4e00\u90e8\u5206. eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9 payload \u00b6 \u8f7d\u8377\u5c31\u662f\u5b58\u653e\u6709\u6548\u4fe1\u606f\u7684\u5730\u65b9\u3002\u8fd9\u4e2a\u540d\u5b57\u50cf\u662f\u7279\u6307\u98de\u673a\u4e0a\u627f\u8f7d\u7684\u8d27\u54c1\uff0c\u8fd9\u4e9b\u6709\u6548\u4fe1\u606f\u5305\u542b\u4e09\u4e2a\u90e8\u5206 \u6807\u51c6\u4e2d\u6ce8\u518c\u7684\u58f0\u660e \u516c\u5171\u7684\u58f0\u660e \u79c1\u6709\u7684\u58f0\u660e \u6807\u51c6\u4e2d\u6ce8\u518c\u7684\u58f0\u660e (\u5efa\u8bae\u4f46\u4e0d\u5f3a\u5236\u4f7f\u7528) \uff1a iss : jwt\u7b7e\u53d1\u8005 sub : jwt\u6240\u9762\u5411\u7684\u7528\u6237 aud : \u63a5\u6536jwt\u7684\u4e00\u65b9 exp : jwt\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u8fd9\u4e2a\u8fc7\u671f\u65f6\u95f4\u5fc5\u987b\u8981\u5927\u4e8e\u7b7e\u53d1\u65f6\u95f4 nbf : \u5b9a\u4e49\u5728\u4ec0\u4e48\u65f6\u95f4\u4e4b\u524d\uff0c\u8be5jwt\u90fd\u662f\u4e0d\u53ef\u7528\u7684. iat : jwt\u7684\u7b7e\u53d1\u65f6\u95f4 jti : jwt\u7684\u552f\u4e00\u8eab\u4efd\u6807\u8bc6\uff0c\u4e3b\u8981\u7528\u6765\u4f5c\u4e3a\u4e00\u6b21\u6027token,\u4ece\u800c\u56de\u907f\u91cd\u653e\u653b\u51fb\u3002 \u516c\u5171\u7684\u58f0\u660e \uff1a \u516c\u5171\u7684\u58f0\u660e\u53ef\u4ee5\u6dfb\u52a0\u4efb\u4f55\u7684\u4fe1\u606f\uff0c\u4e00\u822c\u6dfb\u52a0\u7528\u6237\u7684\u76f8\u5173\u4fe1\u606f\u6216\u5176\u4ed6\u4e1a\u52a1\u9700\u8981\u7684\u5fc5\u8981\u4fe1\u606f.\u4f46\u4e0d\u5efa\u8bae\u6dfb\u52a0\u654f\u611f\u4fe1\u606f\uff0c\u56e0\u4e3a\u8be5\u90e8\u5206\u5728\u5ba2\u6237\u7aef\u53ef\u89e3\u5bc6. \u79c1\u6709\u7684\u58f0\u660e \uff1a \u79c1\u6709\u58f0\u660e\u662f\u63d0\u4f9b\u8005\u548c\u6d88\u8d39\u8005\u6240\u5171\u540c\u5b9a\u4e49\u7684\u58f0\u660e\uff0c\u4e00\u822c\u4e0d\u5efa\u8bae\u5b58\u653e\u654f\u611f\u4fe1\u606f\uff0c\u56e0\u4e3abase64\u662f\u5bf9\u79f0\u89e3\u5bc6\u7684\uff0c\u610f\u5473\u7740\u8be5\u90e8\u5206\u4fe1\u606f\u53ef\u4ee5\u5f52\u7c7b\u4e3a\u660e\u6587\u4fe1\u606f\u3002 \u5b9a\u4e49\u4e00\u4e2apayload: { \"sub\" : \"1234567890\" , \"name\" : \"John Doe\" , \"admin\" : true , \"userData\" : { \"id\" : 100 , userName : \"zhangsan\" } } \u7136\u540e\u5c06\u5176\u8fdb\u884cbase64\u52a0\u5bc6\uff0c\u5f97\u5230Jwt\u7684\u7b2c\u4e8c\u90e8\u5206\u3002 eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9 signature \u00b6 jwt\u7684\u7b2c\u4e09\u90e8\u5206\u662f\u4e00\u4e2a\u7b7e\u8bc1\u4fe1\u606f\uff0c\u8fd9\u4e2a\u7b7e\u8bc1\u4fe1\u606f\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff1a header (base64\u540e\u7684) payload (base64\u540e\u7684) secret \u8fd9\u4e2a\u90e8\u5206\u9700\u8981base64\u52a0\u5bc6\u540e\u7684header\u548cbase64\u52a0\u5bc6\u540e\u7684payload\u4f7f\u7528 . \u8fde\u63a5\u7ec4\u6210\u7684\u5b57\u7b26\u4e32\uff0c\u7136\u540e\u901a\u8fc7header\u4e2d\u58f0\u660e\u7684\u52a0\u5bc6\u65b9\u5f0f\u8fdb\u884c\u52a0\u76d0 secret \u7ec4\u5408\u52a0\u5bc6\uff0c\u7136\u540e\u5c31\u6784\u6210\u4e86jwt\u7684\u7b2c\u4e09\u90e8\u5206\u3002 // javascript var encodedString = base64UrlEncode ( header ) + '.' + base64UrlEncode ( payload ); var signature = HMACSHA256 ( encodedString , ' secret ' ); // TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ \u5c06\u8fd9\u4e09\u90e8\u5206\u7528 . \u8fde\u63a5\u6210\u4e00\u4e2a\u5b8c\u6574\u7684\u5b57\u7b26\u4e32,\u6784\u6210\u4e86\u6700\u7ec8\u7684jwt: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9 . eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9 . TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ \u6ce8\u610f\uff1asecret\u662f\u4fdd\u5b58\u5728\u670d\u52a1\u5668\u7aef\u7684\uff0cjwt\u7684\u7b7e\u53d1\u751f\u6210\u4e5f\u662f\u5728\u670d\u52a1\u5668\u7aef\u7684\uff0csecret\u5c31\u662f\u7528\u6765\u8fdb\u884cjwt\u7684\u7b7e\u53d1\u548cjwt\u7684\u9a8c\u8bc1\uff0c\u6240\u4ee5\uff0c\u5b83\u5c31\u662f\u4f60\u670d\u52a1\u7aef\u7684\u79c1\u94a5\uff0c\u5728\u4efb\u4f55\u573a\u666f\u90fd\u4e0d\u5e94\u8be5\u6d41\u9732\u51fa\u53bb\u3002\u4e00\u65e6\u5ba2\u6237\u7aef\u5f97\u77e5\u8fd9\u4e2asecret, \u90a3\u5c31\u610f\u5473\u7740\u5ba2\u6237\u7aef\u662f\u53ef\u4ee5\u81ea\u6211\u7b7e\u53d1jwt\u4e86\u3002 \u5982\u4f55\u5e94\u7528 \u00b6 \u4e00\u822c\u662f\u5728\u8bf7\u6c42\u5934\u91cc\u52a0\u5165 Authorization \uff0c\u5e76\u52a0\u4e0a Bearer \u6807\u6ce8\uff1a fetch ( 'api/user/1' , { headers: { 'Authorization' : 'Bearer ' + token } }) \u670d\u52a1\u7aef\u4f1a\u9a8c\u8bc1token\uff0c\u5982\u679c\u9a8c\u8bc1\u901a\u8fc7\u5c31\u4f1a\u8fd4\u56de\u76f8\u5e94\u7684\u8d44\u6e90\u3002\u6574\u4e2a\u6d41\u7a0b\u5c31\u662f\u8fd9\u6837\u7684: jwt-diagram \u603b\u7ed3 \u00b6 \u4f18\u70b9 \u00b6 \u56e0\u4e3ajson\u7684\u901a\u7528\u6027\uff0c\u6240\u4ee5JWT\u662f\u53ef\u4ee5\u8fdb\u884c\u8de8\u8bed\u8a00\u652f\u6301\u7684\uff0c\u50cfJAVA,JavaScript,NodeJS,PHP\u7b49\u5f88\u591a\u8bed\u8a00\u90fd\u53ef\u4ee5\u4f7f\u7528\u3002 \u56e0\u4e3a\u6709\u4e86payload\u90e8\u5206\uff0c\u6240\u4ee5JWT\u53ef\u4ee5\u5728\u81ea\u8eab\u5b58\u50a8\u4e00\u4e9b\u5176\u4ed6\u4e1a\u52a1\u903b\u8f91\u6240\u5fc5\u8981\u7684\u975e\u654f\u611f\u4fe1\u606f\u3002 \u4fbf\u4e8e\u4f20\u8f93\uff0cjwt\u7684\u6784\u6210\u975e\u5e38\u7b80\u5355\uff0c\u5b57\u8282\u5360\u7528\u5f88\u5c0f\uff0c\u6240\u4ee5\u5b83\u662f\u975e\u5e38\u4fbf\u4e8e\u4f20\u8f93\u7684\u3002 \u5b83\u4e0d\u9700\u8981\u5728\u670d\u52a1\u7aef\u4fdd\u5b58\u4f1a\u8bdd\u4fe1\u606f, \u6240\u4ee5\u5b83\u6613\u4e8e\u5e94\u7528\u7684\u6269\u5c55 \u5b89\u5168\u76f8\u5173 \u00b6 \u4e0d\u5e94\u8be5\u5728jwt\u7684payload\u90e8\u5206\u5b58\u653e\u654f\u611f\u4fe1\u606f\uff0c\u56e0\u4e3a\u8be5\u90e8\u5206\u662f\u5ba2\u6237\u7aef\u53ef\u89e3\u5bc6\u7684\u90e8\u5206\u3002 \u4fdd\u62a4\u597dsecret\u79c1\u94a5\uff0c\u8be5\u79c1\u94a5\u975e\u5e38\u91cd\u8981\u3002 \u5982\u679c\u53ef\u4ee5\uff0c\u8bf7\u4f7f\u7528https\u534f\u8bae package com.heima.utils.common ; import io.jsonwebtoken.* ; import javax.crypto.SecretKey ; import javax.crypto.spec.SecretKeySpec ; import java.util.* ; public class AppJwtUtil { // \u8bb2\u4e49\u6709\u8bef\uff0cTOKEN\u7684\u6709\u6548\u671f1\u5c0f\u65f6\uff08S\uff09 private static final int TOKEN_TIME_OUT = 3_600 ; // \u52a0\u5bc6KEY private static final String TOKEN_ENCRY_KEY = \"MDk4ZjZiY2Q0NjIxZDM3M2NhZGU0ZTgzMjYyN2I0ZjY\" ; // \u6700\u5c0f\u5237\u65b0\u95f4\u9694(S) private static final int REFRESH_TIME = 300 ; // \u751f\u4ea7ID public static String getToken ( Long id ){ Map < String , Object > claimMaps = new HashMap <> (); claimMaps . put ( \"id\" , id ); long currentTime = System . currentTimeMillis (); return Jwts . builder () . setId ( UUID . randomUUID (). toString ()) . setIssuedAt ( new Date ( currentTime )) //\u7b7e\u53d1\u65f6\u95f4 . setSubject ( \"system\" ) //\u8bf4\u660e . setIssuer ( \"heima\" ) //\u7b7e\u53d1\u8005\u4fe1\u606f . setAudience ( \"app\" ) //\u63a5\u6536\u7528\u6237 . compressWith ( CompressionCodecs . GZIP ) //\u6570\u636e\u538b\u7f29\u65b9\u5f0f . signWith ( SignatureAlgorithm . HS512 , generalKey ()) //\u52a0\u5bc6\u65b9\u5f0f . setExpiration ( new Date ( currentTime + TOKEN_TIME_OUT * 1000 )) //\u8fc7\u671f\u65f6\u95f4\u6233 . addClaims ( claimMaps ) //cla\u4fe1\u606f . compact (); } /** * \u83b7\u53d6token\u4e2d\u7684claims\u4fe1\u606f * * @param token * @return */ private static Jws < Claims > getJws ( String token ) { return Jwts . parser () . setSigningKey ( generalKey ()) . parseClaimsJws ( token ); } /** * \u83b7\u53d6payload body\u4fe1\u606f * * @param token * @return */ public static Claims getClaimsBody ( String token ) { try { return getJws ( token ). getBody (); } catch ( ExpiredJwtException e ){ return null ; } } /** * \u83b7\u53d6hearder body\u4fe1\u606f * * @param token * @return */ public static JwsHeader getHeaderBody ( String token ) { return getJws ( token ). getHeader (); } /** * \u662f\u5426\u8fc7\u671f * * @param claims * @return -1\uff1a\u6709\u6548\uff0c0\uff1a\u6709\u6548\u4f46\u662f\u9700\u8981\u5237\u65b0\uff0c1\uff1a\u8fc7\u671f\uff0c2\uff1a\u8fc7\u671f */ public static int verifyToken ( Claims claims ) { if ( claims == null ){ return 1 ; } try { claims . getExpiration () . before ( new Date ()); // \u9700\u8981\u81ea\u52a8\u5237\u65b0TOKEN if (( claims . getExpiration (). getTime () - System . currentTimeMillis ()) > REFRESH_TIME * 1000 ){ //\u8fc7\u671f\u65f6\u95f45\u5206\u949f\u4e4b\u5916\uff0c\u4e0d\u7528\u5237\u65b0 return - 1 ; } else { return 0 ; } } catch ( ExpiredJwtException ex ) { return 1 ; } catch ( Exception e ){ return 2 ; } } /** * \u7531\u5b57\u7b26\u4e32\u751f\u6210\u52a0\u5bc6key * * @return */ public static SecretKey generalKey () { byte [] encodedKey = Base64 . getEncoder (). encode ( TOKEN_ENCRY_KEY . getBytes ()); SecretKey key = new SecretKeySpec ( encodedKey , 0 , encodedKey . length , \"AES\" ); return key ; } public static void main ( String [] args ) { //\u751f\u6210claims\u6570\u636e\uff0c\u5176\u5b9e\u5c31\u662f\u81ea\u5b9a\u4e49\u6570\u636eid,\u7136\u540e\u4f20\u5165\u5230\u65b9\u6cd5\u4e2d String token = AppJwtUtil . getToken ( 1102L ); System . out . println ( token ); Jws < Claims > jws = AppJwtUtil . getJws ( token ); //\u83b7\u53d6\u81ea\u5b9a\u4e49\u6570\u636e Claims claims = jws . getBody (); System . out . println ( claims . get ( \"id\" )); } } JSON Web Token\uff08JWT\uff09\u662f\u4e00\u4e2a\u5f00\u653e\u7684\u884c\u4e1a\u6807\u51c6\uff08RFC 7519\uff09\uff0c\u5b83\u5b9a\u4e49\u4e86\u4e00\u79cd\u7b80\u6d01\u7684\u3001\u81ea\u5305\u542b\u7684\u534f\u8bae\u683c\u5f0f\uff0c\u7528\u4e8e\u5728\u901a\u4fe1\u53cc\u65b9\u4f20\u9012json\u5bf9\u8c61\uff0c\u4f20\u9012\u7684\u4fe1\u606f\u7ecf\u8fc7\u6570\u5b57\u7b7e\u540d\u53ef\u4ee5\u88ab\u9a8c\u8bc1\u548c\u4fe1\u4efb\u3002 token\u5728\u5931\u6548\u524d\u9700\u8981\u8fdb\u884c\u5237\u65b0: \u00b6 int i = AppJwtUtil . verifyToken ( claimsBody ); System . out . println ( i ); if ( i == 0 ){ //\u5237\u65b0token String userData = ( String ) claimsBody . get ( \"userData\" ); String newToken = AppJwtUtil . getDataToken ( userData ); //\u8fd4\u56de\u7ed9\u524d\u7aefnew Token } 14-admin\u7aef\u767b\u5f55\u529f\u80fd\u601d\u8def\u5206\u6790\u548c\u63a5\u53e3\u5b9a\u4e49 05:18 \u00b6 ad_user\u8868\u5c06id\u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u81ea\u589e 15-admin\u7aef\u767b\u5f55\u529f\u80fd\u5b9e\u73b0 11:55 \u00b6 public ResponseResult login ( AdUserDto dto ) { //1.\u53c2\u6570\u6821\u9a8c if ( StringUtils . isEmpty ( dto . getName ()) || StringUtils . isEmpty ( dto . getPassword ())) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE , \"\u7528\u6237\u540d\u6216\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a\" ); } List < AdUser > list = list ( Wrappers . < AdUser > lambdaQuery (). eq ( AdUser :: getName , dto . getName ())); if ( list != null && list . size () >= 1 ) { AdUser adUser = list . get ( 0 ); String pswd = DigestUtils . md5DigestAsHex (( dto . getPassword () + adUser . getSalt ()). getBytes ()); if ( adUser . getPassword (). equals ( pswd )) { Map < String , Object > map = Maps . newHashMap (); adUser . setPassword ( \"\" ); adUser . setSalt ( \"\" ); map . put ( \"token\" , AppJwtUtil . getToken ( adUser . getId (). longValue ())); map . put ( \"user\" , adUser ); return ResponseResult . okResult ( map ); } else { return ResponseResult . errorResult ( AppHttpCodeEnum . LOGIN_PASSWORD_ERROR ); } } else { return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u7528\u6237\u4e0d\u5b58\u5728\" ); } } 16-admin\u7aef\u767b\u5f55\u529f\u80fd\u6d4b\u8bd5 07:23 \u00b6 \u751f\u6210\u5bc6\u7801\uff1a //\u751f\u6210\u76d0\u548c\u5bc6\u7801 String dbsalt = \"1dni2\" ; String dbpassword = \"123456\" + dbsalt ; String saltPassword = DigestUtils . md5DigestAsHex ( dbpassword . getBytes ()); System . out . println ( saltPassword ); \u5c06\u4e0a\u9762\u7684\u76d0\u548c\u5bc6\u7801\u5199\u5230\u6570\u636e\u5e93\u4e2dad_user\u8868\u4e2d \u5982\u679c\u9700\u8981\u6d4b\u8bd5\u9875\u9762\uff0c\u4fee\u6539\uff1asrc\\views\\login\\index.vue \u627e\u5230\u65b9\u6cd5submitForm\uff0c\u4e0b\u9762\u8fd9\u884c\u6ce8\u91ca\u6389\uff1a //this.$router.replace({ path: '/auth/index' }) \u6253\u5f00\u8fd9\u4e00\u6bb5\u7684\u6ce8\u91ca: this . $refs . ruleForm . validate ( async ( valid ) => { if ( valid ) { const { password , name } = this . ruleForm const result = await loginByUsername ( name , password ) if ( result . code === 0 ) { // this.$router.replace({ path: '/users/index' }) this . $router . replace ({ path : '/auth/index' }) } else { this . $message ({ message : result . error_message , type : 'error' }) } } else { return false } }) 17-nacos\u4ecb\u7ecd 04:10 \u00b6 nacos\u529f\u80fd: 1.\u670d\u52a1\u6ce8\u518c\u548c\u53d1\u73b0 2.\u914d\u7f6e\u7ba1\u7406 AP CP -> CAP \u7b2c\u56db\u5929 eureka -> ap consul -> cp zookeeper -> cp 18-linux\u670d\u52a1\u5668\u6302\u8f7d 03:47 \u00b6 nacos\u5efa\u8bae\u76f4\u63a5\u5728windows\u4e0b\u4f7f\u7528 19-nacos\u642d\u5efa\u53ca\u5fae\u670d\u52a1\u6ce8\u518c 06:19 \u00b6 windows\u4e0b\u76f4\u63a5\u8fd0\u884c nacos-server-1.2.0\\nacos\\bin\\startup.cmd linux\u4e0b\u8fd0\u884c shell sh nacos-server-1.2.0\\nacos\\bin\\startup.sh -m standalone \u8bbf\u95ee\uff1a http://localhost:8848/nacos/index.html","title":"day02"},{"location":"hmtt/day02/#01-_0120","text":"\u80fd\u591f\u638c\u63e1\u9879\u76ee\u4e2d\u901a\u7528\u5f02\u5e38\u7684\u5904\u7406\u65b9\u5f0f \u80fd\u591f\u4e86\u89e3\u524d\u7aef\u57fa\u7840\u73af\u5883\u642d\u5efa \u80fd\u591f\u5b8c\u6210\u654f\u611f\u8bcd\u7ba1\u7406\u7684\u5f00\u53d1 \u80fd\u591f\u719f\u6089\u5e38\u7528\u5bc6\u7801\u52a0\u5bc6\u65b9\u5f0f \u80fd\u591f\u5b8c\u6210admin\u7aef\u767b\u5f55\u529f\u80fd \u80fd\u591f\u5b8c\u6210nacos\u6ce8\u518c\u4e2d\u5fc3\u7684\u642d\u5efa(windows)","title":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 01:20"},{"location":"hmtt/day02/#02-_0932","text":"package com.heima.common.exception ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import lombok.extern.log4j.Log4j2 ; import org.springframework.web.bind.annotation.ControllerAdvice ; import org.springframework.web.bind.annotation.ExceptionHandler ; import org.springframework.web.bind.annotation.ResponseBody ; @ControllerAdvice //\u63a7\u5236\u5668\u589e\u5f3a @Log4j2 public class ExceptionCatch { //\u6355\u83b7Exception\u6b64\u7c7b\u5f02\u5e38 @ExceptionHandler ( Exception . class ) @ResponseBody public ResponseResult exception ( Exception exception ) { exception . printStackTrace (); //\u8bb0\u5f55\u65e5\u5fd7 log . error ( \"catch exception:{}\" , exception . getMessage ()); //\u8fd4\u56de\u901a\u7528\u5f02\u5e38 return ResponseResult . errorResult ( AppHttpCodeEnum . SERVER_ERROR ); } } \u8be5\u5f02\u5e38\u5904\u7406\u7c7b\u867d\u7136\u6dfb\u52a0\u4e86\uff0c\u4f46\u662f\u65e0\u6cd5\u76f4\u63a5\u88ab\u52a0\u8f7d\uff0c\u9700\u8981\u5728\u5fae\u670d\u52a1\u4e2d\u7f16\u5199\u914d\u7f6e\u7c7b\u4e3b\u52a8\u52a0\u8f7d package com.heima.admin.config ; import org.springframework.context.annotation.ComponentScan ; import org.springframework.context.annotation.Configuration ; @Configuration @ComponentScan ( \"com.heima.common.exception\" ) public class ExceptionCatchConfig { }","title":"02-\u901a\u7528\u5f02\u5e38\u4ee3\u7801\u7f16\u5199 09:32"},{"location":"hmtt/day02/#03-_0338","text":"","title":"03-\u901a\u7528\u5f02\u5e38\u4ee3\u7801\u6d4b\u8bd5 03:38"},{"location":"hmtt/day02/#04-_0738","text":"node.js webpack \uff1a\u627e\u5230JavaScript\u6a21\u5757\u4ee5\u53ca\u5176\u5b83\u7684\u4e00\u4e9b\u6d4f\u89c8\u5668\u4e0d\u80fd\u76f4\u63a5\u8fd0\u884c\u7684\u62d3\u5c55\u8bed\u8a00\uff08Sass\uff0cTypeScript\u7b49\uff09\uff0c\u5e76\u5c06\u5176\u8f6c\u6362\u548c\u6253\u5305\u4e3a\u5408\u9002\u7684\u683c\u5f0f\u4f9b\u6d4f\u89c8\u5668\u4f7f\u7528\u3002\uff08js css\u7b49\uff09 webpack\u57fa\u4e8enode.js\u8fd0\u884c\uff0c\u9996\u5148\u9700\u8981\u5b89\u88c5node.js\u3002(\u987b\u5b89\u88c5) 1.\u5b89\u88c5node-v9.4.0-x64.msi 2. npm install nrm -g --registry=https://registry.npm.taobao.org // \u5b89\u88c5nrm nrm ls // \u67e5\u770b\u955c\u50cf\u6e90 nrm use taobao // \u9009\u62e9\u6dd8\u5b9d\u955c\u50cf\uff0c\u4e5f\u53ef\u4ee5\u9009\u62e9cnpm cnpm\u4e0d\u652f\u6301\u6709\u4e9b\u547d\u4ee4 npm install webpack@3.6.0 -g","title":"04-\u524d\u7aef\u76f8\u5173\u77e5\u8bc6  07:38"},{"location":"hmtt/day02/#05-admin_0845","text":"\u9ad8\u7248\u672c\u4e0b(node 10+)\u542f\u52a8\u62a5\u9519\uff1a 1.npm rebuild node-sass (\u4ecegithub\u4e0a\u53bb\u4e0b\u8f7d\u5bf9\u5e94\u5305) 2.\u91cd\u88c5node \u53ef\u4ee5\u4f7f\u7528vscode\u542f\u52a8\u9879\u76ee 1.\u4f7f\u7528vscode\u6253\u5f00\u524d\u7aef\u6587\u4ef6\u5939\uff08\u6ce8\u610f\u4e00\u5b9a\u8981\u6253\u5f00\u4e4b\u540e\u786e\u8ba4\u5f53\u524d\u6839\u76ee\u5f55\u4e0b\u6709\u6ca1\u6709package.json\uff09 2.\u4e0a\u65b9\u70b9\u51fbterminal-new terminal 3.\u5728\u4e0b\u65b9\u7684\u63a7\u5236\u53f0\u4e2d\u8f93\u5165npm run dev\u542f\u52a8 \u8bbf\u95eehttp://localhost:8080/","title":"05-admin\u524d\u53f0\u7cfb\u7edf\u642d\u5efa 08:45"},{"location":"hmtt/day02/#06--_0514","text":"package com.heima.apis.admin ; import com.heima.model.admin.dtos.SensitiveDto ; import com.heima.model.admin.pojos.AdSensitive ; import com.heima.model.common.dtos.ResponseResult ; public interface AdSensitiveControllerApi { /** * \u6839\u636e\u540d\u79f0\u5206\u9875\u67e5\u8be2\u654f\u611f\u8bcd * @param dto * @return */ public ResponseResult list ( SensitiveDto dto ); /** * \u65b0\u589e * @param adSensitive * @return */ public ResponseResult save ( AdSensitive adSensitive ); /** * \u4fee\u6539 * @param adSensitive * @return */ public ResponseResult update ( AdSensitive adSensitive ); /** * \u5220\u9664\u654f\u611f\u8bcd * @param id * @return */ public ResponseResult deleteById ( Integer id ); }","title":"06-\u654f\u611f\u8bcd\u7ba1\u7406-\u9700\u6c42\u5206\u6790\u53ca\u63a5\u53e3\u5b9a\u4e49 05:14"},{"location":"hmtt/day02/#07--_0843","text":"@Override public ResponseResult list ( SensitiveDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //\u6821\u9a8cpage size\u5408\u6cd5\u503c dto . checkParam (); //2.\u6839\u636e\u540d\u79f0\u6a21\u7cca\u5206\u9875\u67e5\u8be2 Page page = new Page <> ( dto . getPage (), dto . getSize ()); LambdaQueryWrapper < AdSensitive > lambdaQueryWrapper = new LambdaQueryWrapper (); if ( StringUtils . isNotBlank ( dto . getName ())){ lambdaQueryWrapper . like ( AdSensitive :: getSensitives , dto . getName ()); } IPage result = page ( page , lambdaQueryWrapper ); //3.\u7ed3\u679c\u8fd4\u56de ResponseResult responseResult = new PageResponseResult ( dto . getPage (), dto . getSize (),( int ) result . getTotal ()); responseResult . setData ( result . getRecords ()); return responseResult ; }","title":"07-\u654f\u611f\u8bcd\u7ba1\u7406-\u5217\u8868\u67e5\u8be2 08:43"},{"location":"hmtt/day02/#08-_0540","text":"@Override public ResponseResult insert ( AdSensitive adSensitive ) { //1.\u53c2\u6570\u68c0\u67e5 if ( adSensitive == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u4fdd\u5b58 adSensitive . setCreatedTime ( new Date ()); save ( adSensitive ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } @Override public ResponseResult update ( AdSensitive adSensitive ) { //1.\u53c2\u6570\u68c0\u67e5 if ( adSensitive == null || adSensitive . getId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u4fee\u6539 updateById ( adSensitive ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } @Override public ResponseResult deleteById ( Integer id ) { //1.\u53c2\u6570\u68c0\u67e5 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u5224\u65ad\u5f53\u524d\u654f\u611f\u8bcd\u662f\u5426\u5b58\u5728 AdSensitive adSensitive = getById ( id ); if ( adSensitive == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST ); } //3.\u5220\u9664\u64cd\u4f5c removeById ( id ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); }","title":"08-\u65b0\u589e\u4fee\u6539\u5220\u9664 05:40"},{"location":"hmtt/day02/#09-_0326","text":"config/index.js\u4e2d\u58f0\u660e\u4e86\u63a5\u53e3\u5730\u5740\uff1a proxyTable : { '/service_9001' : { target : 'http://localhost:9001/' , // \u6e90\u5730\u5740 changeOrigin : true , // \u6539\u53d8\u6e90 pathRewrite : { '^/service_9001' : '' } }, '/service_9002' : { target : 'http://localhost:9002/' , // \u6e90\u5730\u5740 changeOrigin : true , // \u6539\u53d8\u6e90 pathRewrite : { '^/service_9002' : '' } }, '/server_85/WEBSOCKET' : { target : 'http://localhost:9009/' , // \u6e90\u5730\u5740 changeOrigin : true , // \u6539\u53d8\u6e90 pathRewrite : { '^/server_85/WEBSOCKET' : '' } }","title":"09-\u654f\u611f\u8bcd\u529f\u80fd\u4e0e\u524d\u53f0\u7cfb\u7edf\u7efc\u5408\u6d4b\u8bd5     03:26"},{"location":"hmtt/day02/#10-_0543","text":"","title":"10-\u5e38\u89c1\u7684\u52a0\u5bc6\u65b9\u5f0f 05:43"},{"location":"hmtt/day02/#_1","text":"","title":"\u53ef\u9006\u52a0\u5bc6\u7b97\u6cd5"},{"location":"hmtt/day02/#_2","text":"\u4e00\u822c\u7528\u4e8e\u4fdd\u5b58\u7528\u6237\u624b\u673a\u53f7\u3001\u8eab\u4efd\u8bc1\u7b49\u654f\u611f\u4f46\u80fd\u89e3\u5bc6\u7684\u4fe1\u606f\u3002 AES\u3001DES\u30013DES\u3001Blowfish\u3001IDEA\u3001RC4\u3001RC5\u3001RC6\u3001HS256","title":"\u5bf9\u79f0\u52a0\u5bc6"},{"location":"hmtt/day02/#_3","text":"\u4e00\u822c\u7528\u4e8e\u7b7e\u540d\u548c\u8ba4\u8bc1\u3002\u79c1\u94a5\u670d\u52a1\u5668\u4fdd\u5b58, \u7528\u6765\u52a0\u5bc6, \u516c\u94a5\u5ba2\u6237\u62ff\u7740\u7528\u4e8e\u5bf9\u4e8e\u4ee4\u724c\u6216\u8005\u7b7e\u540d\u7684\u89e3\u5bc6\u6216\u8005\u6821\u9a8c\u4f7f\u7528. RSA\u3001DSA\uff08\u6570\u5b57\u7b7e\u540d\u7528\uff09\u3001ECC\uff08\u79fb\u52a8\u8bbe\u5907\u7528\uff09\u3001RS256 (\u91c7\u7528SHA-256 \u7684 RSA \u7b7e\u540d)","title":"\u975e\u5bf9\u79f0\u52a0\u5bc6"},{"location":"hmtt/day02/#_4","text":"\u4e00\u822c\u7528\u4e8e\u6548\u9a8c\u4e0b\u8f7d\u6587\u4ef6\u6b63\u786e\u6027\uff0c\u4e00\u822c\u5728\u7f51\u7ad9\u4e0a\u4e0b\u8f7d\u6587\u4ef6\u90fd\u80fd\u89c1\u5230\uff1b\u5b58\u50a8\u7528\u6237\u654f\u611f\u4fe1\u606f\uff0c\u5982\u5bc6\u7801\u3001 \u5361\u53f7\u7b49\u4e0d\u53ef\u89e3\u5bc6\u7684\u4fe1\u606f\u3002 MD5\u3001SHA\u3001HMAC Base64 Base64\u662f\u7f51\u7edc\u4e0a\u6700\u5e38\u89c1\u7684\u7528\u4e8e\u4f20\u8f938Bit\u5b57\u8282\u4ee3\u7801\u7684\u7f16\u7801\u65b9\u5f0f\u4e4b\u4e00\u3002Base64\u7f16\u7801\u53ef\u7528\u4e8e\u5728HTTP\u73af\u5883\u4e0b\u4f20\u9012\u8f83\u957f\u7684\u6807\u8bc6\u4fe1\u606f\u3002\u91c7\u7528Base64Base64\u7f16\u7801\u89e3\u7801\u5177\u6709\u4e0d\u53ef\u8bfb\u6027\uff0c\u5373\u6240\u7f16\u7801\u7684\u6570\u636e\u4e0d\u4f1a\u88ab\u4eba\u7528\u8089\u773c\u6240\u76f4\u63a5\u770b\u5230\u3002 \u6ce8\u610f\uff1aBase64\u53ea\u662f\u4e00\u79cd\u7f16\u7801\u65b9\u5f0f\uff0c\u4e0d\u7b97\u52a0\u5bc6\u65b9\u6cd5\u3002 \u5bf9\u8bc1\u4e66\u6765\u8bf4\uff0c\u7279\u522b\u662f\u6839\u8bc1\u4e66\uff0c\u4e00\u822c\u90fd\u662f\u4f5cBase64\u7f16\u7801\u7684\uff0c\u56e0\u4e3a\u5b83\u8981\u5728\u7f51\u4e0a\u88ab\u8bb8\u591a\u4eba\u4e0b\u8f7d\u3002\u7535\u5b50\u90ae\u4ef6\u7684\u9644\u4ef6\u4e00\u822c\u4e5f\u4f5cBase64\u7f16\u7801\u7684\uff0c\u56e0\u4e3a\u4e00\u4e2a\u9644\u4ef6\u6570\u636e\u5f80\u5f80\u662f\u6709\u4e0d\u53ef\u89c1\u5b57\u7b26\u7684\u3002","title":"\u4e0d\u53ef\u9006\u52a0\u5bc6\u7b97\u6cd5"},{"location":"hmtt/day02/#_5","text":"\u6211\u4eec\u77e5\u9053\u5728\u8ba1\u7b97\u673a\u4e2d\u4efb\u4f55\u6570\u636e\u90fd\u662f\u6309ascii\u7801\u5b58\u50a8\u7684\uff0c\u800cascii\u7801\u7684128\uff5e255\u4e4b\u95f4\u7684\u503c\u662f\u4e0d\u53ef\u89c1\u5b57\u7b26\u3002\u800c\u5728\u7f51\u7edc\u4e0a\u4ea4\u6362\u6570\u636e\u65f6\uff0c\u6bd4\u5982\u8bf4\u4eceA\u5730\u4f20\u5230B\u5730\uff0c\u5f80\u5f80\u8981\u7ecf\u8fc7\u591a\u4e2a\u8def\u7531\u8bbe\u5907\uff0c\u7531\u4e8e\u4e0d\u540c\u7684\u8bbe\u5907\u5bf9\u5b57\u7b26\u7684\u5904\u7406\u65b9\u5f0f\u6709\u4e00\u4e9b\u4e0d\u540c\uff0c\u8fd9\u6837\u90a3\u4e9b\u4e0d\u53ef\u89c1\u5b57\u7b26\u5c31\u6709\u53ef\u80fd\u88ab\u5904\u7406\u9519\u8bef\uff0c\u8fd9\u662f\u4e0d\u5229\u4e8e\u4f20\u8f93\u7684\u3002\u6240\u4ee5\u5c31\u5148\u628a\u6570\u636e\u5148\u505a\u4e00\u4e2aBase64\u7f16\u7801\uff0c\u7edf\u7edf\u53d8\u6210\u53ef\u89c1\u5b57\u7b26\uff0c\u8fd9\u6837\u51fa\u9519\u7684\u53ef\u80fd\u6027\u5c31\u5927\u964d\u4f4e\u4e86\u3002","title":"\u4e00\u4e9b\u8bc1\u4e66\u4e5f\u597d\uff0c\u7535\u5b50\u90ae\u4ef6\u6570\u636e\u4e5f\u597d\uff0c\u90a3\u4e48\u4e3a\u4ec0\u4e48\u8981\u4f5c\u4e00\u4e0b\u8fd9\u6837\u7684\u7f16\u7801\u5462"},{"location":"hmtt/day02/#base64","text":"\u7b80\u5355\u6765\u8bf4\uff0c\u4efb\u4f55\u4e00\u4e2a\u6570\u636e\u65e0\u975e\u53ef\u4ee5\u770b\u4f5c\u4e00\u4e2a\u6bd4\u7279\u6d41\uff0c\u598201000100010011101100111010111100011001010\u2026\u2026\u90a3\u4e48\u6211\u4eec\u53d66\u4e2a\u6bd4\u7279\u4e3a\u4e00\u7ec4\uff0c\u8ba1\u7b97\u5b83\u7684ascii\u503c\uff0c\u5f97\u5230\u4e00\u4e2a\u5b57\u7b26\uff0c\u8fd9\u4e2a\u5b57\u7b26\u80af\u5b9a\u662f\u53ef\u89c1\u5b57\u7b26\uff0c\u597d\uff0c\u628a\u5b83\u5bf9\u5e94\u7684\u5b57\u7b26\u5199\u51fa\u6765\uff0c\u518d\u53d66\u4e2a\u6bd4\u7279\uff0c\u8ba1\u7b97\u2026\uff0c\u5982\u6b64\u4e0b\u53bb\uff0c\u76f4\u5230\u6700\u540e\uff0c\u5c31\u5b8c\u6210\u4e86\u7f16\u7801\u3002 \u6807\u51c6base64\u53ea\u670964\u4e2a\u5b57\u7b26\uff08\u82f1\u6587\u5927\u5c0f\u5199\u3001\u6570\u5b57\u548c+\u3001/\uff09\u4ee5\u53ca\u7528\u4f5c\u540e\u7f00\u7b49\u53f7\uff1b base64\u662f\u628a3\u4e2a\u5b57\u8282\u53d8\u62104\u4e2a\u53ef\u6253\u5370\u5b57\u7b26\uff0c\u6240\u4ee5base64\u7f16\u7801\u540e\u7684\u5b57\u7b26\u4e32\u4e00\u5b9a\u80fd\u88ab4\u6574\u9664\uff08\u4e0d\u7b97\u7528\u4f5c\u540e\u7f00\u7684\u7b49\u53f7\uff09\uff1b \u7b49\u53f7\u4e00\u5b9a\u7528\u4f5c\u540e\u7f00\uff0c\u4e14\u6570\u76ee\u4e00\u5b9a\u662f0\u4e2a\u30011\u4e2a\u62162\u4e2a\u3002\u8fd9\u662f\u56e0\u4e3a\u5982\u679c\u539f\u6587\u957f\u5ea6\u4e0d\u80fd\u88ab3\u6574\u9664\uff0cbase64\u8981\u5728\u540e\u9762\u6dfb\u52a0\\0\u51d1\u9f503n\u4f4d\u3002\u4e3a\u4e86\u6b63\u786e\u8fd8\u539f\uff0c\u6dfb\u52a0\u4e86\u51e0\u4e2a\\0\u5c31\u52a0\u4e0a\u51e0\u4e2a\u7b49\u53f7\u3002\u663e\u7136\u6dfb\u52a0\u7b49\u53f7\u7684\u6570\u76ee\u53ea\u80fd\u662f0\u30011\u62162\uff1b \u4e25\u683c\u6765\u8bf4base64\u4e0d\u80fd\u7b97\u662f\u4e00\u79cd\u52a0\u5bc6\uff0c\u53ea\u80fd\u8bf4\u662f\u7f16\u7801\u8f6c\u6362\u3002\u4f7f\u7528base64\u7684\u521d\u8877\u3002\u662f\u4e3a\u4e86\u65b9\u4fbf\u628a\u542b\u6709\u4e0d\u53ef\u89c1\u5b57\u7b26\u4e32\u7684\u4fe1\u606f\u7528\u53ef\u89c1\u5b57\u7b26\u4e32\u8868\u793a\u51fa\u6765\uff0c\u4ee5\u4fbf\u590d\u5236\u7c98\u8d34\uff1b \u6bd4\u5982\u6570\u636e\u5e93\u4e2d\u5c31\u53ef\u4ee5\u5b58\u653e\u56fe\u7247\u4e86\uff0c\u4f7f\u7528base64\u7f16\u7801\u4e4b\u540e\u5199\u5165\u6570\u636e\u5e93\uff0c\u4ee5text\u65b9\u5f0f\u5b58\u653e \u5728\u7ebf\u7f16\u7801\u5de5\u5177\uff1a http://www.jsons.cn/img2base64/","title":"\u90a3\u4e48Base64\u5230\u5e95\u662f\u600e\u6837\u7f16\u7801\u7684\u5462\uff1f"},{"location":"hmtt/day02/#11-_1330","text":"package com.heima.password.test ; import com.heima.utils.common.BCrypt ; import com.heima.utils.common.MD5Utils ; import org.apache.commons.lang3.RandomStringUtils ; import org.springframework.util.DigestUtils ; public class MD5Test { public static void main ( String [] args ) { //md5\u52a0\u5bc6 DegestUtils\uff1aspring\u6846\u67b6\u63d0\u4f9b\u7684\u5de5\u5177\u7c7b //String md5Str = DigestUtils.md5DigestAsHex(\"abc\".getBytes()); //System.out.println(md5Str);//900150983cd24fb0d6963f7d28e17f72 //uername:zhangsan password:123 salt:\u968f\u65f6\u5b57\u7b26\u4e32 String salt = RandomStringUtils . randomAlphanumeric ( 10 ); System . out . println ( salt ); String pswd = \"123\" + salt ; String saltPswd = DigestUtils . md5DigestAsHex ( pswd . getBytes ()); System . out . println ( saltPswd ) /* String gensalt = BCrypt.gensalt();//\u8fd9\u4e2a\u662f\u76d0 29\u4e2a\u5b57\u7b26\uff0c\u968f\u673a\u751f\u6210 System.out.println(gensalt); String password = BCrypt.hashpw(\"123456\", gensalt); //\u6839\u636e\u76d0\u5bf9\u5bc6\u7801\u8fdb\u884c\u52a0\u5bc6 System.out.println(password);//\u52a0\u5bc6\u540e\u7684\u5b57\u7b26\u4e32\u524d29\u4f4d\u5c31\u662fd*/ boolean checkpw = BCrypt . checkpw ( \"123456\" , password ); System . out . println ( checkpw ); String abc = MD5Utils . encodeWithSalt ( \"admin\" , \"123abc\" ); System . out . println ( abc ); } }","title":"11-\u5bc6\u7801\u52a0\u5bc6\u53ca\u5bc6\u7801\u52a0\u5bc6\u65b9\u5f0f\u9009\u578b 13:30"},{"location":"hmtt/day02/#12-token_0225","text":"HTTP\u8bf7\u6c42 \u65e0\u72b6\u6001\uff1f","title":"12-token\u8ba4\u8bc1\u6d41\u7a0b 02:25"},{"location":"hmtt/day02/#13-jwt_1050","text":"Json web token (JWT), \u662f\u4e3a\u4e86\u5728\u7f51\u7edc\u5e94\u7528\u73af\u5883\u95f4\u4f20\u9012\u58f0\u660e\u800c\u6267\u884c\u7684\u4e00\u79cd\u57fa\u4e8eJSON\u7684\u5f00\u653e\u6807\u51c6\uff08 (RFC 7519 ).\u8be5token\u88ab\u8bbe\u8ba1\u4e3a\u7d27\u51d1\u4e14\u5b89\u5168\u7684\uff0c\u7279\u522b\u9002\u7528\u4e8e\u5206\u5e03\u5f0f\u7ad9\u70b9\u7684\u5355\u70b9\u767b\u5f55\uff08SSO\uff09\u573a\u666f\u3002JWT\u7684\u58f0\u660e\u4e00\u822c\u88ab\u7528\u6765\u5728\u8eab\u4efd\u63d0\u4f9b\u8005\u548c\u670d\u52a1\u63d0\u4f9b\u8005\u95f4\u4f20\u9012\u88ab\u8ba4\u8bc1\u7684\u7528\u6237\u8eab\u4efd\u4fe1\u606f\uff0c\u4ee5\u4fbf\u4e8e\u4ece\u8d44\u6e90\u670d\u52a1\u5668\u83b7\u53d6\u8d44\u6e90\uff0c\u4e5f\u53ef\u4ee5\u589e\u52a0\u4e00\u4e9b\u989d\u5916\u7684\u5176\u5b83\u4e1a\u52a1\u903b\u8f91\u6240\u5fc5\u987b\u7684\u58f0\u660e\u4fe1\u606f\uff0c\u8be5token\u4e5f\u53ef\u76f4\u63a5\u88ab\u7528\u4e8e\u8ba4\u8bc1\uff0c\u4e5f\u53ef\u88ab\u52a0\u5bc6\u3002","title":"13-JWT\u4ecb\u7ecd\u53ca\u751f\u6210\u548c\u89e3\u6790 10:50"},{"location":"hmtt/day02/#_6","text":"\u8bf4\u8d77JWT\uff0c\u6211\u4eec\u5e94\u8be5\u6765\u8c08\u4e00\u8c08\u57fa\u4e8etoken\u7684\u8ba4\u8bc1\u548c\u4f20\u7edf\u7684session\u8ba4\u8bc1\u7684\u533a\u522b\u3002","title":"\u8d77\u6e90"},{"location":"hmtt/day02/#session","text":"\u6211\u4eec\u77e5\u9053\uff0chttp\u534f\u8bae\u672c\u8eab\u662f\u4e00\u79cd\u65e0\u72b6\u6001\u7684\u534f\u8bae\uff0c\u800c\u8fd9\u5c31\u610f\u5473\u7740\u5982\u679c\u7528\u6237\u5411\u6211\u4eec\u7684\u5e94\u7528\u63d0\u4f9b\u4e86\u7528\u6237\u540d\u548c\u5bc6\u7801\u6765\u8fdb\u884c\u7528\u6237\u8ba4\u8bc1\uff0c\u90a3\u4e48\u4e0b\u4e00\u6b21\u8bf7\u6c42\u65f6\uff0c\u7528\u6237\u8fd8\u8981\u518d\u4e00\u6b21\u8fdb\u884c\u7528\u6237\u8ba4\u8bc1\u624d\u884c\uff0c\u56e0\u4e3a\u6839\u636ehttp\u534f\u8bae\uff0c\u6211\u4eec\u5e76\u4e0d\u80fd\u77e5\u9053\u662f\u54ea\u4e2a\u7528\u6237\u53d1\u51fa\u7684\u8bf7\u6c42\uff0c\u6240\u4ee5\u4e3a\u4e86\u8ba9\u6211\u4eec\u7684\u5e94\u7528\u80fd\u8bc6\u522b\u662f\u54ea\u4e2a\u7528\u6237\u53d1\u51fa\u7684\u8bf7\u6c42\uff0c\u6211\u4eec\u53ea\u80fd\u5728\u670d\u52a1\u5668\u5b58\u50a8\u4e00\u4efd\u7528\u6237\u767b\u5f55\u7684\u4fe1\u606f\uff0c\u8fd9\u4efd\u767b\u5f55\u4fe1\u606f\u4f1a\u5728\u54cd\u5e94\u65f6\u4f20\u9012\u7ed9\u6d4f\u89c8\u5668\uff0c\u544a\u8bc9\u5176\u4fdd\u5b58\u4e3acookie,\u4ee5\u4fbf\u4e0b\u6b21\u8bf7\u6c42\u65f6\u53d1\u9001\u7ed9\u6211\u4eec\u7684\u5e94\u7528\uff0c\u8fd9\u6837\u6211\u4eec\u7684\u5e94\u7528\u5c31\u80fd\u8bc6\u522b\u8bf7\u6c42\u6765\u81ea\u54ea\u4e2a\u7528\u6237\u4e86,\u8fd9\u5c31\u662f\u4f20\u7edf\u7684\u57fa\u4e8esession\u8ba4\u8bc1\u3002 \u4f46\u662f\u8fd9\u79cd\u57fa\u4e8esession\u7684\u8ba4\u8bc1\u4f7f\u5e94\u7528\u672c\u8eab\u5f88\u96be\u5f97\u5230\u6269\u5c55\uff0c\u968f\u7740\u4e0d\u540c\u5ba2\u6237\u7aef\u7528\u6237\u7684\u589e\u52a0\uff0c\u72ec\u7acb\u7684\u670d\u52a1\u5668\u5df2\u65e0\u6cd5\u627f\u8f7d\u66f4\u591a\u7684\u7528\u6237\uff0c\u800c\u8fd9\u65f6\u5019\u57fa\u4e8esession\u8ba4\u8bc1\u5e94\u7528\u7684\u95ee\u9898\u5c31\u4f1a\u66b4\u9732\u51fa\u6765.","title":"\u4f20\u7edf\u7684session\u8ba4\u8bc1"},{"location":"hmtt/day02/#session_1","text":"Session : \u6bcf\u4e2a\u7528\u6237\u7ecf\u8fc7\u6211\u4eec\u7684\u5e94\u7528\u8ba4\u8bc1\u4e4b\u540e\uff0c\u6211\u4eec\u7684\u5e94\u7528\u90fd\u8981\u5728\u670d\u52a1\u7aef\u505a\u4e00\u6b21\u8bb0\u5f55\uff0c\u4ee5\u65b9\u4fbf\u7528\u6237\u4e0b\u6b21\u8bf7\u6c42\u7684\u9274\u522b\uff0c\u901a\u5e38\u800c\u8a00session\u90fd\u662f\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u800c\u968f\u7740\u8ba4\u8bc1\u7528\u6237\u7684\u589e\u591a\uff0c\u670d\u52a1\u7aef\u7684\u5f00\u9500\u4f1a\u660e\u663e\u589e\u5927\u3002 \u6269\u5c55\u6027 : \u7528\u6237\u8ba4\u8bc1\u4e4b\u540e\uff0c\u670d\u52a1\u7aef\u505a\u8ba4\u8bc1\u8bb0\u5f55\uff0c\u5982\u679c\u8ba4\u8bc1\u7684\u8bb0\u5f55\u88ab\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u7684\u8bdd\uff0c\u8fd9\u610f\u5473\u7740\u7528\u6237\u4e0b\u6b21\u8bf7\u6c42\u8fd8\u5fc5\u987b\u8981\u8bf7\u6c42\u5728\u8fd9\u53f0\u670d\u52a1\u5668\u4e0a,\u8fd9\u6837\u624d\u80fd\u62ff\u5230\u6388\u6743\u7684\u8d44\u6e90\uff0c\u8fd9\u6837\u5728\u5206\u5e03\u5f0f\u7684\u5e94\u7528\u4e0a\uff0c\u76f8\u5e94\u7684\u9650\u5236\u4e86\u8d1f\u8f7d\u5747\u8861\u5668\u7684\u80fd\u529b\u3002\u8fd9\u4e5f\u610f\u5473\u7740\u9650\u5236\u4e86\u5e94\u7528\u7684\u6269\u5c55\u80fd\u529b\u3002 CSRF : \u56e0\u4e3a\u662f\u57fa\u4e8ecookie\u6765\u8fdb\u884c\u7528\u6237\u8bc6\u522b\u7684, cookie\u5982\u679c\u88ab\u622a\u83b7\uff0c\u7528\u6237\u5c31\u4f1a\u5f88\u5bb9\u6613\u53d7\u5230\u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020\u7684\u653b\u51fb\u3002","title":"\u57fa\u4e8esession\u8ba4\u8bc1\u6240\u663e\u9732\u7684\u95ee\u9898"},{"location":"hmtt/day02/#token","text":"\u57fa\u4e8etoken\u7684\u9274\u6743\u673a\u5236\u7c7b\u4f3c\u4e8ehttp\u534f\u8bae\u4e5f\u662f\u65e0\u72b6\u6001\u7684\uff0c\u5b83\u4e0d\u9700\u8981\u5728\u670d\u52a1\u7aef\u53bb\u4fdd\u7559\u7528\u6237\u7684\u8ba4\u8bc1\u4fe1\u606f\u6216\u8005\u4f1a\u8bdd\u4fe1\u606f\u3002\u8fd9\u5c31\u610f\u5473\u7740\u57fa\u4e8etoken\u8ba4\u8bc1\u673a\u5236\u7684\u5e94\u7528\u4e0d\u9700\u8981\u53bb\u8003\u8651\u7528\u6237\u5728\u54ea\u4e00\u53f0\u670d\u52a1\u5668\u767b\u5f55\u4e86\uff0c\u8fd9\u5c31\u4e3a\u5e94\u7528\u7684\u6269\u5c55\u63d0\u4f9b\u4e86\u4fbf\u5229\u3002 \u6d41\u7a0b\u4e0a\u662f\u8fd9\u6837\u7684\uff1a \u7528\u6237\u4f7f\u7528\u7528\u6237\u540d\u5bc6\u7801\u6765\u8bf7\u6c42\u670d\u52a1\u5668 \u670d\u52a1\u5668\u8fdb\u884c\u9a8c\u8bc1\u7528\u6237\u7684\u4fe1\u606f \u670d\u52a1\u5668\u901a\u8fc7\u9a8c\u8bc1\u53d1\u9001\u7ed9\u7528\u6237\u4e00\u4e2atoken \u5ba2\u6237\u7aef\u5b58\u50a8token\uff0c\u5e76\u5728\u6bcf\u6b21\u8bf7\u6c42\u65f6\u9644\u9001\u4e0a\u8fd9\u4e2atoken\u503c \u670d\u52a1\u7aef\u9a8c\u8bc1token\u503c\uff0c\u5e76\u8fd4\u56de\u6570\u636e \u8fd9\u4e2atoken\u5fc5\u987b\u8981\u5728\u6bcf\u6b21\u8bf7\u6c42\u65f6\u4f20\u9012\u7ed9\u670d\u52a1\u7aef\uff0c\u5b83\u5e94\u8be5\u4fdd\u5b58\u5728\u8bf7\u6c42\u5934\u91cc\uff0c \u53e6\u5916\uff0c\u670d\u52a1\u7aef\u8981\u652f\u6301 CORS(\u8de8\u6765\u6e90\u8d44\u6e90\u5171\u4eab) \u7b56\u7565\uff0c\u4e00\u822c\u6211\u4eec\u5728\u670d\u52a1\u7aef\u8fd9\u4e48\u505a\u5c31\u53ef\u4ee5\u4e86 Access-Control-Allow-Origin: * \u3002 \u90a3\u4e48\u6211\u4eec\u73b0\u5728\u56de\u5230JWT\u7684\u4e3b\u9898\u4e0a\u3002","title":"\u57fa\u4e8etoken\u7684\u9274\u6743\u673a\u5236"},{"location":"hmtt/day02/#jwt","text":"JWT\u662f\u7531\u4e09\u6bb5\u4fe1\u606f\u6784\u6210\u7684\uff0c\u5c06\u8fd9\u4e09\u6bb5\u4fe1\u606f\u6587\u672c\u7528 . \u94fe\u63a5\u4e00\u8d77\u5c31\u6784\u6210\u4e86Jwt\u5b57\u7b26\u4e32\u3002\u5c31\u50cf\u8fd9\u6837: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9 . eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9 . TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ","title":"JWT\u957f\u4ec0\u4e48\u6837\uff1f"},{"location":"hmtt/day02/#jwt_1","text":"\u7b2c\u4e00\u90e8\u5206\u6211\u4eec\u79f0\u5b83\u4e3a\u5934\u90e8\uff08header),\u7b2c\u4e8c\u90e8\u5206\u6211\u4eec\u79f0\u5176\u4e3a\u8f7d\u8377\uff08payload, \u7c7b\u4f3c\u4e8e\u98de\u673a\u4e0a\u627f\u8f7d\u7684\u7269\u54c1)\uff0c\u7b2c\u4e09\u90e8\u5206\u662f\u7b7e\u8bc1\uff08signature).","title":"JWT\u7684\u6784\u6210"},{"location":"hmtt/day02/#header","text":"jwt\u7684\u5934\u90e8\u627f\u8f7d\u4e24\u90e8\u5206\u4fe1\u606f\uff1a \u58f0\u660e\u7c7b\u578b\uff0c\u8fd9\u91cc\u662fjwt \u58f0\u660e\u52a0\u5bc6\u7684\u7b97\u6cd5 \u901a\u5e38\u76f4\u63a5\u4f7f\u7528 HMAC SHA256 \u5b8c\u6574\u7684\u5934\u90e8\u5c31\u50cf\u4e0b\u9762\u8fd9\u6837\u7684JSON\uff1a { 'typ' : 'JWT' , 'alg' : 'HS256' } \u7136\u540e\u5c06\u5934\u90e8\u8fdb\u884cbase64\u52a0\u5bc6\uff08\u8be5\u52a0\u5bc6\u662f\u53ef\u4ee5\u5bf9\u79f0\u89e3\u5bc6\u7684),\u6784\u6210\u4e86\u7b2c\u4e00\u90e8\u5206. eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9","title":"header"},{"location":"hmtt/day02/#payload","text":"\u8f7d\u8377\u5c31\u662f\u5b58\u653e\u6709\u6548\u4fe1\u606f\u7684\u5730\u65b9\u3002\u8fd9\u4e2a\u540d\u5b57\u50cf\u662f\u7279\u6307\u98de\u673a\u4e0a\u627f\u8f7d\u7684\u8d27\u54c1\uff0c\u8fd9\u4e9b\u6709\u6548\u4fe1\u606f\u5305\u542b\u4e09\u4e2a\u90e8\u5206 \u6807\u51c6\u4e2d\u6ce8\u518c\u7684\u58f0\u660e \u516c\u5171\u7684\u58f0\u660e \u79c1\u6709\u7684\u58f0\u660e \u6807\u51c6\u4e2d\u6ce8\u518c\u7684\u58f0\u660e (\u5efa\u8bae\u4f46\u4e0d\u5f3a\u5236\u4f7f\u7528) \uff1a iss : jwt\u7b7e\u53d1\u8005 sub : jwt\u6240\u9762\u5411\u7684\u7528\u6237 aud : \u63a5\u6536jwt\u7684\u4e00\u65b9 exp : jwt\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u8fd9\u4e2a\u8fc7\u671f\u65f6\u95f4\u5fc5\u987b\u8981\u5927\u4e8e\u7b7e\u53d1\u65f6\u95f4 nbf : \u5b9a\u4e49\u5728\u4ec0\u4e48\u65f6\u95f4\u4e4b\u524d\uff0c\u8be5jwt\u90fd\u662f\u4e0d\u53ef\u7528\u7684. iat : jwt\u7684\u7b7e\u53d1\u65f6\u95f4 jti : jwt\u7684\u552f\u4e00\u8eab\u4efd\u6807\u8bc6\uff0c\u4e3b\u8981\u7528\u6765\u4f5c\u4e3a\u4e00\u6b21\u6027token,\u4ece\u800c\u56de\u907f\u91cd\u653e\u653b\u51fb\u3002 \u516c\u5171\u7684\u58f0\u660e \uff1a \u516c\u5171\u7684\u58f0\u660e\u53ef\u4ee5\u6dfb\u52a0\u4efb\u4f55\u7684\u4fe1\u606f\uff0c\u4e00\u822c\u6dfb\u52a0\u7528\u6237\u7684\u76f8\u5173\u4fe1\u606f\u6216\u5176\u4ed6\u4e1a\u52a1\u9700\u8981\u7684\u5fc5\u8981\u4fe1\u606f.\u4f46\u4e0d\u5efa\u8bae\u6dfb\u52a0\u654f\u611f\u4fe1\u606f\uff0c\u56e0\u4e3a\u8be5\u90e8\u5206\u5728\u5ba2\u6237\u7aef\u53ef\u89e3\u5bc6. \u79c1\u6709\u7684\u58f0\u660e \uff1a \u79c1\u6709\u58f0\u660e\u662f\u63d0\u4f9b\u8005\u548c\u6d88\u8d39\u8005\u6240\u5171\u540c\u5b9a\u4e49\u7684\u58f0\u660e\uff0c\u4e00\u822c\u4e0d\u5efa\u8bae\u5b58\u653e\u654f\u611f\u4fe1\u606f\uff0c\u56e0\u4e3abase64\u662f\u5bf9\u79f0\u89e3\u5bc6\u7684\uff0c\u610f\u5473\u7740\u8be5\u90e8\u5206\u4fe1\u606f\u53ef\u4ee5\u5f52\u7c7b\u4e3a\u660e\u6587\u4fe1\u606f\u3002 \u5b9a\u4e49\u4e00\u4e2apayload: { \"sub\" : \"1234567890\" , \"name\" : \"John Doe\" , \"admin\" : true , \"userData\" : { \"id\" : 100 , userName : \"zhangsan\" } } \u7136\u540e\u5c06\u5176\u8fdb\u884cbase64\u52a0\u5bc6\uff0c\u5f97\u5230Jwt\u7684\u7b2c\u4e8c\u90e8\u5206\u3002 eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9","title":"payload"},{"location":"hmtt/day02/#signature","text":"jwt\u7684\u7b2c\u4e09\u90e8\u5206\u662f\u4e00\u4e2a\u7b7e\u8bc1\u4fe1\u606f\uff0c\u8fd9\u4e2a\u7b7e\u8bc1\u4fe1\u606f\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff1a header (base64\u540e\u7684) payload (base64\u540e\u7684) secret \u8fd9\u4e2a\u90e8\u5206\u9700\u8981base64\u52a0\u5bc6\u540e\u7684header\u548cbase64\u52a0\u5bc6\u540e\u7684payload\u4f7f\u7528 . \u8fde\u63a5\u7ec4\u6210\u7684\u5b57\u7b26\u4e32\uff0c\u7136\u540e\u901a\u8fc7header\u4e2d\u58f0\u660e\u7684\u52a0\u5bc6\u65b9\u5f0f\u8fdb\u884c\u52a0\u76d0 secret \u7ec4\u5408\u52a0\u5bc6\uff0c\u7136\u540e\u5c31\u6784\u6210\u4e86jwt\u7684\u7b2c\u4e09\u90e8\u5206\u3002 // javascript var encodedString = base64UrlEncode ( header ) + '.' + base64UrlEncode ( payload ); var signature = HMACSHA256 ( encodedString , ' secret ' ); // TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ \u5c06\u8fd9\u4e09\u90e8\u5206\u7528 . \u8fde\u63a5\u6210\u4e00\u4e2a\u5b8c\u6574\u7684\u5b57\u7b26\u4e32,\u6784\u6210\u4e86\u6700\u7ec8\u7684jwt: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9 . eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9 . TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ \u6ce8\u610f\uff1asecret\u662f\u4fdd\u5b58\u5728\u670d\u52a1\u5668\u7aef\u7684\uff0cjwt\u7684\u7b7e\u53d1\u751f\u6210\u4e5f\u662f\u5728\u670d\u52a1\u5668\u7aef\u7684\uff0csecret\u5c31\u662f\u7528\u6765\u8fdb\u884cjwt\u7684\u7b7e\u53d1\u548cjwt\u7684\u9a8c\u8bc1\uff0c\u6240\u4ee5\uff0c\u5b83\u5c31\u662f\u4f60\u670d\u52a1\u7aef\u7684\u79c1\u94a5\uff0c\u5728\u4efb\u4f55\u573a\u666f\u90fd\u4e0d\u5e94\u8be5\u6d41\u9732\u51fa\u53bb\u3002\u4e00\u65e6\u5ba2\u6237\u7aef\u5f97\u77e5\u8fd9\u4e2asecret, \u90a3\u5c31\u610f\u5473\u7740\u5ba2\u6237\u7aef\u662f\u53ef\u4ee5\u81ea\u6211\u7b7e\u53d1jwt\u4e86\u3002","title":"signature"},{"location":"hmtt/day02/#_7","text":"\u4e00\u822c\u662f\u5728\u8bf7\u6c42\u5934\u91cc\u52a0\u5165 Authorization \uff0c\u5e76\u52a0\u4e0a Bearer \u6807\u6ce8\uff1a fetch ( 'api/user/1' , { headers: { 'Authorization' : 'Bearer ' + token } }) \u670d\u52a1\u7aef\u4f1a\u9a8c\u8bc1token\uff0c\u5982\u679c\u9a8c\u8bc1\u901a\u8fc7\u5c31\u4f1a\u8fd4\u56de\u76f8\u5e94\u7684\u8d44\u6e90\u3002\u6574\u4e2a\u6d41\u7a0b\u5c31\u662f\u8fd9\u6837\u7684: jwt-diagram","title":"\u5982\u4f55\u5e94\u7528"},{"location":"hmtt/day02/#_8","text":"","title":"\u603b\u7ed3"},{"location":"hmtt/day02/#_9","text":"\u56e0\u4e3ajson\u7684\u901a\u7528\u6027\uff0c\u6240\u4ee5JWT\u662f\u53ef\u4ee5\u8fdb\u884c\u8de8\u8bed\u8a00\u652f\u6301\u7684\uff0c\u50cfJAVA,JavaScript,NodeJS,PHP\u7b49\u5f88\u591a\u8bed\u8a00\u90fd\u53ef\u4ee5\u4f7f\u7528\u3002 \u56e0\u4e3a\u6709\u4e86payload\u90e8\u5206\uff0c\u6240\u4ee5JWT\u53ef\u4ee5\u5728\u81ea\u8eab\u5b58\u50a8\u4e00\u4e9b\u5176\u4ed6\u4e1a\u52a1\u903b\u8f91\u6240\u5fc5\u8981\u7684\u975e\u654f\u611f\u4fe1\u606f\u3002 \u4fbf\u4e8e\u4f20\u8f93\uff0cjwt\u7684\u6784\u6210\u975e\u5e38\u7b80\u5355\uff0c\u5b57\u8282\u5360\u7528\u5f88\u5c0f\uff0c\u6240\u4ee5\u5b83\u662f\u975e\u5e38\u4fbf\u4e8e\u4f20\u8f93\u7684\u3002 \u5b83\u4e0d\u9700\u8981\u5728\u670d\u52a1\u7aef\u4fdd\u5b58\u4f1a\u8bdd\u4fe1\u606f, \u6240\u4ee5\u5b83\u6613\u4e8e\u5e94\u7528\u7684\u6269\u5c55","title":"\u4f18\u70b9"},{"location":"hmtt/day02/#_10","text":"\u4e0d\u5e94\u8be5\u5728jwt\u7684payload\u90e8\u5206\u5b58\u653e\u654f\u611f\u4fe1\u606f\uff0c\u56e0\u4e3a\u8be5\u90e8\u5206\u662f\u5ba2\u6237\u7aef\u53ef\u89e3\u5bc6\u7684\u90e8\u5206\u3002 \u4fdd\u62a4\u597dsecret\u79c1\u94a5\uff0c\u8be5\u79c1\u94a5\u975e\u5e38\u91cd\u8981\u3002 \u5982\u679c\u53ef\u4ee5\uff0c\u8bf7\u4f7f\u7528https\u534f\u8bae package com.heima.utils.common ; import io.jsonwebtoken.* ; import javax.crypto.SecretKey ; import javax.crypto.spec.SecretKeySpec ; import java.util.* ; public class AppJwtUtil { // \u8bb2\u4e49\u6709\u8bef\uff0cTOKEN\u7684\u6709\u6548\u671f1\u5c0f\u65f6\uff08S\uff09 private static final int TOKEN_TIME_OUT = 3_600 ; // \u52a0\u5bc6KEY private static final String TOKEN_ENCRY_KEY = \"MDk4ZjZiY2Q0NjIxZDM3M2NhZGU0ZTgzMjYyN2I0ZjY\" ; // \u6700\u5c0f\u5237\u65b0\u95f4\u9694(S) private static final int REFRESH_TIME = 300 ; // \u751f\u4ea7ID public static String getToken ( Long id ){ Map < String , Object > claimMaps = new HashMap <> (); claimMaps . put ( \"id\" , id ); long currentTime = System . currentTimeMillis (); return Jwts . builder () . setId ( UUID . randomUUID (). toString ()) . setIssuedAt ( new Date ( currentTime )) //\u7b7e\u53d1\u65f6\u95f4 . setSubject ( \"system\" ) //\u8bf4\u660e . setIssuer ( \"heima\" ) //\u7b7e\u53d1\u8005\u4fe1\u606f . setAudience ( \"app\" ) //\u63a5\u6536\u7528\u6237 . compressWith ( CompressionCodecs . GZIP ) //\u6570\u636e\u538b\u7f29\u65b9\u5f0f . signWith ( SignatureAlgorithm . HS512 , generalKey ()) //\u52a0\u5bc6\u65b9\u5f0f . setExpiration ( new Date ( currentTime + TOKEN_TIME_OUT * 1000 )) //\u8fc7\u671f\u65f6\u95f4\u6233 . addClaims ( claimMaps ) //cla\u4fe1\u606f . compact (); } /** * \u83b7\u53d6token\u4e2d\u7684claims\u4fe1\u606f * * @param token * @return */ private static Jws < Claims > getJws ( String token ) { return Jwts . parser () . setSigningKey ( generalKey ()) . parseClaimsJws ( token ); } /** * \u83b7\u53d6payload body\u4fe1\u606f * * @param token * @return */ public static Claims getClaimsBody ( String token ) { try { return getJws ( token ). getBody (); } catch ( ExpiredJwtException e ){ return null ; } } /** * \u83b7\u53d6hearder body\u4fe1\u606f * * @param token * @return */ public static JwsHeader getHeaderBody ( String token ) { return getJws ( token ). getHeader (); } /** * \u662f\u5426\u8fc7\u671f * * @param claims * @return -1\uff1a\u6709\u6548\uff0c0\uff1a\u6709\u6548\u4f46\u662f\u9700\u8981\u5237\u65b0\uff0c1\uff1a\u8fc7\u671f\uff0c2\uff1a\u8fc7\u671f */ public static int verifyToken ( Claims claims ) { if ( claims == null ){ return 1 ; } try { claims . getExpiration () . before ( new Date ()); // \u9700\u8981\u81ea\u52a8\u5237\u65b0TOKEN if (( claims . getExpiration (). getTime () - System . currentTimeMillis ()) > REFRESH_TIME * 1000 ){ //\u8fc7\u671f\u65f6\u95f45\u5206\u949f\u4e4b\u5916\uff0c\u4e0d\u7528\u5237\u65b0 return - 1 ; } else { return 0 ; } } catch ( ExpiredJwtException ex ) { return 1 ; } catch ( Exception e ){ return 2 ; } } /** * \u7531\u5b57\u7b26\u4e32\u751f\u6210\u52a0\u5bc6key * * @return */ public static SecretKey generalKey () { byte [] encodedKey = Base64 . getEncoder (). encode ( TOKEN_ENCRY_KEY . getBytes ()); SecretKey key = new SecretKeySpec ( encodedKey , 0 , encodedKey . length , \"AES\" ); return key ; } public static void main ( String [] args ) { //\u751f\u6210claims\u6570\u636e\uff0c\u5176\u5b9e\u5c31\u662f\u81ea\u5b9a\u4e49\u6570\u636eid,\u7136\u540e\u4f20\u5165\u5230\u65b9\u6cd5\u4e2d String token = AppJwtUtil . getToken ( 1102L ); System . out . println ( token ); Jws < Claims > jws = AppJwtUtil . getJws ( token ); //\u83b7\u53d6\u81ea\u5b9a\u4e49\u6570\u636e Claims claims = jws . getBody (); System . out . println ( claims . get ( \"id\" )); } } JSON Web Token\uff08JWT\uff09\u662f\u4e00\u4e2a\u5f00\u653e\u7684\u884c\u4e1a\u6807\u51c6\uff08RFC 7519\uff09\uff0c\u5b83\u5b9a\u4e49\u4e86\u4e00\u79cd\u7b80\u6d01\u7684\u3001\u81ea\u5305\u542b\u7684\u534f\u8bae\u683c\u5f0f\uff0c\u7528\u4e8e\u5728\u901a\u4fe1\u53cc\u65b9\u4f20\u9012json\u5bf9\u8c61\uff0c\u4f20\u9012\u7684\u4fe1\u606f\u7ecf\u8fc7\u6570\u5b57\u7b7e\u540d\u53ef\u4ee5\u88ab\u9a8c\u8bc1\u548c\u4fe1\u4efb\u3002","title":"\u5b89\u5168\u76f8\u5173"},{"location":"hmtt/day02/#token_1","text":"int i = AppJwtUtil . verifyToken ( claimsBody ); System . out . println ( i ); if ( i == 0 ){ //\u5237\u65b0token String userData = ( String ) claimsBody . get ( \"userData\" ); String newToken = AppJwtUtil . getDataToken ( userData ); //\u8fd4\u56de\u7ed9\u524d\u7aefnew Token }","title":"token\u5728\u5931\u6548\u524d\u9700\u8981\u8fdb\u884c\u5237\u65b0:"},{"location":"hmtt/day02/#14-admin_0518","text":"ad_user\u8868\u5c06id\u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u81ea\u589e","title":"14-admin\u7aef\u767b\u5f55\u529f\u80fd\u601d\u8def\u5206\u6790\u548c\u63a5\u53e3\u5b9a\u4e49 05:18"},{"location":"hmtt/day02/#15-admin_1155","text":"public ResponseResult login ( AdUserDto dto ) { //1.\u53c2\u6570\u6821\u9a8c if ( StringUtils . isEmpty ( dto . getName ()) || StringUtils . isEmpty ( dto . getPassword ())) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE , \"\u7528\u6237\u540d\u6216\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a\" ); } List < AdUser > list = list ( Wrappers . < AdUser > lambdaQuery (). eq ( AdUser :: getName , dto . getName ())); if ( list != null && list . size () >= 1 ) { AdUser adUser = list . get ( 0 ); String pswd = DigestUtils . md5DigestAsHex (( dto . getPassword () + adUser . getSalt ()). getBytes ()); if ( adUser . getPassword (). equals ( pswd )) { Map < String , Object > map = Maps . newHashMap (); adUser . setPassword ( \"\" ); adUser . setSalt ( \"\" ); map . put ( \"token\" , AppJwtUtil . getToken ( adUser . getId (). longValue ())); map . put ( \"user\" , adUser ); return ResponseResult . okResult ( map ); } else { return ResponseResult . errorResult ( AppHttpCodeEnum . LOGIN_PASSWORD_ERROR ); } } else { return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u7528\u6237\u4e0d\u5b58\u5728\" ); } }","title":"15-admin\u7aef\u767b\u5f55\u529f\u80fd\u5b9e\u73b0 11:55"},{"location":"hmtt/day02/#16-admin_0723","text":"\u751f\u6210\u5bc6\u7801\uff1a //\u751f\u6210\u76d0\u548c\u5bc6\u7801 String dbsalt = \"1dni2\" ; String dbpassword = \"123456\" + dbsalt ; String saltPassword = DigestUtils . md5DigestAsHex ( dbpassword . getBytes ()); System . out . println ( saltPassword ); \u5c06\u4e0a\u9762\u7684\u76d0\u548c\u5bc6\u7801\u5199\u5230\u6570\u636e\u5e93\u4e2dad_user\u8868\u4e2d \u5982\u679c\u9700\u8981\u6d4b\u8bd5\u9875\u9762\uff0c\u4fee\u6539\uff1asrc\\views\\login\\index.vue \u627e\u5230\u65b9\u6cd5submitForm\uff0c\u4e0b\u9762\u8fd9\u884c\u6ce8\u91ca\u6389\uff1a //this.$router.replace({ path: '/auth/index' }) \u6253\u5f00\u8fd9\u4e00\u6bb5\u7684\u6ce8\u91ca: this . $refs . ruleForm . validate ( async ( valid ) => { if ( valid ) { const { password , name } = this . ruleForm const result = await loginByUsername ( name , password ) if ( result . code === 0 ) { // this.$router.replace({ path: '/users/index' }) this . $router . replace ({ path : '/auth/index' }) } else { this . $message ({ message : result . error_message , type : 'error' }) } } else { return false } })","title":"16-admin\u7aef\u767b\u5f55\u529f\u80fd\u6d4b\u8bd5 07:23"},{"location":"hmtt/day02/#17-nacos_0410","text":"nacos\u529f\u80fd: 1.\u670d\u52a1\u6ce8\u518c\u548c\u53d1\u73b0 2.\u914d\u7f6e\u7ba1\u7406 AP CP -> CAP \u7b2c\u56db\u5929 eureka -> ap consul -> cp zookeeper -> cp","title":"17-nacos\u4ecb\u7ecd 04:10"},{"location":"hmtt/day02/#18-linux_0347","text":"nacos\u5efa\u8bae\u76f4\u63a5\u5728windows\u4e0b\u4f7f\u7528","title":"18-linux\u670d\u52a1\u5668\u6302\u8f7d 03:47"},{"location":"hmtt/day02/#19-nacos_0619","text":"windows\u4e0b\u76f4\u63a5\u8fd0\u884c nacos-server-1.2.0\\nacos\\bin\\startup.cmd linux\u4e0b\u8fd0\u884c shell sh nacos-server-1.2.0\\nacos\\bin\\startup.sh -m standalone \u8bbf\u95ee\uff1a http://localhost:8848/nacos/index.html","title":"19-nacos\u642d\u5efa\u53ca\u5fae\u670d\u52a1\u6ce8\u518c  06:19"},{"location":"hmtt/day03/","text":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 01:12 \u00b6 \u80fd\u591f\u5b8c\u6210\u7f51\u5173\u7edf\u4e00\u9274\u6743\u7684\u529f\u80fd \u80fd\u591f\u5b8c\u6210\u8ba4\u8bc1\u7528\u6237\u5217\u8868\u67e5\u8be2 \u80fd\u591f\u719f\u6089app\u7aef\u7528\u6237\u8ba4\u8bc1\u5ba1\u6838\u6d41\u7a0b \u80fd\u591f\u5b8c\u6210app\u7528\u6237\u5ba1\u6838\u4ee3\u7801\u5f00\u53d1 02-\u7f51\u5173\u529f\u80fd-\u56de\u987e 03:53 \u00b6 \u7f51\u5173\u662f\u4ecb\u4e8e\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u4e4b\u95f4\u7684\u4e2d\u95f4\u5c42\uff0c\u6240\u6709\u7684\u5916\u90e8\u8bf7\u6c42\u90fd\u4f1a\u5148\u7ecf\u8fc7 \u7f51\u5173\u8fd9\u4e00\u5c42\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cAPI \u7684\u5b9e\u73b0\u65b9\u9762\u66f4\u591a\u7684\u8003\u8651\u4e1a\u52a1\u903b\u8f91\uff0c\u800c\u5b89\u5168\u3001\u6027\u80fd\u3001\u76d1\u63a7\u53ef\u4ee5\u4ea4\u7531 \u7f51\u5173\u6765\u505a\uff0c\u8fd9\u6837\u65e2\u63d0\u9ad8\u4e1a\u52a1\u7075\u6d3b\u6027\u53c8\u4e0d\u7f3a\u5b89\u5168\u6027\uff0c\u5178\u578b\u7684\u67b6\u6784\u56fe\u5982\u56fe\u6240\u793a\uff1a 03-\u7f51\u5173\u5fae\u670d\u52a1\u642d\u5efa 08:17 \u00b6 pom\u6587\u4ef6 <dependencies> <dependency> <groupId> org.springframework.cloud </groupId> <artifactId> spring-cloud-starter-gateway </artifactId> </dependency> <dependency> <groupId> com.alibaba.cloud </groupId> <artifactId> spring-cloud-starter-alibaba-nacos-discovery </artifactId> </dependency> <dependency> <groupId> io.jsonwebtoken </groupId> <artifactId> jjwt </artifactId> </dependency> </dependencies> \u5f15\u5bfc\u7c7b\uff1a package com.heima.admin.gateway ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; import org.springframework.cloud.client.discovery.EnableDiscoveryClient ; @SpringBootApplication @EnableDiscoveryClient //\u5f00\u542f\u6ce8\u518c\u4e2d\u5fc3 public class GatewayApplication { public static void main ( String [] args ) { SpringApplication . run ( GatewayApplication . class , args ); } } application.yml server : port : 6001 spring : application : name : leadnews-admin-gateway cloud : nacos : discovery : server-addr : localhost:8848 gateway : globalcors : cors-configurations : '[/**]' : # \u5339\u914d\u6240\u6709\u8bf7\u6c42 allowedOrigins : \"*\" #\u8de8\u57df\u5904\u7406 \u5141\u8bb8\u6240\u6709\u7684\u57df allowedMethods : # \u652f\u6301\u7684\u65b9\u6cd5 - GET - POST - PUT - DELETE routes : # \u5e73\u53f0\u7ba1\u7406 - id : admin uri : lb://leadnews-admin predicates : - Path=/admin/** filters : - StripPrefix= 1 #\u5c06path\u7b2c\u4e00\u4e2a\u5355\u8bcd\u7ed9\u5220\u9664 # \u5e73\u53f0\u7ba1\u7406 - id : user uri : lb://leadnews-user predicates : - Path=/user/** filters : - StripPrefix= 1 #\u5c06path\u7b2c\u4e00\u4e2a\u5355\u8bcd\u7ed9\u5220\u9664 \u6dfb\u52a0\u4e86\u8fc7\u6ee4\u5668 filters: - StripPrefix= 1 \u5220\u9664\u7b2c\u4e00\u4e2a\u8def\u5f84\u4e2d\u7684\u8282\u70b9 http://localhost:6001/admin/api/v1/channel/list -> http://localhost:9001/api/v1/channel/list 04-jwt\u6821\u9a8c-\u6d41\u7a0b\u5206\u6790 08:42 \u00b6 05-jwt\u6821\u9a8c-\u4ee3\u7801\u7f16\u5199 10:44 \u00b6 \u6ce8\u610f\uff0c\u8fd9\u91cc\u6709\u4e25\u91cd\u95ee\u9898\uff1a if ( result == 0 || result == - 1 ) \u8fd9\u4e00\u53e5\u7684else\u5206\u652f\u4e00\u5b9a\u8981\u5199\uff0c\u5426\u5219\u6821\u9a8c\u5931\u8d25\u4e86\u4e5f\u80fd\u6b63\u5e38\u8fd0\u884c else { //. response . setStatusCode ( HttpStatus . UNAUTHORIZED ); return response . setComplete (); } \u6700\u540e\u7684\u4ee3\u7801\uff1a package com.heima.admin.gateway.filter ; import com.heima.admin.gateway.utils.AppJwtUtil ; import io.jsonwebtoken.Claims ; import lombok.extern.log4j.Log4j2 ; import org.apache.commons.lang3.StringUtils ; import org.springframework.cloud.gateway.filter.GatewayFilterChain ; import org.springframework.cloud.gateway.filter.GlobalFilter ; import org.springframework.core.Ordered ; import org.springframework.http.HttpHeaders ; import org.springframework.http.HttpStatus ; import org.springframework.http.server.reactive.ServerHttpRequest ; import org.springframework.http.server.reactive.ServerHttpResponse ; import org.springframework.stereotype.Component ; import org.springframework.web.server.ServerWebExchange ; import reactor.core.publisher.Mono ; @Component @Log4j2 public class AuthorizeFilter implements GlobalFilter , Ordered { @Override public Mono < Void > filter ( ServerWebExchange exchange , GatewayFilterChain chain ) { //1.\u83b7\u53d6\u8bf7\u6c42\u5bf9\u8c61\u548c\u54cd\u5e94\u5bf9\u8c61 ServerHttpRequest request = exchange . getRequest (); ServerHttpResponse response = exchange . getResponse (); //2.\u5224\u65ad\u5f53\u524d\u7684\u8bf7\u6c42\u662f\u5426\u4e3a\u767b\u5f55\uff0c\u5982\u679c\u662f\uff0c\u76f4\u63a5\u653e\u884c if ( request . getURI (). getPath (). contains ( \"/login/in\" )){ //\u653e\u884c return chain . filter ( exchange ); } //3.\u83b7\u53d6\u5f53\u524d\u7528\u6237\u7684\u8bf7\u6c42\u5934jwt\u4fe1\u606f HttpHeaders headers = request . getHeaders (); String jwtToken = headers . getFirst ( \"token\" ); //4.\u5224\u65ad\u5f53\u524d\u4ee4\u724c\u662f\u5426\u5b58\u5728 if ( StringUtils . isEmpty ( jwtToken )){ //\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5411\u5ba2\u6237\u7aef\u8fd4\u56de\u9519\u8bef\u63d0\u793a\u4fe1\u606f response . setStatusCode ( HttpStatus . UNAUTHORIZED ); return response . setComplete (); } try { //5.\u5982\u679c\u4ee4\u724c\u5b58\u5728\uff0c\u89e3\u6790jwt\u4ee4\u724c\uff0c\u5224\u65ad\u8be5\u4ee4\u724c\u662f\u5426\u5408\u6cd5\uff0c\u5982\u679c\u4e0d\u5408\u6cd5\uff0c\u5219\u5411\u5ba2\u6237\u7aef\u8fd4\u56de\u9519\u8bef\u4fe1\u606f Claims claims = AppJwtUtil . getClaimsBody ( jwtToken ); int result = AppJwtUtil . verifyToken ( claims ); if ( result == 0 || result == - 1 ){ //5.1 \u5408\u6cd5\uff0c\u5219\u5411header\u4e2d\u91cd\u65b0\u8bbe\u7f6euserId Integer id = ( Integer ) claims . get ( \"id\" ); log . info ( \"find userid:{} from uri:{}\" , id , request . getURI ()); //\u91cd\u65b0\u8bbe\u7f6etoken\u5230header\u4e2d //spring cloud gateway\u7684request\u4e0d\u80fd\u76f4\u63a5\u8bbe\u7f6e\u503c\uff0c\u9700\u8981\u5148\u8fdb\u884c\u4e00\u6b65\u8f6c\u5316mutate() //\u7136\u540e\u518d\u7ed9\u5934\u4fe1\u606f\u8bbe\u7f6e\u5bf9\u5e94\u7684\u6570\u636e ServerHttpRequest serverHttpRequest = request . mutate (). headers ( httpHeaders -> { httpHeaders . add ( \"userId\" , id + \"\" ); }). build (); //\u540c\u6837\u8bf7\u6c42\u4e5f\u9700\u8981\u8f6c\u5316\u4e00\u4e0b exchange . mutate (). request ( serverHttpRequest ). build (); } else { //token\u8fc7\u671f\u6216\u8005token\u88ab\u7be1\u6539\uff0c\u76f4\u63a5\u8fd4\u56de401 response . setStatusCode ( HttpStatus . UNAUTHORIZED ); return response . setComplete (); } } catch ( Exception e ){ e . printStackTrace (); //\u60f3\u5ba2\u6237\u7aef\u8fd4\u56de\u9519\u8bef\u63d0\u793a\u4fe1\u606f response . setStatusCode ( HttpStatus . UNAUTHORIZED ); return response . setComplete (); } //6.\u653e\u884c return chain . filter ( exchange ); } /** * \u4f18\u5148\u7ea7\u8bbe\u7f6e * \u503c\u8d8a\u5c0f\uff0c\u4f18\u5148\u7ea7\u8d8a\u9ad8 * @return */ @Override public int getOrder () { return 0 ; } } 06-jwt\u6821\u9a8c-\u6d4b\u8bd5 06:01 \u00b6 \u4f7f\u7528\u8001\u5e08\u63d0\u4f9b\u7684postman\u63a5\u53e3\u8fdb\u884c\u6d4b\u8bd5 \u542f\u52a81.admin 2.admin-gateway\u7f51\u5173 07-app\u7528\u6237\u8ba4\u8bc1\u5217\u8868\u67e5\u8be2-\u601d\u8def\u548c\u5206\u6790 07:23 \u00b6 \u7528\u6237\u5728app\u7aef\u63d0\u4ea4\u8ba4\u8bc1\u4fe1\u606f\u4e4b\u540e\uff0c\u4fe1\u606f\u4f1a\u5f55\u5165\u5230leadnews_user\u6570\u636e\u5e93\u4e2d\u7684ap_user_realname\u8868 08-app\u7528\u6237\u8ba4\u8bc1\u5217\u8868\u67e5\u8be2-\u529f\u80fd\u5b9e\u73b0 14:18 \u00b6 package com.heima.user.service.impl ; import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper ; import com.baomidou.mybatisplus.core.metadata.IPage ; import com.baomidou.mybatisplus.extension.plugins.pagination.Page ; import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl ; import com.heima.model.common.dtos.PageResponseResult ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.user.dtos.AuthDto ; import com.heima.model.user.pojos.ApUserRealname ; import com.heima.user.mapper.ApUserRealnameMapper ; import com.heima.user.service.ApUserRealnameService ; import org.springframework.stereotype.Service ; @Service public class ApUserRealnameServiceImpl extends ServiceImpl < ApUserRealnameMapper , ApUserRealname > implements ApUserRealnameService { @Override public ResponseResult loadListByStatus ( AuthDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //\u5206\u9875\u68c0\u67e5 dto . checkParam (); //2.\u6839\u636e\u72b6\u6001\u5206\u9875\u67e5\u8be2 LambdaQueryWrapper < ApUserRealname > lambdaQueryWrapper = new LambdaQueryWrapper (); if ( dto . getStatus () != null ){ lambdaQueryWrapper . eq ( ApUserRealname :: getStatus , dto . getStatus ()); } //\u5206\u9875\u6761\u4ef6\u6784\u5efa IPage pageParam = new Page ( dto . getPage (), dto . getSize ()); IPage page = page ( pageParam , lambdaQueryWrapper ); //3.\u8fd4\u56de\u7ed3\u679c PageResponseResult responseResult = new PageResponseResult ( dto . getPage (), dto . getSize (),( int ) page . getTotal ()); responseResult . setData ( page . getRecords ()); return responseResult ; } } 09-\u5ba1\u6838-\u601d\u8def\u5206\u6790 04:19 \u00b6 \u7528\u6237\u901a\u8fc7\u5ba1\u6838\u540e\u9700\u8981\u5f00\u901a\u81ea\u5a92\u4f53\u8d26\u53f7\uff08\u8be5\u8d26\u53f7\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u4e0eapp\u4e00\u81f4\uff09 \u7528\u6237\u901a\u8fc7\u5ba1\u6838\u540e\u9700\u8981\u5728article\u4e2d\u5728\u4f5c\u8005\u8868\u4e2d\u65b0\u5efa\u4e00\u4e2a\u4f5c\u8005\u4fe1\u606f 10-\u81ea\u5a92\u4f53\u5de5\u7a0b\u642d\u5efa 08:05 \u00b6 wm_user \u81ea\u5a92\u4f53\u7528\u6237\u8868 11-\u81ea\u5a92\u4f53\u63a5\u53e3\u5b9e\u73b0 10\uff1a32 \u00b6 package com.heima.wemedia.controller.v1 ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.apis.wemedia.WmUserControllerApi ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.wemedia.pojos.WmUser ; import com.heima.wemedia.service.WmUserService ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.* ; import javax.ws.rs.POST ; import java.util.List ; @RestController @RequestMapping ( \"/api/v1/user\" ) public class WmUserController implements WmUserControllerApi { @Autowired private WmUserService wmUserService ; @PostMapping ( \"/save\" ) @Override public ResponseResult save ( @RequestBody WmUser wmUser ) { wmUserService . save ( wmUser ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } @GetMapping ( \"/findByName/{name}\" ) @Override public WmUser findByName ( @PathVariable ( \"name\" ) String name ) { List < WmUser > list = wmUserService . list ( Wrappers . < WmUser > lambdaQuery (). eq ( WmUser :: getName , name )); if ( list != null && ! list . isEmpty ()){ return list . get ( 0 ); } return null ; } } 12-\u4f5c\u8005\u8fdc\u7a0b\u63a5\u53e3 15:21 \u00b6 ap_author \u4f5c\u8005\u4fe1\u606f\u8868 user_id\u5173\u8054\u5230ap_user\u8868 \u63a5\u53e3\u8be6\u89c1\u63a5\u53e3\u6587\u6863 13-\u5ba1\u6838\u63a5\u53e3\u5b9a\u4e49 06:06 \u00b6 \u8be6\u89c1\u7528\u6237\u670d\u52a1\u63a5\u53e3\u6587\u6863\uff1aauthPass app\u7aef\u7528\u6237\u4fe1\u606f\u8868 14-\u5ba1\u6838-\u7528\u6237\u5b9a\u4e49feign\u63a5\u53e3 05:17 \u00b6 package com.heima.user.feign ; import com.heima.model.article.pojos.ApAuthor ; import com.heima.model.common.dtos.ResponseResult ; import org.springframework.cloud.openfeign.FeignClient ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.PathVariable ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestBody ; @FeignClient ( \"leadnews-article\" ) public interface ArticleFeign { @GetMapping ( \"/api/v1/author/findByUserId/{id}\" ) public ApAuthor findByUserId ( @PathVariable ( \"id\" ) Integer id ); @PostMapping ( \"/api/v1/author/save\" ) public ResponseResult save ( @RequestBody ApAuthor apAuthor ); } package com.heima.user.feign ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.wemedia.pojos.WmUser ; import org.springframework.cloud.openfeign.FeignClient ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.PathVariable ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestBody ; @FeignClient ( \"leadnews-wemedia\" ) public interface WemediaFeign { @PostMapping ( \"/api/v1/user/save\" ) public ResponseResult save ( @RequestBody WmUser wmUser ); @GetMapping ( \"/api/v1/user/findByName/{name}\" ) public WmUser findByName ( @PathVariable ( \"name\" ) String name ); } 15-\u5ba1\u6838-\u4e1a\u52a1\u5c42\u5b9e\u73b01 11:38 \u00b6 \u4e1a\u52a1\u903b\u8f91\uff1a //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || dto . getId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //\u68c0\u67e5\u72b6\u6001 if ( checkStatus ( status )){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u4fee\u6539\u72b6\u6001 ApUserRealname apUserRealname = new ApUserRealname (); apUserRealname . setId ( dto . getId ()); apUserRealname . setStatus ( status ); if ( dto . getMsg () != null ){ apUserRealname . setReason ( dto . getMsg ()); } updateById ( apUserRealname ); \u5e38\u91cf\uff1a\u72b6\u6001 0 \u521b\u5efa\u4e2d 1 \u5f85\u5ba1\u6838 2 \u5ba1\u6838\u5931\u8d25 9 \u5ba1\u6838\u901a\u8fc7 package com.heima.common.constans.user ; public class UserConstants { //leadnews_user\u7684ap_user_realname\u7684status\u5b9a\u4e49 0 \u521b\u5efa\u4e2d 1 \u5f85\u5ba1\u6838 2 \u5ba1\u6838\u5931\u8d25 9 \u5ba1\u6838\u901a\u8fc7 //2 \u5ba1\u6838\u5931\u8d25 public static final Short FAIL_AUTH = 2 ; //9 \u5ba1\u6838\u901a\u8fc7 public static final Short PASS_AUTH = 9 ; //leadnews_article\u7684ap_author type\u5b9a\u4e490 \u722c\u53d6\u6570\u636e 1 \u7b7e\u7ea6\u5408\u4f5c\u5546 2 \u5e73\u53f0\u81ea\u5a92\u4f53\u4eba //0 \u722c\u53d6\u6570\u636e 1 \u7b7e\u7ea6\u5408\u4f5c\u5546 2 \u5e73\u53f0\u81ea\u5a92\u4f53\u4eba public static final Integer AUTH_TYPE = 2 ; } 16-\u5ba1\u6838-\u4e1a\u52a1\u5c42\u5b9e\u73b02 09:39 \u00b6 ap_user_realname\u6839\u636euser_id\u5173\u8054\u5230ap_user\u4e2d\u7684\u6570\u636e \u518d\u8c03\u7528WmUser\u63a5\u53e3\u521b\u5efa\u81ea\u5a92\u4f53\u7684\u7528\u6237 private ResponseResult createWmUserAndAuthor ( AuthDto dto ) { //\u83b7\u53d6ap_user\u4fe1\u606f Integer apUserRealnameId = dto . getId (); ApUserRealname apUserRealname = getById ( apUserRealnameId ); ApUser apUser = apUserMapper . selectById ( apUserRealname . getUserId ()); if ( apUser == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } WmUser wmUser = wemediaFeign . findByName ( apUser . getName ()); //\u521b\u5efa\u81ea\u5a92\u4f53\u8d26\u6237 if ( wmUser == null ){ wmUser = new WmUser (); wmUser . setApUserId ( apUser . getId ()); wmUser . setCreatedTime ( new Date ()); wmUser . setName ( apUser . getName ()); wmUser . setPassword ( apUser . getPassword ()); wmUser . setSalt ( apUser . getSalt ()); wmUser . setPhone ( apUser . getPhone ()); wmUser . setStatus ( 9 ); wemediaFeign . save ( wmUser ); } else { //\u6dfb\u52a0\u5f02\u5e38\u5904\u7406 } //\u521b\u5efa\u4f5c\u8005 createAuthor ( wmUser ); apUser . setFlag (( short ) 1 ); apUserMapper . updateById ( apUser ); return null ; } \u4f18\u5316wemedia\u7684findByName\u5224\u65ad\uff1a \u00b6 \u8c03\u7528WmUser\u63a5\u53e3\u521b\u5efa\u81ea\u5a92\u4f53\u7684\u7528\u6237\u4e4b\u524d\u67e5\u8be2\u662f\u5426\u5b58\u5728\uff0c\u9996\u5148\u8fd9\u7c7b\u63a5\u53e3\u8bbe\u8ba1\u5b8c\u5168\u53ef\u4ee5\u653e\u5728wemedia\u5fae\u670d\u52a1\u4e2d\uff0c\u5176\u6b21\u8fd9\u91cc\u6700\u597d\u7528id\u6765\u5224\u65ad\u800c\u4e0d\u662f\u540d\u5b57 WmUserControllerApi\u6dfb\u52a0\u63a5\u53e3: /** * \u6839\u636e\u7528\u6237id\u67e5\u8be2\u81ea\u5a92\u4f53\u7528\u6237 * @param id * @return */ public WmUser findByUserId ( @PathVariable ( \"id\" ) Integer id ); WmUserController\u6dfb\u52a0\u5b9e\u73b0: @GetMapping ( \"/findByUserId/{id}\" ) @Override public WmUser findByUserId ( Integer id ) { return wmUserService . getOne ( Wrappers . < WmUser > lambdaQuery (). eq ( WmUser :: getApUserId , id )); } WemediaFeign\u6dfb\u52a0\u5b9a\u4e49: @GetMapping ( \"/api/v1/user/findByUserId/{id}\" ) public WmUser findByUserId ( @PathVariable ( \"id\" ) Integer id ); ApUserRealnameServiceImpl\u4e2d\u7684createWmUserAndAuthor\u65b9\u6cd5\uff1a //WmUser wmUser = wemediaFeign.findByName(apUser.getName()); WmUser wmUser = wemediaFeign . findByUserId ( apUser . getId ()); 17-\u5ba1\u6838-\u4e1a\u52a1\u5c42\u5b9e\u73b03 06:54 \u00b6 /** * \u521b\u5efa\u4f5c\u8005 * @param wmUser */ private void createAuthor ( WmUser wmUser ) { Integer apUserId = wmUser . getApUserId (); ApAuthor apAuthor = articleFeign . findByUserId ( apUserId ); if ( apAuthor == null ){ apAuthor = new ApAuthor (); apAuthor . setName ( wmUser . getName ()); apAuthor . setCreatedTime ( new Date ()); apAuthor . setUserId ( apUserId ); apAuthor . setType ( UserConstants . AUTH_TYPE ); articleFeign . save ( apAuthor ); } } 18-\u5ba1\u6838-\u63a7\u5236\u5c42\u5b9e\u73b0\u53ca\u6d4b\u8bd5 12:34 \u00b6 \u542f\u52a8Article\u3001User\u3001Wemedia \u4f7f\u7528\u8001\u5e08\u4e0b\u53d1\u7684postman\u811a\u672c\u8fdb\u884c\u6d4b\u8bd5 19-\u7ed3\u5408\u524d\u53f0\u7efc\u5408\u6d4b\u8bd5 04:31 \u00b6 \u542f\u52a8Article\u3001User\u3001Wemedia\u3001AdminGateway\u3001Admin \u4f18\u5316\uff1a \u524d\u7aef\u5728\u901a\u8fc7\u6216\u8005\u62d2\u7edd\u5ba1\u6838\u4e4b\u540e\uff0c\u5217\u8868\u663e\u793a\u6240\u6709\u7684\u6570\u636e \u4fee\u6539src\\views\\user_auth\\index.vue < template > < div > < search - tool : statusList = \"statusList\" : changeParam = \"searchAuthList\" /> < search - result ref = 'mySearchResult' : statusList = \"statusList\" : authList = \"authList\" : host = \"host\" : total = \"total\" : changePage = \"searchAuthList\" : pageSize = \"params.size\" : authPassRealName = \"authPassRealName\" : authFailRealName = \"authFailRealName\" /> < /div> < /template> < script > import SearchTool from './components/SearchTool.vue' import SearchResult from './components/SearchResult.vue' import { findAuthList , authPass , authFail } from '@/api/user_auth' export default { name : 'AuthManage' , data () { return { params : { page : 1 , size : 10 }, total : 0 , host : '' , statusList : [ { label : '' , value : '\u5168\u90e8' }, { label : 0 , value : '\u521b\u5efa\u4e2d' }, { label : 1 , value : '\u5f85\u5ba1\u6838' }, { label : 2 , value : '\u5ba1\u6838\u5931\u8d25' }, { label : 9 , value : '\u5ba1\u6838\u901a\u8fc7' } ], authList : [], searchParam : null } }, created () { this . searchAuthList () }, components : { SearchTool , SearchResult }, methods : { async searchAuthList ( newParams ) { const res = await findAuthList ({ ... this . params , ... newParams }) if ( res . code === 200 ) { this . authList = res . data this . host = res . host this . total = res . total } else { this . $message ({ type : 'error' , message : res . error_message }) } //\u5237\u65b0\u5b8c\uff0c\u672c\u5730\u8bb0\u4f4f\u5f53\u524d\u9009\u4e2d\u7684\u6309\u94ae console . log ( newParams ) this . searchParam = newParams }, async authPassRealName ( params ) { const res = await authPass ( params ) if ( res . code === 200 ) { this . $message ({ type : 'success' , message : '\u64cd\u4f5c\u6210\u529f' }) } else { this . $message ({ type : 'success' , message : res . error_message }) } //\u4f20\u9012\u4e0a\u65b9\u6309\u94ae\u7684\u7c7b\u578b this . searchAuthList ( this . searchParam ) }, async authFailRealName ( params ) { //\u53d1\u9001\u8bf7\u6c42 await authFail ( params ) //\u5237\u65b0\u5217\u8868\u6570\u636e this . searchAuthList ( this . searchParam ) } } } < /script>","title":"day03"},{"location":"hmtt/day03/#01-_0112","text":"\u80fd\u591f\u5b8c\u6210\u7f51\u5173\u7edf\u4e00\u9274\u6743\u7684\u529f\u80fd \u80fd\u591f\u5b8c\u6210\u8ba4\u8bc1\u7528\u6237\u5217\u8868\u67e5\u8be2 \u80fd\u591f\u719f\u6089app\u7aef\u7528\u6237\u8ba4\u8bc1\u5ba1\u6838\u6d41\u7a0b \u80fd\u591f\u5b8c\u6210app\u7528\u6237\u5ba1\u6838\u4ee3\u7801\u5f00\u53d1","title":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 01:12"},{"location":"hmtt/day03/#02--_0353","text":"\u7f51\u5173\u662f\u4ecb\u4e8e\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u4e4b\u95f4\u7684\u4e2d\u95f4\u5c42\uff0c\u6240\u6709\u7684\u5916\u90e8\u8bf7\u6c42\u90fd\u4f1a\u5148\u7ecf\u8fc7 \u7f51\u5173\u8fd9\u4e00\u5c42\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cAPI \u7684\u5b9e\u73b0\u65b9\u9762\u66f4\u591a\u7684\u8003\u8651\u4e1a\u52a1\u903b\u8f91\uff0c\u800c\u5b89\u5168\u3001\u6027\u80fd\u3001\u76d1\u63a7\u53ef\u4ee5\u4ea4\u7531 \u7f51\u5173\u6765\u505a\uff0c\u8fd9\u6837\u65e2\u63d0\u9ad8\u4e1a\u52a1\u7075\u6d3b\u6027\u53c8\u4e0d\u7f3a\u5b89\u5168\u6027\uff0c\u5178\u578b\u7684\u67b6\u6784\u56fe\u5982\u56fe\u6240\u793a\uff1a","title":"02-\u7f51\u5173\u529f\u80fd-\u56de\u987e 03:53"},{"location":"hmtt/day03/#03-_0817","text":"pom\u6587\u4ef6 <dependencies> <dependency> <groupId> org.springframework.cloud </groupId> <artifactId> spring-cloud-starter-gateway </artifactId> </dependency> <dependency> <groupId> com.alibaba.cloud </groupId> <artifactId> spring-cloud-starter-alibaba-nacos-discovery </artifactId> </dependency> <dependency> <groupId> io.jsonwebtoken </groupId> <artifactId> jjwt </artifactId> </dependency> </dependencies> \u5f15\u5bfc\u7c7b\uff1a package com.heima.admin.gateway ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; import org.springframework.cloud.client.discovery.EnableDiscoveryClient ; @SpringBootApplication @EnableDiscoveryClient //\u5f00\u542f\u6ce8\u518c\u4e2d\u5fc3 public class GatewayApplication { public static void main ( String [] args ) { SpringApplication . run ( GatewayApplication . class , args ); } } application.yml server : port : 6001 spring : application : name : leadnews-admin-gateway cloud : nacos : discovery : server-addr : localhost:8848 gateway : globalcors : cors-configurations : '[/**]' : # \u5339\u914d\u6240\u6709\u8bf7\u6c42 allowedOrigins : \"*\" #\u8de8\u57df\u5904\u7406 \u5141\u8bb8\u6240\u6709\u7684\u57df allowedMethods : # \u652f\u6301\u7684\u65b9\u6cd5 - GET - POST - PUT - DELETE routes : # \u5e73\u53f0\u7ba1\u7406 - id : admin uri : lb://leadnews-admin predicates : - Path=/admin/** filters : - StripPrefix= 1 #\u5c06path\u7b2c\u4e00\u4e2a\u5355\u8bcd\u7ed9\u5220\u9664 # \u5e73\u53f0\u7ba1\u7406 - id : user uri : lb://leadnews-user predicates : - Path=/user/** filters : - StripPrefix= 1 #\u5c06path\u7b2c\u4e00\u4e2a\u5355\u8bcd\u7ed9\u5220\u9664 \u6dfb\u52a0\u4e86\u8fc7\u6ee4\u5668 filters: - StripPrefix= 1 \u5220\u9664\u7b2c\u4e00\u4e2a\u8def\u5f84\u4e2d\u7684\u8282\u70b9 http://localhost:6001/admin/api/v1/channel/list -> http://localhost:9001/api/v1/channel/list","title":"03-\u7f51\u5173\u5fae\u670d\u52a1\u642d\u5efa 08:17"},{"location":"hmtt/day03/#04-jwt-_0842","text":"","title":"04-jwt\u6821\u9a8c-\u6d41\u7a0b\u5206\u6790 08:42"},{"location":"hmtt/day03/#05-jwt-_1044","text":"\u6ce8\u610f\uff0c\u8fd9\u91cc\u6709\u4e25\u91cd\u95ee\u9898\uff1a if ( result == 0 || result == - 1 ) \u8fd9\u4e00\u53e5\u7684else\u5206\u652f\u4e00\u5b9a\u8981\u5199\uff0c\u5426\u5219\u6821\u9a8c\u5931\u8d25\u4e86\u4e5f\u80fd\u6b63\u5e38\u8fd0\u884c else { //. response . setStatusCode ( HttpStatus . UNAUTHORIZED ); return response . setComplete (); } \u6700\u540e\u7684\u4ee3\u7801\uff1a package com.heima.admin.gateway.filter ; import com.heima.admin.gateway.utils.AppJwtUtil ; import io.jsonwebtoken.Claims ; import lombok.extern.log4j.Log4j2 ; import org.apache.commons.lang3.StringUtils ; import org.springframework.cloud.gateway.filter.GatewayFilterChain ; import org.springframework.cloud.gateway.filter.GlobalFilter ; import org.springframework.core.Ordered ; import org.springframework.http.HttpHeaders ; import org.springframework.http.HttpStatus ; import org.springframework.http.server.reactive.ServerHttpRequest ; import org.springframework.http.server.reactive.ServerHttpResponse ; import org.springframework.stereotype.Component ; import org.springframework.web.server.ServerWebExchange ; import reactor.core.publisher.Mono ; @Component @Log4j2 public class AuthorizeFilter implements GlobalFilter , Ordered { @Override public Mono < Void > filter ( ServerWebExchange exchange , GatewayFilterChain chain ) { //1.\u83b7\u53d6\u8bf7\u6c42\u5bf9\u8c61\u548c\u54cd\u5e94\u5bf9\u8c61 ServerHttpRequest request = exchange . getRequest (); ServerHttpResponse response = exchange . getResponse (); //2.\u5224\u65ad\u5f53\u524d\u7684\u8bf7\u6c42\u662f\u5426\u4e3a\u767b\u5f55\uff0c\u5982\u679c\u662f\uff0c\u76f4\u63a5\u653e\u884c if ( request . getURI (). getPath (). contains ( \"/login/in\" )){ //\u653e\u884c return chain . filter ( exchange ); } //3.\u83b7\u53d6\u5f53\u524d\u7528\u6237\u7684\u8bf7\u6c42\u5934jwt\u4fe1\u606f HttpHeaders headers = request . getHeaders (); String jwtToken = headers . getFirst ( \"token\" ); //4.\u5224\u65ad\u5f53\u524d\u4ee4\u724c\u662f\u5426\u5b58\u5728 if ( StringUtils . isEmpty ( jwtToken )){ //\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5411\u5ba2\u6237\u7aef\u8fd4\u56de\u9519\u8bef\u63d0\u793a\u4fe1\u606f response . setStatusCode ( HttpStatus . UNAUTHORIZED ); return response . setComplete (); } try { //5.\u5982\u679c\u4ee4\u724c\u5b58\u5728\uff0c\u89e3\u6790jwt\u4ee4\u724c\uff0c\u5224\u65ad\u8be5\u4ee4\u724c\u662f\u5426\u5408\u6cd5\uff0c\u5982\u679c\u4e0d\u5408\u6cd5\uff0c\u5219\u5411\u5ba2\u6237\u7aef\u8fd4\u56de\u9519\u8bef\u4fe1\u606f Claims claims = AppJwtUtil . getClaimsBody ( jwtToken ); int result = AppJwtUtil . verifyToken ( claims ); if ( result == 0 || result == - 1 ){ //5.1 \u5408\u6cd5\uff0c\u5219\u5411header\u4e2d\u91cd\u65b0\u8bbe\u7f6euserId Integer id = ( Integer ) claims . get ( \"id\" ); log . info ( \"find userid:{} from uri:{}\" , id , request . getURI ()); //\u91cd\u65b0\u8bbe\u7f6etoken\u5230header\u4e2d //spring cloud gateway\u7684request\u4e0d\u80fd\u76f4\u63a5\u8bbe\u7f6e\u503c\uff0c\u9700\u8981\u5148\u8fdb\u884c\u4e00\u6b65\u8f6c\u5316mutate() //\u7136\u540e\u518d\u7ed9\u5934\u4fe1\u606f\u8bbe\u7f6e\u5bf9\u5e94\u7684\u6570\u636e ServerHttpRequest serverHttpRequest = request . mutate (). headers ( httpHeaders -> { httpHeaders . add ( \"userId\" , id + \"\" ); }). build (); //\u540c\u6837\u8bf7\u6c42\u4e5f\u9700\u8981\u8f6c\u5316\u4e00\u4e0b exchange . mutate (). request ( serverHttpRequest ). build (); } else { //token\u8fc7\u671f\u6216\u8005token\u88ab\u7be1\u6539\uff0c\u76f4\u63a5\u8fd4\u56de401 response . setStatusCode ( HttpStatus . UNAUTHORIZED ); return response . setComplete (); } } catch ( Exception e ){ e . printStackTrace (); //\u60f3\u5ba2\u6237\u7aef\u8fd4\u56de\u9519\u8bef\u63d0\u793a\u4fe1\u606f response . setStatusCode ( HttpStatus . UNAUTHORIZED ); return response . setComplete (); } //6.\u653e\u884c return chain . filter ( exchange ); } /** * \u4f18\u5148\u7ea7\u8bbe\u7f6e * \u503c\u8d8a\u5c0f\uff0c\u4f18\u5148\u7ea7\u8d8a\u9ad8 * @return */ @Override public int getOrder () { return 0 ; } }","title":"05-jwt\u6821\u9a8c-\u4ee3\u7801\u7f16\u5199  10:44"},{"location":"hmtt/day03/#06-jwt-_0601","text":"\u4f7f\u7528\u8001\u5e08\u63d0\u4f9b\u7684postman\u63a5\u53e3\u8fdb\u884c\u6d4b\u8bd5 \u542f\u52a81.admin 2.admin-gateway\u7f51\u5173","title":"06-jwt\u6821\u9a8c-\u6d4b\u8bd5 06:01"},{"location":"hmtt/day03/#07-app-_0723","text":"\u7528\u6237\u5728app\u7aef\u63d0\u4ea4\u8ba4\u8bc1\u4fe1\u606f\u4e4b\u540e\uff0c\u4fe1\u606f\u4f1a\u5f55\u5165\u5230leadnews_user\u6570\u636e\u5e93\u4e2d\u7684ap_user_realname\u8868","title":"07-app\u7528\u6237\u8ba4\u8bc1\u5217\u8868\u67e5\u8be2-\u601d\u8def\u548c\u5206\u6790 07:23"},{"location":"hmtt/day03/#08-app-_1418","text":"package com.heima.user.service.impl ; import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper ; import com.baomidou.mybatisplus.core.metadata.IPage ; import com.baomidou.mybatisplus.extension.plugins.pagination.Page ; import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl ; import com.heima.model.common.dtos.PageResponseResult ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.user.dtos.AuthDto ; import com.heima.model.user.pojos.ApUserRealname ; import com.heima.user.mapper.ApUserRealnameMapper ; import com.heima.user.service.ApUserRealnameService ; import org.springframework.stereotype.Service ; @Service public class ApUserRealnameServiceImpl extends ServiceImpl < ApUserRealnameMapper , ApUserRealname > implements ApUserRealnameService { @Override public ResponseResult loadListByStatus ( AuthDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //\u5206\u9875\u68c0\u67e5 dto . checkParam (); //2.\u6839\u636e\u72b6\u6001\u5206\u9875\u67e5\u8be2 LambdaQueryWrapper < ApUserRealname > lambdaQueryWrapper = new LambdaQueryWrapper (); if ( dto . getStatus () != null ){ lambdaQueryWrapper . eq ( ApUserRealname :: getStatus , dto . getStatus ()); } //\u5206\u9875\u6761\u4ef6\u6784\u5efa IPage pageParam = new Page ( dto . getPage (), dto . getSize ()); IPage page = page ( pageParam , lambdaQueryWrapper ); //3.\u8fd4\u56de\u7ed3\u679c PageResponseResult responseResult = new PageResponseResult ( dto . getPage (), dto . getSize (),( int ) page . getTotal ()); responseResult . setData ( page . getRecords ()); return responseResult ; } }","title":"08-app\u7528\u6237\u8ba4\u8bc1\u5217\u8868\u67e5\u8be2-\u529f\u80fd\u5b9e\u73b0 14:18"},{"location":"hmtt/day03/#09--_0419","text":"\u7528\u6237\u901a\u8fc7\u5ba1\u6838\u540e\u9700\u8981\u5f00\u901a\u81ea\u5a92\u4f53\u8d26\u53f7\uff08\u8be5\u8d26\u53f7\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u4e0eapp\u4e00\u81f4\uff09 \u7528\u6237\u901a\u8fc7\u5ba1\u6838\u540e\u9700\u8981\u5728article\u4e2d\u5728\u4f5c\u8005\u8868\u4e2d\u65b0\u5efa\u4e00\u4e2a\u4f5c\u8005\u4fe1\u606f","title":"09-\u5ba1\u6838-\u601d\u8def\u5206\u6790 04:19"},{"location":"hmtt/day03/#10-_0805","text":"wm_user \u81ea\u5a92\u4f53\u7528\u6237\u8868","title":"10-\u81ea\u5a92\u4f53\u5de5\u7a0b\u642d\u5efa 08:05"},{"location":"hmtt/day03/#11-_1032","text":"package com.heima.wemedia.controller.v1 ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.apis.wemedia.WmUserControllerApi ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.wemedia.pojos.WmUser ; import com.heima.wemedia.service.WmUserService ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.* ; import javax.ws.rs.POST ; import java.util.List ; @RestController @RequestMapping ( \"/api/v1/user\" ) public class WmUserController implements WmUserControllerApi { @Autowired private WmUserService wmUserService ; @PostMapping ( \"/save\" ) @Override public ResponseResult save ( @RequestBody WmUser wmUser ) { wmUserService . save ( wmUser ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } @GetMapping ( \"/findByName/{name}\" ) @Override public WmUser findByName ( @PathVariable ( \"name\" ) String name ) { List < WmUser > list = wmUserService . list ( Wrappers . < WmUser > lambdaQuery (). eq ( WmUser :: getName , name )); if ( list != null && ! list . isEmpty ()){ return list . get ( 0 ); } return null ; } }","title":"11-\u81ea\u5a92\u4f53\u63a5\u53e3\u5b9e\u73b0 10\uff1a32"},{"location":"hmtt/day03/#12-_1521","text":"ap_author \u4f5c\u8005\u4fe1\u606f\u8868 user_id\u5173\u8054\u5230ap_user\u8868 \u63a5\u53e3\u8be6\u89c1\u63a5\u53e3\u6587\u6863","title":"12-\u4f5c\u8005\u8fdc\u7a0b\u63a5\u53e3 15:21"},{"location":"hmtt/day03/#13-_0606","text":"\u8be6\u89c1\u7528\u6237\u670d\u52a1\u63a5\u53e3\u6587\u6863\uff1aauthPass app\u7aef\u7528\u6237\u4fe1\u606f\u8868","title":"13-\u5ba1\u6838\u63a5\u53e3\u5b9a\u4e49 06:06"},{"location":"hmtt/day03/#14--feign_0517","text":"package com.heima.user.feign ; import com.heima.model.article.pojos.ApAuthor ; import com.heima.model.common.dtos.ResponseResult ; import org.springframework.cloud.openfeign.FeignClient ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.PathVariable ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestBody ; @FeignClient ( \"leadnews-article\" ) public interface ArticleFeign { @GetMapping ( \"/api/v1/author/findByUserId/{id}\" ) public ApAuthor findByUserId ( @PathVariable ( \"id\" ) Integer id ); @PostMapping ( \"/api/v1/author/save\" ) public ResponseResult save ( @RequestBody ApAuthor apAuthor ); } package com.heima.user.feign ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.wemedia.pojos.WmUser ; import org.springframework.cloud.openfeign.FeignClient ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.PathVariable ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestBody ; @FeignClient ( \"leadnews-wemedia\" ) public interface WemediaFeign { @PostMapping ( \"/api/v1/user/save\" ) public ResponseResult save ( @RequestBody WmUser wmUser ); @GetMapping ( \"/api/v1/user/findByName/{name}\" ) public WmUser findByName ( @PathVariable ( \"name\" ) String name ); }","title":"14-\u5ba1\u6838-\u7528\u6237\u5b9a\u4e49feign\u63a5\u53e3 05:17"},{"location":"hmtt/day03/#15--1_1138","text":"\u4e1a\u52a1\u903b\u8f91\uff1a //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || dto . getId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //\u68c0\u67e5\u72b6\u6001 if ( checkStatus ( status )){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u4fee\u6539\u72b6\u6001 ApUserRealname apUserRealname = new ApUserRealname (); apUserRealname . setId ( dto . getId ()); apUserRealname . setStatus ( status ); if ( dto . getMsg () != null ){ apUserRealname . setReason ( dto . getMsg ()); } updateById ( apUserRealname ); \u5e38\u91cf\uff1a\u72b6\u6001 0 \u521b\u5efa\u4e2d 1 \u5f85\u5ba1\u6838 2 \u5ba1\u6838\u5931\u8d25 9 \u5ba1\u6838\u901a\u8fc7 package com.heima.common.constans.user ; public class UserConstants { //leadnews_user\u7684ap_user_realname\u7684status\u5b9a\u4e49 0 \u521b\u5efa\u4e2d 1 \u5f85\u5ba1\u6838 2 \u5ba1\u6838\u5931\u8d25 9 \u5ba1\u6838\u901a\u8fc7 //2 \u5ba1\u6838\u5931\u8d25 public static final Short FAIL_AUTH = 2 ; //9 \u5ba1\u6838\u901a\u8fc7 public static final Short PASS_AUTH = 9 ; //leadnews_article\u7684ap_author type\u5b9a\u4e490 \u722c\u53d6\u6570\u636e 1 \u7b7e\u7ea6\u5408\u4f5c\u5546 2 \u5e73\u53f0\u81ea\u5a92\u4f53\u4eba //0 \u722c\u53d6\u6570\u636e 1 \u7b7e\u7ea6\u5408\u4f5c\u5546 2 \u5e73\u53f0\u81ea\u5a92\u4f53\u4eba public static final Integer AUTH_TYPE = 2 ; }","title":"15-\u5ba1\u6838-\u4e1a\u52a1\u5c42\u5b9e\u73b01 11:38"},{"location":"hmtt/day03/#16--2_0939","text":"ap_user_realname\u6839\u636euser_id\u5173\u8054\u5230ap_user\u4e2d\u7684\u6570\u636e \u518d\u8c03\u7528WmUser\u63a5\u53e3\u521b\u5efa\u81ea\u5a92\u4f53\u7684\u7528\u6237 private ResponseResult createWmUserAndAuthor ( AuthDto dto ) { //\u83b7\u53d6ap_user\u4fe1\u606f Integer apUserRealnameId = dto . getId (); ApUserRealname apUserRealname = getById ( apUserRealnameId ); ApUser apUser = apUserMapper . selectById ( apUserRealname . getUserId ()); if ( apUser == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } WmUser wmUser = wemediaFeign . findByName ( apUser . getName ()); //\u521b\u5efa\u81ea\u5a92\u4f53\u8d26\u6237 if ( wmUser == null ){ wmUser = new WmUser (); wmUser . setApUserId ( apUser . getId ()); wmUser . setCreatedTime ( new Date ()); wmUser . setName ( apUser . getName ()); wmUser . setPassword ( apUser . getPassword ()); wmUser . setSalt ( apUser . getSalt ()); wmUser . setPhone ( apUser . getPhone ()); wmUser . setStatus ( 9 ); wemediaFeign . save ( wmUser ); } else { //\u6dfb\u52a0\u5f02\u5e38\u5904\u7406 } //\u521b\u5efa\u4f5c\u8005 createAuthor ( wmUser ); apUser . setFlag (( short ) 1 ); apUserMapper . updateById ( apUser ); return null ; }","title":"16-\u5ba1\u6838-\u4e1a\u52a1\u5c42\u5b9e\u73b02 09:39"},{"location":"hmtt/day03/#wemediafindbyname","text":"\u8c03\u7528WmUser\u63a5\u53e3\u521b\u5efa\u81ea\u5a92\u4f53\u7684\u7528\u6237\u4e4b\u524d\u67e5\u8be2\u662f\u5426\u5b58\u5728\uff0c\u9996\u5148\u8fd9\u7c7b\u63a5\u53e3\u8bbe\u8ba1\u5b8c\u5168\u53ef\u4ee5\u653e\u5728wemedia\u5fae\u670d\u52a1\u4e2d\uff0c\u5176\u6b21\u8fd9\u91cc\u6700\u597d\u7528id\u6765\u5224\u65ad\u800c\u4e0d\u662f\u540d\u5b57 WmUserControllerApi\u6dfb\u52a0\u63a5\u53e3: /** * \u6839\u636e\u7528\u6237id\u67e5\u8be2\u81ea\u5a92\u4f53\u7528\u6237 * @param id * @return */ public WmUser findByUserId ( @PathVariable ( \"id\" ) Integer id ); WmUserController\u6dfb\u52a0\u5b9e\u73b0: @GetMapping ( \"/findByUserId/{id}\" ) @Override public WmUser findByUserId ( Integer id ) { return wmUserService . getOne ( Wrappers . < WmUser > lambdaQuery (). eq ( WmUser :: getApUserId , id )); } WemediaFeign\u6dfb\u52a0\u5b9a\u4e49: @GetMapping ( \"/api/v1/user/findByUserId/{id}\" ) public WmUser findByUserId ( @PathVariable ( \"id\" ) Integer id ); ApUserRealnameServiceImpl\u4e2d\u7684createWmUserAndAuthor\u65b9\u6cd5\uff1a //WmUser wmUser = wemediaFeign.findByName(apUser.getName()); WmUser wmUser = wemediaFeign . findByUserId ( apUser . getId ());","title":"\u4f18\u5316wemedia\u7684findByName\u5224\u65ad\uff1a"},{"location":"hmtt/day03/#17--3_0654","text":"/** * \u521b\u5efa\u4f5c\u8005 * @param wmUser */ private void createAuthor ( WmUser wmUser ) { Integer apUserId = wmUser . getApUserId (); ApAuthor apAuthor = articleFeign . findByUserId ( apUserId ); if ( apAuthor == null ){ apAuthor = new ApAuthor (); apAuthor . setName ( wmUser . getName ()); apAuthor . setCreatedTime ( new Date ()); apAuthor . setUserId ( apUserId ); apAuthor . setType ( UserConstants . AUTH_TYPE ); articleFeign . save ( apAuthor ); } }","title":"17-\u5ba1\u6838-\u4e1a\u52a1\u5c42\u5b9e\u73b03 06:54"},{"location":"hmtt/day03/#18--_1234","text":"\u542f\u52a8Article\u3001User\u3001Wemedia \u4f7f\u7528\u8001\u5e08\u4e0b\u53d1\u7684postman\u811a\u672c\u8fdb\u884c\u6d4b\u8bd5","title":"18-\u5ba1\u6838-\u63a7\u5236\u5c42\u5b9e\u73b0\u53ca\u6d4b\u8bd5 12:34"},{"location":"hmtt/day03/#19-_0431","text":"\u542f\u52a8Article\u3001User\u3001Wemedia\u3001AdminGateway\u3001Admin \u4f18\u5316\uff1a \u524d\u7aef\u5728\u901a\u8fc7\u6216\u8005\u62d2\u7edd\u5ba1\u6838\u4e4b\u540e\uff0c\u5217\u8868\u663e\u793a\u6240\u6709\u7684\u6570\u636e \u4fee\u6539src\\views\\user_auth\\index.vue < template > < div > < search - tool : statusList = \"statusList\" : changeParam = \"searchAuthList\" /> < search - result ref = 'mySearchResult' : statusList = \"statusList\" : authList = \"authList\" : host = \"host\" : total = \"total\" : changePage = \"searchAuthList\" : pageSize = \"params.size\" : authPassRealName = \"authPassRealName\" : authFailRealName = \"authFailRealName\" /> < /div> < /template> < script > import SearchTool from './components/SearchTool.vue' import SearchResult from './components/SearchResult.vue' import { findAuthList , authPass , authFail } from '@/api/user_auth' export default { name : 'AuthManage' , data () { return { params : { page : 1 , size : 10 }, total : 0 , host : '' , statusList : [ { label : '' , value : '\u5168\u90e8' }, { label : 0 , value : '\u521b\u5efa\u4e2d' }, { label : 1 , value : '\u5f85\u5ba1\u6838' }, { label : 2 , value : '\u5ba1\u6838\u5931\u8d25' }, { label : 9 , value : '\u5ba1\u6838\u901a\u8fc7' } ], authList : [], searchParam : null } }, created () { this . searchAuthList () }, components : { SearchTool , SearchResult }, methods : { async searchAuthList ( newParams ) { const res = await findAuthList ({ ... this . params , ... newParams }) if ( res . code === 200 ) { this . authList = res . data this . host = res . host this . total = res . total } else { this . $message ({ type : 'error' , message : res . error_message }) } //\u5237\u65b0\u5b8c\uff0c\u672c\u5730\u8bb0\u4f4f\u5f53\u524d\u9009\u4e2d\u7684\u6309\u94ae console . log ( newParams ) this . searchParam = newParams }, async authPassRealName ( params ) { const res = await authPass ( params ) if ( res . code === 200 ) { this . $message ({ type : 'success' , message : '\u64cd\u4f5c\u6210\u529f' }) } else { this . $message ({ type : 'success' , message : res . error_message }) } //\u4f20\u9012\u4e0a\u65b9\u6309\u94ae\u7684\u7c7b\u578b this . searchAuthList ( this . searchParam ) }, async authFailRealName ( params ) { //\u53d1\u9001\u8bf7\u6c42 await authFail ( params ) //\u5237\u65b0\u5217\u8868\u6570\u636e this . searchAuthList ( this . searchParam ) } } } < /script>","title":"19-\u7ed3\u5408\u524d\u53f0\u7efc\u5408\u6d4b\u8bd5 04:31"},{"location":"hmtt/day03/%E6%96%87%E7%AB%A0%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/","text":"\u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863 \u00b6 \u7b80\u4ecb :\u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863 HOST :localhost:9003 \u8054\u7cfb\u4eba :\u9ed1\u9a6c\u7a0b\u5e8f\u5458 Version :1.0.0 \u63a5\u53e3\u8def\u5f84 :/v2/api-docs \u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863 author-controller findByUserId save author-controller \u00b6 findByUserId \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/author/findByUserId/{id} \u8bf7\u6c42\u65b9\u5f0f : GET \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : * \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema id id path true integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ApAuthor 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema createdTime string(date-time) string(date-time) id integer(int32) integer(int32) name string type integer(int32) integer(int32) userId integer(int32) integer(int32) wmUserId integer(int32) integer(int32) \u54cd\u5e94\u793a\u4f8b : { \"createdTime\" : \"\" , \"id\" : 0 , \"name\" : \"\" , \"type\" : 0 , \"userId\" : 0 , \"wmUserId\" : 0 } save \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/author/save \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"createdTime\" : \"\" , \"id\" : 0 , \"name\" : \"\" , \"type\" : 0 , \"userId\" : 0 , \"wmUserId\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema apAuthor apAuthor body true ApAuthor ApAuthor \u2003\u2003createdTime false string(date-time) \u2003\u2003id false integer(int32) \u2003\u2003name false string \u2003\u2003type false integer(int32) \u2003\u2003userId false integer(int32) \u2003\u2003wmUserId false integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"\u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863"},{"location":"hmtt/day03/%E6%96%87%E7%AB%A0%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#-api","text":"\u7b80\u4ecb :\u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863 HOST :localhost:9003 \u8054\u7cfb\u4eba :\u9ed1\u9a6c\u7a0b\u5e8f\u5458 Version :1.0.0 \u63a5\u53e3\u8def\u5f84 :/v2/api-docs \u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863 author-controller findByUserId save","title":"\u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863"},{"location":"hmtt/day03/%E6%96%87%E7%AB%A0%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#author-controller","text":"","title":"author-controller"},{"location":"hmtt/day03/%E6%96%87%E7%AB%A0%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#findbyuserid","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/author/findByUserId/{id} \u8bf7\u6c42\u65b9\u5f0f : GET \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : * \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema id id path true integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ApAuthor 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema createdTime string(date-time) string(date-time) id integer(int32) integer(int32) name string type integer(int32) integer(int32) userId integer(int32) integer(int32) wmUserId integer(int32) integer(int32) \u54cd\u5e94\u793a\u4f8b : { \"createdTime\" : \"\" , \"id\" : 0 , \"name\" : \"\" , \"type\" : 0 , \"userId\" : 0 , \"wmUserId\" : 0 }","title":"findByUserId"},{"location":"hmtt/day03/%E6%96%87%E7%AB%A0%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#save","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/author/save \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"createdTime\" : \"\" , \"id\" : 0 , \"name\" : \"\" , \"type\" : 0 , \"userId\" : 0 , \"wmUserId\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema apAuthor apAuthor body true ApAuthor ApAuthor \u2003\u2003createdTime false string(date-time) \u2003\u2003id false integer(int32) \u2003\u2003name false string \u2003\u2003type false integer(int32) \u2003\u2003userId false integer(int32) \u2003\u2003wmUserId false integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"save"},{"location":"hmtt/day03/%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/","text":"\u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863 \u00b6 \u7b80\u4ecb :\u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863 HOST :localhost:9002 \u8054\u7cfb\u4eba :\u9ed1\u9a6c\u7a0b\u5e8f\u5458 Version :1.0.0 \u63a5\u53e3\u8def\u5f84 :/v2/api-docs \u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863 ap-user-realname-controller authFail authPass loadListByStatus ap-user-realname-controller \u00b6 authFail \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/auth/authFail \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"id\" : 0 , \"msg\" : \"\" , \"page\" : 0 , \"size\" : 0 , \"status\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true AuthDto AuthDto \u2003\u2003id false integer(int32) \u2003\u2003msg false string \u2003\u2003page \u5f53\u524d\u9875 true integer(int32) \u2003\u2003size \u6bcf\u9875\u663e\u793a\u6761\u6570 true integer(int32) \u2003\u2003status false integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" } authPass \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/auth/authPass \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"id\" : 0 , \"msg\" : \"\" , \"page\" : 0 , \"size\" : 0 , \"status\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true AuthDto AuthDto \u2003\u2003id false integer(int32) \u2003\u2003msg false string \u2003\u2003page \u5f53\u524d\u9875 true integer(int32) \u2003\u2003size \u6bcf\u9875\u663e\u793a\u6761\u6570 true integer(int32) \u2003\u2003status false integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" } loadListByStatus \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/auth/list \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"id\" : 0 , \"msg\" : \"\" , \"page\" : 0 , \"size\" : 0 , \"status\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true AuthDto AuthDto \u2003\u2003id false integer(int32) \u2003\u2003msg false string \u2003\u2003page \u5f53\u524d\u9875 true integer(int32) \u2003\u2003size \u6bcf\u9875\u663e\u793a\u6761\u6570 true integer(int32) \u2003\u2003status false integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"\u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863"},{"location":"hmtt/day03/%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#-api","text":"\u7b80\u4ecb :\u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863 HOST :localhost:9002 \u8054\u7cfb\u4eba :\u9ed1\u9a6c\u7a0b\u5e8f\u5458 Version :1.0.0 \u63a5\u53e3\u8def\u5f84 :/v2/api-docs \u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863 ap-user-realname-controller authFail authPass loadListByStatus","title":"\u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863"},{"location":"hmtt/day03/%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#ap-user-realname-controller","text":"","title":"ap-user-realname-controller"},{"location":"hmtt/day03/%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#authfail","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/auth/authFail \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"id\" : 0 , \"msg\" : \"\" , \"page\" : 0 , \"size\" : 0 , \"status\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true AuthDto AuthDto \u2003\u2003id false integer(int32) \u2003\u2003msg false string \u2003\u2003page \u5f53\u524d\u9875 true integer(int32) \u2003\u2003size \u6bcf\u9875\u663e\u793a\u6761\u6570 true integer(int32) \u2003\u2003status false integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"authFail"},{"location":"hmtt/day03/%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#authpass","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/auth/authPass \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"id\" : 0 , \"msg\" : \"\" , \"page\" : 0 , \"size\" : 0 , \"status\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true AuthDto AuthDto \u2003\u2003id false integer(int32) \u2003\u2003msg false string \u2003\u2003page \u5f53\u524d\u9875 true integer(int32) \u2003\u2003size \u6bcf\u9875\u663e\u793a\u6761\u6570 true integer(int32) \u2003\u2003status false integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"authPass"},{"location":"hmtt/day03/%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#loadlistbystatus","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/auth/list \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"id\" : 0 , \"msg\" : \"\" , \"page\" : 0 , \"size\" : 0 , \"status\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true AuthDto AuthDto \u2003\u2003id false integer(int32) \u2003\u2003msg false string \u2003\u2003page \u5f53\u524d\u9875 true integer(int32) \u2003\u2003size \u6bcf\u9875\u663e\u793a\u6761\u6570 true integer(int32) \u2003\u2003status false integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"loadListByStatus"},{"location":"hmtt/day04/","text":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 01:06 \u00b6 \u80fd\u591f\u7406\u89e3\u4ec0\u4e48\u662f\u5206\u5e03\u5f0f\u4e8b\u52a1 \u80fd\u591f\u7406\u89e3CAP\u5b9a\u7406\u548cBASE\u7406\u8bba \u80fd\u591f\u638c\u63e1seata\u8981\u89e3\u51b3\u7684\u95ee\u9898 \u80fd\u591f\u5b8c\u6210seata\u96c6\u6210\u5230\u9879\u76ee\u4e2d\u4f7f\u7528 \u80fd\u591f\u638c\u63e1\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edffastdfs\u7684\u57fa\u672c\u4f7f\u7528 \u80fd\u591f\u5b8c\u6210\u7d20\u6750\u7ba1\u7406\u529f\u80fd \u80fd\u591f\u5b8c\u6210\u81ea\u5a92\u4f53\u6587\u7ae0\u5217\u8868\u67e5\u8be2\u529f\u80fd 02-\u7528\u6237\u5b9e\u540d\u8ba4\u8bc1\u5ba1\u6838\u4e8b\u52a1\u95ee\u9898 03:36 \u00b6 \u6211\u4eec\u6628\u5929\u7f16\u5199\u7684\u7528\u6237\u8ba4\u8bc1\u5ba1\u6838\u7684\u4ee3\u7801\u670d\u52a1\u4e2d\u5b58\u5728\u7684\uff0c\u5982\u679c\u5ba1\u6838\u5b8c\u7528\u6237\u540e\u51fa\u4e86\u5f02\u5e38\u662f\u4e0d\u4f1a\u56de\u6eda\u7684 \u7528\u6237\u5ba1\u6838\u6d89\u53caUser\u3001Article\u3001Wemedia\u5fae\u670d\u52a1\uff0c\u8fd9\u4e09\u4e2a\u5fae\u670d\u52a1\u5404\u81ea\u6709\u81ea\u5df1\u7684\u4e8b\u52a1\u7ba1\u7406 \u4efb\u610f\u4e00\u4e2a\u5fae\u670d\u52a1\u51fa\u9519\uff0c\u53ea\u80fd\u5728\u81ea\u5df1\u7684\u5fae\u670d\u52a1\u4e2d\u8fdb\u884c\u4e8b\u52a1\u56de\u6eda \u8fd9\u6837\u5c31\u4f1a\u9020\u6210\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\uff0c\u8fd9\u5176\u5b9e\u5c31\u662f\u6211\u4eec\u6240\u8bf4\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u95ee\u9898 03-\u672c\u5730\u4e8b\u52a1\u56de\u987e 04:45 \u00b6 \u4e8b\u52a1\u62e5\u6709\u4ee5\u4e0b\u56db\u4e2a\u7279\u6027\uff0c\u4e60\u60ef\u4e0a\u88ab\u79f0\u4e3aACID\u7279\u6027\uff1a \u539f\u5b50\u6027(Atomicity) \uff1a\u5373\u4e8b\u52a1\u6700\u7ec8\u7684\u72b6\u6001\u53ea\u6709\u4e24\u79cd\uff0c\u5168\u90e8\u6267\u884c\u6210\u529f\u548c\u5168\u90e8\u4e0d\u6267\u884c\u3002\u82e5\u5904\u7406\u4e8b\u52a1\u7684\u4efb\u4f55\u4e00\u9879\u64cd\u4f5c\u4e0d\u6210\u529f\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6574\u4e2a\u4e8b\u52a1\u5931\u8d25\u3002\u4e00\u65e6\u64cd\u4f5c\u5931\u8d25\uff0c\u6240\u6709\u64cd\u4f5c\u90fd\u4f1a\u88ab\u53d6\u6d88\uff08\u5373\u56de\u6eda\uff09\uff0c\u4f7f\u5f97\u4e8b\u52a1\u4eff\u4f5b\u6ca1\u6709\u88ab\u6267\u884c\u8fc7\u4e00\u6837\u3002 \u4e00\u81f4\u6027(Consistency) \uff1a\uff0c\u662f\u6307\u4e8b\u52a1\u64cd\u4f5c\u524d\u548c\u64cd\u4f5c\u540e\uff0c\u6570\u636e\u7684\u5b8c\u6574\u6027\u4fdd\u6301\u4e00\u81f4\u6216\u6ee1\u8db3\u5b8c\u6574\u6027\u7ea6\u675f\u3002\u6bd4\u5982\uff0c\u7528\u6237 A \u548c\u7528\u6237 B \u5728\u94f6\u884c\u5206\u522b\u6709 800 \u5143\u548c 600 \u5143\uff0c\u603b\u5171 1400 \u5143\uff0c\u7528\u6237 A \u7ed9\u7528\u6237 B \u8f6c\u8d26 200 \u5143\uff0c\u5206\u4e3a\u4e24\u4e2a\u6b65\u9aa4\uff0c\u4ece A \u7684\u8d26\u6237\u6263\u9664 200 \u5143\u548c\u5bf9 B \u7684\u8d26\u6237\u589e\u52a0 200 \u5143 ; \u4e00\u81f4\u6027\u5c31\u662f\u8981\u6c42\u4e0a\u8ff0\u6b65\u9aa4\u64cd\u4f5c\u540e\uff0c\u6700\u540e\u7684\u7ed3\u679c\u662f\u7528\u6237 A \u8fd8\u6709 600 \u5143\uff0c\u7528\u6237 B \u6709 800 \u5143\uff0c\u603b\u5171 1400 \u5143\uff0c\u800c\u4e0d\u4f1a\u51fa\u73b0\u7528\u6237 A \u6263\u9664\u4e86 200 \u5143\uff0c\u4f46\u7528\u6237 B \u672a\u589e\u52a0\u7684\u60c5\u51b5 (\u8be5\u60c5\u51b5\uff0c\u7528\u6237 A \u548c B \u5747\u4e3a 600 \u5143\uff0c\u603b\u5171 1200 \u5143)\u3002 \u9694\u79bb\u6027(Isolation) \uff1a\u662f\u6307\u5f53\u7cfb\u7edf\u5185\u6709\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u6267\u884c\u65f6\uff0c\u591a\u4e2a\u4e8b\u52a1\u4e0d\u4f1a\u76f8\u4e92\u5e72\u6270\uff0c\u5373\u4e00\u4e2a\u4e8b\u52a1\u5185\u90e8\u7684\u64cd\u4f5c\u53ca\u4f7f\u7528\u7684\u6570\u636e\uff0c\u5bf9\u5176\u4ed6\u5e76\u53d1\u4e8b\u52a1\u662f\u9694\u79bb\u7684\u3002 \u6301\u4e45\u6027(Durability) \uff1a\u4e5f\u88ab\u79f0\u4e3a\u6c38\u4e45\u6027\uff0c\u662f\u6307\u4e00\u4e2a\u4e8b\u52a1\u5b8c\u6210\u4e86\uff0c\u90a3\u4e48\u5b83\u5bf9\u6570\u636e\u5e93\u6240\u505a\u7684\u66f4\u65b0\u5c31\u88ab\u6c38\u4e45\u4fdd\u5b58\u4e0b\u6765\u4e86\u3002\u5373\u4f7f\u53d1\u751f\u7cfb\u7edf\u5d29\u6e83\u6216\u5b95\u673a\u7b49\u6545\u969c\uff0c\u53ea\u8981\u6570\u636e\u5e93\u80fd\u591f\u91cd\u65b0\u88ab\u8bbf\u95ee\uff0c\u90a3\u4e48\u4e00\u5b9a\u80fd\u591f\u5c06\u5176\u6062\u590d\u5230\u4e8b\u52a1\u5b8c\u6210\u65f6\u7684\u72b6\u6001\u3002 04-\u5206\u5e03\u5f0f\u4e8b\u52a1 03:11 \u00b6 \u5206\u5e03\u5f0f\u4e8b\u52a1\u6307\u4e8b\u52a1\u7684\u53c2\u4e0e\u8005\u3001\u652f\u6301\u4e8b\u52a1\u7684\u670d\u52a1\u5668\u3001\u8d44\u6e90\u670d\u52a1\u5668\u4ee5\u53ca\u4e8b\u52a1\u7ba1\u7406\u5668\u5206\u522b\u4f4d\u4e8e\u4e0d\u540c\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u4e0d\u540c\u8282\u70b9\u4e4b\u4e0a,\u4e14\u5c5e\u4e8e\u4e0d\u540c\u7684\u5e94\u7528\uff0c\u5206\u5e03\u5f0f\u4e8b\u52a1\u9700\u8981\u4fdd\u8bc1\u8fd9\u4e9b\u64cd\u4f5c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u3002 \u5bf9\u4e8e\u7f51\u4e0a\u8d2d\u7269\u7684\u6bcf\u4e00\u7b14\u8ba2\u5355\u6765\u8bf4\uff0c\u7535\u5546\u5e73\u53f0\u4e00\u822c\u90fd\u4f1a\u6709\u4e24\u4e2a\u6838\u5fc3\u6b65\u9aa4\uff1a\u4e00\u662f\u8ba2\u5355\u4e1a\u52a1\u91c7\u53d6\u4e0b\u8ba2\u5355\u64cd\u4f5c\uff0c\u4e8c\u662f\u5e93\u5b58\u4e1a\u52a1\u91c7\u53d6\u51cf\u5e93\u5b58\u64cd\u4f5c\u3002 \u901a\u5e38\uff0c\u8fd9\u4e24\u4e2a\u4e1a\u52a1\u4f1a\u8fd0\u884c\u5728\u4e0d\u540c\u7684\u673a\u5668\u4e0a\uff0c\u751a\u81f3\u662f\u8fd0\u884c\u5728\u4e0d\u540c\u533a\u57df\u7684\u673a\u5668\u4e0a\u3002\u9488\u5bf9\u540c\u4e00\u7b14\u8ba2\u5355\uff0c\u5f53\u4e14\u4ec5\u5f53\u8ba2\u5355\u64cd\u4f5c\u548c\u51cf\u5e93\u5b58\u64cd\u4f5c\u4e00\u81f4\u65f6\uff0c\u624d\u80fd\u4fdd\u8bc1\u4ea4\u6613\u7684\u6b63\u786e\u6027\u3002\u4e5f\u5c31\u662f\u8bf4\u4e00\u7b14\u8ba2\u5355\uff0c\u53ea\u6709\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u90fd\u5b8c\u6210\uff0c\u624d\u80fd\u7b97\u505a\u5904\u7406\u6210\u529f\uff0c\u5426\u5219\u5904\u7406\u5931\u8d25\uff0c\u5145\u5206\u4f53\u73b0\u4e86\u201cAll or nothing\u201d\u7684\u601d\u60f3\u3002 05-CAP\u5b9a\u7406 12:06 \u00b6 C -> \u4e00\u81f4\u6027 A -> \u53ef\u7528\u6027 P -> \u5206\u533a\u5bb9\u9519\u6027 CAP\u5b9a\u7406\u7684\u9002\u7528\u8303\u56f4\uff1a \u00b6 \u5206\u5e03\u5f0f\u7cfb\u7edf\u5e76\u4e0d\u4e00\u5b9a\u4f1a\u4e92\u8054\u548c\u5171\u4eab\u6570\u636e \u00b6 \u6700\u7b80\u5355\u7684\u4f8b\u5982 Memcache \u7684\u96c6\u7fa4\uff0c\u76f8\u4e92\u4e4b\u95f4\u5c31\u6ca1\u6709\u8fde\u63a5\u548c\u5171\u4eab\u6570\u636e\uff0c\u56e0\u6b64 Memcache \u96c6\u7fa4\u8fd9\u7c7b\u5206\u5e03\u5f0f\u7cfb\u7edf\u5c31\u4e0d\u7b26\u5408 CAP \u7406\u8bba\u63a2\u8ba8\u7684\u5bf9\u8c61\uff1b\u800c MySQL \u96c6\u7fa4\u5c31\u662f\u4e92\u8054\u548c\u8fdb\u884c\u6570\u636e\u590d\u5236\u7684\uff0c\u56e0\u6b64\u662f CAP \u7406\u8bba\u63a2\u8ba8\u7684\u5bf9\u8c61\u3002 CAP \u5173\u6ce8\u7684\u662f\u5bf9\u6570\u636e\u7684\u8bfb\u5199\u64cd\u4f5c\uff0c\u800c\u4e0d\u662f\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u6240\u6709\u529f\u80fd \u00b6 ZooKeeper \u7684\u9009\u4e3e\u673a\u5236\u5c31\u4e0d\u662f CAP \u63a2\u8ba8\u7684\u5bf9\u8c61 \u5047\u8bbe\u67d0\u7535\u5546\uff0c\u5728\u5317\u4eac\u3001\u676d\u5dde\u3001\u4e0a\u6d77\u4e09\u4e2a\u57ce\u5e02\u5efa\u7acb\u4e86\u4ed3\u5e93\uff0c\u540c\u65f6\u5efa\u7acb\u4e86\u5bf9\u5e94\u7684\u670d\u52a1\u5668{A, B, C}\u7528\u4e8e\u5b58\u50a8\u5546\u54c1\u4fe1\u606f\u3002 \u6bd4\u5982\uff0c\u67d0\u7535\u5439\u98ce\u5728\u5317\u4eac\u4ed3\u5e93\u6709 20 \u4e2a\uff0c\u5728\u676d\u5dde\u4ed3\u5e93\u6709 10 \u4e2a\uff0c\u5728\u4e0a\u6d77\u4ed3\u5e93\u6709 30 \u4e2a\u3002 \u90a3\u4e48\uff0cCAP \u8fd9\u4e09\u4e2a\u5b57\u6bcd\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u5206\u522b\u4ee3\u8868\u4ec0\u4e48\u5462\uff1f \u9996\u5148\uff0c\u6211\u4eec\u6765\u770b\u4e00\u4e0b C\u3002C \u4ee3\u8868 Consistency\uff0c\u4e00\u81f4\u6027\uff0c\u662f\u6307\u6240\u6709\u8282\u70b9\u5728\u540c\u4e00\u65f6\u523b\u7684\u6570\u636e\u662f\u76f8\u540c\u7684\uff0c\u5373\u66f4\u65b0\u64cd\u4f5c\u6267\u884c\u7ed3\u675f\u5e76\u54cd\u5e94\u7528\u6237\u5b8c\u6210\u540e\uff0c\u6240\u6709\u8282\u70b9\u5b58\u50a8\u7684\u6570\u636e\u4f1a\u4fdd\u6301\u76f8\u540c\u3002\u5728\u7535\u5546\u7cfb\u7edf\u4e2d\uff0cA\u3001B\u3001C \u4e2d\u5b58\u50a8\u7684\u8be5\u7535\u5439\u98ce\u7684\u6570\u91cf\u5e94\u8be5\u662f 20+10+30=60\u3002\u5047\u8bbe\uff0c\u73b0\u5728\u6709\u4e00\u4e2a\u5317\u4eac\u7528\u6237\u4e70\u8d70\u4e00\u4e2a\u7535\u5439\u98ce\uff0c\u670d\u52a1\u5668 A \u4f1a\u66f4\u65b0\u6570\u636e\u4e3a 60-1=59\uff0c\u4e0e\u6b64\u540c\u65f6\u8981\u6c42 B \u548c C \u4e5f\u66f4\u65b0\u4e3a 59\uff0c\u4ee5\u4fdd\u8bc1\u5728\u540c\u4e00\u65f6\u523b\uff0c\u65e0\u8bba\u8bbf\u95ee A\u3001B\u3001C \u4e2d\u7684\u54ea\u4e2a\u670d\u52a1\u5668\uff0c\u5f97\u5230\u7684\u6570\u636e\u5747\u662f 59\u3002 \u7136\u540e\uff0c\u770b\u4e00\u4e0b A\u3002A \u4ee3\u8868 Availability\uff0c\u53ef\u7528\u6027\uff0c\u662f\u6307\u7cfb\u7edf\u63d0\u4f9b\u7684\u670d\u52a1\u4e00\u76f4\u5904\u4e8e\u53ef\u7528\u72b6\u6001\uff0c\u5bf9\u4e8e\u7528\u6237\u7684\u8bf7\u6c42\u53ef\u5373\u65f6\u54cd\u5e94\u3002\u5728\u7535\u5546\u7cfb\u7edf\u4e2d\uff0c\u7528\u6237\u5728\u4efb\u4e00\u65f6\u523b\u5411 A\u3001B\u3001C \u4e2d\u7684\u4efb\u4e00\u670d\u52a1\u5668\u53d1\u51fa\u8bf7\u6c42\u65f6\uff0c\u5747\u53ef\u5f97\u5230\u5373\u65f6\u54cd\u5e94\uff0c\u6bd4\u5982\u67e5\u8be2\u5546\u54c1\u4fe1\u606f\u7b49\u3002 \u6700\u540e\uff0c\u6211\u4eec\u770b\u4e00\u4e0b P\u3002P \u4ee3\u8868 Partition Tolerance\uff0c\u5206\u533a\u5bb9\u9519\u6027\uff0c\u662f\u6307\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u9047\u5230\u7f51\u7edc\u5206\u533a\u7684\u60c5\u51b5\u4e0b\uff0c\u4ecd\u7136\u53ef\u4ee5\u54cd\u5e94\u7528\u6237\u7684\u8bf7\u6c42\u3002\u7f51\u7edc\u5206\u533a\u662f\u6307\u56e0\u4e3a\u7f51\u7edc\u6545\u969c\u5bfc\u81f4\u7f51\u7edc\u4e0d\u8fde\u901a\uff0c\u4e0d\u540c\u8282\u70b9\u5206\u5e03\u5728\u4e0d\u540c\u7684\u5b50\u7f51\u7edc\u4e2d\uff0c\u5404\u4e2a\u5b50\u7f51\u7edc\u5185\u7f51\u7edc\u6b63\u5e38\u3002\u5728\u7535\u5546\u7cfb\u7edf\u4e2d\uff0c\u5047\u8bbe C \u4e0e A \u548c B \u7684\u7f51\u7edc\u90fd\u4e0d\u901a\u4e86\uff0cA \u548c B \u662f\u76f8\u901a\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f62\u6210\u4e86\u4e24\u4e2a\u5206\u533a{A, B}\u548c{C}\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7cfb\u7edf\u4ecd\u80fd\u54cd\u5e94\u7528\u6237\u8bf7\u6c42\u3002 06-BASE\u7406\u8bba 03:52 \u00b6 BASE\uff1a\u5168\u79f0\uff1aBasically Available(\u57fa\u672c\u53ef\u7528)\uff0cSoft state\uff08\u8f6f\u72b6\u6001\uff09,\u548c Eventually consistent\uff08\u6700\u7ec8\u4e00\u81f4\u6027\uff09\u4e09\u4e2a\u77ed\u8bed\u7684\u7f29\u5199\uff0c\u6765\u81ea ebay \u7684\u67b6\u6784\u5e08\u63d0\u51fa\u3002BASE \u7406\u8bba\u662f\u5bf9 CAP \u4e2d\u4e00\u81f4\u6027\u548c\u53ef\u7528\u6027\u6743\u8861\u7684\u7ed3\u679c\uff0c\u5176\u6765\u6e90\u4e8e\u5bf9\u5927\u578b\u4e92\u8054\u7f51\u5206\u5e03\u5f0f\u5b9e\u8df5\u7684\u603b\u7ed3\uff0c\u662f\u57fa\u4e8e CAP \u5b9a\u7406\u9010\u6b65\u6f14\u5316\u800c\u6765\u7684\u3002 \u65e2\u662f\u65e0\u6cd5\u505a\u5230\u5f3a\u4e00\u81f4\u6027\uff08Strong consistency\uff09\uff0c\u4f46\u6bcf\u4e2a\u5e94\u7528\u90fd\u53ef\u4ee5\u6839\u636e\u81ea\u8eab\u7684\u4e1a\u52a1\u7279\u70b9\uff0c\u91c7\u7528\u9002\u5f53\u7684\u65b9\u5f0f\u6765\u4f7f\u7cfb\u7edf\u8fbe\u5230\u6700\u7ec8\u4e00\u81f4\u6027\uff08Eventual consistency\uff09\u3002 \u5f88\u591a\u540c\u5b66\u53ef\u80fd\u559c\u6b22\u4f7f\u7528\u4e8b\u52a1\u578b\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u6216\u8005\u662f\u5f3a\u4e00\u81f4\u6027\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u56e0\u4e3a\u4f7f\u7528\u8d77\u6765\u5f88\u65b9\u4fbf\uff0c\u4e0d\u9700\u8981\u8003\u8651\u592a\u591a\uff0c\u5c31\u50cf\u4f7f\u7528\u5355\u673a\u7cfb\u7edf\u4e00\u6837\u3002\u4f46\u662f\u5b66\u4e86 CAP \u7406\u8bba\u540e\uff0c\u4f60\u80af\u5b9a\u77e5\u9053\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u8981\u5b9e\u73b0\u5f3a\u4e00\u81f4\u6027\u5fc5\u7136\u4f1a\u5f71\u54cd\u53ef\u7528\u6027\u3002\u6bd4\u5982\uff0c\u5728\u91c7\u7528\u4e24\u9636\u6bb5\u63d0\u4ea4\u534f\u8bae\u7684\u96c6\u7fa4\u7cfb\u7edf\u4e2d\uff0c\u56e0\u4e3a\u6267\u884c\u63d0\u4ea4\u64cd\u4f5c\uff0c\u9700\u8981\u6240\u6709\u8282\u70b9\u786e\u8ba4\u548c\u6295\u7968\u3002 \u6240\u4ee5\uff0c\u96c6\u7fa4\u7684\u53ef\u7528\u6027\u662f\u6bcf\u4e2a\u8282\u70b9\u53ef\u7528\u6027\u7684\u4e58\u79ef\uff0c\u6bd4\u5982\uff0c\u5047\u8bbe 3 \u4e2a\u8282\u70b9\u7684\u96c6\u7fa4\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684\u53ef\u7528\u6027\u4e3a 99.9\uff05\uff0c\u90a3\u4e48\u6574\u4e2a\u96c6\u7fa4\u7684\u53ef\u7528\u6027\u4e3a 99.7\uff05\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c \u6bcf\u4e2a\u6708\u7ea6\u5b95\u673a 129.6 \u5206\u949f\uff0c\u8fd9\u662f\u975e\u5e38\u4e25\u91cd\u7684\u95ee\u9898 \u3002 \u800c\u89e3\u51b3\u53ef\u7528\u6027\u4f4e\u7684\u5173\u952e\u5728\u4e8e\uff0c\u6839\u636e\u5b9e\u9645\u573a\u666f\uff0c\u5c3d\u91cf\u91c7\u7528\u53ef\u7528\u6027\u4f18\u5148\u7684 AP \u6a21\u578b\u3002 \u8bb2\u5230\u8fd9\u513f\uff0c\u53ef\u80fd\u4f1a\u6709\u4e00\u4e9b\u540c\u5b66\u201c\u4e3e\u624b\u63d0\u95ee\u201d\uff1a\u8fd9\u4e5f\u592a\u96be\u4e86\uff0c\u96be\u9053\u6ca1\u6709\u73b0\u6210\u7684\u5e93\u6216\u8005\u65b9\u6848\uff0c\u6765\u5b9e\u73b0\u5408\u9002\u7684 AP \u6a21\u578b\uff1f\u662f\u7684\uff0c\u7684\u786e\u6ca1\u6709\u3002\u56e0\u4e3a\u5b83\u662f\u4e00\u4e2a\u52a8\u6001\u6a21\u578b\uff0c\u662f\u57fa\u4e8e\u4e1a\u52a1\u573a\u666f\u7279\u70b9\u59a5\u534f\u6298\u4e2d\u540e\u8bbe\u8ba1\u5b9e\u73b0\u7684\u3002\u4e0d\u8fc7\uff0c\u4f60\u53ef\u4ee5\u501f\u52a9 BASE \u7406\u8bba\u5e2e\u52a9\u4f60\u8fbe\u6210\u76ee\u7684\u3002 BASE \u7406\u8bba\u662f CAP \u7406\u8bba\u4e2d\u7684 AP \u7684\u5ef6\u4f38\uff0c\u662f\u5bf9\u4e92\u8054\u7f51\u5927\u89c4\u6a21\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u5b9e\u8df5\u603b\u7ed3\uff0c\u5f3a\u8c03\u53ef\u7528\u6027\u3002\u51e0\u4e4e\u6240\u6709\u7684\u4e92\u8054\u7f51\u540e\u53f0\u5206\u5e03\u5f0f\u7cfb\u7edf\u90fd\u6709 BASE \u7684\u652f\u6301\uff0c\u8fd9\u4e2a\u7406\u8bba\u5f88\u91cd\u8981\uff0c\u5730\u4f4d\u4e5f\u5f88\u9ad8\u3002\u4e00\u65e6\u638c\u63e1\u5b83\uff0c\u4f60\u5c31\u80fd\u638c\u63e1\u7edd\u5927\u90e8\u5206\u573a\u666f\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u67b6\u6784\u6280\u5de7\uff0c\u8bbe\u8ba1\u51fa\u9002\u5408\u4e1a\u52a1\u573a\u666f\u7279\u70b9\u7684\u3001\u9ad8\u53ef\u7528\u6027\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\u3002 \u5b9e\u73b0\u57fa\u672c\u53ef\u7528\u7684 4 \u677f\u65a7 \u00b6 \u5f53\u7cfb\u7edf\u8282\u70b9\u51fa\u73b0\u5927\u89c4\u6a21\u6545\u969c\u7684\u65f6\u5019\uff0c\u6bd4\u5982\u4e13\u7ebf\u7684\u5149\u7ea4\u88ab\u6316\u65ad\u3001\u7a81\u53d1\u6d41\u91cf\u5bfc\u81f4\u7cfb\u7edf\u8fc7\u8f7d\uff08\u51fa\u73b0\u4e86\u7a81\u53d1\u4e8b\u4ef6\uff0c\u670d\u52a1\u88ab\u5927\u91cf\u8bbf\u95ee\uff09\uff0c\u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u901a\u8fc7\u670d\u52a1\u964d\u7ea7\uff0c\u727a\u7272\u90e8\u5206\u529f\u80fd\u7684\u53ef\u7528\u6027\uff0c\u4fdd\u969c\u7cfb\u7edf\u7684\u6838\u5fc3\u529f\u80fd\u53ef\u7528\u3002 1.\u6d41\u91cf\u524a\u5cf0 \u00b6 \u200b \u5c31\u62ff 12306 \u8ba2\u7968\u7cfb\u7edf\u57fa\u672c\u53ef\u7528\u7684\u8bbe\u8ba1\u4e3a\u4f8b\uff0c\u8fd9\u4e2a\u8ba2\u7968\u7cfb\u7edf\u5728\u6625\u8fd0\u671f\u95f4\uff0c\u56e0\u4e3a\u5f00\u59cb\u552e\u7968\u540e\u5148\u5230\u5148\u5f97\u7684\u7f18\u6545\uff0c\u4f1a\u51fa\u73b0\u6781\u5176\u6d77\u91cf\u7684\u8bf7\u6c42\u5cf0\u503c\uff0c\u5982\u4f55\u5904\u7406\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f\u54b1\u4eec\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u65f6\u95f4\uff0c\u51fa\u552e\u4e0d\u540c\u533a\u57df\u7684\u7968\uff0c\u5c06\u8bbf\u95ee\u8bf7\u6c42\u9519\u5f00\uff0c\u524a\u5f31\u8bf7\u6c42\u5cf0\u503c\u3002\u6bd4\u5982\uff0c\u5728\u6625\u8fd0\u671f\u95f4\uff0c\u6df1\u5733\u51fa\u53d1\u7684\u706b\u8f66\u7968\u5728 8 \u70b9\u5f00\u552e\uff0c\u5317\u4eac\u51fa\u53d1\u7684\u706b\u8f66\u7968\u5728 9 \u70b9\u5f00\u552e\u3002\u8fd9\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684\u6d41\u91cf\u524a\u5cf0\u3002 2.\u5ef6\u8fdf\u54cd\u5e94 \u00b6 \u4f60\u53ef\u80fd\u5df2\u7ecf\u53d1\u73b0\u4e86\uff0c\u5728\u6625\u8fd0\u671f\u95f4\uff0c\u81ea\u5df1\u63d0\u4ea4\u7684\u8d2d\u7968\u8bf7\u6c42\uff0c\u5f80\u5f80\u4f1a\u5728\u961f\u5217\u4e2d\u6392\u961f\u7b49\u5f85\u5904\u7406\uff0c\u53ef\u80fd\u51e0\u5206\u949f\u6216\u5341\u51e0\u5206\u949f\u540e\uff0c\u7cfb\u7edf\u624d\u5f00\u59cb\u5904\u7406\uff0c\u7136\u540e\u54cd\u5e94\u5904\u7406\u7ed3\u679c\uff0c\u8fd9\u5c31\u662f\u4f60\u719f\u6089\u7684\u5ef6\u8fdf\u54cd\u5e94\u3002 \u4f60\u770b\uff0c12306 \u8ba2\u7968\u7cfb\u7edf\u5728\u51fa\u73b0\u8d85\u51fa\u7cfb\u7edf\u5904\u7406\u80fd\u529b\u7684\u7a81\u53d1\u6d41\u91cf\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u901a\u8fc7\u727a\u7272\u54cd\u5e94\u65f6\u95f4\u7684\u53ef\u7528\u6027\uff0c\u4fdd\u969c\u6838\u5fc3\u529f\u80fd\u7684\u8fd0\u884c\u3002 3.\u4f53\u9a8c\u964d\u7ea7 \u00b6 \u4f60\u6b63\u8d1f\u8d23\u4e00\u4e2a\u4e92\u8054\u7f51\u7cfb\u7edf\uff0c\u7a81\u7136\u51fa\u73b0\u4e86\u7f51\u7edc\u70ed\u70b9\u4e8b\u4ef6\uff0c\u597d\u591a\u7528\u6237\u6d8c\u8fdb\u6765\uff0c\u4ea7\u751f\u4e86\u6d77\u91cf\u7684\u7a81\u53d1\u6d41\u91cf\uff0c\u7cfb\u7edf\u8fc7\u8f7d\u4e86\uff0c\u5927\u91cf\u56fe\u7247\u56e0\u4e3a\u7f51\u7edc\u8d85\u65f6\u65e0\u6cd5\u663e\u793a\u3002\u90a3\u4e48\u8fd9\u4e2a\u65f6\u5019\u4f60\u53ef\u4ee5\u901a\u8fc7\u54ea\u4e9b\u65b9\u6cd5\uff0c\u4fdd\u969c\u7cfb\u7edf\u7684\u57fa\u672c\u53ef\u7528\u5462\uff1f\u76f8\u4fe1\u4f60\u9a6c\u4e0a\u5c31\u80fd\u60f3\u5230\u4f53\u9a8c\u964d\u7ea7\uff0c \u6bd4\u5982\u7528\u5c0f\u56fe\u7247\u6765\u66ff\u4ee3\u539f\u59cb\u56fe\u7247\uff0c\u901a\u8fc7\u964d\u4f4e\u56fe\u7247\u7684\u6e05\u6670\u5ea6\u548c\u5927\u5c0f\uff0c\u63d0\u5347\u7cfb\u7edf\u7684\u5904\u7406\u80fd\u529b\u3002 4.\u8fc7\u8f7d\u4fdd\u62a4 \u00b6 \u6bd4\u5982\u628a\u63a5\u6536\u5230\u7684\u8bf7\u6c42\u653e\u5728\u6307\u5b9a\u7684\u961f\u5217\u4e2d\u6392\u961f\u5904\u7406\uff0c\u5982\u679c\u8bf7\u6c42\u7b49\u5f85\u65f6\u95f4\u8d85\u65f6\u4e86\uff08\u5047\u8bbe\u662f 100ms\uff09\uff0c\u8fd9\u4e2a\u65f6\u5019\u76f4\u63a5\u62d2\u7edd\u8d85\u65f6\u8bf7\u6c42\uff1b\u518d\u6bd4\u5982\u961f\u5217\u6ee1\u4e86\u4e4b\u540e\uff0c\u5c31\u6e05\u9664\u961f\u5217\u4e2d\u4e00\u5b9a\u6570\u91cf\u7684\u6392\u961f\u8bf7\u6c42\uff0c\u4fdd\u62a4\u7cfb\u7edf\u4e0d\u8fc7\u8f7d\uff0c\u5b9e\u73b0\u7cfb\u7edf\u7684\u57fa\u672c\u53ef\u7528\u3002 \u51e0\u4e4e\u6240\u6709\u7684\u4e92\u8054\u7f51\u7cfb\u7edf\u91c7\u7528\u7684\u90fd\u662f\u6700\u7ec8\u4e00\u81f4\u6027\uff0c\u53ea\u6709\u5728\u5b9e\u5728\u65e0\u6cd5\u4f7f\u7528\u6700\u7ec8\u4e00\u81f4\u6027\uff0c\u624d\u4f7f\u7528\u5f3a\u4e00\u81f4\u6027\u6216\u4e8b\u52a1\uff0c\u6bd4\u5982\uff0c\u5bf9\u4e8e\u51b3\u5b9a\u7cfb\u7edf\u8fd0\u884c\u7684\u654f\u611f\u5143\u6570\u636e\uff0c\u9700\u8981\u8003\u8651\u91c7\u7528\u5f3a\u4e00\u81f4\u6027\uff0c\u5bf9\u4e8e\u4e0e\u94b1\u6709\u5173\u7684\u652f\u4ed8\u7cfb\u7edf\u6216\u91d1\u878d\u7cfb\u7edf\u7684\u6570\u636e\uff0c\u9700\u8981\u8003\u8651\u91c7\u7528\u4e8b\u52a1\u3002\u4f60\u53ef\u4ee5\u5c06\u5f3a\u4e00\u81f4\u6027\u7406\u89e3\u4e3a\u6700\u7ec8\u4e00\u81f4\u6027\u7684\u7279\u4f8b\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4f60\u53ef\u4ee5\u628a\u5f3a\u4e00\u81f4\u6027\u770b\u4f5c\u662f\u4e0d\u5b58\u5728\u5ef6\u8fdf\u7684\u4e00\u81f4\u6027\u3002\u5728\u5b9e\u8df5\u4e2d\uff0c\u4f60\u4e5f\u53ef\u4ee5\u8fd9\u6837\u601d\u8003\uff1a \u5982\u679c\u4e1a\u52a1\u7684\u67d0\u529f\u80fd\u65e0\u6cd5\u5bb9\u5fcd\u4e00\u81f4\u6027\u7684\u5ef6\u8fdf\uff08\u6bd4\u5982\u5206\u5e03\u5f0f\u9501\u5bf9\u5e94\u7684\u6570\u636e\uff09\uff0c\u9700\u8981\u5b9e\u73b0\u7684\u662f\u5f3a\u4e00\u81f4\u6027\uff1b\u5982\u679c\u80fd\u5bb9\u5fcd\u77ed\u6682\u7684\u4e00\u81f4\u6027\u7684\u5ef6\u8fdf\uff08\u6bd4\u5982 QQ \u72b6\u6001\u6570\u636e\uff09\uff0c\u5c31\u53ef\u4ee5\u8003\u8651\u6700\u7ec8\u4e00\u81f4\u6027\u3002 07-XA\u534f\u8bae\u4e24\u9636\u6bb5\u63d0\u4ea4 05:24 \u00b6 \u6211\u4ee5\u7528\u6237 A \u8981\u5728\u7f51\u4e0a\u4e0b\u5355\u8d2d\u4e70 100 \u4ef6 T \u6064\u4e3a\u4f8b\uff0c\u91cd\u70b9\u4e0e\u4f60\u4ecb\u7ecd\u4e0b\u5355\u64cd\u4f5c\u548c\u51cf\u5e93\u5b58\u64cd\u4f5c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u3002 \u7b2c\u4e00\u9636\u6bb5\uff1a\u8ba2\u5355\u7cfb\u7edf\u4e2d\u5c06\u4e0e\u7528\u6237 A \u6709\u5173\u7684\u8ba2\u5355\u6570\u636e\u5e93\u9501\u4f4f\uff0c\u51c6\u5907\u597d\u589e\u52a0\u4e00\u6761\u5173\u4e8e\u7528\u6237 A \u8d2d\u4e70 100 \u4ef6 T \u6064\u7684\u4fe1\u606f\uff0c\u5e76\u5c06\u540c\u610f\u6d88\u606f\u201cYes\u201d\u56de\u590d\u7ed9\u534f\u8c03\u8005\u3002\u800c\u5e93\u5b58\u7cfb\u7edf\u7531\u4e8e T \u6064\u5e93\u5b58\u4e0d\u8db3\uff0c\u51fa\u8d27\u5931\u8d25\uff0c\u56e0\u6b64\u5411\u534f\u8c03\u8005\u56de\u590d\u4e86\u4e00\u4e2a\u7ec8\u6b62\u6d88\u606f\u201cNo\u201d\u3002 \u7b2c\u4e8c\u9636\u6bb5\uff1a\u7531\u4e8e\u5e93\u5b58\u7cfb\u7edf\u64cd\u4f5c\u4e0d\u6210\u529f\uff0c\u56e0\u6b64\uff0c\u534f\u8c03\u8005\u5c31\u4f1a\u5411\u8ba2\u5355\u7cfb\u7edf\u548c\u5e93\u5b58\u7cfb\u7edf\u53d1\u9001\u201cDoAbort\u201d\u6d88\u606f\u3002\u8ba2\u5355\u7cfb\u7edf\u63a5\u6536\u5230\u201cDoAbort\u201d\u6d88\u606f\u540e\uff0c\u5c06\u7cfb\u7edf\u5185\u7684\u6570\u636e\u9000\u56de\u5230\u6ca1\u6709\u7528\u6237 A \u8d2d\u4e70 100 \u4ef6 T \u6064\u7684\u7248\u672c\uff0c\u5e76\u91ca\u653e\u9501\u4f4f\u7684\u6570\u636e\u5e93\u8d44\u6e90\u3002\u8ba2\u5355\u7cfb\u7edf\u548c\u5e93\u5b58\u7cfb\u7edf\u5b8c\u6210\u64cd\u4f5c\u540e\uff0c\u5411\u534f\u8c03\u8005\u53d1\u9001\u201cHaveCommitted\u201d\u6d88\u606f\uff0c\u8868\u793a\u5b8c\u6210\u4e86\u4e8b\u52a1\u7684\u64a4\u9500\u64cd\u4f5c\u3002\u81f3\u6b64\uff0c\u7528\u6237 A \u8d2d\u4e70 100 \u4ef6 T \u6064\u8fd9\u4e00\u4e8b\u52a1\u5df2\u7ecf\u7ed3\u675f\uff0c\u7528\u6237 A \u8d2d\u4e70\u5931\u8d25\u3002 \u4e8c\u9636\u6bb5\u63d0\u4ea4\u7684\u7b97\u6cd5\u601d\u8def\u53ef\u4ee5\u6982\u62ec\u4e3a \uff1a \u534f\u8c03\u8005\u5411\u53c2\u4e0e\u8005\u4e0b\u53d1\u8bf7\u6c42\u4e8b\u52a1\u64cd\u4f5c\uff0c\u53c2\u4e0e\u8005\u63a5\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u8fdb\u884c\u76f8\u5173\u64cd\u4f5c\u5e76\u5c06\u64cd\u4f5c\u7ed3\u679c\u901a\u77e5\u534f\u8c03\u8005\uff0c\u534f\u8c03\u8005\u6839\u636e\u6240\u6709\u53c2\u4e0e\u8005\u7684\u53cd\u9988\u7ed3\u679c\u51b3\u5b9a\u5404\u53c2\u4e0e\u8005\u662f\u8981\u63d0\u4ea4\u64cd\u4f5c\u8fd8\u662f\u64a4\u9500\u64cd\u4f5c\u3002\u867d\u7136\u57fa\u4e8e XA \u7684\u4e8c\u9636\u6bb5\u63d0\u4ea4\u7b97\u6cd5\u5c3d\u91cf\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u5f3a\u4e00\u81f4\u6027\uff0c\u800c\u4e14\u5b9e\u73b0\u6210\u672c\u4f4e\uff0c\u4f46\u4f9d\u7136\u6709\u4e9b\u4e0d\u8db3\u3002\u4e3b\u8981\u6709\u4ee5\u4e0b\u4e09\u4e2a\u95ee\u9898\uff1a \u540c\u6b65\u963b\u585e\u95ee\u9898\uff1a\u4e8c\u9636\u6bb5\u63d0\u4ea4\u7b97\u6cd5\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u6240\u6709\u53c2\u4e0e\u8282\u70b9\u90fd\u662f\u4e8b\u52a1\u963b\u585e\u578b\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u672c\u5730\u8d44\u6e90\u7ba1\u7406\u5668\u5360\u6709\u4e34\u754c\u8d44\u6e90\u65f6\uff0c\u5176\u4ed6\u8d44\u6e90\u7ba1\u7406\u5668\u5982\u679c\u8981\u8bbf\u95ee\u540c\u4e00\u4e34\u754c\u8d44\u6e90\uff0c\u4f1a\u5904\u4e8e\u963b\u585e\u72b6\u6001\u3002\u56e0\u6b64\uff0c\u57fa\u4e8e XA \u7684\u4e8c\u9636\u6bb5\u63d0\u4ea4\u534f\u8bae\u4e0d\u652f\u6301\u9ad8\u5e76\u53d1\u573a\u666f\u3002 \u5355\u70b9\u6545\u969c\u95ee\u9898\uff1a\u8be5\u7b97\u6cd5\u7c7b\u4f3c\u4e8e\u96c6\u4e2d\u5f0f\u7b97\u6cd5\uff0c\u4e00\u65e6\u4e8b\u52a1\u7ba1\u7406\u5668\u53d1\u751f\u6545\u969c\uff0c\u6574\u4e2a\u7cfb\u7edf\u90fd\u5904\u4e8e\u505c\u6ede\u72b6\u6001\u3002\u5c24\u5176\u662f\u5728\u63d0\u4ea4\u9636\u6bb5\uff0c\u4e00\u65e6\u4e8b\u52a1\u7ba1\u7406\u5668\u53d1\u751f\u6545\u969c\uff0c\u8d44\u6e90\u7ba1\u7406\u5668\u4f1a\u7531\u4e8e\u7b49\u5f85\u7ba1\u7406\u5668\u7684\u6d88\u606f\uff0c\u800c\u4e00\u76f4\u9501\u5b9a\u4e8b\u52a1\u8d44\u6e90\uff0c\u5bfc\u81f4\u6574\u4e2a\u7cfb\u7edf\u88ab\u963b\u585e\u3002 \u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\uff1a\u5728\u63d0\u4ea4\u9636\u6bb5\uff0c\u5f53\u534f\u8c03\u8005\u5411\u6240\u6709\u53c2\u4e0e\u8005\u53d1\u9001\u201cDoCommit\u201d\u8bf7\u6c42\u65f6\uff0c\u5982\u679c\u53d1\u751f\u4e86\u5c40\u90e8\u7f51\u7edc\u5f02\u5e38\uff0c\u6216\u8005\u5728\u53d1\u9001\u63d0\u4ea4\u8bf7\u6c42\u7684\u8fc7\u7a0b\u4e2d\u534f\u8c03\u8005\u53d1\u751f\u4e86\u6545\u969c\uff0c\u5c31\u4f1a\u5bfc\u81f4\u53ea\u6709\u4e00\u90e8\u5206\u53c2\u4e0e\u8005\u63a5\u6536\u5230\u4e86\u63d0\u4ea4\u8bf7\u6c42\u5e76\u6267\u884c\u63d0\u4ea4\u64cd\u4f5c\uff0c\u4f46\u5176\u4ed6\u672a\u63a5\u5230\u63d0\u4ea4\u8bf7\u6c42\u7684\u90a3\u90e8\u5206\u53c2\u4e0e\u8005\u5219\u65e0\u6cd5\u6267\u884c\u4e8b\u52a1\u63d0\u4ea4\u3002\u4e8e\u662f\u6574\u4e2a\u5206\u5e03\u5f0f\u7cfb\u7edf\u4fbf\u51fa\u73b0\u4e86\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002 \u5e94\u7528\u4e0d\u5e7f\u6cdb\uff0c\u539f\u56e0\u662f\u6027\u80fd\u6bd4\u8f83\u5dee 08-TCC\u8865\u507f\u673a\u5236 04:14 \u00b6 TCC\u662f\u5e94\u7528\u5c42\u76842PC\uff0c\u66f4\u504f\u5411\u4e8e\u4e1a\u52a1\u4e0a\u5c42\u7684\u5904\u7406\uff0c\u975e\u5e95\u5c42\u7684XA\uff082PC\uff09\u7b49\u3002 Try \u9636\u6bb5\u4e3b\u8981\u662f\u5bf9\u4e1a\u52a1\u7cfb\u7edf\u505a\u68c0\u6d4b\u53ca\u8d44\u6e90\u9884\u7559 Confirm \u9636\u6bb5\u4e3b\u8981\u662f\u5bf9\u4e1a\u52a1\u7cfb\u7edf\u505a\u786e\u8ba4\u63d0\u4ea4\uff0cTry\u9636\u6bb5\u6267\u884c\u6210\u529f\u5e76\u5f00\u59cb\u6267\u884c Confirm\u9636\u6bb5\u65f6\uff0c\u9ed8\u8ba4 Confirm\u9636\u6bb5\u662f\u4e0d\u4f1a\u51fa\u9519\u7684\u3002\u5373\uff1a\u53ea\u8981Try\u6210\u529f\uff0cConfirm\u4e00\u5b9a\u6210\u529f\u3002 Cancel \u9636\u6bb5\u4e3b\u8981\u662f\u5728\u4e1a\u52a1\u6267\u884c\u9519\u8bef\uff0c\u9700\u8981\u56de\u6eda\u7684\u72b6\u6001\u4e0b\u6267\u884c\u7684\u4e1a\u52a1\u53d6\u6d88\uff0c\u9884\u7559\u8d44\u6e90\u91ca\u653e\u3002 \u53c2\u8003\u8d44\u6599\uff1a https://www.cnblogs.com/jajian/p/10014145.html 09-\u6d88\u606f\u6700\u7ec8\u4e00\u81f4\u6027 03:42 \u00b6 \u4e0a\u9762\u54b1\u4eec\u804a\u4e86\u804a TCC \u5206\u5e03\u5f0f\u4e8b\u52a1\uff0c\u5bf9\u4e8e\u5e38\u89c1\u7684\u5fae\u670d\u52a1\u7cfb\u7edf\uff0c\u5927\u90e8\u5206\u63a5\u53e3\u8c03\u7528\u662f\u540c\u6b65\u7684\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u670d\u52a1\u76f4\u63a5\u8c03\u7528\u53e6\u5916\u4e00\u4e2a\u670d\u52a1\u7684\u63a5\u53e3\u3002 \u8fd9\u4e2a\u65f6\u5019\uff0c\u7528 TCC \u5206\u5e03\u5f0f\u4e8b\u52a1\u65b9\u6848\u6765\u4fdd\u8bc1\u5404\u4e2a\u63a5\u53e3\u7684\u8c03\u7528\uff0c\u8981\u4e48\u4e00\u8d77\u6210\u529f\uff0c\u8981\u4e48\u4e00\u8d77\u56de\u6eda\uff0c\u662f\u6bd4\u8f83\u5408\u9002\u7684\u3002 \u4f46\u662f\u5728\u5b9e\u9645\u7cfb\u7edf\u7684\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u80fd\u670d\u52a1\u95f4\u7684\u8c03\u7528\u662f\u5f02\u6b65\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u4e2a\u670d\u52a1\u53d1\u9001\u4e00\u4e2a\u6d88\u606f\u7ed9 MQ\uff0c\u5373\u6d88\u606f\u4e2d\u95f4\u4ef6\uff0c\u6bd4\u5982 RocketMQ\u3001RabbitMQ\u3001Kafka\u3001ActiveMQ \u7b49\u7b49\u3002 \u7136\u540e\uff0c\u53e6\u5916\u4e00\u4e2a\u670d\u52a1\u4ece MQ \u6d88\u8d39\u5230\u4e00\u6761\u6d88\u606f\u540e\u8fdb\u884c\u5904\u7406\u3002\u8fd9\u5c31\u6210\u4e86\u57fa\u4e8e MQ \u7684\u5f02\u6b65\u8c03\u7528\u4e86\u3002 \u90a3\u4e48\u9488\u5bf9\u8fd9\u79cd\u57fa\u4e8e MQ \u7684\u5f02\u6b65\u8c03\u7528\uff0c\u5982\u4f55\u4fdd\u8bc1\u5404\u4e2a\u670d\u52a1\u95f4\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u5462\uff1f\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u5e0c\u671b\u7684\u662f\u57fa\u4e8e MQ \u5b9e\u73b0\u5f02\u6b65\u8c03\u7528\u7684\u591a\u4e2a\u670d\u52a1\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u8981\u4e48\u4e00\u8d77\u6210\u529f\uff0c\u8981\u4e48\u4e00\u8d77\u5931\u8d25\u3002 \u8fd9\u4e2a\u65f6\u5019\uff0c\u5c31\u8981\u7528\u4e0a\u53ef\u9760\u6d88\u606f\u6700\u7ec8\u4e00\u81f4\u6027\u65b9\u6848\uff0c\u6765\u5b9e\u73b0\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002 \u6d88\u606f\u6d88\u8d39\u5e42\u7b49\u6027 \u8ba2\u5355\u7cfb\u7edf\uff0c\u67e5\u8be2\u4e00\u4e0b\u6570\u636e\u5e93\u4e2d\u6709\u6ca1\u6709id \u8f6c\u8d26\uff1a\u67e5\u8be2\u4e00\u4e0b\u5168\u5c40\u6d41\u6c34ID \u5982\u679c\u6ca1\u6709ID\uff0c\u91c7\u7528\u4e50\u89c2\u9501 update xxx set data = data - 10,set version = version + 1 where version = 1 10-seata\u4ecb\u7ecd\u548cAT\u6a21\u5f0f\u4ecb\u7ecd 06:48 \u00b6 Seata \u662f\u4e00\u6b3e\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848\uff0c\u81f4\u529b\u4e8e\u63d0\u4f9b\u9ad8\u6027\u80fd\u548c\u7b80\u5355\u6613\u7528\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u670d\u52a1\u3002Seata \u5c06\u4e3a\u7528\u6237\u63d0\u4f9b\u4e86 AT\u3001TCC\u3001SAGA \u548c XA \u4e8b\u52a1\u6a21\u5f0f\uff0c\u4e3a\u7528\u6237\u6253\u9020\u4e00\u7ad9\u5f0f\u7684\u5206\u5e03\u5f0f\u89e3\u51b3\u65b9\u6848\u3002 \u9ed8\u8ba4 \u5373\u662fAT \u6a21\u5f0f ,AT\u672c\u8d28\u4e0a\u662f2pc\u534f\u8bae\u7684\u4e00\u79cd\u5b9e\u73b0 11-seata_server\u5b89\u88c5 04:56 \u00b6 \u5b89\u88c5\u6b65\u9aa4\uff1a 1.\u89e3\u538bseata-server-1.3.0.zip 2.\u5c06\u8d44\u6599\u4e2dfile\u76ee\u5f55\u4e0b\u7684\u4e24\u4e2a\u6587\u4ef6\uff0c\u62f7\u8d1d\u5230seata-server-1.3.0\\seata\\conf\u76ee\u5f55\u4e0b\uff0c\u8986\u76d6\u6389\u539f\u6765\u7684\u4e24\u4e2a\u6587\u4ef6 \u89c6\u9891\u4e2d\u63d0\u5230\u7684db\u6a21\u5f0f\u4fee\u6539\u4e3afile\u6a21\u5f0f\uff0c\u5df2\u7ecf\u4fee\u6539 3.\u53cc\u51fb\u542f\u52a8seata-server-1.3.0\\seata\\bin\\seata-server.bat 12-\u9879\u76ee\u4e2d\u96c6\u6210seata 12:47 \u00b6 1.\u5206\u522b\u5728leadnews_article\u3001leadnews_user\u3001leadnews_wemedia\u4e09\u4e2a\u5e93\u4e2d\u90fd\u521b\u5efaundo_log\u8868(\u5df2\u505a) 2.\u5b8c\u6210heima-leadnews-seata\u9879\u76ee\u7684\u642d\u5efa package com.heima.seata.config ; import com.alibaba.druid.pool.DruidDataSource ; import com.baomidou.mybatisplus.autoconfigure.MybatisPlusProperties ; import com.baomidou.mybatisplus.core.MybatisConfiguration ; import com.baomidou.mybatisplus.extension.spring.MybatisSqlSessionFactoryBean ; import io.seata.rm.datasource.DataSourceProxy ; import org.mybatis.spring.transaction.SpringManagedTransactionFactory ; import org.springframework.boot.context.properties.ConfigurationProperties ; import org.springframework.boot.context.properties.EnableConfigurationProperties ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; import org.springframework.context.annotation.Primary ; import org.springframework.core.io.support.PathMatchingResourcePatternResolver ; import javax.sql.DataSource ; @Configuration @EnableConfigurationProperties ({ MybatisPlusProperties . class }) public class DataSourcesProxyConfig { @Bean @ConfigurationProperties ( prefix = \"spring.datasource\" ) public DataSource druidDataSource () { return new DruidDataSource (); } //\u521b\u5efa\u4ee3\u7406\u6570\u636e\u6e90 @Primary //@Primary\u6807\u8bc6\u5fc5\u987b\u914d\u7f6e\u5728\u4ee3\u7801\u6570\u636e\u6e90\u4e0a\uff0c\u5426\u5219\u672c\u5730\u4e8b\u52a1\u5931\u6548 @Bean public DataSourceProxy dataSourceProxy ( DataSource druidDataSource ) { return new DataSourceProxy ( druidDataSource ); } private MybatisPlusProperties properties ; public DataSourcesProxyConfig ( MybatisPlusProperties properties ) { this . properties = properties ; } //\u66ff\u6362SqlSessionFactory\u7684DataSource @Bean public MybatisSqlSessionFactoryBean sqlSessionFactory ( DataSourceProxy dataSourceProxy ) throws Exception { // \u8fd9\u91cc\u5fc5\u987b\u7528 MybatisSqlSessionFactoryBean \u4ee3\u66ff\u4e86 SqlSessionFactoryBean\uff0c\u5426\u5219 MyBatisPlus \u4e0d\u4f1a\u751f\u6548 MybatisSqlSessionFactoryBean mybatisSqlSessionFactoryBean = new MybatisSqlSessionFactoryBean (); mybatisSqlSessionFactoryBean . setDataSource ( dataSourceProxy ); mybatisSqlSessionFactoryBean . setTransactionFactory ( new SpringManagedTransactionFactory ()); mybatisSqlSessionFactoryBean . setMapperLocations ( new PathMatchingResourcePatternResolver () . getResources ( \"classpath*:/mapper/*.xml\" )); MybatisConfiguration configuration = this . properties . getConfiguration (); if ( configuration == null ){ configuration = new MybatisConfiguration (); } mybatisSqlSessionFactoryBean . setConfiguration ( configuration ); return mybatisSqlSessionFactoryBean ; } } \u6dfb\u52a0\u5206\u9875\u63d2\u4ef6: @Bean public MybatisSqlSessionFactoryBean sqlSessionFactory ( DataSourceProxy dataSourceProxy , PaginationInterceptor paginationInterceptor ) throws Exception { // \u8fd9\u91cc\u5fc5\u987b\u7528 MybatisSqlSessionFactoryBean \u4ee3\u66ff\u4e86 SqlSessionFactoryBean\uff0c\u5426\u5219 MyBatisPlus \u4e0d\u4f1a\u751f\u6548 MybatisSqlSessionFactoryBean mybatisSqlSessionFactoryBean = new MybatisSqlSessionFactoryBean (); mybatisSqlSessionFactoryBean . setDataSource ( dataSourceProxy ); mybatisSqlSessionFactoryBean . setTransactionFactory ( new SpringManagedTransactionFactory ()); mybatisSqlSessionFactoryBean . setMapperLocations ( new PathMatchingResourcePatternResolver () . getResources ( \"classpath*:/mapper/*.xml\" )); MybatisConfiguration configuration = this . properties . getConfiguration (); if ( configuration == null ){ configuration = new MybatisConfiguration (); } mybatisSqlSessionFactoryBean . setConfiguration ( configuration ); //\u6dfb\u52a0\u5206\u9875\u63d2\u4ef6 Interceptor [] interceptors = { paginationInterceptor }; mybatisSqlSessionFactoryBean . setPlugins ( interceptors ); return mybatisSqlSessionFactoryBean ; } \u6ce8\u610f\uff1a \u00b6 \u5728Application\u4e0a\u6dfb\u52a0\uff1a @SpringBootApplication ( scanBasePackages = \"com.heima.wemedia\" , exclude = { DataSourceAutoConfiguration . class }) 3.\u5206\u522b\u5728heima-leadnews-article\u3001heima-leadnews-user\u3001heima-leadnews-wemedia\u5f15\u5165heima-leadnews-seata\u5de5\u7a0b\uff0c\u5e76\u4e14\u6dfb\u52a0\u4e00\u4e0b\u914d\u7f6e\u7c7b\uff1a @Configuration @ComponentScan ( \"com.heima.seata.config\" ) public class SeataConfig { } \u914d\u7f6eseata-server\u94fe\u63a5\u548c\u6ce8\u518c\u4e2d\u5fc3\u4fe1\u606f,\u8be6\u89c1\u8bb2\u4e49 \u5206\u522b\u5728heima-leadnews-article\u3001heima-leadnews-user\u3001heima-leadnews-wemedia\u5fae\u670d\u52a1\u7684application.yml\u6587\u4ef6\u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\uff1a yaml spring: cloud: alibaba: seata: tx-service-group: ${spring.application.name}_tx_group 6.\u5728ApUserRealnameServiceImpl\u7c7b\u7684updateStatusById\u65b9\u6cd5\u4e0a\u52a0\u4e0a @GlobalTransactional \u6ce8\u89e3 13-seata\u6d4b\u8bd5 02:29 \u00b6 \u521d\u59cb\u5316\u811a\u672cundo_log\u4e2d\u7f3a\u5c11\u5b57\u6bb5context\uff0c\u76ee\u524d\u5df2\u4fee\u590d\u3002 \u5b98\u65b9\u811a\u672c0.7.0+ \u589e\u52a0\u5b57\u6bb5 context 1.seata\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u4f1a\u51fa\u73b0\u5185\u5b58\u6cc4\u6f0f\uff08\u5173\u952e\u5b57Memory Leak\uff09\uff0c\u91cd\u542f\u5e94\u7528\u624d\u53ef\u4ee5\u89e3\u51b3 2.\u6d4b\u8bd5\u5b8cseata\u4e4b\u540e\u5c31\u628aseata\u529f\u80fd\u5173\u95ed\uff0c\u5e76\u8fd8\u539f\u6570\u636e\u6e90 \u53ef\u80fd\u4f1a\u51fa\u73b0\u7684bug: \u00b6 realname\u8868\u65e0\u6cd5\u56de\u6eda\uff0c\u539f\u56e0\u662ftinyint\u5bf9seata\u6765\u8bf4\u56de\u6eda\u65e5\u5fd7\u4fdd\u5b58\u6210\u4e86 true false \u5982\u679c\u4ece1->9 \u5bf9\u4e8eseata\u6765\u8bf4\u5176\u5b9e\u5c31\u662ftrue->true\uff0c\u8fd9\u6837\u662f\u65e0\u6cd5\u56de\u6eda\u7684 status tinyint(1) unsigned NULL \u72b6\u6001 0 \u521b\u5efa\u4e2d 1 \u5f85\u5ba1\u6838 2 \u5ba1\u6838\u5931\u8d25 9 \u5ba1\u6838\u901a\u8fc7 \u4fee\u590d\u65b9\u5f0f: tinyint(1) \u6539\u6210 tinyint(3) \u6269\u5c55\uff1a\u4f18\u5316seata\u4e0efeign\u8fdc\u7a0b\u8c03\u7528\u7684\u4ee3\u7801 \u00b6 \u76ee\u524d\u8c03\u7528feign\u65f6\uff0c\u5982\u679c\u9047\u5230feign\u8c03\u7528\u5931\u8d25\uff0c\u662f\u4e0d\u4f1a\u8fdb\u884c\u56de\u6eda\u7684\uff0c\u4fee\u590d\u5982\u4e0b\uff1a ApUserRealnameServiceImpl\u7684createWmUserAndAuthor\u65b9\u6cd5\u4e2d\uff0c\u63a5\u6536save\u7684\u8fd4\u56de\u503c ResponseResult save = wemediaFeign . save ( wmUser ); if ( save . getCode () != 0 ){ throw new RuntimeException ( \"\u8c03\u7528\u8fdc\u7a0b\u63a5\u53e3\u5931\u8d25\" ); } \u5982\u679c\u8fd4\u56de\u4e0d\u6b63\u786e\uff0c\u629b\u51fa\u5f02\u5e38\u3002\u5176\u4ed6\u8fdc\u7a0b\u8c03\u7528\u63a5\u53e3\u7c7b\u4f3c\u5904\u7406\u3002 \u5173\u95edseata\u7684\u65b9\u5f0f\uff1a \u00b6 1.\u53bb\u9664seata\u4f9d\u8d56 2.\u5728\u4ee3\u7801\u4e2d\u5c06GlobalTrasaction\u76f8\u5173\u4ee3\u7801\u6ce8\u91ca\u6389 3.\u6ce8\u91caSeataConfig 4.\u4fee\u6539\u542f\u52a8\u7c7b\uff0c\u628a@SpringBootApplication\u6ce8\u89e3\u8fd8\u539f \u5bf9\u5982\u4e0b\u51e0\u4e2a\u5fae\u670d\u52a1: user,wemedia,article 14-fastdfs\u4ecb\u7ecd 07:22 \u00b6 FastDFS\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u8f7b\u91cf\u7ea7 \u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf \uff0c\u5b83\u5bf9\u6587\u4ef6\u8fdb\u884c\u7ba1\u7406\uff0c\u529f\u80fd\u5305\u62ec\uff1a\u6587\u4ef6\u5b58\u50a8\u3001\u6587\u4ef6\u540c\u6b65\u3001\u6587\u4ef6\u8bbf\u95ee\uff08\u6587\u4ef6\u4e0a\u4f20\u3001\u6587\u4ef6\u4e0b\u8f7d\uff09\u7b49\uff0c\u89e3\u51b3\u4e86\u5927\u5bb9\u91cf\u5b58\u50a8\u548c\u8d1f\u8f7d\u5747\u8861\u7684\u95ee\u9898\u3002\u7279\u522b\u9002\u5408\u4ee5\u6587\u4ef6\u4e3a\u8f7d\u4f53\u7684\u5728\u7ebf\u670d\u52a1\uff0c\u5982\u76f8\u518c\u7f51\u7ad9\u3001\u89c6\u9891\u7f51\u7ad9\u7b49\u7b49\u3002 \u5ba2\u6237\u7aef\u4e0a\u4f20\u6587\u4ef6\u540e\u5b58\u50a8\u670d\u52a1\u5668\u5c06\u6587\u4ef6 ID \u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u6b64\u6587\u4ef6 ID \u7528\u4e8e\u4ee5\u540e\u8bbf\u95ee\u8be5\u6587\u4ef6\u7684\u7d22\u5f15\u4fe1\u606f\u3002\u6587\u4ef6\u7d22\u5f15\u4fe1\u606f\u5305\u62ec\uff1a\u7ec4\u540d\uff0c\u865a\u62df\u78c1\u76d8\u8def\u5f84\uff0c\u6570\u636e\u4e24\u7ea7\u76ee\u5f55\uff0c\u6587\u4ef6\u540d\u3002 \u7ec4\u540d \uff1a\u6587\u4ef6\u4e0a\u4f20\u540e\u6240\u5728\u7684 storage \u7ec4\u540d\u79f0\uff0c\u5728\u6587\u4ef6\u4e0a\u4f20\u6210\u529f\u540e\u6709storage \u670d\u52a1\u5668\u8fd4\u56de\uff0c\u9700\u8981\u5ba2\u6237\u7aef\u81ea\u884c\u4fdd\u5b58\u3002 \u865a\u62df\u78c1\u76d8\u8def\u5f84 \uff1astorage \u914d\u7f6e\u7684\u865a\u62df\u8def\u5f84\uff0c\u4e0e\u78c1\u76d8\u9009\u9879store_path*\u5bf9\u5e94\u3002\u5982\u679c\u914d\u7f6e\u4e86 store_path0 \u5219\u662f M00\uff0c\u5982\u679c\u914d\u7f6e\u4e86 store_path1 \u5219\u662f M01\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002 \u6570\u636e\u4e24\u7ea7\u76ee\u5f55 \uff1astorage \u670d\u52a1\u5668\u5728\u6bcf\u4e2a\u865a\u62df\u78c1\u76d8\u8def\u5f84\u4e0b\u521b\u5efa\u7684\u4e24\u7ea7\u76ee\u5f55\uff0c\u7528\u4e8e\u5b58\u50a8\u6570\u636e\u6587\u4ef6\u3002 \u6587\u4ef6\u540d \uff1a\u4e0e\u6587\u4ef6\u4e0a\u4f20\u65f6\u4e0d\u540c\u3002\u662f\u7531\u5b58\u50a8\u670d\u52a1\u5668\u6839\u636e\u7279\u5b9a\u4fe1\u606f\u751f\u6210\uff0c\u6587\u4ef6\u540d\u5305\u542b\uff1a\u6e90\u5b58\u50a8 \u670d\u52a1\u5668 IP \u5730\u5740\u3001\u6587\u4ef6\u521b\u5efa\u65f6\u95f4\u6233\u3001\u6587\u4ef6\u5927\u5c0f\u3001\u968f\u673a\u6570\u548c\u6587\u4ef6\u62d3\u5c55\u540d\u7b49\u4fe1\u606f\u3002 15-fastdfs\u5b89\u88c5 07:13 \u00b6 \u8bb0\u5f97\u5c06IP\u5730\u5740\u6539\u6210\u81ea\u5df1\u865a\u62df\u673a\u7684IP\uff1a #\u62c9\u53d6\u955c\u50cf(\u865a\u62df\u673a\u4e2d\u5df2\u5b8c\u6210) docker pull delron/fastdfs #\u521b\u5efatracker\u5bb9\u5668 -t(\u4ea4\u4e92\u5f0f\u65b9\u5f0f\u542f\u52a8) -d\uff08\u5b88\u62a4\u5f0f\u542f\u52a8\uff09 docker run -d --network = host --name tracker -v /var/fdfs/tracker:/var/fdfs delron/fastdfs tracker #\u521b\u5efastorage\u5bb9\u5668 -e \u73af\u5883\u53d8\u91cf docker run -d --network = host --name storage -e TRACKER_SERVER = 192 .168.226.134:22122 -v /var/fdfs/storage:/var/fdfs -e GROUP_NAME = group1 delron/fastdfs storage \u5982\u679c\u4e0b\u6b21\u865a\u62df\u673a\u91cd\u542f\u4e4b\u540e\uff0c\u6267\u884c docker start tracker storage \u4ee5\u4e0b\u6b65\u9aa4\u53ef\u4ee5\u4e0d\u505a: #\u8fdb\u5165storage\u5bb9\u5668\uff0c\u5230storage\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6ehttp\u8bbf\u95ee\u7684\u7aef\u53e3\uff0c\u914d\u7f6e\u6587\u4ef6\u5728/etc/fdfs\u76ee\u5f55\u4e0b\u7684storage.conf\u3002 docker exec -it storage /bin/bash vi /usr/local/nginx/conf/nginx.conf #\u9ed8\u8ba4\u7684http\u7aef\u53e3\u4e3a8888\uff0c\u53ef\u4ee5\u4fee\u6539\u4e5f\u53ef\u4ee5\u914d\u7f6e # the port of the web server on this storage server http.server_port = 8888 #\u914d\u7f6enginx\uff0c\u5728/usr/local/nginx\u76ee\u5f55\u4e0b\uff0c\u4fee\u6539nginx.conf\u6587\u4ef6 #\u9ed8\u8ba4\u914d\u7f6e\u5982\u4e0b\uff1a server { listen 8888 ; server_name localhost ; location ~/group [ 0 -9 ] / { ngx_fastdfs_module ; } error_page 500 502 503 504 /50x.html ; location = /50x.html { root html ; } } #\u9ed8\u8ba4\u7684\u5b58\u50a8\u8def\u5f84\u4e3a/var/fdfs/data 16-fastdfs\u73af\u5883\u642d\u5efa 08:16 \u00b6 #socket\u8fde\u63a5\u8d85\u65f6\u65f6\u957f fdfs.soTimeout=1500 #\u8fde\u63a5tracker\u670d\u52a1\u5668\u8d85\u65f6\u65f6\u957f fdfs.connectTimeout=600 fdfs.trackerList=192.168.226.134:22122 fileServerUrl=http://192.168.226.134:8888/ \u6ce8\u610f\u4e00\u4e0b\u8bbf\u95ee\u7aef\u53e3\u662f8888 tracker\u7684\u7aef\u53e3\u662f22122 17-\u4e0a\u4f20\u548c\u5220\u9664 10:24 \u00b6 \u4f7f\u7528\u8001\u5e08\u63d0\u4f9b\u7684postman\u63a5\u53e3\u6587\u4ef6\u8fdb\u884c\u6d4b\u8bd5 fastdfs\u5e95\u5c42\u4f7f\u7528nginx\u4f5c\u4e3a\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u5b58\u5728\u6d4f\u89c8\u5668\u7f13\u5b58\uff0c\u6d4b\u8bd5\u5220\u9664\u65f6\uff0c\u53ef\u4ee5\u5220\u9664\u4e00\u6b21\u4e4b\u540e\u518d\u6b21\u5220\u9664 CTRL+F5 \u5f3a\u5236\u5237\u65b0\u53ef\u4ee5\u6d4b\u8bd5 \u4e5f\u53ef\u4ee5\u89e3\u51b3\u7684 \u5728\u4f7f\u7528fastDFS\u505a\u6587\u4ef6\u7cfb\u7edf\u65f6\uff0c\u56fe\u7247\u6d4f\u89c8\u5668\u7f13\u5b58\u5f71\u54cd\u5220\u9664\u7ed3\u679c\u663e\u793a\u3002 \u89e3\u51b3\u529e\u6cd5\u5982\u4e0b: \u5728fastDFS\u7684\u5bb9\u5668\u4e2d\u7684nginx\u914d\u7f6e\u7981\u6b62\u6d4f\u89c8\u5668\u7f13\u5b58: 18-\u9879\u76ee\u4e2d\u96c6\u6210fastdfs 03:48 \u00b6 \uff081\uff09heima-leadnews-common\u6a21\u5757\u4e2d\u52a0\u5165\u4f9d\u8d56 <!--fastdfs--> <dependency> <groupId> com.github.tobato </groupId> <artifactId> fastdfs-client </artifactId> </dependency> \uff082\uff09heima-leadnews-common\u4e2d\u7684resources\u65b0\u5efa\u6587\u4ef6fast_dfs.properties #socket\u8fde\u63a5\u8d85\u65f6\u65f6\u957f fdfs.soTimeout = 1500 #\u8fde\u63a5tracker\u670d\u52a1\u5668\u8d85\u65f6\u65f6\u957f fdfs.connectTimeout = 600 fdfs.trackerList = 192.168.226.134:22122 \u4fee\u6539\u4e3a\u865a\u62df\u673a\u7684IP\u5730\u5740 \uff083\uff09heima-leadnews-common\u4e2d\u65b0\u5efa\u914d\u7f6e\u7c7b:com.heima.common.fastdfs.FdfsConfiguration @Configuration @Import ( FdfsClientConfig . class ) // \u5bfc\u5165FastDFS-Client\u7ec4\u4ef6 @PropertySource ( \"fast_dfs.properties\" ) public class FdfsConfiguration { } \u8fd9\u4e2a\u914d\u7f6e\u7c7b\u7684\u4f5c\u7528\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u5bfc\u5165\u5ba2\u6237\u7aef\u7a0b\u5e8f \uff084\uff09\u65b0\u5efafastdfs\u5ba2\u6237\u7aef\uff1acom.heima.common.fastdfs.FastDFSClient @Component public class FastDFSClient { @Autowired private FastFileStorageClient storageClient ; public String uploadFile ( MultipartFile file ) throws IOException { StorePath storePath = storageClient . uploadFile (( InputStream ) file . getInputStream (), file . getSize (), FilenameUtils . getExtension ( file . getOriginalFilename ()), null ); return storePath . getFullPath (); } public void delFile ( String filePath ) { storageClient . deleteFile ( filePath ); } /** * \u4e0b\u8f7d * @param groupName * @param path * @return */ public byte [] download ( String groupName , String path ) throws IOException { InputStream ins = storageClient . downloadFile ( groupName , path , new DownloadCallback < InputStream > () { @Override public InputStream recv ( InputStream ins ) throws IOException { // \u5c06\u6b64ins\u8fd4\u56de\u7ed9\u4e0a\u9762\u7684ins return ins ; } }); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream (); byte [] buff = new byte [ 100 ] ; int rc = 0 ; while (( rc = ins . read ( buff , 0 , 100 )) > 0 ) { byteArrayOutputStream . write ( buff , 0 , rc ); } return byteArrayOutputStream . toByteArray (); } } \uff085\uff09\u5728heima-leadnews-wemedia\u5fae\u670d\u52a1\u4e2d\u6dfb\u52a0\u914d\u7f6e \u2460\u6dfb\u52a0\u914d\u7f6e\u7c7b\uff0c\u5f15\u7528fastdfs package com.heima.wemedia.config ; import org.springframework.context.annotation.ComponentScan ; import org.springframework.context.annotation.Configuration ; @Configuration @ComponentScan ( \"com.heima.common.fastdfs\" ) public class FastDfsConfiguration { } \u4f7f\u7528\u914d\u7f6e\u7c7b\u626b\u63cf\u5230common\u5305\u4e2d\u7684fastdfs\u5bf9\u5e94\u7684\u914d\u7f6e\u7c7b\uff0c\u52a0\u8f7d\u5ba2\u6237\u7aef\u7a0b\u5e8f 19-\u7d20\u6750\u7ba1\u7406\u9700\u6c42\u5206\u6790 02:17 \u00b6 \u4e0a\u4f20\u56fe\u7247\u5230fastdfs\uff0c\u540c\u65f6\u8981\u4fdd\u5b58\u4e00\u4efd\u6570\u636e\u5230\u8868\u4e2d\uff0c\u65b9\u4fbf\u540e\u671f\u7ba1\u7406 \u5a92\u4f53\u56fe\u6587\u7d20\u6750\u4fe1\u606f\u8868wm_material 20-\u81ea\u5a92\u4f53\u767b\u5f55\u548c\u7f51\u5173\u5f00\u53d1 15:16 \u00b6 admin\u548c\u81ea\u5a92\u4f53\u662f\u4e24\u4e2a\u4e0d\u540c\u7684\u7cfb\u7edf\uff0c\u6240\u4ee5\u5206\u522b\u90fd\u9700\u8981\u6709\u4e00\u4e2a\u767b\u5f55\u529f\u80fd\u3002 \u4eceadmin\u62f7\u8d1d\u8fdb\u884c\u4fee\u6539\u5373\u53ef\u3002 21-\u83b7\u53d6\u767b\u5f55\u7528\u6237 11:00 \u00b6 package com.heima.utils.threadlocal ; import com.heima.model.wemedia.pojos.WmUser ; public class WmThreadLocalUtils { private final static ThreadLocal < WmUser > USER_THREAD_LOCAL = new ThreadLocal <> (); /** * \u8bbe\u7f6e\u5f53\u524d\u7ebf\u7a0b\u4e2d\u7684\u7528\u6237 * @param wmUser */ public static void setUser ( WmUser wmUser ){ USER_THREAD_LOCAL . set ( wmUser ); } /** * \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u4e2d\u7684\u7528\u6237 * @return */ public static WmUser getUser (){ return USER_THREAD_LOCAL . get (); } } package com.heima.wemedia.filter ; import com.heima.model.wemedia.pojos.WmUser ; import com.heima.utils.threadlocal.WmThreadLocalUtils ; import lombok.extern.log4j.Log4j2 ; import org.springframework.core.annotation.Order ; import org.springframework.web.filter.GenericFilterBean ; import javax.servlet.FilterChain ; import javax.servlet.ServletException ; import javax.servlet.ServletRequest ; import javax.servlet.ServletResponse ; import javax.servlet.annotation.WebFilter ; import javax.servlet.http.HttpServletRequest ; import javax.servlet.http.HttpServletResponse ; import java.io.IOException ; @Order ( 1 ) @WebFilter ( filterName = \"wmTokenFilter\" , urlPatterns = \"/*\" ) @Log4j2 public class WmTokenFilter extends GenericFilterBean { @Override public void doFilter ( ServletRequest servletRequest , ServletResponse servletResponse , FilterChain filterChain ) throws IOException , ServletException { HttpServletRequest request = ( HttpServletRequest ) servletRequest ; //HttpServletResponse response = (HttpServletResponse) servletResponse; //\u5f97\u5230header\u4e2d\u7684\u4fe1\u606f String userId = request . getHeader ( \"userId\" ); if ( userId != null ){ WmUser wmUser = new WmUser (); wmUser . setId ( Integer . valueOf ( userId )); WmThreadLocalUtils . setUser ( wmUser ); } filterChain . doFilter ( request , response ); } } \u5728SpringBootApplication\u4e0a\u4f7f\u7528@ServletComponentScan\u6ce8\u89e3\u540e\uff0cServlet\u3001Filter\u3001Listener\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7@WebServlet\u3001@WebFilter\u3001@WebListener\u6ce8\u89e3\u81ea\u52a8\u6ce8\u518c\uff0c\u65e0\u9700\u5176\u4ed6\u4ee3\u7801\u3002 \u4f18\u5316:\u767b\u5f55\u8bf7\u6c42\u4e5f\u901a\u8fc7\u4e86\u8fc7\u6ee4\u5668\u7684\u903b\u8f91 package com.heima.wemedia.filter ; import com.heima.model.wemedia.pojos.WmUser ; import com.heima.utils.threadlocal.WmThreadLocalUtils ; import lombok.extern.log4j.Log4j2 ; import org.springframework.core.annotation.Order ; import org.springframework.web.filter.GenericFilterBean ; import javax.servlet.FilterChain ; import javax.servlet.ServletException ; import javax.servlet.ServletRequest ; import javax.servlet.ServletResponse ; import javax.servlet.annotation.WebFilter ; import javax.servlet.http.HttpServletRequest ; import javax.servlet.http.HttpServletResponse ; import java.io.IOException ; @Order ( 1 ) @WebFilter ( filterName = \"wmTokenFilter\" , urlPatterns = \"/*\" ) @Log4j2 public class WmTokenFilter extends GenericFilterBean { @Override public void doFilter ( ServletRequest servletRequest , ServletResponse servletResponse , FilterChain filterChain ) throws IOException , ServletException { HttpServletRequest request = ( HttpServletRequest ) servletRequest ; HttpServletResponse response = ( HttpServletResponse ) servletResponse ; if ( request . getRequestURI (). equals ( \"/login/in\" )){ //\u5982\u679c\u662f\u767b\u5f55\u63a5\u53e3\uff0c\u76f4\u63a5\u653e\u884c filterChain . doFilter ( request , response ); return ; } //\u5f97\u5230header\u4e2d\u7684\u4fe1\u606f String userId = request . getHeader ( \"userId\" ); if ( userId != null ){ WmUser wmUser = new WmUser (); wmUser . setId ( Integer . valueOf ( userId )); WmThreadLocalUtils . setUser ( wmUser ); } filterChain . doFilter ( request , response ); } } 22-\u56fe\u7247\u4e0a\u4f20 13:57 \u00b6 @Override public ResponseResult uploadPicture ( MultipartFile multipartFile ) { //1.\u68c0\u67e5\u53c2\u6570 if ( multipartFile == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u4e0a\u4f20\u56fe\u7247\u5230fasfdfs String fileId = null ; try { fileId = fastDFSClient . uploadFile ( multipartFile ); } catch ( IOException e ) { e . printStackTrace (); return ResponseResult . errorResult ( AppHttpCodeEnum . SERVER_ERROR ); } //3.\u4fdd\u5b58\u7d20\u6750\u6570\u636e\u5230\u8868\u4e2d wm_material //\u4ece\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u603b\u83b7\u53d6\u7528\u6237\u4fe1\u606f WmUser user = WmThreadLocalUtils . getUser (); WmMaterial wmMaterial = new WmMaterial (); wmMaterial . setUrl ( fileId ); //\u9ed8\u8ba4\u4e0d\u6536\u85cf wmMaterial . setIsCollection (( short ) 0 ); wmMaterial . setUserId ( user . getId ()); wmMaterial . setType (( short ) 0 ); wmMaterial . setCreatedTime ( new Date ()); save ( wmMaterial ); //\u62fc\u63a5\u56fe\u7247\u8def\u5f84\uff0cfileServerUrl\u4ece\u914d\u7f6e\u6587\u4ef6\u4e2d\u83b7\u53d6 wmMaterial . setUrl ( fileServerUrl + fileId ); return ResponseResult . okResult ( wmMaterial ); } 23-\u56fe\u7247\u4e0a\u4f20 \u6d4b\u8bd5 -05:03 \u00b6 \u4f7f\u7528\u63d0\u4f9b\u7684postman\u8fdb\u884c\u6d4b\u8bd5 24-\u56fe\u7247\u5217\u8868\u67e5\u8be2 14:40 \u00b6 @Override public ResponseResult findList ( WmMaterialDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 dto . checkParam (); //2.\u5e26\u6761\u4ef6\u5206\u9875\u67e5\u8be2 LambdaQueryWrapper < WmMaterial > lambdaQueryWrapper = new LambdaQueryWrapper <> (); //\u83b7\u53d6\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237 Integer uid = WmThreadLocalUtils . getUser (). getId (); lambdaQueryWrapper . eq ( WmMaterial :: getUserId , uid ); //\u662f\u5426\u6536\u85cf if ( dto . getIsCollection () != null && dto . getIsCollection (). shortValue () == 1 ){ lambdaQueryWrapper . eq ( WmMaterial :: getIsCollection , dto . getIsCollection ()); } //\u6309\u7167\u65e5\u671f\u5012\u5e8f\u6392\u5e8f lambdaQueryWrapper . orderByDesc ( WmMaterial :: getCreatedTime ); IPage pageParam = new Page ( dto . getPage (), dto . getSize ()); IPage resultPage = page ( pageParam , lambdaQueryWrapper ); //3.\u7ed3\u679c\u8fd4\u56de PageResponseResult responseResult = new PageResponseResult ( dto . getPage (), dto . getSize (),( int ) resultPage . getTotal ()); List < WmMaterial > datas = resultPage . getRecords (); //\u4e3a\u6bcf\u4e2a\u56fe\u7247\u52a0\u4e0a\u524d\u7f00 datas = datas . stream (). map ( item -> { item . setUrl ( fileServerUrl + item . getUrl ()); return item ; }). collect ( Collectors . toList ()); //for each responseResult . setData ( datas ); return responseResult ; } 25-\u56fe\u7247\u5220\u9664 14:40 \u00b6 \u5982\u679c\u56fe\u7247\u88abwm_news_material\u8868\u5f15\u7528\uff0c\u5219\u4e0d\u80fd\u88ab\u5220\u9664 @Override public ResponseResult delPicture ( Integer id ) { //1.\u68c0\u67e5\u53c2\u6570 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u5224\u65ad\u5f53\u524d\u56fe\u7247\u662f\u5426\u95ee\u5f15\u7528 WmMaterial wmMaterial = getById ( id ); if ( wmMaterial == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } LambdaQueryWrapper < WmNewsMaterial > lambdaQueryWrapper = new LambdaQueryWrapper (); lambdaQueryWrapper . eq ( WmNewsMaterial :: getMaterialId , id ); Integer count = wmNewsMaterialMapper . selectCount ( lambdaQueryWrapper ); if ( count > 0 ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID , \"\u5f53\u524d\u56fe\u7247\u88ab\u5f15\u7528\" ); } //3.\u5220\u9664fastdfs\u4e2d\u7684\u56fe\u7247 String fileId = wmMaterial . getUrl (). replace ( fileServerUrl , \"\" ); try { fastDFSClient . delFile ( fileId ); } catch ( Exception e ){ e . printStackTrace (); return ResponseResult . errorResult ( AppHttpCodeEnum . SERVER_ERROR ); } //4.\u5220\u9664\u6570\u636e\u5e93\u4e2d\u7684\u56fe\u7247 removeById ( id ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } \u62d3\u5c55\uff1a\u5f53\u524d\u767b\u5f55\u7528\u6237\uff0c\u53ea\u80fd\u5220\u9664\u81ea\u5df1\u4e0a\u4f20\u7684\u56fe\u7247 \u00b6 //1.6\u5224\u65ad\u7d20\u6750\u4e0a\u4f20\u7528\u6237\u662f\u5426\u662f\u672c\u7528\u6237.\u5982\u679c\u4e0d\u662f\u672c\u7528\u6237\uff0c\u5c31\u4e0d\u5141\u8bb8\u5220\u9664 if ( wmMaterial . getUserId () != WmThreadLocalUtils . getUser (). getId ()){ return ResponseResult . errorResult ( AppHttpCodeEnum . NO_OPERATOR_AUTH ); } 26-\u6536\u85cf\u548c\u53d6\u6d88\u6536\u85cf 11:54 \u00b6 @Override public ResponseResult updateStatus ( Integer id , Short type ) { //1.\u68c0\u67e5\u53c2\u6570 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u66f4\u65b0\u72b6\u6001 //\u83b7\u53d6\u5f53\u524d\u7528\u6237\u4fe1\u606f Integer uid = WmThreadLocalUtils . getUser (). getId (); update ( Wrappers . < WmMaterial > lambdaUpdate (). set ( WmMaterial :: getIsCollection , type ) . eq ( WmMaterial :: getId , id ). eq ( WmMaterial :: getUserId , uid )); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); }","title":"day04"},{"location":"hmtt/day04/#01-_0106","text":"\u80fd\u591f\u7406\u89e3\u4ec0\u4e48\u662f\u5206\u5e03\u5f0f\u4e8b\u52a1 \u80fd\u591f\u7406\u89e3CAP\u5b9a\u7406\u548cBASE\u7406\u8bba \u80fd\u591f\u638c\u63e1seata\u8981\u89e3\u51b3\u7684\u95ee\u9898 \u80fd\u591f\u5b8c\u6210seata\u96c6\u6210\u5230\u9879\u76ee\u4e2d\u4f7f\u7528 \u80fd\u591f\u638c\u63e1\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edffastdfs\u7684\u57fa\u672c\u4f7f\u7528 \u80fd\u591f\u5b8c\u6210\u7d20\u6750\u7ba1\u7406\u529f\u80fd \u80fd\u591f\u5b8c\u6210\u81ea\u5a92\u4f53\u6587\u7ae0\u5217\u8868\u67e5\u8be2\u529f\u80fd","title":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 01:06"},{"location":"hmtt/day04/#02-_0336","text":"\u6211\u4eec\u6628\u5929\u7f16\u5199\u7684\u7528\u6237\u8ba4\u8bc1\u5ba1\u6838\u7684\u4ee3\u7801\u670d\u52a1\u4e2d\u5b58\u5728\u7684\uff0c\u5982\u679c\u5ba1\u6838\u5b8c\u7528\u6237\u540e\u51fa\u4e86\u5f02\u5e38\u662f\u4e0d\u4f1a\u56de\u6eda\u7684 \u7528\u6237\u5ba1\u6838\u6d89\u53caUser\u3001Article\u3001Wemedia\u5fae\u670d\u52a1\uff0c\u8fd9\u4e09\u4e2a\u5fae\u670d\u52a1\u5404\u81ea\u6709\u81ea\u5df1\u7684\u4e8b\u52a1\u7ba1\u7406 \u4efb\u610f\u4e00\u4e2a\u5fae\u670d\u52a1\u51fa\u9519\uff0c\u53ea\u80fd\u5728\u81ea\u5df1\u7684\u5fae\u670d\u52a1\u4e2d\u8fdb\u884c\u4e8b\u52a1\u56de\u6eda \u8fd9\u6837\u5c31\u4f1a\u9020\u6210\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\uff0c\u8fd9\u5176\u5b9e\u5c31\u662f\u6211\u4eec\u6240\u8bf4\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u95ee\u9898","title":"02-\u7528\u6237\u5b9e\u540d\u8ba4\u8bc1\u5ba1\u6838\u4e8b\u52a1\u95ee\u9898 03:36"},{"location":"hmtt/day04/#03-_0445","text":"\u4e8b\u52a1\u62e5\u6709\u4ee5\u4e0b\u56db\u4e2a\u7279\u6027\uff0c\u4e60\u60ef\u4e0a\u88ab\u79f0\u4e3aACID\u7279\u6027\uff1a \u539f\u5b50\u6027(Atomicity) \uff1a\u5373\u4e8b\u52a1\u6700\u7ec8\u7684\u72b6\u6001\u53ea\u6709\u4e24\u79cd\uff0c\u5168\u90e8\u6267\u884c\u6210\u529f\u548c\u5168\u90e8\u4e0d\u6267\u884c\u3002\u82e5\u5904\u7406\u4e8b\u52a1\u7684\u4efb\u4f55\u4e00\u9879\u64cd\u4f5c\u4e0d\u6210\u529f\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6574\u4e2a\u4e8b\u52a1\u5931\u8d25\u3002\u4e00\u65e6\u64cd\u4f5c\u5931\u8d25\uff0c\u6240\u6709\u64cd\u4f5c\u90fd\u4f1a\u88ab\u53d6\u6d88\uff08\u5373\u56de\u6eda\uff09\uff0c\u4f7f\u5f97\u4e8b\u52a1\u4eff\u4f5b\u6ca1\u6709\u88ab\u6267\u884c\u8fc7\u4e00\u6837\u3002 \u4e00\u81f4\u6027(Consistency) \uff1a\uff0c\u662f\u6307\u4e8b\u52a1\u64cd\u4f5c\u524d\u548c\u64cd\u4f5c\u540e\uff0c\u6570\u636e\u7684\u5b8c\u6574\u6027\u4fdd\u6301\u4e00\u81f4\u6216\u6ee1\u8db3\u5b8c\u6574\u6027\u7ea6\u675f\u3002\u6bd4\u5982\uff0c\u7528\u6237 A \u548c\u7528\u6237 B \u5728\u94f6\u884c\u5206\u522b\u6709 800 \u5143\u548c 600 \u5143\uff0c\u603b\u5171 1400 \u5143\uff0c\u7528\u6237 A \u7ed9\u7528\u6237 B \u8f6c\u8d26 200 \u5143\uff0c\u5206\u4e3a\u4e24\u4e2a\u6b65\u9aa4\uff0c\u4ece A \u7684\u8d26\u6237\u6263\u9664 200 \u5143\u548c\u5bf9 B \u7684\u8d26\u6237\u589e\u52a0 200 \u5143 ; \u4e00\u81f4\u6027\u5c31\u662f\u8981\u6c42\u4e0a\u8ff0\u6b65\u9aa4\u64cd\u4f5c\u540e\uff0c\u6700\u540e\u7684\u7ed3\u679c\u662f\u7528\u6237 A \u8fd8\u6709 600 \u5143\uff0c\u7528\u6237 B \u6709 800 \u5143\uff0c\u603b\u5171 1400 \u5143\uff0c\u800c\u4e0d\u4f1a\u51fa\u73b0\u7528\u6237 A \u6263\u9664\u4e86 200 \u5143\uff0c\u4f46\u7528\u6237 B \u672a\u589e\u52a0\u7684\u60c5\u51b5 (\u8be5\u60c5\u51b5\uff0c\u7528\u6237 A \u548c B \u5747\u4e3a 600 \u5143\uff0c\u603b\u5171 1200 \u5143)\u3002 \u9694\u79bb\u6027(Isolation) \uff1a\u662f\u6307\u5f53\u7cfb\u7edf\u5185\u6709\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u6267\u884c\u65f6\uff0c\u591a\u4e2a\u4e8b\u52a1\u4e0d\u4f1a\u76f8\u4e92\u5e72\u6270\uff0c\u5373\u4e00\u4e2a\u4e8b\u52a1\u5185\u90e8\u7684\u64cd\u4f5c\u53ca\u4f7f\u7528\u7684\u6570\u636e\uff0c\u5bf9\u5176\u4ed6\u5e76\u53d1\u4e8b\u52a1\u662f\u9694\u79bb\u7684\u3002 \u6301\u4e45\u6027(Durability) \uff1a\u4e5f\u88ab\u79f0\u4e3a\u6c38\u4e45\u6027\uff0c\u662f\u6307\u4e00\u4e2a\u4e8b\u52a1\u5b8c\u6210\u4e86\uff0c\u90a3\u4e48\u5b83\u5bf9\u6570\u636e\u5e93\u6240\u505a\u7684\u66f4\u65b0\u5c31\u88ab\u6c38\u4e45\u4fdd\u5b58\u4e0b\u6765\u4e86\u3002\u5373\u4f7f\u53d1\u751f\u7cfb\u7edf\u5d29\u6e83\u6216\u5b95\u673a\u7b49\u6545\u969c\uff0c\u53ea\u8981\u6570\u636e\u5e93\u80fd\u591f\u91cd\u65b0\u88ab\u8bbf\u95ee\uff0c\u90a3\u4e48\u4e00\u5b9a\u80fd\u591f\u5c06\u5176\u6062\u590d\u5230\u4e8b\u52a1\u5b8c\u6210\u65f6\u7684\u72b6\u6001\u3002","title":"03-\u672c\u5730\u4e8b\u52a1\u56de\u987e 04:45"},{"location":"hmtt/day04/#04-_0311","text":"\u5206\u5e03\u5f0f\u4e8b\u52a1\u6307\u4e8b\u52a1\u7684\u53c2\u4e0e\u8005\u3001\u652f\u6301\u4e8b\u52a1\u7684\u670d\u52a1\u5668\u3001\u8d44\u6e90\u670d\u52a1\u5668\u4ee5\u53ca\u4e8b\u52a1\u7ba1\u7406\u5668\u5206\u522b\u4f4d\u4e8e\u4e0d\u540c\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u4e0d\u540c\u8282\u70b9\u4e4b\u4e0a,\u4e14\u5c5e\u4e8e\u4e0d\u540c\u7684\u5e94\u7528\uff0c\u5206\u5e03\u5f0f\u4e8b\u52a1\u9700\u8981\u4fdd\u8bc1\u8fd9\u4e9b\u64cd\u4f5c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u3002 \u5bf9\u4e8e\u7f51\u4e0a\u8d2d\u7269\u7684\u6bcf\u4e00\u7b14\u8ba2\u5355\u6765\u8bf4\uff0c\u7535\u5546\u5e73\u53f0\u4e00\u822c\u90fd\u4f1a\u6709\u4e24\u4e2a\u6838\u5fc3\u6b65\u9aa4\uff1a\u4e00\u662f\u8ba2\u5355\u4e1a\u52a1\u91c7\u53d6\u4e0b\u8ba2\u5355\u64cd\u4f5c\uff0c\u4e8c\u662f\u5e93\u5b58\u4e1a\u52a1\u91c7\u53d6\u51cf\u5e93\u5b58\u64cd\u4f5c\u3002 \u901a\u5e38\uff0c\u8fd9\u4e24\u4e2a\u4e1a\u52a1\u4f1a\u8fd0\u884c\u5728\u4e0d\u540c\u7684\u673a\u5668\u4e0a\uff0c\u751a\u81f3\u662f\u8fd0\u884c\u5728\u4e0d\u540c\u533a\u57df\u7684\u673a\u5668\u4e0a\u3002\u9488\u5bf9\u540c\u4e00\u7b14\u8ba2\u5355\uff0c\u5f53\u4e14\u4ec5\u5f53\u8ba2\u5355\u64cd\u4f5c\u548c\u51cf\u5e93\u5b58\u64cd\u4f5c\u4e00\u81f4\u65f6\uff0c\u624d\u80fd\u4fdd\u8bc1\u4ea4\u6613\u7684\u6b63\u786e\u6027\u3002\u4e5f\u5c31\u662f\u8bf4\u4e00\u7b14\u8ba2\u5355\uff0c\u53ea\u6709\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u90fd\u5b8c\u6210\uff0c\u624d\u80fd\u7b97\u505a\u5904\u7406\u6210\u529f\uff0c\u5426\u5219\u5904\u7406\u5931\u8d25\uff0c\u5145\u5206\u4f53\u73b0\u4e86\u201cAll or nothing\u201d\u7684\u601d\u60f3\u3002","title":"04-\u5206\u5e03\u5f0f\u4e8b\u52a1 03:11"},{"location":"hmtt/day04/#05-cap_1206","text":"C -> \u4e00\u81f4\u6027 A -> \u53ef\u7528\u6027 P -> \u5206\u533a\u5bb9\u9519\u6027","title":"05-CAP\u5b9a\u7406  12:06"},{"location":"hmtt/day04/#cap","text":"","title":"CAP\u5b9a\u7406\u7684\u9002\u7528\u8303\u56f4\uff1a"},{"location":"hmtt/day04/#_1","text":"\u6700\u7b80\u5355\u7684\u4f8b\u5982 Memcache \u7684\u96c6\u7fa4\uff0c\u76f8\u4e92\u4e4b\u95f4\u5c31\u6ca1\u6709\u8fde\u63a5\u548c\u5171\u4eab\u6570\u636e\uff0c\u56e0\u6b64 Memcache \u96c6\u7fa4\u8fd9\u7c7b\u5206\u5e03\u5f0f\u7cfb\u7edf\u5c31\u4e0d\u7b26\u5408 CAP \u7406\u8bba\u63a2\u8ba8\u7684\u5bf9\u8c61\uff1b\u800c MySQL \u96c6\u7fa4\u5c31\u662f\u4e92\u8054\u548c\u8fdb\u884c\u6570\u636e\u590d\u5236\u7684\uff0c\u56e0\u6b64\u662f CAP \u7406\u8bba\u63a2\u8ba8\u7684\u5bf9\u8c61\u3002","title":"\u5206\u5e03\u5f0f\u7cfb\u7edf\u5e76\u4e0d\u4e00\u5b9a\u4f1a\u4e92\u8054\u548c\u5171\u4eab\u6570\u636e"},{"location":"hmtt/day04/#cap_1","text":"ZooKeeper \u7684\u9009\u4e3e\u673a\u5236\u5c31\u4e0d\u662f CAP \u63a2\u8ba8\u7684\u5bf9\u8c61 \u5047\u8bbe\u67d0\u7535\u5546\uff0c\u5728\u5317\u4eac\u3001\u676d\u5dde\u3001\u4e0a\u6d77\u4e09\u4e2a\u57ce\u5e02\u5efa\u7acb\u4e86\u4ed3\u5e93\uff0c\u540c\u65f6\u5efa\u7acb\u4e86\u5bf9\u5e94\u7684\u670d\u52a1\u5668{A, B, C}\u7528\u4e8e\u5b58\u50a8\u5546\u54c1\u4fe1\u606f\u3002 \u6bd4\u5982\uff0c\u67d0\u7535\u5439\u98ce\u5728\u5317\u4eac\u4ed3\u5e93\u6709 20 \u4e2a\uff0c\u5728\u676d\u5dde\u4ed3\u5e93\u6709 10 \u4e2a\uff0c\u5728\u4e0a\u6d77\u4ed3\u5e93\u6709 30 \u4e2a\u3002 \u90a3\u4e48\uff0cCAP \u8fd9\u4e09\u4e2a\u5b57\u6bcd\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u5206\u522b\u4ee3\u8868\u4ec0\u4e48\u5462\uff1f \u9996\u5148\uff0c\u6211\u4eec\u6765\u770b\u4e00\u4e0b C\u3002C \u4ee3\u8868 Consistency\uff0c\u4e00\u81f4\u6027\uff0c\u662f\u6307\u6240\u6709\u8282\u70b9\u5728\u540c\u4e00\u65f6\u523b\u7684\u6570\u636e\u662f\u76f8\u540c\u7684\uff0c\u5373\u66f4\u65b0\u64cd\u4f5c\u6267\u884c\u7ed3\u675f\u5e76\u54cd\u5e94\u7528\u6237\u5b8c\u6210\u540e\uff0c\u6240\u6709\u8282\u70b9\u5b58\u50a8\u7684\u6570\u636e\u4f1a\u4fdd\u6301\u76f8\u540c\u3002\u5728\u7535\u5546\u7cfb\u7edf\u4e2d\uff0cA\u3001B\u3001C \u4e2d\u5b58\u50a8\u7684\u8be5\u7535\u5439\u98ce\u7684\u6570\u91cf\u5e94\u8be5\u662f 20+10+30=60\u3002\u5047\u8bbe\uff0c\u73b0\u5728\u6709\u4e00\u4e2a\u5317\u4eac\u7528\u6237\u4e70\u8d70\u4e00\u4e2a\u7535\u5439\u98ce\uff0c\u670d\u52a1\u5668 A \u4f1a\u66f4\u65b0\u6570\u636e\u4e3a 60-1=59\uff0c\u4e0e\u6b64\u540c\u65f6\u8981\u6c42 B \u548c C \u4e5f\u66f4\u65b0\u4e3a 59\uff0c\u4ee5\u4fdd\u8bc1\u5728\u540c\u4e00\u65f6\u523b\uff0c\u65e0\u8bba\u8bbf\u95ee A\u3001B\u3001C \u4e2d\u7684\u54ea\u4e2a\u670d\u52a1\u5668\uff0c\u5f97\u5230\u7684\u6570\u636e\u5747\u662f 59\u3002 \u7136\u540e\uff0c\u770b\u4e00\u4e0b A\u3002A \u4ee3\u8868 Availability\uff0c\u53ef\u7528\u6027\uff0c\u662f\u6307\u7cfb\u7edf\u63d0\u4f9b\u7684\u670d\u52a1\u4e00\u76f4\u5904\u4e8e\u53ef\u7528\u72b6\u6001\uff0c\u5bf9\u4e8e\u7528\u6237\u7684\u8bf7\u6c42\u53ef\u5373\u65f6\u54cd\u5e94\u3002\u5728\u7535\u5546\u7cfb\u7edf\u4e2d\uff0c\u7528\u6237\u5728\u4efb\u4e00\u65f6\u523b\u5411 A\u3001B\u3001C \u4e2d\u7684\u4efb\u4e00\u670d\u52a1\u5668\u53d1\u51fa\u8bf7\u6c42\u65f6\uff0c\u5747\u53ef\u5f97\u5230\u5373\u65f6\u54cd\u5e94\uff0c\u6bd4\u5982\u67e5\u8be2\u5546\u54c1\u4fe1\u606f\u7b49\u3002 \u6700\u540e\uff0c\u6211\u4eec\u770b\u4e00\u4e0b P\u3002P \u4ee3\u8868 Partition Tolerance\uff0c\u5206\u533a\u5bb9\u9519\u6027\uff0c\u662f\u6307\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u9047\u5230\u7f51\u7edc\u5206\u533a\u7684\u60c5\u51b5\u4e0b\uff0c\u4ecd\u7136\u53ef\u4ee5\u54cd\u5e94\u7528\u6237\u7684\u8bf7\u6c42\u3002\u7f51\u7edc\u5206\u533a\u662f\u6307\u56e0\u4e3a\u7f51\u7edc\u6545\u969c\u5bfc\u81f4\u7f51\u7edc\u4e0d\u8fde\u901a\uff0c\u4e0d\u540c\u8282\u70b9\u5206\u5e03\u5728\u4e0d\u540c\u7684\u5b50\u7f51\u7edc\u4e2d\uff0c\u5404\u4e2a\u5b50\u7f51\u7edc\u5185\u7f51\u7edc\u6b63\u5e38\u3002\u5728\u7535\u5546\u7cfb\u7edf\u4e2d\uff0c\u5047\u8bbe C \u4e0e A \u548c B \u7684\u7f51\u7edc\u90fd\u4e0d\u901a\u4e86\uff0cA \u548c B \u662f\u76f8\u901a\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f62\u6210\u4e86\u4e24\u4e2a\u5206\u533a{A, B}\u548c{C}\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7cfb\u7edf\u4ecd\u80fd\u54cd\u5e94\u7528\u6237\u8bf7\u6c42\u3002","title":"CAP \u5173\u6ce8\u7684\u662f\u5bf9\u6570\u636e\u7684\u8bfb\u5199\u64cd\u4f5c\uff0c\u800c\u4e0d\u662f\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u6240\u6709\u529f\u80fd"},{"location":"hmtt/day04/#06-base_0352","text":"BASE\uff1a\u5168\u79f0\uff1aBasically Available(\u57fa\u672c\u53ef\u7528)\uff0cSoft state\uff08\u8f6f\u72b6\u6001\uff09,\u548c Eventually consistent\uff08\u6700\u7ec8\u4e00\u81f4\u6027\uff09\u4e09\u4e2a\u77ed\u8bed\u7684\u7f29\u5199\uff0c\u6765\u81ea ebay \u7684\u67b6\u6784\u5e08\u63d0\u51fa\u3002BASE \u7406\u8bba\u662f\u5bf9 CAP \u4e2d\u4e00\u81f4\u6027\u548c\u53ef\u7528\u6027\u6743\u8861\u7684\u7ed3\u679c\uff0c\u5176\u6765\u6e90\u4e8e\u5bf9\u5927\u578b\u4e92\u8054\u7f51\u5206\u5e03\u5f0f\u5b9e\u8df5\u7684\u603b\u7ed3\uff0c\u662f\u57fa\u4e8e CAP \u5b9a\u7406\u9010\u6b65\u6f14\u5316\u800c\u6765\u7684\u3002 \u65e2\u662f\u65e0\u6cd5\u505a\u5230\u5f3a\u4e00\u81f4\u6027\uff08Strong consistency\uff09\uff0c\u4f46\u6bcf\u4e2a\u5e94\u7528\u90fd\u53ef\u4ee5\u6839\u636e\u81ea\u8eab\u7684\u4e1a\u52a1\u7279\u70b9\uff0c\u91c7\u7528\u9002\u5f53\u7684\u65b9\u5f0f\u6765\u4f7f\u7cfb\u7edf\u8fbe\u5230\u6700\u7ec8\u4e00\u81f4\u6027\uff08Eventual consistency\uff09\u3002 \u5f88\u591a\u540c\u5b66\u53ef\u80fd\u559c\u6b22\u4f7f\u7528\u4e8b\u52a1\u578b\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u6216\u8005\u662f\u5f3a\u4e00\u81f4\u6027\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u56e0\u4e3a\u4f7f\u7528\u8d77\u6765\u5f88\u65b9\u4fbf\uff0c\u4e0d\u9700\u8981\u8003\u8651\u592a\u591a\uff0c\u5c31\u50cf\u4f7f\u7528\u5355\u673a\u7cfb\u7edf\u4e00\u6837\u3002\u4f46\u662f\u5b66\u4e86 CAP \u7406\u8bba\u540e\uff0c\u4f60\u80af\u5b9a\u77e5\u9053\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u8981\u5b9e\u73b0\u5f3a\u4e00\u81f4\u6027\u5fc5\u7136\u4f1a\u5f71\u54cd\u53ef\u7528\u6027\u3002\u6bd4\u5982\uff0c\u5728\u91c7\u7528\u4e24\u9636\u6bb5\u63d0\u4ea4\u534f\u8bae\u7684\u96c6\u7fa4\u7cfb\u7edf\u4e2d\uff0c\u56e0\u4e3a\u6267\u884c\u63d0\u4ea4\u64cd\u4f5c\uff0c\u9700\u8981\u6240\u6709\u8282\u70b9\u786e\u8ba4\u548c\u6295\u7968\u3002 \u6240\u4ee5\uff0c\u96c6\u7fa4\u7684\u53ef\u7528\u6027\u662f\u6bcf\u4e2a\u8282\u70b9\u53ef\u7528\u6027\u7684\u4e58\u79ef\uff0c\u6bd4\u5982\uff0c\u5047\u8bbe 3 \u4e2a\u8282\u70b9\u7684\u96c6\u7fa4\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684\u53ef\u7528\u6027\u4e3a 99.9\uff05\uff0c\u90a3\u4e48\u6574\u4e2a\u96c6\u7fa4\u7684\u53ef\u7528\u6027\u4e3a 99.7\uff05\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c \u6bcf\u4e2a\u6708\u7ea6\u5b95\u673a 129.6 \u5206\u949f\uff0c\u8fd9\u662f\u975e\u5e38\u4e25\u91cd\u7684\u95ee\u9898 \u3002 \u800c\u89e3\u51b3\u53ef\u7528\u6027\u4f4e\u7684\u5173\u952e\u5728\u4e8e\uff0c\u6839\u636e\u5b9e\u9645\u573a\u666f\uff0c\u5c3d\u91cf\u91c7\u7528\u53ef\u7528\u6027\u4f18\u5148\u7684 AP \u6a21\u578b\u3002 \u8bb2\u5230\u8fd9\u513f\uff0c\u53ef\u80fd\u4f1a\u6709\u4e00\u4e9b\u540c\u5b66\u201c\u4e3e\u624b\u63d0\u95ee\u201d\uff1a\u8fd9\u4e5f\u592a\u96be\u4e86\uff0c\u96be\u9053\u6ca1\u6709\u73b0\u6210\u7684\u5e93\u6216\u8005\u65b9\u6848\uff0c\u6765\u5b9e\u73b0\u5408\u9002\u7684 AP \u6a21\u578b\uff1f\u662f\u7684\uff0c\u7684\u786e\u6ca1\u6709\u3002\u56e0\u4e3a\u5b83\u662f\u4e00\u4e2a\u52a8\u6001\u6a21\u578b\uff0c\u662f\u57fa\u4e8e\u4e1a\u52a1\u573a\u666f\u7279\u70b9\u59a5\u534f\u6298\u4e2d\u540e\u8bbe\u8ba1\u5b9e\u73b0\u7684\u3002\u4e0d\u8fc7\uff0c\u4f60\u53ef\u4ee5\u501f\u52a9 BASE \u7406\u8bba\u5e2e\u52a9\u4f60\u8fbe\u6210\u76ee\u7684\u3002 BASE \u7406\u8bba\u662f CAP \u7406\u8bba\u4e2d\u7684 AP \u7684\u5ef6\u4f38\uff0c\u662f\u5bf9\u4e92\u8054\u7f51\u5927\u89c4\u6a21\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u5b9e\u8df5\u603b\u7ed3\uff0c\u5f3a\u8c03\u53ef\u7528\u6027\u3002\u51e0\u4e4e\u6240\u6709\u7684\u4e92\u8054\u7f51\u540e\u53f0\u5206\u5e03\u5f0f\u7cfb\u7edf\u90fd\u6709 BASE \u7684\u652f\u6301\uff0c\u8fd9\u4e2a\u7406\u8bba\u5f88\u91cd\u8981\uff0c\u5730\u4f4d\u4e5f\u5f88\u9ad8\u3002\u4e00\u65e6\u638c\u63e1\u5b83\uff0c\u4f60\u5c31\u80fd\u638c\u63e1\u7edd\u5927\u90e8\u5206\u573a\u666f\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u67b6\u6784\u6280\u5de7\uff0c\u8bbe\u8ba1\u51fa\u9002\u5408\u4e1a\u52a1\u573a\u666f\u7279\u70b9\u7684\u3001\u9ad8\u53ef\u7528\u6027\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\u3002","title":"06-BASE\u7406\u8bba 03:52"},{"location":"hmtt/day04/#4","text":"\u5f53\u7cfb\u7edf\u8282\u70b9\u51fa\u73b0\u5927\u89c4\u6a21\u6545\u969c\u7684\u65f6\u5019\uff0c\u6bd4\u5982\u4e13\u7ebf\u7684\u5149\u7ea4\u88ab\u6316\u65ad\u3001\u7a81\u53d1\u6d41\u91cf\u5bfc\u81f4\u7cfb\u7edf\u8fc7\u8f7d\uff08\u51fa\u73b0\u4e86\u7a81\u53d1\u4e8b\u4ef6\uff0c\u670d\u52a1\u88ab\u5927\u91cf\u8bbf\u95ee\uff09\uff0c\u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u901a\u8fc7\u670d\u52a1\u964d\u7ea7\uff0c\u727a\u7272\u90e8\u5206\u529f\u80fd\u7684\u53ef\u7528\u6027\uff0c\u4fdd\u969c\u7cfb\u7edf\u7684\u6838\u5fc3\u529f\u80fd\u53ef\u7528\u3002","title":"\u5b9e\u73b0\u57fa\u672c\u53ef\u7528\u7684 4 \u677f\u65a7"},{"location":"hmtt/day04/#1","text":"\u200b \u5c31\u62ff 12306 \u8ba2\u7968\u7cfb\u7edf\u57fa\u672c\u53ef\u7528\u7684\u8bbe\u8ba1\u4e3a\u4f8b\uff0c\u8fd9\u4e2a\u8ba2\u7968\u7cfb\u7edf\u5728\u6625\u8fd0\u671f\u95f4\uff0c\u56e0\u4e3a\u5f00\u59cb\u552e\u7968\u540e\u5148\u5230\u5148\u5f97\u7684\u7f18\u6545\uff0c\u4f1a\u51fa\u73b0\u6781\u5176\u6d77\u91cf\u7684\u8bf7\u6c42\u5cf0\u503c\uff0c\u5982\u4f55\u5904\u7406\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f\u54b1\u4eec\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u65f6\u95f4\uff0c\u51fa\u552e\u4e0d\u540c\u533a\u57df\u7684\u7968\uff0c\u5c06\u8bbf\u95ee\u8bf7\u6c42\u9519\u5f00\uff0c\u524a\u5f31\u8bf7\u6c42\u5cf0\u503c\u3002\u6bd4\u5982\uff0c\u5728\u6625\u8fd0\u671f\u95f4\uff0c\u6df1\u5733\u51fa\u53d1\u7684\u706b\u8f66\u7968\u5728 8 \u70b9\u5f00\u552e\uff0c\u5317\u4eac\u51fa\u53d1\u7684\u706b\u8f66\u7968\u5728 9 \u70b9\u5f00\u552e\u3002\u8fd9\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684\u6d41\u91cf\u524a\u5cf0\u3002","title":"1.\u6d41\u91cf\u524a\u5cf0"},{"location":"hmtt/day04/#2","text":"\u4f60\u53ef\u80fd\u5df2\u7ecf\u53d1\u73b0\u4e86\uff0c\u5728\u6625\u8fd0\u671f\u95f4\uff0c\u81ea\u5df1\u63d0\u4ea4\u7684\u8d2d\u7968\u8bf7\u6c42\uff0c\u5f80\u5f80\u4f1a\u5728\u961f\u5217\u4e2d\u6392\u961f\u7b49\u5f85\u5904\u7406\uff0c\u53ef\u80fd\u51e0\u5206\u949f\u6216\u5341\u51e0\u5206\u949f\u540e\uff0c\u7cfb\u7edf\u624d\u5f00\u59cb\u5904\u7406\uff0c\u7136\u540e\u54cd\u5e94\u5904\u7406\u7ed3\u679c\uff0c\u8fd9\u5c31\u662f\u4f60\u719f\u6089\u7684\u5ef6\u8fdf\u54cd\u5e94\u3002 \u4f60\u770b\uff0c12306 \u8ba2\u7968\u7cfb\u7edf\u5728\u51fa\u73b0\u8d85\u51fa\u7cfb\u7edf\u5904\u7406\u80fd\u529b\u7684\u7a81\u53d1\u6d41\u91cf\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u901a\u8fc7\u727a\u7272\u54cd\u5e94\u65f6\u95f4\u7684\u53ef\u7528\u6027\uff0c\u4fdd\u969c\u6838\u5fc3\u529f\u80fd\u7684\u8fd0\u884c\u3002","title":"2.\u5ef6\u8fdf\u54cd\u5e94"},{"location":"hmtt/day04/#3","text":"\u4f60\u6b63\u8d1f\u8d23\u4e00\u4e2a\u4e92\u8054\u7f51\u7cfb\u7edf\uff0c\u7a81\u7136\u51fa\u73b0\u4e86\u7f51\u7edc\u70ed\u70b9\u4e8b\u4ef6\uff0c\u597d\u591a\u7528\u6237\u6d8c\u8fdb\u6765\uff0c\u4ea7\u751f\u4e86\u6d77\u91cf\u7684\u7a81\u53d1\u6d41\u91cf\uff0c\u7cfb\u7edf\u8fc7\u8f7d\u4e86\uff0c\u5927\u91cf\u56fe\u7247\u56e0\u4e3a\u7f51\u7edc\u8d85\u65f6\u65e0\u6cd5\u663e\u793a\u3002\u90a3\u4e48\u8fd9\u4e2a\u65f6\u5019\u4f60\u53ef\u4ee5\u901a\u8fc7\u54ea\u4e9b\u65b9\u6cd5\uff0c\u4fdd\u969c\u7cfb\u7edf\u7684\u57fa\u672c\u53ef\u7528\u5462\uff1f\u76f8\u4fe1\u4f60\u9a6c\u4e0a\u5c31\u80fd\u60f3\u5230\u4f53\u9a8c\u964d\u7ea7\uff0c \u6bd4\u5982\u7528\u5c0f\u56fe\u7247\u6765\u66ff\u4ee3\u539f\u59cb\u56fe\u7247\uff0c\u901a\u8fc7\u964d\u4f4e\u56fe\u7247\u7684\u6e05\u6670\u5ea6\u548c\u5927\u5c0f\uff0c\u63d0\u5347\u7cfb\u7edf\u7684\u5904\u7406\u80fd\u529b\u3002","title":"3.\u4f53\u9a8c\u964d\u7ea7"},{"location":"hmtt/day04/#4_1","text":"\u6bd4\u5982\u628a\u63a5\u6536\u5230\u7684\u8bf7\u6c42\u653e\u5728\u6307\u5b9a\u7684\u961f\u5217\u4e2d\u6392\u961f\u5904\u7406\uff0c\u5982\u679c\u8bf7\u6c42\u7b49\u5f85\u65f6\u95f4\u8d85\u65f6\u4e86\uff08\u5047\u8bbe\u662f 100ms\uff09\uff0c\u8fd9\u4e2a\u65f6\u5019\u76f4\u63a5\u62d2\u7edd\u8d85\u65f6\u8bf7\u6c42\uff1b\u518d\u6bd4\u5982\u961f\u5217\u6ee1\u4e86\u4e4b\u540e\uff0c\u5c31\u6e05\u9664\u961f\u5217\u4e2d\u4e00\u5b9a\u6570\u91cf\u7684\u6392\u961f\u8bf7\u6c42\uff0c\u4fdd\u62a4\u7cfb\u7edf\u4e0d\u8fc7\u8f7d\uff0c\u5b9e\u73b0\u7cfb\u7edf\u7684\u57fa\u672c\u53ef\u7528\u3002 \u51e0\u4e4e\u6240\u6709\u7684\u4e92\u8054\u7f51\u7cfb\u7edf\u91c7\u7528\u7684\u90fd\u662f\u6700\u7ec8\u4e00\u81f4\u6027\uff0c\u53ea\u6709\u5728\u5b9e\u5728\u65e0\u6cd5\u4f7f\u7528\u6700\u7ec8\u4e00\u81f4\u6027\uff0c\u624d\u4f7f\u7528\u5f3a\u4e00\u81f4\u6027\u6216\u4e8b\u52a1\uff0c\u6bd4\u5982\uff0c\u5bf9\u4e8e\u51b3\u5b9a\u7cfb\u7edf\u8fd0\u884c\u7684\u654f\u611f\u5143\u6570\u636e\uff0c\u9700\u8981\u8003\u8651\u91c7\u7528\u5f3a\u4e00\u81f4\u6027\uff0c\u5bf9\u4e8e\u4e0e\u94b1\u6709\u5173\u7684\u652f\u4ed8\u7cfb\u7edf\u6216\u91d1\u878d\u7cfb\u7edf\u7684\u6570\u636e\uff0c\u9700\u8981\u8003\u8651\u91c7\u7528\u4e8b\u52a1\u3002\u4f60\u53ef\u4ee5\u5c06\u5f3a\u4e00\u81f4\u6027\u7406\u89e3\u4e3a\u6700\u7ec8\u4e00\u81f4\u6027\u7684\u7279\u4f8b\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4f60\u53ef\u4ee5\u628a\u5f3a\u4e00\u81f4\u6027\u770b\u4f5c\u662f\u4e0d\u5b58\u5728\u5ef6\u8fdf\u7684\u4e00\u81f4\u6027\u3002\u5728\u5b9e\u8df5\u4e2d\uff0c\u4f60\u4e5f\u53ef\u4ee5\u8fd9\u6837\u601d\u8003\uff1a \u5982\u679c\u4e1a\u52a1\u7684\u67d0\u529f\u80fd\u65e0\u6cd5\u5bb9\u5fcd\u4e00\u81f4\u6027\u7684\u5ef6\u8fdf\uff08\u6bd4\u5982\u5206\u5e03\u5f0f\u9501\u5bf9\u5e94\u7684\u6570\u636e\uff09\uff0c\u9700\u8981\u5b9e\u73b0\u7684\u662f\u5f3a\u4e00\u81f4\u6027\uff1b\u5982\u679c\u80fd\u5bb9\u5fcd\u77ed\u6682\u7684\u4e00\u81f4\u6027\u7684\u5ef6\u8fdf\uff08\u6bd4\u5982 QQ \u72b6\u6001\u6570\u636e\uff09\uff0c\u5c31\u53ef\u4ee5\u8003\u8651\u6700\u7ec8\u4e00\u81f4\u6027\u3002","title":"4.\u8fc7\u8f7d\u4fdd\u62a4"},{"location":"hmtt/day04/#07-xa_0524","text":"\u6211\u4ee5\u7528\u6237 A \u8981\u5728\u7f51\u4e0a\u4e0b\u5355\u8d2d\u4e70 100 \u4ef6 T \u6064\u4e3a\u4f8b\uff0c\u91cd\u70b9\u4e0e\u4f60\u4ecb\u7ecd\u4e0b\u5355\u64cd\u4f5c\u548c\u51cf\u5e93\u5b58\u64cd\u4f5c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u3002 \u7b2c\u4e00\u9636\u6bb5\uff1a\u8ba2\u5355\u7cfb\u7edf\u4e2d\u5c06\u4e0e\u7528\u6237 A \u6709\u5173\u7684\u8ba2\u5355\u6570\u636e\u5e93\u9501\u4f4f\uff0c\u51c6\u5907\u597d\u589e\u52a0\u4e00\u6761\u5173\u4e8e\u7528\u6237 A \u8d2d\u4e70 100 \u4ef6 T \u6064\u7684\u4fe1\u606f\uff0c\u5e76\u5c06\u540c\u610f\u6d88\u606f\u201cYes\u201d\u56de\u590d\u7ed9\u534f\u8c03\u8005\u3002\u800c\u5e93\u5b58\u7cfb\u7edf\u7531\u4e8e T \u6064\u5e93\u5b58\u4e0d\u8db3\uff0c\u51fa\u8d27\u5931\u8d25\uff0c\u56e0\u6b64\u5411\u534f\u8c03\u8005\u56de\u590d\u4e86\u4e00\u4e2a\u7ec8\u6b62\u6d88\u606f\u201cNo\u201d\u3002 \u7b2c\u4e8c\u9636\u6bb5\uff1a\u7531\u4e8e\u5e93\u5b58\u7cfb\u7edf\u64cd\u4f5c\u4e0d\u6210\u529f\uff0c\u56e0\u6b64\uff0c\u534f\u8c03\u8005\u5c31\u4f1a\u5411\u8ba2\u5355\u7cfb\u7edf\u548c\u5e93\u5b58\u7cfb\u7edf\u53d1\u9001\u201cDoAbort\u201d\u6d88\u606f\u3002\u8ba2\u5355\u7cfb\u7edf\u63a5\u6536\u5230\u201cDoAbort\u201d\u6d88\u606f\u540e\uff0c\u5c06\u7cfb\u7edf\u5185\u7684\u6570\u636e\u9000\u56de\u5230\u6ca1\u6709\u7528\u6237 A \u8d2d\u4e70 100 \u4ef6 T \u6064\u7684\u7248\u672c\uff0c\u5e76\u91ca\u653e\u9501\u4f4f\u7684\u6570\u636e\u5e93\u8d44\u6e90\u3002\u8ba2\u5355\u7cfb\u7edf\u548c\u5e93\u5b58\u7cfb\u7edf\u5b8c\u6210\u64cd\u4f5c\u540e\uff0c\u5411\u534f\u8c03\u8005\u53d1\u9001\u201cHaveCommitted\u201d\u6d88\u606f\uff0c\u8868\u793a\u5b8c\u6210\u4e86\u4e8b\u52a1\u7684\u64a4\u9500\u64cd\u4f5c\u3002\u81f3\u6b64\uff0c\u7528\u6237 A \u8d2d\u4e70 100 \u4ef6 T \u6064\u8fd9\u4e00\u4e8b\u52a1\u5df2\u7ecf\u7ed3\u675f\uff0c\u7528\u6237 A \u8d2d\u4e70\u5931\u8d25\u3002 \u4e8c\u9636\u6bb5\u63d0\u4ea4\u7684\u7b97\u6cd5\u601d\u8def\u53ef\u4ee5\u6982\u62ec\u4e3a \uff1a \u534f\u8c03\u8005\u5411\u53c2\u4e0e\u8005\u4e0b\u53d1\u8bf7\u6c42\u4e8b\u52a1\u64cd\u4f5c\uff0c\u53c2\u4e0e\u8005\u63a5\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u8fdb\u884c\u76f8\u5173\u64cd\u4f5c\u5e76\u5c06\u64cd\u4f5c\u7ed3\u679c\u901a\u77e5\u534f\u8c03\u8005\uff0c\u534f\u8c03\u8005\u6839\u636e\u6240\u6709\u53c2\u4e0e\u8005\u7684\u53cd\u9988\u7ed3\u679c\u51b3\u5b9a\u5404\u53c2\u4e0e\u8005\u662f\u8981\u63d0\u4ea4\u64cd\u4f5c\u8fd8\u662f\u64a4\u9500\u64cd\u4f5c\u3002\u867d\u7136\u57fa\u4e8e XA \u7684\u4e8c\u9636\u6bb5\u63d0\u4ea4\u7b97\u6cd5\u5c3d\u91cf\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u5f3a\u4e00\u81f4\u6027\uff0c\u800c\u4e14\u5b9e\u73b0\u6210\u672c\u4f4e\uff0c\u4f46\u4f9d\u7136\u6709\u4e9b\u4e0d\u8db3\u3002\u4e3b\u8981\u6709\u4ee5\u4e0b\u4e09\u4e2a\u95ee\u9898\uff1a \u540c\u6b65\u963b\u585e\u95ee\u9898\uff1a\u4e8c\u9636\u6bb5\u63d0\u4ea4\u7b97\u6cd5\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u6240\u6709\u53c2\u4e0e\u8282\u70b9\u90fd\u662f\u4e8b\u52a1\u963b\u585e\u578b\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u672c\u5730\u8d44\u6e90\u7ba1\u7406\u5668\u5360\u6709\u4e34\u754c\u8d44\u6e90\u65f6\uff0c\u5176\u4ed6\u8d44\u6e90\u7ba1\u7406\u5668\u5982\u679c\u8981\u8bbf\u95ee\u540c\u4e00\u4e34\u754c\u8d44\u6e90\uff0c\u4f1a\u5904\u4e8e\u963b\u585e\u72b6\u6001\u3002\u56e0\u6b64\uff0c\u57fa\u4e8e XA \u7684\u4e8c\u9636\u6bb5\u63d0\u4ea4\u534f\u8bae\u4e0d\u652f\u6301\u9ad8\u5e76\u53d1\u573a\u666f\u3002 \u5355\u70b9\u6545\u969c\u95ee\u9898\uff1a\u8be5\u7b97\u6cd5\u7c7b\u4f3c\u4e8e\u96c6\u4e2d\u5f0f\u7b97\u6cd5\uff0c\u4e00\u65e6\u4e8b\u52a1\u7ba1\u7406\u5668\u53d1\u751f\u6545\u969c\uff0c\u6574\u4e2a\u7cfb\u7edf\u90fd\u5904\u4e8e\u505c\u6ede\u72b6\u6001\u3002\u5c24\u5176\u662f\u5728\u63d0\u4ea4\u9636\u6bb5\uff0c\u4e00\u65e6\u4e8b\u52a1\u7ba1\u7406\u5668\u53d1\u751f\u6545\u969c\uff0c\u8d44\u6e90\u7ba1\u7406\u5668\u4f1a\u7531\u4e8e\u7b49\u5f85\u7ba1\u7406\u5668\u7684\u6d88\u606f\uff0c\u800c\u4e00\u76f4\u9501\u5b9a\u4e8b\u52a1\u8d44\u6e90\uff0c\u5bfc\u81f4\u6574\u4e2a\u7cfb\u7edf\u88ab\u963b\u585e\u3002 \u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\uff1a\u5728\u63d0\u4ea4\u9636\u6bb5\uff0c\u5f53\u534f\u8c03\u8005\u5411\u6240\u6709\u53c2\u4e0e\u8005\u53d1\u9001\u201cDoCommit\u201d\u8bf7\u6c42\u65f6\uff0c\u5982\u679c\u53d1\u751f\u4e86\u5c40\u90e8\u7f51\u7edc\u5f02\u5e38\uff0c\u6216\u8005\u5728\u53d1\u9001\u63d0\u4ea4\u8bf7\u6c42\u7684\u8fc7\u7a0b\u4e2d\u534f\u8c03\u8005\u53d1\u751f\u4e86\u6545\u969c\uff0c\u5c31\u4f1a\u5bfc\u81f4\u53ea\u6709\u4e00\u90e8\u5206\u53c2\u4e0e\u8005\u63a5\u6536\u5230\u4e86\u63d0\u4ea4\u8bf7\u6c42\u5e76\u6267\u884c\u63d0\u4ea4\u64cd\u4f5c\uff0c\u4f46\u5176\u4ed6\u672a\u63a5\u5230\u63d0\u4ea4\u8bf7\u6c42\u7684\u90a3\u90e8\u5206\u53c2\u4e0e\u8005\u5219\u65e0\u6cd5\u6267\u884c\u4e8b\u52a1\u63d0\u4ea4\u3002\u4e8e\u662f\u6574\u4e2a\u5206\u5e03\u5f0f\u7cfb\u7edf\u4fbf\u51fa\u73b0\u4e86\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002 \u5e94\u7528\u4e0d\u5e7f\u6cdb\uff0c\u539f\u56e0\u662f\u6027\u80fd\u6bd4\u8f83\u5dee","title":"07-XA\u534f\u8bae\u4e24\u9636\u6bb5\u63d0\u4ea4 05:24"},{"location":"hmtt/day04/#08-tcc_0414","text":"TCC\u662f\u5e94\u7528\u5c42\u76842PC\uff0c\u66f4\u504f\u5411\u4e8e\u4e1a\u52a1\u4e0a\u5c42\u7684\u5904\u7406\uff0c\u975e\u5e95\u5c42\u7684XA\uff082PC\uff09\u7b49\u3002 Try \u9636\u6bb5\u4e3b\u8981\u662f\u5bf9\u4e1a\u52a1\u7cfb\u7edf\u505a\u68c0\u6d4b\u53ca\u8d44\u6e90\u9884\u7559 Confirm \u9636\u6bb5\u4e3b\u8981\u662f\u5bf9\u4e1a\u52a1\u7cfb\u7edf\u505a\u786e\u8ba4\u63d0\u4ea4\uff0cTry\u9636\u6bb5\u6267\u884c\u6210\u529f\u5e76\u5f00\u59cb\u6267\u884c Confirm\u9636\u6bb5\u65f6\uff0c\u9ed8\u8ba4 Confirm\u9636\u6bb5\u662f\u4e0d\u4f1a\u51fa\u9519\u7684\u3002\u5373\uff1a\u53ea\u8981Try\u6210\u529f\uff0cConfirm\u4e00\u5b9a\u6210\u529f\u3002 Cancel \u9636\u6bb5\u4e3b\u8981\u662f\u5728\u4e1a\u52a1\u6267\u884c\u9519\u8bef\uff0c\u9700\u8981\u56de\u6eda\u7684\u72b6\u6001\u4e0b\u6267\u884c\u7684\u4e1a\u52a1\u53d6\u6d88\uff0c\u9884\u7559\u8d44\u6e90\u91ca\u653e\u3002 \u53c2\u8003\u8d44\u6599\uff1a https://www.cnblogs.com/jajian/p/10014145.html","title":"08-TCC\u8865\u507f\u673a\u5236  04:14"},{"location":"hmtt/day04/#09-_0342","text":"\u4e0a\u9762\u54b1\u4eec\u804a\u4e86\u804a TCC \u5206\u5e03\u5f0f\u4e8b\u52a1\uff0c\u5bf9\u4e8e\u5e38\u89c1\u7684\u5fae\u670d\u52a1\u7cfb\u7edf\uff0c\u5927\u90e8\u5206\u63a5\u53e3\u8c03\u7528\u662f\u540c\u6b65\u7684\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u670d\u52a1\u76f4\u63a5\u8c03\u7528\u53e6\u5916\u4e00\u4e2a\u670d\u52a1\u7684\u63a5\u53e3\u3002 \u8fd9\u4e2a\u65f6\u5019\uff0c\u7528 TCC \u5206\u5e03\u5f0f\u4e8b\u52a1\u65b9\u6848\u6765\u4fdd\u8bc1\u5404\u4e2a\u63a5\u53e3\u7684\u8c03\u7528\uff0c\u8981\u4e48\u4e00\u8d77\u6210\u529f\uff0c\u8981\u4e48\u4e00\u8d77\u56de\u6eda\uff0c\u662f\u6bd4\u8f83\u5408\u9002\u7684\u3002 \u4f46\u662f\u5728\u5b9e\u9645\u7cfb\u7edf\u7684\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u80fd\u670d\u52a1\u95f4\u7684\u8c03\u7528\u662f\u5f02\u6b65\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u4e2a\u670d\u52a1\u53d1\u9001\u4e00\u4e2a\u6d88\u606f\u7ed9 MQ\uff0c\u5373\u6d88\u606f\u4e2d\u95f4\u4ef6\uff0c\u6bd4\u5982 RocketMQ\u3001RabbitMQ\u3001Kafka\u3001ActiveMQ \u7b49\u7b49\u3002 \u7136\u540e\uff0c\u53e6\u5916\u4e00\u4e2a\u670d\u52a1\u4ece MQ \u6d88\u8d39\u5230\u4e00\u6761\u6d88\u606f\u540e\u8fdb\u884c\u5904\u7406\u3002\u8fd9\u5c31\u6210\u4e86\u57fa\u4e8e MQ \u7684\u5f02\u6b65\u8c03\u7528\u4e86\u3002 \u90a3\u4e48\u9488\u5bf9\u8fd9\u79cd\u57fa\u4e8e MQ \u7684\u5f02\u6b65\u8c03\u7528\uff0c\u5982\u4f55\u4fdd\u8bc1\u5404\u4e2a\u670d\u52a1\u95f4\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u5462\uff1f\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u5e0c\u671b\u7684\u662f\u57fa\u4e8e MQ \u5b9e\u73b0\u5f02\u6b65\u8c03\u7528\u7684\u591a\u4e2a\u670d\u52a1\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u8981\u4e48\u4e00\u8d77\u6210\u529f\uff0c\u8981\u4e48\u4e00\u8d77\u5931\u8d25\u3002 \u8fd9\u4e2a\u65f6\u5019\uff0c\u5c31\u8981\u7528\u4e0a\u53ef\u9760\u6d88\u606f\u6700\u7ec8\u4e00\u81f4\u6027\u65b9\u6848\uff0c\u6765\u5b9e\u73b0\u5206\u5e03\u5f0f\u4e8b\u52a1\u3002 \u6d88\u606f\u6d88\u8d39\u5e42\u7b49\u6027 \u8ba2\u5355\u7cfb\u7edf\uff0c\u67e5\u8be2\u4e00\u4e0b\u6570\u636e\u5e93\u4e2d\u6709\u6ca1\u6709id \u8f6c\u8d26\uff1a\u67e5\u8be2\u4e00\u4e0b\u5168\u5c40\u6d41\u6c34ID \u5982\u679c\u6ca1\u6709ID\uff0c\u91c7\u7528\u4e50\u89c2\u9501 update xxx set data = data - 10,set version = version + 1 where version = 1","title":"09-\u6d88\u606f\u6700\u7ec8\u4e00\u81f4\u6027  03:42"},{"location":"hmtt/day04/#10-seataat_0648","text":"Seata \u662f\u4e00\u6b3e\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u89e3\u51b3\u65b9\u6848\uff0c\u81f4\u529b\u4e8e\u63d0\u4f9b\u9ad8\u6027\u80fd\u548c\u7b80\u5355\u6613\u7528\u7684\u5206\u5e03\u5f0f\u4e8b\u52a1\u670d\u52a1\u3002Seata \u5c06\u4e3a\u7528\u6237\u63d0\u4f9b\u4e86 AT\u3001TCC\u3001SAGA \u548c XA \u4e8b\u52a1\u6a21\u5f0f\uff0c\u4e3a\u7528\u6237\u6253\u9020\u4e00\u7ad9\u5f0f\u7684\u5206\u5e03\u5f0f\u89e3\u51b3\u65b9\u6848\u3002 \u9ed8\u8ba4 \u5373\u662fAT \u6a21\u5f0f ,AT\u672c\u8d28\u4e0a\u662f2pc\u534f\u8bae\u7684\u4e00\u79cd\u5b9e\u73b0","title":"10-seata\u4ecb\u7ecd\u548cAT\u6a21\u5f0f\u4ecb\u7ecd 06:48"},{"location":"hmtt/day04/#11-seata_server_0456","text":"\u5b89\u88c5\u6b65\u9aa4\uff1a 1.\u89e3\u538bseata-server-1.3.0.zip 2.\u5c06\u8d44\u6599\u4e2dfile\u76ee\u5f55\u4e0b\u7684\u4e24\u4e2a\u6587\u4ef6\uff0c\u62f7\u8d1d\u5230seata-server-1.3.0\\seata\\conf\u76ee\u5f55\u4e0b\uff0c\u8986\u76d6\u6389\u539f\u6765\u7684\u4e24\u4e2a\u6587\u4ef6 \u89c6\u9891\u4e2d\u63d0\u5230\u7684db\u6a21\u5f0f\u4fee\u6539\u4e3afile\u6a21\u5f0f\uff0c\u5df2\u7ecf\u4fee\u6539 3.\u53cc\u51fb\u542f\u52a8seata-server-1.3.0\\seata\\bin\\seata-server.bat","title":"11-seata_server\u5b89\u88c5 04:56"},{"location":"hmtt/day04/#12-seata_1247","text":"1.\u5206\u522b\u5728leadnews_article\u3001leadnews_user\u3001leadnews_wemedia\u4e09\u4e2a\u5e93\u4e2d\u90fd\u521b\u5efaundo_log\u8868(\u5df2\u505a) 2.\u5b8c\u6210heima-leadnews-seata\u9879\u76ee\u7684\u642d\u5efa package com.heima.seata.config ; import com.alibaba.druid.pool.DruidDataSource ; import com.baomidou.mybatisplus.autoconfigure.MybatisPlusProperties ; import com.baomidou.mybatisplus.core.MybatisConfiguration ; import com.baomidou.mybatisplus.extension.spring.MybatisSqlSessionFactoryBean ; import io.seata.rm.datasource.DataSourceProxy ; import org.mybatis.spring.transaction.SpringManagedTransactionFactory ; import org.springframework.boot.context.properties.ConfigurationProperties ; import org.springframework.boot.context.properties.EnableConfigurationProperties ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; import org.springframework.context.annotation.Primary ; import org.springframework.core.io.support.PathMatchingResourcePatternResolver ; import javax.sql.DataSource ; @Configuration @EnableConfigurationProperties ({ MybatisPlusProperties . class }) public class DataSourcesProxyConfig { @Bean @ConfigurationProperties ( prefix = \"spring.datasource\" ) public DataSource druidDataSource () { return new DruidDataSource (); } //\u521b\u5efa\u4ee3\u7406\u6570\u636e\u6e90 @Primary //@Primary\u6807\u8bc6\u5fc5\u987b\u914d\u7f6e\u5728\u4ee3\u7801\u6570\u636e\u6e90\u4e0a\uff0c\u5426\u5219\u672c\u5730\u4e8b\u52a1\u5931\u6548 @Bean public DataSourceProxy dataSourceProxy ( DataSource druidDataSource ) { return new DataSourceProxy ( druidDataSource ); } private MybatisPlusProperties properties ; public DataSourcesProxyConfig ( MybatisPlusProperties properties ) { this . properties = properties ; } //\u66ff\u6362SqlSessionFactory\u7684DataSource @Bean public MybatisSqlSessionFactoryBean sqlSessionFactory ( DataSourceProxy dataSourceProxy ) throws Exception { // \u8fd9\u91cc\u5fc5\u987b\u7528 MybatisSqlSessionFactoryBean \u4ee3\u66ff\u4e86 SqlSessionFactoryBean\uff0c\u5426\u5219 MyBatisPlus \u4e0d\u4f1a\u751f\u6548 MybatisSqlSessionFactoryBean mybatisSqlSessionFactoryBean = new MybatisSqlSessionFactoryBean (); mybatisSqlSessionFactoryBean . setDataSource ( dataSourceProxy ); mybatisSqlSessionFactoryBean . setTransactionFactory ( new SpringManagedTransactionFactory ()); mybatisSqlSessionFactoryBean . setMapperLocations ( new PathMatchingResourcePatternResolver () . getResources ( \"classpath*:/mapper/*.xml\" )); MybatisConfiguration configuration = this . properties . getConfiguration (); if ( configuration == null ){ configuration = new MybatisConfiguration (); } mybatisSqlSessionFactoryBean . setConfiguration ( configuration ); return mybatisSqlSessionFactoryBean ; } } \u6dfb\u52a0\u5206\u9875\u63d2\u4ef6: @Bean public MybatisSqlSessionFactoryBean sqlSessionFactory ( DataSourceProxy dataSourceProxy , PaginationInterceptor paginationInterceptor ) throws Exception { // \u8fd9\u91cc\u5fc5\u987b\u7528 MybatisSqlSessionFactoryBean \u4ee3\u66ff\u4e86 SqlSessionFactoryBean\uff0c\u5426\u5219 MyBatisPlus \u4e0d\u4f1a\u751f\u6548 MybatisSqlSessionFactoryBean mybatisSqlSessionFactoryBean = new MybatisSqlSessionFactoryBean (); mybatisSqlSessionFactoryBean . setDataSource ( dataSourceProxy ); mybatisSqlSessionFactoryBean . setTransactionFactory ( new SpringManagedTransactionFactory ()); mybatisSqlSessionFactoryBean . setMapperLocations ( new PathMatchingResourcePatternResolver () . getResources ( \"classpath*:/mapper/*.xml\" )); MybatisConfiguration configuration = this . properties . getConfiguration (); if ( configuration == null ){ configuration = new MybatisConfiguration (); } mybatisSqlSessionFactoryBean . setConfiguration ( configuration ); //\u6dfb\u52a0\u5206\u9875\u63d2\u4ef6 Interceptor [] interceptors = { paginationInterceptor }; mybatisSqlSessionFactoryBean . setPlugins ( interceptors ); return mybatisSqlSessionFactoryBean ; }","title":"12-\u9879\u76ee\u4e2d\u96c6\u6210seata 12:47"},{"location":"hmtt/day04/#_2","text":"\u5728Application\u4e0a\u6dfb\u52a0\uff1a @SpringBootApplication ( scanBasePackages = \"com.heima.wemedia\" , exclude = { DataSourceAutoConfiguration . class }) 3.\u5206\u522b\u5728heima-leadnews-article\u3001heima-leadnews-user\u3001heima-leadnews-wemedia\u5f15\u5165heima-leadnews-seata\u5de5\u7a0b\uff0c\u5e76\u4e14\u6dfb\u52a0\u4e00\u4e0b\u914d\u7f6e\u7c7b\uff1a @Configuration @ComponentScan ( \"com.heima.seata.config\" ) public class SeataConfig { } \u914d\u7f6eseata-server\u94fe\u63a5\u548c\u6ce8\u518c\u4e2d\u5fc3\u4fe1\u606f,\u8be6\u89c1\u8bb2\u4e49 \u5206\u522b\u5728heima-leadnews-article\u3001heima-leadnews-user\u3001heima-leadnews-wemedia\u5fae\u670d\u52a1\u7684application.yml\u6587\u4ef6\u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\uff1a yaml spring: cloud: alibaba: seata: tx-service-group: ${spring.application.name}_tx_group 6.\u5728ApUserRealnameServiceImpl\u7c7b\u7684updateStatusById\u65b9\u6cd5\u4e0a\u52a0\u4e0a @GlobalTransactional \u6ce8\u89e3","title":"\u6ce8\u610f\uff1a"},{"location":"hmtt/day04/#13-seata_0229","text":"\u521d\u59cb\u5316\u811a\u672cundo_log\u4e2d\u7f3a\u5c11\u5b57\u6bb5context\uff0c\u76ee\u524d\u5df2\u4fee\u590d\u3002 \u5b98\u65b9\u811a\u672c0.7.0+ \u589e\u52a0\u5b57\u6bb5 context 1.seata\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u4f1a\u51fa\u73b0\u5185\u5b58\u6cc4\u6f0f\uff08\u5173\u952e\u5b57Memory Leak\uff09\uff0c\u91cd\u542f\u5e94\u7528\u624d\u53ef\u4ee5\u89e3\u51b3 2.\u6d4b\u8bd5\u5b8cseata\u4e4b\u540e\u5c31\u628aseata\u529f\u80fd\u5173\u95ed\uff0c\u5e76\u8fd8\u539f\u6570\u636e\u6e90","title":"13-seata\u6d4b\u8bd5 02:29"},{"location":"hmtt/day04/#bug","text":"realname\u8868\u65e0\u6cd5\u56de\u6eda\uff0c\u539f\u56e0\u662ftinyint\u5bf9seata\u6765\u8bf4\u56de\u6eda\u65e5\u5fd7\u4fdd\u5b58\u6210\u4e86 true false \u5982\u679c\u4ece1->9 \u5bf9\u4e8eseata\u6765\u8bf4\u5176\u5b9e\u5c31\u662ftrue->true\uff0c\u8fd9\u6837\u662f\u65e0\u6cd5\u56de\u6eda\u7684 status tinyint(1) unsigned NULL \u72b6\u6001 0 \u521b\u5efa\u4e2d 1 \u5f85\u5ba1\u6838 2 \u5ba1\u6838\u5931\u8d25 9 \u5ba1\u6838\u901a\u8fc7 \u4fee\u590d\u65b9\u5f0f: tinyint(1) \u6539\u6210 tinyint(3)","title":"\u53ef\u80fd\u4f1a\u51fa\u73b0\u7684bug:"},{"location":"hmtt/day04/#seatafeign","text":"\u76ee\u524d\u8c03\u7528feign\u65f6\uff0c\u5982\u679c\u9047\u5230feign\u8c03\u7528\u5931\u8d25\uff0c\u662f\u4e0d\u4f1a\u8fdb\u884c\u56de\u6eda\u7684\uff0c\u4fee\u590d\u5982\u4e0b\uff1a ApUserRealnameServiceImpl\u7684createWmUserAndAuthor\u65b9\u6cd5\u4e2d\uff0c\u63a5\u6536save\u7684\u8fd4\u56de\u503c ResponseResult save = wemediaFeign . save ( wmUser ); if ( save . getCode () != 0 ){ throw new RuntimeException ( \"\u8c03\u7528\u8fdc\u7a0b\u63a5\u53e3\u5931\u8d25\" ); } \u5982\u679c\u8fd4\u56de\u4e0d\u6b63\u786e\uff0c\u629b\u51fa\u5f02\u5e38\u3002\u5176\u4ed6\u8fdc\u7a0b\u8c03\u7528\u63a5\u53e3\u7c7b\u4f3c\u5904\u7406\u3002","title":"\u6269\u5c55\uff1a\u4f18\u5316seata\u4e0efeign\u8fdc\u7a0b\u8c03\u7528\u7684\u4ee3\u7801"},{"location":"hmtt/day04/#seata","text":"1.\u53bb\u9664seata\u4f9d\u8d56 2.\u5728\u4ee3\u7801\u4e2d\u5c06GlobalTrasaction\u76f8\u5173\u4ee3\u7801\u6ce8\u91ca\u6389 3.\u6ce8\u91caSeataConfig 4.\u4fee\u6539\u542f\u52a8\u7c7b\uff0c\u628a@SpringBootApplication\u6ce8\u89e3\u8fd8\u539f \u5bf9\u5982\u4e0b\u51e0\u4e2a\u5fae\u670d\u52a1: user,wemedia,article","title":"\u5173\u95edseata\u7684\u65b9\u5f0f\uff1a"},{"location":"hmtt/day04/#14-fastdfs_0722","text":"FastDFS\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u8f7b\u91cf\u7ea7 \u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf \uff0c\u5b83\u5bf9\u6587\u4ef6\u8fdb\u884c\u7ba1\u7406\uff0c\u529f\u80fd\u5305\u62ec\uff1a\u6587\u4ef6\u5b58\u50a8\u3001\u6587\u4ef6\u540c\u6b65\u3001\u6587\u4ef6\u8bbf\u95ee\uff08\u6587\u4ef6\u4e0a\u4f20\u3001\u6587\u4ef6\u4e0b\u8f7d\uff09\u7b49\uff0c\u89e3\u51b3\u4e86\u5927\u5bb9\u91cf\u5b58\u50a8\u548c\u8d1f\u8f7d\u5747\u8861\u7684\u95ee\u9898\u3002\u7279\u522b\u9002\u5408\u4ee5\u6587\u4ef6\u4e3a\u8f7d\u4f53\u7684\u5728\u7ebf\u670d\u52a1\uff0c\u5982\u76f8\u518c\u7f51\u7ad9\u3001\u89c6\u9891\u7f51\u7ad9\u7b49\u7b49\u3002 \u5ba2\u6237\u7aef\u4e0a\u4f20\u6587\u4ef6\u540e\u5b58\u50a8\u670d\u52a1\u5668\u5c06\u6587\u4ef6 ID \u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u6b64\u6587\u4ef6 ID \u7528\u4e8e\u4ee5\u540e\u8bbf\u95ee\u8be5\u6587\u4ef6\u7684\u7d22\u5f15\u4fe1\u606f\u3002\u6587\u4ef6\u7d22\u5f15\u4fe1\u606f\u5305\u62ec\uff1a\u7ec4\u540d\uff0c\u865a\u62df\u78c1\u76d8\u8def\u5f84\uff0c\u6570\u636e\u4e24\u7ea7\u76ee\u5f55\uff0c\u6587\u4ef6\u540d\u3002 \u7ec4\u540d \uff1a\u6587\u4ef6\u4e0a\u4f20\u540e\u6240\u5728\u7684 storage \u7ec4\u540d\u79f0\uff0c\u5728\u6587\u4ef6\u4e0a\u4f20\u6210\u529f\u540e\u6709storage \u670d\u52a1\u5668\u8fd4\u56de\uff0c\u9700\u8981\u5ba2\u6237\u7aef\u81ea\u884c\u4fdd\u5b58\u3002 \u865a\u62df\u78c1\u76d8\u8def\u5f84 \uff1astorage \u914d\u7f6e\u7684\u865a\u62df\u8def\u5f84\uff0c\u4e0e\u78c1\u76d8\u9009\u9879store_path*\u5bf9\u5e94\u3002\u5982\u679c\u914d\u7f6e\u4e86 store_path0 \u5219\u662f M00\uff0c\u5982\u679c\u914d\u7f6e\u4e86 store_path1 \u5219\u662f M01\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002 \u6570\u636e\u4e24\u7ea7\u76ee\u5f55 \uff1astorage \u670d\u52a1\u5668\u5728\u6bcf\u4e2a\u865a\u62df\u78c1\u76d8\u8def\u5f84\u4e0b\u521b\u5efa\u7684\u4e24\u7ea7\u76ee\u5f55\uff0c\u7528\u4e8e\u5b58\u50a8\u6570\u636e\u6587\u4ef6\u3002 \u6587\u4ef6\u540d \uff1a\u4e0e\u6587\u4ef6\u4e0a\u4f20\u65f6\u4e0d\u540c\u3002\u662f\u7531\u5b58\u50a8\u670d\u52a1\u5668\u6839\u636e\u7279\u5b9a\u4fe1\u606f\u751f\u6210\uff0c\u6587\u4ef6\u540d\u5305\u542b\uff1a\u6e90\u5b58\u50a8 \u670d\u52a1\u5668 IP \u5730\u5740\u3001\u6587\u4ef6\u521b\u5efa\u65f6\u95f4\u6233\u3001\u6587\u4ef6\u5927\u5c0f\u3001\u968f\u673a\u6570\u548c\u6587\u4ef6\u62d3\u5c55\u540d\u7b49\u4fe1\u606f\u3002","title":"14-fastdfs\u4ecb\u7ecd 07:22"},{"location":"hmtt/day04/#15-fastdfs_0713","text":"\u8bb0\u5f97\u5c06IP\u5730\u5740\u6539\u6210\u81ea\u5df1\u865a\u62df\u673a\u7684IP\uff1a #\u62c9\u53d6\u955c\u50cf(\u865a\u62df\u673a\u4e2d\u5df2\u5b8c\u6210) docker pull delron/fastdfs #\u521b\u5efatracker\u5bb9\u5668 -t(\u4ea4\u4e92\u5f0f\u65b9\u5f0f\u542f\u52a8) -d\uff08\u5b88\u62a4\u5f0f\u542f\u52a8\uff09 docker run -d --network = host --name tracker -v /var/fdfs/tracker:/var/fdfs delron/fastdfs tracker #\u521b\u5efastorage\u5bb9\u5668 -e \u73af\u5883\u53d8\u91cf docker run -d --network = host --name storage -e TRACKER_SERVER = 192 .168.226.134:22122 -v /var/fdfs/storage:/var/fdfs -e GROUP_NAME = group1 delron/fastdfs storage \u5982\u679c\u4e0b\u6b21\u865a\u62df\u673a\u91cd\u542f\u4e4b\u540e\uff0c\u6267\u884c docker start tracker storage \u4ee5\u4e0b\u6b65\u9aa4\u53ef\u4ee5\u4e0d\u505a: #\u8fdb\u5165storage\u5bb9\u5668\uff0c\u5230storage\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6ehttp\u8bbf\u95ee\u7684\u7aef\u53e3\uff0c\u914d\u7f6e\u6587\u4ef6\u5728/etc/fdfs\u76ee\u5f55\u4e0b\u7684storage.conf\u3002 docker exec -it storage /bin/bash vi /usr/local/nginx/conf/nginx.conf #\u9ed8\u8ba4\u7684http\u7aef\u53e3\u4e3a8888\uff0c\u53ef\u4ee5\u4fee\u6539\u4e5f\u53ef\u4ee5\u914d\u7f6e # the port of the web server on this storage server http.server_port = 8888 #\u914d\u7f6enginx\uff0c\u5728/usr/local/nginx\u76ee\u5f55\u4e0b\uff0c\u4fee\u6539nginx.conf\u6587\u4ef6 #\u9ed8\u8ba4\u914d\u7f6e\u5982\u4e0b\uff1a server { listen 8888 ; server_name localhost ; location ~/group [ 0 -9 ] / { ngx_fastdfs_module ; } error_page 500 502 503 504 /50x.html ; location = /50x.html { root html ; } } #\u9ed8\u8ba4\u7684\u5b58\u50a8\u8def\u5f84\u4e3a/var/fdfs/data","title":"15-fastdfs\u5b89\u88c5 07:13"},{"location":"hmtt/day04/#16-fastdfs_0816","text":"#socket\u8fde\u63a5\u8d85\u65f6\u65f6\u957f fdfs.soTimeout=1500 #\u8fde\u63a5tracker\u670d\u52a1\u5668\u8d85\u65f6\u65f6\u957f fdfs.connectTimeout=600 fdfs.trackerList=192.168.226.134:22122 fileServerUrl=http://192.168.226.134:8888/ \u6ce8\u610f\u4e00\u4e0b\u8bbf\u95ee\u7aef\u53e3\u662f8888 tracker\u7684\u7aef\u53e3\u662f22122","title":"16-fastdfs\u73af\u5883\u642d\u5efa 08:16"},{"location":"hmtt/day04/#17-_1024","text":"\u4f7f\u7528\u8001\u5e08\u63d0\u4f9b\u7684postman\u63a5\u53e3\u6587\u4ef6\u8fdb\u884c\u6d4b\u8bd5 fastdfs\u5e95\u5c42\u4f7f\u7528nginx\u4f5c\u4e3a\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u5b58\u5728\u6d4f\u89c8\u5668\u7f13\u5b58\uff0c\u6d4b\u8bd5\u5220\u9664\u65f6\uff0c\u53ef\u4ee5\u5220\u9664\u4e00\u6b21\u4e4b\u540e\u518d\u6b21\u5220\u9664 CTRL+F5 \u5f3a\u5236\u5237\u65b0\u53ef\u4ee5\u6d4b\u8bd5 \u4e5f\u53ef\u4ee5\u89e3\u51b3\u7684 \u5728\u4f7f\u7528fastDFS\u505a\u6587\u4ef6\u7cfb\u7edf\u65f6\uff0c\u56fe\u7247\u6d4f\u89c8\u5668\u7f13\u5b58\u5f71\u54cd\u5220\u9664\u7ed3\u679c\u663e\u793a\u3002 \u89e3\u51b3\u529e\u6cd5\u5982\u4e0b: \u5728fastDFS\u7684\u5bb9\u5668\u4e2d\u7684nginx\u914d\u7f6e\u7981\u6b62\u6d4f\u89c8\u5668\u7f13\u5b58:","title":"17-\u4e0a\u4f20\u548c\u5220\u9664 10:24"},{"location":"hmtt/day04/#18-fastdfs_0348","text":"\uff081\uff09heima-leadnews-common\u6a21\u5757\u4e2d\u52a0\u5165\u4f9d\u8d56 <!--fastdfs--> <dependency> <groupId> com.github.tobato </groupId> <artifactId> fastdfs-client </artifactId> </dependency> \uff082\uff09heima-leadnews-common\u4e2d\u7684resources\u65b0\u5efa\u6587\u4ef6fast_dfs.properties #socket\u8fde\u63a5\u8d85\u65f6\u65f6\u957f fdfs.soTimeout = 1500 #\u8fde\u63a5tracker\u670d\u52a1\u5668\u8d85\u65f6\u65f6\u957f fdfs.connectTimeout = 600 fdfs.trackerList = 192.168.226.134:22122 \u4fee\u6539\u4e3a\u865a\u62df\u673a\u7684IP\u5730\u5740 \uff083\uff09heima-leadnews-common\u4e2d\u65b0\u5efa\u914d\u7f6e\u7c7b:com.heima.common.fastdfs.FdfsConfiguration @Configuration @Import ( FdfsClientConfig . class ) // \u5bfc\u5165FastDFS-Client\u7ec4\u4ef6 @PropertySource ( \"fast_dfs.properties\" ) public class FdfsConfiguration { } \u8fd9\u4e2a\u914d\u7f6e\u7c7b\u7684\u4f5c\u7528\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u5bfc\u5165\u5ba2\u6237\u7aef\u7a0b\u5e8f \uff084\uff09\u65b0\u5efafastdfs\u5ba2\u6237\u7aef\uff1acom.heima.common.fastdfs.FastDFSClient @Component public class FastDFSClient { @Autowired private FastFileStorageClient storageClient ; public String uploadFile ( MultipartFile file ) throws IOException { StorePath storePath = storageClient . uploadFile (( InputStream ) file . getInputStream (), file . getSize (), FilenameUtils . getExtension ( file . getOriginalFilename ()), null ); return storePath . getFullPath (); } public void delFile ( String filePath ) { storageClient . deleteFile ( filePath ); } /** * \u4e0b\u8f7d * @param groupName * @param path * @return */ public byte [] download ( String groupName , String path ) throws IOException { InputStream ins = storageClient . downloadFile ( groupName , path , new DownloadCallback < InputStream > () { @Override public InputStream recv ( InputStream ins ) throws IOException { // \u5c06\u6b64ins\u8fd4\u56de\u7ed9\u4e0a\u9762\u7684ins return ins ; } }); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream (); byte [] buff = new byte [ 100 ] ; int rc = 0 ; while (( rc = ins . read ( buff , 0 , 100 )) > 0 ) { byteArrayOutputStream . write ( buff , 0 , rc ); } return byteArrayOutputStream . toByteArray (); } } \uff085\uff09\u5728heima-leadnews-wemedia\u5fae\u670d\u52a1\u4e2d\u6dfb\u52a0\u914d\u7f6e \u2460\u6dfb\u52a0\u914d\u7f6e\u7c7b\uff0c\u5f15\u7528fastdfs package com.heima.wemedia.config ; import org.springframework.context.annotation.ComponentScan ; import org.springframework.context.annotation.Configuration ; @Configuration @ComponentScan ( \"com.heima.common.fastdfs\" ) public class FastDfsConfiguration { } \u4f7f\u7528\u914d\u7f6e\u7c7b\u626b\u63cf\u5230common\u5305\u4e2d\u7684fastdfs\u5bf9\u5e94\u7684\u914d\u7f6e\u7c7b\uff0c\u52a0\u8f7d\u5ba2\u6237\u7aef\u7a0b\u5e8f","title":"18-\u9879\u76ee\u4e2d\u96c6\u6210fastdfs 03:48"},{"location":"hmtt/day04/#19-_0217","text":"\u4e0a\u4f20\u56fe\u7247\u5230fastdfs\uff0c\u540c\u65f6\u8981\u4fdd\u5b58\u4e00\u4efd\u6570\u636e\u5230\u8868\u4e2d\uff0c\u65b9\u4fbf\u540e\u671f\u7ba1\u7406 \u5a92\u4f53\u56fe\u6587\u7d20\u6750\u4fe1\u606f\u8868wm_material","title":"19-\u7d20\u6750\u7ba1\u7406\u9700\u6c42\u5206\u6790 02:17"},{"location":"hmtt/day04/#20-_1516","text":"admin\u548c\u81ea\u5a92\u4f53\u662f\u4e24\u4e2a\u4e0d\u540c\u7684\u7cfb\u7edf\uff0c\u6240\u4ee5\u5206\u522b\u90fd\u9700\u8981\u6709\u4e00\u4e2a\u767b\u5f55\u529f\u80fd\u3002 \u4eceadmin\u62f7\u8d1d\u8fdb\u884c\u4fee\u6539\u5373\u53ef\u3002","title":"20-\u81ea\u5a92\u4f53\u767b\u5f55\u548c\u7f51\u5173\u5f00\u53d1 15:16"},{"location":"hmtt/day04/#21-_1100","text":"package com.heima.utils.threadlocal ; import com.heima.model.wemedia.pojos.WmUser ; public class WmThreadLocalUtils { private final static ThreadLocal < WmUser > USER_THREAD_LOCAL = new ThreadLocal <> (); /** * \u8bbe\u7f6e\u5f53\u524d\u7ebf\u7a0b\u4e2d\u7684\u7528\u6237 * @param wmUser */ public static void setUser ( WmUser wmUser ){ USER_THREAD_LOCAL . set ( wmUser ); } /** * \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u4e2d\u7684\u7528\u6237 * @return */ public static WmUser getUser (){ return USER_THREAD_LOCAL . get (); } } package com.heima.wemedia.filter ; import com.heima.model.wemedia.pojos.WmUser ; import com.heima.utils.threadlocal.WmThreadLocalUtils ; import lombok.extern.log4j.Log4j2 ; import org.springframework.core.annotation.Order ; import org.springframework.web.filter.GenericFilterBean ; import javax.servlet.FilterChain ; import javax.servlet.ServletException ; import javax.servlet.ServletRequest ; import javax.servlet.ServletResponse ; import javax.servlet.annotation.WebFilter ; import javax.servlet.http.HttpServletRequest ; import javax.servlet.http.HttpServletResponse ; import java.io.IOException ; @Order ( 1 ) @WebFilter ( filterName = \"wmTokenFilter\" , urlPatterns = \"/*\" ) @Log4j2 public class WmTokenFilter extends GenericFilterBean { @Override public void doFilter ( ServletRequest servletRequest , ServletResponse servletResponse , FilterChain filterChain ) throws IOException , ServletException { HttpServletRequest request = ( HttpServletRequest ) servletRequest ; //HttpServletResponse response = (HttpServletResponse) servletResponse; //\u5f97\u5230header\u4e2d\u7684\u4fe1\u606f String userId = request . getHeader ( \"userId\" ); if ( userId != null ){ WmUser wmUser = new WmUser (); wmUser . setId ( Integer . valueOf ( userId )); WmThreadLocalUtils . setUser ( wmUser ); } filterChain . doFilter ( request , response ); } } \u5728SpringBootApplication\u4e0a\u4f7f\u7528@ServletComponentScan\u6ce8\u89e3\u540e\uff0cServlet\u3001Filter\u3001Listener\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7@WebServlet\u3001@WebFilter\u3001@WebListener\u6ce8\u89e3\u81ea\u52a8\u6ce8\u518c\uff0c\u65e0\u9700\u5176\u4ed6\u4ee3\u7801\u3002 \u4f18\u5316:\u767b\u5f55\u8bf7\u6c42\u4e5f\u901a\u8fc7\u4e86\u8fc7\u6ee4\u5668\u7684\u903b\u8f91 package com.heima.wemedia.filter ; import com.heima.model.wemedia.pojos.WmUser ; import com.heima.utils.threadlocal.WmThreadLocalUtils ; import lombok.extern.log4j.Log4j2 ; import org.springframework.core.annotation.Order ; import org.springframework.web.filter.GenericFilterBean ; import javax.servlet.FilterChain ; import javax.servlet.ServletException ; import javax.servlet.ServletRequest ; import javax.servlet.ServletResponse ; import javax.servlet.annotation.WebFilter ; import javax.servlet.http.HttpServletRequest ; import javax.servlet.http.HttpServletResponse ; import java.io.IOException ; @Order ( 1 ) @WebFilter ( filterName = \"wmTokenFilter\" , urlPatterns = \"/*\" ) @Log4j2 public class WmTokenFilter extends GenericFilterBean { @Override public void doFilter ( ServletRequest servletRequest , ServletResponse servletResponse , FilterChain filterChain ) throws IOException , ServletException { HttpServletRequest request = ( HttpServletRequest ) servletRequest ; HttpServletResponse response = ( HttpServletResponse ) servletResponse ; if ( request . getRequestURI (). equals ( \"/login/in\" )){ //\u5982\u679c\u662f\u767b\u5f55\u63a5\u53e3\uff0c\u76f4\u63a5\u653e\u884c filterChain . doFilter ( request , response ); return ; } //\u5f97\u5230header\u4e2d\u7684\u4fe1\u606f String userId = request . getHeader ( \"userId\" ); if ( userId != null ){ WmUser wmUser = new WmUser (); wmUser . setId ( Integer . valueOf ( userId )); WmThreadLocalUtils . setUser ( wmUser ); } filterChain . doFilter ( request , response ); } }","title":"21-\u83b7\u53d6\u767b\u5f55\u7528\u6237  11:00"},{"location":"hmtt/day04/#22-_1357","text":"@Override public ResponseResult uploadPicture ( MultipartFile multipartFile ) { //1.\u68c0\u67e5\u53c2\u6570 if ( multipartFile == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u4e0a\u4f20\u56fe\u7247\u5230fasfdfs String fileId = null ; try { fileId = fastDFSClient . uploadFile ( multipartFile ); } catch ( IOException e ) { e . printStackTrace (); return ResponseResult . errorResult ( AppHttpCodeEnum . SERVER_ERROR ); } //3.\u4fdd\u5b58\u7d20\u6750\u6570\u636e\u5230\u8868\u4e2d wm_material //\u4ece\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u603b\u83b7\u53d6\u7528\u6237\u4fe1\u606f WmUser user = WmThreadLocalUtils . getUser (); WmMaterial wmMaterial = new WmMaterial (); wmMaterial . setUrl ( fileId ); //\u9ed8\u8ba4\u4e0d\u6536\u85cf wmMaterial . setIsCollection (( short ) 0 ); wmMaterial . setUserId ( user . getId ()); wmMaterial . setType (( short ) 0 ); wmMaterial . setCreatedTime ( new Date ()); save ( wmMaterial ); //\u62fc\u63a5\u56fe\u7247\u8def\u5f84\uff0cfileServerUrl\u4ece\u914d\u7f6e\u6587\u4ef6\u4e2d\u83b7\u53d6 wmMaterial . setUrl ( fileServerUrl + fileId ); return ResponseResult . okResult ( wmMaterial ); }","title":"22-\u56fe\u7247\u4e0a\u4f20 13:57"},{"location":"hmtt/day04/#23-_-0503","text":"\u4f7f\u7528\u63d0\u4f9b\u7684postman\u8fdb\u884c\u6d4b\u8bd5","title":"23-\u56fe\u7247\u4e0a\u4f20 \u6d4b\u8bd5 -05:03"},{"location":"hmtt/day04/#24-_1440","text":"@Override public ResponseResult findList ( WmMaterialDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 dto . checkParam (); //2.\u5e26\u6761\u4ef6\u5206\u9875\u67e5\u8be2 LambdaQueryWrapper < WmMaterial > lambdaQueryWrapper = new LambdaQueryWrapper <> (); //\u83b7\u53d6\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237 Integer uid = WmThreadLocalUtils . getUser (). getId (); lambdaQueryWrapper . eq ( WmMaterial :: getUserId , uid ); //\u662f\u5426\u6536\u85cf if ( dto . getIsCollection () != null && dto . getIsCollection (). shortValue () == 1 ){ lambdaQueryWrapper . eq ( WmMaterial :: getIsCollection , dto . getIsCollection ()); } //\u6309\u7167\u65e5\u671f\u5012\u5e8f\u6392\u5e8f lambdaQueryWrapper . orderByDesc ( WmMaterial :: getCreatedTime ); IPage pageParam = new Page ( dto . getPage (), dto . getSize ()); IPage resultPage = page ( pageParam , lambdaQueryWrapper ); //3.\u7ed3\u679c\u8fd4\u56de PageResponseResult responseResult = new PageResponseResult ( dto . getPage (), dto . getSize (),( int ) resultPage . getTotal ()); List < WmMaterial > datas = resultPage . getRecords (); //\u4e3a\u6bcf\u4e2a\u56fe\u7247\u52a0\u4e0a\u524d\u7f00 datas = datas . stream (). map ( item -> { item . setUrl ( fileServerUrl + item . getUrl ()); return item ; }). collect ( Collectors . toList ()); //for each responseResult . setData ( datas ); return responseResult ; }","title":"24-\u56fe\u7247\u5217\u8868\u67e5\u8be2 14:40"},{"location":"hmtt/day04/#25-_1440","text":"\u5982\u679c\u56fe\u7247\u88abwm_news_material\u8868\u5f15\u7528\uff0c\u5219\u4e0d\u80fd\u88ab\u5220\u9664 @Override public ResponseResult delPicture ( Integer id ) { //1.\u68c0\u67e5\u53c2\u6570 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u5224\u65ad\u5f53\u524d\u56fe\u7247\u662f\u5426\u95ee\u5f15\u7528 WmMaterial wmMaterial = getById ( id ); if ( wmMaterial == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } LambdaQueryWrapper < WmNewsMaterial > lambdaQueryWrapper = new LambdaQueryWrapper (); lambdaQueryWrapper . eq ( WmNewsMaterial :: getMaterialId , id ); Integer count = wmNewsMaterialMapper . selectCount ( lambdaQueryWrapper ); if ( count > 0 ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID , \"\u5f53\u524d\u56fe\u7247\u88ab\u5f15\u7528\" ); } //3.\u5220\u9664fastdfs\u4e2d\u7684\u56fe\u7247 String fileId = wmMaterial . getUrl (). replace ( fileServerUrl , \"\" ); try { fastDFSClient . delFile ( fileId ); } catch ( Exception e ){ e . printStackTrace (); return ResponseResult . errorResult ( AppHttpCodeEnum . SERVER_ERROR ); } //4.\u5220\u9664\u6570\u636e\u5e93\u4e2d\u7684\u56fe\u7247 removeById ( id ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); }","title":"25-\u56fe\u7247\u5220\u9664 14:40"},{"location":"hmtt/day04/#_3","text":"//1.6\u5224\u65ad\u7d20\u6750\u4e0a\u4f20\u7528\u6237\u662f\u5426\u662f\u672c\u7528\u6237.\u5982\u679c\u4e0d\u662f\u672c\u7528\u6237\uff0c\u5c31\u4e0d\u5141\u8bb8\u5220\u9664 if ( wmMaterial . getUserId () != WmThreadLocalUtils . getUser (). getId ()){ return ResponseResult . errorResult ( AppHttpCodeEnum . NO_OPERATOR_AUTH ); }","title":"\u62d3\u5c55\uff1a\u5f53\u524d\u767b\u5f55\u7528\u6237\uff0c\u53ea\u80fd\u5220\u9664\u81ea\u5df1\u4e0a\u4f20\u7684\u56fe\u7247"},{"location":"hmtt/day04/#26-_1154","text":"@Override public ResponseResult updateStatus ( Integer id , Short type ) { //1.\u68c0\u67e5\u53c2\u6570 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u66f4\u65b0\u72b6\u6001 //\u83b7\u53d6\u5f53\u524d\u7528\u6237\u4fe1\u606f Integer uid = WmThreadLocalUtils . getUser (). getId (); update ( Wrappers . < WmMaterial > lambdaUpdate (). set ( WmMaterial :: getIsCollection , type ) . eq ( WmMaterial :: getId , id ). eq ( WmMaterial :: getUserId , uid )); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); }","title":"26-\u6536\u85cf\u548c\u53d6\u6d88\u6536\u85cf 11:54"},{"location":"hmtt/day05/","text":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 00:56 \u00b6 \u5b8c\u6210\u81ea\u5a92\u4f53\u6587\u7ae0\u5217\u8868\u67e5\u8be2\u529f\u80fd \u5b8c\u6210\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u53d1\u5e03\u529f\u80fd \u5b8c\u6210\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u67e5\u8be2 \u5b8c\u6210\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u5220\u9664\u529f\u80fd \u5b8c\u6210\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u4e0a\u4e0b\u67b6\u529f\u80fd\u529f\u80fd 02-\u6587\u7ae0\u5217\u8868\u67e5\u8be2-\u9700\u6c42\u5206\u6790 07:08 \u00b6 wm_news \u81ea\u5a92\u4f53\u6587\u7ae0\u8868 03-\u63a5\u53e3\u5b9a\u4e49 05:26 \u00b6 package com.heima.api.wemedia ; import com.heima.model.common.dtos.ResponseResult ; /** * \u81ea\u5a92\u4f53\u6587\u7ae0\u63a5\u53e3 */ public interface WmNewsControllerApi { /** * \u5206\u9875\u5e26\u6761\u4ef6\u67e5\u8be2\u81ea\u5a92\u4f53\u6587\u7ae0\u5217\u8868 * @param wmNewsPageReqDto * @return */ public ResponseResult findAll ( WmNewsPageReqDto wmNewsPageReqDto ); } 04-\u529f\u80fd\u5b9e\u73b0 14:23 \u00b6 @Override public ResponseResult findAll ( WmNewsPageReqDto dto ) { //1.\u53c2\u6570\u68c0\u67e5 if ( dto == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //\u5206\u9875\u53c2\u6570\u68c0\u67e5 dto . checkParam (); //2.\u5206\u9875\u6761\u4ef6\u67e5\u8be2 IPage pageParam = new Page ( dto . getPage (), dto . getSize ()); LambdaQueryWrapper < WmNews > lambdaQueryWrapper = new LambdaQueryWrapper <> (); //\u72b6\u6001\u7cbe\u786e\u67e5\u8be2 if ( dto . getStatus () != null ) { lambdaQueryWrapper . eq ( WmNews :: getStatus , dto . getStatus ()); } //\u9891\u9053\u7cbe\u786e\u67e5\u8be2 if ( dto . getChannelId () != null ) { lambdaQueryWrapper . eq ( WmNews :: getChannelId , dto . getChannelId ()); } //\u5173\u952e\u5b57\u6a21\u7cca\u67e5\u8be2 if ( StringUtils . isNotBlank ( dto . getKeyword ())) { lambdaQueryWrapper . like ( WmNews :: getTitle , dto . getKeyword ()); } //\u65f6\u95f4\u8303\u56f4\u67e5\u8be2 pulish_time between #{beginPubDate} and #{endPubDate} if ( dto . getBeginPubDate () != null && dto . getEndPubDate () != null ) { lambdaQueryWrapper . between ( WmNews :: getPublishTime , dto . getBeginPubDate (), dto . getEndPubDate ()); } //\u6839\u636e\u81ea\u5a92\u4eba\u7cbe\u786e\u67e5\u8be2 WmUser user = WmThreadLocalUtils . getUser (); if ( user == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . NEED_LOGIN ); } //\u5f53\u524d\u767b\u5f55\u7528\u6237\uff0c\u53ea\u80fd\u67e5\u5230\u81ea\u5df1\u63d0\u4ea4\u7684\u6587\u7ae0 lambdaQueryWrapper . eq ( WmNews :: getUserId , user . getId ()); //\u6309\u7167\u53d1\u5e03\u65f6\u95f4\u5012\u5e8f\u67e5\u8be2 lambdaQueryWrapper . orderByDesc ( WmNews :: getPublishTime ); IPage pageResult = page ( pageParam , lambdaQueryWrapper ); //3.\u7ed3\u679c\u5c01\u88c5\u8fd4\u56de PageResponseResult responseResult = new PageResponseResult ( dto . getPage (), dto . getSize (), ( int ) pageResult . getTotal ()); responseResult . setData ( pageResult . getRecords ()); //\u8bbe\u7f6e\u56fe\u7247\u7684\u670d\u52a1\u5668\u8def\u5f84\uff0c\u524d\u7aef\u4f1a\u8d1f\u8d23\u5c06\u56fe\u7247\u7684\u6587\u4ef6\u8def\u5f84\u548c\u670d\u52a1\u5668\u8def\u5f84\u62fc\u5408 responseResult . setHost ( fileServerUrl ); return responseResult ; } 05-\u6d4b\u8bd5 05:29 \u00b6 node\u7248\u672c\u8fc7\u9ad8\u6267\u884c\u547d\u4ee4\uff1a npm rebuild node-sass 06-\u9891\u9053\u5217\u8868\u52a0\u8f7d 04:48 \u00b6 @GetMapping ( \"/channels\" ) @Override public ResponseResult findAll () { List < AdChannel > list = adChannelService . list (); return ResponseResult . okResult ( list ); } 07-\u6587\u7ae0\u53d1\u5e03\u3001\u4fee\u6539\u3001\u4fdd\u5b58\u8349\u7a3f \u9700\u6c42\u5206\u6790 07:17 \u00b6 wm_material \u7d20\u6750\u8868 wm_news_material \u6587\u7ae0\u7d20\u6750\u5173\u7cfb\u8868 \u9632\u6b62\u56fe\u7247\u88ab\u5220\u9664\uff0c1.\u5185\u5bb9\u5f15\u7528 2.\u5c01\u9762\u5f15\u7528 08-\u601d\u8def\u5206\u6790 09\uff1a21 \u00b6 \u8be5\u529f\u80fd\u4e3a\u4fdd\u5b58\u3001\u4fee\u6539\uff08\u662f\u5426\u6709id\uff09\u3001\u4fdd\u5b58\u8349\u7a3f\u7684\u5171\u6709\u65b9\u6cd5 \u5982\u679c\u6709id\u4fee\u6539\u6587\u7ae0\uff0c\u5148\u5220\u9664\u6240\u6709\u7d20\u6750\u5173\u8054\u5173\u7cfb 1 -> 1001,1002 1->1001,1002 \u5982\u679c\u6ca1\u6709id\uff0c\u4fdd\u5b58\u6587\u7ae0 \u5173\u8054\u5185\u5bb9\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb \u5173\u8054\u5c01\u9762\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb \u5c01\u9762\u56fe\u7247\u5982\u679c\u9009\u62e9\u662f\u81ea\u52a8\u9700\u8981\u4ece\u5185\u5bb9\u4e2d\u622a\u56fe\u56fe\u7247\u505a\u4e3a\u5c01\u9762\u56fe\u7247 \u622a\u53d6\u89c4\u5219\u4e3a\uff1a\u5185\u5bb9\u56fe\u7247\u7684\u4e2a\u6570\u5c0f\u4e8e\u7b49\u4e8e2 \u5219\u4e3a\u5355\u56fe\u622a\u56fe\u4e00\u5f20\u56fe\uff0c\u5185\u5bb9\u56fe\u7247\u5927\u4e8e\u7b49\u4e8e3\uff0c\u5219\u4e3a\u591a\u56fe\uff0c\u622a\u56fe\u4e09\u5f20\u56fe\uff0c\u5185\u5bb9\u4e2d\u6ca1\u6709\u56fe\u7247\uff0c\u5219\u4e3a\u65e0\u56fe \u63a5\u53e3\u8be6\u89c1\u63a5\u53e3\u6587\u6863 { \"title\" : \"\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u80cc\u666f\" , \"type\" : \"1\" , //\u8fd9\u4e2a 0 \u662f\u65e0\u56fe 1 \u662f\u5355\u56fe 3 \u662f\u591a\u56fe -1 \u662f\u81ea\u52a8 \"labels\" : \"\u9ed1\u9a6c\u5934\u6761\" , \"publishTime\" : \"2020-03-14T11:35:49.000Z\" , \"channelId\" : 1 , \"images\" :[ \"http://192.168.200.130/group1/M00/00/00/wKjIgl5swbGATaSAAAEPfZfx6Iw790.png\" ], \"status\" : 1 , \"content\" : \"[ { \" t ype \":\" te x t \", \" value \":\" \u968f\u7740\u667a\u80fd\u624b\u673a\u7684\u666e\u53ca\uff0c\u4eba\u4eec\u66f4\u52a0\u4e60\u60ef\u4e8e\u901a\u8fc7\u624b\u673a\u6765\u770b\u65b0\u95fb\u3002\u7531\u4e8e\u751f\u6d3b\u8282\u594f\u7684\u52a0\u5feb\uff0c\u5f88\u591a\u4eba\u53ea\u80fd\u5229\u7528\u788e\u7247\u65f6\u95f4\u6765\u83b7\u53d6\u4fe1\u606f\uff0c\u56e0\u6b64\uff0c\u5bf9\u4e8e\u79fb\u52a8\u8d44\u8baf\u5ba2\u6237\u7aef\u7684\u9700\u6c42\u4e5f\u8d8a\u6765\u8d8a\u9ad8\u3002\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u6b63\u662f\u5728\u8fd9\u6837\u80cc\u666f\u4e0b\u5f00\u53d1\u51fa\u6765\u3002\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u91c7\u7528\u5f53\u4e0b\u706b\u70ed\u7684\u5fae\u670d\u52a1+\u5927\u6570\u636e\u6280\u672f\u67b6\u6784\u5b9e\u73b0\u3002\u672c\u9879\u76ee\u4e3b\u8981\u7740\u624b\u4e8e\u83b7\u53d6\u6700\u65b0\u6700\u70ed\u65b0\u95fb\u8d44\u8baf\uff0c\u901a\u8fc7\u5927\u6570\u636e\u5206\u6790\u7528\u6237\u559c\u597d\u7cbe\u786e\u63a8\u9001\u54a8\u8be2\u65b0\u95fb \" }, { \" t ype \":\" image \", \" value \":\" h tt p : // 192.168.200.130 /group 1 /M 00 / 00 / 00 /wKjIgl 5 swbGATaSAAAEP f Z f x 6 Iw 790. p n g \" }, { \" t ype \":\" image \", \" value \":\" h tt p : // 192.168.200.130 /group 1 /M 00 / 00 / 00 /wKjIgl 5 swbGATaSAAAEP f Z f x 6 Iw 790. p n g \" } ]\" } package com.heima.model.media.dtos ; import lombok.Data ; import java.util.Date ; import java.util.List ; @Data public class WmNewsDto { private Integer id ; /** * \u6807\u9898 */ private String title ; /** * \u9891\u9053id */ private Integer channelId ; /** * \u6807\u7b7e */ private String labels ; /** * \u53d1\u5e03\u65f6\u95f4 */ private Date publishTime ; /** * \u6587\u7ae0\u5185\u5bb9 */ private String content ; /** * \u6587\u7ae0\u5c01\u9762\u7c7b\u578b 0 \u65e0\u56fe 1 \u5355\u56fe 3 \u591a\u56fe -1 \u81ea\u52a8 */ private Short type ; /** * \u662f\u5426\u4e0a\u67b6 0 \u4e0b\u67b6 1 \u4e0a\u67b6 */ private Short enable ; /** * \u63d0\u4ea4\u65f6\u95f4 */ private Date submitedTime ; /** * \u72b6\u6001 \u63d0\u4ea4\u4e3a1 \u8349\u7a3f\u4e3a0 */ private Short status ; /** * \u62d2\u7edd\u7406\u7531 */ private String reason ; /** * \u5c01\u9762\u56fe\u7247\u5217\u8868 \u591a\u5f20\u56fe\u4ee5\u9017\u53f7\u9694\u5f00 */ private List < String > images ; } 09-\u4fdd\u5b58\u6216\u4fee\u6539\u6587\u7ae0 18:24 \u00b6 public ResponseResult saveNews ( WmNewsDto dto , Short isSubmit ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || StringUtils . isBlank ( dto . getContent ())) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u4fdd\u5b58\u6216\u4fee\u6539\u6587\u7ae0 \u5982\u679cid\u4e0d\u4e3a\u7a7a\uff0c\u4fee\u6539 \u5982\u679cid\u4e3a\u7a7a\uff0c\u65b0\u589e WmNews wmNews = new WmNews (); BeanUtils . copyProperties ( dto , wmNews ); //\u5982\u679c\u524d\u7aef\u63d0\u4ea4\u7684\u662f\u81ea\u52a8\u7c7b\u578b\uff0c\u5148\u8bbe\u7f6e\u4e3anull,\u8ba9\u7a0b\u5e8f\u81ea\u52a8\u7b5b\u9009\u56fe\u7247 if ( WemediaContans . WM_NEWS_AUTO_TYPE . equals ( dto . getType ())) { wmNews . setType ( null ); } //\u5c01\u9762\u56fe\u7247 if ( dto . getImages () != null && dto . getImages (). size () > 0 ) { //[dfjksdjfdfj.jpg,sdlkjfskld.jpg] //dfjksdjfdfj.jpg,sdlkjfskld.jpg wmNews . setImages ( dto . getImages (). toString (). replace ( \"[\" , \"\" ) . replace ( \"]\" , \"\" ). replace ( fileServerUrl , \"\" ) . replace ( \" \" , \"\" )); } //\u4fdd\u5b58\u6216\u4fee\u6539\u6587\u7ae0 saveWmNews ( wmNews , isSubmit ); //3.\u5173\u8054\u6587\u7ae0\u4e0e\u7d20\u6750\u7684\u5173\u7cfb String content = dto . getContent (); List < Map > list = JSON . parseArray ( content , Map . class ); //\u5c06\u5185\u5bb9List -> \u56fe\u7247URL LIST List < String > materials = ectractUrlInfo ( list ); //3.1 \u5173\u8054\u5185\u5bb9\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb if ( isSubmit == WmNews . Status . SUBMIT . getCode () && materials . size () != 0 ) { ResponseResult responseResult = saveRelativeInfoForContent ( materials , wmNews . getId ()); if ( responseResult != null ) { return responseResult ; } } //3.2 \u5173\u8054\u5c01\u9762\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb,\u8bbe\u7f6ewm_news\u7684type,\u81ea\u52a8 if ( isSubmit == WmNews . Status . SUBMIT . getCode ()) { ResponseResult responseResult = saveRelativeInfoForCover ( dto , materials , wmNews ); if ( responseResult != null ) { return responseResult ; } } return null ; } \u5148\u5220\u9664\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb 10-\u5173\u8054\u6587\u7ae0\u4e0e\u7d20\u6750\u5173\u7cfb 06:57 \u00b6 //3.\u5173\u8054\u6587\u7ae0\u4e0e\u7d20\u6750\u7684\u5173\u7cfb String content = dto . getContent (); List < Map > list = JSON . parseArray ( content , Map . class ); List < String > materials = ectractUrlInfo ( list ); //[{},{}] -> List /** * \u63d0\u53d6\u56fe\u7247\u4fe1\u606f * * @param list * @return */ private List < String > ectractUrlInfo ( List < Map > list ) { List < String > materials = new ArrayList <> (); for ( Map map : list ) { //\u5224\u65ad\u662f\u5426\u7c7b\u578b\u4e3aimage\uff0c\u53ea\u6709\u4e3aimage\u7c7b\u578b\u7684\u624d\u662f\u56fe\u7247 if ( map . get ( \"type\" ). equals ( WemediaContans . WM_NEWS_TYPE_IMAGE )) { //\u83b7\u53d6value\u503c\uff0c\u5c31\u662f\u56fe\u7247\u7684\u5730\u5740 String imgUrl = ( String ) map . get ( \"value\" ); //\u5220\u9664\u56fe\u7247\u8def\u5f84\u4e2d\u670d\u52a1\u5668\u76f8\u5173\u7684\u4fe1\u606f //\"value\":\"http://192.168.200.130/group1/M00/00/00/wKjIgl5swbGATaSAAAEPfZfx6Iw790.png\" imgUrl = imgUrl . replace ( fileServerUrl , \"\" ); materials . add ( imgUrl ); } } return materials ; } 11-\u5173\u8054\u5185\u5bb9\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb(\u4e0d\u653e) 22:43 \u00b6 //3.1 \u5173\u8054\u5185\u5bb9\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb if ( isSubmit == WmNews . Status . SUBMIT . getCode () && materials . size () != 0 ) { ResponseResult responseResult = saveRelativeInfoForContent ( materials , wmNews . getId ()); if ( responseResult != null ) { return responseResult ; } } /** * \u4fdd\u5b58\u7d20\u6750\u4e0e\u6587\u7ae0\u5185\u5bb9\u7684\u5173\u7cfb * * @param materials * @param newsId * @return */ private ResponseResult saveRelativeInfoForContent ( List < String > materials , Integer newsId ) { return saveRelativeInfo ( materials , newsId , WemediaContans . WM_NEWS_CONTENT_REFERENCE ); } private ResponseResult saveRelativeInfo ( List < String > materials , Integer newsId , Short type ) { //1.\u83b7\u53d6\u6570\u636e\u5e93\u4e2d\u7684\u7d20\u6750\u4fe1\u606f //\u53c2\u65701\u4e3a\u7d20\u6750URL\uff0c\u4f46\u662f\u4fdd\u5b58\u5230\u6570\u636e\u5e93\u9700\u8981\u7d20\u6750\u7684ID\uff0c\u6240\u4ee5\u9700\u8981\u4ece\u6570\u636e\u5e93\u67e5\u8be2\u4e00\u6b21 LambdaQueryWrapper < WmMaterial > lambdaQueryWrapper = new LambdaQueryWrapper <> (); //\u7d20\u6750ID\u5c5e\u4e8e\u8303\u56f4 //select * from wm_material where url in ('a','b','c') and user_id = 1000 lambdaQueryWrapper . in ( WmMaterial :: getUrl , materials ); //\u7d20\u6750\u7528\u6237ID\u7b49\u4e8e\u64cd\u4f5c\u7528\u6237ID lambdaQueryWrapper . eq ( WmMaterial :: getUserId , WmThreadLocalUtils . getUser (). getId ()); List < WmMaterial > dbMaterials = wmMaterialMapper . selectList ( lambdaQueryWrapper ); if ( dbMaterials . size () > 0 ){ List < String > mIds = new ArrayList <> (); //\u53d6\u5230\u7d20\u6750ID for ( WmMaterial dbMaterial : dbMaterials ) { mIds . add ( String . valueOf ( dbMaterial . getId ())); } //\u6279\u91cf\u6dfb\u52a0\u5230\u5173\u8054\u8868\u4e2d wmNewsMaterialMapper . saveRelations ( mIds , newsId , type ); } return null ; } 12-\u5173\u8054\u5c01\u9762\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb 15:53 \u00b6 //3.2 \u5173\u8054\u5c01\u9762\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb,\u8bbe\u7f6ewm_news\u7684type,\u81ea\u52a8 if ( isSubmit == WmNews . Status . SUBMIT . getCode ()) { ResponseResult responseResult = saveRelativeInfoForCover ( dto , materials , wmNews ); if ( responseResult != null ) { return responseResult ; } } /** * \u8bbe\u7f6e\u5c01\u9762\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb * * @param dto * @param materials * @param wmNews * @return */ private ResponseResult saveRelativeInfoForCover ( WmNewsDto dto , List < String > materials , WmNews wmNews ) { List < String > images = dto . getImages (); //\u81ea\u52a8\u5339\u914d\u5c01\u9762 if ( dto . getType (). equals ( WemediaContans . WM_NEWS_AUTO_TYPE )) { //\u5185\u5bb9\u4e2d\u7684\u56fe\u7247\u6570\u91cf\u5c0f\u4e8e\u7b49\u4e8e2 \u8bbe\u7f6e\u4e3a\u5355\u56fe //\u6587\u7ae0\u5e03\u5c40 0 \u65e0\u56fe\u6587\u7ae0 1 \u5355\u56fe\u6587\u7ae0 3 \u591a\u56fe\u6587\u7ae0 if ( materials . size () > 0 && materials . size () <= 2 ) { wmNews . setType ( WemediaContans . WM_NEWS_SINGLE_TYPE ); images = materials . stream (). limit ( 1 ). collect ( Collectors . toList ()); } else if ( materials . size () > 2 ) { //\u5982\u679c\u5185\u5bb9\u4e2d\u7684\u56fe\u7247\u5927\u4e8e2 \u5219\u8bbe\u7f6e\u4e3a\u591a\u56fe wmNews . setType ( WemediaContans . WM_NEWS_MANY_TYPE ); images = materials . stream (). limit ( 3 ). collect ( Collectors . toList ()); } else { //\u5185\u5bb9\u4e2d\u6ca1\u6709\u56fe\u7247\uff0c\u5219\u662f\u65e0\u56fe wmNews . setType ( WemediaContans . WM_NEWS_NONE_TYPE ); } //\u4fee\u6539\u6587\u7ae0\u4fe1\u606f if ( images != null && images . size () > 0 ) { wmNews . setImages ( images . toString (). replace ( \"[\" , \"\" ) . replace ( \"]\" , \"\" ). replace ( fileServerUrl , \"\" ) . replace ( \" \" , \"\" )); } updateById ( wmNews ); } //\u4fdd\u5b58\u5c01\u9762\u56fe\u7247\u7d20\u6750\u4e0e\u6587\u7ae0ID\u7684\u5173\u7cfb if ( images != null && images . size () > 0 ) { ResponseResult responseResult = saveRelativeInfoForImage ( images , wmNews . getId ()); if ( responseResult != null ) { return responseResult ; } } return null ; } /** * @param images * @param newsId * @return */ private ResponseResult saveRelativeInfoForImage ( List < String > images , Integer newsId ) { //\u6ca1\u6709\u592a\u5927\u610f\u4e49 List < String > materials = new ArrayList <> (); for ( String image : images ) { materials . add ( image . replace ( fileServerUrl , \"\" )); } return saveRelativeInfo ( materials , newsId , WemediaContans . WM_NEWS_COVER_REFERENCE ); } \u4f18\u5316service\u5199\u6cd5\uff1a \u00b6 package com.heima.wemedia.service.impl ; import com.alibaba.fastjson.JSON ; import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper ; import com.baomidou.mybatisplus.core.metadata.IPage ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.baomidou.mybatisplus.extension.plugins.pagination.Page ; import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl ; import com.heima.common.constans.wemedia.WemediaContans ; import com.heima.model.common.dtos.PageResponseResult ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.wemedia.dtos.WmNewsDto ; import com.heima.model.wemedia.dtos.WmNewsPageReqDto ; import com.heima.model.wemedia.pojos.WmMaterial ; import com.heima.model.wemedia.pojos.WmNews ; import com.heima.model.wemedia.pojos.WmNewsMaterial ; import com.heima.model.wemedia.pojos.WmUser ; import com.heima.utils.threadlocal.WmThreadLocalUtils ; import com.heima.wemedia.mapper.WmMaterialMapper ; import com.heima.wemedia.mapper.WmNewsMapper ; import com.heima.wemedia.mapper.WmNewsMaterialMapper ; import com.heima.wemedia.service.WmNewsService ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.BeanUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.stereotype.Service ; import java.util.ArrayList ; import java.util.Date ; import java.util.List ; import java.util.Map ; import java.util.stream.Collectors ; @Service public class WmNewsServiceImpl extends ServiceImpl < WmNewsMapper , WmNews > implements WmNewsService { @Value ( \"${fdfs.url}\" ) private String fileServerUrl ; @Override public ResponseResult findAll ( WmNewsPageReqDto dto ) { //1.\u53c2\u6570\u68c0\u67e5 if ( dto == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //\u5206\u9875\u53c2\u6570\u68c0\u67e5 dto . checkParam (); //2.\u5206\u9875\u6761\u4ef6\u67e5\u8be2 IPage pageParam = new Page ( dto . getPage (), dto . getSize ()); LambdaQueryWrapper < WmNews > lambdaQueryWrapper = new LambdaQueryWrapper <> (); //\u72b6\u6001\u7cbe\u786e\u67e5\u8be2 if ( dto . getStatus () != null ) { lambdaQueryWrapper . eq ( WmNews :: getStatus , dto . getStatus ()); } //\u9891\u9053\u7cbe\u786e\u67e5\u8be2 if ( dto . getChannelId () != null ) { lambdaQueryWrapper . eq ( WmNews :: getChannelId , dto . getChannelId ()); } //\u5173\u952e\u5b57\u6a21\u7cca\u67e5\u8be2 if ( StringUtils . isNotBlank ( dto . getKeyword ())) { lambdaQueryWrapper . like ( WmNews :: getTitle , dto . getKeyword ()); } //\u65f6\u95f4\u8303\u56f4\u67e5\u8be2 if ( dto . getBeginPubDate () != null && dto . getEndPubDate () != null ) { lambdaQueryWrapper . between ( WmNews :: getPublishTime , dto . getBeginPubDate (), dto . getEndPubDate ()); } //\u6839\u636e\u81ea\u5a92\u4eba\u7cbe\u786e\u67e5\u8be2 WmUser user = WmThreadLocalUtils . getUser (); if ( user == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . NEED_LOGIN ); } lambdaQueryWrapper . eq ( WmNews :: getUserId , user . getId ()); //\u6309\u7167\u53d1\u5e03\u65f6\u95f4\u5012\u5e8f\u67e5\u8be2 lambdaQueryWrapper . orderByDesc ( WmNews :: getPublishTime ); IPage pageResult = page ( pageParam , lambdaQueryWrapper ); //3.\u7ed3\u679c\u5c01\u88c5\u8fd4\u56de PageResponseResult responseResult = new PageResponseResult ( dto . getPage (), dto . getSize (), ( int ) pageResult . getTotal ()); responseResult . setData ( pageResult . getRecords ()); responseResult . setHost ( fileServerUrl ); return responseResult ; } @Override public ResponseResult saveNews ( WmNewsDto dto , Short isSubmit ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || StringUtils . isEmpty ( dto . getContent ())) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u4fdd\u5b58\u6216\u4fee\u6539\u6587\u7ae0 WmNews wmNews = new WmNews (); //\u590d\u5236\u6240\u6709\u7684\u5c5e\u6027\u503c\u4ecedto\u5230wmNews\uff0c\u5c5e\u6027\u540d\u4e00\u81f4\u5c31\u53ef\u4ee5\u8d4b\u503c BeanUtils . copyProperties ( dto , wmNews ); //3.\u5173\u8054\u6587\u7ae0\u4e0e\u7d20\u6750\u7684\u5173\u7cfb String content = dto . getContent (); // [{},{}] -> List<Map> List < Map > list = JSON . parseArray ( content , Map . class ); //\u5c06\u5185\u5bb9List -> \u56fe\u7247URL LIST List < String > materials = ectractUrlInfo ( list ); //\u5982\u679c\u524d\u7aef\u4f20\u9012\u8fc7\u6765\u4e3a-1\uff0c\u90a3\u4e48\u5c31\u662f\u81ea\u52a8\u9009\u62e9\u56fe\u7247 if ( WemediaContans . WM_NEWS_AUTO_TYPE . equals ( dto . getType ())) { //\u5b58\u653e\u5c01\u9762\u56fe\u7247 List < String > images = new ArrayList <> (); //\u5148\u8bbe\u7f6e\u4e3anull //\u5185\u5bb9\u4e2d\u7684\u56fe\u7247\u6570\u91cf\u5c0f\u4e8e\u7b49\u4e8e2 \u8bbe\u7f6e\u4e3a\u5355\u56fe //\u6587\u7ae0\u5e03\u5c40 0 \u65e0\u56fe\u6587\u7ae0 1 \u5355\u56fe\u6587\u7ae0 3 \u591a\u56fe\u6587\u7ae0 if ( materials . size () > 0 && materials . size () <= 2 ) { wmNews . setType ( WemediaContans . WM_NEWS_SINGLE_TYPE ); images = materials . stream (). limit ( 1 ). collect ( Collectors . toList ()); } else if ( materials . size () > 2 ) { //\u5982\u679c\u5185\u5bb9\u4e2d\u7684\u56fe\u7247\u5927\u4e8e2 \u5219\u8bbe\u7f6e\u4e3a\u591a\u56fe wmNews . setType ( WemediaContans . WM_NEWS_MANY_TYPE ); images = materials . stream (). limit ( 3 ). collect ( Collectors . toList ()); } else { //\u5185\u5bb9\u4e2d\u6ca1\u6709\u56fe\u7247\uff0c\u5219\u662f\u65e0\u56fe wmNews . setType ( WemediaContans . WM_NEWS_NONE_TYPE ); } dto . setImages ( images ); } //Image \u5b58\u653e\u5c01\u9762\u56fe\u7247\u5730\u5740 [http://192.168.226.134:8888:dfjksdjfdfj.jpg] //\u5b58\u653e\u5230\u6570\u636e\u5e93 dfjksdjfdfj.jpg //List<String> -> String if ( dto . getImages () != null && dto . getImages (). size () > 0 ) { //[http://192.168.226.134:8888:dfjksdjfdfj.jpg,http://192.168.226.134:8888:sdlkjfskld.jpg] // -> dfjksdjfdfj.jpg,sdlkjfskld.jpg wmNews . setImages ( dto . getImages (). toString (). replace ( \"[\" , \"\" ) . replace ( \"]\" , \"\" ). replace ( fileServerUrl , \"\" ) . replace ( \" \" , \"\" )); //dto.getImages().stream().collect(Collectors.joining(\",\")); } //\u4fdd\u5b58\u6216\u4fee\u6539\u6587\u7ae0 saveWmNews ( wmNews , isSubmit ); //3.1 \u5173\u8054\u5185\u5bb9\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb if ( isSubmit == WmNews . Status . SUBMIT . getCode () && materials . size () != 0 ) { ResponseResult responseResult = saveRelativeInfoForContent ( materials , wmNews . getId ()); if ( responseResult != null ) { return responseResult ; } } //3.2 \u5173\u8054\u5c01\u9762\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb,\u8bbe\u7f6ewm_news\u7684type,\u81ea\u52a8 if ( isSubmit == WmNews . Status . SUBMIT . getCode ()) { ResponseResult responseResult = saveRelativeInfoForCover ( dto , materials , wmNews ); if ( responseResult != null ) { return responseResult ; } } return null ; } /** * \u8bbe\u7f6e\u5c01\u9762\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb * * @param dto * @param materials * @param wmNews * @return */ private ResponseResult saveRelativeInfoForCover ( WmNewsDto dto , List < String > materials , WmNews wmNews ) { List < String > images = dto . getImages (); //\u4fdd\u5b58\u5c01\u9762\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb if ( images != null && images . size () > 0 ) { ResponseResult responseResult = saveRelativeInfoForImage ( images , wmNews . getId ()); if ( responseResult != null ) { return responseResult ; } } return null ; } /** * @param images * @param newsId * @return */ private ResponseResult saveRelativeInfoForImage ( List < String > images , Integer newsId ) { List < String > materials = new ArrayList <> (); for ( String image : images ) { materials . add ( image . replace ( fileServerUrl , \"\" )); } return saveRelativeInfo ( materials , newsId , WemediaContans . WM_NEWS_COVER_REFERENCE ); } /** * \u4fdd\u5b58\u7d20\u6750\u4e0e\u6587\u7ae0\u5185\u5bb9\u7684\u5173\u7cfb * * @param materials * @param newsId * @return */ private ResponseResult saveRelativeInfoForContent ( List < String > materials , Integer newsId ) { //\u5f15\u7528\u7c7b\u578b\uff1a0\u4e3a\u5185\u5bb9\u5f15\u7528 1\u4e3a\u4e3b\u56fe\u5f15\u7528 return saveRelativeInfo ( materials , newsId , WemediaContans . WM_NEWS_CONTENT_REFERENCE ); } @Autowired private WmMaterialMapper wmMaterialMapper ; /** * \u4fdd\u5b58\u5173\u7cfb * * @param materials * @param newsId * @param type * @return */ private ResponseResult saveRelativeInfo ( List < String > materials , Integer newsId , Short type ) { //1.\u83b7\u53d6\u6570\u636e\u5e93\u4e2d\u7684\u7d20\u6750\u4fe1\u606f //\u53c2\u65701\u4e3a\u7d20\u6750URL\uff0c\u4f46\u662f\u4fdd\u5b58\u5230\u6570\u636e\u5e93\u9700\u8981\u7d20\u6750\u7684ID\uff0c\u6240\u4ee5\u9700\u8981\u4ece\u6570\u636e\u5e93\u67e5\u8be2\u4e00\u6b21 LambdaQueryWrapper < WmMaterial > lambdaQueryWrapper = new LambdaQueryWrapper <> (); //\u7d20\u6750ID\u5c5e\u4e8e\u8303\u56f4 //select * from wm_material where url in ('a','b','c') and user_id = 1000 lambdaQueryWrapper . in ( WmMaterial :: getUrl , materials ); //\u7d20\u6750\u7528\u6237ID\u7b49\u4e8e\u64cd\u4f5c\u7528\u6237ID lambdaQueryWrapper . eq ( WmMaterial :: getUserId , WmThreadLocalUtils . getUser (). getId ()); List < WmMaterial > dbMaterials = wmMaterialMapper . selectList ( lambdaQueryWrapper ); if ( dbMaterials . size () > 0 ){ List < String > mIds = new ArrayList <> (); //\u53d6\u5230\u7d20\u6750ID for ( WmMaterial dbMaterial : dbMaterials ) { mIds . add ( String . valueOf ( dbMaterial . getId ())); } //\u6279\u91cf\u6dfb\u52a0\u5230\u5173\u8054\u8868\u4e2d wmNewsMaterialMapper . saveRelations ( mIds , newsId , type ); // List<WmNewsMaterial> datas = new ArrayList<>(); // short count = 1; // for (WmMaterial dbMaterial : dbMaterials) { // WmNewsMaterial wmNewsMaterial = new WmNewsMaterial(); // wmNewsMaterial.setMaterialId(dbMaterial.getId()); // wmNewsMaterial.setNewsId(newsId); // wmNewsMaterial.setType(type); // wmNewsMaterial.setOrd(count++); // datas.add(wmNewsMaterial); // } // saveBatch(datas); } return null ; } /** * \u63d0\u53d6\u56fe\u7247\u4fe1\u606f * * @param list * @return */ //[{type:text/image,value:http://localhost:8888:URL},{}] private List < String > ectractUrlInfo ( List < Map > list ) { List < String > materials = new ArrayList <> (); for ( Map map : list ) { //\u5224\u65ad\u662f\u5426\u7c7b\u578b\u4e3aimage\uff0c\u53ea\u6709\u4e3aimage\u7c7b\u578b\u7684\u624d\u662f\u56fe\u7247 if ( map . get ( \"type\" ). equals ( WemediaContans . WM_NEWS_TYPE_IMAGE )) { //\u83b7\u53d6value\u503c\uff0c\u5c31\u662f\u56fe\u7247\u7684\u5730\u5740 String imgUrl = ( String ) map . get ( \"value\" ); //\u5220\u9664\u56fe\u7247\u8def\u5f84\u4e2d\u670d\u52a1\u5668\u76f8\u5173\u7684\u4fe1\u606f //\"value\":\"http://192.168.200.130/group1/M00/00/00/wKjIgl5swbGATaSAAAEPfZfx6Iw790.png\" imgUrl = imgUrl . replace ( fileServerUrl , \"\" ); //\"/group1/M00/00/00/wKjIgl5swbGATaSAAAEPfZfx6Iw790.png\" materials . add ( imgUrl ); } } return materials ; } @Autowired private WmNewsMaterialMapper wmNewsMaterialMapper ; /** * \u4fdd\u5b58\u6216\u4fee\u6539\u6587\u7ae0 * * @param wmNews * @param isSubmit */ private void saveWmNews ( WmNews wmNews , Short isSubmit ) { //0\u8349\u7a3f 1\u5f85\u5ba1\u6838 wmNews . setStatus ( isSubmit ); //\u8bbe\u7f6euserId\u4e3a\u5f53\u524d\u767b\u5f55\u7528\u6237ID wmNews . setUserId ( WmThreadLocalUtils . getUser (). getId ()); //\u8bbe\u7f6e\u521b\u5efa\u65f6\u95f4 wmNews . setCreatedTime ( new Date ()); //\u8bbe\u7f6e\u63d0\u4ea4\u65f6\u95f4 wmNews . setSubmitedTime ( new Date ()); //1\u4ee3\u8868\u4e0a\u67b6 wmNews . setEnable (( short ) 1 ); //\u5904\u7406\u6dfb\u52a0\u6216\u8005\u4fee\u6539 if ( wmNews . getId () == null ) { save ( wmNews ); } else { //\u5982\u679c\u662f\u4fee\u6539\uff0c\u5219\u5148\u5220\u9664\u7d20\u6750\u4e0e\u6587\u7ae0\u7684\u5173\u7cfb LambdaQueryWrapper < WmNewsMaterial > queryWrapper = new LambdaQueryWrapper (); queryWrapper . eq ( WmNewsMaterial :: getNewsId , wmNews . getId ()); wmNewsMaterialMapper . delete ( queryWrapper ); updateById ( wmNews ); } } @Override public ResponseResult findWmNewsById ( Integer id ) { //1.\u53c2\u6570\u68c0\u67e5 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID , \"\u6587\u7ae0Id\u4e0d\u53ef\u7f3a\u5c11\" ); } //2.\u67e5\u8be2\u6570\u636e WmNews wmNews = getById ( id ); if ( wmNews == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u6587\u7ae0\u4e0d\u5b58\u5728\" ); } //3.\u7ed3\u679c\u8fd4\u56de ResponseResult responseResult = ResponseResult . okResult ( wmNews ); responseResult . setHost ( fileServerUrl ); return responseResult ; } @Override public ResponseResult delNews ( Integer id ) { //1.\u68c0\u67e5\u53c2\u6570 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID , \"\u6587\u7ae0Id\u4e0d\u53ef\u7f3a\u5c11\" ); } //2.\u83b7\u53d6\u6570\u636e WmNews wmNews = getById ( id ); if ( wmNews == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u6587\u7ae0\u4e0d\u5b58\u5728\" ); } //3.\u5224\u65ad\u5f53\u524d\u6587\u7ae0\u7684\u72b6\u6001 status==9 enable == 1 if ( wmNews . getStatus (). equals ( WmNews . Status . PUBLISHED . getCode ()) && wmNews . getEnable (). equals ( WemediaContans . WM_NEWS_ENABLE_UP )){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u6587\u7ae0\u5df2\u53d1\u5e03\uff0c\u4e0d\u80fd\u5220\u9664\" ); } //4.\u53bb\u9664\u7d20\u6750\u4e0e\u6587\u7ae0\u7684\u5173\u7cfb wmNewsMaterialMapper . delete ( Wrappers . < WmNewsMaterial > lambdaQuery (). eq ( WmNewsMaterial :: getNewsId , wmNews . getId ())); //5.\u5220\u9664\u6587\u7ae0 removeById ( wmNews . getId ()); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } @Override public ResponseResult downOrUp ( WmNewsDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || dto . getId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u6587\u7ae0 WmNews wmNews = getById ( dto . getId ()); if ( wmNews == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u6587\u7ae0\u4e0d\u5b58\u5728\" ); } //3.\u5224\u65ad\u6587\u7ae0\u662f\u5426\u53d1\u5e03 if ( ! wmNews . getStatus (). equals ( WmNews . Status . PUBLISHED . getCode ())){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u5f53\u524d\u6587\u7ae0\u4e0d\u662f\u53d1\u5e03\u72b6\u6001\uff0c\u4e0d\u80fd\u4e0a\u4e0b\u67b6\" ); } //4.\u4fee\u6539\u6587\u7ae0\u72b6\u6001\uff0c\u540c\u6b65\u5230app\u7aef\uff08\u540e\u671f\u505a\uff09TODO if ( dto . getEnable () != null && dto . getEnable () > - 1 && dto . getEnable () < 2 ){ update ( Wrappers . < WmNews > lambdaUpdate (). eq ( WmNews :: getId , dto . getId ()). set ( WmNews :: getEnable , dto . getEnable ())); } return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } public static void main ( String [] args ) { List < String > images = new ArrayList <> (); for ( int i = 0 ; i < 1000000 ; i ++ ) { images . add ( String . valueOf ( i )); } Long start = System . currentTimeMillis (); String replace = images . toString (). replace ( \"[\" , \"\" ) . replace ( \"]\" , \"\" ) . replace ( \" \" , \"\" ); System . out . println ( replace ); System . out . println ( System . currentTimeMillis () - start ); start = System . currentTimeMillis (); replace = images . stream (). collect ( Collectors . joining ( \",\" )); System . out . println ( replace ); System . out . println ( System . currentTimeMillis () - start ); } } 13-controller\u7f16\u5199 13:15 \u00b6 @PostMapping ( \"/submit\" ) @Override public ResponseResult submitNews ( @RequestBody WmNewsDto dto ) { if ( dto . getStatus () == WmNews . Status . SUBMIT . getCode ()){ //\u63d0\u4ea4 return wmNewsService . saveNews ( dto , WmNews . Status . SUBMIT . getCode ()); } else { //\u8349\u7a3f return wmNewsService . saveNews ( dto , WmNews . Status . NORMAL . getCode ()); } } 14-\u8be6\u60c5\u67e5\u8be2 07:00 \u00b6 @Override public ResponseResult findWmNewsById ( Integer id ) { //1.\u53c2\u6570\u68c0\u67e5 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID , \"\u6587\u7ae0Id\u4e0d\u53ef\u7f3a\u5c11\" ); } //2.\u67e5\u8be2\u6570\u636e WmNews wmNews = getById ( id ); if ( wmNews == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u6587\u7ae0\u4e0d\u5b58\u5728\" ); } //3.\u7ed3\u679c\u8fd4\u56de ResponseResult responseResult = ResponseResult . okResult ( wmNews ); responseResult . setHost ( fileServerUrl ); return responseResult ; } 15-\u5220\u9664 09:11 \u00b6 \u5f53\u6587\u7ae0\u72b6\u6001\u4e3a9(\u5df2\u53d1\u5e03)\u4e14\u5df2\u4e0a\u67b6\u5219\u4e0d\u80fd\u5220\u9664\u6587\u7ae0\uff0c\u4e0b\u67b6\u72b6\u6001\u53ef\u4ee5\u5220\u9664\uff0c\u5982\u679c\u662f\u5176\u4ed6\u72b6\u6001\u53ef\u4ee5\u5220\u9664 \u5220\u9664\u6587\u7ae0\u4e4b\u524d\u9700\u8981\u5148\u628a\u7d20\u6750\u4e0e\u6587\u7ae0\u7684\u5173\u7cfb\u5220\u9664\u6389 @Override public ResponseResult delNews ( Integer id ) { //1.\u68c0\u67e5\u53c2\u6570 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID , \"\u6587\u7ae0Id\u4e0d\u53ef\u7f3a\u5c11\" ); } //2.\u83b7\u53d6\u6570\u636e WmNews wmNews = getById ( id ); if ( wmNews == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u6587\u7ae0\u4e0d\u5b58\u5728\" ); } //3.\u5224\u65ad\u5f53\u524d\u6587\u7ae0\u7684\u72b6\u6001 status==9 enable == 1 if ( wmNews . getStatus (). equals ( WmNews . Status . PUBLISHED . getCode ()) && wmNews . getEnable (). equals ( WemediaContans . WM_NEWS_ENABLE_UP )){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u6587\u7ae0\u5df2\u53d1\u5e03\uff0c\u4e0d\u80fd\u5220\u9664\" ); } //4.\u53bb\u9664\u7d20\u6750\u4e0e\u6587\u7ae0\u7684\u5173\u7cfb wmNewsMaterialMapper . delete ( Wrappers . < WmNewsMaterial > lambdaQuery (). eq ( WmNewsMaterial :: getNewsId , wmNews . getId ())); //5.\u5220\u9664\u6587\u7ae0 removeById ( wmNews . getId ()); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } 16-\u4e0a\u67b6\u548c\u4e0b\u67b6 10:11 \u00b6 \u5f53\u524d\u5df2\u7ecf\u53d1\u5e03\uff08\u72b6\u6001\u4e3a9\uff09\u7684\u6587\u7ae0\u53ef\u4ee5\u4e0a\u67b6\uff08enable = 1\uff09\uff0c\u4e5f\u53ef\u4ee5\u4e0b\u67b6\uff08enable = 0\uff09 \u5728\u4e0a\u67b6\u548c\u4e0b\u67b6\u64cd\u4f5c\u7684\u540c\u65f6\uff0c\u9700\u8981\u540c\u6b65app\u7aef\u7684\u6587\u7ae0\u914d\u7f6e\u4fe1\u606f\uff0c\u6682\u65f6\u4e0d\u505a\uff0c\u540e\u671f\u8bb2\u5230\u5ba1\u6838\u6587\u7ae0\u7684\u65f6\u5019\u518d\u4f18\u5316 @Override public ResponseResult downOrUp ( WmNewsDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || dto . getId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u6587\u7ae0 WmNews wmNews = getById ( dto . getId ()); if ( wmNews == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u6587\u7ae0\u4e0d\u5b58\u5728\" ); } //3.\u5224\u65ad\u6587\u7ae0\u662f\u5426\u53d1\u5e03 \u5224\u65adstatus\u5982\u679c\u4e0d\u7b49\u4e8e9\uff0c\u8fd4\u56de\u9519\u8bef if ( ! wmNews . getStatus (). equals ( WmNews . Status . PUBLISHED . getCode ())){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u5f53\u524d\u6587\u7ae0\u4e0d\u662f\u53d1\u5e03\u72b6\u6001\uff0c\u4e0d\u80fd\u4e0a\u4e0b\u67b6\" ); } //4.\u4fee\u6539\u6587\u7ae0\u72b6\u6001\uff0c\u540c\u6b65\u5230app\u7aef\uff08\u540e\u671f\u505a\uff09TODO if ( dto . getEnable () != null && dto . getEnable () >= 0 && dto . getEnable () <= 1 ){ update ( Wrappers . < WmNews > lambdaUpdate (). eq ( WmNews :: getId , dto . getId ()). set ( WmNews :: getEnable , dto . getEnable ())); } return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); }","title":"day05"},{"location":"hmtt/day05/#01-_0056","text":"\u5b8c\u6210\u81ea\u5a92\u4f53\u6587\u7ae0\u5217\u8868\u67e5\u8be2\u529f\u80fd \u5b8c\u6210\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u53d1\u5e03\u529f\u80fd \u5b8c\u6210\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u67e5\u8be2 \u5b8c\u6210\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u5220\u9664\u529f\u80fd \u5b8c\u6210\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u4e0a\u4e0b\u67b6\u529f\u80fd\u529f\u80fd","title":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 00:56"},{"location":"hmtt/day05/#02--_0708","text":"wm_news \u81ea\u5a92\u4f53\u6587\u7ae0\u8868","title":"02-\u6587\u7ae0\u5217\u8868\u67e5\u8be2-\u9700\u6c42\u5206\u6790 07:08"},{"location":"hmtt/day05/#03-_0526","text":"package com.heima.api.wemedia ; import com.heima.model.common.dtos.ResponseResult ; /** * \u81ea\u5a92\u4f53\u6587\u7ae0\u63a5\u53e3 */ public interface WmNewsControllerApi { /** * \u5206\u9875\u5e26\u6761\u4ef6\u67e5\u8be2\u81ea\u5a92\u4f53\u6587\u7ae0\u5217\u8868 * @param wmNewsPageReqDto * @return */ public ResponseResult findAll ( WmNewsPageReqDto wmNewsPageReqDto ); }","title":"03-\u63a5\u53e3\u5b9a\u4e49 05:26"},{"location":"hmtt/day05/#04-_1423","text":"@Override public ResponseResult findAll ( WmNewsPageReqDto dto ) { //1.\u53c2\u6570\u68c0\u67e5 if ( dto == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //\u5206\u9875\u53c2\u6570\u68c0\u67e5 dto . checkParam (); //2.\u5206\u9875\u6761\u4ef6\u67e5\u8be2 IPage pageParam = new Page ( dto . getPage (), dto . getSize ()); LambdaQueryWrapper < WmNews > lambdaQueryWrapper = new LambdaQueryWrapper <> (); //\u72b6\u6001\u7cbe\u786e\u67e5\u8be2 if ( dto . getStatus () != null ) { lambdaQueryWrapper . eq ( WmNews :: getStatus , dto . getStatus ()); } //\u9891\u9053\u7cbe\u786e\u67e5\u8be2 if ( dto . getChannelId () != null ) { lambdaQueryWrapper . eq ( WmNews :: getChannelId , dto . getChannelId ()); } //\u5173\u952e\u5b57\u6a21\u7cca\u67e5\u8be2 if ( StringUtils . isNotBlank ( dto . getKeyword ())) { lambdaQueryWrapper . like ( WmNews :: getTitle , dto . getKeyword ()); } //\u65f6\u95f4\u8303\u56f4\u67e5\u8be2 pulish_time between #{beginPubDate} and #{endPubDate} if ( dto . getBeginPubDate () != null && dto . getEndPubDate () != null ) { lambdaQueryWrapper . between ( WmNews :: getPublishTime , dto . getBeginPubDate (), dto . getEndPubDate ()); } //\u6839\u636e\u81ea\u5a92\u4eba\u7cbe\u786e\u67e5\u8be2 WmUser user = WmThreadLocalUtils . getUser (); if ( user == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . NEED_LOGIN ); } //\u5f53\u524d\u767b\u5f55\u7528\u6237\uff0c\u53ea\u80fd\u67e5\u5230\u81ea\u5df1\u63d0\u4ea4\u7684\u6587\u7ae0 lambdaQueryWrapper . eq ( WmNews :: getUserId , user . getId ()); //\u6309\u7167\u53d1\u5e03\u65f6\u95f4\u5012\u5e8f\u67e5\u8be2 lambdaQueryWrapper . orderByDesc ( WmNews :: getPublishTime ); IPage pageResult = page ( pageParam , lambdaQueryWrapper ); //3.\u7ed3\u679c\u5c01\u88c5\u8fd4\u56de PageResponseResult responseResult = new PageResponseResult ( dto . getPage (), dto . getSize (), ( int ) pageResult . getTotal ()); responseResult . setData ( pageResult . getRecords ()); //\u8bbe\u7f6e\u56fe\u7247\u7684\u670d\u52a1\u5668\u8def\u5f84\uff0c\u524d\u7aef\u4f1a\u8d1f\u8d23\u5c06\u56fe\u7247\u7684\u6587\u4ef6\u8def\u5f84\u548c\u670d\u52a1\u5668\u8def\u5f84\u62fc\u5408 responseResult . setHost ( fileServerUrl ); return responseResult ; }","title":"04-\u529f\u80fd\u5b9e\u73b0 14:23"},{"location":"hmtt/day05/#05-_0529","text":"node\u7248\u672c\u8fc7\u9ad8\u6267\u884c\u547d\u4ee4\uff1a npm rebuild node-sass","title":"05-\u6d4b\u8bd5 05:29"},{"location":"hmtt/day05/#06-_0448","text":"@GetMapping ( \"/channels\" ) @Override public ResponseResult findAll () { List < AdChannel > list = adChannelService . list (); return ResponseResult . okResult ( list ); }","title":"06-\u9891\u9053\u5217\u8868\u52a0\u8f7d 04:48"},{"location":"hmtt/day05/#07-_0717","text":"wm_material \u7d20\u6750\u8868 wm_news_material \u6587\u7ae0\u7d20\u6750\u5173\u7cfb\u8868 \u9632\u6b62\u56fe\u7247\u88ab\u5220\u9664\uff0c1.\u5185\u5bb9\u5f15\u7528 2.\u5c01\u9762\u5f15\u7528","title":"07-\u6587\u7ae0\u53d1\u5e03\u3001\u4fee\u6539\u3001\u4fdd\u5b58\u8349\u7a3f \u9700\u6c42\u5206\u6790 07:17"},{"location":"hmtt/day05/#08-_0921","text":"\u8be5\u529f\u80fd\u4e3a\u4fdd\u5b58\u3001\u4fee\u6539\uff08\u662f\u5426\u6709id\uff09\u3001\u4fdd\u5b58\u8349\u7a3f\u7684\u5171\u6709\u65b9\u6cd5 \u5982\u679c\u6709id\u4fee\u6539\u6587\u7ae0\uff0c\u5148\u5220\u9664\u6240\u6709\u7d20\u6750\u5173\u8054\u5173\u7cfb 1 -> 1001,1002 1->1001,1002 \u5982\u679c\u6ca1\u6709id\uff0c\u4fdd\u5b58\u6587\u7ae0 \u5173\u8054\u5185\u5bb9\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb \u5173\u8054\u5c01\u9762\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb \u5c01\u9762\u56fe\u7247\u5982\u679c\u9009\u62e9\u662f\u81ea\u52a8\u9700\u8981\u4ece\u5185\u5bb9\u4e2d\u622a\u56fe\u56fe\u7247\u505a\u4e3a\u5c01\u9762\u56fe\u7247 \u622a\u53d6\u89c4\u5219\u4e3a\uff1a\u5185\u5bb9\u56fe\u7247\u7684\u4e2a\u6570\u5c0f\u4e8e\u7b49\u4e8e2 \u5219\u4e3a\u5355\u56fe\u622a\u56fe\u4e00\u5f20\u56fe\uff0c\u5185\u5bb9\u56fe\u7247\u5927\u4e8e\u7b49\u4e8e3\uff0c\u5219\u4e3a\u591a\u56fe\uff0c\u622a\u56fe\u4e09\u5f20\u56fe\uff0c\u5185\u5bb9\u4e2d\u6ca1\u6709\u56fe\u7247\uff0c\u5219\u4e3a\u65e0\u56fe \u63a5\u53e3\u8be6\u89c1\u63a5\u53e3\u6587\u6863 { \"title\" : \"\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u80cc\u666f\" , \"type\" : \"1\" , //\u8fd9\u4e2a 0 \u662f\u65e0\u56fe 1 \u662f\u5355\u56fe 3 \u662f\u591a\u56fe -1 \u662f\u81ea\u52a8 \"labels\" : \"\u9ed1\u9a6c\u5934\u6761\" , \"publishTime\" : \"2020-03-14T11:35:49.000Z\" , \"channelId\" : 1 , \"images\" :[ \"http://192.168.200.130/group1/M00/00/00/wKjIgl5swbGATaSAAAEPfZfx6Iw790.png\" ], \"status\" : 1 , \"content\" : \"[ { \" t ype \":\" te x t \", \" value \":\" \u968f\u7740\u667a\u80fd\u624b\u673a\u7684\u666e\u53ca\uff0c\u4eba\u4eec\u66f4\u52a0\u4e60\u60ef\u4e8e\u901a\u8fc7\u624b\u673a\u6765\u770b\u65b0\u95fb\u3002\u7531\u4e8e\u751f\u6d3b\u8282\u594f\u7684\u52a0\u5feb\uff0c\u5f88\u591a\u4eba\u53ea\u80fd\u5229\u7528\u788e\u7247\u65f6\u95f4\u6765\u83b7\u53d6\u4fe1\u606f\uff0c\u56e0\u6b64\uff0c\u5bf9\u4e8e\u79fb\u52a8\u8d44\u8baf\u5ba2\u6237\u7aef\u7684\u9700\u6c42\u4e5f\u8d8a\u6765\u8d8a\u9ad8\u3002\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u6b63\u662f\u5728\u8fd9\u6837\u80cc\u666f\u4e0b\u5f00\u53d1\u51fa\u6765\u3002\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u91c7\u7528\u5f53\u4e0b\u706b\u70ed\u7684\u5fae\u670d\u52a1+\u5927\u6570\u636e\u6280\u672f\u67b6\u6784\u5b9e\u73b0\u3002\u672c\u9879\u76ee\u4e3b\u8981\u7740\u624b\u4e8e\u83b7\u53d6\u6700\u65b0\u6700\u70ed\u65b0\u95fb\u8d44\u8baf\uff0c\u901a\u8fc7\u5927\u6570\u636e\u5206\u6790\u7528\u6237\u559c\u597d\u7cbe\u786e\u63a8\u9001\u54a8\u8be2\u65b0\u95fb \" }, { \" t ype \":\" image \", \" value \":\" h tt p : // 192.168.200.130 /group 1 /M 00 / 00 / 00 /wKjIgl 5 swbGATaSAAAEP f Z f x 6 Iw 790. p n g \" }, { \" t ype \":\" image \", \" value \":\" h tt p : // 192.168.200.130 /group 1 /M 00 / 00 / 00 /wKjIgl 5 swbGATaSAAAEP f Z f x 6 Iw 790. p n g \" } ]\" } package com.heima.model.media.dtos ; import lombok.Data ; import java.util.Date ; import java.util.List ; @Data public class WmNewsDto { private Integer id ; /** * \u6807\u9898 */ private String title ; /** * \u9891\u9053id */ private Integer channelId ; /** * \u6807\u7b7e */ private String labels ; /** * \u53d1\u5e03\u65f6\u95f4 */ private Date publishTime ; /** * \u6587\u7ae0\u5185\u5bb9 */ private String content ; /** * \u6587\u7ae0\u5c01\u9762\u7c7b\u578b 0 \u65e0\u56fe 1 \u5355\u56fe 3 \u591a\u56fe -1 \u81ea\u52a8 */ private Short type ; /** * \u662f\u5426\u4e0a\u67b6 0 \u4e0b\u67b6 1 \u4e0a\u67b6 */ private Short enable ; /** * \u63d0\u4ea4\u65f6\u95f4 */ private Date submitedTime ; /** * \u72b6\u6001 \u63d0\u4ea4\u4e3a1 \u8349\u7a3f\u4e3a0 */ private Short status ; /** * \u62d2\u7edd\u7406\u7531 */ private String reason ; /** * \u5c01\u9762\u56fe\u7247\u5217\u8868 \u591a\u5f20\u56fe\u4ee5\u9017\u53f7\u9694\u5f00 */ private List < String > images ; }","title":"08-\u601d\u8def\u5206\u6790 09\uff1a21"},{"location":"hmtt/day05/#09-_1824","text":"public ResponseResult saveNews ( WmNewsDto dto , Short isSubmit ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || StringUtils . isBlank ( dto . getContent ())) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u4fdd\u5b58\u6216\u4fee\u6539\u6587\u7ae0 \u5982\u679cid\u4e0d\u4e3a\u7a7a\uff0c\u4fee\u6539 \u5982\u679cid\u4e3a\u7a7a\uff0c\u65b0\u589e WmNews wmNews = new WmNews (); BeanUtils . copyProperties ( dto , wmNews ); //\u5982\u679c\u524d\u7aef\u63d0\u4ea4\u7684\u662f\u81ea\u52a8\u7c7b\u578b\uff0c\u5148\u8bbe\u7f6e\u4e3anull,\u8ba9\u7a0b\u5e8f\u81ea\u52a8\u7b5b\u9009\u56fe\u7247 if ( WemediaContans . WM_NEWS_AUTO_TYPE . equals ( dto . getType ())) { wmNews . setType ( null ); } //\u5c01\u9762\u56fe\u7247 if ( dto . getImages () != null && dto . getImages (). size () > 0 ) { //[dfjksdjfdfj.jpg,sdlkjfskld.jpg] //dfjksdjfdfj.jpg,sdlkjfskld.jpg wmNews . setImages ( dto . getImages (). toString (). replace ( \"[\" , \"\" ) . replace ( \"]\" , \"\" ). replace ( fileServerUrl , \"\" ) . replace ( \" \" , \"\" )); } //\u4fdd\u5b58\u6216\u4fee\u6539\u6587\u7ae0 saveWmNews ( wmNews , isSubmit ); //3.\u5173\u8054\u6587\u7ae0\u4e0e\u7d20\u6750\u7684\u5173\u7cfb String content = dto . getContent (); List < Map > list = JSON . parseArray ( content , Map . class ); //\u5c06\u5185\u5bb9List -> \u56fe\u7247URL LIST List < String > materials = ectractUrlInfo ( list ); //3.1 \u5173\u8054\u5185\u5bb9\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb if ( isSubmit == WmNews . Status . SUBMIT . getCode () && materials . size () != 0 ) { ResponseResult responseResult = saveRelativeInfoForContent ( materials , wmNews . getId ()); if ( responseResult != null ) { return responseResult ; } } //3.2 \u5173\u8054\u5c01\u9762\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb,\u8bbe\u7f6ewm_news\u7684type,\u81ea\u52a8 if ( isSubmit == WmNews . Status . SUBMIT . getCode ()) { ResponseResult responseResult = saveRelativeInfoForCover ( dto , materials , wmNews ); if ( responseResult != null ) { return responseResult ; } } return null ; } \u5148\u5220\u9664\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb","title":"09-\u4fdd\u5b58\u6216\u4fee\u6539\u6587\u7ae0 18:24"},{"location":"hmtt/day05/#10-_0657","text":"//3.\u5173\u8054\u6587\u7ae0\u4e0e\u7d20\u6750\u7684\u5173\u7cfb String content = dto . getContent (); List < Map > list = JSON . parseArray ( content , Map . class ); List < String > materials = ectractUrlInfo ( list ); //[{},{}] -> List /** * \u63d0\u53d6\u56fe\u7247\u4fe1\u606f * * @param list * @return */ private List < String > ectractUrlInfo ( List < Map > list ) { List < String > materials = new ArrayList <> (); for ( Map map : list ) { //\u5224\u65ad\u662f\u5426\u7c7b\u578b\u4e3aimage\uff0c\u53ea\u6709\u4e3aimage\u7c7b\u578b\u7684\u624d\u662f\u56fe\u7247 if ( map . get ( \"type\" ). equals ( WemediaContans . WM_NEWS_TYPE_IMAGE )) { //\u83b7\u53d6value\u503c\uff0c\u5c31\u662f\u56fe\u7247\u7684\u5730\u5740 String imgUrl = ( String ) map . get ( \"value\" ); //\u5220\u9664\u56fe\u7247\u8def\u5f84\u4e2d\u670d\u52a1\u5668\u76f8\u5173\u7684\u4fe1\u606f //\"value\":\"http://192.168.200.130/group1/M00/00/00/wKjIgl5swbGATaSAAAEPfZfx6Iw790.png\" imgUrl = imgUrl . replace ( fileServerUrl , \"\" ); materials . add ( imgUrl ); } } return materials ; }","title":"10-\u5173\u8054\u6587\u7ae0\u4e0e\u7d20\u6750\u5173\u7cfb 06:57"},{"location":"hmtt/day05/#11-_2243","text":"//3.1 \u5173\u8054\u5185\u5bb9\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb if ( isSubmit == WmNews . Status . SUBMIT . getCode () && materials . size () != 0 ) { ResponseResult responseResult = saveRelativeInfoForContent ( materials , wmNews . getId ()); if ( responseResult != null ) { return responseResult ; } } /** * \u4fdd\u5b58\u7d20\u6750\u4e0e\u6587\u7ae0\u5185\u5bb9\u7684\u5173\u7cfb * * @param materials * @param newsId * @return */ private ResponseResult saveRelativeInfoForContent ( List < String > materials , Integer newsId ) { return saveRelativeInfo ( materials , newsId , WemediaContans . WM_NEWS_CONTENT_REFERENCE ); } private ResponseResult saveRelativeInfo ( List < String > materials , Integer newsId , Short type ) { //1.\u83b7\u53d6\u6570\u636e\u5e93\u4e2d\u7684\u7d20\u6750\u4fe1\u606f //\u53c2\u65701\u4e3a\u7d20\u6750URL\uff0c\u4f46\u662f\u4fdd\u5b58\u5230\u6570\u636e\u5e93\u9700\u8981\u7d20\u6750\u7684ID\uff0c\u6240\u4ee5\u9700\u8981\u4ece\u6570\u636e\u5e93\u67e5\u8be2\u4e00\u6b21 LambdaQueryWrapper < WmMaterial > lambdaQueryWrapper = new LambdaQueryWrapper <> (); //\u7d20\u6750ID\u5c5e\u4e8e\u8303\u56f4 //select * from wm_material where url in ('a','b','c') and user_id = 1000 lambdaQueryWrapper . in ( WmMaterial :: getUrl , materials ); //\u7d20\u6750\u7528\u6237ID\u7b49\u4e8e\u64cd\u4f5c\u7528\u6237ID lambdaQueryWrapper . eq ( WmMaterial :: getUserId , WmThreadLocalUtils . getUser (). getId ()); List < WmMaterial > dbMaterials = wmMaterialMapper . selectList ( lambdaQueryWrapper ); if ( dbMaterials . size () > 0 ){ List < String > mIds = new ArrayList <> (); //\u53d6\u5230\u7d20\u6750ID for ( WmMaterial dbMaterial : dbMaterials ) { mIds . add ( String . valueOf ( dbMaterial . getId ())); } //\u6279\u91cf\u6dfb\u52a0\u5230\u5173\u8054\u8868\u4e2d wmNewsMaterialMapper . saveRelations ( mIds , newsId , type ); } return null ; }","title":"11-\u5173\u8054\u5185\u5bb9\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb(\u4e0d\u653e) 22:43"},{"location":"hmtt/day05/#12-_1553","text":"//3.2 \u5173\u8054\u5c01\u9762\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb,\u8bbe\u7f6ewm_news\u7684type,\u81ea\u52a8 if ( isSubmit == WmNews . Status . SUBMIT . getCode ()) { ResponseResult responseResult = saveRelativeInfoForCover ( dto , materials , wmNews ); if ( responseResult != null ) { return responseResult ; } } /** * \u8bbe\u7f6e\u5c01\u9762\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb * * @param dto * @param materials * @param wmNews * @return */ private ResponseResult saveRelativeInfoForCover ( WmNewsDto dto , List < String > materials , WmNews wmNews ) { List < String > images = dto . getImages (); //\u81ea\u52a8\u5339\u914d\u5c01\u9762 if ( dto . getType (). equals ( WemediaContans . WM_NEWS_AUTO_TYPE )) { //\u5185\u5bb9\u4e2d\u7684\u56fe\u7247\u6570\u91cf\u5c0f\u4e8e\u7b49\u4e8e2 \u8bbe\u7f6e\u4e3a\u5355\u56fe //\u6587\u7ae0\u5e03\u5c40 0 \u65e0\u56fe\u6587\u7ae0 1 \u5355\u56fe\u6587\u7ae0 3 \u591a\u56fe\u6587\u7ae0 if ( materials . size () > 0 && materials . size () <= 2 ) { wmNews . setType ( WemediaContans . WM_NEWS_SINGLE_TYPE ); images = materials . stream (). limit ( 1 ). collect ( Collectors . toList ()); } else if ( materials . size () > 2 ) { //\u5982\u679c\u5185\u5bb9\u4e2d\u7684\u56fe\u7247\u5927\u4e8e2 \u5219\u8bbe\u7f6e\u4e3a\u591a\u56fe wmNews . setType ( WemediaContans . WM_NEWS_MANY_TYPE ); images = materials . stream (). limit ( 3 ). collect ( Collectors . toList ()); } else { //\u5185\u5bb9\u4e2d\u6ca1\u6709\u56fe\u7247\uff0c\u5219\u662f\u65e0\u56fe wmNews . setType ( WemediaContans . WM_NEWS_NONE_TYPE ); } //\u4fee\u6539\u6587\u7ae0\u4fe1\u606f if ( images != null && images . size () > 0 ) { wmNews . setImages ( images . toString (). replace ( \"[\" , \"\" ) . replace ( \"]\" , \"\" ). replace ( fileServerUrl , \"\" ) . replace ( \" \" , \"\" )); } updateById ( wmNews ); } //\u4fdd\u5b58\u5c01\u9762\u56fe\u7247\u7d20\u6750\u4e0e\u6587\u7ae0ID\u7684\u5173\u7cfb if ( images != null && images . size () > 0 ) { ResponseResult responseResult = saveRelativeInfoForImage ( images , wmNews . getId ()); if ( responseResult != null ) { return responseResult ; } } return null ; } /** * @param images * @param newsId * @return */ private ResponseResult saveRelativeInfoForImage ( List < String > images , Integer newsId ) { //\u6ca1\u6709\u592a\u5927\u610f\u4e49 List < String > materials = new ArrayList <> (); for ( String image : images ) { materials . add ( image . replace ( fileServerUrl , \"\" )); } return saveRelativeInfo ( materials , newsId , WemediaContans . WM_NEWS_COVER_REFERENCE ); }","title":"12-\u5173\u8054\u5c01\u9762\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb 15:53"},{"location":"hmtt/day05/#service","text":"package com.heima.wemedia.service.impl ; import com.alibaba.fastjson.JSON ; import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper ; import com.baomidou.mybatisplus.core.metadata.IPage ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.baomidou.mybatisplus.extension.plugins.pagination.Page ; import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl ; import com.heima.common.constans.wemedia.WemediaContans ; import com.heima.model.common.dtos.PageResponseResult ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.wemedia.dtos.WmNewsDto ; import com.heima.model.wemedia.dtos.WmNewsPageReqDto ; import com.heima.model.wemedia.pojos.WmMaterial ; import com.heima.model.wemedia.pojos.WmNews ; import com.heima.model.wemedia.pojos.WmNewsMaterial ; import com.heima.model.wemedia.pojos.WmUser ; import com.heima.utils.threadlocal.WmThreadLocalUtils ; import com.heima.wemedia.mapper.WmMaterialMapper ; import com.heima.wemedia.mapper.WmNewsMapper ; import com.heima.wemedia.mapper.WmNewsMaterialMapper ; import com.heima.wemedia.service.WmNewsService ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.BeanUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.stereotype.Service ; import java.util.ArrayList ; import java.util.Date ; import java.util.List ; import java.util.Map ; import java.util.stream.Collectors ; @Service public class WmNewsServiceImpl extends ServiceImpl < WmNewsMapper , WmNews > implements WmNewsService { @Value ( \"${fdfs.url}\" ) private String fileServerUrl ; @Override public ResponseResult findAll ( WmNewsPageReqDto dto ) { //1.\u53c2\u6570\u68c0\u67e5 if ( dto == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //\u5206\u9875\u53c2\u6570\u68c0\u67e5 dto . checkParam (); //2.\u5206\u9875\u6761\u4ef6\u67e5\u8be2 IPage pageParam = new Page ( dto . getPage (), dto . getSize ()); LambdaQueryWrapper < WmNews > lambdaQueryWrapper = new LambdaQueryWrapper <> (); //\u72b6\u6001\u7cbe\u786e\u67e5\u8be2 if ( dto . getStatus () != null ) { lambdaQueryWrapper . eq ( WmNews :: getStatus , dto . getStatus ()); } //\u9891\u9053\u7cbe\u786e\u67e5\u8be2 if ( dto . getChannelId () != null ) { lambdaQueryWrapper . eq ( WmNews :: getChannelId , dto . getChannelId ()); } //\u5173\u952e\u5b57\u6a21\u7cca\u67e5\u8be2 if ( StringUtils . isNotBlank ( dto . getKeyword ())) { lambdaQueryWrapper . like ( WmNews :: getTitle , dto . getKeyword ()); } //\u65f6\u95f4\u8303\u56f4\u67e5\u8be2 if ( dto . getBeginPubDate () != null && dto . getEndPubDate () != null ) { lambdaQueryWrapper . between ( WmNews :: getPublishTime , dto . getBeginPubDate (), dto . getEndPubDate ()); } //\u6839\u636e\u81ea\u5a92\u4eba\u7cbe\u786e\u67e5\u8be2 WmUser user = WmThreadLocalUtils . getUser (); if ( user == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . NEED_LOGIN ); } lambdaQueryWrapper . eq ( WmNews :: getUserId , user . getId ()); //\u6309\u7167\u53d1\u5e03\u65f6\u95f4\u5012\u5e8f\u67e5\u8be2 lambdaQueryWrapper . orderByDesc ( WmNews :: getPublishTime ); IPage pageResult = page ( pageParam , lambdaQueryWrapper ); //3.\u7ed3\u679c\u5c01\u88c5\u8fd4\u56de PageResponseResult responseResult = new PageResponseResult ( dto . getPage (), dto . getSize (), ( int ) pageResult . getTotal ()); responseResult . setData ( pageResult . getRecords ()); responseResult . setHost ( fileServerUrl ); return responseResult ; } @Override public ResponseResult saveNews ( WmNewsDto dto , Short isSubmit ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || StringUtils . isEmpty ( dto . getContent ())) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u4fdd\u5b58\u6216\u4fee\u6539\u6587\u7ae0 WmNews wmNews = new WmNews (); //\u590d\u5236\u6240\u6709\u7684\u5c5e\u6027\u503c\u4ecedto\u5230wmNews\uff0c\u5c5e\u6027\u540d\u4e00\u81f4\u5c31\u53ef\u4ee5\u8d4b\u503c BeanUtils . copyProperties ( dto , wmNews ); //3.\u5173\u8054\u6587\u7ae0\u4e0e\u7d20\u6750\u7684\u5173\u7cfb String content = dto . getContent (); // [{},{}] -> List<Map> List < Map > list = JSON . parseArray ( content , Map . class ); //\u5c06\u5185\u5bb9List -> \u56fe\u7247URL LIST List < String > materials = ectractUrlInfo ( list ); //\u5982\u679c\u524d\u7aef\u4f20\u9012\u8fc7\u6765\u4e3a-1\uff0c\u90a3\u4e48\u5c31\u662f\u81ea\u52a8\u9009\u62e9\u56fe\u7247 if ( WemediaContans . WM_NEWS_AUTO_TYPE . equals ( dto . getType ())) { //\u5b58\u653e\u5c01\u9762\u56fe\u7247 List < String > images = new ArrayList <> (); //\u5148\u8bbe\u7f6e\u4e3anull //\u5185\u5bb9\u4e2d\u7684\u56fe\u7247\u6570\u91cf\u5c0f\u4e8e\u7b49\u4e8e2 \u8bbe\u7f6e\u4e3a\u5355\u56fe //\u6587\u7ae0\u5e03\u5c40 0 \u65e0\u56fe\u6587\u7ae0 1 \u5355\u56fe\u6587\u7ae0 3 \u591a\u56fe\u6587\u7ae0 if ( materials . size () > 0 && materials . size () <= 2 ) { wmNews . setType ( WemediaContans . WM_NEWS_SINGLE_TYPE ); images = materials . stream (). limit ( 1 ). collect ( Collectors . toList ()); } else if ( materials . size () > 2 ) { //\u5982\u679c\u5185\u5bb9\u4e2d\u7684\u56fe\u7247\u5927\u4e8e2 \u5219\u8bbe\u7f6e\u4e3a\u591a\u56fe wmNews . setType ( WemediaContans . WM_NEWS_MANY_TYPE ); images = materials . stream (). limit ( 3 ). collect ( Collectors . toList ()); } else { //\u5185\u5bb9\u4e2d\u6ca1\u6709\u56fe\u7247\uff0c\u5219\u662f\u65e0\u56fe wmNews . setType ( WemediaContans . WM_NEWS_NONE_TYPE ); } dto . setImages ( images ); } //Image \u5b58\u653e\u5c01\u9762\u56fe\u7247\u5730\u5740 [http://192.168.226.134:8888:dfjksdjfdfj.jpg] //\u5b58\u653e\u5230\u6570\u636e\u5e93 dfjksdjfdfj.jpg //List<String> -> String if ( dto . getImages () != null && dto . getImages (). size () > 0 ) { //[http://192.168.226.134:8888:dfjksdjfdfj.jpg,http://192.168.226.134:8888:sdlkjfskld.jpg] // -> dfjksdjfdfj.jpg,sdlkjfskld.jpg wmNews . setImages ( dto . getImages (). toString (). replace ( \"[\" , \"\" ) . replace ( \"]\" , \"\" ). replace ( fileServerUrl , \"\" ) . replace ( \" \" , \"\" )); //dto.getImages().stream().collect(Collectors.joining(\",\")); } //\u4fdd\u5b58\u6216\u4fee\u6539\u6587\u7ae0 saveWmNews ( wmNews , isSubmit ); //3.1 \u5173\u8054\u5185\u5bb9\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb if ( isSubmit == WmNews . Status . SUBMIT . getCode () && materials . size () != 0 ) { ResponseResult responseResult = saveRelativeInfoForContent ( materials , wmNews . getId ()); if ( responseResult != null ) { return responseResult ; } } //3.2 \u5173\u8054\u5c01\u9762\u4e2d\u7684\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb,\u8bbe\u7f6ewm_news\u7684type,\u81ea\u52a8 if ( isSubmit == WmNews . Status . SUBMIT . getCode ()) { ResponseResult responseResult = saveRelativeInfoForCover ( dto , materials , wmNews ); if ( responseResult != null ) { return responseResult ; } } return null ; } /** * \u8bbe\u7f6e\u5c01\u9762\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb * * @param dto * @param materials * @param wmNews * @return */ private ResponseResult saveRelativeInfoForCover ( WmNewsDto dto , List < String > materials , WmNews wmNews ) { List < String > images = dto . getImages (); //\u4fdd\u5b58\u5c01\u9762\u56fe\u7247\u4e0e\u7d20\u6750\u7684\u5173\u7cfb if ( images != null && images . size () > 0 ) { ResponseResult responseResult = saveRelativeInfoForImage ( images , wmNews . getId ()); if ( responseResult != null ) { return responseResult ; } } return null ; } /** * @param images * @param newsId * @return */ private ResponseResult saveRelativeInfoForImage ( List < String > images , Integer newsId ) { List < String > materials = new ArrayList <> (); for ( String image : images ) { materials . add ( image . replace ( fileServerUrl , \"\" )); } return saveRelativeInfo ( materials , newsId , WemediaContans . WM_NEWS_COVER_REFERENCE ); } /** * \u4fdd\u5b58\u7d20\u6750\u4e0e\u6587\u7ae0\u5185\u5bb9\u7684\u5173\u7cfb * * @param materials * @param newsId * @return */ private ResponseResult saveRelativeInfoForContent ( List < String > materials , Integer newsId ) { //\u5f15\u7528\u7c7b\u578b\uff1a0\u4e3a\u5185\u5bb9\u5f15\u7528 1\u4e3a\u4e3b\u56fe\u5f15\u7528 return saveRelativeInfo ( materials , newsId , WemediaContans . WM_NEWS_CONTENT_REFERENCE ); } @Autowired private WmMaterialMapper wmMaterialMapper ; /** * \u4fdd\u5b58\u5173\u7cfb * * @param materials * @param newsId * @param type * @return */ private ResponseResult saveRelativeInfo ( List < String > materials , Integer newsId , Short type ) { //1.\u83b7\u53d6\u6570\u636e\u5e93\u4e2d\u7684\u7d20\u6750\u4fe1\u606f //\u53c2\u65701\u4e3a\u7d20\u6750URL\uff0c\u4f46\u662f\u4fdd\u5b58\u5230\u6570\u636e\u5e93\u9700\u8981\u7d20\u6750\u7684ID\uff0c\u6240\u4ee5\u9700\u8981\u4ece\u6570\u636e\u5e93\u67e5\u8be2\u4e00\u6b21 LambdaQueryWrapper < WmMaterial > lambdaQueryWrapper = new LambdaQueryWrapper <> (); //\u7d20\u6750ID\u5c5e\u4e8e\u8303\u56f4 //select * from wm_material where url in ('a','b','c') and user_id = 1000 lambdaQueryWrapper . in ( WmMaterial :: getUrl , materials ); //\u7d20\u6750\u7528\u6237ID\u7b49\u4e8e\u64cd\u4f5c\u7528\u6237ID lambdaQueryWrapper . eq ( WmMaterial :: getUserId , WmThreadLocalUtils . getUser (). getId ()); List < WmMaterial > dbMaterials = wmMaterialMapper . selectList ( lambdaQueryWrapper ); if ( dbMaterials . size () > 0 ){ List < String > mIds = new ArrayList <> (); //\u53d6\u5230\u7d20\u6750ID for ( WmMaterial dbMaterial : dbMaterials ) { mIds . add ( String . valueOf ( dbMaterial . getId ())); } //\u6279\u91cf\u6dfb\u52a0\u5230\u5173\u8054\u8868\u4e2d wmNewsMaterialMapper . saveRelations ( mIds , newsId , type ); // List<WmNewsMaterial> datas = new ArrayList<>(); // short count = 1; // for (WmMaterial dbMaterial : dbMaterials) { // WmNewsMaterial wmNewsMaterial = new WmNewsMaterial(); // wmNewsMaterial.setMaterialId(dbMaterial.getId()); // wmNewsMaterial.setNewsId(newsId); // wmNewsMaterial.setType(type); // wmNewsMaterial.setOrd(count++); // datas.add(wmNewsMaterial); // } // saveBatch(datas); } return null ; } /** * \u63d0\u53d6\u56fe\u7247\u4fe1\u606f * * @param list * @return */ //[{type:text/image,value:http://localhost:8888:URL},{}] private List < String > ectractUrlInfo ( List < Map > list ) { List < String > materials = new ArrayList <> (); for ( Map map : list ) { //\u5224\u65ad\u662f\u5426\u7c7b\u578b\u4e3aimage\uff0c\u53ea\u6709\u4e3aimage\u7c7b\u578b\u7684\u624d\u662f\u56fe\u7247 if ( map . get ( \"type\" ). equals ( WemediaContans . WM_NEWS_TYPE_IMAGE )) { //\u83b7\u53d6value\u503c\uff0c\u5c31\u662f\u56fe\u7247\u7684\u5730\u5740 String imgUrl = ( String ) map . get ( \"value\" ); //\u5220\u9664\u56fe\u7247\u8def\u5f84\u4e2d\u670d\u52a1\u5668\u76f8\u5173\u7684\u4fe1\u606f //\"value\":\"http://192.168.200.130/group1/M00/00/00/wKjIgl5swbGATaSAAAEPfZfx6Iw790.png\" imgUrl = imgUrl . replace ( fileServerUrl , \"\" ); //\"/group1/M00/00/00/wKjIgl5swbGATaSAAAEPfZfx6Iw790.png\" materials . add ( imgUrl ); } } return materials ; } @Autowired private WmNewsMaterialMapper wmNewsMaterialMapper ; /** * \u4fdd\u5b58\u6216\u4fee\u6539\u6587\u7ae0 * * @param wmNews * @param isSubmit */ private void saveWmNews ( WmNews wmNews , Short isSubmit ) { //0\u8349\u7a3f 1\u5f85\u5ba1\u6838 wmNews . setStatus ( isSubmit ); //\u8bbe\u7f6euserId\u4e3a\u5f53\u524d\u767b\u5f55\u7528\u6237ID wmNews . setUserId ( WmThreadLocalUtils . getUser (). getId ()); //\u8bbe\u7f6e\u521b\u5efa\u65f6\u95f4 wmNews . setCreatedTime ( new Date ()); //\u8bbe\u7f6e\u63d0\u4ea4\u65f6\u95f4 wmNews . setSubmitedTime ( new Date ()); //1\u4ee3\u8868\u4e0a\u67b6 wmNews . setEnable (( short ) 1 ); //\u5904\u7406\u6dfb\u52a0\u6216\u8005\u4fee\u6539 if ( wmNews . getId () == null ) { save ( wmNews ); } else { //\u5982\u679c\u662f\u4fee\u6539\uff0c\u5219\u5148\u5220\u9664\u7d20\u6750\u4e0e\u6587\u7ae0\u7684\u5173\u7cfb LambdaQueryWrapper < WmNewsMaterial > queryWrapper = new LambdaQueryWrapper (); queryWrapper . eq ( WmNewsMaterial :: getNewsId , wmNews . getId ()); wmNewsMaterialMapper . delete ( queryWrapper ); updateById ( wmNews ); } } @Override public ResponseResult findWmNewsById ( Integer id ) { //1.\u53c2\u6570\u68c0\u67e5 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID , \"\u6587\u7ae0Id\u4e0d\u53ef\u7f3a\u5c11\" ); } //2.\u67e5\u8be2\u6570\u636e WmNews wmNews = getById ( id ); if ( wmNews == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u6587\u7ae0\u4e0d\u5b58\u5728\" ); } //3.\u7ed3\u679c\u8fd4\u56de ResponseResult responseResult = ResponseResult . okResult ( wmNews ); responseResult . setHost ( fileServerUrl ); return responseResult ; } @Override public ResponseResult delNews ( Integer id ) { //1.\u68c0\u67e5\u53c2\u6570 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID , \"\u6587\u7ae0Id\u4e0d\u53ef\u7f3a\u5c11\" ); } //2.\u83b7\u53d6\u6570\u636e WmNews wmNews = getById ( id ); if ( wmNews == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u6587\u7ae0\u4e0d\u5b58\u5728\" ); } //3.\u5224\u65ad\u5f53\u524d\u6587\u7ae0\u7684\u72b6\u6001 status==9 enable == 1 if ( wmNews . getStatus (). equals ( WmNews . Status . PUBLISHED . getCode ()) && wmNews . getEnable (). equals ( WemediaContans . WM_NEWS_ENABLE_UP )){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u6587\u7ae0\u5df2\u53d1\u5e03\uff0c\u4e0d\u80fd\u5220\u9664\" ); } //4.\u53bb\u9664\u7d20\u6750\u4e0e\u6587\u7ae0\u7684\u5173\u7cfb wmNewsMaterialMapper . delete ( Wrappers . < WmNewsMaterial > lambdaQuery (). eq ( WmNewsMaterial :: getNewsId , wmNews . getId ())); //5.\u5220\u9664\u6587\u7ae0 removeById ( wmNews . getId ()); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } @Override public ResponseResult downOrUp ( WmNewsDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || dto . getId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u6587\u7ae0 WmNews wmNews = getById ( dto . getId ()); if ( wmNews == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u6587\u7ae0\u4e0d\u5b58\u5728\" ); } //3.\u5224\u65ad\u6587\u7ae0\u662f\u5426\u53d1\u5e03 if ( ! wmNews . getStatus (). equals ( WmNews . Status . PUBLISHED . getCode ())){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u5f53\u524d\u6587\u7ae0\u4e0d\u662f\u53d1\u5e03\u72b6\u6001\uff0c\u4e0d\u80fd\u4e0a\u4e0b\u67b6\" ); } //4.\u4fee\u6539\u6587\u7ae0\u72b6\u6001\uff0c\u540c\u6b65\u5230app\u7aef\uff08\u540e\u671f\u505a\uff09TODO if ( dto . getEnable () != null && dto . getEnable () > - 1 && dto . getEnable () < 2 ){ update ( Wrappers . < WmNews > lambdaUpdate (). eq ( WmNews :: getId , dto . getId ()). set ( WmNews :: getEnable , dto . getEnable ())); } return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } public static void main ( String [] args ) { List < String > images = new ArrayList <> (); for ( int i = 0 ; i < 1000000 ; i ++ ) { images . add ( String . valueOf ( i )); } Long start = System . currentTimeMillis (); String replace = images . toString (). replace ( \"[\" , \"\" ) . replace ( \"]\" , \"\" ) . replace ( \" \" , \"\" ); System . out . println ( replace ); System . out . println ( System . currentTimeMillis () - start ); start = System . currentTimeMillis (); replace = images . stream (). collect ( Collectors . joining ( \",\" )); System . out . println ( replace ); System . out . println ( System . currentTimeMillis () - start ); } }","title":"\u4f18\u5316service\u5199\u6cd5\uff1a"},{"location":"hmtt/day05/#13-controller_1315","text":"@PostMapping ( \"/submit\" ) @Override public ResponseResult submitNews ( @RequestBody WmNewsDto dto ) { if ( dto . getStatus () == WmNews . Status . SUBMIT . getCode ()){ //\u63d0\u4ea4 return wmNewsService . saveNews ( dto , WmNews . Status . SUBMIT . getCode ()); } else { //\u8349\u7a3f return wmNewsService . saveNews ( dto , WmNews . Status . NORMAL . getCode ()); } }","title":"13-controller\u7f16\u5199 13:15"},{"location":"hmtt/day05/#14-_0700","text":"@Override public ResponseResult findWmNewsById ( Integer id ) { //1.\u53c2\u6570\u68c0\u67e5 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID , \"\u6587\u7ae0Id\u4e0d\u53ef\u7f3a\u5c11\" ); } //2.\u67e5\u8be2\u6570\u636e WmNews wmNews = getById ( id ); if ( wmNews == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u6587\u7ae0\u4e0d\u5b58\u5728\" ); } //3.\u7ed3\u679c\u8fd4\u56de ResponseResult responseResult = ResponseResult . okResult ( wmNews ); responseResult . setHost ( fileServerUrl ); return responseResult ; }","title":"14-\u8be6\u60c5\u67e5\u8be2 07:00"},{"location":"hmtt/day05/#15-_0911","text":"\u5f53\u6587\u7ae0\u72b6\u6001\u4e3a9(\u5df2\u53d1\u5e03)\u4e14\u5df2\u4e0a\u67b6\u5219\u4e0d\u80fd\u5220\u9664\u6587\u7ae0\uff0c\u4e0b\u67b6\u72b6\u6001\u53ef\u4ee5\u5220\u9664\uff0c\u5982\u679c\u662f\u5176\u4ed6\u72b6\u6001\u53ef\u4ee5\u5220\u9664 \u5220\u9664\u6587\u7ae0\u4e4b\u524d\u9700\u8981\u5148\u628a\u7d20\u6750\u4e0e\u6587\u7ae0\u7684\u5173\u7cfb\u5220\u9664\u6389 @Override public ResponseResult delNews ( Integer id ) { //1.\u68c0\u67e5\u53c2\u6570 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID , \"\u6587\u7ae0Id\u4e0d\u53ef\u7f3a\u5c11\" ); } //2.\u83b7\u53d6\u6570\u636e WmNews wmNews = getById ( id ); if ( wmNews == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u6587\u7ae0\u4e0d\u5b58\u5728\" ); } //3.\u5224\u65ad\u5f53\u524d\u6587\u7ae0\u7684\u72b6\u6001 status==9 enable == 1 if ( wmNews . getStatus (). equals ( WmNews . Status . PUBLISHED . getCode ()) && wmNews . getEnable (). equals ( WemediaContans . WM_NEWS_ENABLE_UP )){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u6587\u7ae0\u5df2\u53d1\u5e03\uff0c\u4e0d\u80fd\u5220\u9664\" ); } //4.\u53bb\u9664\u7d20\u6750\u4e0e\u6587\u7ae0\u7684\u5173\u7cfb wmNewsMaterialMapper . delete ( Wrappers . < WmNewsMaterial > lambdaQuery (). eq ( WmNewsMaterial :: getNewsId , wmNews . getId ())); //5.\u5220\u9664\u6587\u7ae0 removeById ( wmNews . getId ()); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); }","title":"15-\u5220\u9664 09:11"},{"location":"hmtt/day05/#16-_1011","text":"\u5f53\u524d\u5df2\u7ecf\u53d1\u5e03\uff08\u72b6\u6001\u4e3a9\uff09\u7684\u6587\u7ae0\u53ef\u4ee5\u4e0a\u67b6\uff08enable = 1\uff09\uff0c\u4e5f\u53ef\u4ee5\u4e0b\u67b6\uff08enable = 0\uff09 \u5728\u4e0a\u67b6\u548c\u4e0b\u67b6\u64cd\u4f5c\u7684\u540c\u65f6\uff0c\u9700\u8981\u540c\u6b65app\u7aef\u7684\u6587\u7ae0\u914d\u7f6e\u4fe1\u606f\uff0c\u6682\u65f6\u4e0d\u505a\uff0c\u540e\u671f\u8bb2\u5230\u5ba1\u6838\u6587\u7ae0\u7684\u65f6\u5019\u518d\u4f18\u5316 @Override public ResponseResult downOrUp ( WmNewsDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || dto . getId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u6587\u7ae0 WmNews wmNews = getById ( dto . getId ()); if ( wmNews == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u6587\u7ae0\u4e0d\u5b58\u5728\" ); } //3.\u5224\u65ad\u6587\u7ae0\u662f\u5426\u53d1\u5e03 \u5224\u65adstatus\u5982\u679c\u4e0d\u7b49\u4e8e9\uff0c\u8fd4\u56de\u9519\u8bef if ( ! wmNews . getStatus (). equals ( WmNews . Status . PUBLISHED . getCode ())){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u5f53\u524d\u6587\u7ae0\u4e0d\u662f\u53d1\u5e03\u72b6\u6001\uff0c\u4e0d\u80fd\u4e0a\u4e0b\u67b6\" ); } //4.\u4fee\u6539\u6587\u7ae0\u72b6\u6001\uff0c\u540c\u6b65\u5230app\u7aef\uff08\u540e\u671f\u505a\uff09TODO if ( dto . getEnable () != null && dto . getEnable () >= 0 && dto . getEnable () <= 1 ){ update ( Wrappers . < WmNews > lambdaUpdate (). eq ( WmNews :: getId , dto . getId ()). set ( WmNews :: getEnable , dto . getEnable ())); } return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); }","title":"16-\u4e0a\u67b6\u548c\u4e0b\u67b6  10:11"},{"location":"hmtt/day05/%E8%87%AA%E5%AA%92%E4%BD%93%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/","text":"\u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863 \u00b6 \u7b80\u4ecb :\u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863 HOST :localhost:9004 \u8054\u7cfb\u4eba :\u9ed1\u9a6c\u7a0b\u5e8f\u5458 Version :1.0.0 \u63a5\u53e3\u8def\u5f84 :/v2/api-docs \u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863 login-controller login wm-material-controller cancelCollectionMaterial collectionMaterial delPicture findList uploadPicture wm-news-controller delNews downOrUp findAll findWmNewsById submitNews wm-user-controller findByName save login-controller \u00b6 login \u00b6 \u63a5\u53e3\u5730\u5740 : /login/in \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"name\" : \"\" , \"password\" : \"\" } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true WmUserDto WmUserDto \u2003\u2003name false string \u2003\u2003password false string \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" } wm-material-controller \u00b6 cancelCollectionMaterial \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/material/cancel_collect/{id} \u8bf7\u6c42\u65b9\u5f0f : GET \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : * \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema id id path true integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" } collectionMaterial \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/material/collect/{id} \u8bf7\u6c42\u65b9\u5f0f : GET \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : * \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema id id path true integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" } delPicture \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/material/del_picture/{id} \u8bf7\u6c42\u65b9\u5f0f : GET \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : * \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema id id path true integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" } findList \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/material/list \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"isCollection\" : 0 , \"page\" : 0 , \"size\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true WmMaterialDto WmMaterialDto \u2003\u2003isCollection false integer(int32) \u2003\u2003page \u5f53\u524d\u9875 true integer(int32) \u2003\u2003size \u6bcf\u9875\u663e\u793a\u6761\u6570 true integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" } uploadPicture \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/material/upload_picture \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : multipart/form-data \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema multipartFile multipartFile formData false file \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" } wm-news-controller \u00b6 delNews \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/news/del_news/{id} \u8bf7\u6c42\u65b9\u5f0f : GET \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : * \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema id id path true integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" } downOrUp \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/news/down_or_up \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"channelId\" : 0 , \"content\" : \"\" , \"enable\" : 0 , \"id\" : 0 , \"images\" : [], \"labels\" : \"\" , \"publishTime\" : \"\" , \"reason\" : \"\" , \"status\" : 0 , \"submitedTime\" : \"\" , \"title\" : \"\" , \"type\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true WmNewsDto WmNewsDto \u2003\u2003channelId false integer(int32) \u2003\u2003content false string \u2003\u2003enable false integer(int32) \u2003\u2003id false integer(int32) \u2003\u2003images false array string \u2003\u2003labels false string \u2003\u2003publishTime false string(date-time) \u2003\u2003reason false string \u2003\u2003status false integer(int32) \u2003\u2003submitedTime false string(date-time) \u2003\u2003title false string \u2003\u2003type false integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" } findAll \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/news/list \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"beginPubDate\" : \"\" , \"channelId\" : 0 , \"endPubDate\" : \"\" , \"keyword\" : \"\" , \"page\" : 0 , \"size\" : 0 , \"status\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true WmNewsPageReqDto WmNewsPageReqDto \u2003\u2003beginPubDate false string(date-time) \u2003\u2003channelId false integer(int32) \u2003\u2003endPubDate false string(date-time) \u2003\u2003keyword false string \u2003\u2003page \u5f53\u524d\u9875 true integer(int32) \u2003\u2003size \u6bcf\u9875\u663e\u793a\u6761\u6570 true integer(int32) \u2003\u2003status false integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" } findWmNewsById \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/news/one/{id} \u8bf7\u6c42\u65b9\u5f0f : GET \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : * \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema id id path true integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" } submitNews \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/news/submit \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"channelId\" : 0 , \"content\" : \"\" , \"enable\" : 0 , \"id\" : 0 , \"images\" : [], \"labels\" : \"\" , \"publishTime\" : \"\" , \"reason\" : \"\" , \"status\" : 0 , \"submitedTime\" : \"\" , \"title\" : \"\" , \"type\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true WmNewsDto WmNewsDto \u2003\u2003channelId false integer(int32) \u2003\u2003content false string \u2003\u2003enable false integer(int32) \u2003\u2003id false integer(int32) \u2003\u2003images false array string \u2003\u2003labels false string \u2003\u2003publishTime false string(date-time) \u2003\u2003reason false string \u2003\u2003status false integer(int32) \u2003\u2003submitedTime false string(date-time) \u2003\u2003title false string \u2003\u2003type false integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" } wm-user-controller \u00b6 findByName \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/user/findByName/{name} \u8bf7\u6c42\u65b9\u5f0f : GET \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : * \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema name name path true string \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK WmUser 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema apAuthorId integer(int32) integer(int32) apUserId integer(int32) integer(int32) createdTime string(date-time) string(date-time) email string id integer(int32) integer(int32) image string location string loginTime string(date-time) string(date-time) name string nickname string password string phone string salt string score integer(int32) integer(int32) status integer(int32) integer(int32) type integer(int32) integer(int32) \u54cd\u5e94\u793a\u4f8b : { \"apAuthorId\" : 0 , \"apUserId\" : 0 , \"createdTime\" : \"\" , \"email\" : \"\" , \"id\" : 0 , \"image\" : \"\" , \"location\" : \"\" , \"loginTime\" : \"\" , \"name\" : \"\" , \"nickname\" : \"\" , \"password\" : \"\" , \"phone\" : \"\" , \"salt\" : \"\" , \"score\" : 0 , \"status\" : 0 , \"type\" : 0 } save \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/user/save \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"apAuthorId\" : 0 , \"apUserId\" : 0 , \"createdTime\" : \"\" , \"email\" : \"\" , \"id\" : 0 , \"image\" : \"\" , \"location\" : \"\" , \"loginTime\" : \"\" , \"name\" : \"\" , \"nickname\" : \"\" , \"password\" : \"\" , \"phone\" : \"\" , \"salt\" : \"\" , \"score\" : 0 , \"status\" : 0 , \"type\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema wmUser wmUser body true WmUser WmUser \u2003\u2003apAuthorId false integer(int32) \u2003\u2003apUserId false integer(int32) \u2003\u2003createdTime false string(date-time) \u2003\u2003email false string \u2003\u2003id false integer(int32) \u2003\u2003image false string \u2003\u2003location false string \u2003\u2003loginTime false string(date-time) \u2003\u2003name false string \u2003\u2003nickname false string \u2003\u2003password false string \u2003\u2003phone false string \u2003\u2003salt false string \u2003\u2003score false integer(int32) \u2003\u2003status false integer(int32) \u2003\u2003type false integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"\u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863"},{"location":"hmtt/day05/%E8%87%AA%E5%AA%92%E4%BD%93%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#-api","text":"\u7b80\u4ecb :\u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863 HOST :localhost:9004 \u8054\u7cfb\u4eba :\u9ed1\u9a6c\u7a0b\u5e8f\u5458 Version :1.0.0 \u63a5\u53e3\u8def\u5f84 :/v2/api-docs \u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863 login-controller login wm-material-controller cancelCollectionMaterial collectionMaterial delPicture findList uploadPicture wm-news-controller delNews downOrUp findAll findWmNewsById submitNews wm-user-controller findByName save","title":"\u9ed1\u9a6c\u5934\u6761-\u5e73\u53f0\u7ba1\u7406API\u6587\u6863"},{"location":"hmtt/day05/%E8%87%AA%E5%AA%92%E4%BD%93%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#login-controller","text":"","title":"login-controller"},{"location":"hmtt/day05/%E8%87%AA%E5%AA%92%E4%BD%93%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#login","text":"\u63a5\u53e3\u5730\u5740 : /login/in \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"name\" : \"\" , \"password\" : \"\" } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true WmUserDto WmUserDto \u2003\u2003name false string \u2003\u2003password false string \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"login"},{"location":"hmtt/day05/%E8%87%AA%E5%AA%92%E4%BD%93%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#wm-material-controller","text":"","title":"wm-material-controller"},{"location":"hmtt/day05/%E8%87%AA%E5%AA%92%E4%BD%93%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#cancelcollectionmaterial","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/material/cancel_collect/{id} \u8bf7\u6c42\u65b9\u5f0f : GET \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : * \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema id id path true integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"cancelCollectionMaterial"},{"location":"hmtt/day05/%E8%87%AA%E5%AA%92%E4%BD%93%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#collectionmaterial","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/material/collect/{id} \u8bf7\u6c42\u65b9\u5f0f : GET \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : * \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema id id path true integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"collectionMaterial"},{"location":"hmtt/day05/%E8%87%AA%E5%AA%92%E4%BD%93%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#delpicture","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/material/del_picture/{id} \u8bf7\u6c42\u65b9\u5f0f : GET \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : * \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema id id path true integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"delPicture"},{"location":"hmtt/day05/%E8%87%AA%E5%AA%92%E4%BD%93%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#findlist","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/material/list \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"isCollection\" : 0 , \"page\" : 0 , \"size\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true WmMaterialDto WmMaterialDto \u2003\u2003isCollection false integer(int32) \u2003\u2003page \u5f53\u524d\u9875 true integer(int32) \u2003\u2003size \u6bcf\u9875\u663e\u793a\u6761\u6570 true integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"findList"},{"location":"hmtt/day05/%E8%87%AA%E5%AA%92%E4%BD%93%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#uploadpicture","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/material/upload_picture \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : multipart/form-data \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema multipartFile multipartFile formData false file \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"uploadPicture"},{"location":"hmtt/day05/%E8%87%AA%E5%AA%92%E4%BD%93%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#wm-news-controller","text":"","title":"wm-news-controller"},{"location":"hmtt/day05/%E8%87%AA%E5%AA%92%E4%BD%93%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#delnews","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/news/del_news/{id} \u8bf7\u6c42\u65b9\u5f0f : GET \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : * \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema id id path true integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"delNews"},{"location":"hmtt/day05/%E8%87%AA%E5%AA%92%E4%BD%93%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#downorup","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/news/down_or_up \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"channelId\" : 0 , \"content\" : \"\" , \"enable\" : 0 , \"id\" : 0 , \"images\" : [], \"labels\" : \"\" , \"publishTime\" : \"\" , \"reason\" : \"\" , \"status\" : 0 , \"submitedTime\" : \"\" , \"title\" : \"\" , \"type\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true WmNewsDto WmNewsDto \u2003\u2003channelId false integer(int32) \u2003\u2003content false string \u2003\u2003enable false integer(int32) \u2003\u2003id false integer(int32) \u2003\u2003images false array string \u2003\u2003labels false string \u2003\u2003publishTime false string(date-time) \u2003\u2003reason false string \u2003\u2003status false integer(int32) \u2003\u2003submitedTime false string(date-time) \u2003\u2003title false string \u2003\u2003type false integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"downOrUp"},{"location":"hmtt/day05/%E8%87%AA%E5%AA%92%E4%BD%93%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#findall","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/news/list \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"beginPubDate\" : \"\" , \"channelId\" : 0 , \"endPubDate\" : \"\" , \"keyword\" : \"\" , \"page\" : 0 , \"size\" : 0 , \"status\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true WmNewsPageReqDto WmNewsPageReqDto \u2003\u2003beginPubDate false string(date-time) \u2003\u2003channelId false integer(int32) \u2003\u2003endPubDate false string(date-time) \u2003\u2003keyword false string \u2003\u2003page \u5f53\u524d\u9875 true integer(int32) \u2003\u2003size \u6bcf\u9875\u663e\u793a\u6761\u6570 true integer(int32) \u2003\u2003status false integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"findAll"},{"location":"hmtt/day05/%E8%87%AA%E5%AA%92%E4%BD%93%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#findwmnewsbyid","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/news/one/{id} \u8bf7\u6c42\u65b9\u5f0f : GET \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : * \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema id id path true integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"findWmNewsById"},{"location":"hmtt/day05/%E8%87%AA%E5%AA%92%E4%BD%93%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#submitnews","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/news/submit \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"channelId\" : 0 , \"content\" : \"\" , \"enable\" : 0 , \"id\" : 0 , \"images\" : [], \"labels\" : \"\" , \"publishTime\" : \"\" , \"reason\" : \"\" , \"status\" : 0 , \"submitedTime\" : \"\" , \"title\" : \"\" , \"type\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true WmNewsDto WmNewsDto \u2003\u2003channelId false integer(int32) \u2003\u2003content false string \u2003\u2003enable false integer(int32) \u2003\u2003id false integer(int32) \u2003\u2003images false array string \u2003\u2003labels false string \u2003\u2003publishTime false string(date-time) \u2003\u2003reason false string \u2003\u2003status false integer(int32) \u2003\u2003submitedTime false string(date-time) \u2003\u2003title false string \u2003\u2003type false integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"submitNews"},{"location":"hmtt/day05/%E8%87%AA%E5%AA%92%E4%BD%93%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#wm-user-controller","text":"","title":"wm-user-controller"},{"location":"hmtt/day05/%E8%87%AA%E5%AA%92%E4%BD%93%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#findbyname","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/user/findByName/{name} \u8bf7\u6c42\u65b9\u5f0f : GET \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : * \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema name name path true string \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK WmUser 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema apAuthorId integer(int32) integer(int32) apUserId integer(int32) integer(int32) createdTime string(date-time) string(date-time) email string id integer(int32) integer(int32) image string location string loginTime string(date-time) string(date-time) name string nickname string password string phone string salt string score integer(int32) integer(int32) status integer(int32) integer(int32) type integer(int32) integer(int32) \u54cd\u5e94\u793a\u4f8b : { \"apAuthorId\" : 0 , \"apUserId\" : 0 , \"createdTime\" : \"\" , \"email\" : \"\" , \"id\" : 0 , \"image\" : \"\" , \"location\" : \"\" , \"loginTime\" : \"\" , \"name\" : \"\" , \"nickname\" : \"\" , \"password\" : \"\" , \"phone\" : \"\" , \"salt\" : \"\" , \"score\" : 0 , \"status\" : 0 , \"type\" : 0 }","title":"findByName"},{"location":"hmtt/day05/%E8%87%AA%E5%AA%92%E4%BD%93%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/#save","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/user/save \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"apAuthorId\" : 0 , \"apUserId\" : 0 , \"createdTime\" : \"\" , \"email\" : \"\" , \"id\" : 0 , \"image\" : \"\" , \"location\" : \"\" , \"loginTime\" : \"\" , \"name\" : \"\" , \"nickname\" : \"\" , \"password\" : \"\" , \"phone\" : \"\" , \"salt\" : \"\" , \"score\" : 0 , \"status\" : 0 , \"type\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema wmUser wmUser body true WmUser WmUser \u2003\u2003apAuthorId false integer(int32) \u2003\u2003apUserId false integer(int32) \u2003\u2003createdTime false string(date-time) \u2003\u2003email false string \u2003\u2003id false integer(int32) \u2003\u2003image false string \u2003\u2003location false string \u2003\u2003loginTime false string(date-time) \u2003\u2003name false string \u2003\u2003nickname false string \u2003\u2003password false string \u2003\u2003phone false string \u2003\u2003salt false string \u2003\u2003score false integer(int32) \u2003\u2003status false integer(int32) \u2003\u2003type false integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"save"},{"location":"hmtt/day06/","text":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 01:33 \u00b6 \u80fd\u591f\u4e86\u89e3kafka\u57fa\u672c\u4fe1\u606f \u80fd\u591f\u8fd0\u7528kafka\u8fdb\u884c\u6d88\u606f\u7684\u6536\u53d1 \u80fd\u80fd\u7406\u89e3kafka\u751f\u4ea7\u8005\u7684\u539f\u7406\u548c\u673a\u5236 \u80fd\u80fd\u7406\u89e3kafka\u6d88\u8d39\u8005\u7684\u539f\u7406\u548c\u673a\u5236 \u80fd\u591f\u5b8c\u6210\u963f\u91cc\u4e91\u5b89\u5168\u7b2c\u4e09\u65b9\u63a5\u53e3\u6587\u6863\u7684\u4f7f\u7528 \u80fd\u591f\u628a\u963f\u91cc\u4e91\u5b89\u5168\u5bf9\u63a5\u5230\u9879\u76ee\u4e2d \u80fd\u591f\u7406\u89e3\u654f\u611f\u8bcd\u8fc7\u6ee4\u7b97\u6cd5dfa Rocketmq\u590d\u4e60 \u00b6 RocketMQ\u7b80\u4ecb \u00b6 RocketMQ\u662f\u4e00\u4e2a\u7eafJava\u3001\u5206\u5e03\u5f0f\u3001\u961f\u5217\u6a21\u578b\u7684\u5f00\u6e90\u6d88\u606f\u4e2d\u95f4\u4ef6\uff0c\u524d\u8eab\u662fMetaQ\uff0c\u662f\u963f\u91cc\u53c2\u8003Kafka\u7279\u70b9\u7814\u53d1\u7684\u4e00\u4e2a\u961f\u5217\u6a21\u578b\u7684\u6d88\u606f\u4e2d\u95f4\u4ef6\uff0c\u540e\u5f00\u6e90\u7ed9apache\u57fa\u91d1\u4f1a\u6210\u4e3a\u4e86apache\u7684\u9876\u7ea7\u5f00\u6e90\u9879\u76ee\uff0c\u5177\u6709\u9ad8\u6027\u80fd\u3001\u9ad8\u53ef\u9760\u3001\u9ad8\u5b9e\u65f6\u3001\u5206\u5e03\u5f0f\u7279\u70b9\u3002 \u6211\u4eec\u518d\u770b\u4e0b\u963f\u91cc\u7ed9\u4ed6\u53d6\u7684\u540d\u5b57\u54c8\uff1a Rocket \u706b\u7bad \u963f\u91cc\u8fd9\u662f\u5e0c\u671b\u4ed6\u4e0a\u5929\u5440\uff0c\u4e0d\u8fc7\u6211\u89c9\u5f97\u8fd9\u4e2a\u540d\u5b57\u786e\u5b9e\u633a\u9177\u7684\u3002 RocketMQ \u652f\u6301\u540c\u6b65\u3001\u5f02\u6b65\u3001Oneway \u4e09\u79cd\u53d1\u9001\u65b9\u5f0f\u3002 \u540c\u6b65 \uff1a\u5ba2\u6237\u7aef\u53d1\u8d77\u4e00\u6b21\u6d88\u606f\u53d1\u9001\u540e\u4f1a\u540c\u6b65\u7b49\u5f85\u670d\u52a1\u5668\u7684\u54cd\u5e94\u7ed3\u679c\u3002 \u5f02\u6b65 \uff1a\u5ba2\u6237\u7aef\u53d1\u8d77\u4e00\u4e0b\u6d88\u606f\u53d1\u8d77\u8bf7\u6c42\u540e\u4e0d\u7b49\u5f85\u670d\u52a1\u5668\u54cd\u5e94\u7ed3\u679c\u800c\u662f\u7acb\u5373\u8fd4\u56de\uff0c\u8fd9\u6837\u4e0d\u4f1a\u963b\u585e\u5ba2\u6237\u7aef\u5b50\u7ebf\u7a0b\uff0c\u5f53\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u7aef\uff08Broker\uff09\u7684\u54cd\u5e94\u7ed3\u679c\u540e\u4f1a\u81ea\u52a8\u8c03\u7528\u56de\u8c03\u51fd\u6570\u3002 Oneway \uff1a\u5ba2\u6237\u7aef\u53d1\u8d77\u6d88\u606f\u53d1\u9001\u8bf7\u6c42\u540e\u5e76\u4e0d\u4f1a\u7b49\u5f85\u670d\u52a1\u5668\u7684\u54cd\u5e94\u7ed3\u679c\uff0c\u4e5f\u4e0d\u4f1a\u8c03\u7528\u56de\u8c03\u51fd\u6570\uff0c\u5373\u4e0d\u5173\u5fc3\u6d88\u606f\u7684\u6700\u7ec8\u53d1\u9001\u7ed3\u679c\u3002 MQ \u4e0e\u5e94\u7528\u670d\u52a1\u5668\u90fd\u5728\u4e00\u4e2a\u5185\u90e8\u7f51\u7edc\u4e2d\uff0c\u7f51\u7edc\u901a\u4fe1\u7684\u6d41\u91cf\u901a\u5e38\u53ef\u4ee5\u5ffd\u7565\uff0c\u800c\u4e14 MQ \u7684\u8bbe\u8ba1\u76ee\u7684\u662f\u4f4e\u5ef6\u8fdf\u3001\u9ad8\u5e76\u53d1\uff0c\u6545\u901a\u5e38\u6ca1\u6709\u5fc5\u8981\u4f7f\u7528\u5f02\u6b65\u53d1\u9001\uff0c\u901a\u5e38\u90fd\u662f\u4e3a\u4e86\u63d0\u9ad8 RocketMQ Broker \u7aef\u76f8\u5173\u7684\u53c2\u6570\uff0c\u7279\u522b\u662f\u5237\u76d8\u7b56\u7565\u548c\u590d\u5236\u7b56\u7565\u3002\u5982\u679c\u5728\u4e00\u4e2a\u573a\u666f\u4e2d\uff0c\u4e00\u4e2a\u6570\u636e\u5e93\u64cd\u4f5c\u4e8b\u52a1\u4e2d\u9700\u8981\u53d1\u9001\u591a\u6761\u6d88\u606f\uff0c\u8fd9\u4e2a\u65f6\u5019\u4f7f\u7528\u5f02\u6b65\u53d1\u9001\u4e5f\u4f1a\u5e26\u6765\u4e00\u5b9a\u6027\u80fd\u63d0\u5347\u3002 \u5982\u679c\u4f7f\u7528\u5f02\u6b65\u53d1\u9001\uff0c\u7f16\u7a0b\u6a21\u578b\u4e0a\u4f1a\u7a0d\u663e\u590d\u6742\uff0c\u5176\u8865\u507f\u673a\u5236\u3001\u5bb9\u9519\u673a\u5236\u5c06\u4f1a\u53d8\u7684\u8f83\u4e3a\u590d\u6742\u3002 \u6b63\u5982\u4e0a\u8ff0\u793a\u4f8b\u4e2d\u9610\u8ff0\u7684\u90a3\u6837\uff0c\u8865\u507f\u4ee3\u7801\u5e94\u8be5\u5728\u4e24\u4e2a\u5730\u65b9\u8c03\u7528\uff1a producer#send \u65b9\u6cd5\u65f6\u9700\u8981\u6355\u6349\u5f02\u5e38\uff0c\u5e38\u89c1\u7684\u5f02\u5e38\u4fe1\u606f\uff1a MQClientException(\"executor rejected \", e) \u3002 \u5728 SendCallback \u7684 onException \u4e2d\u8fdb\u884c\u8865\u507f\uff0c\u5e38\u89c1\u5f02\u5e38\u6709\u8c03\u7528\u8d85\u65f6\u3001RemotingTooMuchRequestException\u3002 02-kafka\u7b80\u4ecb 05:08 \u00b6 Kafka\u662f\u6700\u521d\u7531Linkedin\u516c\u53f8\u5f00\u53d1\uff0c\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u3001\u5206\u533a\u7684\u3001\u591a\u526f\u672c\u7684\u3001\u591a\u8ba2\u9605\u8005\uff0c\u57fa\u4e8ezookeeper\u534f\u8c03\u7684\u5206\u5e03\u5f0f\u65e5\u5fd7\u7cfb\u7edf\uff08\u4e5f\u53ef\u4ee5\u5f53\u505aMQ\u7cfb\u7edf\uff09\uff0c\u5e38\u89c1\u53ef\u4ee5\u7528\u4e8eweb/nginx\u65e5\u5fd7\u3001\u8bbf\u95ee\u65e5\u5fd7\uff0c\u6d88\u606f\u670d\u52a1\u7b49\u7b49\uff0cLinkedin\u4e8e2010\u5e74\u8d21\u732e\u7ed9\u4e86Apache\u57fa\u91d1\u4f1a\u5e76\u6210\u4e3a\u9876\u7ea7\u5f00\u6e90\u9879\u76ee\u3002 \u4e3b\u8981\u5e94\u7528\u573a\u666f\u662f\uff1a\u65e5\u5fd7\u6536\u96c6\u7cfb\u7edf\u548c\u6d88\u606f\u7cfb\u7edf\u3002 Kafka\u4e3b\u8981\u8bbe\u8ba1\u76ee\u6807\u5982\u4e0b\uff1a \u4ee5\u65f6\u95f4\u590d\u6742\u5ea6\u4e3aO(1)\u7684\u65b9\u5f0f\u63d0\u4f9b\u6d88\u606f\u6301\u4e45\u5316\u80fd\u529b\uff0c\u5373\u4f7f\u5bf9TB\u7ea7\u4ee5\u4e0a\u6570\u636e\u4e5f\u80fd\u4fdd\u8bc1\u5e38\u6570\u65f6\u95f4\u7684\u8bbf\u95ee\u6027\u80fd\u3002 \u9ad8\u541e\u5410\u7387\u3002\u5373\u4f7f\u5728\u975e\u5e38\u5ec9\u4ef7\u7684\u5546\u7528\u673a\u5668\u4e0a\u4e5f\u80fd\u505a\u5230\u5355\u673a\u652f\u6301\u6bcf\u79d2100K\u6761\u6d88\u606f\u7684\u4f20\u8f93\u3002Rabbitmq 1W \u652f\u6301Kafka Server\u95f4\u7684\u6d88\u606f\u5206\u533a\uff0c\u53ca\u5206\u5e03\u5f0f\u6d88\u8d39\uff0c\u540c\u65f6\u4fdd\u8bc1\u6bcf\u4e2apartition\u5185\u7684\u6d88\u606f\u987a\u5e8f\u4f20\u8f93\u3002 \u540c\u65f6\u652f\u6301\u79bb\u7ebf\u6570\u636e\u5904\u7406\u548c\u5b9e\u65f6\u6570\u636e\u5904\u7406\u3002 Scale out:\u652f\u6301\u5728\u7ebf\u6c34\u5e73\u6269\u5c55 1\u3000\u6d88\u606f\u7cfb\u7edf\u4ecb\u7ecd \u00b6 \u4e00\u4e2a\u6d88\u606f\u7cfb\u7edf\u8d1f\u8d23\u5c06\u6570\u636e\u4ece\u4e00\u4e2a\u5e94\u7528\u4f20\u9012\u5230\u53e6\u5916\u4e00\u4e2a\u5e94\u7528\uff0c\u5e94\u7528\u53ea\u9700\u5173\u6ce8\u4e8e\u6570\u636e\uff0c\u65e0\u9700\u5173\u6ce8\u6570\u636e\u5728\u4e24\u4e2a\u6216\u591a\u4e2a\u5e94\u7528\u95f4\u662f\u5982\u4f55\u4f20\u9012\u7684\u3002\u5206\u5e03\u5f0f\u6d88\u606f\u4f20\u9012\u57fa\u4e8e\u53ef\u9760\u7684\u6d88\u606f\u961f\u5217\uff0c\u5728\u5ba2\u6237\u7aef\u5e94\u7528\u548c\u6d88\u606f\u7cfb\u7edf\u4e4b\u95f4\u5f02\u6b65\u4f20\u9012\u6d88\u606f\u3002\u6709\u4e24\u79cd\u4e3b\u8981\u7684\u6d88\u606f\u4f20\u9012\u6a21\u5f0f\uff1a \u70b9\u5bf9\u70b9\u4f20\u9012\u6a21\u5f0f\u3001\u53d1\u5e03-\u8ba2\u9605\u6a21\u5f0f \u3002\u5927\u90e8\u5206\u7684\u6d88\u606f\u7cfb\u7edf\u9009\u7528\u53d1\u5e03-\u8ba2\u9605\u6a21\u5f0f\u3002 Kafka\u5c31\u662f\u4e00\u79cd\u53d1\u5e03-\u8ba2\u9605\u6a21\u5f0f \u3002 1.1\u3000\u70b9\u5bf9\u70b9\u6d88\u606f\u4f20\u9012\u6a21\u5f0f \u00b6 \u5728\u70b9\u5bf9\u70b9\u6d88\u606f\u7cfb\u7edf\u4e2d\uff0c\u6d88\u606f\u6301\u4e45\u5316\u5230\u4e00\u4e2a\u961f\u5217\u4e2d\u3002\u6b64\u65f6\uff0c\u5c06\u6709\u4e00\u4e2a\u6216\u591a\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\u961f\u5217\u4e2d\u7684\u6570\u636e\u3002\u4f46\u662f\u4e00\u6761\u6d88\u606f\u53ea\u80fd\u88ab\u6d88\u8d39\u4e00\u6b21\u3002\u5f53\u4e00\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\u4e86\u961f\u5217\u4e2d\u7684\u67d0\u6761\u6570\u636e\u4e4b\u540e\uff0c\u8be5\u6761\u6570\u636e\u5219\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u5220\u9664\u3002\u8be5\u6a21\u5f0f\u5373\u4f7f\u6709\u591a\u4e2a\u6d88\u8d39\u8005\u540c\u65f6\u6d88\u8d39\u6570\u636e\uff0c\u4e5f\u80fd\u4fdd\u8bc1\u6570\u636e\u5904\u7406\u7684\u987a\u5e8f\u3002\u8fd9\u79cd\u67b6\u6784\u63cf\u8ff0\u793a\u610f\u56fe\u5982\u4e0b\uff1a \u751f\u4ea7\u8005\u53d1\u9001\u4e00\u6761\u6d88\u606f\u5230queue\uff0c\u53ea\u6709\u4e00\u4e2a\u6d88\u8d39\u8005\u80fd\u6536\u5230 \u3002 1.2\u3000\u53d1\u5e03-\u8ba2\u9605\u6d88\u606f\u4f20\u9012\u6a21\u5f0f \u00b6 \u5728\u53d1\u5e03-\u8ba2\u9605\u6d88\u606f\u7cfb\u7edf\u4e2d\uff0c\u6d88\u606f\u88ab\u6301\u4e45\u5316\u5230\u4e00\u4e2atopic\u4e2d\u3002\u4e0e\u70b9\u5bf9\u70b9\u6d88\u606f\u7cfb\u7edf\u4e0d\u540c\u7684\u662f\uff0c\u6d88\u8d39\u8005\u53ef\u4ee5\u8ba2\u9605\u4e00\u4e2a\u6216\u591a\u4e2atopic\uff0c\u6d88\u8d39\u8005\u53ef\u4ee5\u6d88\u8d39\u8be5topic\u4e2d\u6240\u6709\u7684\u6570\u636e\uff0c\u540c\u4e00\u6761\u6570\u636e\u53ef\u4ee5\u88ab\u591a\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\uff0c\u6570\u636e\u88ab\u6d88\u8d39\u540e\u4e0d\u4f1a\u7acb\u9a6c\u5220\u9664\u3002\u5728\u53d1\u5e03-\u8ba2\u9605\u6d88\u606f\u7cfb\u7edf\u4e2d\uff0c\u6d88\u606f\u7684\u751f\u4ea7\u8005\u79f0\u4e3a\u53d1\u5e03\u8005\uff0c\u6d88\u8d39\u8005\u79f0\u4e3a\u8ba2\u9605\u8005\u3002\u8be5\u6a21\u5f0f\u7684\u793a\u4f8b\u56fe\u5982\u4e0b\uff1a \u53d1\u5e03\u8005\u53d1\u9001\u5230topic\u7684\u6d88\u606f\uff0c\u53ea\u6709\u8ba2\u9605\u4e86topic\u7684\u8ba2\u9605\u8005\u624d\u4f1a\u6536\u5230\u6d88\u606f \u3002 2 Kafka\u7684\u4f18\u70b9 \u00b6 2.1\u3000\u89e3\u8026 \u00b6 \u5728\u9879\u76ee\u542f\u52a8\u4e4b\u521d\u6765\u9884\u6d4b\u5c06\u6765\u9879\u76ee\u4f1a\u78b0\u5230\u4ec0\u4e48\u9700\u6c42\uff0c\u662f\u6781\u5176\u56f0\u96be\u7684\u3002\u6d88\u606f\u7cfb\u7edf\u5728\u5904\u7406\u8fc7\u7a0b\u4e2d\u95f4\u63d2\u5165\u4e86\u4e00\u4e2a\u9690\u542b\u7684\u3001\u57fa\u4e8e\u6570\u636e\u7684\u63a5\u53e3\u5c42\uff0c\u4e24\u8fb9\u7684\u5904\u7406\u8fc7\u7a0b\u90fd\u8981\u5b9e\u73b0\u8fd9\u4e00\u63a5\u53e3\u3002\u8fd9\u5141\u8bb8\u4f60\u72ec\u7acb\u7684\u6269\u5c55\u6216\u4fee\u6539\u4e24\u8fb9\u7684\u5904\u7406\u8fc7\u7a0b\uff0c\u53ea\u8981\u786e\u4fdd\u5b83\u4eec\u9075\u5b88\u540c\u6837\u7684\u63a5\u53e3\u7ea6\u675f\u3002 2.2\u3000\u5197\u4f59\uff08\u526f\u672c\uff09 \u00b6 \u6709\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5904\u7406\u6570\u636e\u7684\u8fc7\u7a0b\u4f1a\u5931\u8d25\u3002\u9664\u975e\u6570\u636e\u88ab\u6301\u4e45\u5316\uff0c\u5426\u5219\u5c06\u9020\u6210\u4e22\u5931\u3002\u6d88\u606f\u961f\u5217\u628a\u6570\u636e\u8fdb\u884c\u6301\u4e45\u5316\u76f4\u5230\u5b83\u4eec\u5df2\u7ecf\u88ab\u5b8c\u5168\u5904\u7406\uff0c\u901a\u8fc7\u8fd9\u4e00\u65b9\u5f0f\u89c4\u907f\u4e86\u6570\u636e\u4e22\u5931\u98ce\u9669\u3002\u8bb8\u591a\u6d88\u606f\u961f\u5217\u6240\u91c7\u7528\u7684\"\u63d2\u5165-\u83b7\u53d6-\u5220\u9664\"\u8303\u5f0f\u4e2d\uff0c\u5728\u628a\u4e00\u4e2a\u6d88\u606f\u4ece\u961f\u5217\u4e2d\u5220\u9664\u4e4b\u524d\uff0c\u9700\u8981\u4f60\u7684\u5904\u7406\u7cfb\u7edf\u660e\u786e\u7684\u6307\u51fa\u8be5\u6d88\u606f\u5df2\u7ecf\u88ab\u5904\u7406\u5b8c\u6bd5\uff0c\u4ece\u800c\u786e\u4fdd\u4f60\u7684\u6570\u636e\u88ab\u5b89\u5168\u7684\u4fdd\u5b58\u76f4\u5230\u4f60\u4f7f\u7528\u5b8c\u6bd5\u3002 2.3\u3000\u6269\u5c55\u6027 \u00b6 \u56e0\u4e3a\u6d88\u606f\u961f\u5217\u89e3\u8026\u4e86\u4f60\u7684\u5904\u7406\u8fc7\u7a0b\uff0c\u6240\u4ee5\u589e\u5927\u6d88\u606f\u5165\u961f\u548c\u5904\u7406\u7684\u9891\u7387\u662f\u5f88\u5bb9\u6613\u7684\uff0c\u53ea\u8981\u53e6\u5916\u589e\u52a0\u5904\u7406\u8fc7\u7a0b\u5373\u53ef\u3002\u4e0d\u9700\u8981\u6539\u53d8\u4ee3\u7801\u3001\u4e0d\u9700\u8981\u8c03\u8282\u53c2\u6570\u3002\u6269\u5c55\u5c31\u50cf\u8c03\u5927\u7535\u529b\u6309\u94ae\u4e00\u6837\u7b80\u5355\u3002 2.4\u3000\u7075\u6d3b\u6027&\u5cf0\u503c\u5904\u7406\u80fd\u529b \u00b6 \u5728\u8bbf\u95ee\u91cf\u5267\u589e\u7684\u60c5\u51b5\u4e0b\uff0c\u5e94\u7528\u4ecd\u7136\u9700\u8981\u7ee7\u7eed\u53d1\u6325\u4f5c\u7528\uff0c\u4f46\u662f\u8fd9\u6837\u7684\u7a81\u53d1\u6d41\u91cf\u5e76\u4e0d\u5e38\u89c1\uff1b\u5982\u679c\u4e3a\u4ee5\u80fd\u5904\u7406\u8fd9\u7c7b\u5cf0\u503c\u8bbf\u95ee\u4e3a\u6807\u51c6\u6765\u6295\u5165\u8d44\u6e90\u968f\u65f6\u5f85\u547d\u65e0\u7591\u662f\u5de8\u5927\u7684\u6d6a\u8d39\u3002\u4f7f\u7528\u6d88\u606f\u961f\u5217\u80fd\u591f\u4f7f\u5173\u952e\u7ec4\u4ef6\u9876\u4f4f\u7a81\u53d1\u7684\u8bbf\u95ee\u538b\u529b\uff0c\u800c\u4e0d\u4f1a\u56e0\u4e3a\u7a81\u53d1\u7684\u8d85\u8d1f\u8377\u7684\u8bf7\u6c42\u800c\u5b8c\u5168\u5d29\u6e83\u3002 2.5\u3000\u53ef\u6062\u590d \u00b6 \u7cfb\u7edf\u7684\u4e00\u90e8\u5206\u7ec4\u4ef6\u5931\u6548\u65f6\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5230\u6574\u4e2a\u7cfb\u7edf\u3002\u6d88\u606f\u961f\u5217\u964d\u4f4e\u4e86\u8fdb\u7a0b\u95f4\u7684\u8026\u5408\u5ea6\uff0c\u6240\u4ee5\u5373\u4f7f\u4e00\u4e2a\u5904\u7406\u6d88\u606f\u7684\u8fdb\u7a0b\u6302\u6389\uff0c\u52a0\u5165\u961f\u5217\u4e2d\u7684\u6d88\u606f\u4ecd\u7136\u53ef\u4ee5\u5728\u7cfb\u7edf\u6062\u590d\u540e\u88ab\u5904\u7406\u3002 2.6\u3000\u987a\u5e8f\u4fdd\u8bc1 \u00b6 \u5728\u5927\u591a\u4f7f\u7528\u573a\u666f\u4e0b\uff0c\u6570\u636e\u5904\u7406\u7684\u987a\u5e8f\u90fd\u5f88\u91cd\u8981\u3002\u5927\u90e8\u5206\u6d88\u606f\u961f\u5217\u672c\u6765\u5c31\u662f\u6392\u5e8f\u7684\uff0c\u5e76\u4e14\u80fd\u4fdd\u8bc1\u6570\u636e\u4f1a\u6309\u7167\u7279\u5b9a\u7684\u987a\u5e8f\u6765\u5904\u7406\u3002Kafka\u4fdd\u8bc1\u4e00\u4e2aPartition\u5185\u7684\u6d88\u606f\u7684\u6709\u5e8f\u6027\u3002 2.7\u3000\u7f13\u51b2 \u00b6 \u5728\u4efb\u4f55\u91cd\u8981\u7684\u7cfb\u7edf\u4e2d\uff0c\u90fd\u4f1a\u6709\u9700\u8981\u4e0d\u540c\u7684\u5904\u7406\u65f6\u95f4\u7684\u5143\u7d20\u3002\u4f8b\u5982\uff0c\u52a0\u8f7d\u4e00\u5f20\u56fe\u7247\u6bd4\u5e94\u7528\u8fc7\u6ee4\u5668\u82b1\u8d39\u66f4\u5c11\u7684\u65f6\u95f4\u3002\u6d88\u606f\u961f\u5217\u901a\u8fc7\u4e00\u4e2a\u7f13\u51b2\u5c42\u6765\u5e2e\u52a9\u4efb\u52a1\u6700\u9ad8\u6548\u7387\u7684\u6267\u884c\u2014\u2014\u2014\u5199\u5165\u961f\u5217\u7684\u5904\u7406\u4f1a\u5c3d\u53ef\u80fd\u7684\u5feb\u901f\u3002\u8be5\u7f13\u51b2\u6709\u52a9\u4e8e\u63a7\u5236\u548c\u4f18\u5316\u6570\u636e\u6d41\u7ecf\u8fc7\u7cfb\u7edf\u7684\u901f\u5ea6\u3002 2.8\u3000\u5f02\u6b65\u901a\u4fe1 \u00b6 \u5f88\u591a\u65f6\u5019\uff0c\u7528\u6237\u4e0d\u60f3\u4e5f\u4e0d\u9700\u8981\u7acb\u5373\u5904\u7406\u6d88\u606f\u3002\u6d88\u606f\u961f\u5217\u63d0\u4f9b\u4e86\u5f02\u6b65\u5904\u7406\u673a\u5236\uff0c\u5141\u8bb8\u7528\u6237\u628a\u4e00\u4e2a\u6d88\u606f\u653e\u5165\u961f\u5217\uff0c\u4f46\u5e76\u4e0d\u7acb\u5373\u5904\u7406\u5b83\u3002\u60f3\u5411\u961f\u5217\u4e2d\u653e\u5165\u591a\u5c11\u6d88\u606f\u5c31\u653e\u591a\u5c11\uff0c\u7136\u540e\u5728\u9700\u8981\u7684\u65f6\u5019\u518d\u53bb\u5904\u7406\u5b83\u4eec\u3002 3\u3001\u5e38\u7528Message Queue\u5bf9\u6bd4 \u00b6 3.1\u3000RabbitMQ \u00b6 RabbitMQ\u662f\u4f7f\u7528Erlang\u7f16\u5199\u7684\u4e00\u4e2a\u5f00\u6e90\u7684\u6d88\u606f\u961f\u5217\uff0c\u672c\u8eab\u652f\u6301\u5f88\u591a\u7684\u534f\u8bae\uff1aAMQP\uff0cXMPP, SMTP, STOMP\uff0c\u4e5f\u6b63\u56e0\u5982\u6b64\uff0c\u5b83\u975e\u5e38\u91cd\u91cf\u7ea7\uff0c\u66f4\u9002\u5408\u4e8e\u4f01\u4e1a\u7ea7\u7684\u5f00\u53d1\u3002\u540c\u65f6\u5b9e\u73b0\u4e86Broker\u6784\u67b6\uff0c\u8fd9\u610f\u5473\u7740\u6d88\u606f\u5728\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u65f6\u5148\u5728\u4e2d\u5fc3\u961f\u5217\u6392\u961f\u3002\u5bf9\u8def\u7531\uff0c\u8d1f\u8f7d\u5747\u8861\u6216\u8005\u6570\u636e\u6301\u4e45\u5316\u90fd\u6709\u5f88\u597d\u7684\u652f\u6301\u3002 3.2\u3000Redis \u00b6 Redis\u662f\u4e00\u4e2a\u57fa\u4e8eKey-Value\u5bf9\u7684NoSQL\u6570\u636e\u5e93\uff0c\u5f00\u53d1\u7ef4\u62a4\u5f88\u6d3b\u8dc3\u3002\u867d\u7136\u5b83\u662f\u4e00\u4e2aKey-Value\u6570\u636e\u5e93\u5b58\u50a8\u7cfb\u7edf\uff0c\u4f46\u5b83\u672c\u8eab\u652f\u6301MQ\u529f\u80fd\uff0c\u6240\u4ee5\u5b8c\u5168\u53ef\u4ee5\u5f53\u505a\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u7684\u961f\u5217\u670d\u52a1\u6765\u4f7f\u7528\u3002\u5bf9\u4e8eRabbitMQ\u548cRedis\u7684\u5165\u961f\u548c\u51fa\u961f\u64cd\u4f5c\uff0c\u5404\u6267\u884c100\u4e07\u6b21\uff0c\u6bcf10\u4e07\u6b21\u8bb0\u5f55\u4e00\u6b21\u6267\u884c\u65f6\u95f4\u3002\u6d4b\u8bd5\u6570\u636e\u5206\u4e3a128Bytes\u3001512Bytes\u30011K\u548c10K\u56db\u4e2a\u4e0d\u540c\u5927\u5c0f\u7684\u6570\u636e\u3002\u5b9e\u9a8c\u8868\u660e\uff1a\u5165\u961f\u65f6\uff0c\u5f53\u6570\u636e\u6bd4\u8f83\u5c0f\u65f6Redis\u7684\u6027\u80fd\u8981\u9ad8\u4e8eRabbitMQ\uff0c\u800c\u5982\u679c\u6570\u636e\u5927\u5c0f\u8d85\u8fc7\u4e8610K\uff0cRedis\u5219\u6162\u7684\u65e0\u6cd5\u5fcd\u53d7\uff1b\u51fa\u961f\u65f6\uff0c\u65e0\u8bba\u6570\u636e\u5927\u5c0f\uff0cRedis\u90fd\u8868\u73b0\u51fa\u975e\u5e38\u597d\u7684\u6027\u80fd\uff0c\u800cRabbitMQ\u7684\u51fa\u961f\u6027\u80fd\u5219\u8fdc\u4f4e\u4e8eRedis\u3002 3.3\u3000ZeroMQ \u00b6 ZeroMQ\u53f7\u79f0\u6700\u5feb\u7684\u6d88\u606f\u961f\u5217\u7cfb\u7edf\uff0c\u5c24\u5176\u9488\u5bf9\u5927\u541e\u5410\u91cf\u7684\u9700\u6c42\u573a\u666f\u3002ZeroMQ\u80fd\u591f\u5b9e\u73b0RabbitMQ\u4e0d\u64c5\u957f\u7684\u9ad8\u7ea7/\u590d\u6742\u7684\u961f\u5217\uff0c\u4f46\u662f\u5f00\u53d1\u4eba\u5458\u9700\u8981\u81ea\u5df1\u7ec4\u5408\u591a\u79cd\u6280\u672f\u6846\u67b6\uff0c\u6280\u672f\u4e0a\u7684\u590d\u6742\u5ea6\u662f\u5bf9\u8fd9MQ\u80fd\u591f\u5e94\u7528\u6210\u529f\u7684\u6311\u6218\u3002ZeroMQ\u5177\u6709\u4e00\u4e2a\u72ec\u7279\u7684\u975e\u4e2d\u95f4\u4ef6\u7684\u6a21\u5f0f\uff0c\u4f60\u4e0d\u9700\u8981\u5b89\u88c5\u548c\u8fd0\u884c\u4e00\u4e2a\u6d88\u606f\u670d\u52a1\u5668\u6216\u4e2d\u95f4\u4ef6\uff0c\u56e0\u4e3a\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u5c06\u626e\u6f14\u8fd9\u4e2a\u670d\u52a1\u5668\u89d2\u8272\u3002\u4f60\u53ea\u9700\u8981\u7b80\u5355\u7684\u5f15\u7528ZeroMQ\u7a0b\u5e8f\u5e93\uff0c\u53ef\u4ee5\u4f7f\u7528NuGet\u5b89\u88c5\uff0c\u7136\u540e\u4f60\u5c31\u53ef\u4ee5\u6109\u5feb\u7684\u5728\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u53d1\u9001\u6d88\u606f\u4e86\u3002\u4f46\u662fZeroMQ\u4ec5\u63d0\u4f9b\u975e\u6301\u4e45\u6027\u7684\u961f\u5217\uff0c\u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u5b95\u673a\uff0c\u6570\u636e\u5c06\u4f1a\u4e22\u5931\u3002\u5176\u4e2d\uff0cTwitter\u7684Storm 0.9.0\u4ee5\u524d\u7684\u7248\u672c\u4e2d\u9ed8\u8ba4\u4f7f\u7528ZeroMQ\u4f5c\u4e3a\u6570\u636e\u6d41\u7684\u4f20\u8f93\uff08Storm\u4ece0.9\u7248\u672c\u5f00\u59cb\u540c\u65f6\u652f\u6301ZeroMQ\u548cNetty\u4f5c\u4e3a\u4f20\u8f93\u6a21\u5757\uff09\u3002 3.4\u3000ActiveMQ \u00b6 ActiveMQ\u662fApache\u4e0b\u7684\u4e00\u4e2a\u5b50\u9879\u76ee\u3002 \u7c7b\u4f3c\u4e8eZeroMQ\uff0c\u5b83\u80fd\u591f\u4ee5\u4ee3\u7406\u4eba\u548c\u70b9\u5bf9\u70b9\u7684\u6280\u672f\u5b9e\u73b0\u961f\u5217\u3002\u540c\u65f6\u7c7b\u4f3c\u4e8eRabbitMQ\uff0c\u5b83\u5c11\u91cf\u4ee3\u7801\u5c31\u53ef\u4ee5\u9ad8\u6548\u5730\u5b9e\u73b0\u9ad8\u7ea7\u5e94\u7528\u573a\u666f\u3002 3.5\u3000Kafka/Jafka \u00b6 Kafka\u662fApache\u4e0b\u7684\u4e00\u4e2a\u5b50\u9879\u76ee\uff0c\u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u8de8\u8bed\u8a00\u5206\u5e03\u5f0f\u53d1\u5e03/\u8ba2\u9605\u6d88\u606f\u961f\u5217\u7cfb\u7edf\uff0c\u800cJafka\u662f\u5728Kafka\u4e4b\u4e0a\u5b75\u5316\u800c\u6765\u7684\uff0c\u5373Kafka\u7684\u4e00\u4e2a\u5347\u7ea7\u7248\u3002\u5177\u6709\u4ee5\u4e0b\u7279\u6027\uff1a\u5feb\u901f\u6301\u4e45\u5316\uff0c\u53ef\u4ee5\u5728O(1)\u7684\u7cfb\u7edf\u5f00\u9500\u4e0b\u8fdb\u884c\u6d88\u606f\u6301\u4e45\u5316\uff1b\u9ad8\u541e\u5410\uff0c\u5728\u4e00\u53f0\u666e\u901a\u7684\u670d\u52a1\u5668\u4e0a\u65e2\u53ef\u4ee5\u8fbe\u523010W/s\u7684\u541e\u5410\u901f\u7387\uff1b\u5b8c\u5168\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0cBroker\u3001Producer\u3001Consumer\u90fd\u539f\u751f\u81ea\u52a8\u652f\u6301\u5206\u5e03\u5f0f\uff0c\u81ea\u52a8\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861\uff1b\u652f\u6301Hadoop\u6570\u636e\u5e76\u884c\u52a0\u8f7d\uff0c\u5bf9\u4e8e\u50cfHadoop\u7684\u4e00\u6837\u7684\u65e5\u5fd7\u6570\u636e\u548c\u79bb\u7ebf\u5206\u6790\u7cfb\u7edf\uff0c\u4f46\u53c8\u8981\u6c42\u5b9e\u65f6\u5904\u7406\u7684\u9650\u5236\uff0c\u8fd9\u662f\u4e00\u4e2a\u53ef\u884c\u7684\u89e3\u51b3\u65b9\u6848\u3002Kafka\u901a\u8fc7Hadoop\u7684\u5e76\u884c\u52a0\u8f7d\u673a\u5236\u7edf\u4e00\u4e86\u5728\u7ebf\u548c\u79bb\u7ebf\u7684\u6d88\u606f\u5904\u7406\u3002Apache Kafka\u76f8\u5bf9\u4e8eActiveMQ\u662f\u4e00\u4e2a\u975e\u5e38\u8f7b\u91cf\u7ea7\u7684\u6d88\u606f\u7cfb\u7edf\uff0c\u9664\u4e86\u6027\u80fd\u975e\u5e38\u597d\u4e4b\u5916\uff0c\u8fd8\u662f\u4e00\u4e2a\u5de5\u4f5c\u826f\u597d\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\u3002 4\u3001Kafka\u4e2d\u7684\u672f\u8bed\u89e3\u91ca \u00b6 4.1\u3000\u6982\u8ff0 \u00b6 \u5728\u6df1\u5165\u7406\u89e3Kafka\u4e4b\u524d\uff0c\u5148\u4ecb\u7ecd\u4e00\u4e0bKafka\u4e2d\u7684\u672f\u8bed\u3002\u4e0b\u56fe\u5c55\u793a\u4e86Kafka\u7684\u76f8\u5173\u672f\u8bed\u4ee5\u53ca\u4e4b\u95f4\u7684\u5173\u7cfb\uff1a 4.2\u3000broker \u00b6 Kafka \u96c6\u7fa4\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u8282\u70b9\u79f0\u4e3abroker\u3002 broker\u5b58\u50a8topic\u7684\u6570\u636e\u3002\u5982\u679c\u67d0topic\u6709N\u4e2apartition\uff0c\u96c6\u7fa4\u6709N\u4e2abroker\uff0c\u90a3\u4e48\u6bcf\u4e2abroker\u5b58\u50a8\u8be5topic\u7684\u4e00\u4e2apartition\u3002 \u5982\u679c\u67d0topic\u6709N\u4e2apartition\uff0c\u96c6\u7fa4\u6709(N+M)\u4e2abroker\uff0c\u90a3\u4e48\u5176\u4e2d\u6709N\u4e2abroker\u5b58\u50a8\u8be5topic\u7684\u4e00\u4e2apartition\uff0c\u5269\u4e0b\u7684M\u4e2abroker\u4e0d\u5b58\u50a8\u8be5topic\u7684partition\u6570\u636e\u3002 \u5982\u679c\u67d0topic\u6709N\u4e2apartition\uff0c\u96c6\u7fa4\u4e2dbroker\u6570\u76ee\u5c11\u4e8eN\u4e2a\uff0c\u90a3\u4e48\u4e00\u4e2abroker\u5b58\u50a8\u8be5topic\u7684\u4e00\u4e2a\u6216\u591a\u4e2apartition\u3002\u5728\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u5c3d\u91cf\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\u7684\u53d1\u751f\uff0c\u8fd9\u79cd\u60c5\u51b5\u5bb9\u6613\u5bfc\u81f4Kafka\u96c6\u7fa4\u6570\u636e\u4e0d\u5747\u8861\u3002 4.3\u3000Topic \u00b6 \u6bcf\u6761\u53d1\u5e03\u5230Kafka\u96c6\u7fa4\u7684\u6d88\u606f\u90fd\u6709\u4e00\u4e2a\u7c7b\u522b\uff0c\u8fd9\u4e2a\u7c7b\u522b\u88ab\u79f0\u4e3aTopic\u3002\uff08\u7269\u7406\u4e0a\u4e0d\u540cTopic\u7684\u6d88\u606f\u5206\u5f00\u5b58\u50a8\uff0c\u903b\u8f91\u4e0a\u4e00\u4e2aTopic\u7684\u6d88\u606f\u867d\u7136\u4fdd\u5b58\u4e8e\u4e00\u4e2a\u6216\u591a\u4e2abroker\u4e0a\u4f46\u7528\u6237\u53ea\u9700\u6307\u5b9a\u6d88\u606f\u7684Topic\u5373\u53ef\u751f\u4ea7\u6216\u6d88\u8d39\u6570\u636e\u800c\u4e0d\u5fc5\u5173\u5fc3\u6570\u636e\u5b58\u4e8e\u4f55\u5904\uff09 \u7c7b\u4f3c\u4e8e\u6570\u636e\u5e93\u7684\u8868\u540d 4.3\u3000 Partition \u00b6 topic\u4e2d\u7684\u6570\u636e\u5206\u5272\u4e3a\u4e00\u4e2a\u6216\u591a\u4e2apartition\u3002\u6bcf\u4e2atopic\u81f3\u5c11\u6709\u4e00\u4e2apartition\u3002\u6bcf\u4e2apartition\u4e2d\u7684\u6570\u636e\u4f7f\u7528\u591a\u4e2asegment\u6587\u4ef6\u5b58\u50a8\u3002partition\u4e2d\u7684\u6570\u636e\u662f\u6709\u5e8f\u7684\uff0c\u4e0d\u540cpartition\u95f4\u7684\u6570\u636e\u4e22\u5931\u4e86\u6570\u636e\u7684\u987a\u5e8f\u3002\u5982\u679ctopic\u6709\u591a\u4e2apartition\uff0c\u6d88\u8d39\u6570\u636e\u65f6\u5c31\u4e0d\u80fd\u4fdd\u8bc1\u6570\u636e\u7684\u987a\u5e8f\u3002\u5728\u9700\u8981\u4e25\u683c\u4fdd\u8bc1\u6d88\u606f\u7684\u6d88\u8d39\u987a\u5e8f\u7684\u573a\u666f\u4e0b\uff0c\u9700\u8981\u5c06partition\u6570\u76ee\u8bbe\u4e3a1\u3002 4.4\u3000Producer \u00b6 \u751f\u4ea7\u8005\u5373\u6570\u636e\u7684\u53d1\u5e03\u8005\uff0c\u8be5\u89d2\u8272\u5c06\u6d88\u606f\u53d1\u5e03\u5230Kafka\u7684topic\u4e2d\u3002broker\u63a5\u6536\u5230\u751f\u4ea7\u8005\u53d1\u9001\u7684\u6d88\u606f\u540e\uff0cbroker\u5c06\u8be5\u6d88\u606f \u8ffd\u52a0 \u5230\u5f53\u524d\u7528\u4e8e\u8ffd\u52a0\u6570\u636e\u7684segment\u6587\u4ef6\u4e2d\u3002\u751f\u4ea7\u8005\u53d1\u9001\u7684\u6d88\u606f\uff0c\u5b58\u50a8\u5230\u4e00\u4e2apartition\u4e2d\uff0c\u751f\u4ea7\u8005\u4e5f\u53ef\u4ee5\u6307\u5b9a\u6570\u636e\u5b58\u50a8\u7684partition\u3002 4.5\u3000Consumer \u00b6 \u6d88\u8d39\u8005\u53ef\u4ee5\u4ecebroker\u4e2d\u8bfb\u53d6\u6570\u636e\u3002\u6d88\u8d39\u8005\u53ef\u4ee5\u6d88\u8d39\u591a\u4e2atopic\u4e2d\u7684\u6570\u636e\u3002 4.6\u3000Consumer Group \u00b6 \u6bcf\u4e2aConsumer\u5c5e\u4e8e\u4e00\u4e2a\u7279\u5b9a\u7684Consumer Group\uff08\u53ef\u4e3a\u6bcf\u4e2aConsumer\u6307\u5b9agroup name\uff0c\u82e5\u4e0d\u6307\u5b9agroup name\u5219\u5c5e\u4e8e\u9ed8\u8ba4\u7684group\uff09\u3002 4.7\u3000Leader \u00b6 \u6bcf\u4e2apartition\u6709\u591a\u4e2a\u526f\u672c\uff0c\u5176\u4e2d\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\u4f5c\u4e3aLeader\uff0cLeader\u662f\u5f53\u524d\u8d1f\u8d23\u6570\u636e\u7684\u8bfb\u5199\u7684partition\u3002 4.8\u3000Follower \u00b6 Follower\u8ddf\u968fLeader\uff0c\u6240\u6709\u5199\u8bf7\u6c42\u90fd\u901a\u8fc7Leader\u8def\u7531\uff0c\u6570\u636e\u53d8\u66f4\u4f1a\u5e7f\u64ad\u7ed9\u6240\u6709Follower\uff0cFollower\u4e0eLeader\u4fdd\u6301\u6570\u636e\u540c\u6b65\u3002\u5982\u679cLeader\u5931\u6548\uff0c\u5219\u4eceFollower\u4e2d\u9009\u4e3e\u51fa\u4e00\u4e2a\u65b0\u7684Leader\u3002\u5f53Follower\u4e0eLeader\u6302\u6389\u3001\u5361\u4f4f\u6216\u8005\u540c\u6b65\u592a\u6162\uff0cleader\u4f1a\u628a\u8fd9\u4e2afollower\u4ece\u201cin sync replicas\u201d\uff08ISR\uff09\u5217\u8868\u4e2d\u5220\u9664\uff0c\u91cd\u65b0\u521b\u5efa\u4e00\u4e2aFollower\u3002 03-kafka\u5b89\u88c5 11:21 \u00b6 \u542f\u52a8\u865a\u62df\u673a\u4e4b\u540e\uff0c\u4fee\u6539\u7528\u6237\u540d\u4e3aroot,\u5bc6\u7801\u4e3aitcast \u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a service zookeeper start service kafka start 04-\u5165\u95e8\u6848\u4f8b\u751f\u4ea7\u8005 13:15 \u00b6 package com.itheima.kafka.simple ; import org.apache.kafka.clients.producer.* ; import org.apache.kafka.common.serialization.StringSerializer ; import java.util.Properties ; /** * Kafka \u6d88\u606f\u751f\u4ea7\u8005 */ public class ProducerFastStart { // Kafka\u96c6\u7fa4\u5730\u5740 private static final String brokerList = \"192.168.226.134:9092\" ; // \u4e3b\u9898\u540d\u79f0-\u4e4b\u524d\u5df2\u7ecf\u521b\u5efa private static final String topic = \"kafka-hello\" ; public static void main ( String [] args ) { Properties properties = new Properties (); // \u8bbe\u7f6ekey\u5e8f\u5217\u5316\u5668 properties . put ( ProducerConfig . KEY_SERIALIZER_CLASS_CONFIG , StringSerializer . class . getName ()); // \u8bbe\u7f6e\u91cd\u8bd5\u6b21\u6570 properties . put ( ProducerConfig . RETRIES_CONFIG , 10 ); // \u8bbe\u7f6e\u503c\u5e8f\u5217\u5316\u5668 properties . put ( ProducerConfig . VALUE_SERIALIZER_CLASS_CONFIG , StringSerializer . class . getName ()); // \u8bbe\u7f6e\u96c6\u7fa4\u5730\u5740 properties . put ( ProducerConfig . BOOTSTRAP_SERVERS_CONFIG , brokerList ); // KafkaProducer KafkaProducer < String , String > producer = new KafkaProducer < String , String > ( properties ); //\u5c01\u88c5\u6d88\u606f ProducerRecord < String , String > record = new ProducerRecord < String , String > ( topic , \"Kafka-demo-001\" , \"hello, Kafka!\" ); try { //\u53d1\u9001\u6d88\u606f producer . send ( record ); } catch ( Exception e ) { e . printStackTrace (); } producer . close (); } } 05-\u6d88\u8d39\u8005 08:23 \u00b6 package com.itheima.kafka.simple ; import org.apache.kafka.clients.consumer.* ; import org.apache.kafka.common.serialization.StringDeserializer ; import java.time.Duration ; import java.util.Collections ; import java.util.Properties ; /** * Kafka \u6d88\u606f\u6d88\u8d39\u8005 */ public class ConsumerFastStart { // Kafka\u96c6\u7fa4\u5730\u5740 private static final String brokerList = \"192.168.200.130:9092\" ; // \u4e3b\u9898\u540d\u79f0-\u4e4b\u524d\u5df2\u7ecf\u521b\u5efa private static final String topic = \"kafka-hello\" ; // \u6d88\u8d39\u7ec4 private static final String groupId = \"group.demo1\" ; public static void main ( String [] args ) { Properties properties = new Properties (); properties . put ( ConsumerConfig . BOOTSTRAP_SERVERS_CONFIG , brokerList ); properties . put ( ConsumerConfig . KEY_DESERIALIZER_CLASS_CONFIG , StringDeserializer . class . getName ()); properties . put ( ConsumerConfig . VALUE_DESERIALIZER_CLASS_CONFIG , StringDeserializer . class . getName ()); properties . put ( ConsumerConfig . GROUP_ID_CONFIG , groupId ); KafkaConsumer < String , String > consumer = new KafkaConsumer < String , String > ( properties ); consumer . subscribe ( Collections . singletonList ( topic )); while ( true ) { ConsumerRecords < String , String > records = consumer . poll ( Duration . ofMillis ( 1000 )); for ( ConsumerRecord < String , String > record : records ) { System . out . println ( record . value ()); } } } } onsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(1000)); \u6307\u5b9a\u76841\u79d2\u662f\u7b49\u5f85\u6d88\u606f\u8d85\u65f6\u65f6\u95f4 \u5047\u8bbe\u6d88\u8d39\u8005\u80fd\u6536\u5230\u4e00\u6761\u6d88\u606f\uff0ckafka\u4f1a\u76f4\u63a5\u5c06\u4e00\u6761\u6d88\u606f\u53d1\u9001\u7ed9\u6d88\u8d39\u8005\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1kafka\u53ca\u65f6\u6027 06-\u6d4b\u8bd5 03:10 \u00b6 \u6bcf\u4e2a\u7ec4\u53ea\u80fd\u63a5\u6536\u52301\u4e2a\u6d88\u606f\uff0c\u4e0d\u540c\u7ec4\u53ea\u8981\u8ba2\u9605\u4e86topic\uff0c\u90fd\u80fd\u63a5\u6536\u5230\u8fd9\u4e2a\u6d88\u606f\u3002 07-\u76f8\u5173\u6982\u5ff5 09:48 \u00b6 08-\u751f\u4ea7\u8005\u539f\u7406 06\uff1a37 \u00b6 \u53d1\u9001\u5e76\u5fd8\u8bb0\uff08fire-and-forget) One Way \u628a\u6d88\u606f\u53d1\u9001\u7ed9\u670d\u52a1\u5668\uff0c\u5e76\u4e0d\u5173\u5fc3\u5b83\u662f\u5426\u6b63\u5e38\u5230\u8fbe\uff0c\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u6d88\u606f\u4f1a\u6b63\u5e38\u5230\u8fbe\uff0c\u56e0\u4e3akafka\u662f\u9ad8\u53ef\u7528\u7684\uff0c\u800c\u4e14\u751f\u4ea7\u8005\u4f1a\u81ea\u52a8\u5c1d\u8bd5\u91cd\u53d1\uff0c\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u6709\u65f6\u5019\u4f1a\u4e22\u5931\u4e00\u4e9b\u4fe1\u606f \u540c\u6b65\u53d1\u9001 \u4f7f\u7528send()\u65b9\u6cd5\u53d1\u9001\uff0c\u5b83\u4f1a\u8fd4\u56de\u4e00\u4e2aFuture\u5bf9\u8c61\uff0c\u8c03\u7528get()\u65b9\u6cd5\u8fdb\u884c\u7b49\u5f85\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053\u6d88\u606f\u662f\u5426\u53d1\u9001\u6210\u529f //\u53d1\u9001\u6d88\u606f try { RecordMetadata recordMetadata = producer . send ( record ). get (); System . out . println ( recordMetadata . offset ()); //\u83b7\u53d6\u504f\u79fb\u91cf } catch ( Exception e ){ e . printStackTrace (); } \u5982\u679c\u670d\u52a1\u5668\u8fd4\u56de\u9519\u8bef\uff0cget()\u65b9\u6cd5\u4f1a\u629b\u51fa\u5f02\u5e38\uff0c\u5982\u679c\u6ca1\u6709\u53d1\u751f\u9519\u8bef\uff0c\u6211\u4eec\u5c31\u4f1a\u5f97\u5230\u4e00\u4e2aRecordMetadata\u5bf9\u8c61\uff0c\u53ef\u4ee5\u7528\u5b83\u6765\u83b7\u53d6\u6d88\u606f\u7684\u504f\u79fb\u91cf \u5f02\u6b65\u53d1\u9001 \u8c03\u7528send()\u65b9\u6cd5\uff0c\u5e76\u6307\u5b9a\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u670d\u52a1\u5668\u5728\u8fd4\u56de\u54cd\u5e94\u65f6\u8c03\u7528\u51fd\u6570\u3002\u5982\u4e0b\u4ee3\u7801 //\u53d1\u9001\u6d88\u606f try { producer . send ( record , new Callback () { @Override public void onCompletion ( RecordMetadata recordMetadata , Exception e ) { if ( e != null ){ e . printStackTrace (); } System . out . println ( recordMetadata . offset ()); } }); //\u6267\u884c\u5176\u4ed6\u903b\u8f91 } catch ( Exception e ){ e . printStackTrace (); } \u5982\u679ckafka\u8fd4\u56de\u4e00\u4e2a\u9519\u8bef\uff0conCompletion()\u65b9\u6cd5\u4f1a\u629b\u51fa\u4e00\u4e2a\u975e\u7a7a\uff08non null\uff09\u5f02\u5e38\uff0c\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u5904\u7406\uff0c\u6bd4\u5982\u8bb0\u5f55\u9519\u8bef\u65e5\u5fd7\uff0c\u6216\u8005\u628a\u6d88\u606f\u5199\u5165\u201c\u9519\u8bef\u6d88\u606f\u201d\u6587\u4ef6\u4e2d\uff0c\u65b9\u4fbf\u540e\u671f\u8fdb\u884c\u5206\u6790\u3002 09-\u751f\u4ea7\u8005\u914d\u7f6e 04:03 \u00b6 \u751f\u4ea7\u8005\u8fd8\u6709\u5f88\u591a\u53ef\u914d\u7f6e\u7684\u53c2\u6570\uff0c\u5728kafka\u5b98\u65b9\u6587\u6863\u4e2d\u90fd\u6709\u8bf4\u660e\uff0c\u5927\u90e8\u5206\u90fd\u6709\u5408\u7406\u7684\u9ed8\u8ba4\u503c\uff0c\u6240\u4ee5\u6ca1\u6709\u5fc5\u8981\u53bb\u4fee\u6539\u5b83\u4eec\uff0c\u4e0d\u8fc7\u6709\u51e0\u4e2a\u53c2\u6570\u5728\u5185\u5b58\u4f7f\u7528\uff0c\u6027\u80fd\u548c\u53ef\u9760\u6027\u65b9\u6cd5\u5bf9\u751f\u4ea7\u8005\u6709\u5f71\u54cd acks \u6307\u7684\u662fproducer\u7684\u6d88\u606f\u53d1\u9001\u786e\u8ba4\u673a\u5236 acks=0 \u751f\u4ea7\u8005\u5728\u6210\u529f\u5199\u5165\u6d88\u606f\u4e4b\u524d\u4e0d\u4f1a\u7b49\u5f85\u4efb\u4f55\u6765\u81ea\u670d\u52a1\u5668\u7684\u54cd\u5e94\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u5f53\u4e2d\u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u5bfc\u81f4\u670d\u52a1\u5668\u6ca1\u6709\u6536\u5230\u6d88\u606f\uff0c\u90a3\u4e48\u751f\u4ea7\u8005\u5c31\u65e0\u4ece\u5f97\u77e5\uff0c\u6d88\u606f\u4e5f\u5c31\u4e22\u5931\u4e86\u3002\u4e0d\u8fc7\uff0c\u56e0\u4e3a\u751f\u4ea7\u8005\u4e0d\u9700\u8981\u7b49\u5f85\u670d\u52a1\u5668\u7684\u54cd\u5e94\uff0c\u6240\u4ee5\u5b83\u53ef\u4ee5\u4ee5\u7f51\u7edc\u80fd\u591f\u652f\u6301\u7684\u6700\u5927\u901f\u5ea6\u53d1\u9001\u6d88\u606f\uff0c\u4ece\u800c\u8fbe\u5230\u5f88\u9ad8\u7684\u541e\u5410\u91cf\u3002 acks=1 \u53ea\u8981\u96c6\u7fa4\u9996\u9886\u8282\u70b9\u6536\u5230\u6d88\u606f\uff0c\u751f\u4ea7\u8005\u5c31\u4f1a\u6536\u5230\u4e00\u4e2a\u6765\u81ea\u670d\u52a1\u5668\u7684\u6210\u529f\u54cd\u5e94\uff0c\u5982\u679c\u6d88\u606f\u65e0\u6cd5\u5230\u8fbe\u9996\u9886\u8282\u70b9\uff0c\u751f\u4ea7\u8005\u4f1a\u6536\u5230\u4e00\u4e2a\u9519\u8bef\u54cd\u5e94\uff0c\u4e3a\u4e86\u907f\u514d\u6570\u636e\u4e22\u5931\uff0c\u751f\u4ea7\u8005\u4f1a\u91cd\u53d1\u6d88\u606f\u3002 acks=all \u53ea\u6709\u5f53\u6240\u6709\u53c2\u4e0e\u8d4b\u503c\u7684\u8282\u70b9\u5168\u90e8\u6536\u5230\u6d88\u606f\u65f6\uff0c\u751f\u4ea7\u8005\u624d\u4f1a\u6536\u5230\u4e00\u4e2a\u6765\u81ea\u670d\u52a1\u5668\u7684\u6210\u529f\u54cd\u5e94\uff0c\u8fd9\u79cd\u6a21\u5f0f\u662f\u6700\u5b89\u5168\u7684\uff0c\u5b83\u53ef\u4ee5\u4fdd\u8bc1\u4e0d\u6b62\u4e00\u4e2a\u670d\u52a1\u5668\u6536\u5230\u6d88\u606f\uff0c\u5c31\u7b97\u6709\u670d\u52a1\u5668\u53d1\u751f\u5d29\u6e83\uff0c\u6574\u4e2a\u96c6\u7fa4\u4ecd\u7136\u53ef\u4ee5\u8fd0\u884c\u3002\u4e0d\u8fc7\u4ed6\u7684\u5ef6\u8fdf\u6bd4acks=1\u65f6\u66f4\u9ad8\u3002 retries \u751f\u4ea7\u8005\u4ece\u670d\u52a1\u5668\u6536\u5230\u7684\u9519\u8bef\u6709\u53ef\u80fd\u662f\u4e34\u65f6\u6027\u9519\u8bef\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cretries\u53c2\u6570\u7684\u503c\u51b3\u5b9a\u4e86\u751f\u4ea7\u8005\u53ef\u4ee5\u91cd\u53d1\u6d88\u606f\u7684\u6b21\u6570\uff0c\u5982\u679c\u8fbe\u5230\u8fd9\u4e2a\u6b21\u6570\uff0c\u751f\u4ea7\u8005\u4f1a\u653e\u5f03\u91cd\u8bd5\u8fd4\u56de\u9519\u8bef\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u751f\u4ea7\u8005\u4f1a\u5728\u6bcf\u6b21\u91cd\u8bd5\u4e4b\u95f4\u7b49\u5f85100ms 10-\u6d88\u8d39\u8005\u539f\u7406 04:30 \u00b6 enable.auto.commit \u8be5\u5c5e\u6027\u6307\u5b9a\u4e86\u6d88\u8d39\u8005\u662f\u5426\u81ea\u52a8\u63d0\u4ea4\u504f\u79fb\u91cf\uff0c\u9ed8\u8ba4\u503c\u662ftrue\u3002\u4e3a\u4e86\u5c3d\u91cf\u907f\u514d\u51fa\u73b0\u91cd\u590d\u6570\u636e\u548c\u6570\u636e\u4e22\u5931\uff0c\u53ef\u4ee5\u628a\u5b83\u8bbe\u7f6e\u4e3afalse\uff0c\u7531\u81ea\u5df1\u63a7\u5236\u4f55\u65f6\u63d0\u4ea4\u504f\u79fb\u91cf\u3002\u5982\u679c\u628a\u5b83\u8bbe\u7f6e\u4e3atrue,\u8fd8\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e auto.commit.interval.ms \u5c5e\u6027\u6765\u63a7\u5236\u63d0\u4ea4\u7684\u9891\u7387\u3002 auto.offset.reset earliest \u5f53\u5404\u5206\u533a\u4e0b\u6709\u5df2\u63d0\u4ea4\u7684offset\u65f6\uff0c\u4ece\u63d0\u4ea4\u7684offset\u5f00\u59cb\u6d88\u8d39\uff1b\u65e0\u63d0\u4ea4\u7684offset\u65f6\uff0c\u4ece\u5934\u5f00\u59cb\u6d88\u8d39 \u5e42\u7b49\u6027\u4fdd\u8bc1 latest \u5f53\u5404\u5206\u533a\u4e0b\u6709\u5df2\u63d0\u4ea4\u7684offset\u65f6\uff0c\u4ece\u63d0\u4ea4\u7684offset\u5f00\u59cb\u6d88\u8d39\uff1b\u65e0\u63d0\u4ea4\u7684offset\u65f6\uff0c\u6d88\u8d39\u65b0\u4ea7\u751f\u7684\u8be5\u5206\u533a\u4e0b\u7684\u6570\u636e earliest \u4f1a\u91cd\u590d\u6d88\u8d39\uff0c\u4e0d\u4f1a\u4e22\u6570\u636e latest\u4f1a\u4e22\u6570\u636e\uff0c\u4f46\u662f\u4e0d\u4f1a\u91cd\u590d\u6d88\u8d39 none topic\u5404\u5206\u533a\u90fd\u5b58\u5728\u5df2\u63d0\u4ea4\u7684offset\u65f6\uff0c\u4eceoffset\u540e\u5f00\u59cb\u6d88\u8d39\uff1b\u53ea\u8981\u6709\u4e00\u4e2a\u5206\u533a\u4e0d\u5b58\u5728\u5df2\u63d0\u4ea4\u7684offset\uff0c\u5219\u629b\u51fa\u5f02\u5e38 anything else \u5411consumer\u629b\u51fa\u5f02\u5e38 11-\u63d0\u4ea4\u548c\u504f\u79fb\u91cf 11:23 \u00b6 12-\u96c6\u6210spring boot 09:15 \u00b6 \u751f\u4ea7\u8005\uff1a server : port : 9991 spring : application : name : kafka-demo kafka : bootstrap-servers : 192.168.200.130:9092 #kafka\u96c6\u7fa4\u5730\u5740 producer : retries : 10 #\u751f\u4ea7\u8005\u6295\u9012\u6d88\u606f\u5931\u8d25\uff0c\u91cd\u8bd5\u6b21\u6570 batch-size : 16368 buffer-memory : 33554432 key-serializer : org.apache.kafka.common.serialization.StringSerializer #key\u5e8f\u5217\u5316\u5668->String value-serializer : org.apache.kafka.common.serialization.StringSerializer #value\u5e8f\u5217\u5316\u5668->String consumer : group-id : test-hello-group #\u6d88\u8d39\u8005\u7ec4\u540d 1.\u5982\u679c\u4e24\u4e2a\u6d88\u8d39\u8005\u5b9e\u4f8b\u5728\u4e00\u4e2a\u7ec4\u4e2d\uff0c\u53ea\u6709\u4e00\u4e2a\u80fd\u6d88\u8d39\u67d0\u4e2a\u5206\u533a #2.\u5982\u679c\u4e24\u4e2a\u6d88\u8d39\u8005\u4e0d\u5728\u4e00\u4e2a\u7ec4\u4e2d \u5e7f\u64ad auto-offset-reset : earliest #\u5982\u679c\u6ca1\u6709\u6536\u5230offset\uff0c\u4ece\u5934\u5f00\u59cb\u6d88\u8d39 enable-auto-commit : true #\u662f\u5426\u5f00\u542f\u81ea\u52a8\u63d0\u4ea4offset \u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u63d0\u4ea4 key-deserializer : org.apache.kafka.common.serialization.StringDeserializer value-deserializer : org.apache.kafka.common.serialization.StringDeserializer package com.itheima.kafka.controller ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.kafka.core.KafkaTemplate ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.RestController ; @RestController public class HelloController { @Autowired private KafkaTemplate < String , String > kafkaTemplate ; @GetMapping ( \"/hello\" ) public String hello (){ //\u7b2c\u4e00\u4e2a\u53c2\u6570\uff1atopics //\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff1a\u6d88\u606f\u5185\u5bb9 kafkaTemplate . send ( \"hello-itcast\" , \"key\" , \"hello springboot kafka\" ); return \"ok\" ; } } \u6d88\u8d39\u8005\uff1a package com.itheima.kafka.listener ; import org.apache.kafka.clients.consumer.ConsumerRecord ; import org.springframework.kafka.annotation.KafkaListener ; import org.springframework.stereotype.Component ; import java.util.Optional ; @Component public class HelloListener { @KafkaListener ( topics = { \"wm.news.auto.scan.topic\" }) public void receiverMessage ( ConsumerRecord <? , ?> record ){ Optional <? extends ConsumerRecord <? , ?>> optional = Optional . ofNullable ( record ); if ( optional . isPresent ()){ Object value = record . value (); System . out . println ( value ); } } } package com.itheima.kafka.listener ; import org.apache.kafka.clients.consumer.ConsumerRecord ; import org.springframework.kafka.annotation.KafkaListener ; import org.springframework.stereotype.Component ; import java.util.Optional ; @Component public class HelloListener { @KafkaListener ( topics = { \"wm.news.auto.scan.topic\" }) public void receiverMessage ( ConsumerRecord < String , String > record ){ String key = record . key (); String value = record . value (); } } 13-spring boot\u5bf9\u8c61\u4f20\u9012 04:02 \u00b6 @RestController public class HelloController { @Autowired private KafkaTemplate < String , String > kafkaTemplate ; @GetMapping ( \"/hello\" ) public String hello (){ //\u53d1\u9001\u6d88\u606f User user = new User (); user . setUsername ( \"zhangsan\" ); user . setAge ( 18 ); kafkaTemplate . send ( \"kafka-hello\" , JSON . toJSONString ( user )); return \"ok\" ; } } @Component public class HelloListener { @KafkaListener ( topics = { \"hello-itcast\" }) public void receiverMessage ( ConsumerRecord <? , ?> record ){ Optional <? extends ConsumerRecord <? , ?>> optional = Optional . ofNullable ( record ); if ( optional . isPresent ()){ Object value = record . value (); User user = JSON . parseObject (( String ) value , User . class ); System . out . println ( user ); } } } 14-\u4e91\u76fe\u4ecb\u7ecd 06:34 \u00b6 1.\u6ce8\u518c\u963f\u91cc\u4e91\u8d26\u53f7\uff08\u53ef\u4ee5\u4f7f\u7528\u652f\u4ed8\u5b9d\u626b\u7801\u767b\u5f55\uff09 2.\u5f00\u901a\u5185\u5bb9\u5b89\u5168 https://www.aliyun.com/product/lvwang 3.\u7533\u8bf7AK\u548cSK 15-\u6587\u672c\u5185\u5bb9\u5783\u573e\u68c0\u6d4b 14:38 \u00b6 \u641c\u7d22\u6587\u6863\uff1a\u6587\u672c\u5783\u573e\u5185\u5bb9\u68c0\u6d4b package com.itheima.aliyun.util ; import com.alibaba.fastjson.JSON ; import com.alibaba.fastjson.JSONArray ; import com.alibaba.fastjson.JSONObject ; import com.aliyun.oss.ClientException ; import com.aliyuncs.DefaultAcsClient ; import com.aliyuncs.IAcsClient ; import com.aliyuncs.exceptions.ServerException ; import com.aliyuncs.green.model.v20180509.TextScanRequest ; import com.aliyuncs.http.FormatType ; import com.aliyuncs.http.HttpResponse ; import com.aliyuncs.profile.DefaultProfile ; import com.aliyuncs.profile.IClientProfile ; import java.util.* ; public class Main { public static void main ( String [] args ) throws Exception { IClientProfile profile = DefaultProfile . getProfile ( \"cn-shanghai\" , \"LTAI4FmKL2EKYCGgN2az5M57\" , \"XjgvRoAGzM3rWQxKWDJx98VWOmO0Hz\" ); DefaultProfile . addEndpoint ( \"cn-shanghai\" , \"cn-shanghai\" , \"Green\" , \"green.cn-shanghai.aliyuncs.com\" ); IAcsClient client = new DefaultAcsClient ( profile ); TextScanRequest textScanRequest = new TextScanRequest (); textScanRequest . setAcceptFormat ( FormatType . JSON ); // \u6307\u5b9aAPI\u8fd4\u56de\u683c\u5f0f\u3002 textScanRequest . setHttpContentType ( FormatType . JSON ); textScanRequest . setMethod ( com . aliyuncs . http . MethodType . POST ); // \u6307\u5b9a\u8bf7\u6c42\u65b9\u6cd5\u3002 textScanRequest . setEncoding ( \"UTF-8\" ); textScanRequest . setRegionId ( \"cn-shanghai\" ); List < Map < String , Object >> tasks = new ArrayList < Map < String , Object >> (); Map < String , Object > task1 = new LinkedHashMap < String , Object > (); task1 . put ( \"dataId\" , UUID . randomUUID (). toString ()); /** * \u5f85\u68c0\u6d4b\u7684\u6587\u672c\uff0c\u957f\u5ea6\u4e0d\u8d85\u8fc710000\u4e2a\u5b57\u7b26\u3002 */ task1 . put ( \"content\" , \"\u6211\u662f\u4e00\u4e2a\u6587\u672c,\u4e70\u5356\u51b0\u6bd2\u662f\u8fdd\u6cd5\u7684\" ); tasks . add ( task1 ); JSONObject data = new JSONObject (); /** * \u68c0\u6d4b\u573a\u666f\u3002\u6587\u672c\u5783\u573e\u68c0\u6d4b\u8bf7\u4f20\u9012antispam\u3002 **/ data . put ( \"scenes\" , Arrays . asList ( \"antispam\" )); data . put ( \"tasks\" , tasks ); System . out . println ( JSON . toJSONString ( data , true )); textScanRequest . setHttpContent ( data . toJSONString (). getBytes ( \"UTF-8\" ), \"UTF-8\" , FormatType . JSON ); // \u8bf7\u52a1\u5fc5\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\u3002 textScanRequest . setConnectTimeout ( 3000 ); textScanRequest . setReadTimeout ( 6000 ); try { HttpResponse httpResponse = client . doAction ( textScanRequest ); if ( httpResponse . isSuccess ()){ JSONObject scrResponse = JSON . parseObject ( new String ( httpResponse . getHttpContent (), \"UTF-8\" )); System . out . println ( JSON . toJSONString ( scrResponse , true )); if ( 200 == scrResponse . getInteger ( \"code\" )) { JSONArray taskResults = scrResponse . getJSONArray ( \"data\" ); for ( Object taskResult : taskResults ) { if ( 200 == (( JSONObject ) taskResult ). getInteger ( \"code\" )){ JSONArray sceneResults = (( JSONObject ) taskResult ). getJSONArray ( \"results\" ); for ( Object sceneResult : sceneResults ) { String scene = (( JSONObject ) sceneResult ). getString ( \"scene\" ); String suggestion = (( JSONObject ) sceneResult ). getString ( \"suggestion\" ); //\u6839\u636escene\u548csuggetion\u505a\u76f8\u5173\u5904\u7406\u3002 //suggestion == pass\u8868\u793a\u672a\u547d\u4e2d\u5783\u573e\u3002suggestion == block\u8868\u793a\u547d\u4e2d\u4e86\u5783\u573e\uff0c\u53ef\u4ee5\u901a\u8fc7label\u5b57\u6bb5\u67e5\u770b\u547d\u4e2d\u7684\u5783\u573e\u5206\u7c7b\u3002 System . out . println ( \"args = [\" + scene + \"]\" ); System . out . println ( \"args = [\" + suggestion + \"]\" ); } } else { System . out . println ( \"task process fail:\" + (( JSONObject ) taskResult ). getInteger ( \"code\" )); } } } else { System . out . println ( \"detect not success. code:\" + scrResponse . getInteger ( \"code\" )); } } else { System . out . println ( \"response not success. status:\" + httpResponse . getStatus ()); } } catch ( ServerException e ) { e . printStackTrace (); } catch ( ClientException e ) { e . printStackTrace (); } catch ( Exception e ) { e . printStackTrace (); } } } 16-\u56fe\u7247\u5185\u5bb9\u68c0\u6d4b 11:35 \u00b6 package com.itheima.aliyun.util ; import com.alibaba.fastjson.JSON ; import com.alibaba.fastjson.JSONArray ; import com.alibaba.fastjson.JSONObject ; import com.aliyuncs.DefaultAcsClient ; import com.aliyuncs.IAcsClient ; import com.aliyuncs.green.model.v20180509.ImageSyncScanRequest ; import com.aliyuncs.http.FormatType ; import com.aliyuncs.http.HttpResponse ; import com.aliyuncs.http.MethodType ; import com.aliyuncs.http.ProtocolType ; import com.aliyuncs.profile.DefaultProfile ; import com.aliyuncs.profile.IClientProfile ; import java.util.* ; public class ImageScan { public static void main ( String [] args ) throws Exception { IClientProfile profile = DefaultProfile . getProfile ( \"cn-shanghai\" , \"LTAI4FmKL2EKYCGgN2az5M57\" , \"XjgvRoAGzM3rWQxKWDJx98VWOmO0Hz\" ); DefaultProfile . addEndpoint ( \"cn-shanghai\" , \"cn-shanghai\" , \"Green\" , \"green.cn-shanghai.aliyuncs.com\" ); IAcsClient client = new DefaultAcsClient ( profile ); ImageSyncScanRequest imageSyncScanRequest = new ImageSyncScanRequest (); // \u6307\u5b9aAPI\u8fd4\u56de\u683c\u5f0f\u3002 imageSyncScanRequest . setAcceptFormat ( FormatType . JSON ); // \u6307\u5b9a\u8bf7\u6c42\u65b9\u6cd5\u3002 imageSyncScanRequest . setMethod ( MethodType . POST ); imageSyncScanRequest . setEncoding ( \"utf-8\" ); //\u652f\u6301HTTP\u548cHTTPS\u3002 imageSyncScanRequest . setProtocol ( ProtocolType . HTTP ); JSONObject httpBody = new JSONObject (); /** * \u8bbe\u7f6e\u8981\u68c0\u6d4b\u7684\u573a\u666f\u3002\u8ba1\u8d39\u4f9d\u636e\u6b64\u5904\u4f20\u9012\u7684\u573a\u666f\u8ba1\u7b97\u3002 * \u4e00\u6b21\u8bf7\u6c42\u4e2d\u53ef\u4ee5\u540c\u65f6\u68c0\u6d4b\u591a\u5f20\u56fe\u7247\uff0c\u6bcf\u5f20\u56fe\u7247\u53ef\u4ee5\u540c\u65f6\u68c0\u6d4b\u591a\u4e2a\u98ce\u9669\u573a\u666f\uff0c\u8ba1\u8d39\u6309\u7167\u573a\u666f\u8ba1\u7b97\u3002 * \u4f8b\u5982\uff1a\u68c0\u6d4b2\u5f20\u56fe\u7247\uff0c\u573a\u666f\u4f20\u9012porn\u548cterrorism\uff0c\u8ba1\u8d39\u4f1a\u6309\u71672\u5f20\u56fe\u7247\u9274\u9ec4\uff0c2\u5f20\u56fe\u7247\u66b4\u6050\u68c0\u6d4b\u8ba1\u7b97\u3002 * porn\uff1a\u8868\u793a\u8272\u60c5\u573a\u666f\u68c0\u6d4b\u3002 */ httpBody . put ( \"scenes\" , Arrays . asList ( \"terrorism\" , \"porn\" )); /** * \u5982\u679c\u60a8\u8981\u68c0\u6d4b\u7684\u6587\u4ef6\u5b58\u4e8e\u672c\u5730\u670d\u52a1\u5668\u4e0a\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0b\u8ff0\u4ee3\u7801\u7247\u751f\u6210URL\u3002 * \u518d\u5c06\u8fd4\u56de\u7684URL\u4f5c\u4e3a\u56fe\u7247\u5730\u5740\u4f20\u9012\u5230\u670d\u52a1\u7aef\u8fdb\u884c\u68c0\u6d4b\u3002 */ String url = null ; ClientUploader clientUploader = ClientUploader . getImageClientUploader ( profile , false ); try { url = clientUploader . uploadFile ( \"E:\\\\heima-leadnews\\\\\u9ed1\u9a6c\u5934\u67612.0\\\\\u9ed1\u9a6c\u5934\u6761\u8bfe\u4ef6\\\\day06\\\\\u8d44\u6599\\\\\u56fe\u7247\\\\ak47.jpg\" ); } catch ( Exception e ){ e . printStackTrace (); } /** * \u8bbe\u7f6e\u5f85\u68c0\u6d4b\u56fe\u7247\u3002\u4e00\u5f20\u56fe\u7247\u5bf9\u5e94\u4e00\u4e2atask\u3002 * \u591a\u5f20\u56fe\u7247\u540c\u65f6\u68c0\u6d4b\u65f6\uff0c\u5904\u7406\u7684\u65f6\u95f4\u7531\u6700\u540e\u4e00\u4e2a\u5904\u7406\u5b8c\u7684\u56fe\u7247\u51b3\u5b9a\u3002 * \u901a\u5e38\u60c5\u51b5\u4e0b\u6279\u91cf\u68c0\u6d4b\u7684\u5e73\u5747\u54cd\u5e94\u65f6\u95f4\u6bd4\u5355\u5f20\u68c0\u6d4b\u7684\u8981\u957f\uff0c\u4e00\u6b21\u6279\u91cf\u63d0\u4ea4\u7684\u56fe\u7247\u6570\u8d8a\u591a\uff0c\u54cd\u5e94\u65f6\u95f4\u88ab\u62c9\u957f\u7684\u6982\u7387\u8d8a\u9ad8\u3002 * \u8fd9\u91cc\u4ee5\u5355\u5f20\u56fe\u7247\u68c0\u6d4b\u4f5c\u4e3a\u793a\u4f8b\u3002\u5982\u679c\u662f\u6279\u91cf\u56fe\u7247\u68c0\u6d4b\uff0c\u8bf7\u81ea\u884c\u6784\u5efa\u591a\u4e2atask\u3002 */ JSONObject task = new JSONObject (); task . put ( \"dataId\" , UUID . randomUUID (). toString ()); //\u8bbe\u7f6e\u56fe\u7247\u94fe\u63a5\u4e3a\u4e0a\u4f20\u540e\u7684URL\u3002 task . put ( \"url\" , url ); task . put ( \"time\" , new Date ()); httpBody . put ( \"tasks\" , Arrays . asList ( task )); imageSyncScanRequest . setHttpContent ( org . apache . commons . codec . binary . StringUtils . getBytesUtf8 ( httpBody . toJSONString ()), \"UTF-8\" , FormatType . JSON ); /** * \u8bf7\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\u3002\u670d\u52a1\u7aef\u5168\u94fe\u8def\u5904\u7406\u8d85\u65f6\u65f6\u95f4\u4e3a10\u79d2\uff0c\u8bf7\u505a\u76f8\u5e94\u8bbe\u7f6e\u3002 * \u5982\u679c\u60a8\u8bbe\u7f6e\u7684ReadTimeout\u5c0f\u4e8e\u670d\u52a1\u7aef\u5904\u7406\u7684\u65f6\u95f4\uff0c\u7a0b\u5e8f\u4e2d\u4f1a\u83b7\u5f97\u4e00\u4e2aread timeout\u5f02\u5e38\u3002 */ imageSyncScanRequest . setConnectTimeout ( 3000 ); imageSyncScanRequest . setReadTimeout ( 10000 ); HttpResponse httpResponse = null ; try { httpResponse = client . doAction ( imageSyncScanRequest ); } catch ( Exception e ) { e . printStackTrace (); } //\u670d\u52a1\u7aef\u63a5\u6536\u5230\u8bf7\u6c42\uff0c\u5e76\u5b8c\u6210\u5904\u7406\u540e\u8fd4\u56de\u7684\u7ed3\u679c\u3002 if ( httpResponse != null && httpResponse . isSuccess ()) { JSONObject scrResponse = JSON . parseObject ( org . apache . commons . codec . binary . StringUtils . newStringUtf8 ( httpResponse . getHttpContent ())); System . out . println ( JSON . toJSONString ( scrResponse , true )); int requestCode = scrResponse . getIntValue ( \"code\" ); //\u6bcf\u4e00\u5f20\u56fe\u7247\u7684\u68c0\u6d4b\u7ed3\u679c\u3002 JSONArray taskResults = scrResponse . getJSONArray ( \"data\" ); if ( 200 == requestCode ) { for ( Object taskResult : taskResults ) { //\u5355\u5f20\u56fe\u7247\u7684\u5904\u7406\u7ed3\u679c\u3002 int taskCode = (( JSONObject ) taskResult ). getIntValue ( \"code\" ); //\u56fe\u7247\u5bf9\u5e94\u68c0\u6d4b\u573a\u666f\u7684\u5904\u7406\u7ed3\u679c\u3002\u5982\u679c\u662f\u591a\u4e2a\u573a\u666f\uff0c\u5219\u4f1a\u6709\u6bcf\u4e2a\u573a\u666f\u7684\u7ed3\u679c\u3002 JSONArray sceneResults = (( JSONObject ) taskResult ). getJSONArray ( \"results\" ); if ( 200 == taskCode ) { for ( Object sceneResult : sceneResults ) { String scene = (( JSONObject ) sceneResult ). getString ( \"scene\" ); String suggestion = (( JSONObject ) sceneResult ). getString ( \"suggestion\" ); //\u6839\u636escene\u548csuggetion\u505a\u76f8\u5173\u5904\u7406\u3002 //do something System . out . println ( \"scene = [\" + scene + \"]\" ); System . out . println ( \"suggestion = [\" + suggestion + \"]\" ); } } else { //\u5355\u5f20\u56fe\u7247\u5904\u7406\u5931\u8d25\uff0c\u539f\u56e0\u89c6\u5177\u4f53\u7684\u60c5\u51b5\u8be6\u7ec6\u5206\u6790\u3002 System . out . println ( \"task process fail. task response:\" + JSON . toJSONString ( taskResult )); } } } else { /** * \u8868\u660e\u8bf7\u6c42\u6574\u4f53\u5904\u7406\u5931\u8d25\uff0c\u539f\u56e0\u89c6\u5177\u4f53\u7684\u60c5\u51b5\u8be6\u7ec6\u5206\u6790\u3002 */ System . out . println ( \"the whole image scan request failed. response:\" + JSON . toJSONString ( scrResponse )); } } } } 17-\u63a5\u53e3\u96c6\u6210\u5230\u9879\u76ee 17:22 \u00b6 \u6587\u672c\u5ba1\u6838\u5de5\u5177\u7c7b\uff1a package com.heima.common.aliyun ; import com.alibaba.fastjson.JSON ; import com.alibaba.fastjson.JSONArray ; import com.alibaba.fastjson.JSONObject ; import com.aliyuncs.DefaultAcsClient ; import com.aliyuncs.IAcsClient ; import com.aliyuncs.exceptions.ClientException ; import com.aliyuncs.exceptions.ServerException ; import com.aliyuncs.green.model.v20180509.TextScanRequest ; import com.aliyuncs.http.FormatType ; import com.aliyuncs.http.HttpResponse ; import com.aliyuncs.profile.DefaultProfile ; import com.aliyuncs.profile.IClientProfile ; import lombok.Getter ; import lombok.Setter ; import org.jcodings.util.Hash ; import org.springframework.boot.context.properties.ConfigurationProperties ; import org.springframework.context.annotation.PropertySource ; import org.springframework.stereotype.Component ; import java.util.* ; @Getter @Setter @Component @PropertySource ( \"classpath:aliyun.properties\" ) @ConfigurationProperties ( prefix = \"aliyun\" ) public class GreeTextScan { private String accessKeyId ; private String secret ; public Map greeTextScan ( String content ) throws Exception { IClientProfile profile = DefaultProfile . getProfile ( \"cn-shanghai\" , accessKeyId , secret ); DefaultProfile . addEndpoint ( \"cn-shanghai\" , \"cn-shanghai\" , \"Green\" , \"green.cn-shanghai.aliyuncs.com\" ); IAcsClient client = new DefaultAcsClient ( profile ); TextScanRequest textScanRequest = new TextScanRequest (); textScanRequest . setAcceptFormat ( FormatType . JSON ); // \u6307\u5b9aapi\u8fd4\u56de\u683c\u5f0f textScanRequest . setHttpContentType ( FormatType . JSON ); textScanRequest . setMethod ( com . aliyuncs . http . MethodType . POST ); // \u6307\u5b9a\u8bf7\u6c42\u65b9\u6cd5 textScanRequest . setEncoding ( \"UTF-8\" ); textScanRequest . setRegionId ( \"cn-shanghai\" ); List < Map < String , Object >> tasks = new ArrayList < Map < String , Object >> (); Map < String , Object > task1 = new LinkedHashMap < String , Object > (); task1 . put ( \"dataId\" , UUID . randomUUID (). toString ()); /** * \u5f85\u68c0\u6d4b\u7684\u6587\u672c\uff0c\u957f\u5ea6\u4e0d\u8d85\u8fc710000\u4e2a\u5b57\u7b26 */ task1 . put ( \"content\" , content ); tasks . add ( task1 ); JSONObject data = new JSONObject (); /** * \u68c0\u6d4b\u573a\u666f\uff0c\u6587\u672c\u5783\u573e\u68c0\u6d4b\u4f20\u9012\uff1aantispam **/ data . put ( \"scenes\" , Arrays . asList ( \"antispam\" )); data . put ( \"tasks\" , tasks ); System . out . println ( JSON . toJSONString ( data , true )); textScanRequest . setHttpContent ( data . toJSONString (). getBytes ( \"UTF-8\" ), \"UTF-8\" , FormatType . JSON ); // \u8bf7\u52a1\u5fc5\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4 textScanRequest . setConnectTimeout ( 3000 ); textScanRequest . setReadTimeout ( 6000 ); Map < String , String > resultMap = new HashMap <> (); try { HttpResponse httpResponse = client . doAction ( textScanRequest ); if ( httpResponse . isSuccess ()) { JSONObject scrResponse = JSON . parseObject ( new String ( httpResponse . getHttpContent (), \"UTF-8\" )); System . out . println ( JSON . toJSONString ( scrResponse , true )); if ( 200 == scrResponse . getInteger ( \"code\" )) { JSONArray taskResults = scrResponse . getJSONArray ( \"data\" ); for ( Object taskResult : taskResults ) { if ( 200 == (( JSONObject ) taskResult ). getInteger ( \"code\" )) { JSONArray sceneResults = (( JSONObject ) taskResult ). getJSONArray ( \"results\" ); for ( Object sceneResult : sceneResults ) { String scene = (( JSONObject ) sceneResult ). getString ( \"scene\" ); String label = (( JSONObject ) sceneResult ). getString ( \"label\" ); String suggestion = (( JSONObject ) sceneResult ). getString ( \"suggestion\" ); System . out . println ( \"suggestion = [\" + label + \"]\" ); if ( ! suggestion . equals ( \"pass\" )) { resultMap . put ( \"suggestion\" , suggestion ); resultMap . put ( \"label\" , label ); return resultMap ; } } } else { return null ; } } resultMap . put ( \"suggestion\" , \"pass\" ); return resultMap ; } else { return null ; } } else { return null ; } } catch ( ServerException e ) { e . printStackTrace (); } catch ( ClientException e ) { e . printStackTrace (); } catch ( Exception e ) { e . printStackTrace (); } return null ; } } \u56fe\u7247\u68c0\u6d4b\u5de5\u5177\u7c7b\uff1a package com.heima.common.aliyun ; import com.alibaba.fastjson.JSON ; import com.alibaba.fastjson.JSONArray ; import com.alibaba.fastjson.JSONObject ; import com.aliyuncs.DefaultAcsClient ; import com.aliyuncs.IAcsClient ; import com.aliyuncs.green.model.v20180509.ImageSyncScanRequest ; import com.aliyuncs.http.FormatType ; import com.aliyuncs.http.HttpResponse ; import com.aliyuncs.http.MethodType ; import com.aliyuncs.http.ProtocolType ; import com.aliyuncs.profile.DefaultProfile ; import com.aliyuncs.profile.IClientProfile ; import com.heima.common.aliyun.util.ClientUploader ; import lombok.Getter ; import lombok.Setter ; import org.springframework.boot.context.properties.ConfigurationProperties ; import org.springframework.context.annotation.PropertySource ; import org.springframework.stereotype.Component ; import java.util.* ; @Getter @Setter @Component @PropertySource ( \"classpath:aliyun.properties\" ) @ConfigurationProperties ( prefix = \"aliyun\" ) public class GreenImageScan { private String accessKeyId ; private String secret ; private String scenes ; public Map imageScan ( List < byte []> imageList ) throws Exception { IClientProfile profile = DefaultProfile . getProfile ( \"cn-shanghai\" , accessKeyId , secret ); DefaultProfile . addEndpoint ( \"cn-shanghai\" , \"cn-shanghai\" , \"Green\" , \"green.cn-shanghai.aliyuncs.com\" ); IAcsClient client = new DefaultAcsClient ( profile ); ImageSyncScanRequest imageSyncScanRequest = new ImageSyncScanRequest (); // \u6307\u5b9aapi\u8fd4\u56de\u683c\u5f0f imageSyncScanRequest . setAcceptFormat ( FormatType . JSON ); // \u6307\u5b9a\u8bf7\u6c42\u65b9\u6cd5 imageSyncScanRequest . setMethod ( MethodType . POST ); imageSyncScanRequest . setEncoding ( \"utf-8\" ); //\u652f\u6301http\u548chttps imageSyncScanRequest . setProtocol ( ProtocolType . HTTP ); JSONObject httpBody = new JSONObject (); /** * \u8bbe\u7f6e\u8981\u68c0\u6d4b\u7684\u573a\u666f, \u8ba1\u8d39\u662f\u6309\u7167\u8be5\u5904\u4f20\u9012\u7684\u573a\u666f\u8fdb\u884c * \u4e00\u6b21\u8bf7\u6c42\u4e2d\u53ef\u4ee5\u540c\u65f6\u68c0\u6d4b\u591a\u5f20\u56fe\u7247\uff0c\u6bcf\u5f20\u56fe\u7247\u53ef\u4ee5\u540c\u65f6\u68c0\u6d4b\u591a\u4e2a\u98ce\u9669\u573a\u666f\uff0c\u8ba1\u8d39\u6309\u7167\u573a\u666f\u8ba1\u7b97 * \u4f8b\u5982\uff1a\u68c0\u6d4b2\u5f20\u56fe\u7247\uff0c\u573a\u666f\u4f20\u9012porn\u3001terrorism\uff0c\u8ba1\u8d39\u4f1a\u6309\u71672\u5f20\u56fe\u7247\u9274\u9ec4\uff0c2\u5f20\u56fe\u7247\u66b4\u6050\u68c0\u6d4b\u8ba1\u7b97 * porn: porn\u8868\u793a\u8272\u60c5\u573a\u666f\u68c0\u6d4b */ httpBody . put ( \"scenes\" , Arrays . asList ( scenes . split ( \",\" ))); /** * \u5982\u679c\u60a8\u8981\u68c0\u6d4b\u7684\u6587\u4ef6\u5b58\u4e8e\u672c\u5730\u670d\u52a1\u5668\u4e0a\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0b\u8ff0\u4ee3\u7801\u7247\u751f\u6210url * \u518d\u5c06\u8fd4\u56de\u7684url\u4f5c\u4e3a\u56fe\u7247\u5730\u5740\u4f20\u9012\u5230\u670d\u52a1\u7aef\u8fdb\u884c\u68c0\u6d4b */ /** * \u8bbe\u7f6e\u5f85\u68c0\u6d4b\u56fe\u7247\uff0c \u4e00\u5f20\u56fe\u7247\u4e00\u4e2atask * \u591a\u5f20\u56fe\u7247\u540c\u65f6\u68c0\u6d4b\u65f6\uff0c\u5904\u7406\u7684\u65f6\u95f4\u7531\u6700\u540e\u4e00\u4e2a\u5904\u7406\u5b8c\u7684\u56fe\u7247\u51b3\u5b9a * \u901a\u5e38\u60c5\u51b5\u4e0b\u6279\u91cf\u68c0\u6d4b\u7684\u5e73\u5747rt\u6bd4\u5355\u5f20\u68c0\u6d4b\u7684\u8981\u957f, \u4e00\u6b21\u6279\u91cf\u63d0\u4ea4\u7684\u56fe\u7247\u6570\u8d8a\u591a\uff0crt\u88ab\u62c9\u957f\u7684\u6982\u7387\u8d8a\u9ad8 * \u8fd9\u91cc\u4ee5\u5355\u5f20\u56fe\u7247\u68c0\u6d4b\u4f5c\u4e3a\u793a\u4f8b, \u5982\u679c\u662f\u6279\u91cf\u56fe\u7247\u68c0\u6d4b\uff0c\u8bf7\u81ea\u884c\u6784\u5efa\u591a\u4e2atask */ ClientUploader clientUploader = ClientUploader . getImageClientUploader ( profile , false ); String url = null ; List < JSONObject > urlList = new ArrayList < JSONObject > (); for ( byte [] bytes : imageList ) { url = clientUploader . uploadBytes ( bytes ); JSONObject task = new JSONObject (); task . put ( \"dataId\" , UUID . randomUUID (). toString ()); //\u8bbe\u7f6e\u56fe\u7247\u94fe\u63a5\u4e3a\u4e0a\u4f20\u540e\u7684url task . put ( \"url\" , url ); task . put ( \"time\" , new Date ()); urlList . add ( task ); } httpBody . put ( \"tasks\" , urlList ); imageSyncScanRequest . setHttpContent ( org . apache . commons . codec . binary . StringUtils . getBytesUtf8 ( httpBody . toJSONString ()), \"UTF-8\" , FormatType . JSON ); /** * \u8bf7\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4, \u670d\u52a1\u7aef\u5168\u94fe\u8def\u5904\u7406\u8d85\u65f6\u65f6\u95f4\u4e3a10\u79d2\uff0c\u8bf7\u505a\u76f8\u5e94\u8bbe\u7f6e * \u5982\u679c\u60a8\u8bbe\u7f6e\u7684ReadTimeout\u5c0f\u4e8e\u670d\u52a1\u7aef\u5904\u7406\u7684\u65f6\u95f4\uff0c\u7a0b\u5e8f\u4e2d\u4f1a\u83b7\u5f97\u4e00\u4e2aread timeout\u5f02\u5e38 */ imageSyncScanRequest . setConnectTimeout ( 3000 ); imageSyncScanRequest . setReadTimeout ( 10000 ); HttpResponse httpResponse = null ; try { httpResponse = client . doAction ( imageSyncScanRequest ); } catch ( Exception e ) { e . printStackTrace (); } Map < String , String > resultMap = new HashMap <> (); //\u670d\u52a1\u7aef\u63a5\u6536\u5230\u8bf7\u6c42\uff0c\u5e76\u5b8c\u6210\u5904\u7406\u8fd4\u56de\u7684\u7ed3\u679c if ( httpResponse != null && httpResponse . isSuccess ()) { JSONObject scrResponse = JSON . parseObject ( org . apache . commons . codec . binary . StringUtils . newStringUtf8 ( httpResponse . getHttpContent ())); System . out . println ( JSON . toJSONString ( scrResponse , true )); int requestCode = scrResponse . getIntValue ( \"code\" ); //\u6bcf\u4e00\u5f20\u56fe\u7247\u7684\u68c0\u6d4b\u7ed3\u679c JSONArray taskResults = scrResponse . getJSONArray ( \"data\" ); if ( 200 == requestCode ) { for ( Object taskResult : taskResults ) { //\u5355\u5f20\u56fe\u7247\u7684\u5904\u7406\u7ed3\u679c int taskCode = (( JSONObject ) taskResult ). getIntValue ( \"code\" ); //\u56fe\u7247\u8981\u68c0\u6d4b\u7684\u573a\u666f\u7684\u5904\u7406\u7ed3\u679c, \u5982\u679c\u662f\u591a\u4e2a\u573a\u666f\uff0c\u5219\u4f1a\u6709\u6bcf\u4e2a\u573a\u666f\u7684\u7ed3\u679c JSONArray sceneResults = (( JSONObject ) taskResult ). getJSONArray ( \"results\" ); if ( 200 == taskCode ) { for ( Object sceneResult : sceneResults ) { String scene = (( JSONObject ) sceneResult ). getString ( \"scene\" ); String label = (( JSONObject ) sceneResult ). getString ( \"label\" ); String suggestion = (( JSONObject ) sceneResult ). getString ( \"suggestion\" ); //\u6839\u636escene\u548csuggetion\u505a\u76f8\u5173\u5904\u7406 //do something System . out . println ( \"scene = [\" + scene + \"]\" ); System . out . println ( \"suggestion = [\" + suggestion + \"]\" ); System . out . println ( \"suggestion = [\" + label + \"]\" ); if ( ! suggestion . equals ( \"pass\" )) { resultMap . put ( \"suggestion\" , suggestion ); resultMap . put ( \"label\" , label ); return resultMap ; } } } else { //\u5355\u5f20\u56fe\u7247\u5904\u7406\u5931\u8d25, \u539f\u56e0\u89c6\u5177\u4f53\u7684\u60c5\u51b5\u8be6\u7ec6\u5206\u6790 System . out . println ( \"task process fail. task response:\" + JSON . toJSONString ( taskResult )); return null ; } } resultMap . put ( \"suggestion\" , \"pass\" ); return resultMap ; } else { /** * \u8868\u660e\u8bf7\u6c42\u6574\u4f53\u5904\u7406\u5931\u8d25\uff0c\u539f\u56e0\u89c6\u5177\u4f53\u7684\u60c5\u51b5\u8be6\u7ec6\u5206\u6790 */ System . out . println ( \"the whole image scan request failed. response:\" + JSON . toJSONString ( scrResponse )); return null ; } } return null ; } } admin\u4e2d\u7684\u914d\u7f6e\u7c7b package com.heima.admin.config ; import org.springframework.context.annotation.ComponentScan ; import org.springframework.context.annotation.Configuration ; @Configuration @ComponentScan ( \"com.heima.common.aliyun\" ) public class AliyunConfig { } 18-\u654f\u611f\u8bcd\u8fc7\u6ee4\u7b97\u6cd5DFA 13:33 \u00b6 \u200b DFA\u5168\u79f0\u4e3a\uff1aDeterministic Finite Automaton,\u5373\u786e\u5b9a\u6709\u7a77\u81ea\u52a8\u673a\u3002\u5176\u7279\u5f81\u4e3a\uff1a\u6709\u4e00\u4e2a\u6709\u9650\u72b6\u6001\u96c6\u5408\u548c\u4e00\u4e9b\u4ece\u4e00\u4e2a\u72b6\u6001\u901a\u5411\u53e6\u4e00\u4e2a\u72b6\u6001\u7684\u8fb9\uff0c\u6bcf\u6761\u8fb9\u4e0a\u6807\u8bb0\u6709\u4e00\u4e2a\u7b26\u53f7\uff0c\u5176\u4e2d\u4e00\u4e2a\u72b6\u6001\u662f\u521d\u6001\uff0c\u67d0\u4e9b\u72b6\u6001\u662f\u7ec8\u6001\u3002\u4f46\u4e0d\u540c\u4e8e\u4e0d\u786e\u5b9a\u7684\u6709\u9650\u81ea\u52a8\u673a\uff0cDFA\u4e2d\u4e0d\u4f1a\u6709\u4ece\u540c\u4e00\u72b6\u6001\u51fa\u53d1\u7684\u4e24\u6761\u8fb9\u6807\u5fd7\u6709\u76f8\u540c\u7684\u7b26\u53f7\u3002 \u4e00\u6b21\u6027\u7684\u628a\u6240\u6709\u7684\u654f\u611f\u8bcd\u5b58\u50a8\u5230\u4e86\u591a\u4e2amap\u4e2d\uff0c\u5c31\u662f\u4e0b\u56fe\u8868\u793a\u8fd9\u79cd\u7ed3\u6784 \u654f\u611f\u8bcd\uff1a\u51b0\u6bd2\u3001\u5927\u9ebb\u3001\u5927\u574f\u86cb \u68c0\u7d22\u7684\u8fc7\u7a0b\uff0c\u5c31\u662fhashMap\u7684get\u5b9e\u73b0 1\u3001\u7b2c\u4e00\u4e2a\u5b57\u201c\u51b0\u201d\uff0c\u6211\u4eec\u5728hashMap\u4e2d\u53ef\u4ee5\u627e\u5230\u3002\u5f97\u5230\u4e00\u4e2a\u65b0\u7684map = hashMap.get(\"\")\u3002 2\u3001\u5982\u679cmap == null\uff0c\u5219\u4e0d\u662f\u654f\u611f\u8bcd\u3002\u5426\u5219\u8df3\u81f33 3\u3001\u83b7\u53d6map\u4e2d\u7684isEnd\uff0c\u901a\u8fc7isEnd\u662f\u5426\u7b49\u4e8e1\u6765\u5224\u65ad\u8be5\u8bcd\u662f\u5426\u4e3a\u6700\u540e\u4e00\u4e2a\u3002\u5982\u679cisEnd == 1\u8868\u793a\u8be5\u8bcd\u4e3a\u654f\u611f\u8bcd\uff0c\u5426\u5219\u8df3\u81f31\u3002 \u901a\u8fc7\u8fd9\u4e2a\u6b65\u9aa4\u6211\u4eec\u53ef\u4ee5\u5224\u65ad\u201c\u51b0\u6bd2\u201d\u4e3a\u654f\u611f\u8bcd\uff0c\u4f46\u662f\u5982\u679c\u6211\u4eec\u8f93\u5165\u201c\u51b0\u7bb1\u201d\u5219\u4e0d\u662f\u654f\u611f\u8bcd\u4e86\u3002","title":"day06"},{"location":"hmtt/day06/#01-_0133","text":"\u80fd\u591f\u4e86\u89e3kafka\u57fa\u672c\u4fe1\u606f \u80fd\u591f\u8fd0\u7528kafka\u8fdb\u884c\u6d88\u606f\u7684\u6536\u53d1 \u80fd\u80fd\u7406\u89e3kafka\u751f\u4ea7\u8005\u7684\u539f\u7406\u548c\u673a\u5236 \u80fd\u80fd\u7406\u89e3kafka\u6d88\u8d39\u8005\u7684\u539f\u7406\u548c\u673a\u5236 \u80fd\u591f\u5b8c\u6210\u963f\u91cc\u4e91\u5b89\u5168\u7b2c\u4e09\u65b9\u63a5\u53e3\u6587\u6863\u7684\u4f7f\u7528 \u80fd\u591f\u628a\u963f\u91cc\u4e91\u5b89\u5168\u5bf9\u63a5\u5230\u9879\u76ee\u4e2d \u80fd\u591f\u7406\u89e3\u654f\u611f\u8bcd\u8fc7\u6ee4\u7b97\u6cd5dfa","title":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 01:33"},{"location":"hmtt/day06/#rocketmq","text":"","title":"Rocketmq\u590d\u4e60"},{"location":"hmtt/day06/#rocketmq_1","text":"RocketMQ\u662f\u4e00\u4e2a\u7eafJava\u3001\u5206\u5e03\u5f0f\u3001\u961f\u5217\u6a21\u578b\u7684\u5f00\u6e90\u6d88\u606f\u4e2d\u95f4\u4ef6\uff0c\u524d\u8eab\u662fMetaQ\uff0c\u662f\u963f\u91cc\u53c2\u8003Kafka\u7279\u70b9\u7814\u53d1\u7684\u4e00\u4e2a\u961f\u5217\u6a21\u578b\u7684\u6d88\u606f\u4e2d\u95f4\u4ef6\uff0c\u540e\u5f00\u6e90\u7ed9apache\u57fa\u91d1\u4f1a\u6210\u4e3a\u4e86apache\u7684\u9876\u7ea7\u5f00\u6e90\u9879\u76ee\uff0c\u5177\u6709\u9ad8\u6027\u80fd\u3001\u9ad8\u53ef\u9760\u3001\u9ad8\u5b9e\u65f6\u3001\u5206\u5e03\u5f0f\u7279\u70b9\u3002 \u6211\u4eec\u518d\u770b\u4e0b\u963f\u91cc\u7ed9\u4ed6\u53d6\u7684\u540d\u5b57\u54c8\uff1a Rocket \u706b\u7bad \u963f\u91cc\u8fd9\u662f\u5e0c\u671b\u4ed6\u4e0a\u5929\u5440\uff0c\u4e0d\u8fc7\u6211\u89c9\u5f97\u8fd9\u4e2a\u540d\u5b57\u786e\u5b9e\u633a\u9177\u7684\u3002 RocketMQ \u652f\u6301\u540c\u6b65\u3001\u5f02\u6b65\u3001Oneway \u4e09\u79cd\u53d1\u9001\u65b9\u5f0f\u3002 \u540c\u6b65 \uff1a\u5ba2\u6237\u7aef\u53d1\u8d77\u4e00\u6b21\u6d88\u606f\u53d1\u9001\u540e\u4f1a\u540c\u6b65\u7b49\u5f85\u670d\u52a1\u5668\u7684\u54cd\u5e94\u7ed3\u679c\u3002 \u5f02\u6b65 \uff1a\u5ba2\u6237\u7aef\u53d1\u8d77\u4e00\u4e0b\u6d88\u606f\u53d1\u8d77\u8bf7\u6c42\u540e\u4e0d\u7b49\u5f85\u670d\u52a1\u5668\u54cd\u5e94\u7ed3\u679c\u800c\u662f\u7acb\u5373\u8fd4\u56de\uff0c\u8fd9\u6837\u4e0d\u4f1a\u963b\u585e\u5ba2\u6237\u7aef\u5b50\u7ebf\u7a0b\uff0c\u5f53\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u7aef\uff08Broker\uff09\u7684\u54cd\u5e94\u7ed3\u679c\u540e\u4f1a\u81ea\u52a8\u8c03\u7528\u56de\u8c03\u51fd\u6570\u3002 Oneway \uff1a\u5ba2\u6237\u7aef\u53d1\u8d77\u6d88\u606f\u53d1\u9001\u8bf7\u6c42\u540e\u5e76\u4e0d\u4f1a\u7b49\u5f85\u670d\u52a1\u5668\u7684\u54cd\u5e94\u7ed3\u679c\uff0c\u4e5f\u4e0d\u4f1a\u8c03\u7528\u56de\u8c03\u51fd\u6570\uff0c\u5373\u4e0d\u5173\u5fc3\u6d88\u606f\u7684\u6700\u7ec8\u53d1\u9001\u7ed3\u679c\u3002 MQ \u4e0e\u5e94\u7528\u670d\u52a1\u5668\u90fd\u5728\u4e00\u4e2a\u5185\u90e8\u7f51\u7edc\u4e2d\uff0c\u7f51\u7edc\u901a\u4fe1\u7684\u6d41\u91cf\u901a\u5e38\u53ef\u4ee5\u5ffd\u7565\uff0c\u800c\u4e14 MQ \u7684\u8bbe\u8ba1\u76ee\u7684\u662f\u4f4e\u5ef6\u8fdf\u3001\u9ad8\u5e76\u53d1\uff0c\u6545\u901a\u5e38\u6ca1\u6709\u5fc5\u8981\u4f7f\u7528\u5f02\u6b65\u53d1\u9001\uff0c\u901a\u5e38\u90fd\u662f\u4e3a\u4e86\u63d0\u9ad8 RocketMQ Broker \u7aef\u76f8\u5173\u7684\u53c2\u6570\uff0c\u7279\u522b\u662f\u5237\u76d8\u7b56\u7565\u548c\u590d\u5236\u7b56\u7565\u3002\u5982\u679c\u5728\u4e00\u4e2a\u573a\u666f\u4e2d\uff0c\u4e00\u4e2a\u6570\u636e\u5e93\u64cd\u4f5c\u4e8b\u52a1\u4e2d\u9700\u8981\u53d1\u9001\u591a\u6761\u6d88\u606f\uff0c\u8fd9\u4e2a\u65f6\u5019\u4f7f\u7528\u5f02\u6b65\u53d1\u9001\u4e5f\u4f1a\u5e26\u6765\u4e00\u5b9a\u6027\u80fd\u63d0\u5347\u3002 \u5982\u679c\u4f7f\u7528\u5f02\u6b65\u53d1\u9001\uff0c\u7f16\u7a0b\u6a21\u578b\u4e0a\u4f1a\u7a0d\u663e\u590d\u6742\uff0c\u5176\u8865\u507f\u673a\u5236\u3001\u5bb9\u9519\u673a\u5236\u5c06\u4f1a\u53d8\u7684\u8f83\u4e3a\u590d\u6742\u3002 \u6b63\u5982\u4e0a\u8ff0\u793a\u4f8b\u4e2d\u9610\u8ff0\u7684\u90a3\u6837\uff0c\u8865\u507f\u4ee3\u7801\u5e94\u8be5\u5728\u4e24\u4e2a\u5730\u65b9\u8c03\u7528\uff1a producer#send \u65b9\u6cd5\u65f6\u9700\u8981\u6355\u6349\u5f02\u5e38\uff0c\u5e38\u89c1\u7684\u5f02\u5e38\u4fe1\u606f\uff1a MQClientException(\"executor rejected \", e) \u3002 \u5728 SendCallback \u7684 onException \u4e2d\u8fdb\u884c\u8865\u507f\uff0c\u5e38\u89c1\u5f02\u5e38\u6709\u8c03\u7528\u8d85\u65f6\u3001RemotingTooMuchRequestException\u3002","title":"RocketMQ\u7b80\u4ecb"},{"location":"hmtt/day06/#02-kafka_0508","text":"Kafka\u662f\u6700\u521d\u7531Linkedin\u516c\u53f8\u5f00\u53d1\uff0c\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u3001\u5206\u533a\u7684\u3001\u591a\u526f\u672c\u7684\u3001\u591a\u8ba2\u9605\u8005\uff0c\u57fa\u4e8ezookeeper\u534f\u8c03\u7684\u5206\u5e03\u5f0f\u65e5\u5fd7\u7cfb\u7edf\uff08\u4e5f\u53ef\u4ee5\u5f53\u505aMQ\u7cfb\u7edf\uff09\uff0c\u5e38\u89c1\u53ef\u4ee5\u7528\u4e8eweb/nginx\u65e5\u5fd7\u3001\u8bbf\u95ee\u65e5\u5fd7\uff0c\u6d88\u606f\u670d\u52a1\u7b49\u7b49\uff0cLinkedin\u4e8e2010\u5e74\u8d21\u732e\u7ed9\u4e86Apache\u57fa\u91d1\u4f1a\u5e76\u6210\u4e3a\u9876\u7ea7\u5f00\u6e90\u9879\u76ee\u3002 \u4e3b\u8981\u5e94\u7528\u573a\u666f\u662f\uff1a\u65e5\u5fd7\u6536\u96c6\u7cfb\u7edf\u548c\u6d88\u606f\u7cfb\u7edf\u3002 Kafka\u4e3b\u8981\u8bbe\u8ba1\u76ee\u6807\u5982\u4e0b\uff1a \u4ee5\u65f6\u95f4\u590d\u6742\u5ea6\u4e3aO(1)\u7684\u65b9\u5f0f\u63d0\u4f9b\u6d88\u606f\u6301\u4e45\u5316\u80fd\u529b\uff0c\u5373\u4f7f\u5bf9TB\u7ea7\u4ee5\u4e0a\u6570\u636e\u4e5f\u80fd\u4fdd\u8bc1\u5e38\u6570\u65f6\u95f4\u7684\u8bbf\u95ee\u6027\u80fd\u3002 \u9ad8\u541e\u5410\u7387\u3002\u5373\u4f7f\u5728\u975e\u5e38\u5ec9\u4ef7\u7684\u5546\u7528\u673a\u5668\u4e0a\u4e5f\u80fd\u505a\u5230\u5355\u673a\u652f\u6301\u6bcf\u79d2100K\u6761\u6d88\u606f\u7684\u4f20\u8f93\u3002Rabbitmq 1W \u652f\u6301Kafka Server\u95f4\u7684\u6d88\u606f\u5206\u533a\uff0c\u53ca\u5206\u5e03\u5f0f\u6d88\u8d39\uff0c\u540c\u65f6\u4fdd\u8bc1\u6bcf\u4e2apartition\u5185\u7684\u6d88\u606f\u987a\u5e8f\u4f20\u8f93\u3002 \u540c\u65f6\u652f\u6301\u79bb\u7ebf\u6570\u636e\u5904\u7406\u548c\u5b9e\u65f6\u6570\u636e\u5904\u7406\u3002 Scale out:\u652f\u6301\u5728\u7ebf\u6c34\u5e73\u6269\u5c55","title":"02-kafka\u7b80\u4ecb 05:08"},{"location":"hmtt/day06/#1","text":"\u4e00\u4e2a\u6d88\u606f\u7cfb\u7edf\u8d1f\u8d23\u5c06\u6570\u636e\u4ece\u4e00\u4e2a\u5e94\u7528\u4f20\u9012\u5230\u53e6\u5916\u4e00\u4e2a\u5e94\u7528\uff0c\u5e94\u7528\u53ea\u9700\u5173\u6ce8\u4e8e\u6570\u636e\uff0c\u65e0\u9700\u5173\u6ce8\u6570\u636e\u5728\u4e24\u4e2a\u6216\u591a\u4e2a\u5e94\u7528\u95f4\u662f\u5982\u4f55\u4f20\u9012\u7684\u3002\u5206\u5e03\u5f0f\u6d88\u606f\u4f20\u9012\u57fa\u4e8e\u53ef\u9760\u7684\u6d88\u606f\u961f\u5217\uff0c\u5728\u5ba2\u6237\u7aef\u5e94\u7528\u548c\u6d88\u606f\u7cfb\u7edf\u4e4b\u95f4\u5f02\u6b65\u4f20\u9012\u6d88\u606f\u3002\u6709\u4e24\u79cd\u4e3b\u8981\u7684\u6d88\u606f\u4f20\u9012\u6a21\u5f0f\uff1a \u70b9\u5bf9\u70b9\u4f20\u9012\u6a21\u5f0f\u3001\u53d1\u5e03-\u8ba2\u9605\u6a21\u5f0f \u3002\u5927\u90e8\u5206\u7684\u6d88\u606f\u7cfb\u7edf\u9009\u7528\u53d1\u5e03-\u8ba2\u9605\u6a21\u5f0f\u3002 Kafka\u5c31\u662f\u4e00\u79cd\u53d1\u5e03-\u8ba2\u9605\u6a21\u5f0f \u3002","title":"1\u3000\u6d88\u606f\u7cfb\u7edf\u4ecb\u7ecd"},{"location":"hmtt/day06/#11","text":"\u5728\u70b9\u5bf9\u70b9\u6d88\u606f\u7cfb\u7edf\u4e2d\uff0c\u6d88\u606f\u6301\u4e45\u5316\u5230\u4e00\u4e2a\u961f\u5217\u4e2d\u3002\u6b64\u65f6\uff0c\u5c06\u6709\u4e00\u4e2a\u6216\u591a\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\u961f\u5217\u4e2d\u7684\u6570\u636e\u3002\u4f46\u662f\u4e00\u6761\u6d88\u606f\u53ea\u80fd\u88ab\u6d88\u8d39\u4e00\u6b21\u3002\u5f53\u4e00\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\u4e86\u961f\u5217\u4e2d\u7684\u67d0\u6761\u6570\u636e\u4e4b\u540e\uff0c\u8be5\u6761\u6570\u636e\u5219\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u5220\u9664\u3002\u8be5\u6a21\u5f0f\u5373\u4f7f\u6709\u591a\u4e2a\u6d88\u8d39\u8005\u540c\u65f6\u6d88\u8d39\u6570\u636e\uff0c\u4e5f\u80fd\u4fdd\u8bc1\u6570\u636e\u5904\u7406\u7684\u987a\u5e8f\u3002\u8fd9\u79cd\u67b6\u6784\u63cf\u8ff0\u793a\u610f\u56fe\u5982\u4e0b\uff1a \u751f\u4ea7\u8005\u53d1\u9001\u4e00\u6761\u6d88\u606f\u5230queue\uff0c\u53ea\u6709\u4e00\u4e2a\u6d88\u8d39\u8005\u80fd\u6536\u5230 \u3002","title":"1.1\u3000\u70b9\u5bf9\u70b9\u6d88\u606f\u4f20\u9012\u6a21\u5f0f"},{"location":"hmtt/day06/#12_-","text":"\u5728\u53d1\u5e03-\u8ba2\u9605\u6d88\u606f\u7cfb\u7edf\u4e2d\uff0c\u6d88\u606f\u88ab\u6301\u4e45\u5316\u5230\u4e00\u4e2atopic\u4e2d\u3002\u4e0e\u70b9\u5bf9\u70b9\u6d88\u606f\u7cfb\u7edf\u4e0d\u540c\u7684\u662f\uff0c\u6d88\u8d39\u8005\u53ef\u4ee5\u8ba2\u9605\u4e00\u4e2a\u6216\u591a\u4e2atopic\uff0c\u6d88\u8d39\u8005\u53ef\u4ee5\u6d88\u8d39\u8be5topic\u4e2d\u6240\u6709\u7684\u6570\u636e\uff0c\u540c\u4e00\u6761\u6570\u636e\u53ef\u4ee5\u88ab\u591a\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\uff0c\u6570\u636e\u88ab\u6d88\u8d39\u540e\u4e0d\u4f1a\u7acb\u9a6c\u5220\u9664\u3002\u5728\u53d1\u5e03-\u8ba2\u9605\u6d88\u606f\u7cfb\u7edf\u4e2d\uff0c\u6d88\u606f\u7684\u751f\u4ea7\u8005\u79f0\u4e3a\u53d1\u5e03\u8005\uff0c\u6d88\u8d39\u8005\u79f0\u4e3a\u8ba2\u9605\u8005\u3002\u8be5\u6a21\u5f0f\u7684\u793a\u4f8b\u56fe\u5982\u4e0b\uff1a \u53d1\u5e03\u8005\u53d1\u9001\u5230topic\u7684\u6d88\u606f\uff0c\u53ea\u6709\u8ba2\u9605\u4e86topic\u7684\u8ba2\u9605\u8005\u624d\u4f1a\u6536\u5230\u6d88\u606f \u3002","title":"1.2\u3000\u53d1\u5e03-\u8ba2\u9605\u6d88\u606f\u4f20\u9012\u6a21\u5f0f"},{"location":"hmtt/day06/#2_kafka","text":"","title":"2 Kafka\u7684\u4f18\u70b9"},{"location":"hmtt/day06/#21","text":"\u5728\u9879\u76ee\u542f\u52a8\u4e4b\u521d\u6765\u9884\u6d4b\u5c06\u6765\u9879\u76ee\u4f1a\u78b0\u5230\u4ec0\u4e48\u9700\u6c42\uff0c\u662f\u6781\u5176\u56f0\u96be\u7684\u3002\u6d88\u606f\u7cfb\u7edf\u5728\u5904\u7406\u8fc7\u7a0b\u4e2d\u95f4\u63d2\u5165\u4e86\u4e00\u4e2a\u9690\u542b\u7684\u3001\u57fa\u4e8e\u6570\u636e\u7684\u63a5\u53e3\u5c42\uff0c\u4e24\u8fb9\u7684\u5904\u7406\u8fc7\u7a0b\u90fd\u8981\u5b9e\u73b0\u8fd9\u4e00\u63a5\u53e3\u3002\u8fd9\u5141\u8bb8\u4f60\u72ec\u7acb\u7684\u6269\u5c55\u6216\u4fee\u6539\u4e24\u8fb9\u7684\u5904\u7406\u8fc7\u7a0b\uff0c\u53ea\u8981\u786e\u4fdd\u5b83\u4eec\u9075\u5b88\u540c\u6837\u7684\u63a5\u53e3\u7ea6\u675f\u3002","title":"2.1\u3000\u89e3\u8026"},{"location":"hmtt/day06/#22","text":"\u6709\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5904\u7406\u6570\u636e\u7684\u8fc7\u7a0b\u4f1a\u5931\u8d25\u3002\u9664\u975e\u6570\u636e\u88ab\u6301\u4e45\u5316\uff0c\u5426\u5219\u5c06\u9020\u6210\u4e22\u5931\u3002\u6d88\u606f\u961f\u5217\u628a\u6570\u636e\u8fdb\u884c\u6301\u4e45\u5316\u76f4\u5230\u5b83\u4eec\u5df2\u7ecf\u88ab\u5b8c\u5168\u5904\u7406\uff0c\u901a\u8fc7\u8fd9\u4e00\u65b9\u5f0f\u89c4\u907f\u4e86\u6570\u636e\u4e22\u5931\u98ce\u9669\u3002\u8bb8\u591a\u6d88\u606f\u961f\u5217\u6240\u91c7\u7528\u7684\"\u63d2\u5165-\u83b7\u53d6-\u5220\u9664\"\u8303\u5f0f\u4e2d\uff0c\u5728\u628a\u4e00\u4e2a\u6d88\u606f\u4ece\u961f\u5217\u4e2d\u5220\u9664\u4e4b\u524d\uff0c\u9700\u8981\u4f60\u7684\u5904\u7406\u7cfb\u7edf\u660e\u786e\u7684\u6307\u51fa\u8be5\u6d88\u606f\u5df2\u7ecf\u88ab\u5904\u7406\u5b8c\u6bd5\uff0c\u4ece\u800c\u786e\u4fdd\u4f60\u7684\u6570\u636e\u88ab\u5b89\u5168\u7684\u4fdd\u5b58\u76f4\u5230\u4f60\u4f7f\u7528\u5b8c\u6bd5\u3002","title":"2.2\u3000\u5197\u4f59\uff08\u526f\u672c\uff09"},{"location":"hmtt/day06/#23","text":"\u56e0\u4e3a\u6d88\u606f\u961f\u5217\u89e3\u8026\u4e86\u4f60\u7684\u5904\u7406\u8fc7\u7a0b\uff0c\u6240\u4ee5\u589e\u5927\u6d88\u606f\u5165\u961f\u548c\u5904\u7406\u7684\u9891\u7387\u662f\u5f88\u5bb9\u6613\u7684\uff0c\u53ea\u8981\u53e6\u5916\u589e\u52a0\u5904\u7406\u8fc7\u7a0b\u5373\u53ef\u3002\u4e0d\u9700\u8981\u6539\u53d8\u4ee3\u7801\u3001\u4e0d\u9700\u8981\u8c03\u8282\u53c2\u6570\u3002\u6269\u5c55\u5c31\u50cf\u8c03\u5927\u7535\u529b\u6309\u94ae\u4e00\u6837\u7b80\u5355\u3002","title":"2.3\u3000\u6269\u5c55\u6027"},{"location":"hmtt/day06/#24","text":"\u5728\u8bbf\u95ee\u91cf\u5267\u589e\u7684\u60c5\u51b5\u4e0b\uff0c\u5e94\u7528\u4ecd\u7136\u9700\u8981\u7ee7\u7eed\u53d1\u6325\u4f5c\u7528\uff0c\u4f46\u662f\u8fd9\u6837\u7684\u7a81\u53d1\u6d41\u91cf\u5e76\u4e0d\u5e38\u89c1\uff1b\u5982\u679c\u4e3a\u4ee5\u80fd\u5904\u7406\u8fd9\u7c7b\u5cf0\u503c\u8bbf\u95ee\u4e3a\u6807\u51c6\u6765\u6295\u5165\u8d44\u6e90\u968f\u65f6\u5f85\u547d\u65e0\u7591\u662f\u5de8\u5927\u7684\u6d6a\u8d39\u3002\u4f7f\u7528\u6d88\u606f\u961f\u5217\u80fd\u591f\u4f7f\u5173\u952e\u7ec4\u4ef6\u9876\u4f4f\u7a81\u53d1\u7684\u8bbf\u95ee\u538b\u529b\uff0c\u800c\u4e0d\u4f1a\u56e0\u4e3a\u7a81\u53d1\u7684\u8d85\u8d1f\u8377\u7684\u8bf7\u6c42\u800c\u5b8c\u5168\u5d29\u6e83\u3002","title":"2.4\u3000\u7075\u6d3b\u6027&amp;\u5cf0\u503c\u5904\u7406\u80fd\u529b"},{"location":"hmtt/day06/#25","text":"\u7cfb\u7edf\u7684\u4e00\u90e8\u5206\u7ec4\u4ef6\u5931\u6548\u65f6\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5230\u6574\u4e2a\u7cfb\u7edf\u3002\u6d88\u606f\u961f\u5217\u964d\u4f4e\u4e86\u8fdb\u7a0b\u95f4\u7684\u8026\u5408\u5ea6\uff0c\u6240\u4ee5\u5373\u4f7f\u4e00\u4e2a\u5904\u7406\u6d88\u606f\u7684\u8fdb\u7a0b\u6302\u6389\uff0c\u52a0\u5165\u961f\u5217\u4e2d\u7684\u6d88\u606f\u4ecd\u7136\u53ef\u4ee5\u5728\u7cfb\u7edf\u6062\u590d\u540e\u88ab\u5904\u7406\u3002","title":"2.5\u3000\u53ef\u6062\u590d"},{"location":"hmtt/day06/#26","text":"\u5728\u5927\u591a\u4f7f\u7528\u573a\u666f\u4e0b\uff0c\u6570\u636e\u5904\u7406\u7684\u987a\u5e8f\u90fd\u5f88\u91cd\u8981\u3002\u5927\u90e8\u5206\u6d88\u606f\u961f\u5217\u672c\u6765\u5c31\u662f\u6392\u5e8f\u7684\uff0c\u5e76\u4e14\u80fd\u4fdd\u8bc1\u6570\u636e\u4f1a\u6309\u7167\u7279\u5b9a\u7684\u987a\u5e8f\u6765\u5904\u7406\u3002Kafka\u4fdd\u8bc1\u4e00\u4e2aPartition\u5185\u7684\u6d88\u606f\u7684\u6709\u5e8f\u6027\u3002","title":"2.6\u3000\u987a\u5e8f\u4fdd\u8bc1"},{"location":"hmtt/day06/#27","text":"\u5728\u4efb\u4f55\u91cd\u8981\u7684\u7cfb\u7edf\u4e2d\uff0c\u90fd\u4f1a\u6709\u9700\u8981\u4e0d\u540c\u7684\u5904\u7406\u65f6\u95f4\u7684\u5143\u7d20\u3002\u4f8b\u5982\uff0c\u52a0\u8f7d\u4e00\u5f20\u56fe\u7247\u6bd4\u5e94\u7528\u8fc7\u6ee4\u5668\u82b1\u8d39\u66f4\u5c11\u7684\u65f6\u95f4\u3002\u6d88\u606f\u961f\u5217\u901a\u8fc7\u4e00\u4e2a\u7f13\u51b2\u5c42\u6765\u5e2e\u52a9\u4efb\u52a1\u6700\u9ad8\u6548\u7387\u7684\u6267\u884c\u2014\u2014\u2014\u5199\u5165\u961f\u5217\u7684\u5904\u7406\u4f1a\u5c3d\u53ef\u80fd\u7684\u5feb\u901f\u3002\u8be5\u7f13\u51b2\u6709\u52a9\u4e8e\u63a7\u5236\u548c\u4f18\u5316\u6570\u636e\u6d41\u7ecf\u8fc7\u7cfb\u7edf\u7684\u901f\u5ea6\u3002","title":"2.7\u3000\u7f13\u51b2"},{"location":"hmtt/day06/#28","text":"\u5f88\u591a\u65f6\u5019\uff0c\u7528\u6237\u4e0d\u60f3\u4e5f\u4e0d\u9700\u8981\u7acb\u5373\u5904\u7406\u6d88\u606f\u3002\u6d88\u606f\u961f\u5217\u63d0\u4f9b\u4e86\u5f02\u6b65\u5904\u7406\u673a\u5236\uff0c\u5141\u8bb8\u7528\u6237\u628a\u4e00\u4e2a\u6d88\u606f\u653e\u5165\u961f\u5217\uff0c\u4f46\u5e76\u4e0d\u7acb\u5373\u5904\u7406\u5b83\u3002\u60f3\u5411\u961f\u5217\u4e2d\u653e\u5165\u591a\u5c11\u6d88\u606f\u5c31\u653e\u591a\u5c11\uff0c\u7136\u540e\u5728\u9700\u8981\u7684\u65f6\u5019\u518d\u53bb\u5904\u7406\u5b83\u4eec\u3002","title":"2.8\u3000\u5f02\u6b65\u901a\u4fe1"},{"location":"hmtt/day06/#3message_queue","text":"","title":"3\u3001\u5e38\u7528Message Queue\u5bf9\u6bd4"},{"location":"hmtt/day06/#31_rabbitmq","text":"RabbitMQ\u662f\u4f7f\u7528Erlang\u7f16\u5199\u7684\u4e00\u4e2a\u5f00\u6e90\u7684\u6d88\u606f\u961f\u5217\uff0c\u672c\u8eab\u652f\u6301\u5f88\u591a\u7684\u534f\u8bae\uff1aAMQP\uff0cXMPP, SMTP, STOMP\uff0c\u4e5f\u6b63\u56e0\u5982\u6b64\uff0c\u5b83\u975e\u5e38\u91cd\u91cf\u7ea7\uff0c\u66f4\u9002\u5408\u4e8e\u4f01\u4e1a\u7ea7\u7684\u5f00\u53d1\u3002\u540c\u65f6\u5b9e\u73b0\u4e86Broker\u6784\u67b6\uff0c\u8fd9\u610f\u5473\u7740\u6d88\u606f\u5728\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u65f6\u5148\u5728\u4e2d\u5fc3\u961f\u5217\u6392\u961f\u3002\u5bf9\u8def\u7531\uff0c\u8d1f\u8f7d\u5747\u8861\u6216\u8005\u6570\u636e\u6301\u4e45\u5316\u90fd\u6709\u5f88\u597d\u7684\u652f\u6301\u3002","title":"3.1\u3000RabbitMQ"},{"location":"hmtt/day06/#32_redis","text":"Redis\u662f\u4e00\u4e2a\u57fa\u4e8eKey-Value\u5bf9\u7684NoSQL\u6570\u636e\u5e93\uff0c\u5f00\u53d1\u7ef4\u62a4\u5f88\u6d3b\u8dc3\u3002\u867d\u7136\u5b83\u662f\u4e00\u4e2aKey-Value\u6570\u636e\u5e93\u5b58\u50a8\u7cfb\u7edf\uff0c\u4f46\u5b83\u672c\u8eab\u652f\u6301MQ\u529f\u80fd\uff0c\u6240\u4ee5\u5b8c\u5168\u53ef\u4ee5\u5f53\u505a\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u7684\u961f\u5217\u670d\u52a1\u6765\u4f7f\u7528\u3002\u5bf9\u4e8eRabbitMQ\u548cRedis\u7684\u5165\u961f\u548c\u51fa\u961f\u64cd\u4f5c\uff0c\u5404\u6267\u884c100\u4e07\u6b21\uff0c\u6bcf10\u4e07\u6b21\u8bb0\u5f55\u4e00\u6b21\u6267\u884c\u65f6\u95f4\u3002\u6d4b\u8bd5\u6570\u636e\u5206\u4e3a128Bytes\u3001512Bytes\u30011K\u548c10K\u56db\u4e2a\u4e0d\u540c\u5927\u5c0f\u7684\u6570\u636e\u3002\u5b9e\u9a8c\u8868\u660e\uff1a\u5165\u961f\u65f6\uff0c\u5f53\u6570\u636e\u6bd4\u8f83\u5c0f\u65f6Redis\u7684\u6027\u80fd\u8981\u9ad8\u4e8eRabbitMQ\uff0c\u800c\u5982\u679c\u6570\u636e\u5927\u5c0f\u8d85\u8fc7\u4e8610K\uff0cRedis\u5219\u6162\u7684\u65e0\u6cd5\u5fcd\u53d7\uff1b\u51fa\u961f\u65f6\uff0c\u65e0\u8bba\u6570\u636e\u5927\u5c0f\uff0cRedis\u90fd\u8868\u73b0\u51fa\u975e\u5e38\u597d\u7684\u6027\u80fd\uff0c\u800cRabbitMQ\u7684\u51fa\u961f\u6027\u80fd\u5219\u8fdc\u4f4e\u4e8eRedis\u3002","title":"3.2\u3000Redis"},{"location":"hmtt/day06/#33_zeromq","text":"ZeroMQ\u53f7\u79f0\u6700\u5feb\u7684\u6d88\u606f\u961f\u5217\u7cfb\u7edf\uff0c\u5c24\u5176\u9488\u5bf9\u5927\u541e\u5410\u91cf\u7684\u9700\u6c42\u573a\u666f\u3002ZeroMQ\u80fd\u591f\u5b9e\u73b0RabbitMQ\u4e0d\u64c5\u957f\u7684\u9ad8\u7ea7/\u590d\u6742\u7684\u961f\u5217\uff0c\u4f46\u662f\u5f00\u53d1\u4eba\u5458\u9700\u8981\u81ea\u5df1\u7ec4\u5408\u591a\u79cd\u6280\u672f\u6846\u67b6\uff0c\u6280\u672f\u4e0a\u7684\u590d\u6742\u5ea6\u662f\u5bf9\u8fd9MQ\u80fd\u591f\u5e94\u7528\u6210\u529f\u7684\u6311\u6218\u3002ZeroMQ\u5177\u6709\u4e00\u4e2a\u72ec\u7279\u7684\u975e\u4e2d\u95f4\u4ef6\u7684\u6a21\u5f0f\uff0c\u4f60\u4e0d\u9700\u8981\u5b89\u88c5\u548c\u8fd0\u884c\u4e00\u4e2a\u6d88\u606f\u670d\u52a1\u5668\u6216\u4e2d\u95f4\u4ef6\uff0c\u56e0\u4e3a\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u5c06\u626e\u6f14\u8fd9\u4e2a\u670d\u52a1\u5668\u89d2\u8272\u3002\u4f60\u53ea\u9700\u8981\u7b80\u5355\u7684\u5f15\u7528ZeroMQ\u7a0b\u5e8f\u5e93\uff0c\u53ef\u4ee5\u4f7f\u7528NuGet\u5b89\u88c5\uff0c\u7136\u540e\u4f60\u5c31\u53ef\u4ee5\u6109\u5feb\u7684\u5728\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u53d1\u9001\u6d88\u606f\u4e86\u3002\u4f46\u662fZeroMQ\u4ec5\u63d0\u4f9b\u975e\u6301\u4e45\u6027\u7684\u961f\u5217\uff0c\u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u5b95\u673a\uff0c\u6570\u636e\u5c06\u4f1a\u4e22\u5931\u3002\u5176\u4e2d\uff0cTwitter\u7684Storm 0.9.0\u4ee5\u524d\u7684\u7248\u672c\u4e2d\u9ed8\u8ba4\u4f7f\u7528ZeroMQ\u4f5c\u4e3a\u6570\u636e\u6d41\u7684\u4f20\u8f93\uff08Storm\u4ece0.9\u7248\u672c\u5f00\u59cb\u540c\u65f6\u652f\u6301ZeroMQ\u548cNetty\u4f5c\u4e3a\u4f20\u8f93\u6a21\u5757\uff09\u3002","title":"3.3\u3000ZeroMQ"},{"location":"hmtt/day06/#34_activemq","text":"ActiveMQ\u662fApache\u4e0b\u7684\u4e00\u4e2a\u5b50\u9879\u76ee\u3002 \u7c7b\u4f3c\u4e8eZeroMQ\uff0c\u5b83\u80fd\u591f\u4ee5\u4ee3\u7406\u4eba\u548c\u70b9\u5bf9\u70b9\u7684\u6280\u672f\u5b9e\u73b0\u961f\u5217\u3002\u540c\u65f6\u7c7b\u4f3c\u4e8eRabbitMQ\uff0c\u5b83\u5c11\u91cf\u4ee3\u7801\u5c31\u53ef\u4ee5\u9ad8\u6548\u5730\u5b9e\u73b0\u9ad8\u7ea7\u5e94\u7528\u573a\u666f\u3002","title":"3.4\u3000ActiveMQ"},{"location":"hmtt/day06/#35_kafkajafka","text":"Kafka\u662fApache\u4e0b\u7684\u4e00\u4e2a\u5b50\u9879\u76ee\uff0c\u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u8de8\u8bed\u8a00\u5206\u5e03\u5f0f\u53d1\u5e03/\u8ba2\u9605\u6d88\u606f\u961f\u5217\u7cfb\u7edf\uff0c\u800cJafka\u662f\u5728Kafka\u4e4b\u4e0a\u5b75\u5316\u800c\u6765\u7684\uff0c\u5373Kafka\u7684\u4e00\u4e2a\u5347\u7ea7\u7248\u3002\u5177\u6709\u4ee5\u4e0b\u7279\u6027\uff1a\u5feb\u901f\u6301\u4e45\u5316\uff0c\u53ef\u4ee5\u5728O(1)\u7684\u7cfb\u7edf\u5f00\u9500\u4e0b\u8fdb\u884c\u6d88\u606f\u6301\u4e45\u5316\uff1b\u9ad8\u541e\u5410\uff0c\u5728\u4e00\u53f0\u666e\u901a\u7684\u670d\u52a1\u5668\u4e0a\u65e2\u53ef\u4ee5\u8fbe\u523010W/s\u7684\u541e\u5410\u901f\u7387\uff1b\u5b8c\u5168\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0cBroker\u3001Producer\u3001Consumer\u90fd\u539f\u751f\u81ea\u52a8\u652f\u6301\u5206\u5e03\u5f0f\uff0c\u81ea\u52a8\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861\uff1b\u652f\u6301Hadoop\u6570\u636e\u5e76\u884c\u52a0\u8f7d\uff0c\u5bf9\u4e8e\u50cfHadoop\u7684\u4e00\u6837\u7684\u65e5\u5fd7\u6570\u636e\u548c\u79bb\u7ebf\u5206\u6790\u7cfb\u7edf\uff0c\u4f46\u53c8\u8981\u6c42\u5b9e\u65f6\u5904\u7406\u7684\u9650\u5236\uff0c\u8fd9\u662f\u4e00\u4e2a\u53ef\u884c\u7684\u89e3\u51b3\u65b9\u6848\u3002Kafka\u901a\u8fc7Hadoop\u7684\u5e76\u884c\u52a0\u8f7d\u673a\u5236\u7edf\u4e00\u4e86\u5728\u7ebf\u548c\u79bb\u7ebf\u7684\u6d88\u606f\u5904\u7406\u3002Apache Kafka\u76f8\u5bf9\u4e8eActiveMQ\u662f\u4e00\u4e2a\u975e\u5e38\u8f7b\u91cf\u7ea7\u7684\u6d88\u606f\u7cfb\u7edf\uff0c\u9664\u4e86\u6027\u80fd\u975e\u5e38\u597d\u4e4b\u5916\uff0c\u8fd8\u662f\u4e00\u4e2a\u5de5\u4f5c\u826f\u597d\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\u3002","title":"3.5\u3000Kafka/Jafka"},{"location":"hmtt/day06/#4kafka","text":"","title":"4\u3001Kafka\u4e2d\u7684\u672f\u8bed\u89e3\u91ca"},{"location":"hmtt/day06/#41","text":"\u5728\u6df1\u5165\u7406\u89e3Kafka\u4e4b\u524d\uff0c\u5148\u4ecb\u7ecd\u4e00\u4e0bKafka\u4e2d\u7684\u672f\u8bed\u3002\u4e0b\u56fe\u5c55\u793a\u4e86Kafka\u7684\u76f8\u5173\u672f\u8bed\u4ee5\u53ca\u4e4b\u95f4\u7684\u5173\u7cfb\uff1a","title":"4.1\u3000\u6982\u8ff0"},{"location":"hmtt/day06/#42_broker","text":"Kafka \u96c6\u7fa4\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u8282\u70b9\u79f0\u4e3abroker\u3002 broker\u5b58\u50a8topic\u7684\u6570\u636e\u3002\u5982\u679c\u67d0topic\u6709N\u4e2apartition\uff0c\u96c6\u7fa4\u6709N\u4e2abroker\uff0c\u90a3\u4e48\u6bcf\u4e2abroker\u5b58\u50a8\u8be5topic\u7684\u4e00\u4e2apartition\u3002 \u5982\u679c\u67d0topic\u6709N\u4e2apartition\uff0c\u96c6\u7fa4\u6709(N+M)\u4e2abroker\uff0c\u90a3\u4e48\u5176\u4e2d\u6709N\u4e2abroker\u5b58\u50a8\u8be5topic\u7684\u4e00\u4e2apartition\uff0c\u5269\u4e0b\u7684M\u4e2abroker\u4e0d\u5b58\u50a8\u8be5topic\u7684partition\u6570\u636e\u3002 \u5982\u679c\u67d0topic\u6709N\u4e2apartition\uff0c\u96c6\u7fa4\u4e2dbroker\u6570\u76ee\u5c11\u4e8eN\u4e2a\uff0c\u90a3\u4e48\u4e00\u4e2abroker\u5b58\u50a8\u8be5topic\u7684\u4e00\u4e2a\u6216\u591a\u4e2apartition\u3002\u5728\u5b9e\u9645\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u5c3d\u91cf\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\u7684\u53d1\u751f\uff0c\u8fd9\u79cd\u60c5\u51b5\u5bb9\u6613\u5bfc\u81f4Kafka\u96c6\u7fa4\u6570\u636e\u4e0d\u5747\u8861\u3002","title":"4.2\u3000broker"},{"location":"hmtt/day06/#43_topic","text":"\u6bcf\u6761\u53d1\u5e03\u5230Kafka\u96c6\u7fa4\u7684\u6d88\u606f\u90fd\u6709\u4e00\u4e2a\u7c7b\u522b\uff0c\u8fd9\u4e2a\u7c7b\u522b\u88ab\u79f0\u4e3aTopic\u3002\uff08\u7269\u7406\u4e0a\u4e0d\u540cTopic\u7684\u6d88\u606f\u5206\u5f00\u5b58\u50a8\uff0c\u903b\u8f91\u4e0a\u4e00\u4e2aTopic\u7684\u6d88\u606f\u867d\u7136\u4fdd\u5b58\u4e8e\u4e00\u4e2a\u6216\u591a\u4e2abroker\u4e0a\u4f46\u7528\u6237\u53ea\u9700\u6307\u5b9a\u6d88\u606f\u7684Topic\u5373\u53ef\u751f\u4ea7\u6216\u6d88\u8d39\u6570\u636e\u800c\u4e0d\u5fc5\u5173\u5fc3\u6570\u636e\u5b58\u4e8e\u4f55\u5904\uff09 \u7c7b\u4f3c\u4e8e\u6570\u636e\u5e93\u7684\u8868\u540d","title":"4.3\u3000Topic"},{"location":"hmtt/day06/#43_partition","text":"topic\u4e2d\u7684\u6570\u636e\u5206\u5272\u4e3a\u4e00\u4e2a\u6216\u591a\u4e2apartition\u3002\u6bcf\u4e2atopic\u81f3\u5c11\u6709\u4e00\u4e2apartition\u3002\u6bcf\u4e2apartition\u4e2d\u7684\u6570\u636e\u4f7f\u7528\u591a\u4e2asegment\u6587\u4ef6\u5b58\u50a8\u3002partition\u4e2d\u7684\u6570\u636e\u662f\u6709\u5e8f\u7684\uff0c\u4e0d\u540cpartition\u95f4\u7684\u6570\u636e\u4e22\u5931\u4e86\u6570\u636e\u7684\u987a\u5e8f\u3002\u5982\u679ctopic\u6709\u591a\u4e2apartition\uff0c\u6d88\u8d39\u6570\u636e\u65f6\u5c31\u4e0d\u80fd\u4fdd\u8bc1\u6570\u636e\u7684\u987a\u5e8f\u3002\u5728\u9700\u8981\u4e25\u683c\u4fdd\u8bc1\u6d88\u606f\u7684\u6d88\u8d39\u987a\u5e8f\u7684\u573a\u666f\u4e0b\uff0c\u9700\u8981\u5c06partition\u6570\u76ee\u8bbe\u4e3a1\u3002","title":"4.3\u3000Partition"},{"location":"hmtt/day06/#44_producer","text":"\u751f\u4ea7\u8005\u5373\u6570\u636e\u7684\u53d1\u5e03\u8005\uff0c\u8be5\u89d2\u8272\u5c06\u6d88\u606f\u53d1\u5e03\u5230Kafka\u7684topic\u4e2d\u3002broker\u63a5\u6536\u5230\u751f\u4ea7\u8005\u53d1\u9001\u7684\u6d88\u606f\u540e\uff0cbroker\u5c06\u8be5\u6d88\u606f \u8ffd\u52a0 \u5230\u5f53\u524d\u7528\u4e8e\u8ffd\u52a0\u6570\u636e\u7684segment\u6587\u4ef6\u4e2d\u3002\u751f\u4ea7\u8005\u53d1\u9001\u7684\u6d88\u606f\uff0c\u5b58\u50a8\u5230\u4e00\u4e2apartition\u4e2d\uff0c\u751f\u4ea7\u8005\u4e5f\u53ef\u4ee5\u6307\u5b9a\u6570\u636e\u5b58\u50a8\u7684partition\u3002","title":"4.4\u3000Producer"},{"location":"hmtt/day06/#45_consumer","text":"\u6d88\u8d39\u8005\u53ef\u4ee5\u4ecebroker\u4e2d\u8bfb\u53d6\u6570\u636e\u3002\u6d88\u8d39\u8005\u53ef\u4ee5\u6d88\u8d39\u591a\u4e2atopic\u4e2d\u7684\u6570\u636e\u3002","title":"4.5\u3000Consumer"},{"location":"hmtt/day06/#46_consumer_group","text":"\u6bcf\u4e2aConsumer\u5c5e\u4e8e\u4e00\u4e2a\u7279\u5b9a\u7684Consumer Group\uff08\u53ef\u4e3a\u6bcf\u4e2aConsumer\u6307\u5b9agroup name\uff0c\u82e5\u4e0d\u6307\u5b9agroup name\u5219\u5c5e\u4e8e\u9ed8\u8ba4\u7684group\uff09\u3002","title":"4.6\u3000Consumer Group"},{"location":"hmtt/day06/#47_leader","text":"\u6bcf\u4e2apartition\u6709\u591a\u4e2a\u526f\u672c\uff0c\u5176\u4e2d\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\u4f5c\u4e3aLeader\uff0cLeader\u662f\u5f53\u524d\u8d1f\u8d23\u6570\u636e\u7684\u8bfb\u5199\u7684partition\u3002","title":"4.7\u3000Leader"},{"location":"hmtt/day06/#48_follower","text":"Follower\u8ddf\u968fLeader\uff0c\u6240\u6709\u5199\u8bf7\u6c42\u90fd\u901a\u8fc7Leader\u8def\u7531\uff0c\u6570\u636e\u53d8\u66f4\u4f1a\u5e7f\u64ad\u7ed9\u6240\u6709Follower\uff0cFollower\u4e0eLeader\u4fdd\u6301\u6570\u636e\u540c\u6b65\u3002\u5982\u679cLeader\u5931\u6548\uff0c\u5219\u4eceFollower\u4e2d\u9009\u4e3e\u51fa\u4e00\u4e2a\u65b0\u7684Leader\u3002\u5f53Follower\u4e0eLeader\u6302\u6389\u3001\u5361\u4f4f\u6216\u8005\u540c\u6b65\u592a\u6162\uff0cleader\u4f1a\u628a\u8fd9\u4e2afollower\u4ece\u201cin sync replicas\u201d\uff08ISR\uff09\u5217\u8868\u4e2d\u5220\u9664\uff0c\u91cd\u65b0\u521b\u5efa\u4e00\u4e2aFollower\u3002","title":"4.8\u3000Follower"},{"location":"hmtt/day06/#03-kafka_1121","text":"\u542f\u52a8\u865a\u62df\u673a\u4e4b\u540e\uff0c\u4fee\u6539\u7528\u6237\u540d\u4e3aroot,\u5bc6\u7801\u4e3aitcast \u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a service zookeeper start service kafka start","title":"03-kafka\u5b89\u88c5 11:21"},{"location":"hmtt/day06/#04-_1315","text":"package com.itheima.kafka.simple ; import org.apache.kafka.clients.producer.* ; import org.apache.kafka.common.serialization.StringSerializer ; import java.util.Properties ; /** * Kafka \u6d88\u606f\u751f\u4ea7\u8005 */ public class ProducerFastStart { // Kafka\u96c6\u7fa4\u5730\u5740 private static final String brokerList = \"192.168.226.134:9092\" ; // \u4e3b\u9898\u540d\u79f0-\u4e4b\u524d\u5df2\u7ecf\u521b\u5efa private static final String topic = \"kafka-hello\" ; public static void main ( String [] args ) { Properties properties = new Properties (); // \u8bbe\u7f6ekey\u5e8f\u5217\u5316\u5668 properties . put ( ProducerConfig . KEY_SERIALIZER_CLASS_CONFIG , StringSerializer . class . getName ()); // \u8bbe\u7f6e\u91cd\u8bd5\u6b21\u6570 properties . put ( ProducerConfig . RETRIES_CONFIG , 10 ); // \u8bbe\u7f6e\u503c\u5e8f\u5217\u5316\u5668 properties . put ( ProducerConfig . VALUE_SERIALIZER_CLASS_CONFIG , StringSerializer . class . getName ()); // \u8bbe\u7f6e\u96c6\u7fa4\u5730\u5740 properties . put ( ProducerConfig . BOOTSTRAP_SERVERS_CONFIG , brokerList ); // KafkaProducer KafkaProducer < String , String > producer = new KafkaProducer < String , String > ( properties ); //\u5c01\u88c5\u6d88\u606f ProducerRecord < String , String > record = new ProducerRecord < String , String > ( topic , \"Kafka-demo-001\" , \"hello, Kafka!\" ); try { //\u53d1\u9001\u6d88\u606f producer . send ( record ); } catch ( Exception e ) { e . printStackTrace (); } producer . close (); } }","title":"04-\u5165\u95e8\u6848\u4f8b\u751f\u4ea7\u8005 13:15"},{"location":"hmtt/day06/#05-_0823","text":"package com.itheima.kafka.simple ; import org.apache.kafka.clients.consumer.* ; import org.apache.kafka.common.serialization.StringDeserializer ; import java.time.Duration ; import java.util.Collections ; import java.util.Properties ; /** * Kafka \u6d88\u606f\u6d88\u8d39\u8005 */ public class ConsumerFastStart { // Kafka\u96c6\u7fa4\u5730\u5740 private static final String brokerList = \"192.168.200.130:9092\" ; // \u4e3b\u9898\u540d\u79f0-\u4e4b\u524d\u5df2\u7ecf\u521b\u5efa private static final String topic = \"kafka-hello\" ; // \u6d88\u8d39\u7ec4 private static final String groupId = \"group.demo1\" ; public static void main ( String [] args ) { Properties properties = new Properties (); properties . put ( ConsumerConfig . BOOTSTRAP_SERVERS_CONFIG , brokerList ); properties . put ( ConsumerConfig . KEY_DESERIALIZER_CLASS_CONFIG , StringDeserializer . class . getName ()); properties . put ( ConsumerConfig . VALUE_DESERIALIZER_CLASS_CONFIG , StringDeserializer . class . getName ()); properties . put ( ConsumerConfig . GROUP_ID_CONFIG , groupId ); KafkaConsumer < String , String > consumer = new KafkaConsumer < String , String > ( properties ); consumer . subscribe ( Collections . singletonList ( topic )); while ( true ) { ConsumerRecords < String , String > records = consumer . poll ( Duration . ofMillis ( 1000 )); for ( ConsumerRecord < String , String > record : records ) { System . out . println ( record . value ()); } } } } onsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(1000)); \u6307\u5b9a\u76841\u79d2\u662f\u7b49\u5f85\u6d88\u606f\u8d85\u65f6\u65f6\u95f4 \u5047\u8bbe\u6d88\u8d39\u8005\u80fd\u6536\u5230\u4e00\u6761\u6d88\u606f\uff0ckafka\u4f1a\u76f4\u63a5\u5c06\u4e00\u6761\u6d88\u606f\u53d1\u9001\u7ed9\u6d88\u8d39\u8005\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1kafka\u53ca\u65f6\u6027","title":"05-\u6d88\u8d39\u8005 08:23"},{"location":"hmtt/day06/#06-_0310","text":"\u6bcf\u4e2a\u7ec4\u53ea\u80fd\u63a5\u6536\u52301\u4e2a\u6d88\u606f\uff0c\u4e0d\u540c\u7ec4\u53ea\u8981\u8ba2\u9605\u4e86topic\uff0c\u90fd\u80fd\u63a5\u6536\u5230\u8fd9\u4e2a\u6d88\u606f\u3002","title":"06-\u6d4b\u8bd5 03:10"},{"location":"hmtt/day06/#07-_0948","text":"","title":"07-\u76f8\u5173\u6982\u5ff5 09:48"},{"location":"hmtt/day06/#08-_0637","text":"\u53d1\u9001\u5e76\u5fd8\u8bb0\uff08fire-and-forget) One Way \u628a\u6d88\u606f\u53d1\u9001\u7ed9\u670d\u52a1\u5668\uff0c\u5e76\u4e0d\u5173\u5fc3\u5b83\u662f\u5426\u6b63\u5e38\u5230\u8fbe\uff0c\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u6d88\u606f\u4f1a\u6b63\u5e38\u5230\u8fbe\uff0c\u56e0\u4e3akafka\u662f\u9ad8\u53ef\u7528\u7684\uff0c\u800c\u4e14\u751f\u4ea7\u8005\u4f1a\u81ea\u52a8\u5c1d\u8bd5\u91cd\u53d1\uff0c\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u6709\u65f6\u5019\u4f1a\u4e22\u5931\u4e00\u4e9b\u4fe1\u606f \u540c\u6b65\u53d1\u9001 \u4f7f\u7528send()\u65b9\u6cd5\u53d1\u9001\uff0c\u5b83\u4f1a\u8fd4\u56de\u4e00\u4e2aFuture\u5bf9\u8c61\uff0c\u8c03\u7528get()\u65b9\u6cd5\u8fdb\u884c\u7b49\u5f85\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053\u6d88\u606f\u662f\u5426\u53d1\u9001\u6210\u529f //\u53d1\u9001\u6d88\u606f try { RecordMetadata recordMetadata = producer . send ( record ). get (); System . out . println ( recordMetadata . offset ()); //\u83b7\u53d6\u504f\u79fb\u91cf } catch ( Exception e ){ e . printStackTrace (); } \u5982\u679c\u670d\u52a1\u5668\u8fd4\u56de\u9519\u8bef\uff0cget()\u65b9\u6cd5\u4f1a\u629b\u51fa\u5f02\u5e38\uff0c\u5982\u679c\u6ca1\u6709\u53d1\u751f\u9519\u8bef\uff0c\u6211\u4eec\u5c31\u4f1a\u5f97\u5230\u4e00\u4e2aRecordMetadata\u5bf9\u8c61\uff0c\u53ef\u4ee5\u7528\u5b83\u6765\u83b7\u53d6\u6d88\u606f\u7684\u504f\u79fb\u91cf \u5f02\u6b65\u53d1\u9001 \u8c03\u7528send()\u65b9\u6cd5\uff0c\u5e76\u6307\u5b9a\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u670d\u52a1\u5668\u5728\u8fd4\u56de\u54cd\u5e94\u65f6\u8c03\u7528\u51fd\u6570\u3002\u5982\u4e0b\u4ee3\u7801 //\u53d1\u9001\u6d88\u606f try { producer . send ( record , new Callback () { @Override public void onCompletion ( RecordMetadata recordMetadata , Exception e ) { if ( e != null ){ e . printStackTrace (); } System . out . println ( recordMetadata . offset ()); } }); //\u6267\u884c\u5176\u4ed6\u903b\u8f91 } catch ( Exception e ){ e . printStackTrace (); } \u5982\u679ckafka\u8fd4\u56de\u4e00\u4e2a\u9519\u8bef\uff0conCompletion()\u65b9\u6cd5\u4f1a\u629b\u51fa\u4e00\u4e2a\u975e\u7a7a\uff08non null\uff09\u5f02\u5e38\uff0c\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u5904\u7406\uff0c\u6bd4\u5982\u8bb0\u5f55\u9519\u8bef\u65e5\u5fd7\uff0c\u6216\u8005\u628a\u6d88\u606f\u5199\u5165\u201c\u9519\u8bef\u6d88\u606f\u201d\u6587\u4ef6\u4e2d\uff0c\u65b9\u4fbf\u540e\u671f\u8fdb\u884c\u5206\u6790\u3002","title":"08-\u751f\u4ea7\u8005\u539f\u7406 06\uff1a37"},{"location":"hmtt/day06/#09-_0403","text":"\u751f\u4ea7\u8005\u8fd8\u6709\u5f88\u591a\u53ef\u914d\u7f6e\u7684\u53c2\u6570\uff0c\u5728kafka\u5b98\u65b9\u6587\u6863\u4e2d\u90fd\u6709\u8bf4\u660e\uff0c\u5927\u90e8\u5206\u90fd\u6709\u5408\u7406\u7684\u9ed8\u8ba4\u503c\uff0c\u6240\u4ee5\u6ca1\u6709\u5fc5\u8981\u53bb\u4fee\u6539\u5b83\u4eec\uff0c\u4e0d\u8fc7\u6709\u51e0\u4e2a\u53c2\u6570\u5728\u5185\u5b58\u4f7f\u7528\uff0c\u6027\u80fd\u548c\u53ef\u9760\u6027\u65b9\u6cd5\u5bf9\u751f\u4ea7\u8005\u6709\u5f71\u54cd acks \u6307\u7684\u662fproducer\u7684\u6d88\u606f\u53d1\u9001\u786e\u8ba4\u673a\u5236 acks=0 \u751f\u4ea7\u8005\u5728\u6210\u529f\u5199\u5165\u6d88\u606f\u4e4b\u524d\u4e0d\u4f1a\u7b49\u5f85\u4efb\u4f55\u6765\u81ea\u670d\u52a1\u5668\u7684\u54cd\u5e94\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u5f53\u4e2d\u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u5bfc\u81f4\u670d\u52a1\u5668\u6ca1\u6709\u6536\u5230\u6d88\u606f\uff0c\u90a3\u4e48\u751f\u4ea7\u8005\u5c31\u65e0\u4ece\u5f97\u77e5\uff0c\u6d88\u606f\u4e5f\u5c31\u4e22\u5931\u4e86\u3002\u4e0d\u8fc7\uff0c\u56e0\u4e3a\u751f\u4ea7\u8005\u4e0d\u9700\u8981\u7b49\u5f85\u670d\u52a1\u5668\u7684\u54cd\u5e94\uff0c\u6240\u4ee5\u5b83\u53ef\u4ee5\u4ee5\u7f51\u7edc\u80fd\u591f\u652f\u6301\u7684\u6700\u5927\u901f\u5ea6\u53d1\u9001\u6d88\u606f\uff0c\u4ece\u800c\u8fbe\u5230\u5f88\u9ad8\u7684\u541e\u5410\u91cf\u3002 acks=1 \u53ea\u8981\u96c6\u7fa4\u9996\u9886\u8282\u70b9\u6536\u5230\u6d88\u606f\uff0c\u751f\u4ea7\u8005\u5c31\u4f1a\u6536\u5230\u4e00\u4e2a\u6765\u81ea\u670d\u52a1\u5668\u7684\u6210\u529f\u54cd\u5e94\uff0c\u5982\u679c\u6d88\u606f\u65e0\u6cd5\u5230\u8fbe\u9996\u9886\u8282\u70b9\uff0c\u751f\u4ea7\u8005\u4f1a\u6536\u5230\u4e00\u4e2a\u9519\u8bef\u54cd\u5e94\uff0c\u4e3a\u4e86\u907f\u514d\u6570\u636e\u4e22\u5931\uff0c\u751f\u4ea7\u8005\u4f1a\u91cd\u53d1\u6d88\u606f\u3002 acks=all \u53ea\u6709\u5f53\u6240\u6709\u53c2\u4e0e\u8d4b\u503c\u7684\u8282\u70b9\u5168\u90e8\u6536\u5230\u6d88\u606f\u65f6\uff0c\u751f\u4ea7\u8005\u624d\u4f1a\u6536\u5230\u4e00\u4e2a\u6765\u81ea\u670d\u52a1\u5668\u7684\u6210\u529f\u54cd\u5e94\uff0c\u8fd9\u79cd\u6a21\u5f0f\u662f\u6700\u5b89\u5168\u7684\uff0c\u5b83\u53ef\u4ee5\u4fdd\u8bc1\u4e0d\u6b62\u4e00\u4e2a\u670d\u52a1\u5668\u6536\u5230\u6d88\u606f\uff0c\u5c31\u7b97\u6709\u670d\u52a1\u5668\u53d1\u751f\u5d29\u6e83\uff0c\u6574\u4e2a\u96c6\u7fa4\u4ecd\u7136\u53ef\u4ee5\u8fd0\u884c\u3002\u4e0d\u8fc7\u4ed6\u7684\u5ef6\u8fdf\u6bd4acks=1\u65f6\u66f4\u9ad8\u3002 retries \u751f\u4ea7\u8005\u4ece\u670d\u52a1\u5668\u6536\u5230\u7684\u9519\u8bef\u6709\u53ef\u80fd\u662f\u4e34\u65f6\u6027\u9519\u8bef\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cretries\u53c2\u6570\u7684\u503c\u51b3\u5b9a\u4e86\u751f\u4ea7\u8005\u53ef\u4ee5\u91cd\u53d1\u6d88\u606f\u7684\u6b21\u6570\uff0c\u5982\u679c\u8fbe\u5230\u8fd9\u4e2a\u6b21\u6570\uff0c\u751f\u4ea7\u8005\u4f1a\u653e\u5f03\u91cd\u8bd5\u8fd4\u56de\u9519\u8bef\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u751f\u4ea7\u8005\u4f1a\u5728\u6bcf\u6b21\u91cd\u8bd5\u4e4b\u95f4\u7b49\u5f85100ms","title":"09-\u751f\u4ea7\u8005\u914d\u7f6e 04:03"},{"location":"hmtt/day06/#10-_0430","text":"enable.auto.commit \u8be5\u5c5e\u6027\u6307\u5b9a\u4e86\u6d88\u8d39\u8005\u662f\u5426\u81ea\u52a8\u63d0\u4ea4\u504f\u79fb\u91cf\uff0c\u9ed8\u8ba4\u503c\u662ftrue\u3002\u4e3a\u4e86\u5c3d\u91cf\u907f\u514d\u51fa\u73b0\u91cd\u590d\u6570\u636e\u548c\u6570\u636e\u4e22\u5931\uff0c\u53ef\u4ee5\u628a\u5b83\u8bbe\u7f6e\u4e3afalse\uff0c\u7531\u81ea\u5df1\u63a7\u5236\u4f55\u65f6\u63d0\u4ea4\u504f\u79fb\u91cf\u3002\u5982\u679c\u628a\u5b83\u8bbe\u7f6e\u4e3atrue,\u8fd8\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e auto.commit.interval.ms \u5c5e\u6027\u6765\u63a7\u5236\u63d0\u4ea4\u7684\u9891\u7387\u3002 auto.offset.reset earliest \u5f53\u5404\u5206\u533a\u4e0b\u6709\u5df2\u63d0\u4ea4\u7684offset\u65f6\uff0c\u4ece\u63d0\u4ea4\u7684offset\u5f00\u59cb\u6d88\u8d39\uff1b\u65e0\u63d0\u4ea4\u7684offset\u65f6\uff0c\u4ece\u5934\u5f00\u59cb\u6d88\u8d39 \u5e42\u7b49\u6027\u4fdd\u8bc1 latest \u5f53\u5404\u5206\u533a\u4e0b\u6709\u5df2\u63d0\u4ea4\u7684offset\u65f6\uff0c\u4ece\u63d0\u4ea4\u7684offset\u5f00\u59cb\u6d88\u8d39\uff1b\u65e0\u63d0\u4ea4\u7684offset\u65f6\uff0c\u6d88\u8d39\u65b0\u4ea7\u751f\u7684\u8be5\u5206\u533a\u4e0b\u7684\u6570\u636e earliest \u4f1a\u91cd\u590d\u6d88\u8d39\uff0c\u4e0d\u4f1a\u4e22\u6570\u636e latest\u4f1a\u4e22\u6570\u636e\uff0c\u4f46\u662f\u4e0d\u4f1a\u91cd\u590d\u6d88\u8d39 none topic\u5404\u5206\u533a\u90fd\u5b58\u5728\u5df2\u63d0\u4ea4\u7684offset\u65f6\uff0c\u4eceoffset\u540e\u5f00\u59cb\u6d88\u8d39\uff1b\u53ea\u8981\u6709\u4e00\u4e2a\u5206\u533a\u4e0d\u5b58\u5728\u5df2\u63d0\u4ea4\u7684offset\uff0c\u5219\u629b\u51fa\u5f02\u5e38 anything else \u5411consumer\u629b\u51fa\u5f02\u5e38","title":"10-\u6d88\u8d39\u8005\u539f\u7406 04:30"},{"location":"hmtt/day06/#11-_1123","text":"","title":"11-\u63d0\u4ea4\u548c\u504f\u79fb\u91cf 11:23"},{"location":"hmtt/day06/#12-spring_boot_0915","text":"\u751f\u4ea7\u8005\uff1a server : port : 9991 spring : application : name : kafka-demo kafka : bootstrap-servers : 192.168.200.130:9092 #kafka\u96c6\u7fa4\u5730\u5740 producer : retries : 10 #\u751f\u4ea7\u8005\u6295\u9012\u6d88\u606f\u5931\u8d25\uff0c\u91cd\u8bd5\u6b21\u6570 batch-size : 16368 buffer-memory : 33554432 key-serializer : org.apache.kafka.common.serialization.StringSerializer #key\u5e8f\u5217\u5316\u5668->String value-serializer : org.apache.kafka.common.serialization.StringSerializer #value\u5e8f\u5217\u5316\u5668->String consumer : group-id : test-hello-group #\u6d88\u8d39\u8005\u7ec4\u540d 1.\u5982\u679c\u4e24\u4e2a\u6d88\u8d39\u8005\u5b9e\u4f8b\u5728\u4e00\u4e2a\u7ec4\u4e2d\uff0c\u53ea\u6709\u4e00\u4e2a\u80fd\u6d88\u8d39\u67d0\u4e2a\u5206\u533a #2.\u5982\u679c\u4e24\u4e2a\u6d88\u8d39\u8005\u4e0d\u5728\u4e00\u4e2a\u7ec4\u4e2d \u5e7f\u64ad auto-offset-reset : earliest #\u5982\u679c\u6ca1\u6709\u6536\u5230offset\uff0c\u4ece\u5934\u5f00\u59cb\u6d88\u8d39 enable-auto-commit : true #\u662f\u5426\u5f00\u542f\u81ea\u52a8\u63d0\u4ea4offset \u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u63d0\u4ea4 key-deserializer : org.apache.kafka.common.serialization.StringDeserializer value-deserializer : org.apache.kafka.common.serialization.StringDeserializer package com.itheima.kafka.controller ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.kafka.core.KafkaTemplate ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.RestController ; @RestController public class HelloController { @Autowired private KafkaTemplate < String , String > kafkaTemplate ; @GetMapping ( \"/hello\" ) public String hello (){ //\u7b2c\u4e00\u4e2a\u53c2\u6570\uff1atopics //\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff1a\u6d88\u606f\u5185\u5bb9 kafkaTemplate . send ( \"hello-itcast\" , \"key\" , \"hello springboot kafka\" ); return \"ok\" ; } } \u6d88\u8d39\u8005\uff1a package com.itheima.kafka.listener ; import org.apache.kafka.clients.consumer.ConsumerRecord ; import org.springframework.kafka.annotation.KafkaListener ; import org.springframework.stereotype.Component ; import java.util.Optional ; @Component public class HelloListener { @KafkaListener ( topics = { \"wm.news.auto.scan.topic\" }) public void receiverMessage ( ConsumerRecord <? , ?> record ){ Optional <? extends ConsumerRecord <? , ?>> optional = Optional . ofNullable ( record ); if ( optional . isPresent ()){ Object value = record . value (); System . out . println ( value ); } } } package com.itheima.kafka.listener ; import org.apache.kafka.clients.consumer.ConsumerRecord ; import org.springframework.kafka.annotation.KafkaListener ; import org.springframework.stereotype.Component ; import java.util.Optional ; @Component public class HelloListener { @KafkaListener ( topics = { \"wm.news.auto.scan.topic\" }) public void receiverMessage ( ConsumerRecord < String , String > record ){ String key = record . key (); String value = record . value (); } }","title":"12-\u96c6\u6210spring boot 09:15"},{"location":"hmtt/day06/#13-spring_boot_0402","text":"@RestController public class HelloController { @Autowired private KafkaTemplate < String , String > kafkaTemplate ; @GetMapping ( \"/hello\" ) public String hello (){ //\u53d1\u9001\u6d88\u606f User user = new User (); user . setUsername ( \"zhangsan\" ); user . setAge ( 18 ); kafkaTemplate . send ( \"kafka-hello\" , JSON . toJSONString ( user )); return \"ok\" ; } } @Component public class HelloListener { @KafkaListener ( topics = { \"hello-itcast\" }) public void receiverMessage ( ConsumerRecord <? , ?> record ){ Optional <? extends ConsumerRecord <? , ?>> optional = Optional . ofNullable ( record ); if ( optional . isPresent ()){ Object value = record . value (); User user = JSON . parseObject (( String ) value , User . class ); System . out . println ( user ); } } }","title":"13-spring boot\u5bf9\u8c61\u4f20\u9012 04:02"},{"location":"hmtt/day06/#14-_0634","text":"1.\u6ce8\u518c\u963f\u91cc\u4e91\u8d26\u53f7\uff08\u53ef\u4ee5\u4f7f\u7528\u652f\u4ed8\u5b9d\u626b\u7801\u767b\u5f55\uff09 2.\u5f00\u901a\u5185\u5bb9\u5b89\u5168 https://www.aliyun.com/product/lvwang 3.\u7533\u8bf7AK\u548cSK","title":"14-\u4e91\u76fe\u4ecb\u7ecd 06:34"},{"location":"hmtt/day06/#15-_1438","text":"\u641c\u7d22\u6587\u6863\uff1a\u6587\u672c\u5783\u573e\u5185\u5bb9\u68c0\u6d4b package com.itheima.aliyun.util ; import com.alibaba.fastjson.JSON ; import com.alibaba.fastjson.JSONArray ; import com.alibaba.fastjson.JSONObject ; import com.aliyun.oss.ClientException ; import com.aliyuncs.DefaultAcsClient ; import com.aliyuncs.IAcsClient ; import com.aliyuncs.exceptions.ServerException ; import com.aliyuncs.green.model.v20180509.TextScanRequest ; import com.aliyuncs.http.FormatType ; import com.aliyuncs.http.HttpResponse ; import com.aliyuncs.profile.DefaultProfile ; import com.aliyuncs.profile.IClientProfile ; import java.util.* ; public class Main { public static void main ( String [] args ) throws Exception { IClientProfile profile = DefaultProfile . getProfile ( \"cn-shanghai\" , \"LTAI4FmKL2EKYCGgN2az5M57\" , \"XjgvRoAGzM3rWQxKWDJx98VWOmO0Hz\" ); DefaultProfile . addEndpoint ( \"cn-shanghai\" , \"cn-shanghai\" , \"Green\" , \"green.cn-shanghai.aliyuncs.com\" ); IAcsClient client = new DefaultAcsClient ( profile ); TextScanRequest textScanRequest = new TextScanRequest (); textScanRequest . setAcceptFormat ( FormatType . JSON ); // \u6307\u5b9aAPI\u8fd4\u56de\u683c\u5f0f\u3002 textScanRequest . setHttpContentType ( FormatType . JSON ); textScanRequest . setMethod ( com . aliyuncs . http . MethodType . POST ); // \u6307\u5b9a\u8bf7\u6c42\u65b9\u6cd5\u3002 textScanRequest . setEncoding ( \"UTF-8\" ); textScanRequest . setRegionId ( \"cn-shanghai\" ); List < Map < String , Object >> tasks = new ArrayList < Map < String , Object >> (); Map < String , Object > task1 = new LinkedHashMap < String , Object > (); task1 . put ( \"dataId\" , UUID . randomUUID (). toString ()); /** * \u5f85\u68c0\u6d4b\u7684\u6587\u672c\uff0c\u957f\u5ea6\u4e0d\u8d85\u8fc710000\u4e2a\u5b57\u7b26\u3002 */ task1 . put ( \"content\" , \"\u6211\u662f\u4e00\u4e2a\u6587\u672c,\u4e70\u5356\u51b0\u6bd2\u662f\u8fdd\u6cd5\u7684\" ); tasks . add ( task1 ); JSONObject data = new JSONObject (); /** * \u68c0\u6d4b\u573a\u666f\u3002\u6587\u672c\u5783\u573e\u68c0\u6d4b\u8bf7\u4f20\u9012antispam\u3002 **/ data . put ( \"scenes\" , Arrays . asList ( \"antispam\" )); data . put ( \"tasks\" , tasks ); System . out . println ( JSON . toJSONString ( data , true )); textScanRequest . setHttpContent ( data . toJSONString (). getBytes ( \"UTF-8\" ), \"UTF-8\" , FormatType . JSON ); // \u8bf7\u52a1\u5fc5\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\u3002 textScanRequest . setConnectTimeout ( 3000 ); textScanRequest . setReadTimeout ( 6000 ); try { HttpResponse httpResponse = client . doAction ( textScanRequest ); if ( httpResponse . isSuccess ()){ JSONObject scrResponse = JSON . parseObject ( new String ( httpResponse . getHttpContent (), \"UTF-8\" )); System . out . println ( JSON . toJSONString ( scrResponse , true )); if ( 200 == scrResponse . getInteger ( \"code\" )) { JSONArray taskResults = scrResponse . getJSONArray ( \"data\" ); for ( Object taskResult : taskResults ) { if ( 200 == (( JSONObject ) taskResult ). getInteger ( \"code\" )){ JSONArray sceneResults = (( JSONObject ) taskResult ). getJSONArray ( \"results\" ); for ( Object sceneResult : sceneResults ) { String scene = (( JSONObject ) sceneResult ). getString ( \"scene\" ); String suggestion = (( JSONObject ) sceneResult ). getString ( \"suggestion\" ); //\u6839\u636escene\u548csuggetion\u505a\u76f8\u5173\u5904\u7406\u3002 //suggestion == pass\u8868\u793a\u672a\u547d\u4e2d\u5783\u573e\u3002suggestion == block\u8868\u793a\u547d\u4e2d\u4e86\u5783\u573e\uff0c\u53ef\u4ee5\u901a\u8fc7label\u5b57\u6bb5\u67e5\u770b\u547d\u4e2d\u7684\u5783\u573e\u5206\u7c7b\u3002 System . out . println ( \"args = [\" + scene + \"]\" ); System . out . println ( \"args = [\" + suggestion + \"]\" ); } } else { System . out . println ( \"task process fail:\" + (( JSONObject ) taskResult ). getInteger ( \"code\" )); } } } else { System . out . println ( \"detect not success. code:\" + scrResponse . getInteger ( \"code\" )); } } else { System . out . println ( \"response not success. status:\" + httpResponse . getStatus ()); } } catch ( ServerException e ) { e . printStackTrace (); } catch ( ClientException e ) { e . printStackTrace (); } catch ( Exception e ) { e . printStackTrace (); } } }","title":"15-\u6587\u672c\u5185\u5bb9\u5783\u573e\u68c0\u6d4b 14:38"},{"location":"hmtt/day06/#16-_1135","text":"package com.itheima.aliyun.util ; import com.alibaba.fastjson.JSON ; import com.alibaba.fastjson.JSONArray ; import com.alibaba.fastjson.JSONObject ; import com.aliyuncs.DefaultAcsClient ; import com.aliyuncs.IAcsClient ; import com.aliyuncs.green.model.v20180509.ImageSyncScanRequest ; import com.aliyuncs.http.FormatType ; import com.aliyuncs.http.HttpResponse ; import com.aliyuncs.http.MethodType ; import com.aliyuncs.http.ProtocolType ; import com.aliyuncs.profile.DefaultProfile ; import com.aliyuncs.profile.IClientProfile ; import java.util.* ; public class ImageScan { public static void main ( String [] args ) throws Exception { IClientProfile profile = DefaultProfile . getProfile ( \"cn-shanghai\" , \"LTAI4FmKL2EKYCGgN2az5M57\" , \"XjgvRoAGzM3rWQxKWDJx98VWOmO0Hz\" ); DefaultProfile . addEndpoint ( \"cn-shanghai\" , \"cn-shanghai\" , \"Green\" , \"green.cn-shanghai.aliyuncs.com\" ); IAcsClient client = new DefaultAcsClient ( profile ); ImageSyncScanRequest imageSyncScanRequest = new ImageSyncScanRequest (); // \u6307\u5b9aAPI\u8fd4\u56de\u683c\u5f0f\u3002 imageSyncScanRequest . setAcceptFormat ( FormatType . JSON ); // \u6307\u5b9a\u8bf7\u6c42\u65b9\u6cd5\u3002 imageSyncScanRequest . setMethod ( MethodType . POST ); imageSyncScanRequest . setEncoding ( \"utf-8\" ); //\u652f\u6301HTTP\u548cHTTPS\u3002 imageSyncScanRequest . setProtocol ( ProtocolType . HTTP ); JSONObject httpBody = new JSONObject (); /** * \u8bbe\u7f6e\u8981\u68c0\u6d4b\u7684\u573a\u666f\u3002\u8ba1\u8d39\u4f9d\u636e\u6b64\u5904\u4f20\u9012\u7684\u573a\u666f\u8ba1\u7b97\u3002 * \u4e00\u6b21\u8bf7\u6c42\u4e2d\u53ef\u4ee5\u540c\u65f6\u68c0\u6d4b\u591a\u5f20\u56fe\u7247\uff0c\u6bcf\u5f20\u56fe\u7247\u53ef\u4ee5\u540c\u65f6\u68c0\u6d4b\u591a\u4e2a\u98ce\u9669\u573a\u666f\uff0c\u8ba1\u8d39\u6309\u7167\u573a\u666f\u8ba1\u7b97\u3002 * \u4f8b\u5982\uff1a\u68c0\u6d4b2\u5f20\u56fe\u7247\uff0c\u573a\u666f\u4f20\u9012porn\u548cterrorism\uff0c\u8ba1\u8d39\u4f1a\u6309\u71672\u5f20\u56fe\u7247\u9274\u9ec4\uff0c2\u5f20\u56fe\u7247\u66b4\u6050\u68c0\u6d4b\u8ba1\u7b97\u3002 * porn\uff1a\u8868\u793a\u8272\u60c5\u573a\u666f\u68c0\u6d4b\u3002 */ httpBody . put ( \"scenes\" , Arrays . asList ( \"terrorism\" , \"porn\" )); /** * \u5982\u679c\u60a8\u8981\u68c0\u6d4b\u7684\u6587\u4ef6\u5b58\u4e8e\u672c\u5730\u670d\u52a1\u5668\u4e0a\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0b\u8ff0\u4ee3\u7801\u7247\u751f\u6210URL\u3002 * \u518d\u5c06\u8fd4\u56de\u7684URL\u4f5c\u4e3a\u56fe\u7247\u5730\u5740\u4f20\u9012\u5230\u670d\u52a1\u7aef\u8fdb\u884c\u68c0\u6d4b\u3002 */ String url = null ; ClientUploader clientUploader = ClientUploader . getImageClientUploader ( profile , false ); try { url = clientUploader . uploadFile ( \"E:\\\\heima-leadnews\\\\\u9ed1\u9a6c\u5934\u67612.0\\\\\u9ed1\u9a6c\u5934\u6761\u8bfe\u4ef6\\\\day06\\\\\u8d44\u6599\\\\\u56fe\u7247\\\\ak47.jpg\" ); } catch ( Exception e ){ e . printStackTrace (); } /** * \u8bbe\u7f6e\u5f85\u68c0\u6d4b\u56fe\u7247\u3002\u4e00\u5f20\u56fe\u7247\u5bf9\u5e94\u4e00\u4e2atask\u3002 * \u591a\u5f20\u56fe\u7247\u540c\u65f6\u68c0\u6d4b\u65f6\uff0c\u5904\u7406\u7684\u65f6\u95f4\u7531\u6700\u540e\u4e00\u4e2a\u5904\u7406\u5b8c\u7684\u56fe\u7247\u51b3\u5b9a\u3002 * \u901a\u5e38\u60c5\u51b5\u4e0b\u6279\u91cf\u68c0\u6d4b\u7684\u5e73\u5747\u54cd\u5e94\u65f6\u95f4\u6bd4\u5355\u5f20\u68c0\u6d4b\u7684\u8981\u957f\uff0c\u4e00\u6b21\u6279\u91cf\u63d0\u4ea4\u7684\u56fe\u7247\u6570\u8d8a\u591a\uff0c\u54cd\u5e94\u65f6\u95f4\u88ab\u62c9\u957f\u7684\u6982\u7387\u8d8a\u9ad8\u3002 * \u8fd9\u91cc\u4ee5\u5355\u5f20\u56fe\u7247\u68c0\u6d4b\u4f5c\u4e3a\u793a\u4f8b\u3002\u5982\u679c\u662f\u6279\u91cf\u56fe\u7247\u68c0\u6d4b\uff0c\u8bf7\u81ea\u884c\u6784\u5efa\u591a\u4e2atask\u3002 */ JSONObject task = new JSONObject (); task . put ( \"dataId\" , UUID . randomUUID (). toString ()); //\u8bbe\u7f6e\u56fe\u7247\u94fe\u63a5\u4e3a\u4e0a\u4f20\u540e\u7684URL\u3002 task . put ( \"url\" , url ); task . put ( \"time\" , new Date ()); httpBody . put ( \"tasks\" , Arrays . asList ( task )); imageSyncScanRequest . setHttpContent ( org . apache . commons . codec . binary . StringUtils . getBytesUtf8 ( httpBody . toJSONString ()), \"UTF-8\" , FormatType . JSON ); /** * \u8bf7\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\u3002\u670d\u52a1\u7aef\u5168\u94fe\u8def\u5904\u7406\u8d85\u65f6\u65f6\u95f4\u4e3a10\u79d2\uff0c\u8bf7\u505a\u76f8\u5e94\u8bbe\u7f6e\u3002 * \u5982\u679c\u60a8\u8bbe\u7f6e\u7684ReadTimeout\u5c0f\u4e8e\u670d\u52a1\u7aef\u5904\u7406\u7684\u65f6\u95f4\uff0c\u7a0b\u5e8f\u4e2d\u4f1a\u83b7\u5f97\u4e00\u4e2aread timeout\u5f02\u5e38\u3002 */ imageSyncScanRequest . setConnectTimeout ( 3000 ); imageSyncScanRequest . setReadTimeout ( 10000 ); HttpResponse httpResponse = null ; try { httpResponse = client . doAction ( imageSyncScanRequest ); } catch ( Exception e ) { e . printStackTrace (); } //\u670d\u52a1\u7aef\u63a5\u6536\u5230\u8bf7\u6c42\uff0c\u5e76\u5b8c\u6210\u5904\u7406\u540e\u8fd4\u56de\u7684\u7ed3\u679c\u3002 if ( httpResponse != null && httpResponse . isSuccess ()) { JSONObject scrResponse = JSON . parseObject ( org . apache . commons . codec . binary . StringUtils . newStringUtf8 ( httpResponse . getHttpContent ())); System . out . println ( JSON . toJSONString ( scrResponse , true )); int requestCode = scrResponse . getIntValue ( \"code\" ); //\u6bcf\u4e00\u5f20\u56fe\u7247\u7684\u68c0\u6d4b\u7ed3\u679c\u3002 JSONArray taskResults = scrResponse . getJSONArray ( \"data\" ); if ( 200 == requestCode ) { for ( Object taskResult : taskResults ) { //\u5355\u5f20\u56fe\u7247\u7684\u5904\u7406\u7ed3\u679c\u3002 int taskCode = (( JSONObject ) taskResult ). getIntValue ( \"code\" ); //\u56fe\u7247\u5bf9\u5e94\u68c0\u6d4b\u573a\u666f\u7684\u5904\u7406\u7ed3\u679c\u3002\u5982\u679c\u662f\u591a\u4e2a\u573a\u666f\uff0c\u5219\u4f1a\u6709\u6bcf\u4e2a\u573a\u666f\u7684\u7ed3\u679c\u3002 JSONArray sceneResults = (( JSONObject ) taskResult ). getJSONArray ( \"results\" ); if ( 200 == taskCode ) { for ( Object sceneResult : sceneResults ) { String scene = (( JSONObject ) sceneResult ). getString ( \"scene\" ); String suggestion = (( JSONObject ) sceneResult ). getString ( \"suggestion\" ); //\u6839\u636escene\u548csuggetion\u505a\u76f8\u5173\u5904\u7406\u3002 //do something System . out . println ( \"scene = [\" + scene + \"]\" ); System . out . println ( \"suggestion = [\" + suggestion + \"]\" ); } } else { //\u5355\u5f20\u56fe\u7247\u5904\u7406\u5931\u8d25\uff0c\u539f\u56e0\u89c6\u5177\u4f53\u7684\u60c5\u51b5\u8be6\u7ec6\u5206\u6790\u3002 System . out . println ( \"task process fail. task response:\" + JSON . toJSONString ( taskResult )); } } } else { /** * \u8868\u660e\u8bf7\u6c42\u6574\u4f53\u5904\u7406\u5931\u8d25\uff0c\u539f\u56e0\u89c6\u5177\u4f53\u7684\u60c5\u51b5\u8be6\u7ec6\u5206\u6790\u3002 */ System . out . println ( \"the whole image scan request failed. response:\" + JSON . toJSONString ( scrResponse )); } } } }","title":"16-\u56fe\u7247\u5185\u5bb9\u68c0\u6d4b 11:35"},{"location":"hmtt/day06/#17-_1722","text":"\u6587\u672c\u5ba1\u6838\u5de5\u5177\u7c7b\uff1a package com.heima.common.aliyun ; import com.alibaba.fastjson.JSON ; import com.alibaba.fastjson.JSONArray ; import com.alibaba.fastjson.JSONObject ; import com.aliyuncs.DefaultAcsClient ; import com.aliyuncs.IAcsClient ; import com.aliyuncs.exceptions.ClientException ; import com.aliyuncs.exceptions.ServerException ; import com.aliyuncs.green.model.v20180509.TextScanRequest ; import com.aliyuncs.http.FormatType ; import com.aliyuncs.http.HttpResponse ; import com.aliyuncs.profile.DefaultProfile ; import com.aliyuncs.profile.IClientProfile ; import lombok.Getter ; import lombok.Setter ; import org.jcodings.util.Hash ; import org.springframework.boot.context.properties.ConfigurationProperties ; import org.springframework.context.annotation.PropertySource ; import org.springframework.stereotype.Component ; import java.util.* ; @Getter @Setter @Component @PropertySource ( \"classpath:aliyun.properties\" ) @ConfigurationProperties ( prefix = \"aliyun\" ) public class GreeTextScan { private String accessKeyId ; private String secret ; public Map greeTextScan ( String content ) throws Exception { IClientProfile profile = DefaultProfile . getProfile ( \"cn-shanghai\" , accessKeyId , secret ); DefaultProfile . addEndpoint ( \"cn-shanghai\" , \"cn-shanghai\" , \"Green\" , \"green.cn-shanghai.aliyuncs.com\" ); IAcsClient client = new DefaultAcsClient ( profile ); TextScanRequest textScanRequest = new TextScanRequest (); textScanRequest . setAcceptFormat ( FormatType . JSON ); // \u6307\u5b9aapi\u8fd4\u56de\u683c\u5f0f textScanRequest . setHttpContentType ( FormatType . JSON ); textScanRequest . setMethod ( com . aliyuncs . http . MethodType . POST ); // \u6307\u5b9a\u8bf7\u6c42\u65b9\u6cd5 textScanRequest . setEncoding ( \"UTF-8\" ); textScanRequest . setRegionId ( \"cn-shanghai\" ); List < Map < String , Object >> tasks = new ArrayList < Map < String , Object >> (); Map < String , Object > task1 = new LinkedHashMap < String , Object > (); task1 . put ( \"dataId\" , UUID . randomUUID (). toString ()); /** * \u5f85\u68c0\u6d4b\u7684\u6587\u672c\uff0c\u957f\u5ea6\u4e0d\u8d85\u8fc710000\u4e2a\u5b57\u7b26 */ task1 . put ( \"content\" , content ); tasks . add ( task1 ); JSONObject data = new JSONObject (); /** * \u68c0\u6d4b\u573a\u666f\uff0c\u6587\u672c\u5783\u573e\u68c0\u6d4b\u4f20\u9012\uff1aantispam **/ data . put ( \"scenes\" , Arrays . asList ( \"antispam\" )); data . put ( \"tasks\" , tasks ); System . out . println ( JSON . toJSONString ( data , true )); textScanRequest . setHttpContent ( data . toJSONString (). getBytes ( \"UTF-8\" ), \"UTF-8\" , FormatType . JSON ); // \u8bf7\u52a1\u5fc5\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4 textScanRequest . setConnectTimeout ( 3000 ); textScanRequest . setReadTimeout ( 6000 ); Map < String , String > resultMap = new HashMap <> (); try { HttpResponse httpResponse = client . doAction ( textScanRequest ); if ( httpResponse . isSuccess ()) { JSONObject scrResponse = JSON . parseObject ( new String ( httpResponse . getHttpContent (), \"UTF-8\" )); System . out . println ( JSON . toJSONString ( scrResponse , true )); if ( 200 == scrResponse . getInteger ( \"code\" )) { JSONArray taskResults = scrResponse . getJSONArray ( \"data\" ); for ( Object taskResult : taskResults ) { if ( 200 == (( JSONObject ) taskResult ). getInteger ( \"code\" )) { JSONArray sceneResults = (( JSONObject ) taskResult ). getJSONArray ( \"results\" ); for ( Object sceneResult : sceneResults ) { String scene = (( JSONObject ) sceneResult ). getString ( \"scene\" ); String label = (( JSONObject ) sceneResult ). getString ( \"label\" ); String suggestion = (( JSONObject ) sceneResult ). getString ( \"suggestion\" ); System . out . println ( \"suggestion = [\" + label + \"]\" ); if ( ! suggestion . equals ( \"pass\" )) { resultMap . put ( \"suggestion\" , suggestion ); resultMap . put ( \"label\" , label ); return resultMap ; } } } else { return null ; } } resultMap . put ( \"suggestion\" , \"pass\" ); return resultMap ; } else { return null ; } } else { return null ; } } catch ( ServerException e ) { e . printStackTrace (); } catch ( ClientException e ) { e . printStackTrace (); } catch ( Exception e ) { e . printStackTrace (); } return null ; } } \u56fe\u7247\u68c0\u6d4b\u5de5\u5177\u7c7b\uff1a package com.heima.common.aliyun ; import com.alibaba.fastjson.JSON ; import com.alibaba.fastjson.JSONArray ; import com.alibaba.fastjson.JSONObject ; import com.aliyuncs.DefaultAcsClient ; import com.aliyuncs.IAcsClient ; import com.aliyuncs.green.model.v20180509.ImageSyncScanRequest ; import com.aliyuncs.http.FormatType ; import com.aliyuncs.http.HttpResponse ; import com.aliyuncs.http.MethodType ; import com.aliyuncs.http.ProtocolType ; import com.aliyuncs.profile.DefaultProfile ; import com.aliyuncs.profile.IClientProfile ; import com.heima.common.aliyun.util.ClientUploader ; import lombok.Getter ; import lombok.Setter ; import org.springframework.boot.context.properties.ConfigurationProperties ; import org.springframework.context.annotation.PropertySource ; import org.springframework.stereotype.Component ; import java.util.* ; @Getter @Setter @Component @PropertySource ( \"classpath:aliyun.properties\" ) @ConfigurationProperties ( prefix = \"aliyun\" ) public class GreenImageScan { private String accessKeyId ; private String secret ; private String scenes ; public Map imageScan ( List < byte []> imageList ) throws Exception { IClientProfile profile = DefaultProfile . getProfile ( \"cn-shanghai\" , accessKeyId , secret ); DefaultProfile . addEndpoint ( \"cn-shanghai\" , \"cn-shanghai\" , \"Green\" , \"green.cn-shanghai.aliyuncs.com\" ); IAcsClient client = new DefaultAcsClient ( profile ); ImageSyncScanRequest imageSyncScanRequest = new ImageSyncScanRequest (); // \u6307\u5b9aapi\u8fd4\u56de\u683c\u5f0f imageSyncScanRequest . setAcceptFormat ( FormatType . JSON ); // \u6307\u5b9a\u8bf7\u6c42\u65b9\u6cd5 imageSyncScanRequest . setMethod ( MethodType . POST ); imageSyncScanRequest . setEncoding ( \"utf-8\" ); //\u652f\u6301http\u548chttps imageSyncScanRequest . setProtocol ( ProtocolType . HTTP ); JSONObject httpBody = new JSONObject (); /** * \u8bbe\u7f6e\u8981\u68c0\u6d4b\u7684\u573a\u666f, \u8ba1\u8d39\u662f\u6309\u7167\u8be5\u5904\u4f20\u9012\u7684\u573a\u666f\u8fdb\u884c * \u4e00\u6b21\u8bf7\u6c42\u4e2d\u53ef\u4ee5\u540c\u65f6\u68c0\u6d4b\u591a\u5f20\u56fe\u7247\uff0c\u6bcf\u5f20\u56fe\u7247\u53ef\u4ee5\u540c\u65f6\u68c0\u6d4b\u591a\u4e2a\u98ce\u9669\u573a\u666f\uff0c\u8ba1\u8d39\u6309\u7167\u573a\u666f\u8ba1\u7b97 * \u4f8b\u5982\uff1a\u68c0\u6d4b2\u5f20\u56fe\u7247\uff0c\u573a\u666f\u4f20\u9012porn\u3001terrorism\uff0c\u8ba1\u8d39\u4f1a\u6309\u71672\u5f20\u56fe\u7247\u9274\u9ec4\uff0c2\u5f20\u56fe\u7247\u66b4\u6050\u68c0\u6d4b\u8ba1\u7b97 * porn: porn\u8868\u793a\u8272\u60c5\u573a\u666f\u68c0\u6d4b */ httpBody . put ( \"scenes\" , Arrays . asList ( scenes . split ( \",\" ))); /** * \u5982\u679c\u60a8\u8981\u68c0\u6d4b\u7684\u6587\u4ef6\u5b58\u4e8e\u672c\u5730\u670d\u52a1\u5668\u4e0a\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0b\u8ff0\u4ee3\u7801\u7247\u751f\u6210url * \u518d\u5c06\u8fd4\u56de\u7684url\u4f5c\u4e3a\u56fe\u7247\u5730\u5740\u4f20\u9012\u5230\u670d\u52a1\u7aef\u8fdb\u884c\u68c0\u6d4b */ /** * \u8bbe\u7f6e\u5f85\u68c0\u6d4b\u56fe\u7247\uff0c \u4e00\u5f20\u56fe\u7247\u4e00\u4e2atask * \u591a\u5f20\u56fe\u7247\u540c\u65f6\u68c0\u6d4b\u65f6\uff0c\u5904\u7406\u7684\u65f6\u95f4\u7531\u6700\u540e\u4e00\u4e2a\u5904\u7406\u5b8c\u7684\u56fe\u7247\u51b3\u5b9a * \u901a\u5e38\u60c5\u51b5\u4e0b\u6279\u91cf\u68c0\u6d4b\u7684\u5e73\u5747rt\u6bd4\u5355\u5f20\u68c0\u6d4b\u7684\u8981\u957f, \u4e00\u6b21\u6279\u91cf\u63d0\u4ea4\u7684\u56fe\u7247\u6570\u8d8a\u591a\uff0crt\u88ab\u62c9\u957f\u7684\u6982\u7387\u8d8a\u9ad8 * \u8fd9\u91cc\u4ee5\u5355\u5f20\u56fe\u7247\u68c0\u6d4b\u4f5c\u4e3a\u793a\u4f8b, \u5982\u679c\u662f\u6279\u91cf\u56fe\u7247\u68c0\u6d4b\uff0c\u8bf7\u81ea\u884c\u6784\u5efa\u591a\u4e2atask */ ClientUploader clientUploader = ClientUploader . getImageClientUploader ( profile , false ); String url = null ; List < JSONObject > urlList = new ArrayList < JSONObject > (); for ( byte [] bytes : imageList ) { url = clientUploader . uploadBytes ( bytes ); JSONObject task = new JSONObject (); task . put ( \"dataId\" , UUID . randomUUID (). toString ()); //\u8bbe\u7f6e\u56fe\u7247\u94fe\u63a5\u4e3a\u4e0a\u4f20\u540e\u7684url task . put ( \"url\" , url ); task . put ( \"time\" , new Date ()); urlList . add ( task ); } httpBody . put ( \"tasks\" , urlList ); imageSyncScanRequest . setHttpContent ( org . apache . commons . codec . binary . StringUtils . getBytesUtf8 ( httpBody . toJSONString ()), \"UTF-8\" , FormatType . JSON ); /** * \u8bf7\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4, \u670d\u52a1\u7aef\u5168\u94fe\u8def\u5904\u7406\u8d85\u65f6\u65f6\u95f4\u4e3a10\u79d2\uff0c\u8bf7\u505a\u76f8\u5e94\u8bbe\u7f6e * \u5982\u679c\u60a8\u8bbe\u7f6e\u7684ReadTimeout\u5c0f\u4e8e\u670d\u52a1\u7aef\u5904\u7406\u7684\u65f6\u95f4\uff0c\u7a0b\u5e8f\u4e2d\u4f1a\u83b7\u5f97\u4e00\u4e2aread timeout\u5f02\u5e38 */ imageSyncScanRequest . setConnectTimeout ( 3000 ); imageSyncScanRequest . setReadTimeout ( 10000 ); HttpResponse httpResponse = null ; try { httpResponse = client . doAction ( imageSyncScanRequest ); } catch ( Exception e ) { e . printStackTrace (); } Map < String , String > resultMap = new HashMap <> (); //\u670d\u52a1\u7aef\u63a5\u6536\u5230\u8bf7\u6c42\uff0c\u5e76\u5b8c\u6210\u5904\u7406\u8fd4\u56de\u7684\u7ed3\u679c if ( httpResponse != null && httpResponse . isSuccess ()) { JSONObject scrResponse = JSON . parseObject ( org . apache . commons . codec . binary . StringUtils . newStringUtf8 ( httpResponse . getHttpContent ())); System . out . println ( JSON . toJSONString ( scrResponse , true )); int requestCode = scrResponse . getIntValue ( \"code\" ); //\u6bcf\u4e00\u5f20\u56fe\u7247\u7684\u68c0\u6d4b\u7ed3\u679c JSONArray taskResults = scrResponse . getJSONArray ( \"data\" ); if ( 200 == requestCode ) { for ( Object taskResult : taskResults ) { //\u5355\u5f20\u56fe\u7247\u7684\u5904\u7406\u7ed3\u679c int taskCode = (( JSONObject ) taskResult ). getIntValue ( \"code\" ); //\u56fe\u7247\u8981\u68c0\u6d4b\u7684\u573a\u666f\u7684\u5904\u7406\u7ed3\u679c, \u5982\u679c\u662f\u591a\u4e2a\u573a\u666f\uff0c\u5219\u4f1a\u6709\u6bcf\u4e2a\u573a\u666f\u7684\u7ed3\u679c JSONArray sceneResults = (( JSONObject ) taskResult ). getJSONArray ( \"results\" ); if ( 200 == taskCode ) { for ( Object sceneResult : sceneResults ) { String scene = (( JSONObject ) sceneResult ). getString ( \"scene\" ); String label = (( JSONObject ) sceneResult ). getString ( \"label\" ); String suggestion = (( JSONObject ) sceneResult ). getString ( \"suggestion\" ); //\u6839\u636escene\u548csuggetion\u505a\u76f8\u5173\u5904\u7406 //do something System . out . println ( \"scene = [\" + scene + \"]\" ); System . out . println ( \"suggestion = [\" + suggestion + \"]\" ); System . out . println ( \"suggestion = [\" + label + \"]\" ); if ( ! suggestion . equals ( \"pass\" )) { resultMap . put ( \"suggestion\" , suggestion ); resultMap . put ( \"label\" , label ); return resultMap ; } } } else { //\u5355\u5f20\u56fe\u7247\u5904\u7406\u5931\u8d25, \u539f\u56e0\u89c6\u5177\u4f53\u7684\u60c5\u51b5\u8be6\u7ec6\u5206\u6790 System . out . println ( \"task process fail. task response:\" + JSON . toJSONString ( taskResult )); return null ; } } resultMap . put ( \"suggestion\" , \"pass\" ); return resultMap ; } else { /** * \u8868\u660e\u8bf7\u6c42\u6574\u4f53\u5904\u7406\u5931\u8d25\uff0c\u539f\u56e0\u89c6\u5177\u4f53\u7684\u60c5\u51b5\u8be6\u7ec6\u5206\u6790 */ System . out . println ( \"the whole image scan request failed. response:\" + JSON . toJSONString ( scrResponse )); return null ; } } return null ; } } admin\u4e2d\u7684\u914d\u7f6e\u7c7b package com.heima.admin.config ; import org.springframework.context.annotation.ComponentScan ; import org.springframework.context.annotation.Configuration ; @Configuration @ComponentScan ( \"com.heima.common.aliyun\" ) public class AliyunConfig { }","title":"17-\u63a5\u53e3\u96c6\u6210\u5230\u9879\u76ee 17:22"},{"location":"hmtt/day06/#18-dfa_1333","text":"\u200b DFA\u5168\u79f0\u4e3a\uff1aDeterministic Finite Automaton,\u5373\u786e\u5b9a\u6709\u7a77\u81ea\u52a8\u673a\u3002\u5176\u7279\u5f81\u4e3a\uff1a\u6709\u4e00\u4e2a\u6709\u9650\u72b6\u6001\u96c6\u5408\u548c\u4e00\u4e9b\u4ece\u4e00\u4e2a\u72b6\u6001\u901a\u5411\u53e6\u4e00\u4e2a\u72b6\u6001\u7684\u8fb9\uff0c\u6bcf\u6761\u8fb9\u4e0a\u6807\u8bb0\u6709\u4e00\u4e2a\u7b26\u53f7\uff0c\u5176\u4e2d\u4e00\u4e2a\u72b6\u6001\u662f\u521d\u6001\uff0c\u67d0\u4e9b\u72b6\u6001\u662f\u7ec8\u6001\u3002\u4f46\u4e0d\u540c\u4e8e\u4e0d\u786e\u5b9a\u7684\u6709\u9650\u81ea\u52a8\u673a\uff0cDFA\u4e2d\u4e0d\u4f1a\u6709\u4ece\u540c\u4e00\u72b6\u6001\u51fa\u53d1\u7684\u4e24\u6761\u8fb9\u6807\u5fd7\u6709\u76f8\u540c\u7684\u7b26\u53f7\u3002 \u4e00\u6b21\u6027\u7684\u628a\u6240\u6709\u7684\u654f\u611f\u8bcd\u5b58\u50a8\u5230\u4e86\u591a\u4e2amap\u4e2d\uff0c\u5c31\u662f\u4e0b\u56fe\u8868\u793a\u8fd9\u79cd\u7ed3\u6784 \u654f\u611f\u8bcd\uff1a\u51b0\u6bd2\u3001\u5927\u9ebb\u3001\u5927\u574f\u86cb \u68c0\u7d22\u7684\u8fc7\u7a0b\uff0c\u5c31\u662fhashMap\u7684get\u5b9e\u73b0 1\u3001\u7b2c\u4e00\u4e2a\u5b57\u201c\u51b0\u201d\uff0c\u6211\u4eec\u5728hashMap\u4e2d\u53ef\u4ee5\u627e\u5230\u3002\u5f97\u5230\u4e00\u4e2a\u65b0\u7684map = hashMap.get(\"\")\u3002 2\u3001\u5982\u679cmap == null\uff0c\u5219\u4e0d\u662f\u654f\u611f\u8bcd\u3002\u5426\u5219\u8df3\u81f33 3\u3001\u83b7\u53d6map\u4e2d\u7684isEnd\uff0c\u901a\u8fc7isEnd\u662f\u5426\u7b49\u4e8e1\u6765\u5224\u65ad\u8be5\u8bcd\u662f\u5426\u4e3a\u6700\u540e\u4e00\u4e2a\u3002\u5982\u679cisEnd == 1\u8868\u793a\u8be5\u8bcd\u4e3a\u654f\u611f\u8bcd\uff0c\u5426\u5219\u8df3\u81f31\u3002 \u901a\u8fc7\u8fd9\u4e2a\u6b65\u9aa4\u6211\u4eec\u53ef\u4ee5\u5224\u65ad\u201c\u51b0\u6bd2\u201d\u4e3a\u654f\u611f\u8bcd\uff0c\u4f46\u662f\u5982\u679c\u6211\u4eec\u8f93\u5165\u201c\u51b0\u7bb1\u201d\u5219\u4e0d\u662f\u654f\u611f\u8bcd\u4e86\u3002","title":"18-\u654f\u611f\u8bcd\u8fc7\u6ee4\u7b97\u6cd5DFA 13:33"},{"location":"hmtt/day06/Optional/","text":"\u4ece Java 8 \u5f15\u5165\u7684\u4e00\u4e2a\u5f88\u6709\u8da3\u7684\u7279\u6027\u662f Optional \u7c7b\u3002Optional \u7c7b\u4e3b\u8981\u89e3\u51b3\u7684\u95ee\u9898\u662f\u81ed\u540d\u662d\u8457\u7684\u7a7a\u6307\u9488\u5f02\u5e38\uff08NullPointerException\uff09 \u2014\u2014 \u6bcf\u4e2a Java \u7a0b\u5e8f\u5458\u90fd\u975e\u5e38\u4e86\u89e3\u7684\u5f02\u5e38\u3002 \u672c\u8d28\u4e0a\uff0c\u8fd9\u662f\u4e00\u4e2a\u5305\u542b\u6709\u53ef\u9009\u503c\u7684\u5305\u88c5\u7c7b\uff0c\u8fd9\u610f\u5473\u7740 Optional \u7c7b\u65e2\u53ef\u4ee5\u542b\u6709\u5bf9\u8c61\u4e5f\u53ef\u4ee5\u4e3a\u7a7a\u3002 Optional \u662f Java \u5b9e\u73b0\u51fd\u6570\u5f0f\u7f16\u7a0b\u7684\u5f3a\u52b2\u4e00\u6b65\uff0c\u5e76\u4e14\u5e2e\u52a9\u5728\u8303\u5f0f\u4e2d\u5b9e\u73b0\u3002\u4f46\u662f Optional \u7684\u610f\u4e49\u663e\u7136\u4e0d\u6b62\u4e8e\u6b64\u3002 \u6211\u4eec\u4ece\u4e00\u4e2a\u7b80\u5355\u7684\u7528\u4f8b\u5f00\u59cb\u3002\u5728 Java 8 \u4e4b\u524d\uff0c\u4efb\u4f55\u8bbf\u95ee\u5bf9\u8c61\u65b9\u6cd5\u6216\u5c5e\u6027\u7684\u8c03\u7528\u90fd\u53ef\u80fd\u5bfc\u81f4 NullPointerException \uff1a String isocode = user . getAddress (). getCountry (). getIsocode (). toUpperCase (); \u5728\u8fd9\u4e2a\u5c0f\u793a\u4f8b\u4e2d\uff0c\u5982\u679c\u6211\u4eec\u9700\u8981\u786e\u4fdd\u4e0d\u89e6\u53d1\u5f02\u5e38\uff0c\u5c31\u5f97\u5728\u8bbf\u95ee\u6bcf\u4e00\u4e2a\u503c\u4e4b\u524d\u5bf9\u5176\u8fdb\u884c\u660e\u786e\u5730\u68c0\u67e5\uff1a if ( user != null ) { Address address = user . getAddress (); if ( address != null ) { Country country = address . getCountry (); if ( country != null ) { String isocode = country . getIsocode (); if ( isocode != null ) { isocode = isocode . toUpperCase (); } } } } \u4f60\u770b\u5230\u4e86\uff0c\u8fd9\u5f88\u5bb9\u6613\u5c31\u53d8\u5f97\u5197\u957f\uff0c\u96be\u4ee5\u7ef4\u62a4\u3002 \u4e3a\u4e86\u7b80\u5316\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u6211\u4eec\u6765\u770b\u770b\u7528 Optional \u7c7b\u662f\u600e\u4e48\u505a\u7684\u3002\u4ece\u521b\u5efa\u548c\u9a8c\u8bc1\u5b9e\u4f8b\uff0c\u5230\u4f7f\u7528\u5176\u4e0d\u540c\u7684\u65b9\u6cd5\uff0c\u5e76\u4e0e\u5176\u5b83\u8fd4\u56de\u76f8\u540c\u7c7b\u578b\u7684\u65b9\u6cd5\u76f8\u7ed3\u5408\uff0c\u4e0b\u9762\u662f\u89c1\u8bc1 Optional \u5947\u8ff9\u7684\u65f6\u523b\u3002 \u00b6 \u521b\u5efa Optional \u5b9e\u4f8b \u00b6 \u91cd\u7533\u4e00\u4e0b\uff0c\u8fd9\u4e2a\u7c7b\u578b\u7684\u5bf9\u8c61\u53ef\u80fd\u5305\u542b\u503c\uff0c\u4e5f\u53ef\u80fd\u4e3a\u7a7a\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528\u540c\u540d\u65b9\u6cd5\u521b\u5efa\u4e00\u4e2a\u7a7a\u7684 Optional\u3002 @Test ( expected = NoSuchElementException . class ) public void whenCreateEmptyOptional_thenNull () { Optional < User > emptyOpt = Optional . empty (); emptyOpt . get (); } \u6beb\u4e0d\u5947\u602a\uff0c\u5c1d\u8bd5\u8bbf\u95ee emptyOpt \u53d8\u91cf\u7684\u503c\u4f1a\u5bfc\u81f4 NoSuchElementException \u3002 \u4f60\u53ef\u4ee5\u4f7f\u7528 of() \u548c ofNullable() \u65b9\u6cd5\u521b\u5efa\u5305\u542b\u503c\u7684 Optional \u3002\u4e24\u4e2a\u65b9\u6cd5\u7684\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\u5982\u679c\u4f60\u628a null \u503c\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u8fdb\u53bb\uff0c of() \u65b9\u6cd5\u4f1a\u629b\u51fa NullPointerException \uff1a @Test ( expected = NullPointerException . class ) public void whenCreateOfEmptyOptional_thenNullPointerException () { Optional < User > opt = Optional . of ( user ); } \u4f60\u770b\uff0c\u6211\u4eec\u5e76\u6ca1\u6709\u5b8c\u5168\u6446\u8131 NullPointerException \u3002\u56e0\u6b64\uff0c\u4f60\u5e94\u8be5\u660e\u786e\u5bf9\u8c61\u4e0d\u4e3a null \u7684\u65f6\u5019\u4f7f\u7528 of() \u3002 \u5982\u679c\u5bf9\u8c61\u5373\u53ef\u80fd\u662f null \u4e5f\u53ef\u80fd\u662f\u975e null\uff0c\u4f60\u5c31\u5e94\u8be5\u4f7f\u7528 ofNullable() \u65b9\u6cd5\uff1a Optional < User > opt = Optional . ofNullable ( user ); \u8bbf\u95ee *Optional* \u5bf9\u8c61\u7684\u503c \u4ece Optional \u5b9e\u4f8b\u4e2d\u53d6\u56de\u5b9e\u9645\u503c\u5bf9\u8c61\u7684\u65b9\u6cd5\u4e4b\u4e00\u662f\u4f7f\u7528 get() \u65b9\u6cd5\uff1a @Test public void whenCreateOfNullableOptional_thenOk () { String name = \"John\" ; Optional < String > opt = Optional . ofNullable ( name ); assertEquals ( \"John\" , opt . get ()); } \u4e0d\u8fc7\uff0c\u4f60\u770b\u5230\u4e86\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u5728\u503c\u4e3a null \u7684\u65f6\u5019\u629b\u51fa\u5f02\u5e38\u3002\u8981\u907f\u514d\u5f02\u5e38\uff0c\u4f60\u53ef\u4ee5\u9009\u62e9\u9996\u5148\u9a8c\u8bc1\u662f\u5426\u6709\u503c\uff1a @Test public void whenCheckIfPresent_thenOk () { User user = new User ( \"john@gmail.com\" , \"1234\" ); Optional < User > opt = Optional . ofNullable ( user ); assertTrue ( opt . isPresent ()); assertEquals ( user . getEmail (), opt . get (). getEmail ()); } \u68c0\u67e5\u662f\u5426\u6709\u503c\u7684\u53e6\u4e00\u4e2a\u9009\u62e9\u662f ifPresent() \u65b9\u6cd5\u3002\u8be5\u65b9\u6cd5\u9664\u4e86\u6267\u884c\u68c0\u67e5\uff0c\u8fd8\u63a5\u53d7\u4e00\u4e2a Consumer(\u6d88\u8d39\u8005 ) \u53c2\u6570\uff0c\u5982\u679c\u5bf9\u8c61\u4e0d\u662f\u7a7a\u7684\uff0c\u5c31\u5bf9\u6267\u884c\u4f20\u5165\u7684 Lambda \u8868\u8fbe\u5f0f\uff1a opt . ifPresent ( u -> assertEquals ( user . getEmail (), u . getEmail ())); \u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u53ea\u6709 user \u7528\u6237\u4e0d\u4e3a null \u7684\u65f6\u5019\u624d\u4f1a\u6267\u884c\u65ad\u8a00\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6765\u770b\u770b\u63d0\u4f9b\u7a7a\u503c\u7684\u65b9\u6cd5\u3002 \u00b6 \u8fd4\u56de\u9ed8\u8ba4\u503c \u00b6 Optional \u7c7b\u63d0\u4f9b\u4e86 API \u7528\u4ee5\u8fd4\u56de\u5bf9\u8c61\u503c\uff0c\u6216\u8005\u5728\u5bf9\u8c61\u4e3a\u7a7a\u7684\u65f6\u5019\u8fd4\u56de\u9ed8\u8ba4\u503c\u3002 \u8fd9\u91cc\u4f60\u53ef\u4ee5\u4f7f\u7528\u7684\u7b2c\u4e00\u4e2a\u65b9\u6cd5\u662f orElse() \uff0c\u5b83\u7684\u5de5\u4f5c\u65b9\u5f0f\u975e\u5e38\u76f4\u63a5\uff0c\u5982\u679c\u6709\u503c\u5219\u8fd4\u56de\u8be5\u503c\uff0c\u5426\u5219\u8fd4\u56de\u4f20\u9012\u7ed9\u5b83\u7684\u53c2\u6570\u503c\uff1a @Test public void whenEmptyValue_thenReturnDefault () { User user = null ; User user2 = new User ( \"anna@gmail.com\" , \"1234\" ); User result = Optional . ofNullable ( user ). orElse ( user2 ); assertEquals ( user2 . getEmail (), result . getEmail ()); } \u8fd9\u91cc user \u5bf9\u8c61\u662f\u7a7a\u7684\uff0c\u6240\u4ee5\u8fd4\u56de\u4e86\u4f5c\u4e3a\u9ed8\u8ba4\u503c\u7684 user2 \u3002 \u5982\u679c\u5bf9\u8c61\u7684\u521d\u59cb\u503c\u4e0d\u662f null\uff0c\u90a3\u4e48\u9ed8\u8ba4\u503c\u4f1a\u88ab\u5ffd\u7565\uff1a @Test public void whenValueNotNull_thenIgnoreDefault () { User user = new User ( \"john@gmail.com\" , \"1234\" ); User user2 = new User ( \"anna@gmail.com\" , \"1234\" ); User result = Optional . ofNullable ( user ). orElse ( user2 ); assertEquals ( \"john@gmail.com\" , result . getEmail ()); } \u7b2c\u4e8c\u4e2a\u540c\u7c7b\u578b\u7684 API \u662f orElseGet() \u2014\u2014 \u5176\u884c\u4e3a\u7565\u6709\u4e0d\u540c\u3002\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u5728\u6709\u503c\u7684\u65f6\u5019\u8fd4\u56de\u503c\uff0c\u5982\u679c\u6ca1\u6709\u503c\uff0c\u5b83\u4f1a\u6267\u884c\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u7684 Supplier(\u4f9b\u5e94\u8005) \u51fd\u6570\u5f0f\u63a5\u53e3\uff0c\u5e76\u5c06\u8fd4\u56de\u5176\u6267\u884c\u7ed3\u679c\uff1a User result = Optional . ofNullable ( user ). orElseGet ( () -> user2 ); *orElse()* \u548c *orElseGet()* \u7684\u4e0d\u540c\u4e4b\u5904 \u4e4d\u4e00\u770b\uff0c\u8fd9\u4e24\u79cd\u65b9\u6cd5\u4f3c\u4e4e\u8d77\u7740\u540c\u6837\u7684\u4f5c\u7528\u3002\u7136\u800c\u4e8b\u5b9e\u5e76\u975e\u5982\u6b64\u3002\u6211\u4eec\u521b\u5efa\u4e00\u4e9b\u793a\u4f8b\u6765\u7a81\u51fa\u4e8c\u8005\u884c\u4e3a\u4e0a\u7684\u5f02\u540c\u3002 \u6211\u4eec\u5148\u6765\u770b\u770b\u5bf9\u8c61\u4e3a\u7a7a\u65f6\u4ed6\u4eec\u7684\u884c\u4e3a\uff1a @Test public void givenEmptyValue_whenCompare_thenOk () { User user = null logger . debug ( \"Using orElse\" ); User result = Optional . ofNullable ( user ). orElse ( createNewUser ()); logger . debug ( \"Using orElseGet\" ); User result2 = Optional . ofNullable ( user ). orElseGet (() -> createNewUser ()); } private User createNewUser () { logger . debug ( \"Creating New User\" ); return new User ( \"extra@gmail.com\" , \"1234\" ); } \u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\uff0c\u4e24\u79cd\u65b9\u6cd5\u90fd\u8c03\u7528\u4e86 createNewUser() \u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u8bb0\u5f55\u4e00\u4e2a\u6d88\u606f\u5e76\u8fd4\u56de User \u5bf9\u8c61\u3002 \u4ee3\u7801\u8f93\u51fa\u5982\u4e0b\uff1a Using orElse Creating New User Using orElseGet Creating New User \u7531\u6b64\u53ef\u89c1\uff0c\u5f53\u5bf9\u8c61\u4e3a\u7a7a\u800c\u8fd4\u56de\u9ed8\u8ba4\u5bf9\u8c61\u65f6\uff0c\u884c\u4e3a\u5e76\u65e0\u5dee\u5f02\u3002 \u6211\u4eec\u63a5\u4e0b\u6765\u770b\u4e00\u4e2a\u7c7b\u4f3c\u7684\u793a\u4f8b\uff0c\u4f46\u8fd9\u91cc Optional \u4e0d\u4e3a\u7a7a\uff1a @Test public void givenPresentValue_whenCompare_thenOk () { User user = new User ( \"john@gmail.com\" , \"1234\" ); logger . info ( \"Using orElse\" ); User result = Optional . ofNullable ( user ). orElse ( createNewUser ()); logger . info ( \"Using orElseGet\" ); User result2 = Optional . ofNullable ( user ). orElseGet (() -> createNewUser ()); } \u8fd9\u6b21\u7684\u8f93\u51fa\uff1a Using orElse Creating New User Using orElseGet \u8fd9\u4e2a\u793a\u4f8b\u4e2d\uff0c\u4e24\u4e2a Optional \u5bf9\u8c61\u90fd\u5305\u542b\u975e\u7a7a\u503c\uff0c\u4e24\u4e2a\u65b9\u6cd5\u90fd\u4f1a\u8fd4\u56de\u5bf9\u5e94\u7684\u975e\u7a7a\u503c\u3002\u4e0d\u8fc7\uff0c orElse() \u65b9\u6cd5\u4ecd\u7136\u521b\u5efa\u4e86 User \u5bf9\u8c61\u3002 \u4e0e\u4e4b\u76f8\u53cd\uff0c*orElseGet()* \u65b9\u6cd5\u4e0d\u521b\u5efa * *User* * \u5bf9\u8c61\u3002 \u5728\u6267\u884c\u8f83\u5bc6\u96c6\u7684\u8c03\u7528\u65f6\uff0c\u6bd4\u5982\u8c03\u7528 Web \u670d\u52a1\u6216\u6570\u636e\u67e5\u8be2\uff0c \u8fd9\u4e2a\u5dee\u5f02\u4f1a\u5bf9\u6027\u80fd\u4ea7\u751f\u91cd\u5927\u5f71\u54cd \u3002 orElse(T other) \u4e0d\u8bba\u5bb9\u5668\u662f\u5426\u4e3a\u7a7a,\u53ea\u8981\u8c03\u7528\u8be5\u65b9\u6cd5, \u5219\u5bf9\u8c61 other \u4e00\u5b9a\u5b58\u5728 orElseGet(Supplier<? extends T> supplier) \u53ea\u6709\u5f53\u5bb9\u5668\u4e3a\u7a7a\u65f6,\u624d\u8c03\u7528 supplier.get() \u65b9\u6cd5\u4ea7\u751f\u5bf9\u8c61 \u8fd4\u56de\u5f02\u5e38 \u00b6 \u9664\u4e86 orElse() \u548c orElseGet() \u65b9\u6cd5\uff0cOptional \u8fd8\u5b9a\u4e49\u4e86 orElseThrow() API \u2014\u2014 \u5b83\u4f1a\u5728\u5bf9\u8c61\u4e3a\u7a7a\u7684\u65f6\u5019\u629b\u51fa\u5f02\u5e38\uff0c\u800c\u4e0d\u662f\u8fd4\u56de\u5907\u9009\u7684\u503c\uff1a @Test ( expected = IllegalArgumentException . class ) public void whenThrowException_thenOk () { User result = Optional . ofNullable ( user ) . orElseThrow ( () -> new IllegalArgumentException ()); } \u8fd9\u91cc\uff0c\u5982\u679c user \u503c\u4e3a null\uff0c\u4f1a\u629b\u51fa IllegalArgumentException \u3002 \u8fd9\u4e2a\u65b9\u6cd5\u8ba9\u6211\u4eec\u6709\u66f4\u4e30\u5bcc\u7684\u8bed\u4e49\uff0c\u53ef\u4ee5\u51b3\u5b9a\u629b\u51fa\u4ec0\u4e48\u6837\u7684\u5f02\u5e38\uff0c\u800c\u4e0d\u603b\u662f\u629b\u51fa NullPointerException \u3002 \u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u5f88\u597d\u5730\u7406\u89e3\u4e86\u5982\u4f55\u4f7f\u7528 Optional\uff0c\u6211\u4eec\u6765\u770b\u770b\u5176\u5b83\u53ef\u4ee5\u5bf9 Optional \u503c\u8fdb\u884c\u8f6c\u6362\u548c\u8fc7\u6ee4\u7684\u65b9\u6cd5\u3002 Optional \u7c7b\u7684\u94fe\u5f0f\u65b9\u6cd5 \u00b6 \u4e3a\u4e86\u66f4\u5145\u5206\u7684\u4f7f\u7528 Optional \uff0c\u4f60\u53ef\u4ee5\u94fe\u63a5\u7ec4\u5408\u5176\u5927\u90e8\u5206\u65b9\u6cd5\uff0c\u56e0\u4e3a\u5b83\u4eec\u90fd\u8fd4\u56de\u76f8\u540c\u7c7b\u4f3c\u7684\u5bf9\u8c61\u3002 \u6211\u4eec\u4f7f\u7528 Optional \u91cd\u5199\u6700\u65e9\u4ecb\u7ecd\u7684\u793a\u4f8b\u3002 \u9996\u5148\uff0c\u91cd\u6784\u7c7b\uff0c\u4f7f\u5176 getter \u65b9\u6cd5\u8fd4\u56de Optional \u5f15\u7528\uff1a public class User { private Address address ; public Optional < Address > getAddress () { return Optional . ofNullable ( address ); } // ... } public class Address { private Country country ; public Optional < Country > getCountry () { return Optional . ofNullable ( country ); } // ... } \u4e0a\u9762\u7684\u5d4c\u5957\u7ed3\u6784\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u56fe\u6765\u8868\u793a\uff1a \u73b0\u5728\u53ef\u4ee5\u5220\u9664 null \u68c0\u67e5\uff0c\u66ff\u6362\u4e3a Optional \u7684\u65b9\u6cd5\uff1a @Test public void whenChaining_thenOk () { User user = new User ( \"anna@gmail.com\" , \"1234\" ); String result = Optional . ofNullable ( user ) . flatMap ( u -> u . getAddress ()) . flatMap ( a -> a . getCountry ()) . map ( c -> c . getIsocode ()) . orElse ( \"default\" ); assertEquals ( result , \"default\" ); } \u4e0a\u9762\u7684\u4ee3\u7801\u53ef\u4ee5\u901a\u8fc7\u65b9\u6cd5\u5f15\u7528\u8fdb\u4e00\u6b65\u7f29\u51cf\uff1a String result = Optional . ofNullable ( user ) . flatMap ( User :: getAddress ) . flatMap ( Address :: getCountry ) . map ( Country :: getIsocode ) . orElse ( \"default\" ); \u7ed3\u679c\u73b0\u5728\u7684\u4ee3\u7801\u770b\u8d77\u6765\u6bd4\u4e4b\u524d\u91c7\u7528\u6761\u4ef6\u5206\u652f\u7684\u5197\u957f\u4ee3\u7801\u7b80\u6d01\u591a\u4e86","title":"Optional"},{"location":"hmtt/day06/Optional/#_1","text":"","title":""},{"location":"hmtt/day06/Optional/#optional","text":"\u91cd\u7533\u4e00\u4e0b\uff0c\u8fd9\u4e2a\u7c7b\u578b\u7684\u5bf9\u8c61\u53ef\u80fd\u5305\u542b\u503c\uff0c\u4e5f\u53ef\u80fd\u4e3a\u7a7a\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528\u540c\u540d\u65b9\u6cd5\u521b\u5efa\u4e00\u4e2a\u7a7a\u7684 Optional\u3002 @Test ( expected = NoSuchElementException . class ) public void whenCreateEmptyOptional_thenNull () { Optional < User > emptyOpt = Optional . empty (); emptyOpt . get (); } \u6beb\u4e0d\u5947\u602a\uff0c\u5c1d\u8bd5\u8bbf\u95ee emptyOpt \u53d8\u91cf\u7684\u503c\u4f1a\u5bfc\u81f4 NoSuchElementException \u3002 \u4f60\u53ef\u4ee5\u4f7f\u7528 of() \u548c ofNullable() \u65b9\u6cd5\u521b\u5efa\u5305\u542b\u503c\u7684 Optional \u3002\u4e24\u4e2a\u65b9\u6cd5\u7684\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\u5982\u679c\u4f60\u628a null \u503c\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u8fdb\u53bb\uff0c of() \u65b9\u6cd5\u4f1a\u629b\u51fa NullPointerException \uff1a @Test ( expected = NullPointerException . class ) public void whenCreateOfEmptyOptional_thenNullPointerException () { Optional < User > opt = Optional . of ( user ); } \u4f60\u770b\uff0c\u6211\u4eec\u5e76\u6ca1\u6709\u5b8c\u5168\u6446\u8131 NullPointerException \u3002\u56e0\u6b64\uff0c\u4f60\u5e94\u8be5\u660e\u786e\u5bf9\u8c61\u4e0d\u4e3a null \u7684\u65f6\u5019\u4f7f\u7528 of() \u3002 \u5982\u679c\u5bf9\u8c61\u5373\u53ef\u80fd\u662f null \u4e5f\u53ef\u80fd\u662f\u975e null\uff0c\u4f60\u5c31\u5e94\u8be5\u4f7f\u7528 ofNullable() \u65b9\u6cd5\uff1a Optional < User > opt = Optional . ofNullable ( user ); \u8bbf\u95ee *Optional* \u5bf9\u8c61\u7684\u503c \u4ece Optional \u5b9e\u4f8b\u4e2d\u53d6\u56de\u5b9e\u9645\u503c\u5bf9\u8c61\u7684\u65b9\u6cd5\u4e4b\u4e00\u662f\u4f7f\u7528 get() \u65b9\u6cd5\uff1a @Test public void whenCreateOfNullableOptional_thenOk () { String name = \"John\" ; Optional < String > opt = Optional . ofNullable ( name ); assertEquals ( \"John\" , opt . get ()); } \u4e0d\u8fc7\uff0c\u4f60\u770b\u5230\u4e86\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u5728\u503c\u4e3a null \u7684\u65f6\u5019\u629b\u51fa\u5f02\u5e38\u3002\u8981\u907f\u514d\u5f02\u5e38\uff0c\u4f60\u53ef\u4ee5\u9009\u62e9\u9996\u5148\u9a8c\u8bc1\u662f\u5426\u6709\u503c\uff1a @Test public void whenCheckIfPresent_thenOk () { User user = new User ( \"john@gmail.com\" , \"1234\" ); Optional < User > opt = Optional . ofNullable ( user ); assertTrue ( opt . isPresent ()); assertEquals ( user . getEmail (), opt . get (). getEmail ()); } \u68c0\u67e5\u662f\u5426\u6709\u503c\u7684\u53e6\u4e00\u4e2a\u9009\u62e9\u662f ifPresent() \u65b9\u6cd5\u3002\u8be5\u65b9\u6cd5\u9664\u4e86\u6267\u884c\u68c0\u67e5\uff0c\u8fd8\u63a5\u53d7\u4e00\u4e2a Consumer(\u6d88\u8d39\u8005 ) \u53c2\u6570\uff0c\u5982\u679c\u5bf9\u8c61\u4e0d\u662f\u7a7a\u7684\uff0c\u5c31\u5bf9\u6267\u884c\u4f20\u5165\u7684 Lambda \u8868\u8fbe\u5f0f\uff1a opt . ifPresent ( u -> assertEquals ( user . getEmail (), u . getEmail ())); \u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u53ea\u6709 user \u7528\u6237\u4e0d\u4e3a null \u7684\u65f6\u5019\u624d\u4f1a\u6267\u884c\u65ad\u8a00\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6765\u770b\u770b\u63d0\u4f9b\u7a7a\u503c\u7684\u65b9\u6cd5\u3002","title":"\u521b\u5efa Optional \u5b9e\u4f8b"},{"location":"hmtt/day06/Optional/#_2","text":"","title":""},{"location":"hmtt/day06/Optional/#_3","text":"Optional \u7c7b\u63d0\u4f9b\u4e86 API \u7528\u4ee5\u8fd4\u56de\u5bf9\u8c61\u503c\uff0c\u6216\u8005\u5728\u5bf9\u8c61\u4e3a\u7a7a\u7684\u65f6\u5019\u8fd4\u56de\u9ed8\u8ba4\u503c\u3002 \u8fd9\u91cc\u4f60\u53ef\u4ee5\u4f7f\u7528\u7684\u7b2c\u4e00\u4e2a\u65b9\u6cd5\u662f orElse() \uff0c\u5b83\u7684\u5de5\u4f5c\u65b9\u5f0f\u975e\u5e38\u76f4\u63a5\uff0c\u5982\u679c\u6709\u503c\u5219\u8fd4\u56de\u8be5\u503c\uff0c\u5426\u5219\u8fd4\u56de\u4f20\u9012\u7ed9\u5b83\u7684\u53c2\u6570\u503c\uff1a @Test public void whenEmptyValue_thenReturnDefault () { User user = null ; User user2 = new User ( \"anna@gmail.com\" , \"1234\" ); User result = Optional . ofNullable ( user ). orElse ( user2 ); assertEquals ( user2 . getEmail (), result . getEmail ()); } \u8fd9\u91cc user \u5bf9\u8c61\u662f\u7a7a\u7684\uff0c\u6240\u4ee5\u8fd4\u56de\u4e86\u4f5c\u4e3a\u9ed8\u8ba4\u503c\u7684 user2 \u3002 \u5982\u679c\u5bf9\u8c61\u7684\u521d\u59cb\u503c\u4e0d\u662f null\uff0c\u90a3\u4e48\u9ed8\u8ba4\u503c\u4f1a\u88ab\u5ffd\u7565\uff1a @Test public void whenValueNotNull_thenIgnoreDefault () { User user = new User ( \"john@gmail.com\" , \"1234\" ); User user2 = new User ( \"anna@gmail.com\" , \"1234\" ); User result = Optional . ofNullable ( user ). orElse ( user2 ); assertEquals ( \"john@gmail.com\" , result . getEmail ()); } \u7b2c\u4e8c\u4e2a\u540c\u7c7b\u578b\u7684 API \u662f orElseGet() \u2014\u2014 \u5176\u884c\u4e3a\u7565\u6709\u4e0d\u540c\u3002\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u5728\u6709\u503c\u7684\u65f6\u5019\u8fd4\u56de\u503c\uff0c\u5982\u679c\u6ca1\u6709\u503c\uff0c\u5b83\u4f1a\u6267\u884c\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u7684 Supplier(\u4f9b\u5e94\u8005) \u51fd\u6570\u5f0f\u63a5\u53e3\uff0c\u5e76\u5c06\u8fd4\u56de\u5176\u6267\u884c\u7ed3\u679c\uff1a User result = Optional . ofNullable ( user ). orElseGet ( () -> user2 ); *orElse()* \u548c *orElseGet()* \u7684\u4e0d\u540c\u4e4b\u5904 \u4e4d\u4e00\u770b\uff0c\u8fd9\u4e24\u79cd\u65b9\u6cd5\u4f3c\u4e4e\u8d77\u7740\u540c\u6837\u7684\u4f5c\u7528\u3002\u7136\u800c\u4e8b\u5b9e\u5e76\u975e\u5982\u6b64\u3002\u6211\u4eec\u521b\u5efa\u4e00\u4e9b\u793a\u4f8b\u6765\u7a81\u51fa\u4e8c\u8005\u884c\u4e3a\u4e0a\u7684\u5f02\u540c\u3002 \u6211\u4eec\u5148\u6765\u770b\u770b\u5bf9\u8c61\u4e3a\u7a7a\u65f6\u4ed6\u4eec\u7684\u884c\u4e3a\uff1a @Test public void givenEmptyValue_whenCompare_thenOk () { User user = null logger . debug ( \"Using orElse\" ); User result = Optional . ofNullable ( user ). orElse ( createNewUser ()); logger . debug ( \"Using orElseGet\" ); User result2 = Optional . ofNullable ( user ). orElseGet (() -> createNewUser ()); } private User createNewUser () { logger . debug ( \"Creating New User\" ); return new User ( \"extra@gmail.com\" , \"1234\" ); } \u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\uff0c\u4e24\u79cd\u65b9\u6cd5\u90fd\u8c03\u7528\u4e86 createNewUser() \u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u8bb0\u5f55\u4e00\u4e2a\u6d88\u606f\u5e76\u8fd4\u56de User \u5bf9\u8c61\u3002 \u4ee3\u7801\u8f93\u51fa\u5982\u4e0b\uff1a Using orElse Creating New User Using orElseGet Creating New User \u7531\u6b64\u53ef\u89c1\uff0c\u5f53\u5bf9\u8c61\u4e3a\u7a7a\u800c\u8fd4\u56de\u9ed8\u8ba4\u5bf9\u8c61\u65f6\uff0c\u884c\u4e3a\u5e76\u65e0\u5dee\u5f02\u3002 \u6211\u4eec\u63a5\u4e0b\u6765\u770b\u4e00\u4e2a\u7c7b\u4f3c\u7684\u793a\u4f8b\uff0c\u4f46\u8fd9\u91cc Optional \u4e0d\u4e3a\u7a7a\uff1a @Test public void givenPresentValue_whenCompare_thenOk () { User user = new User ( \"john@gmail.com\" , \"1234\" ); logger . info ( \"Using orElse\" ); User result = Optional . ofNullable ( user ). orElse ( createNewUser ()); logger . info ( \"Using orElseGet\" ); User result2 = Optional . ofNullable ( user ). orElseGet (() -> createNewUser ()); } \u8fd9\u6b21\u7684\u8f93\u51fa\uff1a Using orElse Creating New User Using orElseGet \u8fd9\u4e2a\u793a\u4f8b\u4e2d\uff0c\u4e24\u4e2a Optional \u5bf9\u8c61\u90fd\u5305\u542b\u975e\u7a7a\u503c\uff0c\u4e24\u4e2a\u65b9\u6cd5\u90fd\u4f1a\u8fd4\u56de\u5bf9\u5e94\u7684\u975e\u7a7a\u503c\u3002\u4e0d\u8fc7\uff0c orElse() \u65b9\u6cd5\u4ecd\u7136\u521b\u5efa\u4e86 User \u5bf9\u8c61\u3002 \u4e0e\u4e4b\u76f8\u53cd\uff0c*orElseGet()* \u65b9\u6cd5\u4e0d\u521b\u5efa * *User* * \u5bf9\u8c61\u3002 \u5728\u6267\u884c\u8f83\u5bc6\u96c6\u7684\u8c03\u7528\u65f6\uff0c\u6bd4\u5982\u8c03\u7528 Web \u670d\u52a1\u6216\u6570\u636e\u67e5\u8be2\uff0c \u8fd9\u4e2a\u5dee\u5f02\u4f1a\u5bf9\u6027\u80fd\u4ea7\u751f\u91cd\u5927\u5f71\u54cd \u3002 orElse(T other) \u4e0d\u8bba\u5bb9\u5668\u662f\u5426\u4e3a\u7a7a,\u53ea\u8981\u8c03\u7528\u8be5\u65b9\u6cd5, \u5219\u5bf9\u8c61 other \u4e00\u5b9a\u5b58\u5728 orElseGet(Supplier<? extends T> supplier) \u53ea\u6709\u5f53\u5bb9\u5668\u4e3a\u7a7a\u65f6,\u624d\u8c03\u7528 supplier.get() \u65b9\u6cd5\u4ea7\u751f\u5bf9\u8c61","title":"\u8fd4\u56de\u9ed8\u8ba4\u503c"},{"location":"hmtt/day06/Optional/#_4","text":"\u9664\u4e86 orElse() \u548c orElseGet() \u65b9\u6cd5\uff0cOptional \u8fd8\u5b9a\u4e49\u4e86 orElseThrow() API \u2014\u2014 \u5b83\u4f1a\u5728\u5bf9\u8c61\u4e3a\u7a7a\u7684\u65f6\u5019\u629b\u51fa\u5f02\u5e38\uff0c\u800c\u4e0d\u662f\u8fd4\u56de\u5907\u9009\u7684\u503c\uff1a @Test ( expected = IllegalArgumentException . class ) public void whenThrowException_thenOk () { User result = Optional . ofNullable ( user ) . orElseThrow ( () -> new IllegalArgumentException ()); } \u8fd9\u91cc\uff0c\u5982\u679c user \u503c\u4e3a null\uff0c\u4f1a\u629b\u51fa IllegalArgumentException \u3002 \u8fd9\u4e2a\u65b9\u6cd5\u8ba9\u6211\u4eec\u6709\u66f4\u4e30\u5bcc\u7684\u8bed\u4e49\uff0c\u53ef\u4ee5\u51b3\u5b9a\u629b\u51fa\u4ec0\u4e48\u6837\u7684\u5f02\u5e38\uff0c\u800c\u4e0d\u603b\u662f\u629b\u51fa NullPointerException \u3002 \u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u5f88\u597d\u5730\u7406\u89e3\u4e86\u5982\u4f55\u4f7f\u7528 Optional\uff0c\u6211\u4eec\u6765\u770b\u770b\u5176\u5b83\u53ef\u4ee5\u5bf9 Optional \u503c\u8fdb\u884c\u8f6c\u6362\u548c\u8fc7\u6ee4\u7684\u65b9\u6cd5\u3002","title":"\u8fd4\u56de\u5f02\u5e38"},{"location":"hmtt/day06/Optional/#optional_1","text":"\u4e3a\u4e86\u66f4\u5145\u5206\u7684\u4f7f\u7528 Optional \uff0c\u4f60\u53ef\u4ee5\u94fe\u63a5\u7ec4\u5408\u5176\u5927\u90e8\u5206\u65b9\u6cd5\uff0c\u56e0\u4e3a\u5b83\u4eec\u90fd\u8fd4\u56de\u76f8\u540c\u7c7b\u4f3c\u7684\u5bf9\u8c61\u3002 \u6211\u4eec\u4f7f\u7528 Optional \u91cd\u5199\u6700\u65e9\u4ecb\u7ecd\u7684\u793a\u4f8b\u3002 \u9996\u5148\uff0c\u91cd\u6784\u7c7b\uff0c\u4f7f\u5176 getter \u65b9\u6cd5\u8fd4\u56de Optional \u5f15\u7528\uff1a public class User { private Address address ; public Optional < Address > getAddress () { return Optional . ofNullable ( address ); } // ... } public class Address { private Country country ; public Optional < Country > getCountry () { return Optional . ofNullable ( country ); } // ... } \u4e0a\u9762\u7684\u5d4c\u5957\u7ed3\u6784\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u56fe\u6765\u8868\u793a\uff1a \u73b0\u5728\u53ef\u4ee5\u5220\u9664 null \u68c0\u67e5\uff0c\u66ff\u6362\u4e3a Optional \u7684\u65b9\u6cd5\uff1a @Test public void whenChaining_thenOk () { User user = new User ( \"anna@gmail.com\" , \"1234\" ); String result = Optional . ofNullable ( user ) . flatMap ( u -> u . getAddress ()) . flatMap ( a -> a . getCountry ()) . map ( c -> c . getIsocode ()) . orElse ( \"default\" ); assertEquals ( result , \"default\" ); } \u4e0a\u9762\u7684\u4ee3\u7801\u53ef\u4ee5\u901a\u8fc7\u65b9\u6cd5\u5f15\u7528\u8fdb\u4e00\u6b65\u7f29\u51cf\uff1a String result = Optional . ofNullable ( user ) . flatMap ( User :: getAddress ) . flatMap ( Address :: getCountry ) . map ( Country :: getIsocode ) . orElse ( \"default\" ); \u7ed3\u679c\u73b0\u5728\u7684\u4ee3\u7801\u770b\u8d77\u6765\u6bd4\u4e4b\u524d\u91c7\u7528\u6761\u4ef6\u5206\u652f\u7684\u5197\u957f\u4ee3\u7801\u7b80\u6d01\u591a\u4e86","title":"Optional \u7c7b\u7684\u94fe\u5f0f\u65b9\u6cd5"},{"location":"hmtt/day07/","text":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 00:51 \u00b6 \u80fd\u591f\u638c\u63e1\u81ea\u5a92\u4f53\u6587\u7ae0\u5ba1\u6838\u7684\u6d41\u7a0b \u80fd\u591f\u4f7f\u7528\u963f\u91cc\u4e91\u5b89\u5168\u670d\u52a1\u68c0\u6d4b\u6587\u7ae0\u5185\u5bb9 \u80fd\u591f\u5b8c\u6210\u81ea\u5a92\u4f53\u6587\u7ae0\u5ba1\u6838\u7684\u529f\u80fd \u80fd\u591f\u5b8c\u6210\u81ea\u5a92\u4f53\u53d1\u5e03\u6587\u7ae0\u4e0e\u5ba1\u6838\u5bf9\u63a5 02-\u81ea\u52a8\u5ba1\u6838\u9700\u6c42\u8bf4\u660e 12\uff1a34 \u00b6 status\u5b57\u6bb5\uff1a0 \u8349\u7a3f 1 \u5f85\u5ba1\u6838 2 \u5ba1\u6838\u5931\u8d25 3 \u4eba\u5de5\u5ba1\u6838 4 \u4eba\u5de5\u5ba1\u6838\u901a\u8fc7 8 \u5ba1\u6838\u901a\u8fc7\uff08\u5f85\u53d1\u5e03\uff09 9 \u5df2\u53d1\u5e03 03-\u8868\u7ed3\u6784\u5206\u6790 08:53 \u00b6 wm_news \u81ea\u5a92\u4f53\u6587\u7ae0\u8868 \u5728\u81ea\u5a92\u4f53\u5e93 ap_author \u6587\u7ae0\u4f5c\u8005\u8868 \u5728article\u5e93 ap_article \u6587\u7ae0\u4fe1\u606f\u8868 \u5728article\u5e93 layout \u6587\u7ae0\u5e03\u5c40 0 \u65e0\u56fe\u6587\u7ae0 1 \u5355\u56fe\u6587\u7ae0 2 \u591a\u56fe\u6587\u7ae0 flag \u6587\u7ae0\u6807\u8bb0 0 \u666e\u901a\u6587\u7ae0 1 \u70ed\u70b9\u6587\u7ae0 2 \u7f6e\u9876\u6587\u7ae0 3 \u7cbe\u54c1\u6587\u7ae0 4 \u5927V \u6587\u7ae0 images \u6587\u7ae0\u56fe\u7247 \u591a\u5f20\u9017\u53f7\u5206\u9694 ap_article_content \u6587\u7ae0\u5185\u5bb9\u8868 \u5728article\u5e93 ap_article \u548cap_article_content \u662f\u4e00\u5bf9\u4e00\u7684\u5173\u7cfb ap_article_config \u6587\u7ae0\u914d\u7f6e\u8868 \u5728article\u5e93 ap_article \u548cap_article_config \u662f\u4e00\u5bf9\u4e00\u7684\u5173\u7cfb 04-\u81ea\u5a92\u4f53\u63a5\u53e3 12:36 \u00b6 \u5728\u81ea\u52a8\u5ba1\u6838\u7684\u65f6\u5019\u9700\u8981\u81ea\u5a92\u4f53\u7684\u8fdc\u7a0b\u63a5\u53e3\uff0c\u5982\u4e0b\uff1a 1 \u6839\u636e\u6587\u7ae0id\u67e5\u8be2\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u6570\u636e 2 \u5728\u5ba1\u6838\u7684\u8fc7\u7a0b\u4e2d,\u5ba1\u6838\u5931\u8d25\u6216\u8005\u6210\u529f\u9700\u8981\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001 3 \u5728\u6587\u7ae0\u8fdb\u884c\u4fdd\u5b58\u7684\u65f6\u5019\u9700\u8981\u67e5\u8be2\u4f5c\u8005\u4fe1\u606f\uff0c\u9700\u8981\u901a\u8fc7\u81ea\u5a92\u4f53\u7528\u6237\u5173\u8054\u67e5\u8be2\u4f5c\u8005\u4fe1\u606f admin\u670d\u52a1\u8c03\u7528wemedia\u670d\u52a1\uff0c\u63a5\u53e3\u8c03\u7528\u5c5e\u4e8e\u5185\u90e8\u8c03\u7528\uff0c\u65e0\u9700\u8d70\u7f51\u5173\u3002 package com.heima.admin.feign ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.wemedia.pojos.WmNews ; import com.heima.model.wemedia.pojos.WmUser ; import org.springframework.cloud.openfeign.FeignClient ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.PathVariable ; import org.springframework.web.bind.annotation.PostMapping ; @FeignClient ( \"leadnews-wemedia\" ) public interface WemediaFeign { /** * \u6839\u636eid\u67e5\u8be2\u6587\u7ae0\u4fe1\u606f * @param id \u6587\u7ae0ID * @return \u6587\u7ae0\u4fe1\u606f */ @GetMapping ( \"/api/v1/news/findOne/{id}\" ) public WmNews findById ( @PathVariable ( \"id\" ) Integer id ); /** * \u66f4\u65b0\u6587\u7ae0\u4fe1\u606f * @param wmNews \u6587\u7ae0\u5bf9\u8c61 * @return */ @PostMapping ( \"/api/v1/news/update\" ) public ResponseResult updateWmNews ( WmNews wmNews ); /** *\u6839\u636e\u6587\u7ae0\u4f5c\u8005ID\u83b7\u53d6\u4f5c\u8005\u4fe1\u606f * @param id \u6587\u7ae0\u4f5c\u8005ID * @return \u6587\u7ae0\u4f5c\u8005ID */ @GetMapping ( \"/api/v1/user/findOne/{id}\" ) public WmUser findWmUserById ( @PathVariable ( \"id\" ) Integer id ); } package com.heima.wemedia.controller.v1 ; import com.heima.apis.wemedia.WmNewsControllerApi ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.wemedia.dtos.WmNewsDto ; import com.heima.model.wemedia.dtos.WmNewsPageReqDto ; import com.heima.model.wemedia.pojos.WmNews ; import com.heima.wemedia.service.WmNewsService ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.* ; @RestController @RequestMapping ( \"/api/v1/news\" ) public class WmNewsController implements WmNewsControllerApi { @Autowired private WmNewsService wmNewsService ; @PostMapping ( \"/list\" ) @Override public ResponseResult findAll ( @RequestBody WmNewsPageReqDto dto ) { return wmNewsService . findAll ( dto ); } @PostMapping ( \"/submit\" ) @Override public ResponseResult submitNews ( @RequestBody WmNewsDto dto ) { if ( dto . getStatus () == WmNews . Status . SUBMIT . getCode ()){ return wmNewsService . saveNews ( dto , WmNews . Status . SUBMIT . getCode ()); } else { return wmNewsService . saveNews ( dto , WmNews . Status . NORMAL . getCode ()); } } @GetMapping ( \"/one/{id}\" ) @Override public ResponseResult findWmNewsById ( @PathVariable ( \"id\" ) Integer id ) { return wmNewsService . findWmNewsById ( id ); } @GetMapping ( \"/del_news/{id}\" ) @Override public ResponseResult delNews ( @PathVariable ( \"id\" ) Integer id ) { return wmNewsService . delNews ( id ); } @PostMapping ( \"/down_or_up\" ) @Override public ResponseResult downOrUp ( @RequestBody WmNewsDto dto ) { return wmNewsService . downOrUp ( dto ); } @GetMapping ( \"/findOne/{id}\" ) @Override public WmNews findById ( @PathVariable ( \"id\" ) Integer id ) { return wmNewsService . getById ( id ); } @PostMapping ( \"/update\" ) @Override public ResponseResult updateWmNews ( @RequestBody WmNews wmNews ) { boolean b = wmNewsService . updateById ( wmNews ); return b ? ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ): ResponseResult . errorResult ( AppHttpCodeEnum . SERVER_ERROR ); } } package com.heima.wemedia.controller.v1 ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.apis.wemedia.WmUserControllerApi ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.wemedia.pojos.WmUser ; import com.heima.wemedia.service.WmUserService ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.* ; import java.util.List ; @RestController @RequestMapping ( \"/api/v1/user\" ) public class WmUserController implements WmUserControllerApi { @Autowired private WmUserService wmUserService ; @PostMapping ( \"/save\" ) @Override public ResponseResult save ( @RequestBody WmUser wmUser ) { wmUserService . save ( wmUser ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } @GetMapping ( \"/findByName/{name}\" ) @Override public WmUser findByName ( @PathVariable ( \"name\" ) String name ) { List < WmUser > list = wmUserService . list ( Wrappers . < WmUser > lambdaQuery (). eq ( WmUser :: getName , name )); if ( list != null && ! list . isEmpty ()){ return list . get ( 0 ); } return null ; } @GetMapping ( \"/findOne/{id}\" ) @Override public WmUser findWmUserById ( @PathVariable ( \"id\" ) Integer id ) { return wmUserService . getById ( id ); } } 05-\u96ea\u82b1\u7b97\u6cd5 07:13 \u00b6 1.redis\u81ea\u589e,incr\u547d\u4ee4 2.\u7f8e\u56e2leaf\u6846\u67b6->mysql\u4e2d\u5b58\u50a8id\u8868 3.\u96ea\u82b1\u7b97\u6cd5 4.UUID\u751f\u6210\u968f\u673a\u5b57\u7b26\u4e32 \u5206\u5e03\u5f0fid \u968f\u7740\u4e1a\u52a1\u7684\u589e\u957f\uff0c\u6587\u7ae0\u8868\u53ef\u80fd\u8981\u5360\u7528\u5f88\u5927\u7684\u7269\u7406\u5b58\u50a8\u7a7a\u95f4\uff0c\u4e3a\u4e86\u89e3\u51b3\u8be5\u95ee\u9898\uff0c\u540e\u671f\u4f7f\u7528\u6570\u636e\u5e93\u5206\u7247\u6280\u672f\u3002\u5c06\u4e00\u4e2a\u6570\u636e\u5e93\u8fdb\u884c\u62c6\u5206\uff0c\u901a\u8fc7\u6570\u636e\u5e93\u4e2d\u95f4\u4ef6\u8fde\u63a5\u3002\u5982\u679c\u6570\u636e\u5e93\u4e2d\u8be5\u8868\u9009\u7528ID\u81ea\u589e\u7b56\u7565\uff0c\u5219\u53ef\u80fd\u4ea7\u751f\u91cd\u590d\u7684ID\uff0c\u6b64\u65f6\u5e94\u8be5\u4f7f\u7528\u5206\u5e03\u5f0fID\u751f\u6210\u7b56\u7565\u6765\u751f\u6210ID\u3002 \u96ea\u82b1\u7b97\u6cd5\u5b9e\u73b0 snowflake\u662fTwitter\u5f00\u6e90\u7684\u5206\u5e03\u5f0fID\u751f\u6210\u7b97\u6cd5\uff0c\u7ed3\u679c\u662f\u4e00\u4e2along\u578b\u7684ID\u3002\u5176\u6838\u5fc3\u601d\u60f3\u662f\uff1a\u4f7f\u752841bit\u4f5c\u4e3a\u6beb\u79d2\u6570\uff0c10bit\u4f5c\u4e3a\u673a\u5668\u7684ID\uff085\u4e2abit\u662f\u6570\u636e\u4e2d\u5fc3\uff0c5\u4e2abit\u7684\u673a\u5668ID\uff09\uff0c12bit\u4f5c\u4e3a\u6beb\u79d2\u5185\u7684\u6d41\u6c34\u53f7\uff08\u610f\u5473\u7740\u6bcf\u4e2a\u8282\u70b9\u5728\u6bcf\u6beb\u79d2\u53ef\u4ee5\u4ea7\u751f 4096 \u4e2a ID\uff09\uff0c\u6700\u540e\u8fd8\u6709\u4e00\u4e2a\u7b26\u53f7\u4f4d\uff0c\u6c38\u8fdc\u662f0 mybatis-plus\u5df2\u7ecf\u96c6\u6210\u4e86\u96ea\u82b1\u7b97\u6cd5\uff0c\u5b8c\u6210\u4ee5\u4e0b\u4e24\u6b65\u5373\u53ef\u5728\u9879\u76ee\u4e2d\u96c6\u6210\u96ea\u82b1\u7b97\u6cd5 \u7b2c\u4e00\uff1a\u5728\u5b9e\u4f53\u7c7b\u4e2d\u7684id\u4e0a\u52a0\u5165\u5982\u4e0b\u914d\u7f6e\uff0c\u6307\u5b9a\u7c7b\u578b\u4e3aid_worker @TableId ( value = \"id\" , type = IdType . ID_WORKER ) private Long id ; \u7b2c\u4e8c\uff1a\u5728application.yml\u6587\u4ef6\u4e2d\u914d\u7f6e\u6570\u636e\u4e2d\u5fc3id\u548c\u673a\u5668id mybatis-plus : mapper-locations : classpath*:mapper/*.xml # \u8bbe\u7f6e\u522b\u540d\u5305\u626b\u63cf\u8def\u5f84\uff0c\u901a\u8fc7\u8be5\u5c5e\u6027\u53ef\u4ee5\u7ed9\u5305\u4e2d\u7684\u7c7b\u6ce8\u518c\u522b\u540d type-aliases-package : com.heima.model.article.pojos global-config : datacenter-id : 1 workerId : 1 datacenter-id:\u6570\u636e\u4e2d\u5fc3id(\u53d6\u503c\u8303\u56f4\uff1a0-31) workerId:\u673a\u5668id(\u53d6\u503c\u8303\u56f4\uff1a0-31) \u5b58\u5728\u7684\u95ee\u9898 \u00b6 \u65f6\u95f4\u56de\u62e8\u95ee\u9898\uff1a\u7531\u4e8e\u673a\u5668\u7684\u65f6\u95f4\u662f\u52a8\u6001\u7684\u8c03\u6574\u7684\uff0c\u6709\u53ef\u80fd\u4f1a\u51fa\u73b0\u65f6\u95f4\u8dd1\u5230\u4e4b\u524d\u51e0\u6beb\u79d2\uff0c\u5982\u679c\u8fd9\u4e2a\u65f6\u5019\u83b7\u53d6\u5230\u4e86\u8fd9\u79cd\u65f6\u95f4\uff0c\u5219\u4f1a\u51fa\u73b0\u6570\u636e\u91cd\u590d \u673a\u5668id\u5206\u914d\u53ca\u56de\u6536\u95ee\u9898\uff1a\u76ee\u524d\u673a\u5668id\u9700\u8981\u6bcf\u53f0\u673a\u5668\u4e0d\u4e00\u6837\uff0c\u8fd9\u6837\u7684\u65b9\u5f0f\u5206\u914d\u9700\u8981\u6709\u65b9\u6848\u8fdb\u884c\u5904\u7406\uff0c\u540c\u65f6\u4e5f\u8981\u8003\u8651\uff0c\u5982\u679c\u6539\u673a\u5668\u5b95\u673a\u4e86\uff0c\u5bf9\u5e94\u7684workerId\u5206\u914d\u540e\u7684\u56de\u6536\u95ee\u9898 \u673a\u5668id\u4e0a\u9650\uff1a\u673a\u5668id\u662f\u56fa\u5b9a\u7684bit\uff0c\u90a3\u4e48\u4e5f\u5c31\u662f\u5bf9\u5e94\u7684\u673a\u5668\u4e2a\u6570\u662f\u6709\u4e0a\u9650\u7684\uff0c\u5728\u6709\u4e9b\u4e1a\u52a1\u573a\u666f\u4e0b\uff0c\u9700\u8981\u6240\u6709\u673a\u5668\u5171\u4eab\u540c\u4e00\u4e2a\u4e1a\u52a1\u7a7a\u95f4\uff0c\u90a3\u4e4810bit\u8868\u793a\u76841024\u53f0\u673a\u5668\u662f\u4e0d\u591f\u7684\u3002 06-\u6587\u7ae0\u63a5\u53e3\u5b9a\u4e49 04:58 \u00b6 admin\u670d\u52a1\u8c03\u7528article\u670d\u52a1 package com.heima.admin.feign ; import com.heima.model.article.pojos.ApArticle ; import com.heima.model.article.pojos.ApArticleConfig ; import com.heima.model.article.pojos.ApArticleContent ; import com.heima.model.article.pojos.ApAuthor ; import com.heima.model.common.dtos.ResponseResult ; import org.springframework.cloud.openfeign.FeignClient ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.PathVariable ; import org.springframework.web.bind.annotation.PostMapping ; @FeignClient ( \"leadnews-article\" ) public interface ArticleFeign { /** * \u4fdd\u5b58\u6587\u7ae0\u6570\u636e * @param apArticle \u6587\u7ae0\u5bf9\u8c61 * @return */ @PostMapping ( \"/api/v1/article/save\" ) public ApArticle saveAparticle ( ApArticle apArticle ); /** * \u4fdd\u5b58\u6587\u7ae0\u914d\u7f6e\u5bf9\u8c61 * @param apArticleConfig \u6587\u7ae0\u914d\u7f6e\u5bf9\u8c61 * @return */ @PostMapping ( \"/api/v1/article_config/save\" ) public ResponseResult saveArticleConfig ( ApArticleConfig apArticleConfig ); /** * \u4fdd\u5b58\u6587\u7ae0\u5185\u5bb9\u6570\u636e * @param apArticleContent \u6587\u7ae0\u5185\u5bb9 * @return */ @PostMapping ( \"/api/v1/article_content/save\" ) public ResponseResult saveArticleContent ( ApArticleContent apArticleContent ); /** * \u6839\u636e\u540d\u5b57\u67e5\u8be2\u4f5c\u8005 * @param name \u540d\u5b57 * @return */ @GetMapping ( \"/api/v1/author/findByName/{name}\" ) public ApAuthor selectAuthorByName ( @PathVariable ( \"name\" ) String name ); } 07-\u6587\u7ae0\u63a5\u53e3\u5b9e\u73b0 16:38 \u00b6 AuthorController: package com.heima.article.controller.v1 ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.apis.article.AuthorControllerApi ; import com.heima.article.service.AuthorService ; import com.heima.model.article.pojos.ApAuthor ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.* ; import java.util.List ; @RestController @RequestMapping ( \"/api/v1/author\" ) public class AuthorController implements AuthorControllerApi { @Autowired AuthorService authorService ; @GetMapping ( \"/findByUserId/{id}\" ) @Override public ApAuthor findByUserId ( @PathVariable ( \"id\" ) Integer id ) { List < ApAuthor > list = authorService . list ( Wrappers . < ApAuthor > lambdaQuery (). eq ( ApAuthor :: getUserId , id )); if ( list != null && ! list . isEmpty ()){ return list . get ( 0 ); } return null ; } @PostMapping ( \"/save\" ) @Override public ResponseResult save ( @RequestBody ApAuthor apAuthor ) { authorService . save ( apAuthor ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } @GetMapping ( \"/findByName/{name}\" ) @Override public ApAuthor selectAuthorByName ( @PathVariable ( \"name\" ) String name ) { //select * from ap_author where name = #{name} ApAuthor apAuthor = authorService . getOne ( Wrappers . < ApAuthor > lambdaQuery (). eq ( ApAuthor :: getName , name )); return apAuthor ; } } ApArticleController: package com.heima.article.controller.v1 ; import com.heima.apis.article.ApArticleControllerApi ; import com.heima.article.service.ApArticleService ; import com.heima.model.article.pojos.ApArticle ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestBody ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RestController ; @RestController @RequestMapping ( \"/api/v1/article\" ) public class ApArticleController implements ApArticleControllerApi { @Autowired private ApArticleService articleService ; @PostMapping ( \"save\" ) @Override public ApArticle saveArticle ( @RequestBody ApArticle apArticle ) { articleService . save ( apArticle ); return apArticle ; } } ApArticleContentController: package com.heima.article.controller.v1 ; import com.heima.apis.article.ApArticleContentControllerApi ; import com.heima.article.service.ApArticleContentService ; import com.heima.model.article.pojos.ApArticleContent ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestBody ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RestController ; @RestController @RequestMapping ( \"/api/v1/article_content\" ) public class ApArticleContentController implements ApArticleContentControllerApi { @Autowired private ApArticleContentService apArticleContentService ; @PostMapping ( \"/save\" ) @Override public ResponseResult saveArticleContent ( @RequestBody ApArticleContent apArticleContent ) { boolean flag = apArticleContentService . save ( apArticleContent ); return flag ? ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ) : ResponseResult . okResult ( AppHttpCodeEnum . SERVER_ERROR ); } } ApArticleConfigController: package com.heima.article.controller.v1 ; import com.heima.apis.article.ApArticleConfigControllerApi ; import com.heima.article.service.ApArticleConfigService ; import com.heima.model.article.pojos.ApArticleConfig ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestBody ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RestController ; @RestController @RequestMapping ( \"/api/v1/article_config\" ) public class ApArticleConfigController implements ApArticleConfigControllerApi { @Autowired private ApArticleConfigService apArticleConfigService ; @PostMapping ( \"/save\" ) @Override public ResponseResult saveArticleConfig ( @RequestBody ApArticleConfig apArticleConfig ) { apArticleConfigService . save ( apArticleConfig ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } } 08-\u5f15\u5165\u963f\u91cc\u4e91\u670d\u52a1\u548cfastdfs 05:41 \u00b6 \u5728admin\u5fae\u670d\u52a1\u4e2d\u52a0\u5165\u5982\u4e0b\u914d\u7f6e \u6587\u7ae0\u5ba1\u6838\u9700\u8981\u8c03\u7528\u963f\u91cc\u4e91\u670d\u52a1\u7684\u4e91\u5b89\u5168\u670d\u52a1\u6765\u5ba1\u6838\u6587\u7ae0\u548c\u56fe\u7247 package com.heima.admin.config ; import org.springframework.context.annotation.ComponentScan ; import org.springframework.context.annotation.Configuration ; @Configuration @ComponentScan ( \"com.heima.common.aliyun\" ) public class AliyunConfig { } fastdfs\u670d\u52a1\u5f15\u5165 \u5728\u963f\u91cc\u4e91\u56fe\u7247\u5ba1\u6838\u4e2d\u9700\u8981\u5c06\u56fe\u7247\u5148\u4ecefastdfs\u4e2d\u4e0b\u8f7d\u4e0b\u6765\u518d\u53bb\u5ba1\u6838\u624d\u53ef\u4ee5\uff0c\u5982\u679c\u5f53\u524dfastdfs\u662f\u4e00\u4e2a\u5916\u7f51\u53ef\u4ee5\u8bbf\u95ee\u7684\u5219\u65e0\u987b\u518d\u6b21\u4e0b\u8f7d\uff0c\u53ef\u4ee5\u76f4\u63a5\u5ba1\u6838 package com.heima.admin.config ; import org.springframework.context.annotation.ComponentScan ; import org.springframework.context.annotation.Configuration ; @Configuration @ComponentScan ( \"com.heima.common.fastdfs\" ) public class FastDfsConfig { } \u654f\u611f\u8bcd\u5904\u7406 \u00b6 \u8fd9\u91cc\u67e5\u8be2\u6240\u6709\u654f\u611f\u8bcd\u7684\u4f5c\u7528\u662f\uff0c\u5728\u53bb\u5ba1\u6838\u6587\u672c\u5185\u5bb9\u7684\u65f6\u5019\uff0c\u4ece\u4e24\u65b9\u9762\u5165\u624b\uff0c\u4e00\u4e2a\u662f\u8c03\u7528\u963f\u91cc\u4e91\u7b2c\u4e09\u65b9\u63a5\u53e3\u5ba1\u6838\u5185\u5bb9\uff0c\u53e6\u5916\u4e00\u4e2a\u662f\u7cfb\u7edf\u81ea\u5df1\u5ba1\u6838\uff0c\u4f7f\u7528\u81ea\u5df1\u7ef4\u62a4\u7684\u654f\u611f\u8bcd\u5e93\u53bb\u5339\u914d\u53d1\u5e03\u6587\u7ae0\u7684\u5185\u5bb9\u3002 \u5728admin\u5de5\u7a0b\u4e2d\u5904\u7406\uff1a\u4fee\u6539AdSensitiveMapper\uff0c\u65b0\u589e\u65b9\u6cd5\uff1afindAllSensitive @Mapper public interface AdSensitiveMapper extends BaseMapper < AdSensitive > { public List < String > findAllSensitive (); } \u65b0\u589e\u914d\u7f6e\u6587\u4ef6resources/mapper/AdSensitiveMapper.xml <?xml version=\"1.0\" encoding=\"UTF-8\"?> <!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"> <mapper namespace= \"com.heima.admin.mapper.AdSensitiveMapper\" > <select id= \"findAllSensitive\" resultType= \"string\" > select sensitives from ad_sensitive </select> </mapper> 09-\u4e1a\u52a1\u5c42\u63a5\u53e3\u5b9a\u4e49 06:35 \u00b6 package com.heima.admin.service ; public interface WemediaNewsAutoScanService { /** * \u81ea\u5a92\u4f53\u6587\u7ae0\u5ba1\u6838 * @param id \u6587\u7ae0ID */ public void autoScanByMediaNewsId ( Integer id ); } \u6b64\u65b9\u6cd5\u4f1a\u5728\u63d0\u4ea4\u5ba1\u6838\u548c\u5b9a\u65f6\u4efb\u52a1\u89e6\u53d1\u65f6\u8c03\u7528 10-\u62bd\u53d6\u5185\u5bb9\u548c\u56fe\u7247 17:40 \u00b6 public void autoScanByMediaNewsId ( Integer id ) { if ( id == null ) { log . error ( \"\u5f53\u524d\u7684\u5ba1\u6838id\u7a7a\" ); return ; } //1.\u6839\u636eid\u67e5\u8be2\u81ea\u5a92\u4f53\u6587\u7ae0\u4fe1\u606f WmNews wmNews = wemediaFeign . findById ( id ); if ( wmNews == null ) { log . error ( \"\u5ba1\u6838\u7684\u81ea\u5a92\u4f53\u6587\u7ae0\u4e0d\u5b58\u5728\uff0c\u81ea\u5a92\u4f53\u7684id:{}\" , id ); return ; } //2.\u6587\u7ae0\u72b6\u6001\u4e3a4\uff08\u4eba\u5de5\u5ba1\u6838\u901a\u8fc7\uff09\u76f4\u63a5\u4fdd\u5b58\u6570\u636e\u548c\u521b\u5efa\u7d22\u5f15 if ( wmNews . getStatus () == 4 ) { //\u4fdd\u5b58\u6570\u636e saveAppArticle ( wmNews ); return ; } //3.\u6587\u7ae0\u72b6\u6001\u4e3a8 \u53d1\u5e03\u65f6\u95f4>\u5f53\u524d\u65f6\u95f4 \u76f4\u63a5\u4fdd\u5b58\u6570\u636e if ( wmNews . getStatus () == 8 && wmNews . getPublishTime (). getTime () <= System . currentTimeMillis ()) { //\u4fdd\u5b58\u6570\u636e saveAppArticle ( wmNews ); return ; } //4.\u6587\u7ae0\u72b6\u6001\u4e3a1\uff0c\u5f85\u5ba1\u6838 if ( wmNews . getStatus () == 1 ) { //\u62bd\u53d6\u6587\u7ae0\u5185\u5bb9\u4e2d\u7684\u7eaf\u6587\u672c\u548c\u56fe\u7247 Map < String , Object > contentAndImagesResult = handleTextAndImages ( wmNews ); //4.1 \u6587\u672c\u5ba1\u6838 //4.2 \u56fe\u7247\u5ba1\u6838 //4.3 \u81ea\u7ba1\u7406\u7684\u654f\u611f\u8bcd\u5ba1\u6838 //4.4 \u53d1\u5e03\u65f6\u95f4\u5927\u4e8e\u5f53\u524d\u65f6\u95f4\uff0c //5.\u5ba1\u6838\u901a\u8fc7\uff0c\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u72b6\u6001\u4e3a9 \u4fdd\u5b58app\u7aef\u76f8\u5173\u6587\u7ae0\u4fe1\u606f } } /** * \u63d0\u53d6\u6587\u672c\u5185\u5bb9\u548c\u56fe\u7247 * * @param wmNews * @return */ private Map < String , Object > handleTextAndImages ( WmNews wmNews ) { //\u6587\u7ae0\u7684\u5185\u5bb9 String content = wmNews . getContent (); //\u5b58\u50a8\u7eaf\u6587\u672c\u5185\u5bb9 StringBuilder sb = new StringBuilder (); //\u5b58\u50a8\u56fe\u7247 List < String > images = new ArrayList <> (); //content\u662f\u4e00\u4e2aJSON\u6570\u7ec4\uff0c\u5982\u4e0b /** * { * \"title\":\"\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u80cc\u666f\", * \"type\":\"1\",//\u8fd9\u4e2a 0 \u662f\u65e0\u56fe 1 \u662f\u5355\u56fe 3 \u662f\u591a\u56fe -1 \u662f\u81ea\u52a8 * \"labels\":\"\u9ed1\u9a6c\u5934\u6761\", * \"publishTime\":\"2020-03-14T11:35:49.000Z\", * \"channelId\":1, * \"images\":[ * \"http://192.168.200.130/group1/M00/00/00/wKjIgl5swbGATaSAAAEPfZfx6Iw790.png\" * ], * \"status\":1, * \"content\":\"[ * { * \"type\":\"text\", * \"value\":\"\u968f\u7740\u667a\u80fd\u624b\u673a\u7684\u666e\u53ca\uff0c\u4eba\u4eec\u66f4\u52a0\u4e60\u60ef\u4e8e\u901a\u8fc7\u624b\u673a\u6765\u770b\u65b0\u95fb\u3002\u7531\u4e8e\u751f\u6d3b\u8282\u594f\u7684\u52a0\u5feb\uff0c\u5f88\u591a\u4eba\u53ea\u80fd\u5229\u7528\u788e\u7247\u65f6\u95f4\u6765\u83b7\u53d6\u4fe1\u606f\uff0c\u56e0\u6b64\uff0c\u5bf9\u4e8e\u79fb\u52a8\u8d44\u8baf\u5ba2\u6237\u7aef\u7684\u9700\u6c42\u4e5f\u8d8a\u6765\u8d8a\u9ad8\u3002\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u6b63\u662f\u5728\u8fd9\u6837\u80cc\u666f\u4e0b\u5f00\u53d1\u51fa\u6765\u3002\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u91c7\u7528\u5f53\u4e0b\u706b\u70ed\u7684\u5fae\u670d\u52a1+\u5927\u6570\u636e\u6280\u672f\u67b6\u6784\u5b9e\u73b0\u3002\u672c\u9879\u76ee\u4e3b\u8981\u7740\u624b\u4e8e\u83b7\u53d6\u6700\u65b0\u6700\u70ed\u65b0\u95fb\u8d44\u8baf\uff0c\u901a\u8fc7\u5927\u6570\u636e\u5206\u6790\u7528\u6237\u559c\u597d\u7cbe\u786e\u63a8\u9001\u54a8\u8be2\u65b0\u95fb\" * }, * { * \"type\":\"image\", * \"value\":\"http://192.168.200.130/group1/M00/00/00/wKjIgl5swbGATaSAAAEPfZfx6Iw790.png\" * } * ]\" * } */ //\u5c06\u6570\u7ec4\u8f6c\u6362\u6210List<Map>\u7c7b\u578b List < Map > contentList = JSONArray . parseArray ( content , Map . class ); for ( Map map : contentList ) { if ( map . get ( \"type\" ). equals ( \"text\" )) { sb . append ( map . get ( \"value\" )); } if ( map . get ( \"type\" ). equals ( \"image\" )) { images . add (( String ) map . get ( \"value\" )); } } //type\u4e3a0\u4ee3\u8868\u65e0\u56fe\u6587\u7ae0 //\u628a\u5c01\u9762\u7684\u56fe\u7247\uff0c\u4e5f\u6dfb\u52a0\u5230\u68c0\u6d4b\u5217\u8868\u91cc\u6765 if ( wmNews . getImages () != null && wmNews . getType () != 0 ) { String [] split = wmNews . getImages (). split ( \",\" ); images . addAll ( Arrays . asList ( split )); } //\u5c01\u88c5\u4e00\u4e2amap\u8fdb\u884c\u8fd4\u56de Map < String , Object > resultMap = new HashMap <> (); //\u6587\u672c\u5185\u5bb9 resultMap . put ( \"content\" , sb . toString ()); //\u56fe\u7247\u5185\u5bb9 resultMap . put ( \"images\" , images ); return resultMap ; } 11-\u6587\u672c\u5ba1\u6838 10:51 \u00b6 /** * \u6587\u672c\u5ba1\u6838 * * @param content \u6587\u672c\u5185\u5bb9 * @param wmNews \u6587\u7ae0\u5bf9\u8c61 * @return \u662f\u5426\u6210\u529f\u6807\u8bc6 true or false */ private boolean handleTextScan ( String content , WmNews wmNews ) { //\u5ba1\u6838\u7ed3\u679c\uff0c\u662f\u5426\u6210\u529f boolean flag = true ; try { //\u4f7f\u7528\u963f\u91cc\u4e91\u8fdb\u884c\u5ba1\u6838 Map map = greeTextScan . greeTextScan ( content ); //\u8fd4\u56de\u7ed3\u679c\u4e2d\u7684suggestion\u5b57\u6bb5\u5b58\u653e\u4e86\u7ed3\u679c //\u5ba1\u6838\u4e0d\u901a\u8fc7 if ( ! map . get ( \"suggestion\" ). equals ( \"pass\" )) { //\u5ba1\u6838\u5931\u8d25 if ( map . get ( \"suggestion\" ). equals ( \"block\" )) { //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 updateWmNews ( wmNews , ( short ) 2 , \"\u6587\u7ae0\u5185\u5bb9\u4e2d\u6709\u654f\u611f\u8bcd\u6c47\" ); flag = false ; } //\u4eba\u5de5\u5ba1\u6838 if ( map . get ( \"suggestion\" ). equals ( \"review\" )) { //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 updateWmNews ( wmNews , ( short ) 3 , \"\u6587\u7ae0\u5185\u5bb9\u4e2d\u6709\u4e0d\u786e\u5b9a\u8bcd\u6c47\" ); flag = false ; } } // String suggestion = (String) map.get(\"suggestion\"); // if(\"block\".equals(suggestion)){ // //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 // updateWmNews(wmNews, (short) 2, \"\u6587\u7ae0\u5185\u5bb9\u4e2d\u6709\u654f\u611f\u8bcd\u6c47\"); // flag = false; // }else if(\"review\".equals(suggestion)){ // //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 // updateWmNews(wmNews, (short) 3, \"\u6587\u7ae0\u5185\u5bb9\u4e2d\u6709\u4e0d\u786e\u5b9a\u8bcd\u6c47\"); // flag = false; // } } catch ( Exception e ) { e . printStackTrace (); flag = false ; } return flag ; } //4.1 \u6587\u672c\u5ba1\u6838 boolean textScanBoolean = handleTextScan (( String ) contentAndImagesResult . get ( \"content\" ), wmNews ); if ( ! textScanBoolean ) return ; 12-\u56fe\u7247\u5ba1\u6838 13:35 \u00b6 //4.2 \u56fe\u7247\u5ba1\u6838 boolean imagesScanBoolean = handleImagesScan (( List < String > ) contentAndImagesResult . get ( \"images\" ), wmNews ); if ( ! imagesScanBoolean ) return ; /** * \u5ba1\u6838\u56fe\u7247 * * @param images * @param wmNews * @return */ private boolean handleImagesScan ( List < String > images , WmNews wmNews ) { //\u5224\u65ad\u56fe\u7247\u662f\u5426\u4e3a\u7a7a\uff0c\u4e00\u5b9a\u8981\u52a0size <= 0\u5224\u65ad\uff0c\u5426\u5219\u4e0d\u4f1a\u751f\u6548 //\u5177\u4f53\u4ee3\u7801\u53ef\u4ee5\u770b\u751f\u6210\u56fe\u7247list\u5904\uff0c\u76f4\u63a5new ArrayList\uff0c\u6240\u4ee5\u8fd9\u4e2alist\u5fc5\u4e0d\u53ef\u80fd\u4e3anull if ( images == null || images . size () <= 0 ) { return true ; } boolean flag = true ; List < byte []> imageList = new ArrayList <> (); try { for ( String image : images ) { //\u53bb\u9664\u524d\u7f00 http://192.168.200.130/ String imageName = image . replace ( fileServerUrl , \"\" ); //\u627e\u5230\u7b2c\u4e00\u4e2a\u659c\u6760 group1/M00/00/00/rBENvl1RF0GAIKuTAAE4r64gbnE179.jpg int index = imageName . indexOf ( \"/\" ); //\u4ece0\u5230\u7b2c\u4e00\u4e2a\u659c\u6760\uff08\u4e0d\u5305\u542b\u659c\u6760\uff09 group1 String groupName = imageName . substring ( 0 , index ); //\u4ece\u7b2c\u4e00\u4e2a\u659c\u6760\u540e\u4e00\u4f4d\u5230\u6700\u540e M00/00/00/rBENvl1RF0GAIKuTAAE4r64gbnE179.jpg String imagePath = imageName . substring ( index + 1 ); //\u901a\u8fc7fastdfs\u4e0b\u8f7d\u6587\u4ef6\uff0c\u4fdd\u5b58\u5230\u5185\u5bb9\u4e2dbyte\u6570\u7ec4 byte [] imageByte = fastDFSClient . download ( groupName , imagePath ); //\u5c06byte\u6570\u7ec4\u653e\u5230list\u4e2d\uff0c\u65b9\u4fbf\u63d0\u4ea4\u5230\u963f\u91cc\u4e91 imageList . add ( imageByte ); } //\u963f\u91cc\u4e91\u56fe\u7247\u5ba1\u6838 Map map = greenImageScan . imageScan ( imageList ); //\u5ba1\u6838\u4e0d\u901a\u8fc7 if ( ! map . get ( \"suggestion\" ). equals ( \"pass\" )) { //\u5ba1\u6838\u5931\u8d25 if ( map . get ( \"suggestion\" ). equals ( \"block\" )) { //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 updateWmNews ( wmNews , ( short ) 2 , \"\u6587\u7ae0\u4e2d\u56fe\u7247\u6709\u8fdd\u89c4\" ); flag = false ; } //\u4eba\u5de5\u5ba1\u6838 if ( map . get ( \"suggestion\" ). equals ( \"review\" )) { //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 updateWmNews ( wmNews , ( short ) 3 , \"\u6587\u7ae0\u56fe\u7247\u6709\u4e0d\u786e\u5b9a\u5143\u7d20\" ); flag = false ; } } } catch ( Exception e ) { e . printStackTrace (); flag = false ; } return flag ; } 13-\u81ea\u7ba1\u7406\u654f\u611f\u8bcd\u5ba1\u6838 08:17 \u00b6 //4.3 \u81ea\u7ba1\u7406\u7684\u654f\u611f\u8bcd\u5ba1\u6838 boolean sensitiveScanBoolean = handleSensitive (( String ) contentAndImagesResult . get ( \"content\" ), wmNews ); if ( ! sensitiveScanBoolean ) return ; //4.4 \u53d1\u5e03\u65f6\u95f4\u5927\u4e8e\u5f53\u524d\u65f6\u95f4\uff0c if ( wmNews . getPublishTime (). getTime () > System . currentTimeMillis ()) { //\u4fee\u6539\u6587\u7ae0\u72b6\u6001\u4e3a8 updateWmNews ( wmNews , ( short ) 8 , \"\u5ba1\u6838\u901a\u8fc7\uff0c\u5f85\u53d1\u5e03\" ); return ; } //5.\u5ba1\u6838\u901a\u8fc7\uff0c\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u72b6\u6001\u4e3a9 \u4fdd\u5b58app\u7aef\u76f8\u5173\u6587\u7ae0\u4fe1\u606f saveAppArticle ( wmNews ); /** * \u654f\u611f\u8bcd\u5ba1\u6838 * * @param content * @param wmNews * @return */ private boolean handleSensitive ( String content , WmNews wmNews ) { boolean flag = true ; List < String > allSensitive = adSensitiveMapper . findAllSensitive (); //\u521d\u59cb\u5316\u654f\u611f\u8bcd\uff0c\u5c06\u654f\u611f\u8bcd\u653e\u5230\u9759\u6001map\u4e2d SensitiveWordUtil . initMap ( allSensitive ); //\u6587\u7ae0\u5185\u5bb9\u81ea\u7ba1\u7406\u654f\u611f\u8bcd\u8fc7\u6ee4 Map < String , Integer > resultMap = SensitiveWordUtil . matchWords ( content ); if ( resultMap . size () > 0 ) { log . error ( \"\u654f\u611f\u8bcd\u8fc7\u6ee4\u6ca1\u6709\u901a\u8fc7\uff0c\u5305\u542b\u4e86\u654f\u611f\u8bcd:{}\" , resultMap ); //\u627e\u5230\u4e86\u654f\u611f\u8bcd\uff0c\u5ba1\u6838\u4e0d\u901a\u8fc7 updateWmNews ( wmNews , ( short ) 2 , \"\u6587\u7ae0\u4e2d\u5305\u542b\u4e86\u654f\u611f\u8bcd\" ); flag = false ; } return flag ; } \u4f18\u5316\uff1a\u4fdd\u8bc1\u521d\u59cb\u5316\u52a8\u4f5c\u4e0d\u91cd\u590d\u6267\u884c\uff0c\u5e76\u4e14\u7ebf\u7a0b\u5b89\u5168 \u00b6 package com.heima.utils.common ; import java.util.* ; import java.util.concurrent.ConcurrentHashMap ; import java.util.concurrent.atomic.AtomicBoolean ; import java.util.concurrent.locks.Lock ; import java.util.concurrent.locks.ReadWriteLock ; import java.util.concurrent.locks.ReentrantReadWriteLock ; public class SensitiveWordUtil { //\u5224\u65ad\u662f\u5426\u521d\u59cb\u5316\u4e86 public static AtomicBoolean isInit = new AtomicBoolean ( false ); public static Map < String , Object > dictionaryMap = new HashMap <> (); //\u6dfb\u52a0\u8bfb\u5199\u9501 public static ReadWriteLock readWriteLock = new ReentrantReadWriteLock (); //\u8bfb\u9501\u5224\u65ad\u662f\u5426\u521b\u5efa public static boolean needToInit (){ Lock lock = readWriteLock . readLock (); try { return isInit . get (); } finally { lock . unlock (); } } /** * \u751f\u6210\u5173\u952e\u8bcd\u5b57\u5178\u5e93 * //\u51b0\u6bd2\u3001\u5927\u9ebb\u3001\u5927\u574f\u86cb * * @param words * @return */ public static void initMap ( Collection < String > words ) { Lock lock = readWriteLock . writeLock (); try { lock . lock (); if ( isInit . get ()){ //\u5df2\u7ecf\u88ab\u521b\u5efa,\u76f4\u63a5\u8fd4\u56de return ; } if ( words == null ) { System . out . println ( \"\u654f\u611f\u8bcd\u5217\u8868\u4e0d\u80fd\u4e3a\u7a7a\" ); return ; } // map\u521d\u59cb\u957f\u5ea6words.size()\uff0c\u6574\u4e2a\u5b57\u5178\u5e93\u7684\u5165\u53e3\u5b57\u6570(\u5c0f\u4e8ewords.size()\uff0c\u56e0\u4e3a\u4e0d\u540c\u7684\u8bcd\u53ef\u80fd\u4f1a\u6709\u76f8\u540c\u7684\u9996\u5b57) Map < String , Object > map = new HashMap <> ( words . size ()); // \u904d\u5386\u8fc7\u7a0b\u4e2d\u5f53\u524d\u5c42\u6b21\u7684\u6570\u636e Map < String , Object > curMap = null ; Iterator < String > iterator = words . iterator (); while ( iterator . hasNext ()) { //\u51b0\u6bd2 String word = iterator . next (); curMap = map ; int len = word . length (); for ( int i = 0 ; i < len ; i ++ ) { // \u904d\u5386\u6bcf\u4e2a\u8bcd\u7684\u5b57 String key = String . valueOf ( word . charAt ( i )); // \u5f53\u524d\u5b57\u5728\u5f53\u524d\u5c42\u662f\u5426\u5b58\u5728, \u4e0d\u5b58\u5728\u5219\u65b0\u5efa, \u5f53\u524d\u5c42\u6570\u636e\u6307\u5411\u4e0b\u4e00\u4e2a\u8282\u70b9, \u7ee7\u7eed\u5224\u65ad\u662f\u5426\u5b58\u5728\u6570\u636e Map < String , Object > wordMap = ( Map < String , Object > ) curMap . get ( key ); if ( wordMap == null ) { // \u6bcf\u4e2a\u8282\u70b9\u5b58\u5728\u4e24\u4e2a\u6570\u636e: \u4e0b\u4e00\u4e2a\u8282\u70b9\u548cisEnd(\u662f\u5426\u7ed3\u675f\u6807\u5fd7) wordMap = new HashMap <> ( 2 ); wordMap . put ( \"isEnd\" , \"0\" ); curMap . put ( key , wordMap ); } curMap = wordMap ; // \u5982\u679c\u5f53\u524d\u5b57\u662f\u8bcd\u7684\u6700\u540e\u4e00\u4e2a\u5b57\uff0c\u5219\u5c06isEnd\u6807\u5fd7\u7f6e1 if ( i == len - 1 ) { curMap . put ( \"isEnd\" , \"1\" ); } } } dictionaryMap = map ; isInit . compareAndSet ( false , true ); } catch ( Exception e ){ e . printStackTrace (); } finally { lock . unlock (); } } /** * \u641c\u7d22\u6587\u672c\u4e2d\u67d0\u4e2a\u6587\u5b57\u662f\u5426\u5339\u914d\u5173\u952e\u8bcd * * @param text * @param beginIndex * @return */ private static int checkWord ( String text , int beginIndex ) { Lock lock = readWriteLock . readLock (); //\u5339\u914d\u5230\u7684\u654f\u611f\u5b57\u7684\u4e2a\u6570\uff0c\u4e5f\u5c31\u662f\u654f\u611f\u8bcd\u957f\u5ea6 int length = 0 ; try { lock . lock (); //\u654f\u611f\u8bcd\u7ed3\u675f\u6807\u8bc6\u4f4d\uff1a\u7528\u4e8e\u654f\u611f\u8bcd\u53ea\u67091\u4f4d\u7684\u60c5\u51b5 boolean flag = false ; //\u4ece\u6839Map\u5f00\u59cb\u67e5\u627e Map nowMap = dictionaryMap ; for ( int i = beginIndex ; i < text . length (); i ++ ) { //\u88ab\u5224\u65ad\u8bed\u53e5\u7684\u7b2ci\u4e2a\u5b57\u7b26\u5f00\u59cb String key = String . valueOf ( text . charAt ( i )); //\u83b7\u53d6\u6307\u5b9akey\uff0c\u5e76\u4e14\u5c06\u654f\u611f\u5e93\u6307\u9488\u6307\u5411\u4e0b\u7ea7map nowMap = ( Map ) nowMap . get ( key ); if ( nowMap != null ) { //\u5b58\u5728\uff0c\u5219\u5224\u65ad\u662f\u5426\u4e3a\u6700\u540e\u4e00\u4e2a //\u627e\u5230\u76f8\u5e94key\uff0c\u5339\u914d\u957f\u5ea6+1 length ++ ; //\u5982\u679c\u4e3a\u6700\u540e\u4e00\u4e2a\u5339\u914d\u89c4\u5219,\u7ed3\u675f\u5faa\u73af\uff0c\u8fd4\u56de\u5339\u914d\u6807\u8bc6\u6570 if ( \"1\" . equals ( nowMap . get ( \"isEnd\" ))) { //\u7ed3\u675f\u6807\u5fd7\u4f4d\u4e3atrue flag = true ; } } else { //\u654f\u611f\u5e93\u4e0d\u5b58\u5728\uff0c\u76f4\u63a5\u4e2d\u65ad break ; } } if ( length < 2 || ! flag ) { //\u957f\u5ea6\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e1\u624d\u7b97\u662f\u8bcd\uff0c\u5b57\u7684\u8bdd\u5c31\u4e0d\u5fc5\u8fd9\u4e48\u6298\u817e\u4e86 length = 0 ; } } catch ( Exception e ){ e . printStackTrace (); } finally { lock . unlock (); return length ; } } /** * \u83b7\u53d6\u5339\u914d\u7684\u5173\u952e\u8bcd\u548c\u547d\u4e2d\u6b21\u6570 * * @param text * @return */ public static Map < String , Integer > matchWords ( String text ) { Map < String , Integer > wordMap = new HashMap <> (); int len = text . length (); for ( int i = 0 ; i < len ; i ++ ) { int wordLength = checkWord ( text , i ); if ( wordLength > 0 ) { String word = text . substring ( i , i + wordLength ); // \u6dfb\u52a0\u5173\u952e\u8bcd\u5339\u914d\u6b21\u6570 if ( wordMap . containsKey ( word )) { wordMap . put ( word , wordMap . get ( word ) + 1 ); } else { wordMap . put ( word , 1 ); } i += wordLength - 1 ; } } return wordMap ; } public static void main ( String [] args ) { List < String > list = new ArrayList <> (); list . add ( \"\u51b0\u6bd2\" ); list . add ( \"\u8fdd\u6cd5\" ); initMap ( list ); String content = \"\u6211\u662f\u4e00\u4e2a\u597d\u4eba\uff0c\u4e70\u5356\u51b0\u6bd2\u662f\u8fdd\u6cd5\u7684\u51b0\u6bd2\" ; Map < String , Integer > map = matchWords ( content ); System . out . println ( map ); } } \u5224\u65ad\u4e00\u4e0b\uff0c\u662f\u5426\u9700\u8981\u521d\u59cb\u5316 /** * \u654f\u611f\u8bcd\u5ba1\u6838 * * @param content * @param wmNews * @return */ private boolean handleSensitive ( String content , WmNews wmNews ) { boolean flag = true ; if ( SensitiveWordUtil . needToInit ()){ List < String > allSensitive = adSensitiveMapper . findAllSensitive (); //\u521d\u59cb\u5316\u654f\u611f\u8bcd\uff0c\u5c06\u654f\u611f\u8bcd\u653e\u5230\u9759\u6001map\u4e2d SensitiveWordUtil . initMap ( allSensitive ); } //\u6587\u7ae0\u5185\u5bb9\u81ea\u7ba1\u7406\u654f\u611f\u8bcd\u8fc7\u6ee4 Map < String , Integer > resultMap = SensitiveWordUtil . matchWords ( content ); if ( resultMap . size () > 0 ) { log . error ( \"\u654f\u611f\u8bcd\u8fc7\u6ee4\u6ca1\u6709\u901a\u8fc7\uff0c\u5305\u542b\u4e86\u654f\u611f\u8bcd:{}\" , resultMap ); //\u627e\u5230\u4e86\u654f\u611f\u8bcd\uff0c\u5ba1\u6838\u4e0d\u901a\u8fc7 updateWmNews ( wmNews , ( short ) 2 , \"\u6587\u7ae0\u4e2d\u5305\u542b\u4e86\u654f\u611f\u8bcd\" ); flag = false ; } return flag ; } \u5728\u8bfb\u5199\u65f6\u8fdb\u884c\u52a0\u9501\u3002 \u53e6\u5916\uff0c\u540e\u671f\u5982\u679c\u8981\u5b8c\u6210\u654f\u611f\u8bcd\u6539\u52a8\u4e4b\u540e\u8ba9\u5185\u5b58\u4e2d\u7684map\u80fd\u591f\u5237\u65b0\uff0c\u53ef\u4ee5\u4f7f\u7528kafka\u63a8\u9001\u6d88\u606f\u7684\u6a21\u5f0f\uff0c\u6267\u884cinitMap\u5373\u53ef\u505a\u5230\u5237\u65b0\u3002\u7531\u4e8e\u5728initMap\u4e2d\u6dfb\u52a0\u4e86\u5199\u9501\uff0c\u6b64\u65f6\u5176\u4ed6\u8bfb\u9501\u5c31\u4f1a\u7b49\u5f85\u5237\u65b0\u5b8c\u6210\u3002 14-\u4fdd\u5b58APP\u6587\u7ae0\u6570\u636e 12:05 \u00b6 //5.\u5ba1\u6838\u901a\u8fc7\uff0c\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u72b6\u6001\u4e3a9 \u4fdd\u5b58app\u7aef\u76f8\u5173\u6587\u7ae0\u4fe1\u606f saveAppArticle ( wmNews ); /** * \u4fdd\u5b58\u6587\u7ae0 * @param wmNews * @return */ private ApArticle saveArticle ( WmNews wmNews ) { ApArticle apArticle = new ApArticle (); apArticle . setTitle ( wmNews . getTitle ()); //\u6587\u7ae0\u5e03\u5c40 0 \u65e0\u56fe\u6587\u7ae0 1 \u5355\u56fe\u6587\u7ae0 2 \u591a\u56fe\u6587\u7ae0 apArticle . setLayout ( wmNews . getType ()); apArticle . setImages ( wmNews . getImages ()); apArticle . setCreatedTime ( new Date ()); //\u83b7\u53d6\u4f5c\u8005\u76f8\u5173\u4fe1\u606f Integer wmUserId = wmNews . getUserId (); //\u901a\u8fc7feign\u670d\u52a1\u67e5\u8be2\u81ea\u5a92\u4f53\u4eba WmUser wmUser = wemediaFeign . findWmUserById ( wmUserId ); if ( wmUser != null ){ //\u83b7\u53d6\u81ea\u5a92\u4f53\u7528\u6237\u4e2d\u7684\u540d\u5b57 String wmUserName = wmUser . getName (); //\u6839\u636e\u81ea\u5a92\u4f53\u7528\u6237\u540d\u5b57\uff0c\u901a\u8fc7feign\u63a5\u53e3\u83b7\u53d6\u4f5c\u8005\u4fe1\u606f ApAuthor apAuthor = articleFeign . selectAuthorByName ( wmUserName ); if ( apAuthor != null ){ apArticle . setAuthorId ( apAuthor . getId (). longValue ()); apArticle . setAuthorName ( apAuthor . getName ()); } } //\u83b7\u53d6\u9891\u9053\u76f8\u5173\u4fe1\u606f Integer channelId = wmNews . getChannelId (); AdChannel channel = adChannelMapper . selectById ( channelId ); if ( channel != null ){ apArticle . setChannelId ( channel . getId ()); apArticle . setChannelName ( channel . getName ()); } return articleFeign . saveAparticle ( apArticle ); } 15-\u4fdd\u5b58APP\u6587\u7ae0\u914d\u7f6e\u548c\u5185\u5bb9 05:11 \u00b6 /** * \u4fdd\u5b58app\u6587\u7ae0\u76f8\u5173\u7684\u6570\u636e * * @param wmNews */ private void saveAppArticle ( WmNews wmNews ) { //\u4fdd\u5b58app\u6587\u7ae0 ApArticle apArticle = saveArticle ( wmNews ); //\u4fdd\u5b58app\u6587\u7ae0\u914d\u7f6e saveArticleConfig ( apArticle ); //\u4fdd\u5b58app\u6587\u7ae0\u5185\u5bb9 saveArticleContent ( apArticle , wmNews ); //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\u4e3a9 wmNews . setArticleId ( apArticle . getId (). intValue ()); updateWmNews ( wmNews ,( short ) 9 , \"\u5ba1\u6838\u901a\u8fc7\" ); //TODO es\u7d22\u5f15\u521b\u5efa } /** * \u521b\u5efaapp\u7aef\u6587\u7ae0\u914d\u7f6e\u4fe1\u606f * @param apArticle */ private void saveArticleConfig ( ApArticle apArticle ) { ApArticleConfig apArticleConfig = new ApArticleConfig (); apArticleConfig . setArticleId ( apArticle . getId ()); //\u53ef\u4ee5\u8f6c\u53d1 apArticleConfig . setIsForward ( true ); //\u672a\u88ab\u5220\u9664 apArticleConfig . setIsDelete ( false ); //\u5df2\u4e0b\u67b6 apArticleConfig . setIsDown ( true ); //\u53ef\u4ee5\u8bc4\u8bba apArticleConfig . setIsComment ( true ); articleFeign . saveArticleConfig ( apArticleConfig ); } /** * \u521b\u5efaapp\u7aef\u6587\u7ae0\u5185\u5bb9\u4fe1\u606f * @param apArticle * @param wmNews */ private void saveArticleContent ( ApArticle apArticle , WmNews wmNews ) { ApArticleContent apArticleContent = new ApArticleContent (); apArticleContent . setArticleId ( apArticle . getId ()); apArticleContent . setContent ( wmNews . getContent ()); articleFeign . saveArticleContent ( apArticleContent ); } 16-\u6d4b\u8bd5 15:16 \u00b6 package com.heima.admin.test ; import com.heima.admin.AdminApplication ; import com.heima.admin.service.WemediaNewsAutoScanService ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @SpringBootTest ( classes = AdminApplication . class ) @RunWith ( SpringRunner . class ) public class WemediaNewsAutoScanServiceTest { @Autowired private WemediaNewsAutoScanService wemediaNewsAutoScanService ; @Test public void testScanNews (){ wemediaNewsAutoScanService . autoScanByMediaNewsId ( 6164 ); } } 17-\u53d1\u5e03\u6587\u7ae0\u63d0\u4ea4\u5ba1\u6838 12:25 \u00b6 wmnews\u7684service: /** * \u4fdd\u5b58\u6216\u4fee\u6539\u6587\u7ae0 * * @param wmNews * @param isSubmit */ private void saveWmNews ( WmNews wmNews , Short isSubmit ) { wmNews . setStatus ( isSubmit ); wmNews . setUserId ( WmThreadLocalUtils . getUser (). getId ()); wmNews . setCreatedTime ( new Date ()); wmNews . setSubmitedTime ( new Date ()); wmNews . setEnable (( short ) 1 ); boolean flag = false ; if ( wmNews . getId () == null ) { flag = save ( wmNews ); } else { //\u5982\u679c\u662f\u4fee\u6539\uff0c\u5219\u5148\u5220\u9664\u7d20\u6750\u4e0e\u6587\u7ae0\u7684\u5173\u7cfb LambdaQueryWrapper < WmNewsMaterial > queryWrapper = new LambdaQueryWrapper (); queryWrapper . eq ( WmNewsMaterial :: getNewsId , wmNews . getId ()); wmNewsMaterialMapper . delete ( queryWrapper ); flag = updateById ( wmNews ); } //\u53d1\u9001\u6d88\u606f if ( flag ){ kafkaTemplate . send ( NewsAutoScanConstants . WM_NEWS_AUTO_SCAN_TOPIC , JSON . toJSONString ( wmNews . getId ())); } } admin\u7684kafka\u6d88\u8d39\u8005: package com.heima.admin.kafka.listener ; import com.heima.admin.service.WemediaNewsAutoScanService ; import com.heima.common.constans.message.NewsAutoScanConstants ; import org.apache.kafka.clients.consumer.ConsumerRecord ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.kafka.annotation.KafkaListener ; import org.springframework.stereotype.Component ; import java.util.Optional ; @Component public class WemediaNewsAutoListener { @Autowired WemediaNewsAutoScanService wemediaNewsAutoScanService ; @KafkaListener ( topics = NewsAutoScanConstants . WM_NEWS_AUTO_SCAN_TOPIC ) public void recevieMessage ( ConsumerRecord <? , ?> record ){ Optional <? extends ConsumerRecord <? , ?>> optional = Optional . ofNullable ( record ); if ( optional . isPresent ()){ Object value = record . value (); wemediaNewsAutoScanService . autoScanByMediaNewsId ( Integer . valueOf (( String ) value )); } } } 18-\u7efc\u5408\u6d4b\u8bd5 03:30 \u00b6","title":"day07"},{"location":"hmtt/day07/#01-_0051","text":"\u80fd\u591f\u638c\u63e1\u81ea\u5a92\u4f53\u6587\u7ae0\u5ba1\u6838\u7684\u6d41\u7a0b \u80fd\u591f\u4f7f\u7528\u963f\u91cc\u4e91\u5b89\u5168\u670d\u52a1\u68c0\u6d4b\u6587\u7ae0\u5185\u5bb9 \u80fd\u591f\u5b8c\u6210\u81ea\u5a92\u4f53\u6587\u7ae0\u5ba1\u6838\u7684\u529f\u80fd \u80fd\u591f\u5b8c\u6210\u81ea\u5a92\u4f53\u53d1\u5e03\u6587\u7ae0\u4e0e\u5ba1\u6838\u5bf9\u63a5","title":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 00:51"},{"location":"hmtt/day07/#02-_1234","text":"status\u5b57\u6bb5\uff1a0 \u8349\u7a3f 1 \u5f85\u5ba1\u6838 2 \u5ba1\u6838\u5931\u8d25 3 \u4eba\u5de5\u5ba1\u6838 4 \u4eba\u5de5\u5ba1\u6838\u901a\u8fc7 8 \u5ba1\u6838\u901a\u8fc7\uff08\u5f85\u53d1\u5e03\uff09 9 \u5df2\u53d1\u5e03","title":"02-\u81ea\u52a8\u5ba1\u6838\u9700\u6c42\u8bf4\u660e 12\uff1a34"},{"location":"hmtt/day07/#03-_0853","text":"wm_news \u81ea\u5a92\u4f53\u6587\u7ae0\u8868 \u5728\u81ea\u5a92\u4f53\u5e93 ap_author \u6587\u7ae0\u4f5c\u8005\u8868 \u5728article\u5e93 ap_article \u6587\u7ae0\u4fe1\u606f\u8868 \u5728article\u5e93 layout \u6587\u7ae0\u5e03\u5c40 0 \u65e0\u56fe\u6587\u7ae0 1 \u5355\u56fe\u6587\u7ae0 2 \u591a\u56fe\u6587\u7ae0 flag \u6587\u7ae0\u6807\u8bb0 0 \u666e\u901a\u6587\u7ae0 1 \u70ed\u70b9\u6587\u7ae0 2 \u7f6e\u9876\u6587\u7ae0 3 \u7cbe\u54c1\u6587\u7ae0 4 \u5927V \u6587\u7ae0 images \u6587\u7ae0\u56fe\u7247 \u591a\u5f20\u9017\u53f7\u5206\u9694 ap_article_content \u6587\u7ae0\u5185\u5bb9\u8868 \u5728article\u5e93 ap_article \u548cap_article_content \u662f\u4e00\u5bf9\u4e00\u7684\u5173\u7cfb ap_article_config \u6587\u7ae0\u914d\u7f6e\u8868 \u5728article\u5e93 ap_article \u548cap_article_config \u662f\u4e00\u5bf9\u4e00\u7684\u5173\u7cfb","title":"03-\u8868\u7ed3\u6784\u5206\u6790 08:53"},{"location":"hmtt/day07/#04-_1236","text":"\u5728\u81ea\u52a8\u5ba1\u6838\u7684\u65f6\u5019\u9700\u8981\u81ea\u5a92\u4f53\u7684\u8fdc\u7a0b\u63a5\u53e3\uff0c\u5982\u4e0b\uff1a 1 \u6839\u636e\u6587\u7ae0id\u67e5\u8be2\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u6570\u636e 2 \u5728\u5ba1\u6838\u7684\u8fc7\u7a0b\u4e2d,\u5ba1\u6838\u5931\u8d25\u6216\u8005\u6210\u529f\u9700\u8981\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001 3 \u5728\u6587\u7ae0\u8fdb\u884c\u4fdd\u5b58\u7684\u65f6\u5019\u9700\u8981\u67e5\u8be2\u4f5c\u8005\u4fe1\u606f\uff0c\u9700\u8981\u901a\u8fc7\u81ea\u5a92\u4f53\u7528\u6237\u5173\u8054\u67e5\u8be2\u4f5c\u8005\u4fe1\u606f admin\u670d\u52a1\u8c03\u7528wemedia\u670d\u52a1\uff0c\u63a5\u53e3\u8c03\u7528\u5c5e\u4e8e\u5185\u90e8\u8c03\u7528\uff0c\u65e0\u9700\u8d70\u7f51\u5173\u3002 package com.heima.admin.feign ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.wemedia.pojos.WmNews ; import com.heima.model.wemedia.pojos.WmUser ; import org.springframework.cloud.openfeign.FeignClient ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.PathVariable ; import org.springframework.web.bind.annotation.PostMapping ; @FeignClient ( \"leadnews-wemedia\" ) public interface WemediaFeign { /** * \u6839\u636eid\u67e5\u8be2\u6587\u7ae0\u4fe1\u606f * @param id \u6587\u7ae0ID * @return \u6587\u7ae0\u4fe1\u606f */ @GetMapping ( \"/api/v1/news/findOne/{id}\" ) public WmNews findById ( @PathVariable ( \"id\" ) Integer id ); /** * \u66f4\u65b0\u6587\u7ae0\u4fe1\u606f * @param wmNews \u6587\u7ae0\u5bf9\u8c61 * @return */ @PostMapping ( \"/api/v1/news/update\" ) public ResponseResult updateWmNews ( WmNews wmNews ); /** *\u6839\u636e\u6587\u7ae0\u4f5c\u8005ID\u83b7\u53d6\u4f5c\u8005\u4fe1\u606f * @param id \u6587\u7ae0\u4f5c\u8005ID * @return \u6587\u7ae0\u4f5c\u8005ID */ @GetMapping ( \"/api/v1/user/findOne/{id}\" ) public WmUser findWmUserById ( @PathVariable ( \"id\" ) Integer id ); } package com.heima.wemedia.controller.v1 ; import com.heima.apis.wemedia.WmNewsControllerApi ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.wemedia.dtos.WmNewsDto ; import com.heima.model.wemedia.dtos.WmNewsPageReqDto ; import com.heima.model.wemedia.pojos.WmNews ; import com.heima.wemedia.service.WmNewsService ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.* ; @RestController @RequestMapping ( \"/api/v1/news\" ) public class WmNewsController implements WmNewsControllerApi { @Autowired private WmNewsService wmNewsService ; @PostMapping ( \"/list\" ) @Override public ResponseResult findAll ( @RequestBody WmNewsPageReqDto dto ) { return wmNewsService . findAll ( dto ); } @PostMapping ( \"/submit\" ) @Override public ResponseResult submitNews ( @RequestBody WmNewsDto dto ) { if ( dto . getStatus () == WmNews . Status . SUBMIT . getCode ()){ return wmNewsService . saveNews ( dto , WmNews . Status . SUBMIT . getCode ()); } else { return wmNewsService . saveNews ( dto , WmNews . Status . NORMAL . getCode ()); } } @GetMapping ( \"/one/{id}\" ) @Override public ResponseResult findWmNewsById ( @PathVariable ( \"id\" ) Integer id ) { return wmNewsService . findWmNewsById ( id ); } @GetMapping ( \"/del_news/{id}\" ) @Override public ResponseResult delNews ( @PathVariable ( \"id\" ) Integer id ) { return wmNewsService . delNews ( id ); } @PostMapping ( \"/down_or_up\" ) @Override public ResponseResult downOrUp ( @RequestBody WmNewsDto dto ) { return wmNewsService . downOrUp ( dto ); } @GetMapping ( \"/findOne/{id}\" ) @Override public WmNews findById ( @PathVariable ( \"id\" ) Integer id ) { return wmNewsService . getById ( id ); } @PostMapping ( \"/update\" ) @Override public ResponseResult updateWmNews ( @RequestBody WmNews wmNews ) { boolean b = wmNewsService . updateById ( wmNews ); return b ? ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ): ResponseResult . errorResult ( AppHttpCodeEnum . SERVER_ERROR ); } } package com.heima.wemedia.controller.v1 ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.apis.wemedia.WmUserControllerApi ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.wemedia.pojos.WmUser ; import com.heima.wemedia.service.WmUserService ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.* ; import java.util.List ; @RestController @RequestMapping ( \"/api/v1/user\" ) public class WmUserController implements WmUserControllerApi { @Autowired private WmUserService wmUserService ; @PostMapping ( \"/save\" ) @Override public ResponseResult save ( @RequestBody WmUser wmUser ) { wmUserService . save ( wmUser ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } @GetMapping ( \"/findByName/{name}\" ) @Override public WmUser findByName ( @PathVariable ( \"name\" ) String name ) { List < WmUser > list = wmUserService . list ( Wrappers . < WmUser > lambdaQuery (). eq ( WmUser :: getName , name )); if ( list != null && ! list . isEmpty ()){ return list . get ( 0 ); } return null ; } @GetMapping ( \"/findOne/{id}\" ) @Override public WmUser findWmUserById ( @PathVariable ( \"id\" ) Integer id ) { return wmUserService . getById ( id ); } }","title":"04-\u81ea\u5a92\u4f53\u63a5\u53e3 12:36"},{"location":"hmtt/day07/#05-_0713","text":"1.redis\u81ea\u589e,incr\u547d\u4ee4 2.\u7f8e\u56e2leaf\u6846\u67b6->mysql\u4e2d\u5b58\u50a8id\u8868 3.\u96ea\u82b1\u7b97\u6cd5 4.UUID\u751f\u6210\u968f\u673a\u5b57\u7b26\u4e32 \u5206\u5e03\u5f0fid \u968f\u7740\u4e1a\u52a1\u7684\u589e\u957f\uff0c\u6587\u7ae0\u8868\u53ef\u80fd\u8981\u5360\u7528\u5f88\u5927\u7684\u7269\u7406\u5b58\u50a8\u7a7a\u95f4\uff0c\u4e3a\u4e86\u89e3\u51b3\u8be5\u95ee\u9898\uff0c\u540e\u671f\u4f7f\u7528\u6570\u636e\u5e93\u5206\u7247\u6280\u672f\u3002\u5c06\u4e00\u4e2a\u6570\u636e\u5e93\u8fdb\u884c\u62c6\u5206\uff0c\u901a\u8fc7\u6570\u636e\u5e93\u4e2d\u95f4\u4ef6\u8fde\u63a5\u3002\u5982\u679c\u6570\u636e\u5e93\u4e2d\u8be5\u8868\u9009\u7528ID\u81ea\u589e\u7b56\u7565\uff0c\u5219\u53ef\u80fd\u4ea7\u751f\u91cd\u590d\u7684ID\uff0c\u6b64\u65f6\u5e94\u8be5\u4f7f\u7528\u5206\u5e03\u5f0fID\u751f\u6210\u7b56\u7565\u6765\u751f\u6210ID\u3002 \u96ea\u82b1\u7b97\u6cd5\u5b9e\u73b0 snowflake\u662fTwitter\u5f00\u6e90\u7684\u5206\u5e03\u5f0fID\u751f\u6210\u7b97\u6cd5\uff0c\u7ed3\u679c\u662f\u4e00\u4e2along\u578b\u7684ID\u3002\u5176\u6838\u5fc3\u601d\u60f3\u662f\uff1a\u4f7f\u752841bit\u4f5c\u4e3a\u6beb\u79d2\u6570\uff0c10bit\u4f5c\u4e3a\u673a\u5668\u7684ID\uff085\u4e2abit\u662f\u6570\u636e\u4e2d\u5fc3\uff0c5\u4e2abit\u7684\u673a\u5668ID\uff09\uff0c12bit\u4f5c\u4e3a\u6beb\u79d2\u5185\u7684\u6d41\u6c34\u53f7\uff08\u610f\u5473\u7740\u6bcf\u4e2a\u8282\u70b9\u5728\u6bcf\u6beb\u79d2\u53ef\u4ee5\u4ea7\u751f 4096 \u4e2a ID\uff09\uff0c\u6700\u540e\u8fd8\u6709\u4e00\u4e2a\u7b26\u53f7\u4f4d\uff0c\u6c38\u8fdc\u662f0 mybatis-plus\u5df2\u7ecf\u96c6\u6210\u4e86\u96ea\u82b1\u7b97\u6cd5\uff0c\u5b8c\u6210\u4ee5\u4e0b\u4e24\u6b65\u5373\u53ef\u5728\u9879\u76ee\u4e2d\u96c6\u6210\u96ea\u82b1\u7b97\u6cd5 \u7b2c\u4e00\uff1a\u5728\u5b9e\u4f53\u7c7b\u4e2d\u7684id\u4e0a\u52a0\u5165\u5982\u4e0b\u914d\u7f6e\uff0c\u6307\u5b9a\u7c7b\u578b\u4e3aid_worker @TableId ( value = \"id\" , type = IdType . ID_WORKER ) private Long id ; \u7b2c\u4e8c\uff1a\u5728application.yml\u6587\u4ef6\u4e2d\u914d\u7f6e\u6570\u636e\u4e2d\u5fc3id\u548c\u673a\u5668id mybatis-plus : mapper-locations : classpath*:mapper/*.xml # \u8bbe\u7f6e\u522b\u540d\u5305\u626b\u63cf\u8def\u5f84\uff0c\u901a\u8fc7\u8be5\u5c5e\u6027\u53ef\u4ee5\u7ed9\u5305\u4e2d\u7684\u7c7b\u6ce8\u518c\u522b\u540d type-aliases-package : com.heima.model.article.pojos global-config : datacenter-id : 1 workerId : 1 datacenter-id:\u6570\u636e\u4e2d\u5fc3id(\u53d6\u503c\u8303\u56f4\uff1a0-31) workerId:\u673a\u5668id(\u53d6\u503c\u8303\u56f4\uff1a0-31)","title":"05-\u96ea\u82b1\u7b97\u6cd5 07:13"},{"location":"hmtt/day07/#_1","text":"\u65f6\u95f4\u56de\u62e8\u95ee\u9898\uff1a\u7531\u4e8e\u673a\u5668\u7684\u65f6\u95f4\u662f\u52a8\u6001\u7684\u8c03\u6574\u7684\uff0c\u6709\u53ef\u80fd\u4f1a\u51fa\u73b0\u65f6\u95f4\u8dd1\u5230\u4e4b\u524d\u51e0\u6beb\u79d2\uff0c\u5982\u679c\u8fd9\u4e2a\u65f6\u5019\u83b7\u53d6\u5230\u4e86\u8fd9\u79cd\u65f6\u95f4\uff0c\u5219\u4f1a\u51fa\u73b0\u6570\u636e\u91cd\u590d \u673a\u5668id\u5206\u914d\u53ca\u56de\u6536\u95ee\u9898\uff1a\u76ee\u524d\u673a\u5668id\u9700\u8981\u6bcf\u53f0\u673a\u5668\u4e0d\u4e00\u6837\uff0c\u8fd9\u6837\u7684\u65b9\u5f0f\u5206\u914d\u9700\u8981\u6709\u65b9\u6848\u8fdb\u884c\u5904\u7406\uff0c\u540c\u65f6\u4e5f\u8981\u8003\u8651\uff0c\u5982\u679c\u6539\u673a\u5668\u5b95\u673a\u4e86\uff0c\u5bf9\u5e94\u7684workerId\u5206\u914d\u540e\u7684\u56de\u6536\u95ee\u9898 \u673a\u5668id\u4e0a\u9650\uff1a\u673a\u5668id\u662f\u56fa\u5b9a\u7684bit\uff0c\u90a3\u4e48\u4e5f\u5c31\u662f\u5bf9\u5e94\u7684\u673a\u5668\u4e2a\u6570\u662f\u6709\u4e0a\u9650\u7684\uff0c\u5728\u6709\u4e9b\u4e1a\u52a1\u573a\u666f\u4e0b\uff0c\u9700\u8981\u6240\u6709\u673a\u5668\u5171\u4eab\u540c\u4e00\u4e2a\u4e1a\u52a1\u7a7a\u95f4\uff0c\u90a3\u4e4810bit\u8868\u793a\u76841024\u53f0\u673a\u5668\u662f\u4e0d\u591f\u7684\u3002","title":"\u5b58\u5728\u7684\u95ee\u9898"},{"location":"hmtt/day07/#06-_0458","text":"admin\u670d\u52a1\u8c03\u7528article\u670d\u52a1 package com.heima.admin.feign ; import com.heima.model.article.pojos.ApArticle ; import com.heima.model.article.pojos.ApArticleConfig ; import com.heima.model.article.pojos.ApArticleContent ; import com.heima.model.article.pojos.ApAuthor ; import com.heima.model.common.dtos.ResponseResult ; import org.springframework.cloud.openfeign.FeignClient ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.PathVariable ; import org.springframework.web.bind.annotation.PostMapping ; @FeignClient ( \"leadnews-article\" ) public interface ArticleFeign { /** * \u4fdd\u5b58\u6587\u7ae0\u6570\u636e * @param apArticle \u6587\u7ae0\u5bf9\u8c61 * @return */ @PostMapping ( \"/api/v1/article/save\" ) public ApArticle saveAparticle ( ApArticle apArticle ); /** * \u4fdd\u5b58\u6587\u7ae0\u914d\u7f6e\u5bf9\u8c61 * @param apArticleConfig \u6587\u7ae0\u914d\u7f6e\u5bf9\u8c61 * @return */ @PostMapping ( \"/api/v1/article_config/save\" ) public ResponseResult saveArticleConfig ( ApArticleConfig apArticleConfig ); /** * \u4fdd\u5b58\u6587\u7ae0\u5185\u5bb9\u6570\u636e * @param apArticleContent \u6587\u7ae0\u5185\u5bb9 * @return */ @PostMapping ( \"/api/v1/article_content/save\" ) public ResponseResult saveArticleContent ( ApArticleContent apArticleContent ); /** * \u6839\u636e\u540d\u5b57\u67e5\u8be2\u4f5c\u8005 * @param name \u540d\u5b57 * @return */ @GetMapping ( \"/api/v1/author/findByName/{name}\" ) public ApAuthor selectAuthorByName ( @PathVariable ( \"name\" ) String name ); }","title":"06-\u6587\u7ae0\u63a5\u53e3\u5b9a\u4e49 04:58"},{"location":"hmtt/day07/#07-_1638","text":"AuthorController: package com.heima.article.controller.v1 ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.apis.article.AuthorControllerApi ; import com.heima.article.service.AuthorService ; import com.heima.model.article.pojos.ApAuthor ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.* ; import java.util.List ; @RestController @RequestMapping ( \"/api/v1/author\" ) public class AuthorController implements AuthorControllerApi { @Autowired AuthorService authorService ; @GetMapping ( \"/findByUserId/{id}\" ) @Override public ApAuthor findByUserId ( @PathVariable ( \"id\" ) Integer id ) { List < ApAuthor > list = authorService . list ( Wrappers . < ApAuthor > lambdaQuery (). eq ( ApAuthor :: getUserId , id )); if ( list != null && ! list . isEmpty ()){ return list . get ( 0 ); } return null ; } @PostMapping ( \"/save\" ) @Override public ResponseResult save ( @RequestBody ApAuthor apAuthor ) { authorService . save ( apAuthor ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } @GetMapping ( \"/findByName/{name}\" ) @Override public ApAuthor selectAuthorByName ( @PathVariable ( \"name\" ) String name ) { //select * from ap_author where name = #{name} ApAuthor apAuthor = authorService . getOne ( Wrappers . < ApAuthor > lambdaQuery (). eq ( ApAuthor :: getName , name )); return apAuthor ; } } ApArticleController: package com.heima.article.controller.v1 ; import com.heima.apis.article.ApArticleControllerApi ; import com.heima.article.service.ApArticleService ; import com.heima.model.article.pojos.ApArticle ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestBody ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RestController ; @RestController @RequestMapping ( \"/api/v1/article\" ) public class ApArticleController implements ApArticleControllerApi { @Autowired private ApArticleService articleService ; @PostMapping ( \"save\" ) @Override public ApArticle saveArticle ( @RequestBody ApArticle apArticle ) { articleService . save ( apArticle ); return apArticle ; } } ApArticleContentController: package com.heima.article.controller.v1 ; import com.heima.apis.article.ApArticleContentControllerApi ; import com.heima.article.service.ApArticleContentService ; import com.heima.model.article.pojos.ApArticleContent ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestBody ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RestController ; @RestController @RequestMapping ( \"/api/v1/article_content\" ) public class ApArticleContentController implements ApArticleContentControllerApi { @Autowired private ApArticleContentService apArticleContentService ; @PostMapping ( \"/save\" ) @Override public ResponseResult saveArticleContent ( @RequestBody ApArticleContent apArticleContent ) { boolean flag = apArticleContentService . save ( apArticleContent ); return flag ? ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ) : ResponseResult . okResult ( AppHttpCodeEnum . SERVER_ERROR ); } } ApArticleConfigController: package com.heima.article.controller.v1 ; import com.heima.apis.article.ApArticleConfigControllerApi ; import com.heima.article.service.ApArticleConfigService ; import com.heima.model.article.pojos.ApArticleConfig ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestBody ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RestController ; @RestController @RequestMapping ( \"/api/v1/article_config\" ) public class ApArticleConfigController implements ApArticleConfigControllerApi { @Autowired private ApArticleConfigService apArticleConfigService ; @PostMapping ( \"/save\" ) @Override public ResponseResult saveArticleConfig ( @RequestBody ApArticleConfig apArticleConfig ) { apArticleConfigService . save ( apArticleConfig ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } }","title":"07-\u6587\u7ae0\u63a5\u53e3\u5b9e\u73b0 16:38"},{"location":"hmtt/day07/#08-fastdfs_0541","text":"\u5728admin\u5fae\u670d\u52a1\u4e2d\u52a0\u5165\u5982\u4e0b\u914d\u7f6e \u6587\u7ae0\u5ba1\u6838\u9700\u8981\u8c03\u7528\u963f\u91cc\u4e91\u670d\u52a1\u7684\u4e91\u5b89\u5168\u670d\u52a1\u6765\u5ba1\u6838\u6587\u7ae0\u548c\u56fe\u7247 package com.heima.admin.config ; import org.springframework.context.annotation.ComponentScan ; import org.springframework.context.annotation.Configuration ; @Configuration @ComponentScan ( \"com.heima.common.aliyun\" ) public class AliyunConfig { } fastdfs\u670d\u52a1\u5f15\u5165 \u5728\u963f\u91cc\u4e91\u56fe\u7247\u5ba1\u6838\u4e2d\u9700\u8981\u5c06\u56fe\u7247\u5148\u4ecefastdfs\u4e2d\u4e0b\u8f7d\u4e0b\u6765\u518d\u53bb\u5ba1\u6838\u624d\u53ef\u4ee5\uff0c\u5982\u679c\u5f53\u524dfastdfs\u662f\u4e00\u4e2a\u5916\u7f51\u53ef\u4ee5\u8bbf\u95ee\u7684\u5219\u65e0\u987b\u518d\u6b21\u4e0b\u8f7d\uff0c\u53ef\u4ee5\u76f4\u63a5\u5ba1\u6838 package com.heima.admin.config ; import org.springframework.context.annotation.ComponentScan ; import org.springframework.context.annotation.Configuration ; @Configuration @ComponentScan ( \"com.heima.common.fastdfs\" ) public class FastDfsConfig { }","title":"08-\u5f15\u5165\u963f\u91cc\u4e91\u670d\u52a1\u548cfastdfs 05:41"},{"location":"hmtt/day07/#_2","text":"\u8fd9\u91cc\u67e5\u8be2\u6240\u6709\u654f\u611f\u8bcd\u7684\u4f5c\u7528\u662f\uff0c\u5728\u53bb\u5ba1\u6838\u6587\u672c\u5185\u5bb9\u7684\u65f6\u5019\uff0c\u4ece\u4e24\u65b9\u9762\u5165\u624b\uff0c\u4e00\u4e2a\u662f\u8c03\u7528\u963f\u91cc\u4e91\u7b2c\u4e09\u65b9\u63a5\u53e3\u5ba1\u6838\u5185\u5bb9\uff0c\u53e6\u5916\u4e00\u4e2a\u662f\u7cfb\u7edf\u81ea\u5df1\u5ba1\u6838\uff0c\u4f7f\u7528\u81ea\u5df1\u7ef4\u62a4\u7684\u654f\u611f\u8bcd\u5e93\u53bb\u5339\u914d\u53d1\u5e03\u6587\u7ae0\u7684\u5185\u5bb9\u3002 \u5728admin\u5de5\u7a0b\u4e2d\u5904\u7406\uff1a\u4fee\u6539AdSensitiveMapper\uff0c\u65b0\u589e\u65b9\u6cd5\uff1afindAllSensitive @Mapper public interface AdSensitiveMapper extends BaseMapper < AdSensitive > { public List < String > findAllSensitive (); } \u65b0\u589e\u914d\u7f6e\u6587\u4ef6resources/mapper/AdSensitiveMapper.xml <?xml version=\"1.0\" encoding=\"UTF-8\"?> <!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"> <mapper namespace= \"com.heima.admin.mapper.AdSensitiveMapper\" > <select id= \"findAllSensitive\" resultType= \"string\" > select sensitives from ad_sensitive </select> </mapper>","title":"\u654f\u611f\u8bcd\u5904\u7406"},{"location":"hmtt/day07/#09-_0635","text":"package com.heima.admin.service ; public interface WemediaNewsAutoScanService { /** * \u81ea\u5a92\u4f53\u6587\u7ae0\u5ba1\u6838 * @param id \u6587\u7ae0ID */ public void autoScanByMediaNewsId ( Integer id ); } \u6b64\u65b9\u6cd5\u4f1a\u5728\u63d0\u4ea4\u5ba1\u6838\u548c\u5b9a\u65f6\u4efb\u52a1\u89e6\u53d1\u65f6\u8c03\u7528","title":"09-\u4e1a\u52a1\u5c42\u63a5\u53e3\u5b9a\u4e49 06:35"},{"location":"hmtt/day07/#10-_1740","text":"public void autoScanByMediaNewsId ( Integer id ) { if ( id == null ) { log . error ( \"\u5f53\u524d\u7684\u5ba1\u6838id\u7a7a\" ); return ; } //1.\u6839\u636eid\u67e5\u8be2\u81ea\u5a92\u4f53\u6587\u7ae0\u4fe1\u606f WmNews wmNews = wemediaFeign . findById ( id ); if ( wmNews == null ) { log . error ( \"\u5ba1\u6838\u7684\u81ea\u5a92\u4f53\u6587\u7ae0\u4e0d\u5b58\u5728\uff0c\u81ea\u5a92\u4f53\u7684id:{}\" , id ); return ; } //2.\u6587\u7ae0\u72b6\u6001\u4e3a4\uff08\u4eba\u5de5\u5ba1\u6838\u901a\u8fc7\uff09\u76f4\u63a5\u4fdd\u5b58\u6570\u636e\u548c\u521b\u5efa\u7d22\u5f15 if ( wmNews . getStatus () == 4 ) { //\u4fdd\u5b58\u6570\u636e saveAppArticle ( wmNews ); return ; } //3.\u6587\u7ae0\u72b6\u6001\u4e3a8 \u53d1\u5e03\u65f6\u95f4>\u5f53\u524d\u65f6\u95f4 \u76f4\u63a5\u4fdd\u5b58\u6570\u636e if ( wmNews . getStatus () == 8 && wmNews . getPublishTime (). getTime () <= System . currentTimeMillis ()) { //\u4fdd\u5b58\u6570\u636e saveAppArticle ( wmNews ); return ; } //4.\u6587\u7ae0\u72b6\u6001\u4e3a1\uff0c\u5f85\u5ba1\u6838 if ( wmNews . getStatus () == 1 ) { //\u62bd\u53d6\u6587\u7ae0\u5185\u5bb9\u4e2d\u7684\u7eaf\u6587\u672c\u548c\u56fe\u7247 Map < String , Object > contentAndImagesResult = handleTextAndImages ( wmNews ); //4.1 \u6587\u672c\u5ba1\u6838 //4.2 \u56fe\u7247\u5ba1\u6838 //4.3 \u81ea\u7ba1\u7406\u7684\u654f\u611f\u8bcd\u5ba1\u6838 //4.4 \u53d1\u5e03\u65f6\u95f4\u5927\u4e8e\u5f53\u524d\u65f6\u95f4\uff0c //5.\u5ba1\u6838\u901a\u8fc7\uff0c\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u72b6\u6001\u4e3a9 \u4fdd\u5b58app\u7aef\u76f8\u5173\u6587\u7ae0\u4fe1\u606f } } /** * \u63d0\u53d6\u6587\u672c\u5185\u5bb9\u548c\u56fe\u7247 * * @param wmNews * @return */ private Map < String , Object > handleTextAndImages ( WmNews wmNews ) { //\u6587\u7ae0\u7684\u5185\u5bb9 String content = wmNews . getContent (); //\u5b58\u50a8\u7eaf\u6587\u672c\u5185\u5bb9 StringBuilder sb = new StringBuilder (); //\u5b58\u50a8\u56fe\u7247 List < String > images = new ArrayList <> (); //content\u662f\u4e00\u4e2aJSON\u6570\u7ec4\uff0c\u5982\u4e0b /** * { * \"title\":\"\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u80cc\u666f\", * \"type\":\"1\",//\u8fd9\u4e2a 0 \u662f\u65e0\u56fe 1 \u662f\u5355\u56fe 3 \u662f\u591a\u56fe -1 \u662f\u81ea\u52a8 * \"labels\":\"\u9ed1\u9a6c\u5934\u6761\", * \"publishTime\":\"2020-03-14T11:35:49.000Z\", * \"channelId\":1, * \"images\":[ * \"http://192.168.200.130/group1/M00/00/00/wKjIgl5swbGATaSAAAEPfZfx6Iw790.png\" * ], * \"status\":1, * \"content\":\"[ * { * \"type\":\"text\", * \"value\":\"\u968f\u7740\u667a\u80fd\u624b\u673a\u7684\u666e\u53ca\uff0c\u4eba\u4eec\u66f4\u52a0\u4e60\u60ef\u4e8e\u901a\u8fc7\u624b\u673a\u6765\u770b\u65b0\u95fb\u3002\u7531\u4e8e\u751f\u6d3b\u8282\u594f\u7684\u52a0\u5feb\uff0c\u5f88\u591a\u4eba\u53ea\u80fd\u5229\u7528\u788e\u7247\u65f6\u95f4\u6765\u83b7\u53d6\u4fe1\u606f\uff0c\u56e0\u6b64\uff0c\u5bf9\u4e8e\u79fb\u52a8\u8d44\u8baf\u5ba2\u6237\u7aef\u7684\u9700\u6c42\u4e5f\u8d8a\u6765\u8d8a\u9ad8\u3002\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u6b63\u662f\u5728\u8fd9\u6837\u80cc\u666f\u4e0b\u5f00\u53d1\u51fa\u6765\u3002\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u91c7\u7528\u5f53\u4e0b\u706b\u70ed\u7684\u5fae\u670d\u52a1+\u5927\u6570\u636e\u6280\u672f\u67b6\u6784\u5b9e\u73b0\u3002\u672c\u9879\u76ee\u4e3b\u8981\u7740\u624b\u4e8e\u83b7\u53d6\u6700\u65b0\u6700\u70ed\u65b0\u95fb\u8d44\u8baf\uff0c\u901a\u8fc7\u5927\u6570\u636e\u5206\u6790\u7528\u6237\u559c\u597d\u7cbe\u786e\u63a8\u9001\u54a8\u8be2\u65b0\u95fb\" * }, * { * \"type\":\"image\", * \"value\":\"http://192.168.200.130/group1/M00/00/00/wKjIgl5swbGATaSAAAEPfZfx6Iw790.png\" * } * ]\" * } */ //\u5c06\u6570\u7ec4\u8f6c\u6362\u6210List<Map>\u7c7b\u578b List < Map > contentList = JSONArray . parseArray ( content , Map . class ); for ( Map map : contentList ) { if ( map . get ( \"type\" ). equals ( \"text\" )) { sb . append ( map . get ( \"value\" )); } if ( map . get ( \"type\" ). equals ( \"image\" )) { images . add (( String ) map . get ( \"value\" )); } } //type\u4e3a0\u4ee3\u8868\u65e0\u56fe\u6587\u7ae0 //\u628a\u5c01\u9762\u7684\u56fe\u7247\uff0c\u4e5f\u6dfb\u52a0\u5230\u68c0\u6d4b\u5217\u8868\u91cc\u6765 if ( wmNews . getImages () != null && wmNews . getType () != 0 ) { String [] split = wmNews . getImages (). split ( \",\" ); images . addAll ( Arrays . asList ( split )); } //\u5c01\u88c5\u4e00\u4e2amap\u8fdb\u884c\u8fd4\u56de Map < String , Object > resultMap = new HashMap <> (); //\u6587\u672c\u5185\u5bb9 resultMap . put ( \"content\" , sb . toString ()); //\u56fe\u7247\u5185\u5bb9 resultMap . put ( \"images\" , images ); return resultMap ; }","title":"10-\u62bd\u53d6\u5185\u5bb9\u548c\u56fe\u7247 17:40"},{"location":"hmtt/day07/#11-_1051","text":"/** * \u6587\u672c\u5ba1\u6838 * * @param content \u6587\u672c\u5185\u5bb9 * @param wmNews \u6587\u7ae0\u5bf9\u8c61 * @return \u662f\u5426\u6210\u529f\u6807\u8bc6 true or false */ private boolean handleTextScan ( String content , WmNews wmNews ) { //\u5ba1\u6838\u7ed3\u679c\uff0c\u662f\u5426\u6210\u529f boolean flag = true ; try { //\u4f7f\u7528\u963f\u91cc\u4e91\u8fdb\u884c\u5ba1\u6838 Map map = greeTextScan . greeTextScan ( content ); //\u8fd4\u56de\u7ed3\u679c\u4e2d\u7684suggestion\u5b57\u6bb5\u5b58\u653e\u4e86\u7ed3\u679c //\u5ba1\u6838\u4e0d\u901a\u8fc7 if ( ! map . get ( \"suggestion\" ). equals ( \"pass\" )) { //\u5ba1\u6838\u5931\u8d25 if ( map . get ( \"suggestion\" ). equals ( \"block\" )) { //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 updateWmNews ( wmNews , ( short ) 2 , \"\u6587\u7ae0\u5185\u5bb9\u4e2d\u6709\u654f\u611f\u8bcd\u6c47\" ); flag = false ; } //\u4eba\u5de5\u5ba1\u6838 if ( map . get ( \"suggestion\" ). equals ( \"review\" )) { //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 updateWmNews ( wmNews , ( short ) 3 , \"\u6587\u7ae0\u5185\u5bb9\u4e2d\u6709\u4e0d\u786e\u5b9a\u8bcd\u6c47\" ); flag = false ; } } // String suggestion = (String) map.get(\"suggestion\"); // if(\"block\".equals(suggestion)){ // //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 // updateWmNews(wmNews, (short) 2, \"\u6587\u7ae0\u5185\u5bb9\u4e2d\u6709\u654f\u611f\u8bcd\u6c47\"); // flag = false; // }else if(\"review\".equals(suggestion)){ // //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 // updateWmNews(wmNews, (short) 3, \"\u6587\u7ae0\u5185\u5bb9\u4e2d\u6709\u4e0d\u786e\u5b9a\u8bcd\u6c47\"); // flag = false; // } } catch ( Exception e ) { e . printStackTrace (); flag = false ; } return flag ; } //4.1 \u6587\u672c\u5ba1\u6838 boolean textScanBoolean = handleTextScan (( String ) contentAndImagesResult . get ( \"content\" ), wmNews ); if ( ! textScanBoolean ) return ;","title":"11-\u6587\u672c\u5ba1\u6838 10:51"},{"location":"hmtt/day07/#12-_1335","text":"//4.2 \u56fe\u7247\u5ba1\u6838 boolean imagesScanBoolean = handleImagesScan (( List < String > ) contentAndImagesResult . get ( \"images\" ), wmNews ); if ( ! imagesScanBoolean ) return ; /** * \u5ba1\u6838\u56fe\u7247 * * @param images * @param wmNews * @return */ private boolean handleImagesScan ( List < String > images , WmNews wmNews ) { //\u5224\u65ad\u56fe\u7247\u662f\u5426\u4e3a\u7a7a\uff0c\u4e00\u5b9a\u8981\u52a0size <= 0\u5224\u65ad\uff0c\u5426\u5219\u4e0d\u4f1a\u751f\u6548 //\u5177\u4f53\u4ee3\u7801\u53ef\u4ee5\u770b\u751f\u6210\u56fe\u7247list\u5904\uff0c\u76f4\u63a5new ArrayList\uff0c\u6240\u4ee5\u8fd9\u4e2alist\u5fc5\u4e0d\u53ef\u80fd\u4e3anull if ( images == null || images . size () <= 0 ) { return true ; } boolean flag = true ; List < byte []> imageList = new ArrayList <> (); try { for ( String image : images ) { //\u53bb\u9664\u524d\u7f00 http://192.168.200.130/ String imageName = image . replace ( fileServerUrl , \"\" ); //\u627e\u5230\u7b2c\u4e00\u4e2a\u659c\u6760 group1/M00/00/00/rBENvl1RF0GAIKuTAAE4r64gbnE179.jpg int index = imageName . indexOf ( \"/\" ); //\u4ece0\u5230\u7b2c\u4e00\u4e2a\u659c\u6760\uff08\u4e0d\u5305\u542b\u659c\u6760\uff09 group1 String groupName = imageName . substring ( 0 , index ); //\u4ece\u7b2c\u4e00\u4e2a\u659c\u6760\u540e\u4e00\u4f4d\u5230\u6700\u540e M00/00/00/rBENvl1RF0GAIKuTAAE4r64gbnE179.jpg String imagePath = imageName . substring ( index + 1 ); //\u901a\u8fc7fastdfs\u4e0b\u8f7d\u6587\u4ef6\uff0c\u4fdd\u5b58\u5230\u5185\u5bb9\u4e2dbyte\u6570\u7ec4 byte [] imageByte = fastDFSClient . download ( groupName , imagePath ); //\u5c06byte\u6570\u7ec4\u653e\u5230list\u4e2d\uff0c\u65b9\u4fbf\u63d0\u4ea4\u5230\u963f\u91cc\u4e91 imageList . add ( imageByte ); } //\u963f\u91cc\u4e91\u56fe\u7247\u5ba1\u6838 Map map = greenImageScan . imageScan ( imageList ); //\u5ba1\u6838\u4e0d\u901a\u8fc7 if ( ! map . get ( \"suggestion\" ). equals ( \"pass\" )) { //\u5ba1\u6838\u5931\u8d25 if ( map . get ( \"suggestion\" ). equals ( \"block\" )) { //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 updateWmNews ( wmNews , ( short ) 2 , \"\u6587\u7ae0\u4e2d\u56fe\u7247\u6709\u8fdd\u89c4\" ); flag = false ; } //\u4eba\u5de5\u5ba1\u6838 if ( map . get ( \"suggestion\" ). equals ( \"review\" )) { //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 updateWmNews ( wmNews , ( short ) 3 , \"\u6587\u7ae0\u56fe\u7247\u6709\u4e0d\u786e\u5b9a\u5143\u7d20\" ); flag = false ; } } } catch ( Exception e ) { e . printStackTrace (); flag = false ; } return flag ; }","title":"12-\u56fe\u7247\u5ba1\u6838 13:35"},{"location":"hmtt/day07/#13-_0817","text":"//4.3 \u81ea\u7ba1\u7406\u7684\u654f\u611f\u8bcd\u5ba1\u6838 boolean sensitiveScanBoolean = handleSensitive (( String ) contentAndImagesResult . get ( \"content\" ), wmNews ); if ( ! sensitiveScanBoolean ) return ; //4.4 \u53d1\u5e03\u65f6\u95f4\u5927\u4e8e\u5f53\u524d\u65f6\u95f4\uff0c if ( wmNews . getPublishTime (). getTime () > System . currentTimeMillis ()) { //\u4fee\u6539\u6587\u7ae0\u72b6\u6001\u4e3a8 updateWmNews ( wmNews , ( short ) 8 , \"\u5ba1\u6838\u901a\u8fc7\uff0c\u5f85\u53d1\u5e03\" ); return ; } //5.\u5ba1\u6838\u901a\u8fc7\uff0c\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u72b6\u6001\u4e3a9 \u4fdd\u5b58app\u7aef\u76f8\u5173\u6587\u7ae0\u4fe1\u606f saveAppArticle ( wmNews ); /** * \u654f\u611f\u8bcd\u5ba1\u6838 * * @param content * @param wmNews * @return */ private boolean handleSensitive ( String content , WmNews wmNews ) { boolean flag = true ; List < String > allSensitive = adSensitiveMapper . findAllSensitive (); //\u521d\u59cb\u5316\u654f\u611f\u8bcd\uff0c\u5c06\u654f\u611f\u8bcd\u653e\u5230\u9759\u6001map\u4e2d SensitiveWordUtil . initMap ( allSensitive ); //\u6587\u7ae0\u5185\u5bb9\u81ea\u7ba1\u7406\u654f\u611f\u8bcd\u8fc7\u6ee4 Map < String , Integer > resultMap = SensitiveWordUtil . matchWords ( content ); if ( resultMap . size () > 0 ) { log . error ( \"\u654f\u611f\u8bcd\u8fc7\u6ee4\u6ca1\u6709\u901a\u8fc7\uff0c\u5305\u542b\u4e86\u654f\u611f\u8bcd:{}\" , resultMap ); //\u627e\u5230\u4e86\u654f\u611f\u8bcd\uff0c\u5ba1\u6838\u4e0d\u901a\u8fc7 updateWmNews ( wmNews , ( short ) 2 , \"\u6587\u7ae0\u4e2d\u5305\u542b\u4e86\u654f\u611f\u8bcd\" ); flag = false ; } return flag ; }","title":"13-\u81ea\u7ba1\u7406\u654f\u611f\u8bcd\u5ba1\u6838 08:17"},{"location":"hmtt/day07/#_3","text":"package com.heima.utils.common ; import java.util.* ; import java.util.concurrent.ConcurrentHashMap ; import java.util.concurrent.atomic.AtomicBoolean ; import java.util.concurrent.locks.Lock ; import java.util.concurrent.locks.ReadWriteLock ; import java.util.concurrent.locks.ReentrantReadWriteLock ; public class SensitiveWordUtil { //\u5224\u65ad\u662f\u5426\u521d\u59cb\u5316\u4e86 public static AtomicBoolean isInit = new AtomicBoolean ( false ); public static Map < String , Object > dictionaryMap = new HashMap <> (); //\u6dfb\u52a0\u8bfb\u5199\u9501 public static ReadWriteLock readWriteLock = new ReentrantReadWriteLock (); //\u8bfb\u9501\u5224\u65ad\u662f\u5426\u521b\u5efa public static boolean needToInit (){ Lock lock = readWriteLock . readLock (); try { return isInit . get (); } finally { lock . unlock (); } } /** * \u751f\u6210\u5173\u952e\u8bcd\u5b57\u5178\u5e93 * //\u51b0\u6bd2\u3001\u5927\u9ebb\u3001\u5927\u574f\u86cb * * @param words * @return */ public static void initMap ( Collection < String > words ) { Lock lock = readWriteLock . writeLock (); try { lock . lock (); if ( isInit . get ()){ //\u5df2\u7ecf\u88ab\u521b\u5efa,\u76f4\u63a5\u8fd4\u56de return ; } if ( words == null ) { System . out . println ( \"\u654f\u611f\u8bcd\u5217\u8868\u4e0d\u80fd\u4e3a\u7a7a\" ); return ; } // map\u521d\u59cb\u957f\u5ea6words.size()\uff0c\u6574\u4e2a\u5b57\u5178\u5e93\u7684\u5165\u53e3\u5b57\u6570(\u5c0f\u4e8ewords.size()\uff0c\u56e0\u4e3a\u4e0d\u540c\u7684\u8bcd\u53ef\u80fd\u4f1a\u6709\u76f8\u540c\u7684\u9996\u5b57) Map < String , Object > map = new HashMap <> ( words . size ()); // \u904d\u5386\u8fc7\u7a0b\u4e2d\u5f53\u524d\u5c42\u6b21\u7684\u6570\u636e Map < String , Object > curMap = null ; Iterator < String > iterator = words . iterator (); while ( iterator . hasNext ()) { //\u51b0\u6bd2 String word = iterator . next (); curMap = map ; int len = word . length (); for ( int i = 0 ; i < len ; i ++ ) { // \u904d\u5386\u6bcf\u4e2a\u8bcd\u7684\u5b57 String key = String . valueOf ( word . charAt ( i )); // \u5f53\u524d\u5b57\u5728\u5f53\u524d\u5c42\u662f\u5426\u5b58\u5728, \u4e0d\u5b58\u5728\u5219\u65b0\u5efa, \u5f53\u524d\u5c42\u6570\u636e\u6307\u5411\u4e0b\u4e00\u4e2a\u8282\u70b9, \u7ee7\u7eed\u5224\u65ad\u662f\u5426\u5b58\u5728\u6570\u636e Map < String , Object > wordMap = ( Map < String , Object > ) curMap . get ( key ); if ( wordMap == null ) { // \u6bcf\u4e2a\u8282\u70b9\u5b58\u5728\u4e24\u4e2a\u6570\u636e: \u4e0b\u4e00\u4e2a\u8282\u70b9\u548cisEnd(\u662f\u5426\u7ed3\u675f\u6807\u5fd7) wordMap = new HashMap <> ( 2 ); wordMap . put ( \"isEnd\" , \"0\" ); curMap . put ( key , wordMap ); } curMap = wordMap ; // \u5982\u679c\u5f53\u524d\u5b57\u662f\u8bcd\u7684\u6700\u540e\u4e00\u4e2a\u5b57\uff0c\u5219\u5c06isEnd\u6807\u5fd7\u7f6e1 if ( i == len - 1 ) { curMap . put ( \"isEnd\" , \"1\" ); } } } dictionaryMap = map ; isInit . compareAndSet ( false , true ); } catch ( Exception e ){ e . printStackTrace (); } finally { lock . unlock (); } } /** * \u641c\u7d22\u6587\u672c\u4e2d\u67d0\u4e2a\u6587\u5b57\u662f\u5426\u5339\u914d\u5173\u952e\u8bcd * * @param text * @param beginIndex * @return */ private static int checkWord ( String text , int beginIndex ) { Lock lock = readWriteLock . readLock (); //\u5339\u914d\u5230\u7684\u654f\u611f\u5b57\u7684\u4e2a\u6570\uff0c\u4e5f\u5c31\u662f\u654f\u611f\u8bcd\u957f\u5ea6 int length = 0 ; try { lock . lock (); //\u654f\u611f\u8bcd\u7ed3\u675f\u6807\u8bc6\u4f4d\uff1a\u7528\u4e8e\u654f\u611f\u8bcd\u53ea\u67091\u4f4d\u7684\u60c5\u51b5 boolean flag = false ; //\u4ece\u6839Map\u5f00\u59cb\u67e5\u627e Map nowMap = dictionaryMap ; for ( int i = beginIndex ; i < text . length (); i ++ ) { //\u88ab\u5224\u65ad\u8bed\u53e5\u7684\u7b2ci\u4e2a\u5b57\u7b26\u5f00\u59cb String key = String . valueOf ( text . charAt ( i )); //\u83b7\u53d6\u6307\u5b9akey\uff0c\u5e76\u4e14\u5c06\u654f\u611f\u5e93\u6307\u9488\u6307\u5411\u4e0b\u7ea7map nowMap = ( Map ) nowMap . get ( key ); if ( nowMap != null ) { //\u5b58\u5728\uff0c\u5219\u5224\u65ad\u662f\u5426\u4e3a\u6700\u540e\u4e00\u4e2a //\u627e\u5230\u76f8\u5e94key\uff0c\u5339\u914d\u957f\u5ea6+1 length ++ ; //\u5982\u679c\u4e3a\u6700\u540e\u4e00\u4e2a\u5339\u914d\u89c4\u5219,\u7ed3\u675f\u5faa\u73af\uff0c\u8fd4\u56de\u5339\u914d\u6807\u8bc6\u6570 if ( \"1\" . equals ( nowMap . get ( \"isEnd\" ))) { //\u7ed3\u675f\u6807\u5fd7\u4f4d\u4e3atrue flag = true ; } } else { //\u654f\u611f\u5e93\u4e0d\u5b58\u5728\uff0c\u76f4\u63a5\u4e2d\u65ad break ; } } if ( length < 2 || ! flag ) { //\u957f\u5ea6\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e1\u624d\u7b97\u662f\u8bcd\uff0c\u5b57\u7684\u8bdd\u5c31\u4e0d\u5fc5\u8fd9\u4e48\u6298\u817e\u4e86 length = 0 ; } } catch ( Exception e ){ e . printStackTrace (); } finally { lock . unlock (); return length ; } } /** * \u83b7\u53d6\u5339\u914d\u7684\u5173\u952e\u8bcd\u548c\u547d\u4e2d\u6b21\u6570 * * @param text * @return */ public static Map < String , Integer > matchWords ( String text ) { Map < String , Integer > wordMap = new HashMap <> (); int len = text . length (); for ( int i = 0 ; i < len ; i ++ ) { int wordLength = checkWord ( text , i ); if ( wordLength > 0 ) { String word = text . substring ( i , i + wordLength ); // \u6dfb\u52a0\u5173\u952e\u8bcd\u5339\u914d\u6b21\u6570 if ( wordMap . containsKey ( word )) { wordMap . put ( word , wordMap . get ( word ) + 1 ); } else { wordMap . put ( word , 1 ); } i += wordLength - 1 ; } } return wordMap ; } public static void main ( String [] args ) { List < String > list = new ArrayList <> (); list . add ( \"\u51b0\u6bd2\" ); list . add ( \"\u8fdd\u6cd5\" ); initMap ( list ); String content = \"\u6211\u662f\u4e00\u4e2a\u597d\u4eba\uff0c\u4e70\u5356\u51b0\u6bd2\u662f\u8fdd\u6cd5\u7684\u51b0\u6bd2\" ; Map < String , Integer > map = matchWords ( content ); System . out . println ( map ); } } \u5224\u65ad\u4e00\u4e0b\uff0c\u662f\u5426\u9700\u8981\u521d\u59cb\u5316 /** * \u654f\u611f\u8bcd\u5ba1\u6838 * * @param content * @param wmNews * @return */ private boolean handleSensitive ( String content , WmNews wmNews ) { boolean flag = true ; if ( SensitiveWordUtil . needToInit ()){ List < String > allSensitive = adSensitiveMapper . findAllSensitive (); //\u521d\u59cb\u5316\u654f\u611f\u8bcd\uff0c\u5c06\u654f\u611f\u8bcd\u653e\u5230\u9759\u6001map\u4e2d SensitiveWordUtil . initMap ( allSensitive ); } //\u6587\u7ae0\u5185\u5bb9\u81ea\u7ba1\u7406\u654f\u611f\u8bcd\u8fc7\u6ee4 Map < String , Integer > resultMap = SensitiveWordUtil . matchWords ( content ); if ( resultMap . size () > 0 ) { log . error ( \"\u654f\u611f\u8bcd\u8fc7\u6ee4\u6ca1\u6709\u901a\u8fc7\uff0c\u5305\u542b\u4e86\u654f\u611f\u8bcd:{}\" , resultMap ); //\u627e\u5230\u4e86\u654f\u611f\u8bcd\uff0c\u5ba1\u6838\u4e0d\u901a\u8fc7 updateWmNews ( wmNews , ( short ) 2 , \"\u6587\u7ae0\u4e2d\u5305\u542b\u4e86\u654f\u611f\u8bcd\" ); flag = false ; } return flag ; } \u5728\u8bfb\u5199\u65f6\u8fdb\u884c\u52a0\u9501\u3002 \u53e6\u5916\uff0c\u540e\u671f\u5982\u679c\u8981\u5b8c\u6210\u654f\u611f\u8bcd\u6539\u52a8\u4e4b\u540e\u8ba9\u5185\u5b58\u4e2d\u7684map\u80fd\u591f\u5237\u65b0\uff0c\u53ef\u4ee5\u4f7f\u7528kafka\u63a8\u9001\u6d88\u606f\u7684\u6a21\u5f0f\uff0c\u6267\u884cinitMap\u5373\u53ef\u505a\u5230\u5237\u65b0\u3002\u7531\u4e8e\u5728initMap\u4e2d\u6dfb\u52a0\u4e86\u5199\u9501\uff0c\u6b64\u65f6\u5176\u4ed6\u8bfb\u9501\u5c31\u4f1a\u7b49\u5f85\u5237\u65b0\u5b8c\u6210\u3002","title":"\u4f18\u5316\uff1a\u4fdd\u8bc1\u521d\u59cb\u5316\u52a8\u4f5c\u4e0d\u91cd\u590d\u6267\u884c\uff0c\u5e76\u4e14\u7ebf\u7a0b\u5b89\u5168"},{"location":"hmtt/day07/#14-app_1205","text":"//5.\u5ba1\u6838\u901a\u8fc7\uff0c\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u72b6\u6001\u4e3a9 \u4fdd\u5b58app\u7aef\u76f8\u5173\u6587\u7ae0\u4fe1\u606f saveAppArticle ( wmNews ); /** * \u4fdd\u5b58\u6587\u7ae0 * @param wmNews * @return */ private ApArticle saveArticle ( WmNews wmNews ) { ApArticle apArticle = new ApArticle (); apArticle . setTitle ( wmNews . getTitle ()); //\u6587\u7ae0\u5e03\u5c40 0 \u65e0\u56fe\u6587\u7ae0 1 \u5355\u56fe\u6587\u7ae0 2 \u591a\u56fe\u6587\u7ae0 apArticle . setLayout ( wmNews . getType ()); apArticle . setImages ( wmNews . getImages ()); apArticle . setCreatedTime ( new Date ()); //\u83b7\u53d6\u4f5c\u8005\u76f8\u5173\u4fe1\u606f Integer wmUserId = wmNews . getUserId (); //\u901a\u8fc7feign\u670d\u52a1\u67e5\u8be2\u81ea\u5a92\u4f53\u4eba WmUser wmUser = wemediaFeign . findWmUserById ( wmUserId ); if ( wmUser != null ){ //\u83b7\u53d6\u81ea\u5a92\u4f53\u7528\u6237\u4e2d\u7684\u540d\u5b57 String wmUserName = wmUser . getName (); //\u6839\u636e\u81ea\u5a92\u4f53\u7528\u6237\u540d\u5b57\uff0c\u901a\u8fc7feign\u63a5\u53e3\u83b7\u53d6\u4f5c\u8005\u4fe1\u606f ApAuthor apAuthor = articleFeign . selectAuthorByName ( wmUserName ); if ( apAuthor != null ){ apArticle . setAuthorId ( apAuthor . getId (). longValue ()); apArticle . setAuthorName ( apAuthor . getName ()); } } //\u83b7\u53d6\u9891\u9053\u76f8\u5173\u4fe1\u606f Integer channelId = wmNews . getChannelId (); AdChannel channel = adChannelMapper . selectById ( channelId ); if ( channel != null ){ apArticle . setChannelId ( channel . getId ()); apArticle . setChannelName ( channel . getName ()); } return articleFeign . saveAparticle ( apArticle ); }","title":"14-\u4fdd\u5b58APP\u6587\u7ae0\u6570\u636e 12:05"},{"location":"hmtt/day07/#15-app_0511","text":"/** * \u4fdd\u5b58app\u6587\u7ae0\u76f8\u5173\u7684\u6570\u636e * * @param wmNews */ private void saveAppArticle ( WmNews wmNews ) { //\u4fdd\u5b58app\u6587\u7ae0 ApArticle apArticle = saveArticle ( wmNews ); //\u4fdd\u5b58app\u6587\u7ae0\u914d\u7f6e saveArticleConfig ( apArticle ); //\u4fdd\u5b58app\u6587\u7ae0\u5185\u5bb9 saveArticleContent ( apArticle , wmNews ); //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\u4e3a9 wmNews . setArticleId ( apArticle . getId (). intValue ()); updateWmNews ( wmNews ,( short ) 9 , \"\u5ba1\u6838\u901a\u8fc7\" ); //TODO es\u7d22\u5f15\u521b\u5efa } /** * \u521b\u5efaapp\u7aef\u6587\u7ae0\u914d\u7f6e\u4fe1\u606f * @param apArticle */ private void saveArticleConfig ( ApArticle apArticle ) { ApArticleConfig apArticleConfig = new ApArticleConfig (); apArticleConfig . setArticleId ( apArticle . getId ()); //\u53ef\u4ee5\u8f6c\u53d1 apArticleConfig . setIsForward ( true ); //\u672a\u88ab\u5220\u9664 apArticleConfig . setIsDelete ( false ); //\u5df2\u4e0b\u67b6 apArticleConfig . setIsDown ( true ); //\u53ef\u4ee5\u8bc4\u8bba apArticleConfig . setIsComment ( true ); articleFeign . saveArticleConfig ( apArticleConfig ); } /** * \u521b\u5efaapp\u7aef\u6587\u7ae0\u5185\u5bb9\u4fe1\u606f * @param apArticle * @param wmNews */ private void saveArticleContent ( ApArticle apArticle , WmNews wmNews ) { ApArticleContent apArticleContent = new ApArticleContent (); apArticleContent . setArticleId ( apArticle . getId ()); apArticleContent . setContent ( wmNews . getContent ()); articleFeign . saveArticleContent ( apArticleContent ); }","title":"15-\u4fdd\u5b58APP\u6587\u7ae0\u914d\u7f6e\u548c\u5185\u5bb9 05:11"},{"location":"hmtt/day07/#16-_1516","text":"package com.heima.admin.test ; import com.heima.admin.AdminApplication ; import com.heima.admin.service.WemediaNewsAutoScanService ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @SpringBootTest ( classes = AdminApplication . class ) @RunWith ( SpringRunner . class ) public class WemediaNewsAutoScanServiceTest { @Autowired private WemediaNewsAutoScanService wemediaNewsAutoScanService ; @Test public void testScanNews (){ wemediaNewsAutoScanService . autoScanByMediaNewsId ( 6164 ); } }","title":"16-\u6d4b\u8bd5 15:16"},{"location":"hmtt/day07/#17-_1225","text":"wmnews\u7684service: /** * \u4fdd\u5b58\u6216\u4fee\u6539\u6587\u7ae0 * * @param wmNews * @param isSubmit */ private void saveWmNews ( WmNews wmNews , Short isSubmit ) { wmNews . setStatus ( isSubmit ); wmNews . setUserId ( WmThreadLocalUtils . getUser (). getId ()); wmNews . setCreatedTime ( new Date ()); wmNews . setSubmitedTime ( new Date ()); wmNews . setEnable (( short ) 1 ); boolean flag = false ; if ( wmNews . getId () == null ) { flag = save ( wmNews ); } else { //\u5982\u679c\u662f\u4fee\u6539\uff0c\u5219\u5148\u5220\u9664\u7d20\u6750\u4e0e\u6587\u7ae0\u7684\u5173\u7cfb LambdaQueryWrapper < WmNewsMaterial > queryWrapper = new LambdaQueryWrapper (); queryWrapper . eq ( WmNewsMaterial :: getNewsId , wmNews . getId ()); wmNewsMaterialMapper . delete ( queryWrapper ); flag = updateById ( wmNews ); } //\u53d1\u9001\u6d88\u606f if ( flag ){ kafkaTemplate . send ( NewsAutoScanConstants . WM_NEWS_AUTO_SCAN_TOPIC , JSON . toJSONString ( wmNews . getId ())); } } admin\u7684kafka\u6d88\u8d39\u8005: package com.heima.admin.kafka.listener ; import com.heima.admin.service.WemediaNewsAutoScanService ; import com.heima.common.constans.message.NewsAutoScanConstants ; import org.apache.kafka.clients.consumer.ConsumerRecord ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.kafka.annotation.KafkaListener ; import org.springframework.stereotype.Component ; import java.util.Optional ; @Component public class WemediaNewsAutoListener { @Autowired WemediaNewsAutoScanService wemediaNewsAutoScanService ; @KafkaListener ( topics = NewsAutoScanConstants . WM_NEWS_AUTO_SCAN_TOPIC ) public void recevieMessage ( ConsumerRecord <? , ?> record ){ Optional <? extends ConsumerRecord <? , ?>> optional = Optional . ofNullable ( record ); if ( optional . isPresent ()){ Object value = record . value (); wemediaNewsAutoScanService . autoScanByMediaNewsId ( Integer . valueOf (( String ) value )); } } }","title":"17-\u53d1\u5e03\u6587\u7ae0\u63d0\u4ea4\u5ba1\u6838  12:25"},{"location":"hmtt/day07/#18-_0330","text":"","title":"18-\u7efc\u5408\u6d4b\u8bd5 03:30"},{"location":"hmtt/day08/","text":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 01:06 \u00b6 \u80fd\u591f\u7406\u89e3\u4ec0\u4e48\u662f\u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6 \u80fd\u591f\u638c\u63e1xxl-job\u7684\u57fa\u672c\u4f7f\u7528 \u80fd\u591f\u4f7f\u7528xxl-job\u89e3\u51b3\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u4e2d\u5b9a\u65f6\u4efb\u52a1\u7684\u529f\u80fd \u80fd\u591f\u5b8c\u6210\u81ea\u5a92\u4f53\u6587\u7ae0\u4eba\u5de5\u5ba1\u6838\u529f\u80fd \u80fd\u591f\u5b8c\u6210\u81ea\u5a92\u4f53\u7aef\u6587\u7ae0\u4e0a\u4e0b\u67b6\u540c\u6b65\u7684\u95ee\u9898 02-\u4ec0\u4e48\u662f\u4efb\u52a1\u8c03\u5ea6 06:34 \u00b6 \u6211\u4eec\u53ef\u4ee5\u5148\u601d\u8003\u4e00\u4e0b\u4e1a\u52a1\u573a\u666f\u7684\u89e3\u51b3\u65b9\u6848\uff1a \u67d0\u7535\u5546\u7cfb\u7edf\u9700\u8981\u5728\u6bcf\u5929\u4e0a\u534810\u70b9\uff0c\u4e0b\u53483\u70b9\uff0c\u665a\u4e0a8\u70b9\u53d1\u653e\u4e00\u6279\u4f18\u60e0\u5238\u3002 \u67d0\u94f6\u884c\u7cfb\u7edf\u9700\u8981\u5728\u4fe1\u7528\u5361\u5230\u671f\u8fd8\u6b3e\u65e5\u7684\u524d\u4e09\u5929\u8fdb\u884c\u77ed\u4fe1\u63d0\u9192\u3002 \u67d0\u8d22\u52a1\u7cfb\u7edf\u9700\u8981\u5728\u6bcf\u5929\u51cc\u66680:10\u7ed3\u7b97\u524d\u4e00\u5929\u7684\u8d22\u52a1\u6570\u636e\uff0c\u7edf\u8ba1\u6c47\u603b\u3002 12306\u4f1a\u6839\u636e\u8f66\u6b21\u7684\u4e0d\u540c\uff0c\u8bbe\u7f6e\u67d0\u51e0\u4e2a\u65f6\u95f4\u70b9\u8fdb\u884c\u5206\u6279\u653e\u7968\u3002 \u4ee5\u4e0a\u4e1a\u52a1\u573a\u666f\u7684\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u4efb\u52a1\u8c03\u5ea6\u3002 \u4efb\u52a1\u8c03\u5ea6\u662f\u6307\u7cfb\u7edf\u4e3a\u4e86\u81ea\u52a8\u5b8c\u6210\u7279\u5b9a\u4efb\u52a1\uff0c\u5728\u7ea6\u5b9a\u7684\u7279\u5b9a\u65f6\u523b\u53bb\u6267\u884c\u4efb\u52a1\u7684\u8fc7\u7a0b\u3002\u6709\u4e86\u4efb\u52a1\u8c03\u5ea6\u5373\u53ef\u89e3\u653e\u66f4\u591a\u7684\u4eba\u529b\uff0c\u800c\u662f\u7531\u7cfb\u7edf\u81ea\u52a8\u53bb\u6267\u884c\u4efb\u52a1\u3002 \u5982\u4f55\u5b9e\u73b0\u4efb\u52a1\u8c03\u5ea6\uff1f \u591a\u7ebf\u7a0b\u65b9\u5f0f\uff0c\u7ed3\u5408sleep JDK\u63d0\u4f9b\u7684API\uff0c\u4f8b\u5982\uff1aTimer\u3001ScheduledExecutor \u6846\u67b6\uff0c\u4f8b\u5982Quartz \uff0c\u5b83\u662f\u4e00\u4e2a\u529f\u80fd\u5f3a\u5927\u7684\u4efb\u52a1\u8c03\u5ea6\u6846\u67b6\uff0c\u53ef\u4ee5\u6ee1\u8db3\u66f4\u591a\u66f4\u590d\u6742\u7684\u8c03\u5ea6\u9700\u6c42 spring task \u5165\u95e8\u6848\u4f8b spring\u6846\u67b6\u4e2d\u9ed8\u8ba4\u5c31\u652f\u6301\u4e86\u4e00\u4e2a\u4efb\u52a1\u8c03\u5ea6\uff0cspring-task \uff081\uff09\u521b\u5efa\u4e00\u4e2a\u5de5\u7a0b\uff1aspring-task-demo pom\u6587\u4ef6 <!-- \u7ee7\u627fSpring boot\u5de5\u7a0b --> <parent> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-parent </artifactId> <version> 2.1.5.RELEASE </version> </parent> <dependencies> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-web </artifactId> </dependency> </dependencies> \uff082\uff09\u5f15\u5bfc\u7c7b\uff1a package com.itheima.task ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; import org.springframework.scheduling.annotation.EnableScheduling ; @SpringBootApplication @EnableScheduling public class TaskApplication { public static void main ( String [] args ) { SpringApplication . run ( TaskApplication . class , args ); } } (3)\u7f16\u5199\u6848\u4f8b package com.itheima.task.job ; import org.springframework.scheduling.annotation.Scheduled ; import org.springframework.stereotype.Component ; import java.util.Date ; @Component public class HelloJob { @Scheduled ( cron = \"0/5 * * * * ?\" ) public void eat (){ System . out . println ( \"5\u79d2\u4e2d\u5403\u4e00\u6b21\u996d\uff0c\u6211\u60f3\u6210\u4e3a\u4e00\u4e2a\u80d6\u5b50\" + new Date ()); } } \u6d4b\u8bd5\uff1a\u542f\u52a8\u9879\u76ee\uff0c\u6bcf\u96945\u79d2\u4e2d\u4f1a\u6267\u884c\u4e00\u6b21eat\u65b9\u6cd5 03-cron\u8868\u8fbe\u5f0f 08:03 \u00b6 0 0 14 \uff1f 5 1 # 2 * \u79d2 \u5206 \u65f6 \u5929 \u6708 \u661f\u671f \u5e74 cron\u8868\u8fbe\u5f0f\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32, \u7528\u6765\u8bbe\u7f6e\u5b9a\u65f6\u89c4\u5219, \u7531\u4e03\u90e8\u5206\u7ec4\u6210, \u6bcf\u90e8\u5206\u4e2d\u95f4\u7528\u7a7a\u683c\u9694\u5f00, \u6bcf\u90e8\u5206\u7684\u542b\u4e49\u5982\u4e0b\u8868\u6240\u793a: \u7ec4\u6210\u90e8\u5206 \u542b\u4e49 \u53d6\u503c\u8303\u56f4 \u7b2c\u4e00\u90e8\u5206 Seconds (\u79d2) 0\uff0d59 \u7b2c\u4e8c\u90e8\u5206 Minutes(\u5206) 0\uff0d59 \u7b2c\u4e09\u90e8\u5206 Hours(\u65f6) 0-23 \u7b2c\u56db\u90e8\u5206 Day-of-Month(\u5929) 1-31 \u7b2c\u4e94\u90e8\u5206 Month(\u6708) 0-11\u6216JAN-DEC \u7b2c\u516d\u90e8\u5206 Day-of-Week(\u661f\u671f) 1-7(1\u8868\u793a\u661f\u671f\u65e5)\u6216SUN-SAT \u7b2c\u4e03\u90e8\u5206 Year(\u5e74) \u53ef\u9009 1970-2099 \u53e6\u5916, cron\u8868\u8fbe\u5f0f\u8fd8\u53ef\u4ee5\u5305\u542b\u4e00\u4e9b\u7279\u6b8a\u7b26\u53f7\u6765\u8bbe\u7f6e\u66f4\u52a0\u7075\u6d3b\u7684\u5b9a\u65f6\u89c4\u5219, \u5982\u4e0b\u8868\u6240\u793a: \u7b26\u53f7 \u542b\u4e49 ? \u8868\u793a\u4e0d\u786e\u5b9a\u7684\u503c\u3002\u5f53\u4e24\u4e2a\u5b50\u8868\u8fbe\u5f0f\u5176\u4e2d\u4e00\u4e2a\u88ab\u6307\u5b9a\u4e86\u503c\u4ee5\u540e\uff0c\u4e3a\u4e86\u907f\u514d\u51b2\u7a81\uff0c\u9700\u8981\u5c06\u53e6\u5916\u4e00\u4e2a\u7684\u503c\u8bbe\u4e3a\u201c?\u201d\u3002\u4f8b\u5982\uff1a\u60f3\u5728\u6bcf\u670820\u65e5\u89e6\u53d1\u8c03\u5ea6\uff0c\u4e0d\u7ba120\u53f7\u662f\u661f\u671f\u51e0\uff0c\u53ea\u80fd\u7528\u5982\u4e0b\u5199\u6cd5\uff1a0 0 0 20 * ?\uff0c\u5176\u4e2d\u6700\u540e\u4ee5\u4e3a\u53ea\u80fd\u7528\u201c?\u201d * \u4ee3\u8868\u6240\u6709\u53ef\u80fd\u7684\u503c , \u8bbe\u7f6e\u591a\u4e2a\u503c,\u4f8b\u5982\u201d26,29,33\u201d\u8868\u793a\u572826\u5206,29\u5206\u548c33\u5206\u5404\u81ea\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 - \u8bbe\u7f6e\u53d6\u503c\u8303\u56f4,\u4f8b\u5982\u201d5-20\u201d\uff0c\u8868\u793a\u4ece5\u5206\u523020\u5206\u949f\u6bcf\u5206\u949f\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 / \u8bbe\u7f6e\u9891\u7387\u6216\u95f4\u9694,\u5982\"1/15\"\u8868\u793a\u4ece1\u5206\u5f00\u59cb,\u6bcf\u969415\u5206\u949f\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 L \u7528\u4e8e\u6bcf\u6708\uff0c\u6216\u6bcf\u5468\uff0c\u8868\u793a\u6bcf\u6708\u7684\u6700\u540e\u4e00\u5929\uff0c\u6216\u6bcf\u4e2a\u6708\u7684\u6700\u540e\u661f\u671f\u51e0,\u4f8b\u5982\"6L\"\u8868\u793a\"\u6bcf\u6708\u7684\u6700\u540e\u4e00\u4e2a\u661f\u671f\u4e94\" W \u8868\u793a\u79bb\u7ed9\u5b9a\u65e5\u671f\u6700\u8fd1\u7684\u5de5\u4f5c\u65e5,\u4f8b\u5982\"15W\"\u653e\u5728\u6bcf\u6708\uff08day-of-month\uff09\u4e0a\u8868\u793a\"\u79bb\u672c\u670815\u65e5\u6700\u8fd1\u7684\u5de5\u4f5c\u65e5\" # \u8868\u793a\u8be5\u6708\u7b2c\u51e0\u4e2a\u5468X\u3002\u4f8b\u5982\u201d6#3\u201d\u8868\u793a\u8be5\u6708\u7b2c3\u4e2a\u5468\u4e94 \u4e3a\u4e86\u8ba9\u5927\u5bb6\u66f4\u719f\u6089cron\u8868\u8fbe\u5f0f\u7684\u7528\u6cd5, \u63a5\u4e0b\u6765\u6211\u4eec\u7ed9\u5927\u5bb6\u5217\u4e3e\u4e86\u4e00\u4e9b\u4f8b\u5b50, \u5982\u4e0b\u8868\u6240\u793a: cron\u8868\u8fbe\u5f0f \u542b\u4e49 /5 * * * ? \u6bcf\u96945\u79d2\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 0 0 23 * * ? \u6bcf\u592923\u70b9\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 0 0 1 1 * ? \u6bcf\u67081\u53f7\u51cc\u66681\u70b9\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 0 0 23 L * ? \u6bcf\u6708\u6700\u540e\u4e00\u592923\u70b9\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 0 26,29,33 * * * ? \u572826\u5206\u300129\u5206\u300133\u5206\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 0 0/30 9-17 * * ? \u671d\u4e5d\u665a\u4e94\u5de5\u4f5c\u65f6\u95f4\u5185\u6bcf\u534a\u5c0f\u65f6\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 0 15 10 ? * 6#3 \u6bcf\u6708\u7684\u7b2c\u4e09\u4e2a\u661f\u671f\u4e94\u4e0a\u534810:15\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 0 0 21 \uff1f 5 1 # 2 * \u79d2 \u5206 \u65f6 \u65e5 \u6708 \u5468 \u5e74 0 / 30 04-\u4ec0\u4e48\u662f\u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6 04:11 \u00b6 \u5f53\u524d\u8f6f\u4ef6\u7684\u67b6\u6784\u5df2\u7ecf\u5f00\u59cb\u5411\u5206\u5e03\u5f0f\u67b6\u6784\u8f6c\u53d8\uff0c\u5c06\u5355\u4f53\u7ed3\u6784\u62c6\u5206\u4e3a\u82e5\u5e72\u670d\u52a1\uff0c\u670d\u52a1\u4e4b\u95f4\u901a\u8fc7\u7f51\u7edc\u4ea4\u4e92\u6765\u5b8c\u6210\u4e1a\u52a1\u5904\u7406\u3002\u5728\u5206\u5e03\u5f0f\u67b6\u6784\u4e0b\uff0c\u4e00\u4e2a\u670d\u52a1\u5f80\u5f80\u4f1a\u90e8\u7f72\u591a\u4e2a\u5b9e\u4f8b\u6765\u8fd0\u884c\u6211\u4eec\u7684\u4e1a\u52a1\uff0c\u5982\u679c\u5728\u8fd9\u79cd\u5206\u5e03\u5f0f\u7cfb\u7edf\u73af\u5883\u4e0b\u8fd0\u884c\u4efb\u52a1\u8c03\u5ea6\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a \u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6 \u3002 \u5c06\u4efb\u52a1\u8c03\u5ea6\u7a0b\u5e8f\u5206\u5e03\u5f0f\u6784\u5efa\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5177\u6709\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u7279\u70b9\uff0c\u5e76\u4e14\u63d0\u9ad8\u4efb\u52a1\u7684\u8c03\u5ea6\u5904\u7406\u80fd\u529b\uff1a 1\u3001\u5e76\u884c\u4efb\u52a1\u8c03\u5ea6 \u5e76\u884c\u4efb\u52a1\u8c03\u5ea6\u5b9e\u73b0\u9760\u591a\u7ebf\u7a0b\uff0c\u5982\u679c\u6709\u5927\u91cf\u4efb\u52a1\u9700\u8981\u8c03\u5ea6\uff0c\u6b64\u65f6\u5149\u9760\u591a\u7ebf\u7a0b\u5c31\u4f1a\u6709\u74f6\u9888\u4e86\uff0c\u56e0\u4e3a\u4e00\u53f0\u8ba1\u7b97\u673aCPU\u7684\u5904\u7406\u80fd\u529b\u662f\u6709\u9650\u7684\u3002 \u5982\u679c\u5c06\u4efb\u52a1\u8c03\u5ea6\u7a0b\u5e8f\u5206\u5e03\u5f0f\u90e8\u7f72\uff0c\u6bcf\u4e2a\u7ed3\u70b9\u8fd8\u53ef\u4ee5\u90e8\u7f72\u4e3a\u96c6\u7fa4\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8ba9\u591a\u53f0\u8ba1\u7b97\u673a\u5171\u540c\u53bb\u5b8c\u6210\u4efb\u52a1\u8c03\u5ea6\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u4efb\u52a1\u5206\u5272\u4e3a\u82e5\u5e72\u4e2a\u5206\u7247\uff0c\u7531\u4e0d\u540c\u7684\u5b9e\u4f8b\u5e76\u884c\u6267\u884c\uff0c\u6765\u63d0\u9ad8\u4efb\u52a1\u8c03\u5ea6\u7684\u5904\u7406\u6548\u7387\u3002 2\u3001\u9ad8\u53ef\u7528 \u82e5\u67d0\u4e00\u4e2a\u5b9e\u4f8b\u5b95\u673a\uff0c\u4e0d\u5f71\u54cd\u5176\u4ed6\u5b9e\u4f8b\u6765\u6267\u884c\u4efb\u52a1\u3002 3\u3001\u5f39\u6027\u6269\u5bb9 \u5f53\u96c6\u7fa4\u4e2d\u589e\u52a0\u5b9e\u4f8b\u5c31\u53ef\u4ee5\u63d0\u9ad8\u5e76\u6267\u884c\u4efb\u52a1\u7684\u5904\u7406\u6548\u7387\u3002 4\u3001\u4efb\u52a1\u7ba1\u7406\u4e0e\u76d1\u6d4b \u5bf9\u7cfb\u7edf\u4e2d\u5b58\u5728\u7684\u6240\u6709\u5b9a\u65f6\u4efb\u52a1\u8fdb\u884c\u7edf\u4e00\u7684\u7ba1\u7406\u53ca\u76d1\u6d4b\u3002\u8ba9\u5f00\u53d1\u4eba\u5458\u53ca\u8fd0\u7ef4\u4eba\u5458\u80fd\u591f\u65f6\u523b\u4e86\u89e3\u4efb\u52a1\u6267\u884c\u60c5\u51b5\uff0c\u4ece\u800c\u505a\u51fa\u5feb\u901f\u7684\u5e94\u6025\u5904\u7406\u54cd\u5e94\u3002 \u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6\u9762\u4e34\u7684\u95ee\u9898\uff1a \u5f53\u4efb\u52a1\u8c03\u5ea6\u4ee5\u96c6\u7fa4\u65b9\u5f0f\u90e8\u7f72\uff0c\u540c\u4e00\u4e2a\u4efb\u52a1\u8c03\u5ea6\u53ef\u80fd\u4f1a\u6267\u884c\u591a\u6b21\uff0c\u4f8b\u5982\uff1a\u7535\u5546\u7cfb\u7edf\u5b9a\u671f\u53d1\u653e\u4f18\u60e0\u5238\uff0c\u5c31\u53ef\u80fd\u91cd\u590d\u53d1\u653e\u4f18\u60e0\u5238\uff0c\u5bf9\u516c\u53f8\u9020\u6210\u635f\u5931\uff0c\u4fe1\u7528\u5361\u8fd8\u6b3e\u63d0\u9192\u5c31\u4f1a\u91cd\u590d\u6267\u884c\u591a\u6b21\uff0c\u7ed9\u7528\u6237\u9020\u6210\u70e6\u607c\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u63a7\u5236\u76f8\u540c\u7684\u4efb\u52a1\u5728\u591a\u4e2a\u8fd0\u884c\u5b9e\u4f8b\u4e0a\u53ea\u6267\u884c\u4e00\u6b21\u3002\u5e38\u89c1\u89e3\u51b3\u65b9\u6848\uff1a \u5206\u5e03\u5f0f\u9501\uff0c\u591a\u4e2a\u5b9e\u4f8b\u5728\u4efb\u52a1\u6267\u884c\u524d\u9996\u5148\u9700\u8981\u83b7\u53d6\u9501\uff0c\u5982\u679c\u83b7\u53d6\u5931\u8d25\u90a3\u4e48\u5c31\u8bc1\u660e\u6709\u5176\u4ed6\u670d\u52a1\u5df2\u7ecf\u5728\u8fd0\u884c\uff0c\u5982\u679c\u83b7\u53d6\u6210\u529f\u90a3\u4e48\u8bc1\u660e\u6ca1\u6709\u670d\u52a1\u5728\u8fd0\u884c\u5b9a\u65f6\u4efb\u52a1\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u6267\u884c\u3002 ZooKeeper\u9009\u4e3e\uff0c\u5229\u7528ZooKeeper\u5bf9Leader\u5b9e\u4f8b\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\uff0c\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\u7684\u65f6\u5019\u5224\u65ad\u81ea\u5df1\u662f\u5426\u662fLeader\uff0c\u5982\u679c\u4e0d\u662f\u5219\u4e0d\u6267\u884c\uff0c\u5982\u679c\u662f\u5219\u6267\u884c\u4e1a\u52a1\u903b\u8f91\uff0c\u8fd9\u6837\u4e5f\u80fd\u8fbe\u5230\u76ee\u7684\u3002 05-XXL-Job\u7b80\u4ecb 04:54 \u00b6 \u9488\u5bf9\u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6\u7684\u9700\u6c42\uff0c\u5e02\u573a\u4e0a\u51fa\u73b0\u4e86\u5f88\u591a\u7684\u4ea7\u54c1\uff1a 1\uff09 TBSchedule\uff1a\u6dd8\u5b9d\u63a8\u51fa\u7684\u4e00\u6b3e\u975e\u5e38\u4f18\u79c0\u7684\u9ad8\u6027\u80fd\u5206\u5e03\u5f0f\u8c03\u5ea6\u6846\u67b6\uff0c\u76ee\u524d\u88ab\u5e94\u7528\u4e8e\u963f\u91cc\u3001\u4eac\u4e1c\u3001\u652f\u4ed8\u5b9d\u3001\u56fd\u7f8e\u7b49\u5f88\u591a\u4e92\u8054\u7f51\u4f01\u4e1a\u7684\u6d41\u7a0b\u8c03\u5ea6\u7cfb\u7edf\u4e2d\u3002\u4f46\u662f\u5df2\u7ecf\u591a\u5e74\u672a\u66f4\u65b0\uff0c\u6587\u6863\u7f3a\u5931\u4e25\u91cd\uff0c\u7f3a\u5c11\u7ef4\u62a4\u3002 2\uff09 XXL-Job\uff1a\u5927\u4f17\u70b9\u8bc4\u7684\u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6\u5e73\u53f0\uff0c\u662f\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6\u5e73\u53f0, \u5176\u6838\u5fc3\u8bbe\u8ba1\u76ee\u6807\u662f\u5f00\u53d1\u8fc5\u901f\u3001\u5b66\u4e60\u7b80\u5355\u3001\u8f7b\u91cf\u7ea7\u3001\u6613\u6269\u5c55\u3002\u73b0\u5df2\u5f00\u653e\u6e90\u4ee3\u7801\u5e76\u63a5\u5165\u591a\u5bb6\u516c\u53f8\u7ebf\u4e0a\u4ea7\u54c1\u7ebf\uff0c\u5f00\u7bb1\u5373\u7528\u3002 3\uff09Elastic-job\uff1a\u5f53\u5f53\u7f51\u501f\u9274TBSchedule\u5e76\u57fa\u4e8equartz \u4e8c\u6b21\u5f00\u53d1\u7684\u5f39\u6027\u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6\u7cfb\u7edf\uff0c\u529f\u80fd\u4e30\u5bcc\u5f3a\u5927\uff0c\u91c7\u7528zookeeper\u5b9e\u73b0\u5206\u5e03\u5f0f\u534f\u8c03\uff0c\u5177\u6709\u4efb\u52a1\u9ad8\u53ef\u7528\u4ee5\u53ca\u5206\u7247\u529f\u80fd\u3002 4\uff09Saturn\uff1a \u552f\u54c1\u4f1a\u5f00\u6e90\u7684\u4e00\u4e2a\u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6\u5e73\u53f0\uff0c\u57fa\u4e8eElastic-job\uff0c\u53ef\u4ee5\u5168\u57df\u7edf\u4e00\u914d\u7f6e\uff0c\u7edf\u4e00\u76d1 \u63a7\uff0c\u5177\u6709\u4efb\u52a1\u9ad8\u53ef\u7528\u4ee5\u53ca\u5206\u7247\u529f\u80fd\u3002 XXL-JOB\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6\u5e73\u53f0\uff0c\u5176\u6838\u5fc3\u8bbe\u8ba1\u76ee\u6807\u662f\u5f00\u53d1\u8fc5\u901f\u3001\u5b66\u4e60\u7b80\u5355\u3001\u8f7b\u91cf\u7ea7\u3001\u6613\u6269\u5c55\u3002\u73b0\u5df2\u5f00\u653e\u6e90\u4ee3\u7801\u5e76\u63a5\u5165\u591a\u5bb6\u516c\u53f8\u7ebf\u4e0a\u4ea7\u54c1\u7ebf\uff0c\u5f00\u7bb1\u5373\u7528\u3002 \u6e90\u7801\u5730\u5740\uff1ahttps://gitee.com/xuxueli0323/xxl-job \u6587\u6863\u5730\u5740\uff1ahttps://www.xuxueli.com/xxl-job/ \u7279\u6027 \u7b80\u5355\u7075\u6d3b \u63d0\u4f9bWeb\u9875\u9762\u5bf9\u4efb\u52a1\u8fdb\u884c\u7ba1\u7406\uff0c\u7ba1\u7406\u7cfb\u7edf\u652f\u6301\u7528\u6237\u7ba1\u7406\u3001\u6743\u9650\u63a7\u5236\uff1b \u652f\u6301\u5bb9\u5668\u90e8\u7f72\uff1b \u652f\u6301\u901a\u8fc7\u901a\u7528HTTP\u63d0\u4f9b\u8de8\u5e73\u53f0\u4efb\u52a1\u8c03\u5ea6\uff1b \u4e30\u5bcc\u7684\u4efb\u52a1\u7ba1\u7406\u529f\u80fd \u652f\u6301\u9875\u9762\u5bf9\u4efb\u52a1CRUD\u64cd\u4f5c\uff1b \u652f\u6301\u5728\u9875\u9762\u7f16\u5199\u811a\u672c\u4efb\u52a1\u3001\u547d\u4ee4\u884c\u4efb\u52a1\u3001Java\u4ee3\u7801\u4efb\u52a1\u5e76\u6267\u884c\uff1b \u652f\u6301\u4efb\u52a1\u7ea7\u8054\u7f16\u6392\uff0c\u7236\u4efb\u52a1\u6267\u884c\u7ed3\u675f\u540e\u89e6\u53d1\u5b50\u4efb\u52a1\u6267\u884c\uff1b \u652f \u6301\u8bbe\u7f6e\u6307\u5b9a\u4efb\u52a1\u6267\u884c\u8282\u70b9\u8def\u7531\u7b56\u7565\uff0c\u5305\u62ec\u8f6e\u8be2\u3001\u968f\u673a\u3001\u5e7f\u64ad\u3001\u6545\u969c\u8f6c\u79fb\u3001\u5fd9\u788c\u8f6c\u79fb\u7b49\uff1b \u652f\u6301Cron\u65b9\u5f0f\u3001\u4efb\u52a1\u4f9d\u8d56\u3001\u8c03\u5ea6\u4e2d\u5fc3API\u63a5\u53e3\u65b9\u5f0f\u89e6\u53d1\u4efb\u52a1\u6267\u884c \u9ad8\u6027\u80fd \u4efb\u52a1\u8c03\u5ea6\u6d41\u7a0b\u5168\u5f02\u6b65\u5316\u8bbe\u8ba1\u5b9e\u73b0\uff0c\u5982\u5f02\u6b65\u8c03\u5ea6\u3001\u5f02\u6b65\u8fd0\u884c\u3001\u5f02\u6b65\u56de\u8c03\u7b49\uff0c\u6709\u6548\u5bf9\u5bc6\u96c6\u8c03\u5ea6\u8fdb\u884c\u6d41\u91cf\u524a\u5cf0\uff1b \u9ad8\u53ef\u7528 \u4efb\u52a1\u8c03\u5ea6\u4e2d\u5fc3\u3001\u4efb\u52a1\u6267\u884c\u8282\u70b9\u5747 \u96c6\u7fa4\u90e8\u7f72\uff0c\u652f\u6301\u52a8\u6001\u6269\u5c55\u3001\u6545\u969c\u8f6c\u79fb \u652f\u6301\u4efb\u52a1\u914d\u7f6e\u8def\u7531\u6545\u969c\u8f6c\u79fb\u7b56\u7565\uff0c\u6267\u884c\u5668\u8282\u70b9\u4e0d\u53ef\u7528\u662f\u81ea\u52a8\u8f6c\u79fb\u5230\u5176\u4ed6\u8282\u70b9\u6267\u884c \u652f\u6301\u4efb\u52a1\u8d85\u65f6\u63a7\u5236\u3001\u5931\u8d25\u91cd\u8bd5\u914d\u7f6e \u652f\u6301\u4efb\u52a1\u5904\u7406\u963b\u585e\u7b56\u7565\uff1a\u8c03\u5ea6\u5f53\u4efb\u52a1\u6267\u884c\u8282\u70b9\u5fd9\u788c\u65f6\u6765\u4e0d\u53ca\u6267\u884c\u4efb\u52a1\u7684\u5904\u7406\u7b56\u7565\uff0c\u5305\u62ec\uff1a\u4e32\u884c\u3001\u629b\u5f03\u3001\u8986\u76d6\u7b56\u7565 \u6613\u4e8e\u76d1\u63a7\u8fd0\u7ef4 \u652f\u6301\u8bbe\u7f6e\u4efb\u52a1\u5931\u8d25\u90ae\u4ef6\u544a\u8b66\uff0c\u9884\u7559\u63a5\u53e3\u652f\u6301\u77ed\u4fe1\u3001\u9489\u9489\u544a\u8b66\uff1b \u652f\u6301\u5b9e\u65f6\u67e5\u770b\u4efb\u52a1\u6267\u884c\u8fd0\u884c\u6570\u636e\u7edf\u8ba1\u56fe\u8868\u3001\u4efb\u52a1\u8fdb\u5ea6\u76d1\u63a7\u6570\u636e\u3001\u4efb\u52a1\u5b8c\u6574\u6267\u884c\u65e5\u5fd7\uff1b 06-\u5165\u95e8\u6848\u4f8b\u73af\u5883\u642d\u5efa 10:42 \u00b6 \u5728\u5206\u5e03\u5f0f\u67b6\u6784\u4e0b\uff0c\u901a\u8fc7XXL-Job\u5b9e\u73b0\u5b9a\u65f6\u4efb\u52a1 \u8c03\u5ea6\u4e2d\u5fc3\uff1a\u8d1f\u8d23\u7ba1\u7406\u8c03\u5ea6\u4fe1\u606f\uff0c\u6309\u7167\u8c03\u5ea6\u914d\u7f6e\u53d1\u51fa\u8c03\u5ea6\u8bf7\u6c42\uff0c\u81ea\u8eab\u4e0d\u627f\u62c5\u4e1a\u52a1\u4ee3\u7801\u3002 \u4efb\u52a1\u6267\u884c\u5668\uff1a\u8d1f\u8d23\u63a5\u6536\u8c03\u5ea6\u8bf7\u6c42\u5e76\u6267\u884c\u4efb\u52a1\u903b\u8f91\u3002 \u4efb\u52a1\uff1a\u4e13\u6ce8\u4e8e\u4efb\u52a1\u7684\u5904\u7406\u3002 \u8c03\u5ea6\u4e2d\u5fc3\u4f1a\u53d1\u51fa\u8c03\u5ea6\u8bf7\u6c42\uff0c\u4efb\u52a1\u6267\u884c\u5668\u63a5\u6536\u5230\u8bf7\u6c42\u4e4b\u540e\u4f1a\u53bb\u6267\u884c\u4efb\u52a1\uff0c\u4efb\u52a1\u5219\u4e13\u6ce8\u4e8e\u4efb\u52a1\u4e1a\u52a1\u7684\u5904\u7406\u3002 \u76ee\u524d\u5b98\u65b9\u5df2\u7ecf\u66f4\u65b0\u7248\u672c\u4e3a2.2.0\u4e0d\u518d\u662fsnapshot\uff0c\u6211\u5df2\u7ecf\u5c06\u7248\u672c\u66f4\u65b0 1.\u5728SQLyog\u4e2d\u6267\u884cxxl-job\u8d44\u6599\u4e2d\u7684tables_xxl_job.sql 2.\u7f16\u8f91\u8d44\u6599\u4e2d\u7684application.properties\uff0c\u4fee\u6539mysql\u8def\u5f84\u548c\u7528\u6237\u540d\u5bc6\u7801 3.\u4f7f\u7528cmd,cd\u5230jar\u5305\u6240\u5728\u76ee\u5f55\uff0c\u6267\u884c java -jar xxl-job-admin-2.2.0.jar \u6216\u8005 xxljob.bat \u8bbf\u95eehttp://localhost:10086/xxl-job-admin\u5373\u53ef \u9ed8\u8ba4\u767b\u5f55\u8d26\u53f7\uff1aadmin/123456 09-\u521b\u5efa\u6267\u884c\u5668\u548c\u4efb\u52a1 07:29 \u00b6 \u914d\u7f6e\u6267\u884c\u5668 \u00b6 \u5728\u4efb\u52a1\u8c03\u5ea6\u4e2d\u5fc3\uff0c\u70b9\u51fb\u8fdb\u5165\"\u6267\u884c\u5668\u7ba1\u7406\"\u754c\u9762, \u5982\u4e0b\u56fe: 1\u3001\u6b64\u5904\u7684AppName,\u4f1a\u5728\u521b\u5efa\u4efb\u52a1\u65f6\u88ab\u9009\u62e9\uff0c\u6bcf\u4e2a\u4efb\u52a1\u5fc5\u7136\u8981\u9009\u62e9\u4e00\u4e2a\u6267\u884c\u5668\u3002 2\u3001\"\u6267\u884c\u5668\u5217\u8868\" \u4e2d\u663e\u793a\u5728\u7ebf\u7684\u6267\u884c\u5668\u5217\u8868, \u652f\u6301\u7f16\u8f91\u5220\u9664\u3002 \u4ee5\u4e0b\u662f\u6267\u884c\u5668\u7684\u5c5e\u6027\u8bf4\u660e\uff1a \u5c5e\u6027\u540d\u79f0 \u8bf4\u660e AppName \u662f\u6bcf\u4e2a\u6267\u884c\u5668\u96c6\u7fa4\u7684\u552f\u4e00\u6807\u793aAppName, \u6267\u884c\u5668\u4f1a\u5468\u671f\u6027\u4ee5AppName\u4e3a\u5bf9\u8c61\u8fdb\u884c\u81ea\u52a8\u6ce8\u518c\u3002\u53ef\u901a\u8fc7\u8be5\u914d\u7f6e\u81ea\u52a8\u53d1\u73b0\u6ce8\u518c\u6210\u529f\u7684\u6267\u884c\u5668, \u4f9b\u4efb\u52a1\u8c03\u5ea6\u65f6\u4f7f\u7528; \u540d\u79f0 \u6267\u884c\u5668\u7684\u540d\u79f0, \u56e0\u4e3aAppName\u9650\u5236\u5b57\u6bcd\u6570\u5b57\u7b49\u7ec4\u6210,\u53ef\u8bfb\u6027\u4e0d\u5f3a, \u540d\u79f0\u4e3a\u4e86\u63d0\u9ad8\u6267\u884c\u5668\u7684\u53ef\u8bfb\u6027; \u6392\u5e8f \u6267\u884c\u5668\u7684\u6392\u5e8f, \u7cfb\u7edf\u4e2d\u9700\u8981\u6267\u884c\u5668\u7684\u5730\u65b9,\u5982\u4efb\u52a1\u65b0\u589e, \u5c06\u4f1a\u6309\u7167\u8be5\u6392\u5e8f\u8bfb\u53d6\u53ef\u7528\u7684\u6267\u884c\u5668\u5217\u8868; \u6ce8\u518c\u65b9\u5f0f \u8c03\u5ea6\u4e2d\u5fc3\u83b7\u53d6\u6267\u884c\u5668\u5730\u5740\u7684\u65b9\u5f0f\uff1b \u673a\u5668\u5730\u5740 \u6ce8\u518c\u65b9\u5f0f\u4e3a\"\u624b\u52a8\u5f55\u5165\"\u65f6\u6709\u6548\uff0c\u652f\u6301\u4eba\u5de5\u7ef4\u62a4\u6267\u884c\u5668\u7684\u5730\u5740\u4fe1\u606f\uff1b \u5177\u4f53\u64cd\u4f5c\uff1a \uff081\uff09\u65b0\u589e\u6267\u884c\u5668\uff1a \uff082\uff09\u81ea\u52a8\u6ce8\u518c\u548c\u624b\u52a8\u6ce8\u518c\u7684\u533a\u522b\u548c\u914d\u7f6e \u5728\u8c03\u5ea6\u4e2d\u5fc3\u65b0\u5efa\u4efb\u52a1 \u00b6 \u5728\u4efb\u52a1\u7ba1\u7406->\u65b0\u5efa\uff0c\u586b\u5199\u4ee5\u4e0b\u5185\u5bb9 \u6267\u884c\u5668\uff1a\u4efb\u52a1\u7684\u7ed1\u5b9a\u7684\u6267\u884c\u5668\uff0c\u4efb\u52a1\u89e6\u53d1\u8c03\u5ea6\u65f6\u5c06\u4f1a\u81ea\u52a8\u53d1\u73b0\u6ce8\u518c\u6210\u529f\u7684\u6267\u884c\u5668, \u5b9e\u73b0\u4efb\u52a1\u81ea\u52a8\u53d1\u73b0\u529f\u80fd; \u53e6\u4e00\u65b9\u9762\u4e5f\u53ef\u4ee5\u65b9\u4fbf\u7684\u8fdb\u884c\u4efb\u52a1\u5206\u7ec4\u3002\u6bcf\u4e2a\u4efb\u52a1\u5fc5\u987b\u7ed1\u5b9a\u4e00\u4e2a\u6267\u884c\u5668, \u53ef\u5728 \"\u6267\u884c\u5668\u7ba1\u7406\" \u8fdb\u884c\u8bbe\u7f6e \u4efb\u52a1\u63cf\u8ff0\uff1a\u4efb\u52a1\u7684\u63cf\u8ff0\u4fe1\u606f\uff0c\u4fbf\u4e8e\u4efb\u52a1\u7ba1\u7406 \u8def\u7531\u7b56\u7565\uff1a\u5f53\u6267\u884c\u5668\u96c6\u7fa4\u90e8\u7f72\u65f6\uff0c\u63d0\u4f9b\u4e30\u5bcc\u7684\u8def\u7531\u7b56\u7565\uff0c\u5305\u62ec FIRST\uff08\u7b2c\u4e00\u4e2a\uff09\uff1a\u56fa\u5b9a\u9009\u62e9\u7b2c\u4e00\u4e2a\u673a\u5668\uff1b LAST\uff08\u6700\u540e\u4e00\u4e2a\uff09\uff1a\u56fa\u5b9a\u9009\u62e9\u6700\u540e\u4e00\u4e2a\u673a\u5668\uff1b ROUND\uff08\u8f6e\u8be2\uff09\uff1a RANDOM\uff08\u968f\u673a\uff09\uff1a\u968f\u673a\u9009\u62e9\u5728\u7ebf\u7684\u673a\u5668\uff1b CONSISTENT_HASH\uff08\u4e00\u81f4\u6027HASH\uff09\uff1a\u6bcf\u4e2a\u4efb\u52a1\u6309\u7167Hash\u7b97\u6cd5\u56fa\u5b9a\u9009\u62e9\u67d0\u4e00\u53f0\u673a\u5668\uff0c\u4e14\u6240\u6709\u4efb\u52a1\u5747\u5300\u6563\u5217\u5728\u4e0d\u540c\u673a\u5668\u4e0a\u3002 LEAST_FREQUENTLY_USED\uff08\u6700\u4e0d\u7ecf\u5e38\u4f7f\u7528\uff09\uff1a\u4f7f\u7528\u9891\u7387\u6700\u4f4e\u7684\u673a\u5668\u4f18\u5148\u88ab\u9009\u4e3e\uff1b LEAST_RECENTLY_USED\uff08\u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\uff09\uff1a\u6700\u4e45\u4e3a\u4f7f\u7528\u7684\u673a\u5668\u4f18\u5148\u88ab\u9009\u4e3e\uff1b FAILOVER\uff08\u6545\u969c\u8f6c\u79fb\uff09\uff1a\u6309\u7167\u987a\u5e8f\u4f9d\u6b21\u8fdb\u884c\u5fc3\u8df3\u68c0\u6d4b\uff0c\u7b2c\u4e00\u4e2a\u5fc3\u8df3\u68c0\u6d4b\u6210\u529f\u7684\u673a\u5668\u9009\u5b9a\u4e3a\u76ee\u6807\u6267\u884c\u5668\u5e76\u53d1\u8d77\u8c03\u5ea6\uff1b BUSYOVER\uff08\u5fd9\u788c\u8f6c\u79fb\uff09\uff1a\u6309\u7167\u987a\u5e8f\u4f9d\u6b21\u8fdb\u884c\u7a7a\u95f2\u68c0\u6d4b\uff0c\u7b2c\u4e00\u4e2a\u7a7a\u95f2\u68c0\u6d4b\u6210\u529f\u7684\u673a\u5668\u9009\u5b9a\u4e3a\u76ee\u6807\u6267\u884c\u5668\u5e76\u53d1\u8d77\u8c03\u5ea6\uff1b SHARDING_BROADCAST(\u5206\u7247\u5e7f\u64ad)\uff1a\u5e7f\u64ad\u89e6\u53d1\u5bf9\u5e94\u96c6\u7fa4\u4e2d\u6240\u6709\u673a\u5668\u6267\u884c\u4e00\u6b21\u4efb\u52a1\uff0c\u540c\u65f6\u7cfb\u7edf\u81ea\u52a8\u4f20\u9012\u5206\u7247\u53c2\u6570\uff1b\u53ef\u6839\u636e\u5206\u7247\u53c2\u6570\u5f00\u53d1\u5206\u7247\u4efb\u52a1\uff1b Cron\uff1a\u89e6\u53d1\u4efb\u52a1\u6267\u884c\u7684Cron\u8868\u8fbe\u5f0f\uff1b \u8fd0\u884c\u6a21\u5f0f\uff1a BEAN\u6a21\u5f0f\uff1a\u4efb\u52a1\u4ee5JobHandler\u65b9\u5f0f\u7ef4\u62a4\u5728\u6267\u884c\u5668\u7aef\uff1b\u9700\u8981\u7ed3\u5408 \"JobHandler\" \u5c5e\u6027\u5339\u914d\u6267\u884c\u5668\u4e2d\u4efb\u52a1\uff1b GLUE\u6a21\u5f0f(Java)\uff1a\u4efb\u52a1\u4ee5\u6e90\u7801\u65b9\u5f0f\u7ef4\u62a4\u5728\u8c03\u5ea6\u4e2d\u5fc3\uff1b\u8be5\u6a21\u5f0f\u7684\u4efb\u52a1\u5b9e\u9645\u4e0a\u662f\u4e00\u6bb5\u7ee7\u627f\u81eaIJobHandler\u7684Java\u7c7b\u4ee3\u7801\u5e76 \"groovy\" \u6e90\u7801\u65b9\u5f0f\u7ef4\u62a4\uff0c\u5b83\u5728\u6267\u884c\u5668\u9879\u76ee\u4e2d\u8fd0\u884c\uff0c\u53ef\u4f7f\u7528@Resource/@Autowire\u6ce8\u5165\u6267\u884c\u5668\u91cc\u4e2d\u7684\u5176\u4ed6\u670d\u52a1\uff1b GLUE\u6a21\u5f0f(Shell)\uff1a\u4efb\u52a1\u4ee5\u6e90\u7801\u65b9\u5f0f\u7ef4\u62a4\u5728\u8c03\u5ea6\u4e2d\u5fc3\uff1b\u8be5\u6a21\u5f0f\u7684\u4efb\u52a1\u5b9e\u9645\u4e0a\u662f\u4e00\u6bb5 \"shell\" \u811a\u672c\uff1b GLUE\u6a21\u5f0f(Python)\uff1a\u4efb\u52a1\u4ee5\u6e90\u7801\u65b9\u5f0f\u7ef4\u62a4\u5728\u8c03\u5ea6\u4e2d\u5fc3\uff1b\u8be5\u6a21\u5f0f\u7684\u4efb\u52a1\u5b9e\u9645\u4e0a\u662f\u4e00\u6bb5 \"python\" \u811a\u672c\uff1b GLUE\u6a21\u5f0f(PHP)\uff1a\u4efb\u52a1\u4ee5\u6e90\u7801\u65b9\u5f0f\u7ef4\u62a4\u5728\u8c03\u5ea6\u4e2d\u5fc3\uff1b\u8be5\u6a21\u5f0f\u7684\u4efb\u52a1\u5b9e\u9645\u4e0a\u662f\u4e00\u6bb5 \"php\" \u811a\u672c\uff1b GLUE\u6a21\u5f0f(NodeJS)\uff1a\u4efb\u52a1\u4ee5\u6e90\u7801\u65b9\u5f0f\u7ef4\u62a4\u5728\u8c03\u5ea6\u4e2d\u5fc3\uff1b\u8be5\u6a21\u5f0f\u7684\u4efb\u52a1\u5b9e\u9645\u4e0a\u662f\u4e00\u6bb5 \"nodejs\" \u811a\u672c\uff1b GLUE\u6a21\u5f0f(PowerShell)\uff1a\u4efb\u52a1\u4ee5\u6e90\u7801\u65b9\u5f0f\u7ef4\u62a4\u5728\u8c03\u5ea6\u4e2d\u5fc3\uff1b\u8be5\u6a21\u5f0f\u7684\u4efb\u52a1\u5b9e\u9645\u4e0a\u662f\u4e00\u6bb5 \"PowerShell\" \u811a\u672c\uff1b JobHandler\uff1a\u8fd0\u884c\u6a21\u5f0f\u4e3a \"BEAN\u6a21\u5f0f\" \u65f6\u751f\u6548\uff0c\u5bf9\u5e94\u6267\u884c\u5668\u4e2d\u65b0\u5f00\u53d1\u7684JobHandler\u7c7b\u201c@JobHandler\u201d\u6ce8\u89e3\u81ea\u5b9a\u4e49\u7684value\u503c\uff1b \u963b\u585e\u5904\u7406\u7b56\u7565\uff1a\u8c03\u5ea6\u8fc7\u4e8e\u5bc6\u96c6\u6267\u884c\u5668\u6765\u4e0d\u53ca\u5904\u7406\u65f6\u7684\u5904\u7406\u7b56\u7565\uff1b \u5355\u673a\u4e32\u884c\uff08\u9ed8\u8ba4\uff09\uff1a\u8c03\u5ea6\u8bf7\u6c42\u8fdb\u5165\u5355\u673a\u6267\u884c\u5668\u540e\uff0c\u8c03\u5ea6\u8bf7\u6c42\u8fdb\u5165FIFO\u961f\u5217\u5e76\u4ee5\u4e32\u884c\u65b9\u5f0f\u8fd0\u884c\uff1b \u4e22\u5f03\u540e\u7eed\u8c03\u5ea6\uff1a\u8c03\u5ea6\u8bf7\u6c42\u8fdb\u5165\u5355\u673a\u6267\u884c\u5668\u540e\uff0c\u53d1\u73b0\u6267\u884c\u5668\u5b58\u5728\u8fd0\u884c\u7684\u8c03\u5ea6\u4efb\u52a1\uff0c\u672c\u6b21\u8bf7\u6c42\u5c06\u4f1a\u88ab\u4e22\u5f03\u5e76\u6807\u8bb0\u4e3a\u5931\u8d25\uff1b \u8986\u76d6\u4e4b\u524d\u8c03\u5ea6\uff1a\u8c03\u5ea6\u8bf7\u6c42\u8fdb\u5165\u5355\u673a\u6267\u884c\u5668\u540e\uff0c\u53d1\u73b0\u6267\u884c\u5668\u5b58\u5728\u8fd0\u884c\u7684\u8c03\u5ea6\u4efb\u52a1\uff0c\u5c06\u4f1a\u7ec8\u6b62\u8fd0\u884c\u4e2d\u7684\u8c03\u5ea6\u4efb\u52a1\u5e76\u6e05\u7a7a\u961f\u5217\uff0c\u7136\u540e\u8fd0\u884c\u672c\u5730\u8c03\u5ea6\u4efb\u52a1\uff1b \u5b50\u4efb\u52a1\uff1a\u6bcf\u4e2a\u4efb\u52a1\u90fd\u62e5\u6709\u4e00\u4e2a\u552f\u4e00\u7684\u4efb\u52a1ID(\u4efb\u52a1ID\u53ef\u4ee5\u4ece\u4efb\u52a1\u5217\u8868\u83b7\u53d6)\uff0c\u5f53\u672c\u4efb\u52a1\u6267\u884c\u7ed3\u675f\u5e76\u4e14\u6267\u884c\u6210\u529f\u65f6\uff0c\u5c06\u4f1a\u89e6\u53d1\u5b50\u4efb\u52a1ID\u6240\u5bf9\u5e94\u7684\u4efb\u52a1\u7684\u4e00\u6b21\u4e3b\u52a8\u8c03\u5ea6\u3002 \u4efb\u52a1\u8d85\u65f6\u65f6\u95f4\uff1a\u652f\u6301\u81ea\u5b9a\u4e49\u4efb\u52a1\u8d85\u65f6\u65f6\u95f4\uff0c\u4efb\u52a1\u8fd0\u884c\u8d85\u65f6\u5c06\u4f1a\u4e3b\u52a8\u4e2d\u65ad\u4efb\u52a1\uff1b \u5931\u8d25\u91cd\u8bd5\u6b21\u6570\uff1b\u652f\u6301\u81ea\u5b9a\u4e49\u4efb\u52a1\u5931\u8d25\u91cd\u8bd5\u6b21\u6570\uff0c\u5f53\u4efb\u52a1\u5931\u8d25\u65f6\u5c06\u4f1a\u6309\u7167\u9884\u8bbe\u7684\u5931\u8d25\u91cd\u8bd5\u6b21\u6570\u4e3b\u52a8\u8fdb\u884c\u91cd\u8bd5\uff1b \u62a5\u8b66\u90ae\u4ef6\uff1a\u4efb\u52a1\u8c03\u5ea6\u5931\u8d25\u65f6\u90ae\u4ef6\u901a\u77e5\u7684\u90ae\u7bb1\u5730\u5740\uff0c\u652f\u6301\u914d\u7f6e\u591a\u90ae\u7bb1\u5730\u5740\uff0c\u914d\u7f6e\u591a\u4e2a\u90ae\u7bb1\u5730\u5740\u65f6\u7528\u9017\u53f7\u5206\u9694\uff1b \u8d1f\u8d23\u4eba\uff1a\u4efb\u52a1\u7684\u8d1f\u8d23\u4eba\uff1b \u6267\u884c\u53c2\u6570\uff1a\u4efb\u52a1\u6267\u884c\u6240\u9700\u7684\u53c2\u6570\uff1b 10-\u4e0eSpring Boot\u96c6\u6210 10:18 \u00b6 \u65b0\u5efa\u9879\u76ee\uff1axxl-job-demo \uff081\uff09pom\u6587\u4ef6 <groupId> com.itheima </groupId> <artifactId> xxl-job-demo </artifactId> <version> 1.0-SNAPSHOT </version> <!-- \u7ee7\u627fSpring boot\u5de5\u7a0b --> <parent> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-parent </artifactId> <version> 2.1.5.RELEASE </version> </parent> <dependencies> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-web </artifactId> </dependency> <!-- xxl-job --> <dependency> <groupId> com.xuxueli </groupId> <artifactId> xxl-job-core </artifactId> <version> 2.2.0 </version> </dependency> </dependencies> <build> <plugins> <plugin> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-maven-plugin </artifactId> </plugin> </plugins> </build> 2.2.0-snapshot\u7248\u672c\u5df2\u7ecf\u4e0d\u5b58\u5728\uff0c\u6539\u62102.2.0\u7248\u672c (2)\u914d\u7f6e\u6709\u4e24\u4e2a\uff0c\u4e00\u4e2a\u662fapplication.properties\uff0c\u53e6\u5916\u4e00\u4e2a\u662f\u65e5\u5fd7\u914d\u7f6e:logback.xml application.properties # web port server.port = ${port:8801} # no web #spring.main.web-environment=false # log config logging.config = classpath:logback.xml ### xxl-job admin address list, such as \"http://address\" or \"http://address01,http://address02\" xxl.job.admin.addresses = http://localhost:8888/xxl-job-admin ### xxl-job, access token xxl.job.accessToken = ### xxl-job executor appname xxl.job.executor.appname = xxl-job-executor-sample ### xxl-job executor registry-address: default use address to registry , otherwise use ip:port if address is null xxl.job.executor.address = ### xxl-job executor server-info xxl.job.executor.ip = xxl.job.executor.port = ${executor.port:9999} ### xxl-job executor log-path xxl.job.executor.logpath = /data/applogs/xxl-job/jobhandler ### xxl-job executor log-retention-days xxl.job.executor.logretentiondays = 30 logback.xml <?xml version=\"1.0\" encoding=\"UTF-8\"?> <configuration debug= \"false\" scan= \"true\" scanPeriod= \"1 seconds\" > <contextName> logback </contextName> <property name= \"log.path\" value= \"/data/applogs/xxl-job/xxl-job-executor-sample-springboot.log\" /> <appender name= \"console\" class= \"ch.qos.logback.core.ConsoleAppender\" > <encoder> <pattern> %d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n </pattern> </encoder> </appender> <appender name= \"file\" class= \"ch.qos.logback.core.rolling.RollingFileAppender\" > <file> ${log.path} </file> <rollingPolicy class= \"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\" > <fileNamePattern> ${log.path}.%d{yyyy-MM-dd}.zip </fileNamePattern> </rollingPolicy> <encoder> <pattern> %date %level [%thread] %logger{36} [%file : %line] %msg%n </pattern> </encoder> </appender> <root level= \"info\" > <appender-ref ref= \"console\" /> <appender-ref ref= \"file\" /> </root> </configuration> (3)\u5f15\u5bfc\u7c7b\uff1a package com.itheima.xxljob ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; @SpringBootApplication public class XxlJobApplication { public static void main ( String [] args ) { SpringApplication . run ( XxlJobApplication . class , args ); } } 2.2.4 \u6dfb\u52a0xxl-job\u914d\u7f6e \u00b6 \u6dfb\u52a0\u914d\u7f6e\u7c7b\uff1a \u8fd9\u4e2a\u7c7b\u4e3b\u8981\u662f\u521b\u5efa\u4e86\u4efb\u52a1\u6267\u884c\u5668\uff0c\u53c2\u8003\u5b98\u65b9\u6848\u4f8b\u7f16\u5199\uff0c\u65e0\u987b\u6539\u52a8 package com.itheima.xxljob.config ; import com.xxl.job.core.executor.impl.XxlJobSpringExecutor ; import org.slf4j.Logger ; import org.slf4j.LoggerFactory ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; /** * xxl-job config * * @author xuxueli 2017-04-28 */ @Configuration public class XxlJobConfig { private Logger logger = LoggerFactory . getLogger ( XxlJobConfig . class ); @Value ( \"${xxl.job.admin.addresses}\" ) private String adminAddresses ; @Value ( \"${xxl.job.accessToken}\" ) private String accessToken ; @Value ( \"${xxl.job.executor.appname}\" ) private String appName ; @Value ( \"${xxl.job.executor.address}\" ) private String address ; @Value ( \"${xxl.job.executor.ip}\" ) private String ip ; @Value ( \"${xxl.job.executor.port}\" ) private int port ; @Value ( \"${xxl.job.executor.logpath}\" ) private String logPath ; @Value ( \"${xxl.job.executor.logretentiondays}\" ) private int logRetentionDays ; @Bean public XxlJobSpringExecutor xxlJobExecutor () { logger . info ( \">>>>>>>>>>> xxl-job config init.\" ); XxlJobSpringExecutor xxlJobSpringExecutor = new XxlJobSpringExecutor (); xxlJobSpringExecutor . setAdminAddresses ( adminAddresses ); xxlJobSpringExecutor . setAppname ( appName ); xxlJobSpringExecutor . setAddress ( address ); xxlJobSpringExecutor . setIp ( ip ); xxlJobSpringExecutor . setPort ( port ); xxlJobSpringExecutor . setAccessToken ( accessToken ); xxlJobSpringExecutor . setLogPath ( logPath ); xxlJobSpringExecutor . setLogRetentionDays ( logRetentionDays ); return xxlJobSpringExecutor ; } /** * \u9488\u5bf9\u591a\u7f51\u5361\u3001\u5bb9\u5668\u5185\u90e8\u7f72\u7b49\u60c5\u51b5\uff0c\u53ef\u501f\u52a9 \"spring-cloud-commons\" \u63d0\u4f9b\u7684 \"InetUtils\" \u7ec4\u4ef6\u7075\u6d3b\u5b9a\u5236\u6ce8\u518cIP\uff1b * * 1\u3001\u5f15\u5165\u4f9d\u8d56\uff1a * <dependency> * <groupId>org.springframework.cloud</groupId> * <artifactId>spring-cloud-commons</artifactId> * <version>${version}</version> * </dependency> * * 2\u3001\u914d\u7f6e\u6587\u4ef6\uff0c\u6216\u8005\u5bb9\u5668\u542f\u52a8\u53d8\u91cf * spring.cloud.inetutils.preferred-networks: 'xxx.xxx.xxx.' * * 3\u3001\u83b7\u53d6IP * String ip_ = inetUtils.findFirstNonLoopbackHostInfo().getIpAddress(); */ } 2.2.5 \u521b\u5efa\u4efb\u52a1 \u00b6 package com.itheima.xxljob.job ; import com.xxl.job.core.biz.model.ReturnT ; import com.xxl.job.core.handler.annotation.XxlJob ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.stereotype.Component ; import java.time.LocalDateTime ; @Component public class HelloJob { @Value ( \"${server.port}\" ) private String appPort ; @XxlJob ( \"helloJob\" ) public ReturnT < String > hello ( String param ) throws Exception { System . out . println ( \"helloJob\uff1a\" + LocalDateTime . now () + \",\u7aef\u53e3\u53f7\" + appPort ); return ReturnT . SUCCESS ; } } @XxlJob(\"helloJob\") \u8fd9\u4e2a\u4e00\u5b9a\u8981\u4e0e\u8c03\u5ea6\u4e2d\u5fc3\u65b0\u5efa\u4efb\u52a1\u7684JobHandler\u7684\u503c\u4fdd\u6301\u4e00\u81f4,\u5982\u4e0b\u56fe\uff1a 11-\u6d4b\u8bd5 07:15 \u00b6 \uff081\uff09\u9996\u5148\u542f\u52a8\u8c03\u5ea6\u4e2d\u5fc3 \uff082\uff09\u542f\u52a8xxl-job-demo\u9879\u76ee\uff0c\u4e3a\u4e86\u5c55\u793a\u66f4\u597d\u7684\u6548\u679c\uff0c\u53ef\u4ee5\u540c\u65f6\u542f\u52a8\u4e09\u4e2a\u9879\u76ee\uff0c\u7528\u540c\u4e00\u4e2aJobHandler\uff0c\u67e5\u770b\u5904\u7406\u65b9\u5f0f\u3002 \u5728\u542f\u52a8\u591a\u4e2a\u9879\u76ee\u7684\u65f6\u5019\uff0c\u7aef\u53e3\u9700\u8981\u5207\u6362\uff0c\u8fde\u63a5xxl-job\u7684\u6267\u884c\u5668\u7aef\u53e3\u4e0d\u540c\u76f8\u540c \u670d\u52a1\u4e00\uff1a\u9ed8\u8ba4\u542f\u52a88801\u7aef\u53e3\uff0c\u6267\u884c\u5668\u7aef\u53e3\u4e3a9999 idea\u4e2d\u4e0d\u7528\u5176\u4ed6\u914d\u7f6e\uff0c\u76f4\u63a5\u542f\u52a8\u9879\u76ee\u5373\u53ef \u670d\u52a1\u4e8c\uff1a\u9879\u76ee\u7aef\u53e3\uff1a8802\uff0c\u6267\u884c\u5668\u7aef\u53e3\uff1a9998 idea\u914d\u7f6e\u5982\u4e0b\uff1a \u7f16\u8f91\u914d\u7f6e\uff0cEdit Configurations... \u9009\u4e2dXxlJobApplication\uff0c\u70b9\u51fb\u590d\u5236 \u4fee\u6539\u53c2\u6570 \u542f\u52a8\uff1a\u9009\u4e2d8802\u542f\u52a8\u9879\u76ee \u670d\u52a1\u4e09\uff1a\u9879\u76ee\u7aef\u53e3\uff1a8803\uff0c\u6267\u884c\u5668\u7aef\u53e3\uff1a9997 \uff083\uff09\u6d4b\u8bd5\u6548\u679c \u4e09\u4e2a\u9879\u76ee\u542f\u52a8\u540e\uff0c\u53ef\u4ee5\u67e5\u770b\u5230\u662f\u8f6e\u8be2\u7684\u65b9\u5f0f\u5206\u522b\u53bb\u6267\u884c\u5f53\u524d\u8c03\u5ea6\u4efb\u52a1\u3002 12-\u5b9a\u65f6\u626b\u63cf\u5f85\u53d1\u5e03\u6587\u7ae0-\u6570\u636e\u51c6\u5907 10:18 \u00b6 \u524d\u671f\u56de\u987e\uff1a\u5728\u81ea\u5a92\u4f53\u6587\u7ae0\u5ba1\u6838\u7684\u65f6\u5019\uff0c\u5ba1\u6838\u901a\u8fc7\u540e\uff0c\u5224\u65ad\u4e86\u6587\u7ae0\u7684\u53d1\u5e03\u65f6\u95f4\u5927\u4e8e\u5f53\u524d\u65f6\u95f4\uff0c\u8fd9\u4e2a\u65f6\u5019\u5e76\u6ca1\u6709\u771f\u6b63\u7684\u53d1\u5e03\u6587\u7ae0\uff0c\u800c\u662f\u628a\u6587\u7ae0\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3a\u4e868\uff08\u5ba1\u6838\u901a\u8fc7\u5f85\u53d1\u5e03\uff09 \u5b9a\u65f6\u4efb\u52a1\u7684\u4f5c\u7528\u5c31\u662f\u6bcf\u5206\u949f\u53bb\u626b\u63cf\u8fd9\u4e9b\u5f85\u53d1\u5e03\u7684\u6587\u7ae0\uff0c\u5982\u679c\u5f53\u524d\u6587\u7ae0\u7684\u72b6\u6001\u4e3a8\uff0c\u5e76\u4e14\u53d1\u5e03\u65f6\u95f4\u5c0f\u4e8e\u5f53\u524d\u65f6\u95f4\u7684\uff0c\u7acb\u523b\u53d1\u5e03\u5f53\u524d\u6587\u7ae0 \u81ea\u52a8\u5ba1\u6838\u7684\u4ee3\u7801\u90fd\u662f\u901a\u8fc7\u81ea\u5a92\u4f53\u6587\u7ae0\u7684id\u8fdb\u884c\u5ba1\u6838\u7684\uff0c\u8fd9\u4e2a\u65f6\u5019\u9700\u8981\u5728admin\u7aef\u8fdc\u7a0b\u8c03\u7528\u81ea\u5a92\u4f53\u7aef\u67e5\u8be2\u6587\u7ae0\u72b6\u6001\u4e3a8\u4e14\u53d1\u5e03\u65f6\u95f4\u5c0f\u4e8e\u5f53\u524d\u65f6\u95f4\u7684\u6587\u7ae0id\u5217\u8868 \uff081\uff09\u4fee\u6539WmNewsControllerApi\u63a5\u53e3\uff0c\u65b0\u589e\u65b9\u6cd5 /** * \u67e5\u8be2\u9700\u8981\u53d1\u5e03\u7684\u6587\u7ae0id\u5217\u8868 * @return */ List < Integer > findRelease (); (2)\u4e1a\u52a1\u5c42 \u5728\u81ea\u5a92\u4f53\u5fae\u670d\u52a1\u4e2d\u7684WmNewsService\u65b0\u589e\u65b9\u6cd5 /** * \u67e5\u8be2\u9700\u8981\u53d1\u5e03\u7684\u6587\u7ae0id\u5217\u8868 * @return */ List < Integer > findRelease (); \u5b9e\u73b0\u65b9\u6cd5\uff1a /** * \u67e5\u8be2\u9700\u8981\u53d1\u5e03\u7684\u6587\u7ae0id\u5217\u8868 * @return */ @Override public List < Integer > findRelease (){ List < WmNews > list = list ( Wrappers . < WmNews > lambdaQuery (). eq ( WmNews :: getStatus , 8 ). lt ( WmNews :: getPublishTime , new Date ())); List < Integer > resultList = list . stream (). map ( WmNews :: getId ). collect ( Collectors . toList ()); return resultList ; } (3)\u63a7\u5236\u5668 WmNewsController\u4e2d\u65b0\u589e\u65b9\u6cd5 @GetMapping ( \"/findRelease\" ) @Override public List < Integer > findRelease () { return wmNewsService . findRelease (); } \uff084\uff09\u5728admin\u7aef\u6dfb\u52a0\u8fdc\u7a0b\u8c03\u7528feign\u63a5\u53e3 \u4fee\u6539WemediaFeign\u63a5\u53e3\u6dfb\u52a0\u65b9\u6cd5 @GetMapping ( \"/api/v1/news/findRelease\" ) List < Integer > findRelease (); 13-\u521b\u5efa\u4efb\u52a1 12:44 \u00b6 \u8bb2\u4e49\u4e2d\u7684setAppName\u4fee\u6539\u4e3asetAppname 14-\u6d4b\u8bd5 03:39 \u00b6 cron\u8868\u8fbe\u5f0f\u7f16\u5199\u6709\u8bef 0 0 / 1 * * * ? \u4ece0\u5206\u5f00\u59cb\uff0c\u6bcf\u96941\u5206\u949f\u6267\u884c\u4e00\u6b21 15-\u4eba\u5de5\u5ba1\u6838\u6587\u7ae0 \u9700\u6c42\u8bf4\u660e 03:34 \u00b6 \u5e73\u53f0\u7ba1\u7406\u5458\u53ef\u4ee5\u67e5\u770b\u5f85\u4eba\u5de5\u5ba1\u6838\u7684\u6587\u7ae0\u4fe1\u606f\uff0c\u53ef\u4ee5 \u901a\u8fc7\uff08\u72b6\u6001\u6539\u4e3a4\uff09 \u6216 \u9a73\u56de\uff08\u72b6\u6001\u6539\u4e3a2\uff09 \u4e5f\u53ef\u4ee5\u901a\u8fc7\u70b9\u51fb \u67e5\u770b \u6309\u94ae\uff0c\u67e5\u770b\u6587\u7ae0\u8be6\u7ec6\u4fe1\u606f\uff0c\u67e5\u770b\u8be6\u60c5\u540e\u53ef\u4ee5\u6839\u636e\u5185\u5bb9\u5224\u65ad\u662f\u5426\u9700\u8981\u901a\u8fc7\u5ba1\u6838 16-\u63a5\u53e3\u5b9a\u4e49\u53camapper 13:51 \u00b6 1 \u9700\u8981\u5206\u9875\u67e5\u8be2\u81ea\u5a92\u4f53\u6587\u7ae0\u4fe1\u606f\uff0c\u53ef\u4ee5\u6839\u636e\u6807\u9898\u6a21\u7cca\u67e5\u8be2 2 \u9700\u8981\u6839\u636e\u6587\u7ae0id\u67e5\u770b\u6587\u7ae0\u7684\u8be6\u60c5 3 \u4fee\u6539\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5df2\u5b9e\u73b0 17-\u4e1a\u52a1\u5c42\u5b9e\u73b0\u53ca\u6d4b\u8bd5 12:24 \u00b6 @Autowired private WmNewsMapper wmNewsMapper ; public PageResponseResult findListAndPage ( NewsAuthDto dto ){ //1.\u68c0\u67e5\u53c2\u6570 dto . checkParam (); //\u8bbe\u7f6e\u8d77\u59cb\u9875 dto . setPage (( dto . getPage () - 1 ) * dto . getSize ()); //dto.setTitle(\"%\"+dto.getTitle()+\"%\"); //\u9700\u8981\u5224\u65ad\u662f\u5426\u4e3a\u7a7a,\u5728SQL\u4e2d\u4f7f\u7528concat\u62fc\u63a5\u4e5f\u53ef\u4ee5 null -> \"%null%\" if ( StringUtils . isNotBlank ( dto . getTitle ())){ dto . setTitle ( \"%\" + dto . getTitle () + \"%\" ); } //2.\u5206\u9875\u67e5\u8be2 List < WmNews > list = wmNewsMapper . findListAndPage ( dto ); //\u7edf\u8ba1\u591a\u5c11\u6761\u6570\u636e int count = wmNewsMapper . findListCount ( dto ); //3.\u7ed3\u679c\u8fd4\u56de PageResponseResult responseResult = new PageResponseResult ( dto . getPage (), dto . getSize (), count ); responseResult . setData ( list ); return responseResult ; } @Autowired private WmUserMapper wmUserMapper ; @Override public WmNewsVo findWmNewsVo ( Integer id ) { //1.\u67e5\u8be2\u6587\u7ae0\u4fe1\u606f WmNews wmNews = getById ( id ); //2.\u67e5\u8be2\u4f5c\u8005 WmUser wmUser = null ; if ( wmNews != null && wmNews . getUserId () != null ){ wmUser = wmUserMapper . selectById ( wmNews . getUserId ()); } //3.\u5c01\u88c5vo\u4fe1\u606f\u8fd4\u56de WmNewsVo wmNewsVo = new WmNewsVo (); BeanUtils . copyProperties ( wmNews , wmNewsVo ); if ( wmUser != null ){ wmNewsVo . setAuthorName ( wmUser . getName ()); } return wmNewsVo ; } \u6269\u5c55\uff1amybatis-plus\u4f7f\u7528mapper\u6620\u5c04\u6587\u4ef6\u5982\u4f55\u5b9e\u73b0\u66f4\u4f18\u96c5\u7684\u5206\u9875\uff1f \u00b6 @Override public PageResponseResult findList ( NewsAuthDto dto ) { //1.\u68c0\u67e5\u5206\u9875\u53c2\u6570 dto . checkParam (); //2.\u8bbe\u7f6e\u5206\u9875\u6761\u4ef6 dto . setPage (( dto . getPage () - 1 ) * dto . getSize ()); if ( StringUtils . isNotBlank ( dto . getTitle ())){ dto . setTitle ( \"%\" + dto . getTitle () + \"%\" ); } //3.\u5206\u9875\u67e5\u8be2 //List<WmNewsVo> list = wmNewsMapper.findListAndPage(dto); IPage < WmNewsVo > wmNewsVoIPage = wmNewsMapper . selectPageVo ( new Page <> ( dto . getPage (), dto . getSize ()), dto ); //\u7edf\u8ba1\u6570\u636e //int count = wmNewsMapper.findListCount(dto); //4.\u7ed3\u679c\u8fd4\u56de PageResponseResult pageResponseResult = new PageResponseResult ( dto . getPage (), dto . getSize () , Integer . parseInt ( String . valueOf ( wmNewsVoIPage . getTotal ()))); pageResponseResult . setData ( wmNewsVoIPage . getRecords ()); return pageResponseResult ; } mapper: /** * <p> * \u67e5\u8be2 : \u6839\u636estate\u72b6\u6001\u67e5\u8be2\u7528\u6237\u5217\u8868\uff0c\u5206\u9875\u663e\u793a * </p> * * @param page \u5206\u9875\u5bf9\u8c61,xml\u4e2d\u53ef\u4ee5\u4ece\u91cc\u9762\u8fdb\u884c\u53d6\u503c,\u4f20\u9012\u53c2\u6570 Page \u5373\u81ea\u52a8\u5206\u9875,\u5fc5\u987b\u653e\u5728\u7b2c\u4e00\u4f4d(\u4f60\u53ef\u4ee5\u7ee7\u627fPage\u5b9e\u73b0\u81ea\u5df1\u7684\u5206\u9875\u5bf9\u8c61) * @return \u5206\u9875\u5bf9\u8c61 */ public IPage < WmNewsVo > selectPageVo ( Page <?> page , @Param ( \"dto\" ) NewsAuthDto dto ); <select id= \"selectPageVo\" parameterType= \"com.heima.model.admin.dtos.NewsAuthDto\" resultType= \"com.heima.model.wemedia.vo.WmNewsVo\" > SELECT wn.*, wu.`name` authorName FROM wm_news wn LEFT JOIN wm_user wu ON wn.user_id = wu.id <where> <if test= \"dto.title != null and dto.title != ''\" > and wn.title like #{dto.title} </if> </where> </select> 18-admin\u63a5\u53e3\u5b9a\u4e49 04:25 \u00b6 1 \u9700\u8981\u5206\u9875\u67e5\u8be2\u81ea\u5a92\u4f53\u6587\u7ae0\u4fe1\u606f\uff0c\u53ef\u4ee5\u6839\u636e\u6807\u9898\u6a21\u7cca\u67e5\u8be2 2 \u5f53\u5ba1\u6838\u901a\u8fc7\u540e\uff0c\u4fee\u6539\u6587\u7ae0\u72b6\u6001\u4e3a4 3 \u5f53\u5ba1\u6838\u9a73\u56de\u540e\uff0c\u4fee\u6539\u6587\u7ae0\u72b6\u6001\u4e3a2(\u8bb2\u4e49\u4e2d\u4e3a3\uff0c\u9519\u8bef)\uff0c\u5e76\u4e14\u9700\u8981\u8bf4\u660e\u539f\u56e0 4 \u9700\u8981\u6839\u636e\u6587\u7ae0id\u67e5\u770b\u6587\u7ae0\u7684\u8be6\u60c5 package com.heima.apis.admin ; import com.heima.model.admin.dtos.NewsAuthDto ; import com.heima.model.common.dtos.ResponseResult ; public interface NewsAuthControllerApi { /** * \u67e5\u8be2\u81ea\u5a92\u4f53\u6587\u7ae0\u5217\u8868 * @param dto * @return */ public ResponseResult findNews ( NewsAuthDto dto ); /** * \u67e5\u8be2\u6587\u7ae0\u8be6\u60c5 * @param id * @return */ public ResponseResult findOne ( Integer id ); /** * \u6587\u7ae0\u5ba1\u6838\u6210\u529f * @param dto * @return */ public ResponseResult authPass ( NewsAuthDto dto ); /** * \u6587\u7ae0\u5ba1\u6838\u5931\u8d25 * @param dto * @return */ public ResponseResult authFail ( NewsAuthDto dto ); } 19-admin\u4e1a\u52a1\u5b9e\u73b0 13:05 \u00b6 @Override public PageResponseResult findNews ( NewsAuthDto dto ) { //\u5206\u9875\u67e5\u8be2 PageResponseResult responseResult = wemediaFeign . findList ( dto ); //\u8fd4\u56de\u7684\u6570\u636e\u4e2d\u6709\u56fe\u7247\u9700\u8981\u663e\u793a\uff0c\u9700\u8981\u56de\u663e\u4e00\u4e2afasfdfs\u670d\u52a1\u5668\u7684\u5730\u5740 responseResult . setHost ( fileServerUrl ); return responseResult ; } @Override public ResponseResult findOne ( Integer id ) { //1.\u53c2\u6570\u68c0\u67e5 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u6570\u636e WmNewsVo wmNewsVo = wemediaFeign . findWmNewsVo ( id ); //3.\u7ed3\u679c\u5c01\u88c5 ResponseResult responseResult = ResponseResult . okResult ( wmNewsVo ); responseResult . setHost ( fileServerUrl ); return responseResult ; } @Override public ResponseResult updateStatus ( NewsAuthDto dto , Integer type ) { //1.\u53c2\u6570\u68c0\u67e5 if ( dto == null || dto . getId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u6587\u7ae0\u4fe1\u606f WmNews wmNews = wemediaFeign . findById ( dto . getId ()); if ( wmNews == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST ); } //3.\u5ba1\u6838\u5931\u8d25 if ( type . equals ( 0 )){ updateWmNews ( wmNews ,( short ) 2 , dto . getMsg ()); } else if ( type . equals ( 1 )){ //4.\u5ba1\u6838\u6210\u529f updateWmNews ( wmNews ,( short ) 4 , \"\u4eba\u5de5\u5ba1\u6838\u901a\u8fc7\" ); } return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } bug\u89e3\u51b3\uff1a \u4eba\u5de5\u5ba1\u6838\u4e4b\u540e\uff0c\u65e0\u6cd5\u5c06\u6587\u7ae0\u8fdb\u884c\u53d1\u5e03 package com.heima.admin.service.impl ; import com.alibaba.fastjson.JSONArray ; import com.heima.admin.feign.ArticleFeign ; import com.heima.admin.feign.WemediaFeign ; import com.heima.admin.mapper.AdChannelMapper ; import com.heima.admin.mapper.AdSensitiveMapper ; import com.heima.admin.service.WemediaNewsAutoScanService ; import com.heima.common.aliyun.GreeTextScan ; import com.heima.common.aliyun.GreenImageScan ; import com.heima.common.fastdfs.FastDFSClient ; import com.heima.model.admin.dtos.NewsAuthDto ; import com.heima.model.admin.pojos.AdChannel ; import com.heima.model.article.pojos.ApArticle ; import com.heima.model.article.pojos.ApArticleConfig ; import com.heima.model.article.pojos.ApArticleContent ; import com.heima.model.article.pojos.ApAuthor ; import com.heima.model.common.dtos.PageResponseResult ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.wemedia.pojos.WmNews ; import com.heima.model.wemedia.pojos.WmUser ; import com.heima.model.wemedia.vo.WmNewsVo ; import com.heima.utils.common.SensitiveWordUtil ; import io.seata.spring.annotation.GlobalTransactional ; import lombok.extern.log4j.Log4j2 ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.stereotype.Service ; import java.util.* ; @Service @Log4j2 public class WemediaNewsAutoScanServiceImpl implements WemediaNewsAutoScanService { @Autowired private WemediaFeign wemediaFeign ; @GlobalTransactional //@Override public void autoScanByMediaNewsId ( Integer id ) { if ( id == null ) { log . error ( \"\u5f53\u524d\u7684\u5ba1\u6838id\u7a7a\" ); return ; } //1.\u6839\u636eid\u67e5\u8be2\u81ea\u5a92\u4f53\u6587\u7ae0\u4fe1\u606f WmNews wmNews = wemediaFeign . findById ( id ); if ( wmNews == null ) { log . error ( \"\u5ba1\u6838\u7684\u81ea\u5a92\u4f53\u6587\u7ae0\u4e0d\u5b58\u5728\uff0c\u81ea\u5a92\u4f53\u7684id:{}\" , id ); return ; } //2.\u6587\u7ae0\u72b6\u6001\u4e3a4\uff08\u4eba\u5de5\u5ba1\u6838\u901a\u8fc7\uff09\u76f4\u63a5\u4fdd\u5b58\u6570\u636e\u548c\u521b\u5efa\u7d22\u5f15 if ( wmNews . getStatus () == 4 ) { if ( wmNews . getPublishTime (). getTime () <= System . currentTimeMillis ()){ //\u5df2\u7ecf\u5230\u4e86\u53d1\u5e03\u65f6\u95f4 //\u4fdd\u5b58\u6570\u636e saveAppArticle ( wmNews ); } else { updateWmNews ( wmNews , ( short ) 8 , \"\" ); } return ; } //3.\u6587\u7ae0\u72b6\u6001\u4e3a8 \u53d1\u5e03\u65f6\u95f4\u5c0f\u4e8e\u7b49\u4e8e\u5f53\u524d\u65f6\u95f4 \u76f4\u63a5\u4fdd\u5b58\u6570\u636e if ( wmNews . getStatus () == 8 && wmNews . getPublishTime (). getTime () <= System . currentTimeMillis ()) { //\u4fdd\u5b58\u6570\u636e saveAppArticle ( wmNews ); return ; } //4.\u6587\u7ae0\u72b6\u6001\u4e3a1\uff0c\u5f85\u5ba1\u6838 if ( wmNews . getStatus () == 1 ) { //\u62bd\u53d6\u6587\u7ae0\u5185\u5bb9\u4e2d\u7684\u7eaf\u6587\u672c\u548c\u56fe\u7247 Map < String , Object > contentAndImagesResult = handleTextAndImages ( wmNews ); //4.1 \u6587\u672c\u5ba1\u6838 boolean textScanBoolean = handleTextScan (( String ) contentAndImagesResult . get ( \"content\" ), wmNews ); if ( ! textScanBoolean ) return ; //4.2 \u56fe\u7247\u5ba1\u6838 boolean imagesScanBoolean = handleImagesScan (( List < String > ) contentAndImagesResult . get ( \"images\" ), wmNews ); if ( ! imagesScanBoolean ) return ; //4.3 \u81ea\u7ba1\u7406\u7684\u654f\u611f\u8bcd\u5ba1\u6838 boolean sensitiveScanBoolean = handleSensitive (( String ) contentAndImagesResult . get ( \"content\" ), wmNews ); if ( ! sensitiveScanBoolean ) return ; //4.4 \u53d1\u5e03\u65f6\u95f4\u5927\u4e8e\u5f53\u524d\u65f6\u95f4\uff0c if ( wmNews . getPublishTime (). getTime () > System . currentTimeMillis ()) { //\u4fee\u6539\u6587\u7ae0\u72b6\u6001\u4e3a8 updateWmNews ( wmNews , ( short ) 8 , \"\u5ba1\u6838\u901a\u8fc7\uff0c\u5f85\u53d1\u5e03\" ); return ; } //5.\u5ba1\u6838\u901a\u8fc7\uff0c\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u72b6\u6001\u4e3a9 \u4fdd\u5b58app\u7aef\u76f8\u5173\u6587\u7ae0\u4fe1\u606f saveAppArticle ( wmNews ); } } @Autowired private AdSensitiveMapper adSensitiveMapper ; /** * \u654f\u611f\u8bcd\u5ba1\u6838 * * @param content * @param wmNews * @param wmNews * @return */ private boolean handleSensitive ( String content , WmNews wmNews ) { boolean flag = true ; List < String > allSensitive = adSensitiveMapper . findAllSensitive (); //\u521d\u59cb\u5316\u654f\u611f\u8bcd SensitiveWordUtil . initMap ( allSensitive ); //\u6587\u7ae0\u5185\u5bb9\u81ea\u7ba1\u7406\u654f\u611f\u8bcd\u8fc7\u6ee4 Map < String , Integer > resultMap = SensitiveWordUtil . matchWords ( content ); if ( resultMap . size () > 0 ) { log . error ( \"\u654f\u611f\u8bcd\u8fc7\u6ee4\u6ca1\u6709\u901a\u8fc7\uff0c\u5305\u542b\u4e86\u654f\u611f\u8bcd:{}\" , resultMap ); //\u627e\u5230\u4e86\u654f\u611f\u8bcd\uff0c\u5ba1\u6838\u4e0d\u901a\u8fc7 updateWmNews ( wmNews , ( short ) 2 , \"\u6587\u7ae0\u4e2d\u5305\u542b\u4e86\u654f\u611f\u8bcd\" ); flag = false ; } return flag ; } @Autowired private GreenImageScan greenImageScan ; @Autowired private FastDFSClient fastDFSClient ; @Value ( \"${fdfs.url}\" ) private String fileServerUrl ; /** * \u5ba1\u6838\u56fe\u7247 * * @param images * @param wmNews * @param wmNews * @return */ private boolean handleImagesScan ( List < String > images , WmNews wmNews ) { if ( images == null ) { return true ; } boolean flag = true ; List < byte []> imageList = new ArrayList <> (); try { for ( String image : images ) { String imageName = image . replace ( fileServerUrl , \"\" ); int index = imageName . indexOf ( \"/\" ); String groupName = imageName . substring ( 0 , index ); String imagePath = imageName . substring ( index + 1 ); byte [] imageByte = fastDFSClient . download ( groupName , imagePath ); imageList . add ( imageByte ); } //\u963f\u91cc\u4e91\u56fe\u7247\u5ba1\u6838 Map map = greenImageScan . imageScan ( imageList ); //\u5ba1\u6838\u4e0d\u901a\u8fc7 if ( ! map . get ( \"suggestion\" ). equals ( \"pass\" )) { //\u5ba1\u6838\u5931\u8d25 if ( map . get ( \"suggestion\" ). equals ( \"block\" )) { //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 updateWmNews ( wmNews , ( short ) 2 , \"\u6587\u7ae0\u4e2d\u56fe\u7247\u6709\u8fdd\u89c4\" ); flag = false ; } //\u4eba\u5de5\u5ba1\u6838 if ( map . get ( \"suggestion\" ). equals ( \"review\" )) { //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 updateWmNews ( wmNews , ( short ) 3 , \"\u6587\u7ae0\u56fe\u7247\u6709\u4e0d\u786e\u5b9a\u5143\u7d20\" ); flag = false ; } } } catch ( Exception e ) { e . printStackTrace (); flag = false ; } return flag ; } @Autowired private GreeTextScan greeTextScan ; /** * \u6587\u672c\u5ba1\u6838 * * @param content * @param wmNews * @return */ private boolean handleTextScan ( String content , WmNews wmNews ) { boolean flag = true ; try { Map map = greeTextScan . greeTextScan ( content ); //\u5ba1\u6838\u4e0d\u901a\u8fc7 if ( ! map . get ( \"suggestion\" ). equals ( \"pass\" )) { //\u5ba1\u6838\u5931\u8d25 if ( map . get ( \"suggestion\" ). equals ( \"block\" )) { //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 updateWmNews ( wmNews , ( short ) 2 , \"\u6587\u7ae0\u5185\u5bb9\u4e2d\u6709\u654f\u611f\u8bcd\u6c47\" ); flag = false ; } //\u4eba\u5de5\u5ba1\u6838 if ( map . get ( \"suggestion\" ). equals ( \"review\" )) { //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 updateWmNews ( wmNews , ( short ) 3 , \"\u6587\u7ae0\u5185\u5bb9\u4e2d\u6709\u4e0d\u786e\u5b9a\u8bcd\u6c47\" ); flag = false ; } } } catch ( Exception e ) { e . printStackTrace (); flag = false ; } return flag ; } /** * \u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0 * * @param wmNews * @param status * @param msg */ private void updateWmNews ( WmNews wmNews , short status , String msg ) { wmNews . setStatus ( status ); wmNews . setReason ( msg ); wemediaFeign . updateWmNews ( wmNews ); } /** * \u63d0\u53d6\u6587\u672c\u5185\u5bb9\u548c\u56fe\u7247 * * @param wmNews * @return */ private Map < String , Object > handleTextAndImages ( WmNews wmNews ) { //\u6587\u7ae0\u7684\u5185\u5bb9 String content = wmNews . getContent (); //\u5b58\u50a8\u7eaf\u6587\u672c\u5185\u5bb9 StringBuilder sb = new StringBuilder (); //\u5b58\u50a8\u56fe\u7247 List < String > images = new ArrayList <> (); List < Map > contentList = JSONArray . parseArray ( content , Map . class ); for ( Map map : contentList ) { if ( map . get ( \"type\" ). equals ( \"text\" )) { sb . append ( map . get ( \"value\" )); } if ( map . get ( \"type\" ). equals ( \"image\" )) { images . add (( String ) map . get ( \"value\" )); } } if ( wmNews . getImages () != null && wmNews . getType () != 0 ) { String [] split = wmNews . getImages (). split ( \",\" ); images . addAll ( Arrays . asList ( split )); } Map < String , Object > resultMap = new HashMap <> (); resultMap . put ( \"content\" , sb . toString ()); resultMap . put ( \"images\" , images ); return resultMap ; } @Autowired ArticleFeign articleFeign ; /** * \u4fdd\u5b58app\u6587\u7ae0\u76f8\u5173\u7684\u6570\u636e * * @param wmNews */ private void saveAppArticle ( WmNews wmNews ) { //\u4fdd\u5b58app\u6587\u7ae0 ApArticle apArticle = saveArticle ( wmNews ); //\u4fdd\u5b58app\u6587\u7ae0\u914d\u7f6e saveArticleConfig ( apArticle ); //\u4fdd\u5b58app\u6587\u7ae0\u5185\u5bb9 saveArticleContent ( apArticle , wmNews ); //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\u4e3a9 wmNews . setArticleId ( apArticle . getId ()); updateWmNews ( wmNews , ( short ) 9 , \"\u5ba1\u6838\u901a\u8fc7\" ); //TODO es\u7d22\u5f15\u521b\u5efa } /** * \u521b\u5efaapp\u7aef\u6587\u7ae0\u5185\u5bb9\u4fe1\u606f * * @param apArticle * @param wmNews */ private void saveArticleContent ( ApArticle apArticle , WmNews wmNews ) { ApArticleContent apArticleContent = new ApArticleContent (); apArticleContent . setArticleId ( apArticle . getId ()); apArticleContent . setContent ( wmNews . getContent ()); articleFeign . saveArticleContent ( apArticleContent ); } /** * \u521b\u5efaapp\u7aef\u6587\u7ae0\u914d\u7f6e\u4fe1\u606f * * @param apArticle */ private void saveArticleConfig ( ApArticle apArticle ) { ApArticleConfig apArticleConfig = new ApArticleConfig (); apArticleConfig . setArticleId ( apArticle . getId ()); apArticleConfig . setIsForward ( true ); apArticleConfig . setIsDelete ( false ); apArticleConfig . setIsDown ( true ); apArticleConfig . setIsComment ( true ); articleFeign . saveArticleConfig ( apArticleConfig ); } @Autowired AdChannelMapper adChannelMapper ; /** * \u4fdd\u5b58\u6587\u7ae0 * * @param wmNews * @return */ private ApArticle saveArticle ( WmNews wmNews ) { ApArticle apArticle = new ApArticle (); apArticle . setTitle ( wmNews . getTitle ()); apArticle . setLayout ( wmNews . getType ()); apArticle . setImages ( wmNews . getImages ()); apArticle . setCreatedTime ( new Date ()); //\u83b7\u53d6\u4f5c\u8005\u76f8\u5173\u4fe1\u606f Integer wmUserId = wmNews . getUserId (); WmUser wmUser = wemediaFeign . findWmUserById ( wmUserId ); if ( wmUser != null ) { String wmUserName = wmUser . getName (); ApAuthor apAuthor = articleFeign . selectAuthorByName ( wmUserName ); if ( apAuthor != null ) { apArticle . setAuthorId ( apAuthor . getId (). longValue ()); apArticle . setAuthorName ( apAuthor . getName ()); } } //\u83b7\u53d6\u9891\u9053\u76f8\u5173\u4fe1\u606f Integer channelId = wmNews . getChannelId (); AdChannel channel = adChannelMapper . selectById ( channelId ); if ( channel != null ) { apArticle . setChannelId ( channel . getId ()); apArticle . setChannelName ( channel . getName ()); } return articleFeign . saveAparticle ( apArticle ); } @Override public PageResponseResult findNews ( NewsAuthDto dto ) { //\u5206\u9875\u67e5\u8be2 PageResponseResult responseResult = wemediaFeign . findList ( dto ); //\u8fd4\u56de\u7684\u6570\u636e\u4e2d\u6709\u56fe\u7247\u9700\u8981\u663e\u793a\uff0c\u9700\u8981\u56de\u663e\u4e00\u4e2afasfdfs\u670d\u52a1\u5668\u7684\u5730\u5740 responseResult . setHost ( fileServerUrl ); return responseResult ; } @Override public ResponseResult findOne ( Integer id ) { //1.\u53c2\u6570\u68c0\u67e5 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u6570\u636e WmNewsVo wmNewsVo = wemediaFeign . findWmNewsVo ( id ); //3.\u7ed3\u679c\u5c01\u88c5 ResponseResult responseResult = ResponseResult . okResult ( wmNewsVo ); responseResult . setHost ( fileServerUrl ); return responseResult ; } @Override public ResponseResult updateStatus ( NewsAuthDto dto , Integer type ) { //1.\u53c2\u6570\u68c0\u67e5 if ( dto == null || dto . getId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u6587\u7ae0\u4fe1\u606f WmNews wmNews = wemediaFeign . findById ( dto . getId ()); if ( wmNews == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST ); } //3.\u5ba1\u6838\u5931\u8d25 if ( type . equals ( 0 )){ updateWmNews ( wmNews ,( short ) 2 , dto . getMsg ()); } else if ( type . equals ( 1 )){ //4.\u5ba1\u6838\u6210\u529f updateWmNews ( wmNews ,( short ) 4 , \"\u4eba\u5de5\u5ba1\u6838\u901a\u8fc7\" ); //\u4eba\u5de5\u5ba1\u6838\u901a\u8fc7\u4e4b\u540e\uff0c\u518d\u6b21\u6267\u884c\u81ea\u52a8\u5ba1\u6838\u4ee3\u7801 autoScanByMediaNewsId ( dto . getId ()); } return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } } 20-\u7efc\u5408\u6d4b\u8bd5 02:44 \u00b6 21-\u6587\u7ae0\u4e0a\u4e0b\u67b6 05:31 \u00b6 \u5728\u81ea\u5a92\u4f53\u6587\u7ae0\u7ba1\u7406\u4e2d\u6709\u6587\u7ae0\u4e0a\u4e0b\u67b6\u7684\u64cd\u4f5c\uff0c\u4e0a\u4e0b\u67b6\u662f\u6587\u7ae0\u5df2\u7ecf\u5ba1\u6838\u901a\u8fc7\u53d1\u5e03\u4e4b\u540e\u7684\u6587\u7ae0\uff0c\u76ee\u524d\u81ea\u52a8\u5ba1\u6838\u6587\u7ae0\u548c\u4eba\u5de5\u5ba1\u6838\u6587\u7ae0\u90fd\u5df2\u5b8c\u6210\uff0c\u53ef\u4ee5\u628a\u4e4b\u524d\u4ee3\u7801\u8865\u5145\uff0c\u4f7f\u7528\u5f02\u6b65\u7684\u65b9\u5f0f\uff0c\u4fee\u6539app\u7aef\u6587\u7ae0\u7684 \u914d\u7f6e\u4fe1\u606f \u5373\u53ef\u3002 \u4fee\u6539article\u6570\u636e\u5e93\u4e2dap_article_config\u8868\u7684is_down\u5b57\u6bb5\uff1a \u4e0b\u67b6\u64cd\u4f5c\uff0c\u5c06\u503c\u6539\u4e3a1 \u4e0a\u67b6\u64cd\u4f5c\uff0c\u5c06\u503c\u6539\u4e3a0 22-\u529f\u80fd\u5b9e\u73b0 10:28 \u00b6 \u6d88\u606f\u53d1\u9001\u65b9:wmnews @Override public ResponseResult downOrUp ( WmNewsDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || dto . getId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u6587\u7ae0 WmNews wmNews = getById ( dto . getId ()); if ( wmNews == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u6587\u7ae0\u4e0d\u5b58\u5728\" ); } //3.\u5224\u65ad\u6587\u7ae0\u662f\u5426\u53d1\u5e03 if ( ! wmNews . getStatus (). equals ( WmNews . Status . PUBLISHED . getCode ())){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u5f53\u524d\u6587\u7ae0\u4e0d\u662f\u53d1\u5e03\u72b6\u6001\uff0c\u4e0d\u80fd\u4e0a\u4e0b\u67b6\" ); } //4.\u4fee\u6539\u6587\u7ae0\u72b6\u6001\uff0c\u540c\u6b65\u5230app\u7aef\uff08\u540e\u671f\u505a\uff09TODO if ( dto . getEnable () != null && dto . getEnable () > - 1 && dto . getEnable () < 2 ){ if ( wmNews . getArticleId () != null ){ Map < String , Object > map = new HashMap <> (); //\u4e0a\u4e0b\u67b6\u53c2\u6570 map . put ( \"enable\" , dto . getEnable ()); map . put ( \"articleId\" , wmNews . getArticleId ()); //\u53d1\u9001\u6d88\u606f\u5230kafka\uff0c\u53c2\u6570\u4e3amap\uff0ctopic\u662f\u65b0\u589e\u7684\u9700\u8981\u5b9a\u4e49\u5e38\u91cf kafkaTemplate . send ( WmNewsMessageConstants . WM_NEWS_UP_OR_DOWN_TOPIC , JSON . toJSONString ( map )); } update ( Wrappers . < WmNews > lambdaUpdate (). eq ( WmNews :: getId , dto . getId ()). set ( WmNews :: getEnable , dto . getEnable ())); } return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } \u6d88\u606f\u63a5\u6536\u65b9: article package com.heima.article.kafka.listener ; import com.alibaba.fastjson.JSON ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.article.service.ApArticleConfigService ; import com.heima.common.constans.message.WmNewsMessageConstants ; import com.heima.model.article.pojos.ApArticleConfig ; import org.apache.kafka.clients.consumer.ConsumerRecord ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.kafka.annotation.KafkaListener ; import org.springframework.stereotype.Component ; import java.util.Map ; import java.util.Optional ; @Component public class ArticleIsDownListener { @Autowired private ApArticleConfigService apArticleConfigService ; @KafkaListener ( topics = WmNewsMessageConstants . WM_NEWS_UP_OR_DOWN_TOPIC ) public void receiveMessage ( ConsumerRecord <? , ?> record ){ Optional <? extends ConsumerRecord <? , ?>> optional = Optional . ofNullable ( record ); //\u5224\u65ad\u6d88\u606f\u662f\u5426\u4e3a\u7a7a if ( optional . isPresent ()){ //\u83b7\u53d6\u4f20\u9012\u8fc7\u6765\u7684json\u5b57\u7b26\u4e32 String value = ( String ) record . value (); //\u53cd\u5e8f\u5217\u5316\u4e3amap\u5bf9\u8c61 Map map = JSON . parseObject ( value , Map . class ); apArticleConfigService . update ( Wrappers . < ApArticleConfig > lambdaUpdate () . eq ( ApArticleConfig :: getArticleId , map . get ( \"articleId\" )) . set ( ApArticleConfig :: getIsDown , map . get ( \"enable\" ))); } } }","title":"day08"},{"location":"hmtt/day08/#01-_0106","text":"\u80fd\u591f\u7406\u89e3\u4ec0\u4e48\u662f\u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6 \u80fd\u591f\u638c\u63e1xxl-job\u7684\u57fa\u672c\u4f7f\u7528 \u80fd\u591f\u4f7f\u7528xxl-job\u89e3\u51b3\u9ed1\u9a6c\u5934\u6761\u9879\u76ee\u4e2d\u5b9a\u65f6\u4efb\u52a1\u7684\u529f\u80fd \u80fd\u591f\u5b8c\u6210\u81ea\u5a92\u4f53\u6587\u7ae0\u4eba\u5de5\u5ba1\u6838\u529f\u80fd \u80fd\u591f\u5b8c\u6210\u81ea\u5a92\u4f53\u7aef\u6587\u7ae0\u4e0a\u4e0b\u67b6\u540c\u6b65\u7684\u95ee\u9898","title":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 01:06"},{"location":"hmtt/day08/#02-_0634","text":"\u6211\u4eec\u53ef\u4ee5\u5148\u601d\u8003\u4e00\u4e0b\u4e1a\u52a1\u573a\u666f\u7684\u89e3\u51b3\u65b9\u6848\uff1a \u67d0\u7535\u5546\u7cfb\u7edf\u9700\u8981\u5728\u6bcf\u5929\u4e0a\u534810\u70b9\uff0c\u4e0b\u53483\u70b9\uff0c\u665a\u4e0a8\u70b9\u53d1\u653e\u4e00\u6279\u4f18\u60e0\u5238\u3002 \u67d0\u94f6\u884c\u7cfb\u7edf\u9700\u8981\u5728\u4fe1\u7528\u5361\u5230\u671f\u8fd8\u6b3e\u65e5\u7684\u524d\u4e09\u5929\u8fdb\u884c\u77ed\u4fe1\u63d0\u9192\u3002 \u67d0\u8d22\u52a1\u7cfb\u7edf\u9700\u8981\u5728\u6bcf\u5929\u51cc\u66680:10\u7ed3\u7b97\u524d\u4e00\u5929\u7684\u8d22\u52a1\u6570\u636e\uff0c\u7edf\u8ba1\u6c47\u603b\u3002 12306\u4f1a\u6839\u636e\u8f66\u6b21\u7684\u4e0d\u540c\uff0c\u8bbe\u7f6e\u67d0\u51e0\u4e2a\u65f6\u95f4\u70b9\u8fdb\u884c\u5206\u6279\u653e\u7968\u3002 \u4ee5\u4e0a\u4e1a\u52a1\u573a\u666f\u7684\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u4efb\u52a1\u8c03\u5ea6\u3002 \u4efb\u52a1\u8c03\u5ea6\u662f\u6307\u7cfb\u7edf\u4e3a\u4e86\u81ea\u52a8\u5b8c\u6210\u7279\u5b9a\u4efb\u52a1\uff0c\u5728\u7ea6\u5b9a\u7684\u7279\u5b9a\u65f6\u523b\u53bb\u6267\u884c\u4efb\u52a1\u7684\u8fc7\u7a0b\u3002\u6709\u4e86\u4efb\u52a1\u8c03\u5ea6\u5373\u53ef\u89e3\u653e\u66f4\u591a\u7684\u4eba\u529b\uff0c\u800c\u662f\u7531\u7cfb\u7edf\u81ea\u52a8\u53bb\u6267\u884c\u4efb\u52a1\u3002 \u5982\u4f55\u5b9e\u73b0\u4efb\u52a1\u8c03\u5ea6\uff1f \u591a\u7ebf\u7a0b\u65b9\u5f0f\uff0c\u7ed3\u5408sleep JDK\u63d0\u4f9b\u7684API\uff0c\u4f8b\u5982\uff1aTimer\u3001ScheduledExecutor \u6846\u67b6\uff0c\u4f8b\u5982Quartz \uff0c\u5b83\u662f\u4e00\u4e2a\u529f\u80fd\u5f3a\u5927\u7684\u4efb\u52a1\u8c03\u5ea6\u6846\u67b6\uff0c\u53ef\u4ee5\u6ee1\u8db3\u66f4\u591a\u66f4\u590d\u6742\u7684\u8c03\u5ea6\u9700\u6c42 spring task \u5165\u95e8\u6848\u4f8b spring\u6846\u67b6\u4e2d\u9ed8\u8ba4\u5c31\u652f\u6301\u4e86\u4e00\u4e2a\u4efb\u52a1\u8c03\u5ea6\uff0cspring-task \uff081\uff09\u521b\u5efa\u4e00\u4e2a\u5de5\u7a0b\uff1aspring-task-demo pom\u6587\u4ef6 <!-- \u7ee7\u627fSpring boot\u5de5\u7a0b --> <parent> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-parent </artifactId> <version> 2.1.5.RELEASE </version> </parent> <dependencies> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-web </artifactId> </dependency> </dependencies> \uff082\uff09\u5f15\u5bfc\u7c7b\uff1a package com.itheima.task ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; import org.springframework.scheduling.annotation.EnableScheduling ; @SpringBootApplication @EnableScheduling public class TaskApplication { public static void main ( String [] args ) { SpringApplication . run ( TaskApplication . class , args ); } } (3)\u7f16\u5199\u6848\u4f8b package com.itheima.task.job ; import org.springframework.scheduling.annotation.Scheduled ; import org.springframework.stereotype.Component ; import java.util.Date ; @Component public class HelloJob { @Scheduled ( cron = \"0/5 * * * * ?\" ) public void eat (){ System . out . println ( \"5\u79d2\u4e2d\u5403\u4e00\u6b21\u996d\uff0c\u6211\u60f3\u6210\u4e3a\u4e00\u4e2a\u80d6\u5b50\" + new Date ()); } } \u6d4b\u8bd5\uff1a\u542f\u52a8\u9879\u76ee\uff0c\u6bcf\u96945\u79d2\u4e2d\u4f1a\u6267\u884c\u4e00\u6b21eat\u65b9\u6cd5","title":"02-\u4ec0\u4e48\u662f\u4efb\u52a1\u8c03\u5ea6 06:34"},{"location":"hmtt/day08/#03-cron_0803","text":"0 0 14 \uff1f 5 1 # 2 * \u79d2 \u5206 \u65f6 \u5929 \u6708 \u661f\u671f \u5e74 cron\u8868\u8fbe\u5f0f\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32, \u7528\u6765\u8bbe\u7f6e\u5b9a\u65f6\u89c4\u5219, \u7531\u4e03\u90e8\u5206\u7ec4\u6210, \u6bcf\u90e8\u5206\u4e2d\u95f4\u7528\u7a7a\u683c\u9694\u5f00, \u6bcf\u90e8\u5206\u7684\u542b\u4e49\u5982\u4e0b\u8868\u6240\u793a: \u7ec4\u6210\u90e8\u5206 \u542b\u4e49 \u53d6\u503c\u8303\u56f4 \u7b2c\u4e00\u90e8\u5206 Seconds (\u79d2) 0\uff0d59 \u7b2c\u4e8c\u90e8\u5206 Minutes(\u5206) 0\uff0d59 \u7b2c\u4e09\u90e8\u5206 Hours(\u65f6) 0-23 \u7b2c\u56db\u90e8\u5206 Day-of-Month(\u5929) 1-31 \u7b2c\u4e94\u90e8\u5206 Month(\u6708) 0-11\u6216JAN-DEC \u7b2c\u516d\u90e8\u5206 Day-of-Week(\u661f\u671f) 1-7(1\u8868\u793a\u661f\u671f\u65e5)\u6216SUN-SAT \u7b2c\u4e03\u90e8\u5206 Year(\u5e74) \u53ef\u9009 1970-2099 \u53e6\u5916, cron\u8868\u8fbe\u5f0f\u8fd8\u53ef\u4ee5\u5305\u542b\u4e00\u4e9b\u7279\u6b8a\u7b26\u53f7\u6765\u8bbe\u7f6e\u66f4\u52a0\u7075\u6d3b\u7684\u5b9a\u65f6\u89c4\u5219, \u5982\u4e0b\u8868\u6240\u793a: \u7b26\u53f7 \u542b\u4e49 ? \u8868\u793a\u4e0d\u786e\u5b9a\u7684\u503c\u3002\u5f53\u4e24\u4e2a\u5b50\u8868\u8fbe\u5f0f\u5176\u4e2d\u4e00\u4e2a\u88ab\u6307\u5b9a\u4e86\u503c\u4ee5\u540e\uff0c\u4e3a\u4e86\u907f\u514d\u51b2\u7a81\uff0c\u9700\u8981\u5c06\u53e6\u5916\u4e00\u4e2a\u7684\u503c\u8bbe\u4e3a\u201c?\u201d\u3002\u4f8b\u5982\uff1a\u60f3\u5728\u6bcf\u670820\u65e5\u89e6\u53d1\u8c03\u5ea6\uff0c\u4e0d\u7ba120\u53f7\u662f\u661f\u671f\u51e0\uff0c\u53ea\u80fd\u7528\u5982\u4e0b\u5199\u6cd5\uff1a0 0 0 20 * ?\uff0c\u5176\u4e2d\u6700\u540e\u4ee5\u4e3a\u53ea\u80fd\u7528\u201c?\u201d * \u4ee3\u8868\u6240\u6709\u53ef\u80fd\u7684\u503c , \u8bbe\u7f6e\u591a\u4e2a\u503c,\u4f8b\u5982\u201d26,29,33\u201d\u8868\u793a\u572826\u5206,29\u5206\u548c33\u5206\u5404\u81ea\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 - \u8bbe\u7f6e\u53d6\u503c\u8303\u56f4,\u4f8b\u5982\u201d5-20\u201d\uff0c\u8868\u793a\u4ece5\u5206\u523020\u5206\u949f\u6bcf\u5206\u949f\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 / \u8bbe\u7f6e\u9891\u7387\u6216\u95f4\u9694,\u5982\"1/15\"\u8868\u793a\u4ece1\u5206\u5f00\u59cb,\u6bcf\u969415\u5206\u949f\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 L \u7528\u4e8e\u6bcf\u6708\uff0c\u6216\u6bcf\u5468\uff0c\u8868\u793a\u6bcf\u6708\u7684\u6700\u540e\u4e00\u5929\uff0c\u6216\u6bcf\u4e2a\u6708\u7684\u6700\u540e\u661f\u671f\u51e0,\u4f8b\u5982\"6L\"\u8868\u793a\"\u6bcf\u6708\u7684\u6700\u540e\u4e00\u4e2a\u661f\u671f\u4e94\" W \u8868\u793a\u79bb\u7ed9\u5b9a\u65e5\u671f\u6700\u8fd1\u7684\u5de5\u4f5c\u65e5,\u4f8b\u5982\"15W\"\u653e\u5728\u6bcf\u6708\uff08day-of-month\uff09\u4e0a\u8868\u793a\"\u79bb\u672c\u670815\u65e5\u6700\u8fd1\u7684\u5de5\u4f5c\u65e5\" # \u8868\u793a\u8be5\u6708\u7b2c\u51e0\u4e2a\u5468X\u3002\u4f8b\u5982\u201d6#3\u201d\u8868\u793a\u8be5\u6708\u7b2c3\u4e2a\u5468\u4e94 \u4e3a\u4e86\u8ba9\u5927\u5bb6\u66f4\u719f\u6089cron\u8868\u8fbe\u5f0f\u7684\u7528\u6cd5, \u63a5\u4e0b\u6765\u6211\u4eec\u7ed9\u5927\u5bb6\u5217\u4e3e\u4e86\u4e00\u4e9b\u4f8b\u5b50, \u5982\u4e0b\u8868\u6240\u793a: cron\u8868\u8fbe\u5f0f \u542b\u4e49 /5 * * * ? \u6bcf\u96945\u79d2\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 0 0 23 * * ? \u6bcf\u592923\u70b9\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 0 0 1 1 * ? \u6bcf\u67081\u53f7\u51cc\u66681\u70b9\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 0 0 23 L * ? \u6bcf\u6708\u6700\u540e\u4e00\u592923\u70b9\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 0 26,29,33 * * * ? \u572826\u5206\u300129\u5206\u300133\u5206\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 0 0/30 9-17 * * ? \u671d\u4e5d\u665a\u4e94\u5de5\u4f5c\u65f6\u95f4\u5185\u6bcf\u534a\u5c0f\u65f6\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 0 15 10 ? * 6#3 \u6bcf\u6708\u7684\u7b2c\u4e09\u4e2a\u661f\u671f\u4e94\u4e0a\u534810:15\u8fd0\u884c\u4e00\u6b21\u4efb\u52a1 0 0 21 \uff1f 5 1 # 2 * \u79d2 \u5206 \u65f6 \u65e5 \u6708 \u5468 \u5e74 0 / 30","title":"03-cron\u8868\u8fbe\u5f0f 08:03"},{"location":"hmtt/day08/#04-_0411","text":"\u5f53\u524d\u8f6f\u4ef6\u7684\u67b6\u6784\u5df2\u7ecf\u5f00\u59cb\u5411\u5206\u5e03\u5f0f\u67b6\u6784\u8f6c\u53d8\uff0c\u5c06\u5355\u4f53\u7ed3\u6784\u62c6\u5206\u4e3a\u82e5\u5e72\u670d\u52a1\uff0c\u670d\u52a1\u4e4b\u95f4\u901a\u8fc7\u7f51\u7edc\u4ea4\u4e92\u6765\u5b8c\u6210\u4e1a\u52a1\u5904\u7406\u3002\u5728\u5206\u5e03\u5f0f\u67b6\u6784\u4e0b\uff0c\u4e00\u4e2a\u670d\u52a1\u5f80\u5f80\u4f1a\u90e8\u7f72\u591a\u4e2a\u5b9e\u4f8b\u6765\u8fd0\u884c\u6211\u4eec\u7684\u4e1a\u52a1\uff0c\u5982\u679c\u5728\u8fd9\u79cd\u5206\u5e03\u5f0f\u7cfb\u7edf\u73af\u5883\u4e0b\u8fd0\u884c\u4efb\u52a1\u8c03\u5ea6\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a \u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6 \u3002 \u5c06\u4efb\u52a1\u8c03\u5ea6\u7a0b\u5e8f\u5206\u5e03\u5f0f\u6784\u5efa\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5177\u6709\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u7279\u70b9\uff0c\u5e76\u4e14\u63d0\u9ad8\u4efb\u52a1\u7684\u8c03\u5ea6\u5904\u7406\u80fd\u529b\uff1a 1\u3001\u5e76\u884c\u4efb\u52a1\u8c03\u5ea6 \u5e76\u884c\u4efb\u52a1\u8c03\u5ea6\u5b9e\u73b0\u9760\u591a\u7ebf\u7a0b\uff0c\u5982\u679c\u6709\u5927\u91cf\u4efb\u52a1\u9700\u8981\u8c03\u5ea6\uff0c\u6b64\u65f6\u5149\u9760\u591a\u7ebf\u7a0b\u5c31\u4f1a\u6709\u74f6\u9888\u4e86\uff0c\u56e0\u4e3a\u4e00\u53f0\u8ba1\u7b97\u673aCPU\u7684\u5904\u7406\u80fd\u529b\u662f\u6709\u9650\u7684\u3002 \u5982\u679c\u5c06\u4efb\u52a1\u8c03\u5ea6\u7a0b\u5e8f\u5206\u5e03\u5f0f\u90e8\u7f72\uff0c\u6bcf\u4e2a\u7ed3\u70b9\u8fd8\u53ef\u4ee5\u90e8\u7f72\u4e3a\u96c6\u7fa4\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8ba9\u591a\u53f0\u8ba1\u7b97\u673a\u5171\u540c\u53bb\u5b8c\u6210\u4efb\u52a1\u8c03\u5ea6\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u4efb\u52a1\u5206\u5272\u4e3a\u82e5\u5e72\u4e2a\u5206\u7247\uff0c\u7531\u4e0d\u540c\u7684\u5b9e\u4f8b\u5e76\u884c\u6267\u884c\uff0c\u6765\u63d0\u9ad8\u4efb\u52a1\u8c03\u5ea6\u7684\u5904\u7406\u6548\u7387\u3002 2\u3001\u9ad8\u53ef\u7528 \u82e5\u67d0\u4e00\u4e2a\u5b9e\u4f8b\u5b95\u673a\uff0c\u4e0d\u5f71\u54cd\u5176\u4ed6\u5b9e\u4f8b\u6765\u6267\u884c\u4efb\u52a1\u3002 3\u3001\u5f39\u6027\u6269\u5bb9 \u5f53\u96c6\u7fa4\u4e2d\u589e\u52a0\u5b9e\u4f8b\u5c31\u53ef\u4ee5\u63d0\u9ad8\u5e76\u6267\u884c\u4efb\u52a1\u7684\u5904\u7406\u6548\u7387\u3002 4\u3001\u4efb\u52a1\u7ba1\u7406\u4e0e\u76d1\u6d4b \u5bf9\u7cfb\u7edf\u4e2d\u5b58\u5728\u7684\u6240\u6709\u5b9a\u65f6\u4efb\u52a1\u8fdb\u884c\u7edf\u4e00\u7684\u7ba1\u7406\u53ca\u76d1\u6d4b\u3002\u8ba9\u5f00\u53d1\u4eba\u5458\u53ca\u8fd0\u7ef4\u4eba\u5458\u80fd\u591f\u65f6\u523b\u4e86\u89e3\u4efb\u52a1\u6267\u884c\u60c5\u51b5\uff0c\u4ece\u800c\u505a\u51fa\u5feb\u901f\u7684\u5e94\u6025\u5904\u7406\u54cd\u5e94\u3002 \u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6\u9762\u4e34\u7684\u95ee\u9898\uff1a \u5f53\u4efb\u52a1\u8c03\u5ea6\u4ee5\u96c6\u7fa4\u65b9\u5f0f\u90e8\u7f72\uff0c\u540c\u4e00\u4e2a\u4efb\u52a1\u8c03\u5ea6\u53ef\u80fd\u4f1a\u6267\u884c\u591a\u6b21\uff0c\u4f8b\u5982\uff1a\u7535\u5546\u7cfb\u7edf\u5b9a\u671f\u53d1\u653e\u4f18\u60e0\u5238\uff0c\u5c31\u53ef\u80fd\u91cd\u590d\u53d1\u653e\u4f18\u60e0\u5238\uff0c\u5bf9\u516c\u53f8\u9020\u6210\u635f\u5931\uff0c\u4fe1\u7528\u5361\u8fd8\u6b3e\u63d0\u9192\u5c31\u4f1a\u91cd\u590d\u6267\u884c\u591a\u6b21\uff0c\u7ed9\u7528\u6237\u9020\u6210\u70e6\u607c\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u63a7\u5236\u76f8\u540c\u7684\u4efb\u52a1\u5728\u591a\u4e2a\u8fd0\u884c\u5b9e\u4f8b\u4e0a\u53ea\u6267\u884c\u4e00\u6b21\u3002\u5e38\u89c1\u89e3\u51b3\u65b9\u6848\uff1a \u5206\u5e03\u5f0f\u9501\uff0c\u591a\u4e2a\u5b9e\u4f8b\u5728\u4efb\u52a1\u6267\u884c\u524d\u9996\u5148\u9700\u8981\u83b7\u53d6\u9501\uff0c\u5982\u679c\u83b7\u53d6\u5931\u8d25\u90a3\u4e48\u5c31\u8bc1\u660e\u6709\u5176\u4ed6\u670d\u52a1\u5df2\u7ecf\u5728\u8fd0\u884c\uff0c\u5982\u679c\u83b7\u53d6\u6210\u529f\u90a3\u4e48\u8bc1\u660e\u6ca1\u6709\u670d\u52a1\u5728\u8fd0\u884c\u5b9a\u65f6\u4efb\u52a1\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u6267\u884c\u3002 ZooKeeper\u9009\u4e3e\uff0c\u5229\u7528ZooKeeper\u5bf9Leader\u5b9e\u4f8b\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\uff0c\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\u7684\u65f6\u5019\u5224\u65ad\u81ea\u5df1\u662f\u5426\u662fLeader\uff0c\u5982\u679c\u4e0d\u662f\u5219\u4e0d\u6267\u884c\uff0c\u5982\u679c\u662f\u5219\u6267\u884c\u4e1a\u52a1\u903b\u8f91\uff0c\u8fd9\u6837\u4e5f\u80fd\u8fbe\u5230\u76ee\u7684\u3002","title":"04-\u4ec0\u4e48\u662f\u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6 04:11"},{"location":"hmtt/day08/#05-xxl-job_0454","text":"\u9488\u5bf9\u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6\u7684\u9700\u6c42\uff0c\u5e02\u573a\u4e0a\u51fa\u73b0\u4e86\u5f88\u591a\u7684\u4ea7\u54c1\uff1a 1\uff09 TBSchedule\uff1a\u6dd8\u5b9d\u63a8\u51fa\u7684\u4e00\u6b3e\u975e\u5e38\u4f18\u79c0\u7684\u9ad8\u6027\u80fd\u5206\u5e03\u5f0f\u8c03\u5ea6\u6846\u67b6\uff0c\u76ee\u524d\u88ab\u5e94\u7528\u4e8e\u963f\u91cc\u3001\u4eac\u4e1c\u3001\u652f\u4ed8\u5b9d\u3001\u56fd\u7f8e\u7b49\u5f88\u591a\u4e92\u8054\u7f51\u4f01\u4e1a\u7684\u6d41\u7a0b\u8c03\u5ea6\u7cfb\u7edf\u4e2d\u3002\u4f46\u662f\u5df2\u7ecf\u591a\u5e74\u672a\u66f4\u65b0\uff0c\u6587\u6863\u7f3a\u5931\u4e25\u91cd\uff0c\u7f3a\u5c11\u7ef4\u62a4\u3002 2\uff09 XXL-Job\uff1a\u5927\u4f17\u70b9\u8bc4\u7684\u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6\u5e73\u53f0\uff0c\u662f\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6\u5e73\u53f0, \u5176\u6838\u5fc3\u8bbe\u8ba1\u76ee\u6807\u662f\u5f00\u53d1\u8fc5\u901f\u3001\u5b66\u4e60\u7b80\u5355\u3001\u8f7b\u91cf\u7ea7\u3001\u6613\u6269\u5c55\u3002\u73b0\u5df2\u5f00\u653e\u6e90\u4ee3\u7801\u5e76\u63a5\u5165\u591a\u5bb6\u516c\u53f8\u7ebf\u4e0a\u4ea7\u54c1\u7ebf\uff0c\u5f00\u7bb1\u5373\u7528\u3002 3\uff09Elastic-job\uff1a\u5f53\u5f53\u7f51\u501f\u9274TBSchedule\u5e76\u57fa\u4e8equartz \u4e8c\u6b21\u5f00\u53d1\u7684\u5f39\u6027\u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6\u7cfb\u7edf\uff0c\u529f\u80fd\u4e30\u5bcc\u5f3a\u5927\uff0c\u91c7\u7528zookeeper\u5b9e\u73b0\u5206\u5e03\u5f0f\u534f\u8c03\uff0c\u5177\u6709\u4efb\u52a1\u9ad8\u53ef\u7528\u4ee5\u53ca\u5206\u7247\u529f\u80fd\u3002 4\uff09Saturn\uff1a \u552f\u54c1\u4f1a\u5f00\u6e90\u7684\u4e00\u4e2a\u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6\u5e73\u53f0\uff0c\u57fa\u4e8eElastic-job\uff0c\u53ef\u4ee5\u5168\u57df\u7edf\u4e00\u914d\u7f6e\uff0c\u7edf\u4e00\u76d1 \u63a7\uff0c\u5177\u6709\u4efb\u52a1\u9ad8\u53ef\u7528\u4ee5\u53ca\u5206\u7247\u529f\u80fd\u3002 XXL-JOB\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6\u5e73\u53f0\uff0c\u5176\u6838\u5fc3\u8bbe\u8ba1\u76ee\u6807\u662f\u5f00\u53d1\u8fc5\u901f\u3001\u5b66\u4e60\u7b80\u5355\u3001\u8f7b\u91cf\u7ea7\u3001\u6613\u6269\u5c55\u3002\u73b0\u5df2\u5f00\u653e\u6e90\u4ee3\u7801\u5e76\u63a5\u5165\u591a\u5bb6\u516c\u53f8\u7ebf\u4e0a\u4ea7\u54c1\u7ebf\uff0c\u5f00\u7bb1\u5373\u7528\u3002 \u6e90\u7801\u5730\u5740\uff1ahttps://gitee.com/xuxueli0323/xxl-job \u6587\u6863\u5730\u5740\uff1ahttps://www.xuxueli.com/xxl-job/ \u7279\u6027 \u7b80\u5355\u7075\u6d3b \u63d0\u4f9bWeb\u9875\u9762\u5bf9\u4efb\u52a1\u8fdb\u884c\u7ba1\u7406\uff0c\u7ba1\u7406\u7cfb\u7edf\u652f\u6301\u7528\u6237\u7ba1\u7406\u3001\u6743\u9650\u63a7\u5236\uff1b \u652f\u6301\u5bb9\u5668\u90e8\u7f72\uff1b \u652f\u6301\u901a\u8fc7\u901a\u7528HTTP\u63d0\u4f9b\u8de8\u5e73\u53f0\u4efb\u52a1\u8c03\u5ea6\uff1b \u4e30\u5bcc\u7684\u4efb\u52a1\u7ba1\u7406\u529f\u80fd \u652f\u6301\u9875\u9762\u5bf9\u4efb\u52a1CRUD\u64cd\u4f5c\uff1b \u652f\u6301\u5728\u9875\u9762\u7f16\u5199\u811a\u672c\u4efb\u52a1\u3001\u547d\u4ee4\u884c\u4efb\u52a1\u3001Java\u4ee3\u7801\u4efb\u52a1\u5e76\u6267\u884c\uff1b \u652f\u6301\u4efb\u52a1\u7ea7\u8054\u7f16\u6392\uff0c\u7236\u4efb\u52a1\u6267\u884c\u7ed3\u675f\u540e\u89e6\u53d1\u5b50\u4efb\u52a1\u6267\u884c\uff1b \u652f \u6301\u8bbe\u7f6e\u6307\u5b9a\u4efb\u52a1\u6267\u884c\u8282\u70b9\u8def\u7531\u7b56\u7565\uff0c\u5305\u62ec\u8f6e\u8be2\u3001\u968f\u673a\u3001\u5e7f\u64ad\u3001\u6545\u969c\u8f6c\u79fb\u3001\u5fd9\u788c\u8f6c\u79fb\u7b49\uff1b \u652f\u6301Cron\u65b9\u5f0f\u3001\u4efb\u52a1\u4f9d\u8d56\u3001\u8c03\u5ea6\u4e2d\u5fc3API\u63a5\u53e3\u65b9\u5f0f\u89e6\u53d1\u4efb\u52a1\u6267\u884c \u9ad8\u6027\u80fd \u4efb\u52a1\u8c03\u5ea6\u6d41\u7a0b\u5168\u5f02\u6b65\u5316\u8bbe\u8ba1\u5b9e\u73b0\uff0c\u5982\u5f02\u6b65\u8c03\u5ea6\u3001\u5f02\u6b65\u8fd0\u884c\u3001\u5f02\u6b65\u56de\u8c03\u7b49\uff0c\u6709\u6548\u5bf9\u5bc6\u96c6\u8c03\u5ea6\u8fdb\u884c\u6d41\u91cf\u524a\u5cf0\uff1b \u9ad8\u53ef\u7528 \u4efb\u52a1\u8c03\u5ea6\u4e2d\u5fc3\u3001\u4efb\u52a1\u6267\u884c\u8282\u70b9\u5747 \u96c6\u7fa4\u90e8\u7f72\uff0c\u652f\u6301\u52a8\u6001\u6269\u5c55\u3001\u6545\u969c\u8f6c\u79fb \u652f\u6301\u4efb\u52a1\u914d\u7f6e\u8def\u7531\u6545\u969c\u8f6c\u79fb\u7b56\u7565\uff0c\u6267\u884c\u5668\u8282\u70b9\u4e0d\u53ef\u7528\u662f\u81ea\u52a8\u8f6c\u79fb\u5230\u5176\u4ed6\u8282\u70b9\u6267\u884c \u652f\u6301\u4efb\u52a1\u8d85\u65f6\u63a7\u5236\u3001\u5931\u8d25\u91cd\u8bd5\u914d\u7f6e \u652f\u6301\u4efb\u52a1\u5904\u7406\u963b\u585e\u7b56\u7565\uff1a\u8c03\u5ea6\u5f53\u4efb\u52a1\u6267\u884c\u8282\u70b9\u5fd9\u788c\u65f6\u6765\u4e0d\u53ca\u6267\u884c\u4efb\u52a1\u7684\u5904\u7406\u7b56\u7565\uff0c\u5305\u62ec\uff1a\u4e32\u884c\u3001\u629b\u5f03\u3001\u8986\u76d6\u7b56\u7565 \u6613\u4e8e\u76d1\u63a7\u8fd0\u7ef4 \u652f\u6301\u8bbe\u7f6e\u4efb\u52a1\u5931\u8d25\u90ae\u4ef6\u544a\u8b66\uff0c\u9884\u7559\u63a5\u53e3\u652f\u6301\u77ed\u4fe1\u3001\u9489\u9489\u544a\u8b66\uff1b \u652f\u6301\u5b9e\u65f6\u67e5\u770b\u4efb\u52a1\u6267\u884c\u8fd0\u884c\u6570\u636e\u7edf\u8ba1\u56fe\u8868\u3001\u4efb\u52a1\u8fdb\u5ea6\u76d1\u63a7\u6570\u636e\u3001\u4efb\u52a1\u5b8c\u6574\u6267\u884c\u65e5\u5fd7\uff1b","title":"05-XXL-Job\u7b80\u4ecb 04:54"},{"location":"hmtt/day08/#06-_1042","text":"\u5728\u5206\u5e03\u5f0f\u67b6\u6784\u4e0b\uff0c\u901a\u8fc7XXL-Job\u5b9e\u73b0\u5b9a\u65f6\u4efb\u52a1 \u8c03\u5ea6\u4e2d\u5fc3\uff1a\u8d1f\u8d23\u7ba1\u7406\u8c03\u5ea6\u4fe1\u606f\uff0c\u6309\u7167\u8c03\u5ea6\u914d\u7f6e\u53d1\u51fa\u8c03\u5ea6\u8bf7\u6c42\uff0c\u81ea\u8eab\u4e0d\u627f\u62c5\u4e1a\u52a1\u4ee3\u7801\u3002 \u4efb\u52a1\u6267\u884c\u5668\uff1a\u8d1f\u8d23\u63a5\u6536\u8c03\u5ea6\u8bf7\u6c42\u5e76\u6267\u884c\u4efb\u52a1\u903b\u8f91\u3002 \u4efb\u52a1\uff1a\u4e13\u6ce8\u4e8e\u4efb\u52a1\u7684\u5904\u7406\u3002 \u8c03\u5ea6\u4e2d\u5fc3\u4f1a\u53d1\u51fa\u8c03\u5ea6\u8bf7\u6c42\uff0c\u4efb\u52a1\u6267\u884c\u5668\u63a5\u6536\u5230\u8bf7\u6c42\u4e4b\u540e\u4f1a\u53bb\u6267\u884c\u4efb\u52a1\uff0c\u4efb\u52a1\u5219\u4e13\u6ce8\u4e8e\u4efb\u52a1\u4e1a\u52a1\u7684\u5904\u7406\u3002 \u76ee\u524d\u5b98\u65b9\u5df2\u7ecf\u66f4\u65b0\u7248\u672c\u4e3a2.2.0\u4e0d\u518d\u662fsnapshot\uff0c\u6211\u5df2\u7ecf\u5c06\u7248\u672c\u66f4\u65b0 1.\u5728SQLyog\u4e2d\u6267\u884cxxl-job\u8d44\u6599\u4e2d\u7684tables_xxl_job.sql 2.\u7f16\u8f91\u8d44\u6599\u4e2d\u7684application.properties\uff0c\u4fee\u6539mysql\u8def\u5f84\u548c\u7528\u6237\u540d\u5bc6\u7801 3.\u4f7f\u7528cmd,cd\u5230jar\u5305\u6240\u5728\u76ee\u5f55\uff0c\u6267\u884c java -jar xxl-job-admin-2.2.0.jar \u6216\u8005 xxljob.bat \u8bbf\u95eehttp://localhost:10086/xxl-job-admin\u5373\u53ef \u9ed8\u8ba4\u767b\u5f55\u8d26\u53f7\uff1aadmin/123456","title":"06-\u5165\u95e8\u6848\u4f8b\u73af\u5883\u642d\u5efa 10:42"},{"location":"hmtt/day08/#09-_0729","text":"","title":"09-\u521b\u5efa\u6267\u884c\u5668\u548c\u4efb\u52a1 07:29"},{"location":"hmtt/day08/#_1","text":"\u5728\u4efb\u52a1\u8c03\u5ea6\u4e2d\u5fc3\uff0c\u70b9\u51fb\u8fdb\u5165\"\u6267\u884c\u5668\u7ba1\u7406\"\u754c\u9762, \u5982\u4e0b\u56fe: 1\u3001\u6b64\u5904\u7684AppName,\u4f1a\u5728\u521b\u5efa\u4efb\u52a1\u65f6\u88ab\u9009\u62e9\uff0c\u6bcf\u4e2a\u4efb\u52a1\u5fc5\u7136\u8981\u9009\u62e9\u4e00\u4e2a\u6267\u884c\u5668\u3002 2\u3001\"\u6267\u884c\u5668\u5217\u8868\" \u4e2d\u663e\u793a\u5728\u7ebf\u7684\u6267\u884c\u5668\u5217\u8868, \u652f\u6301\u7f16\u8f91\u5220\u9664\u3002 \u4ee5\u4e0b\u662f\u6267\u884c\u5668\u7684\u5c5e\u6027\u8bf4\u660e\uff1a \u5c5e\u6027\u540d\u79f0 \u8bf4\u660e AppName \u662f\u6bcf\u4e2a\u6267\u884c\u5668\u96c6\u7fa4\u7684\u552f\u4e00\u6807\u793aAppName, \u6267\u884c\u5668\u4f1a\u5468\u671f\u6027\u4ee5AppName\u4e3a\u5bf9\u8c61\u8fdb\u884c\u81ea\u52a8\u6ce8\u518c\u3002\u53ef\u901a\u8fc7\u8be5\u914d\u7f6e\u81ea\u52a8\u53d1\u73b0\u6ce8\u518c\u6210\u529f\u7684\u6267\u884c\u5668, \u4f9b\u4efb\u52a1\u8c03\u5ea6\u65f6\u4f7f\u7528; \u540d\u79f0 \u6267\u884c\u5668\u7684\u540d\u79f0, \u56e0\u4e3aAppName\u9650\u5236\u5b57\u6bcd\u6570\u5b57\u7b49\u7ec4\u6210,\u53ef\u8bfb\u6027\u4e0d\u5f3a, \u540d\u79f0\u4e3a\u4e86\u63d0\u9ad8\u6267\u884c\u5668\u7684\u53ef\u8bfb\u6027; \u6392\u5e8f \u6267\u884c\u5668\u7684\u6392\u5e8f, \u7cfb\u7edf\u4e2d\u9700\u8981\u6267\u884c\u5668\u7684\u5730\u65b9,\u5982\u4efb\u52a1\u65b0\u589e, \u5c06\u4f1a\u6309\u7167\u8be5\u6392\u5e8f\u8bfb\u53d6\u53ef\u7528\u7684\u6267\u884c\u5668\u5217\u8868; \u6ce8\u518c\u65b9\u5f0f \u8c03\u5ea6\u4e2d\u5fc3\u83b7\u53d6\u6267\u884c\u5668\u5730\u5740\u7684\u65b9\u5f0f\uff1b \u673a\u5668\u5730\u5740 \u6ce8\u518c\u65b9\u5f0f\u4e3a\"\u624b\u52a8\u5f55\u5165\"\u65f6\u6709\u6548\uff0c\u652f\u6301\u4eba\u5de5\u7ef4\u62a4\u6267\u884c\u5668\u7684\u5730\u5740\u4fe1\u606f\uff1b \u5177\u4f53\u64cd\u4f5c\uff1a \uff081\uff09\u65b0\u589e\u6267\u884c\u5668\uff1a \uff082\uff09\u81ea\u52a8\u6ce8\u518c\u548c\u624b\u52a8\u6ce8\u518c\u7684\u533a\u522b\u548c\u914d\u7f6e","title":"\u914d\u7f6e\u6267\u884c\u5668"},{"location":"hmtt/day08/#_2","text":"\u5728\u4efb\u52a1\u7ba1\u7406->\u65b0\u5efa\uff0c\u586b\u5199\u4ee5\u4e0b\u5185\u5bb9 \u6267\u884c\u5668\uff1a\u4efb\u52a1\u7684\u7ed1\u5b9a\u7684\u6267\u884c\u5668\uff0c\u4efb\u52a1\u89e6\u53d1\u8c03\u5ea6\u65f6\u5c06\u4f1a\u81ea\u52a8\u53d1\u73b0\u6ce8\u518c\u6210\u529f\u7684\u6267\u884c\u5668, \u5b9e\u73b0\u4efb\u52a1\u81ea\u52a8\u53d1\u73b0\u529f\u80fd; \u53e6\u4e00\u65b9\u9762\u4e5f\u53ef\u4ee5\u65b9\u4fbf\u7684\u8fdb\u884c\u4efb\u52a1\u5206\u7ec4\u3002\u6bcf\u4e2a\u4efb\u52a1\u5fc5\u987b\u7ed1\u5b9a\u4e00\u4e2a\u6267\u884c\u5668, \u53ef\u5728 \"\u6267\u884c\u5668\u7ba1\u7406\" \u8fdb\u884c\u8bbe\u7f6e \u4efb\u52a1\u63cf\u8ff0\uff1a\u4efb\u52a1\u7684\u63cf\u8ff0\u4fe1\u606f\uff0c\u4fbf\u4e8e\u4efb\u52a1\u7ba1\u7406 \u8def\u7531\u7b56\u7565\uff1a\u5f53\u6267\u884c\u5668\u96c6\u7fa4\u90e8\u7f72\u65f6\uff0c\u63d0\u4f9b\u4e30\u5bcc\u7684\u8def\u7531\u7b56\u7565\uff0c\u5305\u62ec FIRST\uff08\u7b2c\u4e00\u4e2a\uff09\uff1a\u56fa\u5b9a\u9009\u62e9\u7b2c\u4e00\u4e2a\u673a\u5668\uff1b LAST\uff08\u6700\u540e\u4e00\u4e2a\uff09\uff1a\u56fa\u5b9a\u9009\u62e9\u6700\u540e\u4e00\u4e2a\u673a\u5668\uff1b ROUND\uff08\u8f6e\u8be2\uff09\uff1a RANDOM\uff08\u968f\u673a\uff09\uff1a\u968f\u673a\u9009\u62e9\u5728\u7ebf\u7684\u673a\u5668\uff1b CONSISTENT_HASH\uff08\u4e00\u81f4\u6027HASH\uff09\uff1a\u6bcf\u4e2a\u4efb\u52a1\u6309\u7167Hash\u7b97\u6cd5\u56fa\u5b9a\u9009\u62e9\u67d0\u4e00\u53f0\u673a\u5668\uff0c\u4e14\u6240\u6709\u4efb\u52a1\u5747\u5300\u6563\u5217\u5728\u4e0d\u540c\u673a\u5668\u4e0a\u3002 LEAST_FREQUENTLY_USED\uff08\u6700\u4e0d\u7ecf\u5e38\u4f7f\u7528\uff09\uff1a\u4f7f\u7528\u9891\u7387\u6700\u4f4e\u7684\u673a\u5668\u4f18\u5148\u88ab\u9009\u4e3e\uff1b LEAST_RECENTLY_USED\uff08\u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\uff09\uff1a\u6700\u4e45\u4e3a\u4f7f\u7528\u7684\u673a\u5668\u4f18\u5148\u88ab\u9009\u4e3e\uff1b FAILOVER\uff08\u6545\u969c\u8f6c\u79fb\uff09\uff1a\u6309\u7167\u987a\u5e8f\u4f9d\u6b21\u8fdb\u884c\u5fc3\u8df3\u68c0\u6d4b\uff0c\u7b2c\u4e00\u4e2a\u5fc3\u8df3\u68c0\u6d4b\u6210\u529f\u7684\u673a\u5668\u9009\u5b9a\u4e3a\u76ee\u6807\u6267\u884c\u5668\u5e76\u53d1\u8d77\u8c03\u5ea6\uff1b BUSYOVER\uff08\u5fd9\u788c\u8f6c\u79fb\uff09\uff1a\u6309\u7167\u987a\u5e8f\u4f9d\u6b21\u8fdb\u884c\u7a7a\u95f2\u68c0\u6d4b\uff0c\u7b2c\u4e00\u4e2a\u7a7a\u95f2\u68c0\u6d4b\u6210\u529f\u7684\u673a\u5668\u9009\u5b9a\u4e3a\u76ee\u6807\u6267\u884c\u5668\u5e76\u53d1\u8d77\u8c03\u5ea6\uff1b SHARDING_BROADCAST(\u5206\u7247\u5e7f\u64ad)\uff1a\u5e7f\u64ad\u89e6\u53d1\u5bf9\u5e94\u96c6\u7fa4\u4e2d\u6240\u6709\u673a\u5668\u6267\u884c\u4e00\u6b21\u4efb\u52a1\uff0c\u540c\u65f6\u7cfb\u7edf\u81ea\u52a8\u4f20\u9012\u5206\u7247\u53c2\u6570\uff1b\u53ef\u6839\u636e\u5206\u7247\u53c2\u6570\u5f00\u53d1\u5206\u7247\u4efb\u52a1\uff1b Cron\uff1a\u89e6\u53d1\u4efb\u52a1\u6267\u884c\u7684Cron\u8868\u8fbe\u5f0f\uff1b \u8fd0\u884c\u6a21\u5f0f\uff1a BEAN\u6a21\u5f0f\uff1a\u4efb\u52a1\u4ee5JobHandler\u65b9\u5f0f\u7ef4\u62a4\u5728\u6267\u884c\u5668\u7aef\uff1b\u9700\u8981\u7ed3\u5408 \"JobHandler\" \u5c5e\u6027\u5339\u914d\u6267\u884c\u5668\u4e2d\u4efb\u52a1\uff1b GLUE\u6a21\u5f0f(Java)\uff1a\u4efb\u52a1\u4ee5\u6e90\u7801\u65b9\u5f0f\u7ef4\u62a4\u5728\u8c03\u5ea6\u4e2d\u5fc3\uff1b\u8be5\u6a21\u5f0f\u7684\u4efb\u52a1\u5b9e\u9645\u4e0a\u662f\u4e00\u6bb5\u7ee7\u627f\u81eaIJobHandler\u7684Java\u7c7b\u4ee3\u7801\u5e76 \"groovy\" \u6e90\u7801\u65b9\u5f0f\u7ef4\u62a4\uff0c\u5b83\u5728\u6267\u884c\u5668\u9879\u76ee\u4e2d\u8fd0\u884c\uff0c\u53ef\u4f7f\u7528@Resource/@Autowire\u6ce8\u5165\u6267\u884c\u5668\u91cc\u4e2d\u7684\u5176\u4ed6\u670d\u52a1\uff1b GLUE\u6a21\u5f0f(Shell)\uff1a\u4efb\u52a1\u4ee5\u6e90\u7801\u65b9\u5f0f\u7ef4\u62a4\u5728\u8c03\u5ea6\u4e2d\u5fc3\uff1b\u8be5\u6a21\u5f0f\u7684\u4efb\u52a1\u5b9e\u9645\u4e0a\u662f\u4e00\u6bb5 \"shell\" \u811a\u672c\uff1b GLUE\u6a21\u5f0f(Python)\uff1a\u4efb\u52a1\u4ee5\u6e90\u7801\u65b9\u5f0f\u7ef4\u62a4\u5728\u8c03\u5ea6\u4e2d\u5fc3\uff1b\u8be5\u6a21\u5f0f\u7684\u4efb\u52a1\u5b9e\u9645\u4e0a\u662f\u4e00\u6bb5 \"python\" \u811a\u672c\uff1b GLUE\u6a21\u5f0f(PHP)\uff1a\u4efb\u52a1\u4ee5\u6e90\u7801\u65b9\u5f0f\u7ef4\u62a4\u5728\u8c03\u5ea6\u4e2d\u5fc3\uff1b\u8be5\u6a21\u5f0f\u7684\u4efb\u52a1\u5b9e\u9645\u4e0a\u662f\u4e00\u6bb5 \"php\" \u811a\u672c\uff1b GLUE\u6a21\u5f0f(NodeJS)\uff1a\u4efb\u52a1\u4ee5\u6e90\u7801\u65b9\u5f0f\u7ef4\u62a4\u5728\u8c03\u5ea6\u4e2d\u5fc3\uff1b\u8be5\u6a21\u5f0f\u7684\u4efb\u52a1\u5b9e\u9645\u4e0a\u662f\u4e00\u6bb5 \"nodejs\" \u811a\u672c\uff1b GLUE\u6a21\u5f0f(PowerShell)\uff1a\u4efb\u52a1\u4ee5\u6e90\u7801\u65b9\u5f0f\u7ef4\u62a4\u5728\u8c03\u5ea6\u4e2d\u5fc3\uff1b\u8be5\u6a21\u5f0f\u7684\u4efb\u52a1\u5b9e\u9645\u4e0a\u662f\u4e00\u6bb5 \"PowerShell\" \u811a\u672c\uff1b JobHandler\uff1a\u8fd0\u884c\u6a21\u5f0f\u4e3a \"BEAN\u6a21\u5f0f\" \u65f6\u751f\u6548\uff0c\u5bf9\u5e94\u6267\u884c\u5668\u4e2d\u65b0\u5f00\u53d1\u7684JobHandler\u7c7b\u201c@JobHandler\u201d\u6ce8\u89e3\u81ea\u5b9a\u4e49\u7684value\u503c\uff1b \u963b\u585e\u5904\u7406\u7b56\u7565\uff1a\u8c03\u5ea6\u8fc7\u4e8e\u5bc6\u96c6\u6267\u884c\u5668\u6765\u4e0d\u53ca\u5904\u7406\u65f6\u7684\u5904\u7406\u7b56\u7565\uff1b \u5355\u673a\u4e32\u884c\uff08\u9ed8\u8ba4\uff09\uff1a\u8c03\u5ea6\u8bf7\u6c42\u8fdb\u5165\u5355\u673a\u6267\u884c\u5668\u540e\uff0c\u8c03\u5ea6\u8bf7\u6c42\u8fdb\u5165FIFO\u961f\u5217\u5e76\u4ee5\u4e32\u884c\u65b9\u5f0f\u8fd0\u884c\uff1b \u4e22\u5f03\u540e\u7eed\u8c03\u5ea6\uff1a\u8c03\u5ea6\u8bf7\u6c42\u8fdb\u5165\u5355\u673a\u6267\u884c\u5668\u540e\uff0c\u53d1\u73b0\u6267\u884c\u5668\u5b58\u5728\u8fd0\u884c\u7684\u8c03\u5ea6\u4efb\u52a1\uff0c\u672c\u6b21\u8bf7\u6c42\u5c06\u4f1a\u88ab\u4e22\u5f03\u5e76\u6807\u8bb0\u4e3a\u5931\u8d25\uff1b \u8986\u76d6\u4e4b\u524d\u8c03\u5ea6\uff1a\u8c03\u5ea6\u8bf7\u6c42\u8fdb\u5165\u5355\u673a\u6267\u884c\u5668\u540e\uff0c\u53d1\u73b0\u6267\u884c\u5668\u5b58\u5728\u8fd0\u884c\u7684\u8c03\u5ea6\u4efb\u52a1\uff0c\u5c06\u4f1a\u7ec8\u6b62\u8fd0\u884c\u4e2d\u7684\u8c03\u5ea6\u4efb\u52a1\u5e76\u6e05\u7a7a\u961f\u5217\uff0c\u7136\u540e\u8fd0\u884c\u672c\u5730\u8c03\u5ea6\u4efb\u52a1\uff1b \u5b50\u4efb\u52a1\uff1a\u6bcf\u4e2a\u4efb\u52a1\u90fd\u62e5\u6709\u4e00\u4e2a\u552f\u4e00\u7684\u4efb\u52a1ID(\u4efb\u52a1ID\u53ef\u4ee5\u4ece\u4efb\u52a1\u5217\u8868\u83b7\u53d6)\uff0c\u5f53\u672c\u4efb\u52a1\u6267\u884c\u7ed3\u675f\u5e76\u4e14\u6267\u884c\u6210\u529f\u65f6\uff0c\u5c06\u4f1a\u89e6\u53d1\u5b50\u4efb\u52a1ID\u6240\u5bf9\u5e94\u7684\u4efb\u52a1\u7684\u4e00\u6b21\u4e3b\u52a8\u8c03\u5ea6\u3002 \u4efb\u52a1\u8d85\u65f6\u65f6\u95f4\uff1a\u652f\u6301\u81ea\u5b9a\u4e49\u4efb\u52a1\u8d85\u65f6\u65f6\u95f4\uff0c\u4efb\u52a1\u8fd0\u884c\u8d85\u65f6\u5c06\u4f1a\u4e3b\u52a8\u4e2d\u65ad\u4efb\u52a1\uff1b \u5931\u8d25\u91cd\u8bd5\u6b21\u6570\uff1b\u652f\u6301\u81ea\u5b9a\u4e49\u4efb\u52a1\u5931\u8d25\u91cd\u8bd5\u6b21\u6570\uff0c\u5f53\u4efb\u52a1\u5931\u8d25\u65f6\u5c06\u4f1a\u6309\u7167\u9884\u8bbe\u7684\u5931\u8d25\u91cd\u8bd5\u6b21\u6570\u4e3b\u52a8\u8fdb\u884c\u91cd\u8bd5\uff1b \u62a5\u8b66\u90ae\u4ef6\uff1a\u4efb\u52a1\u8c03\u5ea6\u5931\u8d25\u65f6\u90ae\u4ef6\u901a\u77e5\u7684\u90ae\u7bb1\u5730\u5740\uff0c\u652f\u6301\u914d\u7f6e\u591a\u90ae\u7bb1\u5730\u5740\uff0c\u914d\u7f6e\u591a\u4e2a\u90ae\u7bb1\u5730\u5740\u65f6\u7528\u9017\u53f7\u5206\u9694\uff1b \u8d1f\u8d23\u4eba\uff1a\u4efb\u52a1\u7684\u8d1f\u8d23\u4eba\uff1b \u6267\u884c\u53c2\u6570\uff1a\u4efb\u52a1\u6267\u884c\u6240\u9700\u7684\u53c2\u6570\uff1b","title":"\u5728\u8c03\u5ea6\u4e2d\u5fc3\u65b0\u5efa\u4efb\u52a1"},{"location":"hmtt/day08/#10-spring_boot_1018","text":"\u65b0\u5efa\u9879\u76ee\uff1axxl-job-demo \uff081\uff09pom\u6587\u4ef6 <groupId> com.itheima </groupId> <artifactId> xxl-job-demo </artifactId> <version> 1.0-SNAPSHOT </version> <!-- \u7ee7\u627fSpring boot\u5de5\u7a0b --> <parent> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-parent </artifactId> <version> 2.1.5.RELEASE </version> </parent> <dependencies> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-web </artifactId> </dependency> <!-- xxl-job --> <dependency> <groupId> com.xuxueli </groupId> <artifactId> xxl-job-core </artifactId> <version> 2.2.0 </version> </dependency> </dependencies> <build> <plugins> <plugin> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-maven-plugin </artifactId> </plugin> </plugins> </build> 2.2.0-snapshot\u7248\u672c\u5df2\u7ecf\u4e0d\u5b58\u5728\uff0c\u6539\u62102.2.0\u7248\u672c (2)\u914d\u7f6e\u6709\u4e24\u4e2a\uff0c\u4e00\u4e2a\u662fapplication.properties\uff0c\u53e6\u5916\u4e00\u4e2a\u662f\u65e5\u5fd7\u914d\u7f6e:logback.xml application.properties # web port server.port = ${port:8801} # no web #spring.main.web-environment=false # log config logging.config = classpath:logback.xml ### xxl-job admin address list, such as \"http://address\" or \"http://address01,http://address02\" xxl.job.admin.addresses = http://localhost:8888/xxl-job-admin ### xxl-job, access token xxl.job.accessToken = ### xxl-job executor appname xxl.job.executor.appname = xxl-job-executor-sample ### xxl-job executor registry-address: default use address to registry , otherwise use ip:port if address is null xxl.job.executor.address = ### xxl-job executor server-info xxl.job.executor.ip = xxl.job.executor.port = ${executor.port:9999} ### xxl-job executor log-path xxl.job.executor.logpath = /data/applogs/xxl-job/jobhandler ### xxl-job executor log-retention-days xxl.job.executor.logretentiondays = 30 logback.xml <?xml version=\"1.0\" encoding=\"UTF-8\"?> <configuration debug= \"false\" scan= \"true\" scanPeriod= \"1 seconds\" > <contextName> logback </contextName> <property name= \"log.path\" value= \"/data/applogs/xxl-job/xxl-job-executor-sample-springboot.log\" /> <appender name= \"console\" class= \"ch.qos.logback.core.ConsoleAppender\" > <encoder> <pattern> %d{HH:mm:ss.SSS} %contextName [%thread] %-5level %logger{36} - %msg%n </pattern> </encoder> </appender> <appender name= \"file\" class= \"ch.qos.logback.core.rolling.RollingFileAppender\" > <file> ${log.path} </file> <rollingPolicy class= \"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\" > <fileNamePattern> ${log.path}.%d{yyyy-MM-dd}.zip </fileNamePattern> </rollingPolicy> <encoder> <pattern> %date %level [%thread] %logger{36} [%file : %line] %msg%n </pattern> </encoder> </appender> <root level= \"info\" > <appender-ref ref= \"console\" /> <appender-ref ref= \"file\" /> </root> </configuration> (3)\u5f15\u5bfc\u7c7b\uff1a package com.itheima.xxljob ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; @SpringBootApplication public class XxlJobApplication { public static void main ( String [] args ) { SpringApplication . run ( XxlJobApplication . class , args ); } }","title":"10-\u4e0eSpring Boot\u96c6\u6210 10:18"},{"location":"hmtt/day08/#224_xxl-job","text":"\u6dfb\u52a0\u914d\u7f6e\u7c7b\uff1a \u8fd9\u4e2a\u7c7b\u4e3b\u8981\u662f\u521b\u5efa\u4e86\u4efb\u52a1\u6267\u884c\u5668\uff0c\u53c2\u8003\u5b98\u65b9\u6848\u4f8b\u7f16\u5199\uff0c\u65e0\u987b\u6539\u52a8 package com.itheima.xxljob.config ; import com.xxl.job.core.executor.impl.XxlJobSpringExecutor ; import org.slf4j.Logger ; import org.slf4j.LoggerFactory ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; /** * xxl-job config * * @author xuxueli 2017-04-28 */ @Configuration public class XxlJobConfig { private Logger logger = LoggerFactory . getLogger ( XxlJobConfig . class ); @Value ( \"${xxl.job.admin.addresses}\" ) private String adminAddresses ; @Value ( \"${xxl.job.accessToken}\" ) private String accessToken ; @Value ( \"${xxl.job.executor.appname}\" ) private String appName ; @Value ( \"${xxl.job.executor.address}\" ) private String address ; @Value ( \"${xxl.job.executor.ip}\" ) private String ip ; @Value ( \"${xxl.job.executor.port}\" ) private int port ; @Value ( \"${xxl.job.executor.logpath}\" ) private String logPath ; @Value ( \"${xxl.job.executor.logretentiondays}\" ) private int logRetentionDays ; @Bean public XxlJobSpringExecutor xxlJobExecutor () { logger . info ( \">>>>>>>>>>> xxl-job config init.\" ); XxlJobSpringExecutor xxlJobSpringExecutor = new XxlJobSpringExecutor (); xxlJobSpringExecutor . setAdminAddresses ( adminAddresses ); xxlJobSpringExecutor . setAppname ( appName ); xxlJobSpringExecutor . setAddress ( address ); xxlJobSpringExecutor . setIp ( ip ); xxlJobSpringExecutor . setPort ( port ); xxlJobSpringExecutor . setAccessToken ( accessToken ); xxlJobSpringExecutor . setLogPath ( logPath ); xxlJobSpringExecutor . setLogRetentionDays ( logRetentionDays ); return xxlJobSpringExecutor ; } /** * \u9488\u5bf9\u591a\u7f51\u5361\u3001\u5bb9\u5668\u5185\u90e8\u7f72\u7b49\u60c5\u51b5\uff0c\u53ef\u501f\u52a9 \"spring-cloud-commons\" \u63d0\u4f9b\u7684 \"InetUtils\" \u7ec4\u4ef6\u7075\u6d3b\u5b9a\u5236\u6ce8\u518cIP\uff1b * * 1\u3001\u5f15\u5165\u4f9d\u8d56\uff1a * <dependency> * <groupId>org.springframework.cloud</groupId> * <artifactId>spring-cloud-commons</artifactId> * <version>${version}</version> * </dependency> * * 2\u3001\u914d\u7f6e\u6587\u4ef6\uff0c\u6216\u8005\u5bb9\u5668\u542f\u52a8\u53d8\u91cf * spring.cloud.inetutils.preferred-networks: 'xxx.xxx.xxx.' * * 3\u3001\u83b7\u53d6IP * String ip_ = inetUtils.findFirstNonLoopbackHostInfo().getIpAddress(); */ }","title":"2.2.4 \u6dfb\u52a0xxl-job\u914d\u7f6e"},{"location":"hmtt/day08/#225","text":"package com.itheima.xxljob.job ; import com.xxl.job.core.biz.model.ReturnT ; import com.xxl.job.core.handler.annotation.XxlJob ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.stereotype.Component ; import java.time.LocalDateTime ; @Component public class HelloJob { @Value ( \"${server.port}\" ) private String appPort ; @XxlJob ( \"helloJob\" ) public ReturnT < String > hello ( String param ) throws Exception { System . out . println ( \"helloJob\uff1a\" + LocalDateTime . now () + \",\u7aef\u53e3\u53f7\" + appPort ); return ReturnT . SUCCESS ; } } @XxlJob(\"helloJob\") \u8fd9\u4e2a\u4e00\u5b9a\u8981\u4e0e\u8c03\u5ea6\u4e2d\u5fc3\u65b0\u5efa\u4efb\u52a1\u7684JobHandler\u7684\u503c\u4fdd\u6301\u4e00\u81f4,\u5982\u4e0b\u56fe\uff1a","title":"2.2.5 \u521b\u5efa\u4efb\u52a1"},{"location":"hmtt/day08/#11-_0715","text":"\uff081\uff09\u9996\u5148\u542f\u52a8\u8c03\u5ea6\u4e2d\u5fc3 \uff082\uff09\u542f\u52a8xxl-job-demo\u9879\u76ee\uff0c\u4e3a\u4e86\u5c55\u793a\u66f4\u597d\u7684\u6548\u679c\uff0c\u53ef\u4ee5\u540c\u65f6\u542f\u52a8\u4e09\u4e2a\u9879\u76ee\uff0c\u7528\u540c\u4e00\u4e2aJobHandler\uff0c\u67e5\u770b\u5904\u7406\u65b9\u5f0f\u3002 \u5728\u542f\u52a8\u591a\u4e2a\u9879\u76ee\u7684\u65f6\u5019\uff0c\u7aef\u53e3\u9700\u8981\u5207\u6362\uff0c\u8fde\u63a5xxl-job\u7684\u6267\u884c\u5668\u7aef\u53e3\u4e0d\u540c\u76f8\u540c \u670d\u52a1\u4e00\uff1a\u9ed8\u8ba4\u542f\u52a88801\u7aef\u53e3\uff0c\u6267\u884c\u5668\u7aef\u53e3\u4e3a9999 idea\u4e2d\u4e0d\u7528\u5176\u4ed6\u914d\u7f6e\uff0c\u76f4\u63a5\u542f\u52a8\u9879\u76ee\u5373\u53ef \u670d\u52a1\u4e8c\uff1a\u9879\u76ee\u7aef\u53e3\uff1a8802\uff0c\u6267\u884c\u5668\u7aef\u53e3\uff1a9998 idea\u914d\u7f6e\u5982\u4e0b\uff1a \u7f16\u8f91\u914d\u7f6e\uff0cEdit Configurations... \u9009\u4e2dXxlJobApplication\uff0c\u70b9\u51fb\u590d\u5236 \u4fee\u6539\u53c2\u6570 \u542f\u52a8\uff1a\u9009\u4e2d8802\u542f\u52a8\u9879\u76ee \u670d\u52a1\u4e09\uff1a\u9879\u76ee\u7aef\u53e3\uff1a8803\uff0c\u6267\u884c\u5668\u7aef\u53e3\uff1a9997 \uff083\uff09\u6d4b\u8bd5\u6548\u679c \u4e09\u4e2a\u9879\u76ee\u542f\u52a8\u540e\uff0c\u53ef\u4ee5\u67e5\u770b\u5230\u662f\u8f6e\u8be2\u7684\u65b9\u5f0f\u5206\u522b\u53bb\u6267\u884c\u5f53\u524d\u8c03\u5ea6\u4efb\u52a1\u3002","title":"11-\u6d4b\u8bd5 07:15"},{"location":"hmtt/day08/#12--_1018","text":"\u524d\u671f\u56de\u987e\uff1a\u5728\u81ea\u5a92\u4f53\u6587\u7ae0\u5ba1\u6838\u7684\u65f6\u5019\uff0c\u5ba1\u6838\u901a\u8fc7\u540e\uff0c\u5224\u65ad\u4e86\u6587\u7ae0\u7684\u53d1\u5e03\u65f6\u95f4\u5927\u4e8e\u5f53\u524d\u65f6\u95f4\uff0c\u8fd9\u4e2a\u65f6\u5019\u5e76\u6ca1\u6709\u771f\u6b63\u7684\u53d1\u5e03\u6587\u7ae0\uff0c\u800c\u662f\u628a\u6587\u7ae0\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3a\u4e868\uff08\u5ba1\u6838\u901a\u8fc7\u5f85\u53d1\u5e03\uff09 \u5b9a\u65f6\u4efb\u52a1\u7684\u4f5c\u7528\u5c31\u662f\u6bcf\u5206\u949f\u53bb\u626b\u63cf\u8fd9\u4e9b\u5f85\u53d1\u5e03\u7684\u6587\u7ae0\uff0c\u5982\u679c\u5f53\u524d\u6587\u7ae0\u7684\u72b6\u6001\u4e3a8\uff0c\u5e76\u4e14\u53d1\u5e03\u65f6\u95f4\u5c0f\u4e8e\u5f53\u524d\u65f6\u95f4\u7684\uff0c\u7acb\u523b\u53d1\u5e03\u5f53\u524d\u6587\u7ae0 \u81ea\u52a8\u5ba1\u6838\u7684\u4ee3\u7801\u90fd\u662f\u901a\u8fc7\u81ea\u5a92\u4f53\u6587\u7ae0\u7684id\u8fdb\u884c\u5ba1\u6838\u7684\uff0c\u8fd9\u4e2a\u65f6\u5019\u9700\u8981\u5728admin\u7aef\u8fdc\u7a0b\u8c03\u7528\u81ea\u5a92\u4f53\u7aef\u67e5\u8be2\u6587\u7ae0\u72b6\u6001\u4e3a8\u4e14\u53d1\u5e03\u65f6\u95f4\u5c0f\u4e8e\u5f53\u524d\u65f6\u95f4\u7684\u6587\u7ae0id\u5217\u8868 \uff081\uff09\u4fee\u6539WmNewsControllerApi\u63a5\u53e3\uff0c\u65b0\u589e\u65b9\u6cd5 /** * \u67e5\u8be2\u9700\u8981\u53d1\u5e03\u7684\u6587\u7ae0id\u5217\u8868 * @return */ List < Integer > findRelease (); (2)\u4e1a\u52a1\u5c42 \u5728\u81ea\u5a92\u4f53\u5fae\u670d\u52a1\u4e2d\u7684WmNewsService\u65b0\u589e\u65b9\u6cd5 /** * \u67e5\u8be2\u9700\u8981\u53d1\u5e03\u7684\u6587\u7ae0id\u5217\u8868 * @return */ List < Integer > findRelease (); \u5b9e\u73b0\u65b9\u6cd5\uff1a /** * \u67e5\u8be2\u9700\u8981\u53d1\u5e03\u7684\u6587\u7ae0id\u5217\u8868 * @return */ @Override public List < Integer > findRelease (){ List < WmNews > list = list ( Wrappers . < WmNews > lambdaQuery (). eq ( WmNews :: getStatus , 8 ). lt ( WmNews :: getPublishTime , new Date ())); List < Integer > resultList = list . stream (). map ( WmNews :: getId ). collect ( Collectors . toList ()); return resultList ; } (3)\u63a7\u5236\u5668 WmNewsController\u4e2d\u65b0\u589e\u65b9\u6cd5 @GetMapping ( \"/findRelease\" ) @Override public List < Integer > findRelease () { return wmNewsService . findRelease (); } \uff084\uff09\u5728admin\u7aef\u6dfb\u52a0\u8fdc\u7a0b\u8c03\u7528feign\u63a5\u53e3 \u4fee\u6539WemediaFeign\u63a5\u53e3\u6dfb\u52a0\u65b9\u6cd5 @GetMapping ( \"/api/v1/news/findRelease\" ) List < Integer > findRelease ();","title":"12-\u5b9a\u65f6\u626b\u63cf\u5f85\u53d1\u5e03\u6587\u7ae0-\u6570\u636e\u51c6\u5907 10:18"},{"location":"hmtt/day08/#13-_1244","text":"\u8bb2\u4e49\u4e2d\u7684setAppName\u4fee\u6539\u4e3asetAppname","title":"13-\u521b\u5efa\u4efb\u52a1 12:44"},{"location":"hmtt/day08/#14-_0339","text":"cron\u8868\u8fbe\u5f0f\u7f16\u5199\u6709\u8bef 0 0 / 1 * * * ? \u4ece0\u5206\u5f00\u59cb\uff0c\u6bcf\u96941\u5206\u949f\u6267\u884c\u4e00\u6b21","title":"14-\u6d4b\u8bd5 03:39"},{"location":"hmtt/day08/#15-_0334","text":"\u5e73\u53f0\u7ba1\u7406\u5458\u53ef\u4ee5\u67e5\u770b\u5f85\u4eba\u5de5\u5ba1\u6838\u7684\u6587\u7ae0\u4fe1\u606f\uff0c\u53ef\u4ee5 \u901a\u8fc7\uff08\u72b6\u6001\u6539\u4e3a4\uff09 \u6216 \u9a73\u56de\uff08\u72b6\u6001\u6539\u4e3a2\uff09 \u4e5f\u53ef\u4ee5\u901a\u8fc7\u70b9\u51fb \u67e5\u770b \u6309\u94ae\uff0c\u67e5\u770b\u6587\u7ae0\u8be6\u7ec6\u4fe1\u606f\uff0c\u67e5\u770b\u8be6\u60c5\u540e\u53ef\u4ee5\u6839\u636e\u5185\u5bb9\u5224\u65ad\u662f\u5426\u9700\u8981\u901a\u8fc7\u5ba1\u6838","title":"15-\u4eba\u5de5\u5ba1\u6838\u6587\u7ae0 \u9700\u6c42\u8bf4\u660e 03:34"},{"location":"hmtt/day08/#16-mapper_1351","text":"1 \u9700\u8981\u5206\u9875\u67e5\u8be2\u81ea\u5a92\u4f53\u6587\u7ae0\u4fe1\u606f\uff0c\u53ef\u4ee5\u6839\u636e\u6807\u9898\u6a21\u7cca\u67e5\u8be2 2 \u9700\u8981\u6839\u636e\u6587\u7ae0id\u67e5\u770b\u6587\u7ae0\u7684\u8be6\u60c5 3 \u4fee\u6539\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5df2\u5b9e\u73b0","title":"16-\u63a5\u53e3\u5b9a\u4e49\u53camapper 13:51"},{"location":"hmtt/day08/#17-_1224","text":"@Autowired private WmNewsMapper wmNewsMapper ; public PageResponseResult findListAndPage ( NewsAuthDto dto ){ //1.\u68c0\u67e5\u53c2\u6570 dto . checkParam (); //\u8bbe\u7f6e\u8d77\u59cb\u9875 dto . setPage (( dto . getPage () - 1 ) * dto . getSize ()); //dto.setTitle(\"%\"+dto.getTitle()+\"%\"); //\u9700\u8981\u5224\u65ad\u662f\u5426\u4e3a\u7a7a,\u5728SQL\u4e2d\u4f7f\u7528concat\u62fc\u63a5\u4e5f\u53ef\u4ee5 null -> \"%null%\" if ( StringUtils . isNotBlank ( dto . getTitle ())){ dto . setTitle ( \"%\" + dto . getTitle () + \"%\" ); } //2.\u5206\u9875\u67e5\u8be2 List < WmNews > list = wmNewsMapper . findListAndPage ( dto ); //\u7edf\u8ba1\u591a\u5c11\u6761\u6570\u636e int count = wmNewsMapper . findListCount ( dto ); //3.\u7ed3\u679c\u8fd4\u56de PageResponseResult responseResult = new PageResponseResult ( dto . getPage (), dto . getSize (), count ); responseResult . setData ( list ); return responseResult ; } @Autowired private WmUserMapper wmUserMapper ; @Override public WmNewsVo findWmNewsVo ( Integer id ) { //1.\u67e5\u8be2\u6587\u7ae0\u4fe1\u606f WmNews wmNews = getById ( id ); //2.\u67e5\u8be2\u4f5c\u8005 WmUser wmUser = null ; if ( wmNews != null && wmNews . getUserId () != null ){ wmUser = wmUserMapper . selectById ( wmNews . getUserId ()); } //3.\u5c01\u88c5vo\u4fe1\u606f\u8fd4\u56de WmNewsVo wmNewsVo = new WmNewsVo (); BeanUtils . copyProperties ( wmNews , wmNewsVo ); if ( wmUser != null ){ wmNewsVo . setAuthorName ( wmUser . getName ()); } return wmNewsVo ; }","title":"17-\u4e1a\u52a1\u5c42\u5b9e\u73b0\u53ca\u6d4b\u8bd5 12:24"},{"location":"hmtt/day08/#mybatis-plusmapper","text":"@Override public PageResponseResult findList ( NewsAuthDto dto ) { //1.\u68c0\u67e5\u5206\u9875\u53c2\u6570 dto . checkParam (); //2.\u8bbe\u7f6e\u5206\u9875\u6761\u4ef6 dto . setPage (( dto . getPage () - 1 ) * dto . getSize ()); if ( StringUtils . isNotBlank ( dto . getTitle ())){ dto . setTitle ( \"%\" + dto . getTitle () + \"%\" ); } //3.\u5206\u9875\u67e5\u8be2 //List<WmNewsVo> list = wmNewsMapper.findListAndPage(dto); IPage < WmNewsVo > wmNewsVoIPage = wmNewsMapper . selectPageVo ( new Page <> ( dto . getPage (), dto . getSize ()), dto ); //\u7edf\u8ba1\u6570\u636e //int count = wmNewsMapper.findListCount(dto); //4.\u7ed3\u679c\u8fd4\u56de PageResponseResult pageResponseResult = new PageResponseResult ( dto . getPage (), dto . getSize () , Integer . parseInt ( String . valueOf ( wmNewsVoIPage . getTotal ()))); pageResponseResult . setData ( wmNewsVoIPage . getRecords ()); return pageResponseResult ; } mapper: /** * <p> * \u67e5\u8be2 : \u6839\u636estate\u72b6\u6001\u67e5\u8be2\u7528\u6237\u5217\u8868\uff0c\u5206\u9875\u663e\u793a * </p> * * @param page \u5206\u9875\u5bf9\u8c61,xml\u4e2d\u53ef\u4ee5\u4ece\u91cc\u9762\u8fdb\u884c\u53d6\u503c,\u4f20\u9012\u53c2\u6570 Page \u5373\u81ea\u52a8\u5206\u9875,\u5fc5\u987b\u653e\u5728\u7b2c\u4e00\u4f4d(\u4f60\u53ef\u4ee5\u7ee7\u627fPage\u5b9e\u73b0\u81ea\u5df1\u7684\u5206\u9875\u5bf9\u8c61) * @return \u5206\u9875\u5bf9\u8c61 */ public IPage < WmNewsVo > selectPageVo ( Page <?> page , @Param ( \"dto\" ) NewsAuthDto dto ); <select id= \"selectPageVo\" parameterType= \"com.heima.model.admin.dtos.NewsAuthDto\" resultType= \"com.heima.model.wemedia.vo.WmNewsVo\" > SELECT wn.*, wu.`name` authorName FROM wm_news wn LEFT JOIN wm_user wu ON wn.user_id = wu.id <where> <if test= \"dto.title != null and dto.title != ''\" > and wn.title like #{dto.title} </if> </where> </select>","title":"\u6269\u5c55\uff1amybatis-plus\u4f7f\u7528mapper\u6620\u5c04\u6587\u4ef6\u5982\u4f55\u5b9e\u73b0\u66f4\u4f18\u96c5\u7684\u5206\u9875\uff1f"},{"location":"hmtt/day08/#18-admin_0425","text":"1 \u9700\u8981\u5206\u9875\u67e5\u8be2\u81ea\u5a92\u4f53\u6587\u7ae0\u4fe1\u606f\uff0c\u53ef\u4ee5\u6839\u636e\u6807\u9898\u6a21\u7cca\u67e5\u8be2 2 \u5f53\u5ba1\u6838\u901a\u8fc7\u540e\uff0c\u4fee\u6539\u6587\u7ae0\u72b6\u6001\u4e3a4 3 \u5f53\u5ba1\u6838\u9a73\u56de\u540e\uff0c\u4fee\u6539\u6587\u7ae0\u72b6\u6001\u4e3a2(\u8bb2\u4e49\u4e2d\u4e3a3\uff0c\u9519\u8bef)\uff0c\u5e76\u4e14\u9700\u8981\u8bf4\u660e\u539f\u56e0 4 \u9700\u8981\u6839\u636e\u6587\u7ae0id\u67e5\u770b\u6587\u7ae0\u7684\u8be6\u60c5 package com.heima.apis.admin ; import com.heima.model.admin.dtos.NewsAuthDto ; import com.heima.model.common.dtos.ResponseResult ; public interface NewsAuthControllerApi { /** * \u67e5\u8be2\u81ea\u5a92\u4f53\u6587\u7ae0\u5217\u8868 * @param dto * @return */ public ResponseResult findNews ( NewsAuthDto dto ); /** * \u67e5\u8be2\u6587\u7ae0\u8be6\u60c5 * @param id * @return */ public ResponseResult findOne ( Integer id ); /** * \u6587\u7ae0\u5ba1\u6838\u6210\u529f * @param dto * @return */ public ResponseResult authPass ( NewsAuthDto dto ); /** * \u6587\u7ae0\u5ba1\u6838\u5931\u8d25 * @param dto * @return */ public ResponseResult authFail ( NewsAuthDto dto ); }","title":"18-admin\u63a5\u53e3\u5b9a\u4e49 04:25"},{"location":"hmtt/day08/#19-admin_1305","text":"@Override public PageResponseResult findNews ( NewsAuthDto dto ) { //\u5206\u9875\u67e5\u8be2 PageResponseResult responseResult = wemediaFeign . findList ( dto ); //\u8fd4\u56de\u7684\u6570\u636e\u4e2d\u6709\u56fe\u7247\u9700\u8981\u663e\u793a\uff0c\u9700\u8981\u56de\u663e\u4e00\u4e2afasfdfs\u670d\u52a1\u5668\u7684\u5730\u5740 responseResult . setHost ( fileServerUrl ); return responseResult ; } @Override public ResponseResult findOne ( Integer id ) { //1.\u53c2\u6570\u68c0\u67e5 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u6570\u636e WmNewsVo wmNewsVo = wemediaFeign . findWmNewsVo ( id ); //3.\u7ed3\u679c\u5c01\u88c5 ResponseResult responseResult = ResponseResult . okResult ( wmNewsVo ); responseResult . setHost ( fileServerUrl ); return responseResult ; } @Override public ResponseResult updateStatus ( NewsAuthDto dto , Integer type ) { //1.\u53c2\u6570\u68c0\u67e5 if ( dto == null || dto . getId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u6587\u7ae0\u4fe1\u606f WmNews wmNews = wemediaFeign . findById ( dto . getId ()); if ( wmNews == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST ); } //3.\u5ba1\u6838\u5931\u8d25 if ( type . equals ( 0 )){ updateWmNews ( wmNews ,( short ) 2 , dto . getMsg ()); } else if ( type . equals ( 1 )){ //4.\u5ba1\u6838\u6210\u529f updateWmNews ( wmNews ,( short ) 4 , \"\u4eba\u5de5\u5ba1\u6838\u901a\u8fc7\" ); } return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } bug\u89e3\u51b3\uff1a \u4eba\u5de5\u5ba1\u6838\u4e4b\u540e\uff0c\u65e0\u6cd5\u5c06\u6587\u7ae0\u8fdb\u884c\u53d1\u5e03 package com.heima.admin.service.impl ; import com.alibaba.fastjson.JSONArray ; import com.heima.admin.feign.ArticleFeign ; import com.heima.admin.feign.WemediaFeign ; import com.heima.admin.mapper.AdChannelMapper ; import com.heima.admin.mapper.AdSensitiveMapper ; import com.heima.admin.service.WemediaNewsAutoScanService ; import com.heima.common.aliyun.GreeTextScan ; import com.heima.common.aliyun.GreenImageScan ; import com.heima.common.fastdfs.FastDFSClient ; import com.heima.model.admin.dtos.NewsAuthDto ; import com.heima.model.admin.pojos.AdChannel ; import com.heima.model.article.pojos.ApArticle ; import com.heima.model.article.pojos.ApArticleConfig ; import com.heima.model.article.pojos.ApArticleContent ; import com.heima.model.article.pojos.ApAuthor ; import com.heima.model.common.dtos.PageResponseResult ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.wemedia.pojos.WmNews ; import com.heima.model.wemedia.pojos.WmUser ; import com.heima.model.wemedia.vo.WmNewsVo ; import com.heima.utils.common.SensitiveWordUtil ; import io.seata.spring.annotation.GlobalTransactional ; import lombok.extern.log4j.Log4j2 ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.stereotype.Service ; import java.util.* ; @Service @Log4j2 public class WemediaNewsAutoScanServiceImpl implements WemediaNewsAutoScanService { @Autowired private WemediaFeign wemediaFeign ; @GlobalTransactional //@Override public void autoScanByMediaNewsId ( Integer id ) { if ( id == null ) { log . error ( \"\u5f53\u524d\u7684\u5ba1\u6838id\u7a7a\" ); return ; } //1.\u6839\u636eid\u67e5\u8be2\u81ea\u5a92\u4f53\u6587\u7ae0\u4fe1\u606f WmNews wmNews = wemediaFeign . findById ( id ); if ( wmNews == null ) { log . error ( \"\u5ba1\u6838\u7684\u81ea\u5a92\u4f53\u6587\u7ae0\u4e0d\u5b58\u5728\uff0c\u81ea\u5a92\u4f53\u7684id:{}\" , id ); return ; } //2.\u6587\u7ae0\u72b6\u6001\u4e3a4\uff08\u4eba\u5de5\u5ba1\u6838\u901a\u8fc7\uff09\u76f4\u63a5\u4fdd\u5b58\u6570\u636e\u548c\u521b\u5efa\u7d22\u5f15 if ( wmNews . getStatus () == 4 ) { if ( wmNews . getPublishTime (). getTime () <= System . currentTimeMillis ()){ //\u5df2\u7ecf\u5230\u4e86\u53d1\u5e03\u65f6\u95f4 //\u4fdd\u5b58\u6570\u636e saveAppArticle ( wmNews ); } else { updateWmNews ( wmNews , ( short ) 8 , \"\" ); } return ; } //3.\u6587\u7ae0\u72b6\u6001\u4e3a8 \u53d1\u5e03\u65f6\u95f4\u5c0f\u4e8e\u7b49\u4e8e\u5f53\u524d\u65f6\u95f4 \u76f4\u63a5\u4fdd\u5b58\u6570\u636e if ( wmNews . getStatus () == 8 && wmNews . getPublishTime (). getTime () <= System . currentTimeMillis ()) { //\u4fdd\u5b58\u6570\u636e saveAppArticle ( wmNews ); return ; } //4.\u6587\u7ae0\u72b6\u6001\u4e3a1\uff0c\u5f85\u5ba1\u6838 if ( wmNews . getStatus () == 1 ) { //\u62bd\u53d6\u6587\u7ae0\u5185\u5bb9\u4e2d\u7684\u7eaf\u6587\u672c\u548c\u56fe\u7247 Map < String , Object > contentAndImagesResult = handleTextAndImages ( wmNews ); //4.1 \u6587\u672c\u5ba1\u6838 boolean textScanBoolean = handleTextScan (( String ) contentAndImagesResult . get ( \"content\" ), wmNews ); if ( ! textScanBoolean ) return ; //4.2 \u56fe\u7247\u5ba1\u6838 boolean imagesScanBoolean = handleImagesScan (( List < String > ) contentAndImagesResult . get ( \"images\" ), wmNews ); if ( ! imagesScanBoolean ) return ; //4.3 \u81ea\u7ba1\u7406\u7684\u654f\u611f\u8bcd\u5ba1\u6838 boolean sensitiveScanBoolean = handleSensitive (( String ) contentAndImagesResult . get ( \"content\" ), wmNews ); if ( ! sensitiveScanBoolean ) return ; //4.4 \u53d1\u5e03\u65f6\u95f4\u5927\u4e8e\u5f53\u524d\u65f6\u95f4\uff0c if ( wmNews . getPublishTime (). getTime () > System . currentTimeMillis ()) { //\u4fee\u6539\u6587\u7ae0\u72b6\u6001\u4e3a8 updateWmNews ( wmNews , ( short ) 8 , \"\u5ba1\u6838\u901a\u8fc7\uff0c\u5f85\u53d1\u5e03\" ); return ; } //5.\u5ba1\u6838\u901a\u8fc7\uff0c\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u72b6\u6001\u4e3a9 \u4fdd\u5b58app\u7aef\u76f8\u5173\u6587\u7ae0\u4fe1\u606f saveAppArticle ( wmNews ); } } @Autowired private AdSensitiveMapper adSensitiveMapper ; /** * \u654f\u611f\u8bcd\u5ba1\u6838 * * @param content * @param wmNews * @param wmNews * @return */ private boolean handleSensitive ( String content , WmNews wmNews ) { boolean flag = true ; List < String > allSensitive = adSensitiveMapper . findAllSensitive (); //\u521d\u59cb\u5316\u654f\u611f\u8bcd SensitiveWordUtil . initMap ( allSensitive ); //\u6587\u7ae0\u5185\u5bb9\u81ea\u7ba1\u7406\u654f\u611f\u8bcd\u8fc7\u6ee4 Map < String , Integer > resultMap = SensitiveWordUtil . matchWords ( content ); if ( resultMap . size () > 0 ) { log . error ( \"\u654f\u611f\u8bcd\u8fc7\u6ee4\u6ca1\u6709\u901a\u8fc7\uff0c\u5305\u542b\u4e86\u654f\u611f\u8bcd:{}\" , resultMap ); //\u627e\u5230\u4e86\u654f\u611f\u8bcd\uff0c\u5ba1\u6838\u4e0d\u901a\u8fc7 updateWmNews ( wmNews , ( short ) 2 , \"\u6587\u7ae0\u4e2d\u5305\u542b\u4e86\u654f\u611f\u8bcd\" ); flag = false ; } return flag ; } @Autowired private GreenImageScan greenImageScan ; @Autowired private FastDFSClient fastDFSClient ; @Value ( \"${fdfs.url}\" ) private String fileServerUrl ; /** * \u5ba1\u6838\u56fe\u7247 * * @param images * @param wmNews * @param wmNews * @return */ private boolean handleImagesScan ( List < String > images , WmNews wmNews ) { if ( images == null ) { return true ; } boolean flag = true ; List < byte []> imageList = new ArrayList <> (); try { for ( String image : images ) { String imageName = image . replace ( fileServerUrl , \"\" ); int index = imageName . indexOf ( \"/\" ); String groupName = imageName . substring ( 0 , index ); String imagePath = imageName . substring ( index + 1 ); byte [] imageByte = fastDFSClient . download ( groupName , imagePath ); imageList . add ( imageByte ); } //\u963f\u91cc\u4e91\u56fe\u7247\u5ba1\u6838 Map map = greenImageScan . imageScan ( imageList ); //\u5ba1\u6838\u4e0d\u901a\u8fc7 if ( ! map . get ( \"suggestion\" ). equals ( \"pass\" )) { //\u5ba1\u6838\u5931\u8d25 if ( map . get ( \"suggestion\" ). equals ( \"block\" )) { //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 updateWmNews ( wmNews , ( short ) 2 , \"\u6587\u7ae0\u4e2d\u56fe\u7247\u6709\u8fdd\u89c4\" ); flag = false ; } //\u4eba\u5de5\u5ba1\u6838 if ( map . get ( \"suggestion\" ). equals ( \"review\" )) { //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 updateWmNews ( wmNews , ( short ) 3 , \"\u6587\u7ae0\u56fe\u7247\u6709\u4e0d\u786e\u5b9a\u5143\u7d20\" ); flag = false ; } } } catch ( Exception e ) { e . printStackTrace (); flag = false ; } return flag ; } @Autowired private GreeTextScan greeTextScan ; /** * \u6587\u672c\u5ba1\u6838 * * @param content * @param wmNews * @return */ private boolean handleTextScan ( String content , WmNews wmNews ) { boolean flag = true ; try { Map map = greeTextScan . greeTextScan ( content ); //\u5ba1\u6838\u4e0d\u901a\u8fc7 if ( ! map . get ( \"suggestion\" ). equals ( \"pass\" )) { //\u5ba1\u6838\u5931\u8d25 if ( map . get ( \"suggestion\" ). equals ( \"block\" )) { //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 updateWmNews ( wmNews , ( short ) 2 , \"\u6587\u7ae0\u5185\u5bb9\u4e2d\u6709\u654f\u611f\u8bcd\u6c47\" ); flag = false ; } //\u4eba\u5de5\u5ba1\u6838 if ( map . get ( \"suggestion\" ). equals ( \"review\" )) { //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\uff0c\u5e76\u544a\u77e5\u5ba1\u6838\u5931\u8d25\u539f\u56e0 updateWmNews ( wmNews , ( short ) 3 , \"\u6587\u7ae0\u5185\u5bb9\u4e2d\u6709\u4e0d\u786e\u5b9a\u8bcd\u6c47\" ); flag = false ; } } } catch ( Exception e ) { e . printStackTrace (); flag = false ; } return flag ; } /** * \u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0 * * @param wmNews * @param status * @param msg */ private void updateWmNews ( WmNews wmNews , short status , String msg ) { wmNews . setStatus ( status ); wmNews . setReason ( msg ); wemediaFeign . updateWmNews ( wmNews ); } /** * \u63d0\u53d6\u6587\u672c\u5185\u5bb9\u548c\u56fe\u7247 * * @param wmNews * @return */ private Map < String , Object > handleTextAndImages ( WmNews wmNews ) { //\u6587\u7ae0\u7684\u5185\u5bb9 String content = wmNews . getContent (); //\u5b58\u50a8\u7eaf\u6587\u672c\u5185\u5bb9 StringBuilder sb = new StringBuilder (); //\u5b58\u50a8\u56fe\u7247 List < String > images = new ArrayList <> (); List < Map > contentList = JSONArray . parseArray ( content , Map . class ); for ( Map map : contentList ) { if ( map . get ( \"type\" ). equals ( \"text\" )) { sb . append ( map . get ( \"value\" )); } if ( map . get ( \"type\" ). equals ( \"image\" )) { images . add (( String ) map . get ( \"value\" )); } } if ( wmNews . getImages () != null && wmNews . getType () != 0 ) { String [] split = wmNews . getImages (). split ( \",\" ); images . addAll ( Arrays . asList ( split )); } Map < String , Object > resultMap = new HashMap <> (); resultMap . put ( \"content\" , sb . toString ()); resultMap . put ( \"images\" , images ); return resultMap ; } @Autowired ArticleFeign articleFeign ; /** * \u4fdd\u5b58app\u6587\u7ae0\u76f8\u5173\u7684\u6570\u636e * * @param wmNews */ private void saveAppArticle ( WmNews wmNews ) { //\u4fdd\u5b58app\u6587\u7ae0 ApArticle apArticle = saveArticle ( wmNews ); //\u4fdd\u5b58app\u6587\u7ae0\u914d\u7f6e saveArticleConfig ( apArticle ); //\u4fdd\u5b58app\u6587\u7ae0\u5185\u5bb9 saveArticleContent ( apArticle , wmNews ); //\u4fee\u6539\u81ea\u5a92\u4f53\u6587\u7ae0\u7684\u72b6\u6001\u4e3a9 wmNews . setArticleId ( apArticle . getId ()); updateWmNews ( wmNews , ( short ) 9 , \"\u5ba1\u6838\u901a\u8fc7\" ); //TODO es\u7d22\u5f15\u521b\u5efa } /** * \u521b\u5efaapp\u7aef\u6587\u7ae0\u5185\u5bb9\u4fe1\u606f * * @param apArticle * @param wmNews */ private void saveArticleContent ( ApArticle apArticle , WmNews wmNews ) { ApArticleContent apArticleContent = new ApArticleContent (); apArticleContent . setArticleId ( apArticle . getId ()); apArticleContent . setContent ( wmNews . getContent ()); articleFeign . saveArticleContent ( apArticleContent ); } /** * \u521b\u5efaapp\u7aef\u6587\u7ae0\u914d\u7f6e\u4fe1\u606f * * @param apArticle */ private void saveArticleConfig ( ApArticle apArticle ) { ApArticleConfig apArticleConfig = new ApArticleConfig (); apArticleConfig . setArticleId ( apArticle . getId ()); apArticleConfig . setIsForward ( true ); apArticleConfig . setIsDelete ( false ); apArticleConfig . setIsDown ( true ); apArticleConfig . setIsComment ( true ); articleFeign . saveArticleConfig ( apArticleConfig ); } @Autowired AdChannelMapper adChannelMapper ; /** * \u4fdd\u5b58\u6587\u7ae0 * * @param wmNews * @return */ private ApArticle saveArticle ( WmNews wmNews ) { ApArticle apArticle = new ApArticle (); apArticle . setTitle ( wmNews . getTitle ()); apArticle . setLayout ( wmNews . getType ()); apArticle . setImages ( wmNews . getImages ()); apArticle . setCreatedTime ( new Date ()); //\u83b7\u53d6\u4f5c\u8005\u76f8\u5173\u4fe1\u606f Integer wmUserId = wmNews . getUserId (); WmUser wmUser = wemediaFeign . findWmUserById ( wmUserId ); if ( wmUser != null ) { String wmUserName = wmUser . getName (); ApAuthor apAuthor = articleFeign . selectAuthorByName ( wmUserName ); if ( apAuthor != null ) { apArticle . setAuthorId ( apAuthor . getId (). longValue ()); apArticle . setAuthorName ( apAuthor . getName ()); } } //\u83b7\u53d6\u9891\u9053\u76f8\u5173\u4fe1\u606f Integer channelId = wmNews . getChannelId (); AdChannel channel = adChannelMapper . selectById ( channelId ); if ( channel != null ) { apArticle . setChannelId ( channel . getId ()); apArticle . setChannelName ( channel . getName ()); } return articleFeign . saveAparticle ( apArticle ); } @Override public PageResponseResult findNews ( NewsAuthDto dto ) { //\u5206\u9875\u67e5\u8be2 PageResponseResult responseResult = wemediaFeign . findList ( dto ); //\u8fd4\u56de\u7684\u6570\u636e\u4e2d\u6709\u56fe\u7247\u9700\u8981\u663e\u793a\uff0c\u9700\u8981\u56de\u663e\u4e00\u4e2afasfdfs\u670d\u52a1\u5668\u7684\u5730\u5740 responseResult . setHost ( fileServerUrl ); return responseResult ; } @Override public ResponseResult findOne ( Integer id ) { //1.\u53c2\u6570\u68c0\u67e5 if ( id == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u6570\u636e WmNewsVo wmNewsVo = wemediaFeign . findWmNewsVo ( id ); //3.\u7ed3\u679c\u5c01\u88c5 ResponseResult responseResult = ResponseResult . okResult ( wmNewsVo ); responseResult . setHost ( fileServerUrl ); return responseResult ; } @Override public ResponseResult updateStatus ( NewsAuthDto dto , Integer type ) { //1.\u53c2\u6570\u68c0\u67e5 if ( dto == null || dto . getId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u6587\u7ae0\u4fe1\u606f WmNews wmNews = wemediaFeign . findById ( dto . getId ()); if ( wmNews == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST ); } //3.\u5ba1\u6838\u5931\u8d25 if ( type . equals ( 0 )){ updateWmNews ( wmNews ,( short ) 2 , dto . getMsg ()); } else if ( type . equals ( 1 )){ //4.\u5ba1\u6838\u6210\u529f updateWmNews ( wmNews ,( short ) 4 , \"\u4eba\u5de5\u5ba1\u6838\u901a\u8fc7\" ); //\u4eba\u5de5\u5ba1\u6838\u901a\u8fc7\u4e4b\u540e\uff0c\u518d\u6b21\u6267\u884c\u81ea\u52a8\u5ba1\u6838\u4ee3\u7801 autoScanByMediaNewsId ( dto . getId ()); } return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } }","title":"19-admin\u4e1a\u52a1\u5b9e\u73b0 13:05"},{"location":"hmtt/day08/#20-_0244","text":"","title":"20-\u7efc\u5408\u6d4b\u8bd5 02:44"},{"location":"hmtt/day08/#21-_0531","text":"\u5728\u81ea\u5a92\u4f53\u6587\u7ae0\u7ba1\u7406\u4e2d\u6709\u6587\u7ae0\u4e0a\u4e0b\u67b6\u7684\u64cd\u4f5c\uff0c\u4e0a\u4e0b\u67b6\u662f\u6587\u7ae0\u5df2\u7ecf\u5ba1\u6838\u901a\u8fc7\u53d1\u5e03\u4e4b\u540e\u7684\u6587\u7ae0\uff0c\u76ee\u524d\u81ea\u52a8\u5ba1\u6838\u6587\u7ae0\u548c\u4eba\u5de5\u5ba1\u6838\u6587\u7ae0\u90fd\u5df2\u5b8c\u6210\uff0c\u53ef\u4ee5\u628a\u4e4b\u524d\u4ee3\u7801\u8865\u5145\uff0c\u4f7f\u7528\u5f02\u6b65\u7684\u65b9\u5f0f\uff0c\u4fee\u6539app\u7aef\u6587\u7ae0\u7684 \u914d\u7f6e\u4fe1\u606f \u5373\u53ef\u3002 \u4fee\u6539article\u6570\u636e\u5e93\u4e2dap_article_config\u8868\u7684is_down\u5b57\u6bb5\uff1a \u4e0b\u67b6\u64cd\u4f5c\uff0c\u5c06\u503c\u6539\u4e3a1 \u4e0a\u67b6\u64cd\u4f5c\uff0c\u5c06\u503c\u6539\u4e3a0","title":"21-\u6587\u7ae0\u4e0a\u4e0b\u67b6 05:31"},{"location":"hmtt/day08/#22-_1028","text":"\u6d88\u606f\u53d1\u9001\u65b9:wmnews @Override public ResponseResult downOrUp ( WmNewsDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || dto . getId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u6587\u7ae0 WmNews wmNews = getById ( dto . getId ()); if ( wmNews == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u6587\u7ae0\u4e0d\u5b58\u5728\" ); } //3.\u5224\u65ad\u6587\u7ae0\u662f\u5426\u53d1\u5e03 if ( ! wmNews . getStatus (). equals ( WmNews . Status . PUBLISHED . getCode ())){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u5f53\u524d\u6587\u7ae0\u4e0d\u662f\u53d1\u5e03\u72b6\u6001\uff0c\u4e0d\u80fd\u4e0a\u4e0b\u67b6\" ); } //4.\u4fee\u6539\u6587\u7ae0\u72b6\u6001\uff0c\u540c\u6b65\u5230app\u7aef\uff08\u540e\u671f\u505a\uff09TODO if ( dto . getEnable () != null && dto . getEnable () > - 1 && dto . getEnable () < 2 ){ if ( wmNews . getArticleId () != null ){ Map < String , Object > map = new HashMap <> (); //\u4e0a\u4e0b\u67b6\u53c2\u6570 map . put ( \"enable\" , dto . getEnable ()); map . put ( \"articleId\" , wmNews . getArticleId ()); //\u53d1\u9001\u6d88\u606f\u5230kafka\uff0c\u53c2\u6570\u4e3amap\uff0ctopic\u662f\u65b0\u589e\u7684\u9700\u8981\u5b9a\u4e49\u5e38\u91cf kafkaTemplate . send ( WmNewsMessageConstants . WM_NEWS_UP_OR_DOWN_TOPIC , JSON . toJSONString ( map )); } update ( Wrappers . < WmNews > lambdaUpdate (). eq ( WmNews :: getId , dto . getId ()). set ( WmNews :: getEnable , dto . getEnable ())); } return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } \u6d88\u606f\u63a5\u6536\u65b9: article package com.heima.article.kafka.listener ; import com.alibaba.fastjson.JSON ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.article.service.ApArticleConfigService ; import com.heima.common.constans.message.WmNewsMessageConstants ; import com.heima.model.article.pojos.ApArticleConfig ; import org.apache.kafka.clients.consumer.ConsumerRecord ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.kafka.annotation.KafkaListener ; import org.springframework.stereotype.Component ; import java.util.Map ; import java.util.Optional ; @Component public class ArticleIsDownListener { @Autowired private ApArticleConfigService apArticleConfigService ; @KafkaListener ( topics = WmNewsMessageConstants . WM_NEWS_UP_OR_DOWN_TOPIC ) public void receiveMessage ( ConsumerRecord <? , ?> record ){ Optional <? extends ConsumerRecord <? , ?>> optional = Optional . ofNullable ( record ); //\u5224\u65ad\u6d88\u606f\u662f\u5426\u4e3a\u7a7a if ( optional . isPresent ()){ //\u83b7\u53d6\u4f20\u9012\u8fc7\u6765\u7684json\u5b57\u7b26\u4e32 String value = ( String ) record . value (); //\u53cd\u5e8f\u5217\u5316\u4e3amap\u5bf9\u8c61 Map map = JSON . parseObject ( value , Map . class ); apArticleConfigService . update ( Wrappers . < ApArticleConfig > lambdaUpdate () . eq ( ApArticleConfig :: getArticleId , map . get ( \"articleId\" )) . set ( ApArticleConfig :: getIsDown , map . get ( \"enable\" ))); } } }","title":"22-\u529f\u80fd\u5b9e\u73b0 10:28"},{"location":"hmtt/day09/","text":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 00:49 \u00b6 \u80fd\u591f\u5b8c\u6210app\u7aef\u6587\u7ae0\u5217\u8868\u5c55\u793a\u529f\u80fd\u5f00\u53d1 \u80fd\u591f\u5b8c\u6210app\u7aef\u6587\u7ae0\u8be6\u60c5\u7684\u529f\u80fd\u5f00\u53d1 \u80fd\u591f\u638c\u63e1\u89e3\u51b3long\u7c7b\u578b\u4e22\u5931\u7cbe\u5ea6\u7684\u95ee\u9898 \u80fd\u591f\u5b8c\u6210app\u7aef\u767b\u5f55\u7684\u529f\u80fd \u80fd\u591f\u638c\u63e1\u5173\u6ce8\u4f5c\u8005\u529f\u80fd 02-\u6587\u7ae0\u5217\u8868-\u9700\u6c42\u5206\u6790 \u00b6 1,\u5728\u9ed8\u8ba4\u9891\u9053\u5c55\u793a10\u6761\u6587\u7ae0\u4fe1\u606f >\u5206\u9875\u67e5\u8be2 2,\u53ef\u4ee5\u5207\u6362\u9891\u9053\u67e5\u770b\u4e0d\u540c\u79cd\u7c7b\u6587\u7ae0 \u6839\u636e\u9891\u9053\u7c7b\u522b\u8fdb\u884c\u67e5\u8be2 3,\u5f53\u7528\u6237\u4e0b\u62c9\u53ef\u4ee5\u52a0\u8f7d\u6700\u65b0\u7684\u6587\u7ae0\u4fe1\u606f\uff08\u6309\u7167\u53d1\u5e03\u65f6\u95f4\uff09 \u89c1\u4e0a\u56fe\uff0c\u6839\u636e\u53d1\u5e03\u65f6\u95f4\u67e5\u8be2 \u672c\u9875\u6587\u7ae0\u5217\u8868\u4e2d\u53d1\u5e03\u65f6\u95f4\u6700\u5927\u7684\u65f6\u95f4\u4e3a\u4f9d\u636e 4,\u5f53\u7528\u6237\u4e0a\u62c9\u53ef\u4ee5\u52a0\u8f7d\u66f4\u591a\u7684\u6587\u7ae0\uff08\u5206\u9875\uff09 \u672c\u9875\u6587\u7ae0\u5217\u8868\u4e2d\u53d1\u5e03\u65f6\u95f4\u4e3a\u6700\u5c0f\u7684\u65f6\u95f4\u4e3a\u4f9d\u636e 03-\u63a5\u53e3\u5b9a\u4e49 04:11 \u00b6 article-home-controller \u00b6 load \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/article/load \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"maxBehotTime\" : \"\" , \"minBehotTime\" : \"\" , \"size\" : 10 , \"tag\" : \"\" } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true ArticleHomeDto ArticleHomeDto \u2003\u2003maxBehotTime \u6700\u5927\u65f6\u95f4 false string(date-time) \u2003\u2003minBehotTime \u6700\u5c0f\u65f6\u95f4 false string(date-time) \u2003\u2003size \u5f53\u524d\u9875\u5c55\u793a\u6570\u636e\u6570\u636e\u91cf false integer(int32) \u2003\u2003tag \u9891\u9053ID false string \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" } loadMore \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/article/loadmore \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"maxBehotTime\" : \"\" , \"minBehotTime\" : \"\" , \"size\" : 0 , \"tag\" : \"\" } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true ArticleHomeDto ArticleHomeDto \u2003\u2003maxBehotTime false string(date-time) \u2003\u2003minBehotTime false string(date-time) \u2003\u2003size false integer(int32) \u2003\u2003tag false string \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" } loadNew \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/article/loadnew \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"maxBehotTime\" : \"\" , \"minBehotTime\" : \"\" , \"size\" : 0 , \"tag\" : \"\" } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true ArticleHomeDto ArticleHomeDto \u2003\u2003maxBehotTime false string(date-time) \u2003\u2003minBehotTime false string(date-time) \u2003\u2003size false integer(int32) \u2003\u2003tag false string \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" } \u5728apis\u6a21\u5757\u4e2d\u65b0\u589e\u63a5\u53e3 package com.heima.apis.article ; import com.heima.model.article.dtos.ArticleHomeDto ; import com.heima.model.common.dtos.ResponseResult ; public interface ArticleHomeControllerApi { /** * \u52a0\u8f7d\u9996\u9875\u6587\u7ae0 * @return */ public ResponseResult load ( ArticleHomeDto dto ); /** * \u52a0\u8f7d\u66f4\u591a * @return */ public ResponseResult loadMore ( ArticleHomeDto dto ); /** * \u52a0\u8f7d\u6700\u65b0 * @return */ public ResponseResult loadNew ( ArticleHomeDto dto ); } ArticleHomeDto package com.heima.model.article.dtos ; import lombok.Data ; import java.util.Date ; @Data public class ArticleHomeDto { // \u6700\u5927\u65f6\u95f4 Date maxBehotTime ; // \u6700\u5c0f\u65f6\u95f4 Date minBehotTime ; // \u5206\u9875size Integer size ; // \u6570\u636e\u8303\u56f4\uff0c\u6bd4\u5982\u9891\u9053ID String tag ; } 04-SQL\u7f16\u5199 10:05 \u00b6 <?xml version=\"1.0\" encoding=\"UTF-8\"?> <!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"> <mapper namespace= \"com.heima.article.mapper.ApArticleMapper\" > <resultMap id= \"resultMap\" type= \"com.heima.model.article.pojos.ApArticle\" > <id column= \"id\" property= \"id\" /> <result column= \"title\" property= \"title\" /> <result column= \"author_id\" property= \"authorId\" /> <result column= \"author_name\" property= \"authorName\" /> <result column= \"channel_id\" property= \"channelId\" /> <result column= \"channel_name\" property= \"channelName\" /> <result column= \"layout\" property= \"layout\" /> <result column= \"flag\" property= \"flag\" /> <result column= \"images\" property= \"images\" /> <result column= \"labels\" property= \"labels\" /> <result column= \"likes\" property= \"likes\" /> <result column= \"collection\" property= \"collection\" /> <result column= \"comment\" property= \"comment\" /> <result column= \"views\" property= \"views\" /> <result column= \"province_id\" property= \"provinceId\" /> <result column= \"city_id\" property= \"cityId\" /> <result column= \"county_id\" property= \"countyId\" /> <result column= \"created_time\" property= \"createdTime\" /> <result column= \"publish_time\" property= \"publishTime\" /> <result column= \"sync_status\" property= \"syncStatus\" /> </resultMap> <select id= \"loadArticleList\" resultMap= \"resultMap\" > SELECT aa.* FROM `ap_article` aa LEFT JOIN ap_article_config aac ON aa.id = aac.article_id <where> and aac.is_delete != 1 and aac.is_down != 1 <!-- loadmore --> <if test= \"type != null and type == 1\" > and aa.publish_time &lt; #{dto.minBehotTime} </if> <if test= \"type != null and type == 2\" > <![CDATA[ and aa.publish_time > #{dto.maxBehotTime} ]]> </if> <if test= \"dto.tag != '__all__'\" > and aa.channel_id = #{dto.tag} </if> </where> order by aa.publish_time desc limit #{dto.size} </select> </mapper> 05-\u4e1a\u52a1\u5c42\u4ee3\u7801\u7f16\u5199 14:02 \u00b6 package com.heima.article.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.heima.model.article.dtos.ArticleHomeDto ; import com.heima.model.article.pojos.ApArticle ; import org.apache.ibatis.annotations.Mapper ; import org.apache.ibatis.annotations.Param ; import java.util.List ; @Mapper public interface ApArticleMapper extends BaseMapper < ApArticle > { public List < ApArticle > loadArticleList ( @Param ( \"dto\" ) ArticleHomeDto dto , @Param ( \"type\" ) Short type ); } @Override public ResponseResult load ( ArticleHomeDto dto , Short loadType ) { //1.\u6821\u9a8c\u53c2\u6570 Integer size = dto . getSize (); if ( size == null || size <= 0 ){ size = 10 ; } //\u6700\u591a\u53ea\u80fd\u8bf7\u6c4250\u6761\uff0c\u5982\u679c>=50\u5c31\u53d650 size = Math . min ( size , MAX_PAGE_SIZE ); dto . setSize ( size ); //\u7c7b\u578b\u53c2\u6570\u68c0\u9a8c \u5224\u65ad\u5982\u679c\u4e0d\u7b49\u4e8e1\u548c2\uff0c\u7ed9\u51fa\u9ed8\u8ba4\u503c1 if ( ! loadType . equals ( ArticleConstans . LOADTYPE_LOAD_MORE ) &&! loadType . equals ( ArticleConstans . LOADTYPE_LOAD_NEW )){ loadType = ArticleConstans . LOADTYPE_LOAD_MORE ; } //\u6587\u7ae0\u9891\u9053\u6821\u9a8c \u5982\u679c\u6ca1\u6709\u4f20\u9012tag\u53c2\u6570\uff0c\u5c31\u7ed9\u51fa\u9ed8\u8ba4\u7684\u503c_all_,\u67e5\u8be2\u6240\u6709\u6570\u636e if ( StringUtils . isEmpty ( dto . getTag ())){ dto . setTag ( ArticleConstans . DEFAULT_TAG ); } //\u65f6\u95f4\u6821\u9a8c \u5982\u679c\u4e3a\u7a7a\uff0c\u8bbe\u7f6e\u4e3a\u6700\u65b0\u7684\u65f6\u95f4 if ( dto . getMaxBehotTime () == null ) dto . setMaxBehotTime ( new Date ()); if ( dto . getMinBehotTime () == null ) dto . setMinBehotTime ( new Date ()); //2.\u67e5\u8be2\u6570\u636e List < ApArticle > apArticles = apArticleMapper . loadArticleList ( dto , loadType ); //3.\u7ed3\u679c\u5c01\u88c5 host\u5730\u5740 + \u56fe\u7247ID \u62fc\u6210\u56fe\u7247URL ResponseResult responseResult = ResponseResult . okResult ( apArticles ); responseResult . setHost ( fileServerUrl ); return responseResult ; } 06-\u6d4b\u8bd5\u548c\u7f51\u5173\u642d\u5efa 08:50 \u00b6 07-\u524d\u7aef\u642d\u5efa\u548c\u8054\u8c03\u6d4b\u8bd5 10:44 \u00b6 \u6ce8\u610f\uff1a\u6309TAB\u952e\u624d\u53ef\u4ee5\u5728\u524d\u7aef\u9009\u4e2d\u8f93\u5165\u6846 \u00b6 1.\u4f7f\u7528vs code\u6253\u5f00\u9879\u76ee\u4e4b\u540e\uff0c\u4f7f\u7528npm install\u5148\u66f4\u65b0\u9879\u76ee\uff08\u53ef\u4e0d\u505a\uff09 2.\u6839\u636e\u8bb2\u4e49\u4e2d\u7684\u5185\u5bb9\u4fee\u6539IP\u5730\u5740\uff08\u5df2\u4fee\u6539\u4e3a127.0.0.1\uff0c\u672c\u5730\u8c03\u8bd5\u5c31\u4e0d\u7528\u6539\uff0c\u5982\u679c\u662fWIFI\u8c03\u8bd5\uff0c\u6539\u6210\u540c\u4e00\u7f51\u6bb5\u4e0b\u7684\u5185\u7f51IP\uff09 3.\u4f7f\u7528Terminal\u7ec8\u7aef\uff0cnpm run start\u547d\u4ee4\u542f\u52a8\u5373\u53ef \u524d\u7aef\u9700\u8981\u767b\u5f55\u624d\u53ef\u4ee5\u6d4b\u8bd5\u6587\u7ae0\u5185\u5bb9\u5c55\u793a\uff0c\u5148\u5b8c\u6210\u767b\u5f55\u529f\u80fd\u518d\u6d4b\u8bd5 08-\u9700\u6c42\u8bf4\u660e\u548c\u601d\u8def\u5206\u6790 03:21 \u00b6 \u6587\u7ae0\u8be6\u60c5\u6240\u5c55\u793a\u7684\u4e3b\u8981\u662f\u6587\u7ae0\u7684\u5185\u5bb9\uff0c\u8fd9\u4e2a\u65f6\u5019\u65e0\u987b\u518d\u6b21\u52a0\u91cdap_article\u8868\u4e2d\u7684\u6570\u636e\uff0c\u53ea\u9700\u8981\u901a\u8fc7\u524d\u7aef\u4f20\u9012\u8fc7\u6765\u7684\u6587\u7ae0id\u53bb\u67e5\u8be2\u6587\u7ae0\u7684\u5185\u5bb9\u5373\u53ef\uff0c\u540c\u65f6\u9700\u8981\u5224\u65ad\u5f53\u524d\u6587\u7ae0\u662f\u5426\u5df2\u4e0a\u67b6\u548c\u662f\u5426\u5df2\u7ecf\u5220\u9664\u3002 \u7531\u5206\u6790\u5f97\u51fa\uff0c\u4e3b\u8981\u662f\u901a\u8fc7\u6587\u7ae0id\u67e5\u8be2ap_article_content\u548cap_article_config\u8868\u7684\u6570\u636e\u5373\u53ef\u3002 ap_article_content app\u6587\u7ae0\u5185\u5bb9\u8868 ap_article_config app\u6587\u7ae0\u914d\u7f6e\u8868 loadArticleInfo \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/article/load_article_info \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"articleId\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true ArticleInfoDto ArticleInfoDto \u2003\u2003articleId false integer(int64) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : { \"content\" : \u6587\u7ae0\u5bf9\u8c61ApArticleContent , \"config\" : \u6587\u7ae0\u914d\u7f6e\u5bf9\u8c61ApArticleConfig }, \"errorMessage\" : \"\" , \"host\" : \"\" } 09-\u529f\u80fd\u5f00\u53d1 10:43 \u00b6 package com.heima.article.service.impl ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.article.mapper.ApArticleConfigMapper ; import com.heima.article.mapper.ApArticleContentMapper ; import com.heima.article.service.ArticleInfoService ; import com.heima.model.article.dtos.ArticleInfoDto ; import com.heima.model.article.pojos.ApArticleConfig ; import com.heima.model.article.pojos.ApArticleContent ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import java.util.HashMap ; import java.util.Map ; @Service public class ArticleInfoServiceImpl implements ArticleInfoService { @Autowired private ApArticleConfigMapper apArticleConfigMapper ; @Autowired private ApArticleContentMapper apArticleContentMapper ; @Override public ResponseResult loadArticleInfo ( ArticleInfoDto dto ) { Map < String , Object > resultMap = new HashMap <> (); //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || dto . getArticleId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u6587\u7ae0\u7684\u914d\u7f6e ApArticleConfig apArticleConfig = apArticleConfigMapper . selectOne ( Wrappers . < ApArticleConfig > lambdaQuery (). eq ( ApArticleConfig :: getArticleId , dto . getArticleId ())); if ( apArticleConfig == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //3.\u67e5\u8be2\u6587\u7ae0\u7684\u5185\u5bb9 if ( ! apArticleConfig . getIsDelete () && ! apArticleConfig . getIsDown ()){ ApArticleContent apArticleContent = apArticleContentMapper . selectOne ( Wrappers . < ApArticleContent > lambdaQuery (). eq ( ApArticleContent :: getArticleId , dto . getArticleId ())); resultMap . put ( \"content\" , apArticleContent ); } else { //\u5f53\u524d\u6587\u7ae0\u5df2\u7ecf\u88ab\u4e0b\u67b6\u6216\u8005\u5220\u9664\uff0c\u65e0\u6cd5\u8fdb\u884c\u9605\u8bfb return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } resultMap . put ( \"config\" , apArticleConfig ); //4.\u7ed3\u679c\u8fd4\u56de return ResponseResult . okResult ( resultMap ); } } 10-APP\u6587\u7ae0\u8be6\u60c5-\u6d4b\u8bd5 04:52 \u00b6 1.\u542f\u52a8article\u5fae\u670d\u52a1 2.\u542f\u52a8app\u7f51\u5173 3.\u542f\u52a8\u524d\u7aef\u9879\u76ee npm run start 11-Long\u7c7b\u578b\u8f6c\u6362 12:25 \u00b6 \u4ea7\u751f\u539f\u56e0\uff1a js \u7684 number \u7c7b\u578b\u652f\u6301\u7684\u6700\u5927\u503c\u662f9007199254740992 \uff082 \u7684 53\u6b21\u65b9 -1\uff0916\u4f4d\uff0c\u6ea2\u51fa\u4e4b\u540e\u7684\u7cbe\u5ea6\u4f1a\u4e22\u5931\uff0c\u5bfc\u81f4\u524d\u540e\u7aef\u7684\u503c\u4e0d\u4e00\u81f4\u3002 java \u7684 long \u7c7b\u578b\u6700\u5927\u503c\u4e3a 9223372036854775807 19\u4f4d\uff0c\u8fdc\u9ad8\u4e8e js number\u7c7b\u578b\u7684\u6700\u5927\u503c\uff0c\u6240\u4ee5\u8fd9\u4e2a\u5751\u5c31\u51fa\u73b0\u4e86\u3002 \u89e3\u51b3\u601d\u8def\uff1a \u65b9\u6848\u4e00\uff1a\u5c06\u6587\u7ae0\u7684id\u7684\u7531long\u7c7b\u578b\u624b\u52a8\u6539\u4e3aString\u7c7b\u578b\uff0c\u53ef\u4ee5\u89e3\u51b3\u6b64\u95ee\u9898\u3002\uff08\u9700\u8981\u4fee\u6539\u8868\u7ed3\u6784\uff09 \u65b9\u6848\u4e8c\uff1a\u53ef\u4ee5\u4f7f\u7528jackson\u8fdb\u884c\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u89e3\u51b3\uff08\u672c\u9879\u76ee\u91c7\u7528\u8fd9\u79cd\u65b9\u6848\uff09 \u8fd9\u90e8\u5206\u4e0d\u9700\u8981\u540c\u5b66\u4eec\u81ea\u5df1\u5199\uff0c\u628a\u76f8\u5173\u4ee3\u7801\u653e\u8fdb\u53bb\u5373\u53ef\u3002 jackson\u7684\u914d\u7f6e\u6587\u4ef6 package com.heima.common.jackson ; import com.fasterxml.jackson.core.Version ; import com.fasterxml.jackson.databind.DeserializationFeature ; import com.fasterxml.jackson.databind.Module ; import com.fasterxml.jackson.databind.ObjectMapper ; import com.fasterxml.jackson.databind.PropertyNamingStrategy ; public class ConfusionModule extends Module { public final static String MODULE_NAME = \"jackson-confusion-encryption\" ; public final static Version VERSION = new Version ( 1 , 0 , 0 , null , \"heima\" , MODULE_NAME ); @Override public String getModuleName () { return MODULE_NAME ; } @Override public Version version () { return VERSION ; } @Override public void setupModule ( SetupContext context ) { context . addBeanSerializerModifier ( new ConfusionSerializerModifier ()); context . addBeanDeserializerModifier ( new ConfusionDeserializerModifier ()); } /** * \u6ce8\u518c\u5f53\u524d\u6a21\u5757 * @return */ public static ObjectMapper registerModule ( ObjectMapper objectMapper ){ //CamelCase\u7b56\u7565\uff0cJava\u5bf9\u8c61\u5c5e\u6027\uff1apersonId\uff0c\u5e8f\u5217\u5316\u540e\u5c5e\u6027\uff1apersionId //PascalCase\u7b56\u7565\uff0cJava\u5bf9\u8c61\u5c5e\u6027\uff1apersonId\uff0c\u5e8f\u5217\u5316\u540e\u5c5e\u6027\uff1aPersonId //SnakeCase\u7b56\u7565\uff0cJava\u5bf9\u8c61\u5c5e\u6027\uff1apersonId\uff0c\u5e8f\u5217\u5316\u540e\u5c5e\u6027\uff1aperson_id //KebabCase\u7b56\u7565\uff0cJava\u5bf9\u8c61\u5c5e\u6027\uff1apersonId\uff0c\u5e8f\u5217\u5316\u540e\u5c5e\u6027\uff1aperson-id // \u5ffd\u7565\u591a\u4f59\u5b57\u6bb5\uff0c\u629b\u9519 objectMapper . configure ( DeserializationFeature . FAIL_ON_UNKNOWN_PROPERTIES , false ); // objectMapper.setPropertyNamingStrategy(PropertyNamingStrategy.SNAKE_CASE); return objectMapper . registerModule ( new ConfusionModule ()); } } jackson\u7684\u914d\u7f6e\u7c7b\uff1a package com.heima.common.jackson ; import com.fasterxml.jackson.databind.ObjectMapper ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; @Configuration public class InitJacksonConfig { @Bean public ObjectMapper objectMapper () { ObjectMapper objectMapper = new ObjectMapper (); objectMapper = ConfusionModule . registerModule ( objectMapper ); return objectMapper ; } } \u5728article\u4e2d\u542f\u52a8\u914d\u7f6e\u7c7b\uff1a package com.heima.article.config ; import org.springframework.context.annotation.ComponentScan ; import org.springframework.context.annotation.Configuration ; @Configuration @ComponentScan ( \"com.heima.common.jackson\" ) public class InitConfig { } 12-\u767b\u5f55 \u9700\u6c42\u53ca\u601d\u8def 04:21 \u00b6 \u70b9\u51fb\u767b\u5f55\uff0c\u6821\u9a8c\u624b\u673a\u53f7\u5bc6\u7801\uff0c\u83b7\u53d6\u7528\u6237ID\u751f\u6210jwtToken \u4e0d\u767b\u5f55\u5148\u770b\u770b\uff0c\u76f4\u63a5\u4f7f\u75280\u4f5c\u4e3a\u7528\u6237ID\u751f\u6210jwtToken 13-\u529f\u80fd\u5b9e\u73b0 12:13 \u00b6 package com.heima.user.service.impl ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.user.dtos.LoginDto ; import com.heima.model.user.pojos.ApUser ; import com.heima.user.mapper.ApUserMapper ; import com.heima.user.service.ApUserLoginService ; import com.heima.utils.common.AppJwtUtil ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import org.springframework.util.DigestUtils ; import java.util.HashMap ; import java.util.Map ; @Service public class ApUserLoginServiceImpl implements ApUserLoginService { @Autowired ApUserMapper apUserMapper ; @Override public ResponseResult login ( LoginDto dto ) { //1.\u6821\u9a8c\u53c2\u6570 //2.\u8fd9\u513f\u5199\u9519\u4e86\uff0c\u5e94\u8be5\u662f\u624b\u673a\u53f7 \u5bc6\u7801 \u8bbe\u5907ID\u540c\u65f6\u4e3a\u7a7a \u8fd4\u56de\u9519\u8bef if ( dto . getEquipmentId () == null && ( StringUtils . isEmpty ( dto . getPhone ()) && StringUtils . isEmpty ( dto . getPassword ()))){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u624b\u673a\u53f7+\u5bc6\u7801\u767b\u5f55 if ( ! StringUtils . isEmpty ( dto . getPhone ()) &&! StringUtils . isEmpty ( dto . getPassword ())){ //\u7528\u6237\u767b\u5f55 ApUser dbUser = apUserMapper . selectOne ( Wrappers . < ApUser > lambdaQuery (). eq ( ApUser :: getPhone , dto . getPhone ())); if ( dbUser != null ) { String pswd = DigestUtils . md5DigestAsHex (( dto . getPassword () + dbUser . getSalt ()). getBytes ()); if ( dbUser . getPassword (). equals ( pswd )) { Map < String , Object > map = new HashMap <> (); dbUser . setPassword ( \"\" ); dbUser . setSalt ( \"\" ); map . put ( \"token\" , AppJwtUtil . getToken ( dbUser . getId (). longValue ())); map . put ( \"user\" , dbUser ); return ResponseResult . okResult ( map ); } else { return ResponseResult . errorResult ( AppHttpCodeEnum . LOGIN_PASSWORD_ERROR ); } } else { return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u7528\u6237\u4e0d\u5b58\u5728\" ); } } else { //3.\u8bbe\u5907\u767b\u5f55 if ( dto . getEquipmentId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //\u6839\u636e\u8bbe\u5907ID\uff0c\u5728\u7528\u6237\u8868\u4e2d\u67e5\u8be2\u4e00\u4e0b\uff0c\u5982\u679c\u7528\u6237\u5b58\u5728\uff0c\u8fd4\u56de\u7528\u6237ID\uff0c\u5982\u679c\u7528\u6237\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u7528\u6237\u5e76\u4e14\u7ed1\u5b9a\u8bbe\u5907ID //\u8bbe\u5907\u767b\u5f55\u76f4\u63a5\u7ed9\u7528\u6237\u8bbe\u7f6eid\u4e3a0 Map < String , Object > map = new HashMap <> (); map . put ( \"token\" , AppJwtUtil . getToken ( 0 l )); return ResponseResult . okResult ( map ); } } } 14-\u7f51\u5173\u642d\u5efa\u53ca\u6d4b\u8bd5 12:13 \u00b6 15-\u5173\u6ce8\u548c\u53d6\u6d88\u5173\u6ce8-\u9700\u6c42\u548c\u601d\u8def\u5206\u6790 06:48 \u00b6 \u70b9\u51fb\u6309\u94ae\u53ef\u4ee5\u5173\u6ce8\u7528\u6237\uff0c\u518d\u6b21\u70b9\u51fb\u53d6\u6d88\u5173\u6ce8 \u4e00\u4e2a\u7528\u6237\u53ef\u4ee5\u5173\u6ce8\u591a\u4e2a\u4f5c\u8005\uff0c\u4e00\u4e2a\u4f5c\u8005\u4e5f\u53ef\u4ee5\u6709\u591a\u4e2a\u7c89\u4e1d 1.\u524d\u7aef\u4f20\u9012\u4f5c\u8005ID 2.\u7528\u6237\u4fdd\u5b58\u5173\u6ce8\u7684\u4f5c\u8005\uff0c\u4f5c\u8005\u4fdd\u5b58\u5f53\u524d\u7c89\u4e1d\uff0c\u8fd9\u662f\u4e24\u5f20\u8868 3.\u53d6\u6d88\u5173\u6ce8\uff0c\u8981\u5220\u9664\u4e0a\u8ff0\u4e24\u5f20\u8868\u7684\u5185\u5bb9 \u4e24\u5f20\u8868\uff1a app\u5173\u6ce8\u4fe1\u606f\u8868 ap_user_follow CREATE TABLE ` ap_user_follow ` ( ` id ` int ( 11 ) unsigned NOT NULL AUTO_INCREMENT COMMENT '\u4e3b\u952e' , ` user_id ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u7528\u6237ID' , ` follow_id ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u5173\u6ce8\u4f5c\u8005ID' , ` follow_name ` varchar ( 20 ) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '\u7c89\u4e1d\u6635\u79f0' , ` level ` tinyint ( 1 ) unsigned DEFAULT NULL COMMENT '\u5173\u6ce8\u5ea6\\r\\n 0 \u5076\u5c14\u611f\u5174\u8da3\\r\\n 1 \u4e00\u822c\\r\\n 2 \u7ecf\u5e38\\r\\n 3 \u9ad8\u5ea6' , ` is_notice ` tinyint ( 1 ) unsigned DEFAULT NULL COMMENT '\u662f\u5426\u52a8\u6001\u901a\u77e5' , ` created_time ` datetime DEFAULT NULL COMMENT '\u521b\u5efa\u65f6\u95f4' , PRIMARY KEY ( ` id ` ) USING BTREE ) ENGINE = InnoDB AUTO_INCREMENT = 14 DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci ROW_FORMAT = DYNAMIC COMMENT = 'APP\u7528\u6237\u5173\u6ce8\u4fe1\u606f\u8868' app\u7528\u6237\u7c89\u4e1d\u8868 ap_user_fan CREATE TABLE ` ap_user_fan ` ( ` id ` int ( 11 ) unsigned NOT NULL AUTO_INCREMENT COMMENT '\u4e3b\u952e' , ` user_id ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u4f5c\u8005ID' , ` fans_id ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u7c89\u4e1dID' , ` fans_name ` varchar ( 20 ) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '\u7c89\u4e1d\u6635\u79f0' , ` level ` tinyint ( 1 ) unsigned DEFAULT NULL COMMENT '\u7c89\u4e1d\u5fe0\u5b9e\u5ea6\\r\\n 0 \u6b63\u5e38\\r\\n 1 \u6f5c\u529b\u80a1\\r\\n 2 \u52c7\u58eb\\r\\n 3 \u94c1\u6746\\r\\n 4 \u8001\u94c1' , ` created_time ` datetime DEFAULT NULL COMMENT '\u521b\u5efa\u65f6\u95f4' , ` is_display ` tinyint ( 1 ) unsigned DEFAULT NULL COMMENT '\u662f\u5426\u53ef\u89c1\u6211\u52a8\u6001' , ` is_shield_letter ` tinyint ( 1 ) unsigned DEFAULT NULL COMMENT '\u662f\u5426\u5c4f\u853d\u79c1\u4fe1' , ` is_shield_comment ` tinyint ( 1 ) unsigned DEFAULT NULL COMMENT '\u662f\u5426\u5c4f\u853d\u8bc4\u8bba' , PRIMARY KEY ( ` id ` ) USING BTREE ) ENGINE = InnoDB AUTO_INCREMENT = 13 DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci ROW_FORMAT = DYNAMIC COMMENT = 'APP\u7528\u6237\u7c89\u4e1d\u4fe1\u606f\u8868' 16-\u63a5\u53e3\u5b9a\u4e49 07:56 \u00b6 follow \u00b6 \u63a5\u53e3\u5730\u5740 : /api/v1/user/user_follow \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"articleId\" : 0 , \"authorId\" : 0 , \"operation\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true UserRelationDto UserRelationDto \u2003\u2003articleId \u6587\u7ae0ID false integer(int64) \u2003\u2003authorId \u4f5c\u8005ID false integer(int32) \u2003\u2003operation 0\u5173\u6ce8 1\u53d6\u6d88 false integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" } 17-\u83b7\u53d6\u4f5c\u8005\u548c\u83b7\u53d6\u767b\u5f55\u4eba 09:59 \u00b6 \u524d\u7aef\u4f20\u9012\u7684author_id\u662fap_author\u8868\u4e2d\u7684id,\u6240\u4ee5\u9700\u8981\u67e5\u8be2\u51fa\u5bf9\u5e94\u7684user_id package com.heima.user.feign ; import com.heima.model.article.pojos.ApAuthor ; import com.heima.model.common.dtos.ResponseResult ; import org.springframework.cloud.openfeign.FeignClient ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.PathVariable ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestBody ; @FeignClient ( \"leadnews-article\" ) public interface ArticleFeign { @GetMapping ( \"/api/v1/author/findByUserId/{id}\" ) public ApAuthor findByUserId ( @PathVariable ( \"id\" ) Integer id ); @PostMapping ( \"/api/v1/author/save\" ) public ResponseResult save ( @RequestBody ApAuthor apAuthor ); @GetMapping ( \"/api/v1/author/one/{id}\" ) public ApAuthor findById ( @PathVariable ( \"id\" ) Integer id ); } AuthorController\uff1a @GetMapping ( \"/one/{id}\" ) @Override public ApAuthor findById ( @PathVariable ( \"id\" ) Integer id ) { return authorService . getById ( id ); } user\u6a21\u5757\u4e2d\u6dfb\u52a0\u8fc7\u6ee4\u5668\uff1a package com.heima.user.filter ; import com.heima.model.user.pojos.ApUser ; import com.heima.model.wemedia.pojos.WmUser ; import com.heima.utils.threadlocal.AppThreadLocalUtils ; import com.heima.utils.threadlocal.WmThreadLocalUtils ; import org.springframework.core.annotation.Order ; import org.springframework.web.filter.GenericFilterBean ; import javax.servlet.FilterChain ; import javax.servlet.ServletException ; import javax.servlet.ServletRequest ; import javax.servlet.ServletResponse ; import javax.servlet.annotation.WebFilter ; import javax.servlet.http.HttpServletRequest ; import javax.servlet.http.HttpServletResponse ; import java.io.IOException ; @Order ( 1 ) @WebFilter ( filterName = \"appTokenFilter\" , urlPatterns = \"/*\" ) public class AppTokenFilter extends GenericFilterBean { @Override public void doFilter ( ServletRequest servletRequest , ServletResponse servletResponse , FilterChain filterChain ) throws IOException , ServletException { HttpServletRequest request = ( HttpServletRequest ) servletRequest ; HttpServletResponse response = ( HttpServletResponse ) servletResponse ; //\u5f97\u5230header\u4e2d\u7684\u4fe1\u606f String userId = request . getHeader ( \"userId\" ); if ( userId != null && Integer . valueOf ( userId ). intValue () != 0 ) { ApUser apUser = new ApUser (); apUser . setId ( Integer . valueOf ( userId )); AppThreadLocalUtils . setUser ( apUser ); } filterChain . doFilter ( request , response ); } } \u5728utils\u4e2d\u6dfb\u52a0\u5de5\u5177\u7c7b package com.heima.utils.threadlocal ; import com.heima.model.user.pojos.ApUser ; import com.heima.model.wemedia.pojos.WmUser ; public class AppThreadLocalUtils { private final static ThreadLocal < ApUser > USER_THREAD_LOCAL = new ThreadLocal <> (); /** * \u8bbe\u7f6e\u5f53\u524d\u7ebf\u7a0b\u4e2d\u7684\u7528\u6237 * @param wmUser */ public static void setUser ( ApUser wmUser ){ USER_THREAD_LOCAL . set ( wmUser ); } /** * \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u4e2d\u7684\u7528\u6237 * @return */ public static ApUser getUser (){ return USER_THREAD_LOCAL . get (); } } 18-\u4e1a\u52a1\u5c42 12:32 \u00b6 public ResponseResult follow ( UserRelationDto dto ) { //1.\u53c2\u6570\u68c0\u67e5 if ( dto . getOperation () == null || dto . getOperation () < 0 || dto . getOperation () > 1 ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } if ( dto . getAuthorId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE , \"\u4f5c\u8005\u4fe1\u606f\u4e0d\u80fd\u4e3a\u7a7a\" ); } //2.\u83b7\u53d6\u4f5c\u8005 Integer followId = null ; ApAuthor apAuthor = articleFeign . findById ( dto . getAuthorId ()); if ( apAuthor != null ){ followId = apAuthor . getUserId (); } if ( followId == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u5173\u6ce8\u4eba\u4e0d\u5b58\u5728\" ); } else { ApUser apUser = AppThreadLocalUtils . getUser (); if ( apUser != null ){ if ( dto . getOperation () == 0 ){ //3.\u5982\u679c\u5f53\u524d\u64cd\u4f5c\u662f0 \u521b\u5efa\u6570\u636e\uff08app\u7528\u6237\u5173\u6ce8\u4fe1\u606f\u548capp\u7684\u7528\u6237\u7c89\u4e1d\u4fe1\u606f\uff09 return followByUserId ( apUser , followId , dto . getArticleId ()); } else { //4.\u5982\u679c\u5f53\u524d\u64cd\u4f5c\u662f1 \u5220\u9664\u6570\u636e\uff08app\u7528\u6237\u5173\u6ce8\u4fe1\u606f\u548capp\u7684\u7528\u6237\u7c89\u4e1d\u4fe1\u606f\uff09 return followCancelByUserId ( apUser , followId ); } } else { return ResponseResult . errorResult ( AppHttpCodeEnum . NEED_LOGIN ); } } } 19-\u5904\u7406\u5173\u6ce8\u903b\u8f91 15:41 \u00b6 /** * \u5904\u7406\u5173\u6ce8\u7684\u64cd\u4f5c * @param apUser * @param followId * @param articleId * @return */ private ResponseResult followByUserId ( ApUser apUser , Integer followId , Long articleId ) { //\u5224\u65ad\u5f53\u524d\u5173\u6ce8\u4eba\u662f\u5426\u5b58\u5728 ApUser followUser = apUserMapper . selectById ( followId ); ApUser fansUser = apUserMapper . selectById ( apUser . getId ()); if ( followUser == null || fansUser == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u5173\u6ce8\u7528\u6237\u6216\u8005\u767b\u9646\u7528\u6237\u4e0d\u5b58\u5728\" ); } //\u5224\u65ad\u7528\u6237\u662f\u5426\u91cd\u590d\u5173\u6ce8 ApUserFollow apUserFollow = apUserFollowMapper . selectOne ( Wrappers . < ApUserFollow > lambdaQuery (). eq ( ApUserFollow :: getUserId , apUser . getId ()). eq ( ApUserFollow :: getFollowId , followId )); //\u6ca1\u6709\u627e\u5230\u5173\u6ce8\u4fe1\u606f\uff0c\u6240\u4ee5\u662f\u672a\u5173\u6ce8\u7684\u72b6\u6001 if ( apUserFollow == null ){ //\u4fdd\u5b58\u6570\u636e ap_user_follow ap_user_fan //\u67e5\u8be2\u662f\u5426\u6709\u7c89\u4e1d\u5173\u6ce8\u4fe1\u606f\uff0c\u5982\u679c\u6709\u7684\u8bdd\uff0c\u4e5f\u4e0d\u9700\u8981\u4fdd\u5b58 ApUserFan apUserFan = apUserFanMapper . selectOne ( Wrappers . < ApUserFan > lambdaQuery (). eq ( ApUserFan :: getUserId , followId ). eq ( ApUserFan :: getFansId , apUser . getId ())); //\u4fdd\u5b58app\u7528\u6237\u7c89\u4e1d\u4fe1\u606f if ( apUserFan == null ){ apUserFan = new ApUserFan (); //\u7c89\u4e1d\u8868\u4e2d\u7684userId,\u5c31\u662f\u5173\u6ce8\u7684\u4f5c\u8005ID apUserFan . setUserId ( followId ); //\u7c89\u4e1d\u8868\u4e2d\u7684fansId,\u5c31\u662f\u767b\u5f55\u4eba apUserFan . setFansId ( apUser . getId (). longValue ()); //\u767b\u5f55\u4eba\u540d\u5b57(\u4fee\u6539\u4e3a\u7c89\u4e1d\u540d\u5b57) apUserFan . setFansName ( fansUser . getName ()); apUserFan . setLevel (( short ) 0 ); apUserFan . setIsDisplay ( true ); apUserFan . setIsShieldLetter ( false ); apUserFan . setIsShieldComment ( false ); apUserFan . setCreatedTime ( new Date ()); apUserFanMapper . insert ( apUserFan ); } else { //\u5982\u679c\u7c89\u4e1d\u5b58\u5728\uff0c\u8fd4\u56de\u9519\u8bef return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_EXIST , \"\u5df2\u5173\u6ce8\" ); } //\u4fdd\u5b58app\u7528\u6237\u5173\u6ce8\u4fe1\u606f apUserFollow = new ApUserFollow (); apUserFollow . setUserId ( apUser . getId ()); apUserFollow . setFollowId ( followId ); //\u8bbe\u7f6e\u5173\u6ce8\u7684\u4f5c\u8005\u540d\u5b57 apUserFollow . setFollowName ( apUserFollow . getName ()); apUserFollow . setCreatedTime ( new Date ()); apUserFollow . setIsNotice ( true ); apUserFollow . setLevel (( short ) 1 ); apUserFollowMapper . insert ( apUserFollow ); //TODO \u8bb0\u5f55\u5173\u6ce8\u6587\u7ae0\u7684\u884c\u4e3a return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } else { //\u5df2\u5173\u6ce8 return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_EXIST , \"\u5df2\u5173\u6ce8\" ); } } 20-\u53d6\u6d88\u5173\u6ce8\u903b\u8f91 11:17 \u00b6 /** * \u53d6\u6d88\u5173\u6ce8\u7684\u5904\u7406\u903b\u8f91 * @param apUser * @param followId * @return */ private ResponseResult followCancelByUserId ( ApUser apUser , Integer followId ) { //\u5148\u67e5\u518d\u5220 ApUserFollow apUserFollow = apUserFollowMapper . selectOne ( Wrappers . < ApUserFollow > lambdaQuery (). eq ( ApUserFollow :: getUserId , apUser . getId ()). eq ( ApUserFollow :: getFollowId , followId )); if ( apUserFollow == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u672a\u5173\u6ce8\" ); } else { ApUserFan apUserFan = apUserFanMapper . selectOne ( Wrappers . < ApUserFan > lambdaQuery (). eq ( ApUserFan :: getUserId , followId ). eq ( ApUserFan :: getFansId , apUser . getId ())); //\u5220\u9664\u7528\u6237\u7c89\u4e1d\u4fe1\u606f \u4fee\u6539apUser\u4e3aapUserFan if ( apUserFan != null ){ apUserFanMapper . delete ( Wrappers . < ApUserFan > lambdaQuery (). eq ( ApUserFan :: getUserId , followId ). eq ( ApUserFan :: getFansId , apUser . getId ())); } //\u5220\u9664\u7528\u6237\u5173\u6ce8\u4fe1\u606f apUserFollowMapper . delete ( Wrappers . < ApUserFollow > lambdaQuery (). eq ( ApUserFollow :: getUserId , apUser . getId ()). eq ( ApUserFollow :: getFollowId , followId )); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } }","title":"day09"},{"location":"hmtt/day09/#01-_0049","text":"\u80fd\u591f\u5b8c\u6210app\u7aef\u6587\u7ae0\u5217\u8868\u5c55\u793a\u529f\u80fd\u5f00\u53d1 \u80fd\u591f\u5b8c\u6210app\u7aef\u6587\u7ae0\u8be6\u60c5\u7684\u529f\u80fd\u5f00\u53d1 \u80fd\u591f\u638c\u63e1\u89e3\u51b3long\u7c7b\u578b\u4e22\u5931\u7cbe\u5ea6\u7684\u95ee\u9898 \u80fd\u591f\u5b8c\u6210app\u7aef\u767b\u5f55\u7684\u529f\u80fd \u80fd\u591f\u638c\u63e1\u5173\u6ce8\u4f5c\u8005\u529f\u80fd","title":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 00:49"},{"location":"hmtt/day09/#02--","text":"1,\u5728\u9ed8\u8ba4\u9891\u9053\u5c55\u793a10\u6761\u6587\u7ae0\u4fe1\u606f >\u5206\u9875\u67e5\u8be2 2,\u53ef\u4ee5\u5207\u6362\u9891\u9053\u67e5\u770b\u4e0d\u540c\u79cd\u7c7b\u6587\u7ae0 \u6839\u636e\u9891\u9053\u7c7b\u522b\u8fdb\u884c\u67e5\u8be2 3,\u5f53\u7528\u6237\u4e0b\u62c9\u53ef\u4ee5\u52a0\u8f7d\u6700\u65b0\u7684\u6587\u7ae0\u4fe1\u606f\uff08\u6309\u7167\u53d1\u5e03\u65f6\u95f4\uff09 \u89c1\u4e0a\u56fe\uff0c\u6839\u636e\u53d1\u5e03\u65f6\u95f4\u67e5\u8be2 \u672c\u9875\u6587\u7ae0\u5217\u8868\u4e2d\u53d1\u5e03\u65f6\u95f4\u6700\u5927\u7684\u65f6\u95f4\u4e3a\u4f9d\u636e 4,\u5f53\u7528\u6237\u4e0a\u62c9\u53ef\u4ee5\u52a0\u8f7d\u66f4\u591a\u7684\u6587\u7ae0\uff08\u5206\u9875\uff09 \u672c\u9875\u6587\u7ae0\u5217\u8868\u4e2d\u53d1\u5e03\u65f6\u95f4\u4e3a\u6700\u5c0f\u7684\u65f6\u95f4\u4e3a\u4f9d\u636e","title":"02-\u6587\u7ae0\u5217\u8868-\u9700\u6c42\u5206\u6790"},{"location":"hmtt/day09/#03-_0411","text":"","title":"03-\u63a5\u53e3\u5b9a\u4e49 04:11"},{"location":"hmtt/day09/#article-home-controller","text":"","title":"article-home-controller"},{"location":"hmtt/day09/#load","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/article/load \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"maxBehotTime\" : \"\" , \"minBehotTime\" : \"\" , \"size\" : 10 , \"tag\" : \"\" } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true ArticleHomeDto ArticleHomeDto \u2003\u2003maxBehotTime \u6700\u5927\u65f6\u95f4 false string(date-time) \u2003\u2003minBehotTime \u6700\u5c0f\u65f6\u95f4 false string(date-time) \u2003\u2003size \u5f53\u524d\u9875\u5c55\u793a\u6570\u636e\u6570\u636e\u91cf false integer(int32) \u2003\u2003tag \u9891\u9053ID false string \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"load"},{"location":"hmtt/day09/#loadmore","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/article/loadmore \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"maxBehotTime\" : \"\" , \"minBehotTime\" : \"\" , \"size\" : 0 , \"tag\" : \"\" } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true ArticleHomeDto ArticleHomeDto \u2003\u2003maxBehotTime false string(date-time) \u2003\u2003minBehotTime false string(date-time) \u2003\u2003size false integer(int32) \u2003\u2003tag false string \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"loadMore"},{"location":"hmtt/day09/#loadnew","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/article/loadnew \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"maxBehotTime\" : \"\" , \"minBehotTime\" : \"\" , \"size\" : 0 , \"tag\" : \"\" } \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true ArticleHomeDto ArticleHomeDto \u2003\u2003maxBehotTime false string(date-time) \u2003\u2003minBehotTime false string(date-time) \u2003\u2003size false integer(int32) \u2003\u2003tag false string \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" } \u5728apis\u6a21\u5757\u4e2d\u65b0\u589e\u63a5\u53e3 package com.heima.apis.article ; import com.heima.model.article.dtos.ArticleHomeDto ; import com.heima.model.common.dtos.ResponseResult ; public interface ArticleHomeControllerApi { /** * \u52a0\u8f7d\u9996\u9875\u6587\u7ae0 * @return */ public ResponseResult load ( ArticleHomeDto dto ); /** * \u52a0\u8f7d\u66f4\u591a * @return */ public ResponseResult loadMore ( ArticleHomeDto dto ); /** * \u52a0\u8f7d\u6700\u65b0 * @return */ public ResponseResult loadNew ( ArticleHomeDto dto ); } ArticleHomeDto package com.heima.model.article.dtos ; import lombok.Data ; import java.util.Date ; @Data public class ArticleHomeDto { // \u6700\u5927\u65f6\u95f4 Date maxBehotTime ; // \u6700\u5c0f\u65f6\u95f4 Date minBehotTime ; // \u5206\u9875size Integer size ; // \u6570\u636e\u8303\u56f4\uff0c\u6bd4\u5982\u9891\u9053ID String tag ; }","title":"loadNew"},{"location":"hmtt/day09/#04-sql_1005","text":"<?xml version=\"1.0\" encoding=\"UTF-8\"?> <!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"> <mapper namespace= \"com.heima.article.mapper.ApArticleMapper\" > <resultMap id= \"resultMap\" type= \"com.heima.model.article.pojos.ApArticle\" > <id column= \"id\" property= \"id\" /> <result column= \"title\" property= \"title\" /> <result column= \"author_id\" property= \"authorId\" /> <result column= \"author_name\" property= \"authorName\" /> <result column= \"channel_id\" property= \"channelId\" /> <result column= \"channel_name\" property= \"channelName\" /> <result column= \"layout\" property= \"layout\" /> <result column= \"flag\" property= \"flag\" /> <result column= \"images\" property= \"images\" /> <result column= \"labels\" property= \"labels\" /> <result column= \"likes\" property= \"likes\" /> <result column= \"collection\" property= \"collection\" /> <result column= \"comment\" property= \"comment\" /> <result column= \"views\" property= \"views\" /> <result column= \"province_id\" property= \"provinceId\" /> <result column= \"city_id\" property= \"cityId\" /> <result column= \"county_id\" property= \"countyId\" /> <result column= \"created_time\" property= \"createdTime\" /> <result column= \"publish_time\" property= \"publishTime\" /> <result column= \"sync_status\" property= \"syncStatus\" /> </resultMap> <select id= \"loadArticleList\" resultMap= \"resultMap\" > SELECT aa.* FROM `ap_article` aa LEFT JOIN ap_article_config aac ON aa.id = aac.article_id <where> and aac.is_delete != 1 and aac.is_down != 1 <!-- loadmore --> <if test= \"type != null and type == 1\" > and aa.publish_time &lt; #{dto.minBehotTime} </if> <if test= \"type != null and type == 2\" > <![CDATA[ and aa.publish_time > #{dto.maxBehotTime} ]]> </if> <if test= \"dto.tag != '__all__'\" > and aa.channel_id = #{dto.tag} </if> </where> order by aa.publish_time desc limit #{dto.size} </select> </mapper>","title":"04-SQL\u7f16\u5199 10:05"},{"location":"hmtt/day09/#05-_1402","text":"package com.heima.article.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.heima.model.article.dtos.ArticleHomeDto ; import com.heima.model.article.pojos.ApArticle ; import org.apache.ibatis.annotations.Mapper ; import org.apache.ibatis.annotations.Param ; import java.util.List ; @Mapper public interface ApArticleMapper extends BaseMapper < ApArticle > { public List < ApArticle > loadArticleList ( @Param ( \"dto\" ) ArticleHomeDto dto , @Param ( \"type\" ) Short type ); } @Override public ResponseResult load ( ArticleHomeDto dto , Short loadType ) { //1.\u6821\u9a8c\u53c2\u6570 Integer size = dto . getSize (); if ( size == null || size <= 0 ){ size = 10 ; } //\u6700\u591a\u53ea\u80fd\u8bf7\u6c4250\u6761\uff0c\u5982\u679c>=50\u5c31\u53d650 size = Math . min ( size , MAX_PAGE_SIZE ); dto . setSize ( size ); //\u7c7b\u578b\u53c2\u6570\u68c0\u9a8c \u5224\u65ad\u5982\u679c\u4e0d\u7b49\u4e8e1\u548c2\uff0c\u7ed9\u51fa\u9ed8\u8ba4\u503c1 if ( ! loadType . equals ( ArticleConstans . LOADTYPE_LOAD_MORE ) &&! loadType . equals ( ArticleConstans . LOADTYPE_LOAD_NEW )){ loadType = ArticleConstans . LOADTYPE_LOAD_MORE ; } //\u6587\u7ae0\u9891\u9053\u6821\u9a8c \u5982\u679c\u6ca1\u6709\u4f20\u9012tag\u53c2\u6570\uff0c\u5c31\u7ed9\u51fa\u9ed8\u8ba4\u7684\u503c_all_,\u67e5\u8be2\u6240\u6709\u6570\u636e if ( StringUtils . isEmpty ( dto . getTag ())){ dto . setTag ( ArticleConstans . DEFAULT_TAG ); } //\u65f6\u95f4\u6821\u9a8c \u5982\u679c\u4e3a\u7a7a\uff0c\u8bbe\u7f6e\u4e3a\u6700\u65b0\u7684\u65f6\u95f4 if ( dto . getMaxBehotTime () == null ) dto . setMaxBehotTime ( new Date ()); if ( dto . getMinBehotTime () == null ) dto . setMinBehotTime ( new Date ()); //2.\u67e5\u8be2\u6570\u636e List < ApArticle > apArticles = apArticleMapper . loadArticleList ( dto , loadType ); //3.\u7ed3\u679c\u5c01\u88c5 host\u5730\u5740 + \u56fe\u7247ID \u62fc\u6210\u56fe\u7247URL ResponseResult responseResult = ResponseResult . okResult ( apArticles ); responseResult . setHost ( fileServerUrl ); return responseResult ; }","title":"05-\u4e1a\u52a1\u5c42\u4ee3\u7801\u7f16\u5199 14:02"},{"location":"hmtt/day09/#06-_0850","text":"","title":"06-\u6d4b\u8bd5\u548c\u7f51\u5173\u642d\u5efa 08:50"},{"location":"hmtt/day09/#07-_1044","text":"","title":"07-\u524d\u7aef\u642d\u5efa\u548c\u8054\u8c03\u6d4b\u8bd5 10:44"},{"location":"hmtt/day09/#tab","text":"1.\u4f7f\u7528vs code\u6253\u5f00\u9879\u76ee\u4e4b\u540e\uff0c\u4f7f\u7528npm install\u5148\u66f4\u65b0\u9879\u76ee\uff08\u53ef\u4e0d\u505a\uff09 2.\u6839\u636e\u8bb2\u4e49\u4e2d\u7684\u5185\u5bb9\u4fee\u6539IP\u5730\u5740\uff08\u5df2\u4fee\u6539\u4e3a127.0.0.1\uff0c\u672c\u5730\u8c03\u8bd5\u5c31\u4e0d\u7528\u6539\uff0c\u5982\u679c\u662fWIFI\u8c03\u8bd5\uff0c\u6539\u6210\u540c\u4e00\u7f51\u6bb5\u4e0b\u7684\u5185\u7f51IP\uff09 3.\u4f7f\u7528Terminal\u7ec8\u7aef\uff0cnpm run start\u547d\u4ee4\u542f\u52a8\u5373\u53ef \u524d\u7aef\u9700\u8981\u767b\u5f55\u624d\u53ef\u4ee5\u6d4b\u8bd5\u6587\u7ae0\u5185\u5bb9\u5c55\u793a\uff0c\u5148\u5b8c\u6210\u767b\u5f55\u529f\u80fd\u518d\u6d4b\u8bd5","title":"\u6ce8\u610f\uff1a\u6309TAB\u952e\u624d\u53ef\u4ee5\u5728\u524d\u7aef\u9009\u4e2d\u8f93\u5165\u6846"},{"location":"hmtt/day09/#08-_0321","text":"\u6587\u7ae0\u8be6\u60c5\u6240\u5c55\u793a\u7684\u4e3b\u8981\u662f\u6587\u7ae0\u7684\u5185\u5bb9\uff0c\u8fd9\u4e2a\u65f6\u5019\u65e0\u987b\u518d\u6b21\u52a0\u91cdap_article\u8868\u4e2d\u7684\u6570\u636e\uff0c\u53ea\u9700\u8981\u901a\u8fc7\u524d\u7aef\u4f20\u9012\u8fc7\u6765\u7684\u6587\u7ae0id\u53bb\u67e5\u8be2\u6587\u7ae0\u7684\u5185\u5bb9\u5373\u53ef\uff0c\u540c\u65f6\u9700\u8981\u5224\u65ad\u5f53\u524d\u6587\u7ae0\u662f\u5426\u5df2\u4e0a\u67b6\u548c\u662f\u5426\u5df2\u7ecf\u5220\u9664\u3002 \u7531\u5206\u6790\u5f97\u51fa\uff0c\u4e3b\u8981\u662f\u901a\u8fc7\u6587\u7ae0id\u67e5\u8be2ap_article_content\u548cap_article_config\u8868\u7684\u6570\u636e\u5373\u53ef\u3002 ap_article_content app\u6587\u7ae0\u5185\u5bb9\u8868 ap_article_config app\u6587\u7ae0\u914d\u7f6e\u8868","title":"08-\u9700\u6c42\u8bf4\u660e\u548c\u601d\u8def\u5206\u6790 03:21"},{"location":"hmtt/day09/#loadarticleinfo","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/article/load_article_info \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"articleId\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true ArticleInfoDto ArticleInfoDto \u2003\u2003articleId false integer(int64) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : { \"content\" : \u6587\u7ae0\u5bf9\u8c61ApArticleContent , \"config\" : \u6587\u7ae0\u914d\u7f6e\u5bf9\u8c61ApArticleConfig }, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"loadArticleInfo"},{"location":"hmtt/day09/#09-_1043","text":"package com.heima.article.service.impl ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.article.mapper.ApArticleConfigMapper ; import com.heima.article.mapper.ApArticleContentMapper ; import com.heima.article.service.ArticleInfoService ; import com.heima.model.article.dtos.ArticleInfoDto ; import com.heima.model.article.pojos.ApArticleConfig ; import com.heima.model.article.pojos.ApArticleContent ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import java.util.HashMap ; import java.util.Map ; @Service public class ArticleInfoServiceImpl implements ArticleInfoService { @Autowired private ApArticleConfigMapper apArticleConfigMapper ; @Autowired private ApArticleContentMapper apArticleContentMapper ; @Override public ResponseResult loadArticleInfo ( ArticleInfoDto dto ) { Map < String , Object > resultMap = new HashMap <> (); //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || dto . getArticleId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u6587\u7ae0\u7684\u914d\u7f6e ApArticleConfig apArticleConfig = apArticleConfigMapper . selectOne ( Wrappers . < ApArticleConfig > lambdaQuery (). eq ( ApArticleConfig :: getArticleId , dto . getArticleId ())); if ( apArticleConfig == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //3.\u67e5\u8be2\u6587\u7ae0\u7684\u5185\u5bb9 if ( ! apArticleConfig . getIsDelete () && ! apArticleConfig . getIsDown ()){ ApArticleContent apArticleContent = apArticleContentMapper . selectOne ( Wrappers . < ApArticleContent > lambdaQuery (). eq ( ApArticleContent :: getArticleId , dto . getArticleId ())); resultMap . put ( \"content\" , apArticleContent ); } else { //\u5f53\u524d\u6587\u7ae0\u5df2\u7ecf\u88ab\u4e0b\u67b6\u6216\u8005\u5220\u9664\uff0c\u65e0\u6cd5\u8fdb\u884c\u9605\u8bfb return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } resultMap . put ( \"config\" , apArticleConfig ); //4.\u7ed3\u679c\u8fd4\u56de return ResponseResult . okResult ( resultMap ); } }","title":"09-\u529f\u80fd\u5f00\u53d1 10:43"},{"location":"hmtt/day09/#10-app-_0452","text":"1.\u542f\u52a8article\u5fae\u670d\u52a1 2.\u542f\u52a8app\u7f51\u5173 3.\u542f\u52a8\u524d\u7aef\u9879\u76ee npm run start","title":"10-APP\u6587\u7ae0\u8be6\u60c5-\u6d4b\u8bd5  04:52"},{"location":"hmtt/day09/#11-long_1225","text":"\u4ea7\u751f\u539f\u56e0\uff1a js \u7684 number \u7c7b\u578b\u652f\u6301\u7684\u6700\u5927\u503c\u662f9007199254740992 \uff082 \u7684 53\u6b21\u65b9 -1\uff0916\u4f4d\uff0c\u6ea2\u51fa\u4e4b\u540e\u7684\u7cbe\u5ea6\u4f1a\u4e22\u5931\uff0c\u5bfc\u81f4\u524d\u540e\u7aef\u7684\u503c\u4e0d\u4e00\u81f4\u3002 java \u7684 long \u7c7b\u578b\u6700\u5927\u503c\u4e3a 9223372036854775807 19\u4f4d\uff0c\u8fdc\u9ad8\u4e8e js number\u7c7b\u578b\u7684\u6700\u5927\u503c\uff0c\u6240\u4ee5\u8fd9\u4e2a\u5751\u5c31\u51fa\u73b0\u4e86\u3002 \u89e3\u51b3\u601d\u8def\uff1a \u65b9\u6848\u4e00\uff1a\u5c06\u6587\u7ae0\u7684id\u7684\u7531long\u7c7b\u578b\u624b\u52a8\u6539\u4e3aString\u7c7b\u578b\uff0c\u53ef\u4ee5\u89e3\u51b3\u6b64\u95ee\u9898\u3002\uff08\u9700\u8981\u4fee\u6539\u8868\u7ed3\u6784\uff09 \u65b9\u6848\u4e8c\uff1a\u53ef\u4ee5\u4f7f\u7528jackson\u8fdb\u884c\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u89e3\u51b3\uff08\u672c\u9879\u76ee\u91c7\u7528\u8fd9\u79cd\u65b9\u6848\uff09 \u8fd9\u90e8\u5206\u4e0d\u9700\u8981\u540c\u5b66\u4eec\u81ea\u5df1\u5199\uff0c\u628a\u76f8\u5173\u4ee3\u7801\u653e\u8fdb\u53bb\u5373\u53ef\u3002 jackson\u7684\u914d\u7f6e\u6587\u4ef6 package com.heima.common.jackson ; import com.fasterxml.jackson.core.Version ; import com.fasterxml.jackson.databind.DeserializationFeature ; import com.fasterxml.jackson.databind.Module ; import com.fasterxml.jackson.databind.ObjectMapper ; import com.fasterxml.jackson.databind.PropertyNamingStrategy ; public class ConfusionModule extends Module { public final static String MODULE_NAME = \"jackson-confusion-encryption\" ; public final static Version VERSION = new Version ( 1 , 0 , 0 , null , \"heima\" , MODULE_NAME ); @Override public String getModuleName () { return MODULE_NAME ; } @Override public Version version () { return VERSION ; } @Override public void setupModule ( SetupContext context ) { context . addBeanSerializerModifier ( new ConfusionSerializerModifier ()); context . addBeanDeserializerModifier ( new ConfusionDeserializerModifier ()); } /** * \u6ce8\u518c\u5f53\u524d\u6a21\u5757 * @return */ public static ObjectMapper registerModule ( ObjectMapper objectMapper ){ //CamelCase\u7b56\u7565\uff0cJava\u5bf9\u8c61\u5c5e\u6027\uff1apersonId\uff0c\u5e8f\u5217\u5316\u540e\u5c5e\u6027\uff1apersionId //PascalCase\u7b56\u7565\uff0cJava\u5bf9\u8c61\u5c5e\u6027\uff1apersonId\uff0c\u5e8f\u5217\u5316\u540e\u5c5e\u6027\uff1aPersonId //SnakeCase\u7b56\u7565\uff0cJava\u5bf9\u8c61\u5c5e\u6027\uff1apersonId\uff0c\u5e8f\u5217\u5316\u540e\u5c5e\u6027\uff1aperson_id //KebabCase\u7b56\u7565\uff0cJava\u5bf9\u8c61\u5c5e\u6027\uff1apersonId\uff0c\u5e8f\u5217\u5316\u540e\u5c5e\u6027\uff1aperson-id // \u5ffd\u7565\u591a\u4f59\u5b57\u6bb5\uff0c\u629b\u9519 objectMapper . configure ( DeserializationFeature . FAIL_ON_UNKNOWN_PROPERTIES , false ); // objectMapper.setPropertyNamingStrategy(PropertyNamingStrategy.SNAKE_CASE); return objectMapper . registerModule ( new ConfusionModule ()); } } jackson\u7684\u914d\u7f6e\u7c7b\uff1a package com.heima.common.jackson ; import com.fasterxml.jackson.databind.ObjectMapper ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; @Configuration public class InitJacksonConfig { @Bean public ObjectMapper objectMapper () { ObjectMapper objectMapper = new ObjectMapper (); objectMapper = ConfusionModule . registerModule ( objectMapper ); return objectMapper ; } } \u5728article\u4e2d\u542f\u52a8\u914d\u7f6e\u7c7b\uff1a package com.heima.article.config ; import org.springframework.context.annotation.ComponentScan ; import org.springframework.context.annotation.Configuration ; @Configuration @ComponentScan ( \"com.heima.common.jackson\" ) public class InitConfig { }","title":"11-Long\u7c7b\u578b\u8f6c\u6362 12:25"},{"location":"hmtt/day09/#12-_0421","text":"\u70b9\u51fb\u767b\u5f55\uff0c\u6821\u9a8c\u624b\u673a\u53f7\u5bc6\u7801\uff0c\u83b7\u53d6\u7528\u6237ID\u751f\u6210jwtToken \u4e0d\u767b\u5f55\u5148\u770b\u770b\uff0c\u76f4\u63a5\u4f7f\u75280\u4f5c\u4e3a\u7528\u6237ID\u751f\u6210jwtToken","title":"12-\u767b\u5f55 \u9700\u6c42\u53ca\u601d\u8def 04:21"},{"location":"hmtt/day09/#13-_1213","text":"package com.heima.user.service.impl ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.user.dtos.LoginDto ; import com.heima.model.user.pojos.ApUser ; import com.heima.user.mapper.ApUserMapper ; import com.heima.user.service.ApUserLoginService ; import com.heima.utils.common.AppJwtUtil ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import org.springframework.util.DigestUtils ; import java.util.HashMap ; import java.util.Map ; @Service public class ApUserLoginServiceImpl implements ApUserLoginService { @Autowired ApUserMapper apUserMapper ; @Override public ResponseResult login ( LoginDto dto ) { //1.\u6821\u9a8c\u53c2\u6570 //2.\u8fd9\u513f\u5199\u9519\u4e86\uff0c\u5e94\u8be5\u662f\u624b\u673a\u53f7 \u5bc6\u7801 \u8bbe\u5907ID\u540c\u65f6\u4e3a\u7a7a \u8fd4\u56de\u9519\u8bef if ( dto . getEquipmentId () == null && ( StringUtils . isEmpty ( dto . getPhone ()) && StringUtils . isEmpty ( dto . getPassword ()))){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u624b\u673a\u53f7+\u5bc6\u7801\u767b\u5f55 if ( ! StringUtils . isEmpty ( dto . getPhone ()) &&! StringUtils . isEmpty ( dto . getPassword ())){ //\u7528\u6237\u767b\u5f55 ApUser dbUser = apUserMapper . selectOne ( Wrappers . < ApUser > lambdaQuery (). eq ( ApUser :: getPhone , dto . getPhone ())); if ( dbUser != null ) { String pswd = DigestUtils . md5DigestAsHex (( dto . getPassword () + dbUser . getSalt ()). getBytes ()); if ( dbUser . getPassword (). equals ( pswd )) { Map < String , Object > map = new HashMap <> (); dbUser . setPassword ( \"\" ); dbUser . setSalt ( \"\" ); map . put ( \"token\" , AppJwtUtil . getToken ( dbUser . getId (). longValue ())); map . put ( \"user\" , dbUser ); return ResponseResult . okResult ( map ); } else { return ResponseResult . errorResult ( AppHttpCodeEnum . LOGIN_PASSWORD_ERROR ); } } else { return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u7528\u6237\u4e0d\u5b58\u5728\" ); } } else { //3.\u8bbe\u5907\u767b\u5f55 if ( dto . getEquipmentId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //\u6839\u636e\u8bbe\u5907ID\uff0c\u5728\u7528\u6237\u8868\u4e2d\u67e5\u8be2\u4e00\u4e0b\uff0c\u5982\u679c\u7528\u6237\u5b58\u5728\uff0c\u8fd4\u56de\u7528\u6237ID\uff0c\u5982\u679c\u7528\u6237\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u7528\u6237\u5e76\u4e14\u7ed1\u5b9a\u8bbe\u5907ID //\u8bbe\u5907\u767b\u5f55\u76f4\u63a5\u7ed9\u7528\u6237\u8bbe\u7f6eid\u4e3a0 Map < String , Object > map = new HashMap <> (); map . put ( \"token\" , AppJwtUtil . getToken ( 0 l )); return ResponseResult . okResult ( map ); } } }","title":"13-\u529f\u80fd\u5b9e\u73b0 12:13"},{"location":"hmtt/day09/#14-_1213","text":"","title":"14-\u7f51\u5173\u642d\u5efa\u53ca\u6d4b\u8bd5 12:13"},{"location":"hmtt/day09/#15--_0648","text":"\u70b9\u51fb\u6309\u94ae\u53ef\u4ee5\u5173\u6ce8\u7528\u6237\uff0c\u518d\u6b21\u70b9\u51fb\u53d6\u6d88\u5173\u6ce8 \u4e00\u4e2a\u7528\u6237\u53ef\u4ee5\u5173\u6ce8\u591a\u4e2a\u4f5c\u8005\uff0c\u4e00\u4e2a\u4f5c\u8005\u4e5f\u53ef\u4ee5\u6709\u591a\u4e2a\u7c89\u4e1d 1.\u524d\u7aef\u4f20\u9012\u4f5c\u8005ID 2.\u7528\u6237\u4fdd\u5b58\u5173\u6ce8\u7684\u4f5c\u8005\uff0c\u4f5c\u8005\u4fdd\u5b58\u5f53\u524d\u7c89\u4e1d\uff0c\u8fd9\u662f\u4e24\u5f20\u8868 3.\u53d6\u6d88\u5173\u6ce8\uff0c\u8981\u5220\u9664\u4e0a\u8ff0\u4e24\u5f20\u8868\u7684\u5185\u5bb9 \u4e24\u5f20\u8868\uff1a app\u5173\u6ce8\u4fe1\u606f\u8868 ap_user_follow CREATE TABLE ` ap_user_follow ` ( ` id ` int ( 11 ) unsigned NOT NULL AUTO_INCREMENT COMMENT '\u4e3b\u952e' , ` user_id ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u7528\u6237ID' , ` follow_id ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u5173\u6ce8\u4f5c\u8005ID' , ` follow_name ` varchar ( 20 ) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '\u7c89\u4e1d\u6635\u79f0' , ` level ` tinyint ( 1 ) unsigned DEFAULT NULL COMMENT '\u5173\u6ce8\u5ea6\\r\\n 0 \u5076\u5c14\u611f\u5174\u8da3\\r\\n 1 \u4e00\u822c\\r\\n 2 \u7ecf\u5e38\\r\\n 3 \u9ad8\u5ea6' , ` is_notice ` tinyint ( 1 ) unsigned DEFAULT NULL COMMENT '\u662f\u5426\u52a8\u6001\u901a\u77e5' , ` created_time ` datetime DEFAULT NULL COMMENT '\u521b\u5efa\u65f6\u95f4' , PRIMARY KEY ( ` id ` ) USING BTREE ) ENGINE = InnoDB AUTO_INCREMENT = 14 DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci ROW_FORMAT = DYNAMIC COMMENT = 'APP\u7528\u6237\u5173\u6ce8\u4fe1\u606f\u8868' app\u7528\u6237\u7c89\u4e1d\u8868 ap_user_fan CREATE TABLE ` ap_user_fan ` ( ` id ` int ( 11 ) unsigned NOT NULL AUTO_INCREMENT COMMENT '\u4e3b\u952e' , ` user_id ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u4f5c\u8005ID' , ` fans_id ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u7c89\u4e1dID' , ` fans_name ` varchar ( 20 ) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '\u7c89\u4e1d\u6635\u79f0' , ` level ` tinyint ( 1 ) unsigned DEFAULT NULL COMMENT '\u7c89\u4e1d\u5fe0\u5b9e\u5ea6\\r\\n 0 \u6b63\u5e38\\r\\n 1 \u6f5c\u529b\u80a1\\r\\n 2 \u52c7\u58eb\\r\\n 3 \u94c1\u6746\\r\\n 4 \u8001\u94c1' , ` created_time ` datetime DEFAULT NULL COMMENT '\u521b\u5efa\u65f6\u95f4' , ` is_display ` tinyint ( 1 ) unsigned DEFAULT NULL COMMENT '\u662f\u5426\u53ef\u89c1\u6211\u52a8\u6001' , ` is_shield_letter ` tinyint ( 1 ) unsigned DEFAULT NULL COMMENT '\u662f\u5426\u5c4f\u853d\u79c1\u4fe1' , ` is_shield_comment ` tinyint ( 1 ) unsigned DEFAULT NULL COMMENT '\u662f\u5426\u5c4f\u853d\u8bc4\u8bba' , PRIMARY KEY ( ` id ` ) USING BTREE ) ENGINE = InnoDB AUTO_INCREMENT = 13 DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci ROW_FORMAT = DYNAMIC COMMENT = 'APP\u7528\u6237\u7c89\u4e1d\u4fe1\u606f\u8868'","title":"15-\u5173\u6ce8\u548c\u53d6\u6d88\u5173\u6ce8-\u9700\u6c42\u548c\u601d\u8def\u5206\u6790 06:48"},{"location":"hmtt/day09/#16-_0756","text":"","title":"16-\u63a5\u53e3\u5b9a\u4e49 07:56"},{"location":"hmtt/day09/#follow","text":"\u63a5\u53e3\u5730\u5740 : /api/v1/user/user_follow \u8bf7\u6c42\u65b9\u5f0f : POST \u8bf7\u6c42\u6570\u636e\u7c7b\u578b : application/json \u54cd\u5e94\u6570\u636e\u7c7b\u578b : */* \u63a5\u53e3\u63cf\u8ff0 : \u8bf7\u6c42\u793a\u4f8b : { \"articleId\" : 0 , \"authorId\" : 0 , \"operation\" : 0 } \u8bf7\u6c42\u53c2\u6570 : \u8bf7\u6c42\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e in \u662f\u5426\u5fc5\u987b \u6570\u636e\u7c7b\u578b schema dto dto body true UserRelationDto UserRelationDto \u2003\u2003articleId \u6587\u7ae0ID false integer(int64) \u2003\u2003authorId \u4f5c\u8005ID false integer(int32) \u2003\u2003operation 0\u5173\u6ce8 1\u53d6\u6d88 false integer(int32) \u54cd\u5e94\u72b6\u6001 : \u72b6\u6001\u7801 \u8bf4\u660e schema 200 OK ResponseResult 201 Created 401 Unauthorized 403 Forbidden 404 Not Found \u54cd\u5e94\u53c2\u6570 : \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8bf4\u660e \u7c7b\u578b schema code integer(int32) integer(int32) data object errorMessage string host string \u54cd\u5e94\u793a\u4f8b : { \"code\" : 0 , \"data\" : {}, \"errorMessage\" : \"\" , \"host\" : \"\" }","title":"follow"},{"location":"hmtt/day09/#17-_0959","text":"\u524d\u7aef\u4f20\u9012\u7684author_id\u662fap_author\u8868\u4e2d\u7684id,\u6240\u4ee5\u9700\u8981\u67e5\u8be2\u51fa\u5bf9\u5e94\u7684user_id package com.heima.user.feign ; import com.heima.model.article.pojos.ApAuthor ; import com.heima.model.common.dtos.ResponseResult ; import org.springframework.cloud.openfeign.FeignClient ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.PathVariable ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestBody ; @FeignClient ( \"leadnews-article\" ) public interface ArticleFeign { @GetMapping ( \"/api/v1/author/findByUserId/{id}\" ) public ApAuthor findByUserId ( @PathVariable ( \"id\" ) Integer id ); @PostMapping ( \"/api/v1/author/save\" ) public ResponseResult save ( @RequestBody ApAuthor apAuthor ); @GetMapping ( \"/api/v1/author/one/{id}\" ) public ApAuthor findById ( @PathVariable ( \"id\" ) Integer id ); } AuthorController\uff1a @GetMapping ( \"/one/{id}\" ) @Override public ApAuthor findById ( @PathVariable ( \"id\" ) Integer id ) { return authorService . getById ( id ); } user\u6a21\u5757\u4e2d\u6dfb\u52a0\u8fc7\u6ee4\u5668\uff1a package com.heima.user.filter ; import com.heima.model.user.pojos.ApUser ; import com.heima.model.wemedia.pojos.WmUser ; import com.heima.utils.threadlocal.AppThreadLocalUtils ; import com.heima.utils.threadlocal.WmThreadLocalUtils ; import org.springframework.core.annotation.Order ; import org.springframework.web.filter.GenericFilterBean ; import javax.servlet.FilterChain ; import javax.servlet.ServletException ; import javax.servlet.ServletRequest ; import javax.servlet.ServletResponse ; import javax.servlet.annotation.WebFilter ; import javax.servlet.http.HttpServletRequest ; import javax.servlet.http.HttpServletResponse ; import java.io.IOException ; @Order ( 1 ) @WebFilter ( filterName = \"appTokenFilter\" , urlPatterns = \"/*\" ) public class AppTokenFilter extends GenericFilterBean { @Override public void doFilter ( ServletRequest servletRequest , ServletResponse servletResponse , FilterChain filterChain ) throws IOException , ServletException { HttpServletRequest request = ( HttpServletRequest ) servletRequest ; HttpServletResponse response = ( HttpServletResponse ) servletResponse ; //\u5f97\u5230header\u4e2d\u7684\u4fe1\u606f String userId = request . getHeader ( \"userId\" ); if ( userId != null && Integer . valueOf ( userId ). intValue () != 0 ) { ApUser apUser = new ApUser (); apUser . setId ( Integer . valueOf ( userId )); AppThreadLocalUtils . setUser ( apUser ); } filterChain . doFilter ( request , response ); } } \u5728utils\u4e2d\u6dfb\u52a0\u5de5\u5177\u7c7b package com.heima.utils.threadlocal ; import com.heima.model.user.pojos.ApUser ; import com.heima.model.wemedia.pojos.WmUser ; public class AppThreadLocalUtils { private final static ThreadLocal < ApUser > USER_THREAD_LOCAL = new ThreadLocal <> (); /** * \u8bbe\u7f6e\u5f53\u524d\u7ebf\u7a0b\u4e2d\u7684\u7528\u6237 * @param wmUser */ public static void setUser ( ApUser wmUser ){ USER_THREAD_LOCAL . set ( wmUser ); } /** * \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u4e2d\u7684\u7528\u6237 * @return */ public static ApUser getUser (){ return USER_THREAD_LOCAL . get (); } }","title":"17-\u83b7\u53d6\u4f5c\u8005\u548c\u83b7\u53d6\u767b\u5f55\u4eba 09:59"},{"location":"hmtt/day09/#18-_1232","text":"public ResponseResult follow ( UserRelationDto dto ) { //1.\u53c2\u6570\u68c0\u67e5 if ( dto . getOperation () == null || dto . getOperation () < 0 || dto . getOperation () > 1 ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } if ( dto . getAuthorId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE , \"\u4f5c\u8005\u4fe1\u606f\u4e0d\u80fd\u4e3a\u7a7a\" ); } //2.\u83b7\u53d6\u4f5c\u8005 Integer followId = null ; ApAuthor apAuthor = articleFeign . findById ( dto . getAuthorId ()); if ( apAuthor != null ){ followId = apAuthor . getUserId (); } if ( followId == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u5173\u6ce8\u4eba\u4e0d\u5b58\u5728\" ); } else { ApUser apUser = AppThreadLocalUtils . getUser (); if ( apUser != null ){ if ( dto . getOperation () == 0 ){ //3.\u5982\u679c\u5f53\u524d\u64cd\u4f5c\u662f0 \u521b\u5efa\u6570\u636e\uff08app\u7528\u6237\u5173\u6ce8\u4fe1\u606f\u548capp\u7684\u7528\u6237\u7c89\u4e1d\u4fe1\u606f\uff09 return followByUserId ( apUser , followId , dto . getArticleId ()); } else { //4.\u5982\u679c\u5f53\u524d\u64cd\u4f5c\u662f1 \u5220\u9664\u6570\u636e\uff08app\u7528\u6237\u5173\u6ce8\u4fe1\u606f\u548capp\u7684\u7528\u6237\u7c89\u4e1d\u4fe1\u606f\uff09 return followCancelByUserId ( apUser , followId ); } } else { return ResponseResult . errorResult ( AppHttpCodeEnum . NEED_LOGIN ); } } }","title":"18-\u4e1a\u52a1\u5c42 12:32"},{"location":"hmtt/day09/#19-_1541","text":"/** * \u5904\u7406\u5173\u6ce8\u7684\u64cd\u4f5c * @param apUser * @param followId * @param articleId * @return */ private ResponseResult followByUserId ( ApUser apUser , Integer followId , Long articleId ) { //\u5224\u65ad\u5f53\u524d\u5173\u6ce8\u4eba\u662f\u5426\u5b58\u5728 ApUser followUser = apUserMapper . selectById ( followId ); ApUser fansUser = apUserMapper . selectById ( apUser . getId ()); if ( followUser == null || fansUser == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u5173\u6ce8\u7528\u6237\u6216\u8005\u767b\u9646\u7528\u6237\u4e0d\u5b58\u5728\" ); } //\u5224\u65ad\u7528\u6237\u662f\u5426\u91cd\u590d\u5173\u6ce8 ApUserFollow apUserFollow = apUserFollowMapper . selectOne ( Wrappers . < ApUserFollow > lambdaQuery (). eq ( ApUserFollow :: getUserId , apUser . getId ()). eq ( ApUserFollow :: getFollowId , followId )); //\u6ca1\u6709\u627e\u5230\u5173\u6ce8\u4fe1\u606f\uff0c\u6240\u4ee5\u662f\u672a\u5173\u6ce8\u7684\u72b6\u6001 if ( apUserFollow == null ){ //\u4fdd\u5b58\u6570\u636e ap_user_follow ap_user_fan //\u67e5\u8be2\u662f\u5426\u6709\u7c89\u4e1d\u5173\u6ce8\u4fe1\u606f\uff0c\u5982\u679c\u6709\u7684\u8bdd\uff0c\u4e5f\u4e0d\u9700\u8981\u4fdd\u5b58 ApUserFan apUserFan = apUserFanMapper . selectOne ( Wrappers . < ApUserFan > lambdaQuery (). eq ( ApUserFan :: getUserId , followId ). eq ( ApUserFan :: getFansId , apUser . getId ())); //\u4fdd\u5b58app\u7528\u6237\u7c89\u4e1d\u4fe1\u606f if ( apUserFan == null ){ apUserFan = new ApUserFan (); //\u7c89\u4e1d\u8868\u4e2d\u7684userId,\u5c31\u662f\u5173\u6ce8\u7684\u4f5c\u8005ID apUserFan . setUserId ( followId ); //\u7c89\u4e1d\u8868\u4e2d\u7684fansId,\u5c31\u662f\u767b\u5f55\u4eba apUserFan . setFansId ( apUser . getId (). longValue ()); //\u767b\u5f55\u4eba\u540d\u5b57(\u4fee\u6539\u4e3a\u7c89\u4e1d\u540d\u5b57) apUserFan . setFansName ( fansUser . getName ()); apUserFan . setLevel (( short ) 0 ); apUserFan . setIsDisplay ( true ); apUserFan . setIsShieldLetter ( false ); apUserFan . setIsShieldComment ( false ); apUserFan . setCreatedTime ( new Date ()); apUserFanMapper . insert ( apUserFan ); } else { //\u5982\u679c\u7c89\u4e1d\u5b58\u5728\uff0c\u8fd4\u56de\u9519\u8bef return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_EXIST , \"\u5df2\u5173\u6ce8\" ); } //\u4fdd\u5b58app\u7528\u6237\u5173\u6ce8\u4fe1\u606f apUserFollow = new ApUserFollow (); apUserFollow . setUserId ( apUser . getId ()); apUserFollow . setFollowId ( followId ); //\u8bbe\u7f6e\u5173\u6ce8\u7684\u4f5c\u8005\u540d\u5b57 apUserFollow . setFollowName ( apUserFollow . getName ()); apUserFollow . setCreatedTime ( new Date ()); apUserFollow . setIsNotice ( true ); apUserFollow . setLevel (( short ) 1 ); apUserFollowMapper . insert ( apUserFollow ); //TODO \u8bb0\u5f55\u5173\u6ce8\u6587\u7ae0\u7684\u884c\u4e3a return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } else { //\u5df2\u5173\u6ce8 return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_EXIST , \"\u5df2\u5173\u6ce8\" ); } }","title":"19-\u5904\u7406\u5173\u6ce8\u903b\u8f91 15:41"},{"location":"hmtt/day09/#20-_1117","text":"/** * \u53d6\u6d88\u5173\u6ce8\u7684\u5904\u7406\u903b\u8f91 * @param apUser * @param followId * @return */ private ResponseResult followCancelByUserId ( ApUser apUser , Integer followId ) { //\u5148\u67e5\u518d\u5220 ApUserFollow apUserFollow = apUserFollowMapper . selectOne ( Wrappers . < ApUserFollow > lambdaQuery (). eq ( ApUserFollow :: getUserId , apUser . getId ()). eq ( ApUserFollow :: getFollowId , followId )); if ( apUserFollow == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u672a\u5173\u6ce8\" ); } else { ApUserFan apUserFan = apUserFanMapper . selectOne ( Wrappers . < ApUserFan > lambdaQuery (). eq ( ApUserFan :: getUserId , followId ). eq ( ApUserFan :: getFansId , apUser . getId ())); //\u5220\u9664\u7528\u6237\u7c89\u4e1d\u4fe1\u606f \u4fee\u6539apUser\u4e3aapUserFan if ( apUserFan != null ){ apUserFanMapper . delete ( Wrappers . < ApUserFan > lambdaQuery (). eq ( ApUserFan :: getUserId , followId ). eq ( ApUserFan :: getFansId , apUser . getId ())); } //\u5220\u9664\u7528\u6237\u5173\u6ce8\u4fe1\u606f apUserFollowMapper . delete ( Wrappers . < ApUserFollow > lambdaQuery (). eq ( ApUserFollow :: getUserId , apUser . getId ()). eq ( ApUserFollow :: getFollowId , followId )); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } }","title":"20-\u53d6\u6d88\u5173\u6ce8\u903b\u8f91 11:17"},{"location":"hmtt/day10/","text":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 01:09 \u00b6 \u7406\u89e3app\u7aef\u884c\u4e3a\u8bb0\u5f55 \u5b8c\u6210\u5173\u6ce8\u3001\u70b9\u8d5e\u3001\u9605\u8bfb\u884c\u4e3a \u638c\u63e1\u4e0d\u559c\u6b22\u548c\u6536\u85cf\u5b9e\u73b0\u601d\u8def \u5b8c\u6210app\u6587\u7ae0\u5173\u7cfb\u5c55\u793a\u529f\u80fd 02-\u6982\u5ff5\u4ecb\u7ecd\u548c\u5fae\u670d\u52a1\u4ecb\u7ecd 08:09 \u00b6 \u521b\u5efaheima-leadnews-behavior\u670d\u52a1 03-\u8868\u5173\u7cfb\u5206\u6790 06:18 \u00b6 CREATE TABLE ` ap_behavior_entry ` ( ` id ` int ( 11 ) unsigned NOT NULL AUTO_INCREMENT COMMENT '\u4e3b\u952e' , ` type ` tinyint ( 1 ) unsigned DEFAULT NULL COMMENT '\u5b9e\u4f53\u7c7b\u578b\\r\\n 0\u7ec8\u7aef\u8bbe\u5907\\r\\n 1\u7528\u6237' , ` entry_id ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u5b9e\u4f53ID' , ` created_time ` datetime DEFAULT NULL COMMENT '\u521b\u5efa\u65f6\u95f4' , PRIMARY KEY ( ` id ` ) USING BTREE ) ENGINE = InnoDB AUTO_INCREMENT = 2 DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci ROW_FORMAT = DYNAMIC COMMENT = 'APP\u884c\u4e3a\u5b9e\u4f53\u8868,\u4e00\u4e2a\u884c\u4e3a\u5b9e\u4f53\u53ef\u80fd\u662f\u7528\u6237\u6216\u8005\u8bbe\u5907\uff0c\u6216\u8005\u5176\u5b83' entry_id \u5982\u679c\u662f\u7528\u6237\uff0c\u5c31\u662f\u7528\u6237ID\uff1b\u5982\u679c\u662f\u8bbe\u5907\uff0c\u5c31\u662f\u8bbe\u5907ID CREATE TABLE ` ap_follow_behavior ` ( ` id ` bigint ( 20 ) unsigned NOT NULL , ` entry_id ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u5b9e\u4f53ID' , ` article_id ` bigint ( 20 ) unsigned DEFAULT NULL COMMENT '\u6587\u7ae0ID' , ` follow_id ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u5173\u6ce8\u7528\u6237ID' , ` created_time ` datetime DEFAULT NULL COMMENT '\u767b\u5f55\u65f6\u95f4' , PRIMARY KEY ( ` id ` ) USING BTREE , KEY ` idx_entry_id ` ( ` entry_id ` ) ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci ROW_FORMAT = DYNAMIC COMMENT = 'PP\u5173\u6ce8\u884c\u4e3a\u8868' \u6ce8\u610f\uff1a\u884c\u4e3a\u8868\u4e2d\u7684entry_id\u662fentry\u8868\u4e2d\u7684id 04-\u7528\u6237\u7aef\u53d1\u9001\u6d88\u606f 05:28 \u00b6 UserRelationServiceImpl\uff1a /** * \u5904\u7406\u5173\u6ce8\u7684\u64cd\u4f5c * @param apUser * @param followId * @param articleId * @return */ private ResponseResult followByUserId ( ApUser apUser , Integer followId , Long articleId ) { //\u5224\u65ad\u5f53\u524d\u5173\u6ce8\u4eba\u662f\u5426\u5b58\u5728 ApUser followUser = apUserMapper . selectById ( followId ); if ( followUser == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u5173\u6ce8\u7528\u6237\u4e0d\u5b58\u5728\" ); } ApUserFollow apUserFollow = apUserFollowMapper . selectOne ( Wrappers . < ApUserFollow > lambdaQuery (). eq ( ApUserFollow :: getUserId , apUser . getId ()). eq ( ApUserFollow :: getFollowId , followId )); if ( apUserFollow == null ){ //\u4fdd\u5b58\u6570\u636e ap_user_follow ap_user_fan ApUserFan apUserFan = apUserFanMapper . selectOne ( Wrappers . < ApUserFan > lambdaQuery (). eq ( ApUserFan :: getUserId , followId ). eq ( ApUserFan :: getFansId , apUser . getId ())); //\u4fdd\u5b58app\u7528\u6237\u7c89\u4e1d\u4fe1\u606f if ( apUserFan == null ){ apUserFan = new ApUserFan (); apUserFan . setUserId ( followId ); apUserFan . setFansId ( apUser . getId (). longValue ()); apUserFan . setFansName ( followUser . getName ()); apUserFan . setLevel (( short ) 0 ); apUserFan . setIsDisplay ( true ); apUserFan . setIsShieldLetter ( false ); apUserFan . setIsShieldComment ( false ); apUserFan . setCreatedTime ( new Date ()); apUserFanMapper . insert ( apUserFan ); } //\u4fdd\u5b58app\u7528\u6237\u5173\u6ce8\u4fe1\u606f apUserFollow = new ApUserFollow (); apUserFollow . setUserId ( apUser . getId ()); apUserFollow . setFollowId ( followId ); apUserFollow . setCreatedTime ( new Date ()); apUserFollow . setIsNotice ( true ); apUserFollow . setLevel (( short ) 1 ); apUserFollowMapper . insert ( apUserFollow ); //TODO \u8bb0\u5f55\u5173\u6ce8\u6587\u7ae0\u7684\u884c\u4e3a FollowBehaviorDto dto = new FollowBehaviorDto (); dto . setFollowId ( followId ); dto . setArticleId ( articleId ); dto . setUserId ( apUser . getId ()); kafkaTemplate . send ( FollowBehaviorConstants . FOLLOW_BEHAVIOR_TOPIC , JSON . toJSONString ( dto )); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } else { //\u5df2\u5173\u6ce8 return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_EXIST , \"\u5df2\u5173\u6ce8\" ); } } 05-\u4fdd\u5b58\u5173\u6ce8\u884c\u4e3a 15:05 \u00b6 1.\u63d0\u4f9b\u63a5\u53e3\uff0c\u6839\u636e\u7528\u6237ID\u6216\u8005\u8bbe\u5907ID\uff0c\u67e5\u8be2entityId 2.\u4fdd\u5b58\u884c\u4e3a\u6570\u636e package com.heima.behavior.service.impl ; import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl ; import com.heima.behavior.mapper.ApFollowBehaviorMapper ; import com.heima.behavior.service.ApBehaviorEntryService ; import com.heima.behavior.service.ApFollowBehaviorService ; import com.heima.model.behavior.dtos.FollowBehaviorDto ; import com.heima.model.behavior.pojos.ApBehaviorEntry ; import com.heima.model.behavior.pojos.ApFollowBehavior ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import lombok.extern.log4j.Log4j2 ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import java.util.Date ; @Service @Log4j2 public class ApFollowBehaviorServiceImpl extends ServiceImpl < ApFollowBehaviorMapper , ApFollowBehavior > implements ApFollowBehaviorService { @Autowired private ApBehaviorEntryService apBehaviorEntryService ; @Override public ResponseResult saveFollowBehavior ( FollowBehaviorDto dto ) { //1.\u67e5\u8be2\u884c\u4e3a\u5b9e\u4f53 ApBehaviorEntry apBehaviorEntry = apBehaviorEntryService . findByUserIdOrEquipmentId ( dto . getUserId (), null ); if ( apBehaviorEntry == null ){ log . error ( \"\u884c\u4e3a\u5b9e\u4f53\u4e3a\u7a7a\" ); return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u4fdd\u5b58\u5173\u6ce8\u884c\u4e3a ApFollowBehavior apFollowBehavior = new ApFollowBehavior (); //\u6ce8\u610f\u8bbe\u7f6eentryId\u6307\u7684\u662fentry\u8868\u4e2d\u7684id apFollowBehavior . setEntryId ( apBehaviorEntry . getId ()); apFollowBehavior . setFollowId ( dto . getFollowId ()); apFollowBehavior . setArticleId ( dto . getArticleId ()); apFollowBehavior . setCreatedTime ( new Date ()); save ( apFollowBehavior ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } } 06-\u63a5\u6536\u6570\u636e\u5e76\u6d4b\u8bd5 08:25 \u00b6 package com.heima.behavior.kafka.listener ; import com.alibaba.fastjson.JSON ; import com.heima.behavior.service.ApFollowBehaviorService ; import com.heima.common.constans.message.FollowBehaviorConstants ; import com.heima.model.behavior.dtos.FollowBehaviorDto ; import org.apache.kafka.clients.consumer.ConsumerRecord ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.kafka.annotation.KafkaListener ; import org.springframework.stereotype.Component ; import java.util.Optional ; @Component public class FollowBehaviorListener { @Autowired private ApFollowBehaviorService apFollowBehaviorService ; @KafkaListener ( topics = FollowBehaviorConstants . FOLLOW_BEHAVIOR_TOPIC ) public void receivMessage ( ConsumerRecord <? , ?> record ){ //\u63a5\u6536\u5173\u6ce8\u884c\u4e3a\u6570\u636e\uff0c\u4fdd\u5b58 Optional <? extends ConsumerRecord <? , ?>> optional = Optional . ofNullable ( record ); if ( optional . isPresent ()){ FollowBehaviorDto dto = JSON . parseObject ( record . value (). toString (), FollowBehaviorDto . class ); apFollowBehaviorService . saveFollowBehavior ( dto ); } } } 07-\u70b9\u8d5e\u884c\u4e3a-\u9700\u6c42\u5206\u6790 08:24 \u00b6 CREATE TABLE ` ap_likes_behavior ` ( ` id ` bigint ( 20 ) unsigned NOT NULL , ` entry_id ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u5b9e\u4f53ID' , ` article_id ` bigint ( 20 ) unsigned DEFAULT NULL COMMENT '\u6587\u7ae0ID' , ` type ` tinyint ( 1 ) unsigned DEFAULT NULL COMMENT '\u70b9\u8d5e\u5185\u5bb9\u7c7b\u578b\\r\\n 0\u6587\u7ae0\\r\\n 1\u52a8\u6001' , ` operation ` tinyint ( 1 ) unsigned DEFAULT NULL COMMENT '0 \u70b9\u8d5e\\r\\n 1 \u53d6\u6d88\u70b9\u8d5e' , ` created_time ` datetime DEFAULT NULL COMMENT '\u767b\u5f55\u65f6\u95f4' , PRIMARY KEY ( ` id ` ) USING BTREE ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci ROW_FORMAT = DYNAMIC COMMENT = 'APP\u70b9\u8d5e\u884c\u4e3a\u8868' package com.heima.apis.behavior ; import com.heima.model.behavior.dtos.LikesBehaviorDto ; import com.heima.model.behavior.pojos.ApLikesBehavior ; import com.heima.model.common.dtos.ResponseResult ; public interface ApLikesBehaviorControllerApi { /** * \u4fdd\u5b58\u70b9\u8d5e\u884c\u4e3a * @param dto * @return */ ResponseResult like ( LikesBehaviorDto dto ); } package com.heima.model.behavior.dtos ; import com.heima.model.common.annotation.IdEncrypt ; import lombok.Data ; @Data public class LikesBehaviorDto { // \u8bbe\u5907ID @IdEncrypt Integer equipmentId ; // \u6587\u7ae0\u3001\u52a8\u6001\u3001\u8bc4\u8bba\u7b49ID @IdEncrypt Long articleId ; /** * \u559c\u6b22\u5185\u5bb9\u7c7b\u578b * 0\u6587\u7ae0 * 1\u52a8\u6001 * 2\u8bc4\u8bba */ Short type ; /** * \u559c\u6b22\u64cd\u4f5c\u65b9\u5f0f * 0 \u70b9\u8d5e * 1 \u53d6\u6d88\u70b9\u8d5e */ Short operation ; } 08-\u529f\u80fd\u5b9e\u73b0\u53ca\u6d4b\u8bd5 14:10 \u00b6 package com.heima.behavior.service.impl ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl ; import com.heima.behavior.mapper.ApLikesBehaviorMapper ; import com.heima.behavior.service.ApBehaviorEntryService ; import com.heima.behavior.service.ApLikesBehaviorService ; import com.heima.model.behavior.dtos.LikesBehaviorDto ; import com.heima.model.behavior.pojos.ApBehaviorEntry ; import com.heima.model.behavior.pojos.ApLikesBehavior ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.user.pojos.ApUser ; import com.heima.utils.threadlocal.AppThreadLocalUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import java.util.Date ; @Service public class ApLikesBehaviorServiceImpl extends ServiceImpl < ApLikesBehaviorMapper , ApLikesBehavior > implements ApLikesBehaviorService { @Autowired private ApBehaviorEntryService apBehaviorEntryService ; @Override public ResponseResult like ( LikesBehaviorDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || dto . getArticleId () == null || ( dto . getType () < 0 || dto . getType () > 2 ) || ( dto . getOperation () < 0 || dto . getOperation () > 1 )){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u884c\u4e3a\u5b9e\u4f53 //\u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u7684\u7528\u6237\uff0cbehavior\u4e2d\u9700\u8981\u52a0\u5165\u8fc7\u6ee4\u5668\uff0c\u8fc7\u6ee4\u5668\u5c06\u7528\u6237\u5bf9\u8c61\u653e\u5230\u7ebf\u7a0b\u4e2d ApUser user = AppThreadLocalUtils . getUser (); ApBehaviorEntry apBehaviorEntry = apBehaviorEntryService . findByUserIdOrEquipmentId ( user . getId (), dto . getEquipmentId ()); if ( apBehaviorEntry == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //3.\u70b9\u8d5e\u6216\u53d6\u6d88\u70b9\u8d5e //\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728 ApLikesBehavior apLikesBehavior = getOne ( Wrappers . < ApLikesBehavior > lambdaQuery (). eq ( ApLikesBehavior :: getArticleId , dto . getArticleId ()). eq ( ApLikesBehavior :: getEntryId , apBehaviorEntry . getId ())); //\u907f\u514d\u7528\u6237\u672a\u70b9\u8d5e\uff0c\u64cd\u4f5c\uff1a\u53d6\u6d88\u70b9\u8d5e if ( apLikesBehavior == null && dto . getOperation () == 1 ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } if ( apLikesBehavior == null && dto . getOperation () == 0 ){ //\u6570\u636e\u4e0d\u5b58\u5728\uff0c\u6dfb\u52a0\u4e00\u6761\u70b9\u8d5e\u8bb0\u5f55 apLikesBehavior = new ApLikesBehavior (); apLikesBehavior . setOperation ( dto . getOperation ()); apLikesBehavior . setArticleId ( dto . getArticleId ()); apLikesBehavior . setEntryId ( apBehaviorEntry . getId ()); apLikesBehavior . setType ( dto . getType ()); apLikesBehavior . setCreatedTime ( new Date ()); save ( apLikesBehavior ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } else { apLikesBehavior . setOperation ( dto . getOperation ()); updateById ( apLikesBehavior ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } } } \u4fee\u6539\uff1a if ( dto == null || dto . getArticleId () == null || ( dto . getType () < 0 || dto . getType () > 2 ) || ( dto . getOperation () < 0 || dto . getOperation () > 1 )) 09-\u9605\u8bfb\u884c\u4e3a-\u9700\u6c42\u8bf4\u660e 09:08 \u00b6 CREATE TABLE ` ap_read_behavior ` ( ` id ` bigint ( 20 ) unsigned NOT NULL , ` entry_id ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u7528\u6237ID' , ` article_id ` bigint ( 20 ) unsigned DEFAULT NULL COMMENT '\u6587\u7ae0ID' , ` count ` tinyint ( 3 ) unsigned DEFAULT NULL , ` read_duration ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u9605\u8bfb\u65f6\u95f4\u5355\u4f4d\u79d2' , ` percentage ` tinyint ( 3 ) unsigned DEFAULT NULL COMMENT '\u9605\u8bfb\u767e\u5206\u6bd4' , ` load_duration ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u6587\u7ae0\u52a0\u8f7d\u65f6\u95f4' , ` created_time ` datetime DEFAULT NULL COMMENT '\u767b\u5f55\u65f6\u95f4' , ` updated_time ` datetime DEFAULT NULL , PRIMARY KEY ( ` id ` ) USING BTREE ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci ROW_FORMAT = DYNAMIC COMMENT = 'APP\u9605\u8bfb\u884c\u4e3a\u8868' \u65b0\u5efa\u9605\u8bfb\u884c\u4e3a\u7684api\u63a5\u53e3 package com.heima.apis.behavior ; import com.heima.model.behavior.dtos.ReadBehaviorDto ; import com.heima.model.common.dtos.ResponseResult ; public interface ApReadBehaviorControllerApi { /** * \u4fdd\u5b58\u6216\u66f4\u65b0\u9605\u8bfb\u884c\u4e3a * @return */ public ResponseResult readBehavior ( ReadBehaviorDto dto ); } ReadBehaviorDto package com.heima.model.behavior.dtos ; import com.heima.model.common.annotation.IdEncrypt ; import lombok.Data ; @Data public class ReadBehaviorDto { // \u8bbe\u5907ID @IdEncrypt Integer equipmentId ; // \u6587\u7ae0\u3001\u52a8\u6001\u3001\u8bc4\u8bba\u7b49ID @IdEncrypt Long articleId ; /** * \u9605\u8bfb\u6b21\u6570 */ Short count ; /** * \u9605\u8bfb\u65f6\u957f\uff08S) */ Integer readDuration ; /** * \u9605\u8bfb\u767e\u5206\u6bd4 */ Short percentage ; /** * \u52a0\u8f7d\u65f6\u95f4 */ Short loadDuration ; } 10-\u529f\u80fd\u5b8c\u6210\u53ca\u6d4b\u8bd5 10:08 \u00b6 package com.heima.behavior.service.impl ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl ; import com.heima.behavior.mapper.ApReadBehaviorMapper ; import com.heima.behavior.service.ApBehaviorEntryService ; import com.heima.behavior.service.ApReadBehaviorService ; import com.heima.model.behavior.dtos.ReadBehaviorDto ; import com.heima.model.behavior.pojos.ApBehaviorEntry ; import com.heima.model.behavior.pojos.ApReadBehavior ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.user.pojos.ApUser ; import com.heima.utils.threadlocal.AppThreadLocalUtils ; import lombok.extern.log4j.Log4j2 ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import java.util.Date ; @Service @Log4j2 public class ApReadBehaviorServiceImpl extends ServiceImpl < ApReadBehaviorMapper , ApReadBehavior > implements ApReadBehaviorService { @Autowired private ApBehaviorEntryService apBehaviorEntryService ; @Override public ResponseResult readBehavior ( ReadBehaviorDto dto ) { //1.\u53c2\u6570\u6821\u9a8c if ( dto == null || dto . getArticleId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u884c\u4e3a\u5b9e\u4f53 ApUser user = AppThreadLocalUtils . getUser (); ApBehaviorEntry apBehaviorEntry = apBehaviorEntryService . findByUserIdOrEquipmentId ( user . getId (), dto . getEquipmentId ()); if ( apBehaviorEntry == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //3.\u4fdd\u5b58\u6216\u66f4\u65b0\u9605\u8bfb\u7684\u884c\u4e3a ApReadBehavior apReadBehavior = getOne ( Wrappers . < ApReadBehavior > lambdaQuery (). eq ( ApReadBehavior :: getEntryId , apBehaviorEntry . getId ()). eq ( ApReadBehavior :: getArticleId , dto . getArticleId ())); if ( apReadBehavior == null ){ apReadBehavior = new ApReadBehavior (); apReadBehavior . setCount ( dto . getCount ()); apReadBehavior . setArticleId ( dto . getArticleId ()); apReadBehavior . setPercentage ( dto . getPercentage ()); apReadBehavior . setEntryId ( apBehaviorEntry . getId ()); apReadBehavior . setLoadDuration ( dto . getLoadDuration ()); apReadBehavior . setReadDuration ( dto . getReadDuration ()); apReadBehavior . setCreatedTime ( new Date ()); apReadBehavior . setUpdatedTime ( new Date ()); save ( apReadBehavior ); } else { apReadBehavior . setUpdatedTime ( new Date ()); apReadBehavior . setCount (( short )( apReadBehavior . getCount () + dto . getCount ())); //\u6700\u597d\u628a\u6700\u540e\u4e00\u6b21\u7684\u6570\u636e\u4e5f\u8bbe\u7f6e\u4e0a apReadBehavior . setLoadDuration ( dto . getLoadDuration ()); apReadBehavior . setReadDuration ( dto . getReadDuration ()); apReadBehavior . setPercentage ( dto . getPercentage ()); updateById ( apReadBehavior ); } return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } } 11-\u4e0d\u559c\u6b22\u548c\u6536\u85cf \u884c\u4e3a\u601d\u8def\u5206\u6790 06:46 \u00b6 \u4e0d\u559c\u6b22\uff1a 1 \u83b7\u53d6\u884c\u4e3a\u5b9e\u4f53 2 \u67e5\u8be2\u4e0d\u559c\u6b22\u5bf9\u8c61\uff0c\u6709\u5219\u4fee\u6539\uff0c\u65e0\u5219\u65b0\u589e 3 \u56fa\u5b9aapi\u63a5\u53e3\u5730\u5740\uff1a/api/v1/unlike_behavior POST\u8bf7\u6c42 \u6536\u85cf\uff1a \u6536\u85cf\u8868\u5728\u6587\u7ae0\u5e93\u4e2d\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u8bbe\u8ba1\u5728\u884c\u4e3a\u5e93\uff1f \u56e0\u4e3aapp\u7aef\u7528\u6237\u53ef\u4ee5\u4e2a\u4eba\u4e2d\u5fc3\u627e\u5230\u81ea\u5df1\u6536\u85cf\u7684\u6587\u7ae0\u5217\u8868\uff0c\u8fd9\u6837\u8bbe\u8ba1\u66f4\u65b9\u4fbf 12-\u6587\u7ae0\u5173\u7cfb \u9700\u6c42\u548c\u601d\u8def\u5206\u6790 07:10 \u00b6 1 \u7528\u6237\u67e5\u770b\u6587\u7ae0\u8be6\u60c5\uff0c\u5c55\u793a\u6587\u7ae0\u4fe1\u606f\uff08\u529f\u80fd\u5df2\u5b9e\u73b0\uff09\uff0c\u540c\u65f6\u9700\u8981\u5c55\u793a\u5f53\u524d\u6587\u7ae0\u7684\u884c\u4e3a\uff08\u70b9\u8d5e\uff0c\u6536\u85cf\u7b49\uff09 2 \u6839\u636e\u7528\u6237id(\u5df2\u767b\u5f55)\u6216\u8bbe\u5907id(\u672a\u767b\u5f55)\u53bb\u67e5\u8be2\u5f53\u524d\u5b9e\u4f53id 3 \u901a\u8fc7\u5b9e\u4f53id\u548c\u524d\u7aef\u4f20\u9012\u8fc7\u6765\u7684\u6587\u7ae0id\u53bb\u67e5\u8be2\u6536\u85cf\u8868\u3001\u70b9\u8d5e\u8868\u3001\u4e0d\u559c\u6b22\u8868\uff1b\u5176\u4e2d\u70b9\u8d5e\u548c\u4e0d\u559c\u6b22\u9700\u8981\u8fdc\u7a0b\u8c03\u7528behavior\u5fae\u670d\u52a1\u83b7\u53d6\u6570\u636e\u3002 4 \u5728\u6587\u7ae0\u8be6\u60c5\u5c55\u793a\u662f\u5426\u5173\u6ce8\u6b64\u4f5c\u8005\uff0c\u9700\u8981\u901a\u8fc7\u5f53\u524d\u7528\u6237\u548c\u4f5c\u8005\u5173\u7cfb\u8868\u8fdb\u884c\u67e5\u8be2\uff0c\u6709\u6570\u636e\u5219\u5173\u6ce8\uff0c\u65e0\u6570\u636e\u5219\u6ca1\u6709\u5173\u6ce8 \u8fd4\u56de\u7684\u683c\u5f0f\u5982\u4e0b\uff1a {\"isfollow\":true,\"islike\":true,\"isunlike\":false,\"iscollection\":true} 13-\u884c\u4e3a\u5fae\u670d\u52a1\u8fdc\u7a0b\u63a5\u53e3 16:09 \u00b6 package com.heima.apis.behavior ; import com.heima.model.behavior.pojos.ApBehaviorEntry ; public interface ApBehaviorEntryControllerApi { /** * \u67e5\u8be2\u884c\u4e3a\u5b9e\u4f53 * @param userId * @param equipmentId * @return */ public ApBehaviorEntry findByUserIdOrEquipmentId ( Integer userId , Integer equipmentId ); } \u70b9\u8d5e\uff1a package com.heima.behavior.controller.v1 ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.apis.behavior.ApLikesBehaviorControllerApi ; import com.heima.behavior.service.ApLikesBehaviorService ; import com.heima.model.behavior.dtos.LikesBehaviorDto ; import com.heima.model.behavior.pojos.ApLikesBehavior ; import com.heima.model.common.dtos.ResponseResult ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.* ; @RestController @RequestMapping ( \"/api/v1/likes_behavior\" ) public class ApLikesBehaviorController implements ApLikesBehaviorControllerApi { @Autowired private ApLikesBehaviorService apLikesBehaviorService ; @PostMapping @Override public ResponseResult like ( @RequestBody LikesBehaviorDto dto ) { return apLikesBehaviorService . like ( dto ); } @GetMapping ( \"/one\" ) @Override public ApLikesBehavior findLikeByArticleIdAndEntryId ( @RequestParam ( \"articleId\" ) Long articleId , @RequestParam ( \"entryId\" ) Integer entryId , @RequestParam ( \"type\" ) Short type ) { ApLikesBehavior apLikesBehavior = apLikesBehaviorService . getOne ( Wrappers . < ApLikesBehavior > lambdaQuery () . eq ( ApLikesBehavior :: getArticleId , articleId ). eq ( ApLikesBehavior :: getEntryId , entryId ) . eq ( ApLikesBehavior :: getType , type )); return apLikesBehavior ; } } \u4e0d\u559c\u6b22 package com.heima.behavior.controller.v1 ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.apis.behavior.ApUnlikesBehaviorControllerApi ; import com.heima.behavior.service.ApUnlikesBehaviorService ; import com.heima.model.behavior.pojos.ApUnlikesBehavior ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RequestParam ; import org.springframework.web.bind.annotation.RestController ; @RestController @RequestMapping ( \"/api/v1/un_likes_behavior\" ) public class ApUnlikesBehaviorController implements ApUnlikesBehaviorControllerApi { @Autowired private ApUnlikesBehaviorService apUnlikesBehaviorService ; @GetMapping ( \"/one\" ) @Override public ApUnlikesBehavior findUnLikeByArticleIdAndEntryId ( @RequestParam ( \"entryId\" ) Integer entryId , @RequestParam ( \"articleId\" ) Long articleId ) { return apUnlikesBehaviorService . getOne ( Wrappers . < ApUnlikesBehavior > lambdaQuery (). eq ( ApUnlikesBehavior :: getArticleId , articleId ) . eq ( ApUnlikesBehavior :: getEntryId , entryId )); } } 14-\u884c\u4e3a\u5fae\u670d\u52a1\u6d4b\u8bd5 04:17 \u00b6 \u542f\u52a8\u884c\u4e3a\u5fae\u670d\u52a1\u6d4b\u8bd5\uff0c\u4e0d\u7528\u7ecf\u8fc7\u7f51\u5173 15-\u7528\u6237\u5fae\u670d\u52a1\u8fdc\u7a0b\u63a5\u53e3 07:27 \u00b6 package com.heima.user.controller.v1 ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.apis.user.ApUserFollowControllerApi ; import com.heima.model.user.pojos.ApUserFollow ; import com.heima.user.service.ApUserFollowService ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RequestParam ; import org.springframework.web.bind.annotation.RestController ; @RestController @RequestMapping ( \"/api/v1/user_follow\" ) public class ApUserFollowController implements ApUserFollowControllerApi { @Autowired private ApUserFollowService apUserFollowService ; @GetMapping ( \"/one\" ) @Override public ApUserFollow findByUserIdAndFollowId ( @RequestParam ( \"userId\" ) Integer userId , @RequestParam ( \"followId\" ) Integer followId ) { return apUserFollowService . getOne ( Wrappers . < ApUserFollow > lambdaQuery () . eq ( ApUserFollow :: getUserId , userId ) . eq ( ApUserFollow :: getFollowId , followId )); } } 16-\u6587\u7ae0\u5fae\u670d\u52a1feign\u63a5\u53e3\u5b9a\u4e49 04:56 \u00b6 package com.heima.article.feign ; import com.heima.model.behavior.pojos.ApBehaviorEntry ; import com.heima.model.behavior.pojos.ApLikesBehavior ; import com.heima.model.behavior.pojos.ApUnlikesBehavior ; import org.springframework.cloud.openfeign.FeignClient ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.RequestParam ; @FeignClient ( \"leadnews-behavior\" ) public interface BehaviorFeign { @GetMapping ( \"/api/v1/behavior_entry/one\" ) public ApBehaviorEntry findByUserIdOrEquipmentId ( @RequestParam ( \"userId\" ) Integer userId , @RequestParam ( \"equipmentId\" ) Integer equipmentId ); @GetMapping ( \"/api/v1/likes_behavior/one\" ) public ApLikesBehavior findLikeByArticleIdAndEntryId ( @RequestParam ( \"articleId\" ) Long articleId , @RequestParam ( \"entryId\" ) Integer entryId , @RequestParam ( \"type\" ) Short type ); @GetMapping ( \"/api/v1/un_likes_behavior/one\" ) public ApUnlikesBehavior findUnLikeByArticleIdAndEntryId ( @RequestParam ( \"entryId\" ) Integer entryId , @RequestParam ( \"articleId\" ) Long articleId ); } package com.heima.article.feign ; import com.heima.model.user.pojos.ApUserFollow ; import org.springframework.cloud.openfeign.FeignClient ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.RequestParam ; @FeignClient ( \"leadnews-user\" ) public interface UserFeign { @GetMapping ( \"/api/v1/user_follow/one\" ) public ApUserFollow findByUserIdAndFollowId ( @RequestParam ( \"userId\" ) Integer userId , @RequestParam ( \"followId\" ) Integer followId ); } 17-\u63a5\u53e3\u5b9a\u4e49 08:14 \u00b6 @PostMapping ( \"/load_article_behavior\" ) @Override public ResponseResult loadArticleBehavior ( @RequestBody ArticleInfoDto dto ) { return articleInfoService . loadArticleBehavior ( dto ); } 1.\u4e0d\u559c\u6b22 true,false 2.\u70b9\u8d5e 3.\u6536\u85cf 4.\u5173\u6ce8 package com.heima.model.article.dtos ; import com.heima.model.common.annotation.IdEncrypt ; import lombok.Data ; @Data public class ArticleInfoDto { // \u8bbe\u5907ID @IdEncrypt Integer equipmentId ; // \u6587\u7ae0ID @IdEncrypt Long articleId ; // \u4f5c\u8005ID @IdEncrypt Integer authorId ; } 18-\u529f\u80fd\u5b9e\u73b0 15:18 \u00b6 package com.heima.article.service.impl ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.article.feign.BehaviorFeign ; import com.heima.article.feign.UserFeign ; import com.heima.article.mapper.ApArticleConfigMapper ; import com.heima.article.mapper.ApArticleContentMapper ; import com.heima.article.mapper.ApCollectionMapper ; import com.heima.article.mapper.AuthorMapper ; import com.heima.article.service.ArticleInfoService ; import com.heima.model.article.dtos.ArticleInfoDto ; import com.heima.model.article.pojos.ApArticleConfig ; import com.heima.model.article.pojos.ApArticleContent ; import com.heima.model.article.pojos.ApAuthor ; import com.heima.model.article.pojos.ApCollection ; import com.heima.model.behavior.pojos.ApBehaviorEntry ; import com.heima.model.behavior.pojos.ApLikesBehavior ; import com.heima.model.behavior.pojos.ApUnlikesBehavior ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.user.pojos.ApUser ; import com.heima.model.user.pojos.ApUserFollow ; import com.heima.utils.threadlocal.AppThreadLocalUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import java.util.HashMap ; import java.util.Map ; @Service public class ArticleInfoServiceImpl implements ArticleInfoService { @Autowired private ApArticleConfigMapper apArticleConfigMapper ; @Autowired private ApArticleContentMapper apArticleContentMapper ; @Override public ResponseResult loadArticleInfo ( ArticleInfoDto dto ) { Map < String , Object > resultMap = new HashMap <> (); //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || dto . getArticleId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u6587\u7ae0\u7684\u914d\u7f6e ApArticleConfig apArticleConfig = apArticleConfigMapper . selectOne ( Wrappers . < ApArticleConfig > lambdaQuery (). eq ( ApArticleConfig :: getArticleId , dto . getArticleId ())); if ( apArticleConfig == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //3.\u67e5\u8be2\u6587\u7ae0\u7684\u5185\u5bb9 if ( ! apArticleConfig . getIsDelete () && ! apArticleConfig . getIsDown ()){ ApArticleContent apArticleContent = apArticleContentMapper . selectOne ( Wrappers . < ApArticleContent > lambdaQuery (). eq ( ApArticleContent :: getArticleId , dto . getArticleId ())); resultMap . put ( \"content\" , apArticleContent ); } resultMap . put ( \"config\" , apArticleConfig ); //4.\u7ed3\u679c\u8fd4\u56de return ResponseResult . okResult ( resultMap ); } @Autowired private BehaviorFeign behaviorFeign ; @Autowired private ApCollectionMapper apCollectionMapper ; @Autowired private UserFeign userFeign ; @Autowired private AuthorMapper authorMapper ; @Override public ResponseResult loadArticleBehavior ( ArticleInfoDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || dto . getArticleId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u884c\u4e3a\u5b9e\u4f53 ApUser user = AppThreadLocalUtils . getUser (); ApBehaviorEntry apBehaviorEntry = behaviorFeign . findByUserIdOrEquipmentId ( user . getId (), dto . getEquipmentId ()); if ( apBehaviorEntry == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } boolean isUnlike = false , isLike = false , isCollection = false , isFollow = false ; //3.\u67e5\u8be2\u4e0d\u559c\u6b22\u884c\u4e3a ApUnlikesBehavior apUnlikesBehavior = behaviorFeign . findUnLikeByArticleIdAndEntryId ( apBehaviorEntry . getId (), dto . getArticleId ()); if ( apUnlikesBehavior != null && apUnlikesBehavior . getType () == ApUnlikesBehavior . Type . UNLIKE . getCode ()){ isUnlike = true ; } //4.\u67e5\u8be2\u70b9\u8d5e\u884c\u4e3a ApLikesBehavior apLikesBehavior = behaviorFeign . findLikeByArticleIdAndEntryId ( dto . getArticleId (), apBehaviorEntry . getId (), ApLikesBehavior . Type . ARTICLE . getCode ()); if ( apLikesBehavior != null && apLikesBehavior . getOperation () == ApLikesBehavior . Operation . LIKE . getCode ()){ isLike = true ; } //5.\u67e5\u8be2\u6536\u85cf\u884c\u4e3a ApCollection apCollection = apCollectionMapper . selectOne ( Wrappers . < ApCollection > lambdaQuery (). eq ( ApCollection :: getEntryId , apBehaviorEntry . getId ()) . eq ( ApCollection :: getArticleId , dto . getArticleId ()). eq ( ApCollection :: getType , ApCollection . Type . ARTICLE . getCode ())); if ( apCollection != null ){ isCollection = true ; } //6.\u67e5\u8be2\u662f\u5426\u5173\u6ce8 ApAuthor apAuthor = authorMapper . selectById ( dto . getAuthorId ()); if ( apAuthor != null ){ ApUserFollow apUserFollow = userFeign . findByUserIdAndFollowId ( user . getId (), apAuthor . getId ()); if ( apUserFollow != null ){ isFollow = true ; } } //7.\u7ed3\u679c\u8fd4\u56de {\"isfollow\":true,\"islike\":true,\"isunlike\":false,\"iscollection\":true} Map < String , Object > resultMap = new HashMap <> (); resultMap . put ( \"isfollow\" , isFollow ); resultMap . put ( \"islike\" , isLike ); resultMap . put ( \"isunlike\" , isUnlike ); resultMap . put ( \"iscollection\" , isCollection ); return ResponseResult . okResult ( resultMap ); } } 19-\u6d4b\u8bd5 06:36 \u00b6","title":"day10"},{"location":"hmtt/day10/#01-_0109","text":"\u7406\u89e3app\u7aef\u884c\u4e3a\u8bb0\u5f55 \u5b8c\u6210\u5173\u6ce8\u3001\u70b9\u8d5e\u3001\u9605\u8bfb\u884c\u4e3a \u638c\u63e1\u4e0d\u559c\u6b22\u548c\u6536\u85cf\u5b9e\u73b0\u601d\u8def \u5b8c\u6210app\u6587\u7ae0\u5173\u7cfb\u5c55\u793a\u529f\u80fd","title":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 01:09"},{"location":"hmtt/day10/#02-_0809","text":"\u521b\u5efaheima-leadnews-behavior\u670d\u52a1","title":"02-\u6982\u5ff5\u4ecb\u7ecd\u548c\u5fae\u670d\u52a1\u4ecb\u7ecd 08:09"},{"location":"hmtt/day10/#03-_0618","text":"CREATE TABLE ` ap_behavior_entry ` ( ` id ` int ( 11 ) unsigned NOT NULL AUTO_INCREMENT COMMENT '\u4e3b\u952e' , ` type ` tinyint ( 1 ) unsigned DEFAULT NULL COMMENT '\u5b9e\u4f53\u7c7b\u578b\\r\\n 0\u7ec8\u7aef\u8bbe\u5907\\r\\n 1\u7528\u6237' , ` entry_id ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u5b9e\u4f53ID' , ` created_time ` datetime DEFAULT NULL COMMENT '\u521b\u5efa\u65f6\u95f4' , PRIMARY KEY ( ` id ` ) USING BTREE ) ENGINE = InnoDB AUTO_INCREMENT = 2 DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci ROW_FORMAT = DYNAMIC COMMENT = 'APP\u884c\u4e3a\u5b9e\u4f53\u8868,\u4e00\u4e2a\u884c\u4e3a\u5b9e\u4f53\u53ef\u80fd\u662f\u7528\u6237\u6216\u8005\u8bbe\u5907\uff0c\u6216\u8005\u5176\u5b83' entry_id \u5982\u679c\u662f\u7528\u6237\uff0c\u5c31\u662f\u7528\u6237ID\uff1b\u5982\u679c\u662f\u8bbe\u5907\uff0c\u5c31\u662f\u8bbe\u5907ID CREATE TABLE ` ap_follow_behavior ` ( ` id ` bigint ( 20 ) unsigned NOT NULL , ` entry_id ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u5b9e\u4f53ID' , ` article_id ` bigint ( 20 ) unsigned DEFAULT NULL COMMENT '\u6587\u7ae0ID' , ` follow_id ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u5173\u6ce8\u7528\u6237ID' , ` created_time ` datetime DEFAULT NULL COMMENT '\u767b\u5f55\u65f6\u95f4' , PRIMARY KEY ( ` id ` ) USING BTREE , KEY ` idx_entry_id ` ( ` entry_id ` ) ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci ROW_FORMAT = DYNAMIC COMMENT = 'PP\u5173\u6ce8\u884c\u4e3a\u8868' \u6ce8\u610f\uff1a\u884c\u4e3a\u8868\u4e2d\u7684entry_id\u662fentry\u8868\u4e2d\u7684id","title":"03-\u8868\u5173\u7cfb\u5206\u6790 06:18"},{"location":"hmtt/day10/#04-_0528","text":"UserRelationServiceImpl\uff1a /** * \u5904\u7406\u5173\u6ce8\u7684\u64cd\u4f5c * @param apUser * @param followId * @param articleId * @return */ private ResponseResult followByUserId ( ApUser apUser , Integer followId , Long articleId ) { //\u5224\u65ad\u5f53\u524d\u5173\u6ce8\u4eba\u662f\u5426\u5b58\u5728 ApUser followUser = apUserMapper . selectById ( followId ); if ( followUser == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_NOT_EXIST , \"\u5173\u6ce8\u7528\u6237\u4e0d\u5b58\u5728\" ); } ApUserFollow apUserFollow = apUserFollowMapper . selectOne ( Wrappers . < ApUserFollow > lambdaQuery (). eq ( ApUserFollow :: getUserId , apUser . getId ()). eq ( ApUserFollow :: getFollowId , followId )); if ( apUserFollow == null ){ //\u4fdd\u5b58\u6570\u636e ap_user_follow ap_user_fan ApUserFan apUserFan = apUserFanMapper . selectOne ( Wrappers . < ApUserFan > lambdaQuery (). eq ( ApUserFan :: getUserId , followId ). eq ( ApUserFan :: getFansId , apUser . getId ())); //\u4fdd\u5b58app\u7528\u6237\u7c89\u4e1d\u4fe1\u606f if ( apUserFan == null ){ apUserFan = new ApUserFan (); apUserFan . setUserId ( followId ); apUserFan . setFansId ( apUser . getId (). longValue ()); apUserFan . setFansName ( followUser . getName ()); apUserFan . setLevel (( short ) 0 ); apUserFan . setIsDisplay ( true ); apUserFan . setIsShieldLetter ( false ); apUserFan . setIsShieldComment ( false ); apUserFan . setCreatedTime ( new Date ()); apUserFanMapper . insert ( apUserFan ); } //\u4fdd\u5b58app\u7528\u6237\u5173\u6ce8\u4fe1\u606f apUserFollow = new ApUserFollow (); apUserFollow . setUserId ( apUser . getId ()); apUserFollow . setFollowId ( followId ); apUserFollow . setCreatedTime ( new Date ()); apUserFollow . setIsNotice ( true ); apUserFollow . setLevel (( short ) 1 ); apUserFollowMapper . insert ( apUserFollow ); //TODO \u8bb0\u5f55\u5173\u6ce8\u6587\u7ae0\u7684\u884c\u4e3a FollowBehaviorDto dto = new FollowBehaviorDto (); dto . setFollowId ( followId ); dto . setArticleId ( articleId ); dto . setUserId ( apUser . getId ()); kafkaTemplate . send ( FollowBehaviorConstants . FOLLOW_BEHAVIOR_TOPIC , JSON . toJSONString ( dto )); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } else { //\u5df2\u5173\u6ce8 return ResponseResult . errorResult ( AppHttpCodeEnum . DATA_EXIST , \"\u5df2\u5173\u6ce8\" ); } }","title":"04-\u7528\u6237\u7aef\u53d1\u9001\u6d88\u606f 05:28"},{"location":"hmtt/day10/#05-_1505","text":"1.\u63d0\u4f9b\u63a5\u53e3\uff0c\u6839\u636e\u7528\u6237ID\u6216\u8005\u8bbe\u5907ID\uff0c\u67e5\u8be2entityId 2.\u4fdd\u5b58\u884c\u4e3a\u6570\u636e package com.heima.behavior.service.impl ; import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl ; import com.heima.behavior.mapper.ApFollowBehaviorMapper ; import com.heima.behavior.service.ApBehaviorEntryService ; import com.heima.behavior.service.ApFollowBehaviorService ; import com.heima.model.behavior.dtos.FollowBehaviorDto ; import com.heima.model.behavior.pojos.ApBehaviorEntry ; import com.heima.model.behavior.pojos.ApFollowBehavior ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import lombok.extern.log4j.Log4j2 ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import java.util.Date ; @Service @Log4j2 public class ApFollowBehaviorServiceImpl extends ServiceImpl < ApFollowBehaviorMapper , ApFollowBehavior > implements ApFollowBehaviorService { @Autowired private ApBehaviorEntryService apBehaviorEntryService ; @Override public ResponseResult saveFollowBehavior ( FollowBehaviorDto dto ) { //1.\u67e5\u8be2\u884c\u4e3a\u5b9e\u4f53 ApBehaviorEntry apBehaviorEntry = apBehaviorEntryService . findByUserIdOrEquipmentId ( dto . getUserId (), null ); if ( apBehaviorEntry == null ){ log . error ( \"\u884c\u4e3a\u5b9e\u4f53\u4e3a\u7a7a\" ); return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u4fdd\u5b58\u5173\u6ce8\u884c\u4e3a ApFollowBehavior apFollowBehavior = new ApFollowBehavior (); //\u6ce8\u610f\u8bbe\u7f6eentryId\u6307\u7684\u662fentry\u8868\u4e2d\u7684id apFollowBehavior . setEntryId ( apBehaviorEntry . getId ()); apFollowBehavior . setFollowId ( dto . getFollowId ()); apFollowBehavior . setArticleId ( dto . getArticleId ()); apFollowBehavior . setCreatedTime ( new Date ()); save ( apFollowBehavior ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } }","title":"05-\u4fdd\u5b58\u5173\u6ce8\u884c\u4e3a 15:05"},{"location":"hmtt/day10/#06-_0825","text":"package com.heima.behavior.kafka.listener ; import com.alibaba.fastjson.JSON ; import com.heima.behavior.service.ApFollowBehaviorService ; import com.heima.common.constans.message.FollowBehaviorConstants ; import com.heima.model.behavior.dtos.FollowBehaviorDto ; import org.apache.kafka.clients.consumer.ConsumerRecord ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.kafka.annotation.KafkaListener ; import org.springframework.stereotype.Component ; import java.util.Optional ; @Component public class FollowBehaviorListener { @Autowired private ApFollowBehaviorService apFollowBehaviorService ; @KafkaListener ( topics = FollowBehaviorConstants . FOLLOW_BEHAVIOR_TOPIC ) public void receivMessage ( ConsumerRecord <? , ?> record ){ //\u63a5\u6536\u5173\u6ce8\u884c\u4e3a\u6570\u636e\uff0c\u4fdd\u5b58 Optional <? extends ConsumerRecord <? , ?>> optional = Optional . ofNullable ( record ); if ( optional . isPresent ()){ FollowBehaviorDto dto = JSON . parseObject ( record . value (). toString (), FollowBehaviorDto . class ); apFollowBehaviorService . saveFollowBehavior ( dto ); } } }","title":"06-\u63a5\u6536\u6570\u636e\u5e76\u6d4b\u8bd5 08:25"},{"location":"hmtt/day10/#07--_0824","text":"CREATE TABLE ` ap_likes_behavior ` ( ` id ` bigint ( 20 ) unsigned NOT NULL , ` entry_id ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u5b9e\u4f53ID' , ` article_id ` bigint ( 20 ) unsigned DEFAULT NULL COMMENT '\u6587\u7ae0ID' , ` type ` tinyint ( 1 ) unsigned DEFAULT NULL COMMENT '\u70b9\u8d5e\u5185\u5bb9\u7c7b\u578b\\r\\n 0\u6587\u7ae0\\r\\n 1\u52a8\u6001' , ` operation ` tinyint ( 1 ) unsigned DEFAULT NULL COMMENT '0 \u70b9\u8d5e\\r\\n 1 \u53d6\u6d88\u70b9\u8d5e' , ` created_time ` datetime DEFAULT NULL COMMENT '\u767b\u5f55\u65f6\u95f4' , PRIMARY KEY ( ` id ` ) USING BTREE ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci ROW_FORMAT = DYNAMIC COMMENT = 'APP\u70b9\u8d5e\u884c\u4e3a\u8868' package com.heima.apis.behavior ; import com.heima.model.behavior.dtos.LikesBehaviorDto ; import com.heima.model.behavior.pojos.ApLikesBehavior ; import com.heima.model.common.dtos.ResponseResult ; public interface ApLikesBehaviorControllerApi { /** * \u4fdd\u5b58\u70b9\u8d5e\u884c\u4e3a * @param dto * @return */ ResponseResult like ( LikesBehaviorDto dto ); } package com.heima.model.behavior.dtos ; import com.heima.model.common.annotation.IdEncrypt ; import lombok.Data ; @Data public class LikesBehaviorDto { // \u8bbe\u5907ID @IdEncrypt Integer equipmentId ; // \u6587\u7ae0\u3001\u52a8\u6001\u3001\u8bc4\u8bba\u7b49ID @IdEncrypt Long articleId ; /** * \u559c\u6b22\u5185\u5bb9\u7c7b\u578b * 0\u6587\u7ae0 * 1\u52a8\u6001 * 2\u8bc4\u8bba */ Short type ; /** * \u559c\u6b22\u64cd\u4f5c\u65b9\u5f0f * 0 \u70b9\u8d5e * 1 \u53d6\u6d88\u70b9\u8d5e */ Short operation ; }","title":"07-\u70b9\u8d5e\u884c\u4e3a-\u9700\u6c42\u5206\u6790 08:24"},{"location":"hmtt/day10/#08-_1410","text":"package com.heima.behavior.service.impl ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl ; import com.heima.behavior.mapper.ApLikesBehaviorMapper ; import com.heima.behavior.service.ApBehaviorEntryService ; import com.heima.behavior.service.ApLikesBehaviorService ; import com.heima.model.behavior.dtos.LikesBehaviorDto ; import com.heima.model.behavior.pojos.ApBehaviorEntry ; import com.heima.model.behavior.pojos.ApLikesBehavior ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.user.pojos.ApUser ; import com.heima.utils.threadlocal.AppThreadLocalUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import java.util.Date ; @Service public class ApLikesBehaviorServiceImpl extends ServiceImpl < ApLikesBehaviorMapper , ApLikesBehavior > implements ApLikesBehaviorService { @Autowired private ApBehaviorEntryService apBehaviorEntryService ; @Override public ResponseResult like ( LikesBehaviorDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || dto . getArticleId () == null || ( dto . getType () < 0 || dto . getType () > 2 ) || ( dto . getOperation () < 0 || dto . getOperation () > 1 )){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u884c\u4e3a\u5b9e\u4f53 //\u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u7684\u7528\u6237\uff0cbehavior\u4e2d\u9700\u8981\u52a0\u5165\u8fc7\u6ee4\u5668\uff0c\u8fc7\u6ee4\u5668\u5c06\u7528\u6237\u5bf9\u8c61\u653e\u5230\u7ebf\u7a0b\u4e2d ApUser user = AppThreadLocalUtils . getUser (); ApBehaviorEntry apBehaviorEntry = apBehaviorEntryService . findByUserIdOrEquipmentId ( user . getId (), dto . getEquipmentId ()); if ( apBehaviorEntry == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //3.\u70b9\u8d5e\u6216\u53d6\u6d88\u70b9\u8d5e //\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728 ApLikesBehavior apLikesBehavior = getOne ( Wrappers . < ApLikesBehavior > lambdaQuery (). eq ( ApLikesBehavior :: getArticleId , dto . getArticleId ()). eq ( ApLikesBehavior :: getEntryId , apBehaviorEntry . getId ())); //\u907f\u514d\u7528\u6237\u672a\u70b9\u8d5e\uff0c\u64cd\u4f5c\uff1a\u53d6\u6d88\u70b9\u8d5e if ( apLikesBehavior == null && dto . getOperation () == 1 ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } if ( apLikesBehavior == null && dto . getOperation () == 0 ){ //\u6570\u636e\u4e0d\u5b58\u5728\uff0c\u6dfb\u52a0\u4e00\u6761\u70b9\u8d5e\u8bb0\u5f55 apLikesBehavior = new ApLikesBehavior (); apLikesBehavior . setOperation ( dto . getOperation ()); apLikesBehavior . setArticleId ( dto . getArticleId ()); apLikesBehavior . setEntryId ( apBehaviorEntry . getId ()); apLikesBehavior . setType ( dto . getType ()); apLikesBehavior . setCreatedTime ( new Date ()); save ( apLikesBehavior ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } else { apLikesBehavior . setOperation ( dto . getOperation ()); updateById ( apLikesBehavior ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } } } \u4fee\u6539\uff1a if ( dto == null || dto . getArticleId () == null || ( dto . getType () < 0 || dto . getType () > 2 ) || ( dto . getOperation () < 0 || dto . getOperation () > 1 ))","title":"08-\u529f\u80fd\u5b9e\u73b0\u53ca\u6d4b\u8bd5 14:10"},{"location":"hmtt/day10/#09--_0908","text":"CREATE TABLE ` ap_read_behavior ` ( ` id ` bigint ( 20 ) unsigned NOT NULL , ` entry_id ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u7528\u6237ID' , ` article_id ` bigint ( 20 ) unsigned DEFAULT NULL COMMENT '\u6587\u7ae0ID' , ` count ` tinyint ( 3 ) unsigned DEFAULT NULL , ` read_duration ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u9605\u8bfb\u65f6\u95f4\u5355\u4f4d\u79d2' , ` percentage ` tinyint ( 3 ) unsigned DEFAULT NULL COMMENT '\u9605\u8bfb\u767e\u5206\u6bd4' , ` load_duration ` int ( 11 ) unsigned DEFAULT NULL COMMENT '\u6587\u7ae0\u52a0\u8f7d\u65f6\u95f4' , ` created_time ` datetime DEFAULT NULL COMMENT '\u767b\u5f55\u65f6\u95f4' , ` updated_time ` datetime DEFAULT NULL , PRIMARY KEY ( ` id ` ) USING BTREE ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci ROW_FORMAT = DYNAMIC COMMENT = 'APP\u9605\u8bfb\u884c\u4e3a\u8868' \u65b0\u5efa\u9605\u8bfb\u884c\u4e3a\u7684api\u63a5\u53e3 package com.heima.apis.behavior ; import com.heima.model.behavior.dtos.ReadBehaviorDto ; import com.heima.model.common.dtos.ResponseResult ; public interface ApReadBehaviorControllerApi { /** * \u4fdd\u5b58\u6216\u66f4\u65b0\u9605\u8bfb\u884c\u4e3a * @return */ public ResponseResult readBehavior ( ReadBehaviorDto dto ); } ReadBehaviorDto package com.heima.model.behavior.dtos ; import com.heima.model.common.annotation.IdEncrypt ; import lombok.Data ; @Data public class ReadBehaviorDto { // \u8bbe\u5907ID @IdEncrypt Integer equipmentId ; // \u6587\u7ae0\u3001\u52a8\u6001\u3001\u8bc4\u8bba\u7b49ID @IdEncrypt Long articleId ; /** * \u9605\u8bfb\u6b21\u6570 */ Short count ; /** * \u9605\u8bfb\u65f6\u957f\uff08S) */ Integer readDuration ; /** * \u9605\u8bfb\u767e\u5206\u6bd4 */ Short percentage ; /** * \u52a0\u8f7d\u65f6\u95f4 */ Short loadDuration ; }","title":"09-\u9605\u8bfb\u884c\u4e3a-\u9700\u6c42\u8bf4\u660e 09:08"},{"location":"hmtt/day10/#10-_1008","text":"package com.heima.behavior.service.impl ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl ; import com.heima.behavior.mapper.ApReadBehaviorMapper ; import com.heima.behavior.service.ApBehaviorEntryService ; import com.heima.behavior.service.ApReadBehaviorService ; import com.heima.model.behavior.dtos.ReadBehaviorDto ; import com.heima.model.behavior.pojos.ApBehaviorEntry ; import com.heima.model.behavior.pojos.ApReadBehavior ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.user.pojos.ApUser ; import com.heima.utils.threadlocal.AppThreadLocalUtils ; import lombok.extern.log4j.Log4j2 ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import java.util.Date ; @Service @Log4j2 public class ApReadBehaviorServiceImpl extends ServiceImpl < ApReadBehaviorMapper , ApReadBehavior > implements ApReadBehaviorService { @Autowired private ApBehaviorEntryService apBehaviorEntryService ; @Override public ResponseResult readBehavior ( ReadBehaviorDto dto ) { //1.\u53c2\u6570\u6821\u9a8c if ( dto == null || dto . getArticleId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u884c\u4e3a\u5b9e\u4f53 ApUser user = AppThreadLocalUtils . getUser (); ApBehaviorEntry apBehaviorEntry = apBehaviorEntryService . findByUserIdOrEquipmentId ( user . getId (), dto . getEquipmentId ()); if ( apBehaviorEntry == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //3.\u4fdd\u5b58\u6216\u66f4\u65b0\u9605\u8bfb\u7684\u884c\u4e3a ApReadBehavior apReadBehavior = getOne ( Wrappers . < ApReadBehavior > lambdaQuery (). eq ( ApReadBehavior :: getEntryId , apBehaviorEntry . getId ()). eq ( ApReadBehavior :: getArticleId , dto . getArticleId ())); if ( apReadBehavior == null ){ apReadBehavior = new ApReadBehavior (); apReadBehavior . setCount ( dto . getCount ()); apReadBehavior . setArticleId ( dto . getArticleId ()); apReadBehavior . setPercentage ( dto . getPercentage ()); apReadBehavior . setEntryId ( apBehaviorEntry . getId ()); apReadBehavior . setLoadDuration ( dto . getLoadDuration ()); apReadBehavior . setReadDuration ( dto . getReadDuration ()); apReadBehavior . setCreatedTime ( new Date ()); apReadBehavior . setUpdatedTime ( new Date ()); save ( apReadBehavior ); } else { apReadBehavior . setUpdatedTime ( new Date ()); apReadBehavior . setCount (( short )( apReadBehavior . getCount () + dto . getCount ())); //\u6700\u597d\u628a\u6700\u540e\u4e00\u6b21\u7684\u6570\u636e\u4e5f\u8bbe\u7f6e\u4e0a apReadBehavior . setLoadDuration ( dto . getLoadDuration ()); apReadBehavior . setReadDuration ( dto . getReadDuration ()); apReadBehavior . setPercentage ( dto . getPercentage ()); updateById ( apReadBehavior ); } return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } }","title":"10-\u529f\u80fd\u5b8c\u6210\u53ca\u6d4b\u8bd5 10:08"},{"location":"hmtt/day10/#11-_0646","text":"\u4e0d\u559c\u6b22\uff1a 1 \u83b7\u53d6\u884c\u4e3a\u5b9e\u4f53 2 \u67e5\u8be2\u4e0d\u559c\u6b22\u5bf9\u8c61\uff0c\u6709\u5219\u4fee\u6539\uff0c\u65e0\u5219\u65b0\u589e 3 \u56fa\u5b9aapi\u63a5\u53e3\u5730\u5740\uff1a/api/v1/unlike_behavior POST\u8bf7\u6c42 \u6536\u85cf\uff1a \u6536\u85cf\u8868\u5728\u6587\u7ae0\u5e93\u4e2d\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u8bbe\u8ba1\u5728\u884c\u4e3a\u5e93\uff1f \u56e0\u4e3aapp\u7aef\u7528\u6237\u53ef\u4ee5\u4e2a\u4eba\u4e2d\u5fc3\u627e\u5230\u81ea\u5df1\u6536\u85cf\u7684\u6587\u7ae0\u5217\u8868\uff0c\u8fd9\u6837\u8bbe\u8ba1\u66f4\u65b9\u4fbf","title":"11-\u4e0d\u559c\u6b22\u548c\u6536\u85cf \u884c\u4e3a\u601d\u8def\u5206\u6790 06:46"},{"location":"hmtt/day10/#12-_0710","text":"1 \u7528\u6237\u67e5\u770b\u6587\u7ae0\u8be6\u60c5\uff0c\u5c55\u793a\u6587\u7ae0\u4fe1\u606f\uff08\u529f\u80fd\u5df2\u5b9e\u73b0\uff09\uff0c\u540c\u65f6\u9700\u8981\u5c55\u793a\u5f53\u524d\u6587\u7ae0\u7684\u884c\u4e3a\uff08\u70b9\u8d5e\uff0c\u6536\u85cf\u7b49\uff09 2 \u6839\u636e\u7528\u6237id(\u5df2\u767b\u5f55)\u6216\u8bbe\u5907id(\u672a\u767b\u5f55)\u53bb\u67e5\u8be2\u5f53\u524d\u5b9e\u4f53id 3 \u901a\u8fc7\u5b9e\u4f53id\u548c\u524d\u7aef\u4f20\u9012\u8fc7\u6765\u7684\u6587\u7ae0id\u53bb\u67e5\u8be2\u6536\u85cf\u8868\u3001\u70b9\u8d5e\u8868\u3001\u4e0d\u559c\u6b22\u8868\uff1b\u5176\u4e2d\u70b9\u8d5e\u548c\u4e0d\u559c\u6b22\u9700\u8981\u8fdc\u7a0b\u8c03\u7528behavior\u5fae\u670d\u52a1\u83b7\u53d6\u6570\u636e\u3002 4 \u5728\u6587\u7ae0\u8be6\u60c5\u5c55\u793a\u662f\u5426\u5173\u6ce8\u6b64\u4f5c\u8005\uff0c\u9700\u8981\u901a\u8fc7\u5f53\u524d\u7528\u6237\u548c\u4f5c\u8005\u5173\u7cfb\u8868\u8fdb\u884c\u67e5\u8be2\uff0c\u6709\u6570\u636e\u5219\u5173\u6ce8\uff0c\u65e0\u6570\u636e\u5219\u6ca1\u6709\u5173\u6ce8 \u8fd4\u56de\u7684\u683c\u5f0f\u5982\u4e0b\uff1a {\"isfollow\":true,\"islike\":true,\"isunlike\":false,\"iscollection\":true}","title":"12-\u6587\u7ae0\u5173\u7cfb \u9700\u6c42\u548c\u601d\u8def\u5206\u6790 07:10"},{"location":"hmtt/day10/#13-_1609","text":"package com.heima.apis.behavior ; import com.heima.model.behavior.pojos.ApBehaviorEntry ; public interface ApBehaviorEntryControllerApi { /** * \u67e5\u8be2\u884c\u4e3a\u5b9e\u4f53 * @param userId * @param equipmentId * @return */ public ApBehaviorEntry findByUserIdOrEquipmentId ( Integer userId , Integer equipmentId ); } \u70b9\u8d5e\uff1a package com.heima.behavior.controller.v1 ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.apis.behavior.ApLikesBehaviorControllerApi ; import com.heima.behavior.service.ApLikesBehaviorService ; import com.heima.model.behavior.dtos.LikesBehaviorDto ; import com.heima.model.behavior.pojos.ApLikesBehavior ; import com.heima.model.common.dtos.ResponseResult ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.* ; @RestController @RequestMapping ( \"/api/v1/likes_behavior\" ) public class ApLikesBehaviorController implements ApLikesBehaviorControllerApi { @Autowired private ApLikesBehaviorService apLikesBehaviorService ; @PostMapping @Override public ResponseResult like ( @RequestBody LikesBehaviorDto dto ) { return apLikesBehaviorService . like ( dto ); } @GetMapping ( \"/one\" ) @Override public ApLikesBehavior findLikeByArticleIdAndEntryId ( @RequestParam ( \"articleId\" ) Long articleId , @RequestParam ( \"entryId\" ) Integer entryId , @RequestParam ( \"type\" ) Short type ) { ApLikesBehavior apLikesBehavior = apLikesBehaviorService . getOne ( Wrappers . < ApLikesBehavior > lambdaQuery () . eq ( ApLikesBehavior :: getArticleId , articleId ). eq ( ApLikesBehavior :: getEntryId , entryId ) . eq ( ApLikesBehavior :: getType , type )); return apLikesBehavior ; } } \u4e0d\u559c\u6b22 package com.heima.behavior.controller.v1 ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.apis.behavior.ApUnlikesBehaviorControllerApi ; import com.heima.behavior.service.ApUnlikesBehaviorService ; import com.heima.model.behavior.pojos.ApUnlikesBehavior ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RequestParam ; import org.springframework.web.bind.annotation.RestController ; @RestController @RequestMapping ( \"/api/v1/un_likes_behavior\" ) public class ApUnlikesBehaviorController implements ApUnlikesBehaviorControllerApi { @Autowired private ApUnlikesBehaviorService apUnlikesBehaviorService ; @GetMapping ( \"/one\" ) @Override public ApUnlikesBehavior findUnLikeByArticleIdAndEntryId ( @RequestParam ( \"entryId\" ) Integer entryId , @RequestParam ( \"articleId\" ) Long articleId ) { return apUnlikesBehaviorService . getOne ( Wrappers . < ApUnlikesBehavior > lambdaQuery (). eq ( ApUnlikesBehavior :: getArticleId , articleId ) . eq ( ApUnlikesBehavior :: getEntryId , entryId )); } }","title":"13-\u884c\u4e3a\u5fae\u670d\u52a1\u8fdc\u7a0b\u63a5\u53e3 16:09"},{"location":"hmtt/day10/#14-_0417","text":"\u542f\u52a8\u884c\u4e3a\u5fae\u670d\u52a1\u6d4b\u8bd5\uff0c\u4e0d\u7528\u7ecf\u8fc7\u7f51\u5173","title":"14-\u884c\u4e3a\u5fae\u670d\u52a1\u6d4b\u8bd5 04:17"},{"location":"hmtt/day10/#15-_0727","text":"package com.heima.user.controller.v1 ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.apis.user.ApUserFollowControllerApi ; import com.heima.model.user.pojos.ApUserFollow ; import com.heima.user.service.ApUserFollowService ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RequestParam ; import org.springframework.web.bind.annotation.RestController ; @RestController @RequestMapping ( \"/api/v1/user_follow\" ) public class ApUserFollowController implements ApUserFollowControllerApi { @Autowired private ApUserFollowService apUserFollowService ; @GetMapping ( \"/one\" ) @Override public ApUserFollow findByUserIdAndFollowId ( @RequestParam ( \"userId\" ) Integer userId , @RequestParam ( \"followId\" ) Integer followId ) { return apUserFollowService . getOne ( Wrappers . < ApUserFollow > lambdaQuery () . eq ( ApUserFollow :: getUserId , userId ) . eq ( ApUserFollow :: getFollowId , followId )); } }","title":"15-\u7528\u6237\u5fae\u670d\u52a1\u8fdc\u7a0b\u63a5\u53e3 07:27"},{"location":"hmtt/day10/#16-feign_0456","text":"package com.heima.article.feign ; import com.heima.model.behavior.pojos.ApBehaviorEntry ; import com.heima.model.behavior.pojos.ApLikesBehavior ; import com.heima.model.behavior.pojos.ApUnlikesBehavior ; import org.springframework.cloud.openfeign.FeignClient ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.RequestParam ; @FeignClient ( \"leadnews-behavior\" ) public interface BehaviorFeign { @GetMapping ( \"/api/v1/behavior_entry/one\" ) public ApBehaviorEntry findByUserIdOrEquipmentId ( @RequestParam ( \"userId\" ) Integer userId , @RequestParam ( \"equipmentId\" ) Integer equipmentId ); @GetMapping ( \"/api/v1/likes_behavior/one\" ) public ApLikesBehavior findLikeByArticleIdAndEntryId ( @RequestParam ( \"articleId\" ) Long articleId , @RequestParam ( \"entryId\" ) Integer entryId , @RequestParam ( \"type\" ) Short type ); @GetMapping ( \"/api/v1/un_likes_behavior/one\" ) public ApUnlikesBehavior findUnLikeByArticleIdAndEntryId ( @RequestParam ( \"entryId\" ) Integer entryId , @RequestParam ( \"articleId\" ) Long articleId ); } package com.heima.article.feign ; import com.heima.model.user.pojos.ApUserFollow ; import org.springframework.cloud.openfeign.FeignClient ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.RequestParam ; @FeignClient ( \"leadnews-user\" ) public interface UserFeign { @GetMapping ( \"/api/v1/user_follow/one\" ) public ApUserFollow findByUserIdAndFollowId ( @RequestParam ( \"userId\" ) Integer userId , @RequestParam ( \"followId\" ) Integer followId ); }","title":"16-\u6587\u7ae0\u5fae\u670d\u52a1feign\u63a5\u53e3\u5b9a\u4e49 04:56"},{"location":"hmtt/day10/#17-_0814","text":"@PostMapping ( \"/load_article_behavior\" ) @Override public ResponseResult loadArticleBehavior ( @RequestBody ArticleInfoDto dto ) { return articleInfoService . loadArticleBehavior ( dto ); } 1.\u4e0d\u559c\u6b22 true,false 2.\u70b9\u8d5e 3.\u6536\u85cf 4.\u5173\u6ce8 package com.heima.model.article.dtos ; import com.heima.model.common.annotation.IdEncrypt ; import lombok.Data ; @Data public class ArticleInfoDto { // \u8bbe\u5907ID @IdEncrypt Integer equipmentId ; // \u6587\u7ae0ID @IdEncrypt Long articleId ; // \u4f5c\u8005ID @IdEncrypt Integer authorId ; }","title":"17-\u63a5\u53e3\u5b9a\u4e49 08:14"},{"location":"hmtt/day10/#18-_1518","text":"package com.heima.article.service.impl ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.article.feign.BehaviorFeign ; import com.heima.article.feign.UserFeign ; import com.heima.article.mapper.ApArticleConfigMapper ; import com.heima.article.mapper.ApArticleContentMapper ; import com.heima.article.mapper.ApCollectionMapper ; import com.heima.article.mapper.AuthorMapper ; import com.heima.article.service.ArticleInfoService ; import com.heima.model.article.dtos.ArticleInfoDto ; import com.heima.model.article.pojos.ApArticleConfig ; import com.heima.model.article.pojos.ApArticleContent ; import com.heima.model.article.pojos.ApAuthor ; import com.heima.model.article.pojos.ApCollection ; import com.heima.model.behavior.pojos.ApBehaviorEntry ; import com.heima.model.behavior.pojos.ApLikesBehavior ; import com.heima.model.behavior.pojos.ApUnlikesBehavior ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.user.pojos.ApUser ; import com.heima.model.user.pojos.ApUserFollow ; import com.heima.utils.threadlocal.AppThreadLocalUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import java.util.HashMap ; import java.util.Map ; @Service public class ArticleInfoServiceImpl implements ArticleInfoService { @Autowired private ApArticleConfigMapper apArticleConfigMapper ; @Autowired private ApArticleContentMapper apArticleContentMapper ; @Override public ResponseResult loadArticleInfo ( ArticleInfoDto dto ) { Map < String , Object > resultMap = new HashMap <> (); //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || dto . getArticleId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u6587\u7ae0\u7684\u914d\u7f6e ApArticleConfig apArticleConfig = apArticleConfigMapper . selectOne ( Wrappers . < ApArticleConfig > lambdaQuery (). eq ( ApArticleConfig :: getArticleId , dto . getArticleId ())); if ( apArticleConfig == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //3.\u67e5\u8be2\u6587\u7ae0\u7684\u5185\u5bb9 if ( ! apArticleConfig . getIsDelete () && ! apArticleConfig . getIsDown ()){ ApArticleContent apArticleContent = apArticleContentMapper . selectOne ( Wrappers . < ApArticleContent > lambdaQuery (). eq ( ApArticleContent :: getArticleId , dto . getArticleId ())); resultMap . put ( \"content\" , apArticleContent ); } resultMap . put ( \"config\" , apArticleConfig ); //4.\u7ed3\u679c\u8fd4\u56de return ResponseResult . okResult ( resultMap ); } @Autowired private BehaviorFeign behaviorFeign ; @Autowired private ApCollectionMapper apCollectionMapper ; @Autowired private UserFeign userFeign ; @Autowired private AuthorMapper authorMapper ; @Override public ResponseResult loadArticleBehavior ( ArticleInfoDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || dto . getArticleId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u884c\u4e3a\u5b9e\u4f53 ApUser user = AppThreadLocalUtils . getUser (); ApBehaviorEntry apBehaviorEntry = behaviorFeign . findByUserIdOrEquipmentId ( user . getId (), dto . getEquipmentId ()); if ( apBehaviorEntry == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } boolean isUnlike = false , isLike = false , isCollection = false , isFollow = false ; //3.\u67e5\u8be2\u4e0d\u559c\u6b22\u884c\u4e3a ApUnlikesBehavior apUnlikesBehavior = behaviorFeign . findUnLikeByArticleIdAndEntryId ( apBehaviorEntry . getId (), dto . getArticleId ()); if ( apUnlikesBehavior != null && apUnlikesBehavior . getType () == ApUnlikesBehavior . Type . UNLIKE . getCode ()){ isUnlike = true ; } //4.\u67e5\u8be2\u70b9\u8d5e\u884c\u4e3a ApLikesBehavior apLikesBehavior = behaviorFeign . findLikeByArticleIdAndEntryId ( dto . getArticleId (), apBehaviorEntry . getId (), ApLikesBehavior . Type . ARTICLE . getCode ()); if ( apLikesBehavior != null && apLikesBehavior . getOperation () == ApLikesBehavior . Operation . LIKE . getCode ()){ isLike = true ; } //5.\u67e5\u8be2\u6536\u85cf\u884c\u4e3a ApCollection apCollection = apCollectionMapper . selectOne ( Wrappers . < ApCollection > lambdaQuery (). eq ( ApCollection :: getEntryId , apBehaviorEntry . getId ()) . eq ( ApCollection :: getArticleId , dto . getArticleId ()). eq ( ApCollection :: getType , ApCollection . Type . ARTICLE . getCode ())); if ( apCollection != null ){ isCollection = true ; } //6.\u67e5\u8be2\u662f\u5426\u5173\u6ce8 ApAuthor apAuthor = authorMapper . selectById ( dto . getAuthorId ()); if ( apAuthor != null ){ ApUserFollow apUserFollow = userFeign . findByUserIdAndFollowId ( user . getId (), apAuthor . getId ()); if ( apUserFollow != null ){ isFollow = true ; } } //7.\u7ed3\u679c\u8fd4\u56de {\"isfollow\":true,\"islike\":true,\"isunlike\":false,\"iscollection\":true} Map < String , Object > resultMap = new HashMap <> (); resultMap . put ( \"isfollow\" , isFollow ); resultMap . put ( \"islike\" , isLike ); resultMap . put ( \"isunlike\" , isUnlike ); resultMap . put ( \"iscollection\" , isCollection ); return ResponseResult . okResult ( resultMap ); } }","title":"18-\u529f\u80fd\u5b9e\u73b0 15:18"},{"location":"hmtt/day10/#19-_0636","text":"","title":"19-\u6d4b\u8bd5 06:36"},{"location":"hmtt/day11/","text":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 00:51 \u00b6 \u80fd\u591f\u5b8c\u6210\u5bf9mongodb\u7684\u73af\u5883\u642d\u5efa \u80fd\u591f\u638c\u63e1mongodb\u7684\u57fa\u672c\u4f7f\u7528 \u80fd\u591f\u5b8c\u6210app\u7aef\u8bc4\u8bba\u7684\u67e5\u8be2\u3001\u53d1\u8868\u3001\u70b9\u8d5e\u7b49\u529f\u80fd \u80fd\u591f\u5b8c\u6210app\u7aef\u8bc4\u8bba\u56de\u590d\u7684\u67e5\u8be2\uff0c\u53d1\u8868\u3001\u70b9\u8d5e\u529f\u80fd 02-mongodb\u4ecb\u7ecd\u53ca\u5b89\u88c5 04:35 \u00b6 MongoDB\u662f\u4e00\u4e2a\u5f00\u6e90\u3001\u9ad8\u6027\u80fd\u3001\u65e0\u6a21\u5f0f\u7684\u6587\u6863\u578b\u6570\u636e\u5e93 \u5e94\u7528\u573a\u666f\uff1a \u652f\u6301\u6587\u672c\u67e5\u8be2 \u4e0d\u9700\u8981\u652f\u6301\u4e8b\u52a1\uff0c\u4e0d\u5b58\u5728\u590d\u6742\u7684\u591a\u8868\u67e5\u8be2 \u5b58\u50a8\u6570\u636e\u53ef\u6301\u4e45\u5316 \u9700\u8981TB\u751a\u81f3 PB \u7ea7\u522b\u6570\u636e\u5b58\u50a8 \u9700\u6c42\u53d8\u5316\u8f83\u5feb\uff0c\u6570\u636e\u6a21\u578b\u65e0\u6cd5\u786e\u8ba4\uff0c\u9884\u8ba1\u4f7f\u7528\u5feb\u901f\u8fed\u4ee3\u5f00\u53d1\u5f62\u5f0f \u9700\u8981\u81f3\u5c112000\u4ee5\u4e0a\u7684\u8bfb\u5199QPS\u3010\u9ad8\u6027\u80fd\u3011 \u80fd\u652f\u6301\u5feb\u901f\u6c34\u5e73\u6269\u5c55\u3010\u9ad8\u6269\u5c55\u3011 99.999%\u9ad8\u53ef\u7528\u3010\u9ad8\u53ef\u7528\u3011 windows\u4e0b\u5b89\u88c5mongodb\u5e76\u8bbe\u7f6e\u6210\u81ea\u52a8\u542f\u52a8\uff1a \u00b6 \u6267\u884c\u8d44\u6599\u4e2d\u7684mongodb-win32-x86_64-2008plus-ssl-4.0.19-signed.msi\uff0c\u4e00\u8defnext\u5373\u53ef\uff0c\u8fc7\u7a0b\u4e2d\u4f1a\u5e2e\u4f60\u521b\u5efa\u670d\u52a1\u5e76\u4e14\u81ea\u52a8\u542f\u52a8\u3002 03-mongodb\u4e0espringboot\u6574\u5408\u540e\u7684crud 10:26 \u00b6 mongodb\u5df2\u7ecf\u4e0espringboot\u81ea\u52a8\u914d\u7f6e\u505a\u4e86\u6574\u5408\uff0c\u53ea\u9700\u8981\u63d0\u4f9b\u5982\u4e0b\u914d\u7f6e\u5373\u53ef server : port : 9001 spring : application : name : mongo - demo data : mongodb : host : localhost port : 27017 database : leadnews - comment \u4e0d\u7528\u63d0\u4f9b\u81ea\u5df1\u7684\u914d\u7f6e\u7c7b\uff0c\u4e0d\u7528\u5199\uff0c\u4e0d\u7528\u5199\uff0c\u4e0d\u7528\u5199\uff01 04-mongodb\u4e0espringboot\u6574\u5408\u540e\u7684crud2 13:35 \u00b6 package com.itheima.mongodemo.demo ; import com.itheima.mongodemo.demo.pojo.ApComment ; import org.junit.jupiter.api.Test ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.data.domain.PageRequest ; import org.springframework.data.domain.Pageable ; import org.springframework.data.domain.Sort ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; import org.springframework.data.mongodb.core.query.Update ; import org.springframework.test.context.junit4.SpringRunner ; import java.util.List ; @SpringBootTest class DemoApplicationTests { @Autowired private MongoTemplate mongoTemplate ; //\u6dfb\u52a0 @Test public void testCreate () { for ( int i = 0 ; i < 10 ; i ++ ) { ApComment apComment = new ApComment (); apComment . setContent ( \"\u8fd9\u662f\u4e00\u4e2a\u8bc4\u8bba\" ); apComment . setLikes ( 20 + i ); mongoTemplate . insert ( apComment ); } } //\u6dfb\u52a0 \u5728id\u5b57\u6bb5\u4e0a\u6dfb\u52a0@Id\u6ce8\u89e3 @Test public void testCreate2 () { ApComment apComment = new ApComment (); apComment . setId ( \"111\" ); apComment . setContent ( \"\u8fd9\u662f\u4e00\u4e2a\u8bc4\u8bba\" ); apComment . setLikes ( 1 ); mongoTemplate . insert ( apComment ); } //\u67e5\u8be2\u4e00\u4e2a @Test public void testFindOne () { ApComment apComment = mongoTemplate . findById ( \"111\" , ApComment . class ); System . out . println ( apComment ); } //\u6761\u4ef6\u67e5\u8be2 @Test public void testQuery () { // Query query = Query.query(Criteria.where(\"_id\").is(\"5f7012e03ea2da5788227a6f\")); //where likes < 28 Query query = Query . query ( Criteria . where ( \"likes\" ). lt ( 28 )); //order by likes desc query . with ( Sort . by ( Sort . Direction . DESC , \"likes\" )); Pageable pageable = PageRequest . of ( 1 , 3 ); query . with ( pageable ); List < ApComment > apComments = mongoTemplate . find ( query , ApComment . class ); System . out . println ( apComments ); } //\u5220\u9664 @Test public void testDelete (){ mongoTemplate . remove ( Query . query ( Criteria . where ( \"_id\" ). is ( \"5f7012e03ea2da5788227a6f\" )), ApComment . class ); } //\u4fee\u6539 @Test public void testUpdate (){ Query query = Query . query ( Criteria . where ( \"_id\" ). is ( \"5f7015e63ea2da1618d173eb\" )); Update update = new Update (). set ( \"content\" , \"itcast\" ); mongoTemplate . updateMulti ( query , update , ApComment . class ); } } 05-app\u7aef\u8bc4\u8bba-\u53d1\u8868\u8bc4\u8bba 05:47 \u00b6 \u6587\u7ae0\u8be6\u60c5\u9875\u4e0b\u65b9\u53ef\u4ee5\u67e5\u770b\u8bc4\u8bba\u4fe1\u606f\uff0c\u6309\u7167\u70b9\u8d5e\u6570\u91cf\u5012\u5e8f\u6392\u5217\uff0c\u5c55\u793a \u8bc4\u8bba\u5185\u5bb9\u3001\u8bc4\u8bba\u7684\u4f5c\u8005\u3001\u70b9\u8d5e\u6570\u3001\u56de\u590d\u6570\u3001\u65f6\u95f4 \uff0c\u9ed8\u8ba4\u67e5\u770b20\u6761\u8bc4\u8bba\uff0c\u5982\u679c\u60f3\u67e5\u770b\u66f4\u591a\uff0c\u53ef\u4ee5\u70b9\u51fb\u52a0\u8f7d\u66f4\u591a\u8fdb\u884c\u5206\u9875 \u9488\u5bf9\u67d0\u4e2a\u6587\u7ae0\u63d0\u4f9b\u67e5\u8be2\u63a5\u53e3 \u53ef\u4ee5\u9488\u5bf9\u5f53\u524d\u6587\u7ae0\u53d1\u5e03\u8bc4\u8bba \u67e5\u8be2\u8bc4\u8bba\u5217\u8868\u63a5\u53e3 \u53d1\u5e03\u8bc4\u8bba\u63a5\u53e3 \u53ef\u4ee5\u9488\u5bf9\u4e8e\u67d0\u4e00\u6761\u8bc4\u8bba\u8fdb\u884c\u70b9\u8d5e\u64cd\u4f5c \u70b9\u8d5e\u63a5\u53e3 06-\u73af\u5883\u642d\u5efa 07:50 \u00b6 server : port : 9006 spring : autoconfigure : exclude : org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration application : name : leadnews-comment cloud : nacos : discovery : server-addr : localhost:8848 data : mongodb : host : localhost port : 27017 database : leadnews-comment \u4f7f\u7528\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u5c31\u4e0d\u9700\u8981\u96c6\u6210mongodb\u914d\u7f6e\u7c7b 07-\u4fdd\u5b58\u8bc4\u8bba-\u5f00\u53d1 17:06 \u00b6 \u628a\u4e0b\u9762\u7684\u914d\u7f6e\u7c7b\u653e\u5230config\u5305\u4e0b\uff1a package com.heima.comment.config ; import com.github.xiaoymin.knife4j.spring.annotations.EnableKnife4j ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; import org.springframework.context.annotation.Import ; import springfox.bean.validators.configuration.BeanValidatorPluginsConfiguration ; import springfox.documentation.builders.ApiInfoBuilder ; import springfox.documentation.builders.PathSelectors ; import springfox.documentation.builders.RequestHandlerSelectors ; import springfox.documentation.service.ApiInfo ; import springfox.documentation.service.Contact ; import springfox.documentation.spi.DocumentationType ; import springfox.documentation.spring.web.plugins.Docket ; import springfox.documentation.swagger2.annotations.EnableSwagger2 ; @Configuration @EnableSwagger2 @EnableKnife4j @Import ( BeanValidatorPluginsConfiguration . class ) public class SwaggerConfiguration { @Bean public Docket buildDocket () { return new Docket ( DocumentationType . SWAGGER_2 ) . apiInfo ( buildApiInfo ()) . select () // \u8981\u626b\u63cf\u7684API(Controller)\u57fa\u7840\u5305 . apis ( RequestHandlerSelectors . basePackage ( \"com.heima\" )) . paths ( PathSelectors . any ()) . build (); } private ApiInfo buildApiInfo () { Contact contact = new Contact ( \"\u9ed1\u9a6c\u7a0b\u5e8f\u5458\" , \"\" , \"\" ); return new ApiInfoBuilder () . title ( \"\u9ed1\u9a6c\u5934\u6761-\u8bc4\u8bbaAPI\u6587\u6863\" ) . description ( \"\u8bc4\u8bba\u670d\u52a1api\" ) . contact ( contact ) . version ( \"1.0.0\" ). build (); } } \u670d\u52a1\u5c42\u4ee3\u7801: @Override public ResponseResult saveComment ( CommentSaveDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto . getArticleId () == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE ); } if ( dto . getContent () != null && dto . getContent (). length () > 140 ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE , \"\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc7140\u5b57\" ); } //2.\u5224\u65ad\u662f\u5426\u767b\u5f55 ApUser user = AppThreadLocalUtils . getUser (); if ( user == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . NEED_LOGIN ); } //3.\u5b89\u5168\u8fc7\u6ee4,\u81ea\u884c\u5b9e\u73b0 (1.\u654f\u611f\u8bcd\u5ba1\u6838 2.\u963f\u91cc\u4e91\u5185\u5bb9\u5b89\u5168) //4.\u4fdd\u5b58\u8bc4\u8bba //\u8c03\u7528\u8fdc\u7a0b\u63a5\u53e3\uff0c\u6839\u636e\u7528\u6237ID\u83b7\u53d6\u7528\u6237\u4fe1\u606f ApUser apUser = userFeign . findUserById ( user . getId ()); if ( apUser == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE , \"\u5f53\u524d\u767b\u5f55\u4fe1\u606f\u6709\u8bef\" ); } ApComment apComment = new ApComment (); apComment . setAuthorId ( apUser . getId ()); apComment . setAuthorName ( apUser . getName ()); apComment . setContent ( dto . getContent ()); //entryId : 1.\u6587\u7ae0ID 2.\u52a8\u6001ID\uff08\u672a\u505a\uff09 apComment . setEntryId ( dto . getArticleId ()); apComment . setCreatedTime ( new Date ()); apComment . setUpdatedTime ( new Date ()); apComment . setImage ( apUser . getImage ()); apComment . setLikes ( 0 ); apComment . setReply ( 0 ); apComment . setType (( short ) 0 ); apComment . setFlag (( short ) 0 ); mongoTemplate . insert ( apComment ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } 08-\u6d4b\u8bd5 07:19 \u00b6 \u4f7f\u7528\u8001\u5e08\u4e0b\u53d1\u7684postman\u63a5\u53e3\u8fdb\u884c\u6d4b\u8bd5 1.\u542f\u52a8app\u7f51\u5173 2.\u542f\u52a8comment\u3001user\u5fae\u670d\u52a1 3.\u4f7f\u7528postman\u8fdb\u884c\u767b\u5f55\uff0c\u5c06jwt\u590d\u5236\u53d1\u5e03\u8bc4\u8bba\u63a5\u53e3\u7684header\u4e2d\u7684token\u5b57\u6bb5\uff0c\u8c03\u7528\u53d1\u5e03\u8bc4\u8bba\u63a5\u53e3\u8fdb\u884c\u6d4b\u8bd5 09-\u70b9\u8d5e\u8bc4\u8bba 16:57 \u00b6 \u89c6\u9891\u4e2d\u7684\u4ee3\u7801\u5b58\u5728\u91cd\u590d\u70b9\u8d5e\u4e4b\u540e\u91cd\u590d\u63d2\u5165\u70b9\u8d5e\u6570\u636e\u7684\u95ee\u9898\uff0c\u4fee\u590d\u5982\u4e0b\uff1a @Override public ResponseResult like ( CommentLikeDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto . getCommentId () == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE ); } //2.\u5224\u65ad\u662f\u5426\u767b\u5f55 ApUser user = AppThreadLocalUtils . getUser (); if ( user == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . NEED_LOGIN ); } //\u5224\u65ad\u662f\u5426\u91cd\u590d\u70b9\u8d5e //\u5224\u65ad\u662f\u5426\u5df2\u7ecf\u5b58\u5728\u70b9\u8d5e\u6570\u636e Query query = Query . query ( Criteria . where ( \"authorId\" ). is ( user . getId ()). and ( \"commentId\" ). is ( dto . getCommentId ())); ApCommentLike apCommentLike = mongoTemplate . findOne ( query , ApCommentLike . class ); //1.\u5df2\u70b9\u8d5e\uff0c\u518d\u6b21\u70b9\u8d5e //2.\u65e0\u70b9\u8d5e\u6570\u636e\uff0c\u53d6\u6d88\u70b9\u8d5e if (( apCommentLike != null && dto . getOperation () == 0 ) || ( apCommentLike == null && dto . getOperation () == 1 )){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE ); } //3.\u70b9\u8d5e\u64cd\u4f5c ApComment apComment = mongoTemplate . findById ( dto . getCommentId (), ApComment . class ); if ( apComment != null && dto . getOperation () == 0 ) { //\u66f4\u65b0\u8bc4\u8bba\u7684\u70b9\u8d5e\u6570\u91cf apComment . setLikes ( apComment . getLikes () + 1 ); mongoTemplate . save ( apComment ); } else if ( apComment != null && dto . getOperation () == 1 ) { //4.\u53d6\u6d88\u70b9\u8d5e //\u66f4\u65b0\u8bc4\u8bba\u7684\u70b9\u8d5e\u6570\u91cf apComment . setLikes ( Math . max ( 0 , apComment . getLikes () - 1 )); mongoTemplate . save ( apComment ); } if ( dto . getOperation () == 0 ){ //\u70b9\u8d5e apCommentLike = new ApCommentLike (); apCommentLike . setAuthorId ( user . getId ()); apCommentLike . setCommentId ( apComment . getId ()); //\u4fdd\u5b58\u70b9\u8d5e\u6570\u636e apCommentLike . setOperation (( short ) 0 ); mongoTemplate . save ( apCommentLike ); } else { //\u53d6\u6d88\u70b9\u8d5e mongoTemplate . remove ( Query . query ( Criteria . where ( \"authorId\" ). is ( user . getId ()). and ( \"commentId\" ). is ( dto . getCommentId ())), ApCommentLike . class ); } //\u70b9\u8d5e+1 -1 //5.\u6570\u636e\u8fd4\u56de Map < String , Object > resultMap = new HashMap <> (); resultMap . put ( \"likes\" , apComment . getLikes ()); return ResponseResult . okResult ( resultMap ); } 10-\u6d4b\u8bd5 02:44 \u00b6 \u4f7f\u7528\u8001\u5e08\u4e0b\u53d1\u7684postman\u63a5\u53e3\u8fdb\u884c\u6d4b\u8bd5 11-\u52a0\u8f7d\u8bc4\u8bba\u5217\u8868 12:16 \u00b6 12-\u52a0\u8f7d\u8bc4\u8bba\u5217\u88682 09:18 \u00b6 @Override public ResponseResult findByArticleId ( CommentDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto . getArticleId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE ); } if ( dto . getSize () == null || dto . getSize () == 0 || dto . getSize () > 100 ){ dto . setSize ( 20 ); } //2.\u6309\u7167\u6587\u7ae0id\u8fc7\u6ee4\uff0c\u8bbe\u7f6e\u5206\u9875\u548c\u6392\u5e8f Query query = Query . query ( Criteria . where ( \"entryId\" ). is ( dto . getArticleId ()). and ( \"likes\" ). lt ( dto . getMinLikes ())); query . limit ( dto . getSize ()). with ( Sort . by ( Sort . Direction . DESC , \"likes\" )); List < ApComment > list = mongoTemplate . find ( query , ApComment . class ); //3.\u6570\u636e\u5c01\u88c5\u8fd4\u56de //3.1 \u7528\u6237\u672a\u767b\u5f55 \u52a0\u8f7d\u6570\u636e ApUser user = AppThreadLocalUtils . getUser (); if ( user == null ){ return ResponseResult . okResult ( list ); } //3.2 \u7528\u6237\u5df2\u767b\u5f55\uff0c\u52a0\u8f7d\u6570\u636e\uff0c\u9700\u8981\u5224\u65ad\u5f53\u524d\u7528\u6237\u70b9\u8d5e\u4e86\u54ea\u4e9b\u8bc4\u8bba //\u83b7\u53d6\u8bc4\u8bba\u5217\u8868\u4e2d\u7684\u6240\u6709\u6570\u636e\uff0c\u901a\u8fc7map\u65b9\u6cd5\uff0c\u5c06\u6240\u6709\u8bc4\u8bba\u7684id\u751f\u6210\u96c6\u5408 List < String > idList = list . stream (). map ( x -> x . getId ()). collect ( Collectors . toList ()); //\u5728\u8fd9\u4e9b\u8bc4\u8bba\u4e2d\uff0c\u67e5\u8be2\u5f53\u524d\u767b\u5f55\u7528\u6237\u70b9\u8d5e\u8fc7\u7684\u8bc4\u8bba Query query1 = Query . query ( Criteria . where ( \"commentId\" ). in ( idList ). and ( \"authorId\" ). is ( user . getId ()). and ( \"operation\" ). is ( 0 )); List < ApCommentLike > apCommentLikes = mongoTemplate . find ( query1 , ApCommentLike . class ); List < ApCommentVo > resultList = new ArrayList <> (); //\u5c06\u8fd4\u56de\u503c\u7684\u70b9\u8d5e\u8d4b\u503c\uff0c\u5982\u679c\u7528\u6237\u70b9\u8d5e\u8fc7\uff0c\u8d4b\u503c\u4e3a0 if ( apCommentLikes != null ){ //\u4e0d\u7528\u53cc\u91cd\u5faa\u73af\uff0c\u76f4\u63a5\u6784\u5efa\u4e00\u4e2aset\u7528\u4e8e\u67e5\u8be2\u662f\u5426\u70b9\u8d5e\u8fc7 Set < String > commandId = apCommentLikes . stream (). map ( x -> x . getCommentId ()). collect ( Collectors . toSet ()); list . stream (). forEach ( x -> { ApCommentVo apCommentVo = new ApCommentVo (); BeanUtils . copyProperties ( x , apCommentVo ); if ( commandId . contains ( x . getId ())){ apCommentVo . setOperation (( short ) 0 ); } else { apCommentVo . setOperation (( short ) 1 ); } resultList . add ( apCommentVo ); }); // list.stream().forEach(x->{ // ApCommentVo apCommentVo = new ApCommentVo(); // BeanUtils.copyProperties(x,apCommentVo); // for (ApCommentLike apCommentLike : apCommentLikes) { // if(x.getId().equals(apCommentLike.getCommentId())){ // apCommentVo.setOperation((short)0); // break; // } // } // resultList.add(apCommentVo); // }); } return ResponseResult . okResult ( resultList ); } 13-\u6d4b\u8bd5 03:34 \u00b6 \u4f7f\u7528app\u8fdb\u884c\u6d4b\u8bd5 configs/config.js\u4e2d\u7684ip\u4fee\u6539\u4e3a\u672c\u673a const ip = \"localhost\"; 14-\u8bc4\u8bba\u56de\u590d 07:33 \u00b6 1\uff0c\u7528\u6237\u70b9\u51fb \u56de\u590d \uff0c\u6839\u636e\u5f53\u524d\u8bc4\u8bbaid\u67e5\u8be2\u5bf9\u5e94\u7684\u6240\u6709\u56de\u590d\u8fdb\u884c\u5c55\u793a 2\uff0c\u7528\u6237\u9488\u5bf9\u4e8e\u5f53\u524d\u7684\u8bc4\u8bba\u8fdb\u884c\u4e86\u56de\u590d\uff0c\u9700\u8981\u4fdd\u5b58\u6570\u636e\uff0c\u540c\u65f6\u9700\u8981\u66f4\u65b0\u5f53\u524d\u8bc4\u8bba\u7684\u56de\u590d\u6570 3\uff0c\u53ef\u4ee5\u5bf9\u56de\u590d\u5217\u8868\u8fdb\u884c\u70b9\u8d5e\u64cd\u4f5c 15-\u4e1a\u52a1\u5c42 07:34 \u00b6 16-\u4e1a\u52a1\u5c422 07:21 \u00b6 package com.heima.comment.service.impl ; import com.heima.comment.feign.UserFeign ; import com.heima.comment.service.CommentRepayService ; import com.heima.model.comment.dtos.CommentRepayDto ; import com.heima.model.comment.dtos.CommentRepayLikeDto ; import com.heima.model.comment.dtos.CommentRepaySaveDto ; import com.heima.model.comment.pojos.ApComment ; import com.heima.model.comment.pojos.ApCommentLike ; import com.heima.model.comment.pojos.ApCommentRepay ; import com.heima.model.comment.pojos.ApCommentRepayLike ; import com.heima.model.comment.vo.ApCommentRepayVo ; import com.heima.model.comment.vo.ApCommentVo ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.user.pojos.ApUser ; import com.heima.utils.threadlocal.AppThreadLocalUtils ; import lombok.extern.log4j.Log4j2 ; import org.springframework.beans.BeanUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.domain.Sort ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; import org.springframework.stereotype.Service ; import java.util.* ; import java.util.stream.Collectors ; @Service @Log4j2 public class CommentRepayServiceImpl implements CommentRepayService { @Autowired private MongoTemplate mongoTemplate ; @Autowired private UserFeign userFeign ; @Override public ResponseResult loadCommentRepay ( CommentRepayDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto . getCommentId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE ); } if ( dto . getSize () == null || dto . getSize () == 0 ){ dto . setSize ( 20 ); } //2.\u6309\u7167\u6587\u7ae0id\u8fc7\u6ee4\uff0c\u8bbe\u7f6e\u5206\u9875\u548c\u6392\u5e8f Query query = Query . query ( Criteria . where ( \"commentId\" ). is ( dto . getCommentId ()). and ( \"likes\" ). lt ( dto . getMinLikes ())); query . limit ( dto . getSize ()). with ( Sort . by ( Sort . Direction . DESC , \"likes\" )); List < ApCommentRepay > list = mongoTemplate . find ( query , ApCommentRepay . class ); //3.\u6570\u636e\u5c01\u88c5\u8fd4\u56de //3.1 \u7528\u6237\u672a\u767b\u5f55 \u52a0\u8f7d\u6570\u636e ApUser user = AppThreadLocalUtils . getUser (); if ( user == null ){ return ResponseResult . okResult ( list ); } //3.2 \u7528\u6237\u5df2\u767b\u5f55\uff0c\u52a0\u8f7d\u6570\u636e\uff0c\u9700\u8981\u5224\u65ad\u5f53\u524d\u7528\u6237\u70b9\u8d5e\u4e86\u54ea\u4e9b\u8bc4\u8bba List < String > idList = list . stream (). map ( x -> x . getId ()). collect ( Collectors . toList ()); Query query1 = Query . query ( Criteria . where ( \"commentRepayId\" ). in ( idList ). and ( \"authorId\" ). is ( user . getId ())); List < ApCommentRepayLike > apCommentRepayLikes = mongoTemplate . find ( query1 , ApCommentRepayLike . class ); List < ApCommentRepayVo > resultList = new ArrayList <> (); if ( apCommentRepayLikes != null ){ list . stream (). forEach ( x -> { ApCommentRepayVo apCommentRepayVo = new ApCommentRepayVo (); BeanUtils . copyProperties ( x , apCommentRepayVo ); for ( ApCommentRepayLike apCommentRepayLike : apCommentRepayLikes ) { if ( x . getId (). equals ( apCommentRepayLike . getCommentRepayId ())){ apCommentRepayVo . setOperation (( short ) 0 ); break ; } } resultList . add ( apCommentRepayVo ); }); } return ResponseResult . okResult ( resultList ); } @Override public ResponseResult saveCommentRepay ( CommentRepaySaveDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto . getCommentId () == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE ); } if ( dto . getContent () != null && dto . getContent (). length () > 140 ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE , \"\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc7140\u5b57\" ); } //2.\u5224\u65ad\u662f\u5426\u767b\u5f55 ApUser user = AppThreadLocalUtils . getUser (); if ( user == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . NEED_LOGIN ); } //3.\u5b89\u5168\u8fc7\u6ee4,\u81ea\u884c\u5b9e\u73b0 //4.\u4fdd\u5b58\u8bc4\u8bba ApUser apUser = userFeign . findUserById ( user . getId ()); if ( apUser == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE , \"\u5f53\u524d\u767b\u5f55\u4fe1\u606f\u6709\u8bef\" ); } ApCommentRepay apCommentRepay = new ApCommentRepay (); apCommentRepay . setAuthorId ( apUser . getId ()); apCommentRepay . setAuthorName ( apUser . getName ()); apCommentRepay . setContent ( dto . getContent ()); apCommentRepay . setCommentId ( dto . getCommentId ()); apCommentRepay . setCreatedTime ( new Date ()); apCommentRepay . setUpdatedTime ( new Date ()); apCommentRepay . setLikes ( 0 ); mongoTemplate . insert ( apCommentRepay ); //\u66f4\u65b0\u8bc4\u8bba\u7684\u56de\u590d\u6570\u91cf ApComment apComment = mongoTemplate . findById ( dto . getCommentId (), ApComment . class ); apComment . setReply ( apComment . getReply () + 1 ); mongoTemplate . save ( apComment ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } @Override public ResponseResult saveCommentRepayLike ( CommentRepayLikeDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto . getCommentRepayId () == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE ); } //2.\u5224\u65ad\u662f\u5426\u767b\u5f55 ApUser user = AppThreadLocalUtils . getUser (); if ( user == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . NEED_LOGIN ); } //3.\u70b9\u8d5e\u64cd\u4f5c ApCommentRepay apCommentRepay = mongoTemplate . findById ( dto . getCommentRepayId (), ApCommentRepay . class ); if ( apCommentRepay != null && dto . getOperation () == 0 ) { //\u66f4\u65b0\u8bc4\u8bba\u7684\u70b9\u8d5e\u6570\u91cf apCommentRepay . setLikes ( apCommentRepay . getLikes () + 1 ); mongoTemplate . save ( apCommentRepay ); //\u4fdd\u5b58 APP\u8bc4\u8bba\u4fe1\u606f\u70b9\u8d5e ApCommentRepayLike apCommentLike = new ApCommentRepayLike (); apCommentLike . setAuthorId ( user . getId ()); apCommentLike . setCommentRepayId ( apCommentRepay . getId ()); apCommentLike . setOperation ( dto . getOperation ()); mongoTemplate . save ( apCommentLike ); } else if ( apCommentRepay != null && dto . getOperation () == 1 ) { //4.\u53d6\u6d88\u70b9\u8d5e //\u66f4\u65b0\u8bc4\u8bba\u7684\u70b9\u8d5e\u6570\u91cf apCommentRepay . setLikes ( apCommentRepay . getLikes () < 0 ? 0 : apCommentRepay . getLikes () - 1 ); mongoTemplate . save ( apCommentRepay ); //\u66f4\u65b0 APP\u8bc4\u8bba\u4fe1\u606f\u70b9\u8d5e Query query = Query . query ( Criteria . where ( \"authorId\" ). is ( user . getId ()). and ( \"commentRepayId\" ). is ( apCommentRepay . getId ())); ApCommentRepayLike apCommentLike = mongoTemplate . findOne ( query , ApCommentRepayLike . class ); apCommentLike . setOperation ( dto . getOperation ()); mongoTemplate . save ( apCommentLike ); } //5.\u6570\u636e\u8fd4\u56de Map < String , Object > resultMap = new HashMap <> (); resultMap . put ( \"likes\" , apCommentRepay . getLikes ()); return ResponseResult . okResult ( resultMap ); } }","title":"day11"},{"location":"hmtt/day11/#01-_0051","text":"\u80fd\u591f\u5b8c\u6210\u5bf9mongodb\u7684\u73af\u5883\u642d\u5efa \u80fd\u591f\u638c\u63e1mongodb\u7684\u57fa\u672c\u4f7f\u7528 \u80fd\u591f\u5b8c\u6210app\u7aef\u8bc4\u8bba\u7684\u67e5\u8be2\u3001\u53d1\u8868\u3001\u70b9\u8d5e\u7b49\u529f\u80fd \u80fd\u591f\u5b8c\u6210app\u7aef\u8bc4\u8bba\u56de\u590d\u7684\u67e5\u8be2\uff0c\u53d1\u8868\u3001\u70b9\u8d5e\u529f\u80fd","title":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 00:51"},{"location":"hmtt/day11/#02-mongodb_0435","text":"MongoDB\u662f\u4e00\u4e2a\u5f00\u6e90\u3001\u9ad8\u6027\u80fd\u3001\u65e0\u6a21\u5f0f\u7684\u6587\u6863\u578b\u6570\u636e\u5e93 \u5e94\u7528\u573a\u666f\uff1a \u652f\u6301\u6587\u672c\u67e5\u8be2 \u4e0d\u9700\u8981\u652f\u6301\u4e8b\u52a1\uff0c\u4e0d\u5b58\u5728\u590d\u6742\u7684\u591a\u8868\u67e5\u8be2 \u5b58\u50a8\u6570\u636e\u53ef\u6301\u4e45\u5316 \u9700\u8981TB\u751a\u81f3 PB \u7ea7\u522b\u6570\u636e\u5b58\u50a8 \u9700\u6c42\u53d8\u5316\u8f83\u5feb\uff0c\u6570\u636e\u6a21\u578b\u65e0\u6cd5\u786e\u8ba4\uff0c\u9884\u8ba1\u4f7f\u7528\u5feb\u901f\u8fed\u4ee3\u5f00\u53d1\u5f62\u5f0f \u9700\u8981\u81f3\u5c112000\u4ee5\u4e0a\u7684\u8bfb\u5199QPS\u3010\u9ad8\u6027\u80fd\u3011 \u80fd\u652f\u6301\u5feb\u901f\u6c34\u5e73\u6269\u5c55\u3010\u9ad8\u6269\u5c55\u3011 99.999%\u9ad8\u53ef\u7528\u3010\u9ad8\u53ef\u7528\u3011","title":"02-mongodb\u4ecb\u7ecd\u53ca\u5b89\u88c5 04:35"},{"location":"hmtt/day11/#windowsmongodb","text":"\u6267\u884c\u8d44\u6599\u4e2d\u7684mongodb-win32-x86_64-2008plus-ssl-4.0.19-signed.msi\uff0c\u4e00\u8defnext\u5373\u53ef\uff0c\u8fc7\u7a0b\u4e2d\u4f1a\u5e2e\u4f60\u521b\u5efa\u670d\u52a1\u5e76\u4e14\u81ea\u52a8\u542f\u52a8\u3002","title":"windows\u4e0b\u5b89\u88c5mongodb\u5e76\u8bbe\u7f6e\u6210\u81ea\u52a8\u542f\u52a8\uff1a"},{"location":"hmtt/day11/#03-mongodbspringbootcrud_1026","text":"mongodb\u5df2\u7ecf\u4e0espringboot\u81ea\u52a8\u914d\u7f6e\u505a\u4e86\u6574\u5408\uff0c\u53ea\u9700\u8981\u63d0\u4f9b\u5982\u4e0b\u914d\u7f6e\u5373\u53ef server : port : 9001 spring : application : name : mongo - demo data : mongodb : host : localhost port : 27017 database : leadnews - comment \u4e0d\u7528\u63d0\u4f9b\u81ea\u5df1\u7684\u914d\u7f6e\u7c7b\uff0c\u4e0d\u7528\u5199\uff0c\u4e0d\u7528\u5199\uff0c\u4e0d\u7528\u5199\uff01","title":"03-mongodb\u4e0espringboot\u6574\u5408\u540e\u7684crud  10:26"},{"location":"hmtt/day11/#04-mongodbspringbootcrud2_1335","text":"package com.itheima.mongodemo.demo ; import com.itheima.mongodemo.demo.pojo.ApComment ; import org.junit.jupiter.api.Test ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.data.domain.PageRequest ; import org.springframework.data.domain.Pageable ; import org.springframework.data.domain.Sort ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; import org.springframework.data.mongodb.core.query.Update ; import org.springframework.test.context.junit4.SpringRunner ; import java.util.List ; @SpringBootTest class DemoApplicationTests { @Autowired private MongoTemplate mongoTemplate ; //\u6dfb\u52a0 @Test public void testCreate () { for ( int i = 0 ; i < 10 ; i ++ ) { ApComment apComment = new ApComment (); apComment . setContent ( \"\u8fd9\u662f\u4e00\u4e2a\u8bc4\u8bba\" ); apComment . setLikes ( 20 + i ); mongoTemplate . insert ( apComment ); } } //\u6dfb\u52a0 \u5728id\u5b57\u6bb5\u4e0a\u6dfb\u52a0@Id\u6ce8\u89e3 @Test public void testCreate2 () { ApComment apComment = new ApComment (); apComment . setId ( \"111\" ); apComment . setContent ( \"\u8fd9\u662f\u4e00\u4e2a\u8bc4\u8bba\" ); apComment . setLikes ( 1 ); mongoTemplate . insert ( apComment ); } //\u67e5\u8be2\u4e00\u4e2a @Test public void testFindOne () { ApComment apComment = mongoTemplate . findById ( \"111\" , ApComment . class ); System . out . println ( apComment ); } //\u6761\u4ef6\u67e5\u8be2 @Test public void testQuery () { // Query query = Query.query(Criteria.where(\"_id\").is(\"5f7012e03ea2da5788227a6f\")); //where likes < 28 Query query = Query . query ( Criteria . where ( \"likes\" ). lt ( 28 )); //order by likes desc query . with ( Sort . by ( Sort . Direction . DESC , \"likes\" )); Pageable pageable = PageRequest . of ( 1 , 3 ); query . with ( pageable ); List < ApComment > apComments = mongoTemplate . find ( query , ApComment . class ); System . out . println ( apComments ); } //\u5220\u9664 @Test public void testDelete (){ mongoTemplate . remove ( Query . query ( Criteria . where ( \"_id\" ). is ( \"5f7012e03ea2da5788227a6f\" )), ApComment . class ); } //\u4fee\u6539 @Test public void testUpdate (){ Query query = Query . query ( Criteria . where ( \"_id\" ). is ( \"5f7015e63ea2da1618d173eb\" )); Update update = new Update (). set ( \"content\" , \"itcast\" ); mongoTemplate . updateMulti ( query , update , ApComment . class ); } }","title":"04-mongodb\u4e0espringboot\u6574\u5408\u540e\u7684crud2  13:35"},{"location":"hmtt/day11/#05-app-_0547","text":"\u6587\u7ae0\u8be6\u60c5\u9875\u4e0b\u65b9\u53ef\u4ee5\u67e5\u770b\u8bc4\u8bba\u4fe1\u606f\uff0c\u6309\u7167\u70b9\u8d5e\u6570\u91cf\u5012\u5e8f\u6392\u5217\uff0c\u5c55\u793a \u8bc4\u8bba\u5185\u5bb9\u3001\u8bc4\u8bba\u7684\u4f5c\u8005\u3001\u70b9\u8d5e\u6570\u3001\u56de\u590d\u6570\u3001\u65f6\u95f4 \uff0c\u9ed8\u8ba4\u67e5\u770b20\u6761\u8bc4\u8bba\uff0c\u5982\u679c\u60f3\u67e5\u770b\u66f4\u591a\uff0c\u53ef\u4ee5\u70b9\u51fb\u52a0\u8f7d\u66f4\u591a\u8fdb\u884c\u5206\u9875 \u9488\u5bf9\u67d0\u4e2a\u6587\u7ae0\u63d0\u4f9b\u67e5\u8be2\u63a5\u53e3 \u53ef\u4ee5\u9488\u5bf9\u5f53\u524d\u6587\u7ae0\u53d1\u5e03\u8bc4\u8bba \u67e5\u8be2\u8bc4\u8bba\u5217\u8868\u63a5\u53e3 \u53d1\u5e03\u8bc4\u8bba\u63a5\u53e3 \u53ef\u4ee5\u9488\u5bf9\u4e8e\u67d0\u4e00\u6761\u8bc4\u8bba\u8fdb\u884c\u70b9\u8d5e\u64cd\u4f5c \u70b9\u8d5e\u63a5\u53e3","title":"05-app\u7aef\u8bc4\u8bba-\u53d1\u8868\u8bc4\u8bba 05:47"},{"location":"hmtt/day11/#06-_0750","text":"server : port : 9006 spring : autoconfigure : exclude : org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration application : name : leadnews-comment cloud : nacos : discovery : server-addr : localhost:8848 data : mongodb : host : localhost port : 27017 database : leadnews-comment \u4f7f\u7528\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u5c31\u4e0d\u9700\u8981\u96c6\u6210mongodb\u914d\u7f6e\u7c7b","title":"06-\u73af\u5883\u642d\u5efa 07:50"},{"location":"hmtt/day11/#07--_1706","text":"\u628a\u4e0b\u9762\u7684\u914d\u7f6e\u7c7b\u653e\u5230config\u5305\u4e0b\uff1a package com.heima.comment.config ; import com.github.xiaoymin.knife4j.spring.annotations.EnableKnife4j ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; import org.springframework.context.annotation.Import ; import springfox.bean.validators.configuration.BeanValidatorPluginsConfiguration ; import springfox.documentation.builders.ApiInfoBuilder ; import springfox.documentation.builders.PathSelectors ; import springfox.documentation.builders.RequestHandlerSelectors ; import springfox.documentation.service.ApiInfo ; import springfox.documentation.service.Contact ; import springfox.documentation.spi.DocumentationType ; import springfox.documentation.spring.web.plugins.Docket ; import springfox.documentation.swagger2.annotations.EnableSwagger2 ; @Configuration @EnableSwagger2 @EnableKnife4j @Import ( BeanValidatorPluginsConfiguration . class ) public class SwaggerConfiguration { @Bean public Docket buildDocket () { return new Docket ( DocumentationType . SWAGGER_2 ) . apiInfo ( buildApiInfo ()) . select () // \u8981\u626b\u63cf\u7684API(Controller)\u57fa\u7840\u5305 . apis ( RequestHandlerSelectors . basePackage ( \"com.heima\" )) . paths ( PathSelectors . any ()) . build (); } private ApiInfo buildApiInfo () { Contact contact = new Contact ( \"\u9ed1\u9a6c\u7a0b\u5e8f\u5458\" , \"\" , \"\" ); return new ApiInfoBuilder () . title ( \"\u9ed1\u9a6c\u5934\u6761-\u8bc4\u8bbaAPI\u6587\u6863\" ) . description ( \"\u8bc4\u8bba\u670d\u52a1api\" ) . contact ( contact ) . version ( \"1.0.0\" ). build (); } } \u670d\u52a1\u5c42\u4ee3\u7801: @Override public ResponseResult saveComment ( CommentSaveDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto . getArticleId () == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE ); } if ( dto . getContent () != null && dto . getContent (). length () > 140 ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE , \"\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc7140\u5b57\" ); } //2.\u5224\u65ad\u662f\u5426\u767b\u5f55 ApUser user = AppThreadLocalUtils . getUser (); if ( user == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . NEED_LOGIN ); } //3.\u5b89\u5168\u8fc7\u6ee4,\u81ea\u884c\u5b9e\u73b0 (1.\u654f\u611f\u8bcd\u5ba1\u6838 2.\u963f\u91cc\u4e91\u5185\u5bb9\u5b89\u5168) //4.\u4fdd\u5b58\u8bc4\u8bba //\u8c03\u7528\u8fdc\u7a0b\u63a5\u53e3\uff0c\u6839\u636e\u7528\u6237ID\u83b7\u53d6\u7528\u6237\u4fe1\u606f ApUser apUser = userFeign . findUserById ( user . getId ()); if ( apUser == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE , \"\u5f53\u524d\u767b\u5f55\u4fe1\u606f\u6709\u8bef\" ); } ApComment apComment = new ApComment (); apComment . setAuthorId ( apUser . getId ()); apComment . setAuthorName ( apUser . getName ()); apComment . setContent ( dto . getContent ()); //entryId : 1.\u6587\u7ae0ID 2.\u52a8\u6001ID\uff08\u672a\u505a\uff09 apComment . setEntryId ( dto . getArticleId ()); apComment . setCreatedTime ( new Date ()); apComment . setUpdatedTime ( new Date ()); apComment . setImage ( apUser . getImage ()); apComment . setLikes ( 0 ); apComment . setReply ( 0 ); apComment . setType (( short ) 0 ); apComment . setFlag (( short ) 0 ); mongoTemplate . insert ( apComment ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); }","title":"07-\u4fdd\u5b58\u8bc4\u8bba-\u5f00\u53d1 17:06"},{"location":"hmtt/day11/#08-_0719","text":"\u4f7f\u7528\u8001\u5e08\u4e0b\u53d1\u7684postman\u63a5\u53e3\u8fdb\u884c\u6d4b\u8bd5 1.\u542f\u52a8app\u7f51\u5173 2.\u542f\u52a8comment\u3001user\u5fae\u670d\u52a1 3.\u4f7f\u7528postman\u8fdb\u884c\u767b\u5f55\uff0c\u5c06jwt\u590d\u5236\u53d1\u5e03\u8bc4\u8bba\u63a5\u53e3\u7684header\u4e2d\u7684token\u5b57\u6bb5\uff0c\u8c03\u7528\u53d1\u5e03\u8bc4\u8bba\u63a5\u53e3\u8fdb\u884c\u6d4b\u8bd5","title":"08-\u6d4b\u8bd5 07:19"},{"location":"hmtt/day11/#09-_1657","text":"\u89c6\u9891\u4e2d\u7684\u4ee3\u7801\u5b58\u5728\u91cd\u590d\u70b9\u8d5e\u4e4b\u540e\u91cd\u590d\u63d2\u5165\u70b9\u8d5e\u6570\u636e\u7684\u95ee\u9898\uff0c\u4fee\u590d\u5982\u4e0b\uff1a @Override public ResponseResult like ( CommentLikeDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto . getCommentId () == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE ); } //2.\u5224\u65ad\u662f\u5426\u767b\u5f55 ApUser user = AppThreadLocalUtils . getUser (); if ( user == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . NEED_LOGIN ); } //\u5224\u65ad\u662f\u5426\u91cd\u590d\u70b9\u8d5e //\u5224\u65ad\u662f\u5426\u5df2\u7ecf\u5b58\u5728\u70b9\u8d5e\u6570\u636e Query query = Query . query ( Criteria . where ( \"authorId\" ). is ( user . getId ()). and ( \"commentId\" ). is ( dto . getCommentId ())); ApCommentLike apCommentLike = mongoTemplate . findOne ( query , ApCommentLike . class ); //1.\u5df2\u70b9\u8d5e\uff0c\u518d\u6b21\u70b9\u8d5e //2.\u65e0\u70b9\u8d5e\u6570\u636e\uff0c\u53d6\u6d88\u70b9\u8d5e if (( apCommentLike != null && dto . getOperation () == 0 ) || ( apCommentLike == null && dto . getOperation () == 1 )){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE ); } //3.\u70b9\u8d5e\u64cd\u4f5c ApComment apComment = mongoTemplate . findById ( dto . getCommentId (), ApComment . class ); if ( apComment != null && dto . getOperation () == 0 ) { //\u66f4\u65b0\u8bc4\u8bba\u7684\u70b9\u8d5e\u6570\u91cf apComment . setLikes ( apComment . getLikes () + 1 ); mongoTemplate . save ( apComment ); } else if ( apComment != null && dto . getOperation () == 1 ) { //4.\u53d6\u6d88\u70b9\u8d5e //\u66f4\u65b0\u8bc4\u8bba\u7684\u70b9\u8d5e\u6570\u91cf apComment . setLikes ( Math . max ( 0 , apComment . getLikes () - 1 )); mongoTemplate . save ( apComment ); } if ( dto . getOperation () == 0 ){ //\u70b9\u8d5e apCommentLike = new ApCommentLike (); apCommentLike . setAuthorId ( user . getId ()); apCommentLike . setCommentId ( apComment . getId ()); //\u4fdd\u5b58\u70b9\u8d5e\u6570\u636e apCommentLike . setOperation (( short ) 0 ); mongoTemplate . save ( apCommentLike ); } else { //\u53d6\u6d88\u70b9\u8d5e mongoTemplate . remove ( Query . query ( Criteria . where ( \"authorId\" ). is ( user . getId ()). and ( \"commentId\" ). is ( dto . getCommentId ())), ApCommentLike . class ); } //\u70b9\u8d5e+1 -1 //5.\u6570\u636e\u8fd4\u56de Map < String , Object > resultMap = new HashMap <> (); resultMap . put ( \"likes\" , apComment . getLikes ()); return ResponseResult . okResult ( resultMap ); }","title":"09-\u70b9\u8d5e\u8bc4\u8bba 16:57"},{"location":"hmtt/day11/#10-_0244","text":"\u4f7f\u7528\u8001\u5e08\u4e0b\u53d1\u7684postman\u63a5\u53e3\u8fdb\u884c\u6d4b\u8bd5","title":"10-\u6d4b\u8bd5 02:44"},{"location":"hmtt/day11/#11-_1216","text":"","title":"11-\u52a0\u8f7d\u8bc4\u8bba\u5217\u8868 12:16"},{"location":"hmtt/day11/#12-2_0918","text":"@Override public ResponseResult findByArticleId ( CommentDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto . getArticleId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE ); } if ( dto . getSize () == null || dto . getSize () == 0 || dto . getSize () > 100 ){ dto . setSize ( 20 ); } //2.\u6309\u7167\u6587\u7ae0id\u8fc7\u6ee4\uff0c\u8bbe\u7f6e\u5206\u9875\u548c\u6392\u5e8f Query query = Query . query ( Criteria . where ( \"entryId\" ). is ( dto . getArticleId ()). and ( \"likes\" ). lt ( dto . getMinLikes ())); query . limit ( dto . getSize ()). with ( Sort . by ( Sort . Direction . DESC , \"likes\" )); List < ApComment > list = mongoTemplate . find ( query , ApComment . class ); //3.\u6570\u636e\u5c01\u88c5\u8fd4\u56de //3.1 \u7528\u6237\u672a\u767b\u5f55 \u52a0\u8f7d\u6570\u636e ApUser user = AppThreadLocalUtils . getUser (); if ( user == null ){ return ResponseResult . okResult ( list ); } //3.2 \u7528\u6237\u5df2\u767b\u5f55\uff0c\u52a0\u8f7d\u6570\u636e\uff0c\u9700\u8981\u5224\u65ad\u5f53\u524d\u7528\u6237\u70b9\u8d5e\u4e86\u54ea\u4e9b\u8bc4\u8bba //\u83b7\u53d6\u8bc4\u8bba\u5217\u8868\u4e2d\u7684\u6240\u6709\u6570\u636e\uff0c\u901a\u8fc7map\u65b9\u6cd5\uff0c\u5c06\u6240\u6709\u8bc4\u8bba\u7684id\u751f\u6210\u96c6\u5408 List < String > idList = list . stream (). map ( x -> x . getId ()). collect ( Collectors . toList ()); //\u5728\u8fd9\u4e9b\u8bc4\u8bba\u4e2d\uff0c\u67e5\u8be2\u5f53\u524d\u767b\u5f55\u7528\u6237\u70b9\u8d5e\u8fc7\u7684\u8bc4\u8bba Query query1 = Query . query ( Criteria . where ( \"commentId\" ). in ( idList ). and ( \"authorId\" ). is ( user . getId ()). and ( \"operation\" ). is ( 0 )); List < ApCommentLike > apCommentLikes = mongoTemplate . find ( query1 , ApCommentLike . class ); List < ApCommentVo > resultList = new ArrayList <> (); //\u5c06\u8fd4\u56de\u503c\u7684\u70b9\u8d5e\u8d4b\u503c\uff0c\u5982\u679c\u7528\u6237\u70b9\u8d5e\u8fc7\uff0c\u8d4b\u503c\u4e3a0 if ( apCommentLikes != null ){ //\u4e0d\u7528\u53cc\u91cd\u5faa\u73af\uff0c\u76f4\u63a5\u6784\u5efa\u4e00\u4e2aset\u7528\u4e8e\u67e5\u8be2\u662f\u5426\u70b9\u8d5e\u8fc7 Set < String > commandId = apCommentLikes . stream (). map ( x -> x . getCommentId ()). collect ( Collectors . toSet ()); list . stream (). forEach ( x -> { ApCommentVo apCommentVo = new ApCommentVo (); BeanUtils . copyProperties ( x , apCommentVo ); if ( commandId . contains ( x . getId ())){ apCommentVo . setOperation (( short ) 0 ); } else { apCommentVo . setOperation (( short ) 1 ); } resultList . add ( apCommentVo ); }); // list.stream().forEach(x->{ // ApCommentVo apCommentVo = new ApCommentVo(); // BeanUtils.copyProperties(x,apCommentVo); // for (ApCommentLike apCommentLike : apCommentLikes) { // if(x.getId().equals(apCommentLike.getCommentId())){ // apCommentVo.setOperation((short)0); // break; // } // } // resultList.add(apCommentVo); // }); } return ResponseResult . okResult ( resultList ); }","title":"12-\u52a0\u8f7d\u8bc4\u8bba\u5217\u88682 09:18"},{"location":"hmtt/day11/#13-_0334","text":"\u4f7f\u7528app\u8fdb\u884c\u6d4b\u8bd5 configs/config.js\u4e2d\u7684ip\u4fee\u6539\u4e3a\u672c\u673a const ip = \"localhost\";","title":"13-\u6d4b\u8bd5 03:34"},{"location":"hmtt/day11/#14-_0733","text":"1\uff0c\u7528\u6237\u70b9\u51fb \u56de\u590d \uff0c\u6839\u636e\u5f53\u524d\u8bc4\u8bbaid\u67e5\u8be2\u5bf9\u5e94\u7684\u6240\u6709\u56de\u590d\u8fdb\u884c\u5c55\u793a 2\uff0c\u7528\u6237\u9488\u5bf9\u4e8e\u5f53\u524d\u7684\u8bc4\u8bba\u8fdb\u884c\u4e86\u56de\u590d\uff0c\u9700\u8981\u4fdd\u5b58\u6570\u636e\uff0c\u540c\u65f6\u9700\u8981\u66f4\u65b0\u5f53\u524d\u8bc4\u8bba\u7684\u56de\u590d\u6570 3\uff0c\u53ef\u4ee5\u5bf9\u56de\u590d\u5217\u8868\u8fdb\u884c\u70b9\u8d5e\u64cd\u4f5c","title":"14-\u8bc4\u8bba\u56de\u590d  07:33"},{"location":"hmtt/day11/#15-_0734","text":"","title":"15-\u4e1a\u52a1\u5c42 07:34"},{"location":"hmtt/day11/#16-2_0721","text":"package com.heima.comment.service.impl ; import com.heima.comment.feign.UserFeign ; import com.heima.comment.service.CommentRepayService ; import com.heima.model.comment.dtos.CommentRepayDto ; import com.heima.model.comment.dtos.CommentRepayLikeDto ; import com.heima.model.comment.dtos.CommentRepaySaveDto ; import com.heima.model.comment.pojos.ApComment ; import com.heima.model.comment.pojos.ApCommentLike ; import com.heima.model.comment.pojos.ApCommentRepay ; import com.heima.model.comment.pojos.ApCommentRepayLike ; import com.heima.model.comment.vo.ApCommentRepayVo ; import com.heima.model.comment.vo.ApCommentVo ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.user.pojos.ApUser ; import com.heima.utils.threadlocal.AppThreadLocalUtils ; import lombok.extern.log4j.Log4j2 ; import org.springframework.beans.BeanUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.domain.Sort ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; import org.springframework.stereotype.Service ; import java.util.* ; import java.util.stream.Collectors ; @Service @Log4j2 public class CommentRepayServiceImpl implements CommentRepayService { @Autowired private MongoTemplate mongoTemplate ; @Autowired private UserFeign userFeign ; @Override public ResponseResult loadCommentRepay ( CommentRepayDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto . getCommentId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE ); } if ( dto . getSize () == null || dto . getSize () == 0 ){ dto . setSize ( 20 ); } //2.\u6309\u7167\u6587\u7ae0id\u8fc7\u6ee4\uff0c\u8bbe\u7f6e\u5206\u9875\u548c\u6392\u5e8f Query query = Query . query ( Criteria . where ( \"commentId\" ). is ( dto . getCommentId ()). and ( \"likes\" ). lt ( dto . getMinLikes ())); query . limit ( dto . getSize ()). with ( Sort . by ( Sort . Direction . DESC , \"likes\" )); List < ApCommentRepay > list = mongoTemplate . find ( query , ApCommentRepay . class ); //3.\u6570\u636e\u5c01\u88c5\u8fd4\u56de //3.1 \u7528\u6237\u672a\u767b\u5f55 \u52a0\u8f7d\u6570\u636e ApUser user = AppThreadLocalUtils . getUser (); if ( user == null ){ return ResponseResult . okResult ( list ); } //3.2 \u7528\u6237\u5df2\u767b\u5f55\uff0c\u52a0\u8f7d\u6570\u636e\uff0c\u9700\u8981\u5224\u65ad\u5f53\u524d\u7528\u6237\u70b9\u8d5e\u4e86\u54ea\u4e9b\u8bc4\u8bba List < String > idList = list . stream (). map ( x -> x . getId ()). collect ( Collectors . toList ()); Query query1 = Query . query ( Criteria . where ( \"commentRepayId\" ). in ( idList ). and ( \"authorId\" ). is ( user . getId ())); List < ApCommentRepayLike > apCommentRepayLikes = mongoTemplate . find ( query1 , ApCommentRepayLike . class ); List < ApCommentRepayVo > resultList = new ArrayList <> (); if ( apCommentRepayLikes != null ){ list . stream (). forEach ( x -> { ApCommentRepayVo apCommentRepayVo = new ApCommentRepayVo (); BeanUtils . copyProperties ( x , apCommentRepayVo ); for ( ApCommentRepayLike apCommentRepayLike : apCommentRepayLikes ) { if ( x . getId (). equals ( apCommentRepayLike . getCommentRepayId ())){ apCommentRepayVo . setOperation (( short ) 0 ); break ; } } resultList . add ( apCommentRepayVo ); }); } return ResponseResult . okResult ( resultList ); } @Override public ResponseResult saveCommentRepay ( CommentRepaySaveDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto . getCommentId () == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE ); } if ( dto . getContent () != null && dto . getContent (). length () > 140 ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE , \"\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc7140\u5b57\" ); } //2.\u5224\u65ad\u662f\u5426\u767b\u5f55 ApUser user = AppThreadLocalUtils . getUser (); if ( user == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . NEED_LOGIN ); } //3.\u5b89\u5168\u8fc7\u6ee4,\u81ea\u884c\u5b9e\u73b0 //4.\u4fdd\u5b58\u8bc4\u8bba ApUser apUser = userFeign . findUserById ( user . getId ()); if ( apUser == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE , \"\u5f53\u524d\u767b\u5f55\u4fe1\u606f\u6709\u8bef\" ); } ApCommentRepay apCommentRepay = new ApCommentRepay (); apCommentRepay . setAuthorId ( apUser . getId ()); apCommentRepay . setAuthorName ( apUser . getName ()); apCommentRepay . setContent ( dto . getContent ()); apCommentRepay . setCommentId ( dto . getCommentId ()); apCommentRepay . setCreatedTime ( new Date ()); apCommentRepay . setUpdatedTime ( new Date ()); apCommentRepay . setLikes ( 0 ); mongoTemplate . insert ( apCommentRepay ); //\u66f4\u65b0\u8bc4\u8bba\u7684\u56de\u590d\u6570\u91cf ApComment apComment = mongoTemplate . findById ( dto . getCommentId (), ApComment . class ); apComment . setReply ( apComment . getReply () + 1 ); mongoTemplate . save ( apComment ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } @Override public ResponseResult saveCommentRepayLike ( CommentRepayLikeDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto . getCommentRepayId () == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE ); } //2.\u5224\u65ad\u662f\u5426\u767b\u5f55 ApUser user = AppThreadLocalUtils . getUser (); if ( user == null ) { return ResponseResult . errorResult ( AppHttpCodeEnum . NEED_LOGIN ); } //3.\u70b9\u8d5e\u64cd\u4f5c ApCommentRepay apCommentRepay = mongoTemplate . findById ( dto . getCommentRepayId (), ApCommentRepay . class ); if ( apCommentRepay != null && dto . getOperation () == 0 ) { //\u66f4\u65b0\u8bc4\u8bba\u7684\u70b9\u8d5e\u6570\u91cf apCommentRepay . setLikes ( apCommentRepay . getLikes () + 1 ); mongoTemplate . save ( apCommentRepay ); //\u4fdd\u5b58 APP\u8bc4\u8bba\u4fe1\u606f\u70b9\u8d5e ApCommentRepayLike apCommentLike = new ApCommentRepayLike (); apCommentLike . setAuthorId ( user . getId ()); apCommentLike . setCommentRepayId ( apCommentRepay . getId ()); apCommentLike . setOperation ( dto . getOperation ()); mongoTemplate . save ( apCommentLike ); } else if ( apCommentRepay != null && dto . getOperation () == 1 ) { //4.\u53d6\u6d88\u70b9\u8d5e //\u66f4\u65b0\u8bc4\u8bba\u7684\u70b9\u8d5e\u6570\u91cf apCommentRepay . setLikes ( apCommentRepay . getLikes () < 0 ? 0 : apCommentRepay . getLikes () - 1 ); mongoTemplate . save ( apCommentRepay ); //\u66f4\u65b0 APP\u8bc4\u8bba\u4fe1\u606f\u70b9\u8d5e Query query = Query . query ( Criteria . where ( \"authorId\" ). is ( user . getId ()). and ( \"commentRepayId\" ). is ( apCommentRepay . getId ())); ApCommentRepayLike apCommentLike = mongoTemplate . findOne ( query , ApCommentRepayLike . class ); apCommentLike . setOperation ( dto . getOperation ()); mongoTemplate . save ( apCommentLike ); } //5.\u6570\u636e\u8fd4\u56de Map < String , Object > resultMap = new HashMap <> (); resultMap . put ( \"likes\" , apCommentRepay . getLikes ()); return ResponseResult . okResult ( resultMap ); } }","title":"16-\u4e1a\u52a1\u5c422  07:21"},{"location":"hmtt/day12/","text":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 01:07 \u00b6 \u80fd\u591f\u719f\u6089docker\u642d\u5efaElasticSearch\u7684\u73af\u5883 \u80fd\u591f\u638c\u63e1\u521b\u5efa\u7d22\u5f15\u7684\u601d\u8def \u80fd\u591f\u5b8c\u6210app\u7aef\u6587\u7ae0\u7684\u641c\u7d22 \u80fd\u591f\u5b8c\u6210app\u7aef\u641c\u7d22\u8bb0\u5f55\u7684\u7ba1\u7406 \u80fd\u591f\u5b8c\u6210\u641c\u7d22\u5173\u952e\u8bcd\u7684\u8054\u60f3\u529f\u80fd 02-docker\u5b89\u88c5es\u73af\u5883 07:04 \u00b6 03-docker\u5b89\u88c5kibana\u73af\u5883 04:07 \u00b6 \u4f7f\u7528windows\u4e0b\u7684es\u8fdb\u884c\u5b89\u88c5\uff0c\u8be6\u89c1es\u8bfe\u7a0b\u4e2d\u7684windows\u5b89\u88c5\u8bf4\u660e ELK ELASTIC-SEARCH(\u67e5\u8be2) LOGSTASH\uff08\u6570\u636e\u91c7\u96c6\uff09 KIBANA\uff08\u5c55\u793a\uff09 04-\u6587\u7ae0\u641c\u7d22 \u9700\u6c42\u5206\u6790\u53ca\u521b\u5efa\u7d22\u5f15 04:29 \u00b6 \u5b9e\u73b0\u601d\u8def \u9700\u8981\u628a\u6587\u7ae0\u76f8\u5173\u7684\u6570\u636e\u5b58\u50a8\u5230es\u7d22\u5f15\u5e93\u4e2d \u5728\u641c\u7d22\u5fae\u670d\u52a1\u4e2d\u8fdb\u884c\u68c0\u7d22\uff0c\u67e5\u8be2\u7684\u662fes\u5e93\uff0c\u5c55\u793a\u6587\u7ae0\u5217\u8868\uff0c\u9700\u8981\u6839\u636e\u5173\u952e\u5b57\u8fdb\u884c\u67e5\u8be2 \u5728\u641c\u7d22\u7684\u65f6\u5019\uff0c\u7528\u6237\u8f93\u5165\u4e86\u5173\u952e\u5b57\uff0c\u9700\u8981\u5bf9\u5f53\u524d\u7528\u6237\u8bb0\u5f55\u641c\u7d22\u5386\u53f2 PUT app_i nf o_ar t icle { \"mappings\" :{ \"properties\" :{ \"id\" :{ \"type\" : \"text\" }, \"publishTime\" :{ \"type\" : \"date\" }, \"layout\" :{ \"type\" : \"short\" }, \"images\" :{ \"type\" : \"text\" }, \"authorId\" : { \"type\" : \"integer\" }, \"title\" :{ \"type\" : \"text\" , \"analyzer\" : \"ik_smart\" }, \"content\" :{ \"type\" : \"text\" , \"analyzer\" : \"ik_smart\" } } } } title.keyword\u5b57\u6bb5\u662ftitle\u7684keyword\u7248\u672c package com.heima.search.config ; import lombok.Getter ; import lombok.Setter ; import org.apache.http.HttpHost ; import org.elasticsearch.client.RestClient ; import org.elasticsearch.client.RestHighLevelClient ; import org.springframework.boot.context.properties.ConfigurationProperties ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; import org.springframework.context.annotation.PropertySource ; @Getter @Setter @Configuration @ConfigurationProperties ( prefix = \"elasticsearch\" ) public class ElasticSearchConfig { private String host ; private int port ; @Bean public RestHighLevelClient client (){ System . out . println ( host ); System . out . println ( port ); return new RestHighLevelClient ( RestClient . builder ( new HttpHost ( host , port , \"http\" ) )); } } 05-\u641c\u7d22\u5fae\u670d\u52a1\u642d\u5efa 04:41 \u00b6 06-\u7d22\u5f15\u5e93\u6570\u636e\u5bfc\u5165 11:45 \u00b6 article\u96c6\u6210es\uff0c\u7f16\u5199\u6d4b\u8bd5\u7c7b: import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.article.ArticleApplication ; import com.heima.article.service.ApArticleContentService ; import com.heima.article.service.ApArticleService ; import com.heima.model.article.pojos.ApArticle ; import com.heima.model.article.pojos.ApArticleContent ; import org.elasticsearch.action.index.IndexRequest ; import org.elasticsearch.client.RequestOptions ; import org.elasticsearch.client.RestHighLevelClient ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; import java.io.IOException ; import java.util.HashMap ; import java.util.List ; import java.util.Map ; @SpringBootTest ( classes = ArticleApplication . class ) @RunWith ( SpringRunner . class ) public class ArticleTest { @Autowired private ApArticleService articleService ; @Autowired private RestHighLevelClient restHighLevelClient ; @Autowired private ApArticleContentService apArticleContentService ; @Test public void testImportAll () throws IOException { List < ApArticle > list = articleService . list (); for ( ApArticle apArticle : list ) { Map < String , Object > map = new HashMap < String , Object > (); map . put ( \"id\" , apArticle . getId ()); map . put ( \"publishTime\" , apArticle . getPublishTime ()); map . put ( \"layout\" , apArticle . getLayout ()); map . put ( \"images\" , apArticle . getImages ()); map . put ( \"authorId\" , apArticle . getAuthorId ()); map . put ( \"title\" , apArticle . getTitle ()); ApArticleContent one = apArticleContentService . getOne ( Wrappers . < ApArticleContent > lambdaQuery (). eq ( ApArticleContent :: getArticleId , apArticle . getId ())); map . put ( \"content\" , one . getContent ()); IndexRequest indexRequest = new IndexRequest ( \"app_info_article\" ). id ( apArticle . getId (). toString ()). source ( map ); restHighLevelClient . index ( indexRequest , RequestOptions . DEFAULT ); } } } 07-\u63a5\u53e3\u5b9a\u4e49 06:20 \u00b6 package com.heima.apis.search ; import com.heima.model.article.dtos.UserSearchDto ; import com.heima.model.common.dtos.ResponseResult ; public interface ArticleSearchControllerApi { /** * \u641c\u7d22\u6587\u7ae0 * @param userSearchDto * @return */ public ResponseResult search ( UserSearchDto userSearchDto ); } package com.heima.model.search.dtos ; import com.heima.model.common.annotation.IdEncrypt ; import com.heima.model.search.pojos.ApUserSearch ; import lombok.Data ; import java.util.Date ; import java.util.List ; @Data public class UserSearchDto { // \u8bbe\u5907ID @IdEncrypt Integer equipmentId ; /** * \u641c\u7d22\u5173\u952e\u5b57 */ String searchWords ; /** * \u5f53\u524d\u9875 */ int pageNum ; /** * \u5206\u9875\u6761\u6570 */ int pageSize ; /** * \u6700\u5c0f\u65f6\u95f4 */ Date minBehotTime ; public int getFromIndex (){ if ( this . pageNum < 1 ) return 0 ; if ( this . pageSize < 1 ) this . pageSize = 10 ; return this . pageSize * ( pageNum - 1 ); } } 08-\u4e1a\u52a1\u5c42 10\uff1a39 \u00b6 package com.heima.search.service.impl ; import com.alibaba.fastjson.JSON ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.search.dtos.UserSearchDto ; import com.heima.search.service.ApArticleSearchService ; import com.heima.search.service.ApUserSearchService ; import lombok.extern.log4j.Log4j2 ; import org.apache.commons.lang3.StringUtils ; import org.elasticsearch.action.search.SearchRequest ; import org.elasticsearch.action.search.SearchResponse ; import org.elasticsearch.client.RequestOptions ; import org.elasticsearch.client.RestHighLevelClient ; import org.elasticsearch.index.query.* ; import org.elasticsearch.search.SearchHit ; import org.elasticsearch.search.builder.SearchSourceBuilder ; import org.elasticsearch.search.sort.SortOrder ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import java.io.IOException ; import java.util.ArrayList ; import java.util.List ; import java.util.Map ; @Service @Log4j2 public class ApArticleSearchServiceImpl implements ApArticleSearchService { @Autowired private RestHighLevelClient restHighLevelClient ; @Autowired private ApUserSearchService apUserSearchService ; @Override public ResponseResult esArticleSearch ( UserSearchDto dto ) throws IOException { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || StringUtils . isBlank ( dto . getSearchWords ())) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //\u8ba1\u7b97\u5f53\u524d\u67e5\u8be2\u8d77\u59cb\u6570\u636e\uff0c\u662f\u4e0d\u662f\u7b2c\u4e00\u6761 if ( dto . getFromIndex () == 0 ){ ResponseResult result = apUserSearchService . getEntryId ( dto ); if ( result . getCode () != AppHttpCodeEnum . SUCCESS . getCode ()){ return result ; } apUserSearchService . insert (( int ) result . getData (), dto . getSearchWords ()); } //2.\u6839\u636e\u6807\u9898\u6a21\u7cca\u5206\u9875\u67e5\u8be2 //\u6784\u5efa\u67e5\u8be2\u8bf7\u6c42\u5bf9\u8c61\uff0c\u6307\u5b9a\u67e5\u8be2\u7684\u7d22\u5f15\u540d\u79f0 SearchRequest searchRequest = new SearchRequest ( \"app_info_article\" ); //\u521b\u5efa\u67e5\u8be2\u6761\u4ef6\u6784\u5efa\u5668SearchSourceBuilder SearchSourceBuilder sourceBuilder = new SearchSourceBuilder (); BoolQueryBuilder boolQuery = QueryBuilders . boolQuery (); //\u6839\u636e\u6807\u9898\u6a21\u7cca\u67e5\u8be2 //\u4fee\u6539\u4e3amatch\u67e5\u8be2\uff0c\u6a21\u7cca\u67e5\u8be2\u65e0\u6cd5\u641c\u7d22 \u7231 \u6700\u4f73\u7b49\u5b57\u6837 MatchQueryBuilder title = QueryBuilders . matchQuery ( \"title\" , dto . getSearchWords ()); boolQuery . must ( title ); //WildcardQueryBuilder wildcardQueryBuilder = QueryBuilders.wildcardQuery(\"title\", dto.getSearchWords()); //boolQuery.must(wildcardQueryBuilder); //\u5c0f\u4e8e\u5f53\u524d\u7684\u65f6\u95f4 RangeQueryBuilder rangeQueryBuilder = QueryBuilders . rangeQuery ( \"publishTime\" ). lte ( dto . getMinBehotTime ()); boolQuery . filter ( rangeQueryBuilder ); sourceBuilder . query ( boolQuery ); //\u6309\u7167\u53d1\u5e03\u65f6\u95f4\u5012\u5e8f\u6392\u5e8f sourceBuilder . sort ( \"publishTime\" , SortOrder . DESC ); //\u5206\u9875\u67e5\u8be2 //\u8c03\u7528getFromIndex\u83b7\u53d6\u4ece\u7b2c\u51e0\u6761\u5f00\u59cb\u67e5 sourceBuilder . from ( dto . getFromIndex ()); sourceBuilder . size ( dto . getPageSize ()); searchRequest . source ( sourceBuilder ); //\u67e5\u8be2,\u83b7\u53d6\u67e5\u8be2\u7ed3\u679c SearchResponse searchResponse = restHighLevelClient . search ( searchRequest , RequestOptions . DEFAULT ); //3.\u5c01\u88c5\u6570\u636e \u83b7\u53d6Hits\u6570\u636e SearchHit [] hits = searchResponse . getHits (). getHits (); List < Map > articleList = new ArrayList <> (); for ( SearchHit searchHit : hits ) { String sourceAsString = searchHit . getSourceAsString (); //\u8f6c\u4e3ajava\u5bf9\u8c61 Map goods = JSON . parseObject ( sourceAsString , Map . class ); articleList . add ( goods ); } return ResponseResult . okResult ( articleList ); } } 09-\u6d4b\u8bd5 08:02 \u00b6 #\u83b7\u53d6\u7d22\u5f15\u4fe1\u606f GET app_i nf o_ar t icle #\u67e5\u770b\u6240\u6709\u6570\u636e GET app_i nf o_ar t icle/_search #\u83b7\u53d6\u5206\u8bcd\u7ed3\u679c GET /app_i nf o_ar t icle/_doc/ 1 /_ ter mvec t ors? f ields= t i tle #\u6a21\u7cca\u641c\u7d22 GET app_i nf o_ar t icle/_search { \"query\" :{ \"bool\" : { \"must\" : [ { \"wildcard\" : { \"title\" : { \"wildcard\" : \"\u7231\u60c5\" , \"boost\" : 1.0 } } } ], \"filter\" : [ { \"range\" : { \"publishTime\" : { \"from\" : null , \"to\" : \"2603-10-11T11:33:20.000Z\" , \"include_lower\" : true , \"include_upper\" : true , \"boost\" : 1.0 } } } ], \"adjust_pure_negative\" : true , \"boost\" : 1.0 } } } 10-\u6587\u7ae0\u81ea\u52a8\u5ba1\u6838\u6784\u5efa\u7d22\u5f15 03:20 \u00b6 \u7b2c\u4e00\uff0c\u5728admin\u5fae\u670d\u52a1\u4e2d\u96c6\u6210elasticSearch\uff0c\u53c2\u8003\u641c\u7d22\u5fae\u670d\u52a1 \u7b2c\u4e8c\uff0c\u5728admin\u5fae\u670d\u52a1\u4e2d\u7684\u81ea\u52a8\u5ba1\u6838\u4ee3\u7801\u4e2d\u7684saveAppArticle\u65b9\u6cd5\u7684\u6700\u4e0b\u65b9\u6dfb\u52a0\u5982\u4e0b\u4ee3\u7801 //TODO es\u7d22\u5f15\u521b\u5efa Map < String , Object > map = new HashMap < String , Object > (); map . put ( \"id\" , apArticle . getId ()); map . put ( \"publishTime\" , apArticle . getPublishTime ()); map . put ( \"layout\" , apArticle . getLayout ()); map . put ( \"images\" , apArticle . getImages ()); map . put ( \"authorId\" , apArticle . getAuthorId ()); map . put ( \"title\" , apArticle . getTitle ()); IndexRequest indexRequest = new IndexRequest ( \"app_info_article\" ). id ( apArticle . getId (). toString ()). source ( map ); try { restHighLevelClient . index ( indexRequest , RequestOptions . DEFAULT ); } catch ( IOException e ) { e . printStackTrace (); } \u6b63\u5e38\u9879\u76ee\u4e2d\uff0c\u7d22\u5f15\u662f\u4e0d\u7528\u5728\u4ee3\u7801\u4e2d\u521b\u5efa\u7684\uff0c\u9879\u76ee\u4e0a\u7ebf\u524d\u5fc5\u987b\u521b\u5efa\u5b8c\u7d22\u5f15 logstash,maxwell 11-app\u7aef\u641c \u5f55 05\uff1a58 \u00b6 \u5c55\u793a\u7528\u6237\u7684\u641c\u7d22\u8bb0\u5f555\u6761 \u53ef\u4ee5\u5220\u9664\u641c\u7d22\u8bb0\u5f55 \u7269\u7406\u5220\u9664 : \u4ece\u6570\u636e\u5e93\u4e2d\u76f4\u63a5\u5c06\u6570\u636edelete \u903b\u8f91\u5220\u9664\uff1a\u4f7f\u7528status\u4fdd\u5b58\u662f\u5426\u5df2\u88ab\u5220\u9664\uff0c0\u4ee3\u8868\u5df2\u88ab\u5220\u9664\uff0c1\u4ee3\u8868\u6709\u6548 select * from ap_user_search where status = 1 and entry_id = 1 \u8868\u7ed3\u6784\uff1a ap_user_search APP\u7528\u6237\u641c\u7d22\u4fe1\u606f\u8868 \u641c\u7d22\u65f6\u8981\u5199\u5165\u6570\u636e\u5e93\uff0c\u8fd9\u4e2a\u884c\u4e3a\u7528\u6237\u5e76\u4e0d\u5173\u5fc3\uff0c\u53ef\u4ee5\u4f7f\u7528\u591a\u7ebf\u7a0b\u5f02\u6b65\u7684\u65b9\u5f0f\u6765\u8fdb\u884c\u5199\u5165\u3002 12-\u96c6\u6210\u7ebf\u7a0b\u6c60 05:57 \u00b6 package com.heima.common.threadpool ; import lombok.Data ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; import org.springframework.scheduling.annotation.EnableAsync ; import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor ; import java.util.concurrent.ThreadPoolExecutor ; @Data @Configuration @EnableAsync //\u5f00\u542f\u5f02\u6b65\u8bf7\u6c42 public class ThreadPoolConfig { private static final int corePoolSize = 10 ; // \u6838\u5fc3\u7ebf\u7a0b\u6570\uff08\u9ed8\u8ba4\u7ebf\u7a0b\u6570\uff09 private static final int maxPoolSize = 100 ; // \u6700\u5927\u7ebf\u7a0b\u6570 private static final int keepAliveTime = 10 ; // \u5141\u8bb8\u7ebf\u7a0b\u7a7a\u95f2\u65f6\u95f4\uff08\u5355\u4f4d\uff1a\u9ed8\u8ba4\u4e3a\u79d2\uff09 private static final int queueCapacity = 500 ; // \u7f13\u51b2\u961f\u5217\u6570 /** * \u9ed8\u8ba4\u5f02\u6b65\u7ebf\u7a0b\u6c60 * @return */ @Bean ( \"taskExecutor\" ) public ThreadPoolTaskExecutor taskExecutor (){ ThreadPoolTaskExecutor pool = new ThreadPoolTaskExecutor (); pool . setThreadNamePrefix ( \"--------------\u5168\u5c40\u7ebf\u7a0b\u6c60-----------------\" ); pool . setCorePoolSize ( corePoolSize ); pool . setMaxPoolSize ( maxPoolSize ); pool . setKeepAliveSeconds ( keepAliveTime ); pool . setQueueCapacity ( queueCapacity ); // \u7528\u4e8e\u88ab\u62d2\u7edd\u4efb\u52a1\u7684\u5904\u7406\u7a0b\u5e8f\uff0c\u5b83\u76f4\u63a5\u5728 execute \u65b9\u6cd5\u7684\u8c03\u7528\u7ebf\u7a0b\u4e2d\u8fd0\u884c\u88ab\u62d2\u7edd\u7684\u4efb\u52a1\uff1b\u5982\u679c\u6267\u884c\u7a0b\u5e8f\u5df2\u5173\u95ed\uff0c\u5219\u4f1a\u4e22\u5f03\u8be5\u4efb\u52a1 pool . setRejectedExecutionHandler ( new ThreadPoolExecutor . CallerRunsPolicy ()); // \u521d\u59cb\u5316 pool . initialize (); return pool ; } } 13-\u63a5\u53e3\u5b9a\u4e49 10:26 \u00b6 package com.heima.apis.search ; import com.heima.model.article.dtos.UserSearchDto ; import com.heima.model.common.dtos.ResponseResult ; public interface ApUserSearchControllerApi { /** * \u67e5\u8be2\u641c\u7d22\u5386\u53f2 * @param userSearchDto * @return */ public ResponseResult findUserSearch ( UserSearchDto userSearchDto ) ; /** * \u5220\u9664\u641c\u7d22\u5386\u53f2 * @param userSearchDto * @return */ public ResponseResult delUserSearch ( UserSearchDto userSearchDto ) ; } package com.heima.model.search.dtos ; import com.heima.model.common.annotation.IdEncrypt ; import com.heima.model.search.pojos.ApUserSearch ; import lombok.Data ; import java.util.Date ; import java.util.List ; @Data public class UserSearchDto { // \u8bbe\u5907ID @IdEncrypt Integer equipmentId ; /** * \u641c\u7d22\u5173\u952e\u5b57 */ String searchWords ; /** * \u5f53\u524d\u9875 */ int pageNum ; /** * \u5206\u9875\u6761\u6570 */ int pageSize ; /** * \u6700\u5c0f\u65f6\u95f4 */ Date minBehotTime ; /** * \u63a5\u6536\u641c\u7d22\u5386\u53f2\u8bb0\u5f55id */ Integer id ; public int getFromIndex (){ if ( this . pageNum < 1 ) return 0 ; if ( this . pageSize < 1 ) this . pageSize = 10 ; return this . pageSize * ( pageNum - 1 ); } } 14-\u67e5\u8be2\u641c\u7d22\u5217\u8868 05:38 \u00b6 @Override public ResponseResult findUserSearch ( UserSearchDto dto ) { //\u83b7\u53d6\u6bcf\u9875\u6570\u91cf\u8d85\u8fc750\u6761\uff0c\u76f4\u63a5\u8fd4\u56de\u53c2\u6570\u9519\u8bef if ( dto . getPageSize () > 50 ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //\u901a\u8fc7\u7528\u6237\u548c\u8bbe\u5907ID\uff0c\u83b7\u53d6entryId ResponseResult ret = getEntryId ( dto ); if ( ret . getCode () != AppHttpCodeEnum . SUCCESS . getCode ()){ return ret ; } IPage pageParam = new Page ( 0 , dto . getPageSize ()); QueryWrapper < ApUserSearch > queryWrapper = new QueryWrapper (); //\u53ea\u67e5\u8be2entryId\u5339\u914d\u7684\uff0c\u5e76\u4e14\u6709\u6548\u7684\u6570\u636e queryWrapper . lambda (). eq ( ApUserSearch :: getEntryId , ret . getData ()). eq ( ApUserSearch :: getStatus , 1 ); IPage < ApUserSearch > page = page ( pageParam , queryWrapper ); return ResponseResult . okResult ( page . getRecords ()); } public ResponseResult getEntryId ( UserSearchDto dto ){ ApUser user = AppThreadLocalUtils . getUser (); // \u7528\u6237\u548c\u8bbe\u5907\u4e0d\u80fd\u540c\u65f6\u4e3a\u7a7a if ( user == null && dto . getEquipmentId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE ); } Integer userId = null ; if ( user != null ){ userId = user . getId (); } ApBehaviorEntry apBehaviorEntry = behaviorFeign . findByUserIdOrEntryId ( userId , dto . getEquipmentId ()); // \u884c\u4e3a\u5b9e\u4f53\u627e\u4ee5\u53ca\u6ce8\u518c\u4e86\uff0c\u903b\u8f91\u4e0a\u8fd9\u91cc\u662f\u5fc5\u5b9a\u6709\u503c\u5f97\uff0c\u9664\u975e\u53c2\u6570\u9519\u8bef if ( apBehaviorEntry == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } return ResponseResult . okResult ( apBehaviorEntry . getId ()); } 15-\u5220\u9664\u548c\u65b0\u589e\u641c\u7d22\u8bb0\u5f55 09:20 \u00b6 @Override public ResponseResult delUserSearch ( UserSearchDto dto ) { if ( dto . getHisList () == null || dto . getHisList (). size () <= 0 ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE ); } ResponseResult ret = getEntryId ( dto ); if ( ret . getCode () != AppHttpCodeEnum . SUCCESS . getCode ()){ return ret ; } //\u83b7\u53d6\u6279\u91cf\u7684\u5220\u9664\u5217\u8868 List < Integer > ids = dto . getHisList (). stream (). map ( ApUserSearch :: getId ). collect ( Collectors . toList ()); //\u5c06\u8fd9\u4e9b\u5220\u9664\u5217\u8868\u4e2d\u7684\u6570\u636e\u8bbe\u7f6estatus\u4e3a0 boolean update = update ( Wrappers . < ApUserSearch > lambdaUpdate (). eq ( ApUserSearch :: getEntryId , ret . getData ()). in ( ApUserSearch :: getId , ids ). set ( ApUserSearch :: getStatus , 0 )); return ResponseResult . okResult ( update ); } @Override @Async ( \"taskExecutor\" ) public void insert ( Integer entryId , String searchWords ) { //\u67e5\u8be2\u751f\u6548\u7684\u8bb0\u5f55\u662f\u5426\u5b58\u5728 // int count = count(Wrappers.<ApUserSearch>lambdaQuery().eq(ApUserSearch::getEntryId, entryId).eq(ApUserSearch::getKeyword, searchWords)); ApUserSearch userSearch = getOne ( Wrappers . < ApUserSearch > lambdaQuery (). eq ( ApUserSearch :: getEntryId , entryId ). eq ( ApUserSearch :: getKeyword , searchWords )); if ( userSearch != null && userSearch . getStatus () == 1 ){ log . info ( \"\u5f53\u524d\u5173\u952e\u5b57\u5df2\u5b58\u5728\uff0c\u65e0\u987b\u518d\u6b21\u4fdd\u5b58\" ); return ; } else if ( userSearch != null && userSearch . getStatus () == 0 ){ userSearch . setStatus ( 1 ); updateById ( userSearch ); return ; } //\u4fdd\u5b58\u65b0\u7684\u5173\u952e\u5b57 ApUserSearch apUserSearch = new ApUserSearch (); apUserSearch . setEntryId ( entryId ); apUserSearch . setKeyword ( searchWords ); apUserSearch . setStatus ( 1 ); apUserSearch . setCreatedTime ( new Date ()); save ( apUserSearch ); } 16-\u6d4b\u8bd5 12:48 \u00b6 esArticleSearch\u65b9\u6cd5\u4e2d\uff1a //\u5982\u679c\u662f\u7ffb\u9875\u5230\u540e\u9762\u51e0\u9875\uff0c\u5c31\u4e0d\u8981\u5b58\u50a8\u641c\u7d22\u5185\u5bb9\u4e86 if ( dto . getFromIndex () == 0 ){ ResponseResult result = apUserSearchService . getEntryId ( dto ); if ( result . getCode () != AppHttpCodeEnum . SUCCESS . getCode ()){ return result ; } apUserSearchService . insert (( int ) result . getData (), dto . getSearchWords ()); } 17-\u5173\u952e\u5b57\u8054\u60f3\u8bcd 10:53 \u00b6 package com.heima.search.service.impl ; import com.baomidou.mybatisplus.core.metadata.IPage ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.baomidou.mybatisplus.extension.plugins.pagination.Page ; import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.search.dtos.UserSearchDto ; import com.heima.model.search.pojos.ApAssociateWords ; import com.heima.search.mapper.ApAssociateWordsMapper ; import com.heima.search.service.ApAssociateWordsService ; import lombok.extern.slf4j.Slf4j ; import org.springframework.stereotype.Service ; /** * <p> * \u8054\u60f3\u8bcd\u8868 \u670d\u52a1\u5b9e\u73b0\u7c7b * </p> * * @author itheima */ @Slf4j @Service public class ApAssociateWordsServiceImpl extends ServiceImpl < ApAssociateWordsMapper , ApAssociateWords > implements ApAssociateWordsService { @Override public ResponseResult searchAssociate ( UserSearchDto dto ) { if ( dto . getPageSize () > 50 || dto . getPageSize () < 1 ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } IPage pageParam = new Page ( 0 , dto . getPageSize ()); //\u6a21\u7cca\u67e5\u8be2ap_associate_words\u8868 IPage page = page ( pageParam , Wrappers . < ApAssociateWords > lambdaQuery (). like ( ApAssociateWords :: getAssociateWords , dto . getSearchWords ())); return ResponseResult . okResult ( page . getRecords ()); } } 18-\u4f18\u5316\u6539\u9020\u5173\u952e\u5b57\u8054\u60f3\u8bcd\u65b9\u6848\u8bf4\u660e 07:35 \u00b6 \u4f18\u5316\u65b9\u6848\uff1a \u6570\u636e\u80fd\u591f\u7f13\u5b58\u5230redis \u6784\u9020Trie\u6811\u6570\u636e\u7ed3\u6784\uff0c\u9ad8\u6548\u67e5\u8be2\u6570\u636e Trie\u6811\uff1a\u53c8\u79f0\u5355\u8bcd\u67e5\u627e\u6811\uff0cTrie\u6811\uff0c\u662f\u4e00\u79cd\u6811\u5f62\u7ed3\u6784\uff0c\u662f\u4e00\u79cd\u54c8\u5e0c\u6811\u7684\u53d8\u79cd\u3002\u5178\u578b\u5e94\u7528\u662f\u7528\u4e8e\u7edf\u8ba1\uff0c\u6392 \u5e8f\u548c\u4fdd\u5b58\u5927\u91cf\u7684\u5b57\u7b26\u4e32\uff08\u4f46\u4e0d\u4ec5\u9650\u4e8e\u5b57\u7b26\u4e32\uff09\uff0c\u6240\u4ee5\u7ecf\u5e38\u88ab\u641c\u7d22\u5f15\u64ce\u7cfb\u7edf\u7528\u4e8e\u6587\u672c\u8bcd\u9891\u7edf\u8ba1\u3002\u5b83\u7684\u4f18\u70b9 \u662f\uff1a\u5229\u7528\u5b57\u7b26\u4e32\u7684\u516c\u5171\u524d\u7f00\u6765\u51cf\u5c11\u67e5\u8be2\u65f6\u95f4\uff0c\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u65e0\u8c13\u7684\u5b57\u7b26\u4e32\u6bd4\u8f83\uff0c\u67e5\u8be2\u6548\u7387\u6bd4\u54c8\u5e0c\u6811 \u9ad8\u3002 \u8bcd\u7ec4\u4e3a\uff1a\u9ed1\u9a6c\u7a0b\u5e8f\u5458\u3001\u9ed1\u9a6c\u5934\u6761\u3001\u9ed1\u9a6c\u65c5\u6e38\u3001\u9ed1\u732b \u6839\u8282\u70b9\u4e0d\u5305\u542b\u5b57\u7b26\uff0c\u9664\u6839\u8282\u70b9\u5916\u7684\u6bcf\u4e00\u4e2a\u5b50\u8282\u70b9\u90fd\u5305\u542b\u4e00\u4e2a\u5b57\u7b26\u3002 \u4ece\u6839\u8282\u70b9\u5230\u67d0\u4e00\u8282\u70b9\uff0c\u8def\u5f84\u4e0a\u7ecf\u8fc7\u7684\u5b57\u7b26\u8fde\u63a5\u8d77\u6765\uff0c\u5c31\u662f\u8be5\u8282\u70b9\u5bf9\u5e94\u7684\u5b57\u7b26\u4e32\u3002 \u6bcf\u4e2a\u5355\u8bcd\u7684\u516c\u5171\u524d\u7f00\u4f5c\u4e3a\u4e00\u4e2a\u5b57\u7b26\u8282\u70b9\u4fdd\u5b58\u3002 19-\u642d\u5efaredis\u73af\u5883 04:46 \u00b6 \u62c9\u53d6\u955c\u50cf docker pull redis \u521b\u5efa\u5bb9\u5668\u5e76\u8bbe\u7f6e\u5f00\u673a\u81ea\u542f docker run -d --name redis --restart=always -p 6379:6379 redis --requirepass \"1234qwer\" \u5728common\u6a21\u5757\u4e2d\u96c6\u6210redis \u65b0\u5efaredis.properties\u6587\u4ef6 #redis config spring.redis.host = localhost spring.redis.port = 6379 #spring.redis.password=123456 #spring.redis.password=1234qwer spring.redis.timeout = 90000 #\u8fde\u63a5\u6c60\u7684\u6700\u5927\u6570\u636e\u5e93\u8fde\u63a5\u6570 spring.redis.lettuce.pool.max-active = 8 #\u8fde\u63a5\u6c60\u7684\u6700\u5927\u7a7a\u95f2\u6570 spring.redis.lettuce.pool.max-idle = 8 #\u8fde\u63a5\u6c60\u7684\u6700\u5927\u5efa\u7acb\u8fde\u63a5\u7b49\u5f85\u65f6\u95f4 -1 \u4e3a\u65e0\u9650\u7b49\u5f85 spring.redis.lettuce.pool.max-wait = -1 #\u8fde\u63a5\u6c60\u7684\u6700\u5927\u7a7a\u95f2\u6570 0 \u8868\u793a\u4e0d\u9650\u5236 spring.redis.lettuce.pool.min-idle = 0 \u65b0\u5efa\u914d\u7f6e\u7c7b package com.heima.common.redis ; import org.springframework.boot.context.properties.ConfigurationProperties ; import org.springframework.context.annotation.Configuration ; import org.springframework.context.annotation.PropertySource ; @Configuration @PropertySource ( \"classpath:redis.properties\" ) @ConfigurationProperties ( prefix = \"spring.redis\" ) public class RedisConfiguration { } (3)\u5728\u641c\u7d22\u5fae\u670d\u52a1\u4e2d\u96c6\u6210redis package com.heima.search.config ; import org.springframework.context.annotation.ComponentScan ; import org.springframework.context.annotation.Configuration ; @Configuration @ComponentScan ( \"com.heima.common.redis\" ) public class RedisConfig { } 20-\u4e1a\u52a1\u5c42 09:19 \u00b6 @Override public ResponseResult searchV2 ( UserSearchDto dto ) { //1.\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u6570\u636e String assoStr = redisTemplate . opsForValue (). get ( \"associate_list\" ); List < ApAssociateWords > apAssociateWords = null ; if ( StringUtils . isNotEmpty ( assoStr )){ //2.\u7f13\u5b58\u4e2d\u5b58\u5728\uff0c\u76f4\u63a5\u62ff\u6570\u636e \"[{},{}]\" apAssociateWords = JSON . parseArray ( assoStr , ApAssociateWords . class ); } else { //3.\u7f13\u5b58\u4e2d\u4e0d\u5b58\u5728\uff0c\u4ece\u6570\u636e\u5e93\u4e2d\u83b7\u53d6\u6570\u636e\uff0c\u5b58\u50a8\u5230redis apAssociateWords = list (); redisTemplate . opsForValue (). set ( \"associate_list\" , JSON . toJSONString ( apAssociateWords )); } //4.\u6784\u5efatrie\u6570\u636e\u7ed3\u6784\uff0c\u4ecetrie\u4e2d\u83b7\u53d6\u6570\u636e\uff0c\u5c01\u88c5\u8fd4\u56de Trie t = new Trie (); for ( ApAssociateWords apAssociateWord : apAssociateWords ) { t . insert ( apAssociateWord . getAssociateWords ()); } List < String > ret = t . startWith ( dto . getSearchWords ()); List < ApAssociateWords > resultList = new ArrayList <> (); for ( String s : ret ) { ApAssociateWords aaw = new ApAssociateWords (); aaw . setAssociateWords ( s ); resultList . add ( aaw ); } return ResponseResult . okResult ( resultList ); } \u4f7f\u7528es\u8fdb\u884c\u6a21\u7cca\u67e5\u8be2\uff0c\u66ff\u4ee3\u5f53\u524d\u65b9\u6848 21-\u6d4b\u8bd5 04:15 \u00b6 \u7b80\u5316\u6d4b\u8bd5\u6b65\u9aa4\uff0c\u53ef\u4ee5\u76f4\u63a5\u5c06controller\u8c03\u7528\u7684service\u65b9\u6cd5\u4fee\u6539\u4e00\u4e0b","title":"day12"},{"location":"hmtt/day12/#01-_0107","text":"\u80fd\u591f\u719f\u6089docker\u642d\u5efaElasticSearch\u7684\u73af\u5883 \u80fd\u591f\u638c\u63e1\u521b\u5efa\u7d22\u5f15\u7684\u601d\u8def \u80fd\u591f\u5b8c\u6210app\u7aef\u6587\u7ae0\u7684\u641c\u7d22 \u80fd\u591f\u5b8c\u6210app\u7aef\u641c\u7d22\u8bb0\u5f55\u7684\u7ba1\u7406 \u80fd\u591f\u5b8c\u6210\u641c\u7d22\u5173\u952e\u8bcd\u7684\u8054\u60f3\u529f\u80fd","title":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 01:07"},{"location":"hmtt/day12/#02-dockeres_0704","text":"","title":"02-docker\u5b89\u88c5es\u73af\u5883  07:04"},{"location":"hmtt/day12/#03-dockerkibana_0407","text":"\u4f7f\u7528windows\u4e0b\u7684es\u8fdb\u884c\u5b89\u88c5\uff0c\u8be6\u89c1es\u8bfe\u7a0b\u4e2d\u7684windows\u5b89\u88c5\u8bf4\u660e ELK ELASTIC-SEARCH(\u67e5\u8be2) LOGSTASH\uff08\u6570\u636e\u91c7\u96c6\uff09 KIBANA\uff08\u5c55\u793a\uff09","title":"03-docker\u5b89\u88c5kibana\u73af\u5883  04:07"},{"location":"hmtt/day12/#04-_0429","text":"\u5b9e\u73b0\u601d\u8def \u9700\u8981\u628a\u6587\u7ae0\u76f8\u5173\u7684\u6570\u636e\u5b58\u50a8\u5230es\u7d22\u5f15\u5e93\u4e2d \u5728\u641c\u7d22\u5fae\u670d\u52a1\u4e2d\u8fdb\u884c\u68c0\u7d22\uff0c\u67e5\u8be2\u7684\u662fes\u5e93\uff0c\u5c55\u793a\u6587\u7ae0\u5217\u8868\uff0c\u9700\u8981\u6839\u636e\u5173\u952e\u5b57\u8fdb\u884c\u67e5\u8be2 \u5728\u641c\u7d22\u7684\u65f6\u5019\uff0c\u7528\u6237\u8f93\u5165\u4e86\u5173\u952e\u5b57\uff0c\u9700\u8981\u5bf9\u5f53\u524d\u7528\u6237\u8bb0\u5f55\u641c\u7d22\u5386\u53f2 PUT app_i nf o_ar t icle { \"mappings\" :{ \"properties\" :{ \"id\" :{ \"type\" : \"text\" }, \"publishTime\" :{ \"type\" : \"date\" }, \"layout\" :{ \"type\" : \"short\" }, \"images\" :{ \"type\" : \"text\" }, \"authorId\" : { \"type\" : \"integer\" }, \"title\" :{ \"type\" : \"text\" , \"analyzer\" : \"ik_smart\" }, \"content\" :{ \"type\" : \"text\" , \"analyzer\" : \"ik_smart\" } } } } title.keyword\u5b57\u6bb5\u662ftitle\u7684keyword\u7248\u672c package com.heima.search.config ; import lombok.Getter ; import lombok.Setter ; import org.apache.http.HttpHost ; import org.elasticsearch.client.RestClient ; import org.elasticsearch.client.RestHighLevelClient ; import org.springframework.boot.context.properties.ConfigurationProperties ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; import org.springframework.context.annotation.PropertySource ; @Getter @Setter @Configuration @ConfigurationProperties ( prefix = \"elasticsearch\" ) public class ElasticSearchConfig { private String host ; private int port ; @Bean public RestHighLevelClient client (){ System . out . println ( host ); System . out . println ( port ); return new RestHighLevelClient ( RestClient . builder ( new HttpHost ( host , port , \"http\" ) )); } }","title":"04-\u6587\u7ae0\u641c\u7d22 \u9700\u6c42\u5206\u6790\u53ca\u521b\u5efa\u7d22\u5f15 04:29"},{"location":"hmtt/day12/#05-_0441","text":"","title":"05-\u641c\u7d22\u5fae\u670d\u52a1\u642d\u5efa  04:41"},{"location":"hmtt/day12/#06-_1145","text":"article\u96c6\u6210es\uff0c\u7f16\u5199\u6d4b\u8bd5\u7c7b: import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.article.ArticleApplication ; import com.heima.article.service.ApArticleContentService ; import com.heima.article.service.ApArticleService ; import com.heima.model.article.pojos.ApArticle ; import com.heima.model.article.pojos.ApArticleContent ; import org.elasticsearch.action.index.IndexRequest ; import org.elasticsearch.client.RequestOptions ; import org.elasticsearch.client.RestHighLevelClient ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; import java.io.IOException ; import java.util.HashMap ; import java.util.List ; import java.util.Map ; @SpringBootTest ( classes = ArticleApplication . class ) @RunWith ( SpringRunner . class ) public class ArticleTest { @Autowired private ApArticleService articleService ; @Autowired private RestHighLevelClient restHighLevelClient ; @Autowired private ApArticleContentService apArticleContentService ; @Test public void testImportAll () throws IOException { List < ApArticle > list = articleService . list (); for ( ApArticle apArticle : list ) { Map < String , Object > map = new HashMap < String , Object > (); map . put ( \"id\" , apArticle . getId ()); map . put ( \"publishTime\" , apArticle . getPublishTime ()); map . put ( \"layout\" , apArticle . getLayout ()); map . put ( \"images\" , apArticle . getImages ()); map . put ( \"authorId\" , apArticle . getAuthorId ()); map . put ( \"title\" , apArticle . getTitle ()); ApArticleContent one = apArticleContentService . getOne ( Wrappers . < ApArticleContent > lambdaQuery (). eq ( ApArticleContent :: getArticleId , apArticle . getId ())); map . put ( \"content\" , one . getContent ()); IndexRequest indexRequest = new IndexRequest ( \"app_info_article\" ). id ( apArticle . getId (). toString ()). source ( map ); restHighLevelClient . index ( indexRequest , RequestOptions . DEFAULT ); } } }","title":"06-\u7d22\u5f15\u5e93\u6570\u636e\u5bfc\u5165 11:45"},{"location":"hmtt/day12/#07-_0620","text":"package com.heima.apis.search ; import com.heima.model.article.dtos.UserSearchDto ; import com.heima.model.common.dtos.ResponseResult ; public interface ArticleSearchControllerApi { /** * \u641c\u7d22\u6587\u7ae0 * @param userSearchDto * @return */ public ResponseResult search ( UserSearchDto userSearchDto ); } package com.heima.model.search.dtos ; import com.heima.model.common.annotation.IdEncrypt ; import com.heima.model.search.pojos.ApUserSearch ; import lombok.Data ; import java.util.Date ; import java.util.List ; @Data public class UserSearchDto { // \u8bbe\u5907ID @IdEncrypt Integer equipmentId ; /** * \u641c\u7d22\u5173\u952e\u5b57 */ String searchWords ; /** * \u5f53\u524d\u9875 */ int pageNum ; /** * \u5206\u9875\u6761\u6570 */ int pageSize ; /** * \u6700\u5c0f\u65f6\u95f4 */ Date minBehotTime ; public int getFromIndex (){ if ( this . pageNum < 1 ) return 0 ; if ( this . pageSize < 1 ) this . pageSize = 10 ; return this . pageSize * ( pageNum - 1 ); } }","title":"07-\u63a5\u53e3\u5b9a\u4e49 06:20"},{"location":"hmtt/day12/#08-_1039","text":"package com.heima.search.service.impl ; import com.alibaba.fastjson.JSON ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.search.dtos.UserSearchDto ; import com.heima.search.service.ApArticleSearchService ; import com.heima.search.service.ApUserSearchService ; import lombok.extern.log4j.Log4j2 ; import org.apache.commons.lang3.StringUtils ; import org.elasticsearch.action.search.SearchRequest ; import org.elasticsearch.action.search.SearchResponse ; import org.elasticsearch.client.RequestOptions ; import org.elasticsearch.client.RestHighLevelClient ; import org.elasticsearch.index.query.* ; import org.elasticsearch.search.SearchHit ; import org.elasticsearch.search.builder.SearchSourceBuilder ; import org.elasticsearch.search.sort.SortOrder ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import java.io.IOException ; import java.util.ArrayList ; import java.util.List ; import java.util.Map ; @Service @Log4j2 public class ApArticleSearchServiceImpl implements ApArticleSearchService { @Autowired private RestHighLevelClient restHighLevelClient ; @Autowired private ApUserSearchService apUserSearchService ; @Override public ResponseResult esArticleSearch ( UserSearchDto dto ) throws IOException { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || StringUtils . isBlank ( dto . getSearchWords ())) { return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //\u8ba1\u7b97\u5f53\u524d\u67e5\u8be2\u8d77\u59cb\u6570\u636e\uff0c\u662f\u4e0d\u662f\u7b2c\u4e00\u6761 if ( dto . getFromIndex () == 0 ){ ResponseResult result = apUserSearchService . getEntryId ( dto ); if ( result . getCode () != AppHttpCodeEnum . SUCCESS . getCode ()){ return result ; } apUserSearchService . insert (( int ) result . getData (), dto . getSearchWords ()); } //2.\u6839\u636e\u6807\u9898\u6a21\u7cca\u5206\u9875\u67e5\u8be2 //\u6784\u5efa\u67e5\u8be2\u8bf7\u6c42\u5bf9\u8c61\uff0c\u6307\u5b9a\u67e5\u8be2\u7684\u7d22\u5f15\u540d\u79f0 SearchRequest searchRequest = new SearchRequest ( \"app_info_article\" ); //\u521b\u5efa\u67e5\u8be2\u6761\u4ef6\u6784\u5efa\u5668SearchSourceBuilder SearchSourceBuilder sourceBuilder = new SearchSourceBuilder (); BoolQueryBuilder boolQuery = QueryBuilders . boolQuery (); //\u6839\u636e\u6807\u9898\u6a21\u7cca\u67e5\u8be2 //\u4fee\u6539\u4e3amatch\u67e5\u8be2\uff0c\u6a21\u7cca\u67e5\u8be2\u65e0\u6cd5\u641c\u7d22 \u7231 \u6700\u4f73\u7b49\u5b57\u6837 MatchQueryBuilder title = QueryBuilders . matchQuery ( \"title\" , dto . getSearchWords ()); boolQuery . must ( title ); //WildcardQueryBuilder wildcardQueryBuilder = QueryBuilders.wildcardQuery(\"title\", dto.getSearchWords()); //boolQuery.must(wildcardQueryBuilder); //\u5c0f\u4e8e\u5f53\u524d\u7684\u65f6\u95f4 RangeQueryBuilder rangeQueryBuilder = QueryBuilders . rangeQuery ( \"publishTime\" ). lte ( dto . getMinBehotTime ()); boolQuery . filter ( rangeQueryBuilder ); sourceBuilder . query ( boolQuery ); //\u6309\u7167\u53d1\u5e03\u65f6\u95f4\u5012\u5e8f\u6392\u5e8f sourceBuilder . sort ( \"publishTime\" , SortOrder . DESC ); //\u5206\u9875\u67e5\u8be2 //\u8c03\u7528getFromIndex\u83b7\u53d6\u4ece\u7b2c\u51e0\u6761\u5f00\u59cb\u67e5 sourceBuilder . from ( dto . getFromIndex ()); sourceBuilder . size ( dto . getPageSize ()); searchRequest . source ( sourceBuilder ); //\u67e5\u8be2,\u83b7\u53d6\u67e5\u8be2\u7ed3\u679c SearchResponse searchResponse = restHighLevelClient . search ( searchRequest , RequestOptions . DEFAULT ); //3.\u5c01\u88c5\u6570\u636e \u83b7\u53d6Hits\u6570\u636e SearchHit [] hits = searchResponse . getHits (). getHits (); List < Map > articleList = new ArrayList <> (); for ( SearchHit searchHit : hits ) { String sourceAsString = searchHit . getSourceAsString (); //\u8f6c\u4e3ajava\u5bf9\u8c61 Map goods = JSON . parseObject ( sourceAsString , Map . class ); articleList . add ( goods ); } return ResponseResult . okResult ( articleList ); } }","title":"08-\u4e1a\u52a1\u5c42 10\uff1a39"},{"location":"hmtt/day12/#09-_0802","text":"#\u83b7\u53d6\u7d22\u5f15\u4fe1\u606f GET app_i nf o_ar t icle #\u67e5\u770b\u6240\u6709\u6570\u636e GET app_i nf o_ar t icle/_search #\u83b7\u53d6\u5206\u8bcd\u7ed3\u679c GET /app_i nf o_ar t icle/_doc/ 1 /_ ter mvec t ors? f ields= t i tle #\u6a21\u7cca\u641c\u7d22 GET app_i nf o_ar t icle/_search { \"query\" :{ \"bool\" : { \"must\" : [ { \"wildcard\" : { \"title\" : { \"wildcard\" : \"\u7231\u60c5\" , \"boost\" : 1.0 } } } ], \"filter\" : [ { \"range\" : { \"publishTime\" : { \"from\" : null , \"to\" : \"2603-10-11T11:33:20.000Z\" , \"include_lower\" : true , \"include_upper\" : true , \"boost\" : 1.0 } } } ], \"adjust_pure_negative\" : true , \"boost\" : 1.0 } } }","title":"09-\u6d4b\u8bd5 08:02"},{"location":"hmtt/day12/#10-_0320","text":"\u7b2c\u4e00\uff0c\u5728admin\u5fae\u670d\u52a1\u4e2d\u96c6\u6210elasticSearch\uff0c\u53c2\u8003\u641c\u7d22\u5fae\u670d\u52a1 \u7b2c\u4e8c\uff0c\u5728admin\u5fae\u670d\u52a1\u4e2d\u7684\u81ea\u52a8\u5ba1\u6838\u4ee3\u7801\u4e2d\u7684saveAppArticle\u65b9\u6cd5\u7684\u6700\u4e0b\u65b9\u6dfb\u52a0\u5982\u4e0b\u4ee3\u7801 //TODO es\u7d22\u5f15\u521b\u5efa Map < String , Object > map = new HashMap < String , Object > (); map . put ( \"id\" , apArticle . getId ()); map . put ( \"publishTime\" , apArticle . getPublishTime ()); map . put ( \"layout\" , apArticle . getLayout ()); map . put ( \"images\" , apArticle . getImages ()); map . put ( \"authorId\" , apArticle . getAuthorId ()); map . put ( \"title\" , apArticle . getTitle ()); IndexRequest indexRequest = new IndexRequest ( \"app_info_article\" ). id ( apArticle . getId (). toString ()). source ( map ); try { restHighLevelClient . index ( indexRequest , RequestOptions . DEFAULT ); } catch ( IOException e ) { e . printStackTrace (); } \u6b63\u5e38\u9879\u76ee\u4e2d\uff0c\u7d22\u5f15\u662f\u4e0d\u7528\u5728\u4ee3\u7801\u4e2d\u521b\u5efa\u7684\uff0c\u9879\u76ee\u4e0a\u7ebf\u524d\u5fc5\u987b\u521b\u5efa\u5b8c\u7d22\u5f15 logstash,maxwell","title":"10-\u6587\u7ae0\u81ea\u52a8\u5ba1\u6838\u6784\u5efa\u7d22\u5f15 03:20"},{"location":"hmtt/day12/#11-app_0558","text":"\u5c55\u793a\u7528\u6237\u7684\u641c\u7d22\u8bb0\u5f555\u6761 \u53ef\u4ee5\u5220\u9664\u641c\u7d22\u8bb0\u5f55 \u7269\u7406\u5220\u9664 : \u4ece\u6570\u636e\u5e93\u4e2d\u76f4\u63a5\u5c06\u6570\u636edelete \u903b\u8f91\u5220\u9664\uff1a\u4f7f\u7528status\u4fdd\u5b58\u662f\u5426\u5df2\u88ab\u5220\u9664\uff0c0\u4ee3\u8868\u5df2\u88ab\u5220\u9664\uff0c1\u4ee3\u8868\u6709\u6548 select * from ap_user_search where status = 1 and entry_id = 1 \u8868\u7ed3\u6784\uff1a ap_user_search APP\u7528\u6237\u641c\u7d22\u4fe1\u606f\u8868 \u641c\u7d22\u65f6\u8981\u5199\u5165\u6570\u636e\u5e93\uff0c\u8fd9\u4e2a\u884c\u4e3a\u7528\u6237\u5e76\u4e0d\u5173\u5fc3\uff0c\u53ef\u4ee5\u4f7f\u7528\u591a\u7ebf\u7a0b\u5f02\u6b65\u7684\u65b9\u5f0f\u6765\u8fdb\u884c\u5199\u5165\u3002","title":"11-app\u7aef\u641c \u5f55 05\uff1a58"},{"location":"hmtt/day12/#12-_0557","text":"package com.heima.common.threadpool ; import lombok.Data ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; import org.springframework.scheduling.annotation.EnableAsync ; import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor ; import java.util.concurrent.ThreadPoolExecutor ; @Data @Configuration @EnableAsync //\u5f00\u542f\u5f02\u6b65\u8bf7\u6c42 public class ThreadPoolConfig { private static final int corePoolSize = 10 ; // \u6838\u5fc3\u7ebf\u7a0b\u6570\uff08\u9ed8\u8ba4\u7ebf\u7a0b\u6570\uff09 private static final int maxPoolSize = 100 ; // \u6700\u5927\u7ebf\u7a0b\u6570 private static final int keepAliveTime = 10 ; // \u5141\u8bb8\u7ebf\u7a0b\u7a7a\u95f2\u65f6\u95f4\uff08\u5355\u4f4d\uff1a\u9ed8\u8ba4\u4e3a\u79d2\uff09 private static final int queueCapacity = 500 ; // \u7f13\u51b2\u961f\u5217\u6570 /** * \u9ed8\u8ba4\u5f02\u6b65\u7ebf\u7a0b\u6c60 * @return */ @Bean ( \"taskExecutor\" ) public ThreadPoolTaskExecutor taskExecutor (){ ThreadPoolTaskExecutor pool = new ThreadPoolTaskExecutor (); pool . setThreadNamePrefix ( \"--------------\u5168\u5c40\u7ebf\u7a0b\u6c60-----------------\" ); pool . setCorePoolSize ( corePoolSize ); pool . setMaxPoolSize ( maxPoolSize ); pool . setKeepAliveSeconds ( keepAliveTime ); pool . setQueueCapacity ( queueCapacity ); // \u7528\u4e8e\u88ab\u62d2\u7edd\u4efb\u52a1\u7684\u5904\u7406\u7a0b\u5e8f\uff0c\u5b83\u76f4\u63a5\u5728 execute \u65b9\u6cd5\u7684\u8c03\u7528\u7ebf\u7a0b\u4e2d\u8fd0\u884c\u88ab\u62d2\u7edd\u7684\u4efb\u52a1\uff1b\u5982\u679c\u6267\u884c\u7a0b\u5e8f\u5df2\u5173\u95ed\uff0c\u5219\u4f1a\u4e22\u5f03\u8be5\u4efb\u52a1 pool . setRejectedExecutionHandler ( new ThreadPoolExecutor . CallerRunsPolicy ()); // \u521d\u59cb\u5316 pool . initialize (); return pool ; } }","title":"12-\u96c6\u6210\u7ebf\u7a0b\u6c60 05:57"},{"location":"hmtt/day12/#13-_1026","text":"package com.heima.apis.search ; import com.heima.model.article.dtos.UserSearchDto ; import com.heima.model.common.dtos.ResponseResult ; public interface ApUserSearchControllerApi { /** * \u67e5\u8be2\u641c\u7d22\u5386\u53f2 * @param userSearchDto * @return */ public ResponseResult findUserSearch ( UserSearchDto userSearchDto ) ; /** * \u5220\u9664\u641c\u7d22\u5386\u53f2 * @param userSearchDto * @return */ public ResponseResult delUserSearch ( UserSearchDto userSearchDto ) ; } package com.heima.model.search.dtos ; import com.heima.model.common.annotation.IdEncrypt ; import com.heima.model.search.pojos.ApUserSearch ; import lombok.Data ; import java.util.Date ; import java.util.List ; @Data public class UserSearchDto { // \u8bbe\u5907ID @IdEncrypt Integer equipmentId ; /** * \u641c\u7d22\u5173\u952e\u5b57 */ String searchWords ; /** * \u5f53\u524d\u9875 */ int pageNum ; /** * \u5206\u9875\u6761\u6570 */ int pageSize ; /** * \u6700\u5c0f\u65f6\u95f4 */ Date minBehotTime ; /** * \u63a5\u6536\u641c\u7d22\u5386\u53f2\u8bb0\u5f55id */ Integer id ; public int getFromIndex (){ if ( this . pageNum < 1 ) return 0 ; if ( this . pageSize < 1 ) this . pageSize = 10 ; return this . pageSize * ( pageNum - 1 ); } }","title":"13-\u63a5\u53e3\u5b9a\u4e49 10:26"},{"location":"hmtt/day12/#14-_0538","text":"@Override public ResponseResult findUserSearch ( UserSearchDto dto ) { //\u83b7\u53d6\u6bcf\u9875\u6570\u91cf\u8d85\u8fc750\u6761\uff0c\u76f4\u63a5\u8fd4\u56de\u53c2\u6570\u9519\u8bef if ( dto . getPageSize () > 50 ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //\u901a\u8fc7\u7528\u6237\u548c\u8bbe\u5907ID\uff0c\u83b7\u53d6entryId ResponseResult ret = getEntryId ( dto ); if ( ret . getCode () != AppHttpCodeEnum . SUCCESS . getCode ()){ return ret ; } IPage pageParam = new Page ( 0 , dto . getPageSize ()); QueryWrapper < ApUserSearch > queryWrapper = new QueryWrapper (); //\u53ea\u67e5\u8be2entryId\u5339\u914d\u7684\uff0c\u5e76\u4e14\u6709\u6548\u7684\u6570\u636e queryWrapper . lambda (). eq ( ApUserSearch :: getEntryId , ret . getData ()). eq ( ApUserSearch :: getStatus , 1 ); IPage < ApUserSearch > page = page ( pageParam , queryWrapper ); return ResponseResult . okResult ( page . getRecords ()); } public ResponseResult getEntryId ( UserSearchDto dto ){ ApUser user = AppThreadLocalUtils . getUser (); // \u7528\u6237\u548c\u8bbe\u5907\u4e0d\u80fd\u540c\u65f6\u4e3a\u7a7a if ( user == null && dto . getEquipmentId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE ); } Integer userId = null ; if ( user != null ){ userId = user . getId (); } ApBehaviorEntry apBehaviorEntry = behaviorFeign . findByUserIdOrEntryId ( userId , dto . getEquipmentId ()); // \u884c\u4e3a\u5b9e\u4f53\u627e\u4ee5\u53ca\u6ce8\u518c\u4e86\uff0c\u903b\u8f91\u4e0a\u8fd9\u91cc\u662f\u5fc5\u5b9a\u6709\u503c\u5f97\uff0c\u9664\u975e\u53c2\u6570\u9519\u8bef if ( apBehaviorEntry == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } return ResponseResult . okResult ( apBehaviorEntry . getId ()); }","title":"14-\u67e5\u8be2\u641c\u7d22\u5217\u8868 05:38"},{"location":"hmtt/day12/#15-_0920","text":"@Override public ResponseResult delUserSearch ( UserSearchDto dto ) { if ( dto . getHisList () == null || dto . getHisList (). size () <= 0 ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_REQUIRE ); } ResponseResult ret = getEntryId ( dto ); if ( ret . getCode () != AppHttpCodeEnum . SUCCESS . getCode ()){ return ret ; } //\u83b7\u53d6\u6279\u91cf\u7684\u5220\u9664\u5217\u8868 List < Integer > ids = dto . getHisList (). stream (). map ( ApUserSearch :: getId ). collect ( Collectors . toList ()); //\u5c06\u8fd9\u4e9b\u5220\u9664\u5217\u8868\u4e2d\u7684\u6570\u636e\u8bbe\u7f6estatus\u4e3a0 boolean update = update ( Wrappers . < ApUserSearch > lambdaUpdate (). eq ( ApUserSearch :: getEntryId , ret . getData ()). in ( ApUserSearch :: getId , ids ). set ( ApUserSearch :: getStatus , 0 )); return ResponseResult . okResult ( update ); } @Override @Async ( \"taskExecutor\" ) public void insert ( Integer entryId , String searchWords ) { //\u67e5\u8be2\u751f\u6548\u7684\u8bb0\u5f55\u662f\u5426\u5b58\u5728 // int count = count(Wrappers.<ApUserSearch>lambdaQuery().eq(ApUserSearch::getEntryId, entryId).eq(ApUserSearch::getKeyword, searchWords)); ApUserSearch userSearch = getOne ( Wrappers . < ApUserSearch > lambdaQuery (). eq ( ApUserSearch :: getEntryId , entryId ). eq ( ApUserSearch :: getKeyword , searchWords )); if ( userSearch != null && userSearch . getStatus () == 1 ){ log . info ( \"\u5f53\u524d\u5173\u952e\u5b57\u5df2\u5b58\u5728\uff0c\u65e0\u987b\u518d\u6b21\u4fdd\u5b58\" ); return ; } else if ( userSearch != null && userSearch . getStatus () == 0 ){ userSearch . setStatus ( 1 ); updateById ( userSearch ); return ; } //\u4fdd\u5b58\u65b0\u7684\u5173\u952e\u5b57 ApUserSearch apUserSearch = new ApUserSearch (); apUserSearch . setEntryId ( entryId ); apUserSearch . setKeyword ( searchWords ); apUserSearch . setStatus ( 1 ); apUserSearch . setCreatedTime ( new Date ()); save ( apUserSearch ); }","title":"15-\u5220\u9664\u548c\u65b0\u589e\u641c\u7d22\u8bb0\u5f55 09:20"},{"location":"hmtt/day12/#16-_1248","text":"esArticleSearch\u65b9\u6cd5\u4e2d\uff1a //\u5982\u679c\u662f\u7ffb\u9875\u5230\u540e\u9762\u51e0\u9875\uff0c\u5c31\u4e0d\u8981\u5b58\u50a8\u641c\u7d22\u5185\u5bb9\u4e86 if ( dto . getFromIndex () == 0 ){ ResponseResult result = apUserSearchService . getEntryId ( dto ); if ( result . getCode () != AppHttpCodeEnum . SUCCESS . getCode ()){ return result ; } apUserSearchService . insert (( int ) result . getData (), dto . getSearchWords ()); }","title":"16-\u6d4b\u8bd5 12:48"},{"location":"hmtt/day12/#17-_1053","text":"package com.heima.search.service.impl ; import com.baomidou.mybatisplus.core.metadata.IPage ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.baomidou.mybatisplus.extension.plugins.pagination.Page ; import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.search.dtos.UserSearchDto ; import com.heima.model.search.pojos.ApAssociateWords ; import com.heima.search.mapper.ApAssociateWordsMapper ; import com.heima.search.service.ApAssociateWordsService ; import lombok.extern.slf4j.Slf4j ; import org.springframework.stereotype.Service ; /** * <p> * \u8054\u60f3\u8bcd\u8868 \u670d\u52a1\u5b9e\u73b0\u7c7b * </p> * * @author itheima */ @Slf4j @Service public class ApAssociateWordsServiceImpl extends ServiceImpl < ApAssociateWordsMapper , ApAssociateWords > implements ApAssociateWordsService { @Override public ResponseResult searchAssociate ( UserSearchDto dto ) { if ( dto . getPageSize () > 50 || dto . getPageSize () < 1 ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } IPage pageParam = new Page ( 0 , dto . getPageSize ()); //\u6a21\u7cca\u67e5\u8be2ap_associate_words\u8868 IPage page = page ( pageParam , Wrappers . < ApAssociateWords > lambdaQuery (). like ( ApAssociateWords :: getAssociateWords , dto . getSearchWords ())); return ResponseResult . okResult ( page . getRecords ()); } }","title":"17-\u5173\u952e\u5b57\u8054\u60f3\u8bcd 10:53"},{"location":"hmtt/day12/#18-_0735","text":"\u4f18\u5316\u65b9\u6848\uff1a \u6570\u636e\u80fd\u591f\u7f13\u5b58\u5230redis \u6784\u9020Trie\u6811\u6570\u636e\u7ed3\u6784\uff0c\u9ad8\u6548\u67e5\u8be2\u6570\u636e Trie\u6811\uff1a\u53c8\u79f0\u5355\u8bcd\u67e5\u627e\u6811\uff0cTrie\u6811\uff0c\u662f\u4e00\u79cd\u6811\u5f62\u7ed3\u6784\uff0c\u662f\u4e00\u79cd\u54c8\u5e0c\u6811\u7684\u53d8\u79cd\u3002\u5178\u578b\u5e94\u7528\u662f\u7528\u4e8e\u7edf\u8ba1\uff0c\u6392 \u5e8f\u548c\u4fdd\u5b58\u5927\u91cf\u7684\u5b57\u7b26\u4e32\uff08\u4f46\u4e0d\u4ec5\u9650\u4e8e\u5b57\u7b26\u4e32\uff09\uff0c\u6240\u4ee5\u7ecf\u5e38\u88ab\u641c\u7d22\u5f15\u64ce\u7cfb\u7edf\u7528\u4e8e\u6587\u672c\u8bcd\u9891\u7edf\u8ba1\u3002\u5b83\u7684\u4f18\u70b9 \u662f\uff1a\u5229\u7528\u5b57\u7b26\u4e32\u7684\u516c\u5171\u524d\u7f00\u6765\u51cf\u5c11\u67e5\u8be2\u65f6\u95f4\uff0c\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u65e0\u8c13\u7684\u5b57\u7b26\u4e32\u6bd4\u8f83\uff0c\u67e5\u8be2\u6548\u7387\u6bd4\u54c8\u5e0c\u6811 \u9ad8\u3002 \u8bcd\u7ec4\u4e3a\uff1a\u9ed1\u9a6c\u7a0b\u5e8f\u5458\u3001\u9ed1\u9a6c\u5934\u6761\u3001\u9ed1\u9a6c\u65c5\u6e38\u3001\u9ed1\u732b \u6839\u8282\u70b9\u4e0d\u5305\u542b\u5b57\u7b26\uff0c\u9664\u6839\u8282\u70b9\u5916\u7684\u6bcf\u4e00\u4e2a\u5b50\u8282\u70b9\u90fd\u5305\u542b\u4e00\u4e2a\u5b57\u7b26\u3002 \u4ece\u6839\u8282\u70b9\u5230\u67d0\u4e00\u8282\u70b9\uff0c\u8def\u5f84\u4e0a\u7ecf\u8fc7\u7684\u5b57\u7b26\u8fde\u63a5\u8d77\u6765\uff0c\u5c31\u662f\u8be5\u8282\u70b9\u5bf9\u5e94\u7684\u5b57\u7b26\u4e32\u3002 \u6bcf\u4e2a\u5355\u8bcd\u7684\u516c\u5171\u524d\u7f00\u4f5c\u4e3a\u4e00\u4e2a\u5b57\u7b26\u8282\u70b9\u4fdd\u5b58\u3002","title":"18-\u4f18\u5316\u6539\u9020\u5173\u952e\u5b57\u8054\u60f3\u8bcd\u65b9\u6848\u8bf4\u660e 07:35"},{"location":"hmtt/day12/#19-redis_0446","text":"\u62c9\u53d6\u955c\u50cf docker pull redis \u521b\u5efa\u5bb9\u5668\u5e76\u8bbe\u7f6e\u5f00\u673a\u81ea\u542f docker run -d --name redis --restart=always -p 6379:6379 redis --requirepass \"1234qwer\" \u5728common\u6a21\u5757\u4e2d\u96c6\u6210redis \u65b0\u5efaredis.properties\u6587\u4ef6 #redis config spring.redis.host = localhost spring.redis.port = 6379 #spring.redis.password=123456 #spring.redis.password=1234qwer spring.redis.timeout = 90000 #\u8fde\u63a5\u6c60\u7684\u6700\u5927\u6570\u636e\u5e93\u8fde\u63a5\u6570 spring.redis.lettuce.pool.max-active = 8 #\u8fde\u63a5\u6c60\u7684\u6700\u5927\u7a7a\u95f2\u6570 spring.redis.lettuce.pool.max-idle = 8 #\u8fde\u63a5\u6c60\u7684\u6700\u5927\u5efa\u7acb\u8fde\u63a5\u7b49\u5f85\u65f6\u95f4 -1 \u4e3a\u65e0\u9650\u7b49\u5f85 spring.redis.lettuce.pool.max-wait = -1 #\u8fde\u63a5\u6c60\u7684\u6700\u5927\u7a7a\u95f2\u6570 0 \u8868\u793a\u4e0d\u9650\u5236 spring.redis.lettuce.pool.min-idle = 0 \u65b0\u5efa\u914d\u7f6e\u7c7b package com.heima.common.redis ; import org.springframework.boot.context.properties.ConfigurationProperties ; import org.springframework.context.annotation.Configuration ; import org.springframework.context.annotation.PropertySource ; @Configuration @PropertySource ( \"classpath:redis.properties\" ) @ConfigurationProperties ( prefix = \"spring.redis\" ) public class RedisConfiguration { } (3)\u5728\u641c\u7d22\u5fae\u670d\u52a1\u4e2d\u96c6\u6210redis package com.heima.search.config ; import org.springframework.context.annotation.ComponentScan ; import org.springframework.context.annotation.Configuration ; @Configuration @ComponentScan ( \"com.heima.common.redis\" ) public class RedisConfig { }","title":"19-\u642d\u5efaredis\u73af\u5883 04:46"},{"location":"hmtt/day12/#20-_0919","text":"@Override public ResponseResult searchV2 ( UserSearchDto dto ) { //1.\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u6570\u636e String assoStr = redisTemplate . opsForValue (). get ( \"associate_list\" ); List < ApAssociateWords > apAssociateWords = null ; if ( StringUtils . isNotEmpty ( assoStr )){ //2.\u7f13\u5b58\u4e2d\u5b58\u5728\uff0c\u76f4\u63a5\u62ff\u6570\u636e \"[{},{}]\" apAssociateWords = JSON . parseArray ( assoStr , ApAssociateWords . class ); } else { //3.\u7f13\u5b58\u4e2d\u4e0d\u5b58\u5728\uff0c\u4ece\u6570\u636e\u5e93\u4e2d\u83b7\u53d6\u6570\u636e\uff0c\u5b58\u50a8\u5230redis apAssociateWords = list (); redisTemplate . opsForValue (). set ( \"associate_list\" , JSON . toJSONString ( apAssociateWords )); } //4.\u6784\u5efatrie\u6570\u636e\u7ed3\u6784\uff0c\u4ecetrie\u4e2d\u83b7\u53d6\u6570\u636e\uff0c\u5c01\u88c5\u8fd4\u56de Trie t = new Trie (); for ( ApAssociateWords apAssociateWord : apAssociateWords ) { t . insert ( apAssociateWord . getAssociateWords ()); } List < String > ret = t . startWith ( dto . getSearchWords ()); List < ApAssociateWords > resultList = new ArrayList <> (); for ( String s : ret ) { ApAssociateWords aaw = new ApAssociateWords (); aaw . setAssociateWords ( s ); resultList . add ( aaw ); } return ResponseResult . okResult ( resultList ); } \u4f7f\u7528es\u8fdb\u884c\u6a21\u7cca\u67e5\u8be2\uff0c\u66ff\u4ee3\u5f53\u524d\u65b9\u6848","title":"20-\u4e1a\u52a1\u5c42 09:19"},{"location":"hmtt/day12/#21-_0415","text":"\u7b80\u5316\u6d4b\u8bd5\u6b65\u9aa4\uff0c\u53ef\u4ee5\u76f4\u63a5\u5c06controller\u8c03\u7528\u7684service\u65b9\u6cd5\u4fee\u6539\u4e00\u4e0b","title":"21-\u6d4b\u8bd5 04:15"},{"location":"hmtt/day13/","text":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 01:19 \u00b6 \u80fd\u591f\u7406\u89e3\u4ec0\u4e48\u662f\u5b9e\u65f6\u6d41\u5f0f\u8ba1\u7b97 \u80fd\u591f\u7406\u89e3kafkaStream\u5904\u7406\u5b9e\u65f6\u6d41\u5f0f\u8ba1\u7b97\u7684\u6d41\u7a0b \u80fd\u591f\u5b8c\u6210kafkaStream\u5b9e\u65f6\u6d41\u5f0f\u8ba1\u7b97\u7684\u5165\u95e8\u6848\u4f8b \u80fd\u591f\u5b8c\u6210app\u7aef\u70ed\u70b9\u6587\u7ae0\u8ba1\u7b97\u7684\u529f\u80fd \u80fd\u591f\u5b8c\u6210app\u7aef\u6587\u7ae0\u5217\u8868\u63a5\u53e3\u7684\u4f18\u5316\u6539\u9020 02-\u5b9e\u65f6\u6d41\u5f0f\u8ba1\u7b97\u6982\u5ff5\u4ecb\u7ecd 05:46 \u00b6 \u6279\u5904\u7406/\u6d41\u5f0f\u5b9e\u65f6\u5904\u7406 \u6d41\u5f0f\u8ba1\u7b97\u662f\u6e90\u6e90\u4e0d\u65ad\u7684\u63a5\u6536\u6570\u636e\uff0c\u901a\u8fc7\u4e00\u5b9a\u7b97\u6cd5\u6e90\u6e90\u4e0d\u65ad\u7684\u4ea7\u751f\u6570\u636e\u3002 \u5e94\u7528\u573a\u666f \u00b6 \u65e5\u5fd7\u5206\u6790 \u7f51\u7ad9\u7684\u7528\u6237\u8bbf\u95ee\u65e5\u5fd7\u8fdb\u884c\u5b9e\u65f6\u7684\u5206\u6790\uff0c\u8ba1\u7b97\u8bbf\u95ee\u91cf\uff0c\u7528\u6237\u753b\u50cf\uff0c\u7559\u5b58\u7387\u7b49\u7b49\uff0c\u5b9e\u65f6\u7684\u8fdb\u884c\u6570\u636e\u5206\u6790\uff0c\u5e2e\u52a9\u4f01\u4e1a\u8fdb\u884c\u51b3\u7b56 \u5927\u5c4f\u770b\u677f\u7edf\u8ba1 \u53ef\u4ee5\u5b9e\u65f6\u7684\u67e5\u770b\u7f51\u7ad9\u6ce8\u518c\u6570\u91cf\uff0c\u8ba2\u5355\u6570\u91cf\uff0c\u8d2d\u4e70\u6570\u91cf\uff0c\u91d1\u989d\u7b49\u3002 \u516c\u4ea4\u5b9e\u65f6\u6570\u636e \u53ef\u4ee5\u968f\u65f6\u66f4\u65b0\u516c\u4ea4\u8f66\u65b9\u4f4d\uff0c\u8ba1\u7b97\u591a\u4e45\u5230\u8fbe\u7ad9\u724c\u7b49 \u5b9e\u65f6\u6587\u7ae0\u5206\u503c\u8ba1\u7b97 \u5934\u6761\u7c7b\u6587\u7ae0\u7684\u5206\u503c\u8ba1\u7b97\uff0c\u901a\u8fc7\u7528\u6237\u7684\u884c\u4e3a\u5b9e\u65f6\u6587\u7ae0\u7684\u5206\u503c\uff0c\u5206\u503c\u8d8a\u9ad8\u5c31\u8d8a\u88ab\u63a8\u8350\u3002 \u6280\u672f\u65b9\u6848\u9009\u578b \u00b6 \u4ea7\u54c1 \u6a21\u578b API \u4fdd\u8bc1\u6b21\u6570 \u5bb9\u9519\u673a\u5236 \u72b6\u6001\u7ba1\u7406 \u5ef6\u65f6 \u541e\u5410\u91cf Storm Native\uff08\u6570\u636e\u8fdb\u5165\u7acb\u5373\u5904\u7406\uff09 \u7ec4\u5408\u5f0f\uff08\u57fa\u7840API\uff09 At-least-once \uff08\u81f3\u5c11\u4e00\u6b21\uff09 Record ACK\uff08ACK\u673a\u5236\uff09 \u65e0 \u4f4e \u4f4e Trident Micro-Batching\uff08\u5212\u5206\u4e3a\u5c0f\u6279 \u5904\u7406\uff09 \u7ec4\u5408\u5f0f Exactly-once \uff08\u4ec5\u4e00\u6b21\uff09 Record ACK \u57fa\u4e8e\u64cd\u4f5c\uff08\u6bcf\u6b21\u64cd\u4f5c\u6709\u4e00\u4e2a\u72b6\u6001\uff09 \u4e2d\u7b49 \u4e2d\u7b49 Spark Streaming Micro-Batching \u58f0\u660e\u5f0f\uff08\u63d0\u4f9b\u5c01\u88c5\u540e\u7684\u9ad8\u9636\u51fd\u6570\uff0c\u5982count\u51fd\u6570\uff09 Exactly-once RDD CheckPoint\uff08\u57fa\u4e8eRDD\u505aCheckPoint\uff09 \u57fa\u4e8eDStream \u4e2d\u7b49 \u9ad8 Flink Native \u58f0\u660e\u5f0f Exactly-once CheckPoint\uff08Flink\u7684\u4e00\u79cd\u5feb\u7167\uff09 \u57fa\u4e8e\u64cd\u4f5c \u4f4e \u9ad8 03-Kafka Streams\u7684\u6982\u5ff5\u4ecb\u7ecd 06:08 \u00b6 Kafka Stream\u662fApache Kafka\u4ece0.10\u7248\u672c\u5f15\u5165\u7684\u4e00\u4e2a\u65b0Feature\u3002\u5b83\u662f\u63d0\u4f9b\u4e86\u5bf9\u5b58\u50a8\u4e8eKafka\u5185\u7684\u6570\u636e\u8fdb\u884c\u6d41\u5f0f\u5904\u7406\u548c\u5206\u6790\u7684\u529f\u80fd\u3002 Kafka Stream\u7684\u7279\u70b9\u5982\u4e0b\uff1a Kafka Stream\u63d0\u4f9b\u4e86\u4e00\u4e2a\u975e\u5e38\u7b80\u5355\u800c\u8f7b\u91cf\u7684Library\uff0c\u5b83\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u5d4c\u5165\u4efb\u610fJava\u5e94\u7528\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u4efb\u610f\u65b9\u5f0f\u6253\u5305\u548c\u90e8\u7f72 \u9664\u4e86Kafka\u5916\uff0c\u65e0\u4efb\u4f55\u5916\u90e8\u4f9d\u8d56 \u5145\u5206\u5229\u7528Kafka\u5206\u533a\u673a\u5236\u5b9e\u73b0\u6c34\u5e73\u6269\u5c55\u548c\u987a\u5e8f\u6027\u4fdd\u8bc1 \u901a\u8fc7\u53ef\u5bb9\u9519\u7684state store\u5b9e\u73b0\u9ad8\u6548\u7684\u72b6\u6001\u64cd\u4f5c\uff08\u5982windowed join\u548caggregation\uff09 \u652f\u6301\u6b63\u597d\u4e00\u6b21\u5904\u7406\u8bed\u4e49 \u63d0\u4f9b\u8bb0\u5f55\u7ea7\u7684\u5904\u7406\u80fd\u529b\uff0c\u4ece\u800c\u5b9e\u73b0\u6beb\u79d2\u7ea7\u7684\u4f4e\u5ef6\u8fdf \u652f\u6301\u57fa\u4e8e\u4e8b\u4ef6\u65f6\u95f4\u7684\u7a97\u53e3\u64cd\u4f5c\uff0c\u5e76\u4e14\u53ef\u5904\u7406\u665a\u5230\u7684\u6570\u636e\uff08late arrival of records\uff09 \u540c\u65f6\u63d0\u4f9b\u5e95\u5c42\u7684\u5904\u7406\u539f\u8bedProcessor\uff08\u7c7b\u4f3c\u4e8eStorm\u7684spout\u548cbolt\uff09\uff0c\u4ee5\u53ca\u9ad8\u5c42\u62bd\u8c61\u7684DSL\uff08\u7c7b\u4f3c\u4e8eSpark\u7684map/group/reduce\uff09 \uff081\uff09Stream\u5904\u7406\u62d3\u6251 \u6d41 \u662fKafka Stream\u63d0\u51fa\u7684\u6700\u91cd\u8981\u7684\u62bd\u8c61\u6982\u5ff5\uff1a\u5b83\u8868\u793a\u4e00\u4e2a\u65e0\u9650\u7684\uff0c\u4e0d\u65ad\u66f4\u65b0\u7684\u6570\u636e\u96c6\u3002\u6d41\u662f\u4e00\u4e2a\u6709\u5e8f\u7684\uff0c\u53ef\u91cd\u653e\uff08\u53cd\u590d\u7684\u4f7f\u7528\uff09\uff0c\u4e0d\u53ef\u53d8\u7684\u5bb9\u9519\u5e8f\u5217\uff0c\u6570\u636e\u8bb0\u5f55\u7684\u683c\u5f0f\u662f\u952e\u503c\u5bf9\uff08key-value\uff09\u3002 \u901a\u8fc7Kafka Streams\u7f16\u5199\u4e00\u4e2a\u6216\u591a\u4e2a\u7684\u8ba1\u7b97\u903b\u8f91\u7684\u5904\u7406\u5668\u62d3\u6251\u3002\u5176\u4e2d\u5904\u7406\u5668\u62d3\u6251\u662f\u4e00\u4e2a\u7531\u6d41\uff08\u8fb9\u7f18\uff09\u8fde\u63a5\u7684\u6d41\u5904\u7406\uff08\u8282\u70b9\uff09\u7684\u56fe\u3002 \u6d41\u5904\u7406\u5668 \u662f \u5904\u7406\u5668\u62d3\u6251 \u4e2d\u7684\u4e00\u4e2a\u8282\u70b9\uff1b\u5b83\u8868\u793a\u4e00\u4e2a\u5904\u7406\u7684\u6b65\u9aa4\uff0c\u7528\u6765\u8f6c\u6362\u6d41\u4e2d\u7684\u6570\u636e\uff08\u4ece\u62d3\u6251\u4e2d\u7684\u4e0a\u6e38\u5904\u7406\u5668\u4e00\u6b21\u63a5\u53d7\u4e00\u4e2a\u8f93\u5165\u6d88\u606f\uff0c\u5e76\u4e14\u968f\u540e\u4ea7\u751f\u4e00\u4e2a\u6216\u591a\u4e2a\u8f93\u51fa\u6d88\u606f\u5230\u5176\u4e0b\u6e38\u5904\u7406\u5668\u4e2d\uff09\u3002 \uff082\uff09\u5728\u62d3\u6251\u4e2d\u6709\u4e24\u4e2a\u7279\u522b\u7684\u5904\u7406\u5668\uff1a \u6e90\u5904\u7406\u5668\uff08Source Processor\uff09 \uff1a\u6e90\u5904\u7406\u5668\u662f\u4e00\u4e2a\u6ca1\u6709\u4efb\u4f55\u4e0a\u6e38\u5904\u7406\u5668\u7684\u7279\u6b8a\u7c7b\u578b\u7684\u6d41\u5904\u7406\u5668\u3002\u5b83\u4ece\u4e00\u4e2a\u6216\u591a\u4e2akafka\u4e3b\u9898\u751f\u6210\u8f93\u5165\u6d41\u3002\u901a\u8fc7\u6d88\u8d39\u8fd9\u4e9b\u4e3b\u9898\u7684\u6d88\u606f\u5e76\u5c06\u5b83\u4eec\u8f6c\u53d1\u5230\u4e0b\u6e38\u5904\u7406\u5668\u3002 Sink\u5904\u7406\u5668 \uff1asink\u5904\u7406\u5668\u662f\u4e00\u4e2a\u6ca1\u6709\u4e0b\u6e38\u6d41\u5904\u7406\u5668\u7684\u7279\u6b8a\u7c7b\u578b\u7684\u6d41\u5904\u7406\u5668\u3002\u5b83\u63a5\u6536\u4e0a\u6e38\u6d41\u5904\u7406\u5668\u7684\u6d88\u606f\u53d1\u9001\u5230\u4e00\u4e2a\u6307\u5b9a\u7684 Kafka\u4e3b\u9898 \u3002 04-KStream KTable 03:49 \u00b6 KStream\uff1a \u00b6 \u4e00\u4e2a\u7eaf\u7cb9\u7684\u6d41\u5c31\u662f\u6240\u6709\u7684\u66f4\u65b0\u90fd\u88ab\u89e3\u91ca\u6210INSERT\u8bed\u53e5(\u56e0\u4e3a\u6ca1\u6709\u8bb0\u5f55\u4f1a\u66ff\u6362\u5df2\u6709\u7684\u8bb0\u5f55)\u7684\u8868\u3002 \u5728\u4e00\u4e2a\u6d41\u4e2d(KStream)\uff0c\u6bcf\u4e2akey-value\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u4fe1\u606f\u7247\u65ad\uff0c\u6bd4\u5982\uff0c\u7528\u6237\u8d2d\u4e70\u6d41\u662f\uff1aalice->\u9ec4\u6cb9\uff0cbob->\u9762\u5305\uff0calice->\u5976\u916a\u9762\u5305\uff0c\u6211\u4eec\u77e5\u9053alice\u65e2\u4e70\u4e86\u9ec4\u6cb9\uff0c\u53c8\u4e70\u4e86\u5976\u916a\u9762\u5305\u3002 KTable(changelog\u6d41)\uff1a \u00b6 KTable \u4e00\u5f20\u8868\u5c31\u662f\u4e00\u4e2a\u6240\u6709\u7684\u6539\u53d8\u90fd\u88ab\u89e3\u91ca\u6210UPDATE\u7684\u6d41(\u56e0\u4e3a\u6240\u6709\u4f7f\u7528\u540c\u6837\u7684key\u7684\u5df2\u5b58\u5728\u7684\u884c\u90fd\u4f1a\u88ab\u8986\u76d6)\u3002 \u5bf9\u4e8e\u4e00\u4e2a\u8868table( KTable)\uff0c\u662f\u4ee3\u8868\u4e00\u4e2a\u53d8\u5316\u65e5\u5fd7\uff0c\u5982\u679c\u8868\u5305\u542b\u4e24\u5bf9\u540c\u6837key\u7684key-value\u503c\uff0c\u540e\u8005\u4f1a\u8986\u76d6\u524d\u9762\u7684\u8bb0\u5f55\uff0c\u56e0\u4e3akey\u503c\u4e00\u6837\u7684\uff0c\u6bd4\u5982\u7528\u6237\u5730\u5740\u8868\uff1aalice -> \u7ebd\u7ea6, bob -> \u65e7\u91d1\u5c71, alice -> \u829d\u52a0\u54e5\uff0c\u610f\u5473\u7740Alice\u4ece\u7ebd\u7ea6\u8fc1\u79fb\u5230\u829d\u52a0\u54e5\uff0c\u800c\u4e0d\u662f\u540c\u65f6\u5c45\u4f4f\u5728\u4e24\u4e2a\u5730\u65b9\u3002 KTable \u8fd8\u63d0\u4f9b\u4e86\u901a\u8fc7key\u67e5\u627e\u6570\u636e\u503c\u5f97\u529f\u80fd\uff0c\u8be5\u67e5\u627e\u529f\u80fd\u53ef\u4ee5\u7528\u5728Join\u7b49\u529f\u80fd\u4e0a\u3002 05-\u5165\u95e8\u6848\u4f8b\u7f16\u5199 16:14 \u00b6 package com.itheima.kafka.simple ; import org.apache.kafka.common.serialization.Serdes ; import org.apache.kafka.streams.* ; import org.apache.kafka.streams.kstream.* ; import java.util.Arrays ; import java.util.Properties ; /** * \u9700\u6c42\uff1a * \u63a5\u6536kafka\u6d88\u606f\u5185\u5bb9\u5e76\u8ba1\u7b97\u6d88\u606f\u5185\u5355\u8bcd\u7684\u4e2a\u6570 * \u5982\uff1a * hello kafka stareams * hello heima kafka * hello beijing heima kafka * * \u7ed3\u679c\uff1a * hello 3 * kafka 3 * streams 1 * heima 2 * beijing 1 */ public class KafkaStreamFastStart { public static void main ( String [] args ) { //kafka\u914d\u7f6e\u4fe1\u606f Properties prop = new Properties (); prop . put ( StreamsConfig . BOOTSTRAP_SERVERS_CONFIG , \"192.168.200.130:9092\" ); prop . put ( StreamsConfig . DEFAULT_KEY_SERDE_CLASS_CONFIG , Serdes . String (). getClass ()); prop . put ( StreamsConfig . DEFAULT_VALUE_SERDE_CLASS_CONFIG , Serdes . String (). getClass ()); prop . put ( StreamsConfig . APPLICATION_ID_CONFIG , \"streams-faststart\" ); //stream\u6784\u5efa\u5668 StreamsBuilder builder = new StreamsBuilder (); //\u6d41\u5f0f\u8ba1\u7b97 group ( builder ); //\u521b\u5efakafkaStream KafkaStreams kafkaStreams = new KafkaStreams ( builder . build (), prop ); //\u5f00\u542fkafka\u6d41\u8ba1\u7b97 kafkaStreams . start (); } /** * \u5b9e\u65f6\u6d41\u5f0f\u8ba1\u7b97 * @param builder */ private static void group ( StreamsBuilder builder ) { //\u63a5\u6536\u4e0a\u6e38\u5904\u7406\u5668\u7684\u6d88\u606f KStream < String , String > stream = builder . stream ( \"input_topic\" ); KStream < String , String > map = stream . flatMapValues ( new ValueMapper < String , Iterable < String >> () { /** * \u628a\u6d88\u606f\u4e2d\u7684\u8bcd\u7ec4\uff0c\u8f6c\u6362\u4e3a\u4e00\u4e2a\u4e00\u4e2a\u7684\u5355\u8bcd\u653e\u5230\u96c6\u5408\u4e2d * @param value * @return */ @Override public Iterable < String > apply ( String value ) { return Arrays . asList ( value . split ( \" \" )); } }). map ( new KeyValueMapper < String , String , KeyValue < String , String >> () { /** * \u628a\u6d88\u606f\u7684key,\u91cd\u65b0\u8d4b\u503c\uff0c\u76ee\u524d\u6d88\u606f\u7684key,\u5c31\u662f\u4e00\u4e2a\u4e2a\u7684\u5355\u8bcd\uff0c\u628a\u5355\u8bcd\u4f5c\u4e3akey\u8fdb\u884c\u805a\u5408 * @param key * @param value * @return */ @Override public KeyValue < String , String > apply ( String key , String value ) { return new KeyValue <> ( value , value ); } }) //\u6839\u636ekey\u8fdb\u884c\u5206\u7ec4 \u76ee\u524d\u7684key \u5c31\u662fvalue,\u5c31\u662f\u4e00\u4e2a\u4e2a\u7684\u5355\u8bcd . groupByKey () //\u805a\u5408\u7684\u65f6\u95f4\u7a97\u53e3 \u591a\u4e45\u805a\u5408\u4e00\u6b21 . windowedBy ( TimeWindows . of ( 10000 )) //\u805a\u5408 \u6c42\u5355\u8bcd\u7684\u4e2a\u6570\uff0c\u8c03\u7528count\u540e\uff0c\u6d88\u606f\u7684vlaue\u662f\u805a\u5408\u5355\u8bcd\u540e\u7684\u7edf\u8ba1\u6570\u503c \u662f\u4e00\u4e2along\u7c7b\u578b //Materialized.as(\"count-article-num-001\") \u662f\u5f53\u524d\u6d88\u606f\u7684\u72b6\u6001\u503c\uff0c\u4e0d\u91cd\u590d\u5373\u53ef . count ( Materialized . as ( \"count-article-num-001\" )) //\u8f6c\u6362\u6210 Kstream . toStream () //\u628a\u5904\u7406\u540e\u7684key\u548cvalue\u8f6c\u6210string . map (( key , value ) -> { return new KeyValue <> ( key . key (). toString (), value . toString ()); }); //\u5904\u7406\u540e\u7684\u7ed3\u679c\uff0c\u53d1\u9001\u7ed9\u4e0b\u6e38\u5904\u7406\u5668 map . to ( \"out_topic\" ); } } 06-\u5165\u95e8\u6848\u4f8b\u6d4b\u8bd5\u53ca\u603b\u7ed3 11:10 \u00b6 \u4e0a\u8ff0\u4ee3\u7801\u6709\u4e25\u91cd\u95ee\u9898\uff0c\u7edf\u8ba1\u8fc7\u7a0b\u4e2d\u5e94\u8be5\u662f\u62ff\u4e0a\u6b21\u7684\u7ed3\u679c\u4e0e\u8fd9\u6b21\u7684\u7ed3\u679c\u8fdb\u884c\u7d2f\u52a0\uff0c\u4fee\u590d\u5982\u4e0b\uff1a \u53d1\u9001\u65b9\uff1a package com.itheima.kafka.simple ; import org.apache.kafka.clients.producer.* ; import org.apache.kafka.common.protocol.types.Field ; import java.util.Properties ; /** * \u6d88\u606f\u751f\u4ea7\u8005 */ public class ProducerFastStart { private static final String INPUT_TOPIC = \"input_topic_1\" ; public static void main ( String [] args ) throws InterruptedException { //\u6dfb\u52a0kafka\u7684\u914d\u7f6e\u4fe1\u606f Properties properties = new Properties (); //\u914d\u7f6ebroker\u4fe1\u606f properties . put ( \"bootstrap.servers\" , \"192.168.226.134:9092\" ); properties . put ( ProducerConfig . KEY_SERIALIZER_CLASS_CONFIG , \"org.apache.kafka.common.serialization.StringSerializer\" ); properties . put ( ProducerConfig . VALUE_SERIALIZER_CLASS_CONFIG , \"org.apache.kafka.common.serialization.StringSerializer\" ); properties . put ( ProducerConfig . RETRIES_CONFIG , 10 ); //\u751f\u4ea7\u8005\u5bf9\u8c61 KafkaProducer < String , String > producer = new KafkaProducer < String , String > ( properties ); while ( true ){ //\u5c01\u88c5\u6d88\u606f ProducerRecord < String , String > record = new ProducerRecord < String , String > ( INPUT_TOPIC , \"00001\" , \"hello,kafka\" ); //\u53d1\u9001\u6d88\u606f try { /*RecordMetadata recordMetadata = producer.send(record).get(); System.out.println(recordMetadata.offset());*/ producer . send ( record , new Callback () { @Override public void onCompletion ( RecordMetadata recordMetadata , Exception e ) { if ( e != null ){ e . printStackTrace (); } System . out . println ( recordMetadata . offset ()); } }); } catch ( Exception e ){ e . printStackTrace (); } Thread . sleep ( 1000 ); } //\u5173\u7cfb\u6d88\u606f\u901a\u9053 //producer.close(); } } \u8fd9\u91cc\u4e00\u76f4\u53d1\u9001\uff0c\u6bcf\u6b21\u53d1\u9001\u95f4\u96941\u79d2 \u6d41\u5f0f\u5904\u7406\uff1a package com.itheima.kafka.simple ; import org.apache.kafka.common.serialization.Serdes ; import org.apache.kafka.streams.* ; import org.apache.kafka.streams.kstream.* ; import org.springframework.util.StringUtils ; import java.util.Arrays ; import java.util.List ; import java.util.Properties ; public class KafkaStreamSample { public static final String INPUT_TOPIC = \"input_topic_1\" ; public static final String OUT_TOPIC = \"out_topic\" ; public static void main ( String [] args ) { //\u6dfb\u52a0kafka\u914d\u7f6e\u4fe1\u606f Properties prop = new Properties (); //\u8bbe\u7f6ekafka\u670d\u52a1\u5668\u5730\u5740 prop . put ( StreamsConfig . BOOTSTRAP_SERVERS_CONFIG , \"192.168.226.134:9092\" ); //\u8bbe\u7f6e\u5e94\u7528\u540d\uff0c\u53ef\u4ee5\u81ea\u5df1\u5b9a\u4e49 prop . put ( StreamsConfig . APPLICATION_ID_CONFIG , \"kafka-stream-sample\" ); //\u6307\u5b9akey\u7684\u7c7b\u578b prop . put ( StreamsConfig . DEFAULT_KEY_SERDE_CLASS_CONFIG , Serdes . String (). getClass ()); //\u6307\u5b9avalue\u7684\u7c7b\u578b prop . put ( StreamsConfig . DEFAULT_VALUE_SERDE_CLASS_CONFIG , Serdes . String (). getClass ()); StreamsBuilder builder = new StreamsBuilder (); //\u6784\u5efa\u8fc7\u6ee4\u7684\u805a\u5408\u6761\u4ef6 group ( builder ); KafkaStreams streams = new KafkaStreams ( builder . build (), prop ); streams . start (); } /** * \u5b9a\u4e49\u6d41\u5f0f\u8ba1\u7b97\u7684\u8fc7\u7a0b * * @param builder */ private static void group ( StreamsBuilder builder ) { //\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u8f93\u5165\u6570\u636e\u6240\u5728\u7684topic //\u7b2c\u4e8c\u4e2a\u53c2\u6570 \u5f53\u5404\u5206\u533a\u4e0b\u6709\u5df2\u63d0\u4ea4\u7684offset\u65f6\uff0c\u4ece\u63d0\u4ea4\u7684offset\u5f00\u59cb\u6d88\u8d39\uff1b\u65e0\u63d0\u4ea4\u7684offset\u65f6\uff0c\u6d88\u8d39\u65b0\u4ea7\u751f\u7684\u8be5\u5206\u533a\u4e0b\u7684\u6570\u636e KStream < String , String > stream = builder . stream ( INPUT_TOPIC , Consumed . with ( Topology . AutoOffsetReset . LATEST )); KStream < String , String > map = stream . groupByKey () //\u65f6\u95f4\u7a97\u53e3 10s\u805a\u5408\u4e00\u6b21\u6570\u636e . windowedBy ( TimeWindows . of ( 10000 )) . aggregate ( new Initializer < String > () { @Override public String apply () { return \"0\" ; } }, new Aggregator < String , String , String > () { /** * * @param key \u63a5\u6536\u5230\u7684\u6d88\u606f\u7684key, * @param value \u63a5\u6536\u5230\u7684\u6d88\u606f\u7684value * @param aggValue \u4e0a\u9762apply\u7684\u65b9\u6cd5\u8fd4\u56de\u503c * @return */ @Override public String apply ( String key , String value , String aggValue ) { //value\u4e3a\u7a7a\uff0c\u4e0d\u4f5c\u4efb\u4f55\u5904\u7406 if ( StringUtils . isEmpty ( value )) { return aggValue ; } //value\u5c06\u6765\u53d1\u9001\u7684\u5185\u5bb9\uff1a\"hello,kafka\" List < String > strings = Arrays . asList ( value . toLowerCase (). split ( \",\" )); int count = 0 ; for ( String string : strings ) { //\u5982\u679c\u5b57\u7b26\u4e32\u5305\u542bhello\uff0c\u5c31\u5c06count++ if ( string . equals ( \"hello\" )) { count ++ ; } } Integer integer = Integer . valueOf ( aggValue ); return String . valueOf ( integer + count ); } //\u552f\u4e00\u6807\u8bc6 }, Materialized . as ( \"kafka-stream-sample-count\" )) . toStream () . map (( key , value ) -> new KeyValue <> ( key . key (), value )); map . to ( OUT_TOPIC , Produced . with ( Serdes . String (), Serdes . String ())); } } 07-springboot\u96c6\u6210kafkaStream 08\uff1a47 \u00b6 package com.itheima.kafka.config ; import lombok.Getter ; import lombok.Setter ; import org.apache.kafka.clients.consumer.ConsumerConfig ; import org.apache.kafka.common.serialization.Serdes ; import org.apache.kafka.streams.StreamsConfig ; import org.apache.kafka.streams.Topology ; import org.springframework.boot.context.properties.ConfigurationProperties ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; import org.springframework.kafka.annotation.EnableKafkaStreams ; import org.springframework.kafka.annotation.KafkaStreamsDefaultConfiguration ; import org.springframework.kafka.config.KafkaStreamsConfiguration ; import java.util.HashMap ; import java.util.Map ; /** * \u901a\u8fc7\u91cd\u65b0\u6ce8\u518cKafkaStreamsConfiguration\u5bf9\u8c61\uff0c\u8bbe\u7f6e\u81ea\u5b9a\u914d\u7f6e\u53c2\u6570 */ @Setter @Getter @Configuration @EnableKafkaStreams @ConfigurationProperties ( prefix = \"kafka\" ) public class KafkaStreamConfig { private static final int MAX_MESSAGE_SIZE = 16 * 1024 * 1024 ; private String hosts ; private String group ; /** * \u91cd\u65b0\u5b9a\u4e49\u9ed8\u8ba4\u7684KafkaStreams\u914d\u7f6e\u5c5e\u6027\uff0c\u5305\u62ec\uff1a * 1\u3001\u670d\u52a1\u5668\u5730\u5740 * 2\u3001\u5e94\u7528ID * 3\u3001\u6d41\u6d88\u606f\u7684\u526f\u672c\u6570\u7b49\u914d\u7f6e * @return */ @Bean ( name = KafkaStreamsDefaultConfiguration . DEFAULT_STREAMS_CONFIG_BEAN_NAME ) public KafkaStreamsConfiguration defaultKafkaStreamsConfig () { Map < String , Object > props = new HashMap <> (); //kafka\u5730\u5740 props . put ( StreamsConfig . BOOTSTRAP_SERVERS_CONFIG , hosts ); //\u5e94\u7528ID props . put ( StreamsConfig . APPLICATION_ID_CONFIG , this . getGroup () + \"_stream_aid\" ); //\u5ba2\u6237\u7aefID props . put ( StreamsConfig . CLIENT_ID_CONFIG , this . getGroup () + \"_stream_cid\" ); //\u91cd\u8bd5\u6b21\u6570 props . put ( StreamsConfig . RETRIES_CONFIG , 10 ); //\u7c7b\u578b\u8f6c\u6362 props . put ( StreamsConfig . DEFAULT_KEY_SERDE_CLASS_CONFIG , Serdes . String (). getClass ()); props . put ( StreamsConfig . DEFAULT_VALUE_SERDE_CLASS_CONFIG , Serdes . String (). getClass ()); // \u6d88\u606f\u526f\u672c\u6570\u91cf props . put ( StreamsConfig . REPLICATION_FACTOR_CONFIG , 1 ); props . put ( StreamsConfig . RETRY_BACKOFF_MS_CONFIG , 5_000 ); props . put ( StreamsConfig . SEND_BUFFER_CONFIG , 3 * MAX_MESSAGE_SIZE ); props . put ( ConsumerConfig . AUTO_OFFSET_RESET_CONFIG , Topology . AutoOffsetReset . EARLIEST . name (). toLowerCase ()); return new KafkaStreamsConfiguration ( props ); } } package com.itheima.kafka.config ; /** * \u6d41\u6570\u636e\u7684\u76d1\u542c\u6d88\u8d39\u8005\u5b9e\u73b0\u7684\u63a5\u53e3\u7c7b\uff0c\u7cfb\u7edf\u81ea\u52a8\u4f1a\u901a\u8fc7 * KafkaStreamListenerFactory\u7c7b\u626b\u63cf\u9879\u76ee\u4e2d\u5b9e\u73b0\u8be5\u63a5\u53e3\u7684\u7c7b * \u5e76\u6ce8\u518c\u4e3a\u6d41\u6570\u636e\u7684\u6d88\u8d39\u7aef * * \u5176\u4e2d\u6cdb\u578b\u53ef\u662fKStream\u6216KTable * @param <T> */ public interface KafkaStreamListener < T > { // \u76d1\u542c\u7684\u7c7b\u578b String listenerTopic (); // \u5904\u7406\u7ed3\u679c\u53d1\u9001\u7684\u7c7b String sendTopic (); // \u5bf9\u8c61\u5904\u7406\u903b\u8f91 T getService ( T stream ); } package com.itheima.kafka.config ; import org.apache.kafka.streams.StreamsBuilder ; import org.slf4j.Logger ; import org.slf4j.LoggerFactory ; import org.springframework.beans.factory.InitializingBean ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.beans.factory.support.DefaultListableBeanFactory ; import org.springframework.context.ApplicationContext ; import org.springframework.stereotype.Component ; import java.util.Map ; /** * KafkaStreamListener\u626b\u63cf\u548c\u5b9e\u4f8b\u5316\u6210KafkaStreamProcessor.doAction\u7684\u8fd4\u56de\u7c7b\uff0c\u5b8c\u6210\u76d1\u542c\u5668\u5b9e\u9645\u6ce8\u518c\u7684\u8fc7\u7a0b */ @Component public class KafkaStreamListenerFactory implements InitializingBean { Logger logger = LoggerFactory . getLogger ( KafkaStreamListenerFactory . class ); @Autowired DefaultListableBeanFactory defaultListableBeanFactory ; /** * \u521d\u59cb\u5316\u5b8c\u6210\u540e\u81ea\u52a8\u8c03\u7528 */ @Override public void afterPropertiesSet () { Map < String , KafkaStreamListener > map = defaultListableBeanFactory . getBeansOfType ( KafkaStreamListener . class ); for ( String key : map . keySet ()) { KafkaStreamListener k = map . get ( key ); KafkaStreamProcessor processor = new KafkaStreamProcessor ( defaultListableBeanFactory . getBean ( StreamsBuilder . class ), k ); String beanName = k . getClass (). getSimpleName () + \"AutoProcessor\" ; defaultListableBeanFactory . registerSingleton ( beanName , processor . doAction ()); logger . info ( \"add kafka stream auto listener [{}]\" , beanName ); } } } package com.itheima.kafka.config ; import org.apache.kafka.streams.StreamsBuilder ; import org.apache.kafka.streams.Topology ; import org.apache.kafka.streams.kstream.Consumed ; import org.apache.kafka.streams.kstream.KStream ; import org.apache.kafka.streams.kstream.KTable ; import org.springframework.util.Assert ; import java.lang.reflect.ParameterizedType ; import java.lang.reflect.Type ; /** * KafkaStream\u81ea\u52a8\u5904\u7406\u5305\u88c5\u7c7b */ public class KafkaStreamProcessor { // \u6d41\u6784\u5efa\u5668 StreamsBuilder streamsBuilder ; private String type ; KafkaStreamListener listener ; public KafkaStreamProcessor ( StreamsBuilder streamsBuilder , KafkaStreamListener kafkaStreamListener ){ this . streamsBuilder = streamsBuilder ; this . listener = kafkaStreamListener ; this . parseType (); Assert . notNull ( this . type , \"Kafka Stream \u76d1\u542c\u5668\u53ea\u652f\u6301kstream\u3001ktable,\u5f53\u524d\u7c7b\u578b\u662f\" + this . type ); } /** * \u901a\u8fc7\u6cdb\u578b\u7c7b\u578b\u81ea\u52a8\u6ce8\u518c\u5bf9\u5e94\u7c7b\u578b\u7684\u6d41\u5904\u7406\u5668\u5bf9\u8c61 * \u652f\u6301KStream\u3001KTable * @return */ public Object doAction (){ if ( \"kstream\" . equals ( this . type )) { KStream <? , ?> stream = streamsBuilder . stream ( listener . listenerTopic (), Consumed . with ( Topology . AutoOffsetReset . LATEST )); stream = ( KStream ) listener . getService ( stream ); stream . to ( listener . sendTopic ()); return stream ; } else { KTable <? , ?> table = streamsBuilder . table ( listener . listenerTopic (), Consumed . with ( Topology . AutoOffsetReset . LATEST )); table = ( KTable ) listener . getService ( table ); table . toStream (). to ( listener . sendTopic ()); return table ; } } /** * \u89e3\u6790\u4f20\u5165listener\u7c7b\u7684\u6cdb\u578b\u7c7b */ private void parseType (){ Type [] types = listener . getClass (). getGenericInterfaces (); if ( types != null ){ for ( int i = 0 ; i < types . length ; i ++ ) { if ( types [ i ] instanceof ParameterizedType ){ ParameterizedType t = ( ParameterizedType ) types [ i ] ; String name = t . getActualTypeArguments () [ 0 ] . getTypeName (). toLowerCase (); if ( name . contains ( \"org.apache.kafka.streams.kstream.kstream\" ) || name . contains ( \"org.apache.kafka.streams.kstream.ktable\" )){ this . type = name . substring ( 0 , name . indexOf ( '<' )). replace ( \"org.apache.kafka.streams.kstream.\" , \"\" ). trim (); break ; } } } } } } 08-\u5165\u95e8\u6848\u4f8b 12:27 \u00b6 package com.itheima.kafka.stream.listener ; import com.itheima.kafka.config.KafkaStreamListener ; import org.apache.kafka.streams.KeyValue ; import org.apache.kafka.streams.kstream.* ; import org.springframework.stereotype.Component ; import org.springframework.util.StringUtils ; import java.util.Arrays ; import java.util.List ; /** * \u6cdb\u578b\u6267\u884c\u6267\u884c\u4e24\u79cd\u7c7b\u578b * Ktable * KStream */ @Component public class StreamListener implements KafkaStreamListener < KStream <? , String >> { @Override public String listenerTopic () { return \"input_topic_1\" ; } @Override public String sendTopic () { return \"out_topic\" ; } @Override public KStream <? , String > getService ( KStream <? , String > stream ) { return stream . groupByKey (). windowedBy ( TimeWindows . of ( 10000 )) . aggregate ( new Initializer < String > () { @Override public String apply () { return \"0\" ; } }, new Aggregator < Object , String , String > () { @Override public String apply ( Object key , String value , String aggValue ) { System . out . println ( \"spring\u96c6\u6210\u4ee5\u540e\u7684\u6d41\u5f0f\u5904\u7406------------\" ); if ( StringUtils . isEmpty ( value )){ return aggValue ; } List < String > strings = Arrays . asList ( value . toLowerCase (). split ( \",\" )); int count = 0 ; for ( String string : strings ) { if ( string . equals ( \"hello\" )){ count ++ ; } } Integer integer = Integer . valueOf ( aggValue ); return String . valueOf ( integer + count ); } }, Materialized . as ( \"kafka-stream-sample-count-1\" )). toStream () . map (( key , value ) -> { return new KeyValue <> ( key . key (). toString (), value ); }); } } \u76d1\u542c\uff1a package com.itheima.kafka.listener ; import com.alibaba.fastjson.JSON ; import com.itheima.kafka.pojo.User ; import org.apache.kafka.clients.consumer.ConsumerRecord ; import org.springframework.kafka.annotation.KafkaListener ; import org.springframework.stereotype.Component ; import java.util.Optional ; @Component public class HelloListener { @KafkaListener ( topics = { \"out_topic\" }) public void receiveMessage ( ConsumerRecord <? , ?> record ){ Optional <? extends ConsumerRecord <? , ?>> optional = Optional . ofNullable ( record ); if ( optional . isPresent ()){ Object value = record . value (); System . out . println ( value ); } } } 09-app\u7aef\u70ed\u70b9\u6587\u7ae0\u8ba1\u7b97-\u601d\u8def\u5206\u6790 10:40 \u00b6 \u8be6\u89c1\u8bb2\u4e49 10-\u73af\u5883\u96c6\u6210\u51c6\u5907 06:31 \u00b6 11-\u8ba1\u7b97\u6587\u7ae0\u5206\u503c 12:36 \u00b6 12-\u6570\u636e\u6392\u5e8f\u7f13\u5b58 16:18 \u00b6 package com.heima.article.service.impl ; import com.alibaba.fastjson.JSON ; import com.alibaba.fastjson.JSONArray ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.article.feign.AdminFeign ; import com.heima.article.mapper.ApArticleMapper ; import com.heima.article.service.HotArticleService ; import com.heima.common.constans.article.ArticleConstans ; import com.heima.model.admin.pojos.AdChannel ; import com.heima.model.article.pojos.ApArticle ; import com.heima.model.article.vo.HotArticleVo ; import com.heima.model.common.dtos.ResponseResult ; import org.joda.time.DateTime ; import org.springframework.beans.BeanUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.redis.core.StringRedisTemplate ; import org.springframework.stereotype.Service ; import java.util.ArrayList ; import java.util.Comparator ; import java.util.List ; import java.util.stream.Collectors ; @Service public class HotArticleServiceImpl implements HotArticleService { @Autowired private ApArticleMapper apArticleMapper ; @Override public void computeHotArticle () { //1.\u67e5\u8be2\u524d5\u5929\u7684\u65b0\u53d1\u5e03\u7684\u6587\u7ae0\u7684\u6570\u636e String dayParam = DateTime . now (). minusDays ( 5 ). toString ( \"yyyy-MM-dd 00:00:00\" ); List < ApArticle > articleList = apArticleMapper . selectList ( Wrappers . < ApArticle > lambdaQuery (). gt ( ApArticle :: getPublishTime , dayParam )); //2.\u8ba1\u7b97\u6587\u7ae0\u7684\u5206\u503c\uff08\u9605\u8bfb\u91cf\u3001\u70b9\u8d5e\u91cf\u3001\u8bc4\u8bba\u548c\u6536\u85cf\uff09 List < HotArticleVo > hotArticleVoList = computeHotArticle ( articleList ); //3.\u7ed9\u6bcf\u4e2a\u9891\u9053\u7f13\u5b58\u70ed\u5ea6\u8f83\u9ad8\u768430\u6761\u6570\u636e cacheTagToRedis ( hotArticleVoList ); } @Autowired private AdminFeign adminFeign ; @Autowired private StringRedisTemplate redisTemplate ; /** * \u7f13\u5b58\u6587\u7ae0\u5217\u8868\u5230redis * @param hotArticleVoList */ private void cacheTagToRedis ( List < HotArticleVo > hotArticleVoList ) { //1.\u67e5\u8be2\u6240\u6709\u7684\u9891\u9053\u4fe1\u606f ResponseResult responseResult = adminFeign . selectAllChannel (); List < AdChannel > channels = JSONArray . parseArray ( JSON . toJSONString ( responseResult . getData ()), AdChannel . class ); //2.\u68c0\u7d22\u6570\u636e\uff0c\u7ed9\u6bcf\u4e2a\u9891\u9053\u5b58\u516530\u6761\u5206\u503c\u8f83\u9ad8\u7684\u6570\u636e\u5230redis if ( channels != null && ! channels . isEmpty ()){ for ( AdChannel channel : channels ) { //\u8fc7\u6ee4\u6570\u636e\uff0c\u5982\u679c\u67d0\u4e9b\u6570\u636e\u4e0d\u5728\u9891\u9053\u5217\u8868\u4e2d\uff0c\u5c31\u6392\u9664\u6389 List < HotArticleVo > hotArticleVos = hotArticleVoList . stream (). filter ( p -> p . getChannelId (). equals ( channel . getId ())). collect ( Collectors . toList ()); sortAndCache ( hotArticleVos , ArticleConstans . HOT_ARTICLE_FIRST_PAGE + channel . getId ()); } } //3.\u5982\u679c\u662f\u63a8\u8350\u6570\u636e__all__\uff0c\u4ece\u70ed\u70b9\u6570\u636e\u4e2d\u627e\u51fa\u5206\u503c\u6700\u9ad8\u768430\u6761\u6570\u636e\u5b58\u5165redis sortAndCache ( hotArticleVoList , ArticleConstans . HOT_ARTICLE_FIRST_PAGE + ArticleConstans . DEFAULT_TAG ); } private void sortAndCache ( List < HotArticleVo > hotArticleVos , String s ) { //\u5012\u5e8f hotArticleVos . sort (( o1 , o2 ) -> o1 . getScore () < o2 . getScore () ? 1 : - 1 ); //\u83b7\u53d6\u524d30\u6761 if ( hotArticleVos . size () > 30 ) { hotArticleVos = hotArticleVos . subList ( 0 , 30 ); } if ( hotArticleVos . size () == 0 ) { redisTemplate . opsForValue (). set ( s , \"\" ); } redisTemplate . opsForValue (). set ( s , JSON . toJSONString ( hotArticleVos )); } /** * \u8ba1\u7b97\u6587\u7ae0\u5206\u503c * @param articleList * @return */ private List < HotArticleVo > computeHotArticle ( List < ApArticle > articleList ) { List < HotArticleVo > hotArticleVoList = new ArrayList <> (); HotArticleVo hotArticleVo = null ; if ( ! articleList . isEmpty () && articleList . size () > 0 ){ for ( ApArticle apArticle : articleList ) { hotArticleVo = new HotArticleVo (); //\u62f7\u8d1dapArticle\u5230hotArticleVo BeanUtils . copyProperties ( apArticle , hotArticleVo ); //\u8ba1\u7b97\u5206\u503c Integer score = computeScore ( apArticle ); //\u7ed9hotArticleVo\u8d4b\u503c\u5206\u503c hotArticleVo . setScore ( score ); hotArticleVoList . add ( hotArticleVo ); } } return hotArticleVoList ; } /** * \u8ba1\u7b97\u5206\u503c * @param apArticle * @return */ private Integer computeScore ( ApArticle apArticle ) { Integer score = 0 ; if ( apArticle . getLikes () != null ){ score += apArticle . getLikes () * ArticleConstans . HOT_ARTICLE_LIKE_WEIGHT ; } if ( apArticle . getViews () != null ){ score += apArticle . getViews (); } if ( apArticle . getComment () != null ){ score += apArticle . getComment () * ArticleConstans . HOT_ARTICLE_COMMENT_WEIGHT ; } if ( apArticle . getCollection () != null ){ score += apArticle . getCollection () * ArticleConstans . HOT_ARTICLE_COLLECTION_WEIGHT ; } return score ; } } 13-\u5355\u5143\u6d4b\u8bd5 12:25 \u00b6 \u5c06\u8d44\u6599\u4e2d\u7684sql\u5bfc\u5165\u5230\u6570\u636e\u5e93,\u66f4\u65b0\u4e00\u4e0b\u65f6\u95f4\u65b9\u4fbf\u6d4b\u8bd5 UPDATE ap_article SET publish_time = NOW () \u542f\u52a8admin,\u5728article\u4e2d\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b\uff1a package com.heima.article.test ; import com.heima.article.ArticleApplication ; import com.heima.article.service.HotArticleService ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @SpringBootTest ( classes = ArticleApplication . class ) @RunWith ( SpringRunner . class ) public class HotArticleServiceTest { @Autowired private HotArticleService hotArticleService ; @Test public void testComputeHotArticle (){ hotArticleService . computeHotArticle (); } } 14-\u5b9a\u65f6\u4efb\u52a1 08:25 \u00b6 \u542f\u52a8xxl-job-admin\uff0c\u53c2\u8003\u7b2c8\u5929\u7684\u8bb2\u4e49 \u53c2\u8003\u8bb2\u4e49\u914d\u7f6e\u4efb\u52a1\uff0c\u96c6\u6210xxl-job 15-\u884c\u4e3a\u6d88\u606f\u53d1\u9001 09:45 \u00b6 \u70b9\u8d5e\u4fee\u6539\uff1a package com.heima.behavior.service.impl ; import com.alibaba.fastjson.JSON ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl ; import com.heima.behavior.mapper.ApLikesBehaviorMapper ; import com.heima.behavior.service.ApBehaviorEntryService ; import com.heima.behavior.service.ApLikesBehaviorService ; import com.heima.common.constans.message.HotArticleConstants ; import com.heima.model.article.mess.UpdateArticleMess ; import com.heima.model.behavior.dtos.LikesBehaviorDto ; import com.heima.model.behavior.pojos.ApBehaviorEntry ; import com.heima.model.behavior.pojos.ApLikesBehavior ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.user.pojos.ApUser ; import com.heima.utils.threadlocal.AppThreadLocalUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.kafka.core.KafkaTemplate ; import org.springframework.stereotype.Service ; import java.util.Date ; @Service public class ApLikesBehaviorServiceImpl extends ServiceImpl < ApLikesBehaviorMapper , ApLikesBehavior > implements ApLikesBehaviorService { @Autowired private ApBehaviorEntryService apBehaviorEntryService ; @Autowired private KafkaTemplate kafkaTemplate ; @Override public ResponseResult like ( LikesBehaviorDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || dto . getArticleId () == null || ( dto . getType () < 0 && dto . getType () > 2 ) || ( dto . getOperation () < 0 && dto . getOperation () > 1 )){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u884c\u4e3a\u5b9e\u4f53 ApUser user = AppThreadLocalUtils . getUser (); ApBehaviorEntry apBehaviorEntry = apBehaviorEntryService . findByUserIdOrEquipmentId ( user . getId (), dto . getEquipmentId ()); if ( apBehaviorEntry == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //3.\u70b9\u8d5e\u6216\u53d6\u6d88\u70b9\u8d5e ApLikesBehavior apLikesBehavior = getOne ( Wrappers . < ApLikesBehavior > lambdaQuery (). eq ( ApLikesBehavior :: getArticleId , dto . getArticleId ()). eq ( ApLikesBehavior :: getEntryId , apBehaviorEntry . getId ())); //\u53d1\u9001\u6d88\u606f if ( dto . getOperation () == 0 ){ UpdateArticleMess mess = new UpdateArticleMess (); mess . setAdd ( 1 ); mess . setArticleId ( dto . getArticleId ()); mess . setType ( UpdateArticleMess . UpdateArticleType . LIKES ); kafkaTemplate . send ( HotArticleConstants . HOT_ARTICLE_SCORE_TOPIC , JSON . toJSONString ( mess )); } if ( apLikesBehavior == null && dto . getOperation () == 0 ){ apLikesBehavior = new ApLikesBehavior (); apLikesBehavior . setOperation ( dto . getOperation ()); apLikesBehavior . setArticleId ( dto . getArticleId ()); apLikesBehavior . setEntryId ( apBehaviorEntry . getId ()); apLikesBehavior . setType ( dto . getType ()); apLikesBehavior . setCreatedTime ( new Date ()); boolean save = save ( apLikesBehavior ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } else { apLikesBehavior . setOperation ( dto . getOperation ()); updateById ( apLikesBehavior ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } } } \u6dfb\u52a0\u4e86\u53d1\u9001\u6d88\u606f\u8fd9\u4e00\u6bb5\u4ee3\u7801 \u9605\u8bfb\u4fee\u6539\uff1a package com.heima.behavior.service.impl ; import com.alibaba.fastjson.JSON ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl ; import com.heima.behavior.mapper.ApReadBehaviorMapper ; import com.heima.behavior.service.ApBehaviorEntryService ; import com.heima.behavior.service.ApReadBehaviorService ; import com.heima.common.constans.message.HotArticleConstants ; import com.heima.model.article.mess.UpdateArticleMess ; import com.heima.model.behavior.dtos.ReadBehaviorDto ; import com.heima.model.behavior.pojos.ApBehaviorEntry ; import com.heima.model.behavior.pojos.ApReadBehavior ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.user.pojos.ApUser ; import com.heima.utils.threadlocal.AppThreadLocalUtils ; import lombok.extern.log4j.Log4j2 ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.kafka.core.KafkaTemplate ; import org.springframework.stereotype.Service ; import java.util.Date ; @Service @Log4j2 public class ApReadBehaviorServiceImpl extends ServiceImpl < ApReadBehaviorMapper , ApReadBehavior > implements ApReadBehaviorService { @Autowired private ApBehaviorEntryService apBehaviorEntryService ; @Autowired private KafkaTemplate kafkaTemplate ; @Override public ResponseResult readBehavior ( ReadBehaviorDto dto ) { //1.\u53c2\u6570\u6821\u9a8c if ( dto == null || dto . getArticleId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u884c\u4e3a\u5b9e\u4f53 ApUser user = AppThreadLocalUtils . getUser (); ApBehaviorEntry apBehaviorEntry = apBehaviorEntryService . findByUserIdOrEquipmentId ( user . getId (), dto . getEquipmentId ()); if ( apBehaviorEntry == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //3.\u4fdd\u5b58\u6216\u66f4\u65b0\u9605\u8bfb\u7684\u884c\u4e3a ApReadBehavior apReadBehavior = getOne ( Wrappers . < ApReadBehavior > lambdaQuery (). eq ( ApReadBehavior :: getEntryId , apBehaviorEntry . getId ()). eq ( ApReadBehavior :: getArticleId , dto . getArticleId ())); if ( apReadBehavior == null ){ apReadBehavior = new ApReadBehavior (); apReadBehavior . setCount ( dto . getCount ()); apReadBehavior . setArticleId ( dto . getArticleId ()); apReadBehavior . setPercentage ( dto . getPercentage ()); apReadBehavior . setEntryId ( apBehaviorEntry . getId ()); apReadBehavior . setLoadDuration ( dto . getLoadDuration ()); apReadBehavior . setReadDuration ( dto . getReadDuration ()); apReadBehavior . setCreatedTime ( new Date ()); save ( apReadBehavior ); } else { apReadBehavior . setUpdatedTime ( new Date ()); apReadBehavior . setCount (( short )( apReadBehavior . getCount () + 1 )); updateById ( apReadBehavior ); } //\u53d1\u9001\u6d88\u606f UpdateArticleMess mess = new UpdateArticleMess (); mess . setAdd ( 1 ); mess . setArticleId ( dto . getArticleId ()); mess . setType ( UpdateArticleMess . UpdateArticleType . VIEWS ); kafkaTemplate . send ( HotArticleConstants . HOT_ARTICLE_SCORE_TOPIC , JSON . toJSONString ( mess )); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } } 16-kafkastream\u96c6\u6210 04:39 \u00b6 \u8be6\u89c1\u8bb2\u4e49 17-\u6d41\u5f0f\u5904\u74061 15:36 \u00b6 18-\u6d41\u5f0f\u5904\u74062 08:17 \u00b6 package com.heima.article.stream.listener ; import com.alibaba.fastjson.JSON ; import com.heima.article.config.stream.KafkaStreamListener ; import com.heima.common.constans.message.HotArticleConstants ; import com.heima.model.article.mess.ArticleVisitStreamMess ; import com.heima.model.article.mess.UpdateArticleMess ; import lombok.extern.log4j.Log4j2 ; import org.apache.kafka.streams.KeyValue ; import org.apache.kafka.streams.kstream.* ; import org.springframework.stereotype.Component ; import java.util.regex.Matcher ; import java.util.regex.Pattern ; @Component @Log4j2 public class HotArticleStreamHandler implements KafkaStreamListener < KStream <? , String >> { @Override public String listenerTopic () { return HotArticleConstants . HOT_ARTICLE_SCORE_TOPIC ; } @Override public String sendTopic () { return HotArticleConstants . HOT_ARTICLE_INCR_HANDLE_TOPIC ; } @Override public KStream <? , String > getService ( KStream <? , String > stream ) { return stream . map (( key , value ) -> { //\u5148\u5c06\u4f20\u9012\u8fc7\u6765\u7684\u5b57\u7b26\u4e32\u8fd8\u539f\u6210\u5bf9\u8c61 UpdateArticleMess mess = JSON . parseObject ( value , UpdateArticleMess . class ); //map<articleId,LIKES:1> System . out . println ( \"key:\" + mess . getArticleId () + \",value:\" + mess . getType (). name () + \":\" + mess . getAdd ()); //\u5c06key-value\u8fd4\u56de\uff0ckey:articleId value: \u884c\u4e3a\u7c7b\u578b:\u6dfb\u52a0\u7684\u503c return new KeyValue <> ( mess . getArticleId (). toString (), mess . getType (). name () + \":\" + mess . getAdd ()); }). groupByKey (). windowedBy ( TimeWindows . of ( 10000 )). aggregate ( new Initializer < String > () { @Override public String apply () { //\u521d\u59cb\u5316\u90fd\u4e3a0 return \"COLLECTION:0,COMMENT:0,LIKES:0,VIEWS:0\" ; } }, new Aggregator < Object , String , String > () { @Override public String apply ( Object aggKey , String value , String aggValue ) { //LIKES:1 String [] valArr = value . split ( \":\" ); if ( valArr [ 0 ] . equals ( \"\" ) || valArr [ 1 ] . equals ( \"\" )){ return aggValue ; } int col = 0 , com = 0 , lik = 0 , vie = 0 ; if ( \"COLLECTION\" . equalsIgnoreCase ( valArr [ 0 ] )){ col += Integer . valueOf ( valArr [ 1 ] ); } if ( \"COMMENT\" . equalsIgnoreCase ( valArr [ 0 ] )){ com += Integer . valueOf ( valArr [ 1 ] ); } if ( \"LIKES\" . equalsIgnoreCase ( valArr [ 0 ] )){ lik += Integer . valueOf ( valArr [ 1 ] ); } if ( \"VIEWS\" . equalsIgnoreCase ( valArr [ 0 ] )){ vie += Integer . valueOf ( valArr [ 1 ] ); } System . out . println ( String . format ( \"COLLECTION:%d,COMMENT:%d,LIKES:%d,VIEWS:%d\" , col , com , lik , vie )); return String . format ( \"COLLECTION:%d,COMMENT:%d,LIKES:%d,VIEWS:%d\" , col , com , lik , vie ); } }, Materialized . as ( \"count-article-num-miukoo-1\" )). toStream (). map (( key , value ) -> { return new KeyValue <> ( key . key (). toString (), formatObj ( key . key (). toString (), value )); }); } /** * \u683c\u5f0f\u5316\u53d1\u9001\u6d88\u606f\u7684value * @param ArticleId * @param value * @return */ private String formatObj ( String ArticleId , String value ){ ArticleVisitStreamMess mess = new ArticleVisitStreamMess (); //value --> COLLECTION:%d,COMMENT:%d,LIKES:%d,VIEWS:%d Pattern pattern = Pattern . compile ( \"COLLECTION:(\\\\d+),COMMENT:(\\\\d+),LIKES:(\\\\d+),VIEWS:(\\\\d+)\" ); //\u901a\u8fc7\u6b63\u5219\u8fdb\u884c\u67e5\u8be2 Matcher matcher = pattern . matcher ( value ); if ( matcher . find ()){ mess . setCollect ( Long . valueOf ( matcher . group ( 1 ))); mess . setComment ( Long . valueOf ( matcher . group ( 2 ))); mess . setLike ( Long . valueOf ( matcher . group ( 3 ))); mess . setView ( Long . valueOf ( matcher . group ( 4 ))); } else { mess . setCollect ( 0 ); mess . setComment ( 0 ); mess . setLike ( 0 ); mess . setView ( 0 ); } mess . setArticleId ( Long . valueOf ( ArticleId )); System . out . println ( JSON . toJSONString ( mess )); //{\"articleId\":1302977558807060482,\"collect\":0,\"comment\":0,\"like\":0,\"view\":1} return JSON . toJSONString ( mess ); } } \u4f18\u5316\u4ee3\u7801 \u00b6 \u76ee\u524d\u7684\u4ee3\u7801\u5b57\u7b26\u4e32\u64cd\u4f5c\u592a\u591a\uff0c\u76f4\u63a5\u4f7f\u7528json\u5bf9\u8c61\u4f20\u9012\u4f1a\u7b80\u5355\u5f88\u591a\u3002 package com.heima.article.stream.listener ; import com.alibaba.fastjson.JSON ; import com.heima.article.config.stream.KafkaStreamListener ; import com.heima.common.constans.message.HotArticleConstants ; import com.heima.model.article.mess.ArticleVisitStreamMess ; import com.heima.model.article.mess.UpdateArticleMess ; import lombok.extern.log4j.Log4j2 ; import org.apache.kafka.streams.KeyValue ; import org.apache.kafka.streams.kstream.* ; import org.springframework.stereotype.Component ; import java.util.regex.Matcher ; import java.util.regex.Pattern ; @Component @Log4j2 public class HotArticleStreamHandlerV2 implements KafkaStreamListener < KStream <? , String >> { @Override public String listenerTopic () { return HotArticleConstants . HOT_ARTICLE_SCORE_TOPIC ; } @Override public String sendTopic () { return HotArticleConstants . HOT_ARTICLE_INCR_HANDLE_TOPIC ; } @Override public KStream <? , String > getService ( KStream <? , String > stream ) { return stream . map (( key , value ) -> { //\u5148\u5c06\u4f20\u9012\u8fc7\u6765\u7684\u5b57\u7b26\u4e32\u8fd8\u539f\u6210\u5bf9\u8c61 UpdateArticleMess mess = JSON . parseObject ( value , UpdateArticleMess . class ); //map<articleId,LIKES:1> System . out . println ( \"key:\" + mess . getArticleId () + \",value:\" + mess . getType (). name () + \":\" + mess . getAdd ()); //\u5c06key-value\u8fd4\u56de\uff0ckey:articleId value: UpdateArticleMess return new KeyValue <> ( mess . getArticleId (). toString (), value ); }). groupByKey (). windowedBy ( TimeWindows . of ( 10000 )). aggregate ( new Initializer < String > () { @Override public String apply () { //\u521d\u59cb\u5316\u90fd\u4e3a0 ArticleVisitStreamMess mess = new ArticleVisitStreamMess (); return JSON . toJSONString ( mess ); } }, new Aggregator < Object , String , String > () { @Override public String apply ( Object aggKey , String value , String aggValue ) { //\u8fd8\u539fvalue \u548c \u805a\u5408value UpdateArticleMess mess = JSON . parseObject ( value , UpdateArticleMess . class ); ArticleVisitStreamMess agg = JSON . parseObject ( value , ArticleVisitStreamMess . class ); //articleId\u4e3a\u7a7a\uff0c\u8d4b\u503c\u4e00\u4e0b if ( agg . getArticleId () == null ){ agg . setArticleId (( Long ) aggKey ); } //\u6839\u636evalue\u4e2d\u7684\u7c7b\u578b\uff0c\u589e\u52a0\u76f8\u5e94\u7684\u503c if ( mess . getType () != null ){ switch ( mess . getType ()){ case LIKES : agg . setLike ( agg . getLike () + mess . getAdd ()); break ; case VIEWS : agg . setView ( agg . getView () + mess . getAdd ()); break ; case COMMENT : agg . setComment ( agg . getComment () + mess . getAdd ()); break ; case COLLECTION : agg . setCollect ( agg . getCollect () + mess . getAdd ()); break ; } } return JSON . toJSONString ( agg ); } }, Materialized . as ( \"count-article-num-miukoo-1\" )). toStream (). map (( key , value ) -> { return new KeyValue <> ( key . key (). toString (), value ); }); } } 19-\u6d4b\u8bd5 11:48 \u00b6 \u542f\u52a8ArticleApplication BehaviorApplication AppGatewayApplication UserApplication \u524d\u7aef\u5de5\u7a0b \u7ed9\u51fa\u7684\u6d4b\u8bd5\u811a\u672c\u5b58\u5728\u95ee\u9898\uff0c\u6267\u884c\u4e0b\u9762\u4e24\u884c\u4ee3\u7801\u4fee\u590d\u7f3a\u5931\u7684\u8868\u6570\u636e\uff1a INSERT INTO ap_article_config ( article_id , is_comment , is_forward , is_down , is_delete ) SELECT id , 1 , 0 , 0 , 0 FROM ap_article INSERT INTO ap_article_content ( article_id , content ) SELECT id , '[{\"type\":\"text\",\"value\":\"\u6d4b\u8bd5\u81ea\u52a8\u5ba1\u6838\"},{\"type\":\"text\",\"value\":\"\u8bf7\u8f93\u5165\u6587\u7ae0\u5185\u5bb9...\"}]' FROM ap_article 20-\u8ba1\u7b97\u6587\u7ae0\u7684\u5206\u503c 15:30 \u00b6 \u8bb2\u4e49\u548c\u89c6\u9891\u4e2d\u4ee3\u7801\u5747\u6709\u8bef\uff1a package com.heima.article.service.impl ; import com.alibaba.fastjson.JSON ; import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl ; import com.heima.article.mapper.ApArticleMapper ; import com.heima.article.service.ApArticleService ; import com.heima.common.constans.article.ArticleConstans ; import com.heima.model.article.dtos.ArticleHomeDto ; import com.heima.model.article.mess.ArticleVisitStreamMess ; import com.heima.model.article.pojos.ApArticle ; import com.heima.model.article.vo.HotArticleVo ; import com.heima.model.common.dtos.ResponseResult ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.BeanUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.data.redis.core.StringRedisTemplate ; import org.springframework.stereotype.Service ; import java.util.Date ; import java.util.List ; @Service public class ApArticleServiceImpl extends ServiceImpl < ApArticleMapper , ApArticle > implements ApArticleService { // \u5355\u9875\u6700\u5927\u52a0\u8f7d\u7684\u6570\u5b57 private final static short MAX_PAGE_SIZE = 50 ; @Autowired private ApArticleMapper apArticleMapper ; @Value ( \"${fdfs.url}\" ) private String fileServerUrl ; @Override public ResponseResult load ( ArticleHomeDto dto , Short loadType ) { //1.\u6821\u9a8c\u53c2\u6570 Integer size = dto . getSize (); if ( size == null || size == 0 ) { size = 10 ; } size = Math . min ( size , MAX_PAGE_SIZE ); dto . setSize ( size ); //\u7c7b\u578b\u53c2\u6570\u68c0\u9a8c if ( ! loadType . equals ( ArticleConstans . LOADTYPE_LOAD_MORE ) && ! loadType . equals ( ArticleConstans . LOADTYPE_LOAD_NEW )) { loadType = ArticleConstans . LOADTYPE_LOAD_MORE ; } //\u6587\u7ae0\u9891\u9053\u6821\u9a8c if ( StringUtils . isEmpty ( dto . getTag ())) { dto . setTag ( ArticleConstans . DEFAULT_TAG ); } //\u65f6\u95f4\u6821\u9a8c if ( dto . getMaxBehotTime () == null ) dto . setMaxBehotTime ( new Date ()); if ( dto . getMinBehotTime () == null ) dto . setMinBehotTime ( new Date ()); //2.\u67e5\u8be2\u6570\u636e List < ApArticle > apArticles = apArticleMapper . loadArticleList ( dto , loadType ); //3.\u7ed3\u679c\u5c01\u88c5 ResponseResult responseResult = ResponseResult . okResult ( apArticles ); responseResult . setHost ( fileServerUrl ); return responseResult ; } @Autowired private StringRedisTemplate redisTemplate ; @Override public void updateArticle ( ArticleVisitStreamMess mess ) { //1.\u67e5\u8be2\u5f53\u524d\u6587\u7ae0\u6570\u636e ApArticle apArticle = getById ( mess . getArticleId ()); //2.\u4fee\u6539\u6587\u7ae0 apArticle . setViews (( int ) ( apArticle . getViews () == null ? 0 : apArticle . getViews () + mess . getView ())); apArticle . setComment (( int ) ( apArticle . getComment () == null ? 0 : apArticle . getComment () + mess . getComment ())); apArticle . setCollection (( int ) ( apArticle . getCollection () == null ? 0 : apArticle . getCollection () + mess . getCollect ())); apArticle . setLikes (( int ) ( apArticle . getLikes () == null ? 0 : apArticle . getLikes () + mess . getLike ())); //3.\u8ba1\u7b97\u5206\u503c Integer score = computeScore ( apArticle ); score = score * 3 ; //4.\u67e5\u8be2redis\u4e2d\u7684\u6570\u636e String jsonStr = redisTemplate . opsForValue (). get ( ArticleConstans . HOT_ARTICLE_FIRST_PAGE + apArticle . getChannelId ()); if ( StringUtils . isNotBlank ( jsonStr )) { //boolean flag = true; //5.\u5224\u65ad\u5f53\u524d\u6587\u7ae0\u5206\u503c\u662f\u5426\u5927\u4e8e\u7f13\u5b58\u4e2d\u7684\u67d0\u4e00\u6761\u6570\u636e //\u5982\u679c\u5927\u4e8e\uff0c\u5c31\u66ff\u6362\u7f13\u5b58\u4e2d\u7684\u8fd9\u4e00\u6761\u6570\u636e List < HotArticleVo > hotArticleVoList = JSON . parseArray ( jsonStr , HotArticleVo . class ); if ( ! hotArticleVoList . isEmpty () && hotArticleVoList . size () > 0 ) { for ( HotArticleVo hotArticleVo : hotArticleVoList ) { //\u5982\u679c\u6570\u636e\u4e2d\u5b58\u5728\u8fd9\u4e2aid\uff0c\u5224\u65ad\u5206\u6570\u662f\u5426\u66f4\u9ad8 if ( hotArticleVo . getId (). equals ( apArticle . getId ()) && ( hotArticleVo . getScore () == null || hotArticleVo . getScore () < score )) { //flag = false; //\u590d\u5236\u6240\u6709\u5c5e\u6027 BeanUtils . copyProperties ( apArticle , hotArticleVo ); //\u8bbe\u7f6e\u5206\u6570 hotArticleVo . setScore ( score ); //\u66f4\u65b0redis redisTemplate . opsForValue (). set ( ArticleConstans . HOT_ARTICLE_FIRST_PAGE + apArticle . getChannelId (), JSON . toJSONString ( hotArticleVoList )); break ; } } // if(flag){ // for (HotArticleVo hotArticleVo : hotArticleVoList) { // if ((hotArticleVo.getScore()==null ? 0:hotArticleVo.getScore()) < score ) { // hotArticleVoList.remove(hotArticleVo); // HotArticleVo hot = new HotArticleVo(); // BeanUtils.copyProperties(apArticle, hot); // hotArticleVo.setScore(score); // hotArticleVoList.add(hot); // redisTemplate.opsForValue().set(ArticleConstans.HOT_ARTICLE_FIRST_PAGE + apArticle.getChannelId(), JSON.toJSONString(hotArticleVoList)); // break; // } // } // } } } updateById ( apArticle ); } /** * \u67e5\u627e\u70ed\u70b9\u6570\u636e\u5e76\u4e14\u66ff\u6362 * @param apArticle * @param score * @param hotArticleVoList * @param hotArticleVo */ private void findHotAndCache ( ApArticle apArticle , Integer score , List < HotArticleVo > hotArticleVoList , HotArticleVo hotArticleVo ) { } /** * \u8ba1\u7b97\u5206\u503c * * @param apArticle * @return */ private Integer computeScore ( ApArticle apArticle ) { Integer score = 0 ; if ( apArticle . getLikes () != null ) { score += apArticle . getLikes () * ArticleConstans . HOT_ARTICLE_LIKE_WEIGHT ; } if ( apArticle . getViews () != null ) { score += apArticle . getViews (); } if ( apArticle . getComment () != null ) { score += apArticle . getComment () * ArticleConstans . HOT_ARTICLE_COMMENT_WEIGHT ; } if ( apArticle . getCollection () != null ) { score += apArticle . getCollection () * ArticleConstans . HOT_ARTICLE_COLLECTION_WEIGHT ; } return score ; } @Override public ResponseResult load2 ( ArticleHomeDto dto , Short loadType , boolean firstPage ) { if ( firstPage ){ String jsonStr = redisTemplate . opsForValue (). get ( ArticleConstans . HOT_ARTICLE_FIRST_PAGE + dto . getTag ()); if ( StringUtils . isNotBlank ( jsonStr )){ List < HotArticleVo > hotArticleVoList = JSON . parseArray ( jsonStr , HotArticleVo . class ); if ( ! hotArticleVoList . isEmpty () && hotArticleVoList . size () > 0 ){ ResponseResult responseResult = ResponseResult . okResult ( hotArticleVoList ); responseResult . setHost ( fileServerUrl ); return responseResult ; } } } return load ( dto , loadType ); } } \u7ec3\u4e60\uff1a\u5206\u6570\u4fee\u6539\u540e\uff0c\u6392\u5e8f\u5c31\u4e0d\u4e00\u5b9a\u5408\u9002\u4e86\u3002\u53ef\u4ee5\u4f7f\u7528list\u96c6\u5408\u6392\u5e8f\u529f\u80fd\u91cd\u65b0\u6392\u5e8f\u4e00\u4e0b\u3002 //\u5f53\u524d\u6587\u7ae0\u5982\u679c\u4e0d\u5b58\u5728redis\u4e2d\uff0c\u76f4\u63a5\u653e\u5230\u961f\u5c3e\uff0c\u6392\u5e8f\uff0c\u53d6\u524d30 //\u5982\u679c\u6587\u7ae0\u5b58\u5728\uff0c\u6392\u5e8f if ( ! flag ){ //\u6587\u7ae0\u4e0d\u5b58\u5728 HotArticleVo hotArticleVo = new HotArticleVo (); BeanUtils . copyProperties ( apArticle , hotArticleVo ); hotArticleVo . setScore ( score ); hotArticleVoList . add ( hotArticleVo ); } hotArticleVoList = hotArticleVoList . stream (). sorted ( Comparator . comparing ( HotArticleVo :: getScore ). reversed ()). collect ( Collectors . toList ()); if ( ! flag ){ hotArticleVoList = hotArticleVoList . subList ( 0 , 30 ); } redisTemplate . opsForValue (). set ( ArticleConstans . HOT_ARTICLE_FIRST_PAGE + apArticle . getChannelId (), JSON . toJSONString ( hotArticleVoList )); 21-\u76d1\u542c\u6570\u636e\u6574\u4f53\u6d4b\u8bd5 07:01 \u00b6 package com.heima.article.kafka.listener ; import com.alibaba.fastjson.JSON ; import com.heima.article.service.ApArticleService ; import com.heima.common.constans.message.HotArticleConstants ; import com.heima.model.article.mess.ArticleVisitStreamMess ; import org.apache.kafka.clients.consumer.ConsumerRecord ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.kafka.annotation.KafkaListener ; import org.springframework.stereotype.Component ; import java.util.Optional ; @Component public class ArticleIncrHandleListener { @Autowired private ApArticleService articleService ; @KafkaListener ( topics = HotArticleConstants . HOT_ARTICLE_INCR_HANDLE_TOPIC ) public void receiveMessage ( ConsumerRecord < String , String > record ){ Optional <? extends ConsumerRecord <? , ?>> optional = Optional . ofNullable ( record ); if ( optional . isPresent ()){ String value = record . value (); ArticleVisitStreamMess mess = JSON . parseObject ( value , ArticleVisitStreamMess . class ); articleService . updateArticle ( mess ); } } } 22-\u67e5\u8be2\u70ed\u70b9\u6570\u636e 07:04 \u00b6 @Override public ResponseResult load2 ( ArticleHomeDto dto , Short loadType , boolean firstPage ) { if ( firstPage ){ //\u83b7\u53d6\u5bf9\u5e94\u7684redis\u4e2d\u7f13\u5b58\u7684\u70ed\u70b9\u6587\u7ae0 String jsonStr = redisTemplate . opsForValue (). get ( ArticleConstans . HOT_ARTICLE_FIRST_PAGE + dto . getTag ()); //[{},{},{}] ->String if ( StringUtils . isNotBlank ( jsonStr )){ //\u8fd8\u539f\u6210list List < HotArticleVo > hotArticleVoList = JSON . parseArray ( jsonStr , HotArticleVo . class ); if ( ! hotArticleVoList . isEmpty ()){ ResponseResult responseResult = ResponseResult . okResult ( hotArticleVoList ); responseResult . setHost ( fileServerUrl ); return responseResult ; } } } return load ( dto , loadType ); } 23-\u6d4b\u8bd5\u5b9e\u65f6\u6570\u636e 07:04 \u00b6","title":"day13"},{"location":"hmtt/day13/#01-_0119","text":"\u80fd\u591f\u7406\u89e3\u4ec0\u4e48\u662f\u5b9e\u65f6\u6d41\u5f0f\u8ba1\u7b97 \u80fd\u591f\u7406\u89e3kafkaStream\u5904\u7406\u5b9e\u65f6\u6d41\u5f0f\u8ba1\u7b97\u7684\u6d41\u7a0b \u80fd\u591f\u5b8c\u6210kafkaStream\u5b9e\u65f6\u6d41\u5f0f\u8ba1\u7b97\u7684\u5165\u95e8\u6848\u4f8b \u80fd\u591f\u5b8c\u6210app\u7aef\u70ed\u70b9\u6587\u7ae0\u8ba1\u7b97\u7684\u529f\u80fd \u80fd\u591f\u5b8c\u6210app\u7aef\u6587\u7ae0\u5217\u8868\u63a5\u53e3\u7684\u4f18\u5316\u6539\u9020","title":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 01:19"},{"location":"hmtt/day13/#02-_0546","text":"\u6279\u5904\u7406/\u6d41\u5f0f\u5b9e\u65f6\u5904\u7406 \u6d41\u5f0f\u8ba1\u7b97\u662f\u6e90\u6e90\u4e0d\u65ad\u7684\u63a5\u6536\u6570\u636e\uff0c\u901a\u8fc7\u4e00\u5b9a\u7b97\u6cd5\u6e90\u6e90\u4e0d\u65ad\u7684\u4ea7\u751f\u6570\u636e\u3002","title":"02-\u5b9e\u65f6\u6d41\u5f0f\u8ba1\u7b97\u6982\u5ff5\u4ecb\u7ecd 05:46"},{"location":"hmtt/day13/#_1","text":"\u65e5\u5fd7\u5206\u6790 \u7f51\u7ad9\u7684\u7528\u6237\u8bbf\u95ee\u65e5\u5fd7\u8fdb\u884c\u5b9e\u65f6\u7684\u5206\u6790\uff0c\u8ba1\u7b97\u8bbf\u95ee\u91cf\uff0c\u7528\u6237\u753b\u50cf\uff0c\u7559\u5b58\u7387\u7b49\u7b49\uff0c\u5b9e\u65f6\u7684\u8fdb\u884c\u6570\u636e\u5206\u6790\uff0c\u5e2e\u52a9\u4f01\u4e1a\u8fdb\u884c\u51b3\u7b56 \u5927\u5c4f\u770b\u677f\u7edf\u8ba1 \u53ef\u4ee5\u5b9e\u65f6\u7684\u67e5\u770b\u7f51\u7ad9\u6ce8\u518c\u6570\u91cf\uff0c\u8ba2\u5355\u6570\u91cf\uff0c\u8d2d\u4e70\u6570\u91cf\uff0c\u91d1\u989d\u7b49\u3002 \u516c\u4ea4\u5b9e\u65f6\u6570\u636e \u53ef\u4ee5\u968f\u65f6\u66f4\u65b0\u516c\u4ea4\u8f66\u65b9\u4f4d\uff0c\u8ba1\u7b97\u591a\u4e45\u5230\u8fbe\u7ad9\u724c\u7b49 \u5b9e\u65f6\u6587\u7ae0\u5206\u503c\u8ba1\u7b97 \u5934\u6761\u7c7b\u6587\u7ae0\u7684\u5206\u503c\u8ba1\u7b97\uff0c\u901a\u8fc7\u7528\u6237\u7684\u884c\u4e3a\u5b9e\u65f6\u6587\u7ae0\u7684\u5206\u503c\uff0c\u5206\u503c\u8d8a\u9ad8\u5c31\u8d8a\u88ab\u63a8\u8350\u3002","title":"\u5e94\u7528\u573a\u666f"},{"location":"hmtt/day13/#_2","text":"\u4ea7\u54c1 \u6a21\u578b API \u4fdd\u8bc1\u6b21\u6570 \u5bb9\u9519\u673a\u5236 \u72b6\u6001\u7ba1\u7406 \u5ef6\u65f6 \u541e\u5410\u91cf Storm Native\uff08\u6570\u636e\u8fdb\u5165\u7acb\u5373\u5904\u7406\uff09 \u7ec4\u5408\u5f0f\uff08\u57fa\u7840API\uff09 At-least-once \uff08\u81f3\u5c11\u4e00\u6b21\uff09 Record ACK\uff08ACK\u673a\u5236\uff09 \u65e0 \u4f4e \u4f4e Trident Micro-Batching\uff08\u5212\u5206\u4e3a\u5c0f\u6279 \u5904\u7406\uff09 \u7ec4\u5408\u5f0f Exactly-once \uff08\u4ec5\u4e00\u6b21\uff09 Record ACK \u57fa\u4e8e\u64cd\u4f5c\uff08\u6bcf\u6b21\u64cd\u4f5c\u6709\u4e00\u4e2a\u72b6\u6001\uff09 \u4e2d\u7b49 \u4e2d\u7b49 Spark Streaming Micro-Batching \u58f0\u660e\u5f0f\uff08\u63d0\u4f9b\u5c01\u88c5\u540e\u7684\u9ad8\u9636\u51fd\u6570\uff0c\u5982count\u51fd\u6570\uff09 Exactly-once RDD CheckPoint\uff08\u57fa\u4e8eRDD\u505aCheckPoint\uff09 \u57fa\u4e8eDStream \u4e2d\u7b49 \u9ad8 Flink Native \u58f0\u660e\u5f0f Exactly-once CheckPoint\uff08Flink\u7684\u4e00\u79cd\u5feb\u7167\uff09 \u57fa\u4e8e\u64cd\u4f5c \u4f4e \u9ad8","title":"\u6280\u672f\u65b9\u6848\u9009\u578b"},{"location":"hmtt/day13/#03-kafka_streams_0608","text":"Kafka Stream\u662fApache Kafka\u4ece0.10\u7248\u672c\u5f15\u5165\u7684\u4e00\u4e2a\u65b0Feature\u3002\u5b83\u662f\u63d0\u4f9b\u4e86\u5bf9\u5b58\u50a8\u4e8eKafka\u5185\u7684\u6570\u636e\u8fdb\u884c\u6d41\u5f0f\u5904\u7406\u548c\u5206\u6790\u7684\u529f\u80fd\u3002 Kafka Stream\u7684\u7279\u70b9\u5982\u4e0b\uff1a Kafka Stream\u63d0\u4f9b\u4e86\u4e00\u4e2a\u975e\u5e38\u7b80\u5355\u800c\u8f7b\u91cf\u7684Library\uff0c\u5b83\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u5d4c\u5165\u4efb\u610fJava\u5e94\u7528\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u4efb\u610f\u65b9\u5f0f\u6253\u5305\u548c\u90e8\u7f72 \u9664\u4e86Kafka\u5916\uff0c\u65e0\u4efb\u4f55\u5916\u90e8\u4f9d\u8d56 \u5145\u5206\u5229\u7528Kafka\u5206\u533a\u673a\u5236\u5b9e\u73b0\u6c34\u5e73\u6269\u5c55\u548c\u987a\u5e8f\u6027\u4fdd\u8bc1 \u901a\u8fc7\u53ef\u5bb9\u9519\u7684state store\u5b9e\u73b0\u9ad8\u6548\u7684\u72b6\u6001\u64cd\u4f5c\uff08\u5982windowed join\u548caggregation\uff09 \u652f\u6301\u6b63\u597d\u4e00\u6b21\u5904\u7406\u8bed\u4e49 \u63d0\u4f9b\u8bb0\u5f55\u7ea7\u7684\u5904\u7406\u80fd\u529b\uff0c\u4ece\u800c\u5b9e\u73b0\u6beb\u79d2\u7ea7\u7684\u4f4e\u5ef6\u8fdf \u652f\u6301\u57fa\u4e8e\u4e8b\u4ef6\u65f6\u95f4\u7684\u7a97\u53e3\u64cd\u4f5c\uff0c\u5e76\u4e14\u53ef\u5904\u7406\u665a\u5230\u7684\u6570\u636e\uff08late arrival of records\uff09 \u540c\u65f6\u63d0\u4f9b\u5e95\u5c42\u7684\u5904\u7406\u539f\u8bedProcessor\uff08\u7c7b\u4f3c\u4e8eStorm\u7684spout\u548cbolt\uff09\uff0c\u4ee5\u53ca\u9ad8\u5c42\u62bd\u8c61\u7684DSL\uff08\u7c7b\u4f3c\u4e8eSpark\u7684map/group/reduce\uff09 \uff081\uff09Stream\u5904\u7406\u62d3\u6251 \u6d41 \u662fKafka Stream\u63d0\u51fa\u7684\u6700\u91cd\u8981\u7684\u62bd\u8c61\u6982\u5ff5\uff1a\u5b83\u8868\u793a\u4e00\u4e2a\u65e0\u9650\u7684\uff0c\u4e0d\u65ad\u66f4\u65b0\u7684\u6570\u636e\u96c6\u3002\u6d41\u662f\u4e00\u4e2a\u6709\u5e8f\u7684\uff0c\u53ef\u91cd\u653e\uff08\u53cd\u590d\u7684\u4f7f\u7528\uff09\uff0c\u4e0d\u53ef\u53d8\u7684\u5bb9\u9519\u5e8f\u5217\uff0c\u6570\u636e\u8bb0\u5f55\u7684\u683c\u5f0f\u662f\u952e\u503c\u5bf9\uff08key-value\uff09\u3002 \u901a\u8fc7Kafka Streams\u7f16\u5199\u4e00\u4e2a\u6216\u591a\u4e2a\u7684\u8ba1\u7b97\u903b\u8f91\u7684\u5904\u7406\u5668\u62d3\u6251\u3002\u5176\u4e2d\u5904\u7406\u5668\u62d3\u6251\u662f\u4e00\u4e2a\u7531\u6d41\uff08\u8fb9\u7f18\uff09\u8fde\u63a5\u7684\u6d41\u5904\u7406\uff08\u8282\u70b9\uff09\u7684\u56fe\u3002 \u6d41\u5904\u7406\u5668 \u662f \u5904\u7406\u5668\u62d3\u6251 \u4e2d\u7684\u4e00\u4e2a\u8282\u70b9\uff1b\u5b83\u8868\u793a\u4e00\u4e2a\u5904\u7406\u7684\u6b65\u9aa4\uff0c\u7528\u6765\u8f6c\u6362\u6d41\u4e2d\u7684\u6570\u636e\uff08\u4ece\u62d3\u6251\u4e2d\u7684\u4e0a\u6e38\u5904\u7406\u5668\u4e00\u6b21\u63a5\u53d7\u4e00\u4e2a\u8f93\u5165\u6d88\u606f\uff0c\u5e76\u4e14\u968f\u540e\u4ea7\u751f\u4e00\u4e2a\u6216\u591a\u4e2a\u8f93\u51fa\u6d88\u606f\u5230\u5176\u4e0b\u6e38\u5904\u7406\u5668\u4e2d\uff09\u3002 \uff082\uff09\u5728\u62d3\u6251\u4e2d\u6709\u4e24\u4e2a\u7279\u522b\u7684\u5904\u7406\u5668\uff1a \u6e90\u5904\u7406\u5668\uff08Source Processor\uff09 \uff1a\u6e90\u5904\u7406\u5668\u662f\u4e00\u4e2a\u6ca1\u6709\u4efb\u4f55\u4e0a\u6e38\u5904\u7406\u5668\u7684\u7279\u6b8a\u7c7b\u578b\u7684\u6d41\u5904\u7406\u5668\u3002\u5b83\u4ece\u4e00\u4e2a\u6216\u591a\u4e2akafka\u4e3b\u9898\u751f\u6210\u8f93\u5165\u6d41\u3002\u901a\u8fc7\u6d88\u8d39\u8fd9\u4e9b\u4e3b\u9898\u7684\u6d88\u606f\u5e76\u5c06\u5b83\u4eec\u8f6c\u53d1\u5230\u4e0b\u6e38\u5904\u7406\u5668\u3002 Sink\u5904\u7406\u5668 \uff1asink\u5904\u7406\u5668\u662f\u4e00\u4e2a\u6ca1\u6709\u4e0b\u6e38\u6d41\u5904\u7406\u5668\u7684\u7279\u6b8a\u7c7b\u578b\u7684\u6d41\u5904\u7406\u5668\u3002\u5b83\u63a5\u6536\u4e0a\u6e38\u6d41\u5904\u7406\u5668\u7684\u6d88\u606f\u53d1\u9001\u5230\u4e00\u4e2a\u6307\u5b9a\u7684 Kafka\u4e3b\u9898 \u3002","title":"03-Kafka Streams\u7684\u6982\u5ff5\u4ecb\u7ecd 06:08"},{"location":"hmtt/day13/#04-kstream_ktable_0349","text":"","title":"04-KStream KTable  03:49"},{"location":"hmtt/day13/#kstream","text":"\u4e00\u4e2a\u7eaf\u7cb9\u7684\u6d41\u5c31\u662f\u6240\u6709\u7684\u66f4\u65b0\u90fd\u88ab\u89e3\u91ca\u6210INSERT\u8bed\u53e5(\u56e0\u4e3a\u6ca1\u6709\u8bb0\u5f55\u4f1a\u66ff\u6362\u5df2\u6709\u7684\u8bb0\u5f55)\u7684\u8868\u3002 \u5728\u4e00\u4e2a\u6d41\u4e2d(KStream)\uff0c\u6bcf\u4e2akey-value\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u4fe1\u606f\u7247\u65ad\uff0c\u6bd4\u5982\uff0c\u7528\u6237\u8d2d\u4e70\u6d41\u662f\uff1aalice->\u9ec4\u6cb9\uff0cbob->\u9762\u5305\uff0calice->\u5976\u916a\u9762\u5305\uff0c\u6211\u4eec\u77e5\u9053alice\u65e2\u4e70\u4e86\u9ec4\u6cb9\uff0c\u53c8\u4e70\u4e86\u5976\u916a\u9762\u5305\u3002","title":"KStream\uff1a"},{"location":"hmtt/day13/#ktablechangelog","text":"KTable \u4e00\u5f20\u8868\u5c31\u662f\u4e00\u4e2a\u6240\u6709\u7684\u6539\u53d8\u90fd\u88ab\u89e3\u91ca\u6210UPDATE\u7684\u6d41(\u56e0\u4e3a\u6240\u6709\u4f7f\u7528\u540c\u6837\u7684key\u7684\u5df2\u5b58\u5728\u7684\u884c\u90fd\u4f1a\u88ab\u8986\u76d6)\u3002 \u5bf9\u4e8e\u4e00\u4e2a\u8868table( KTable)\uff0c\u662f\u4ee3\u8868\u4e00\u4e2a\u53d8\u5316\u65e5\u5fd7\uff0c\u5982\u679c\u8868\u5305\u542b\u4e24\u5bf9\u540c\u6837key\u7684key-value\u503c\uff0c\u540e\u8005\u4f1a\u8986\u76d6\u524d\u9762\u7684\u8bb0\u5f55\uff0c\u56e0\u4e3akey\u503c\u4e00\u6837\u7684\uff0c\u6bd4\u5982\u7528\u6237\u5730\u5740\u8868\uff1aalice -> \u7ebd\u7ea6, bob -> \u65e7\u91d1\u5c71, alice -> \u829d\u52a0\u54e5\uff0c\u610f\u5473\u7740Alice\u4ece\u7ebd\u7ea6\u8fc1\u79fb\u5230\u829d\u52a0\u54e5\uff0c\u800c\u4e0d\u662f\u540c\u65f6\u5c45\u4f4f\u5728\u4e24\u4e2a\u5730\u65b9\u3002 KTable \u8fd8\u63d0\u4f9b\u4e86\u901a\u8fc7key\u67e5\u627e\u6570\u636e\u503c\u5f97\u529f\u80fd\uff0c\u8be5\u67e5\u627e\u529f\u80fd\u53ef\u4ee5\u7528\u5728Join\u7b49\u529f\u80fd\u4e0a\u3002","title":"KTable(changelog\u6d41)\uff1a"},{"location":"hmtt/day13/#05-_1614","text":"package com.itheima.kafka.simple ; import org.apache.kafka.common.serialization.Serdes ; import org.apache.kafka.streams.* ; import org.apache.kafka.streams.kstream.* ; import java.util.Arrays ; import java.util.Properties ; /** * \u9700\u6c42\uff1a * \u63a5\u6536kafka\u6d88\u606f\u5185\u5bb9\u5e76\u8ba1\u7b97\u6d88\u606f\u5185\u5355\u8bcd\u7684\u4e2a\u6570 * \u5982\uff1a * hello kafka stareams * hello heima kafka * hello beijing heima kafka * * \u7ed3\u679c\uff1a * hello 3 * kafka 3 * streams 1 * heima 2 * beijing 1 */ public class KafkaStreamFastStart { public static void main ( String [] args ) { //kafka\u914d\u7f6e\u4fe1\u606f Properties prop = new Properties (); prop . put ( StreamsConfig . BOOTSTRAP_SERVERS_CONFIG , \"192.168.200.130:9092\" ); prop . put ( StreamsConfig . DEFAULT_KEY_SERDE_CLASS_CONFIG , Serdes . String (). getClass ()); prop . put ( StreamsConfig . DEFAULT_VALUE_SERDE_CLASS_CONFIG , Serdes . String (). getClass ()); prop . put ( StreamsConfig . APPLICATION_ID_CONFIG , \"streams-faststart\" ); //stream\u6784\u5efa\u5668 StreamsBuilder builder = new StreamsBuilder (); //\u6d41\u5f0f\u8ba1\u7b97 group ( builder ); //\u521b\u5efakafkaStream KafkaStreams kafkaStreams = new KafkaStreams ( builder . build (), prop ); //\u5f00\u542fkafka\u6d41\u8ba1\u7b97 kafkaStreams . start (); } /** * \u5b9e\u65f6\u6d41\u5f0f\u8ba1\u7b97 * @param builder */ private static void group ( StreamsBuilder builder ) { //\u63a5\u6536\u4e0a\u6e38\u5904\u7406\u5668\u7684\u6d88\u606f KStream < String , String > stream = builder . stream ( \"input_topic\" ); KStream < String , String > map = stream . flatMapValues ( new ValueMapper < String , Iterable < String >> () { /** * \u628a\u6d88\u606f\u4e2d\u7684\u8bcd\u7ec4\uff0c\u8f6c\u6362\u4e3a\u4e00\u4e2a\u4e00\u4e2a\u7684\u5355\u8bcd\u653e\u5230\u96c6\u5408\u4e2d * @param value * @return */ @Override public Iterable < String > apply ( String value ) { return Arrays . asList ( value . split ( \" \" )); } }). map ( new KeyValueMapper < String , String , KeyValue < String , String >> () { /** * \u628a\u6d88\u606f\u7684key,\u91cd\u65b0\u8d4b\u503c\uff0c\u76ee\u524d\u6d88\u606f\u7684key,\u5c31\u662f\u4e00\u4e2a\u4e2a\u7684\u5355\u8bcd\uff0c\u628a\u5355\u8bcd\u4f5c\u4e3akey\u8fdb\u884c\u805a\u5408 * @param key * @param value * @return */ @Override public KeyValue < String , String > apply ( String key , String value ) { return new KeyValue <> ( value , value ); } }) //\u6839\u636ekey\u8fdb\u884c\u5206\u7ec4 \u76ee\u524d\u7684key \u5c31\u662fvalue,\u5c31\u662f\u4e00\u4e2a\u4e2a\u7684\u5355\u8bcd . groupByKey () //\u805a\u5408\u7684\u65f6\u95f4\u7a97\u53e3 \u591a\u4e45\u805a\u5408\u4e00\u6b21 . windowedBy ( TimeWindows . of ( 10000 )) //\u805a\u5408 \u6c42\u5355\u8bcd\u7684\u4e2a\u6570\uff0c\u8c03\u7528count\u540e\uff0c\u6d88\u606f\u7684vlaue\u662f\u805a\u5408\u5355\u8bcd\u540e\u7684\u7edf\u8ba1\u6570\u503c \u662f\u4e00\u4e2along\u7c7b\u578b //Materialized.as(\"count-article-num-001\") \u662f\u5f53\u524d\u6d88\u606f\u7684\u72b6\u6001\u503c\uff0c\u4e0d\u91cd\u590d\u5373\u53ef . count ( Materialized . as ( \"count-article-num-001\" )) //\u8f6c\u6362\u6210 Kstream . toStream () //\u628a\u5904\u7406\u540e\u7684key\u548cvalue\u8f6c\u6210string . map (( key , value ) -> { return new KeyValue <> ( key . key (). toString (), value . toString ()); }); //\u5904\u7406\u540e\u7684\u7ed3\u679c\uff0c\u53d1\u9001\u7ed9\u4e0b\u6e38\u5904\u7406\u5668 map . to ( \"out_topic\" ); } }","title":"05-\u5165\u95e8\u6848\u4f8b\u7f16\u5199 16:14"},{"location":"hmtt/day13/#06-_1110","text":"\u4e0a\u8ff0\u4ee3\u7801\u6709\u4e25\u91cd\u95ee\u9898\uff0c\u7edf\u8ba1\u8fc7\u7a0b\u4e2d\u5e94\u8be5\u662f\u62ff\u4e0a\u6b21\u7684\u7ed3\u679c\u4e0e\u8fd9\u6b21\u7684\u7ed3\u679c\u8fdb\u884c\u7d2f\u52a0\uff0c\u4fee\u590d\u5982\u4e0b\uff1a \u53d1\u9001\u65b9\uff1a package com.itheima.kafka.simple ; import org.apache.kafka.clients.producer.* ; import org.apache.kafka.common.protocol.types.Field ; import java.util.Properties ; /** * \u6d88\u606f\u751f\u4ea7\u8005 */ public class ProducerFastStart { private static final String INPUT_TOPIC = \"input_topic_1\" ; public static void main ( String [] args ) throws InterruptedException { //\u6dfb\u52a0kafka\u7684\u914d\u7f6e\u4fe1\u606f Properties properties = new Properties (); //\u914d\u7f6ebroker\u4fe1\u606f properties . put ( \"bootstrap.servers\" , \"192.168.226.134:9092\" ); properties . put ( ProducerConfig . KEY_SERIALIZER_CLASS_CONFIG , \"org.apache.kafka.common.serialization.StringSerializer\" ); properties . put ( ProducerConfig . VALUE_SERIALIZER_CLASS_CONFIG , \"org.apache.kafka.common.serialization.StringSerializer\" ); properties . put ( ProducerConfig . RETRIES_CONFIG , 10 ); //\u751f\u4ea7\u8005\u5bf9\u8c61 KafkaProducer < String , String > producer = new KafkaProducer < String , String > ( properties ); while ( true ){ //\u5c01\u88c5\u6d88\u606f ProducerRecord < String , String > record = new ProducerRecord < String , String > ( INPUT_TOPIC , \"00001\" , \"hello,kafka\" ); //\u53d1\u9001\u6d88\u606f try { /*RecordMetadata recordMetadata = producer.send(record).get(); System.out.println(recordMetadata.offset());*/ producer . send ( record , new Callback () { @Override public void onCompletion ( RecordMetadata recordMetadata , Exception e ) { if ( e != null ){ e . printStackTrace (); } System . out . println ( recordMetadata . offset ()); } }); } catch ( Exception e ){ e . printStackTrace (); } Thread . sleep ( 1000 ); } //\u5173\u7cfb\u6d88\u606f\u901a\u9053 //producer.close(); } } \u8fd9\u91cc\u4e00\u76f4\u53d1\u9001\uff0c\u6bcf\u6b21\u53d1\u9001\u95f4\u96941\u79d2 \u6d41\u5f0f\u5904\u7406\uff1a package com.itheima.kafka.simple ; import org.apache.kafka.common.serialization.Serdes ; import org.apache.kafka.streams.* ; import org.apache.kafka.streams.kstream.* ; import org.springframework.util.StringUtils ; import java.util.Arrays ; import java.util.List ; import java.util.Properties ; public class KafkaStreamSample { public static final String INPUT_TOPIC = \"input_topic_1\" ; public static final String OUT_TOPIC = \"out_topic\" ; public static void main ( String [] args ) { //\u6dfb\u52a0kafka\u914d\u7f6e\u4fe1\u606f Properties prop = new Properties (); //\u8bbe\u7f6ekafka\u670d\u52a1\u5668\u5730\u5740 prop . put ( StreamsConfig . BOOTSTRAP_SERVERS_CONFIG , \"192.168.226.134:9092\" ); //\u8bbe\u7f6e\u5e94\u7528\u540d\uff0c\u53ef\u4ee5\u81ea\u5df1\u5b9a\u4e49 prop . put ( StreamsConfig . APPLICATION_ID_CONFIG , \"kafka-stream-sample\" ); //\u6307\u5b9akey\u7684\u7c7b\u578b prop . put ( StreamsConfig . DEFAULT_KEY_SERDE_CLASS_CONFIG , Serdes . String (). getClass ()); //\u6307\u5b9avalue\u7684\u7c7b\u578b prop . put ( StreamsConfig . DEFAULT_VALUE_SERDE_CLASS_CONFIG , Serdes . String (). getClass ()); StreamsBuilder builder = new StreamsBuilder (); //\u6784\u5efa\u8fc7\u6ee4\u7684\u805a\u5408\u6761\u4ef6 group ( builder ); KafkaStreams streams = new KafkaStreams ( builder . build (), prop ); streams . start (); } /** * \u5b9a\u4e49\u6d41\u5f0f\u8ba1\u7b97\u7684\u8fc7\u7a0b * * @param builder */ private static void group ( StreamsBuilder builder ) { //\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u8f93\u5165\u6570\u636e\u6240\u5728\u7684topic //\u7b2c\u4e8c\u4e2a\u53c2\u6570 \u5f53\u5404\u5206\u533a\u4e0b\u6709\u5df2\u63d0\u4ea4\u7684offset\u65f6\uff0c\u4ece\u63d0\u4ea4\u7684offset\u5f00\u59cb\u6d88\u8d39\uff1b\u65e0\u63d0\u4ea4\u7684offset\u65f6\uff0c\u6d88\u8d39\u65b0\u4ea7\u751f\u7684\u8be5\u5206\u533a\u4e0b\u7684\u6570\u636e KStream < String , String > stream = builder . stream ( INPUT_TOPIC , Consumed . with ( Topology . AutoOffsetReset . LATEST )); KStream < String , String > map = stream . groupByKey () //\u65f6\u95f4\u7a97\u53e3 10s\u805a\u5408\u4e00\u6b21\u6570\u636e . windowedBy ( TimeWindows . of ( 10000 )) . aggregate ( new Initializer < String > () { @Override public String apply () { return \"0\" ; } }, new Aggregator < String , String , String > () { /** * * @param key \u63a5\u6536\u5230\u7684\u6d88\u606f\u7684key, * @param value \u63a5\u6536\u5230\u7684\u6d88\u606f\u7684value * @param aggValue \u4e0a\u9762apply\u7684\u65b9\u6cd5\u8fd4\u56de\u503c * @return */ @Override public String apply ( String key , String value , String aggValue ) { //value\u4e3a\u7a7a\uff0c\u4e0d\u4f5c\u4efb\u4f55\u5904\u7406 if ( StringUtils . isEmpty ( value )) { return aggValue ; } //value\u5c06\u6765\u53d1\u9001\u7684\u5185\u5bb9\uff1a\"hello,kafka\" List < String > strings = Arrays . asList ( value . toLowerCase (). split ( \",\" )); int count = 0 ; for ( String string : strings ) { //\u5982\u679c\u5b57\u7b26\u4e32\u5305\u542bhello\uff0c\u5c31\u5c06count++ if ( string . equals ( \"hello\" )) { count ++ ; } } Integer integer = Integer . valueOf ( aggValue ); return String . valueOf ( integer + count ); } //\u552f\u4e00\u6807\u8bc6 }, Materialized . as ( \"kafka-stream-sample-count\" )) . toStream () . map (( key , value ) -> new KeyValue <> ( key . key (), value )); map . to ( OUT_TOPIC , Produced . with ( Serdes . String (), Serdes . String ())); } }","title":"06-\u5165\u95e8\u6848\u4f8b\u6d4b\u8bd5\u53ca\u603b\u7ed3 11:10"},{"location":"hmtt/day13/#07-springbootkafkastream_0847","text":"package com.itheima.kafka.config ; import lombok.Getter ; import lombok.Setter ; import org.apache.kafka.clients.consumer.ConsumerConfig ; import org.apache.kafka.common.serialization.Serdes ; import org.apache.kafka.streams.StreamsConfig ; import org.apache.kafka.streams.Topology ; import org.springframework.boot.context.properties.ConfigurationProperties ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; import org.springframework.kafka.annotation.EnableKafkaStreams ; import org.springframework.kafka.annotation.KafkaStreamsDefaultConfiguration ; import org.springframework.kafka.config.KafkaStreamsConfiguration ; import java.util.HashMap ; import java.util.Map ; /** * \u901a\u8fc7\u91cd\u65b0\u6ce8\u518cKafkaStreamsConfiguration\u5bf9\u8c61\uff0c\u8bbe\u7f6e\u81ea\u5b9a\u914d\u7f6e\u53c2\u6570 */ @Setter @Getter @Configuration @EnableKafkaStreams @ConfigurationProperties ( prefix = \"kafka\" ) public class KafkaStreamConfig { private static final int MAX_MESSAGE_SIZE = 16 * 1024 * 1024 ; private String hosts ; private String group ; /** * \u91cd\u65b0\u5b9a\u4e49\u9ed8\u8ba4\u7684KafkaStreams\u914d\u7f6e\u5c5e\u6027\uff0c\u5305\u62ec\uff1a * 1\u3001\u670d\u52a1\u5668\u5730\u5740 * 2\u3001\u5e94\u7528ID * 3\u3001\u6d41\u6d88\u606f\u7684\u526f\u672c\u6570\u7b49\u914d\u7f6e * @return */ @Bean ( name = KafkaStreamsDefaultConfiguration . DEFAULT_STREAMS_CONFIG_BEAN_NAME ) public KafkaStreamsConfiguration defaultKafkaStreamsConfig () { Map < String , Object > props = new HashMap <> (); //kafka\u5730\u5740 props . put ( StreamsConfig . BOOTSTRAP_SERVERS_CONFIG , hosts ); //\u5e94\u7528ID props . put ( StreamsConfig . APPLICATION_ID_CONFIG , this . getGroup () + \"_stream_aid\" ); //\u5ba2\u6237\u7aefID props . put ( StreamsConfig . CLIENT_ID_CONFIG , this . getGroup () + \"_stream_cid\" ); //\u91cd\u8bd5\u6b21\u6570 props . put ( StreamsConfig . RETRIES_CONFIG , 10 ); //\u7c7b\u578b\u8f6c\u6362 props . put ( StreamsConfig . DEFAULT_KEY_SERDE_CLASS_CONFIG , Serdes . String (). getClass ()); props . put ( StreamsConfig . DEFAULT_VALUE_SERDE_CLASS_CONFIG , Serdes . String (). getClass ()); // \u6d88\u606f\u526f\u672c\u6570\u91cf props . put ( StreamsConfig . REPLICATION_FACTOR_CONFIG , 1 ); props . put ( StreamsConfig . RETRY_BACKOFF_MS_CONFIG , 5_000 ); props . put ( StreamsConfig . SEND_BUFFER_CONFIG , 3 * MAX_MESSAGE_SIZE ); props . put ( ConsumerConfig . AUTO_OFFSET_RESET_CONFIG , Topology . AutoOffsetReset . EARLIEST . name (). toLowerCase ()); return new KafkaStreamsConfiguration ( props ); } } package com.itheima.kafka.config ; /** * \u6d41\u6570\u636e\u7684\u76d1\u542c\u6d88\u8d39\u8005\u5b9e\u73b0\u7684\u63a5\u53e3\u7c7b\uff0c\u7cfb\u7edf\u81ea\u52a8\u4f1a\u901a\u8fc7 * KafkaStreamListenerFactory\u7c7b\u626b\u63cf\u9879\u76ee\u4e2d\u5b9e\u73b0\u8be5\u63a5\u53e3\u7684\u7c7b * \u5e76\u6ce8\u518c\u4e3a\u6d41\u6570\u636e\u7684\u6d88\u8d39\u7aef * * \u5176\u4e2d\u6cdb\u578b\u53ef\u662fKStream\u6216KTable * @param <T> */ public interface KafkaStreamListener < T > { // \u76d1\u542c\u7684\u7c7b\u578b String listenerTopic (); // \u5904\u7406\u7ed3\u679c\u53d1\u9001\u7684\u7c7b String sendTopic (); // \u5bf9\u8c61\u5904\u7406\u903b\u8f91 T getService ( T stream ); } package com.itheima.kafka.config ; import org.apache.kafka.streams.StreamsBuilder ; import org.slf4j.Logger ; import org.slf4j.LoggerFactory ; import org.springframework.beans.factory.InitializingBean ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.beans.factory.support.DefaultListableBeanFactory ; import org.springframework.context.ApplicationContext ; import org.springframework.stereotype.Component ; import java.util.Map ; /** * KafkaStreamListener\u626b\u63cf\u548c\u5b9e\u4f8b\u5316\u6210KafkaStreamProcessor.doAction\u7684\u8fd4\u56de\u7c7b\uff0c\u5b8c\u6210\u76d1\u542c\u5668\u5b9e\u9645\u6ce8\u518c\u7684\u8fc7\u7a0b */ @Component public class KafkaStreamListenerFactory implements InitializingBean { Logger logger = LoggerFactory . getLogger ( KafkaStreamListenerFactory . class ); @Autowired DefaultListableBeanFactory defaultListableBeanFactory ; /** * \u521d\u59cb\u5316\u5b8c\u6210\u540e\u81ea\u52a8\u8c03\u7528 */ @Override public void afterPropertiesSet () { Map < String , KafkaStreamListener > map = defaultListableBeanFactory . getBeansOfType ( KafkaStreamListener . class ); for ( String key : map . keySet ()) { KafkaStreamListener k = map . get ( key ); KafkaStreamProcessor processor = new KafkaStreamProcessor ( defaultListableBeanFactory . getBean ( StreamsBuilder . class ), k ); String beanName = k . getClass (). getSimpleName () + \"AutoProcessor\" ; defaultListableBeanFactory . registerSingleton ( beanName , processor . doAction ()); logger . info ( \"add kafka stream auto listener [{}]\" , beanName ); } } } package com.itheima.kafka.config ; import org.apache.kafka.streams.StreamsBuilder ; import org.apache.kafka.streams.Topology ; import org.apache.kafka.streams.kstream.Consumed ; import org.apache.kafka.streams.kstream.KStream ; import org.apache.kafka.streams.kstream.KTable ; import org.springframework.util.Assert ; import java.lang.reflect.ParameterizedType ; import java.lang.reflect.Type ; /** * KafkaStream\u81ea\u52a8\u5904\u7406\u5305\u88c5\u7c7b */ public class KafkaStreamProcessor { // \u6d41\u6784\u5efa\u5668 StreamsBuilder streamsBuilder ; private String type ; KafkaStreamListener listener ; public KafkaStreamProcessor ( StreamsBuilder streamsBuilder , KafkaStreamListener kafkaStreamListener ){ this . streamsBuilder = streamsBuilder ; this . listener = kafkaStreamListener ; this . parseType (); Assert . notNull ( this . type , \"Kafka Stream \u76d1\u542c\u5668\u53ea\u652f\u6301kstream\u3001ktable,\u5f53\u524d\u7c7b\u578b\u662f\" + this . type ); } /** * \u901a\u8fc7\u6cdb\u578b\u7c7b\u578b\u81ea\u52a8\u6ce8\u518c\u5bf9\u5e94\u7c7b\u578b\u7684\u6d41\u5904\u7406\u5668\u5bf9\u8c61 * \u652f\u6301KStream\u3001KTable * @return */ public Object doAction (){ if ( \"kstream\" . equals ( this . type )) { KStream <? , ?> stream = streamsBuilder . stream ( listener . listenerTopic (), Consumed . with ( Topology . AutoOffsetReset . LATEST )); stream = ( KStream ) listener . getService ( stream ); stream . to ( listener . sendTopic ()); return stream ; } else { KTable <? , ?> table = streamsBuilder . table ( listener . listenerTopic (), Consumed . with ( Topology . AutoOffsetReset . LATEST )); table = ( KTable ) listener . getService ( table ); table . toStream (). to ( listener . sendTopic ()); return table ; } } /** * \u89e3\u6790\u4f20\u5165listener\u7c7b\u7684\u6cdb\u578b\u7c7b */ private void parseType (){ Type [] types = listener . getClass (). getGenericInterfaces (); if ( types != null ){ for ( int i = 0 ; i < types . length ; i ++ ) { if ( types [ i ] instanceof ParameterizedType ){ ParameterizedType t = ( ParameterizedType ) types [ i ] ; String name = t . getActualTypeArguments () [ 0 ] . getTypeName (). toLowerCase (); if ( name . contains ( \"org.apache.kafka.streams.kstream.kstream\" ) || name . contains ( \"org.apache.kafka.streams.kstream.ktable\" )){ this . type = name . substring ( 0 , name . indexOf ( '<' )). replace ( \"org.apache.kafka.streams.kstream.\" , \"\" ). trim (); break ; } } } } } }","title":"07-springboot\u96c6\u6210kafkaStream 08\uff1a47"},{"location":"hmtt/day13/#08-_1227","text":"package com.itheima.kafka.stream.listener ; import com.itheima.kafka.config.KafkaStreamListener ; import org.apache.kafka.streams.KeyValue ; import org.apache.kafka.streams.kstream.* ; import org.springframework.stereotype.Component ; import org.springframework.util.StringUtils ; import java.util.Arrays ; import java.util.List ; /** * \u6cdb\u578b\u6267\u884c\u6267\u884c\u4e24\u79cd\u7c7b\u578b * Ktable * KStream */ @Component public class StreamListener implements KafkaStreamListener < KStream <? , String >> { @Override public String listenerTopic () { return \"input_topic_1\" ; } @Override public String sendTopic () { return \"out_topic\" ; } @Override public KStream <? , String > getService ( KStream <? , String > stream ) { return stream . groupByKey (). windowedBy ( TimeWindows . of ( 10000 )) . aggregate ( new Initializer < String > () { @Override public String apply () { return \"0\" ; } }, new Aggregator < Object , String , String > () { @Override public String apply ( Object key , String value , String aggValue ) { System . out . println ( \"spring\u96c6\u6210\u4ee5\u540e\u7684\u6d41\u5f0f\u5904\u7406------------\" ); if ( StringUtils . isEmpty ( value )){ return aggValue ; } List < String > strings = Arrays . asList ( value . toLowerCase (). split ( \",\" )); int count = 0 ; for ( String string : strings ) { if ( string . equals ( \"hello\" )){ count ++ ; } } Integer integer = Integer . valueOf ( aggValue ); return String . valueOf ( integer + count ); } }, Materialized . as ( \"kafka-stream-sample-count-1\" )). toStream () . map (( key , value ) -> { return new KeyValue <> ( key . key (). toString (), value ); }); } } \u76d1\u542c\uff1a package com.itheima.kafka.listener ; import com.alibaba.fastjson.JSON ; import com.itheima.kafka.pojo.User ; import org.apache.kafka.clients.consumer.ConsumerRecord ; import org.springframework.kafka.annotation.KafkaListener ; import org.springframework.stereotype.Component ; import java.util.Optional ; @Component public class HelloListener { @KafkaListener ( topics = { \"out_topic\" }) public void receiveMessage ( ConsumerRecord <? , ?> record ){ Optional <? extends ConsumerRecord <? , ?>> optional = Optional . ofNullable ( record ); if ( optional . isPresent ()){ Object value = record . value (); System . out . println ( value ); } } }","title":"08-\u5165\u95e8\u6848\u4f8b 12:27"},{"location":"hmtt/day13/#09-app-_1040","text":"\u8be6\u89c1\u8bb2\u4e49","title":"09-app\u7aef\u70ed\u70b9\u6587\u7ae0\u8ba1\u7b97-\u601d\u8def\u5206\u6790 10:40"},{"location":"hmtt/day13/#10-_0631","text":"","title":"10-\u73af\u5883\u96c6\u6210\u51c6\u5907 06:31"},{"location":"hmtt/day13/#11-_1236","text":"","title":"11-\u8ba1\u7b97\u6587\u7ae0\u5206\u503c 12:36"},{"location":"hmtt/day13/#12-_1618","text":"package com.heima.article.service.impl ; import com.alibaba.fastjson.JSON ; import com.alibaba.fastjson.JSONArray ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.heima.article.feign.AdminFeign ; import com.heima.article.mapper.ApArticleMapper ; import com.heima.article.service.HotArticleService ; import com.heima.common.constans.article.ArticleConstans ; import com.heima.model.admin.pojos.AdChannel ; import com.heima.model.article.pojos.ApArticle ; import com.heima.model.article.vo.HotArticleVo ; import com.heima.model.common.dtos.ResponseResult ; import org.joda.time.DateTime ; import org.springframework.beans.BeanUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.redis.core.StringRedisTemplate ; import org.springframework.stereotype.Service ; import java.util.ArrayList ; import java.util.Comparator ; import java.util.List ; import java.util.stream.Collectors ; @Service public class HotArticleServiceImpl implements HotArticleService { @Autowired private ApArticleMapper apArticleMapper ; @Override public void computeHotArticle () { //1.\u67e5\u8be2\u524d5\u5929\u7684\u65b0\u53d1\u5e03\u7684\u6587\u7ae0\u7684\u6570\u636e String dayParam = DateTime . now (). minusDays ( 5 ). toString ( \"yyyy-MM-dd 00:00:00\" ); List < ApArticle > articleList = apArticleMapper . selectList ( Wrappers . < ApArticle > lambdaQuery (). gt ( ApArticle :: getPublishTime , dayParam )); //2.\u8ba1\u7b97\u6587\u7ae0\u7684\u5206\u503c\uff08\u9605\u8bfb\u91cf\u3001\u70b9\u8d5e\u91cf\u3001\u8bc4\u8bba\u548c\u6536\u85cf\uff09 List < HotArticleVo > hotArticleVoList = computeHotArticle ( articleList ); //3.\u7ed9\u6bcf\u4e2a\u9891\u9053\u7f13\u5b58\u70ed\u5ea6\u8f83\u9ad8\u768430\u6761\u6570\u636e cacheTagToRedis ( hotArticleVoList ); } @Autowired private AdminFeign adminFeign ; @Autowired private StringRedisTemplate redisTemplate ; /** * \u7f13\u5b58\u6587\u7ae0\u5217\u8868\u5230redis * @param hotArticleVoList */ private void cacheTagToRedis ( List < HotArticleVo > hotArticleVoList ) { //1.\u67e5\u8be2\u6240\u6709\u7684\u9891\u9053\u4fe1\u606f ResponseResult responseResult = adminFeign . selectAllChannel (); List < AdChannel > channels = JSONArray . parseArray ( JSON . toJSONString ( responseResult . getData ()), AdChannel . class ); //2.\u68c0\u7d22\u6570\u636e\uff0c\u7ed9\u6bcf\u4e2a\u9891\u9053\u5b58\u516530\u6761\u5206\u503c\u8f83\u9ad8\u7684\u6570\u636e\u5230redis if ( channels != null && ! channels . isEmpty ()){ for ( AdChannel channel : channels ) { //\u8fc7\u6ee4\u6570\u636e\uff0c\u5982\u679c\u67d0\u4e9b\u6570\u636e\u4e0d\u5728\u9891\u9053\u5217\u8868\u4e2d\uff0c\u5c31\u6392\u9664\u6389 List < HotArticleVo > hotArticleVos = hotArticleVoList . stream (). filter ( p -> p . getChannelId (). equals ( channel . getId ())). collect ( Collectors . toList ()); sortAndCache ( hotArticleVos , ArticleConstans . HOT_ARTICLE_FIRST_PAGE + channel . getId ()); } } //3.\u5982\u679c\u662f\u63a8\u8350\u6570\u636e__all__\uff0c\u4ece\u70ed\u70b9\u6570\u636e\u4e2d\u627e\u51fa\u5206\u503c\u6700\u9ad8\u768430\u6761\u6570\u636e\u5b58\u5165redis sortAndCache ( hotArticleVoList , ArticleConstans . HOT_ARTICLE_FIRST_PAGE + ArticleConstans . DEFAULT_TAG ); } private void sortAndCache ( List < HotArticleVo > hotArticleVos , String s ) { //\u5012\u5e8f hotArticleVos . sort (( o1 , o2 ) -> o1 . getScore () < o2 . getScore () ? 1 : - 1 ); //\u83b7\u53d6\u524d30\u6761 if ( hotArticleVos . size () > 30 ) { hotArticleVos = hotArticleVos . subList ( 0 , 30 ); } if ( hotArticleVos . size () == 0 ) { redisTemplate . opsForValue (). set ( s , \"\" ); } redisTemplate . opsForValue (). set ( s , JSON . toJSONString ( hotArticleVos )); } /** * \u8ba1\u7b97\u6587\u7ae0\u5206\u503c * @param articleList * @return */ private List < HotArticleVo > computeHotArticle ( List < ApArticle > articleList ) { List < HotArticleVo > hotArticleVoList = new ArrayList <> (); HotArticleVo hotArticleVo = null ; if ( ! articleList . isEmpty () && articleList . size () > 0 ){ for ( ApArticle apArticle : articleList ) { hotArticleVo = new HotArticleVo (); //\u62f7\u8d1dapArticle\u5230hotArticleVo BeanUtils . copyProperties ( apArticle , hotArticleVo ); //\u8ba1\u7b97\u5206\u503c Integer score = computeScore ( apArticle ); //\u7ed9hotArticleVo\u8d4b\u503c\u5206\u503c hotArticleVo . setScore ( score ); hotArticleVoList . add ( hotArticleVo ); } } return hotArticleVoList ; } /** * \u8ba1\u7b97\u5206\u503c * @param apArticle * @return */ private Integer computeScore ( ApArticle apArticle ) { Integer score = 0 ; if ( apArticle . getLikes () != null ){ score += apArticle . getLikes () * ArticleConstans . HOT_ARTICLE_LIKE_WEIGHT ; } if ( apArticle . getViews () != null ){ score += apArticle . getViews (); } if ( apArticle . getComment () != null ){ score += apArticle . getComment () * ArticleConstans . HOT_ARTICLE_COMMENT_WEIGHT ; } if ( apArticle . getCollection () != null ){ score += apArticle . getCollection () * ArticleConstans . HOT_ARTICLE_COLLECTION_WEIGHT ; } return score ; } }","title":"12-\u6570\u636e\u6392\u5e8f\u7f13\u5b58 16:18"},{"location":"hmtt/day13/#13-_1225","text":"\u5c06\u8d44\u6599\u4e2d\u7684sql\u5bfc\u5165\u5230\u6570\u636e\u5e93,\u66f4\u65b0\u4e00\u4e0b\u65f6\u95f4\u65b9\u4fbf\u6d4b\u8bd5 UPDATE ap_article SET publish_time = NOW () \u542f\u52a8admin,\u5728article\u4e2d\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b\uff1a package com.heima.article.test ; import com.heima.article.ArticleApplication ; import com.heima.article.service.HotArticleService ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @SpringBootTest ( classes = ArticleApplication . class ) @RunWith ( SpringRunner . class ) public class HotArticleServiceTest { @Autowired private HotArticleService hotArticleService ; @Test public void testComputeHotArticle (){ hotArticleService . computeHotArticle (); } }","title":"13-\u5355\u5143\u6d4b\u8bd5 12:25"},{"location":"hmtt/day13/#14-_0825","text":"\u542f\u52a8xxl-job-admin\uff0c\u53c2\u8003\u7b2c8\u5929\u7684\u8bb2\u4e49 \u53c2\u8003\u8bb2\u4e49\u914d\u7f6e\u4efb\u52a1\uff0c\u96c6\u6210xxl-job","title":"14-\u5b9a\u65f6\u4efb\u52a1 08:25"},{"location":"hmtt/day13/#15-_0945","text":"\u70b9\u8d5e\u4fee\u6539\uff1a package com.heima.behavior.service.impl ; import com.alibaba.fastjson.JSON ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl ; import com.heima.behavior.mapper.ApLikesBehaviorMapper ; import com.heima.behavior.service.ApBehaviorEntryService ; import com.heima.behavior.service.ApLikesBehaviorService ; import com.heima.common.constans.message.HotArticleConstants ; import com.heima.model.article.mess.UpdateArticleMess ; import com.heima.model.behavior.dtos.LikesBehaviorDto ; import com.heima.model.behavior.pojos.ApBehaviorEntry ; import com.heima.model.behavior.pojos.ApLikesBehavior ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.user.pojos.ApUser ; import com.heima.utils.threadlocal.AppThreadLocalUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.kafka.core.KafkaTemplate ; import org.springframework.stereotype.Service ; import java.util.Date ; @Service public class ApLikesBehaviorServiceImpl extends ServiceImpl < ApLikesBehaviorMapper , ApLikesBehavior > implements ApLikesBehaviorService { @Autowired private ApBehaviorEntryService apBehaviorEntryService ; @Autowired private KafkaTemplate kafkaTemplate ; @Override public ResponseResult like ( LikesBehaviorDto dto ) { //1.\u68c0\u67e5\u53c2\u6570 if ( dto == null || dto . getArticleId () == null || ( dto . getType () < 0 && dto . getType () > 2 ) || ( dto . getOperation () < 0 && dto . getOperation () > 1 )){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u884c\u4e3a\u5b9e\u4f53 ApUser user = AppThreadLocalUtils . getUser (); ApBehaviorEntry apBehaviorEntry = apBehaviorEntryService . findByUserIdOrEquipmentId ( user . getId (), dto . getEquipmentId ()); if ( apBehaviorEntry == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //3.\u70b9\u8d5e\u6216\u53d6\u6d88\u70b9\u8d5e ApLikesBehavior apLikesBehavior = getOne ( Wrappers . < ApLikesBehavior > lambdaQuery (). eq ( ApLikesBehavior :: getArticleId , dto . getArticleId ()). eq ( ApLikesBehavior :: getEntryId , apBehaviorEntry . getId ())); //\u53d1\u9001\u6d88\u606f if ( dto . getOperation () == 0 ){ UpdateArticleMess mess = new UpdateArticleMess (); mess . setAdd ( 1 ); mess . setArticleId ( dto . getArticleId ()); mess . setType ( UpdateArticleMess . UpdateArticleType . LIKES ); kafkaTemplate . send ( HotArticleConstants . HOT_ARTICLE_SCORE_TOPIC , JSON . toJSONString ( mess )); } if ( apLikesBehavior == null && dto . getOperation () == 0 ){ apLikesBehavior = new ApLikesBehavior (); apLikesBehavior . setOperation ( dto . getOperation ()); apLikesBehavior . setArticleId ( dto . getArticleId ()); apLikesBehavior . setEntryId ( apBehaviorEntry . getId ()); apLikesBehavior . setType ( dto . getType ()); apLikesBehavior . setCreatedTime ( new Date ()); boolean save = save ( apLikesBehavior ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } else { apLikesBehavior . setOperation ( dto . getOperation ()); updateById ( apLikesBehavior ); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } } } \u6dfb\u52a0\u4e86\u53d1\u9001\u6d88\u606f\u8fd9\u4e00\u6bb5\u4ee3\u7801 \u9605\u8bfb\u4fee\u6539\uff1a package com.heima.behavior.service.impl ; import com.alibaba.fastjson.JSON ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl ; import com.heima.behavior.mapper.ApReadBehaviorMapper ; import com.heima.behavior.service.ApBehaviorEntryService ; import com.heima.behavior.service.ApReadBehaviorService ; import com.heima.common.constans.message.HotArticleConstants ; import com.heima.model.article.mess.UpdateArticleMess ; import com.heima.model.behavior.dtos.ReadBehaviorDto ; import com.heima.model.behavior.pojos.ApBehaviorEntry ; import com.heima.model.behavior.pojos.ApReadBehavior ; import com.heima.model.common.dtos.ResponseResult ; import com.heima.model.common.enums.AppHttpCodeEnum ; import com.heima.model.user.pojos.ApUser ; import com.heima.utils.threadlocal.AppThreadLocalUtils ; import lombok.extern.log4j.Log4j2 ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.kafka.core.KafkaTemplate ; import org.springframework.stereotype.Service ; import java.util.Date ; @Service @Log4j2 public class ApReadBehaviorServiceImpl extends ServiceImpl < ApReadBehaviorMapper , ApReadBehavior > implements ApReadBehaviorService { @Autowired private ApBehaviorEntryService apBehaviorEntryService ; @Autowired private KafkaTemplate kafkaTemplate ; @Override public ResponseResult readBehavior ( ReadBehaviorDto dto ) { //1.\u53c2\u6570\u6821\u9a8c if ( dto == null || dto . getArticleId () == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //2.\u67e5\u8be2\u884c\u4e3a\u5b9e\u4f53 ApUser user = AppThreadLocalUtils . getUser (); ApBehaviorEntry apBehaviorEntry = apBehaviorEntryService . findByUserIdOrEquipmentId ( user . getId (), dto . getEquipmentId ()); if ( apBehaviorEntry == null ){ return ResponseResult . errorResult ( AppHttpCodeEnum . PARAM_INVALID ); } //3.\u4fdd\u5b58\u6216\u66f4\u65b0\u9605\u8bfb\u7684\u884c\u4e3a ApReadBehavior apReadBehavior = getOne ( Wrappers . < ApReadBehavior > lambdaQuery (). eq ( ApReadBehavior :: getEntryId , apBehaviorEntry . getId ()). eq ( ApReadBehavior :: getArticleId , dto . getArticleId ())); if ( apReadBehavior == null ){ apReadBehavior = new ApReadBehavior (); apReadBehavior . setCount ( dto . getCount ()); apReadBehavior . setArticleId ( dto . getArticleId ()); apReadBehavior . setPercentage ( dto . getPercentage ()); apReadBehavior . setEntryId ( apBehaviorEntry . getId ()); apReadBehavior . setLoadDuration ( dto . getLoadDuration ()); apReadBehavior . setReadDuration ( dto . getReadDuration ()); apReadBehavior . setCreatedTime ( new Date ()); save ( apReadBehavior ); } else { apReadBehavior . setUpdatedTime ( new Date ()); apReadBehavior . setCount (( short )( apReadBehavior . getCount () + 1 )); updateById ( apReadBehavior ); } //\u53d1\u9001\u6d88\u606f UpdateArticleMess mess = new UpdateArticleMess (); mess . setAdd ( 1 ); mess . setArticleId ( dto . getArticleId ()); mess . setType ( UpdateArticleMess . UpdateArticleType . VIEWS ); kafkaTemplate . send ( HotArticleConstants . HOT_ARTICLE_SCORE_TOPIC , JSON . toJSONString ( mess )); return ResponseResult . okResult ( AppHttpCodeEnum . SUCCESS ); } }","title":"15-\u884c\u4e3a\u6d88\u606f\u53d1\u9001 09:45"},{"location":"hmtt/day13/#16-kafkastream_0439","text":"\u8be6\u89c1\u8bb2\u4e49","title":"16-kafkastream\u96c6\u6210 04:39"},{"location":"hmtt/day13/#17-1_1536","text":"","title":"17-\u6d41\u5f0f\u5904\u74061 15:36"},{"location":"hmtt/day13/#18-2_0817","text":"package com.heima.article.stream.listener ; import com.alibaba.fastjson.JSON ; import com.heima.article.config.stream.KafkaStreamListener ; import com.heima.common.constans.message.HotArticleConstants ; import com.heima.model.article.mess.ArticleVisitStreamMess ; import com.heima.model.article.mess.UpdateArticleMess ; import lombok.extern.log4j.Log4j2 ; import org.apache.kafka.streams.KeyValue ; import org.apache.kafka.streams.kstream.* ; import org.springframework.stereotype.Component ; import java.util.regex.Matcher ; import java.util.regex.Pattern ; @Component @Log4j2 public class HotArticleStreamHandler implements KafkaStreamListener < KStream <? , String >> { @Override public String listenerTopic () { return HotArticleConstants . HOT_ARTICLE_SCORE_TOPIC ; } @Override public String sendTopic () { return HotArticleConstants . HOT_ARTICLE_INCR_HANDLE_TOPIC ; } @Override public KStream <? , String > getService ( KStream <? , String > stream ) { return stream . map (( key , value ) -> { //\u5148\u5c06\u4f20\u9012\u8fc7\u6765\u7684\u5b57\u7b26\u4e32\u8fd8\u539f\u6210\u5bf9\u8c61 UpdateArticleMess mess = JSON . parseObject ( value , UpdateArticleMess . class ); //map<articleId,LIKES:1> System . out . println ( \"key:\" + mess . getArticleId () + \",value:\" + mess . getType (). name () + \":\" + mess . getAdd ()); //\u5c06key-value\u8fd4\u56de\uff0ckey:articleId value: \u884c\u4e3a\u7c7b\u578b:\u6dfb\u52a0\u7684\u503c return new KeyValue <> ( mess . getArticleId (). toString (), mess . getType (). name () + \":\" + mess . getAdd ()); }). groupByKey (). windowedBy ( TimeWindows . of ( 10000 )). aggregate ( new Initializer < String > () { @Override public String apply () { //\u521d\u59cb\u5316\u90fd\u4e3a0 return \"COLLECTION:0,COMMENT:0,LIKES:0,VIEWS:0\" ; } }, new Aggregator < Object , String , String > () { @Override public String apply ( Object aggKey , String value , String aggValue ) { //LIKES:1 String [] valArr = value . split ( \":\" ); if ( valArr [ 0 ] . equals ( \"\" ) || valArr [ 1 ] . equals ( \"\" )){ return aggValue ; } int col = 0 , com = 0 , lik = 0 , vie = 0 ; if ( \"COLLECTION\" . equalsIgnoreCase ( valArr [ 0 ] )){ col += Integer . valueOf ( valArr [ 1 ] ); } if ( \"COMMENT\" . equalsIgnoreCase ( valArr [ 0 ] )){ com += Integer . valueOf ( valArr [ 1 ] ); } if ( \"LIKES\" . equalsIgnoreCase ( valArr [ 0 ] )){ lik += Integer . valueOf ( valArr [ 1 ] ); } if ( \"VIEWS\" . equalsIgnoreCase ( valArr [ 0 ] )){ vie += Integer . valueOf ( valArr [ 1 ] ); } System . out . println ( String . format ( \"COLLECTION:%d,COMMENT:%d,LIKES:%d,VIEWS:%d\" , col , com , lik , vie )); return String . format ( \"COLLECTION:%d,COMMENT:%d,LIKES:%d,VIEWS:%d\" , col , com , lik , vie ); } }, Materialized . as ( \"count-article-num-miukoo-1\" )). toStream (). map (( key , value ) -> { return new KeyValue <> ( key . key (). toString (), formatObj ( key . key (). toString (), value )); }); } /** * \u683c\u5f0f\u5316\u53d1\u9001\u6d88\u606f\u7684value * @param ArticleId * @param value * @return */ private String formatObj ( String ArticleId , String value ){ ArticleVisitStreamMess mess = new ArticleVisitStreamMess (); //value --> COLLECTION:%d,COMMENT:%d,LIKES:%d,VIEWS:%d Pattern pattern = Pattern . compile ( \"COLLECTION:(\\\\d+),COMMENT:(\\\\d+),LIKES:(\\\\d+),VIEWS:(\\\\d+)\" ); //\u901a\u8fc7\u6b63\u5219\u8fdb\u884c\u67e5\u8be2 Matcher matcher = pattern . matcher ( value ); if ( matcher . find ()){ mess . setCollect ( Long . valueOf ( matcher . group ( 1 ))); mess . setComment ( Long . valueOf ( matcher . group ( 2 ))); mess . setLike ( Long . valueOf ( matcher . group ( 3 ))); mess . setView ( Long . valueOf ( matcher . group ( 4 ))); } else { mess . setCollect ( 0 ); mess . setComment ( 0 ); mess . setLike ( 0 ); mess . setView ( 0 ); } mess . setArticleId ( Long . valueOf ( ArticleId )); System . out . println ( JSON . toJSONString ( mess )); //{\"articleId\":1302977558807060482,\"collect\":0,\"comment\":0,\"like\":0,\"view\":1} return JSON . toJSONString ( mess ); } }","title":"18-\u6d41\u5f0f\u5904\u74062  08:17"},{"location":"hmtt/day13/#_3","text":"\u76ee\u524d\u7684\u4ee3\u7801\u5b57\u7b26\u4e32\u64cd\u4f5c\u592a\u591a\uff0c\u76f4\u63a5\u4f7f\u7528json\u5bf9\u8c61\u4f20\u9012\u4f1a\u7b80\u5355\u5f88\u591a\u3002 package com.heima.article.stream.listener ; import com.alibaba.fastjson.JSON ; import com.heima.article.config.stream.KafkaStreamListener ; import com.heima.common.constans.message.HotArticleConstants ; import com.heima.model.article.mess.ArticleVisitStreamMess ; import com.heima.model.article.mess.UpdateArticleMess ; import lombok.extern.log4j.Log4j2 ; import org.apache.kafka.streams.KeyValue ; import org.apache.kafka.streams.kstream.* ; import org.springframework.stereotype.Component ; import java.util.regex.Matcher ; import java.util.regex.Pattern ; @Component @Log4j2 public class HotArticleStreamHandlerV2 implements KafkaStreamListener < KStream <? , String >> { @Override public String listenerTopic () { return HotArticleConstants . HOT_ARTICLE_SCORE_TOPIC ; } @Override public String sendTopic () { return HotArticleConstants . HOT_ARTICLE_INCR_HANDLE_TOPIC ; } @Override public KStream <? , String > getService ( KStream <? , String > stream ) { return stream . map (( key , value ) -> { //\u5148\u5c06\u4f20\u9012\u8fc7\u6765\u7684\u5b57\u7b26\u4e32\u8fd8\u539f\u6210\u5bf9\u8c61 UpdateArticleMess mess = JSON . parseObject ( value , UpdateArticleMess . class ); //map<articleId,LIKES:1> System . out . println ( \"key:\" + mess . getArticleId () + \",value:\" + mess . getType (). name () + \":\" + mess . getAdd ()); //\u5c06key-value\u8fd4\u56de\uff0ckey:articleId value: UpdateArticleMess return new KeyValue <> ( mess . getArticleId (). toString (), value ); }). groupByKey (). windowedBy ( TimeWindows . of ( 10000 )). aggregate ( new Initializer < String > () { @Override public String apply () { //\u521d\u59cb\u5316\u90fd\u4e3a0 ArticleVisitStreamMess mess = new ArticleVisitStreamMess (); return JSON . toJSONString ( mess ); } }, new Aggregator < Object , String , String > () { @Override public String apply ( Object aggKey , String value , String aggValue ) { //\u8fd8\u539fvalue \u548c \u805a\u5408value UpdateArticleMess mess = JSON . parseObject ( value , UpdateArticleMess . class ); ArticleVisitStreamMess agg = JSON . parseObject ( value , ArticleVisitStreamMess . class ); //articleId\u4e3a\u7a7a\uff0c\u8d4b\u503c\u4e00\u4e0b if ( agg . getArticleId () == null ){ agg . setArticleId (( Long ) aggKey ); } //\u6839\u636evalue\u4e2d\u7684\u7c7b\u578b\uff0c\u589e\u52a0\u76f8\u5e94\u7684\u503c if ( mess . getType () != null ){ switch ( mess . getType ()){ case LIKES : agg . setLike ( agg . getLike () + mess . getAdd ()); break ; case VIEWS : agg . setView ( agg . getView () + mess . getAdd ()); break ; case COMMENT : agg . setComment ( agg . getComment () + mess . getAdd ()); break ; case COLLECTION : agg . setCollect ( agg . getCollect () + mess . getAdd ()); break ; } } return JSON . toJSONString ( agg ); } }, Materialized . as ( \"count-article-num-miukoo-1\" )). toStream (). map (( key , value ) -> { return new KeyValue <> ( key . key (). toString (), value ); }); } }","title":"\u4f18\u5316\u4ee3\u7801"},{"location":"hmtt/day13/#19-_1148","text":"\u542f\u52a8ArticleApplication BehaviorApplication AppGatewayApplication UserApplication \u524d\u7aef\u5de5\u7a0b \u7ed9\u51fa\u7684\u6d4b\u8bd5\u811a\u672c\u5b58\u5728\u95ee\u9898\uff0c\u6267\u884c\u4e0b\u9762\u4e24\u884c\u4ee3\u7801\u4fee\u590d\u7f3a\u5931\u7684\u8868\u6570\u636e\uff1a INSERT INTO ap_article_config ( article_id , is_comment , is_forward , is_down , is_delete ) SELECT id , 1 , 0 , 0 , 0 FROM ap_article INSERT INTO ap_article_content ( article_id , content ) SELECT id , '[{\"type\":\"text\",\"value\":\"\u6d4b\u8bd5\u81ea\u52a8\u5ba1\u6838\"},{\"type\":\"text\",\"value\":\"\u8bf7\u8f93\u5165\u6587\u7ae0\u5185\u5bb9...\"}]' FROM ap_article","title":"19-\u6d4b\u8bd5 11:48"},{"location":"hmtt/day13/#20-_1530","text":"\u8bb2\u4e49\u548c\u89c6\u9891\u4e2d\u4ee3\u7801\u5747\u6709\u8bef\uff1a package com.heima.article.service.impl ; import com.alibaba.fastjson.JSON ; import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl ; import com.heima.article.mapper.ApArticleMapper ; import com.heima.article.service.ApArticleService ; import com.heima.common.constans.article.ArticleConstans ; import com.heima.model.article.dtos.ArticleHomeDto ; import com.heima.model.article.mess.ArticleVisitStreamMess ; import com.heima.model.article.pojos.ApArticle ; import com.heima.model.article.vo.HotArticleVo ; import com.heima.model.common.dtos.ResponseResult ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.BeanUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.data.redis.core.StringRedisTemplate ; import org.springframework.stereotype.Service ; import java.util.Date ; import java.util.List ; @Service public class ApArticleServiceImpl extends ServiceImpl < ApArticleMapper , ApArticle > implements ApArticleService { // \u5355\u9875\u6700\u5927\u52a0\u8f7d\u7684\u6570\u5b57 private final static short MAX_PAGE_SIZE = 50 ; @Autowired private ApArticleMapper apArticleMapper ; @Value ( \"${fdfs.url}\" ) private String fileServerUrl ; @Override public ResponseResult load ( ArticleHomeDto dto , Short loadType ) { //1.\u6821\u9a8c\u53c2\u6570 Integer size = dto . getSize (); if ( size == null || size == 0 ) { size = 10 ; } size = Math . min ( size , MAX_PAGE_SIZE ); dto . setSize ( size ); //\u7c7b\u578b\u53c2\u6570\u68c0\u9a8c if ( ! loadType . equals ( ArticleConstans . LOADTYPE_LOAD_MORE ) && ! loadType . equals ( ArticleConstans . LOADTYPE_LOAD_NEW )) { loadType = ArticleConstans . LOADTYPE_LOAD_MORE ; } //\u6587\u7ae0\u9891\u9053\u6821\u9a8c if ( StringUtils . isEmpty ( dto . getTag ())) { dto . setTag ( ArticleConstans . DEFAULT_TAG ); } //\u65f6\u95f4\u6821\u9a8c if ( dto . getMaxBehotTime () == null ) dto . setMaxBehotTime ( new Date ()); if ( dto . getMinBehotTime () == null ) dto . setMinBehotTime ( new Date ()); //2.\u67e5\u8be2\u6570\u636e List < ApArticle > apArticles = apArticleMapper . loadArticleList ( dto , loadType ); //3.\u7ed3\u679c\u5c01\u88c5 ResponseResult responseResult = ResponseResult . okResult ( apArticles ); responseResult . setHost ( fileServerUrl ); return responseResult ; } @Autowired private StringRedisTemplate redisTemplate ; @Override public void updateArticle ( ArticleVisitStreamMess mess ) { //1.\u67e5\u8be2\u5f53\u524d\u6587\u7ae0\u6570\u636e ApArticle apArticle = getById ( mess . getArticleId ()); //2.\u4fee\u6539\u6587\u7ae0 apArticle . setViews (( int ) ( apArticle . getViews () == null ? 0 : apArticle . getViews () + mess . getView ())); apArticle . setComment (( int ) ( apArticle . getComment () == null ? 0 : apArticle . getComment () + mess . getComment ())); apArticle . setCollection (( int ) ( apArticle . getCollection () == null ? 0 : apArticle . getCollection () + mess . getCollect ())); apArticle . setLikes (( int ) ( apArticle . getLikes () == null ? 0 : apArticle . getLikes () + mess . getLike ())); //3.\u8ba1\u7b97\u5206\u503c Integer score = computeScore ( apArticle ); score = score * 3 ; //4.\u67e5\u8be2redis\u4e2d\u7684\u6570\u636e String jsonStr = redisTemplate . opsForValue (). get ( ArticleConstans . HOT_ARTICLE_FIRST_PAGE + apArticle . getChannelId ()); if ( StringUtils . isNotBlank ( jsonStr )) { //boolean flag = true; //5.\u5224\u65ad\u5f53\u524d\u6587\u7ae0\u5206\u503c\u662f\u5426\u5927\u4e8e\u7f13\u5b58\u4e2d\u7684\u67d0\u4e00\u6761\u6570\u636e //\u5982\u679c\u5927\u4e8e\uff0c\u5c31\u66ff\u6362\u7f13\u5b58\u4e2d\u7684\u8fd9\u4e00\u6761\u6570\u636e List < HotArticleVo > hotArticleVoList = JSON . parseArray ( jsonStr , HotArticleVo . class ); if ( ! hotArticleVoList . isEmpty () && hotArticleVoList . size () > 0 ) { for ( HotArticleVo hotArticleVo : hotArticleVoList ) { //\u5982\u679c\u6570\u636e\u4e2d\u5b58\u5728\u8fd9\u4e2aid\uff0c\u5224\u65ad\u5206\u6570\u662f\u5426\u66f4\u9ad8 if ( hotArticleVo . getId (). equals ( apArticle . getId ()) && ( hotArticleVo . getScore () == null || hotArticleVo . getScore () < score )) { //flag = false; //\u590d\u5236\u6240\u6709\u5c5e\u6027 BeanUtils . copyProperties ( apArticle , hotArticleVo ); //\u8bbe\u7f6e\u5206\u6570 hotArticleVo . setScore ( score ); //\u66f4\u65b0redis redisTemplate . opsForValue (). set ( ArticleConstans . HOT_ARTICLE_FIRST_PAGE + apArticle . getChannelId (), JSON . toJSONString ( hotArticleVoList )); break ; } } // if(flag){ // for (HotArticleVo hotArticleVo : hotArticleVoList) { // if ((hotArticleVo.getScore()==null ? 0:hotArticleVo.getScore()) < score ) { // hotArticleVoList.remove(hotArticleVo); // HotArticleVo hot = new HotArticleVo(); // BeanUtils.copyProperties(apArticle, hot); // hotArticleVo.setScore(score); // hotArticleVoList.add(hot); // redisTemplate.opsForValue().set(ArticleConstans.HOT_ARTICLE_FIRST_PAGE + apArticle.getChannelId(), JSON.toJSONString(hotArticleVoList)); // break; // } // } // } } } updateById ( apArticle ); } /** * \u67e5\u627e\u70ed\u70b9\u6570\u636e\u5e76\u4e14\u66ff\u6362 * @param apArticle * @param score * @param hotArticleVoList * @param hotArticleVo */ private void findHotAndCache ( ApArticle apArticle , Integer score , List < HotArticleVo > hotArticleVoList , HotArticleVo hotArticleVo ) { } /** * \u8ba1\u7b97\u5206\u503c * * @param apArticle * @return */ private Integer computeScore ( ApArticle apArticle ) { Integer score = 0 ; if ( apArticle . getLikes () != null ) { score += apArticle . getLikes () * ArticleConstans . HOT_ARTICLE_LIKE_WEIGHT ; } if ( apArticle . getViews () != null ) { score += apArticle . getViews (); } if ( apArticle . getComment () != null ) { score += apArticle . getComment () * ArticleConstans . HOT_ARTICLE_COMMENT_WEIGHT ; } if ( apArticle . getCollection () != null ) { score += apArticle . getCollection () * ArticleConstans . HOT_ARTICLE_COLLECTION_WEIGHT ; } return score ; } @Override public ResponseResult load2 ( ArticleHomeDto dto , Short loadType , boolean firstPage ) { if ( firstPage ){ String jsonStr = redisTemplate . opsForValue (). get ( ArticleConstans . HOT_ARTICLE_FIRST_PAGE + dto . getTag ()); if ( StringUtils . isNotBlank ( jsonStr )){ List < HotArticleVo > hotArticleVoList = JSON . parseArray ( jsonStr , HotArticleVo . class ); if ( ! hotArticleVoList . isEmpty () && hotArticleVoList . size () > 0 ){ ResponseResult responseResult = ResponseResult . okResult ( hotArticleVoList ); responseResult . setHost ( fileServerUrl ); return responseResult ; } } } return load ( dto , loadType ); } } \u7ec3\u4e60\uff1a\u5206\u6570\u4fee\u6539\u540e\uff0c\u6392\u5e8f\u5c31\u4e0d\u4e00\u5b9a\u5408\u9002\u4e86\u3002\u53ef\u4ee5\u4f7f\u7528list\u96c6\u5408\u6392\u5e8f\u529f\u80fd\u91cd\u65b0\u6392\u5e8f\u4e00\u4e0b\u3002 //\u5f53\u524d\u6587\u7ae0\u5982\u679c\u4e0d\u5b58\u5728redis\u4e2d\uff0c\u76f4\u63a5\u653e\u5230\u961f\u5c3e\uff0c\u6392\u5e8f\uff0c\u53d6\u524d30 //\u5982\u679c\u6587\u7ae0\u5b58\u5728\uff0c\u6392\u5e8f if ( ! flag ){ //\u6587\u7ae0\u4e0d\u5b58\u5728 HotArticleVo hotArticleVo = new HotArticleVo (); BeanUtils . copyProperties ( apArticle , hotArticleVo ); hotArticleVo . setScore ( score ); hotArticleVoList . add ( hotArticleVo ); } hotArticleVoList = hotArticleVoList . stream (). sorted ( Comparator . comparing ( HotArticleVo :: getScore ). reversed ()). collect ( Collectors . toList ()); if ( ! flag ){ hotArticleVoList = hotArticleVoList . subList ( 0 , 30 ); } redisTemplate . opsForValue (). set ( ArticleConstans . HOT_ARTICLE_FIRST_PAGE + apArticle . getChannelId (), JSON . toJSONString ( hotArticleVoList ));","title":"20-\u8ba1\u7b97\u6587\u7ae0\u7684\u5206\u503c 15:30"},{"location":"hmtt/day13/#21-_0701","text":"package com.heima.article.kafka.listener ; import com.alibaba.fastjson.JSON ; import com.heima.article.service.ApArticleService ; import com.heima.common.constans.message.HotArticleConstants ; import com.heima.model.article.mess.ArticleVisitStreamMess ; import org.apache.kafka.clients.consumer.ConsumerRecord ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.kafka.annotation.KafkaListener ; import org.springframework.stereotype.Component ; import java.util.Optional ; @Component public class ArticleIncrHandleListener { @Autowired private ApArticleService articleService ; @KafkaListener ( topics = HotArticleConstants . HOT_ARTICLE_INCR_HANDLE_TOPIC ) public void receiveMessage ( ConsumerRecord < String , String > record ){ Optional <? extends ConsumerRecord <? , ?>> optional = Optional . ofNullable ( record ); if ( optional . isPresent ()){ String value = record . value (); ArticleVisitStreamMess mess = JSON . parseObject ( value , ArticleVisitStreamMess . class ); articleService . updateArticle ( mess ); } } }","title":"21-\u76d1\u542c\u6570\u636e\u6574\u4f53\u6d4b\u8bd5 07:01"},{"location":"hmtt/day13/#22-_0704","text":"@Override public ResponseResult load2 ( ArticleHomeDto dto , Short loadType , boolean firstPage ) { if ( firstPage ){ //\u83b7\u53d6\u5bf9\u5e94\u7684redis\u4e2d\u7f13\u5b58\u7684\u70ed\u70b9\u6587\u7ae0 String jsonStr = redisTemplate . opsForValue (). get ( ArticleConstans . HOT_ARTICLE_FIRST_PAGE + dto . getTag ()); //[{},{},{}] ->String if ( StringUtils . isNotBlank ( jsonStr )){ //\u8fd8\u539f\u6210list List < HotArticleVo > hotArticleVoList = JSON . parseArray ( jsonStr , HotArticleVo . class ); if ( ! hotArticleVoList . isEmpty ()){ ResponseResult responseResult = ResponseResult . okResult ( hotArticleVoList ); responseResult . setHost ( fileServerUrl ); return responseResult ; } } } return load ( dto , loadType ); }","title":"22-\u67e5\u8be2\u70ed\u70b9\u6570\u636e 07:04"},{"location":"hmtt/day13/#23-_0704","text":"","title":"23-\u6d4b\u8bd5\u5b9e\u65f6\u6570\u636e 07:04"},{"location":"hmtt/day14/","text":"\u4f7f\u7528\u8001\u5e08\u63d0\u4f9b\u7684\u865a\u62df\u673a\uff0c\u672c\u65e5\u8bfe\u7a0b\u4e2d\u5185\u5bb9\u90fd\u5df2\u7ecf\u914d\u7f6e\u5b8c\u6bd5\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\uff08\u6ce8\u610f\u662fleadnews14-jenkinsall\uff09\u3002 \u8bbe\u7f6e\u6a21\u5f0f\u4e3anat\u6a21\u5f0f\uff0c\u70b9\u51fb\u7f16\u8f91-\u865a\u62df\u7f51\u7edc\u7f16\u8f91\u5668 \u5f00\u673a\u4e4b\u540e\u6309\u987a\u5e8f\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a docker start zookeeper #\u542f\u52a8\u6210\u529f\u4e4b\u540e docker start kafka nacos mysql #\u542f\u52a8\u670d\u52a1 docker start heima-leadnews-user heima-leadnews-admin heima-leadnews-admin-gateway heima-leadnews-wemedia \u542f\u52a8nginx: /usr/local/nginx/sbin/nginx \u8bbf\u95eehttp://192.168.226.135/ \u67e5\u8be2docker\u65e5\u5fd7\uff1a docker logs \u5bb9\u5668ID\u6216\u8005\u5bb9\u5668\u540d","title":"day14"},{"location":"hmtt/day15/","text":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 01:30 \u00b6 \u80fd\u8bf4\u51fa\u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a\u7684\u6982\u5ff5\uff0c\u4ee5\u53ca\u4e3a\u4ec0\u4e48\u8981\u94fe\u8def\u8ffd\u8e2a \u80fd\u8bf4\u51faGoogle Dapper\u4e2d\u7684\u4e00\u4e9b\u6982\u5ff5\uff0c\u5982trace\uff0cspan\uff0c\u91c7\u6837\u7387 \u80fd\u8bf4\u51faOpenTracing\u6807\u51c6\u4e2d\u5b9a\u4e49\u7684Trace\uff0cSpan\uff0c\u4ee5\u53caSpan\u7684\u7ec4\u6210 \u80fd\u591f\u8bf4\u51faskywalking\u7684\u6838\u5fc3\u529f\u80fd\u8981\u70b9 \u80fd\u591f\u8bf4\u51faskywalking\u7ec4\u6210 \u5b8c\u6210skywalking\u7684\u73af\u5883\u642d\u5efa \u5b8c\u6210\u5e94\u7528\u7a0b\u5e8f\u63a5\u5165skywalking\u7684\u529f\u80fd \u5b8c\u6210skywalking\u90ae\u4ef6\u544a\u8b66\u7684\u529f\u80fd \u5b8c\u6210\u9879\u76ee\u81ea\u52a8\u5316\u90e8\u7f72\u63a5\u5165skywalking 02-\u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a\u6982\u8ff0 08\uff1a56 \u00b6 \u95ee\u9898\u5b9a\u4f4d\uff1a\u5f53\u67d0\u4e00\u4e2a\u670d\u52a1\u8282\u70b9\u51fa\u73b0\u95ee\u9898\u5bfc\u81f4\u6574\u4e2a\u8c03\u7528\u5931\u8d25\uff0c\u65e0\u6cd5\u5feb\u901f\u6e05\u6670\u5730\u5b9a\u4f4d\u95ee\u9898\u670d\u52a1\u3002 \u6bd4\u5982\u7ebf\u4e0a\u7a81\u7136\u51fa\u73b0\u4e86\u67d0\u7b14\u8c03\u7528\u5931\u8d25\u4e86\uff0c\u4f60\u5f97\u80fd\u77e5\u9053\u662f\u54ea\u513f\u51fa\u73b0\u4e86\u95ee\u9898\u3002\u4f46\u7531\u4e8e\u5fae\u670d\u52a1\u67b6\u6784\u4e0b\uff0c\u8c03\u7528\u94fe\u8def\u5f88\u590d\u6742\u3002\u53ef\u80fd\u662fA->B->C->D\uff0c\u9700\u8981\u76f4\u89c2\u7684\u5b9a\u4f4d\u5230\u662f\u54ea\u4e2a\u5fae\u670d\u52a1\uff08\u6bd4\u5982\u8bf4C\uff09\u51fa\u73b0\u4e86\u95ee\u9898 \u6027\u80fd\u5206\u6790\uff1a\u670d\u52a1\u5b58\u5728\u76f8\u4e92\u4f9d\u8d56\u8c03\u7528\u7684\u5173\u7cfb\uff0c\u5f53\u67d0\u4e00\u4e2a\u670d\u52a1\u63a5\u53e3\u8017\u65f6\u8fc7\u957f\uff0c\u4f1a\u5bfc\u81f4\u6574\u4e2a\u63a5\u53e3\u8c03\u7528\u53d8\u7684\u5f88\u6162\uff0c\u6211\u4eec\u65e0\u6cd5\u660e\u786e\u6bcf\u4e00\u4e2a\u63a5\u53e3\u7684\u8017\u65f6\u3002 \u4e0e\u4e0a\u95ee\u9898\u7c7b\u4f3c\uff0c\u94fe\u8def\u957f\u4e86\u4e4b\u540e\uff0c\u5f97\u77e5\u9053\u662f\u54ea\u513f\u6162\u4e86 \u670d\u52a1\u62d3\u6251\u56fe\uff1a\u968f\u7740\u9700\u6c42\u8fed\u4ee3\uff0c\u7cfb\u7edf\u4e4b\u95f4\u8c03\u7528\u5173\u7cfb\u53d8\u5316\u9891\u7e41\uff0c\u9760\u4eba\u5de5\u5f88\u96be\u68b3\u7406\u6e05\u695a\u7cfb\u7edf\u4e4b\u95f4\u7684\u8c03\u7528\u5173\u7cfb\u3002 \u662f\u5426\u6709\u4e0d\u5fc5\u8981\u7684\u8c03\u7528\u5173\u7cfb\uff1f \u662f\u5426\u6709\u4e0d\u5b89\u5168\u7684\u8c03\u7528\u65b9\u5728\u8c03\u7528\u6211\uff1f \u670d\u52a1\u544a\u8b66\uff1a\u5f53\u670d\u52a1\u51fa\u73b0\u95ee\u9898\uff0c\u6211\u4eec\u65e0\u6cd5\u505a\u5230\u7531\u7cfb\u7edf\u81ea\u52a8\u901a\u77e5\u76f8\u5173\u4eba\u5458\u3002 \u6ca1\u6709\u4eba\u4f1a24\u5c0f\u65f6\u76ef\u7740\u5c4f\u5e55\u76d1\u63a7\uff0c\u6700\u597d\u662f\u6709\u95ee\u9898\u60c5\u51b5\u4e0b\uff0c\u4e3b\u52a8\u901a\u77e5\u76f8\u5173\u4eba\u5458\uff08\u77ed\u4fe1\u6216\u8005\u90ae\u4ef6\uff09 \u4e0a\u56fe\u662f\u4e00\u4e2a\u8bf7\u6c42\u7684\u6d41\u7a0b\u4f8b\u5b50\uff0c\u8bf7\u6c42\u4ece\u5ba2\u6237\u7aef\u53d1\u51fa\uff0c\u5230\u8fbe\u8d1f\u8f7d\u5747\u8861\uff0c\u518d\u4f9d\u6b21\u8fdb\u884c\u8ba4\u8bc1\u3001\u8ba1\u8d39\uff0c\u6700\u540e\u53d6\u5230\u76ee\u6807\u8d44\u6e90\u3002 \u8bf7\u6c42\u8fc7\u7a0b\u88ab\u91c7\u96c6\u4e4b\u540e\uff0c\u4f1a\u4ee5\u4e0a\u56fe\u7684\u5f62\u5f0f\u5448\u73b0\uff0c\u6a2a\u5750\u6807\u662f\u65f6\u95f4\uff0c\u5706\u89d2\u77e9\u5f62\u662f\u8bf7\u6c42\u7684\u6267\u884c\u7684\u5404\u4e2a\u9636\u6bb5\u3002 03-Google Dapper 11:57 \u00b6 \u4e2d\u6587\u8bba\u6587\uff1ahttps://bigbully.github.io/Dapper-translation/ \u4e09\u4e2a\u76ee\u6807\uff1a \u4f4e\u6d88\u8017\uff1a\u5728\u751f\u4ea7\u73af\u5883\u4e0b\uff0c\u670d\u52a1\u7684\u4e00\u70b9\u70b9\u635f\u8017\uff0c\u90fd\u6709\u53ef\u80fd\u4e0d\u5f97\u4e0d\u5c06\u5176\u6458\u9664\u3002\u6240\u4ee5\u8ffd\u8e2a\u7cfb\u7edf\u5bf9\u4e8e\u670d\u52a1\u7684\u5f71\u54cd\u8981\u5c3d\u53ef\u80fd\u7684\u5c0f\u3002 \u5e94\u7528\u7ea7\u900f\u660e\uff1a\u5bf9\u4e8e\u5e94\u7528\u7684\u7a0b\u5e8f\u5458\u6765\u8bf4\uff0c\u662f\u4e0d\u9700\u8981\u77e5\u9053\u6709\u8ddf\u8e2a\u7cfb\u7edf\u8fd9\u56de\u4e8b\u7684\u3002\u5982\u679c\u4e00\u4e2a\u8ddf\u8e2a\u7cfb\u7edf\u60f3\u751f\u6548\uff0c\u8fd8\u5fc5\u987b\u8981\u4f9d\u8d56\u5e94\u7528\u7684\u5f00\u53d1\u8005\u4e3b\u52a8\u914d\u5408\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8ddf\u8e2a\u7cfb\u7edf\u4e5f\u592a\u8106\u5f31\u4e86\uff0c\u5f80\u5f80\u7531\u4e8e\u8ddf\u8e2a\u7cfb\u7edf\u5728\u5e94\u7528\u4e2d\u690d\u5165\u4ee3\u7801\u7684bug\u6216\u758f\u5ffd\u5bfc\u81f4\u5e94\u7528\u7cfb\u7edf\u51fa\u4e86\u95ee\u9898\uff0c\u90a3\u8fd9\u6837\u65e0\u6cd5\u6ee1\u8db3\u6211\u4eec\u5bf9\u8ddf\u8e2a\u7cfb\u7edf\u201c\u65e0\u6240\u4e0d\u5728\u7684\u90e8\u7f72\u201d\u8fd9\u4e2a\u9700\u6c42\uff0c\u5bf9\u4e8e\u5f53\u4e0b\u8fd9\u79cd\u5feb\u8282\u594f\u7684\u5f00\u53d1\u73af\u5883\u6765\u8bf4\u5c24\u4e3a\u91cd\u8981\u3002 \u5ef6\u5c55\u6027\uff1a\u968f\u7740\u6211\u4eec\u4e1a\u52a1\u7684\u7cfb\u7edf\u7684\u53d8\u5316\uff0c\u6211\u4eec\u7684\u8ddf\u8e2a\u7cfb\u7edf\u9700\u8981\u80fd\u591f\u652f\u6491\u672a\u6765\u670d\u52a1\u548c\u96c6\u7fa4\u89c4\u6a21\u7684\u53d8\u5316\u3002 \u96be\u70b9\uff1a \u5728\u6574\u4e2a\u7cfb\u7edf\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u8fd9\u4e48\u591a\u8c03\u7528\uff0c\u5982\u4f55\u77e5\u9053\u8fd9\u51e0\u7b14\u8c03\u7528\u4f3c\u4e4e\u4e00\u6b21\u7528\u6237\u8bf7\u6c42\u4e2d\u7684\uff1f \u901a\u8fc7\u5728\u4e00\u6b21\u643a\u5e26\u5168\u5c40ID\u6765\u4fdd\u8bc1\u6bcf\u6b21\u8bf7\u6c42\u7684\u8c03\u7528\u90fd\u62e5\u6709\u76f8\u540c\u7684ID \u5982\u4f55\u5206\u8fa8\u8c03\u7528\u7684\u5148\u540e\u5173\u7cfb\uff1f \u901a\u8fc7span id\u548cparent id\u6765\u5206\u8fa8\u8c03\u7528\u7684\u7236\u5b50\u5173\u7cfb \u5982\u4f55\u8ba1\u7b97\u8c03\u7528\u7684\u65f6\u95f4\uff1f \u8bb0\u5f55\u8c03\u7528\u5f00\u59cb\u65f6\u95f4\u548c\u7ed3\u675f\u65f6\u95f4\uff0c\u8ba1\u7b97\u6bcf\u4e00\u7b14\u8c03\u7528\u7684\u65f6\u95f4 04-Open Tracing 03:33 \u00b6 OpenTracing \u662f\u4e00\u4e2a\u4e2d\u7acb\u7684\uff08\u5382\u5546\u65e0\u5173\u3001\u5e73\u53f0\u65e0\u5173\uff09\u5206\u5e03\u5f0f\u8ffd\u8e2a\u7684 API \u89c4\u8303\uff0c\u63d0\u4f9b\u7edf\u4e00\u63a5\u53e3\uff0c\u53ef\u65b9\u4fbf\u5f00\u53d1\u8005\u5728\u81ea\u5df1\u7684\u670d\u52a1\u4e2d\u96c6\u6210\u4e00\u79cd\u6216\u591a\u79cd\u5206\u5e03\u5f0f\u8ffd\u8e2a\u7684\u5b9e\u73b0\u3002 OpenTracing \u5b9a\u4e49\u4e86\u4e00\u5957\u901a\u7528\u7684\u6570\u636e\u4e0a\u62a5\u63a5\u53e3\uff0c\u8981\u6c42\u5404\u4e2a\u5206\u5e03\u5f0f\u8ffd\u8e2a\u7cfb\u7edf\u90fd\u6765\u5b9e\u73b0\u8fd9\u5957\u63a5\u53e3\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ea\u9700\u8981\u5bf9\u63a5 OpenTracing\uff0c\u800c\u65e0\u9700\u5173\u5fc3\u540e\u7aef\u91c7\u7528\u7684\u5230\u5e95\u4ec0\u4e48\u5206\u5e03\u5f0f\u8ffd\u8e2a\u7cfb\u7edf\uff0c\u56e0\u6b64\u5f00\u53d1\u8005\u53ef\u4ee5\u65e0\u7f1d\u5207\u6362\u5206\u5e03\u5f0f\u8ffd\u8e2a\u7cfb\u7edf\uff0c\u4e5f\u4f7f\u5f97\u5728\u901a\u7528\u4ee3\u7801\u5e93\u589e\u52a0\u5bf9\u5206\u5e03\u5f0f\u8ffd\u8e2a\u7684\u652f\u6301\u6210\u4e3a\u53ef\u80fd\u3002 Causal relationships between Spans in a single Trace \u89e3\u91ca\u4e86 Trace \u548c Span\u7684\u56e0\u679c\u5173\u7cfb [ Span A ] \u2190\u2190\u2190 ( the root span ) | +------+------+ | | [ Span B ] [ Span C ] \u2190\u2190\u2190 ( Span C is a ` ChildOf ` Span A ) | | [ Span D ] +---+-------+ | | [ Span E ] [ Span F ] >>> [ Span G ] >>> [ Span H ] \u2191 \u2191 \u2191 ( Span G ` FollowsFrom ` Span F ) Trace \uff1a\u8c03\u7528\u94fe\uff0c\u6bcf\u4e2a\u8c03\u7528\u94fe\u7531\u591a\u4e2a Span \u7ec4\u6210\uff08\u53ef\u7c7b\u6bd4\u4e3a\u54b1\u4eec\u4e4b\u524d\u6240\u8bf4\u7684\u8ddf\u8e2a\u6811\uff09\u3002 Span \uff1a\u53ef\u4ee5\u7406\u89e3\u4e3a\u67d0\u4e2a\u5904\u7406\u9636\u6bb5\u3002Span \u548c Span \u7684\u5173\u7cfb\u79f0\u4e3a Reference\u3002\u4e0a\u56fe\u4e2d\uff0c\u603b\u5171\u6709\u6807\u53f7\u4e3a A-H \u7684 8 \u4e2a\u9636\u6bb5\uff08\u6bcf\u4e00\u6b21\u7684\u8c03\u7528\u5c31\u662f\u4e00\u4e2a\u5904\u7406\u9636\u6bb5\uff09\u3002 05-java agent\u6982\u8ff0 04:35 \u00b6 \u5176\u5b9ejava Agent\u5728JDK1.5\u4ee5\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528agent\u6280\u672f\u6784\u5efa\u4e00\u4e2a \u72ec\u7acb\u4e8e\u5e94\u7528\u7a0b\u5e8f\u7684\u4ee3\u7406\u7a0b\u5e8f\uff08\u5373Agent\uff0c\u5c31\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u7a0b\u5e8f\uff09 \uff0c\u7528\u6765\u534f\u52a9\u76d1\u6d4b\u3001\u8fd0\u884c\u751a\u81f3\u66ff\u6362\u5176\u4ed6JVM\u4e0a\u7684\u7a0b\u5e8f\u3002\u4f7f\u7528\u5b83\u53ef\u4ee5\u5b9e\u73b0\u865a\u62df\u673a\u7ea7\u522b\u7684AOP\u529f\u80fd\uff0c\u5e76\u4e14\u8fd9\u79cd\u65b9\u5f0f\u4e00\u4e2a\u5178\u578b\u7684\u4f18\u52bf\u5c31\u662f\u65e0\u4ee3\u7801\u4fb5\u5165\u3002 06-java agent\u5165\u95e8 14:35 \u00b6 07-\u63a2\u9488\u6280\u672f\u603b\u7ed3 03:02 \u00b6 08-skywalking\u6982\u8ff0 04:27 \u00b6 \u4e3b\u6d41\u7684\u5f00\u6e90APM\u4ea7\u54c1 \u00b6 PinPoint \u00b6 Pinpoint\u662f\u7531\u4e00\u4e2a\u97e9\u56fd\u56e2\u961f\u5b9e\u73b0\u5e76\u5f00\u6e90\uff0c\u9488\u5bf9Java\u7f16\u5199\u7684\u5927\u89c4\u6a21\u5206\u5e03\u5f0f\u7cfb\u7edf\u8bbe\u8ba1\uff0c\u901a\u8fc7JavaAgent\u7684\u673a\u5236\u505a\u5b57\u8282\u4ee3\u7801\u690d\u5165\uff0c\u5b9e\u73b0\u52a0\u5165traceid\u548c\u83b7\u53d6\u6027\u80fd\u6570\u636e\u7684\u76ee\u7684\uff0c\u5bf9\u5e94\u7528\u4ee3\u7801\u96f6\u4fb5\u5165\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://github.com/naver/pinpoint SkyWalking \u00b6 SkyWalking\u662fapache\u57fa\u91d1\u4f1a\u4e0b\u9762\u7684\u4e00\u4e2a\u5f00\u6e90APM\u9879\u76ee\uff0c\u4e3a\u5fae\u670d\u52a1\u67b6\u6784\u548c\u4e91\u539f\u751f\u67b6\u6784\u7cfb\u7edf\u8bbe\u8ba1\u3002\u5b83\u901a\u8fc7\u63a2\u9488\u81ea\u52a8\u6536\u96c6\u6240\u9700\u7684\u6307\u6807\uff0c\u5e76\u8fdb\u884c\u5206\u5e03\u5f0f\u8ffd\u8e2a\u3002\u901a\u8fc7\u8fd9\u4e9b\u8c03\u7528\u94fe\u8def\u4ee5\u53ca\u6307\u6807\uff0cSkywalking APM\u4f1a\u611f\u77e5\u5e94\u7528\u95f4\u5173\u7cfb\u548c\u670d\u52a1\u95f4\u5173\u7cfb\uff0c\u5e76\u8fdb\u884c\u76f8\u5e94\u7684\u6307\u6807\u7edf\u8ba1\u3002Skywalking\u652f\u6301\u94fe\u8def\u8ffd\u8e2a\u548c\u76d1\u63a7\u5e94\u7528\u7ec4\u4ef6\u57fa\u672c\u6db5\u76d6\u4e3b\u6d41\u6846\u67b6\u548c\u5bb9\u5668\uff0c\u5982\u56fd\u4ea7RPC Dubbo\u548cmotan\u7b49\uff0c\u56fd\u9645\u5316\u7684spring boot\uff0cspring cloud\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a http://skywalking.apache.org/ Zipkin \u00b6 Zipkin\u662f\u7531Twitter\u5f00\u6e90\uff0c\u662f\u5206\u5e03\u5f0f\u94fe\u8def\u8c03\u7528\u76d1\u63a7\u7cfb\u7edf\uff0c\u805a\u5408\u5404\u4e1a\u52a1\u7cfb\u7edf\u8c03\u7528\u5ef6\u8fdf\u6570\u636e\uff0c\u8fbe\u5230\u94fe\u8def\u8c03\u7528\u76d1\u63a7\u8ddf\u8e2a\u3002Zipkin\u57fa\u4e8eGoogle\u7684Dapper\u8bba\u6587\u5b9e\u73b0\uff0c\u4e3b\u8981\u5b8c\u6210\u6570\u636e\u7684\u6536\u96c6\u3001\u5b58\u50a8\u3001\u641c\u7d22\u4e0e\u754c\u9762\u5c55\u793a\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://zipkin.io/ CAT \u00b6 CAT\u662f\u7531\u5927\u4f17\u70b9\u8bc4\u5f00\u6e90\u7684\u9879\u76ee\uff0c\u57fa\u4e8eJava\u5f00\u53d1\u7684\u5b9e\u65f6\u5e94\u7528\u76d1\u63a7\u5e73\u53f0\uff0c\u5305\u62ec\u5b9e\u65f6\u5e94\u7528\u76d1\u63a7\uff0c\u4e1a\u52a1\u76d1\u63a7\uff0c\u53ef\u4ee5\u63d0\u4f9b\u5341\u51e0\u5f20\u62a5\u8868\u5c55\u793a\u3002 \u5b98\u65b9\u7f51\u7ad9: https://github.com/dianping/cat \u6559\u7a0b\uff1a https://ke.qq.com/course/2645411 09-skywalking\u67b6\u6784\u8bbe\u8ba1 02:37 \u00b6 \u6574\u4f53\u67b6\u6784\u5305\u542b\u5982\u4e0b\u4e09\u4e2a\u7ec4\u6210\u90e8\u5206\uff1a \u63a2\u9488(agent)\u8d1f\u8d23\u8fdb\u884c\u6570\u636e\u7684\u6536\u96c6\uff0c\u5305\u542b\u4e86Tracing\u548cMetrics\u7684\u6570\u636e\uff0cagent\u4f1a\u88ab\u5b89\u88c5\u5230\u670d\u52a1\u6240\u5728\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u4ee5\u65b9\u4fbf\u6570\u636e\u7684\u83b7\u53d6\u3002 \u53ef\u89c2\u6d4b\u6027\u5206\u6790\u5e73\u53f0OAP(Observability Analysis Platform)\uff0c\u63a5\u6536\u63a2\u9488\u53d1\u9001\u7684\u6570\u636e\uff0c\u5e76\u5728\u5185\u5b58\u4e2d\u4f7f\u7528\u5206\u6790\u5f15\u64ce\uff08Analysis Core)\u8fdb\u884c\u6570\u636e\u7684\u6574\u5408\u8fd0\u7b97\uff0c\u7136\u540e\u5c06\u6570\u636e\u5b58\u50a8\u5230\u5bf9\u5e94\u7684\u5b58\u50a8\u4ecb\u8d28\u4e0a\uff0c\u6bd4\u5982Elasticsearch\u3001MySQL\u6570\u636e\u5e93\u3001H2\u6570\u636e\u5e93\u7b49\u3002\u540c\u65f6OAP\u8fd8\u4f7f\u7528\u67e5\u8be2\u5f15\u64ce(Query Core)\u63d0\u4f9bHTTP\u67e5\u8be2\u63a5\u53e3\u3002 Skywalking\u63d0\u4f9b\u5355\u72ec\u7684UI\u8fdb\u884c\u6570\u636e\u7684\u67e5\u770b\uff0c\u6b64\u65f6UI\u4f1a\u8c03\u7528OAP\u63d0\u4f9b\u7684\u63a5\u53e3\uff0c\u83b7\u53d6\u5bf9\u5e94\u7684\u6570\u636e\u7136\u540e\u8fdb\u884c\u5c55\u793a\u3002 \u793e\u533a\u76f8\u5f53\u6d3b\u8dc3\u3002Skywalking\u5df2\u7ecf\u8fdb\u5165apache\u5b75\u5316\u3002\u5f00\u53d1\u8005\u662f\u56fd\u4eba\uff0c\u53ef\u4ee5\u76f4\u63a5\u548c\u9879\u76ee\u53d1\u8d77\u4eba\u4ea4\u6d41\u8fdb\u884c\u95ee\u9898\u7684\u89e3\u51b3\u3002 Skywalking\u652f\u6301Java\uff0c.NET Core\u548cNode.JS\u8bed\u8a00\u3002\u76f8\u5bf9\u4e8e\u5176\u4ed6\u5e73\u53f0\uff1a\u6bd4\u5982Pinpoint\u652f\u6301Java\u548cPHP,\u5177\u6709\u8f83\u5927\u7684\u4f18\u52bf\u3002 \u63a2\u9488\u65e0\u503e\u5165\u6027\u3002\u5bf9\u6bd4CAT\u5177\u6709\u503e\u5165\u6027\u7684\u63a2\u9488\uff0c\u4f18\u52bf\u8f83\u5927\u3002\u4e0d\u4fee\u6539\u539f\u6709\u9879\u76ee\u4e00\u884c\u4ee3\u7801\u5c31\u53ef\u4ee5\u8fdb\u884c\u96c6\u6210\u3002 \u63a2\u9488\u6027\u80fd\u4f18\u79c0\u3002\u6709\u7f51\u53cb\u5bf9Pinpoint\u548cSkywalking\u8fdb\u884c\u8fc7\u6d4b\u8bd5\uff0c\u7531\u4e8ePinpoint\u6536\u96c6\u7684\u6570\u636e\u8fc7\u591a\uff0c\u6240\u4ee5\u5bf9\u6027\u80fd\u635f\u8017\u8f83\u5927\uff0c\u800cSkywalking\u63a2\u9488\u6027\u80fd\u5341\u5206\u51fa\u8272\u3002 \u652f\u6301\u7ec4\u4ef6\u8f83\u591a\u3002\u7279\u522b\u662f\u5bf9Rpc\u6846\u67b6\u7684\u652f\u6301\uff0c\u8fd9\u662f\u5176\u4ed6\u6846\u67b6\u6240\u4e0d\u5177\u5907\u7684\u3002Skywalking\u5bf9Dubbo\u3001gRpc\u7b49\u6709\u539f\u751f\u7684\u652f\u6301\uff0c\u751a\u81f3\u8fde\u5c0f\u4f17\u7684motan\u548csofarpc\u90fd\u652f\u6301\u3002 10-skywalking\u73af\u5883\u642d\u5efa 08:26 \u00b6 \u8fd9\u91cc\u53bb\u6389\u4e86--restart always\uff08docker\u542f\u52a8\u65f6\u5c31\u542f\u52a8\u8fd9\u4e2a\u5bb9\u5668\uff09\uff0c\u9632\u6b62\u5185\u5b58\u4e0d\u8db3\uff0c\u7528\u65f6\u518d\u542f\u52a8\u5373\u53ef \u542f\u52a8\u547d\u4ee4\uff1a docker start skywalking,skywalking-ui 11-\u5e94\u7528\u7a0b\u5e8f\u63a5\u5165 06:47 \u00b6 \u76f4\u63a5\u4f7f\u7528\u8d44\u6599\u4e2d\u63d0\u4f9b\u7684agent\u6587\u4ef6\u5939\u5373\u53ef\uff0c\u5185\u90e8\u914d\u7f6e\u7684ip\u5730\u5740\u5df2\u7ecf\u66f4\u6539\u4e3a192.168.226.134 \u542f\u52a8\u53c2\u6570vm-options\u4e2d\u6dfb\u52a0: -javaagent:D:\\develop\\agent\\skywalking-agent.jar -Dskywalking.agent.service_name=leadnews-admin \u95ee\u9898\uff1askywalking\u5e94\u7528\u4e0espringcloud-gateway\u65f6\u65e0\u6cd5\u901a\u8fc7gateway\u53d1\u73b0\u8def\u7531\u7684\u670d\u52a1\u94fe\u8def\uff1f \u00b6 \u539f\u56e0\uff1a Spring Cloud Gateway \u662f\u57fa\u4e8e WebFlux \u5b9e\u73b0\uff0c\u5fc5\u987b\u642d\u914d\u4e0a apm-spring-cloud-gateway-2.1.x-plugin \u548c apm-spring-webflux-x.x-plugin \u4e24\u4e2a\u63d2\u4ef6\uff08\u5907\u6ce8\uff1a \u4e00\u822cwebflux\u5df2\u7ecf\u5305\u542b\u5728\u76ee\u6807\u8def\u5f84\u4e0b\uff09 \u65b9\u6848\uff1a \u5c06agent/optional-plugins\u4e0b\u7684\u4e24\u4e2a\u63d2\u4ef6 \u590d\u5236\u5230 agent/plugins\u76ee\u5f55\u4e0b 12-UI\u6307\u6807\u5185\u5bb9\u4ecb\u7ecd 05:41 \u00b6 \u6269\u5c55\u5185\u5bb9\uff1a\u524d\u7aef\u53d1\u73b0\u4e00\u4e2a\u63a5\u53e3\u8c03\u4e0d\u901a\u4e86\uff0c\u600e\u4e48\u5feb\u901f\u5b9a\u4f4d\u5230\u95ee\u9898\uff1f \u00b6 1\uff0c\u5f15\u5165\u4f9d\u8d56jar\u5305 <dependency> <groupId> org.apache.skywalking </groupId> <artifactId> apm-toolkit-trace </artifactId> <version> 8.2.0 </version> </dependency> 2\uff0c\u65b9\u6cd5\u8c03\u7528 import org.apache.skywalking.apm.toolkit.trace.TraceContext ; String traceId = TraceContext . traceId (); \u53ef\u4ee5\u5c06traceid\u8fd4\u56de\u7ed9\u524d\u7aef\u3002 \u63a5\u4e0b\u6765\u5728UI\u4e0a\u641c\u7d22\u8fd9\u4e2aTraceId: \u8fd9\u6837\u5c31\u53ef\u4ee5\u5b9a\u4f4d\u5230\u5bf9\u5e94\u7684\u8fd9\u4e00\u7b14\u8c03\u7528\u4e86\u3002 13-\u544a\u8b66\u89c4\u5219\u8bf4\u660e 10:38 \u00b6 SkyWalking \u544a\u8b66\u529f\u80fd\u662f\u57286.x\u7248\u672c\u65b0\u589e\u7684\uff0c\u5176\u6838\u5fc3\u7531\u4e00\u7ec4\u89c4\u5219\u9a71\u52a8\uff0c\u8fd9\u4e9b\u89c4\u5219\u5b9a\u4e49\u5728 config/alarm-settings.yml \u6587\u4ef6\u4e2d\u3002 \u544a\u8b66\u7684\u5b9a\u4e49\u5206\u4e3a\u4e24\u90e8\u5206\uff1a \u544a\u8b66\u89c4\u5219 \uff1a\u5b83\u4eec\u5b9a\u4e49\u4e86\u5e94\u8be5\u5982\u4f55\u89e6\u53d1\u5ea6\u91cf\u8b66\u62a5\uff0c\u5e94\u8be5\u8003\u8651\u4ec0\u4e48\u6761\u4ef6\u3002 Webhook\uff08\u7f51\u7edc\u94a9\u5b50\uff09 \uff1a\u5b9a\u4e49\u5f53\u8b66\u544a\u89e6\u53d1\u65f6\uff0c\u54ea\u4e9b\u670d\u52a1\u7ec8\u7aef\u9700\u8981\u88ab\u544a\u77e5 \u5199\u4e2a\u63a5\u53e3\uff0c\u544a\u8b66\u65f6\u4f1a\u56de\u8c03\u4f60\u7684\u63a5\u53e3\uff0c\u63a5\u53e3\u91cc\u53ef\u4ee5\u53d1\u77ed\u4fe1\u3001\u53d1\u90ae\u4ef6 \u4fee\u6539\u56de\u8c03\u65b9\u6cd5\u7684\u5730\u5740: docker exec - it skywalking / bin / bash vi config / alarm - settings . yml 14-15-\u544a\u8b66\u529f\u80fd-\u529f\u80fd\u5b8c\u6210 10:14+18\uff1a27 \u00b6 \u65b0\u7248\u672c\u4e2d\uff0c\u6570\u636e\u5305\u5df2\u7ecf\u53d8\u66f4\u4e3a\u5982\u4e0b\u683c\u5f0f\uff1a AlarmMessage(scopeId=1, name=leadnews-admin, id0=bGVhZG5ld3MtYWRtaW4=.1, id1=, alarmMessage=Successful rate of service leadnews-admin is lower than 80% in 2 minutes of last 10 minutes, startTime=1606119016400) id0\u548cid1\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u6240\u4ee5\u9700\u8981\u4fee\u6539\u5b9e\u4f53\u7c7b\uff1a package com.heima.admin.domain ; import lombok.Data ; @Data public class AlarmMessage { private int scopeId ; private String name ; private String id0 ; private String id1 ; private String alarmMessage ; private long startTime ; } 16-\u81ea\u52a8\u5316\u90e8\u7f72\u63a5\u5165skywalking 12:15 \u00b6 jenkins","title":"day15"},{"location":"hmtt/day15/#01-_0130","text":"\u80fd\u8bf4\u51fa\u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a\u7684\u6982\u5ff5\uff0c\u4ee5\u53ca\u4e3a\u4ec0\u4e48\u8981\u94fe\u8def\u8ffd\u8e2a \u80fd\u8bf4\u51faGoogle Dapper\u4e2d\u7684\u4e00\u4e9b\u6982\u5ff5\uff0c\u5982trace\uff0cspan\uff0c\u91c7\u6837\u7387 \u80fd\u8bf4\u51faOpenTracing\u6807\u51c6\u4e2d\u5b9a\u4e49\u7684Trace\uff0cSpan\uff0c\u4ee5\u53caSpan\u7684\u7ec4\u6210 \u80fd\u591f\u8bf4\u51faskywalking\u7684\u6838\u5fc3\u529f\u80fd\u8981\u70b9 \u80fd\u591f\u8bf4\u51faskywalking\u7ec4\u6210 \u5b8c\u6210skywalking\u7684\u73af\u5883\u642d\u5efa \u5b8c\u6210\u5e94\u7528\u7a0b\u5e8f\u63a5\u5165skywalking\u7684\u529f\u80fd \u5b8c\u6210skywalking\u90ae\u4ef6\u544a\u8b66\u7684\u529f\u80fd \u5b8c\u6210\u9879\u76ee\u81ea\u52a8\u5316\u90e8\u7f72\u63a5\u5165skywalking","title":"01-\u4eca\u65e5\u5b66\u4e60\u76ee\u6807 01:30"},{"location":"hmtt/day15/#02-_0856","text":"\u95ee\u9898\u5b9a\u4f4d\uff1a\u5f53\u67d0\u4e00\u4e2a\u670d\u52a1\u8282\u70b9\u51fa\u73b0\u95ee\u9898\u5bfc\u81f4\u6574\u4e2a\u8c03\u7528\u5931\u8d25\uff0c\u65e0\u6cd5\u5feb\u901f\u6e05\u6670\u5730\u5b9a\u4f4d\u95ee\u9898\u670d\u52a1\u3002 \u6bd4\u5982\u7ebf\u4e0a\u7a81\u7136\u51fa\u73b0\u4e86\u67d0\u7b14\u8c03\u7528\u5931\u8d25\u4e86\uff0c\u4f60\u5f97\u80fd\u77e5\u9053\u662f\u54ea\u513f\u51fa\u73b0\u4e86\u95ee\u9898\u3002\u4f46\u7531\u4e8e\u5fae\u670d\u52a1\u67b6\u6784\u4e0b\uff0c\u8c03\u7528\u94fe\u8def\u5f88\u590d\u6742\u3002\u53ef\u80fd\u662fA->B->C->D\uff0c\u9700\u8981\u76f4\u89c2\u7684\u5b9a\u4f4d\u5230\u662f\u54ea\u4e2a\u5fae\u670d\u52a1\uff08\u6bd4\u5982\u8bf4C\uff09\u51fa\u73b0\u4e86\u95ee\u9898 \u6027\u80fd\u5206\u6790\uff1a\u670d\u52a1\u5b58\u5728\u76f8\u4e92\u4f9d\u8d56\u8c03\u7528\u7684\u5173\u7cfb\uff0c\u5f53\u67d0\u4e00\u4e2a\u670d\u52a1\u63a5\u53e3\u8017\u65f6\u8fc7\u957f\uff0c\u4f1a\u5bfc\u81f4\u6574\u4e2a\u63a5\u53e3\u8c03\u7528\u53d8\u7684\u5f88\u6162\uff0c\u6211\u4eec\u65e0\u6cd5\u660e\u786e\u6bcf\u4e00\u4e2a\u63a5\u53e3\u7684\u8017\u65f6\u3002 \u4e0e\u4e0a\u95ee\u9898\u7c7b\u4f3c\uff0c\u94fe\u8def\u957f\u4e86\u4e4b\u540e\uff0c\u5f97\u77e5\u9053\u662f\u54ea\u513f\u6162\u4e86 \u670d\u52a1\u62d3\u6251\u56fe\uff1a\u968f\u7740\u9700\u6c42\u8fed\u4ee3\uff0c\u7cfb\u7edf\u4e4b\u95f4\u8c03\u7528\u5173\u7cfb\u53d8\u5316\u9891\u7e41\uff0c\u9760\u4eba\u5de5\u5f88\u96be\u68b3\u7406\u6e05\u695a\u7cfb\u7edf\u4e4b\u95f4\u7684\u8c03\u7528\u5173\u7cfb\u3002 \u662f\u5426\u6709\u4e0d\u5fc5\u8981\u7684\u8c03\u7528\u5173\u7cfb\uff1f \u662f\u5426\u6709\u4e0d\u5b89\u5168\u7684\u8c03\u7528\u65b9\u5728\u8c03\u7528\u6211\uff1f \u670d\u52a1\u544a\u8b66\uff1a\u5f53\u670d\u52a1\u51fa\u73b0\u95ee\u9898\uff0c\u6211\u4eec\u65e0\u6cd5\u505a\u5230\u7531\u7cfb\u7edf\u81ea\u52a8\u901a\u77e5\u76f8\u5173\u4eba\u5458\u3002 \u6ca1\u6709\u4eba\u4f1a24\u5c0f\u65f6\u76ef\u7740\u5c4f\u5e55\u76d1\u63a7\uff0c\u6700\u597d\u662f\u6709\u95ee\u9898\u60c5\u51b5\u4e0b\uff0c\u4e3b\u52a8\u901a\u77e5\u76f8\u5173\u4eba\u5458\uff08\u77ed\u4fe1\u6216\u8005\u90ae\u4ef6\uff09 \u4e0a\u56fe\u662f\u4e00\u4e2a\u8bf7\u6c42\u7684\u6d41\u7a0b\u4f8b\u5b50\uff0c\u8bf7\u6c42\u4ece\u5ba2\u6237\u7aef\u53d1\u51fa\uff0c\u5230\u8fbe\u8d1f\u8f7d\u5747\u8861\uff0c\u518d\u4f9d\u6b21\u8fdb\u884c\u8ba4\u8bc1\u3001\u8ba1\u8d39\uff0c\u6700\u540e\u53d6\u5230\u76ee\u6807\u8d44\u6e90\u3002 \u8bf7\u6c42\u8fc7\u7a0b\u88ab\u91c7\u96c6\u4e4b\u540e\uff0c\u4f1a\u4ee5\u4e0a\u56fe\u7684\u5f62\u5f0f\u5448\u73b0\uff0c\u6a2a\u5750\u6807\u662f\u65f6\u95f4\uff0c\u5706\u89d2\u77e9\u5f62\u662f\u8bf7\u6c42\u7684\u6267\u884c\u7684\u5404\u4e2a\u9636\u6bb5\u3002","title":"02-\u5206\u5e03\u5f0f\u94fe\u8def\u8ffd\u8e2a\u6982\u8ff0 08\uff1a56"},{"location":"hmtt/day15/#03-google_dapper_1157","text":"\u4e2d\u6587\u8bba\u6587\uff1ahttps://bigbully.github.io/Dapper-translation/ \u4e09\u4e2a\u76ee\u6807\uff1a \u4f4e\u6d88\u8017\uff1a\u5728\u751f\u4ea7\u73af\u5883\u4e0b\uff0c\u670d\u52a1\u7684\u4e00\u70b9\u70b9\u635f\u8017\uff0c\u90fd\u6709\u53ef\u80fd\u4e0d\u5f97\u4e0d\u5c06\u5176\u6458\u9664\u3002\u6240\u4ee5\u8ffd\u8e2a\u7cfb\u7edf\u5bf9\u4e8e\u670d\u52a1\u7684\u5f71\u54cd\u8981\u5c3d\u53ef\u80fd\u7684\u5c0f\u3002 \u5e94\u7528\u7ea7\u900f\u660e\uff1a\u5bf9\u4e8e\u5e94\u7528\u7684\u7a0b\u5e8f\u5458\u6765\u8bf4\uff0c\u662f\u4e0d\u9700\u8981\u77e5\u9053\u6709\u8ddf\u8e2a\u7cfb\u7edf\u8fd9\u56de\u4e8b\u7684\u3002\u5982\u679c\u4e00\u4e2a\u8ddf\u8e2a\u7cfb\u7edf\u60f3\u751f\u6548\uff0c\u8fd8\u5fc5\u987b\u8981\u4f9d\u8d56\u5e94\u7528\u7684\u5f00\u53d1\u8005\u4e3b\u52a8\u914d\u5408\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8ddf\u8e2a\u7cfb\u7edf\u4e5f\u592a\u8106\u5f31\u4e86\uff0c\u5f80\u5f80\u7531\u4e8e\u8ddf\u8e2a\u7cfb\u7edf\u5728\u5e94\u7528\u4e2d\u690d\u5165\u4ee3\u7801\u7684bug\u6216\u758f\u5ffd\u5bfc\u81f4\u5e94\u7528\u7cfb\u7edf\u51fa\u4e86\u95ee\u9898\uff0c\u90a3\u8fd9\u6837\u65e0\u6cd5\u6ee1\u8db3\u6211\u4eec\u5bf9\u8ddf\u8e2a\u7cfb\u7edf\u201c\u65e0\u6240\u4e0d\u5728\u7684\u90e8\u7f72\u201d\u8fd9\u4e2a\u9700\u6c42\uff0c\u5bf9\u4e8e\u5f53\u4e0b\u8fd9\u79cd\u5feb\u8282\u594f\u7684\u5f00\u53d1\u73af\u5883\u6765\u8bf4\u5c24\u4e3a\u91cd\u8981\u3002 \u5ef6\u5c55\u6027\uff1a\u968f\u7740\u6211\u4eec\u4e1a\u52a1\u7684\u7cfb\u7edf\u7684\u53d8\u5316\uff0c\u6211\u4eec\u7684\u8ddf\u8e2a\u7cfb\u7edf\u9700\u8981\u80fd\u591f\u652f\u6491\u672a\u6765\u670d\u52a1\u548c\u96c6\u7fa4\u89c4\u6a21\u7684\u53d8\u5316\u3002 \u96be\u70b9\uff1a \u5728\u6574\u4e2a\u7cfb\u7edf\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u8fd9\u4e48\u591a\u8c03\u7528\uff0c\u5982\u4f55\u77e5\u9053\u8fd9\u51e0\u7b14\u8c03\u7528\u4f3c\u4e4e\u4e00\u6b21\u7528\u6237\u8bf7\u6c42\u4e2d\u7684\uff1f \u901a\u8fc7\u5728\u4e00\u6b21\u643a\u5e26\u5168\u5c40ID\u6765\u4fdd\u8bc1\u6bcf\u6b21\u8bf7\u6c42\u7684\u8c03\u7528\u90fd\u62e5\u6709\u76f8\u540c\u7684ID \u5982\u4f55\u5206\u8fa8\u8c03\u7528\u7684\u5148\u540e\u5173\u7cfb\uff1f \u901a\u8fc7span id\u548cparent id\u6765\u5206\u8fa8\u8c03\u7528\u7684\u7236\u5b50\u5173\u7cfb \u5982\u4f55\u8ba1\u7b97\u8c03\u7528\u7684\u65f6\u95f4\uff1f \u8bb0\u5f55\u8c03\u7528\u5f00\u59cb\u65f6\u95f4\u548c\u7ed3\u675f\u65f6\u95f4\uff0c\u8ba1\u7b97\u6bcf\u4e00\u7b14\u8c03\u7528\u7684\u65f6\u95f4","title":"03-Google Dapper 11:57"},{"location":"hmtt/day15/#04-open_tracing_0333","text":"OpenTracing \u662f\u4e00\u4e2a\u4e2d\u7acb\u7684\uff08\u5382\u5546\u65e0\u5173\u3001\u5e73\u53f0\u65e0\u5173\uff09\u5206\u5e03\u5f0f\u8ffd\u8e2a\u7684 API \u89c4\u8303\uff0c\u63d0\u4f9b\u7edf\u4e00\u63a5\u53e3\uff0c\u53ef\u65b9\u4fbf\u5f00\u53d1\u8005\u5728\u81ea\u5df1\u7684\u670d\u52a1\u4e2d\u96c6\u6210\u4e00\u79cd\u6216\u591a\u79cd\u5206\u5e03\u5f0f\u8ffd\u8e2a\u7684\u5b9e\u73b0\u3002 OpenTracing \u5b9a\u4e49\u4e86\u4e00\u5957\u901a\u7528\u7684\u6570\u636e\u4e0a\u62a5\u63a5\u53e3\uff0c\u8981\u6c42\u5404\u4e2a\u5206\u5e03\u5f0f\u8ffd\u8e2a\u7cfb\u7edf\u90fd\u6765\u5b9e\u73b0\u8fd9\u5957\u63a5\u53e3\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ea\u9700\u8981\u5bf9\u63a5 OpenTracing\uff0c\u800c\u65e0\u9700\u5173\u5fc3\u540e\u7aef\u91c7\u7528\u7684\u5230\u5e95\u4ec0\u4e48\u5206\u5e03\u5f0f\u8ffd\u8e2a\u7cfb\u7edf\uff0c\u56e0\u6b64\u5f00\u53d1\u8005\u53ef\u4ee5\u65e0\u7f1d\u5207\u6362\u5206\u5e03\u5f0f\u8ffd\u8e2a\u7cfb\u7edf\uff0c\u4e5f\u4f7f\u5f97\u5728\u901a\u7528\u4ee3\u7801\u5e93\u589e\u52a0\u5bf9\u5206\u5e03\u5f0f\u8ffd\u8e2a\u7684\u652f\u6301\u6210\u4e3a\u53ef\u80fd\u3002 Causal relationships between Spans in a single Trace \u89e3\u91ca\u4e86 Trace \u548c Span\u7684\u56e0\u679c\u5173\u7cfb [ Span A ] \u2190\u2190\u2190 ( the root span ) | +------+------+ | | [ Span B ] [ Span C ] \u2190\u2190\u2190 ( Span C is a ` ChildOf ` Span A ) | | [ Span D ] +---+-------+ | | [ Span E ] [ Span F ] >>> [ Span G ] >>> [ Span H ] \u2191 \u2191 \u2191 ( Span G ` FollowsFrom ` Span F ) Trace \uff1a\u8c03\u7528\u94fe\uff0c\u6bcf\u4e2a\u8c03\u7528\u94fe\u7531\u591a\u4e2a Span \u7ec4\u6210\uff08\u53ef\u7c7b\u6bd4\u4e3a\u54b1\u4eec\u4e4b\u524d\u6240\u8bf4\u7684\u8ddf\u8e2a\u6811\uff09\u3002 Span \uff1a\u53ef\u4ee5\u7406\u89e3\u4e3a\u67d0\u4e2a\u5904\u7406\u9636\u6bb5\u3002Span \u548c Span \u7684\u5173\u7cfb\u79f0\u4e3a Reference\u3002\u4e0a\u56fe\u4e2d\uff0c\u603b\u5171\u6709\u6807\u53f7\u4e3a A-H \u7684 8 \u4e2a\u9636\u6bb5\uff08\u6bcf\u4e00\u6b21\u7684\u8c03\u7528\u5c31\u662f\u4e00\u4e2a\u5904\u7406\u9636\u6bb5\uff09\u3002","title":"04-Open Tracing 03:33"},{"location":"hmtt/day15/#05-java_agent_0435","text":"\u5176\u5b9ejava Agent\u5728JDK1.5\u4ee5\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528agent\u6280\u672f\u6784\u5efa\u4e00\u4e2a \u72ec\u7acb\u4e8e\u5e94\u7528\u7a0b\u5e8f\u7684\u4ee3\u7406\u7a0b\u5e8f\uff08\u5373Agent\uff0c\u5c31\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u7a0b\u5e8f\uff09 \uff0c\u7528\u6765\u534f\u52a9\u76d1\u6d4b\u3001\u8fd0\u884c\u751a\u81f3\u66ff\u6362\u5176\u4ed6JVM\u4e0a\u7684\u7a0b\u5e8f\u3002\u4f7f\u7528\u5b83\u53ef\u4ee5\u5b9e\u73b0\u865a\u62df\u673a\u7ea7\u522b\u7684AOP\u529f\u80fd\uff0c\u5e76\u4e14\u8fd9\u79cd\u65b9\u5f0f\u4e00\u4e2a\u5178\u578b\u7684\u4f18\u52bf\u5c31\u662f\u65e0\u4ee3\u7801\u4fb5\u5165\u3002","title":"05-java agent\u6982\u8ff0 04:35"},{"location":"hmtt/day15/#06-java_agent_1435","text":"","title":"06-java agent\u5165\u95e8 14:35"},{"location":"hmtt/day15/#07-_0302","text":"","title":"07-\u63a2\u9488\u6280\u672f\u603b\u7ed3 03:02"},{"location":"hmtt/day15/#08-skywalking_0427","text":"","title":"08-skywalking\u6982\u8ff0 04:27"},{"location":"hmtt/day15/#apm","text":"","title":"\u4e3b\u6d41\u7684\u5f00\u6e90APM\u4ea7\u54c1"},{"location":"hmtt/day15/#pinpoint","text":"Pinpoint\u662f\u7531\u4e00\u4e2a\u97e9\u56fd\u56e2\u961f\u5b9e\u73b0\u5e76\u5f00\u6e90\uff0c\u9488\u5bf9Java\u7f16\u5199\u7684\u5927\u89c4\u6a21\u5206\u5e03\u5f0f\u7cfb\u7edf\u8bbe\u8ba1\uff0c\u901a\u8fc7JavaAgent\u7684\u673a\u5236\u505a\u5b57\u8282\u4ee3\u7801\u690d\u5165\uff0c\u5b9e\u73b0\u52a0\u5165traceid\u548c\u83b7\u53d6\u6027\u80fd\u6570\u636e\u7684\u76ee\u7684\uff0c\u5bf9\u5e94\u7528\u4ee3\u7801\u96f6\u4fb5\u5165\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://github.com/naver/pinpoint","title":"PinPoint"},{"location":"hmtt/day15/#skywalking","text":"SkyWalking\u662fapache\u57fa\u91d1\u4f1a\u4e0b\u9762\u7684\u4e00\u4e2a\u5f00\u6e90APM\u9879\u76ee\uff0c\u4e3a\u5fae\u670d\u52a1\u67b6\u6784\u548c\u4e91\u539f\u751f\u67b6\u6784\u7cfb\u7edf\u8bbe\u8ba1\u3002\u5b83\u901a\u8fc7\u63a2\u9488\u81ea\u52a8\u6536\u96c6\u6240\u9700\u7684\u6307\u6807\uff0c\u5e76\u8fdb\u884c\u5206\u5e03\u5f0f\u8ffd\u8e2a\u3002\u901a\u8fc7\u8fd9\u4e9b\u8c03\u7528\u94fe\u8def\u4ee5\u53ca\u6307\u6807\uff0cSkywalking APM\u4f1a\u611f\u77e5\u5e94\u7528\u95f4\u5173\u7cfb\u548c\u670d\u52a1\u95f4\u5173\u7cfb\uff0c\u5e76\u8fdb\u884c\u76f8\u5e94\u7684\u6307\u6807\u7edf\u8ba1\u3002Skywalking\u652f\u6301\u94fe\u8def\u8ffd\u8e2a\u548c\u76d1\u63a7\u5e94\u7528\u7ec4\u4ef6\u57fa\u672c\u6db5\u76d6\u4e3b\u6d41\u6846\u67b6\u548c\u5bb9\u5668\uff0c\u5982\u56fd\u4ea7RPC Dubbo\u548cmotan\u7b49\uff0c\u56fd\u9645\u5316\u7684spring boot\uff0cspring cloud\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a http://skywalking.apache.org/","title":"SkyWalking"},{"location":"hmtt/day15/#zipkin","text":"Zipkin\u662f\u7531Twitter\u5f00\u6e90\uff0c\u662f\u5206\u5e03\u5f0f\u94fe\u8def\u8c03\u7528\u76d1\u63a7\u7cfb\u7edf\uff0c\u805a\u5408\u5404\u4e1a\u52a1\u7cfb\u7edf\u8c03\u7528\u5ef6\u8fdf\u6570\u636e\uff0c\u8fbe\u5230\u94fe\u8def\u8c03\u7528\u76d1\u63a7\u8ddf\u8e2a\u3002Zipkin\u57fa\u4e8eGoogle\u7684Dapper\u8bba\u6587\u5b9e\u73b0\uff0c\u4e3b\u8981\u5b8c\u6210\u6570\u636e\u7684\u6536\u96c6\u3001\u5b58\u50a8\u3001\u641c\u7d22\u4e0e\u754c\u9762\u5c55\u793a\u3002 \u5b98\u65b9\u7f51\u7ad9\uff1a https://zipkin.io/","title":"Zipkin"},{"location":"hmtt/day15/#cat","text":"CAT\u662f\u7531\u5927\u4f17\u70b9\u8bc4\u5f00\u6e90\u7684\u9879\u76ee\uff0c\u57fa\u4e8eJava\u5f00\u53d1\u7684\u5b9e\u65f6\u5e94\u7528\u76d1\u63a7\u5e73\u53f0\uff0c\u5305\u62ec\u5b9e\u65f6\u5e94\u7528\u76d1\u63a7\uff0c\u4e1a\u52a1\u76d1\u63a7\uff0c\u53ef\u4ee5\u63d0\u4f9b\u5341\u51e0\u5f20\u62a5\u8868\u5c55\u793a\u3002 \u5b98\u65b9\u7f51\u7ad9: https://github.com/dianping/cat \u6559\u7a0b\uff1a https://ke.qq.com/course/2645411","title":"CAT"},{"location":"hmtt/day15/#09-skywalking_0237","text":"\u6574\u4f53\u67b6\u6784\u5305\u542b\u5982\u4e0b\u4e09\u4e2a\u7ec4\u6210\u90e8\u5206\uff1a \u63a2\u9488(agent)\u8d1f\u8d23\u8fdb\u884c\u6570\u636e\u7684\u6536\u96c6\uff0c\u5305\u542b\u4e86Tracing\u548cMetrics\u7684\u6570\u636e\uff0cagent\u4f1a\u88ab\u5b89\u88c5\u5230\u670d\u52a1\u6240\u5728\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u4ee5\u65b9\u4fbf\u6570\u636e\u7684\u83b7\u53d6\u3002 \u53ef\u89c2\u6d4b\u6027\u5206\u6790\u5e73\u53f0OAP(Observability Analysis Platform)\uff0c\u63a5\u6536\u63a2\u9488\u53d1\u9001\u7684\u6570\u636e\uff0c\u5e76\u5728\u5185\u5b58\u4e2d\u4f7f\u7528\u5206\u6790\u5f15\u64ce\uff08Analysis Core)\u8fdb\u884c\u6570\u636e\u7684\u6574\u5408\u8fd0\u7b97\uff0c\u7136\u540e\u5c06\u6570\u636e\u5b58\u50a8\u5230\u5bf9\u5e94\u7684\u5b58\u50a8\u4ecb\u8d28\u4e0a\uff0c\u6bd4\u5982Elasticsearch\u3001MySQL\u6570\u636e\u5e93\u3001H2\u6570\u636e\u5e93\u7b49\u3002\u540c\u65f6OAP\u8fd8\u4f7f\u7528\u67e5\u8be2\u5f15\u64ce(Query Core)\u63d0\u4f9bHTTP\u67e5\u8be2\u63a5\u53e3\u3002 Skywalking\u63d0\u4f9b\u5355\u72ec\u7684UI\u8fdb\u884c\u6570\u636e\u7684\u67e5\u770b\uff0c\u6b64\u65f6UI\u4f1a\u8c03\u7528OAP\u63d0\u4f9b\u7684\u63a5\u53e3\uff0c\u83b7\u53d6\u5bf9\u5e94\u7684\u6570\u636e\u7136\u540e\u8fdb\u884c\u5c55\u793a\u3002 \u793e\u533a\u76f8\u5f53\u6d3b\u8dc3\u3002Skywalking\u5df2\u7ecf\u8fdb\u5165apache\u5b75\u5316\u3002\u5f00\u53d1\u8005\u662f\u56fd\u4eba\uff0c\u53ef\u4ee5\u76f4\u63a5\u548c\u9879\u76ee\u53d1\u8d77\u4eba\u4ea4\u6d41\u8fdb\u884c\u95ee\u9898\u7684\u89e3\u51b3\u3002 Skywalking\u652f\u6301Java\uff0c.NET Core\u548cNode.JS\u8bed\u8a00\u3002\u76f8\u5bf9\u4e8e\u5176\u4ed6\u5e73\u53f0\uff1a\u6bd4\u5982Pinpoint\u652f\u6301Java\u548cPHP,\u5177\u6709\u8f83\u5927\u7684\u4f18\u52bf\u3002 \u63a2\u9488\u65e0\u503e\u5165\u6027\u3002\u5bf9\u6bd4CAT\u5177\u6709\u503e\u5165\u6027\u7684\u63a2\u9488\uff0c\u4f18\u52bf\u8f83\u5927\u3002\u4e0d\u4fee\u6539\u539f\u6709\u9879\u76ee\u4e00\u884c\u4ee3\u7801\u5c31\u53ef\u4ee5\u8fdb\u884c\u96c6\u6210\u3002 \u63a2\u9488\u6027\u80fd\u4f18\u79c0\u3002\u6709\u7f51\u53cb\u5bf9Pinpoint\u548cSkywalking\u8fdb\u884c\u8fc7\u6d4b\u8bd5\uff0c\u7531\u4e8ePinpoint\u6536\u96c6\u7684\u6570\u636e\u8fc7\u591a\uff0c\u6240\u4ee5\u5bf9\u6027\u80fd\u635f\u8017\u8f83\u5927\uff0c\u800cSkywalking\u63a2\u9488\u6027\u80fd\u5341\u5206\u51fa\u8272\u3002 \u652f\u6301\u7ec4\u4ef6\u8f83\u591a\u3002\u7279\u522b\u662f\u5bf9Rpc\u6846\u67b6\u7684\u652f\u6301\uff0c\u8fd9\u662f\u5176\u4ed6\u6846\u67b6\u6240\u4e0d\u5177\u5907\u7684\u3002Skywalking\u5bf9Dubbo\u3001gRpc\u7b49\u6709\u539f\u751f\u7684\u652f\u6301\uff0c\u751a\u81f3\u8fde\u5c0f\u4f17\u7684motan\u548csofarpc\u90fd\u652f\u6301\u3002","title":"09-skywalking\u67b6\u6784\u8bbe\u8ba1 02:37"},{"location":"hmtt/day15/#10-skywalking_0826","text":"\u8fd9\u91cc\u53bb\u6389\u4e86--restart always\uff08docker\u542f\u52a8\u65f6\u5c31\u542f\u52a8\u8fd9\u4e2a\u5bb9\u5668\uff09\uff0c\u9632\u6b62\u5185\u5b58\u4e0d\u8db3\uff0c\u7528\u65f6\u518d\u542f\u52a8\u5373\u53ef \u542f\u52a8\u547d\u4ee4\uff1a docker start skywalking,skywalking-ui","title":"10-skywalking\u73af\u5883\u642d\u5efa 08:26"},{"location":"hmtt/day15/#11-_0647","text":"\u76f4\u63a5\u4f7f\u7528\u8d44\u6599\u4e2d\u63d0\u4f9b\u7684agent\u6587\u4ef6\u5939\u5373\u53ef\uff0c\u5185\u90e8\u914d\u7f6e\u7684ip\u5730\u5740\u5df2\u7ecf\u66f4\u6539\u4e3a192.168.226.134 \u542f\u52a8\u53c2\u6570vm-options\u4e2d\u6dfb\u52a0: -javaagent:D:\\develop\\agent\\skywalking-agent.jar -Dskywalking.agent.service_name=leadnews-admin","title":"11-\u5e94\u7528\u7a0b\u5e8f\u63a5\u5165 06:47"},{"location":"hmtt/day15/#skywalkingspringcloud-gatewaygateway","text":"\u539f\u56e0\uff1a Spring Cloud Gateway \u662f\u57fa\u4e8e WebFlux \u5b9e\u73b0\uff0c\u5fc5\u987b\u642d\u914d\u4e0a apm-spring-cloud-gateway-2.1.x-plugin \u548c apm-spring-webflux-x.x-plugin \u4e24\u4e2a\u63d2\u4ef6\uff08\u5907\u6ce8\uff1a \u4e00\u822cwebflux\u5df2\u7ecf\u5305\u542b\u5728\u76ee\u6807\u8def\u5f84\u4e0b\uff09 \u65b9\u6848\uff1a \u5c06agent/optional-plugins\u4e0b\u7684\u4e24\u4e2a\u63d2\u4ef6 \u590d\u5236\u5230 agent/plugins\u76ee\u5f55\u4e0b","title":"\u95ee\u9898\uff1askywalking\u5e94\u7528\u4e0espringcloud-gateway\u65f6\u65e0\u6cd5\u901a\u8fc7gateway\u53d1\u73b0\u8def\u7531\u7684\u670d\u52a1\u94fe\u8def\uff1f"},{"location":"hmtt/day15/#12-ui_0541","text":"","title":"12-UI\u6307\u6807\u5185\u5bb9\u4ecb\u7ecd  05:41"},{"location":"hmtt/day15/#_1","text":"1\uff0c\u5f15\u5165\u4f9d\u8d56jar\u5305 <dependency> <groupId> org.apache.skywalking </groupId> <artifactId> apm-toolkit-trace </artifactId> <version> 8.2.0 </version> </dependency> 2\uff0c\u65b9\u6cd5\u8c03\u7528 import org.apache.skywalking.apm.toolkit.trace.TraceContext ; String traceId = TraceContext . traceId (); \u53ef\u4ee5\u5c06traceid\u8fd4\u56de\u7ed9\u524d\u7aef\u3002 \u63a5\u4e0b\u6765\u5728UI\u4e0a\u641c\u7d22\u8fd9\u4e2aTraceId: \u8fd9\u6837\u5c31\u53ef\u4ee5\u5b9a\u4f4d\u5230\u5bf9\u5e94\u7684\u8fd9\u4e00\u7b14\u8c03\u7528\u4e86\u3002","title":"\u6269\u5c55\u5185\u5bb9\uff1a\u524d\u7aef\u53d1\u73b0\u4e00\u4e2a\u63a5\u53e3\u8c03\u4e0d\u901a\u4e86\uff0c\u600e\u4e48\u5feb\u901f\u5b9a\u4f4d\u5230\u95ee\u9898\uff1f"},{"location":"hmtt/day15/#13-_1038","text":"SkyWalking \u544a\u8b66\u529f\u80fd\u662f\u57286.x\u7248\u672c\u65b0\u589e\u7684\uff0c\u5176\u6838\u5fc3\u7531\u4e00\u7ec4\u89c4\u5219\u9a71\u52a8\uff0c\u8fd9\u4e9b\u89c4\u5219\u5b9a\u4e49\u5728 config/alarm-settings.yml \u6587\u4ef6\u4e2d\u3002 \u544a\u8b66\u7684\u5b9a\u4e49\u5206\u4e3a\u4e24\u90e8\u5206\uff1a \u544a\u8b66\u89c4\u5219 \uff1a\u5b83\u4eec\u5b9a\u4e49\u4e86\u5e94\u8be5\u5982\u4f55\u89e6\u53d1\u5ea6\u91cf\u8b66\u62a5\uff0c\u5e94\u8be5\u8003\u8651\u4ec0\u4e48\u6761\u4ef6\u3002 Webhook\uff08\u7f51\u7edc\u94a9\u5b50\uff09 \uff1a\u5b9a\u4e49\u5f53\u8b66\u544a\u89e6\u53d1\u65f6\uff0c\u54ea\u4e9b\u670d\u52a1\u7ec8\u7aef\u9700\u8981\u88ab\u544a\u77e5 \u5199\u4e2a\u63a5\u53e3\uff0c\u544a\u8b66\u65f6\u4f1a\u56de\u8c03\u4f60\u7684\u63a5\u53e3\uff0c\u63a5\u53e3\u91cc\u53ef\u4ee5\u53d1\u77ed\u4fe1\u3001\u53d1\u90ae\u4ef6 \u4fee\u6539\u56de\u8c03\u65b9\u6cd5\u7684\u5730\u5740: docker exec - it skywalking / bin / bash vi config / alarm - settings . yml","title":"13-\u544a\u8b66\u89c4\u5219\u8bf4\u660e 10:38"},{"location":"hmtt/day15/#14-15--_10141827","text":"\u65b0\u7248\u672c\u4e2d\uff0c\u6570\u636e\u5305\u5df2\u7ecf\u53d8\u66f4\u4e3a\u5982\u4e0b\u683c\u5f0f\uff1a AlarmMessage(scopeId=1, name=leadnews-admin, id0=bGVhZG5ld3MtYWRtaW4=.1, id1=, alarmMessage=Successful rate of service leadnews-admin is lower than 80% in 2 minutes of last 10 minutes, startTime=1606119016400) id0\u548cid1\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u6240\u4ee5\u9700\u8981\u4fee\u6539\u5b9e\u4f53\u7c7b\uff1a package com.heima.admin.domain ; import lombok.Data ; @Data public class AlarmMessage { private int scopeId ; private String name ; private String id0 ; private String id1 ; private String alarmMessage ; private long startTime ; }","title":"14-15-\u544a\u8b66\u529f\u80fd-\u529f\u80fd\u5b8c\u6210 10:14+18\uff1a27"},{"location":"hmtt/day15/#16-skywalking_1215","text":"jenkins","title":"16-\u81ea\u52a8\u5316\u90e8\u7f72\u63a5\u5165skywalking 12:15"},{"location":"interview/e.g.1.0.0/","text":"\u4e00\u3001Java\u57fa\u7840 \u00b6 1.Java\u57fa\u7840\u77e5\u8bc6 \u00b6 1.1\u9762\u5411\u5bf9\u8c61\u7684\u7279\u5f81\uff08\u4e86\u89e3\uff09 \u00b6 \u5c01\u88c5, \u7c7b\u7684\u79c1\u6709\u5316 \u7ee7\u627f, \u591a\u6001 \u7236\u7c7b/\u7236\u63a5\u53e3\u5f15\u7528\u6307\u5411\u5b50\u7c7b\u5bf9\u8c61 1.2Java\u7684\u57fa\u672c\u6570\u636e\u7c7b\u578b\u6709\u54ea\u4e9b\uff08\u4e86\u89e3\uff09 \u00b6 8\u79cd 1.3JDKJREJVM\u7684\u533a\u522b\uff08\u5fc5\u4f1a\uff09 \u00b6 1.4\u91cd\u8f7d\u548c\u91cd\u5199\u7684\u533a\u522b\uff08\u5fc5\u4f1a\uff09 \u00b6 \u91cd\u8f7d\uff1a \u53d1\u751f\u5728\u540c\u4e00\u4e2a\u7c7b\u4e2d\uff0c\u65b9\u6cd5\u540d\u5fc5\u987b\u76f8\u540c\uff0c\u53c2\u6570\u7c7b\u578b\u4e0d\u540c.\u4e2a\u6570\u4e0d\u540c. \u987a\u5e8f\u4e0d\u540c\uff0c\u65b9\u6cd5\u8fd4\u56de\u503c\u548c\u8bbf\u95ee\u4fee\u9970\u7b26\u53ef\u4ee5\u4e0d\u540c\uff0c\u53d1\u751f\u5728\u7f16\u8bd1\u65f6\u3002 \u91cd\u5199\uff1a \u53d1\u751f\u5728\u7236\u5b50\u7c7b\u4e2d\uff0c\u65b9\u6cd5\u540d.\u53c2\u6570\u5217\u8868\u5fc5\u987b\u76f8\u540c\uff0c\u8fd4\u56de\u503c\u8303\u56f4\u5c0f\u4e8e \u7b49\u4e8e\u7236\u7c7b\uff0c\u629b\u51fa\u7684\u5f02\u5e38\u8303\u56f4\u5c0f\u4e8e\u7b49\u4e8e\u7236\u7c7b\uff0c \u8bbf\u95ee\u4fee\u9970\u7b26\u8303\u56f4\u5927\u4e8e\u7b49\u4e8e\u7236\u7c7b\uff1b\u5982\u679c\u7236\u7c7b\u65b9\u6cd5\u8bbf\u95ee\u4fee\u9970\u7b26\u4e3a private \u5219 \u5b50\u7c7b\u5c31\u4e0d\u80fd\u91cd\u5199\u8be5\u65b9\u6cd5\u3002 1.5Java\u4e2d==\u548cequals\u7684\u533a\u522b\uff08\u5fc5\u4f1a\uff09 \u00b6 1.6String\u3001StringBuffer\u3001StringBuilder\u4e09\u8005\u4e4b\u95f4\u7684\u533a\u522b\uff08\u5fc5\u4f1a\uff09 \u00b6 1.7\u63a5\u53e3\u548c\u62bd\u8c61\u7c7b\u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f\uff08\u5fc5\u4f1a\uff09 \u00b6 1.8string\u5e38\u7528\u7684\u65b9\u6cd5\u6709\u54ea\u4e9b\uff1f\uff08\u4e86\u89e3\uff09 \u00b6 1.9\u4ec0\u4e48\u662f\u5355\u4f8b\u6a21\u5f0f\uff1f\u6709\u51e0\u79cd\uff1f\uff08\u5fc5\u4f1a\uff09 \u00b6 1.10\u53cd\u5c04\uff08\u4e86\u89e3\uff09 \u00b6 1.11jdk1.8\u7684\u65b0\u7279\u6027\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 1.12Java\u7684\u5f02\u5e38\uff08\u5fc5\u4f1a\uff09 \u00b6 1.13BIO\u3001NIO\u3001AIO\u6709\u4ec0\u4e48\u533a\u522b\uff1f\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 1.14Threadloal\u7684\u539f\u7406\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 1.16\u540c\u6b65\u9501\u3001\u6b7b\u9501\u3001\u4e50\u89c2\u9501\u3001\u60b2\u89c2\u9501\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 1.17\u8bf4\u4e00\u4e0bsynchronized\u5e95\u5c42\u5b9e\u73b0\u539f\u7406\uff1f\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 1.18synchronized\u548cvolatile\u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 1.19synchronized\u548cLock \u6709\u4ec0\u4e48\u533a\u522b\uff1f\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 1.20\u624b\u5199\u5192\u6ce1\u6392\u5e8f\uff1f\uff08\u5fc5\u4f1a\uff09 \u00b6 2.\u96c6\u5408\uff08\u5fc5\u4f1a\uff09 \u00b6 2.1\u5e38\u89c1\u7684\u6570\u636e\u7ed3\u6784\uff08\u4e86\u89e3\uff09 \u00b6 2.2\u96c6\u5408\u548c\u6570\u7ec4\u7684\u533a\u522b\uff08\u4e86\u89e3\uff09 \u00b6 2.3List\u548cMap\u3001Set\u7684\u533a\u522b\uff08\u5fc5\u4f1a\uff09 \u00b6 2.4List\u548cMap\u3001Set\u7684\u5b9e\u73b0\u7c7b\uff08\u5fc5\u4f1a\uff09 \u00b6 2.5Hashmap\u7684\u5e95\u5c42\u539f\u7406\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 2.6Hashmap\u548chashtable ConcurrentHashMap\u533a\u522b\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 3.\u591a\u7ebf\u7a0b\uff08\u5fc5\u4f1a\uff09 \u00b6 3.1\u4ec0\u4e48\u662f\u7ebf\u7a0b\uff1f\u7ebf\u7a0b\u548c\u8fdb\u7a0b\u7684\u533a\u522b\uff1f\uff08\u4e86\u89e3\uff09 \u00b6 3.2\u521b\u5efa\u7ebf\u7a0b\u6709\u51e0\u79cd\u65b9\u5f0f\uff08\u5fc5\u4f1a\uff09 \u00b6 3.3Runnable\u548cCallable\u7684\u533a\u522b\uff1f\uff08\u5fc5\u4f1a\uff09 \u00b6 3.4\u5982\u4f55\u542f\u52a8\u4e00\u4e2a\u65b0\u7ebf\u7a0b\u3001\u8c03\u7528start\u548crun\u65b9\u6cd5\u7684\u533a\u522b\uff1f\uff08\u5fc5\u4f1a\uff09 \u00b6 3.5\u7ebf\u7a0b\u6709\u54ea\u51e0\u79cd\u72b6\u6001\u4ee5\u53ca\u5404\u79cd\u72b6\u6001\u4e4b\u95f4\u7684\u8f6c\u6362\uff1f\uff08\u5fc5\u4f1a\uff09 \u00b6 3.6\u7ebf\u7a0b\u76f8\u5173\u7684\u57fa\u672c\u65b9\u6cd5\uff1f\uff08\u5fc5\u4f1a\uff09 \u00b6 3.7 wait\uff08\uff09\u548csleep\uff08\uff09\u7684\u533a\u522b\uff1f\uff08\u5fc5\u4f1a\uff09 \u00b6 4.\u7ebf\u7a0b\u6c60 \u00b6 4.1\u4e3a\u4ec0\u4e48\u9700\u8981\u7ebf\u7a0b\u6c60\uff08\u4e86\u89e3\uff09 \u00b6 4.2\u7ebf\u7a0b\u6c60\u7684\u5206\u7c7b\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 4.3\u6838\u5fc3\u53c2\u6570\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 4.4\u7ebf\u7a0b\u6c60\u7684\u539f\u7406\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 4.5\u62d2\u7edd\u7b56\u7565\uff08\u4e86\u89e3\uff09 \u00b6 4.6\u7ebf\u7a0b\u6c60\u7684\u5173\u95ed\uff08\u4e86\u89e3\uff09 \u00b6 6.Jvm \u00b6 6.2JDK1.8\u5806\u5185\u5b58\u7ed3\u6784\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 6.3Gc\u5783\u573e\u56de\u6536\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 6.4JVM\u8c03\u4f18\u53c2\u6570\uff08\u4e86\u89e3\uff09 \u00b6 \u4e8c\u3001Web \u00b6 1.\u7f51\u7edc\u901a\u8baf\u90e8\u5206 \u00b6 1.1TCP\u4e0eUDP\u533a\u522b\uff1f\uff08\u4e86\u89e3\uff09 \u00b6 1.2\u4ec0\u4e48\u662fHTTP\u534f\u8bae\uff1f \u00b6 1.3TCP\u7684\u4e09\u6b21\u63e1\u624b1.4HTTP\u4e2d\u91cd\u5b9a\u5411\u548c\u8bf7\u6c42\u8f6c\u53d1\u7684\u533a\u522b\uff1f \u00b6 1.5Get\u548cPost\u7684\u533a\u522b\uff1f \u00b6 2.cookie\u548csession\u7684\u533a\u522b\uff1f\uff08\u5fc5\u4f1a\uff09 \u00b6 3.Jsp\u548cServlet\uff08\u4e86\u89e3\uff09 \u00b6 1.Jsp\u548cServlet\u7684\u533a\u522b\uff1f \u00b6 2.Servlet\u7684\u751f\u547d\u5468\u671f \u00b6 3.JSP\u4e5d\u5927\u5185\u7f6e\u5bf9\u8c61 \u00b6 4.Ajax\u7684\u4ecb\u7ecd\uff08\u5fc5\u4f1a\uff09 \u00b6 \u4e09\u3001\u6570\u636e\u5e93 \u00b6 1.\u8fde\u63a5\u67e5\u8be2\uff08\u5fc5\u4f1a\uff09 \u00b6 2.\u805a\u5408\u51fd\u6570\uff08\u5fc5\u4f1a\uff09 \u00b6 3.SQL\u5173\u952e\u5b57\uff08\u5fc5\u4f1a\uff09 \u00b6 4.SQL Select \u8bed\u53e5\u5b8c\u6574\u7684\u6267\u884c\u987a\u5e8f\uff1a\uff08\u5fc5\u4f1a\uff09 \u00b6 5.\u6570\u636e\u5e93\u4e09\u8303\u5f0f\uff08\u5fc5\u4f1a\uff09 \u00b6 6.\u5b58\u50a8\u5f15\u64ce\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 1.MyISAM\u5b58\u50a8\u5f15\u64ce \u00b6 2.InnoDB\u5b58\u50a8\u5f15\u64ce \u00b6 7.\u6570\u636e\u5e93\u4e8b\u52a1\uff08\u5fc5\u4f1a\uff09 \u00b6 1.\u4e8b\u52a1\u7279\u6027 \u00b6 2.\u9694\u79bb\u7ea7\u522b \u00b6 8.\u7d22\u5f15 \u00b6 1.\u7d22\u5f15\u7684\u6982\u5ff5\u548c\u4f18\u70b9\uff08\u4e86\u89e3\uff09 \u00b6 2.\u7d22\u5f15\u7684\u5206\u7c7b\uff08\u5fc5\u4f1a\uff09 \u00b6 3.\u7d22\u5f15\u7684\u5e95\u5c42\u5b9e\u73b0\u539f\u7406\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 4.\u5982\u4f55\u907f\u514d\u7d22\u5f15\u5931\u6548\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 9.\u6570\u636e\u5e93\u9501\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 1.\u884c\u9501\u548c\u8868\u9501 \u00b6 2.\u60b2\u89c2\u9501\u548c\u4e50\u89c2\u9501 \u00b6 10.MySql\u4f18\u5316\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 1\uff09\u5b9a\u4f4d\u6267\u884c\u6548\u7387\u6162\u7684sql\u8bed\u53e5.\uff08\u4e86\u89e3\uff09 \u00b6 2\uff09\u4f18\u5316\u7d22\u5f15\uff08\u9ad8\u85aa\uff09 \u00b6 3\uff09Sql\u8bed\u53e5\u8c03\u4f18\uff08\u9ad8\u85aa\uff09 \u00b6 4\uff09\u5408\u7406\u7684\u6570\u636e\u5e93\u8bbe\u8ba1\uff08\u4e86\u89e3\uff09 \u00b6 \u56db\u3001\u6846\u67b6 \u00b6 1.Mybatis\u6846\u67b6 \u00b6 1.1\u8c08\u4e00\u8c08\u4f60\u5bf9Mybatis\u6846\u67b6\u7684\u7406\u89e3\uff08\u4e86\u89e3\uff09 \u00b6 1.2\u5728mybatis\u4e2d\uff0c$}\u548c##}\u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f\uff08\u5fc5\u4f1a\uff09 \u00b6 1.3MyBatis\u7f16\u7a0b\u6b65\u9aa4\u662f\u4ec0\u4e48\u6837\u7684\uff1f\uff08\u4e86\u89e3\uff09 \u00b6 1.4\u5728mybatis\u4e2d\uff0cresultType\u548cResultMap\u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f\uff08\u5fc5\u4f1a\uff09 \u00b6 1.5\u5728Mybatis\u4e2d\u4f60\u77e5\u9053\u7684\u52a8\u6001SQL\u7684\u6807\u7b7e\u6709\u54ea\u4e9b\uff1f\u4f5c\u7528\u5206\u522b\u662f\u4ec0\u4e48\uff1f\uff08\u2026 \u00b6 1.6\u8c08\u4e00\u4e0b\u4f60\u5bf9mybatis\u7f13\u5b58\u673a\u5236\u7684\u7406\u89e3\uff1f\uff08\u4e86\u89e3\uff09 \u00b6 2.Spring\u6846\u67b6 \u00b6 2.1Spring\u7684\u4e24\u5927\u6838\u5fc3\u662f\u4ec0\u4e48\uff1f\u8c08\u4e00\u8c08\u4f60\u5bf9IOC\u7684\u7406\u89e3\uff1f\u8c08\u4e00\u8c08\u4f60\u5bf9\u2026 \u00b6 IOC\u548cAOP ioc \u63a7\u5236\u7ffb\u8f6c\uff0cSpring\u53cd\u5411\u63a7\u5236\u5e94\u7528\u7a0b\u5e8f\u6240\u9700\u8981\u4f7f\u7528\u7684\u5916\u90e8\u8d44\u6e90 2.2Spring\u7684\u751f\u547d\u5468\u671f\uff1f\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 2.3Spring\u652f\u6301bean\u7684\u4f5c\u7528\u57df\u6709\u51e0\u79cd\u5417\uff1f\u6bcf\u79cd\u4f5c\u7528\u57df\u662f\u4ec0\u4e48\u6837\u7684\uff1f\uff08\u2026 \u00b6 2.4BeanFactory\u548cApplicationContext\u6709\u4ec0\u4e48\u533a\u522b\uff08\u4e86\u89e3\uff09 \u00b6 2.5Spring\u6846\u67b6\u4e2d\u90fd\u7528\u5230\u4e86\u54ea\u4e9b\u8bbe\u8ba1\u6a21\u5f0f\uff1f\uff08\u5fc5\u4f1a\uff09 \u00b6 2.6Spring\u4e8b\u52a1\u7684\u5b9e\u73b0\u65b9\u5f0f\u548c\u5b9e\u73b0\u539f\u7406\uff08\u5fc5\u4f1a\uff09 \u00b6 2.6\u4f60\u77e5\u9053\u7684Spring\u7684\u901a\u77e5\u7c7b\u578b\u6709\u54ea\u4e9b\uff0c\u5206\u522b\u5728\u4ec0\u4e48\u65f6\u5019\u6267\u884c\uff1f\uff08\u4e86\u89e3\uff09 \u00b6 2.7Spring\u7684\u5bf9\u8c61\u9ed8\u8ba4\u662f\u5355\u4f8b\u7684\u8fd8\u662f\u591a\u4f8b\u7684\uff1f\u5355\u4f8bbean\u5b58\u4e0d\u5b58\u5728\u7ebf.\u2026 \u00b6 2.8@Resource\u548c@Autowired\u4f9d\u8d56\u6ce8\u5165\u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f@Qualifie... \u00b6 2.8Spring\u7684\u5e38\u7528\u6ce8\u89e3\uff08\u5fc5\u4f1a\uff09 \u00b6 2.9Spring\u7684\u4e8b\u52a1\u4f20\u64ad\u884c\u4e3a\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 2.10Spring\u4e2d\u7684\u9694\u79bb\u7ea7\u522b\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 3.SpringMVC\u6846\u67b6 \u00b6 3.1\u8c08\u4e00\u4e0b\u4f60\u5bf9SpringMVC\u6846\u67b6\u7684\u7406\u89e3\uff08\u4e86\u89e3\uff09 \u00b6 3.2SpringMVC\u4e3b\u8981\u7ec4\u4ef6\uff08\u5fc5\u4f1a\uff09 \u00b6 3.3\u8c08\u4e00\u4e0bSpringMVC\u7684\u6267\u884c\u6d41\u7a0b\u4ee5\u53ca\u5404\u4e2a\u7ec4\u4ef6\u7684\u4f5c\u7528\uff08\u5fc5\u4f1a\uff09 \u00b6 3.4\u8bf4\u4e00\u4e0bSpringMVC\u652f\u6301\u7684\u8f6c\u53d1\u548c\u91cd\u5b9a\u5411\u7684\u5199\u6cd5\uff08\u5fc5\u4f1a\uff09 \u00b6 3.5 SpringMVC\u7684\u5e38\u7528\u6ce8\u89e3\uff08\u5fc5\u4f1a\uff09 \u00b6 3.6\u8c08\u4e00\u4e0bSpringMVC\u7edf\u4e00\u5f02\u5e38\u5904\u7406\u7684\u601d\u60f3\u548c\u5b9e\u73b0\u65b9\u5f0f\uff08\u5fc5\u4f1a\uff09 \u00b6 3.7\u5728SpringMVC\u4e2d\uff0c\u5982\u679c\u60f3\u901a\u8fc7\u8f6c\u53d1\u5c06\u6570\u636e\u4f20\u9012\u5230\u524d\u53f0\uff0c\u6709\u51e0\u79cd\u5199.\u2026 \u00b6 3.8\u5728SpringMVC\u4e2d\u62e6\u622a\u5668\u7684\u4f7f\u7528\u6b65\u9aa4\u662f\u4ec0\u4e48\u6837\u7684\uff1f\uff08\u5fc5\u4f1a\uff09 \u00b6 3.9\u5728SpringMVC\u4e2d\u6587\u4ef6\u4e0a\u4f20\u7684\u4f7f\u7528\u6b65\u9aa4\u662f\u4ec0\u4e48\u6837\u7684\uff1f\u524d\u53f0\u4e09\u8981\u7d20\u2026 \u00b6 3.10SpringMVC\u4e2d\u5982\u4f55\u89e3\u51b3GETIPOST\u8bf7\u6c42\u4e2d\u6587\u4e71\u7801\u95ee\u9898\uff1f\uff08\u4e86\u89e3\uff09 \u00b6 4.Dubbo \u00b6 4.1\u4ec0\u4e48\u662fdubbo\uff08\u5fc5\u4f1a\uff09 \u00b6 4.2Dubbo\u7684\u5b9e\u73b0\u539f\u7406\uff08\u5fc5\u4f1a\uff09 \u00b6 4.3\u8282\u70b9\u89d2\u8272\u8bf4\u660e\uff08\u5fc5\u4f1a\uff09 \u00b6 4.4\u8c03\u7528\u5173\u7cfb\u8bf4\u660e\uff08\u5fc5\u4f1a\uff09 \u00b6 4.5\u5728\u5b9e\u9645\u5f00\u53d1\u7684\u573a\u666f\u4e2d\u5e94\u8be5\u5982\u4f55\u9009\u62e9RPC\u6846\u67b6\uff08\u4e86\u89e3\uff09 \u00b6 5.Zookeeper \u00b6 1.Zookeeper\u662f\u4ec0\u4e48\uff08\u4e86\u89e3\uff09 \u00b6 2.Zookeeper\u7684\u6570\u636e\u6a21\u578b\uff08\u5fc5\u4f1a\uff09 \u00b6 3.Zookeeper\u7684watch\u76d1\u542c\u673a\u5236\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 3.1\u76d1\u542c\u5668\u539f\u7406 \u00b6 3.2\u76d1\u542c\u5668\u5b9e\u9645\u5e94\u7528 \u00b6 4.Zookeeper\u7684\u5e94\u7528\u573a\u666f\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 4.1\u7edf\u4e00\u547d\u540d\u670d\u52a1 \u00b6 4.2\u7edf\u4e00\u914d\u7f6e\u7ba1\u7406 \u00b6 4.3\u7edf\u4e00\u96c6\u7fa4\u7ba1\u7406 \u00b6 4.4\u96c6\u7fa4\u9009\u4e3b \u00b6 4.5\u5206\u5e03\u5f0f\u9501 \u00b6 5.Zookeeper\u96c6\u7fa4[\u9ad8\u7ea7]\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 5.1ZK\u96c6\u7fa4\u4ecb\u7ecd \u00b6 5.2\u6570\u636e\u4e00\u81f4\u6027\u5904\u7406 \u00b6 5.2.1\u96c6\u7fa4\u89d2\u8272 \u00b6 5.2.2Zookeeper\u7684\u7279\u6027 \u00b6 5.2.3ZAB\u534f\u8bae \u00b6 5.2.4ZK\u96c6\u7fa4\u5199\u6570\u636e\u6d41\u7a0b \u00b6 5.3ZK\u96c6\u7fa4\u9009\u4e3e\u673a\u5236 \u00b6 5.3.1\u96c6\u7fa4\u542f\u52a8\u5668\u7684\u9009\u4e3e\u673a\u5236 \u00b6 5.3.2\u670d\u52a1\u5668\u8fd0\u884c\u65f6\u671f\u7684Leader\u9009\u4e3e \u00b6 6.\u4e3a\u4ec0\u4e48zookeeper\u96c6\u7fa4\u7684\u6570\u76ee\uff0c\u4e00\u822c\u4e3a\u5947\u6570\u4e2a\uff1f\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 6.SpringBoot \u00b6 6.1SpringBoot\u662f\u4ec0\u4e48\uff08\u4e86\u89e3\uff09 \u00b6 6.2SpringBoot\u7684\u4f18\u70b9\uff08\u5fc5\u4f1a\uff09 \u00b6 6.3\u8fd0\u884cSpringBoot\u9879\u76ee\u7684\u65b9\u5f0f\uff08\u5fc5\u4f1a\uff09 \u00b6 6.4SpringBoot\u7684\u542f\u52a8\u5668starter\uff08\u5fc5\u4f1a\uff09 \u00b6 6.5SpringBoot\u8fd0\u884c\u539f\u7406\u5256\u6790\uff08\u5fc5\u4f1a\uff09 \u00b6 6.6SpringBoot\u70ed\u90e8\u7f72\uff08\u4e86\u89e3\uff09 \u00b6 6.7 SpringBoot\u4e2d\u7684\u914d\u7f6e\u6587\u4ef6\uff08\u5fc5\u4f1a\uff09 \u00b6 6.8SpringBoot\u652f\u6301\u54ea\u4e9b\u65e5\u5fd7\u6846\u67b6\uff08\u4e86\u89e3\uff09 \u00b6 6.9SpringBoot\u5e38\u7528\u6ce8\u89e3\uff08\u5fc5\u4f1a\uff09 \u00b6 7.SpringCloud \u00b6 7.1SOA\u548c\u5fae\u670d\u52a1\u7684\u533a\u522b\uff1f\uff08\u5fc5\u4f1a\uff09 \u00b6 7.2 SpringCloud\u662f\u4ec0\u4e48\uff1f\uff08\u4e86\u89e3\uff09 \u00b6 7.3SpringCloud\u7684\u4f18\u52bf\uff1f\uff08\u4e86\u89e3\uff09 \u00b6 7.4SpringCloud\u6709\u54ea\u4e9b\u6838\u5fc3\u7ec4\u4ef6\uff1f\uff08\u5fc5\u4f1a\uff09 \u00b6 7.5SpringBoot\u548cSpringCloud\u7684\u5173\u7cfb\uff08\u5fc5\u4f1a\uff09 \u00b6 7.6SpringCloud\u548cDubbo\u7684\u533a\u522b\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 7.7 Eureka\u548cZookeeper\u7684\u533a\u522b\uff08\u9ad8\u85aa\u5e38\u95ee\uff09 \u00b6 \u4e94\u3001\u6280\u672f\u70b9 \u00b6 1.Redis \u00b6 1.1Redis\u662f\u4ec0\u4e48\uff1f \u00b6 1.2Redis\u7684\u5b58\u50a8\u7ed3\u6784\u6709\u54ea\u4e9b\uff1f \u00b6 1.3Redis\u7684\u4f18\u70b9\uff1f \u00b6 1.4\u4e3a\u4ec0\u4e48\u8981\u7528Redis \u00b6 1.5redis\u7684\u6301\u4e45\u5316 \u00b6 1.6Redis\u7684\u7f3a\u70b9 \u00b6 1.7Redis\u96c6\u7fa4 \u00b6 1.7.1\u4e3b\u4ece\u590d\u5236 \u00b6 1.7.2\u54e8\u5175\u6a21\u5f0f \u00b6 1.7.3 Redis-Cluster \u96c6\u7fa4 \u00b6 1.8Redis\u7684\u5206\u5e03\u5f0f\u9501 \u00b6 2.RocketMQ \u00b6 2.1\u6d88\u606f\u4e2d\u95f4\u4ef6\u7684\u533a\u522b\uff1f \u00b6 2.2\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528MQ\uff1f \u00b6 2.3RocketMQ\u7531\u54ea\u4e9b\u89d2\u8272\u7ec4\u6210\uff0c\u6bcf\u4e2a\u89d2\u8272\u4f5c\u7528\u548c\u7279\u70b9\u662f\u4ec0\u4e48\uff1f \u00b6 2.4RocketMQ\u6d88\u8d39\u6a21\u5f0f\u6709\u51e0\u79cd\uff1f \u00b6 2.5RocketMQ\u5982\u4f55\u505a\u8d1f\u8f7d\u5747\u8861\uff1f \u00b6 2.6\u6d88\u606f\u91cd\u590d\u6d88\u8d39\u5982\u4f55\u89e3\u51b3\uff1f \u00b6 2.7\u5982\u4f55\u8ba9RocketMQ\u4fdd\u8bc1\u6d88\u606f\u7684\u987a\u5e8f\u6d88\u8d39 \u00b6 2.8RocketMQ\u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u4e0d\u4e22\u5931 \u00b6 2.9RocketMQ\u7684\u6d88\u606f\u5806\u79ef\u5982\u4f55\u5904\u7406 \u00b6 2.10RocketMQ\u5982\u4f55\u5b9e\u73b0\u5206\u5e03\u5f0f\u4e8b\u52a1\uff1f \u00b6 2.11\u4efb\u4f55\u4e00\u53f0Broker\u7a81\u7136\u5b95\u673a\u4e86\u600e\u4e48\u529e\uff1f \u00b6 3.MongoDb \u00b6 3.1MongoDB\u662f\u4ec0\u4e48\uff1f \u00b6 3.2MongoDB\u548c\u5173\u7cfb\u578b\u6570\u636e\u5e93mysql\u533a\u522b \u00b6 3.3MongoDB\u67093\u4e2a\u6570\u636e\u5e93 \u00b6 3.4Mongo\u4e2d\u7684\u6570\u636e\u7c7b\u578b \u00b6 3.5MongoDB\u9002\u7528\u4e1a\u52a1\u573a\u666f \u00b6 4.Nginx \u00b6 4.1Nginx\u662f\u4ec0\u4e48\uff1f \u00b6 4.2Nginx\u7684\u4f5c\u7528\uff1f \u00b6 4.3Nginx\u7684\u4f18\u52bf\uff1f \u00b6 4.4\u4ec0\u4e48\u662f\u53cd\u5411\u4ee3\u7406\uff1f \u00b6 4.5\u4ec0\u4e48\u662f\u6b63\u5411\u4ee3\u7406\uff1f \u00b6 4.6\u4ec0\u4e48\u662f\u8d1f\u8f7d\u5747\u8861\uff1f \u00b6 4.7Nginx\u662f\u5982\u4f55\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\u7684\uff1f \u00b6 4.8\u4e3a\u4ec0\u4e48Nginx\u6027\u80fd\u8fd9\u4e48\u9ad8\uff1f \u00b6 5.FastDFS \u00b6 5.1FastDFS\u662f\u4ec0\u4e48\uff1f \u00b6 5.2 FastDFS\u7ec4\u6210 \u00b6 5.3FastDFS\u7684\u6d41\u7a0b \u00b6 5.4FastDFS\u5982\u4f55\u73b0\u5728\u7ec4\u5185\u7684\u591a\u4e2a storage server\u7684\u6570\u636e\u540c\u6b65\uff1f \u00b6 6.JWT \u00b6 6.1\u7ec4\u6210 \u00b6 6.2\u4f7f\u7528\u573a\u666f \u00b6 6.3\u9762\u8bd5\u95ee\u9898\uff1a \u00b6 1.JWT token \u6cc4\u9732\u4e86\u600e\u4e48\u529e\uff1f\uff08\u5e38\u95ee\uff09 \u00b6 \u4f7f\u7528https\u52a0\u5bc6\u4f60\u7684\u5e94\u7528\uff0c\u8fd4\u56dejwt\u7ed9\u5ba2\u6237\u7aef\u65f6\u8bbe\u7f6ehttpOnly=true\u5e76\u4e14\u4f7f\u7528cookie\u800c\u4e0d\u662fLocalStorage\u5b58\u50a8jwt\uff0c\u8fd9\u6837\u53ef\u4ee5\u9632\u6b62XSS\u653b\u51fb\u548cCSRF\u653b\u51fb\u3002 2.Secret\u5982\u4f55\u8bbe\u8ba1\uff1f \u00b6 jwt\u552f\u4e00\u5b58\u50a8\u5728\u670d\u52a1\u7aef\u7684\u53ea\u6709\u4e00\u4e2asecret\uff0c\u4e2a\u4eba\u8ba4\u4e3a\u8fd9\u4e2asecret\u5e94\u8be5\u8bbe\u8ba1\u6210\u548c\u7528\u6237\u76f8\u5173\u7684\u5c5e\u6027\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u6240\u6709\u7528\u6237\u516c\u7528\u7684\u7edf\u4e00\u503c\u3002\u8fd9\u6837\u53ef\u4ee5\u6709\u6548\u7684\u907f\u514d\u4e00\u4e9b\u6ce8\u9500\u548c\u4fee\u6539\u5bc6\u7801\u65f6\u9047\u5230\u7684\u7a98\u5883\u3002 3.\u6ce8\u9500\u548c\u4fee\u6539\u5bc6\u7801\uff1f \u00b6 \u4f20\u7edf\u7684session+cookie\u65b9\u6848\u7528\u6237\u70b9\u51fb\u6ce8\u9500\uff0c\u670d\u52a1\u7aef\u6e05\u7a7asession\u5373\u53ef\uff0c\u56e0\u4e3a\u72b6\u6001\u4fdd\u5b58\u5728\u670d\u52a1\u7aef\u3002\u4f46jwt\u7684\u65b9\u6848\u5c31\u6bd4\u8f83\u96be\u529e\u4e86\uff0c\u56e0\u4e3ajwt\u662f\u65e0\u72b6\u6001\u7684\uff0c\u670d\u52a1\u7aef\u901a\u8fc7\u8ba1\u7b97\u6765\u6821\u9a8c\u6709\u6548\u6027\u3002\u6ca1\u6709\u5b58\u50a8\u8d77\u6765\uff0c\u6240\u4ee5\u5373\u4f7f\u5ba2\u6237\u7aef\u5220\u9664\u4e86jwt\uff0c\u4f46\u662f\u8be5jwt\u8fd8\u662f\u5728\u6709\u6548\u671f\u5185\uff0c\u53ea\u4e0d\u8fc7\u5904\u4e8e\u4e00\u4e2a\u6e38\u79bb\u72b6\u6001\u3002\u5206\u6790\u4e0b\u75db\u70b9\uff1a\u6ce8\u9500\u53d8\u5f97\u590d\u6742\u7684\u539f\u56e0\u5728\u4e8ejwt\u7684\u65e0\u72b6\u6001\u3002\u63d0\u4f9b\u51e0\u4e2a\u65b9\u6848\uff0c\u89c6\u5177\u4f53\u7684\u4e1a\u52a1\u6765\u51b3\u5b9a\u80fd\u4e0d\u80fd\u63a5\u53d7\uff1a\u4ec5\u4ec5\u6e05\u7a7a\u5ba2\u6237\u7aefcookie\uff0c\u8fd9\u6837\u7528\u6237\u8bbf\u95ee\u65f6\u5c31\u4e0d\u4f1a\u643a\u5e26jwt\uff0c\u670d\u52a1\u7aef\u5c31\u8ba4\u4e3a\u7528\u6237\u9700\u8981 \u516d\u3001\u63a2\u82b1\u4ea4\u53cb \u00b6 \u4e03\u3001\u9ed1\u9a6c\u5934\u6761 \u00b6","title":"e.g.1.0.0"},{"location":"interview/e.g.1.0.0/#java","text":"","title":"\u4e00\u3001Java\u57fa\u7840"},{"location":"interview/e.g.1.0.0/#1java","text":"","title":"1.Java\u57fa\u7840\u77e5\u8bc6"},{"location":"interview/e.g.1.0.0/#11","text":"\u5c01\u88c5, \u7c7b\u7684\u79c1\u6709\u5316 \u7ee7\u627f, \u591a\u6001 \u7236\u7c7b/\u7236\u63a5\u53e3\u5f15\u7528\u6307\u5411\u5b50\u7c7b\u5bf9\u8c61","title":"1.1\u9762\u5411\u5bf9\u8c61\u7684\u7279\u5f81\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#12java","text":"8\u79cd","title":"1.2Java\u7684\u57fa\u672c\u6570\u636e\u7c7b\u578b\u6709\u54ea\u4e9b\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#13jdkjrejvm","text":"","title":"1.3JDKJREJVM\u7684\u533a\u522b\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#14","text":"\u91cd\u8f7d\uff1a \u53d1\u751f\u5728\u540c\u4e00\u4e2a\u7c7b\u4e2d\uff0c\u65b9\u6cd5\u540d\u5fc5\u987b\u76f8\u540c\uff0c\u53c2\u6570\u7c7b\u578b\u4e0d\u540c.\u4e2a\u6570\u4e0d\u540c. \u987a\u5e8f\u4e0d\u540c\uff0c\u65b9\u6cd5\u8fd4\u56de\u503c\u548c\u8bbf\u95ee\u4fee\u9970\u7b26\u53ef\u4ee5\u4e0d\u540c\uff0c\u53d1\u751f\u5728\u7f16\u8bd1\u65f6\u3002 \u91cd\u5199\uff1a \u53d1\u751f\u5728\u7236\u5b50\u7c7b\u4e2d\uff0c\u65b9\u6cd5\u540d.\u53c2\u6570\u5217\u8868\u5fc5\u987b\u76f8\u540c\uff0c\u8fd4\u56de\u503c\u8303\u56f4\u5c0f\u4e8e \u7b49\u4e8e\u7236\u7c7b\uff0c\u629b\u51fa\u7684\u5f02\u5e38\u8303\u56f4\u5c0f\u4e8e\u7b49\u4e8e\u7236\u7c7b\uff0c \u8bbf\u95ee\u4fee\u9970\u7b26\u8303\u56f4\u5927\u4e8e\u7b49\u4e8e\u7236\u7c7b\uff1b\u5982\u679c\u7236\u7c7b\u65b9\u6cd5\u8bbf\u95ee\u4fee\u9970\u7b26\u4e3a private \u5219 \u5b50\u7c7b\u5c31\u4e0d\u80fd\u91cd\u5199\u8be5\u65b9\u6cd5\u3002","title":"1.4\u91cd\u8f7d\u548c\u91cd\u5199\u7684\u533a\u522b\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#15javaequals","text":"","title":"1.5Java\u4e2d==\u548cequals\u7684\u533a\u522b\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#16stringstringbufferstringbuilder","text":"","title":"1.6String\u3001StringBuffer\u3001StringBuilder\u4e09\u8005\u4e4b\u95f4\u7684\u533a\u522b\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#17","text":"","title":"1.7\u63a5\u53e3\u548c\u62bd\u8c61\u7c7b\u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#18string","text":"","title":"1.8string\u5e38\u7528\u7684\u65b9\u6cd5\u6709\u54ea\u4e9b\uff1f\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#19","text":"","title":"1.9\u4ec0\u4e48\u662f\u5355\u4f8b\u6a21\u5f0f\uff1f\u6709\u51e0\u79cd\uff1f\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#110","text":"","title":"1.10\u53cd\u5c04\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#111jdk18","text":"","title":"1.11jdk1.8\u7684\u65b0\u7279\u6027\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#112java","text":"","title":"1.12Java\u7684\u5f02\u5e38\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#113bionioaio","text":"","title":"1.13BIO\u3001NIO\u3001AIO\u6709\u4ec0\u4e48\u533a\u522b\uff1f\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#114threadloal","text":"","title":"1.14Threadloal\u7684\u539f\u7406\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#116","text":"","title":"1.16\u540c\u6b65\u9501\u3001\u6b7b\u9501\u3001\u4e50\u89c2\u9501\u3001\u60b2\u89c2\u9501\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#117synchronized","text":"","title":"1.17\u8bf4\u4e00\u4e0bsynchronized\u5e95\u5c42\u5b9e\u73b0\u539f\u7406\uff1f\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#118synchronizedvolatile","text":"","title":"1.18synchronized\u548cvolatile\u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#119synchronizedlock","text":"","title":"1.19synchronized\u548cLock \u6709\u4ec0\u4e48\u533a\u522b\uff1f\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#120","text":"","title":"1.20\u624b\u5199\u5192\u6ce1\u6392\u5e8f\uff1f\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#2","text":"","title":"2.\u96c6\u5408\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#21","text":"","title":"2.1\u5e38\u89c1\u7684\u6570\u636e\u7ed3\u6784\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#22","text":"","title":"2.2\u96c6\u5408\u548c\u6570\u7ec4\u7684\u533a\u522b\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#23listmapset","text":"","title":"2.3List\u548cMap\u3001Set\u7684\u533a\u522b\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#24listmapset","text":"","title":"2.4List\u548cMap\u3001Set\u7684\u5b9e\u73b0\u7c7b\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#25hashmap","text":"","title":"2.5Hashmap\u7684\u5e95\u5c42\u539f\u7406\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#26hashmaphashtable_concurrenthashmap","text":"","title":"2.6Hashmap\u548chashtable ConcurrentHashMap\u533a\u522b\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#3","text":"","title":"3.\u591a\u7ebf\u7a0b\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#31","text":"","title":"3.1\u4ec0\u4e48\u662f\u7ebf\u7a0b\uff1f\u7ebf\u7a0b\u548c\u8fdb\u7a0b\u7684\u533a\u522b\uff1f\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#32","text":"","title":"3.2\u521b\u5efa\u7ebf\u7a0b\u6709\u51e0\u79cd\u65b9\u5f0f\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#33runnablecallable","text":"","title":"3.3Runnable\u548cCallable\u7684\u533a\u522b\uff1f\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#34startrun","text":"","title":"3.4\u5982\u4f55\u542f\u52a8\u4e00\u4e2a\u65b0\u7ebf\u7a0b\u3001\u8c03\u7528start\u548crun\u65b9\u6cd5\u7684\u533a\u522b\uff1f\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#35","text":"","title":"3.5\u7ebf\u7a0b\u6709\u54ea\u51e0\u79cd\u72b6\u6001\u4ee5\u53ca\u5404\u79cd\u72b6\u6001\u4e4b\u95f4\u7684\u8f6c\u6362\uff1f\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#36","text":"","title":"3.6\u7ebf\u7a0b\u76f8\u5173\u7684\u57fa\u672c\u65b9\u6cd5\uff1f\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#37_waitsleep","text":"","title":"3.7 wait\uff08\uff09\u548csleep\uff08\uff09\u7684\u533a\u522b\uff1f\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#4","text":"","title":"4.\u7ebf\u7a0b\u6c60"},{"location":"interview/e.g.1.0.0/#41","text":"","title":"4.1\u4e3a\u4ec0\u4e48\u9700\u8981\u7ebf\u7a0b\u6c60\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#42","text":"","title":"4.2\u7ebf\u7a0b\u6c60\u7684\u5206\u7c7b\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#43","text":"","title":"4.3\u6838\u5fc3\u53c2\u6570\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#44","text":"","title":"4.4\u7ebf\u7a0b\u6c60\u7684\u539f\u7406\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#45","text":"","title":"4.5\u62d2\u7edd\u7b56\u7565\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#46","text":"","title":"4.6\u7ebf\u7a0b\u6c60\u7684\u5173\u95ed\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#6jvm","text":"","title":"6.Jvm"},{"location":"interview/e.g.1.0.0/#62jdk18","text":"","title":"6.2JDK1.8\u5806\u5185\u5b58\u7ed3\u6784\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#63gc","text":"","title":"6.3Gc\u5783\u573e\u56de\u6536\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#64jvm","text":"","title":"6.4JVM\u8c03\u4f18\u53c2\u6570\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#web","text":"","title":"\u4e8c\u3001Web"},{"location":"interview/e.g.1.0.0/#1","text":"","title":"1.\u7f51\u7edc\u901a\u8baf\u90e8\u5206"},{"location":"interview/e.g.1.0.0/#11tcpudp","text":"","title":"1.1TCP\u4e0eUDP\u533a\u522b\uff1f\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#12http","text":"","title":"1.2\u4ec0\u4e48\u662fHTTP\u534f\u8bae\uff1f"},{"location":"interview/e.g.1.0.0/#13tcp14http","text":"","title":"1.3TCP\u7684\u4e09\u6b21\u63e1\u624b1.4HTTP\u4e2d\u91cd\u5b9a\u5411\u548c\u8bf7\u6c42\u8f6c\u53d1\u7684\u533a\u522b\uff1f"},{"location":"interview/e.g.1.0.0/#15getpost","text":"","title":"1.5Get\u548cPost\u7684\u533a\u522b\uff1f"},{"location":"interview/e.g.1.0.0/#2cookiesession","text":"","title":"2.cookie\u548csession\u7684\u533a\u522b\uff1f\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#3jspservlet","text":"","title":"3.Jsp\u548cServlet\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#1jspservlet","text":"","title":"1.Jsp\u548cServlet\u7684\u533a\u522b\uff1f"},{"location":"interview/e.g.1.0.0/#2servlet","text":"","title":"2.Servlet\u7684\u751f\u547d\u5468\u671f"},{"location":"interview/e.g.1.0.0/#3jsp","text":"","title":"3.JSP\u4e5d\u5927\u5185\u7f6e\u5bf9\u8c61"},{"location":"interview/e.g.1.0.0/#4ajax","text":"","title":"4.Ajax\u7684\u4ecb\u7ecd\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#_1","text":"","title":"\u4e09\u3001\u6570\u636e\u5e93"},{"location":"interview/e.g.1.0.0/#1_1","text":"","title":"1.\u8fde\u63a5\u67e5\u8be2\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#2_1","text":"","title":"2.\u805a\u5408\u51fd\u6570\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#3sql","text":"","title":"3.SQL\u5173\u952e\u5b57\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#4sql_select","text":"","title":"4.SQL Select \u8bed\u53e5\u5b8c\u6574\u7684\u6267\u884c\u987a\u5e8f\uff1a\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#5","text":"","title":"5.\u6570\u636e\u5e93\u4e09\u8303\u5f0f\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#6","text":"","title":"6.\u5b58\u50a8\u5f15\u64ce\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#1myisam","text":"","title":"1.MyISAM\u5b58\u50a8\u5f15\u64ce"},{"location":"interview/e.g.1.0.0/#2innodb","text":"","title":"2.InnoDB\u5b58\u50a8\u5f15\u64ce"},{"location":"interview/e.g.1.0.0/#7","text":"","title":"7.\u6570\u636e\u5e93\u4e8b\u52a1\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#1_2","text":"","title":"1.\u4e8b\u52a1\u7279\u6027"},{"location":"interview/e.g.1.0.0/#2_2","text":"","title":"2.\u9694\u79bb\u7ea7\u522b"},{"location":"interview/e.g.1.0.0/#8","text":"","title":"8.\u7d22\u5f15"},{"location":"interview/e.g.1.0.0/#1_3","text":"","title":"1.\u7d22\u5f15\u7684\u6982\u5ff5\u548c\u4f18\u70b9\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#2_3","text":"","title":"2.\u7d22\u5f15\u7684\u5206\u7c7b\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#3_1","text":"","title":"3.\u7d22\u5f15\u7684\u5e95\u5c42\u5b9e\u73b0\u539f\u7406\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#4_1","text":"","title":"4.\u5982\u4f55\u907f\u514d\u7d22\u5f15\u5931\u6548\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#9","text":"","title":"9.\u6570\u636e\u5e93\u9501\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#1_4","text":"","title":"1.\u884c\u9501\u548c\u8868\u9501"},{"location":"interview/e.g.1.0.0/#2_4","text":"","title":"2.\u60b2\u89c2\u9501\u548c\u4e50\u89c2\u9501"},{"location":"interview/e.g.1.0.0/#10mysql","text":"","title":"10.MySql\u4f18\u5316\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#1sql","text":"","title":"1\uff09\u5b9a\u4f4d\u6267\u884c\u6548\u7387\u6162\u7684sql\u8bed\u53e5.\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#2_5","text":"","title":"2\uff09\u4f18\u5316\u7d22\u5f15\uff08\u9ad8\u85aa\uff09"},{"location":"interview/e.g.1.0.0/#3sql_1","text":"","title":"3\uff09Sql\u8bed\u53e5\u8c03\u4f18\uff08\u9ad8\u85aa\uff09"},{"location":"interview/e.g.1.0.0/#4_2","text":"","title":"4\uff09\u5408\u7406\u7684\u6570\u636e\u5e93\u8bbe\u8ba1\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#_2","text":"","title":"\u56db\u3001\u6846\u67b6"},{"location":"interview/e.g.1.0.0/#1mybatis","text":"","title":"1.Mybatis\u6846\u67b6"},{"location":"interview/e.g.1.0.0/#11mybatis","text":"","title":"1.1\u8c08\u4e00\u8c08\u4f60\u5bf9Mybatis\u6846\u67b6\u7684\u7406\u89e3\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#12mybatis","text":"","title":"1.2\u5728mybatis\u4e2d\uff0c$}\u548c##}\u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#13mybatis","text":"","title":"1.3MyBatis\u7f16\u7a0b\u6b65\u9aa4\u662f\u4ec0\u4e48\u6837\u7684\uff1f\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#14mybatisresulttyperesultmap","text":"","title":"1.4\u5728mybatis\u4e2d\uff0cresultType\u548cResultMap\u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#15mybatissql","text":"","title":"1.5\u5728Mybatis\u4e2d\u4f60\u77e5\u9053\u7684\u52a8\u6001SQL\u7684\u6807\u7b7e\u6709\u54ea\u4e9b\uff1f\u4f5c\u7528\u5206\u522b\u662f\u4ec0\u4e48\uff1f\uff08\u2026"},{"location":"interview/e.g.1.0.0/#16mybatis","text":"","title":"1.6\u8c08\u4e00\u4e0b\u4f60\u5bf9mybatis\u7f13\u5b58\u673a\u5236\u7684\u7406\u89e3\uff1f\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#2spring","text":"","title":"2.Spring\u6846\u67b6"},{"location":"interview/e.g.1.0.0/#21springioc","text":"IOC\u548cAOP ioc \u63a7\u5236\u7ffb\u8f6c\uff0cSpring\u53cd\u5411\u63a7\u5236\u5e94\u7528\u7a0b\u5e8f\u6240\u9700\u8981\u4f7f\u7528\u7684\u5916\u90e8\u8d44\u6e90","title":"2.1Spring\u7684\u4e24\u5927\u6838\u5fc3\u662f\u4ec0\u4e48\uff1f\u8c08\u4e00\u8c08\u4f60\u5bf9IOC\u7684\u7406\u89e3\uff1f\u8c08\u4e00\u8c08\u4f60\u5bf9\u2026"},{"location":"interview/e.g.1.0.0/#22spring","text":"","title":"2.2Spring\u7684\u751f\u547d\u5468\u671f\uff1f\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#23springbean","text":"","title":"2.3Spring\u652f\u6301bean\u7684\u4f5c\u7528\u57df\u6709\u51e0\u79cd\u5417\uff1f\u6bcf\u79cd\u4f5c\u7528\u57df\u662f\u4ec0\u4e48\u6837\u7684\uff1f\uff08\u2026"},{"location":"interview/e.g.1.0.0/#24beanfactoryapplicationcontext","text":"","title":"2.4BeanFactory\u548cApplicationContext\u6709\u4ec0\u4e48\u533a\u522b\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#25spring","text":"","title":"2.5Spring\u6846\u67b6\u4e2d\u90fd\u7528\u5230\u4e86\u54ea\u4e9b\u8bbe\u8ba1\u6a21\u5f0f\uff1f\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#26spring","text":"","title":"2.6Spring\u4e8b\u52a1\u7684\u5b9e\u73b0\u65b9\u5f0f\u548c\u5b9e\u73b0\u539f\u7406\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#26spring_1","text":"","title":"2.6\u4f60\u77e5\u9053\u7684Spring\u7684\u901a\u77e5\u7c7b\u578b\u6709\u54ea\u4e9b\uff0c\u5206\u522b\u5728\u4ec0\u4e48\u65f6\u5019\u6267\u884c\uff1f\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#27springbean","text":"","title":"2.7Spring\u7684\u5bf9\u8c61\u9ed8\u8ba4\u662f\u5355\u4f8b\u7684\u8fd8\u662f\u591a\u4f8b\u7684\uff1f\u5355\u4f8bbean\u5b58\u4e0d\u5b58\u5728\u7ebf.\u2026"},{"location":"interview/e.g.1.0.0/#28resourceautowiredqualifie","text":"","title":"2.8@Resource\u548c@Autowired\u4f9d\u8d56\u6ce8\u5165\u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f@Qualifie..."},{"location":"interview/e.g.1.0.0/#28spring","text":"","title":"2.8Spring\u7684\u5e38\u7528\u6ce8\u89e3\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#29spring","text":"","title":"2.9Spring\u7684\u4e8b\u52a1\u4f20\u64ad\u884c\u4e3a\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#210spring","text":"","title":"2.10Spring\u4e2d\u7684\u9694\u79bb\u7ea7\u522b\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#3springmvc","text":"","title":"3.SpringMVC\u6846\u67b6"},{"location":"interview/e.g.1.0.0/#31springmvc","text":"","title":"3.1\u8c08\u4e00\u4e0b\u4f60\u5bf9SpringMVC\u6846\u67b6\u7684\u7406\u89e3\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#32springmvc","text":"","title":"3.2SpringMVC\u4e3b\u8981\u7ec4\u4ef6\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#33springmvc","text":"","title":"3.3\u8c08\u4e00\u4e0bSpringMVC\u7684\u6267\u884c\u6d41\u7a0b\u4ee5\u53ca\u5404\u4e2a\u7ec4\u4ef6\u7684\u4f5c\u7528\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#34springmvc","text":"","title":"3.4\u8bf4\u4e00\u4e0bSpringMVC\u652f\u6301\u7684\u8f6c\u53d1\u548c\u91cd\u5b9a\u5411\u7684\u5199\u6cd5\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#35_springmvc","text":"","title":"3.5 SpringMVC\u7684\u5e38\u7528\u6ce8\u89e3\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#36springmvc","text":"","title":"3.6\u8c08\u4e00\u4e0bSpringMVC\u7edf\u4e00\u5f02\u5e38\u5904\u7406\u7684\u601d\u60f3\u548c\u5b9e\u73b0\u65b9\u5f0f\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#37springmvc","text":"","title":"3.7\u5728SpringMVC\u4e2d\uff0c\u5982\u679c\u60f3\u901a\u8fc7\u8f6c\u53d1\u5c06\u6570\u636e\u4f20\u9012\u5230\u524d\u53f0\uff0c\u6709\u51e0\u79cd\u5199.\u2026"},{"location":"interview/e.g.1.0.0/#38springmvc","text":"","title":"3.8\u5728SpringMVC\u4e2d\u62e6\u622a\u5668\u7684\u4f7f\u7528\u6b65\u9aa4\u662f\u4ec0\u4e48\u6837\u7684\uff1f\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#39springmvc","text":"","title":"3.9\u5728SpringMVC\u4e2d\u6587\u4ef6\u4e0a\u4f20\u7684\u4f7f\u7528\u6b65\u9aa4\u662f\u4ec0\u4e48\u6837\u7684\uff1f\u524d\u53f0\u4e09\u8981\u7d20\u2026"},{"location":"interview/e.g.1.0.0/#310springmvcgetipost","text":"","title":"3.10SpringMVC\u4e2d\u5982\u4f55\u89e3\u51b3GETIPOST\u8bf7\u6c42\u4e2d\u6587\u4e71\u7801\u95ee\u9898\uff1f\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#4dubbo","text":"","title":"4.Dubbo"},{"location":"interview/e.g.1.0.0/#41dubbo","text":"","title":"4.1\u4ec0\u4e48\u662fdubbo\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#42dubbo","text":"","title":"4.2Dubbo\u7684\u5b9e\u73b0\u539f\u7406\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#43_1","text":"","title":"4.3\u8282\u70b9\u89d2\u8272\u8bf4\u660e\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#44_1","text":"","title":"4.4\u8c03\u7528\u5173\u7cfb\u8bf4\u660e\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#45rpc","text":"","title":"4.5\u5728\u5b9e\u9645\u5f00\u53d1\u7684\u573a\u666f\u4e2d\u5e94\u8be5\u5982\u4f55\u9009\u62e9RPC\u6846\u67b6\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#5zookeeper","text":"","title":"5.Zookeeper"},{"location":"interview/e.g.1.0.0/#1zookeeper","text":"","title":"1.Zookeeper\u662f\u4ec0\u4e48\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#2zookeeper","text":"","title":"2.Zookeeper\u7684\u6570\u636e\u6a21\u578b\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#3zookeeperwatch","text":"","title":"3.Zookeeper\u7684watch\u76d1\u542c\u673a\u5236\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#31_1","text":"","title":"3.1\u76d1\u542c\u5668\u539f\u7406"},{"location":"interview/e.g.1.0.0/#32_1","text":"","title":"3.2\u76d1\u542c\u5668\u5b9e\u9645\u5e94\u7528"},{"location":"interview/e.g.1.0.0/#4zookeeper","text":"","title":"4.Zookeeper\u7684\u5e94\u7528\u573a\u666f\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#41_1","text":"","title":"4.1\u7edf\u4e00\u547d\u540d\u670d\u52a1"},{"location":"interview/e.g.1.0.0/#42_1","text":"","title":"4.2\u7edf\u4e00\u914d\u7f6e\u7ba1\u7406"},{"location":"interview/e.g.1.0.0/#43_2","text":"","title":"4.3\u7edf\u4e00\u96c6\u7fa4\u7ba1\u7406"},{"location":"interview/e.g.1.0.0/#44_2","text":"","title":"4.4\u96c6\u7fa4\u9009\u4e3b"},{"location":"interview/e.g.1.0.0/#45_1","text":"","title":"4.5\u5206\u5e03\u5f0f\u9501"},{"location":"interview/e.g.1.0.0/#5zookeeper_1","text":"","title":"5.Zookeeper\u96c6\u7fa4[\u9ad8\u7ea7]\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#51zk","text":"","title":"5.1ZK\u96c6\u7fa4\u4ecb\u7ecd"},{"location":"interview/e.g.1.0.0/#52","text":"","title":"5.2\u6570\u636e\u4e00\u81f4\u6027\u5904\u7406"},{"location":"interview/e.g.1.0.0/#521","text":"","title":"5.2.1\u96c6\u7fa4\u89d2\u8272"},{"location":"interview/e.g.1.0.0/#522zookeeper","text":"","title":"5.2.2Zookeeper\u7684\u7279\u6027"},{"location":"interview/e.g.1.0.0/#523zab","text":"","title":"5.2.3ZAB\u534f\u8bae"},{"location":"interview/e.g.1.0.0/#524zk","text":"","title":"5.2.4ZK\u96c6\u7fa4\u5199\u6570\u636e\u6d41\u7a0b"},{"location":"interview/e.g.1.0.0/#53zk","text":"","title":"5.3ZK\u96c6\u7fa4\u9009\u4e3e\u673a\u5236"},{"location":"interview/e.g.1.0.0/#531","text":"","title":"5.3.1\u96c6\u7fa4\u542f\u52a8\u5668\u7684\u9009\u4e3e\u673a\u5236"},{"location":"interview/e.g.1.0.0/#532leader","text":"","title":"5.3.2\u670d\u52a1\u5668\u8fd0\u884c\u65f6\u671f\u7684Leader\u9009\u4e3e"},{"location":"interview/e.g.1.0.0/#6zookeeper","text":"","title":"6.\u4e3a\u4ec0\u4e48zookeeper\u96c6\u7fa4\u7684\u6570\u76ee\uff0c\u4e00\u822c\u4e3a\u5947\u6570\u4e2a\uff1f\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#6springboot","text":"","title":"6.SpringBoot"},{"location":"interview/e.g.1.0.0/#61springboot","text":"","title":"6.1SpringBoot\u662f\u4ec0\u4e48\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#62springboot","text":"","title":"6.2SpringBoot\u7684\u4f18\u70b9\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#63springboot","text":"","title":"6.3\u8fd0\u884cSpringBoot\u9879\u76ee\u7684\u65b9\u5f0f\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#64springbootstarter","text":"","title":"6.4SpringBoot\u7684\u542f\u52a8\u5668starter\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#65springboot","text":"","title":"6.5SpringBoot\u8fd0\u884c\u539f\u7406\u5256\u6790\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#66springboot","text":"","title":"6.6SpringBoot\u70ed\u90e8\u7f72\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#67_springboot","text":"","title":"6.7 SpringBoot\u4e2d\u7684\u914d\u7f6e\u6587\u4ef6\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#68springboot","text":"","title":"6.8SpringBoot\u652f\u6301\u54ea\u4e9b\u65e5\u5fd7\u6846\u67b6\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#69springboot","text":"","title":"6.9SpringBoot\u5e38\u7528\u6ce8\u89e3\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#7springcloud","text":"","title":"7.SpringCloud"},{"location":"interview/e.g.1.0.0/#71soa","text":"","title":"7.1SOA\u548c\u5fae\u670d\u52a1\u7684\u533a\u522b\uff1f\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#72_springcloud","text":"","title":"7.2 SpringCloud\u662f\u4ec0\u4e48\uff1f\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#73springcloud","text":"","title":"7.3SpringCloud\u7684\u4f18\u52bf\uff1f\uff08\u4e86\u89e3\uff09"},{"location":"interview/e.g.1.0.0/#74springcloud","text":"","title":"7.4SpringCloud\u6709\u54ea\u4e9b\u6838\u5fc3\u7ec4\u4ef6\uff1f\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#75springbootspringcloud","text":"","title":"7.5SpringBoot\u548cSpringCloud\u7684\u5173\u7cfb\uff08\u5fc5\u4f1a\uff09"},{"location":"interview/e.g.1.0.0/#76springclouddubbo","text":"","title":"7.6SpringCloud\u548cDubbo\u7684\u533a\u522b\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#77_eurekazookeeper","text":"","title":"7.7 Eureka\u548cZookeeper\u7684\u533a\u522b\uff08\u9ad8\u85aa\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#_3","text":"","title":"\u4e94\u3001\u6280\u672f\u70b9"},{"location":"interview/e.g.1.0.0/#1redis","text":"","title":"1.Redis"},{"location":"interview/e.g.1.0.0/#11redis","text":"","title":"1.1Redis\u662f\u4ec0\u4e48\uff1f"},{"location":"interview/e.g.1.0.0/#12redis","text":"","title":"1.2Redis\u7684\u5b58\u50a8\u7ed3\u6784\u6709\u54ea\u4e9b\uff1f"},{"location":"interview/e.g.1.0.0/#13redis","text":"","title":"1.3Redis\u7684\u4f18\u70b9\uff1f"},{"location":"interview/e.g.1.0.0/#14redis","text":"","title":"1.4\u4e3a\u4ec0\u4e48\u8981\u7528Redis"},{"location":"interview/e.g.1.0.0/#15redis","text":"","title":"1.5redis\u7684\u6301\u4e45\u5316"},{"location":"interview/e.g.1.0.0/#16redis","text":"","title":"1.6Redis\u7684\u7f3a\u70b9"},{"location":"interview/e.g.1.0.0/#17redis","text":"","title":"1.7Redis\u96c6\u7fa4"},{"location":"interview/e.g.1.0.0/#171","text":"","title":"1.7.1\u4e3b\u4ece\u590d\u5236"},{"location":"interview/e.g.1.0.0/#172","text":"","title":"1.7.2\u54e8\u5175\u6a21\u5f0f"},{"location":"interview/e.g.1.0.0/#173_redis-cluster","text":"","title":"1.7.3 Redis-Cluster \u96c6\u7fa4"},{"location":"interview/e.g.1.0.0/#18redis","text":"","title":"1.8Redis\u7684\u5206\u5e03\u5f0f\u9501"},{"location":"interview/e.g.1.0.0/#2rocketmq","text":"","title":"2.RocketMQ"},{"location":"interview/e.g.1.0.0/#21_1","text":"","title":"2.1\u6d88\u606f\u4e2d\u95f4\u4ef6\u7684\u533a\u522b\uff1f"},{"location":"interview/e.g.1.0.0/#22mq","text":"","title":"2.2\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528MQ\uff1f"},{"location":"interview/e.g.1.0.0/#23rocketmq","text":"","title":"2.3RocketMQ\u7531\u54ea\u4e9b\u89d2\u8272\u7ec4\u6210\uff0c\u6bcf\u4e2a\u89d2\u8272\u4f5c\u7528\u548c\u7279\u70b9\u662f\u4ec0\u4e48\uff1f"},{"location":"interview/e.g.1.0.0/#24rocketmq","text":"","title":"2.4RocketMQ\u6d88\u8d39\u6a21\u5f0f\u6709\u51e0\u79cd\uff1f"},{"location":"interview/e.g.1.0.0/#25rocketmq","text":"","title":"2.5RocketMQ\u5982\u4f55\u505a\u8d1f\u8f7d\u5747\u8861\uff1f"},{"location":"interview/e.g.1.0.0/#26","text":"","title":"2.6\u6d88\u606f\u91cd\u590d\u6d88\u8d39\u5982\u4f55\u89e3\u51b3\uff1f"},{"location":"interview/e.g.1.0.0/#27rocketmq","text":"","title":"2.7\u5982\u4f55\u8ba9RocketMQ\u4fdd\u8bc1\u6d88\u606f\u7684\u987a\u5e8f\u6d88\u8d39"},{"location":"interview/e.g.1.0.0/#28rocketmq","text":"","title":"2.8RocketMQ\u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u4e0d\u4e22\u5931"},{"location":"interview/e.g.1.0.0/#29rocketmq","text":"","title":"2.9RocketMQ\u7684\u6d88\u606f\u5806\u79ef\u5982\u4f55\u5904\u7406"},{"location":"interview/e.g.1.0.0/#210rocketmq","text":"","title":"2.10RocketMQ\u5982\u4f55\u5b9e\u73b0\u5206\u5e03\u5f0f\u4e8b\u52a1\uff1f"},{"location":"interview/e.g.1.0.0/#211broker","text":"","title":"2.11\u4efb\u4f55\u4e00\u53f0Broker\u7a81\u7136\u5b95\u673a\u4e86\u600e\u4e48\u529e\uff1f"},{"location":"interview/e.g.1.0.0/#3mongodb","text":"","title":"3.MongoDb"},{"location":"interview/e.g.1.0.0/#31mongodb","text":"","title":"3.1MongoDB\u662f\u4ec0\u4e48\uff1f"},{"location":"interview/e.g.1.0.0/#32mongodbmysql","text":"","title":"3.2MongoDB\u548c\u5173\u7cfb\u578b\u6570\u636e\u5e93mysql\u533a\u522b"},{"location":"interview/e.g.1.0.0/#33mongodb3","text":"","title":"3.3MongoDB\u67093\u4e2a\u6570\u636e\u5e93"},{"location":"interview/e.g.1.0.0/#34mongo","text":"","title":"3.4Mongo\u4e2d\u7684\u6570\u636e\u7c7b\u578b"},{"location":"interview/e.g.1.0.0/#35mongodb","text":"","title":"3.5MongoDB\u9002\u7528\u4e1a\u52a1\u573a\u666f"},{"location":"interview/e.g.1.0.0/#4nginx","text":"","title":"4.Nginx"},{"location":"interview/e.g.1.0.0/#41nginx","text":"","title":"4.1Nginx\u662f\u4ec0\u4e48\uff1f"},{"location":"interview/e.g.1.0.0/#42nginx","text":"","title":"4.2Nginx\u7684\u4f5c\u7528\uff1f"},{"location":"interview/e.g.1.0.0/#43nginx","text":"","title":"4.3Nginx\u7684\u4f18\u52bf\uff1f"},{"location":"interview/e.g.1.0.0/#44_3","text":"","title":"4.4\u4ec0\u4e48\u662f\u53cd\u5411\u4ee3\u7406\uff1f"},{"location":"interview/e.g.1.0.0/#45_2","text":"","title":"4.5\u4ec0\u4e48\u662f\u6b63\u5411\u4ee3\u7406\uff1f"},{"location":"interview/e.g.1.0.0/#46_1","text":"","title":"4.6\u4ec0\u4e48\u662f\u8d1f\u8f7d\u5747\u8861\uff1f"},{"location":"interview/e.g.1.0.0/#47nginx","text":"","title":"4.7Nginx\u662f\u5982\u4f55\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\u7684\uff1f"},{"location":"interview/e.g.1.0.0/#48nginx","text":"","title":"4.8\u4e3a\u4ec0\u4e48Nginx\u6027\u80fd\u8fd9\u4e48\u9ad8\uff1f"},{"location":"interview/e.g.1.0.0/#5fastdfs","text":"","title":"5.FastDFS"},{"location":"interview/e.g.1.0.0/#51fastdfs","text":"","title":"5.1FastDFS\u662f\u4ec0\u4e48\uff1f"},{"location":"interview/e.g.1.0.0/#52_fastdfs","text":"","title":"5.2 FastDFS\u7ec4\u6210"},{"location":"interview/e.g.1.0.0/#53fastdfs","text":"","title":"5.3FastDFS\u7684\u6d41\u7a0b"},{"location":"interview/e.g.1.0.0/#54fastdfs_storage_server","text":"","title":"5.4FastDFS\u5982\u4f55\u73b0\u5728\u7ec4\u5185\u7684\u591a\u4e2a storage server\u7684\u6570\u636e\u540c\u6b65\uff1f"},{"location":"interview/e.g.1.0.0/#6jwt","text":"","title":"6.JWT"},{"location":"interview/e.g.1.0.0/#61","text":"","title":"6.1\u7ec4\u6210"},{"location":"interview/e.g.1.0.0/#62","text":"","title":"6.2\u4f7f\u7528\u573a\u666f"},{"location":"interview/e.g.1.0.0/#63","text":"","title":"6.3\u9762\u8bd5\u95ee\u9898\uff1a"},{"location":"interview/e.g.1.0.0/#1jwt_token","text":"\u4f7f\u7528https\u52a0\u5bc6\u4f60\u7684\u5e94\u7528\uff0c\u8fd4\u56dejwt\u7ed9\u5ba2\u6237\u7aef\u65f6\u8bbe\u7f6ehttpOnly=true\u5e76\u4e14\u4f7f\u7528cookie\u800c\u4e0d\u662fLocalStorage\u5b58\u50a8jwt\uff0c\u8fd9\u6837\u53ef\u4ee5\u9632\u6b62XSS\u653b\u51fb\u548cCSRF\u653b\u51fb\u3002","title":"1.JWT token \u6cc4\u9732\u4e86\u600e\u4e48\u529e\uff1f\uff08\u5e38\u95ee\uff09"},{"location":"interview/e.g.1.0.0/#2secret","text":"jwt\u552f\u4e00\u5b58\u50a8\u5728\u670d\u52a1\u7aef\u7684\u53ea\u6709\u4e00\u4e2asecret\uff0c\u4e2a\u4eba\u8ba4\u4e3a\u8fd9\u4e2asecret\u5e94\u8be5\u8bbe\u8ba1\u6210\u548c\u7528\u6237\u76f8\u5173\u7684\u5c5e\u6027\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u6240\u6709\u7528\u6237\u516c\u7528\u7684\u7edf\u4e00\u503c\u3002\u8fd9\u6837\u53ef\u4ee5\u6709\u6548\u7684\u907f\u514d\u4e00\u4e9b\u6ce8\u9500\u548c\u4fee\u6539\u5bc6\u7801\u65f6\u9047\u5230\u7684\u7a98\u5883\u3002","title":"2.Secret\u5982\u4f55\u8bbe\u8ba1\uff1f"},{"location":"interview/e.g.1.0.0/#3_2","text":"\u4f20\u7edf\u7684session+cookie\u65b9\u6848\u7528\u6237\u70b9\u51fb\u6ce8\u9500\uff0c\u670d\u52a1\u7aef\u6e05\u7a7asession\u5373\u53ef\uff0c\u56e0\u4e3a\u72b6\u6001\u4fdd\u5b58\u5728\u670d\u52a1\u7aef\u3002\u4f46jwt\u7684\u65b9\u6848\u5c31\u6bd4\u8f83\u96be\u529e\u4e86\uff0c\u56e0\u4e3ajwt\u662f\u65e0\u72b6\u6001\u7684\uff0c\u670d\u52a1\u7aef\u901a\u8fc7\u8ba1\u7b97\u6765\u6821\u9a8c\u6709\u6548\u6027\u3002\u6ca1\u6709\u5b58\u50a8\u8d77\u6765\uff0c\u6240\u4ee5\u5373\u4f7f\u5ba2\u6237\u7aef\u5220\u9664\u4e86jwt\uff0c\u4f46\u662f\u8be5jwt\u8fd8\u662f\u5728\u6709\u6548\u671f\u5185\uff0c\u53ea\u4e0d\u8fc7\u5904\u4e8e\u4e00\u4e2a\u6e38\u79bb\u72b6\u6001\u3002\u5206\u6790\u4e0b\u75db\u70b9\uff1a\u6ce8\u9500\u53d8\u5f97\u590d\u6742\u7684\u539f\u56e0\u5728\u4e8ejwt\u7684\u65e0\u72b6\u6001\u3002\u63d0\u4f9b\u51e0\u4e2a\u65b9\u6848\uff0c\u89c6\u5177\u4f53\u7684\u4e1a\u52a1\u6765\u51b3\u5b9a\u80fd\u4e0d\u80fd\u63a5\u53d7\uff1a\u4ec5\u4ec5\u6e05\u7a7a\u5ba2\u6237\u7aefcookie\uff0c\u8fd9\u6837\u7528\u6237\u8bbf\u95ee\u65f6\u5c31\u4e0d\u4f1a\u643a\u5e26jwt\uff0c\u670d\u52a1\u7aef\u5c31\u8ba4\u4e3a\u7528\u6237\u9700\u8981","title":"3.\u6ce8\u9500\u548c\u4fee\u6539\u5bc6\u7801\uff1f"},{"location":"interview/e.g.1.0.0/#_4","text":"","title":"\u516d\u3001\u63a2\u82b1\u4ea4\u53cb"},{"location":"interview/e.g.1.0.0/#_5","text":"","title":"\u4e03\u3001\u9ed1\u9a6c\u5934\u6761"},{"location":"jquery/","text":"1\u3001JQuery\u5feb\u901f\u5165\u95e8 1.1\u3001JQuery\u4ecb\u7ecd \u00b6 jQuery \u662f\u4e00\u4e2a JavaScript \u5e93\u3002 \u6240\u8c13\u7684\u5e93\uff0c\u5c31\u662f\u4e00\u4e2a JS \u6587\u4ef6\uff0c\u91cc\u9762\u5c01\u88c5\u4e86\u5f88\u591a\u9884\u5b9a\u4e49\u7684\u51fd\u6570\uff0c\u6bd4\u5982\u83b7\u53d6\u5143\u7d20\uff0c\u6267\u884c\u9690\u85cf\u3001\u79fb\u52a8\u7b49\uff0c\u76ee\u7684\u5c31 \u662f\u5728\u4f7f\u7528\u65f6\u76f4\u63a5\u8c03\u7528\uff0c\u4e0d\u9700\u8981\u518d\u91cd\u590d\u5b9a\u4e49\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u6781\u5927\u5730\u7b80\u5316\u4e86 JavaScript \u7f16\u7a0b\u3002 jQuery \u5b98\u7f51\uff1ahttps://www.jquery.com 1.2\u3001JQuery\u5feb\u901f\u5165\u95e8 \u00b6 \u5f00\u53d1\u601d\u8def \u7f16\u5199 HTML \u6587\u6863\u3002 \u5f15\u5165 jQuery \u6587\u4ef6\u3002 \u4f7f\u7528 jQuery \u83b7\u53d6\u5143\u7d20\u3002 \u4f7f\u7528\u6d4f\u89c8\u5668\u6d4b\u8bd5\u3002 \u4ee3\u7801\u5b9e\u73b0 <!DOCTYPE html> < html lang = \"en\" > < head > < meta charset = \"UTF-8\" > < meta name = \"viewport\" content = \"width=device-width, initial-scale=1.0\" > < title > \u5feb\u901f\u5165\u95e8 </ title > </ head > < body > < div id = \"div\" > \u6211\u662fdiv </ div > </ body > <!--\u5f15\u5165 jQuery \u6587\u4ef6--> < script src = \"js/jquery-3.3.1.min.js\" ></ script > < script > // JS\u65b9\u5f0f\uff0c\u901a\u8fc7id\u5c5e\u6027\u503c\u6765\u83b7\u53d6div\u5143\u7d20 let jsDiv = document . getElementById ( \"div\" ); //alert(jsDiv); //alert(jsDiv.innerHTML); // jQuery\u65b9\u5f0f\uff0c\u901a\u8fc7id\u5c5e\u6027\u503c\u6765\u83b7\u53d6div\u5143\u7d20 let jqDiv = $ ( \"#div\" ); alert ( jqDiv ); alert ( jqDiv . html ()); </ script > </ html > 1.3\u3001\u5c0f\u7ed3 \u00b6 jQuery \u662f\u4e00\u4e2a JavaScript \u5e93\u3002 \u8bf4\u767d\u4e86\u5c31\u662f\u5b9a\u4e49\u597d\u7684\u4e00\u4e2a JS \u6587\u4ef6\uff0c\u5185\u90e8\u5c01\u88c5\u4e86\u5f88\u591a\u529f\u80fd\uff0c\u53ef\u4ee5\u5927\u5927\u7b80\u5316\u6211\u4eec\u7684 JS \u64cd\u4f5c\u6b65\u9aa4\u3002 jQuery \u5b98\u7f51\uff1ahttps://www.jquery.com\u3002 \u8981\u60f3\u4f7f\u7528\uff0c\u5fc5\u987b\u8981\u5f15\u5165\u8be5\u6587\u4ef6\u3002 jQuery \u7684\u6838\u5fc3\u8bed\u6cd5 $(); 2\u3001JQuery\u57fa\u672c\u8bed\u6cd5 \u00b6 2.1\u3001JS\u5bf9\u8c61\u548cJQuery\u5bf9\u8c61\u8f6c\u6362 \u00b6 jQuery \u672c\u8d28\u4e0a\u867d\u7136\u4e5f\u662f JS\uff0c\u4f46\u5982\u679c\u60f3\u4f7f\u7528 jQuery \u7684\u5c5e\u6027\u548c\u65b9\u6cd5\u90a3\u4e48\u5fc5\u987b\u4fdd\u8bc1\u5bf9\u8c61\u662f jQuery \u5bf9\u8c61\uff0c\u800c\u4e0d\u662f JS \u65b9\u5f0f\u83b7\u5f97\u7684 DOM \u5bf9\u8c61\uff0c\u4e8c\u8005\u7684 API \u65b9\u6cd5\u4e0d\u80fd\u6df7\u5408\u4f7f\u7528\uff0c\u82e5\u60f3\u4f7f\u7528\u5bf9\u65b9\u7684 API\uff0c\u9700\u8981\u8fdb\u884c\u5bf9\u8c61\u7684\u8f6c\u6362\u3002 JS \u7684 DOM \u5bf9\u8c61\u8f6c\u6362\u6210 jQuery \u5bf9\u8c61 ```js //$(JS \u7684 DOM \u5bf9\u8c61); // JS\u65b9\u5f0f\uff0c\u901a\u8fc7id\u5c5e\u6027\u503c\u83b7\u53d6div\u5143\u7d20 let jsDiv = document.getElementById(\"div\"); alert(jsDiv.innerHTML); //alert(jsDiv.html()); JS\u5bf9\u8c61\u65e0\u6cd5\u4f7f\u7528jQuery\u91cc\u9762\u7684\u529f\u80fd // \u5c06 JS \u5bf9\u8c61\u8f6c\u6362\u4e3ajQuery\u5bf9\u8c61 let jq = $(jsDiv); alert(jq.html()); ``` jQuery \u5bf9\u8c61\u8f6c\u6362\u6210 JS \u5bf9\u8c61 ```js / jQuery \u5bf9\u8c61[\u7d22\u5f15]; jQuery \u5bf9\u8c61.get(\u7d22\u5f15); / // jQuery\u65b9\u5f0f\uff0c\u901a\u8fc7id\u5c5e\u6027\u503c\u83b7\u53d6div\u5143\u7d20 let jqDiv = $(\"#div\"); alert(jqDiv.html()); // alert(jqDiv.innerHTML); jQuery\u5bf9\u8c61\u65e0\u6cd5\u4f7f\u7528JS\u91cc\u9762\u7684\u529f\u80fd // \u5c06 jQuery\u5bf9\u8c61\u8f6c\u6362\u4e3aJS\u5bf9\u8c61 let js = jqDiv[0]; alert(js.innerHTML); ``` 2.2\u3001\u4e8b\u4ef6\u7684\u57fa\u672c\u4f7f\u7528 \u00b6 \u5e38\u7528\u7684\u4e8b\u4ef6 \u5728 jQuery \u4e2d\u5c06\u4e8b\u4ef6\u5c01\u88c5\u6210\u4e86\u5bf9\u5e94\u7684\u65b9\u6cd5\u3002\u53bb\u6389\u4e86 JS \u4e2d\u7684 .on \u8bed\u6cd5\u3002 \u4ee3\u7801\u5b9e\u73b0 ```html \u4e8b\u4ef6\u7684\u4f7f\u7528 //\u5355\u51fb\u4e8b\u4ef6 $(\"#btn\").click(function(){ alert(\"\u70b9\u6211\u5e72\u561b?\"); }); //\u83b7\u53d6\u7126\u70b9\u4e8b\u4ef6 // $(\"#input\").focus(function(){ // alert(\"\u4f60\u8981\u8f93\u5165\u6570\u636e\u5566...\"); // }); //\u5931\u53bb\u7126\u70b9\u4e8b\u4ef6 $(\"#input\").blur(function(){ alert(\"\u4f60\u8f93\u5165\u5b8c\u6210\u5566...\"); }); ``` 2.3\u3001\u4e8b\u4ef6\u7684\u7ed1\u5b9a\u548c\u89e3\u7ed1 \u00b6 \u7ed1\u5b9a\u4e8b\u4ef6 //jQuery \u5bf9\u8c61.on(\u4e8b\u4ef6\u540d\u79f0,\u6267\u884c\u7684\u529f\u80fd); js //\u7ed9btn1\u6309\u94ae\u7ed1\u5b9a\u5355\u51fb\u4e8b\u4ef6 $(\"#btn1\").on(\"click\",function(){ alert(\"\u70b9\u6211\u5e72\u561b?\"); }); \u89e3\u7ed1\u4e8b\u4ef6 \u5982\u679c\u4e0d\u6307\u5b9a\u4e8b\u4ef6\u540d\u79f0\uff0c\u5219\u4f1a\u628a\u8be5\u5bf9\u8c61\u7ed1\u5b9a\u7684\u6240\u6709\u4e8b\u4ef6\u90fd\u89e3\u7ed1 //jQuery \u5bf9\u8c61.off(\u4e8b\u4ef6\u540d\u79f0); js //\u901a\u8fc7btn2\u89e3\u7ed1btn1\u7684\u5355\u51fb\u4e8b\u4ef6 $(\"#btn2\").on(\"click\",function(){ $(\"#btn1\").off(\"click\"); }); 2.4\u3001\u4e8b\u4ef6\u7684\u5207\u6362 \u00b6 \u4e8b\u4ef6\u7684\u5207\u6362\uff1a\u9700\u8981\u7ed9\u540c\u4e00\u4e2a\u5bf9\u8c61\u7ed1\u5b9a\u591a\u4e2a\u4e8b\u4ef6\uff0c\u800c\u4e14\u591a\u4e2a\u4e8b\u4ef6\u8fd8\u6709\u5148\u540e\u987a\u5e8f\u5173\u7cfb\u3002 \u65b9\u5f0f\u4e00\uff1a\u5355\u72ec\u5b9a\u4e49 $(\u5143\u7d20).\u4e8b\u4ef6\u65b9\u6cd5\u540d1(\u8981\u6267\u884c\u7684\u529f\u80fd); $(\u5143\u7d20).\u4e8b\u4ef6\u65b9\u6cd5\u540d2(\u8981\u6267\u884c\u7684\u529f\u80fd); js //\u65b9\u5f0f\u4e00 \u5355\u72ec\u5b9a\u4e49 $(\"#div\").mouseover(function(){ //\u80cc\u666f\u8272\uff1a\u7ea2\u8272 //$(\"#div\").css(\"background\",\"red\"); $(this).css(\"background\",\"red\"); }); $(\"#div\").mouseout(function(){ //\u80cc\u666f\u8272\uff1a\u84dd\u8272 //$(\"#div\").css(\"background\",\"blue\"); $(this).css(\"background\",\"blue\"); }); \u65b9\u5f0f\u4e8c\uff1a\u94fe\u5f0f\u5b9a\u4e49 $(\u5143\u7d20).\u4e8b\u4ef6\u65b9\u6cd5\u540d1(\u8981\u6267\u884c\u7684\u529f\u80fd) .\u4e8b\u4ef6\u65b9\u6cd5\u540d2(\u8981\u6267\u884c\u7684\u529f\u80fd); js //\u65b9\u5f0f\u4e8c \u94fe\u5f0f\u5b9a\u4e49 $(\"#div\").mouseover(function(){ $(this).css(\"background\",\"red\"); }).mouseout(function(){ $(this).css(\"background\",\"blue\"); }); 2.5\u3001\u904d\u5386\u64cd\u4f5c \u00b6 \u65b9\u5f0f\u4e00\uff1a\u4f20\u7edf\u65b9\u5f0f tex for(let i = 0; i < \u5bb9\u5668\u5bf9\u8c61\u957f\u5ea6; i++){ \u6267\u884c\u529f\u80fd; } js //\u65b9\u5f0f\u4e00\uff1a\u4f20\u7edf\u65b9\u5f0f $(\"#btn\").click(function(){ let lis = $(\"li\"); for(let i = 0 ; i < lis.length; i++) { alert(i + \":\" + lis[i].innerHTML); } }); \u65b9\u5f0f\u4e8c\uff1a\u5bf9\u8c61.each()\u65b9\u6cd5 tex \u5bb9\u5668\u5bf9\u8c61.each(function(index,ele){ \u6267\u884c\u529f\u80fd; }); js //\u65b9\u5f0f\u4e8c\uff1a\u5bf9\u8c61.each()\u65b9\u6cd5 $(\"#btn\").click(function(){ let lis = $(\"li\"); lis.each(function(index,ele){ alert(index + \":\" + ele.innerHTML); }); }); \u65b9\u5f0f\u4e09\uff1a$.each()\u65b9\u6cd5 tex $.each(\u5bb9\u5668\u5bf9\u8c61,function(index,ele){ \u6267\u884c\u529f\u80fd; }); js //\u65b9\u5f0f\u4e09\uff1a$.each()\u65b9\u6cd5 $(\"#btn\").click(function(){ let lis = $(\"li\"); $.each(lis,function(index,ele){ alert(index + \":\" + ele.innerHTML); }); }); \u65b9\u5f0f\u56db\uff1afor of\u8bed\u53e5 tex for(ele of \u5bb9\u5668\u5bf9\u8c61){ \u6267\u884c\u529f\u80fd; } js //\u65b9\u5f0f\u56db\uff1afor of \u8bed\u53e5\u904d\u5386: \u7c7b\u4f3c\u4e8ejava \u7684\u589e\u5f3afor \u5faa\u73af, \u662f\u539f\u59cbJS \u63d0\u4f9b\u7684\u529f\u80fd $(\"#btn\").click(function(){ let lis = $(\"li\"); for(ele of lis){ alert(ele.innerHTML); } }); 2.6\u3001\u5c0f\u7ed3 \u00b6 JS \u5bf9\u8c61\u548c jQuery \u5bf9\u8c61\u76f8\u4e92\u8f6c\u6362 $(JS \u7684 DOM \u5bf9\u8c61)\uff1a\u5c06 JS \u5bf9\u8c61\u8f6c\u4e3a jQuery \u5bf9\u8c61\u3002 jQuery \u5bf9\u8c61[\u7d22\u5f15] jQuery \u5bf9\u8c61.get(\u7d22\u5f15)\uff1a\u5c06 jQuery \u5bf9\u8c61\u8f6c\u4e3a JS \u5bf9\u8c61\u3002 \u4e8b\u4ef6 \u5728 jQuery \u4e2d\u5c06\u4e8b\u4ef6\u5c01\u88c5\u6210\u4e86\u5bf9\u5e94\u7684\u65b9\u6cd5\u3002\u53bb\u6389\u4e86 JS \u4e2d\u7684 .on \u8bed\u6cd5\u3002 on(\u4e8b\u4ef6\u540d\u79f0,\u6267\u884c\u7684\u529f\u80fd)\uff1a\u7ed1\u5b9a\u4e8b\u4ef6\u3002 off(\u4e8b\u4ef6\u540d\u79f0)\uff1a\u89e3\u7ed1\u4e8b\u4ef6\u3002 \u904d\u5386 \u4f20\u7edf\u65b9\u5f0f\u3002 \u5bf9\u8c61.each() \u65b9\u6cd5\u3002 $.each() \u65b9\u6cd5\u3002 for of \u8bed\u53e5\u3002 3\u3001JQuery\u9009\u62e9\u5668 \u00b6 3.1\u3001\u57fa\u672c\u9009\u62e9\u5668 \u00b6 \u9009\u62e9\u5668\uff1a\u7c7b\u4f3c\u4e8e CSS \u7684\u9009\u62e9\u5668\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u83b7\u53d6\u5143\u7d20\u3002 \u4f8b\u5982\uff1aid \u9009\u62e9\u5668\u3001\u7c7b\u9009\u62e9\u5668\u3001\u5143\u7d20\u9009\u62e9\u5668\u3001\u5c5e\u6027\u9009\u62e9\u5668\u7b49\u7b49\u3002 jQuery \u4e2d\u9009\u62e9\u5668\u7684\u8bed\u6cd5\uff1a$(); \u4ee3\u7801\u5b9e\u73b0 ```html \u57fa\u672c\u9009\u62e9\u5668 div1 div2 div3 //1.\u5143\u7d20\u9009\u62e9\u5668 $(\"\u5143\u7d20\u7684\u540d\u79f0\") let divs = $(\"div\"); //alert(divs.length); //2.id\u9009\u62e9\u5668 $(\"#id\u7684\u5c5e\u6027\u503c\") let div1 = $(\"#div1\"); //alert(div1); //3.\u7c7b\u9009\u62e9\u5668 $(\".class\u7684\u5c5e\u6027\u503c\") let cls = $(\".cls\"); alert(cls.length); ``` 3.2\u3001\u5c42\u7ea7\u9009\u62e9\u5668 \u00b6 \u4ee3\u7801\u5b9e\u73b0 ```html \u5c42\u7ea7\u9009\u62e9\u5668 s1 s1-1 s1-2 s2 p1 p2 // 1. \u540e\u4ee3\u9009\u62e9\u5668 $(\"A B\"); A\u4e0b\u7684\u6240\u6709B(\u5305\u62ecB\u7684\u5b50\u7ea7) let spans1 = $(\"div span\"); //alert(spans1.length); // 2. \u5b50\u9009\u62e9\u5668 $(\"A > B\"); A\u4e0b\u7684\u6240\u6709B(\u4e0d\u5305\u62ecB\u7684\u5b50\u7ea7) let spans2 = $(\"div > span\"); //alert(spans2.length); // 3. \u5144\u5f1f\u9009\u62e9\u5668 $(\"A + B\"); A\u76f8\u90bb\u7684\u4e0b\u4e00\u4e2aB let ps1 = $(\"div + p\"); //alert(ps1.length); // 4. \u5144\u5f1f\u9009\u62e9\u5668 $(\"A ~ B\"); A\u76f8\u90bb\u7684\u6240\u6709B let ps2 = $(\"div ~ p\"); alert(ps2.length); ``` 3.3\u3001\u5c5e\u6027\u9009\u62e9\u5668 \u00b6 \u4ee3\u7801\u5b9e\u73b0 ```html \u5c5e\u6027\u9009\u62e9\u5668 //1.\u5c5e\u6027\u540d\u9009\u62e9\u5668 $(\"\u5143\u7d20[\u5c5e\u6027\u540d]\") let in1 = $(\"input[type]\"); //alert(in1.length); //2.\u5c5e\u6027\u503c\u9009\u62e9\u5668 $(\"\u5143\u7d20[\u5c5e\u6027\u540d=\u5c5e\u6027\u503c]\") let in2 = $(\"input[type='password']\"); alert(in2.length); ``` 3.4\u3001\u8fc7\u6ee4\u5668\u9009\u62e9\u5668 \u00b6 \u4ee3\u7801\u5b9e\u73b0 ```html \u8fc7\u6ee4\u5668\u9009\u62e9\u5668 div1 div2 div3 div4 // 1.\u9996\u5143\u7d20\u9009\u62e9\u5668 $(\"A:first\"); let div1 = $(\"div:first\"); //alert(div1.html()); // 2.\u5c3e\u5143\u7d20\u9009\u62e9\u5668 $(\"A:last\"); let div4 = $(\"div:last\"); //alert(div4.html()); // 3.\u975e\u5143\u7d20\u9009\u62e9\u5668 $(\"A:not(B)\"); let divs1 = $(\"div:not(#div2)\"); //alert(divs1.length); // 4.\u5076\u6570\u9009\u62e9\u5668 $(\"A:even\"); let divs2 = $(\"div:even\"); //alert(divs2.length); //alert(divs2[0].innerHTML); //alert(divs2[1].innerHTML); // 5.\u5947\u6570\u9009\u62e9\u5668 $(\"A:odd\"); let divs3 = $(\"div:odd\"); //alert(divs3.length); //alert(divs3[0].innerHTML); //alert(divs3[1].innerHTML); // 6.\u7b49\u4e8e\u7d22\u5f15\u9009\u62e9\u5668 $(\"A:eq(index)\"); let div3 = $(\"div:eq(2)\"); //alert(div3.html()); // 7.\u5927\u4e8e\u7d22\u5f15\u9009\u62e9\u5668 $(\"A:gt(index)\"); let divs4 = $(\"div:gt(1)\"); //alert(divs4.length); //alert(divs4[0].innerHTML); //alert(divs4[1].innerHTML); // 8.\u5c0f\u4e8e\u7d22\u5f15\u9009\u62e9\u5668 $(\"A:lt(index)\"); let divs5 = $(\"div:lt(2)\"); alert(divs5.length); alert(divs5[0].innerHTML); alert(divs5[1].innerHTML); ``` 3.5\u3001\u8868\u5355\u5c5e\u6027\u9009\u62e9\u5668 \u00b6 \u4ee3\u7801\u5b9e\u73b0 ```html \u8868\u5355\u5c5e\u6027\u9009\u62e9\u5668 \u7537 \u5973 \u5b66\u4e60 \u7761\u89c9 ---\u8bf7\u9009\u62e9--- \u672c\u79d1 \u4e13\u79d1 // 1.\u53ef\u7528\u5143\u7d20\u9009\u62e9\u5668 $(\"A:enabled\"); let ins1 = $(\"input:enabled\"); //alert(ins1.length); // 2.\u4e0d\u53ef\u7528\u5143\u7d20\u9009\u62e9\u5668 $(\"A:disabled\"); let ins2 = $(\"input:disabled\"); //alert(ins2.length); // 3.\u5355\u9009/\u590d\u9009\u6846\u88ab\u9009\u4e2d\u7684\u5143\u7d20 $(\"A:checked\"); let ins3 = $(\"input:checked\"); //alert(ins3.length); //alert(ins3[0].value); //alert(ins3[1].value); //alert(ins3[2].value); // 4.\u4e0b\u62c9\u6846\u88ab\u9009\u4e2d\u7684\u5143\u7d20 $(\"A:selected\"); let select = $(\"select option:selected\"); alert(select.html()); ``` 3.6\u3001\u5c0f\u7ed3 \u00b6 \u9009\u62e9\u5668\uff1a\u7c7b\u4f3c\u4e8e CSS \u7684\u9009\u62e9\u5668\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u83b7\u53d6\u5143\u7d20\u3002 jQuery \u4e2d\u9009\u62e9\u5668\u7684\u8bed\u6cd5\uff1a$(); \u57fa\u672c\u9009\u62e9\u5668 $(\"\u5143\u7d20\u7684\u540d\u79f0\"); $(\"#id\u7684\u5c5e\u6027\u503c\"); $(\".class\u7684\u5c5e\u6027\u503c\"); \u5c42\u7ea7\u9009\u62e9\u5668 $(\"A B\"); $(\"A > B\"); \u5c5e\u6027\u9009\u62e9\u5668 $(\"A[\u5c5e\u6027\u540d]\"); $(\"A[\u5c5e\u6027\u540d=\u5c5e\u6027\u503c]\"); \u8fc7\u6ee4\u5668\u9009\u62e9\u5668 $(\"A:even\"); $(\"A:odd\"); \u8868\u5355\u5c5e\u6027\u9009\u62e9\u5668 $(\"A:disabled\"); $(\"A:checked\"); $(\"A:selected\"); 4\u3001JQuery DOM \u00b6 4.1\u3001\u64cd\u4f5c\u6587\u672c \u00b6 \u5e38\u7528\u65b9\u6cd5 \u4ee3\u7801\u5b9e\u73b0 ```html \u64cd\u4f5c\u6587\u672c \u6211\u662fdiv //1. html() \u83b7\u53d6\u6807\u7b7e\u7684\u6587\u672c\u5185\u5bb9 $(\"#btn1\").click(function(){ //\u83b7\u53d6div\u6807\u7b7e\u7684\u6587\u672c\u5185\u5bb9 let value = $(\"#div\").html(); alert(value); }); //2. html(value) \u8bbe\u7f6e\u6807\u7b7e\u7684\u6587\u672c\u5185\u5bb9\uff0c\u89e3\u6790\u6807\u7b7e $(\"#btn2\").click(function(){ //\u8bbe\u7f6ediv\u6807\u7b7e\u7684\u6587\u672c\u5185\u5bb9 //$(\"#div\").html(\"\u6211\u771f\u7684\u662fdiv\"); $(\"#div\").html(\"<b>\u6211\u771f\u7684\u662fdiv</b>\"); }); ``` 4.2\u3001\u64cd\u4f5c\u5bf9\u8c61 \u00b6 \u5e38\u7528\u65b9\u6cd5 \u4ee3\u7801\u5b9e\u73b0 ```html \u64cd\u4f5c\u5bf9\u8c61 \u5317\u4eac \u4e0a\u6d77 \u5e7f\u5dde \u6df1\u5733 \u52a0\u6cb9 \u96c4\u8d77 /* 1. $(\"\u5143\u7d20\") \u521b\u5efa\u6307\u5b9a\u5143\u7d20 2. append(element) \u6dfb\u52a0\u6210\u6700\u540e\u4e00\u4e2a\u5b50\u5143\u7d20\uff0c\u7531\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528 3. appendTo(element) \u6dfb\u52a0\u6210\u6700\u540e\u4e00\u4e2a\u5b50\u5143\u7d20\uff0c\u7531\u88ab\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528 4. prepend(element) \u6dfb\u52a0\u6210\u7b2c\u4e00\u4e2a\u5b50\u5143\u7d20\uff0c\u7531\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528 5. prependTo(element) \u6dfb\u52a0\u6210\u7b2c\u4e00\u4e2a\u5b50\u5143\u7d20\uff0c\u7531\u88ab\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528 6. before(element) \u6dfb\u52a0\u5230\u5f53\u524d\u5143\u7d20\u7684\u524d\u9762\uff0c\u4e24\u8005\u4e4b\u95f4\u662f\u5144\u5f1f\u5173\u7cfb\uff0c\u7531\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528 7. after(element) \u6dfb\u52a0\u5230\u5f53\u524d\u5143\u7d20\u7684\u540e\u9762\uff0c\u4e24\u8005\u4e4b\u95f4\u662f\u5144\u5f1f\u5173\u7cfb\uff0c\u7531\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528 8. remove() \u5220\u9664\u6307\u5b9a\u5143\u7d20(\u81ea\u5df1\u79fb\u9664\u81ea\u5df1) 9. empty() \u6e05\u7a7a\u6307\u5b9a\u5143\u7d20\u7684\u6240\u6709\u5b50\u5143\u7d20 */ // \u6309\u94ae\u4e00\uff1a\u6dfb\u52a0\u4e00\u4e2aspan\u5230div $(\"#btn1\").click(function(){ let span = $(\"<span>span</span>\"); $(\"#div\").append(span); }); //\u6309\u94ae\u4e8c\uff1a\u5c06\u52a0\u6cb9\u6dfb\u52a0\u5230\u57ce\u5e02\u5217\u8868\u6700\u4e0b\u65b9 $(\"#btn2\").click(function(){ //$(\"#city\").append($(\"#jy\")); $(\"#jy\").appendTo($(\"#city\")); }); //\u6309\u94ae\u4e09\uff1a\u5c06\u52a0\u6cb9\u6dfb\u52a0\u5230\u57ce\u5e02\u5217\u8868\u6700\u4e0a\u65b9 $(\"#btn3\").click(function(){ //$(\"#city\").prepend($(\"#jy\")); $(\"#jy\").prependTo($(\"#city\")); }); //\u6309\u94ae\u56db\uff1a\u5c06\u96c4\u8d77\u6dfb\u52a0\u5230\u4e0a\u6d77\u4e0b\u65b9 $(\"#btn4\").click(function(){ $(\"#sh\").after($(\"#xq\")); }); //\u6309\u94ae\u4e94\uff1a\u5c06\u96c4\u8d77\u6dfb\u52a0\u5230\u4e0a\u6d77\u4e0a\u65b9 $(\"#btn5\").click(function(){ $(\"#sh\").before($(\"#xq\")); }); //\u6309\u94ae\u516d\uff1a\u5c06\u96c4\u8d77\u5220\u9664 $(\"#btn6\").click(function(){ $(\"#xq\").remove(); }); //\u6309\u94ae\u4e03\uff1a\u5c06\u63cf\u8ff0\u5217\u8868\u5168\u90e8\u5220\u9664 $(\"#btn7\").click(function(){ $(\"#desc\").empty(); }); ``` 4.3\u3001\u64cd\u4f5c\u6837\u5f0f \u00b6 \u5e38\u7528\u65b9\u6cd5 \u4ee3\u7801\u5b9e\u73b0 ```html \u64cd\u4f5c\u6837\u5f0f .cls1{ background: pink; height: 30px; } \u6211\u662fdiv // 1.css(name) \u83b7\u53d6css\u6837\u5f0f $(\"#btn1\").click(function(){ alert($(\"#div\").css(\"border\")); }); // 2.css(name,value) \u8bbe\u7f6eCSS\u6837\u5f0f $(\"#btn2\").click(function(){ $(\"#div\").css(\"background\",\"blue\"); }); // 3.addClass(value) \u7ed9\u6307\u5b9a\u7684\u5bf9\u8c61\u6dfb\u52a0\u6837\u5f0f\u7c7b\u540d $(\"#btn3\").click(function(){ $(\"#div\").addClass(\"cls1\"); }); // 4.removeClass(value) \u7ed9\u6307\u5b9a\u7684\u5bf9\u8c61\u5220\u9664\u6837\u5f0f\u7c7b\u540d $(\"#btn4\").click(function(){ $(\"#div\").removeClass(\"cls1\"); }); // 5.toggleClass(value) \u5982\u679c\u6ca1\u6709\u6837\u5f0f\u7c7b\u540d\uff0c\u5219\u6dfb\u52a0\u3002\u5982\u679c\u6709\uff0c\u5219\u5220\u9664 $(\"#btn5\").click(function(){ $(\"#div\").toggleClass(\"cls1\"); }); ``` 4.4\u3001\u64cd\u4f5c\u5c5e\u6027 \u00b6 \u5e38\u7528\u65b9\u6cd5 \u4ee3\u7801\u5b9e\u73b0 ```html \u64cd\u4f5c\u5c5e\u6027 \u7537 \u5973 ---\u8bf7\u9009\u62e9--- \u672c\u79d1 \u4e13\u79d1 // 1.attr(name,[value]) \u83b7\u5f97/\u8bbe\u7f6e\u5c5e\u6027\u7684\u503c //\u6309\u94ae\u4e00\uff1a\u83b7\u53d6\u8f93\u5165\u6846\u7684id\u5c5e\u6027 $(\"#btn1\").click(function(){ alert($(\"#username\").attr(\"id\")); }); //\u6309\u94ae\u4e8c\uff1a\u7ed9\u8f93\u5165\u6846\u8bbe\u7f6evalue\u5c5e\u6027 $(\"#btn2\").click(function(){ $(\"#username\").attr(\"value\",\"hello...\"); }); // 2.prop(name,[value]) \u83b7\u5f97/\u8bbe\u7f6e\u5c5e\u6027\u7684\u503c(checked\uff0cselected) //\u6309\u94ae\u4e09\uff1a\u9009\u4e2d\u5973 $(\"#btn3\").click(function(){ $(\"#gender2\").prop(\"checked\",true); }); //\u6309\u94ae\u56db\uff1a\u9009\u4e2d\u672c\u79d1 $(\"#btn4\").click(function(){ $(\"#bk\").prop(\"selected\",true); }); ``` 4.5\u3001\u5c0f\u7ed3 \u00b6 \u64cd\u4f5c\u6587\u672c html() html(\u2026)\uff1a\u83b7\u53d6\u6216\u8bbe\u7f6e\u6807\u7b7e\u7684\u6587\u672c\uff0c\u89e3\u6790\u6807\u7b7e\u3002 \u64cd\u4f5c\u5bf9\u8c61 $(\u201c\u5143\u7d20\u201d)\uff1a\u521b\u5efa\u6307\u5b9a\u5143\u7d20\u3002 append(element)\uff1a\u6dfb\u52a0\u6210\u6700\u540e\u4e00\u4e2a\u5b50\u5143\u7d20\uff0c\u7531\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528\u3002 prepend(element)\uff1a\u6dfb\u52a0\u6210\u7b2c\u4e00\u4e2a\u5b50\u5143\u7d20\uff0c\u7531\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528\u3002 before(element)\uff1a\u6dfb\u52a0\u5230\u5f53\u524d\u5143\u7d20\u7684\u524d\u9762\uff0c\u4e24\u8005\u4e4b\u95f4\u662f\u5144\u5f1f\u5173\u7cfb\uff0c\u7531\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528\u3002 after(element)\uff1a\u6dfb\u52a0\u5230\u5f53\u524d\u5143\u7d20\u7684\u540e\u9762\uff0c\u4e24\u8005\u4e4b\u95f4\u662f\u5144\u5f1f\u5173\u7cfb\uff0c\u7531\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528\u3002 remove()\uff1a\u5220\u9664\u6307\u5b9a\u5143\u7d20(\u81ea\u5df1\u79fb\u9664\u81ea\u5df1)\u3002 \u64cd\u4f5c\u6837\u5f0f addClass(value)\uff1a\u7ed9\u6307\u5b9a\u7684\u5bf9\u8c61\u6dfb\u52a0\u6837\u5f0f\u7c7b\u540d\u3002 removeClass(value)\uff1a\u7ed9\u6307\u5b9a\u7684\u5bf9\u8c61\u5220\u9664\u6837\u5f0f\u7c7b\u540d\u3002 \u64cd\u4f5c\u5c5e\u6027 attr(name,[value])\uff1a\u83b7\u5f97/\u8bbe\u7f6e\u5c5e\u6027\u7684\u503c\u3002 prop(name,[value])\uff1a\u83b7\u5f97/\u8bbe\u7f6e\u5c5e\u6027\u7684\u503c(checked\uff0cselected)\u3002 5\u3001\u7efc\u5408\u6848\u4f8b \u590d\u9009\u6846 \u00b6 5.1\u3001\u6848\u4f8b\u6548\u679c \u00b6 5.2\u3001\u5206\u6790\u548c\u5b9e\u73b0 \u00b6 \u529f\u80fd\u5206\u6790 \u5168\u9009 \u4e3a\u5168\u9009\u6309\u94ae\u7ed1\u5b9a\u5355\u51fb\u4e8b\u4ef6\u3002 \u83b7\u53d6\u6240\u6709\u7684\u5546\u54c1\u9879\u590d\u9009\u6846\u5143\u7d20\uff0c\u4e3a\u5176\u6dfb\u52a0 checked \u5c5e\u6027\uff0c\u5c5e\u6027\u503c\u4e3a true\u3002 \u5168\u4e0d\u9009 \u4e3a\u5168\u4e0d\u9009\u6309\u94ae\u7ed1\u5b9a\u5355\u51fb\u4e8b\u4ef6\u3002 \u83b7\u53d6\u6240\u6709\u7684\u5546\u54c1\u9879\u590d\u9009\u6846\u5143\u7d20\uff0c\u4e3a\u5176\u6dfb\u52a0 checked \u5c5e\u6027\uff0c\u5c5e\u6027\u503c\u4e3a false\u3002 \u53cd\u9009 \u4e3a\u53cd\u9009\u6309\u94ae\u7ed1\u5b9a\u5355\u51fb\u4e8b\u4ef6 \u83b7\u53d6\u6240\u6709\u7684\u5546\u54c1\u9879\u590d\u9009\u6846\u5143\u7d20\uff0c\u4e3a\u5176\u6dfb\u52a0 checked \u5c5e\u6027\uff0c\u5c5e\u6027\u503c\u662f\u76ee\u524d\u76f8\u53cd\u7684\u72b6\u6001\u3002 \u4ee3\u7801\u5b9e\u73b0 <!DOCTYPE html> < html lang = \"en\" > < head > < meta charset = \"UTF-8\" > < meta name = \"viewport\" content = \"width=device-width, initial-scale=1.0\" > < title > \u590d\u9009\u6846 </ title > </ head > < body > < table id = \"tab1\" border = \"1\" width = \"800\" align = \"center\" > < tr > < th style = \"text-align: left\" > < input style = \"background:lightgreen\" id = \"selectAll\" type = \"button\" value = \"\u5168\u9009\" > < input style = \"background:lightgreen\" id = \"selectNone\" type = \"button\" value = \"\u5168\u4e0d\u9009\" > < input style = \"background:lightgreen\" id = \"reverse\" type = \"button\" value = \"\u53cd\u9009\" > </ th > < th > \u5206\u7c7bID </ th > < th > \u5206\u7c7b\u540d\u79f0 </ th > < th > \u5206\u7c7b\u63cf\u8ff0 </ th > < th > \u64cd\u4f5c </ th > </ tr > < tr > < td >< input type = \"checkbox\" class = \"item\" ></ td > < td > 1 </ td > < td > \u624b\u673a\u6570\u7801 </ td > < td > \u624b\u673a\u6570\u7801\u7c7b\u5546\u54c1 </ td > < td >< a href = \"\" > \u4fee\u6539 </ a > | < a href = \"\" > \u5220\u9664 </ a ></ td > </ tr > < tr > < td >< input type = \"checkbox\" class = \"item\" ></ td > < td > 2 </ td > < td > \u7535\u8111\u529e\u516c </ td > < td > \u7535\u8111\u529e\u516c\u7c7b\u5546\u54c1 </ td > < td >< a href = \"\" > \u4fee\u6539 </ a > | < a href = \"\" > \u5220\u9664 </ a ></ td > </ tr > < tr > < td >< input type = \"checkbox\" class = \"item\" ></ td > < td > 3 </ td > < td > \u978b\u9774\u7bb1\u5305 </ td > < td > \u978b\u9774\u7bb1\u5305\u7c7b\u5546\u54c1 </ td > < td >< a href = \"\" > \u4fee\u6539 </ a > | < a href = \"\" > \u5220\u9664 </ a ></ td > </ tr > < tr > < td >< input type = \"checkbox\" class = \"item\" ></ td > < td > 4 </ td > < td > \u5bb6\u5c45\u9970\u54c1 </ td > < td > \u5bb6\u5c45\u9970\u54c1\u7c7b\u5546\u54c1 </ td > < td >< a href = \"\" > \u4fee\u6539 </ a > | < a href = \"\" > \u5220\u9664 </ a ></ td > </ tr > </ table > </ body > < script src = \"js/jquery-3.3.1.min.js\" ></ script > < script > //\u5168\u9009 //1.\u4e3a\u5168\u9009\u6309\u94ae\u6dfb\u52a0\u5355\u51fb\u4e8b\u4ef6 $ ( \"#selectAll\" ). click ( function (){ //2.\u83b7\u53d6\u6240\u6709\u7684\u5546\u54c1\u590d\u9009\u6846\u5143\u7d20\uff0c\u4e3a\u5176\u6dfb\u52a0checked\u5c5e\u6027\uff0c\u5c5e\u6027\u503ctrue $ ( \".item\" ). prop ( \"checked\" , true ); }); //\u5168\u4e0d\u9009 //1.\u4e3a\u5168\u4e0d\u9009\u6309\u94ae\u6dfb\u52a0\u5355\u51fb\u4e8b\u4ef6 $ ( \"#selectNone\" ). click ( function (){ //2.\u83b7\u53d6\u6240\u6709\u7684\u5546\u54c1\u590d\u9009\u6846\u5143\u7d20\uff0c\u4e3a\u5176\u6dfb\u52a0checked\u5c5e\u6027\uff0c\u5c5e\u6027\u503cfalse $ ( \".item\" ). prop ( \"checked\" , false ); }); //\u53cd\u9009 //1.\u4e3a\u53cd\u9009\u6309\u94ae\u6dfb\u52a0\u5355\u51fb\u4e8b\u4ef6 $ ( \"#reverse\" ). click ( function (){ //2.\u83b7\u53d6\u6240\u6709\u7684\u5546\u54c1\u590d\u9009\u6846\u5143\u7d20\uff0c\u4e3a\u5176\u6dfb\u52a0checked\u5c5e\u6027\uff0c\u5c5e\u6027\u503c\u662f\u76ee\u524d\u76f8\u53cd\u7684\u72b6\u6001 let items = $ ( \".item\" ); items . each ( function (){ $ ( this ). prop ( \"checked\" , ! $ ( this ). prop ( \"checked\" )); }); }); </ script > </ html > 6\u3001\u7efc\u5408\u6848\u4f8b \u968f\u673a\u56fe\u7247 \u00b6 6.1\u3001\u6848\u4f8b\u6548\u679c \u00b6 6.2\u3001\u52a8\u6001\u5207\u6362\u5c0f\u56fe\u7684\u5206\u6790\u548c\u5b9e\u73b0 \u00b6 \u529f\u80fd\u5206\u6790 \u51c6\u5907\u4e00\u4e2a\u6570\u7ec4 \u5b9a\u4e49\u8ba1\u6570\u5668 \u5b9a\u4e49\u5b9a\u65f6\u5668\u5bf9\u8c61 \u5b9a\u4e49\u56fe\u7247\u8def\u5f84\u53d8\u91cf \u4e3a\u5f00\u59cb\u6309\u94ae\u7ed1\u5b9a\u5355\u51fb\u4e8b\u4ef6 \u8bbe\u7f6e\u6309\u94ae\u72b6\u6001 \u8bbe\u7f6e\u5b9a\u65f6\u5668\uff0c\u5faa\u73af\u663e\u793a\u56fe\u7247 \u5faa\u73af\u83b7\u53d6\u56fe\u7247\u8def\u5f84 \u5c06\u5f53\u524d\u56fe\u7247\u663e\u793a\u5230\u5c0f\u56fe\u7247\u4e0a \u8ba1\u6570\u5668\u81ea\u589e \u4ee3\u7801\u5b9e\u73b0 ```html \u968f\u673a\u56fe\u7247 //1.\u51c6\u5907\u4e00\u4e2a\u6570\u7ec4 let imgs = [ \"img/01.jpg\", \"img/02.jpg\", \"img/03.jpg\", \"img/04.jpg\", \"img/05.jpg\", \"img/06.jpg\", \"img/07.jpg\", \"img/08.jpg\", \"img/09.jpg\", \"img/10.jpg\"]; //2.\u5b9a\u4e49\u8ba1\u6570\u5668\u53d8\u91cf let count = 0; //3.\u58f0\u660e\u5b9a\u65f6\u5668\u5bf9\u8c61 let time = null; //4.\u58f0\u660e\u56fe\u7247\u8def\u5f84\u53d8\u91cf let imgSrc = \"\"; //5.\u4e3a\u5f00\u59cb\u6309\u94ae\u7ed1\u5b9a\u5355\u51fb\u4e8b\u4ef6 $(\"#startBtn\").click(function(){ //6.\u8bbe\u7f6e\u6309\u94ae\u72b6\u6001 //\u7981\u7528\u5f00\u59cb\u6309\u94ae $(\"#startBtn\").prop(\"disabled\",true); //\u542f\u7528\u505c\u6b62\u6309\u94ae $(\"#stopBtn\").prop(\"disabled\",false); //7.\u8bbe\u7f6e\u5b9a\u65f6\u5668\uff0c\u5faa\u73af\u663e\u793a\u56fe\u7247 time = setInterval(function(){ //8.\u5faa\u73af\u83b7\u53d6\u56fe\u7247\u8def\u5f84 let index = count % imgs.length; // 0%10=0 1%10=1 2%10=2 .. 9%10=9 10%10=0 //9.\u5c06\u5f53\u524d\u56fe\u7247\u663e\u793a\u5230\u5c0f\u56fe\u7247\u4e0a imgSrc = imgs[index]; $(\"#small\").prop(\"src\",imgSrc); //10.\u8ba1\u6570\u5668\u81ea\u589e count++; },10); }); ``` 6.3\u3001\u663e\u793a\u5927\u56fe\u7684\u5206\u6790\u548c\u5b9e\u73b0 \u00b6 \u529f\u80fd\u5206\u6790 \u4e3a\u505c\u6b62\u6309\u94ae\u7ed1\u5b9a\u5355\u51fb\u4e8b\u4ef6 \u53d6\u6d88\u5b9a\u65f6\u5668 \u8bbe\u7f6e\u6309\u94ae\u72b6\u6001 \u5c06\u56fe\u7247\u663e\u793a\u5230\u5927\u56fe\u7247\u4e0a \u4ee3\u7801\u5b9e\u73b0 ```js //11.\u4e3a\u505c\u6b62\u6309\u94ae\u7ed1\u5b9a\u5355\u51fb\u4e8b\u4ef6 $(\"#stopBtn\").click(function(){ //12.\u53d6\u6d88\u5b9a\u65f6\u5668 clearInterval(time); // 13 . \u8bbe\u7f6e\u6309\u94ae\u72b6\u6001 // \u542f\u7528\u5f00\u59cb\u6309\u94ae $( \"#startBtn\" ) . prop ( \"disabled\" , false ); // \u7981\u7528\u505c\u6b62\u6309\u94ae $( \"#stopBtn\" ) . prop ( \"disabled\" , true ); // 14 . \u5c06\u56fe\u7247\u663e\u793a\u5230\u5927\u56fe\u7247\u4e0a $( \"#big\" ) . prop ( \"src\" , imgSrc ); $( \"#big\" ) . prop ( \"style\" , \"width: 400px; height: 400px;\" ); }); ```","title":"JQuery"},{"location":"jquery/#11jquery","text":"jQuery \u662f\u4e00\u4e2a JavaScript \u5e93\u3002 \u6240\u8c13\u7684\u5e93\uff0c\u5c31\u662f\u4e00\u4e2a JS \u6587\u4ef6\uff0c\u91cc\u9762\u5c01\u88c5\u4e86\u5f88\u591a\u9884\u5b9a\u4e49\u7684\u51fd\u6570\uff0c\u6bd4\u5982\u83b7\u53d6\u5143\u7d20\uff0c\u6267\u884c\u9690\u85cf\u3001\u79fb\u52a8\u7b49\uff0c\u76ee\u7684\u5c31 \u662f\u5728\u4f7f\u7528\u65f6\u76f4\u63a5\u8c03\u7528\uff0c\u4e0d\u9700\u8981\u518d\u91cd\u590d\u5b9a\u4e49\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u6781\u5927\u5730\u7b80\u5316\u4e86 JavaScript \u7f16\u7a0b\u3002 jQuery \u5b98\u7f51\uff1ahttps://www.jquery.com","title":"1.1\u3001JQuery\u4ecb\u7ecd"},{"location":"jquery/#12jquery","text":"\u5f00\u53d1\u601d\u8def \u7f16\u5199 HTML \u6587\u6863\u3002 \u5f15\u5165 jQuery \u6587\u4ef6\u3002 \u4f7f\u7528 jQuery \u83b7\u53d6\u5143\u7d20\u3002 \u4f7f\u7528\u6d4f\u89c8\u5668\u6d4b\u8bd5\u3002 \u4ee3\u7801\u5b9e\u73b0 <!DOCTYPE html> < html lang = \"en\" > < head > < meta charset = \"UTF-8\" > < meta name = \"viewport\" content = \"width=device-width, initial-scale=1.0\" > < title > \u5feb\u901f\u5165\u95e8 </ title > </ head > < body > < div id = \"div\" > \u6211\u662fdiv </ div > </ body > <!--\u5f15\u5165 jQuery \u6587\u4ef6--> < script src = \"js/jquery-3.3.1.min.js\" ></ script > < script > // JS\u65b9\u5f0f\uff0c\u901a\u8fc7id\u5c5e\u6027\u503c\u6765\u83b7\u53d6div\u5143\u7d20 let jsDiv = document . getElementById ( \"div\" ); //alert(jsDiv); //alert(jsDiv.innerHTML); // jQuery\u65b9\u5f0f\uff0c\u901a\u8fc7id\u5c5e\u6027\u503c\u6765\u83b7\u53d6div\u5143\u7d20 let jqDiv = $ ( \"#div\" ); alert ( jqDiv ); alert ( jqDiv . html ()); </ script > </ html >","title":"1.2\u3001JQuery\u5feb\u901f\u5165\u95e8"},{"location":"jquery/#13","text":"jQuery \u662f\u4e00\u4e2a JavaScript \u5e93\u3002 \u8bf4\u767d\u4e86\u5c31\u662f\u5b9a\u4e49\u597d\u7684\u4e00\u4e2a JS \u6587\u4ef6\uff0c\u5185\u90e8\u5c01\u88c5\u4e86\u5f88\u591a\u529f\u80fd\uff0c\u53ef\u4ee5\u5927\u5927\u7b80\u5316\u6211\u4eec\u7684 JS \u64cd\u4f5c\u6b65\u9aa4\u3002 jQuery \u5b98\u7f51\uff1ahttps://www.jquery.com\u3002 \u8981\u60f3\u4f7f\u7528\uff0c\u5fc5\u987b\u8981\u5f15\u5165\u8be5\u6587\u4ef6\u3002 jQuery \u7684\u6838\u5fc3\u8bed\u6cd5 $();","title":"1.3\u3001\u5c0f\u7ed3"},{"location":"jquery/#2jquery","text":"","title":"2\u3001JQuery\u57fa\u672c\u8bed\u6cd5"},{"location":"jquery/#21jsjquery","text":"jQuery \u672c\u8d28\u4e0a\u867d\u7136\u4e5f\u662f JS\uff0c\u4f46\u5982\u679c\u60f3\u4f7f\u7528 jQuery \u7684\u5c5e\u6027\u548c\u65b9\u6cd5\u90a3\u4e48\u5fc5\u987b\u4fdd\u8bc1\u5bf9\u8c61\u662f jQuery \u5bf9\u8c61\uff0c\u800c\u4e0d\u662f JS \u65b9\u5f0f\u83b7\u5f97\u7684 DOM \u5bf9\u8c61\uff0c\u4e8c\u8005\u7684 API \u65b9\u6cd5\u4e0d\u80fd\u6df7\u5408\u4f7f\u7528\uff0c\u82e5\u60f3\u4f7f\u7528\u5bf9\u65b9\u7684 API\uff0c\u9700\u8981\u8fdb\u884c\u5bf9\u8c61\u7684\u8f6c\u6362\u3002 JS \u7684 DOM \u5bf9\u8c61\u8f6c\u6362\u6210 jQuery \u5bf9\u8c61 ```js //$(JS \u7684 DOM \u5bf9\u8c61); // JS\u65b9\u5f0f\uff0c\u901a\u8fc7id\u5c5e\u6027\u503c\u83b7\u53d6div\u5143\u7d20 let jsDiv = document.getElementById(\"div\"); alert(jsDiv.innerHTML); //alert(jsDiv.html()); JS\u5bf9\u8c61\u65e0\u6cd5\u4f7f\u7528jQuery\u91cc\u9762\u7684\u529f\u80fd // \u5c06 JS \u5bf9\u8c61\u8f6c\u6362\u4e3ajQuery\u5bf9\u8c61 let jq = $(jsDiv); alert(jq.html()); ``` jQuery \u5bf9\u8c61\u8f6c\u6362\u6210 JS \u5bf9\u8c61 ```js / jQuery \u5bf9\u8c61[\u7d22\u5f15]; jQuery \u5bf9\u8c61.get(\u7d22\u5f15); / // jQuery\u65b9\u5f0f\uff0c\u901a\u8fc7id\u5c5e\u6027\u503c\u83b7\u53d6div\u5143\u7d20 let jqDiv = $(\"#div\"); alert(jqDiv.html()); // alert(jqDiv.innerHTML); jQuery\u5bf9\u8c61\u65e0\u6cd5\u4f7f\u7528JS\u91cc\u9762\u7684\u529f\u80fd // \u5c06 jQuery\u5bf9\u8c61\u8f6c\u6362\u4e3aJS\u5bf9\u8c61 let js = jqDiv[0]; alert(js.innerHTML); ```","title":"2.1\u3001JS\u5bf9\u8c61\u548cJQuery\u5bf9\u8c61\u8f6c\u6362"},{"location":"jquery/#22","text":"\u5e38\u7528\u7684\u4e8b\u4ef6 \u5728 jQuery \u4e2d\u5c06\u4e8b\u4ef6\u5c01\u88c5\u6210\u4e86\u5bf9\u5e94\u7684\u65b9\u6cd5\u3002\u53bb\u6389\u4e86 JS \u4e2d\u7684 .on \u8bed\u6cd5\u3002 \u4ee3\u7801\u5b9e\u73b0 ```html \u4e8b\u4ef6\u7684\u4f7f\u7528 //\u5355\u51fb\u4e8b\u4ef6 $(\"#btn\").click(function(){ alert(\"\u70b9\u6211\u5e72\u561b?\"); }); //\u83b7\u53d6\u7126\u70b9\u4e8b\u4ef6 // $(\"#input\").focus(function(){ // alert(\"\u4f60\u8981\u8f93\u5165\u6570\u636e\u5566...\"); // }); //\u5931\u53bb\u7126\u70b9\u4e8b\u4ef6 $(\"#input\").blur(function(){ alert(\"\u4f60\u8f93\u5165\u5b8c\u6210\u5566...\"); }); ```","title":"2.2\u3001\u4e8b\u4ef6\u7684\u57fa\u672c\u4f7f\u7528"},{"location":"jquery/#23","text":"\u7ed1\u5b9a\u4e8b\u4ef6 //jQuery \u5bf9\u8c61.on(\u4e8b\u4ef6\u540d\u79f0,\u6267\u884c\u7684\u529f\u80fd); js //\u7ed9btn1\u6309\u94ae\u7ed1\u5b9a\u5355\u51fb\u4e8b\u4ef6 $(\"#btn1\").on(\"click\",function(){ alert(\"\u70b9\u6211\u5e72\u561b?\"); }); \u89e3\u7ed1\u4e8b\u4ef6 \u5982\u679c\u4e0d\u6307\u5b9a\u4e8b\u4ef6\u540d\u79f0\uff0c\u5219\u4f1a\u628a\u8be5\u5bf9\u8c61\u7ed1\u5b9a\u7684\u6240\u6709\u4e8b\u4ef6\u90fd\u89e3\u7ed1 //jQuery \u5bf9\u8c61.off(\u4e8b\u4ef6\u540d\u79f0); js //\u901a\u8fc7btn2\u89e3\u7ed1btn1\u7684\u5355\u51fb\u4e8b\u4ef6 $(\"#btn2\").on(\"click\",function(){ $(\"#btn1\").off(\"click\"); });","title":"2.3\u3001\u4e8b\u4ef6\u7684\u7ed1\u5b9a\u548c\u89e3\u7ed1"},{"location":"jquery/#24","text":"\u4e8b\u4ef6\u7684\u5207\u6362\uff1a\u9700\u8981\u7ed9\u540c\u4e00\u4e2a\u5bf9\u8c61\u7ed1\u5b9a\u591a\u4e2a\u4e8b\u4ef6\uff0c\u800c\u4e14\u591a\u4e2a\u4e8b\u4ef6\u8fd8\u6709\u5148\u540e\u987a\u5e8f\u5173\u7cfb\u3002 \u65b9\u5f0f\u4e00\uff1a\u5355\u72ec\u5b9a\u4e49 $(\u5143\u7d20).\u4e8b\u4ef6\u65b9\u6cd5\u540d1(\u8981\u6267\u884c\u7684\u529f\u80fd); $(\u5143\u7d20).\u4e8b\u4ef6\u65b9\u6cd5\u540d2(\u8981\u6267\u884c\u7684\u529f\u80fd); js //\u65b9\u5f0f\u4e00 \u5355\u72ec\u5b9a\u4e49 $(\"#div\").mouseover(function(){ //\u80cc\u666f\u8272\uff1a\u7ea2\u8272 //$(\"#div\").css(\"background\",\"red\"); $(this).css(\"background\",\"red\"); }); $(\"#div\").mouseout(function(){ //\u80cc\u666f\u8272\uff1a\u84dd\u8272 //$(\"#div\").css(\"background\",\"blue\"); $(this).css(\"background\",\"blue\"); }); \u65b9\u5f0f\u4e8c\uff1a\u94fe\u5f0f\u5b9a\u4e49 $(\u5143\u7d20).\u4e8b\u4ef6\u65b9\u6cd5\u540d1(\u8981\u6267\u884c\u7684\u529f\u80fd) .\u4e8b\u4ef6\u65b9\u6cd5\u540d2(\u8981\u6267\u884c\u7684\u529f\u80fd); js //\u65b9\u5f0f\u4e8c \u94fe\u5f0f\u5b9a\u4e49 $(\"#div\").mouseover(function(){ $(this).css(\"background\",\"red\"); }).mouseout(function(){ $(this).css(\"background\",\"blue\"); });","title":"2.4\u3001\u4e8b\u4ef6\u7684\u5207\u6362"},{"location":"jquery/#25","text":"\u65b9\u5f0f\u4e00\uff1a\u4f20\u7edf\u65b9\u5f0f tex for(let i = 0; i < \u5bb9\u5668\u5bf9\u8c61\u957f\u5ea6; i++){ \u6267\u884c\u529f\u80fd; } js //\u65b9\u5f0f\u4e00\uff1a\u4f20\u7edf\u65b9\u5f0f $(\"#btn\").click(function(){ let lis = $(\"li\"); for(let i = 0 ; i < lis.length; i++) { alert(i + \":\" + lis[i].innerHTML); } }); \u65b9\u5f0f\u4e8c\uff1a\u5bf9\u8c61.each()\u65b9\u6cd5 tex \u5bb9\u5668\u5bf9\u8c61.each(function(index,ele){ \u6267\u884c\u529f\u80fd; }); js //\u65b9\u5f0f\u4e8c\uff1a\u5bf9\u8c61.each()\u65b9\u6cd5 $(\"#btn\").click(function(){ let lis = $(\"li\"); lis.each(function(index,ele){ alert(index + \":\" + ele.innerHTML); }); }); \u65b9\u5f0f\u4e09\uff1a$.each()\u65b9\u6cd5 tex $.each(\u5bb9\u5668\u5bf9\u8c61,function(index,ele){ \u6267\u884c\u529f\u80fd; }); js //\u65b9\u5f0f\u4e09\uff1a$.each()\u65b9\u6cd5 $(\"#btn\").click(function(){ let lis = $(\"li\"); $.each(lis,function(index,ele){ alert(index + \":\" + ele.innerHTML); }); }); \u65b9\u5f0f\u56db\uff1afor of\u8bed\u53e5 tex for(ele of \u5bb9\u5668\u5bf9\u8c61){ \u6267\u884c\u529f\u80fd; } js //\u65b9\u5f0f\u56db\uff1afor of \u8bed\u53e5\u904d\u5386: \u7c7b\u4f3c\u4e8ejava \u7684\u589e\u5f3afor \u5faa\u73af, \u662f\u539f\u59cbJS \u63d0\u4f9b\u7684\u529f\u80fd $(\"#btn\").click(function(){ let lis = $(\"li\"); for(ele of lis){ alert(ele.innerHTML); } });","title":"2.5\u3001\u904d\u5386\u64cd\u4f5c"},{"location":"jquery/#26","text":"JS \u5bf9\u8c61\u548c jQuery \u5bf9\u8c61\u76f8\u4e92\u8f6c\u6362 $(JS \u7684 DOM \u5bf9\u8c61)\uff1a\u5c06 JS \u5bf9\u8c61\u8f6c\u4e3a jQuery \u5bf9\u8c61\u3002 jQuery \u5bf9\u8c61[\u7d22\u5f15] jQuery \u5bf9\u8c61.get(\u7d22\u5f15)\uff1a\u5c06 jQuery \u5bf9\u8c61\u8f6c\u4e3a JS \u5bf9\u8c61\u3002 \u4e8b\u4ef6 \u5728 jQuery \u4e2d\u5c06\u4e8b\u4ef6\u5c01\u88c5\u6210\u4e86\u5bf9\u5e94\u7684\u65b9\u6cd5\u3002\u53bb\u6389\u4e86 JS \u4e2d\u7684 .on \u8bed\u6cd5\u3002 on(\u4e8b\u4ef6\u540d\u79f0,\u6267\u884c\u7684\u529f\u80fd)\uff1a\u7ed1\u5b9a\u4e8b\u4ef6\u3002 off(\u4e8b\u4ef6\u540d\u79f0)\uff1a\u89e3\u7ed1\u4e8b\u4ef6\u3002 \u904d\u5386 \u4f20\u7edf\u65b9\u5f0f\u3002 \u5bf9\u8c61.each() \u65b9\u6cd5\u3002 $.each() \u65b9\u6cd5\u3002 for of \u8bed\u53e5\u3002","title":"2.6\u3001\u5c0f\u7ed3"},{"location":"jquery/#3jquery","text":"","title":"3\u3001JQuery\u9009\u62e9\u5668"},{"location":"jquery/#31","text":"\u9009\u62e9\u5668\uff1a\u7c7b\u4f3c\u4e8e CSS \u7684\u9009\u62e9\u5668\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u83b7\u53d6\u5143\u7d20\u3002 \u4f8b\u5982\uff1aid \u9009\u62e9\u5668\u3001\u7c7b\u9009\u62e9\u5668\u3001\u5143\u7d20\u9009\u62e9\u5668\u3001\u5c5e\u6027\u9009\u62e9\u5668\u7b49\u7b49\u3002 jQuery \u4e2d\u9009\u62e9\u5668\u7684\u8bed\u6cd5\uff1a$(); \u4ee3\u7801\u5b9e\u73b0 ```html \u57fa\u672c\u9009\u62e9\u5668 div1 div2 div3 //1.\u5143\u7d20\u9009\u62e9\u5668 $(\"\u5143\u7d20\u7684\u540d\u79f0\") let divs = $(\"div\"); //alert(divs.length); //2.id\u9009\u62e9\u5668 $(\"#id\u7684\u5c5e\u6027\u503c\") let div1 = $(\"#div1\"); //alert(div1); //3.\u7c7b\u9009\u62e9\u5668 $(\".class\u7684\u5c5e\u6027\u503c\") let cls = $(\".cls\"); alert(cls.length); ```","title":"3.1\u3001\u57fa\u672c\u9009\u62e9\u5668"},{"location":"jquery/#32","text":"\u4ee3\u7801\u5b9e\u73b0 ```html \u5c42\u7ea7\u9009\u62e9\u5668 s1 s1-1 s1-2 s2 p1 p2 // 1. \u540e\u4ee3\u9009\u62e9\u5668 $(\"A B\"); A\u4e0b\u7684\u6240\u6709B(\u5305\u62ecB\u7684\u5b50\u7ea7) let spans1 = $(\"div span\"); //alert(spans1.length); // 2. \u5b50\u9009\u62e9\u5668 $(\"A > B\"); A\u4e0b\u7684\u6240\u6709B(\u4e0d\u5305\u62ecB\u7684\u5b50\u7ea7) let spans2 = $(\"div > span\"); //alert(spans2.length); // 3. \u5144\u5f1f\u9009\u62e9\u5668 $(\"A + B\"); A\u76f8\u90bb\u7684\u4e0b\u4e00\u4e2aB let ps1 = $(\"div + p\"); //alert(ps1.length); // 4. \u5144\u5f1f\u9009\u62e9\u5668 $(\"A ~ B\"); A\u76f8\u90bb\u7684\u6240\u6709B let ps2 = $(\"div ~ p\"); alert(ps2.length); ```","title":"3.2\u3001\u5c42\u7ea7\u9009\u62e9\u5668"},{"location":"jquery/#33","text":"\u4ee3\u7801\u5b9e\u73b0 ```html \u5c5e\u6027\u9009\u62e9\u5668 //1.\u5c5e\u6027\u540d\u9009\u62e9\u5668 $(\"\u5143\u7d20[\u5c5e\u6027\u540d]\") let in1 = $(\"input[type]\"); //alert(in1.length); //2.\u5c5e\u6027\u503c\u9009\u62e9\u5668 $(\"\u5143\u7d20[\u5c5e\u6027\u540d=\u5c5e\u6027\u503c]\") let in2 = $(\"input[type='password']\"); alert(in2.length); ```","title":"3.3\u3001\u5c5e\u6027\u9009\u62e9\u5668"},{"location":"jquery/#34","text":"\u4ee3\u7801\u5b9e\u73b0 ```html \u8fc7\u6ee4\u5668\u9009\u62e9\u5668 div1 div2 div3 div4 // 1.\u9996\u5143\u7d20\u9009\u62e9\u5668 $(\"A:first\"); let div1 = $(\"div:first\"); //alert(div1.html()); // 2.\u5c3e\u5143\u7d20\u9009\u62e9\u5668 $(\"A:last\"); let div4 = $(\"div:last\"); //alert(div4.html()); // 3.\u975e\u5143\u7d20\u9009\u62e9\u5668 $(\"A:not(B)\"); let divs1 = $(\"div:not(#div2)\"); //alert(divs1.length); // 4.\u5076\u6570\u9009\u62e9\u5668 $(\"A:even\"); let divs2 = $(\"div:even\"); //alert(divs2.length); //alert(divs2[0].innerHTML); //alert(divs2[1].innerHTML); // 5.\u5947\u6570\u9009\u62e9\u5668 $(\"A:odd\"); let divs3 = $(\"div:odd\"); //alert(divs3.length); //alert(divs3[0].innerHTML); //alert(divs3[1].innerHTML); // 6.\u7b49\u4e8e\u7d22\u5f15\u9009\u62e9\u5668 $(\"A:eq(index)\"); let div3 = $(\"div:eq(2)\"); //alert(div3.html()); // 7.\u5927\u4e8e\u7d22\u5f15\u9009\u62e9\u5668 $(\"A:gt(index)\"); let divs4 = $(\"div:gt(1)\"); //alert(divs4.length); //alert(divs4[0].innerHTML); //alert(divs4[1].innerHTML); // 8.\u5c0f\u4e8e\u7d22\u5f15\u9009\u62e9\u5668 $(\"A:lt(index)\"); let divs5 = $(\"div:lt(2)\"); alert(divs5.length); alert(divs5[0].innerHTML); alert(divs5[1].innerHTML); ```","title":"3.4\u3001\u8fc7\u6ee4\u5668\u9009\u62e9\u5668"},{"location":"jquery/#35","text":"\u4ee3\u7801\u5b9e\u73b0 ```html \u8868\u5355\u5c5e\u6027\u9009\u62e9\u5668 \u7537 \u5973 \u5b66\u4e60 \u7761\u89c9 ---\u8bf7\u9009\u62e9--- \u672c\u79d1 \u4e13\u79d1 // 1.\u53ef\u7528\u5143\u7d20\u9009\u62e9\u5668 $(\"A:enabled\"); let ins1 = $(\"input:enabled\"); //alert(ins1.length); // 2.\u4e0d\u53ef\u7528\u5143\u7d20\u9009\u62e9\u5668 $(\"A:disabled\"); let ins2 = $(\"input:disabled\"); //alert(ins2.length); // 3.\u5355\u9009/\u590d\u9009\u6846\u88ab\u9009\u4e2d\u7684\u5143\u7d20 $(\"A:checked\"); let ins3 = $(\"input:checked\"); //alert(ins3.length); //alert(ins3[0].value); //alert(ins3[1].value); //alert(ins3[2].value); // 4.\u4e0b\u62c9\u6846\u88ab\u9009\u4e2d\u7684\u5143\u7d20 $(\"A:selected\"); let select = $(\"select option:selected\"); alert(select.html()); ```","title":"3.5\u3001\u8868\u5355\u5c5e\u6027\u9009\u62e9\u5668"},{"location":"jquery/#36","text":"\u9009\u62e9\u5668\uff1a\u7c7b\u4f3c\u4e8e CSS \u7684\u9009\u62e9\u5668\uff0c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u83b7\u53d6\u5143\u7d20\u3002 jQuery \u4e2d\u9009\u62e9\u5668\u7684\u8bed\u6cd5\uff1a$(); \u57fa\u672c\u9009\u62e9\u5668 $(\"\u5143\u7d20\u7684\u540d\u79f0\"); $(\"#id\u7684\u5c5e\u6027\u503c\"); $(\".class\u7684\u5c5e\u6027\u503c\"); \u5c42\u7ea7\u9009\u62e9\u5668 $(\"A B\"); $(\"A > B\"); \u5c5e\u6027\u9009\u62e9\u5668 $(\"A[\u5c5e\u6027\u540d]\"); $(\"A[\u5c5e\u6027\u540d=\u5c5e\u6027\u503c]\"); \u8fc7\u6ee4\u5668\u9009\u62e9\u5668 $(\"A:even\"); $(\"A:odd\"); \u8868\u5355\u5c5e\u6027\u9009\u62e9\u5668 $(\"A:disabled\"); $(\"A:checked\"); $(\"A:selected\");","title":"3.6\u3001\u5c0f\u7ed3"},{"location":"jquery/#4jquery_dom","text":"","title":"4\u3001JQuery DOM"},{"location":"jquery/#41","text":"\u5e38\u7528\u65b9\u6cd5 \u4ee3\u7801\u5b9e\u73b0 ```html \u64cd\u4f5c\u6587\u672c \u6211\u662fdiv //1. html() \u83b7\u53d6\u6807\u7b7e\u7684\u6587\u672c\u5185\u5bb9 $(\"#btn1\").click(function(){ //\u83b7\u53d6div\u6807\u7b7e\u7684\u6587\u672c\u5185\u5bb9 let value = $(\"#div\").html(); alert(value); }); //2. html(value) \u8bbe\u7f6e\u6807\u7b7e\u7684\u6587\u672c\u5185\u5bb9\uff0c\u89e3\u6790\u6807\u7b7e $(\"#btn2\").click(function(){ //\u8bbe\u7f6ediv\u6807\u7b7e\u7684\u6587\u672c\u5185\u5bb9 //$(\"#div\").html(\"\u6211\u771f\u7684\u662fdiv\"); $(\"#div\").html(\"<b>\u6211\u771f\u7684\u662fdiv</b>\"); }); ```","title":"4.1\u3001\u64cd\u4f5c\u6587\u672c"},{"location":"jquery/#42","text":"\u5e38\u7528\u65b9\u6cd5 \u4ee3\u7801\u5b9e\u73b0 ```html \u64cd\u4f5c\u5bf9\u8c61 \u5317\u4eac \u4e0a\u6d77 \u5e7f\u5dde \u6df1\u5733 \u52a0\u6cb9 \u96c4\u8d77 /* 1. $(\"\u5143\u7d20\") \u521b\u5efa\u6307\u5b9a\u5143\u7d20 2. append(element) \u6dfb\u52a0\u6210\u6700\u540e\u4e00\u4e2a\u5b50\u5143\u7d20\uff0c\u7531\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528 3. appendTo(element) \u6dfb\u52a0\u6210\u6700\u540e\u4e00\u4e2a\u5b50\u5143\u7d20\uff0c\u7531\u88ab\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528 4. prepend(element) \u6dfb\u52a0\u6210\u7b2c\u4e00\u4e2a\u5b50\u5143\u7d20\uff0c\u7531\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528 5. prependTo(element) \u6dfb\u52a0\u6210\u7b2c\u4e00\u4e2a\u5b50\u5143\u7d20\uff0c\u7531\u88ab\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528 6. before(element) \u6dfb\u52a0\u5230\u5f53\u524d\u5143\u7d20\u7684\u524d\u9762\uff0c\u4e24\u8005\u4e4b\u95f4\u662f\u5144\u5f1f\u5173\u7cfb\uff0c\u7531\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528 7. after(element) \u6dfb\u52a0\u5230\u5f53\u524d\u5143\u7d20\u7684\u540e\u9762\uff0c\u4e24\u8005\u4e4b\u95f4\u662f\u5144\u5f1f\u5173\u7cfb\uff0c\u7531\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528 8. remove() \u5220\u9664\u6307\u5b9a\u5143\u7d20(\u81ea\u5df1\u79fb\u9664\u81ea\u5df1) 9. empty() \u6e05\u7a7a\u6307\u5b9a\u5143\u7d20\u7684\u6240\u6709\u5b50\u5143\u7d20 */ // \u6309\u94ae\u4e00\uff1a\u6dfb\u52a0\u4e00\u4e2aspan\u5230div $(\"#btn1\").click(function(){ let span = $(\"<span>span</span>\"); $(\"#div\").append(span); }); //\u6309\u94ae\u4e8c\uff1a\u5c06\u52a0\u6cb9\u6dfb\u52a0\u5230\u57ce\u5e02\u5217\u8868\u6700\u4e0b\u65b9 $(\"#btn2\").click(function(){ //$(\"#city\").append($(\"#jy\")); $(\"#jy\").appendTo($(\"#city\")); }); //\u6309\u94ae\u4e09\uff1a\u5c06\u52a0\u6cb9\u6dfb\u52a0\u5230\u57ce\u5e02\u5217\u8868\u6700\u4e0a\u65b9 $(\"#btn3\").click(function(){ //$(\"#city\").prepend($(\"#jy\")); $(\"#jy\").prependTo($(\"#city\")); }); //\u6309\u94ae\u56db\uff1a\u5c06\u96c4\u8d77\u6dfb\u52a0\u5230\u4e0a\u6d77\u4e0b\u65b9 $(\"#btn4\").click(function(){ $(\"#sh\").after($(\"#xq\")); }); //\u6309\u94ae\u4e94\uff1a\u5c06\u96c4\u8d77\u6dfb\u52a0\u5230\u4e0a\u6d77\u4e0a\u65b9 $(\"#btn5\").click(function(){ $(\"#sh\").before($(\"#xq\")); }); //\u6309\u94ae\u516d\uff1a\u5c06\u96c4\u8d77\u5220\u9664 $(\"#btn6\").click(function(){ $(\"#xq\").remove(); }); //\u6309\u94ae\u4e03\uff1a\u5c06\u63cf\u8ff0\u5217\u8868\u5168\u90e8\u5220\u9664 $(\"#btn7\").click(function(){ $(\"#desc\").empty(); }); ```","title":"4.2\u3001\u64cd\u4f5c\u5bf9\u8c61"},{"location":"jquery/#43","text":"\u5e38\u7528\u65b9\u6cd5 \u4ee3\u7801\u5b9e\u73b0 ```html \u64cd\u4f5c\u6837\u5f0f .cls1{ background: pink; height: 30px; } \u6211\u662fdiv // 1.css(name) \u83b7\u53d6css\u6837\u5f0f $(\"#btn1\").click(function(){ alert($(\"#div\").css(\"border\")); }); // 2.css(name,value) \u8bbe\u7f6eCSS\u6837\u5f0f $(\"#btn2\").click(function(){ $(\"#div\").css(\"background\",\"blue\"); }); // 3.addClass(value) \u7ed9\u6307\u5b9a\u7684\u5bf9\u8c61\u6dfb\u52a0\u6837\u5f0f\u7c7b\u540d $(\"#btn3\").click(function(){ $(\"#div\").addClass(\"cls1\"); }); // 4.removeClass(value) \u7ed9\u6307\u5b9a\u7684\u5bf9\u8c61\u5220\u9664\u6837\u5f0f\u7c7b\u540d $(\"#btn4\").click(function(){ $(\"#div\").removeClass(\"cls1\"); }); // 5.toggleClass(value) \u5982\u679c\u6ca1\u6709\u6837\u5f0f\u7c7b\u540d\uff0c\u5219\u6dfb\u52a0\u3002\u5982\u679c\u6709\uff0c\u5219\u5220\u9664 $(\"#btn5\").click(function(){ $(\"#div\").toggleClass(\"cls1\"); }); ```","title":"4.3\u3001\u64cd\u4f5c\u6837\u5f0f"},{"location":"jquery/#44","text":"\u5e38\u7528\u65b9\u6cd5 \u4ee3\u7801\u5b9e\u73b0 ```html \u64cd\u4f5c\u5c5e\u6027 \u7537 \u5973 ---\u8bf7\u9009\u62e9--- \u672c\u79d1 \u4e13\u79d1 // 1.attr(name,[value]) \u83b7\u5f97/\u8bbe\u7f6e\u5c5e\u6027\u7684\u503c //\u6309\u94ae\u4e00\uff1a\u83b7\u53d6\u8f93\u5165\u6846\u7684id\u5c5e\u6027 $(\"#btn1\").click(function(){ alert($(\"#username\").attr(\"id\")); }); //\u6309\u94ae\u4e8c\uff1a\u7ed9\u8f93\u5165\u6846\u8bbe\u7f6evalue\u5c5e\u6027 $(\"#btn2\").click(function(){ $(\"#username\").attr(\"value\",\"hello...\"); }); // 2.prop(name,[value]) \u83b7\u5f97/\u8bbe\u7f6e\u5c5e\u6027\u7684\u503c(checked\uff0cselected) //\u6309\u94ae\u4e09\uff1a\u9009\u4e2d\u5973 $(\"#btn3\").click(function(){ $(\"#gender2\").prop(\"checked\",true); }); //\u6309\u94ae\u56db\uff1a\u9009\u4e2d\u672c\u79d1 $(\"#btn4\").click(function(){ $(\"#bk\").prop(\"selected\",true); }); ```","title":"4.4\u3001\u64cd\u4f5c\u5c5e\u6027"},{"location":"jquery/#45","text":"\u64cd\u4f5c\u6587\u672c html() html(\u2026)\uff1a\u83b7\u53d6\u6216\u8bbe\u7f6e\u6807\u7b7e\u7684\u6587\u672c\uff0c\u89e3\u6790\u6807\u7b7e\u3002 \u64cd\u4f5c\u5bf9\u8c61 $(\u201c\u5143\u7d20\u201d)\uff1a\u521b\u5efa\u6307\u5b9a\u5143\u7d20\u3002 append(element)\uff1a\u6dfb\u52a0\u6210\u6700\u540e\u4e00\u4e2a\u5b50\u5143\u7d20\uff0c\u7531\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528\u3002 prepend(element)\uff1a\u6dfb\u52a0\u6210\u7b2c\u4e00\u4e2a\u5b50\u5143\u7d20\uff0c\u7531\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528\u3002 before(element)\uff1a\u6dfb\u52a0\u5230\u5f53\u524d\u5143\u7d20\u7684\u524d\u9762\uff0c\u4e24\u8005\u4e4b\u95f4\u662f\u5144\u5f1f\u5173\u7cfb\uff0c\u7531\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528\u3002 after(element)\uff1a\u6dfb\u52a0\u5230\u5f53\u524d\u5143\u7d20\u7684\u540e\u9762\uff0c\u4e24\u8005\u4e4b\u95f4\u662f\u5144\u5f1f\u5173\u7cfb\uff0c\u7531\u6dfb\u52a0\u8005\u5bf9\u8c61\u8c03\u7528\u3002 remove()\uff1a\u5220\u9664\u6307\u5b9a\u5143\u7d20(\u81ea\u5df1\u79fb\u9664\u81ea\u5df1)\u3002 \u64cd\u4f5c\u6837\u5f0f addClass(value)\uff1a\u7ed9\u6307\u5b9a\u7684\u5bf9\u8c61\u6dfb\u52a0\u6837\u5f0f\u7c7b\u540d\u3002 removeClass(value)\uff1a\u7ed9\u6307\u5b9a\u7684\u5bf9\u8c61\u5220\u9664\u6837\u5f0f\u7c7b\u540d\u3002 \u64cd\u4f5c\u5c5e\u6027 attr(name,[value])\uff1a\u83b7\u5f97/\u8bbe\u7f6e\u5c5e\u6027\u7684\u503c\u3002 prop(name,[value])\uff1a\u83b7\u5f97/\u8bbe\u7f6e\u5c5e\u6027\u7684\u503c(checked\uff0cselected)\u3002","title":"4.5\u3001\u5c0f\u7ed3"},{"location":"jquery/#5","text":"","title":"5\u3001\u7efc\u5408\u6848\u4f8b \u590d\u9009\u6846"},{"location":"jquery/#51","text":"","title":"5.1\u3001\u6848\u4f8b\u6548\u679c"},{"location":"jquery/#52","text":"\u529f\u80fd\u5206\u6790 \u5168\u9009 \u4e3a\u5168\u9009\u6309\u94ae\u7ed1\u5b9a\u5355\u51fb\u4e8b\u4ef6\u3002 \u83b7\u53d6\u6240\u6709\u7684\u5546\u54c1\u9879\u590d\u9009\u6846\u5143\u7d20\uff0c\u4e3a\u5176\u6dfb\u52a0 checked \u5c5e\u6027\uff0c\u5c5e\u6027\u503c\u4e3a true\u3002 \u5168\u4e0d\u9009 \u4e3a\u5168\u4e0d\u9009\u6309\u94ae\u7ed1\u5b9a\u5355\u51fb\u4e8b\u4ef6\u3002 \u83b7\u53d6\u6240\u6709\u7684\u5546\u54c1\u9879\u590d\u9009\u6846\u5143\u7d20\uff0c\u4e3a\u5176\u6dfb\u52a0 checked \u5c5e\u6027\uff0c\u5c5e\u6027\u503c\u4e3a false\u3002 \u53cd\u9009 \u4e3a\u53cd\u9009\u6309\u94ae\u7ed1\u5b9a\u5355\u51fb\u4e8b\u4ef6 \u83b7\u53d6\u6240\u6709\u7684\u5546\u54c1\u9879\u590d\u9009\u6846\u5143\u7d20\uff0c\u4e3a\u5176\u6dfb\u52a0 checked \u5c5e\u6027\uff0c\u5c5e\u6027\u503c\u662f\u76ee\u524d\u76f8\u53cd\u7684\u72b6\u6001\u3002 \u4ee3\u7801\u5b9e\u73b0 <!DOCTYPE html> < html lang = \"en\" > < head > < meta charset = \"UTF-8\" > < meta name = \"viewport\" content = \"width=device-width, initial-scale=1.0\" > < title > \u590d\u9009\u6846 </ title > </ head > < body > < table id = \"tab1\" border = \"1\" width = \"800\" align = \"center\" > < tr > < th style = \"text-align: left\" > < input style = \"background:lightgreen\" id = \"selectAll\" type = \"button\" value = \"\u5168\u9009\" > < input style = \"background:lightgreen\" id = \"selectNone\" type = \"button\" value = \"\u5168\u4e0d\u9009\" > < input style = \"background:lightgreen\" id = \"reverse\" type = \"button\" value = \"\u53cd\u9009\" > </ th > < th > \u5206\u7c7bID </ th > < th > \u5206\u7c7b\u540d\u79f0 </ th > < th > \u5206\u7c7b\u63cf\u8ff0 </ th > < th > \u64cd\u4f5c </ th > </ tr > < tr > < td >< input type = \"checkbox\" class = \"item\" ></ td > < td > 1 </ td > < td > \u624b\u673a\u6570\u7801 </ td > < td > \u624b\u673a\u6570\u7801\u7c7b\u5546\u54c1 </ td > < td >< a href = \"\" > \u4fee\u6539 </ a > | < a href = \"\" > \u5220\u9664 </ a ></ td > </ tr > < tr > < td >< input type = \"checkbox\" class = \"item\" ></ td > < td > 2 </ td > < td > \u7535\u8111\u529e\u516c </ td > < td > \u7535\u8111\u529e\u516c\u7c7b\u5546\u54c1 </ td > < td >< a href = \"\" > \u4fee\u6539 </ a > | < a href = \"\" > \u5220\u9664 </ a ></ td > </ tr > < tr > < td >< input type = \"checkbox\" class = \"item\" ></ td > < td > 3 </ td > < td > \u978b\u9774\u7bb1\u5305 </ td > < td > \u978b\u9774\u7bb1\u5305\u7c7b\u5546\u54c1 </ td > < td >< a href = \"\" > \u4fee\u6539 </ a > | < a href = \"\" > \u5220\u9664 </ a ></ td > </ tr > < tr > < td >< input type = \"checkbox\" class = \"item\" ></ td > < td > 4 </ td > < td > \u5bb6\u5c45\u9970\u54c1 </ td > < td > \u5bb6\u5c45\u9970\u54c1\u7c7b\u5546\u54c1 </ td > < td >< a href = \"\" > \u4fee\u6539 </ a > | < a href = \"\" > \u5220\u9664 </ a ></ td > </ tr > </ table > </ body > < script src = \"js/jquery-3.3.1.min.js\" ></ script > < script > //\u5168\u9009 //1.\u4e3a\u5168\u9009\u6309\u94ae\u6dfb\u52a0\u5355\u51fb\u4e8b\u4ef6 $ ( \"#selectAll\" ). click ( function (){ //2.\u83b7\u53d6\u6240\u6709\u7684\u5546\u54c1\u590d\u9009\u6846\u5143\u7d20\uff0c\u4e3a\u5176\u6dfb\u52a0checked\u5c5e\u6027\uff0c\u5c5e\u6027\u503ctrue $ ( \".item\" ). prop ( \"checked\" , true ); }); //\u5168\u4e0d\u9009 //1.\u4e3a\u5168\u4e0d\u9009\u6309\u94ae\u6dfb\u52a0\u5355\u51fb\u4e8b\u4ef6 $ ( \"#selectNone\" ). click ( function (){ //2.\u83b7\u53d6\u6240\u6709\u7684\u5546\u54c1\u590d\u9009\u6846\u5143\u7d20\uff0c\u4e3a\u5176\u6dfb\u52a0checked\u5c5e\u6027\uff0c\u5c5e\u6027\u503cfalse $ ( \".item\" ). prop ( \"checked\" , false ); }); //\u53cd\u9009 //1.\u4e3a\u53cd\u9009\u6309\u94ae\u6dfb\u52a0\u5355\u51fb\u4e8b\u4ef6 $ ( \"#reverse\" ). click ( function (){ //2.\u83b7\u53d6\u6240\u6709\u7684\u5546\u54c1\u590d\u9009\u6846\u5143\u7d20\uff0c\u4e3a\u5176\u6dfb\u52a0checked\u5c5e\u6027\uff0c\u5c5e\u6027\u503c\u662f\u76ee\u524d\u76f8\u53cd\u7684\u72b6\u6001 let items = $ ( \".item\" ); items . each ( function (){ $ ( this ). prop ( \"checked\" , ! $ ( this ). prop ( \"checked\" )); }); }); </ script > </ html >","title":"5.2\u3001\u5206\u6790\u548c\u5b9e\u73b0"},{"location":"jquery/#6","text":"","title":"6\u3001\u7efc\u5408\u6848\u4f8b \u968f\u673a\u56fe\u7247"},{"location":"jquery/#61","text":"","title":"6.1\u3001\u6848\u4f8b\u6548\u679c"},{"location":"jquery/#62","text":"\u529f\u80fd\u5206\u6790 \u51c6\u5907\u4e00\u4e2a\u6570\u7ec4 \u5b9a\u4e49\u8ba1\u6570\u5668 \u5b9a\u4e49\u5b9a\u65f6\u5668\u5bf9\u8c61 \u5b9a\u4e49\u56fe\u7247\u8def\u5f84\u53d8\u91cf \u4e3a\u5f00\u59cb\u6309\u94ae\u7ed1\u5b9a\u5355\u51fb\u4e8b\u4ef6 \u8bbe\u7f6e\u6309\u94ae\u72b6\u6001 \u8bbe\u7f6e\u5b9a\u65f6\u5668\uff0c\u5faa\u73af\u663e\u793a\u56fe\u7247 \u5faa\u73af\u83b7\u53d6\u56fe\u7247\u8def\u5f84 \u5c06\u5f53\u524d\u56fe\u7247\u663e\u793a\u5230\u5c0f\u56fe\u7247\u4e0a \u8ba1\u6570\u5668\u81ea\u589e \u4ee3\u7801\u5b9e\u73b0 ```html \u968f\u673a\u56fe\u7247 //1.\u51c6\u5907\u4e00\u4e2a\u6570\u7ec4 let imgs = [ \"img/01.jpg\", \"img/02.jpg\", \"img/03.jpg\", \"img/04.jpg\", \"img/05.jpg\", \"img/06.jpg\", \"img/07.jpg\", \"img/08.jpg\", \"img/09.jpg\", \"img/10.jpg\"]; //2.\u5b9a\u4e49\u8ba1\u6570\u5668\u53d8\u91cf let count = 0; //3.\u58f0\u660e\u5b9a\u65f6\u5668\u5bf9\u8c61 let time = null; //4.\u58f0\u660e\u56fe\u7247\u8def\u5f84\u53d8\u91cf let imgSrc = \"\"; //5.\u4e3a\u5f00\u59cb\u6309\u94ae\u7ed1\u5b9a\u5355\u51fb\u4e8b\u4ef6 $(\"#startBtn\").click(function(){ //6.\u8bbe\u7f6e\u6309\u94ae\u72b6\u6001 //\u7981\u7528\u5f00\u59cb\u6309\u94ae $(\"#startBtn\").prop(\"disabled\",true); //\u542f\u7528\u505c\u6b62\u6309\u94ae $(\"#stopBtn\").prop(\"disabled\",false); //7.\u8bbe\u7f6e\u5b9a\u65f6\u5668\uff0c\u5faa\u73af\u663e\u793a\u56fe\u7247 time = setInterval(function(){ //8.\u5faa\u73af\u83b7\u53d6\u56fe\u7247\u8def\u5f84 let index = count % imgs.length; // 0%10=0 1%10=1 2%10=2 .. 9%10=9 10%10=0 //9.\u5c06\u5f53\u524d\u56fe\u7247\u663e\u793a\u5230\u5c0f\u56fe\u7247\u4e0a imgSrc = imgs[index]; $(\"#small\").prop(\"src\",imgSrc); //10.\u8ba1\u6570\u5668\u81ea\u589e count++; },10); }); ```","title":"6.2\u3001\u52a8\u6001\u5207\u6362\u5c0f\u56fe\u7684\u5206\u6790\u548c\u5b9e\u73b0"},{"location":"jquery/#63","text":"\u529f\u80fd\u5206\u6790 \u4e3a\u505c\u6b62\u6309\u94ae\u7ed1\u5b9a\u5355\u51fb\u4e8b\u4ef6 \u53d6\u6d88\u5b9a\u65f6\u5668 \u8bbe\u7f6e\u6309\u94ae\u72b6\u6001 \u5c06\u56fe\u7247\u663e\u793a\u5230\u5927\u56fe\u7247\u4e0a \u4ee3\u7801\u5b9e\u73b0 ```js //11.\u4e3a\u505c\u6b62\u6309\u94ae\u7ed1\u5b9a\u5355\u51fb\u4e8b\u4ef6 $(\"#stopBtn\").click(function(){ //12.\u53d6\u6d88\u5b9a\u65f6\u5668 clearInterval(time); // 13 . \u8bbe\u7f6e\u6309\u94ae\u72b6\u6001 // \u542f\u7528\u5f00\u59cb\u6309\u94ae $( \"#startBtn\" ) . prop ( \"disabled\" , false ); // \u7981\u7528\u505c\u6b62\u6309\u94ae $( \"#stopBtn\" ) . prop ( \"disabled\" , true ); // 14 . \u5c06\u56fe\u7247\u663e\u793a\u5230\u5927\u56fe\u7247\u4e0a $( \"#big\" ) . prop ( \"src\" , imgSrc ); $( \"#big\" ) . prop ( \"style\" , \"width: 400px; height: 400px;\" ); }); ```","title":"6.3\u3001\u663e\u793a\u5927\u56fe\u7684\u5206\u6790\u548c\u5b9e\u73b0"},{"location":"redis/day01/","text":"1. Redis \u7b80\u4ecb \u00b6 Redis \u7684\u4e0b\u8f7d\u4e0e\u5b89\u88c5 \u00b6 \u672c\u8bfe\u7a0b\u6240\u793a\uff0c\u5747\u57fa\u4e8eCenter OS7\u5b89\u88c5Redis\u3002 0 ) \u5982\u679c wget \u547d\u4ee4\u627e\u4e0d\u5230 yum - y install wget 0 ) \u5982\u679cmake \u62a5\u9519 \u5b89\u88c5 c \u8bed\u8a00\u7f16\u8bd1\u73af\u5883 yum install gcc - c ++ (1)\u4e0b\u8f7dRedis \u4e0b\u8f7d\u5b89\u88c5\u5305\uff1a wget http://download.redis.io/releases/redis-5.0.0.tar.gz \u89e3\u538b\u5b89\u88c5\u5305\uff1a tar -xvf redis-5.0.0.tar.gz \u7f16\u8bd1\uff08\u5728\u89e3\u538b\u7684\u76ee\u5f55\u4e2d\u6267\u884c\uff09\uff1a make \u5b89\u88c5\uff08\u5728\u89e3\u538b\u7684\u76ee\u5f55\u4e2d\u6267\u884c\uff09\uff1a make install \uff082\uff09\u5b89\u88c5 Redis redis-server\uff0c\u670d\u52a1\u5668\u542f\u52a8\u547d\u4ee4 \u5ba2\u6237\u7aef\u542f\u52a8\u547d\u4ee4 redis-cli\uff0credis\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6 redis.conf\uff0cRDB\u6587\u4ef6\u68c0\u67e5\u5de5\u5177\uff08\u5feb\u7167\u6301\u4e45\u5316\u6587\u4ef6\uff09 redis-check-dump\uff0cAOF\u6587\u4ef6\u4fee\u590d\u5de5\u5177 redis-check-aof Redis\u670d\u52a1\u5668\u542f\u52a8 \u00b6 Redis\u670d\u52a1\u5668\u542f\u52a8 \u00b6 \u542f\u52a8\u670d\u52a1\u5668\u2014\u2014\u53c2\u6570\u542f\u52a8 redis-server [ --port port ] \u8303\u4f8b redis-server --port 6379 \u542f\u52a8\u670d\u52a1\u5668\u2014\u2014\u914d\u7f6e\u6587\u4ef6\u542f\u52a8 redis-server config_file_name \u8303\u4f8b redis-server redis.conf Redis\u5ba2\u6237\u7aef\u542f\u52a8 \u00b6 \u542f\u52a8\u5ba2\u6237\u7aef redis-cli [ -h host ] [ -p port ] \u8303 \u4f8b redis-cli -h 61 .129.65.248 -p 6384 \u6ce8\u610f\uff1a\u670d\u52a1\u5668\u542f\u52a8\u6307\u5b9a\u7aef\u53e3\u4f7f\u7528\u7684\u662f--port\uff0c\u5ba2\u6237\u7aef\u542f\u52a8\u6307\u5b9a\u7aef\u53e3\u4f7f\u7528\u7684\u662f-p\u3002-\u7684\u6570\u91cf\u4e0d\u540c\u3002 Redis\u57fa\u7840\u73af\u5883\u8bbe\u7f6e\u7ea6\u5b9a \u00b6 \u521b\u5efa\u914d\u7f6e\u6587\u4ef6\u5b58\u50a8\u76ee\u5f55 mkdir conf \u521b\u5efa\u670d\u52a1\u5668\u6587\u4ef6\u5b58\u50a8\u76ee\u5f55\uff08\u5305\u542b\u65e5\u5fd7\u3001\u6570\u636e\u3001\u4e34\u65f6\u914d\u7f6e\u6587\u4ef6\u7b49\uff09 mkdir data \u521b\u5efa\u5feb\u901f\u8bbf\u95ee\u94fe\u63a5 ln -s redis-5.0.0 redis \u914d\u7f6e\u6587\u4ef6\u542f\u52a8\u4e0e\u5e38\u7528\u914d\u7f6e \u00b6 # \u67e5\u770b\u914d\u7f6e\u547d\u4ee4 cat redis.conf | grep -v '#' | grep -v '^$' # \u90a3\u4e9bip \u80fd\u8bbf\u95eeredis #bind 127.0.0.1 # \u7aef\u53e3\u53f7 port 6379 # \u8d85\u65f6\u65f6\u95f4 #timeout 0 # \u662f\u5426\u540e\u53f0\u542f\u52a8 daemonize yes # \u65e5\u5fd7\u6587\u4ef6 logfile \"log_6379.log\" # \u6570\u636e\u6587\u4ef6\u4f4d\u7f6e dir /usr/local/redis/data \u670d\u52a1\u5668\u7aef\u8bbe\u5b9a \u00b6 \u8bbe\u7f6e\u670d\u52a1\u5668\u4ee5\u5b88\u62a4\u8fdb\u7a0b\u7684\u65b9\u5f0f\u8fd0\u884c\uff0c\u5f00\u542f\u540e\u670d\u52a1\u5668\u63a7\u5236\u53f0\u4e2d\u5c06\u6253\u5370\u670d\u52a1\u5668\u8fd0\u884c\u4fe1\u606f\uff08\u540c\u65e5\u5fd7\u5185\u5bb9\u76f8\u540c\uff09 daemonize yes | no \u7ed1\u5b9a\u4e3b\u673a\u5730\u5740 bind ip \u8bbe\u7f6e\u670d\u52a1\u5668\u7aef\u53e3 port port \u8bbe\u7f6e\u670d\u52a1\u5668\u6587\u4ef6\u4fdd\u5b58\u5730\u5740 dir path \u5ba2\u6237\u7aef\u914d\u7f6e \u00b6 \u670d\u52a1\u5668\u5141\u8bb8\u5ba2\u6237\u7aef\u8fde\u63a5\u6700\u5927\u6570\u91cf\uff0c\u9ed8\u8ba40\uff0c\u8868\u793a\u65e0\u9650\u5236\u3002\u5f53\u5ba2\u6237\u7aef\u8fde\u63a5\u5230\u8fbe\u4e0a\u9650\u540e\uff0cRedis\u4f1a\u62d2\u7edd\u65b0\u7684\u8fde\u63a5 maxclients count \u5ba2\u6237\u7aef\u95f2\u7f6e\u7b49\u5f85\u6700\u5927\u65f6\u957f\uff0c\u8fbe\u5230\u6700\u5927\u503c\u540e\u5173\u95ed\u5bf9\u5e94\u8fde\u63a5\u3002\u5982\u9700\u5173\u95ed\u8be5\u529f\u80fd\uff0c\u8bbe\u7f6e\u4e3a 0 timeout seconds \u65e5\u5fd7\u914d\u7f6e \u00b6 \u8bbe\u7f6e\u670d\u52a1\u5668\u4ee5\u6307\u5b9a\u65e5\u5fd7\u8bb0\u5f55\u7ea7\u522b loglevel debug | verbose | notice | warning \u65e5\u5fd7\u8bb0\u5f55\u6587\u4ef6\u540d logfile filename \u6ce8\u610f\uff1a\u65e5\u5fd7\u7ea7\u522b\u5f00\u53d1\u671f\u8bbe\u7f6e\u4e3averbose\u5373\u53ef\uff0c\u751f\u4ea7\u73af\u5883\u4e2d\u914d\u7f6e\u4e3anotice\uff0c\u7b80\u5316\u65e5\u5fd7\u8f93\u51fa\u91cf\uff0c\u964d\u4f4e\u5199\u65e5\u5fd7IO\u7684\u9891\u5ea6\u3002 Redis\u57fa\u672c\u64cd\u4f5c \u00b6 \u547d\u4ee4\u884c\u6a21\u5f0f\u5de5\u5177\u4f7f\u7528\u601d\u8003 \u00b6 \u529f\u80fd\u6027\u547d\u4ee4 \u5e2e\u52a9\u4fe1\u606f\u67e5\u9605 \u9000\u51fa\u6307\u4ee4 \u6e05\u9664\u5c4f\u5e55\u4fe1\u606f \u4fe1\u606f\u8bfb\u5199 \u00b6 \u8bbe\u7f6e key\uff0cvalue \u6570\u636e set key value \u8303\u4f8b set name itheima \u6839\u636e key \u67e5\u8be2\u5bf9\u5e94\u7684 value\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u8fd4\u56de\u7a7a\uff08nil\uff09 get key \u8303\u4f8b get name \u5e2e\u52a9\u4fe1\u606f \u00b6 \u83b7\u53d6\u547d\u4ee4\u5e2e\u52a9\u6587\u6863 help [ command ] \u8303\u4f8b help set \u83b7\u53d6\u7ec4\u4e2d\u6240\u6709\u547d\u4ee4\u4fe1\u606f\u540d\u79f0 help [ @group-name ] \u8303\u4f8b help @string \u9000\u51fa\u547d\u4ee4\u884c\u5ba2\u6237\u7aef\u6a21\u5f0f \u9000\u51fa\u5ba2\u6237\u7aef quit exit \u5feb\u6377\u952e Ctrl+C 1.6.4 redis\u5165\u95e8\u603b\u7ed3 \u00b6 \u5230\u8fd9\u91cc\uff0cRedis \u5165\u95e8\u7684\u76f8\u5173\u77e5\u8bc6\uff0c\u6211\u4eec\u5c31\u5168\u90e8\u5b66\u4e60\u5b8c\u4e86\uff0c\u518d\u6765\u56de\u987e\u4e00\u4e0b\uff0c\u8fd9\u4e2a\u90e8\u5206\u6211\u4eec\u4e3b\u8981\u8bb2\u89e3\u4e86\u54ea\u4e9b\u5185\u5bb9\u5462\uff1f \u9996\u5148\uff0c\u6211\u4eec\u5bf9Redis\u8fdb\u884c\u4e86\u4e00\u4e2a\u7b80\u5355\u4ecb\u7ecd\uff0c\u5305\u62ecNoSQL\u7684\u6982\u5ff5\u3001Redis\u7684\u6982\u5ff5\u7b49\u3002 \u7136\u540e\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86Redis \u7684\u4e0b\u8f7d\u4e0e\u5b89\u88c5\u3002\u5305\u62ec\u4e0b\u8f7d\u4e0e\u5b89\u88c5\u3001\u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u542f\u52a8\u3001\u4ee5\u53ca\u76f8\u5173\u914d\u7f6e\u6587\u4ef6\uff083\u7c7b\uff09\u3002 \u6700\u540e\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86Redis \u7684\u57fa\u672c\u64cd\u4f5c\u3002\u5305\u62ec\u6570\u636e\u8bfb\u5199\u3001\u9000\u51fa\u4e0e\u5e2e\u52a9\u4fe1\u606f\u83b7\u53d6\u3002 2. \u6570\u636e\u7c7b\u578b \u00b6 2.1 Redis \u6570\u636e\u7c7b\u578b(5\u79cd\u5e38\u7528) \u00b6 \u57fa\u4e8e\u4ee5\u4e0a\u6570\u636e\u7279\u5f81\u6211\u4eec\u8fdb\u884c\u5206\u6790\uff0c\u6700\u7ec8\u5f97\u51fa\u6765\u6211\u4eec\u7684Redis\u4e2d\u8981\u8bbe\u8ba15\u79cd \u6570\u636e\u7c7b\u578b\uff1a string\u3001hash\u3001list\u3001set\u3001sorted_set/zset\uff08\u5e94\u7528\u6027\u8f83\u4f4e\uff09 2.2 string\u6570\u636e\u7c7b\u578b \u00b6 \u5728\u5b66\u4e60\u7b2c\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\u4e4b\u524d\uff0c\u5148\u7ed9\u5927\u5bb6\u4ecb\u7ecd\u4e00\u4e0b\uff0c\u5728\u968f\u540e\u8fd9\u90e8\u5206\u5185\u5bb9\u7684\u5b66\u4e60\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u6bcf\u4e00\u79cd\u6570\u636e\u7c7b\u578b\u90fd\u5206\u6210\u4e09\u5757\u6765\u8bb2\uff1a\u9996\u5148\u662f\u8bb2\u4e0b\u5b83\u7684\u57fa\u672c\u64cd\u4f5c\uff0c\u63a5\u4e0b\u6765\u8bb2\u4e00\u4e9b\u5b83\u7684\u6269\u5c55\u64cd\u4f5c\uff0c\u6700\u540e\u6211\u4eec\u4f1a\u53bb\u505a\u4e00\u4e2a\u5c0f\u7684\u6848\u4f8b\u5206\u6790\u3002 2.2.1Redis \u6570\u636e\u5b58\u50a8\u683c\u5f0f \u00b6 \u5728\u5b66\u4e60string\u8fd9\u4e2a\u6570\u636e\u5f62\u5f0f\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u8981\u660e\u767dstring\u5230\u5e95\u662f\u4fee\u9970\u4ec0\u4e48\u7684\u3002\u6211\u4eec\u77e5\u9053redis \u81ea\u8eab\u662f\u4e00\u4e2a Map\uff0c\u5176\u4e2d\u6240\u6709\u7684\u6570\u636e\u90fd\u662f\u91c7\u7528 key : value \u7684\u5f62\u5f0f\u5b58\u50a8\u3002 \u5bf9\u4e8e\u8fd9\u79cd\u7ed3\u6784\u6765\u8bf4\uff0c\u6211\u4eec\u7528\u6765\u5b58\u50a8\u6570\u636e\u4e00\u5b9a\u662f\u4e00\u4e2a\u503c\u524d\u9762\u5bf9\u5e94\u4e00\u4e2a\u540d\u79f0\u3002\u6211\u4eec\u901a\u8fc7\u540d\u79f0\u6765\u8bbf\u95ee\u540e\u9762\u7684\u503c\u3002\u6309\u7167\u8fd9\u79cd\u5f62\u52bf\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u51fa\u6765\u6211\u4eec\u7684\u5b58\u50a8\u683c\u5f0f\u3002\u524d\u9762\u8fd9\u4e00\u90e8\u5206\u6211\u4eec\u79f0\u4e3akey\u3002\u540e\u9762\u7684\u4e00\u90e8\u5206\u79f0\u4e3avalue\uff0c\u800c\u6211\u4eec\u7684\u6570\u636e\u7c7b\u578b\uff0c\u4ed6\u4e00\u5b9a\u662f\u4fee\u9970value\u7684\u3002 \u6570\u636e\u7c7b\u578b\u6307\u7684\u662f\u5b58\u50a8\u7684\u6570\u636e\u7684\u7c7b\u578b\uff0c\u4e5f\u5c31\u662f value \u90e8\u5206\u7684\u7c7b\u578b\uff0ckey \u90e8\u5206\u6c38\u8fdc\u90fd\u662f\u5b57\u7b26\u4e32\u3002 2.2.2 string \u7c7b\u578b \u00b6 \uff081\uff09\u5b58\u50a8\u7684\u6570\u636e\uff1a\u5355\u4e2a\u6570\u636e\uff0c\u6700\u7b80\u5355\u7684\u6570\u636e\u5b58\u50a8\u7c7b\u578b\uff0c\u4e5f\u662f\u6700\u5e38\u7528\u7684\u6570\u636e\u5b58\u50a8\u7c7b\u578b\u3002 string\uff0c\u4ed6\u5c31\u662f\u5b58\u4e00\u4e2a\u5b57\u7b26\u4e32\u513f\uff0c\u6ce8\u610f\u662fvalue\u90a3\u4e00\u90e8\u5206\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5b83\u662fredis\u4e2d\u6700\u57fa\u672c\u3001\u6700\u7b80\u5355\u7684\u5b58\u50a8\u6570\u636e\u7684\u683c\u5f0f\u3002 \uff082\uff09\u5b58\u50a8\u6570\u636e\u7684\u683c\u5f0f\uff1a\u4e00\u4e2a\u5b58\u50a8\u7a7a\u95f4\u4fdd\u5b58\u4e00\u4e2a\u6570\u636e \u6bcf\u4e00\u4e2a\u7a7a\u95f4\u4e2d\u53ea\u80fd\u4fdd\u5b58\u4e00\u4e2a\u5b57\u7b26\u4e32\u4fe1\u606f\uff0c\u8fd9\u4e2a\u4fe1\u606f\u91cc\u8fb9\u5982\u679c\u662f\u5b58\u7684\u7eaf\u6570\u5b57\uff0c\u4ed6\u4e5f\u80fd\u5f53\u6570\u5b57\u4f7f\u7528\uff0c\u6211\u4eec\u6765\u770b\u4e00\u4e0b\uff0c\u8fd9\u662f\u6211\u4eec\u7684\u6570\u636e\u7684\u5b58\u50a8\u7a7a\u95f4\u3002 \uff083\uff09\u5b58\u50a8\u5185\u5bb9\uff1a\u901a\u5e38\u4f7f\u7528\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u5b57\u7b26\u4e32\u4ee5\u6574\u6570\u7684\u5f62\u5f0f\u5c55\u793a\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u6570\u5b57\u64cd\u4f5c\u4f7f\u7528. \u4e00\u4e2akey\u5bf9\u4e00\u4e2avalue\uff0c\u800c\u8fd9\u4e2aitheima\u5c31\u662f\u6211\u4eec\u6240\u8bf4\u7684string\u7c7b\u578b\uff0c\u5f53\u7136\u5b83\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u7eaf\u6570\u5b57\u7684\u683c\u5f0f\u3002 2.2.3 string \u7c7b\u578b\u6570\u636e\u7684\u57fa\u672c\u64cd\u4f5c \u00b6 \uff081\uff09\u57fa\u7840\u6307\u4ee4 \u6dfb\u52a0/\u4fee\u6539\u6570\u636e\u6dfb\u52a0/\u4fee\u6539\u6570\u636e set key value \u83b7\u53d6\u6570\u636e get key \u5220\u9664\u6570\u636e del key \u5224\u5b9a\u6027\u6dfb\u52a0\u6570\u636e setnx key value \u6dfb\u52a0/\u4fee\u6539\u591a\u4e2a\u6570\u636e mset key1 value1 key2 value2 \u2026 \u83b7\u53d6\u591a\u4e2a\u6570\u636e mget key1 key2 \u2026 \u83b7\u53d6\u6570\u636e\u5b57\u7b26\u4e2a\u6570\uff08\u5b57\u7b26\u4e32\u957f\u5ea6\uff09 strlen key \u8ffd\u52a0\u4fe1\u606f\u5230\u539f\u59cb\u4fe1\u606f\u540e\u90e8\uff08\u5982\u679c\u539f\u59cb\u4fe1\u606f\u5b58\u5728\u5c31\u8ffd\u52a0\uff0c\u5426\u5219\u65b0\u5efa\uff09 append key value \uff082\uff09\u5355\u6570\u636e\u64cd\u4f5c\u4e0e\u591a\u6570\u636e\u64cd\u4f5c\u7684\u9009\u62e9\u4e4b\u60d1 \u5373set \u4e0emset\u7684\u5173\u7cfb\u3002\u8fd9\u5bf9\u4e8e\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u6765\u8bf4\uff0c\u6ca1\u6709\u4ec0\u4e48\u4f60\u5e94\u8be5\u9009\u54ea\u4e2a\uff0c\u800c\u662f\u4ed6\u4eec\u81ea\u5df1\u7684\u7279\u5f81\u662f\u4ec0\u4e48\uff0c\u4f60\u8981\u6839\u636e\u8fd9\u4e2a\u7279\u5f81\u53bb\u6bd4\u5bf9\u4f60\u7684\u4e1a\u52a1\uff0c\u770b\u770b\u7a76\u7adf\u9002\u7528\u4e8e\u54ea\u4e2a\u3002 \u5047\u5982\u8bf4\u8fd9\u662f\u6211\u4eec\u73b0\u5728\u7684\u670d\u52a1\u5668\uff0c\u4ed6\u8981\u5411redis\u8981\u6570\u636e\u7684\u8bdd\uff0c\u5b83\u4f1a\u53d1\u51fa\u4e00\u6761\u6307\u4ee4\u3002\u90a3\u4e48\u5f53\u8fd9\u6761\u6307\u4ee4\u53d1\u8fc7\u6765\u7684\u65f6\u5019\uff0c\u6bd4\u5982\u8bf4\u662f\u8fd9\u4e2aset\u6307\u4ee4\u8fc7\u6765\uff0c\u90a3\u4e48\u5b83\u4f1a\u628a\u8fd9\u4e2a\u7ed3\u679c\u8fd4\u56de\u7ed9\u4f60\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u8981\u601d\u8003\u8fd9\u91cc\u8fb9\u4e00\u5171\u7ecf\u8fc7\u4e86\u591a\u957f\u65f6\u95f4\u3002 \u9996\u5148\uff0c\u53d1\u9001set\u6307\u4ee4\u8981\u65f6\u95f4\uff0c\u8fd9\u662f\u7f51\u7edc\u7684\u4e00\u4e2a\u65f6\u95f4\uff0c\u63a5\u4e0b\u6765redis\u8981\u53bb\u8fd0\u884c\u8fd9\u4e2a\u6307\u4ee4\u8981\u6d88\u8017\u65f6\u95f4\uff0c\u6700\u7ec8\u628a\u8fd9\u4e2a\u7ed3\u679c\u8fd4\u56de\u7ed9\u4f60\u53c8\u6709\u4e00\u4e2a\u65f6\u95f4\uff0c\u8fd9\u4e2a\u65f6\u95f4\u53c8\u662f\u4e00\u4e2a\u7f51\u7edc\u7684\u65f6\u95f4\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u7406\u89e3\u4e3a\uff1a\u4e00\u4e2a\u6307\u4ee4\u53d1\u9001\u7684\u8fc7\u7a0b\u4e2d\u9700\u8981\u6d88\u8017\u8fd9\u6837\u7684\u65f6\u95f4. \u4f46\u662f\u5982\u679c\u8bf4\u73b0\u5728\u4e0d\u662f\u4e00\u6761\u6307\u4ee4\u4e86\uff0c\u4f60\u8981\u53d13\u4e2aset\u7684\u8bdd\uff0c\u8fd8\u8981\u591a\u957f\u65f6\u95f4\u5462\uff1f\u5bf9\u5e94\u7684\u53d1\u9001\u65f6\u95f4\u8981\u4e583\u4e86\uff0c\u56e0\u4e3a\u8fd9\u662f\u4e09\u4e2a\u5355\u6761\u6307\u4ee4,\u800c\u8fd0\u884c\u7684\u64cd\u4f5c\u65f6\u95f4\u5462\uff0c\u5b83\u4e5f\u8981\u4e583\u4e86\uff0c\u4f46\u6700\u7ec8\u8fd4\u56de\u7684\u4e5f\u8981\u53d13\u6b21\uff0c\u6240\u4ee5\u8fd9\u8fb9\u4e5f\u8981\u4e583\u3002 \u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u7ed3\u8bba\uff1a\u5355\u6307\u4ee4\u53d13\u6761\u5b83\u9700\u8981\u7684\u65f6\u95f4\uff0c\u5047\u5b9a\u4ed6\u4eec\u4e24\u4e2a\u4e00\u6837\uff0c\u662f6\u4e2a\u7f51\u7edc\u65f6\u95f4\u52a03\u4e2a\u5904\u7406\u65f6\u95f4\uff0c\u5982\u679c\u6211\u4eec\u628a\u5b83\u5408\u6210\u4e00\u4e2amset\u5462\uff0c\u6211\u4eec\u60f3\u4e00\u60f3\u3002 \u5047\u5982\u8bf4\u7528\u591a\u6307\u4ee4\u53d13\u4e2a\u6307\u4ee4\u7684\u8bdd\uff0c\u5176\u5b9e\u53ea\u9700\u8981\u53d1\u4e00\u6b21\u5c31\u884c\u4e86\u3002\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u7ed3\u8bba\uff0c\u591a\u6307\u4ee4\u53d13\u4e2a\u6307\u4ee4\u7684\u8bdd\uff0c\u5176\u5b9e\u5b83\u662f\u4e24\u4e2a\u7f51\u7edc\u65f6\u95f4\u52a0\u4e0a3\u4e2aredis\u7684\u64cd\u4f5c\u65f6\u95f4\uff0c\u4e3a\u4ec0\u4e48\u8fd9\u5199\u4e00\u4e2a\u5c0f\u52a0\u53f7\u5462\uff0c\u5c31\u662f\u56e0\u4e3a\u6bd5\u7adf\u53d1\u7684\u4fe1\u606f\u91cf\u53d8\u5927\u4e86\uff0c\u6240\u4ee5\u7f51\u7edc\u65f6\u95f4\u6709\u53ef\u80fd\u4f1a\u53d8\u957f\u3002 \u90a3\u4e48\u901a\u8fc7\u8fd9\u5f20\u56fe\uff0c\u4f60\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u7ed3\u8bba\uff0c\u6211\u4eec\u5355\u6307\u4ee4\u548c\u591a\u6307\u4ee4\u4ed6\u4eec\u7684\u5dee\u522b\u5c31\u5728\u4e8e\u4f60\u53d1\u9001\u7684\u6b21\u6570\u662f\u591a\u8fd8\u662f\u5c11\u3002\u5f53\u4f60\u5f71\u54cd\u7684\u6570\u636e\u6bd4\u8f83\u5c11\u7684\u65f6\u5019\uff0c\u4f60\u53ef\u4ee5\u7528\u5355\u6307\u4ee4\uff0c\u4e5f\u53ef\u4ee5\u7528\u591a\u6307\u4ee4\u3002\u4f46\u662f\u4e00\u65e6\u8fd9\u4e2a\u91cf\u5927\u4e86\uff0c\u4f60\u5c31\u8981\u9009\u62e9\u591a\u6307\u4ee4\u4e86\uff0c\u4ed6\u7684\u6548\u7387\u4f1a\u9ad8\u4e00\u4e9b\u3002 2.3 string \u7c7b\u578b\u6570\u636e\u7684\u6269\u5c55\u64cd\u4f5c \u00b6 2.3.1 string \u7c7b\u578b\u6570\u636e\u7684\u6269\u5c55\u64cd\u4f5c \u00b6 \u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e00string\u7684\u6269\u5c55\u64cd\u4f5c\uff0c\u5206\u6210\u4e24\u5927\u5757\uff1a\u4e00\u5757\u662f\u5bf9\u6570\u5b57\u8fdb\u884c\u64cd\u4f5c\u7684\uff0c\u7b2c\u4e8c\u5757\u662f\u5bf9\u6211\u4eec\u7684key\u7684\u65f6\u95f4\u8fdb\u884c\u64cd\u4f5c\u7684\u3002 \u8bbe\u7f6e\u6570\u503c\u6570\u636e\u589e\u52a0\u6307\u5b9a\u8303\u56f4\u7684\u503c incr key incrby key increment incrbyfloat key increment \u8bbe\u7f6e\u6570\u503c\u6570\u636e\u51cf\u5c11\u6307\u5b9a\u8303\u56f4\u7684\u503c decr key decrby key increment \u8bbe\u7f6e\u6570\u636e\u5177\u6709\u6307\u5b9a\u7684\u751f\u547d\u5468\u671f setex key seconds value psetex key milliseconds value 2.3.2 string \u7c7b\u578b\u6570\u636e\u64cd\u4f5c\u7684\u6ce8\u610f\u4e8b\u9879 \u00b6 (1)\u6570\u636e\u64cd\u4f5c\u4e0d\u6210\u529f\u7684\u53cd\u9988\u4e0e\u6570\u636e\u6b63\u5e38\u64cd\u4f5c\u4e4b\u95f4\u7684\u5dee\u5f02 \u8868\u793a\u8fd0\u884c\u7ed3\u679c\u662f\u5426\u6210\u529f (integer) 0 \u2192 false \u5931\u8d25 (integer) 1 \u2192 true \u6210\u529f \u8868\u793a\u8fd0\u884c\u7ed3\u679c\u503c (integer) 3 \u2192 3 3\u4e2a (integer) 1 \u2192 1 1\u4e2a (2)\u6570\u636e\u672a\u83b7\u53d6\u5230\u65f6\uff0c\u5bf9\u5e94\u7684\u6570\u636e\u4e3a\uff08nil\uff09\uff0c\u7b49\u540c\u4e8enull (3)\u6570\u636e\u6700\u5927\u5b58\u50a8\u91cf\uff1a512MB (4)string\u5728redis\u5185\u90e8\u5b58\u50a8\u9ed8\u8ba4\u5c31\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5f53\u9047\u5230\u589e\u51cf\u7c7b\u64cd\u4f5cincr\uff0cdecr\u65f6\u4f1a\u8f6c\u6210\u6570\u503c\u578b\u8fdb\u884c\u8ba1\u7b97 (5)\u6309\u6570\u503c\u8fdb\u884c\u64cd\u4f5c\u7684\u6570\u636e\uff0c\u5982\u679c\u539f\u59cb\u6570\u636e\u4e0d\u80fd\u8f6c\u6210\u6570\u503c\uff0c\u6216\u8d85\u8d8a\u4e86redis \u6570\u503c\u4e0a\u9650\u8303\u56f4\uff0c\u5c06\u62a5\u9519 9223372036854775807\uff08java\u4e2dLong\u578b\u6570\u636e\u6700\u5927\u503c\uff0cLong.MAX_VALUE\uff09 (6)redis\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u662f\u539f\u5b50\u6027\u7684\uff0c\u91c7\u7528\u5355\u7ebf\u7a0b\u5904\u7406\u6240\u6709\u4e1a\u52a1\uff0c\u547d\u4ee4\u662f\u4e00\u4e2a\u4e00\u4e2a\u6267\u884c\u7684\uff0c\u56e0\u6b64\u65e0\u9700\u8003\u8651\u5e76\u53d1\u5e26\u6765\u7684\u6570\u636e\u5f71\u54cd. 2.4string\u5e94\u7528\u573a\u666f\u4e0ekey\u547d\u540d\u7ea6\u5b9a \u00b6 2.4.1 \u5e94\u7528\u573a\u666f \u00b6 \u5b83\u7684\u5e94\u7528\u573a\u666f\u5728\u4e8e\uff1a\u4e3b\u9875\u9ad8\u9891\u8bbf\u95ee\u4fe1\u606f\u663e\u793a\u63a7\u5236\uff0c\u4f8b\u5982\u65b0\u6d6a\u5fae\u535a\u5927V\u4e3b\u9875\u663e\u793a\u7c89\u4e1d\u6570\u4e0e\u5fae\u535a\u6570\u91cf\u3002 \u6211\u4eec\u6765\u601d\u8003\u4e00\u4e0b\uff1a\u8fd9\u4e9b\u4fe1\u606f\u662f\u4e0d\u662f\u4f60\u8fdb\u5165\u5927V\u7684\u9875\u9762\u513f\u4ee5\u540e\u5c31\u8981\u8bfb\u53d6\u8fd9\u5199\u4fe1\u606f\u7684\u554a\uff0c\u90a3\u8fd9\u79cd\u4fe1\u606f\u4e00\u5b9a\u8981\u5b58\u50a8\u5230\u6211\u4eec\u7684redis\u4e2d\uff0c\u56e0\u4e3a\u4ed6\u7684\u8bbf\u95ee\u91cf\u592a\u9ad8\u4e86\uff01\u90a3\u8fd9\u79cd\u6570\u636e\u5e94\u8be5\u600e\u4e48\u5b58\u5462\uff1f\u6211\u4eec\u6765\u4e00\u5757\u513f\u770b\u4e00\u4e0b\u65b9\u6848\uff01 2.4.2 \u89e3\u51b3\u65b9\u6848 \u00b6 \uff081\uff09\u5728redis\u4e2d\u4e3a\u5927V\u7528\u6237\u8bbe\u5b9a\u7528\u6237\u4fe1\u606f\uff0c\u4ee5\u7528\u6237\u4e3b\u952e\u548c\u5c5e\u6027\u503c\u4f5c\u4e3akey\uff0c\u540e\u53f0\u8bbe\u5b9a\u5b9a\u65f6\u5237\u65b0\u7b56\u7565\u5373\u53ef\u3002 eg: user:id:3506728370:fans \u2192 12210947 eg: user:id:3506728370:blogs \u2192 6164 eg: user:id:3506728370:focuses \u2192 83 \uff082\uff09\u4e5f\u53ef\u4ee5\u4f7f\u7528json\u683c\u5f0f\u4fdd\u5b58\u6570\u636e eg: user:id:3506728370 \u2192 {\u201cfans\u201d\uff1a12210947\uff0c\u201cblogs\u201d\uff1a6164\uff0c\u201c focuses \u201d\uff1a83 } \uff083\uff09 key \u7684\u8bbe\u7f6e\u7ea6\u5b9a \u6570\u636e\u5e93\u4e2d\u7684\u70ed\u70b9\u6570\u636ekey\u547d\u540d\u60ef\u4f8b \u8868\u540d \u4e3b\u952e\u540d \u4e3b\u952e\u503c \u5b57\u6bb5\u540d eg1\uff1a order id 29437595 name eg2\uff1a equip id 390472345 type eg3\uff1a news id 202004150 title 2.5 hash\u7684\u57fa\u672c\u64cd\u4f5c \u00b6 \u4e0b\u9762\u6211\u4eec\u6765\u5b66\u4e60\u7b2c\u4e8c\u4e2a\u6570\u636e\u7c7b\u578bhash\u3002 2.5.1 \u6570\u636e\u5b58\u50a8\u7684\u56f0\u60d1 \u00b6 \u5bf9\u8c61\u7c7b\u6570\u636e\u7684\u5b58\u50a8\u5982\u679c\u5177\u6709\u8f83\u9891\u7e41\u7684\u66f4\u65b0\u9700\u6c42\u64cd\u4f5c\u4f1a\u663e\u5f97\u7b28\u91cd\uff01 \u5728\u6b63\u5f0f\u5b66\u4e60\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u770b\u4e00\u4e2a\u5173\u4e8e\u6570\u636e\u5b58\u50a8\u7684\u56f0\u60d1\uff1a \u6bd4\u5982\u8bf4\u524d\u9762\u6211\u4eec\u7528\u4ee5\u4e0a\u5f62\u5f0f\u5b58\u4e86\u6570\u636e\uff0c\u5982\u679c\u6211\u4eec\u7528\u5355\u6761\u53bb\u5b58\u7684\u8bdd\uff0c\u5b83\u5b58\u7684\u6761\u6570\u4f1a\u5f88\u591a\u3002\u4f46\u5982\u679c\u6211\u4eec\u7528json\u683c\u5f0f\uff0c\u5b83\u5b58\u4e00\u6761\u6570\u636e\u5c31\u591f\u4e86\u3002\u95ee\u9898\u6765\u4e86\uff0c\u5047\u5982\u8bf4\u73b0\u5728\u7c89\u4e1d\u6570\u91cf\u53d1\u751f\u53d8\u5316\u4e86\uff0c\u4f60\u8981\u628a\u6574\u4e2a\u503c\u90fd\u6539\u4e86\u3002\u4f46\u662f\u7528\u5355\u6761\u5b58\u7684\u8bdd\u5c31\u4e0d\u5b58\u5728\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f60\u53ea\u9700\u8981\u6539\u5176\u4e2d\u4e00\u4e2a\u5c31\u884c\u4e86\u3002\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5c31\u60f3\uff0c\u6709\u6ca1\u6709\u4e00\u79cd\u65b0\u7684\u5b58\u50a8\u7ed3\u6784\uff0c\u80fd\u5e2e\u6211\u4eec\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\u3002 \u6211\u4eec\u4e00\u5757\u513f\u6765\u5206\u6790\u4e00\u4e0b\uff1a \u5982\u4e0a\u56fe\u6240\u793a\uff1a\u5355\u6761\u7684\u8bdd\u662f\u5bf9\u5e94\u7684\u6570\u636e\u5728\u540e\u9762\u653e\u7740\u3002\u4ed4\u7ec6\u89c2\u5bdf\uff1a\u6211\u4eec\u770b\u5de6\u8fb9\u662f\u4e0d\u662f\u957f\u5f97\u90fd\u4e00\u6a21\u4e00\u6837\u554a\uff0c\u90fd\u662f\u5bf9\u5e94\u7684\u8868\u540d\u3001ID\u7b49\u7684\u4e00\u7cfb\u5217\u7684\u4e1c\u897f\u3002\u6211\u4eec\u53ef\u4ee5\u5c06\u53f3\u8fb9\u7ea2\u6846\u4e2d\u7684\u8fd9\u4e2a\u533a\u57df\u7ed9\u4ed6\u5c01\u8d77\u6765\u3002 \u90a3\u5982\u679c\u8981\u662f\u8fd9\u6837\u7684\u5f62\u5f0f\u7684\u8bdd\uff0c\u5982\u4e0b\u56fe\uff0c\u6211\u4eec\u628a\u5b83\u4e00\u5408\u5e76\uff0c\u5e76\u628a\u53f3\u8fb9\u7684\u4e1c\u897f\u7ed9\u4ed6\u53d8\u6210\u8fd9\u4e2a\u683c\u5f0f\uff0c\u8fd9\u4e0d\u5c31\u884c\u4e86\u5417\uff1f \u8fd9\u4e2a\u56fe\u5176\u5b9e\u5927\u5bb6\u5e76\u4e0d\u964c\u751f\uff0c\u7b2c\u4e00\uff0c\u4f60\u524d\u9762\u5b66\u8fc7\u4e00\u4e2a\u4e1c\u897f\u53ebhashmap\u4e0d\u5c31\u8fd9\u683c\u5f0f\u5417\uff1f\u7b2c\u4e8c\uff0credis\u81ea\u8eab\u4e0d\u4e5f\u662f\u8fd9\u683c\u5f0f\u5417\uff1f\u90a3\u662f\u4ec0\u4e48\u610f\u601d\u5462\uff1f\u6ce8\u610f\uff0c\u8fd9\u5c31\u662f\u6211\u4eec\u8981\u8bb2\u7684\u7b2c\u4e8c\u79cd\u683c\u5f0f\uff0chash\u3002 \u5728\u53f3\u8fb9\u5bf9\u5e94\u7684\u503c\uff0c\u6211\u4eec\u5c31\u5b58\u5177\u4f53\u7684\u503c\uff0c\u90a3\u5de6\u8fb9\u513f\u8fd9\u5c31\u662f\u6211\u4eec\u7684key\u3002\u95ee\u9898\u6765\u4e86\uff0c\u90a3\u4e2d\u95f4\u7684\u8fd9\u4e00\u5757\u53eb\u4ec0\u4e48\u5462\uff1f\u8fd9\u4e2a\u4e1c\u897f\u6211\u4eec\u7ed9\u4ed6\u8d77\u4e2a\u540d\u513f\uff0c\u53eb\u505afield\u5b57\u6bb5\u3002\u90a3\u4e48\u53f3\u8fb9\u513f\u6574\u4f53\u8fd9\u5757\u513f\u7a7a\u95f4\u6211\u4eec\u5c31\u79f0\u4e3ahash\uff0c\u4e5f\u5c31\u662f\u8bf4hash\u662f\u5b58\u4e86\u4e00\u4e2akey value\u7684\u5b58\u50a8\u7a7a\u95f4\u3002 2.5.2 hash \u7c7b\u578b \u00b6 \u65b0\u7684\u5b58\u50a8\u9700\u6c42\uff1a\u5bf9\u4e00\u7cfb\u5217\u5b58\u50a8\u7684\u6570\u636e\u8fdb\u884c\u7f16\u7ec4\uff0c\u65b9\u4fbf\u7ba1\u7406\uff0c\u5178\u578b\u5e94\u7528\u5b58\u50a8\u5bf9\u8c61\u4fe1\u606f \u9700\u8981\u7684\u5b58\u50a8\u7ed3\u6784\uff1a\u4e00\u4e2a\u5b58\u50a8\u7a7a\u95f4\u4fdd\u5b58\u591a\u4e2a\u952e\u503c\u5bf9\u6570\u636e hash\u7c7b\u578b\uff1a\u5e95\u5c42\u4f7f\u7528\u54c8\u5e0c\u8868\u7ed3\u6784\u5b9e\u73b0\u6570\u636e\u5b58\u50a8 \u5982\u4e0a\u56fe\u6240\u793a\uff0c\u8fd9\u79cd\u7ed3\u6784\u53eb\u505ahash\uff0c\u5de6\u8fb9\u4e00\u4e2akey\uff0c\u5bf9\u53f3\u8fb9\u4e00\u4e2a\u5b58\u50a8\u7a7a\u95f4\u3002\u8fd9\u91cc\u8981\u660e\u786e\u4e00\u70b9\uff0c\u53f3\u8fb9\u8fd9\u5757\u513f\u5b58\u50a8\u7a7a\u95f4\u53ebhash\uff0c\u4e5f\u5c31\u662f\u8bf4hash\u662f\u6307\u7684\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\uff0c\u4ed6\u6307\u7684\u4e0d\u662f\u4e00\u4e2a\u6570\u636e\uff0c\u662f\u8fd9\u91cc\u8fb9\u7684\u4e00\u5806\u6570\u636e\uff0c\u90a3\u4e48\u5b83\u5e95\u5c42\u5462\uff0c\u662f\u7528hash\u8868\u7684\u7ed3\u6784\u6765\u5b9e\u73b0\u7684\u3002 \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff1a \u5982\u679cfield\u6570\u91cf\u8f83\u5c11\uff0c\u5b58\u50a8\u7ed3\u6784\u4f18\u5316\u4e3a\u7c7b\u6570\u7ec4\u7ed3\u6784 \u5982\u679cfield\u6570\u91cf\u8f83\u591a\uff0c\u5b58\u50a8\u7ed3\u6784\u4f7f\u7528HashMap\u7ed3\u6784 2.5.3 hash \u7c7b\u578b\u6570\u636e\u7684\u57fa\u672c\u64cd\u4f5c \u00b6 \u6dfb\u52a0/\u4fee\u6539\u6570\u636e hset key field value \u83b7\u53d6\u6570\u636e hget key field hgetall key \u5220\u9664\u6570\u636e hdel key field1 [ field2 ] \u8bbe\u7f6efield\u7684\u503c\uff0c\u5982\u679c\u8be5field\u5b58\u5728\u5219\u4e0d\u505a\u4efb\u4f55\u64cd\u4f5c hsetnx key field value \u6dfb\u52a0/\u4fee\u6539\u591a\u4e2a\u6570\u636e hmset key field1 value1 field2 value2 \u2026 \u83b7\u53d6\u591a\u4e2a\u6570\u636e hmget key field1 field2 \u2026 \u83b7\u53d6\u54c8\u5e0c\u8868\u4e2d\u5b57\u6bb5\u7684\u6570\u91cf hlen key \u83b7\u53d6\u54c8\u5e0c\u8868\u4e2d\u662f\u5426\u5b58\u5728\u6307\u5b9a\u7684\u5b57\u6bb5 hexists key field 2.6 hash\u7684\u62d3\u5c55\u64cd\u4f5c \u00b6 \u5728\u770b\u5b8chash\u7684\u57fa\u672c\u64cd\u4f5c\u540e\uff0c\u6211\u4eec\u518d\u6765\u770b\u4ed6\u7684\u62d3\u5c55\u64cd\u4f5c\uff0c\u4ed6\u7684\u62d3\u5c55\u64cd\u4f5c\u76f8\u5bf9\u6bd4\u8f83\u7b80\u5355\uff1a 2.6.1 hash \u7c7b\u578b\u6570\u636e\u6269\u5c55\u64cd\u4f5c \u00b6 \u83b7\u53d6\u54c8\u5e0c\u8868\u4e2d\u6240\u6709\u7684\u5b57\u6bb5\u540d\u6216\u5b57\u6bb5\u503c hkeys key hvals key \u8bbe\u7f6e\u6307\u5b9a\u5b57\u6bb5\u7684\u6570\u503c\u6570\u636e\u589e\u52a0\u6307\u5b9a\u8303\u56f4\u7684\u503c hincrby key field increment hincrbyfloat key field increment 2.6.2 hash\u7c7b\u578b\u6570\u636e\u64cd\u4f5c\u7684\u6ce8\u610f\u4e8b\u9879 \u00b6 (1)hash\u7c7b\u578b\u4e2dvalue\u53ea\u80fd\u5b58\u50a8\u5b57\u7b26\u4e32\uff0c\u4e0d\u5141\u8bb8\u5b58\u50a8\u5176\u4ed6\u6570\u636e\u7c7b\u578b\uff0c\u4e0d\u5b58\u5728\u5d4c\u5957\u73b0\u8c61\u3002\u5982\u679c\u6570\u636e\u672a\u83b7\u53d6\u5230\uff0c\u5bf9\u5e94\u7684\u503c\u4e3a\uff08nil\uff09\u3002 (2\uff09\u6bcf\u4e2a hash \u53ef\u4ee5\u5b58\u50a8 2^32 - 1 \u4e2a\u952e\u503c\u5bf9 hash\u7c7b\u578b\u5341\u5206\u8d34\u8fd1\u5bf9\u8c61\u7684\u6570\u636e\u5b58\u50a8\u5f62\u5f0f\uff0c\u5e76\u4e14\u53ef\u4ee5\u7075\u6d3b\u6dfb\u52a0\u5220\u9664\u5bf9\u8c61\u5c5e\u6027\u3002\u4f46hash\u8bbe\u8ba1\u521d\u8877\u4e0d\u662f\u4e3a\u4e86\u5b58\u50a8\u5927\u91cf\u5bf9\u8c61\u800c\u8bbe\u8ba1 \u7684\uff0c\u5207\u8bb0\u4e0d\u53ef\u6ee5\u7528\uff0c\u66f4\u4e0d\u53ef\u4ee5\u5c06hash\u4f5c\u4e3a\u5bf9\u8c61\u5217\u8868\u4f7f\u7528\u3002 (3)hgetall \u64cd\u4f5c\u53ef\u4ee5\u83b7\u53d6\u5168\u90e8\u5c5e\u6027\uff0c\u5982\u679c\u5185\u90e8field\u8fc7\u591a\uff0c\u904d\u5386\u6574\u4f53\u6570\u636e\u6548\u7387\u5c31\u5f88\u4f1a\u4f4e\uff0c\u6709\u53ef\u80fd\u6210\u4e3a\u6570\u636e\u8bbf\u95ee\u74f6\u9888\u3002 2.7 hash\u5e94\u7528\u573a\u666f \u00b6 2.7.1 \u5e94\u7528\u573a\u666f \u00b6 \u53cc11\u6d3b\u52a8\u65e5\uff0c\u9500\u552e\u624b\u673a\u5145\u503c\u5361\u7684\u5546\u5bb6\u5bf9\u79fb\u52a8\u3001\u8054\u901a\u3001\u7535\u4fe1\u768430\u5143\u300150\u5143\u3001100\u5143\u5546\u54c1\u63a8\u51fa\u62a2\u8d2d\u6d3b\u52a8\uff0c\u6bcf\u79cd\u5546\u54c1\u62a2\u8d2d\u4e0a\u96501000 \u5f20\u3002 \u4e5f\u5c31\u662f\u5546\u5bb6\u6709\u4e86\uff0c\u5546\u54c1\u6709\u4e86\uff0c\u6570\u91cf\u6709\u4e86\u3002\u6700\u7ec8\u6211\u4eec\u7684\u7528\u6237\u4e70\u4e1c\u897f\u5c31\u662f\u5728\u6539\u53d8\u8fd9\u4e2a\u6570\u91cf\u3002\u90a3\u4f60\u8bf4\u8fd9\u4e2a\u7ed3\u6784\u5e94\u8be5\u600e\u4e48\u5b58\u5462\uff1f\u5bf9\u5e94\u7684\u5546\u5bb6\u7684ID\u4f5c\u4e3akey\uff0c\u7136\u540e\u8fd9\u4e9b\u5145\u503c\u5361\u7684ID\u4f5c\u4e3afield\uff0c\u6700\u540e\u8fd9\u4e9b\u6570\u91cf\u4f5c\u4e3avalue\u3002\u800c\u6211\u4eec\u6240\u8c13\u7684\u64cd\u4f5c\u662f\u5176\u5b9e\u5c31\u662fincrea\u8fd9\u4e2a\u64cd\u4f5c\uff0c\u53ea\u4e0d\u8fc7\u4f60\u4f20\u8d1f\u503c\u5c31\u884c\u4e86\u3002\u770b\u4e00\u770b\u5bf9\u5e94\u7684\u89e3\u51b3\u65b9\u6848\uff1a 2.7.2 \u89e3\u51b3\u65b9\u6848 \u00b6 \u4ee5\u5546\u5bb6id\u4f5c\u4e3akey \u5c06\u53c2\u4e0e\u62a2\u8d2d\u7684\u5546\u54c1id\u4f5c\u4e3afield \u5c06\u53c2\u4e0e\u62a2\u8d2d\u7684\u5546\u54c1\u6570\u91cf\u4f5c\u4e3a\u5bf9\u5e94\u7684value \u62a2\u8d2d\u65f6\u4f7f\u7528\u964d\u503c\u7684\u65b9\u5f0f\u63a7\u5236\u4ea7\u54c1\u6570\u91cf \u6ce8\u610f\uff1a\u5b9e\u9645\u4e1a\u52a1\u4e2d\u8fd8\u6709\u8d85\u5356\u7b49\u5b9e\u9645\u95ee\u9898\uff0c\u8fd9\u91cc\u4e0d\u505a\u8ba8\u8bba 2.8 list\u57fa\u672c\u64cd\u4f5c \u00b6 \u524d\u9762\u6211\u4eec\u5b58\u6570\u636e\u7684\u65f6\u5019\u5462\uff0c\u5355\u4e2a\u6570\u636e\u4e5f\u80fd\u5b58\uff0c\u591a\u4e2a\u6570\u636e\u4e5f\u80fd\u5b58\uff0c\u4f46\u662f\u8fd9\u91cc\u9762\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5b58\u591a\u4e2a\u6570\u636e\u7528hash\u7684\u65f6\u5019\u5b83\u662f\u6ca1\u6709\u987a\u5e8f\u7684\u3002\u6211\u4eec\u5e73\u65f6\u64cd\u4f5c\uff0c\u5b9e\u9645\u4e0a\u6570\u636e\u5f88\u591a\u60c5\u51b5\u4e0b\u90fd\u662f\u6709\u987a\u5e8f\u7684\uff0c\u90a3\u6709\u6ca1\u6709\u4e00\u79cd\u80fd\u591f\u7528\u6765\u5b58\u50a8\u5e26\u6709\u987a\u5e8f\u7684\u8fd9\u79cd\u6570\u636e\u6a21\u578b\u5462\uff0clist\u5c31\u4e13\u95e8\u6765\u5e72\u8fd9\u4e8b\u513f\u3002 2.8.1 list \u7c7b\u578b \u00b6 \u6570\u636e\u5b58\u50a8\u9700\u6c42\uff1a\u5b58\u50a8\u591a\u4e2a\u6570\u636e\uff0c\u5e76\u5bf9\u6570\u636e\u8fdb\u5165\u5b58\u50a8\u7a7a\u95f4\u7684\u987a\u5e8f\u8fdb\u884c\u533a\u5206 \u9700\u8981\u7684\u5b58\u50a8\u7ed3\u6784\uff1a\u4e00\u4e2a\u5b58\u50a8\u7a7a\u95f4\u4fdd\u5b58\u591a\u4e2a\u6570\u636e\uff0c\u4e14\u901a\u8fc7\u6570\u636e\u53ef\u4ee5\u4f53\u73b0\u8fdb\u5165\u987a\u5e8f list\u7c7b\u578b\uff1a\u4fdd\u5b58\u591a\u4e2a\u6570\u636e\uff0c\u5e95\u5c42\u4f7f\u7528\u53cc\u5411\u94fe\u8868\u5b58\u50a8\u7ed3\u6784\u5b9e\u73b0 \u5148\u6765\u901a\u8fc7\u4e00\u5f20\u56fe\uff0c\u56de\u5fc6\u4e00\u4e0b\u987a\u5e8f\u8868\u3001\u94fe\u8868\u3001\u53cc\u5411\u94fe\u8868\u3002 list\u5bf9\u5e94\u7684\u5b58\u50a8\u7ed3\u6784\u662f\u4ec0\u4e48\u5462\uff1f\u91cc\u8fb9\u5b58\u7684\u8fd9\u4e2a\u4e1c\u897f\u662f\u4e2a\u5217\u8868\uff0c\u4ed6\u6709\u4e00\u4e2a\u5bf9\u5e94\u7684\u540d\u79f0\u3002\u5c31\u662fkey\u5b58\u4e00\u4e2alist\u7684\u8fd9\u6837\u7ed3\u6784\u3002\u5bf9\u5e94\u7684\u57fa\u672c\u64cd\u4f5c\uff0c\u4f60\u5176\u5b9e\u662f\u53ef\u4ee5\u60f3\u5230\u7684\u3002 \u6765\u770b\u4e00\u4e0b\uff0c\u56e0\u4e3a\u5b83\u662f\u53cc\u5411\u7684\uff0c\u6240\u4ee5\u4ed6\u5de6\u8fb9\u53f3\u8fb9\u90fd\u80fd\u64cd\u4f5c\uff0c\u5b83\u5bf9\u5e94\u7684\u64cd\u4f5c\u7ed3\u6784\u4e24\u8fb9\u90fd\u80fd\u8fdb\u6570\u636e\u3002\u8fd9\u5c31\u662f\u94fe\u8868\u7684\u4e00\u4e2a\u5b58\u50a8\u7ed3\u6784\u3002\u5f80\u5916\u62ff\u6570\u636e\u7684\u65f6\u5019\u600e\u4e48\u62ff\u5462\uff1f\u901a\u5e38\u662f\u4ece\u4e00\u7aef\u62ff\uff0c\u5f53\u7136\u53e6\u4e00\u7aef\u4e5f\u80fd\u62ff\u3002\u5982\u679c\u4e24\u7aef\u90fd\u80fd\u62ff\u7684\u8bdd\uff0c\u8fd9\u5c31\u662f\u4e2a\u53cc\u7aef\u961f\u5217\uff0c\u4e24\u8fb9\u513f\u90fd\u80fd\u64cd\u4f5c\u3002\u5982\u679c\u53ea\u80fd\u4ece\u4e00\u7aef\u8fdb\u4e00\u7aef\u51fa\uff0c\u8fd9\u4e2a\u6a21\u578b\u54b1\u4eec\u524d\u9762\u4e86\u89e3\u8fc7\uff0c\u53eb\u505a\u6808\u3002 2.8.2 list \u7c7b\u578b\u6570\u636e\u57fa\u672c\u64cd\u4f5c \u00b6 \u6700\u540e\u770b\u4e00\u4e0b\u4ed6\u7684\u57fa\u672c\u64cd\u4f5c \u6dfb\u52a0/\u4fee\u6539\u6570\u636e lpush key value1 [ value2 ] \u2026\u2026 rpush key value1 [ value2 ] \u2026\u2026 \u83b7\u53d6\u6570\u636e lrange key start stop lindex key index llen key \u83b7\u53d6\u5e76\u79fb\u9664\u6570\u636e lpop key rpop key 2.9 list\u6269\u5c55\u64cd\u4f5c \u00b6 2.9.1 list \u7c7b\u578b\u6570\u636e\u6269\u5c55\u64cd\u4f5c \u00b6 \u79fb\u9664\u6307\u5b9a\u6570\u636e lrem key count value \u89c4\u5b9a\u65f6\u95f4\u5185\u83b7\u53d6\u5e76\u79fb\u9664\u6570\u636e blpop key1 [ key2 ] timeout brpop key1 [ key2 ] timeout brpoplpush source destination timeout 2.9.2 list \u7c7b\u578b\u6570\u636e\u64cd\u4f5c\u6ce8\u610f\u4e8b\u9879 \u00b6 \uff081\uff09list\u4e2d\u4fdd\u5b58\u7684\u6570\u636e\u90fd\u662fstring\u7c7b\u578b\u7684\uff0c\u6570\u636e\u603b\u5bb9\u91cf\u662f\u6709\u9650\u7684\uff0c\u6700\u591a2^32 - 1 \u4e2a\u5143\u7d20(4294967295)\u3002 \uff082\uff09list\u5177\u6709\u7d22\u5f15\u7684\u6982\u5ff5\uff0c\u4f46\u662f\u64cd\u4f5c\u6570\u636e\u65f6\u901a\u5e38\u4ee5\u961f\u5217\u7684\u5f62\u5f0f\u8fdb\u884c\u5165\u961f\u51fa\u961f\u64cd\u4f5c\uff0c\u6216\u4ee5\u6808\u7684\u5f62\u5f0f\u8fdb\u884c\u5165\u6808\u51fa\u6808\u64cd\u4f5c \uff083\uff09\u83b7\u53d6\u5168\u90e8\u6570\u636e\u64cd\u4f5c\u7ed3\u675f\u7d22\u5f15\u8bbe\u7f6e\u4e3a-1 \uff084\uff09list\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u5206\u9875\u64cd\u4f5c\uff0c\u901a\u5e38\u7b2c\u4e00\u9875\u7684\u4fe1\u606f\u6765\u81ea\u4e8elist\uff0c\u7b2c2\u9875\u53ca\u66f4\u591a\u7684\u4fe1\u606f\u901a\u8fc7\u6570\u636e\u5e93\u7684\u5f62\u5f0f\u52a0\u8f7d 2.10 list \u5e94\u7528\u573a\u666f \u00b6 2.10.1 \u5e94\u7528\u573a\u666f \u00b6 \u4f01\u4e1a\u8fd0\u8425\u8fc7\u7a0b\u4e2d\uff0c\u7cfb\u7edf\u5c06\u4ea7\u751f\u51fa\u5927\u91cf\u7684\u8fd0\u8425\u6570\u636e\uff0c\u5982\u4f55\u4fdd\u969c\u591a\u53f0\u670d\u52a1\u5668\u64cd\u4f5c\u65e5\u5fd7\u7684\u7edf\u4e00\u987a\u5e8f\u8f93\u51fa\uff1f \u5047\u5982\u73b0\u5728\u4f60\u6709\u591a\u53f0\u670d\u52a1\u5668\uff0c\u6bcf\u4e00\u53f0\u670d\u52a1\u5668\u90fd\u4f1a\u4ea7\u751f\u5b83\u7684\u65e5\u5fd7\uff0c\u5047\u8bbe\u4f60\u662f\u4e00\u4e2a\u8fd0\u7ef4\u4eba\u5458\uff0c\u4f60\u60f3\u770b\u5b83\u7684\u64cd\u4f5c\u65e5\u5fd7\uff0c\u4f60\u600e\u4e48\u770b\u5462\uff1f\u6253\u5f00A\u673a\u5668\u7684\u65e5\u5fd7\u770b\u4e00\u770b\uff0c\u6253\u5f00B\u673a\u5668\u7684\u65e5\u5fd7\u518d\u770b\u4e00\u770b\u5417\uff1f\u8fd9\u6837\u7684\u8bdd\u4f60\u4f1a\u53ef\u80fd\u4f1a\u75af\u6389\u7684\uff01\u56e0\u4e3a\u5de6\u8fb9\u770b\u7684\u6709\u53ef\u80fd\u5b83\u7684\u65f6\u95f4\u662f11:01\uff0c\u53f3\u8fb911:02\uff0c\u7136\u540e\u518d\u770b\u5de6\u8fb911:03\uff0c\u5b83\u4eec\u672c\u8eab\u662f\u8fde\u7eed\u7684\uff0c\u4f46\u662f\u4f60\u5728\u770b\u7684\u65f6\u5019\u5c31\u5206\u6210\u56db\u4e2a\u6587\u4ef6\u4e86\uff0c\u8fd9\u4e2a\u65f6\u5019\u4f60\u770b\u8d77\u6765\u5c31\u4f1a\u5f88\u9ebb\u70e6\u3002\u80fd\u4e0d\u80fd\u628a\u4ed6\u4eec\u5408\u5e76\u5462\uff1f\u7b54\u6848\u662f\u53ef\u4ee5\u7684\uff01\u600e\u4e48\u505a\u5462\uff1f\u5efa\u7acb\u8d77redis\u670d\u52a1\u5668\u3002\u5f53\u4ed6\u4eec\u9700\u8981\u8bb0\u65e5\u5fd7\u7684\u65f6\u5019\uff0c\u8bb0\u5728\u54ea\u513f,\u5168\u90e8\u53d1\u7ed9redis\u3002\u7b49\u5230\u4f60\u60f3\u770b\u7684\u65f6\u5019\uff0c\u901a\u8fc7\u670d\u52a1\u5668\u8bbf\u95eeredis\u83b7\u53d6\u65e5\u5fd7\u3002\u7136\u540e\u5f97\u5230\u4ee5\u540e\uff0c\u5c31\u4f1a\u5f97\u5230\u4e00\u4e2a\u5b8c\u6574\u7684\u65e5\u5fd7\u4fe1\u606f\u3002\u90a3\u4e48\u8fd9\u91cc\u9762\u5c31\u53ef\u4ee5\u83b7\u53d6\u5230\u5b8c\u6574\u7684\u65e5\u5fd7\u4e86\uff0c\u4f9d\u9760\u4ec0\u4e48\u6765\u5b9e\u73b0\u5462\uff1f\u5c31\u4f9d\u9760\u6211\u4eec\u7684list\u7684\u6a21\u578b\u7684\u987a\u5e8f\u6765\u5b9e\u73b0\u3002\u8fdb\u6765\u4e00\u7ec4\u6570\u636e\u5c31\u5f80\u91cc\u52a0\uff0c\u8c01\u5148\u8fdb\u6765\u8c01\u5148\u52a0\u8fdb\u53bb\uff0c\u5b83\u662f\u6709\u4e00\u5b9a\u7684\u987a\u5e8f\u7684\u3002 2.10.2 \u89e3\u51b3\u65b9\u6848 \u00b6 \u4f9d\u8d56list\u7684\u6570\u636e\u5177\u6709\u987a\u5e8f\u7684\u7279\u5f81\u5bf9\u4fe1\u606f\u8fdb\u884c\u7ba1\u7406 \u4f7f\u7528\u961f\u5217\u6a21\u578b\u89e3\u51b3\u591a\u8def\u4fe1\u606f\u6c47\u603b\u5408\u5e76\u7684\u95ee\u9898 \u4f7f\u7528\u6808\u6a21\u578b\u89e3\u51b3\u6700\u65b0\u6d88\u606f\u7684\u95ee\u9898 2.11 set \u57fa\u672c\u64cd\u4f5c \u00b6 2.11.1 set\u7c7b\u578b \u00b6 \u65b0\u7684\u5b58\u50a8\u9700\u6c42\uff1a\u5b58\u50a8\u5927\u91cf\u7684\u6570\u636e\uff0c\u5728\u67e5\u8be2\u65b9\u9762\u63d0\u4f9b\u66f4\u9ad8\u7684\u6548\u7387 \u9700\u8981\u7684\u5b58\u50a8\u7ed3\u6784\uff1a\u80fd\u591f\u4fdd\u5b58\u5927\u91cf\u7684\u6570\u636e\uff0c\u9ad8\u6548\u7684\u5185\u90e8\u5b58\u50a8\u673a\u5236\uff0c\u4fbf\u4e8e\u67e5\u8be2 set\u7c7b\u578b\uff1a\u4e0ehash\u5b58\u50a8\u7ed3\u6784\u5b8c\u5168\u76f8\u540c\uff0c\u4ec5\u5b58\u50a8\u952e\uff0c\u4e0d\u5b58\u50a8\u503c\uff08nil\uff09\uff0c\u5e76\u4e14\u503c\u662f\u4e0d\u5141\u8bb8\u91cd\u590d\u7684 \u901a\u8fc7\u8fd9\u4e2a\u540d\u79f0\uff0c\u5927\u5bb6\u4e5f\u57fa\u672c\u4e0a\u80fd\u591f\u8ba4\u8bc6\u5230\u548c\u6211\u4eecJava\u4e2d\u7684set\u5b8c\u5168\u4e00\u6837\u3002\u6211\u4eec\u73b0\u5728\u8981\u5b58\u50a8\u5927\u91cf\u7684\u6570\u636e\uff0c\u5e76\u4e14\u8981\u6c42\u63d0\u9ad8\u5b83\u7684\u67e5\u8be2\u6548\u7387\u3002\u7528list\u8fd9\u79cd\u94fe\u8868\u5f62\u5f0f\uff0c\u5b83\u7684\u67e5\u8be2\u6548\u7387\u662f\u4e0d\u9ad8\u7684\uff0c\u90a3\u600e\u4e48\u529e\u5462\uff1f\u8fd9\u65f6\u5019\u6211\u4eec\u5c31\u60f3\uff0c\u6709\u6ca1\u6709\u9ad8\u6548\u7684\u5b58\u50a8\u673a\u5236\u3002\u5176\u5b9e\u524d\u9762\u54b1\u8bb2Java\u7684\u65f6\u5019\u8bf4\u8fc7hash\u8868\u7684\u7ed3\u6784\u5c31\u975e\u5e38\u7684\u597d\uff0c\u4f46\u662f\u8fd9\u91cc\u8fb9\u6211\u4eec\u5df2\u7ecf\u6709hash\u4e86\uff0c\u4ed6\u505a\u4e86\u8fd9\u4e48\u4e00\u4e2a\u8bbe\u5b9a\uff0c\u5e72\u561b\u5462\uff0c\u4ed6\u628ahash\u7684\u5b58\u50a8\u7a7a\u95f4\u7ed9\u6539\u4e00\u4e0b\uff0c\u53f3\u8fb9\u4f60\u539f\u6765\u5b58\u6570\u636e\u6539\u6389,\u5168\u90e8\u5b58\u7a7a\uff0c\u90a3\u4f60\u8bf4\u6570\u636e\u653e\u54ea\u513f\u4e86\uff1f\u653e\u5230\u539f\u6765\u7684filed\u7684\u4f4d\u7f6e\uff0c\u4e5f\u5c31\u5728\u8fd9\u91cc\u8fb9\u5b58\u771f\u6b63\u7684\u503c\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6a21\u578b\u5c31\u662f\u6211\u4eec\u7684set \u6a21\u578b\u3002 set\u7c7b\u578b\uff1a\u4e0ehash\u5b58\u50a8\u7ed3\u6784\u5b8c\u5168\u76f8\u540c\uff0c\u4ec5\u5b58\u50a8\u952e\uff0c\u4e0d\u5b58\u50a8\u503c\uff08nil\uff09\uff0c\u5e76\u4e14\u503c\u662f\u4e0d\u5141\u8bb8\u91cd\u590d\u7684\u3002 \u770b\u4e00\u4e0b\u5b83\u7684\u6574\u4e2a\u7ed3\u6784\uff1a 2.11.2 set\u7c7b\u578b\u6570\u636e\u7684\u57fa\u672c\u64cd\u4f5c \u00b6 \u6dfb\u52a0\u6570\u636e sadd key member1 [ member2 ] \u83b7\u53d6\u5168\u90e8\u6570\u636e smembers key \u5220\u9664\u6570\u636e srem key member1 [ member2 ] \u83b7\u53d6\u96c6\u5408\u6570\u636e\u603b\u91cf scard key \u5224\u65ad\u96c6\u5408\u4e2d\u662f\u5426\u5305\u542b\u6307\u5b9a\u6570\u636e sismember key member \u968f\u673a\u83b7\u53d6\u96c6\u5408\u4e2d\u6307\u5b9a\u6570\u91cf\u7684\u6570\u636e srandmember key [ count ] \u968f\u673a\u83b7\u53d6\u96c6\u4e2d\u7684\u67d0\u4e2a\u6570\u636e\u5e76\u5c06\u8be5\u6570\u636e\u79fb\u9664\u96c6\u5408 spop key [ count ] 2.12 set \u7c7b\u578b\u6570\u636e\u7684\u6269\u5c55\u64cd\u4f5c \u00b6 2.12.1 set \u7c7b\u578b\u6570\u636e\u7684\u6269\u5c55\u64cd\u4f5c \u00b6 \u6c42\u4e24\u4e2a\u96c6\u5408\u7684\u4ea4\u3001\u5e76\u3001\u5dee\u96c6 sinter key1 [key2 \u2026] sunion key1 [key2 \u2026] sdiff key1 [key2 \u2026] \u6c42\u4e24\u4e2a\u96c6\u5408\u7684\u4ea4\u3001\u5e76\u3001\u5dee\u96c6\u5e76\u5b58\u50a8\u5230\u6307\u5b9a\u96c6\u5408\u4e2d sinterstore destination key1 [key2 \u2026] sunionstore destination key1 [key2 \u2026] sdiffstore destination key1 [key2 \u2026] \u5c06\u6307\u5b9a\u6570\u636e\u4ece\u539f\u59cb\u96c6\u5408\u4e2d\u79fb\u52a8\u5230\u76ee\u6807\u96c6\u5408\u4e2d smove source destination member \u901a\u8fc7\u4e0b\u9762\u4e00\u5f20\u56fe\u56de\u5fc6\u4e00\u4e0b\u4ea4\u3001\u5e76\u3001\u5dee 2.12.2 set \u7c7b\u578b\u6570\u636e\u64cd\u4f5c\u7684\u6ce8\u610f\u4e8b\u9879 \u00b6 set \u7c7b\u578b\u4e0d\u5141\u8bb8\u6570\u636e\u91cd\u590d\uff0c\u5982\u679c\u6dfb\u52a0\u7684\u6570\u636e\u5728 set \u4e2d\u5df2\u7ecf\u5b58\u5728\uff0c\u5c06\u53ea\u4fdd\u7559\u4e00\u4efd\u3002 set \u867d\u7136\u4e0ehash\u7684\u5b58\u50a8\u7ed3\u6784\u76f8\u540c\uff0c\u4f46\u662f\u65e0\u6cd5\u542f\u7528hash\u4e2d\u5b58\u50a8\u503c\u7684\u7a7a\u95f4\u3002 2.13 set\u5e94\u7528\u573a\u666f \u00b6 2.13.1 set\u5e94\u7528\u573a\u666f \u00b6 \uff081\uff09\u9ed1\u540d\u5355 \u8d44\u8baf\u7c7b\u4fe1\u606f\u7c7b\u7f51\u7ad9\u8ffd\u6c42\u9ad8\u8bbf\u95ee\u91cf\uff0c\u4f46\u662f\u7531\u4e8e\u5176\u4fe1\u606f\u7684\u4ef7\u503c\uff0c\u5f80\u5f80\u5bb9\u6613\u88ab\u4e0d\u6cd5\u5206\u5b50\u5229\u7528\uff0c\u901a\u8fc7\u722c\u866b\u6280\u672f\uff0c \u5feb\u901f\u83b7\u53d6\u4fe1\u606f\uff0c\u4e2a\u522b\u7279\u79cd\u884c\u4e1a\u7f51\u7ad9\u4fe1\u606f\u901a\u8fc7\u722c\u866b\u83b7\u53d6\u5206\u6790\u540e\uff0c\u53ef\u4ee5\u8f6c\u6362\u6210\u5546\u4e1a\u673a\u5bc6\u8fdb\u884c\u51fa\u552e\u3002\u4f8b\u5982\u7b2c\u4e09\u65b9\u706b \u8f66\u7968\u3001\u673a\u7968\u3001\u9152\u5e97\u5237\u7968\u4ee3\u8d2d\u8f6f\u4ef6\uff0c\u7535\u5546\u5237\u8bc4\u8bba\u3001\u5237\u597d\u8bc4\u3002 \u540c\u65f6\u722c\u866b\u5e26\u6765\u7684\u4f2a\u6d41\u91cf\u4e5f\u4f1a\u7ed9\u7ecf\u8425\u8005\u5e26\u6765\u9519\u89c9\uff0c\u4ea7\u751f\u9519\u8bef\u7684\u51b3\u7b56\uff0c\u6709\u6548\u907f\u514d\u7f51\u7ad9\u88ab\u722c\u866b\u53cd\u590d\u722c\u53d6\u6210\u4e3a\u6bcf\u4e2a\u7f51\u7ad9\u90fd\u8981\u8003\u8651\u7684\u57fa\u672c\u95ee\u9898\u3002\u5728\u57fa\u4e8e\u6280\u672f\u5c42\u9762\u533a\u5206\u51fa\u722c\u866b\u7528\u6237\u540e\uff0c\u9700\u8981\u5c06\u6b64\u7c7b\u7528\u6237\u8fdb\u884c\u6709\u6548\u7684\u5c4f\u853d\uff0c\u8fd9\u5c31\u662f\u9ed1\u540d\u5355\u7684\u5178\u578b\u5e94\u7528\u3002 ps:\u4e0d\u662f\u8bf4\u722c\u866b\u4e00\u5b9a\u505a\u6467\u6bc1\u6027\u7684\u5de5\u4f5c\uff0c\u6709\u4e9b\u5c0f\u578b\u7f51\u7ad9\u9700\u8981\u722c\u866b\u4e3a\u5176\u5e26\u6765\u4e00\u4e9b\u6d41\u91cf\u3002 \uff082\uff09\u767d\u540d\u5355 \u5bf9\u4e8e\u5b89\u5168\u6027\u66f4\u9ad8\u7684\u5e94\u7528\u8bbf\u95ee\uff0c\u4ec5\u4ec5\u9760\u9ed1\u540d\u5355\u662f\u4e0d\u80fd\u89e3\u51b3\u5b89\u5168\u95ee\u9898\u7684\uff0c\u6b64\u65f6\u9700\u8981\u8bbe\u5b9a\u53ef\u8bbf\u95ee\u7684\u7528\u6237\u7fa4\u4f53\uff0c \u4f9d\u8d56\u767d\u540d\u5355\u505a\u66f4\u4e3a\u82db\u523b\u7684\u8bbf\u95ee\u9a8c\u8bc1\u3002 2.13.2 \u89e3\u51b3\u65b9\u6848 \u00b6 \u57fa\u4e8e\u7ecf\u8425\u6218\u7565\u8bbe\u5b9a\u95ee\u9898\u7528\u6237\u53d1\u73b0\u3001\u9274\u522b\u89c4\u5219 \u5468\u671f\u6027\u66f4\u65b0\u6ee1\u8db3\u89c4\u5219\u7684\u7528\u6237\u9ed1\u540d\u5355\uff0c\u52a0\u5165set\u96c6\u5408 \u7528\u6237\u884c\u4e3a\u4fe1\u606f\u8fbe\u5230\u540e\u4e0e\u9ed1\u540d\u5355\u8fdb\u884c\u6bd4\u5bf9\uff0c\u786e\u8ba4\u884c\u4e3a\u53bb\u5411 \u9ed1\u540d\u5355\u8fc7\u6ee4IP\u5730\u5740\uff1a\u5e94\u7528\u4e8e\u5f00\u653e\u6e38\u5ba2\u8bbf\u95ee\u6743\u9650\u7684\u4fe1\u606f\u6e90 \u9ed1\u540d\u5355\u8fc7\u6ee4\u8bbe\u5907\u4fe1\u606f\uff1a\u5e94\u7528\u4e8e\u9650\u5b9a\u8bbf\u95ee\u8bbe\u5907\u7684\u4fe1\u606f\u6e90 \u9ed1\u540d\u5355\u8fc7\u6ee4\u7528\u6237\uff1a\u5e94\u7528\u4e8e\u57fa\u4e8e\u8bbf\u95ee\u6743\u9650\u7684\u4fe1\u606f\u6e90 2.14 \u5b9e\u8df5\u6848\u4f8b \u00b6 2.14.1\u4e1a\u52a1\u573a\u666f \u00b6 \u4f7f\u7528\u5fae\u4fe1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5f53\u5fae\u4fe1\u63a5\u6536\u6d88\u606f\u540e\uff0c\u4f1a\u9ed8\u8ba4\u5c06\u6700\u8fd1\u63a5\u6536\u7684\u6d88\u606f\u7f6e\u9876\uff0c\u5f53\u591a\u4e2a\u597d\u53cb\u53ca\u5173\u6ce8\u7684\u8ba2\u9605\u53f7\u540c\u65f6\u53d1 \u9001\u6d88\u606f\u65f6\uff0c\u8be5\u6392\u5e8f\u4f1a\u4e0d\u505c\u7684\u8fdb\u884c\u4ea4\u66ff\u3002\u540c\u65f6\u8fd8\u53ef\u4ee5\u5c06\u91cd\u8981\u7684\u4f1a\u8bdd\u8bbe\u7f6e\u4e3a\u7f6e\u9876\u3002\u4e00\u65e6\u7528\u6237\u79bb\u7ebf\u540e\uff0c\u518d\u6b21\u6253\u5f00\u5fae\u4fe1\u65f6\uff0c\u6d88\u606f\u8be5\u6309\u7167\u4ec0\u4e48\u6837\u7684\u987a\u5e8f\u663e\u793a\u3002 \u6211\u4eec\u5206\u6790\u4e00\u4e0b\uff1a 100\u8fd9\u53f0\u624b\u673a\u4ee3\u8868\u4f60\u3002\u800c200\u3001300\u3001400\u8fd9\u4e09\u53f0\u4ee3\u8868\u4f60\u597d\u53cb\u7684\u624b\u673a\u3002\u5728\u8fd9\u91cc\u6709\u4e00\u4e9b\u4e1c\u897f\u9700\u8981\u4ea4\u4ee3\u4e00\u4e0b\uff0c\u56e0\u4e3a\u6211\u4eec\u6bcf\u4e2a\u4eba\u7684\u90fd\u4f1a\u5bf9\u81ea\u5df1\u7684\u5fae\u4fe1\u4e2d\u7684\u4e00\u4e9b\u6bd4\u8f83\u91cd\u8981\u7684\u4eba\u8bbe\u7f6e\u4f1a\u8bdd\u7f6e\u9876\uff0c\u5c06\u4ed6\u7684\u90a3\u6761\u5bf9\u8bdd\u653e\u5728\u6700\u4e0a\u9762\u3002\u6211\u4eec\u5047\u5b9a\u8fd9\u4e2a\u4eba\u6709\u4e24\u4e2a\u4f1a\u8bdd\u7f6e\u9876\u7684\u597d\u53cb\uff0c\u5206\u522b\u662f400\u548c500\uff0c\u800c\u8fd9\u91cc\u8fb9\u5c31\u5305\u542b400. \u4e0b\u9762\u5462\uff0c\u6211\u4eec\u5c31\u6765\u53d1\u8fd9\u4e2a\u6d88\u606f\uff0c\u7b2c\u4e00\u4e2a\u53d1\u6d88\u606f\u7684\u662f300\uff0c\u4ed6\u53d1\u4e86\u4e2a\u6d88\u606f\u7ed9100\u3002\u53d1\u5b8c\u4ee5\u540e\uff0c\u8fd9\u4e2a\u4e1c\u897f\u5e94\u8be5\u600e\u4e48\u5b58\u50a8\u5462\uff1f\u5728\u8fd9\u91cc\u9762\u4e00\u5b9a\u8981\u5206\u5f00\uff0c\u8bb0\u5f55\u7f6e\u9876\u7684\u8fd9\u4e9b\u4eba\u7684\u4f1a\u8bdd\uff0c\u5bf9\u5e94\u7684\u4f1a\u8bdd\u663e\u793a\u987a\u5e8f\u548c\u975e\u7f6e\u9876\u7684\u4e00\u5b9a\u8981\u5206\u4e24\u3002 \u8fd9\u91cc\u9762\u6211\u4eec\u521b\u5efa\u4e24\u4e2a\u6a21\u578b\uff0c\u4e00\u4e2a\u662f\u666e\u901a\u7684\uff0c\u4e00\u4e2a\u662f\u7f6e\u9876\u7684\uff0c\u800c\u4e0a\u9762\u7684\u8fd9\u4e2a\u7f6e\u9876\u7684\u7528\u6237\u5462\uff0c\u6211\u4eec\u7528set\u6765\u5b58\u50a8\uff0c\u56e0\u4e3a\u4e0d\u91cd\u590d\u3002\u800c\u4e0b\u9762\u8fd9\u4e9b\u56e0\u4e3a\u6709\u987a\u5e8f\uff0c\u5f88\u5bb9\u6613\u60f3\u5230\u7528list\u53bb\u5b58\u50a8,\u4e0d\u7136\u4f60\u600e\u4e48\u8868\u8fbe\u987a\u5e8f\u5462\uff1f \u90a3\u5f53300\u53d1\u7ed9\u6d88\u606f\u7ed9100\u4ee5\u540e\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5148\u5224\u5b9a\u4f60\u5728\u7f6e\u9876\u4eba\u7fa4\u4e2d\u5417\uff1f\u4e0d\u5728,\u90a3\u597d\uff0c300\u7684\u6d88\u606f\u5bf9\u5e94\u7684\u987a\u5e8f\u5c31\u5e94\u8be5\u653e\u5728\u666e\u901a\u7684\u5217\u8868\u91cc\u8fb9\u3002\u800c\u5728\u8fd9\u91cc\u8fb9\uff0c\u6211\u4eec\u628a300\u52a0\u8fdb\u53bb\u3002\u7b2c\u4e00\u4e2a\u6570\u636e\u4e5f\u5c31\u662f\u73b0\u5728300\u3002 \u63a5\u4e0b\u6765400\uff0c\u53d1\u4e86\u4e2a\u6d88\u606f\u3002\u5224\u65ad\u4e00\u4e0b\uff0c\u4ed6\u662f\u9700\u8981\u7f6e\u9876\u7684\uff0c\u6240\u4ee5400\u5c06\u8fdb\u5165list\u7684\u7f6e\u9876\u91cc\u8fb9\u653e\u7740\u3002\u5f53\u524d\u8fd8\u6ca1\u6709\u7279\u6b8a\u7684\u5730\u65b9\u3002 \u518d\u6765200\u53d1\u6d88\u606f\u4e86\uff0c\u548c\u521a\u624d\u7684\u5224\u5b9a\u65b9\u6cd5\u4e00\u6837\uff0c\u5148\u770b\u5728\u4e0d\u5728\u7f6e\u9876\u91cc\uff0c\u4e0d\u5728\u7684\u8bdd\u8fdb\u666e\u901a\uff0c\u7136\u540e\u5728\u666e\u901a\u91cc\u8fb9\u628a200\u52a0\u5165\u5c31\u884c\u4e86\uff0cOK\uff0c\u5230\u8fd9\u91cc\u76ee\u524d\u8fd8\u6ca1\u6709\u987a\u5e8f\u53d8\u5316\u3002 \u63a5\u4e0b\u6765200\u53c8\u53d1\u6d88\u606f\u8fc7\u6765\uff0c\u540c\u4e00\u4e2a\u4eba\u7ed9\u4f60\u8fde\u53d1\u4e86\u4e24\u6761\uff0c\u90a3\u8fd9\u4e2a\u65f6\u5019200\u7684\u6d88\u606f\u5230\u8fbe\u4ee5\u540e\uff0c\u5148\u5224\u65ad\u662f\u5426\u5728\u7f6e\u9876\u8303\u56f4\uff0c\u4e0d\u5728\uff0c\u63a5\u4e0b\u6765\u4ed6\u8981\u653e\u5728list\u666e\u901a\u4e2d\uff0c\u8fd9\u91cc\u4f60\u8981\u6ce8\u610f\u4e00\u70b9\uff0c\u56e0\u4e3a\u8fd9\u91cc\u8fb9\u5df2\u7ecf\u6709200\uff0c\u6240\u4ee5\u8fdb\u6765\u4ee5\u540e\u5148\u5e72\u4e00\u4ef6\u4e8b\u513f\uff0c\u628a200\u6740\u6389\uff0c\u6ca1\u6709200\uff0c\u7136\u540e\u518d\u628a200\u52a0\u8fdb\u6765\uff0c\u90a3\u4f60\u60f3\u4e00\u4e0b\uff0c\u73b0\u5728\u8fd9\u4e2a\u4f4d\u7f6e\u987a\u5e8f\u662f\u4ec0\u4e48\u5462\uff1f\u5c31\u662f\u65b0\u7684\u90fd\u5728\u53f3\u8fb9\uff0c\u5bf9\u4e0d\u5bf9\uff1f \u8fd8\u8bb0\u5f97\u6211\u4eec\u8bf4list\u6a21\u578b\uff0c\u5982\u679c\u662f\u4e00\u4e2a\u53cc\u7aef\u961f\u5217\uff0c\u5b83\u662f\u53ef\u4ee5\u4e24\u5934\u8fdb\u4e24\u5934\u51fa\u3002\u5f53\u7136\u6211\u4eec\u53cc\u7aef\u4ece\u4e00\u5934\u8fdb\u4e00\u5934\u51fa\uff0c\u8fd9\u5c31\u662f\u6808\u6a21\u578b\uff0c\u73b0\u5728\u54b1\u4eec\u8fd0\u7528\u7684\u5c31\u662flist\u6a21\u578b\u4e2d\u7684\u6808\u6a21\u578b\u3002 \u73b0\u5728300\u53d1\u6d88\u606f\uff0c\u5148\u5224\u5b9a\u4ed6\u5728\u4e0d\u5728\uff0c\u4e0d\u5728\uff0c\u7528\u666e\u901a\u7684\u961f\u5217\uff0c\u63a5\u4e0b\u6765\u6309\u7167\u521a\u624d\u7684\u64cd\u4f5c\uff0c\u4e0d\u7ba1\u4f60\u91cc\u8fb9\u539f\u6765\u6709\u6ca1\u6709300\uff0c\u6211\u5148\u628a300\u6740\u6389\uff0c\u6ca1\u4e86\uff0c200\u81ea\u7136\u5c31\u586b\u5230300\u7684\u4f4d\u7f6e\u4e86\uff0c\u4ed6\u73b0\u5728\u662flist\u91cc\u9762\u552f\u4e00\u4e00\u4e2a\uff0c\u7136\u540e\u8ba9300\u8fdb\u6765\uff0c\u6ce8\u610f\u662f\u4ece\u53f3\u4fa7\u8fdb\u6765\u7684\uff0c\u90a3\u4e48\u73b0\u5728300\u5c31\u662f\u6700\u65b0\u7684\u3002 \u90a3\u4e48\u5230\u8fd9\u91cc\u5462\uff0c\u6211\u4eec\u8ba9100\u6765\u8bfb\u53d6\u6d88\u606f\u3002\u4f60\u89c9\u5f97\u8fd9\u4e2a\u6d88\u606f\u987a\u5e8f\u5e94\u8be5\u662f\u4ec0\u4e48\u6837\u7684\uff1f\u9996\u5148\u7f6e\u9876\u7684400\u6709\u4e00\u4e2a\uff0c\u4ed6\u8dd1\u5728\u6700\u4e0a\u9762\uff0c\u7136\u540elist\u666e\u901a\u5982\u679c\u51fa\u6765\u7684\u8bdd\uff0c300\u662f\u6700\u65b0\u7684\u6d88\u606f\uff0c\u800c200\u5728\u4ed6\u540e\u9762\u7684\u3002\u7528\u8fd9\u79cd\u5f62\u5f0f\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u505a\u51fa\u6765\u4ed6\u7684\u6d88\u606f\u987a\u5e8f\u6765\u3002 2.14.2 \u89e3\u51b3\u65b9\u6848 \u00b6 \u770b\u4e00\u4e0b\u6700\u7ec8\u7684\u89e3\u51b3\u65b9\u6848\uff1a \u4f9d\u8d56list\u7684\u6570\u636e\u5177\u6709\u987a\u5e8f\u7684\u7279\u5f81\u5bf9\u6d88\u606f\u8fdb\u884c\u7ba1\u7406\uff0c\u5c06list\u7ed3\u6784\u4f5c\u4e3a\u6808\u4f7f\u7528 \u7f6e\u9876\u4e0e\u666e\u901a\u4f1a\u8bdd\u5206\u522b\u521b\u5efa\u72ec\u7acb\u7684list\u5206\u522b\u7ba1\u7406 \u5f53\u67d0\u4e2alist\u4e2d\u63a5\u6536\u5230\u7528\u6237\u6d88\u606f\u540e\uff0c\u5c06\u6d88\u606f\u53d1\u9001\u65b9\u7684id\u4ecelist\u7684\u4e00\u4fa7\u52a0\u5165list\uff08\u6b64\u5904\u8bbe\u5b9a\u5de6\u4fa7\uff09 \u591a\u4e2a\u76f8\u540cid\u53d1\u51fa\u7684\u6d88\u606f\u53cd\u590d\u5165\u6808\u4f1a\u51fa\u73b0\u95ee\u9898\uff0c\u5728\u5165\u6808\u4e4b\u524d\u65e0\u8bba\u662f\u5426\u5177\u6709\u5f53\u524did\u5bf9\u5e94\u7684\u6d88\u606f\uff0c\u5148\u5220\u9664\u5bf9\u5e94id \u63a8\u9001\u6d88\u606f\u65f6\u5148\u63a8\u9001\u7f6e\u9876\u4f1a\u8bddlist\uff0c\u518d\u63a8\u9001\u666e\u901a\u4f1a\u8bddlist\uff0c\u63a8\u9001\u5b8c\u6210\u7684list\u6e05\u9664\u6240\u6709\u6570\u636e \u6d88\u606f\u7684\u6570\u91cf\uff0c\u4e5f\u5c31\u662f\u5fae\u4fe1\u7528\u6237\u5bf9\u8bdd\u6570\u91cf\u91c7\u7528\u8ba1\u6570\u5668\u7684\u601d\u60f3\u53e6\u884c\u8bb0\u5f55\uff0c\u4f34\u968flist\u64cd\u4f5c\u540c\u6b65\u66f4\u65b0 2.14.3 \u6570\u636e\u7c7b\u578b\u603b\u7ed3 \u00b6 \u603b\u7ed3\u4e00\u4e0b\uff0c\u5728\u6574\u4e2a\u6570\u636e\u7c7b\u578b\u7684\u90e8\u5206\uff0c\u6211\u4eec\u4e3b\u8981\u4ecb\u7ecd\u4e86\u54ea\u4e9b\u5185\u5bb9\uff1a \u9996\u5148\u6211\u4eec\u4e86\u89e3\u4e86\u4e00\u4e0b\u6570\u636e\u7c7b\u578b\uff0c\u63a5\u4e0b\u6765\u9488\u5bf9\u7740\u6211\u4eec\u8981\u5b66\u4e60\u7684\u6570\u636e\u7c7b\u578b\uff0c\u8fdb\u884c\u9010\u4e00\u8bb2\u89e3\u4e86string\u3001hash\u3001list\u3001set\u7b49\uff0c\u6700\u540e\u901a\u8fc7\u4e00\u4e2a\u6848\u4f8b\u603b\u7ed3\u4e86\u4e00\u4e0b\u524d\u9762\u7684\u6570\u636e\u7c7b\u578b\u7684\u4f7f\u7528\u573a\u666f\u3002 3. \u5e38\u7528\u6307\u4ee4 \u00b6 \u5728\u8fd9\u90e8\u5206\u4e2d\u5462\uff0c\u6211\u4eec\u5bb6\u5b66\u4e60\u4e24\u4e2a\u77e5\u8bc6\uff0c\u7b2c\u4e00\u4e2a\u662fkey\u7684\u5e38\u7528\u6307\u4ee4\uff0c\u7b2c\u4e8c\u4e2a\u662f\u6570\u636e\u5e93\u7684\u5e38\u7528\u6307\u4ee4\u3002\u548c\u524d\u9762\u6211\u4eec\u5b66\u6570\u636e\u7c7b\u578b\u505a\u4e00\u4e0b\u533a\u5206\uff0c\u524d\u9762\u4f60\u5b66\u7684\u90a3\u4e9b\u6307\u4ee4\u5462\uff0c\u90fd\u662f\u9488\u5bf9\u67d0\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\u64cd\u4f5c\u7684\uff0c\u73b0\u5728\u5b66\u7684\u90fd\u662f\u5bf9\u6240\u6709\u7684\u64cd\u4f5c\u7684\uff0c\u6765\u770b\u4e00\u4e0b\uff0c\u6211\u4eec\u5728\u5b66\u4e60Key\u7684\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5148\u60f3\u4e00\u4e0b\u7684\u64cd\u4f5c\u6211\u4eec\u5e94\u8be5\u5b66\u54ea\u4e9b\u4e1c\u897f: 3.1 key \u64cd\u4f5c\u5206\u6790 \u00b6 3.1.1 key\u5e94\u8be5\u8bbe\u8ba1\u54ea\u4e9b\u64cd\u4f5c\uff1f \u00b6 key\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u901a\u8fc7key\u83b7\u53d6redis\u4e2d\u4fdd\u5b58\u7684\u6570\u636e \u5bf9\u4e8ekey\u81ea\u8eab\u72b6\u6001\u7684\u76f8\u5173\u64cd\u4f5c\uff0c\u4f8b\u5982\uff1a\u5220\u9664\uff0c\u5224\u5b9a\u5b58\u5728\uff0c\u83b7\u53d6\u7c7b\u578b\u7b49 \u5bf9\u4e8ekey\u6709\u6548\u6027\u63a7\u5236\u76f8\u5173\u64cd\u4f5c\uff0c\u4f8b\u5982\uff1a\u6709\u6548\u671f\u8bbe\u5b9a\uff0c\u5224\u5b9a\u662f\u5426\u6709\u6548\uff0c\u6709\u6548\u72b6\u6001\u7684\u5207\u6362\u7b49 \u5bf9\u4e8ekey\u5feb\u901f\u67e5\u8be2\u64cd\u4f5c\uff0c\u4f8b\u5982\uff1a\u6309\u6307\u5b9a\u7b56\u7565\u67e5\u8be2key 3.1.2 key \u57fa\u672c\u64cd\u4f5c \u00b6 \u5220\u9664\u6307\u5b9akey del key \u83b7\u53d6key\u662f\u5426\u5b58\u5728 exists key \u83b7\u53d6key\u7684\u7c7b\u578b type key 3.1.3 \u62d3\u5c55\u64cd\u4f5c \u6392\u5e8f sort \u6539\u540d rename key newkey renamenx key newkey 3.1.3 key \u6269\u5c55\u64cd\u4f5c\uff08\u65f6\u6548\u6027\u63a7\u5236\uff09 \u00b6 \u4e3a\u6307\u5b9akey\u8bbe\u7f6e\u6709\u6548\u671f expire key seconds pexpire key milliseconds expireat key timestamp pexpireat key milliseconds-timestamp \u83b7\u53d6key\u7684\u6709\u6548\u65f6\u95f4 ttl key pttl key \u5207\u6362key\u4ece\u65f6\u6548\u6027\u8f6c\u6362\u4e3a\u6c38\u4e45\u6027 persist key 3.1.4 key \u6269\u5c55\u64cd\u4f5c\uff08\u67e5\u8be2\u6a21\u5f0f\uff09 \u00b6 \u67e5\u8be2key keys pattern \u67e5\u8be2\u6a21\u5f0f\u89c4\u5219 *\u5339\u914d\u4efb\u610f\u6570\u91cf\u7684\u4efb\u610f\u7b26\u53f7 ? \u914d\u5408\u4e00\u4e2a\u4efb\u610f\u7b26\u53f7 [] \u5339\u914d\u4e00\u4e2a\u6307\u5b9a\u7b26\u53f7 keys * keys \u67e5\u8be2\u6240\u6709 it* keys \u67e5\u8be2\u6240\u6709\u4ee5it\u5f00\u5934 *heima \u67e5\u8be2\u6240\u6709\u4ee5heima\u7ed3\u5c3e keys ??heima \u67e5\u8be2\u6240\u6709\u524d\u9762\u4e24\u4e2a\u5b57\u7b26\u4efb\u610f\uff0c\u540e\u9762\u4ee5heima\u7ed3\u5c3e \u67e5\u8be2\u6240\u6709\u4ee5 keys user:? user:\u5f00\u5934\uff0c\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u4efb\u610f keys u [ st ] er:1 \u67e5\u8be2\u6240\u6709\u4ee5u\u5f00\u5934\uff0c\u4ee5er:1\u7ed3\u5c3e\uff0c\u4e2d\u95f4\u5305\u542b\u4e00\u4e2a\u5b57\u6bcd\uff0cs\u6216t 3.2 \u6570\u636e\u5e93\u6307\u4ee4 \u00b6 3.2.1 key \u7684\u91cd\u590d\u95ee\u9898 \u00b6 \u5728\u8fd9\u4e2a\u5730\u65b9\u6211\u4eec\u6765\u8bb2\u4e00\u4e0b\u6570\u636e\u5e93\u7684\u5e38\u7528\u6307\u4ee4\uff0c\u5728\u8bb2\u8fd9\u4e2a\u4e1c\u897f\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u601d\u8003\u4e00\u4e2a\u95ee\u9898\uff1a \u5047\u5982\u8bf4\u4f60\u4eec\u5341\u4e2a\u4eba\u540c\u65f6\u64cd\u4f5credis\uff0c\u4f1a\u4e0d\u4f1a\u51fa\u73b0key\u540d\u5b57\u547d\u540d\u51b2\u7a81\u7684\u95ee\u9898\u3002 \u4e00\u5b9a\u4f1a\uff0c\u4e3a\u4ec0\u4e48?\u56e0\u4e3a\u4f60\u7684key\u662f\u7531\u7a0b\u5e8f\u800c\u5b9a\u4e49\u7684\u3002\u4f60\u60f3\u5199\u4ec0\u4e48\u5199\u4ec0\u4e48\uff0c\u90a3\u5728\u4f7f\u7528\u7684\u8fc7\u7a0b\u4e2d\u5927\u5bb6\u90fd\u5728\u4e0d\u505c\u7684\u52a0\uff0c\u65e9\u665a\u6709\u4e00\u5929\u4ed6\u4f1a\u51b2\u7a81\u7684\u3002 redis\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u4f34\u968f\u7740\u64cd\u4f5c\u6570\u636e\u91cf\u7684\u589e\u52a0\uff0c\u4f1a\u51fa\u73b0\u5927\u91cf\u7684\u6570\u636e\u4ee5\u53ca\u5bf9\u5e94\u7684key\u3002 \u90a3\u8fd9\u4e2a\u95ee\u9898\u6211\u4eec\u8981\u4e0d\u8981\u89e3\u51b3\uff1f\u8981\uff01\u600e\u4e48\u89e3\u51b3\u5462\uff1f\u6211\u4eec\u6700\u597d\u628a\u6570\u636e\u8fdb\u884c\u4e00\u4e2a\u5206\u7c7b\uff0c\u9664\u4e86\u547d\u540d\u89c4\u8303\u6211\u4eec\u505a\u7edf\u4e00\u4ee5\u5916\uff0c\u5982\u679c\u8fd8\u80fd\u628a\u5b83\u5206\u5f00\uff0c\u8fd9\u6837\u662f\u4e0d\u662f\u51b2\u7a81\u7684\u673a\u7387\u5c31\u4f1a\u5c0f\u4e00\u4e9b\u4e86\uff0c\u8fd9\u5c31\u662f\u54b1\u4eec\u4e0b\u9762\u8981\u8bf4\u7684\u89e3\u51b3\u65b9\u6848\uff01 3.2.2 \u89e3\u51b3\u65b9\u6848 \u00b6 redis\u4e3a\u6bcf\u4e2a\u670d\u52a1\u63d0\u4f9b\u670916\u4e2a\u6570\u636e\u5e93\uff0c\u7f16\u53f7\u4ece0\u523015 \u6bcf\u4e2a\u6570\u636e\u5e93\u4e4b\u95f4\u7684\u6570\u636e\u76f8\u4e92\u72ec\u7acb \u5728\u5bf9\u5e94\u7684\u6570\u636e\u5e93\u4e2d\u5212\u51fa\u4e00\u5757\u533a\u57df\uff0c\u8bf4\u4ed6\u5c31\u662f\u51e0\uff0c\u4f60\u5c31\u7528\u51e0\u90a3\u5757\uff0c\u540c\u65f6\uff0c\u5176\u4ed6\u7684\u8fd9\u4e9b\u90fd\u53ef\u4ee5\u8fdb\u884c\u5b9a\u4e49\uff0c\u4e00\u5171\u662f16\u4e2a\uff0c\u8fd9\u91cc\u8fb9\u9700\u8981\u6ce8\u610f\u4e00\u70b9\uff0c\u4ed6\u4eec\u8fd916\u4e2a\u5171\u7528redis\u7684\u5185\u5b58\u3002\u6ca1\u6709\u8bf4\u8c01\u5927\u8c01\u5c0f\uff0c\u4e5f\u5c31\u662f\u8bf4\u6570\u5b57\u53ea\u662f\u4ee3\u8868\u4e86\u4e00\u5757\u513f\u533a\u57df\uff0c\u533a\u57df\u5177\u4f53\u591a\u5927\u672a\u77e5\u3002\u8fd9\u662f\u6570\u636e\u5e93\u7684\u4e00\u4e2a\u5206\u533a\u7684\u4e00\u4e2a\u7b56\u7565\uff01 3.2.3 \u6570\u636e\u5e93\u7684\u57fa\u672c\u64cd\u4f5c \u00b6 \u5207\u6362\u6570\u636e\u5e93 select index \u5176\u4ed6\u64cd\u4f5c ping 3.2.4 \u6570\u636e\u5e93\u6269\u5c55\u64cd\u4f5c \u00b6 \u6570\u636e\u79fb\u52a8 move key db \u6570\u636e\u603b\u91cf dbsize \u6570\u636e\u6e05\u9664 flushdb flushall 4. Jedis \u00b6 \u5728\u5b66\u4e60\u5b8credis\u540e\uff0c\u6211\u4eec\u73b0\u5728\u5c31\u8981\u7528Java\u6765\u8fde\u63a5redis\u4e86\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u7684\u8fd9\u4e00\u7ae0\u8981\u5b66\u7684Jedis\u4e86\u3002\u5728\u8fd9\u4e2a\u90e8\u5206\uff0c\u6211\u4eec\u4e3b\u8981\u8bb2\u89e3\u4ee5\u4e0b3\u4e2a\u5185\u5bb9\uff1a HelloWorld\uff08Jedis\u7248\uff09 Jedis\u7b80\u6613\u5de5\u5177\u7c7b\u5f00\u53d1 \u53ef\u89c6\u5316\u5ba2\u6237\u7aef 4.1 Jedis\u7b80\u4ecb \u00b6 4.1.1 \u7f16\u7a0b\u8bed\u8a00\u4e0eredis \u00b6 \u5bf9\u4e8e\u6211\u4eec\u73b0\u5728\u7684\u6570\u636e\u6765\u8bf4\uff0c\u5b83\u662f\u5728\u6211\u4eec\u7684redis\u4e2d\uff0c\u800c\u6700\u7ec8\u6211\u4eec\u662f\u8981\u505a\u7a0b\u5e8f\u3002\u90a3\u4e48\u7a0b\u5e8f\u5c31\u8981\u548c\u6211\u4eec\u7684redis\u8fdb\u884c\u8fde\u63a5\u3002\u5e72\u4ec0\u4e48\u4e8b\u60c5\u5462\uff1f\u4e24\u4ef6\u4e8b\uff1a\u7a0b\u5e8f\u4e2d\u6709\u6570\u636e\u7684\u65f6\u5019\uff0c\u6211\u4eec\u8981\u628a\u8fd9\u4e9b\u6570\u636e\u5168\u90e8\u4ea4\u7ed9redis\u7ba1\u7406\u3002\u540c\u65f6\uff0credis\u4e2d\u7684\u6570\u636e\u8fd8\u80fd\u53d6\u51fa\u6765\uff0c\u56de\u5230\u6211\u4eec\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u3002\u90a3\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u5728Java\u4e0eredis\u4e4b\u95f4\u6253\u4ea4\u9053\u7684\u8fd9\u4e2a\u4e1c\u897f\u5c31\u53eb\u505aJedis.\u7b80\u5355\u8bf4\uff0cJedis\u5c31\u662f\u63d0\u4f9b\u4e86Java\u4e0eredis\u7684\u8fde\u63a5\u670d\u52a1\u7684\uff0c\u91cc\u8fb9\u6709\u5404\u79cd\u5404\u6837\u7684API\u63a5\u53e3\uff0c\u4f60\u53ef\u4ee5\u53bb\u8c03\u7528\u5b83\u3002 \u9664\u4e86Jedis\u5916\uff0c\u8fd8\u6709\u6ca1\u6709\u5176\u4ed6\u7684\u8fd9\u79cd\u8fde\u63a5\u670d\u52a1\u5462\uff1f\u5176\u5b9e\u8fd8\u6709\u5f88\u591a\uff0c\u4e86\u89e3\u4e00\u4e0b\uff1a Java\u8bed\u8a00\u8fde\u63a5redis\u670d\u52a1 Jedis\uff08SpringData\u3001Redis \u3001 Lettuce\uff09 \u5176\u5b83\u8bed\u8a00\uff1aC \u3001C++ \u3001C# \u3001Erlang\u3001Lua \u3001Objective-C \u3001Perl \u3001PHP \u3001Python \u3001Ruby \u3001Scala 4.1.2 \u51c6\u5907\u5de5\u4f5c \u00b6 (1)jar\u5305\u5bfc\u5165 \u4e0b\u8f7d\u5730\u5740\uff1ahttps://mvnrepository.com/artifact/redis.clients/jedis \u57fa\u4e8emaven <dependency> <groupId> redis.clients </groupId> <artifactId> jedis </artifactId> <version> 2.9.0 </version> </dependency> (2)\u5ba2\u6237\u7aef\u8fde\u63a5redis \u8fde\u63a5redis Jedis jedis = new Jedis(\"localhost\", 6379); \u64cd\u4f5credis jedis.set(\"name\", \"itheima\"); jedis.get(\"name\"); \u5173\u95edredis\u8fde\u63a5 jedis.close(); API\u6587\u6863 http://xetorthio.github.io/jedis/ 4.1.3 \u4ee3\u7801\u5b9e\u73b0 \u00b6 \u521b\u5efa\uff1acom.itheima.JedisTest public class JedisTest { public static void main ( String [] args ) { //1.\u83b7\u53d6\u8fde\u63a5\u5bf9\u8c61 Jedis jedis = new Jedis ( \"192.168.40.130\" , 6379 ); //2.\u6267\u884c\u64cd\u4f5c jedis . set ( \"age\" , \"39\" ); String hello = jedis . get ( \"hello\" ); System . out . println ( hello ); jedis . lpush ( \"list1\" , \"a\" , \"b\" , \"c\" , \"d\" ); List < String > list1 = jedis . lrange ( \"list1\" , 0 , - 1 ); for ( String s : list1 ) { System . out . println ( s ); } jedis . sadd ( \"set1\" , \"abc\" , \"abc\" , \"def\" , \"poi\" , \"cba\" ); Long len = jedis . scard ( \"set1\" ); System . out . println ( len ); //3.\u5173\u95ed\u8fde\u63a5 jedis . close (); } } 4.2 Jedis\u7b80\u6613\u5de5\u5177\u7c7b\u5f00\u53d1 \u00b6 \u524d\u9762\u6211\u4eec\u505a\u7684\u7a0b\u5e8f\u8fd8\u662f\u6709\u70b9\u513f\u5c0f\u95ee\u9898\uff0c\u5c31\u662f\u6211\u4eec\u7684Jedis\u5bf9\u8c61\u7684\u7ba1\u7406\u662f\u6211\u4eec\u81ea\u5df1\u521b\u5efa\u7684\uff0c\u771f\u5b9e\u4f01\u4e1a\u5f00\u53d1\u4e2d\u662f\u4e0d\u53ef\u80fd\u8ba9\u4f60\u53bbnew\u4e00\u4e2a\u7684\uff0c\u90a3\u63a5\u4e0b\u6765\u54b1\u4eec\u5c31\u8981\u505a\u4e00\u4e2a\u5de5\u5177\u7c7b\uff0c\u7b80\u5355\u6765\u8bf4\uff0c\u5c31\u662f\u505a\u4e00\u4e2a\u521b\u5efaJedis\u7684\u8fd9\u6837\u7684\u4e00\u4e2a\u5de5\u5177\u3002 4.2.1 \u57fa\u4e8e\u8fde\u63a5\u6c60\u83b7\u53d6\u8fde\u63a5 \u00b6 JedisPool\uff1aJedis\u63d0\u4f9b\u7684\u8fde\u63a5\u6c60\u6280\u672f poolConfig:\u8fde\u63a5\u6c60\u914d\u7f6e\u5bf9\u8c61 host:redis\u670d\u52a1\u5730\u5740 port:redis\u670d\u52a1\u7aef\u53e3\u53f7 JedisPool\u7684\u6784\u9020\u5668\u5982\u4e0b\uff1a public JedisPool ( GenericObjectPoolConfig poolConfig , String host , int port ) { this ( poolConfig , host , port , 2000 , ( String ) null , 0 , ( String ) null ); } 4.2.2 \u5c01\u88c5\u8fde\u63a5\u53c2\u6570 \u00b6 \u521b\u5efajedis\u7684\u914d\u7f6e\u6587\u4ef6\uff1ajedis.properties jedis.host = 192.168.40.130 jedis.port = 6379 jedis.maxTotal = 50 jedis.maxIdle = 10 4.2.3 \u52a0\u8f7d\u914d\u7f6e\u4fe1\u606f \u00b6 \u521b\u5efaJedisUtils\uff1acom.itheima.util.JedisUtils\uff0c\u4f7f\u7528\u9759\u6001\u4ee3\u7801\u5757\u521d\u59cb\u5316\u8d44\u6e90 public class JedisUtils { private static int maxTotal ; private static int maxIdel ; private static String host ; private static int port ; private static JedisPoolConfig jpc ; private static JedisPool jp ; static { ResourceBundle bundle = ResourceBundle . getBundle ( \"redis\" ); maxTotal = Integer . parseInt ( bundle . getString ( \"redis.maxTotal\" )); maxIdel = Integer . parseInt ( bundle . getString ( \"redis.maxIdel\" )); host = bundle . getString ( \"redis.host\" ); port = Integer . parseInt ( bundle . getString ( \"redis.port\" )); //Jedis\u8fde\u63a5\u6c60\u914d\u7f6e jpc = new JedisPoolConfig (); jpc . setMaxTotal ( maxTotal ); jpc . setMaxIdle ( maxIdel ); jp = new JedisPool ( jpc , host , port ); } } 4.2.4 \u83b7\u53d6\u8fde\u63a5 \u00b6 \u5bf9\u5916\u8bbf\u95ee\u63a5\u53e3\uff0c\u63d0\u4f9bjedis\u8fde\u63a5\u5bf9\u8c61\uff0c\u8fde\u63a5\u4ece\u8fde\u63a5\u6c60\u83b7\u53d6\uff0c\u5728JedisUtils\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u83b7\u53d6jedis\u7684\u65b9\u6cd5\uff1agetJedis public static Jedis getJedis (){ Jedis jedis = jedisPool . getResource (); return jedis ; } 4.3 \u53ef\u89c6\u5316\u5ba2\u6237\u7aef \u00b6 4.3.1 Redis Desktop Manager 5. \u6301\u4e45\u5316 \u00b6 \u4e0b\u9762\u5462\uff0c\u8fdb\u5165\u5230\u6301\u4e45\u5316\u7684\u5b66\u4e60.\u8fd9\u90e8\u5206\u5185\u5bb9\u7406\u89e3\u7684\u4e1c\u897f\u591a\uff0c\u64cd\u4f5c\u7684\u4e1c\u897f\u5c11\u3002\u5728\u8fd9\u4e2a\u90e8\u5206\uff0c\u6211\u4eec\u5c06\u8bb2\u89e3\u56db\u4e2a\u4e1c\u897f\uff1a \u6301\u4e45\u5316\u7b80\u4ecb RDB AOF RDB\u4e0eAOF\u533a\u522b 5.1 \u6301\u4e45\u5316\u7b80\u4ecb \u00b6 5.1.1 \u573a\u666f-\u610f\u5916\u65ad\u7535 \u00b6 \u4e0d\u77e5\u9053\u5927\u5bb6\u6709\u6ca1\u6709\u9047\u89c1\u8fc7\uff0c\u5c31\u662f\u6b63\u5de5\u4f5c\u7684\u65f6\u5019\u505c\u7535\u4e86\uff0c\u5982\u679c\u4f60\u7528\u7684\u662f\u7b14\u8bb0\u672c\u7535\u8111\u8fd8\u597d\uff0c\u4f60\u6709\u7535\u6c60\uff0c\u4f46\u5982\u679c\u4f60\u7528\u7684\u662f\u53f0\u5f0f\u673a\u5462\uff0c\u90a3\u6050\u6015\u5c31\u6bd4\u8f83\u707e\u96be\u4e86\uff0c\u5047\u5982\u4f60\u73b0\u5728\u6b63\u5728\u5199\u4e00\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u6587\u6863\uff0c\u5982\u679c\u4f60\u8981\u4f7f\u7528\u7684\u662fword\uff0c\u8fd9\u79cd\u529e\u516c\u81ea\u52a8\u5316\u8f6f\u4ef6\u7684\u8bdd\uff0c\u4ed6\u4e00\u65e6\u9047\u5230\u505c\u7535\uff0c\u5176\u5b9e\u4f60\u4e0d\u7528\u62c5\u5fc3\uff0c\u56e0\u4e3a\u5b83\u4f1a\u7ed9\u4f60\u751f\u6210\u4e00\u4e9b\u5176\u4ed6\u7684\u6587\u4ef6\u3002 \u5176\u5b9e\u4ed6\u4eec\u90fd\u5728\u505a\u4e00\u4ef6\u4e8b\u513f\uff0c\u5e2e\u4f60\u81ea\u52a8\u6062\u590d\uff0c\u6709\u4e86\u8fd9\u4e2a\u6587\u4ef6\uff0c\u4f60\u524d\u9762\u7684\u4e1c\u897f\u5c31\u4e0d\u518d\u4e22\u4e86\u3002\u90a3\u4ec0\u4e48\u662f\u81ea\u52a8\u6062\u590d\u5462\uff1f\u4f60\u8981\u5148\u4e86\u89e3\u4ed6\u7684\u6574\u4e2a\u8fc7\u7a0b\u3002 \u6211\u4eec\u8bf4\u81ea\u52a8\u6062\u590d\uff0c\u5176\u5b9e\u57fa\u4e8e\u7684\u4e00\u4e2a\u524d\u63d0\u5c31\u662f\u4ed6\u63d0\u524d\u628a\u4f60\u7684\u6570\u636e\u7ed9\u5b58\u8d77\u6765\u4e86\u3002\u4f60\u5e73\u5e38\u64cd\u4f5c\u7684\u6240\u6709\u4fe1\u606f\u90fd\u662f\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u800c\u6211\u4eec\u771f\u6b63\u7684\u4fe1\u606f\u662f\u4fdd\u5b58\u5728\u786c\u76d8\u4e2d\u7684\uff0c\u5185\u5b58\u4e2d\u7684\u4fe1\u606f\u65ad\u7535\u4ee5\u540e\u5c31\u6d88\u5931\u4e86\uff0c\u786c\u76d8\u4e2d\u7684\u4fe1\u606f\u65ad\u7535\u4ee5\u540e\u8fd8\u53ef\u4ee5\u4fdd\u7559\u4e0b\u6765\uff01 \u6211\u4eec\u5c06\u6587\u4ef6\u7531\u5185\u5b58\u4e2d\u4fdd\u5b58\u5230\u786c\u76d8\u4e2d\u7684\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u6211\u4eec\u53eb\u505a\u6570\u636e\u4fdd\u5b58\uff0c\u4e5f\u5c31\u53eb\u505a\u6301\u4e45\u5316\u3002\u4f46\u662f\u628a\u5b83\u4fdd\u5b58\u4e0b\u6765\u4e0d\u662f\u4f60\u7684\u76ee\u7684\uff0c\u6700\u7ec8\u4f60\u8fd8\u8981\u628a\u5b83\u518d\u8bfb\u53d6\u51fa\u6765\uff0c\u5b83\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u6211\u4eec\u53eb\u505a\u6570\u636e\u6062\u590d\uff0c\u8fd9\u5c31\u662f\u6211\u4eec\u6240\u8bf4\u7684word\u4e3a\u4ec0\u4e48\u65ad\u7535\u4ee5\u540e\u8fd8\u80fd\u591f\u7ed9\u4f60\u4fdd\u7559\u6587\u4ef6\uff0c\u56e0\u4e3a\u5b83\u6267\u884c\u4e86\u4e00\u4e2a\u81ea\u52a8\u5907\u4efd\u7684\u8fc7\u7a0b\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u81ea\u52a8\u7684\u5f62\u5f0f\uff0c\u628a\u4f60\u7684\u6570\u636e\u5b58\u50a8\u8d77\u6765\uff0c\u90a3\u4e48\u6709\u4e86\u8fd9\u79cd\u5f62\u5f0f\u4ee5\u540e\uff0c\u6211\u4eec\u7684\u6570\u636e\u5c31\u53ef\u4ee5\u7531\u5185\u5b58\u5230\u786c\u76d8\u4e0a\u5b9e\u73b0\u4fdd\u5b58\u3002 5.1.2 \u4ec0\u4e48\u662f\u6301\u4e45\u5316 \u00b6 (1)\u4ec0\u4e48\u662f\u6301\u4e45\u5316 \u5229\u7528\u6c38\u4e45\u6027\u5b58\u50a8\u4ecb\u8d28\u5c06\u6570\u636e\u8fdb\u884c\u4fdd\u5b58\uff0c\u5728\u7279\u5b9a\u7684\u65f6\u95f4\u5c06\u4fdd\u5b58\u7684\u6570\u636e\u8fdb\u884c\u6062\u590d\u7684\u5de5\u4f5c\u673a\u5236\u79f0\u4e3a\u6301\u4e45\u5316 \u3002 \u6301\u4e45\u5316\u7528\u4e8e\u9632\u6b62\u6570\u636e\u7684\u610f\u5916\u4e22\u5931\uff0c\u786e\u4fdd\u6570\u636e\u5b89\u5168\u6027\u3002 (2)\u6301\u4e45\u5316\u8fc7\u7a0b\u4fdd\u5b58\u4ec0\u4e48\uff1f \u6211\u4eec\u77e5\u9053\u4e00\u70b9\uff0c\u8ba1\u7b97\u673a\u4e2d\u7684\u6570\u636e\u5168\u90e8\u90fd\u662f\u4e8c\u8fdb\u5236\uff0c\u5982\u679c\u73b0\u5728\u6211\u8981\u4f60\u7ed9\u6211\u4fdd\u5b58\u4e00\u7ec4\u6570\u636e\u7684\u8bdd\uff0c\u4f60\u6709\u4ec0\u4e48\u6837\u7684\u65b9\u5f0f\u5462\uff0c\u5176\u5b9e\u6700\u7b80\u5355\u7684\u5c31\u662f\u73b0\u5728\u957f\u4ec0\u4e48\u6837\uff0c\u6211\u5c31\u8bb0\u4e0b\u6765\u5c31\u884c\u4e86\uff0c\u90a3\u4e48\u8fd9\u79cd\u662f\u8bb0\u5f55\u7eaf\u7cb9\u7684\u6570\u636e\uff0c\u4e5f\u53eb\u505a\u5feb\u7167\u5b58\u50a8\uff0c\u4e5f\u5c31\u662f\u5b83\u4fdd\u5b58\u7684\u662f\u67d0\u4e00\u65f6\u523b\u7684\u6570\u636e\u72b6\u6001\u3002 \u8fd8\u6709\u4e00\u79cd\u5f62\u5f0f\uff0c\u5b83\u4e0d\u8bb0\u5f55\u4f60\u7684\u6570\u636e\uff0c\u5b83\u8bb0\u5f55\u4f60\u6240\u6709\u7684\u64cd\u4f5c\u8fc7\u7a0b\uff0c\u6bd4\u5982\u8bf4\u5927\u5bb6\u7528idea\u7684\u65f6\u5019\uff0c\u6709\u6ca1\u6709\u9047\u5230\u8fc7\u5199\u9519\u4e86ctrl+z\u64a4\u9500\uff0c\u7136\u540ectrl+y\u8fd8\u80fd\u6062\u590d\uff0c\u8fd9\u4e2a\u5730\u65b9\u5b83\u4e5f\u662f\u5728\u8bb0\u5f55\uff0c\u4f46\u662f\u8bb0\u5f55\u7684\u662f\u4f60\u6240\u6709\u7684\u64cd\u4f5c\u8fc7\u7a0b\uff0c\u90a3\u6211\u60f3\u95ee\u4e00\u4e0b\uff0c\u64cd\u4f5c\u8fc7\u7a0b\uff0c\u6211\u90fd\u7ed9\u4f60\u7559\u4e0b\u6765\u4e86\uff0c\u4f60\u8bf4\u6570\u636e\u8fd8\u4f1a\u4e22\u5417\uff1f\u80af\u5b9a\u4e0d\u4f1a\u4e22\uff0c\u56e0\u4e3a\u4f60\u6240\u6709\u7684\u64cd\u4f5c\u8fc7\u7a0b\u6211\u90fd\u4fdd\u5b58\u4e86\u3002\u8fd9\u79cd\u4fdd\u5b58\u64cd\u4f5c\u8fc7\u7a0b\u7684\u5b58\u50a8\uff0c\u7528\u4e13\u4e1a\u672f\u8bed\u6765\u8bf4\u53ef\u4ee5\u8bf4\u662f\u65e5\u5fd7\uff0c\u8fd9\u662f\u4e24\u79cd\u4e0d\u540c\u7684\u4fdd\u5b58\u6570\u636e\u7684\u5f62\u5f0f\u554a\u3002 \u603b\u7ed3\u4e00\u4e0b\uff1a \u7b2c\u4e00\u79cd\uff1a\u5c06\u5f53\u524d\u6570\u636e\u72b6\u6001\u8fdb\u884c\u4fdd\u5b58\uff0c\u5feb\u7167\u5f62\u5f0f\uff0c\u5b58\u50a8\u6570\u636e\u7ed3\u679c\uff0c\u5b58\u50a8\u683c\u5f0f\u7b80\u5355\uff0c\u5173\u6ce8\u70b9\u5728\u6570\u636e\u3002 \u7b2c\u4e8c\u79cd\uff1a\u5c06\u6570\u636e\u7684\u64cd\u4f5c\u8fc7\u7a0b\u8fdb\u884c\u4fdd\u5b58\uff0c\u65e5\u5fd7\u5f62\u5f0f\uff0c\u5b58\u50a8\u64cd\u4f5c\u8fc7\u7a0b\uff0c\u5b58\u50a8\u683c\u5f0f\u590d\u6742\uff0c\u5173\u6ce8\u70b9\u5728\u6570\u636e\u7684\u64cd\u4f5c\u8fc7\u7a0b\u3002 5.2 RDB \u00b6 5.2.1 save\u6307\u4ee4 \u00b6 \u624b\u52a8\u6267\u884c\u4e00\u6b21\u4fdd\u5b58\u64cd\u4f5c save save\u6307\u4ee4\u76f8\u5173\u914d\u7f6e \u8bbe\u7f6e\u672c\u5730\u6570\u636e\u5e93\u6587\u4ef6\u540d\uff0c\u9ed8\u8ba4\u503c\u4e3a dump.rdb\uff0c\u901a\u5e38\u8bbe\u7f6e\u4e3adump-\u7aef\u53e3\u53f7.rdb dbfilename filename \u8bbe\u7f6e\u5b58\u50a8.rdb\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u901a\u5e38\u8bbe\u7f6e\u6210\u5b58\u50a8\u7a7a\u95f4\u8f83\u5927\u7684\u76ee\u5f55\u4e2d\uff0c\u76ee\u5f55\u540d\u79f0data dir path \u8bbe\u7f6e\u5b58\u50a8\u81f3\u672c\u5730\u6570\u636e\u5e93\u65f6\u662f\u5426\u538b\u7f29\u6570\u636e\uff0c\u9ed8\u8ba4yes\uff0c\u8bbe\u7f6e\u4e3ano\uff0c\u8282\u7701 CPU \u8fd0\u884c\u65f6\u95f4\uff0c\u4f46\u5b58\u50a8\u6587\u4ef6\u53d8\u5927 rdbcompression yes|no \u8bbe\u7f6e\u8bfb\u5199\u6587\u4ef6\u8fc7\u7a0b\u662f\u5426\u8fdb\u884cRDB\u683c\u5f0f\u6821\u9a8c\uff0c\u9ed8\u8ba4yes\uff0c\u8bbe\u7f6e\u4e3ano\uff0c\u8282\u7ea6\u8bfb\u519910%\u65f6\u95f4\u6d88\u8017\uff0c\u5355\u5b58\u5728\u6570\u636e\u635f\u574f\u7684\u98ce\u9669 rdbchecksum yes|no save\u6307\u4ee4\u5de5\u4f5c\u539f\u7406 \u9700\u8981\u6ce8\u610f\u4e00\u4e2a\u95ee\u9898\uff0c\u6765\u770b\u4e00\u4e0b\uff0c\u73b0\u5728\u6709\u56db\u4e2a\u5ba2\u6237\u7aef\u5404\u81ea\u8981\u6267\u884c\u4e00\u4e2a\u6307\u4ee4\uff0c\u628a\u8fd9\u4e9b\u6307\u4ee4\u53d1\u9001\u5230redis\u670d\u52a1\u5668\u540e\uff0c\u4ed6\u4eec\u6267\u884c\u6709\u4e00\u4e2a\u5148\u540e\u987a\u5e8f\u95ee\u9898\uff0c\u5047\u5b9a\u5c31\u662f\u6309\u71671234\u7684\u987a\u5e8f\u653e\u8fc7\u53bb\u7684\u8bdd\uff0c\u90a3\u4f1a\u662f\u4ec0\u4e48\u6837\u7684\uff1f \u8bb0\u5f97redis\u662f\u4e2a\u5355\u7ebf\u7a0b\u7684\u5de5\u4f5c\u6a21\u5f0f\uff0c\u5b83\u4f1a\u521b\u5efa\u4e00\u4e2a\u4efb\u52a1\u961f\u5217\uff0c\u6240\u6709\u7684\u547d\u4ee4\u90fd\u4f1a\u8fdb\u5230\u8fd9\u4e2a\u961f\u5217\u91cc\u8fb9\uff0c\u5728\u8fd9\u513f\u6392\u961f\u6267\u884c\uff0c\u6267\u884c\u5b8c\u4e00\u4e2a\u6d88\u5931\u4e00\u4e2a\uff0c\u5f53\u6240\u6709\u7684\u547d\u4ee4\u90fd\u6267\u884c\u5b8c\u4e86\uff0cOK\uff0c\u7ed3\u679c\u8fbe\u5230\u4e86\u3002 \u4f46\u662f\u5982\u679c\u73b0\u5728\u6211\u4eec\u6267\u884c\u7684\u65f6\u5019save\u6307\u4ee4\u4fdd\u5b58\u7684\u6570\u636e\u91cf\u5f88\u5927\u4f1a\u662f\u4ec0\u4e48\u73b0\u8c61\u5462\uff1f \u4ed6\u4f1a\u975e\u5e38\u8017\u65f6\uff0c\u4ee5\u81f3\u4e8e\u5f71\u54cd\u5230\u5b83\u5728\u6267\u884c\u7684\u65f6\u5019\uff0c\u540e\u9762\u7684\u6307\u4ee4\u90fd\u8981\u7b49\uff0c\u6240\u4ee5\u8bf4\u8fd9\u79cd\u6a21\u5f0f\u662f\u4e0d\u53cb\u597d\u7684\uff0c\u8fd9\u662fsave\u6307\u4ee4\u5bf9\u5e94\u7684\u4e00\u4e2a\u95ee\u9898\uff0c\u5f53cpu\u6267\u884c\u7684\u65f6\u5019\u4f1a\u963b\u585eredis\u670d\u52a1\u5668\uff0c\u76f4\u5230\u4ed6\u6267\u884c\u5b8c\u6bd5\uff0c\u6240\u4ee5\u8bf4\u6211\u4eec\u4e0d\u5efa\u8bae\u5927\u5bb6\u5728\u7ebf\u4e0a\u73af\u5883\u7528save\u6307\u4ee4\u3002 5.2.2 bgsave\u6307\u4ee4 \u00b6 \u4e4b\u524d\u6211\u4eec\u8bb2\u5230\u4e86\u5f53save\u6307\u4ee4\u7684\u6570\u636e\u91cf\u8fc7\u5927\u65f6\uff0c\u5355\u7ebf\u7a0b\u6267\u884c\u65b9\u5f0f\u9020\u6210\u6548\u7387\u8fc7\u4f4e\uff0c\u90a3\u5e94\u8be5\u5982\u4f55\u5904\u7406\uff1f \u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\uff1a bgsave \u6307\u4ee4\uff0cbg\u5176\u5b9e\u662fbackground\u7684\u610f\u601d\uff0c\u540e\u53f0\u6267\u884c\u7684\u610f\u601d \u624b\u52a8\u542f\u52a8\u540e\u53f0\u4fdd\u5b58\u64cd\u4f5c\uff0c\u4f46\u4e0d\u662f\u7acb\u5373\u6267\u884c bgsave bgsave\u6307\u4ee4\u76f8\u5173\u914d\u7f6e \u540e\u53f0\u5b58\u50a8\u8fc7\u7a0b\u4e2d\u5982\u679c\u51fa\u73b0\u9519\u8bef\u73b0\u8c61\uff0c\u662f\u5426\u505c\u6b62\u4fdd\u5b58\u64cd\u4f5c\uff0c\u9ed8\u8ba4yes stop-writes-on-bgsave-error yes|no \u5176 \u4ed6 dbfilename filename dir path rdbcompression yes|no rdbchecksum yes|no bgsave\u6307\u4ee4\u5de5\u4f5c\u539f\u7406 \u5f53\u6267\u884cbgsave\u7684\u65f6\u5019\uff0c\u5ba2\u6237\u7aef\u53d1\u51fabgsave\u6307\u4ee4\u7ed9\u5230redis\u670d\u52a1\u5668\u3002\u6ce8\u610f\uff0c\u8fd9\u4e2a\u65f6\u5019\u670d\u52a1\u5668\u9a6c\u4e0a\u56de\u4e00\u4e2a\u7ed3\u679c\u544a\u8bc9\u5ba2\u6237\u7aef\u540e\u53f0\u5df2\u7ecf\u5f00\u59cb\u4e86\uff0c\u4e0e\u6b64\u540c\u65f6\u5b83\u4f1a\u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u4f7f\u7528Linux\u7684fork\u51fd\u6570\u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u8ba9\u8fd9\u4e2a\u5b50\u8fdb\u7a0b\u53bb\u6267\u884csave\u76f8\u5173\u7684\u64cd\u4f5c\uff0c\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u60f3\u4e00\u4e0b\uff0c\u6211\u4eec\u4e3b\u8fdb\u7a0b\u4e00\u76f4\u5728\u5904\u7406\u6307\u4ee4\uff0c\u800c\u5b50\u8fdb\u7a0b\u5728\u6267\u884c\u540e\u53f0\u7684\u4fdd\u5b58\uff0c\u5b83\u4f1a\u4e0d\u4f1a\u5e72\u6270\u5230\u4e3b\u8fdb\u7a0b\u7684\u6267\u884c\u5417\uff1f \u7b54\u6848\u662f\u4e0d\u4f1a\uff0c\u6240\u4ee5\u8bf4\u4ed6\u624d\u662f\u4e3b\u6d41\u65b9\u6848\u3002\u5b50\u8fdb\u7a0b\u5f00\u59cb\u6267\u884c\u4e4b\u540e\uff0c\u5b83\u5c31\u4f1a\u521b\u5efa\u554aRDB\u6587\u4ef6\u628a\u5b83\u5b58\u8d77\u6765\uff0c\u64cd\u4f5c\u5b8c\u4ee5\u540e\u4ed6\u4f1a\u628a\u8fd9\u4e2a\u7ed3\u679c\u8fd4\u56de\uff0c\u4e5f\u5c31\u662f\u8bf4bgsave\u7684\u8fc7\u7a0b\u5206\u6210\u4e24\u4e2a\u8fc7\u7a0b\uff0c\u7b2c\u4e00\u4e2a\u662f\u670d\u52a1\u7aef\u62ff\u5230\u6307\u4ee4\u76f4\u63a5\u544a\u8bc9\u5ba2\u6237\u7aef\u5f00\u59cb\u6267\u884c\u4e86\uff1b\u53e6\u5916\u4e00\u4e2a\u8fc7\u7a0b\u662f\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u5728\u5b8c\u6210\u540e\u53f0\u7684\u4fdd\u5b58\u64cd\u4f5c\uff0c\u64cd\u4f5c\u5b8c\u4ee5\u540e\u56de\u4e00\u4e2a\u6d88\u606f\u3002 5.2.3 save\u914d\u7f6e\u81ea\u52a8\u6267\u884c \u00b6 \u8bbe\u7f6e\u81ea\u52a8\u6301\u4e45\u5316\u7684\u6761\u4ef6\uff0c\u6ee1\u8db3\u9650\u5b9a\u65f6\u95f4\u8303\u56f4\u5185key\u7684\u53d8\u5316\u6570\u91cf\u8fbe\u5230\u6307\u5b9a\u6570\u91cf\u5373\u8fdb\u884c\u6301\u4e45\u5316 save second changes \u53c2\u6570 second\uff1a\u76d1\u63a7\u65f6\u95f4\u8303\u56f4 changes\uff1a\u76d1\u63a7key\u7684\u53d8\u5316\u91cf \u8303\u4f8b\uff1a save 900 1 save 300 10 save 60 10000 \u5176\u4ed6\u76f8\u5173\u914d\u7f6e\uff1a dbfilename filename dir path rdbcompression yes|no rdbchecksum yes|no stop-writes-on-bgsave-error yes|no save\u914d\u7f6e\u5de5\u4f5c\u539f\u7406 5.2.4 RDB\u4e09\u79cd\u542f\u52a8\u65b9\u5f0f\u5bf9\u6bd4 \u00b6 \u65b9\u5f0f save\u6307\u4ee4 bgsave\u6307\u4ee4 \u8bfb\u5199 \u540c\u6b65 \u5f02\u6b65 \u963b\u585e\u5ba2\u6237\u7aef\u6307\u4ee4 \u662f \u5426 \u989d\u5916\u5185\u5b58\u6d88\u8017 \u5426 \u662f \u542f\u52a8\u65b0\u8fdb\u7a0b \u5426 \u662f RDB\u7279\u6b8a\u542f\u52a8\u5f62\u5f0f \u670d\u52a1\u5668\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u91cd\u542f debug reload \u5173\u95ed\u670d\u52a1\u5668\u65f6\u6307\u5b9a\u4fdd\u5b58\u6570\u636e shutdown save \u5168\u91cf\u590d\u5236\uff08\u5728\u4e3b\u4ece\u590d\u5236\u4e2d\u8be6\u7ec6\u8bb2\u89e3\uff09 RDB\u4f18\u70b9\uff1a RDB\u662f\u4e00\u4e2a\u7d27\u51d1\u538b\u7f29\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5b58\u50a8\u6548\u7387\u8f83\u9ad8 RDB\u5185\u90e8\u5b58\u50a8\u7684\u662fredis\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\u7684\u6570\u636e\u5feb\u7167\uff0c\u975e\u5e38\u9002\u5408\u7528\u4e8e\u6570\u636e\u5907\u4efd\uff0c\u5168\u91cf\u590d\u5236\u7b49\u573a\u666f RDB\u6062\u590d\u6570\u636e\u7684\u901f\u5ea6\u8981\u6bd4AOF\u5feb\u5f88\u591a \u5e94\u7528\uff1a\u670d\u52a1\u5668\u4e2d\u6bcfX\u5c0f\u65f6\u6267\u884cbgsave\u5907\u4efd\uff0c\u5e76\u5c06RDB\u6587\u4ef6\u62f7\u8d1d\u5230\u8fdc\u7a0b\u673a\u5668\u4e2d\uff0c\u7528\u4e8e\u707e\u96be\u6062\u590d\u3002 RDB\u7f3a\u70b9 RDB\u65b9\u5f0f\u65e0\u8bba\u662f\u6267\u884c\u6307\u4ee4\u8fd8\u662f\u5229\u7528\u914d\u7f6e\uff0c\u65e0\u6cd5\u505a\u5230\u5b9e\u65f6\u6301\u4e45\u5316\uff0c\u5177\u6709\u8f83\u5927\u7684\u53ef\u80fd\u6027\u4e22\u5931\u6570\u636e bgsave\u6307\u4ee4\u6bcf\u6b21\u8fd0\u884c\u8981\u6267\u884cfork\u64cd\u4f5c\u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u8981\u727a\u7272\u6389\u4e00\u4e9b\u6027\u80fd Redis\u7684\u4f17\u591a\u7248\u672c\u4e2d\u672a\u8fdb\u884cRDB\u6587\u4ef6\u683c\u5f0f\u7684\u7248\u672c\u7edf\u4e00\uff0c\u6709\u53ef\u80fd\u51fa\u73b0\u5404\u7248\u672c\u670d\u52a1\u4e4b\u95f4\u6570\u636e\u683c\u5f0f\u65e0\u6cd5\u517c\u5bb9\u73b0\u8c61 5.3 AOF \u00b6 \u4e3a\u4ec0\u4e48\u8981\u6709AOF,\u8fd9\u5f97\u4eceRDB\u7684\u5b58\u50a8\u7684\u5f0a\u7aef\u8bf4\u8d77\uff1a \u5b58\u50a8\u6570\u636e\u91cf\u8f83\u5927\uff0c\u6548\u7387\u8f83\u4f4e\uff0c\u57fa\u4e8e\u5feb\u7167\u601d\u60f3\uff0c\u6bcf\u6b21\u8bfb\u5199\u90fd\u662f\u5168\u90e8\u6570\u636e\uff0c\u5f53\u6570\u636e\u91cf\u5de8\u5927\u65f6\uff0c\u6548\u7387\u975e\u5e38\u4f4e \u5927\u6570\u636e\u91cf\u4e0b\u7684IO\u6027\u80fd\u8f83\u4f4e \u57fa\u4e8efork\u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u5185\u5b58\u4ea7\u751f\u989d\u5916\u6d88\u8017 \u5b95\u673a\u5e26\u6765\u7684\u6570\u636e\u4e22\u5931\u98ce\u9669 \u90a3\u89e3\u51b3\u7684\u601d\u8def\u662f\u4ec0\u4e48\u5462\uff1f \u4e0d\u5199\u5168\u6570\u636e\uff0c\u4ec5\u8bb0\u5f55\u90e8\u5206\u6570\u636e \u964d\u4f4e\u533a\u5206\u6570\u636e\u662f\u5426\u6539\u53d8\u7684\u96be\u5ea6\uff0c\u6539\u8bb0\u5f55\u6570\u636e\u4e3a\u8bb0\u5f55\u64cd\u4f5c\u8fc7\u7a0b \u5bf9\u6240\u6709\u64cd\u4f5c\u5747\u8fdb\u884c\u8bb0\u5f55\uff0c\u6392\u9664\u4e22\u5931\u6570\u636e\u7684\u98ce\u9669 5.3.1 AOF\u6982\u5ff5 \u00b6 AOF (append only file)\u6301\u4e45\u5316\uff1a\u4ee5\u72ec\u7acb\u65e5\u5fd7\u7684\u65b9\u5f0f\u8bb0\u5f55\u6bcf\u6b21\u5199\u547d\u4ee4\uff0c\u91cd\u542f\u65f6\u518d\u91cd\u65b0\u6267\u884cAOF\u6587\u4ef6\u4e2d\u547d\u4ee4 \u8fbe\u5230\u6062\u590d\u6570\u636e\u7684\u76ee\u7684\u3002 \u4e0eRDB\u76f8\u6bd4\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u4e3a\u7531\u8bb0\u5f55\u6570\u636e\u6539\u4e3a\u8bb0\u5f55\u6570\u636e\u4ea7\u751f\u7684\u53d8\u5316 AOF\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u89e3\u51b3\u4e86\u6570\u636e\u6301\u4e45\u5316\u7684\u5b9e\u65f6\u6027\uff0c\u76ee\u524d\u5df2\u7ecf\u662fRedis\u6301\u4e45\u5316\u7684\u4e3b\u6d41\u65b9\u5f0f AOF\u5199\u6570\u636e\u8fc7\u7a0b \u542f\u52a8AOF\u76f8\u5173\u914d\u7f6e \u5f00\u542fAOF\u6301\u4e45\u5316\u529f\u80fd\uff0c\u9ed8\u8ba4no\uff0c\u5373\u4e0d\u5f00\u542f\u72b6\u6001 appendonly yes|no AOF\u6301\u4e45\u5316\u6587\u4ef6\u540d\uff0c\u9ed8\u8ba4\u6587\u4ef6\u540d\u4e3aappendonly.aof\uff0c\u5efa\u8bae\u914d\u7f6e\u4e3aappendonly-\u7aef\u53e3\u53f7.aof appendfilename filename AOF\u6301\u4e45\u5316\u6587\u4ef6\u4fdd\u5b58\u8def\u5f84\uff0c\u4e0eRDB\u6301\u4e45\u5316\u6587\u4ef6\u4fdd\u6301\u4e00\u81f4\u5373\u53ef dir AOF\u5199\u6570\u636e\u7b56\u7565\uff0c\u9ed8\u8ba4\u4e3aeverysec appendfsync always|everysec|no 5.3.2 AOF\u6267\u884c\u7b56\u7565 \u00b6 AOF\u5199\u6570\u636e\u4e09\u79cd\u7b56\u7565(appendfsync) always (\u6bcf\u6b21\uff09\uff1a\u6bcf\u6b21\u5199\u5165\u64cd\u4f5c\u5747\u540c\u6b65\u5230AOF\u6587\u4ef6\u4e2d\u6570\u636e\u96f6\u8bef\u5dee\uff0c\u6027\u80fd\u8f83\u4f4e\uff0c\u4e0d\u5efa\u8bae\u4f7f\u7528\u3002 everysec \uff08\u6bcf\u79d2\uff09\uff1a\u6bcf\u79d2\u5c06\u7f13\u51b2\u533a\u4e2d\u7684\u6307\u4ee4\u540c\u6b65\u5230AOF\u6587\u4ef6\u4e2d\uff0c\u5728\u7cfb\u7edf\u7a81\u7136\u5b95\u673a\u7684\u60c5\u51b5\u4e0b\u4e22\u59311\u79d2\u5185\u7684\u6570\u636e \u6570\u636e\u51c6\u786e\u6027\u8f83\u9ad8\uff0c\u6027\u80fd\u8f83\u9ad8\uff0c\u5efa\u8bae\u4f7f\u7528\uff0c\u4e5f\u662f\u9ed8\u8ba4\u914d\u7f6e no \uff08\u7cfb\u7edf\u63a7\u5236\uff09\uff1a\u7531\u64cd\u4f5c\u7cfb\u7edf\u63a7\u5236\u6bcf\u6b21\u540c\u6b65\u5230AOF\u6587\u4ef6\u7684\u5468\u671f\uff0c\u6574\u4f53\u8fc7\u7a0b\u4e0d\u53ef\u63a7 5.3.3 AOF\u91cd\u5199 \u00b6 \u573a\u666f\uff1aAOF\u5199\u6570\u636e\u9047\u5230\u7684\u95ee\u9898\uff0c\u5982\u679c\u8fde\u7eed\u6267\u884c\u5982\u4e0b\u6307\u4ee4\u8be5\u5982\u4f55\u5904\u7406 \u4ec0\u4e48\u53ebAOF\u91cd\u5199\uff1f \u968f\u7740\u547d\u4ee4\u4e0d\u65ad\u5199\u5165AOF\uff0c\u6587\u4ef6\u4f1a\u8d8a\u6765\u8d8a\u5927\uff0c\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cRedis\u5f15\u5165\u4e86AOF\u91cd\u5199\u673a\u5236\u538b\u7f29\u6587\u4ef6\u4f53\u79ef\u3002AOF\u6587\u4ef6\u91cd \u5199\u662f\u5c06Redis\u8fdb\u7a0b\u5185\u7684\u6570\u636e\u8f6c\u5316\u4e3a\u5199\u547d\u4ee4\u540c\u6b65\u5230\u65b0AOF\u6587\u4ef6\u7684\u8fc7\u7a0b\u3002\u7b80\u5355\u8bf4\u5c31\u662f\u5c06\u5bf9\u540c\u4e00\u4e2a\u6570\u636e\u7684\u82e5\u5e72\u4e2a\u6761\u547d\u4ee4\u6267\u884c\u7ed3 \u679c\u8f6c\u5316\u6210\u6700\u7ec8\u7ed3\u679c\u6570\u636e\u5bf9\u5e94\u7684\u6307\u4ee4\u8fdb\u884c\u8bb0\u5f55\u3002 AOF\u91cd\u5199\u4f5c\u7528 \u964d\u4f4e\u78c1\u76d8\u5360\u7528\u91cf\uff0c\u63d0\u9ad8\u78c1\u76d8\u5229\u7528\u7387 \u63d0\u9ad8\u6301\u4e45\u5316\u6548\u7387\uff0c\u964d\u4f4e\u6301\u4e45\u5316\u5199\u65f6\u95f4\uff0c\u63d0\u9ad8IO\u6027\u80fd \u964d\u4f4e\u6570\u636e\u6062\u590d\u7528\u65f6\uff0c\u63d0\u9ad8\u6570\u636e\u6062\u590d\u6548\u7387 AOF\u91cd\u5199\u89c4\u5219 \u8fdb\u7a0b\u5185\u5177\u6709\u65f6\u6548\u6027\u7684\u6570\u636e\uff0c\u5e76\u4e14\u6570\u636e\u5df2\u8d85\u65f6\u5c06\u4e0d\u518d\u5199\u5165\u6587\u4ef6 \u975e\u5199\u5165\u7c7b\u7684\u65e0\u6548\u6307\u4ee4\u5c06\u88ab\u5ffd\u7565\uff0c\u53ea\u4fdd\u7559\u6700\u7ec8\u6570\u636e\u7684\u5199\u5165\u547d\u4ee4 \u5982del key1\u3001 hdel key2\u3001srem key3\u3001set key4 111\u3001set key4 222\u7b49 \u5982select\u6307\u4ee4\u867d\u7136\u4e0d\u66f4\u6539\u6570\u636e\uff0c\u4f46\u662f\u66f4\u6539\u4e86\u6570\u636e\u7684\u5b58\u50a8\u4f4d\u7f6e\uff0c\u6b64\u7c7b\u547d\u4ee4\u540c\u6837\u9700\u8981\u8bb0\u5f55 \u5bf9\u540c\u4e00\u6570\u636e\u7684\u591a\u6761\u5199\u547d\u4ee4\u5408\u5e76\u4e3a\u4e00\u6761\u547d\u4ee4 \u5982lpushlist1 a\u3001lpush list1 b\u3001lpush list1 c\u53ef\u4ee5\u8f6c\u5316\u4e3a\uff1alpush list1 a b c\u3002 \u4e3a\u9632\u6b62\u6570\u636e\u91cf\u8fc7\u5927\u9020\u6210\u5ba2\u6237\u7aef\u7f13\u51b2\u533a\u6ea2\u51fa\uff0c\u5bf9list\u3001set\u3001hash\u3001zset\u7b49\u7c7b\u578b\uff0c\u6bcf\u6761\u6307\u4ee4\u6700\u591a\u5199\u516564\u4e2a\u5143\u7d20 AOF\u91cd\u5199\u65b9\u5f0f \u624b\u52a8\u91cd\u5199 bgrewriteaof \u624b\u52a8\u91cd\u5199\u539f\u7406\u5206\u6790\uff1a \u81ea\u52a8\u91cd\u5199 auto-aof-rewrite-min-size size auto-aof-rewrite-percentage percentage \u81ea\u52a8\u91cd\u5199\u89e6\u53d1\u6761\u4ef6\u8bbe\u7f6e auto-aof-rewrite-min-size size auto-aof-rewrite-percentage percent \u81ea\u52a8\u91cd\u5199\u89e6\u53d1\u6bd4\u5bf9\u53c2\u6570\uff08 \u8fd0\u884c\u6307\u4ee4info Persistence\u83b7\u53d6\u5177\u4f53\u4fe1\u606f \uff09 aof_current_size aof_base_size \u81ea\u52a8\u91cd\u5199\u89e6\u53d1\u6761\u4ef6\u516c\u5f0f\uff1a 5.3.4 AOF\u5de5\u4f5c\u6d41\u7a0b\u53ca\u91cd\u5199\u6d41\u7a0b \u00b6 5.4 RDB\u4e0eAOF\u533a\u522b \u00b6 5.4.1 RDB\u4e0eAOF\u5bf9\u6bd4\uff08\u4f18\u7f3a\u70b9\uff09 \u00b6 \u6301\u4e45\u5316\u65b9\u5f0f RDB AOF \u5360\u7528\u5b58\u50a8\u7a7a\u95f4 \u5c0f\uff08\u6570\u636e\u7ea7\uff1a\u538b\u7f29\uff09 \u5927\uff08\u6307\u4ee4\u7ea7\uff1a\u91cd\u5199\uff09 \u5b58\u50a8\u901f\u5ea6 \u6162 \u5feb \u6062\u590d\u901f\u5ea6 \u5feb \u6162 \u6570\u636e\u5b89\u5168\u6027 \u4f1a\u4e22\u5931\u6570\u636e \u4f9d\u636e\u7b56\u7565\u51b3\u5b9a \u8d44\u6e90\u6d88\u8017 \u9ad8/\u91cd\u91cf\u7ea7 \u4f4e/\u8f7b\u91cf\u7ea7 \u542f\u52a8\u4f18\u5148\u7ea7 \u4f4e \u9ad8 5.4.2 RDB\u4e0eAOF\u5e94\u7528\u573a\u666f \u00b6 RDB\u4e0eAOF\u7684\u9009\u62e9\u4e4b\u60d1 \u5bf9\u6570\u636e\u975e\u5e38\u654f\u611f\uff0c\u5efa\u8bae\u4f7f\u7528\u9ed8\u8ba4\u7684AOF\u6301\u4e45\u5316\u65b9\u6848 AOF\u6301\u4e45\u5316\u7b56\u7565\u4f7f\u7528everysecond\uff0c\u6bcf\u79d2\u949ffsync\u4e00\u6b21\u3002\u8be5\u7b56\u7565redis\u4ecd\u53ef\u4ee5\u4fdd\u6301\u5f88\u597d\u7684\u5904\u7406\u6027\u80fd\uff0c\u5f53\u51fa \u73b0\u95ee\u9898\u65f6\uff0c\u6700\u591a\u4e22\u59310-1\u79d2\u5185\u7684\u6570\u636e\u3002 \u6ce8\u610f\uff1a\u7531\u4e8eAOF\u6587\u4ef6\u5b58\u50a8\u4f53\u79ef\u8f83\u5927\uff0c\u4e14\u6062\u590d\u901f\u5ea6\u8f83\u6162 \u6570\u636e\u5448\u73b0\u9636\u6bb5\u6709\u6548\u6027\uff0c\u5efa\u8bae\u4f7f\u7528RDB\u6301\u4e45\u5316\u65b9\u6848 \u6570\u636e\u53ef\u4ee5\u826f\u597d\u7684\u505a\u5230\u9636\u6bb5\u5185\u65e0\u4e22\u5931\uff08\u8be5\u9636\u6bb5\u662f\u5f00\u53d1\u8005\u6216\u8fd0\u7ef4\u4eba\u5458\u624b\u5de5\u7ef4\u62a4\u7684\uff09\uff0c\u4e14\u6062\u590d\u901f\u5ea6\u8f83\u5feb\uff0c\u9636\u6bb5 \u70b9\u6570\u636e\u6062\u590d\u901a\u5e38\u91c7\u7528RDB\u65b9\u6848 \u6ce8\u610f\uff1a\u5229\u7528RDB\u5b9e\u73b0\u7d27\u51d1\u7684\u6570\u636e\u6301\u4e45\u5316\u4f1a\u4f7fRedis\u964d\u7684\u5f88\u4f4e\uff0c\u614e\u91cd\u603b\u7ed3\uff1a \u7efc\u5408\u6bd4\u5bf9 RDB\u4e0eAOF\u7684\u9009\u62e9\u5b9e\u9645\u4e0a\u662f\u5728\u505a\u4e00\u79cd\u6743\u8861\uff0c\u6bcf\u79cd\u90fd\u6709\u5229\u6709\u5f0a \u5982\u4e0d\u80fd\u627f\u53d7\u6570\u5206\u949f\u4ee5\u5185\u7684\u6570\u636e\u4e22\u5931\uff0c\u5bf9\u4e1a\u52a1\u6570\u636e\u975e\u5e38\u654f\u611f\uff0c\u9009\u7528AOF \u5982\u80fd\u627f\u53d7\u6570\u5206\u949f\u4ee5\u5185\u7684\u6570\u636e\u4e22\u5931\uff0c\u4e14\u8ffd\u6c42\u5927\u6570\u636e\u96c6\u7684\u6062\u590d\u901f\u5ea6\uff0c\u9009\u7528RDB \u707e\u96be\u6062\u590d\u9009\u7528RDB \u53cc\u4fdd\u9669\u7b56\u7565\uff0c\u540c\u65f6\u5f00\u542f RDB\u548c AOF\uff0c\u91cd\u542f\u540e\uff0cRedis\u4f18\u5148\u4f7f\u7528 AOF \u6765\u6062\u590d\u6570\u636e\uff0c\u964d\u4f4e\u4e22\u5931\u6570\u636e\u7684\u91cf # \u5ba2\u6237\u7aef\u600e\u4e48\u8bbf\u95ee\u90fd\u884c bind 0 .0.0.0 port 6379 timeout 0 # \u540e\u53f0\u542f\u52a8 daemonize yes logfile \"log_6379.log\" dir /usr/local/redis/data # rdb \u65b9\u5f0f\u6587\u4ef6\u540d\u79f0 dbfilename \"dump6379.rdb\" # \u5b58\u50a8\u7b56\u7565 2s \u4e2d\u5185\u5982\u679c\u6709\u4e24\u4e2a \u4fee\u6539\u547d\u4ee4 \u5219\u6267\u884c\u5b58\u50a8 save 2 2 # aop \u914d\u7f6e appendonly yes appendfilename \"dump6379.aof\" appendfsync always # aof \u81ea\u52a8\u91cd\u5199 # \u6bcf4M \u6570\u636e \u91cd\u5199\u4e00\u6b21 auto-aof-rewrite-min-size 4mb # \u548c\u4e0a\u6b21\u5907\u4efd\u505a\u5bf9\u6bd4,\u5982\u679c \u8d85\u8fc7\u4e8610% \u5219\u91cd\u5199\u6587\u4ef6 auto-aof-rewrite-percentage 10 %","title":"day01"},{"location":"redis/day01/#1_redis","text":"","title":"1. Redis \u7b80\u4ecb"},{"location":"redis/day01/#redis","text":"\u672c\u8bfe\u7a0b\u6240\u793a\uff0c\u5747\u57fa\u4e8eCenter OS7\u5b89\u88c5Redis\u3002 0 ) \u5982\u679c wget \u547d\u4ee4\u627e\u4e0d\u5230 yum - y install wget 0 ) \u5982\u679cmake \u62a5\u9519 \u5b89\u88c5 c \u8bed\u8a00\u7f16\u8bd1\u73af\u5883 yum install gcc - c ++ (1)\u4e0b\u8f7dRedis \u4e0b\u8f7d\u5b89\u88c5\u5305\uff1a wget http://download.redis.io/releases/redis-5.0.0.tar.gz \u89e3\u538b\u5b89\u88c5\u5305\uff1a tar -xvf redis-5.0.0.tar.gz \u7f16\u8bd1\uff08\u5728\u89e3\u538b\u7684\u76ee\u5f55\u4e2d\u6267\u884c\uff09\uff1a make \u5b89\u88c5\uff08\u5728\u89e3\u538b\u7684\u76ee\u5f55\u4e2d\u6267\u884c\uff09\uff1a make install \uff082\uff09\u5b89\u88c5 Redis redis-server\uff0c\u670d\u52a1\u5668\u542f\u52a8\u547d\u4ee4 \u5ba2\u6237\u7aef\u542f\u52a8\u547d\u4ee4 redis-cli\uff0credis\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6 redis.conf\uff0cRDB\u6587\u4ef6\u68c0\u67e5\u5de5\u5177\uff08\u5feb\u7167\u6301\u4e45\u5316\u6587\u4ef6\uff09 redis-check-dump\uff0cAOF\u6587\u4ef6\u4fee\u590d\u5de5\u5177 redis-check-aof","title":"Redis \u7684\u4e0b\u8f7d\u4e0e\u5b89\u88c5"},{"location":"redis/day01/#redis_1","text":"","title":"Redis\u670d\u52a1\u5668\u542f\u52a8"},{"location":"redis/day01/#redis_2","text":"\u542f\u52a8\u670d\u52a1\u5668\u2014\u2014\u53c2\u6570\u542f\u52a8 redis-server [ --port port ] \u8303\u4f8b redis-server --port 6379 \u542f\u52a8\u670d\u52a1\u5668\u2014\u2014\u914d\u7f6e\u6587\u4ef6\u542f\u52a8 redis-server config_file_name \u8303\u4f8b redis-server redis.conf","title":"Redis\u670d\u52a1\u5668\u542f\u52a8"},{"location":"redis/day01/#redis_3","text":"\u542f\u52a8\u5ba2\u6237\u7aef redis-cli [ -h host ] [ -p port ] \u8303 \u4f8b redis-cli -h 61 .129.65.248 -p 6384 \u6ce8\u610f\uff1a\u670d\u52a1\u5668\u542f\u52a8\u6307\u5b9a\u7aef\u53e3\u4f7f\u7528\u7684\u662f--port\uff0c\u5ba2\u6237\u7aef\u542f\u52a8\u6307\u5b9a\u7aef\u53e3\u4f7f\u7528\u7684\u662f-p\u3002-\u7684\u6570\u91cf\u4e0d\u540c\u3002","title":"Redis\u5ba2\u6237\u7aef\u542f\u52a8"},{"location":"redis/day01/#redis_4","text":"\u521b\u5efa\u914d\u7f6e\u6587\u4ef6\u5b58\u50a8\u76ee\u5f55 mkdir conf \u521b\u5efa\u670d\u52a1\u5668\u6587\u4ef6\u5b58\u50a8\u76ee\u5f55\uff08\u5305\u542b\u65e5\u5fd7\u3001\u6570\u636e\u3001\u4e34\u65f6\u914d\u7f6e\u6587\u4ef6\u7b49\uff09 mkdir data \u521b\u5efa\u5feb\u901f\u8bbf\u95ee\u94fe\u63a5 ln -s redis-5.0.0 redis","title":"Redis\u57fa\u7840\u73af\u5883\u8bbe\u7f6e\u7ea6\u5b9a"},{"location":"redis/day01/#_1","text":"# \u67e5\u770b\u914d\u7f6e\u547d\u4ee4 cat redis.conf | grep -v '#' | grep -v '^$' # \u90a3\u4e9bip \u80fd\u8bbf\u95eeredis #bind 127.0.0.1 # \u7aef\u53e3\u53f7 port 6379 # \u8d85\u65f6\u65f6\u95f4 #timeout 0 # \u662f\u5426\u540e\u53f0\u542f\u52a8 daemonize yes # \u65e5\u5fd7\u6587\u4ef6 logfile \"log_6379.log\" # \u6570\u636e\u6587\u4ef6\u4f4d\u7f6e dir /usr/local/redis/data","title":"\u914d\u7f6e\u6587\u4ef6\u542f\u52a8\u4e0e\u5e38\u7528\u914d\u7f6e"},{"location":"redis/day01/#_2","text":"\u8bbe\u7f6e\u670d\u52a1\u5668\u4ee5\u5b88\u62a4\u8fdb\u7a0b\u7684\u65b9\u5f0f\u8fd0\u884c\uff0c\u5f00\u542f\u540e\u670d\u52a1\u5668\u63a7\u5236\u53f0\u4e2d\u5c06\u6253\u5370\u670d\u52a1\u5668\u8fd0\u884c\u4fe1\u606f\uff08\u540c\u65e5\u5fd7\u5185\u5bb9\u76f8\u540c\uff09 daemonize yes | no \u7ed1\u5b9a\u4e3b\u673a\u5730\u5740 bind ip \u8bbe\u7f6e\u670d\u52a1\u5668\u7aef\u53e3 port port \u8bbe\u7f6e\u670d\u52a1\u5668\u6587\u4ef6\u4fdd\u5b58\u5730\u5740 dir path","title":"\u670d\u52a1\u5668\u7aef\u8bbe\u5b9a"},{"location":"redis/day01/#_3","text":"\u670d\u52a1\u5668\u5141\u8bb8\u5ba2\u6237\u7aef\u8fde\u63a5\u6700\u5927\u6570\u91cf\uff0c\u9ed8\u8ba40\uff0c\u8868\u793a\u65e0\u9650\u5236\u3002\u5f53\u5ba2\u6237\u7aef\u8fde\u63a5\u5230\u8fbe\u4e0a\u9650\u540e\uff0cRedis\u4f1a\u62d2\u7edd\u65b0\u7684\u8fde\u63a5 maxclients count \u5ba2\u6237\u7aef\u95f2\u7f6e\u7b49\u5f85\u6700\u5927\u65f6\u957f\uff0c\u8fbe\u5230\u6700\u5927\u503c\u540e\u5173\u95ed\u5bf9\u5e94\u8fde\u63a5\u3002\u5982\u9700\u5173\u95ed\u8be5\u529f\u80fd\uff0c\u8bbe\u7f6e\u4e3a 0 timeout seconds","title":"\u5ba2\u6237\u7aef\u914d\u7f6e"},{"location":"redis/day01/#_4","text":"\u8bbe\u7f6e\u670d\u52a1\u5668\u4ee5\u6307\u5b9a\u65e5\u5fd7\u8bb0\u5f55\u7ea7\u522b loglevel debug | verbose | notice | warning \u65e5\u5fd7\u8bb0\u5f55\u6587\u4ef6\u540d logfile filename \u6ce8\u610f\uff1a\u65e5\u5fd7\u7ea7\u522b\u5f00\u53d1\u671f\u8bbe\u7f6e\u4e3averbose\u5373\u53ef\uff0c\u751f\u4ea7\u73af\u5883\u4e2d\u914d\u7f6e\u4e3anotice\uff0c\u7b80\u5316\u65e5\u5fd7\u8f93\u51fa\u91cf\uff0c\u964d\u4f4e\u5199\u65e5\u5fd7IO\u7684\u9891\u5ea6\u3002","title":"\u65e5\u5fd7\u914d\u7f6e"},{"location":"redis/day01/#redis_5","text":"","title":"Redis\u57fa\u672c\u64cd\u4f5c"},{"location":"redis/day01/#_5","text":"\u529f\u80fd\u6027\u547d\u4ee4 \u5e2e\u52a9\u4fe1\u606f\u67e5\u9605 \u9000\u51fa\u6307\u4ee4 \u6e05\u9664\u5c4f\u5e55\u4fe1\u606f","title":"\u547d\u4ee4\u884c\u6a21\u5f0f\u5de5\u5177\u4f7f\u7528\u601d\u8003"},{"location":"redis/day01/#_6","text":"\u8bbe\u7f6e key\uff0cvalue \u6570\u636e set key value \u8303\u4f8b set name itheima \u6839\u636e key \u67e5\u8be2\u5bf9\u5e94\u7684 value\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u8fd4\u56de\u7a7a\uff08nil\uff09 get key \u8303\u4f8b get name","title":"\u4fe1\u606f\u8bfb\u5199"},{"location":"redis/day01/#_7","text":"\u83b7\u53d6\u547d\u4ee4\u5e2e\u52a9\u6587\u6863 help [ command ] \u8303\u4f8b help set \u83b7\u53d6\u7ec4\u4e2d\u6240\u6709\u547d\u4ee4\u4fe1\u606f\u540d\u79f0 help [ @group-name ] \u8303\u4f8b help @string \u9000\u51fa\u547d\u4ee4\u884c\u5ba2\u6237\u7aef\u6a21\u5f0f \u9000\u51fa\u5ba2\u6237\u7aef quit exit \u5feb\u6377\u952e Ctrl+C","title":"\u5e2e\u52a9\u4fe1\u606f"},{"location":"redis/day01/#164_redis","text":"\u5230\u8fd9\u91cc\uff0cRedis \u5165\u95e8\u7684\u76f8\u5173\u77e5\u8bc6\uff0c\u6211\u4eec\u5c31\u5168\u90e8\u5b66\u4e60\u5b8c\u4e86\uff0c\u518d\u6765\u56de\u987e\u4e00\u4e0b\uff0c\u8fd9\u4e2a\u90e8\u5206\u6211\u4eec\u4e3b\u8981\u8bb2\u89e3\u4e86\u54ea\u4e9b\u5185\u5bb9\u5462\uff1f \u9996\u5148\uff0c\u6211\u4eec\u5bf9Redis\u8fdb\u884c\u4e86\u4e00\u4e2a\u7b80\u5355\u4ecb\u7ecd\uff0c\u5305\u62ecNoSQL\u7684\u6982\u5ff5\u3001Redis\u7684\u6982\u5ff5\u7b49\u3002 \u7136\u540e\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86Redis \u7684\u4e0b\u8f7d\u4e0e\u5b89\u88c5\u3002\u5305\u62ec\u4e0b\u8f7d\u4e0e\u5b89\u88c5\u3001\u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u542f\u52a8\u3001\u4ee5\u53ca\u76f8\u5173\u914d\u7f6e\u6587\u4ef6\uff083\u7c7b\uff09\u3002 \u6700\u540e\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86Redis \u7684\u57fa\u672c\u64cd\u4f5c\u3002\u5305\u62ec\u6570\u636e\u8bfb\u5199\u3001\u9000\u51fa\u4e0e\u5e2e\u52a9\u4fe1\u606f\u83b7\u53d6\u3002","title":"1.6.4  redis\u5165\u95e8\u603b\u7ed3"},{"location":"redis/day01/#2","text":"","title":"2. \u6570\u636e\u7c7b\u578b"},{"location":"redis/day01/#21_redis_5","text":"\u57fa\u4e8e\u4ee5\u4e0a\u6570\u636e\u7279\u5f81\u6211\u4eec\u8fdb\u884c\u5206\u6790\uff0c\u6700\u7ec8\u5f97\u51fa\u6765\u6211\u4eec\u7684Redis\u4e2d\u8981\u8bbe\u8ba15\u79cd \u6570\u636e\u7c7b\u578b\uff1a string\u3001hash\u3001list\u3001set\u3001sorted_set/zset\uff08\u5e94\u7528\u6027\u8f83\u4f4e\uff09","title":"2.1  Redis \u6570\u636e\u7c7b\u578b(5\u79cd\u5e38\u7528)"},{"location":"redis/day01/#22_string","text":"\u5728\u5b66\u4e60\u7b2c\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\u4e4b\u524d\uff0c\u5148\u7ed9\u5927\u5bb6\u4ecb\u7ecd\u4e00\u4e0b\uff0c\u5728\u968f\u540e\u8fd9\u90e8\u5206\u5185\u5bb9\u7684\u5b66\u4e60\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u6bcf\u4e00\u79cd\u6570\u636e\u7c7b\u578b\u90fd\u5206\u6210\u4e09\u5757\u6765\u8bb2\uff1a\u9996\u5148\u662f\u8bb2\u4e0b\u5b83\u7684\u57fa\u672c\u64cd\u4f5c\uff0c\u63a5\u4e0b\u6765\u8bb2\u4e00\u4e9b\u5b83\u7684\u6269\u5c55\u64cd\u4f5c\uff0c\u6700\u540e\u6211\u4eec\u4f1a\u53bb\u505a\u4e00\u4e2a\u5c0f\u7684\u6848\u4f8b\u5206\u6790\u3002","title":"2.2  string\u6570\u636e\u7c7b\u578b"},{"location":"redis/day01/#221redis","text":"\u5728\u5b66\u4e60string\u8fd9\u4e2a\u6570\u636e\u5f62\u5f0f\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u8981\u660e\u767dstring\u5230\u5e95\u662f\u4fee\u9970\u4ec0\u4e48\u7684\u3002\u6211\u4eec\u77e5\u9053redis \u81ea\u8eab\u662f\u4e00\u4e2a Map\uff0c\u5176\u4e2d\u6240\u6709\u7684\u6570\u636e\u90fd\u662f\u91c7\u7528 key : value \u7684\u5f62\u5f0f\u5b58\u50a8\u3002 \u5bf9\u4e8e\u8fd9\u79cd\u7ed3\u6784\u6765\u8bf4\uff0c\u6211\u4eec\u7528\u6765\u5b58\u50a8\u6570\u636e\u4e00\u5b9a\u662f\u4e00\u4e2a\u503c\u524d\u9762\u5bf9\u5e94\u4e00\u4e2a\u540d\u79f0\u3002\u6211\u4eec\u901a\u8fc7\u540d\u79f0\u6765\u8bbf\u95ee\u540e\u9762\u7684\u503c\u3002\u6309\u7167\u8fd9\u79cd\u5f62\u52bf\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u51fa\u6765\u6211\u4eec\u7684\u5b58\u50a8\u683c\u5f0f\u3002\u524d\u9762\u8fd9\u4e00\u90e8\u5206\u6211\u4eec\u79f0\u4e3akey\u3002\u540e\u9762\u7684\u4e00\u90e8\u5206\u79f0\u4e3avalue\uff0c\u800c\u6211\u4eec\u7684\u6570\u636e\u7c7b\u578b\uff0c\u4ed6\u4e00\u5b9a\u662f\u4fee\u9970value\u7684\u3002 \u6570\u636e\u7c7b\u578b\u6307\u7684\u662f\u5b58\u50a8\u7684\u6570\u636e\u7684\u7c7b\u578b\uff0c\u4e5f\u5c31\u662f value \u90e8\u5206\u7684\u7c7b\u578b\uff0ckey \u90e8\u5206\u6c38\u8fdc\u90fd\u662f\u5b57\u7b26\u4e32\u3002","title":"2.2.1Redis \u6570\u636e\u5b58\u50a8\u683c\u5f0f"},{"location":"redis/day01/#222_string","text":"\uff081\uff09\u5b58\u50a8\u7684\u6570\u636e\uff1a\u5355\u4e2a\u6570\u636e\uff0c\u6700\u7b80\u5355\u7684\u6570\u636e\u5b58\u50a8\u7c7b\u578b\uff0c\u4e5f\u662f\u6700\u5e38\u7528\u7684\u6570\u636e\u5b58\u50a8\u7c7b\u578b\u3002 string\uff0c\u4ed6\u5c31\u662f\u5b58\u4e00\u4e2a\u5b57\u7b26\u4e32\u513f\uff0c\u6ce8\u610f\u662fvalue\u90a3\u4e00\u90e8\u5206\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5b83\u662fredis\u4e2d\u6700\u57fa\u672c\u3001\u6700\u7b80\u5355\u7684\u5b58\u50a8\u6570\u636e\u7684\u683c\u5f0f\u3002 \uff082\uff09\u5b58\u50a8\u6570\u636e\u7684\u683c\u5f0f\uff1a\u4e00\u4e2a\u5b58\u50a8\u7a7a\u95f4\u4fdd\u5b58\u4e00\u4e2a\u6570\u636e \u6bcf\u4e00\u4e2a\u7a7a\u95f4\u4e2d\u53ea\u80fd\u4fdd\u5b58\u4e00\u4e2a\u5b57\u7b26\u4e32\u4fe1\u606f\uff0c\u8fd9\u4e2a\u4fe1\u606f\u91cc\u8fb9\u5982\u679c\u662f\u5b58\u7684\u7eaf\u6570\u5b57\uff0c\u4ed6\u4e5f\u80fd\u5f53\u6570\u5b57\u4f7f\u7528\uff0c\u6211\u4eec\u6765\u770b\u4e00\u4e0b\uff0c\u8fd9\u662f\u6211\u4eec\u7684\u6570\u636e\u7684\u5b58\u50a8\u7a7a\u95f4\u3002 \uff083\uff09\u5b58\u50a8\u5185\u5bb9\uff1a\u901a\u5e38\u4f7f\u7528\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u5b57\u7b26\u4e32\u4ee5\u6574\u6570\u7684\u5f62\u5f0f\u5c55\u793a\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u6570\u5b57\u64cd\u4f5c\u4f7f\u7528. \u4e00\u4e2akey\u5bf9\u4e00\u4e2avalue\uff0c\u800c\u8fd9\u4e2aitheima\u5c31\u662f\u6211\u4eec\u6240\u8bf4\u7684string\u7c7b\u578b\uff0c\u5f53\u7136\u5b83\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u7eaf\u6570\u5b57\u7684\u683c\u5f0f\u3002","title":"2.2.2  string \u7c7b\u578b"},{"location":"redis/day01/#223_string","text":"\uff081\uff09\u57fa\u7840\u6307\u4ee4 \u6dfb\u52a0/\u4fee\u6539\u6570\u636e\u6dfb\u52a0/\u4fee\u6539\u6570\u636e set key value \u83b7\u53d6\u6570\u636e get key \u5220\u9664\u6570\u636e del key \u5224\u5b9a\u6027\u6dfb\u52a0\u6570\u636e setnx key value \u6dfb\u52a0/\u4fee\u6539\u591a\u4e2a\u6570\u636e mset key1 value1 key2 value2 \u2026 \u83b7\u53d6\u591a\u4e2a\u6570\u636e mget key1 key2 \u2026 \u83b7\u53d6\u6570\u636e\u5b57\u7b26\u4e2a\u6570\uff08\u5b57\u7b26\u4e32\u957f\u5ea6\uff09 strlen key \u8ffd\u52a0\u4fe1\u606f\u5230\u539f\u59cb\u4fe1\u606f\u540e\u90e8\uff08\u5982\u679c\u539f\u59cb\u4fe1\u606f\u5b58\u5728\u5c31\u8ffd\u52a0\uff0c\u5426\u5219\u65b0\u5efa\uff09 append key value \uff082\uff09\u5355\u6570\u636e\u64cd\u4f5c\u4e0e\u591a\u6570\u636e\u64cd\u4f5c\u7684\u9009\u62e9\u4e4b\u60d1 \u5373set \u4e0emset\u7684\u5173\u7cfb\u3002\u8fd9\u5bf9\u4e8e\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u6765\u8bf4\uff0c\u6ca1\u6709\u4ec0\u4e48\u4f60\u5e94\u8be5\u9009\u54ea\u4e2a\uff0c\u800c\u662f\u4ed6\u4eec\u81ea\u5df1\u7684\u7279\u5f81\u662f\u4ec0\u4e48\uff0c\u4f60\u8981\u6839\u636e\u8fd9\u4e2a\u7279\u5f81\u53bb\u6bd4\u5bf9\u4f60\u7684\u4e1a\u52a1\uff0c\u770b\u770b\u7a76\u7adf\u9002\u7528\u4e8e\u54ea\u4e2a\u3002 \u5047\u5982\u8bf4\u8fd9\u662f\u6211\u4eec\u73b0\u5728\u7684\u670d\u52a1\u5668\uff0c\u4ed6\u8981\u5411redis\u8981\u6570\u636e\u7684\u8bdd\uff0c\u5b83\u4f1a\u53d1\u51fa\u4e00\u6761\u6307\u4ee4\u3002\u90a3\u4e48\u5f53\u8fd9\u6761\u6307\u4ee4\u53d1\u8fc7\u6765\u7684\u65f6\u5019\uff0c\u6bd4\u5982\u8bf4\u662f\u8fd9\u4e2aset\u6307\u4ee4\u8fc7\u6765\uff0c\u90a3\u4e48\u5b83\u4f1a\u628a\u8fd9\u4e2a\u7ed3\u679c\u8fd4\u56de\u7ed9\u4f60\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u8981\u601d\u8003\u8fd9\u91cc\u8fb9\u4e00\u5171\u7ecf\u8fc7\u4e86\u591a\u957f\u65f6\u95f4\u3002 \u9996\u5148\uff0c\u53d1\u9001set\u6307\u4ee4\u8981\u65f6\u95f4\uff0c\u8fd9\u662f\u7f51\u7edc\u7684\u4e00\u4e2a\u65f6\u95f4\uff0c\u63a5\u4e0b\u6765redis\u8981\u53bb\u8fd0\u884c\u8fd9\u4e2a\u6307\u4ee4\u8981\u6d88\u8017\u65f6\u95f4\uff0c\u6700\u7ec8\u628a\u8fd9\u4e2a\u7ed3\u679c\u8fd4\u56de\u7ed9\u4f60\u53c8\u6709\u4e00\u4e2a\u65f6\u95f4\uff0c\u8fd9\u4e2a\u65f6\u95f4\u53c8\u662f\u4e00\u4e2a\u7f51\u7edc\u7684\u65f6\u95f4\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u7406\u89e3\u4e3a\uff1a\u4e00\u4e2a\u6307\u4ee4\u53d1\u9001\u7684\u8fc7\u7a0b\u4e2d\u9700\u8981\u6d88\u8017\u8fd9\u6837\u7684\u65f6\u95f4. \u4f46\u662f\u5982\u679c\u8bf4\u73b0\u5728\u4e0d\u662f\u4e00\u6761\u6307\u4ee4\u4e86\uff0c\u4f60\u8981\u53d13\u4e2aset\u7684\u8bdd\uff0c\u8fd8\u8981\u591a\u957f\u65f6\u95f4\u5462\uff1f\u5bf9\u5e94\u7684\u53d1\u9001\u65f6\u95f4\u8981\u4e583\u4e86\uff0c\u56e0\u4e3a\u8fd9\u662f\u4e09\u4e2a\u5355\u6761\u6307\u4ee4,\u800c\u8fd0\u884c\u7684\u64cd\u4f5c\u65f6\u95f4\u5462\uff0c\u5b83\u4e5f\u8981\u4e583\u4e86\uff0c\u4f46\u6700\u7ec8\u8fd4\u56de\u7684\u4e5f\u8981\u53d13\u6b21\uff0c\u6240\u4ee5\u8fd9\u8fb9\u4e5f\u8981\u4e583\u3002 \u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u7ed3\u8bba\uff1a\u5355\u6307\u4ee4\u53d13\u6761\u5b83\u9700\u8981\u7684\u65f6\u95f4\uff0c\u5047\u5b9a\u4ed6\u4eec\u4e24\u4e2a\u4e00\u6837\uff0c\u662f6\u4e2a\u7f51\u7edc\u65f6\u95f4\u52a03\u4e2a\u5904\u7406\u65f6\u95f4\uff0c\u5982\u679c\u6211\u4eec\u628a\u5b83\u5408\u6210\u4e00\u4e2amset\u5462\uff0c\u6211\u4eec\u60f3\u4e00\u60f3\u3002 \u5047\u5982\u8bf4\u7528\u591a\u6307\u4ee4\u53d13\u4e2a\u6307\u4ee4\u7684\u8bdd\uff0c\u5176\u5b9e\u53ea\u9700\u8981\u53d1\u4e00\u6b21\u5c31\u884c\u4e86\u3002\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u7ed3\u8bba\uff0c\u591a\u6307\u4ee4\u53d13\u4e2a\u6307\u4ee4\u7684\u8bdd\uff0c\u5176\u5b9e\u5b83\u662f\u4e24\u4e2a\u7f51\u7edc\u65f6\u95f4\u52a0\u4e0a3\u4e2aredis\u7684\u64cd\u4f5c\u65f6\u95f4\uff0c\u4e3a\u4ec0\u4e48\u8fd9\u5199\u4e00\u4e2a\u5c0f\u52a0\u53f7\u5462\uff0c\u5c31\u662f\u56e0\u4e3a\u6bd5\u7adf\u53d1\u7684\u4fe1\u606f\u91cf\u53d8\u5927\u4e86\uff0c\u6240\u4ee5\u7f51\u7edc\u65f6\u95f4\u6709\u53ef\u80fd\u4f1a\u53d8\u957f\u3002 \u90a3\u4e48\u901a\u8fc7\u8fd9\u5f20\u56fe\uff0c\u4f60\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u7ed3\u8bba\uff0c\u6211\u4eec\u5355\u6307\u4ee4\u548c\u591a\u6307\u4ee4\u4ed6\u4eec\u7684\u5dee\u522b\u5c31\u5728\u4e8e\u4f60\u53d1\u9001\u7684\u6b21\u6570\u662f\u591a\u8fd8\u662f\u5c11\u3002\u5f53\u4f60\u5f71\u54cd\u7684\u6570\u636e\u6bd4\u8f83\u5c11\u7684\u65f6\u5019\uff0c\u4f60\u53ef\u4ee5\u7528\u5355\u6307\u4ee4\uff0c\u4e5f\u53ef\u4ee5\u7528\u591a\u6307\u4ee4\u3002\u4f46\u662f\u4e00\u65e6\u8fd9\u4e2a\u91cf\u5927\u4e86\uff0c\u4f60\u5c31\u8981\u9009\u62e9\u591a\u6307\u4ee4\u4e86\uff0c\u4ed6\u7684\u6548\u7387\u4f1a\u9ad8\u4e00\u4e9b\u3002","title":"2.2.3  string \u7c7b\u578b\u6570\u636e\u7684\u57fa\u672c\u64cd\u4f5c"},{"location":"redis/day01/#23_string","text":"","title":"2.3  string \u7c7b\u578b\u6570\u636e\u7684\u6269\u5c55\u64cd\u4f5c"},{"location":"redis/day01/#231_string","text":"\u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e00string\u7684\u6269\u5c55\u64cd\u4f5c\uff0c\u5206\u6210\u4e24\u5927\u5757\uff1a\u4e00\u5757\u662f\u5bf9\u6570\u5b57\u8fdb\u884c\u64cd\u4f5c\u7684\uff0c\u7b2c\u4e8c\u5757\u662f\u5bf9\u6211\u4eec\u7684key\u7684\u65f6\u95f4\u8fdb\u884c\u64cd\u4f5c\u7684\u3002 \u8bbe\u7f6e\u6570\u503c\u6570\u636e\u589e\u52a0\u6307\u5b9a\u8303\u56f4\u7684\u503c incr key incrby key increment incrbyfloat key increment \u8bbe\u7f6e\u6570\u503c\u6570\u636e\u51cf\u5c11\u6307\u5b9a\u8303\u56f4\u7684\u503c decr key decrby key increment \u8bbe\u7f6e\u6570\u636e\u5177\u6709\u6307\u5b9a\u7684\u751f\u547d\u5468\u671f setex key seconds value psetex key milliseconds value","title":"2.3.1  string \u7c7b\u578b\u6570\u636e\u7684\u6269\u5c55\u64cd\u4f5c"},{"location":"redis/day01/#232_string","text":"(1)\u6570\u636e\u64cd\u4f5c\u4e0d\u6210\u529f\u7684\u53cd\u9988\u4e0e\u6570\u636e\u6b63\u5e38\u64cd\u4f5c\u4e4b\u95f4\u7684\u5dee\u5f02 \u8868\u793a\u8fd0\u884c\u7ed3\u679c\u662f\u5426\u6210\u529f (integer) 0 \u2192 false \u5931\u8d25 (integer) 1 \u2192 true \u6210\u529f \u8868\u793a\u8fd0\u884c\u7ed3\u679c\u503c (integer) 3 \u2192 3 3\u4e2a (integer) 1 \u2192 1 1\u4e2a (2)\u6570\u636e\u672a\u83b7\u53d6\u5230\u65f6\uff0c\u5bf9\u5e94\u7684\u6570\u636e\u4e3a\uff08nil\uff09\uff0c\u7b49\u540c\u4e8enull (3)\u6570\u636e\u6700\u5927\u5b58\u50a8\u91cf\uff1a512MB (4)string\u5728redis\u5185\u90e8\u5b58\u50a8\u9ed8\u8ba4\u5c31\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5f53\u9047\u5230\u589e\u51cf\u7c7b\u64cd\u4f5cincr\uff0cdecr\u65f6\u4f1a\u8f6c\u6210\u6570\u503c\u578b\u8fdb\u884c\u8ba1\u7b97 (5)\u6309\u6570\u503c\u8fdb\u884c\u64cd\u4f5c\u7684\u6570\u636e\uff0c\u5982\u679c\u539f\u59cb\u6570\u636e\u4e0d\u80fd\u8f6c\u6210\u6570\u503c\uff0c\u6216\u8d85\u8d8a\u4e86redis \u6570\u503c\u4e0a\u9650\u8303\u56f4\uff0c\u5c06\u62a5\u9519 9223372036854775807\uff08java\u4e2dLong\u578b\u6570\u636e\u6700\u5927\u503c\uff0cLong.MAX_VALUE\uff09 (6)redis\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u662f\u539f\u5b50\u6027\u7684\uff0c\u91c7\u7528\u5355\u7ebf\u7a0b\u5904\u7406\u6240\u6709\u4e1a\u52a1\uff0c\u547d\u4ee4\u662f\u4e00\u4e2a\u4e00\u4e2a\u6267\u884c\u7684\uff0c\u56e0\u6b64\u65e0\u9700\u8003\u8651\u5e76\u53d1\u5e26\u6765\u7684\u6570\u636e\u5f71\u54cd.","title":"2.3.2  string \u7c7b\u578b\u6570\u636e\u64cd\u4f5c\u7684\u6ce8\u610f\u4e8b\u9879"},{"location":"redis/day01/#24stringkey","text":"","title":"2.4string\u5e94\u7528\u573a\u666f\u4e0ekey\u547d\u540d\u7ea6\u5b9a"},{"location":"redis/day01/#241","text":"\u5b83\u7684\u5e94\u7528\u573a\u666f\u5728\u4e8e\uff1a\u4e3b\u9875\u9ad8\u9891\u8bbf\u95ee\u4fe1\u606f\u663e\u793a\u63a7\u5236\uff0c\u4f8b\u5982\u65b0\u6d6a\u5fae\u535a\u5927V\u4e3b\u9875\u663e\u793a\u7c89\u4e1d\u6570\u4e0e\u5fae\u535a\u6570\u91cf\u3002 \u6211\u4eec\u6765\u601d\u8003\u4e00\u4e0b\uff1a\u8fd9\u4e9b\u4fe1\u606f\u662f\u4e0d\u662f\u4f60\u8fdb\u5165\u5927V\u7684\u9875\u9762\u513f\u4ee5\u540e\u5c31\u8981\u8bfb\u53d6\u8fd9\u5199\u4fe1\u606f\u7684\u554a\uff0c\u90a3\u8fd9\u79cd\u4fe1\u606f\u4e00\u5b9a\u8981\u5b58\u50a8\u5230\u6211\u4eec\u7684redis\u4e2d\uff0c\u56e0\u4e3a\u4ed6\u7684\u8bbf\u95ee\u91cf\u592a\u9ad8\u4e86\uff01\u90a3\u8fd9\u79cd\u6570\u636e\u5e94\u8be5\u600e\u4e48\u5b58\u5462\uff1f\u6211\u4eec\u6765\u4e00\u5757\u513f\u770b\u4e00\u4e0b\u65b9\u6848\uff01","title":"2.4.1  \u5e94\u7528\u573a\u666f"},{"location":"redis/day01/#242","text":"\uff081\uff09\u5728redis\u4e2d\u4e3a\u5927V\u7528\u6237\u8bbe\u5b9a\u7528\u6237\u4fe1\u606f\uff0c\u4ee5\u7528\u6237\u4e3b\u952e\u548c\u5c5e\u6027\u503c\u4f5c\u4e3akey\uff0c\u540e\u53f0\u8bbe\u5b9a\u5b9a\u65f6\u5237\u65b0\u7b56\u7565\u5373\u53ef\u3002 eg: user:id:3506728370:fans \u2192 12210947 eg: user:id:3506728370:blogs \u2192 6164 eg: user:id:3506728370:focuses \u2192 83 \uff082\uff09\u4e5f\u53ef\u4ee5\u4f7f\u7528json\u683c\u5f0f\u4fdd\u5b58\u6570\u636e eg: user:id:3506728370 \u2192 {\u201cfans\u201d\uff1a12210947\uff0c\u201cblogs\u201d\uff1a6164\uff0c\u201c focuses \u201d\uff1a83 } \uff083\uff09 key \u7684\u8bbe\u7f6e\u7ea6\u5b9a \u6570\u636e\u5e93\u4e2d\u7684\u70ed\u70b9\u6570\u636ekey\u547d\u540d\u60ef\u4f8b \u8868\u540d \u4e3b\u952e\u540d \u4e3b\u952e\u503c \u5b57\u6bb5\u540d eg1\uff1a order id 29437595 name eg2\uff1a equip id 390472345 type eg3\uff1a news id 202004150 title","title":"2.4.2  \u89e3\u51b3\u65b9\u6848"},{"location":"redis/day01/#25_hash","text":"\u4e0b\u9762\u6211\u4eec\u6765\u5b66\u4e60\u7b2c\u4e8c\u4e2a\u6570\u636e\u7c7b\u578bhash\u3002","title":"2.5  hash\u7684\u57fa\u672c\u64cd\u4f5c"},{"location":"redis/day01/#251","text":"\u5bf9\u8c61\u7c7b\u6570\u636e\u7684\u5b58\u50a8\u5982\u679c\u5177\u6709\u8f83\u9891\u7e41\u7684\u66f4\u65b0\u9700\u6c42\u64cd\u4f5c\u4f1a\u663e\u5f97\u7b28\u91cd\uff01 \u5728\u6b63\u5f0f\u5b66\u4e60\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u770b\u4e00\u4e2a\u5173\u4e8e\u6570\u636e\u5b58\u50a8\u7684\u56f0\u60d1\uff1a \u6bd4\u5982\u8bf4\u524d\u9762\u6211\u4eec\u7528\u4ee5\u4e0a\u5f62\u5f0f\u5b58\u4e86\u6570\u636e\uff0c\u5982\u679c\u6211\u4eec\u7528\u5355\u6761\u53bb\u5b58\u7684\u8bdd\uff0c\u5b83\u5b58\u7684\u6761\u6570\u4f1a\u5f88\u591a\u3002\u4f46\u5982\u679c\u6211\u4eec\u7528json\u683c\u5f0f\uff0c\u5b83\u5b58\u4e00\u6761\u6570\u636e\u5c31\u591f\u4e86\u3002\u95ee\u9898\u6765\u4e86\uff0c\u5047\u5982\u8bf4\u73b0\u5728\u7c89\u4e1d\u6570\u91cf\u53d1\u751f\u53d8\u5316\u4e86\uff0c\u4f60\u8981\u628a\u6574\u4e2a\u503c\u90fd\u6539\u4e86\u3002\u4f46\u662f\u7528\u5355\u6761\u5b58\u7684\u8bdd\u5c31\u4e0d\u5b58\u5728\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f60\u53ea\u9700\u8981\u6539\u5176\u4e2d\u4e00\u4e2a\u5c31\u884c\u4e86\u3002\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5c31\u60f3\uff0c\u6709\u6ca1\u6709\u4e00\u79cd\u65b0\u7684\u5b58\u50a8\u7ed3\u6784\uff0c\u80fd\u5e2e\u6211\u4eec\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\u3002 \u6211\u4eec\u4e00\u5757\u513f\u6765\u5206\u6790\u4e00\u4e0b\uff1a \u5982\u4e0a\u56fe\u6240\u793a\uff1a\u5355\u6761\u7684\u8bdd\u662f\u5bf9\u5e94\u7684\u6570\u636e\u5728\u540e\u9762\u653e\u7740\u3002\u4ed4\u7ec6\u89c2\u5bdf\uff1a\u6211\u4eec\u770b\u5de6\u8fb9\u662f\u4e0d\u662f\u957f\u5f97\u90fd\u4e00\u6a21\u4e00\u6837\u554a\uff0c\u90fd\u662f\u5bf9\u5e94\u7684\u8868\u540d\u3001ID\u7b49\u7684\u4e00\u7cfb\u5217\u7684\u4e1c\u897f\u3002\u6211\u4eec\u53ef\u4ee5\u5c06\u53f3\u8fb9\u7ea2\u6846\u4e2d\u7684\u8fd9\u4e2a\u533a\u57df\u7ed9\u4ed6\u5c01\u8d77\u6765\u3002 \u90a3\u5982\u679c\u8981\u662f\u8fd9\u6837\u7684\u5f62\u5f0f\u7684\u8bdd\uff0c\u5982\u4e0b\u56fe\uff0c\u6211\u4eec\u628a\u5b83\u4e00\u5408\u5e76\uff0c\u5e76\u628a\u53f3\u8fb9\u7684\u4e1c\u897f\u7ed9\u4ed6\u53d8\u6210\u8fd9\u4e2a\u683c\u5f0f\uff0c\u8fd9\u4e0d\u5c31\u884c\u4e86\u5417\uff1f \u8fd9\u4e2a\u56fe\u5176\u5b9e\u5927\u5bb6\u5e76\u4e0d\u964c\u751f\uff0c\u7b2c\u4e00\uff0c\u4f60\u524d\u9762\u5b66\u8fc7\u4e00\u4e2a\u4e1c\u897f\u53ebhashmap\u4e0d\u5c31\u8fd9\u683c\u5f0f\u5417\uff1f\u7b2c\u4e8c\uff0credis\u81ea\u8eab\u4e0d\u4e5f\u662f\u8fd9\u683c\u5f0f\u5417\uff1f\u90a3\u662f\u4ec0\u4e48\u610f\u601d\u5462\uff1f\u6ce8\u610f\uff0c\u8fd9\u5c31\u662f\u6211\u4eec\u8981\u8bb2\u7684\u7b2c\u4e8c\u79cd\u683c\u5f0f\uff0chash\u3002 \u5728\u53f3\u8fb9\u5bf9\u5e94\u7684\u503c\uff0c\u6211\u4eec\u5c31\u5b58\u5177\u4f53\u7684\u503c\uff0c\u90a3\u5de6\u8fb9\u513f\u8fd9\u5c31\u662f\u6211\u4eec\u7684key\u3002\u95ee\u9898\u6765\u4e86\uff0c\u90a3\u4e2d\u95f4\u7684\u8fd9\u4e00\u5757\u53eb\u4ec0\u4e48\u5462\uff1f\u8fd9\u4e2a\u4e1c\u897f\u6211\u4eec\u7ed9\u4ed6\u8d77\u4e2a\u540d\u513f\uff0c\u53eb\u505afield\u5b57\u6bb5\u3002\u90a3\u4e48\u53f3\u8fb9\u513f\u6574\u4f53\u8fd9\u5757\u513f\u7a7a\u95f4\u6211\u4eec\u5c31\u79f0\u4e3ahash\uff0c\u4e5f\u5c31\u662f\u8bf4hash\u662f\u5b58\u4e86\u4e00\u4e2akey value\u7684\u5b58\u50a8\u7a7a\u95f4\u3002","title":"2.5.1  \u6570\u636e\u5b58\u50a8\u7684\u56f0\u60d1"},{"location":"redis/day01/#252_hash","text":"\u65b0\u7684\u5b58\u50a8\u9700\u6c42\uff1a\u5bf9\u4e00\u7cfb\u5217\u5b58\u50a8\u7684\u6570\u636e\u8fdb\u884c\u7f16\u7ec4\uff0c\u65b9\u4fbf\u7ba1\u7406\uff0c\u5178\u578b\u5e94\u7528\u5b58\u50a8\u5bf9\u8c61\u4fe1\u606f \u9700\u8981\u7684\u5b58\u50a8\u7ed3\u6784\uff1a\u4e00\u4e2a\u5b58\u50a8\u7a7a\u95f4\u4fdd\u5b58\u591a\u4e2a\u952e\u503c\u5bf9\u6570\u636e hash\u7c7b\u578b\uff1a\u5e95\u5c42\u4f7f\u7528\u54c8\u5e0c\u8868\u7ed3\u6784\u5b9e\u73b0\u6570\u636e\u5b58\u50a8 \u5982\u4e0a\u56fe\u6240\u793a\uff0c\u8fd9\u79cd\u7ed3\u6784\u53eb\u505ahash\uff0c\u5de6\u8fb9\u4e00\u4e2akey\uff0c\u5bf9\u53f3\u8fb9\u4e00\u4e2a\u5b58\u50a8\u7a7a\u95f4\u3002\u8fd9\u91cc\u8981\u660e\u786e\u4e00\u70b9\uff0c\u53f3\u8fb9\u8fd9\u5757\u513f\u5b58\u50a8\u7a7a\u95f4\u53ebhash\uff0c\u4e5f\u5c31\u662f\u8bf4hash\u662f\u6307\u7684\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\uff0c\u4ed6\u6307\u7684\u4e0d\u662f\u4e00\u4e2a\u6570\u636e\uff0c\u662f\u8fd9\u91cc\u8fb9\u7684\u4e00\u5806\u6570\u636e\uff0c\u90a3\u4e48\u5b83\u5e95\u5c42\u5462\uff0c\u662f\u7528hash\u8868\u7684\u7ed3\u6784\u6765\u5b9e\u73b0\u7684\u3002 \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff1a \u5982\u679cfield\u6570\u91cf\u8f83\u5c11\uff0c\u5b58\u50a8\u7ed3\u6784\u4f18\u5316\u4e3a\u7c7b\u6570\u7ec4\u7ed3\u6784 \u5982\u679cfield\u6570\u91cf\u8f83\u591a\uff0c\u5b58\u50a8\u7ed3\u6784\u4f7f\u7528HashMap\u7ed3\u6784","title":"2.5.2  hash \u7c7b\u578b"},{"location":"redis/day01/#253_hash","text":"\u6dfb\u52a0/\u4fee\u6539\u6570\u636e hset key field value \u83b7\u53d6\u6570\u636e hget key field hgetall key \u5220\u9664\u6570\u636e hdel key field1 [ field2 ] \u8bbe\u7f6efield\u7684\u503c\uff0c\u5982\u679c\u8be5field\u5b58\u5728\u5219\u4e0d\u505a\u4efb\u4f55\u64cd\u4f5c hsetnx key field value \u6dfb\u52a0/\u4fee\u6539\u591a\u4e2a\u6570\u636e hmset key field1 value1 field2 value2 \u2026 \u83b7\u53d6\u591a\u4e2a\u6570\u636e hmget key field1 field2 \u2026 \u83b7\u53d6\u54c8\u5e0c\u8868\u4e2d\u5b57\u6bb5\u7684\u6570\u91cf hlen key \u83b7\u53d6\u54c8\u5e0c\u8868\u4e2d\u662f\u5426\u5b58\u5728\u6307\u5b9a\u7684\u5b57\u6bb5 hexists key field","title":"2.5.3  hash \u7c7b\u578b\u6570\u636e\u7684\u57fa\u672c\u64cd\u4f5c"},{"location":"redis/day01/#26_hash","text":"\u5728\u770b\u5b8chash\u7684\u57fa\u672c\u64cd\u4f5c\u540e\uff0c\u6211\u4eec\u518d\u6765\u770b\u4ed6\u7684\u62d3\u5c55\u64cd\u4f5c\uff0c\u4ed6\u7684\u62d3\u5c55\u64cd\u4f5c\u76f8\u5bf9\u6bd4\u8f83\u7b80\u5355\uff1a","title":"2.6  hash\u7684\u62d3\u5c55\u64cd\u4f5c"},{"location":"redis/day01/#261_hash","text":"\u83b7\u53d6\u54c8\u5e0c\u8868\u4e2d\u6240\u6709\u7684\u5b57\u6bb5\u540d\u6216\u5b57\u6bb5\u503c hkeys key hvals key \u8bbe\u7f6e\u6307\u5b9a\u5b57\u6bb5\u7684\u6570\u503c\u6570\u636e\u589e\u52a0\u6307\u5b9a\u8303\u56f4\u7684\u503c hincrby key field increment hincrbyfloat key field increment","title":"2.6.1  hash \u7c7b\u578b\u6570\u636e\u6269\u5c55\u64cd\u4f5c"},{"location":"redis/day01/#262_hash","text":"(1)hash\u7c7b\u578b\u4e2dvalue\u53ea\u80fd\u5b58\u50a8\u5b57\u7b26\u4e32\uff0c\u4e0d\u5141\u8bb8\u5b58\u50a8\u5176\u4ed6\u6570\u636e\u7c7b\u578b\uff0c\u4e0d\u5b58\u5728\u5d4c\u5957\u73b0\u8c61\u3002\u5982\u679c\u6570\u636e\u672a\u83b7\u53d6\u5230\uff0c\u5bf9\u5e94\u7684\u503c\u4e3a\uff08nil\uff09\u3002 (2\uff09\u6bcf\u4e2a hash \u53ef\u4ee5\u5b58\u50a8 2^32 - 1 \u4e2a\u952e\u503c\u5bf9 hash\u7c7b\u578b\u5341\u5206\u8d34\u8fd1\u5bf9\u8c61\u7684\u6570\u636e\u5b58\u50a8\u5f62\u5f0f\uff0c\u5e76\u4e14\u53ef\u4ee5\u7075\u6d3b\u6dfb\u52a0\u5220\u9664\u5bf9\u8c61\u5c5e\u6027\u3002\u4f46hash\u8bbe\u8ba1\u521d\u8877\u4e0d\u662f\u4e3a\u4e86\u5b58\u50a8\u5927\u91cf\u5bf9\u8c61\u800c\u8bbe\u8ba1 \u7684\uff0c\u5207\u8bb0\u4e0d\u53ef\u6ee5\u7528\uff0c\u66f4\u4e0d\u53ef\u4ee5\u5c06hash\u4f5c\u4e3a\u5bf9\u8c61\u5217\u8868\u4f7f\u7528\u3002 (3)hgetall \u64cd\u4f5c\u53ef\u4ee5\u83b7\u53d6\u5168\u90e8\u5c5e\u6027\uff0c\u5982\u679c\u5185\u90e8field\u8fc7\u591a\uff0c\u904d\u5386\u6574\u4f53\u6570\u636e\u6548\u7387\u5c31\u5f88\u4f1a\u4f4e\uff0c\u6709\u53ef\u80fd\u6210\u4e3a\u6570\u636e\u8bbf\u95ee\u74f6\u9888\u3002","title":"2.6.2  hash\u7c7b\u578b\u6570\u636e\u64cd\u4f5c\u7684\u6ce8\u610f\u4e8b\u9879"},{"location":"redis/day01/#27_hash","text":"","title":"2.7  hash\u5e94\u7528\u573a\u666f"},{"location":"redis/day01/#271","text":"\u53cc11\u6d3b\u52a8\u65e5\uff0c\u9500\u552e\u624b\u673a\u5145\u503c\u5361\u7684\u5546\u5bb6\u5bf9\u79fb\u52a8\u3001\u8054\u901a\u3001\u7535\u4fe1\u768430\u5143\u300150\u5143\u3001100\u5143\u5546\u54c1\u63a8\u51fa\u62a2\u8d2d\u6d3b\u52a8\uff0c\u6bcf\u79cd\u5546\u54c1\u62a2\u8d2d\u4e0a\u96501000 \u5f20\u3002 \u4e5f\u5c31\u662f\u5546\u5bb6\u6709\u4e86\uff0c\u5546\u54c1\u6709\u4e86\uff0c\u6570\u91cf\u6709\u4e86\u3002\u6700\u7ec8\u6211\u4eec\u7684\u7528\u6237\u4e70\u4e1c\u897f\u5c31\u662f\u5728\u6539\u53d8\u8fd9\u4e2a\u6570\u91cf\u3002\u90a3\u4f60\u8bf4\u8fd9\u4e2a\u7ed3\u6784\u5e94\u8be5\u600e\u4e48\u5b58\u5462\uff1f\u5bf9\u5e94\u7684\u5546\u5bb6\u7684ID\u4f5c\u4e3akey\uff0c\u7136\u540e\u8fd9\u4e9b\u5145\u503c\u5361\u7684ID\u4f5c\u4e3afield\uff0c\u6700\u540e\u8fd9\u4e9b\u6570\u91cf\u4f5c\u4e3avalue\u3002\u800c\u6211\u4eec\u6240\u8c13\u7684\u64cd\u4f5c\u662f\u5176\u5b9e\u5c31\u662fincrea\u8fd9\u4e2a\u64cd\u4f5c\uff0c\u53ea\u4e0d\u8fc7\u4f60\u4f20\u8d1f\u503c\u5c31\u884c\u4e86\u3002\u770b\u4e00\u770b\u5bf9\u5e94\u7684\u89e3\u51b3\u65b9\u6848\uff1a","title":"2.7.1  \u5e94\u7528\u573a\u666f"},{"location":"redis/day01/#272","text":"\u4ee5\u5546\u5bb6id\u4f5c\u4e3akey \u5c06\u53c2\u4e0e\u62a2\u8d2d\u7684\u5546\u54c1id\u4f5c\u4e3afield \u5c06\u53c2\u4e0e\u62a2\u8d2d\u7684\u5546\u54c1\u6570\u91cf\u4f5c\u4e3a\u5bf9\u5e94\u7684value \u62a2\u8d2d\u65f6\u4f7f\u7528\u964d\u503c\u7684\u65b9\u5f0f\u63a7\u5236\u4ea7\u54c1\u6570\u91cf \u6ce8\u610f\uff1a\u5b9e\u9645\u4e1a\u52a1\u4e2d\u8fd8\u6709\u8d85\u5356\u7b49\u5b9e\u9645\u95ee\u9898\uff0c\u8fd9\u91cc\u4e0d\u505a\u8ba8\u8bba","title":"2.7.2  \u89e3\u51b3\u65b9\u6848"},{"location":"redis/day01/#28_list","text":"\u524d\u9762\u6211\u4eec\u5b58\u6570\u636e\u7684\u65f6\u5019\u5462\uff0c\u5355\u4e2a\u6570\u636e\u4e5f\u80fd\u5b58\uff0c\u591a\u4e2a\u6570\u636e\u4e5f\u80fd\u5b58\uff0c\u4f46\u662f\u8fd9\u91cc\u9762\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5b58\u591a\u4e2a\u6570\u636e\u7528hash\u7684\u65f6\u5019\u5b83\u662f\u6ca1\u6709\u987a\u5e8f\u7684\u3002\u6211\u4eec\u5e73\u65f6\u64cd\u4f5c\uff0c\u5b9e\u9645\u4e0a\u6570\u636e\u5f88\u591a\u60c5\u51b5\u4e0b\u90fd\u662f\u6709\u987a\u5e8f\u7684\uff0c\u90a3\u6709\u6ca1\u6709\u4e00\u79cd\u80fd\u591f\u7528\u6765\u5b58\u50a8\u5e26\u6709\u987a\u5e8f\u7684\u8fd9\u79cd\u6570\u636e\u6a21\u578b\u5462\uff0clist\u5c31\u4e13\u95e8\u6765\u5e72\u8fd9\u4e8b\u513f\u3002","title":"2.8  list\u57fa\u672c\u64cd\u4f5c"},{"location":"redis/day01/#281_list","text":"\u6570\u636e\u5b58\u50a8\u9700\u6c42\uff1a\u5b58\u50a8\u591a\u4e2a\u6570\u636e\uff0c\u5e76\u5bf9\u6570\u636e\u8fdb\u5165\u5b58\u50a8\u7a7a\u95f4\u7684\u987a\u5e8f\u8fdb\u884c\u533a\u5206 \u9700\u8981\u7684\u5b58\u50a8\u7ed3\u6784\uff1a\u4e00\u4e2a\u5b58\u50a8\u7a7a\u95f4\u4fdd\u5b58\u591a\u4e2a\u6570\u636e\uff0c\u4e14\u901a\u8fc7\u6570\u636e\u53ef\u4ee5\u4f53\u73b0\u8fdb\u5165\u987a\u5e8f list\u7c7b\u578b\uff1a\u4fdd\u5b58\u591a\u4e2a\u6570\u636e\uff0c\u5e95\u5c42\u4f7f\u7528\u53cc\u5411\u94fe\u8868\u5b58\u50a8\u7ed3\u6784\u5b9e\u73b0 \u5148\u6765\u901a\u8fc7\u4e00\u5f20\u56fe\uff0c\u56de\u5fc6\u4e00\u4e0b\u987a\u5e8f\u8868\u3001\u94fe\u8868\u3001\u53cc\u5411\u94fe\u8868\u3002 list\u5bf9\u5e94\u7684\u5b58\u50a8\u7ed3\u6784\u662f\u4ec0\u4e48\u5462\uff1f\u91cc\u8fb9\u5b58\u7684\u8fd9\u4e2a\u4e1c\u897f\u662f\u4e2a\u5217\u8868\uff0c\u4ed6\u6709\u4e00\u4e2a\u5bf9\u5e94\u7684\u540d\u79f0\u3002\u5c31\u662fkey\u5b58\u4e00\u4e2alist\u7684\u8fd9\u6837\u7ed3\u6784\u3002\u5bf9\u5e94\u7684\u57fa\u672c\u64cd\u4f5c\uff0c\u4f60\u5176\u5b9e\u662f\u53ef\u4ee5\u60f3\u5230\u7684\u3002 \u6765\u770b\u4e00\u4e0b\uff0c\u56e0\u4e3a\u5b83\u662f\u53cc\u5411\u7684\uff0c\u6240\u4ee5\u4ed6\u5de6\u8fb9\u53f3\u8fb9\u90fd\u80fd\u64cd\u4f5c\uff0c\u5b83\u5bf9\u5e94\u7684\u64cd\u4f5c\u7ed3\u6784\u4e24\u8fb9\u90fd\u80fd\u8fdb\u6570\u636e\u3002\u8fd9\u5c31\u662f\u94fe\u8868\u7684\u4e00\u4e2a\u5b58\u50a8\u7ed3\u6784\u3002\u5f80\u5916\u62ff\u6570\u636e\u7684\u65f6\u5019\u600e\u4e48\u62ff\u5462\uff1f\u901a\u5e38\u662f\u4ece\u4e00\u7aef\u62ff\uff0c\u5f53\u7136\u53e6\u4e00\u7aef\u4e5f\u80fd\u62ff\u3002\u5982\u679c\u4e24\u7aef\u90fd\u80fd\u62ff\u7684\u8bdd\uff0c\u8fd9\u5c31\u662f\u4e2a\u53cc\u7aef\u961f\u5217\uff0c\u4e24\u8fb9\u513f\u90fd\u80fd\u64cd\u4f5c\u3002\u5982\u679c\u53ea\u80fd\u4ece\u4e00\u7aef\u8fdb\u4e00\u7aef\u51fa\uff0c\u8fd9\u4e2a\u6a21\u578b\u54b1\u4eec\u524d\u9762\u4e86\u89e3\u8fc7\uff0c\u53eb\u505a\u6808\u3002","title":"2.8.1  list \u7c7b\u578b"},{"location":"redis/day01/#282_list","text":"\u6700\u540e\u770b\u4e00\u4e0b\u4ed6\u7684\u57fa\u672c\u64cd\u4f5c \u6dfb\u52a0/\u4fee\u6539\u6570\u636e lpush key value1 [ value2 ] \u2026\u2026 rpush key value1 [ value2 ] \u2026\u2026 \u83b7\u53d6\u6570\u636e lrange key start stop lindex key index llen key \u83b7\u53d6\u5e76\u79fb\u9664\u6570\u636e lpop key rpop key","title":"2.8.2 list \u7c7b\u578b\u6570\u636e\u57fa\u672c\u64cd\u4f5c"},{"location":"redis/day01/#29_list","text":"","title":"2.9  list\u6269\u5c55\u64cd\u4f5c"},{"location":"redis/day01/#291_list","text":"\u79fb\u9664\u6307\u5b9a\u6570\u636e lrem key count value \u89c4\u5b9a\u65f6\u95f4\u5185\u83b7\u53d6\u5e76\u79fb\u9664\u6570\u636e blpop key1 [ key2 ] timeout brpop key1 [ key2 ] timeout brpoplpush source destination timeout","title":"2.9.1  list \u7c7b\u578b\u6570\u636e\u6269\u5c55\u64cd\u4f5c"},{"location":"redis/day01/#292_list","text":"\uff081\uff09list\u4e2d\u4fdd\u5b58\u7684\u6570\u636e\u90fd\u662fstring\u7c7b\u578b\u7684\uff0c\u6570\u636e\u603b\u5bb9\u91cf\u662f\u6709\u9650\u7684\uff0c\u6700\u591a2^32 - 1 \u4e2a\u5143\u7d20(4294967295)\u3002 \uff082\uff09list\u5177\u6709\u7d22\u5f15\u7684\u6982\u5ff5\uff0c\u4f46\u662f\u64cd\u4f5c\u6570\u636e\u65f6\u901a\u5e38\u4ee5\u961f\u5217\u7684\u5f62\u5f0f\u8fdb\u884c\u5165\u961f\u51fa\u961f\u64cd\u4f5c\uff0c\u6216\u4ee5\u6808\u7684\u5f62\u5f0f\u8fdb\u884c\u5165\u6808\u51fa\u6808\u64cd\u4f5c \uff083\uff09\u83b7\u53d6\u5168\u90e8\u6570\u636e\u64cd\u4f5c\u7ed3\u675f\u7d22\u5f15\u8bbe\u7f6e\u4e3a-1 \uff084\uff09list\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u5206\u9875\u64cd\u4f5c\uff0c\u901a\u5e38\u7b2c\u4e00\u9875\u7684\u4fe1\u606f\u6765\u81ea\u4e8elist\uff0c\u7b2c2\u9875\u53ca\u66f4\u591a\u7684\u4fe1\u606f\u901a\u8fc7\u6570\u636e\u5e93\u7684\u5f62\u5f0f\u52a0\u8f7d","title":"2.9.2  list \u7c7b\u578b\u6570\u636e\u64cd\u4f5c\u6ce8\u610f\u4e8b\u9879"},{"location":"redis/day01/#210_list","text":"","title":"2.10 list \u5e94\u7528\u573a\u666f"},{"location":"redis/day01/#2101","text":"\u4f01\u4e1a\u8fd0\u8425\u8fc7\u7a0b\u4e2d\uff0c\u7cfb\u7edf\u5c06\u4ea7\u751f\u51fa\u5927\u91cf\u7684\u8fd0\u8425\u6570\u636e\uff0c\u5982\u4f55\u4fdd\u969c\u591a\u53f0\u670d\u52a1\u5668\u64cd\u4f5c\u65e5\u5fd7\u7684\u7edf\u4e00\u987a\u5e8f\u8f93\u51fa\uff1f \u5047\u5982\u73b0\u5728\u4f60\u6709\u591a\u53f0\u670d\u52a1\u5668\uff0c\u6bcf\u4e00\u53f0\u670d\u52a1\u5668\u90fd\u4f1a\u4ea7\u751f\u5b83\u7684\u65e5\u5fd7\uff0c\u5047\u8bbe\u4f60\u662f\u4e00\u4e2a\u8fd0\u7ef4\u4eba\u5458\uff0c\u4f60\u60f3\u770b\u5b83\u7684\u64cd\u4f5c\u65e5\u5fd7\uff0c\u4f60\u600e\u4e48\u770b\u5462\uff1f\u6253\u5f00A\u673a\u5668\u7684\u65e5\u5fd7\u770b\u4e00\u770b\uff0c\u6253\u5f00B\u673a\u5668\u7684\u65e5\u5fd7\u518d\u770b\u4e00\u770b\u5417\uff1f\u8fd9\u6837\u7684\u8bdd\u4f60\u4f1a\u53ef\u80fd\u4f1a\u75af\u6389\u7684\uff01\u56e0\u4e3a\u5de6\u8fb9\u770b\u7684\u6709\u53ef\u80fd\u5b83\u7684\u65f6\u95f4\u662f11:01\uff0c\u53f3\u8fb911:02\uff0c\u7136\u540e\u518d\u770b\u5de6\u8fb911:03\uff0c\u5b83\u4eec\u672c\u8eab\u662f\u8fde\u7eed\u7684\uff0c\u4f46\u662f\u4f60\u5728\u770b\u7684\u65f6\u5019\u5c31\u5206\u6210\u56db\u4e2a\u6587\u4ef6\u4e86\uff0c\u8fd9\u4e2a\u65f6\u5019\u4f60\u770b\u8d77\u6765\u5c31\u4f1a\u5f88\u9ebb\u70e6\u3002\u80fd\u4e0d\u80fd\u628a\u4ed6\u4eec\u5408\u5e76\u5462\uff1f\u7b54\u6848\u662f\u53ef\u4ee5\u7684\uff01\u600e\u4e48\u505a\u5462\uff1f\u5efa\u7acb\u8d77redis\u670d\u52a1\u5668\u3002\u5f53\u4ed6\u4eec\u9700\u8981\u8bb0\u65e5\u5fd7\u7684\u65f6\u5019\uff0c\u8bb0\u5728\u54ea\u513f,\u5168\u90e8\u53d1\u7ed9redis\u3002\u7b49\u5230\u4f60\u60f3\u770b\u7684\u65f6\u5019\uff0c\u901a\u8fc7\u670d\u52a1\u5668\u8bbf\u95eeredis\u83b7\u53d6\u65e5\u5fd7\u3002\u7136\u540e\u5f97\u5230\u4ee5\u540e\uff0c\u5c31\u4f1a\u5f97\u5230\u4e00\u4e2a\u5b8c\u6574\u7684\u65e5\u5fd7\u4fe1\u606f\u3002\u90a3\u4e48\u8fd9\u91cc\u9762\u5c31\u53ef\u4ee5\u83b7\u53d6\u5230\u5b8c\u6574\u7684\u65e5\u5fd7\u4e86\uff0c\u4f9d\u9760\u4ec0\u4e48\u6765\u5b9e\u73b0\u5462\uff1f\u5c31\u4f9d\u9760\u6211\u4eec\u7684list\u7684\u6a21\u578b\u7684\u987a\u5e8f\u6765\u5b9e\u73b0\u3002\u8fdb\u6765\u4e00\u7ec4\u6570\u636e\u5c31\u5f80\u91cc\u52a0\uff0c\u8c01\u5148\u8fdb\u6765\u8c01\u5148\u52a0\u8fdb\u53bb\uff0c\u5b83\u662f\u6709\u4e00\u5b9a\u7684\u987a\u5e8f\u7684\u3002","title":"2.10.1  \u5e94\u7528\u573a\u666f"},{"location":"redis/day01/#2102","text":"\u4f9d\u8d56list\u7684\u6570\u636e\u5177\u6709\u987a\u5e8f\u7684\u7279\u5f81\u5bf9\u4fe1\u606f\u8fdb\u884c\u7ba1\u7406 \u4f7f\u7528\u961f\u5217\u6a21\u578b\u89e3\u51b3\u591a\u8def\u4fe1\u606f\u6c47\u603b\u5408\u5e76\u7684\u95ee\u9898 \u4f7f\u7528\u6808\u6a21\u578b\u89e3\u51b3\u6700\u65b0\u6d88\u606f\u7684\u95ee\u9898","title":"2.10.2  \u89e3\u51b3\u65b9\u6848"},{"location":"redis/day01/#211_set","text":"","title":"2.11  set \u57fa\u672c\u64cd\u4f5c"},{"location":"redis/day01/#2111_set","text":"\u65b0\u7684\u5b58\u50a8\u9700\u6c42\uff1a\u5b58\u50a8\u5927\u91cf\u7684\u6570\u636e\uff0c\u5728\u67e5\u8be2\u65b9\u9762\u63d0\u4f9b\u66f4\u9ad8\u7684\u6548\u7387 \u9700\u8981\u7684\u5b58\u50a8\u7ed3\u6784\uff1a\u80fd\u591f\u4fdd\u5b58\u5927\u91cf\u7684\u6570\u636e\uff0c\u9ad8\u6548\u7684\u5185\u90e8\u5b58\u50a8\u673a\u5236\uff0c\u4fbf\u4e8e\u67e5\u8be2 set\u7c7b\u578b\uff1a\u4e0ehash\u5b58\u50a8\u7ed3\u6784\u5b8c\u5168\u76f8\u540c\uff0c\u4ec5\u5b58\u50a8\u952e\uff0c\u4e0d\u5b58\u50a8\u503c\uff08nil\uff09\uff0c\u5e76\u4e14\u503c\u662f\u4e0d\u5141\u8bb8\u91cd\u590d\u7684 \u901a\u8fc7\u8fd9\u4e2a\u540d\u79f0\uff0c\u5927\u5bb6\u4e5f\u57fa\u672c\u4e0a\u80fd\u591f\u8ba4\u8bc6\u5230\u548c\u6211\u4eecJava\u4e2d\u7684set\u5b8c\u5168\u4e00\u6837\u3002\u6211\u4eec\u73b0\u5728\u8981\u5b58\u50a8\u5927\u91cf\u7684\u6570\u636e\uff0c\u5e76\u4e14\u8981\u6c42\u63d0\u9ad8\u5b83\u7684\u67e5\u8be2\u6548\u7387\u3002\u7528list\u8fd9\u79cd\u94fe\u8868\u5f62\u5f0f\uff0c\u5b83\u7684\u67e5\u8be2\u6548\u7387\u662f\u4e0d\u9ad8\u7684\uff0c\u90a3\u600e\u4e48\u529e\u5462\uff1f\u8fd9\u65f6\u5019\u6211\u4eec\u5c31\u60f3\uff0c\u6709\u6ca1\u6709\u9ad8\u6548\u7684\u5b58\u50a8\u673a\u5236\u3002\u5176\u5b9e\u524d\u9762\u54b1\u8bb2Java\u7684\u65f6\u5019\u8bf4\u8fc7hash\u8868\u7684\u7ed3\u6784\u5c31\u975e\u5e38\u7684\u597d\uff0c\u4f46\u662f\u8fd9\u91cc\u8fb9\u6211\u4eec\u5df2\u7ecf\u6709hash\u4e86\uff0c\u4ed6\u505a\u4e86\u8fd9\u4e48\u4e00\u4e2a\u8bbe\u5b9a\uff0c\u5e72\u561b\u5462\uff0c\u4ed6\u628ahash\u7684\u5b58\u50a8\u7a7a\u95f4\u7ed9\u6539\u4e00\u4e0b\uff0c\u53f3\u8fb9\u4f60\u539f\u6765\u5b58\u6570\u636e\u6539\u6389,\u5168\u90e8\u5b58\u7a7a\uff0c\u90a3\u4f60\u8bf4\u6570\u636e\u653e\u54ea\u513f\u4e86\uff1f\u653e\u5230\u539f\u6765\u7684filed\u7684\u4f4d\u7f6e\uff0c\u4e5f\u5c31\u5728\u8fd9\u91cc\u8fb9\u5b58\u771f\u6b63\u7684\u503c\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6a21\u578b\u5c31\u662f\u6211\u4eec\u7684set \u6a21\u578b\u3002 set\u7c7b\u578b\uff1a\u4e0ehash\u5b58\u50a8\u7ed3\u6784\u5b8c\u5168\u76f8\u540c\uff0c\u4ec5\u5b58\u50a8\u952e\uff0c\u4e0d\u5b58\u50a8\u503c\uff08nil\uff09\uff0c\u5e76\u4e14\u503c\u662f\u4e0d\u5141\u8bb8\u91cd\u590d\u7684\u3002 \u770b\u4e00\u4e0b\u5b83\u7684\u6574\u4e2a\u7ed3\u6784\uff1a","title":"2.11.1 set\u7c7b\u578b"},{"location":"redis/day01/#2112_set","text":"\u6dfb\u52a0\u6570\u636e sadd key member1 [ member2 ] \u83b7\u53d6\u5168\u90e8\u6570\u636e smembers key \u5220\u9664\u6570\u636e srem key member1 [ member2 ] \u83b7\u53d6\u96c6\u5408\u6570\u636e\u603b\u91cf scard key \u5224\u65ad\u96c6\u5408\u4e2d\u662f\u5426\u5305\u542b\u6307\u5b9a\u6570\u636e sismember key member \u968f\u673a\u83b7\u53d6\u96c6\u5408\u4e2d\u6307\u5b9a\u6570\u91cf\u7684\u6570\u636e srandmember key [ count ] \u968f\u673a\u83b7\u53d6\u96c6\u4e2d\u7684\u67d0\u4e2a\u6570\u636e\u5e76\u5c06\u8be5\u6570\u636e\u79fb\u9664\u96c6\u5408 spop key [ count ]","title":"2.11.2 set\u7c7b\u578b\u6570\u636e\u7684\u57fa\u672c\u64cd\u4f5c"},{"location":"redis/day01/#212_set","text":"","title":"2.12  set \u7c7b\u578b\u6570\u636e\u7684\u6269\u5c55\u64cd\u4f5c"},{"location":"redis/day01/#2121_set","text":"\u6c42\u4e24\u4e2a\u96c6\u5408\u7684\u4ea4\u3001\u5e76\u3001\u5dee\u96c6 sinter key1 [key2 \u2026] sunion key1 [key2 \u2026] sdiff key1 [key2 \u2026] \u6c42\u4e24\u4e2a\u96c6\u5408\u7684\u4ea4\u3001\u5e76\u3001\u5dee\u96c6\u5e76\u5b58\u50a8\u5230\u6307\u5b9a\u96c6\u5408\u4e2d sinterstore destination key1 [key2 \u2026] sunionstore destination key1 [key2 \u2026] sdiffstore destination key1 [key2 \u2026] \u5c06\u6307\u5b9a\u6570\u636e\u4ece\u539f\u59cb\u96c6\u5408\u4e2d\u79fb\u52a8\u5230\u76ee\u6807\u96c6\u5408\u4e2d smove source destination member \u901a\u8fc7\u4e0b\u9762\u4e00\u5f20\u56fe\u56de\u5fc6\u4e00\u4e0b\u4ea4\u3001\u5e76\u3001\u5dee","title":"2.12.1  set \u7c7b\u578b\u6570\u636e\u7684\u6269\u5c55\u64cd\u4f5c"},{"location":"redis/day01/#2122_set","text":"set \u7c7b\u578b\u4e0d\u5141\u8bb8\u6570\u636e\u91cd\u590d\uff0c\u5982\u679c\u6dfb\u52a0\u7684\u6570\u636e\u5728 set \u4e2d\u5df2\u7ecf\u5b58\u5728\uff0c\u5c06\u53ea\u4fdd\u7559\u4e00\u4efd\u3002 set \u867d\u7136\u4e0ehash\u7684\u5b58\u50a8\u7ed3\u6784\u76f8\u540c\uff0c\u4f46\u662f\u65e0\u6cd5\u542f\u7528hash\u4e2d\u5b58\u50a8\u503c\u7684\u7a7a\u95f4\u3002","title":"2.12.2  set \u7c7b\u578b\u6570\u636e\u64cd\u4f5c\u7684\u6ce8\u610f\u4e8b\u9879"},{"location":"redis/day01/#213_set","text":"","title":"2.13  set\u5e94\u7528\u573a\u666f"},{"location":"redis/day01/#2131_set","text":"\uff081\uff09\u9ed1\u540d\u5355 \u8d44\u8baf\u7c7b\u4fe1\u606f\u7c7b\u7f51\u7ad9\u8ffd\u6c42\u9ad8\u8bbf\u95ee\u91cf\uff0c\u4f46\u662f\u7531\u4e8e\u5176\u4fe1\u606f\u7684\u4ef7\u503c\uff0c\u5f80\u5f80\u5bb9\u6613\u88ab\u4e0d\u6cd5\u5206\u5b50\u5229\u7528\uff0c\u901a\u8fc7\u722c\u866b\u6280\u672f\uff0c \u5feb\u901f\u83b7\u53d6\u4fe1\u606f\uff0c\u4e2a\u522b\u7279\u79cd\u884c\u4e1a\u7f51\u7ad9\u4fe1\u606f\u901a\u8fc7\u722c\u866b\u83b7\u53d6\u5206\u6790\u540e\uff0c\u53ef\u4ee5\u8f6c\u6362\u6210\u5546\u4e1a\u673a\u5bc6\u8fdb\u884c\u51fa\u552e\u3002\u4f8b\u5982\u7b2c\u4e09\u65b9\u706b \u8f66\u7968\u3001\u673a\u7968\u3001\u9152\u5e97\u5237\u7968\u4ee3\u8d2d\u8f6f\u4ef6\uff0c\u7535\u5546\u5237\u8bc4\u8bba\u3001\u5237\u597d\u8bc4\u3002 \u540c\u65f6\u722c\u866b\u5e26\u6765\u7684\u4f2a\u6d41\u91cf\u4e5f\u4f1a\u7ed9\u7ecf\u8425\u8005\u5e26\u6765\u9519\u89c9\uff0c\u4ea7\u751f\u9519\u8bef\u7684\u51b3\u7b56\uff0c\u6709\u6548\u907f\u514d\u7f51\u7ad9\u88ab\u722c\u866b\u53cd\u590d\u722c\u53d6\u6210\u4e3a\u6bcf\u4e2a\u7f51\u7ad9\u90fd\u8981\u8003\u8651\u7684\u57fa\u672c\u95ee\u9898\u3002\u5728\u57fa\u4e8e\u6280\u672f\u5c42\u9762\u533a\u5206\u51fa\u722c\u866b\u7528\u6237\u540e\uff0c\u9700\u8981\u5c06\u6b64\u7c7b\u7528\u6237\u8fdb\u884c\u6709\u6548\u7684\u5c4f\u853d\uff0c\u8fd9\u5c31\u662f\u9ed1\u540d\u5355\u7684\u5178\u578b\u5e94\u7528\u3002 ps:\u4e0d\u662f\u8bf4\u722c\u866b\u4e00\u5b9a\u505a\u6467\u6bc1\u6027\u7684\u5de5\u4f5c\uff0c\u6709\u4e9b\u5c0f\u578b\u7f51\u7ad9\u9700\u8981\u722c\u866b\u4e3a\u5176\u5e26\u6765\u4e00\u4e9b\u6d41\u91cf\u3002 \uff082\uff09\u767d\u540d\u5355 \u5bf9\u4e8e\u5b89\u5168\u6027\u66f4\u9ad8\u7684\u5e94\u7528\u8bbf\u95ee\uff0c\u4ec5\u4ec5\u9760\u9ed1\u540d\u5355\u662f\u4e0d\u80fd\u89e3\u51b3\u5b89\u5168\u95ee\u9898\u7684\uff0c\u6b64\u65f6\u9700\u8981\u8bbe\u5b9a\u53ef\u8bbf\u95ee\u7684\u7528\u6237\u7fa4\u4f53\uff0c \u4f9d\u8d56\u767d\u540d\u5355\u505a\u66f4\u4e3a\u82db\u523b\u7684\u8bbf\u95ee\u9a8c\u8bc1\u3002","title":"2.13.1  set\u5e94\u7528\u573a\u666f"},{"location":"redis/day01/#2132","text":"\u57fa\u4e8e\u7ecf\u8425\u6218\u7565\u8bbe\u5b9a\u95ee\u9898\u7528\u6237\u53d1\u73b0\u3001\u9274\u522b\u89c4\u5219 \u5468\u671f\u6027\u66f4\u65b0\u6ee1\u8db3\u89c4\u5219\u7684\u7528\u6237\u9ed1\u540d\u5355\uff0c\u52a0\u5165set\u96c6\u5408 \u7528\u6237\u884c\u4e3a\u4fe1\u606f\u8fbe\u5230\u540e\u4e0e\u9ed1\u540d\u5355\u8fdb\u884c\u6bd4\u5bf9\uff0c\u786e\u8ba4\u884c\u4e3a\u53bb\u5411 \u9ed1\u540d\u5355\u8fc7\u6ee4IP\u5730\u5740\uff1a\u5e94\u7528\u4e8e\u5f00\u653e\u6e38\u5ba2\u8bbf\u95ee\u6743\u9650\u7684\u4fe1\u606f\u6e90 \u9ed1\u540d\u5355\u8fc7\u6ee4\u8bbe\u5907\u4fe1\u606f\uff1a\u5e94\u7528\u4e8e\u9650\u5b9a\u8bbf\u95ee\u8bbe\u5907\u7684\u4fe1\u606f\u6e90 \u9ed1\u540d\u5355\u8fc7\u6ee4\u7528\u6237\uff1a\u5e94\u7528\u4e8e\u57fa\u4e8e\u8bbf\u95ee\u6743\u9650\u7684\u4fe1\u606f\u6e90","title":"2.13.2  \u89e3\u51b3\u65b9\u6848"},{"location":"redis/day01/#214","text":"","title":"2.14  \u5b9e\u8df5\u6848\u4f8b"},{"location":"redis/day01/#2141","text":"\u4f7f\u7528\u5fae\u4fe1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5f53\u5fae\u4fe1\u63a5\u6536\u6d88\u606f\u540e\uff0c\u4f1a\u9ed8\u8ba4\u5c06\u6700\u8fd1\u63a5\u6536\u7684\u6d88\u606f\u7f6e\u9876\uff0c\u5f53\u591a\u4e2a\u597d\u53cb\u53ca\u5173\u6ce8\u7684\u8ba2\u9605\u53f7\u540c\u65f6\u53d1 \u9001\u6d88\u606f\u65f6\uff0c\u8be5\u6392\u5e8f\u4f1a\u4e0d\u505c\u7684\u8fdb\u884c\u4ea4\u66ff\u3002\u540c\u65f6\u8fd8\u53ef\u4ee5\u5c06\u91cd\u8981\u7684\u4f1a\u8bdd\u8bbe\u7f6e\u4e3a\u7f6e\u9876\u3002\u4e00\u65e6\u7528\u6237\u79bb\u7ebf\u540e\uff0c\u518d\u6b21\u6253\u5f00\u5fae\u4fe1\u65f6\uff0c\u6d88\u606f\u8be5\u6309\u7167\u4ec0\u4e48\u6837\u7684\u987a\u5e8f\u663e\u793a\u3002 \u6211\u4eec\u5206\u6790\u4e00\u4e0b\uff1a 100\u8fd9\u53f0\u624b\u673a\u4ee3\u8868\u4f60\u3002\u800c200\u3001300\u3001400\u8fd9\u4e09\u53f0\u4ee3\u8868\u4f60\u597d\u53cb\u7684\u624b\u673a\u3002\u5728\u8fd9\u91cc\u6709\u4e00\u4e9b\u4e1c\u897f\u9700\u8981\u4ea4\u4ee3\u4e00\u4e0b\uff0c\u56e0\u4e3a\u6211\u4eec\u6bcf\u4e2a\u4eba\u7684\u90fd\u4f1a\u5bf9\u81ea\u5df1\u7684\u5fae\u4fe1\u4e2d\u7684\u4e00\u4e9b\u6bd4\u8f83\u91cd\u8981\u7684\u4eba\u8bbe\u7f6e\u4f1a\u8bdd\u7f6e\u9876\uff0c\u5c06\u4ed6\u7684\u90a3\u6761\u5bf9\u8bdd\u653e\u5728\u6700\u4e0a\u9762\u3002\u6211\u4eec\u5047\u5b9a\u8fd9\u4e2a\u4eba\u6709\u4e24\u4e2a\u4f1a\u8bdd\u7f6e\u9876\u7684\u597d\u53cb\uff0c\u5206\u522b\u662f400\u548c500\uff0c\u800c\u8fd9\u91cc\u8fb9\u5c31\u5305\u542b400. \u4e0b\u9762\u5462\uff0c\u6211\u4eec\u5c31\u6765\u53d1\u8fd9\u4e2a\u6d88\u606f\uff0c\u7b2c\u4e00\u4e2a\u53d1\u6d88\u606f\u7684\u662f300\uff0c\u4ed6\u53d1\u4e86\u4e2a\u6d88\u606f\u7ed9100\u3002\u53d1\u5b8c\u4ee5\u540e\uff0c\u8fd9\u4e2a\u4e1c\u897f\u5e94\u8be5\u600e\u4e48\u5b58\u50a8\u5462\uff1f\u5728\u8fd9\u91cc\u9762\u4e00\u5b9a\u8981\u5206\u5f00\uff0c\u8bb0\u5f55\u7f6e\u9876\u7684\u8fd9\u4e9b\u4eba\u7684\u4f1a\u8bdd\uff0c\u5bf9\u5e94\u7684\u4f1a\u8bdd\u663e\u793a\u987a\u5e8f\u548c\u975e\u7f6e\u9876\u7684\u4e00\u5b9a\u8981\u5206\u4e24\u3002 \u8fd9\u91cc\u9762\u6211\u4eec\u521b\u5efa\u4e24\u4e2a\u6a21\u578b\uff0c\u4e00\u4e2a\u662f\u666e\u901a\u7684\uff0c\u4e00\u4e2a\u662f\u7f6e\u9876\u7684\uff0c\u800c\u4e0a\u9762\u7684\u8fd9\u4e2a\u7f6e\u9876\u7684\u7528\u6237\u5462\uff0c\u6211\u4eec\u7528set\u6765\u5b58\u50a8\uff0c\u56e0\u4e3a\u4e0d\u91cd\u590d\u3002\u800c\u4e0b\u9762\u8fd9\u4e9b\u56e0\u4e3a\u6709\u987a\u5e8f\uff0c\u5f88\u5bb9\u6613\u60f3\u5230\u7528list\u53bb\u5b58\u50a8,\u4e0d\u7136\u4f60\u600e\u4e48\u8868\u8fbe\u987a\u5e8f\u5462\uff1f \u90a3\u5f53300\u53d1\u7ed9\u6d88\u606f\u7ed9100\u4ee5\u540e\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5148\u5224\u5b9a\u4f60\u5728\u7f6e\u9876\u4eba\u7fa4\u4e2d\u5417\uff1f\u4e0d\u5728,\u90a3\u597d\uff0c300\u7684\u6d88\u606f\u5bf9\u5e94\u7684\u987a\u5e8f\u5c31\u5e94\u8be5\u653e\u5728\u666e\u901a\u7684\u5217\u8868\u91cc\u8fb9\u3002\u800c\u5728\u8fd9\u91cc\u8fb9\uff0c\u6211\u4eec\u628a300\u52a0\u8fdb\u53bb\u3002\u7b2c\u4e00\u4e2a\u6570\u636e\u4e5f\u5c31\u662f\u73b0\u5728300\u3002 \u63a5\u4e0b\u6765400\uff0c\u53d1\u4e86\u4e2a\u6d88\u606f\u3002\u5224\u65ad\u4e00\u4e0b\uff0c\u4ed6\u662f\u9700\u8981\u7f6e\u9876\u7684\uff0c\u6240\u4ee5400\u5c06\u8fdb\u5165list\u7684\u7f6e\u9876\u91cc\u8fb9\u653e\u7740\u3002\u5f53\u524d\u8fd8\u6ca1\u6709\u7279\u6b8a\u7684\u5730\u65b9\u3002 \u518d\u6765200\u53d1\u6d88\u606f\u4e86\uff0c\u548c\u521a\u624d\u7684\u5224\u5b9a\u65b9\u6cd5\u4e00\u6837\uff0c\u5148\u770b\u5728\u4e0d\u5728\u7f6e\u9876\u91cc\uff0c\u4e0d\u5728\u7684\u8bdd\u8fdb\u666e\u901a\uff0c\u7136\u540e\u5728\u666e\u901a\u91cc\u8fb9\u628a200\u52a0\u5165\u5c31\u884c\u4e86\uff0cOK\uff0c\u5230\u8fd9\u91cc\u76ee\u524d\u8fd8\u6ca1\u6709\u987a\u5e8f\u53d8\u5316\u3002 \u63a5\u4e0b\u6765200\u53c8\u53d1\u6d88\u606f\u8fc7\u6765\uff0c\u540c\u4e00\u4e2a\u4eba\u7ed9\u4f60\u8fde\u53d1\u4e86\u4e24\u6761\uff0c\u90a3\u8fd9\u4e2a\u65f6\u5019200\u7684\u6d88\u606f\u5230\u8fbe\u4ee5\u540e\uff0c\u5148\u5224\u65ad\u662f\u5426\u5728\u7f6e\u9876\u8303\u56f4\uff0c\u4e0d\u5728\uff0c\u63a5\u4e0b\u6765\u4ed6\u8981\u653e\u5728list\u666e\u901a\u4e2d\uff0c\u8fd9\u91cc\u4f60\u8981\u6ce8\u610f\u4e00\u70b9\uff0c\u56e0\u4e3a\u8fd9\u91cc\u8fb9\u5df2\u7ecf\u6709200\uff0c\u6240\u4ee5\u8fdb\u6765\u4ee5\u540e\u5148\u5e72\u4e00\u4ef6\u4e8b\u513f\uff0c\u628a200\u6740\u6389\uff0c\u6ca1\u6709200\uff0c\u7136\u540e\u518d\u628a200\u52a0\u8fdb\u6765\uff0c\u90a3\u4f60\u60f3\u4e00\u4e0b\uff0c\u73b0\u5728\u8fd9\u4e2a\u4f4d\u7f6e\u987a\u5e8f\u662f\u4ec0\u4e48\u5462\uff1f\u5c31\u662f\u65b0\u7684\u90fd\u5728\u53f3\u8fb9\uff0c\u5bf9\u4e0d\u5bf9\uff1f \u8fd8\u8bb0\u5f97\u6211\u4eec\u8bf4list\u6a21\u578b\uff0c\u5982\u679c\u662f\u4e00\u4e2a\u53cc\u7aef\u961f\u5217\uff0c\u5b83\u662f\u53ef\u4ee5\u4e24\u5934\u8fdb\u4e24\u5934\u51fa\u3002\u5f53\u7136\u6211\u4eec\u53cc\u7aef\u4ece\u4e00\u5934\u8fdb\u4e00\u5934\u51fa\uff0c\u8fd9\u5c31\u662f\u6808\u6a21\u578b\uff0c\u73b0\u5728\u54b1\u4eec\u8fd0\u7528\u7684\u5c31\u662flist\u6a21\u578b\u4e2d\u7684\u6808\u6a21\u578b\u3002 \u73b0\u5728300\u53d1\u6d88\u606f\uff0c\u5148\u5224\u5b9a\u4ed6\u5728\u4e0d\u5728\uff0c\u4e0d\u5728\uff0c\u7528\u666e\u901a\u7684\u961f\u5217\uff0c\u63a5\u4e0b\u6765\u6309\u7167\u521a\u624d\u7684\u64cd\u4f5c\uff0c\u4e0d\u7ba1\u4f60\u91cc\u8fb9\u539f\u6765\u6709\u6ca1\u6709300\uff0c\u6211\u5148\u628a300\u6740\u6389\uff0c\u6ca1\u4e86\uff0c200\u81ea\u7136\u5c31\u586b\u5230300\u7684\u4f4d\u7f6e\u4e86\uff0c\u4ed6\u73b0\u5728\u662flist\u91cc\u9762\u552f\u4e00\u4e00\u4e2a\uff0c\u7136\u540e\u8ba9300\u8fdb\u6765\uff0c\u6ce8\u610f\u662f\u4ece\u53f3\u4fa7\u8fdb\u6765\u7684\uff0c\u90a3\u4e48\u73b0\u5728300\u5c31\u662f\u6700\u65b0\u7684\u3002 \u90a3\u4e48\u5230\u8fd9\u91cc\u5462\uff0c\u6211\u4eec\u8ba9100\u6765\u8bfb\u53d6\u6d88\u606f\u3002\u4f60\u89c9\u5f97\u8fd9\u4e2a\u6d88\u606f\u987a\u5e8f\u5e94\u8be5\u662f\u4ec0\u4e48\u6837\u7684\uff1f\u9996\u5148\u7f6e\u9876\u7684400\u6709\u4e00\u4e2a\uff0c\u4ed6\u8dd1\u5728\u6700\u4e0a\u9762\uff0c\u7136\u540elist\u666e\u901a\u5982\u679c\u51fa\u6765\u7684\u8bdd\uff0c300\u662f\u6700\u65b0\u7684\u6d88\u606f\uff0c\u800c200\u5728\u4ed6\u540e\u9762\u7684\u3002\u7528\u8fd9\u79cd\u5f62\u5f0f\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u505a\u51fa\u6765\u4ed6\u7684\u6d88\u606f\u987a\u5e8f\u6765\u3002","title":"2.14.1\u4e1a\u52a1\u573a\u666f"},{"location":"redis/day01/#2142","text":"\u770b\u4e00\u4e0b\u6700\u7ec8\u7684\u89e3\u51b3\u65b9\u6848\uff1a \u4f9d\u8d56list\u7684\u6570\u636e\u5177\u6709\u987a\u5e8f\u7684\u7279\u5f81\u5bf9\u6d88\u606f\u8fdb\u884c\u7ba1\u7406\uff0c\u5c06list\u7ed3\u6784\u4f5c\u4e3a\u6808\u4f7f\u7528 \u7f6e\u9876\u4e0e\u666e\u901a\u4f1a\u8bdd\u5206\u522b\u521b\u5efa\u72ec\u7acb\u7684list\u5206\u522b\u7ba1\u7406 \u5f53\u67d0\u4e2alist\u4e2d\u63a5\u6536\u5230\u7528\u6237\u6d88\u606f\u540e\uff0c\u5c06\u6d88\u606f\u53d1\u9001\u65b9\u7684id\u4ecelist\u7684\u4e00\u4fa7\u52a0\u5165list\uff08\u6b64\u5904\u8bbe\u5b9a\u5de6\u4fa7\uff09 \u591a\u4e2a\u76f8\u540cid\u53d1\u51fa\u7684\u6d88\u606f\u53cd\u590d\u5165\u6808\u4f1a\u51fa\u73b0\u95ee\u9898\uff0c\u5728\u5165\u6808\u4e4b\u524d\u65e0\u8bba\u662f\u5426\u5177\u6709\u5f53\u524did\u5bf9\u5e94\u7684\u6d88\u606f\uff0c\u5148\u5220\u9664\u5bf9\u5e94id \u63a8\u9001\u6d88\u606f\u65f6\u5148\u63a8\u9001\u7f6e\u9876\u4f1a\u8bddlist\uff0c\u518d\u63a8\u9001\u666e\u901a\u4f1a\u8bddlist\uff0c\u63a8\u9001\u5b8c\u6210\u7684list\u6e05\u9664\u6240\u6709\u6570\u636e \u6d88\u606f\u7684\u6570\u91cf\uff0c\u4e5f\u5c31\u662f\u5fae\u4fe1\u7528\u6237\u5bf9\u8bdd\u6570\u91cf\u91c7\u7528\u8ba1\u6570\u5668\u7684\u601d\u60f3\u53e6\u884c\u8bb0\u5f55\uff0c\u4f34\u968flist\u64cd\u4f5c\u540c\u6b65\u66f4\u65b0","title":"2.14.2  \u89e3\u51b3\u65b9\u6848"},{"location":"redis/day01/#2143","text":"\u603b\u7ed3\u4e00\u4e0b\uff0c\u5728\u6574\u4e2a\u6570\u636e\u7c7b\u578b\u7684\u90e8\u5206\uff0c\u6211\u4eec\u4e3b\u8981\u4ecb\u7ecd\u4e86\u54ea\u4e9b\u5185\u5bb9\uff1a \u9996\u5148\u6211\u4eec\u4e86\u89e3\u4e86\u4e00\u4e0b\u6570\u636e\u7c7b\u578b\uff0c\u63a5\u4e0b\u6765\u9488\u5bf9\u7740\u6211\u4eec\u8981\u5b66\u4e60\u7684\u6570\u636e\u7c7b\u578b\uff0c\u8fdb\u884c\u9010\u4e00\u8bb2\u89e3\u4e86string\u3001hash\u3001list\u3001set\u7b49\uff0c\u6700\u540e\u901a\u8fc7\u4e00\u4e2a\u6848\u4f8b\u603b\u7ed3\u4e86\u4e00\u4e0b\u524d\u9762\u7684\u6570\u636e\u7c7b\u578b\u7684\u4f7f\u7528\u573a\u666f\u3002","title":"2.14.3  \u6570\u636e\u7c7b\u578b\u603b\u7ed3"},{"location":"redis/day01/#3","text":"\u5728\u8fd9\u90e8\u5206\u4e2d\u5462\uff0c\u6211\u4eec\u5bb6\u5b66\u4e60\u4e24\u4e2a\u77e5\u8bc6\uff0c\u7b2c\u4e00\u4e2a\u662fkey\u7684\u5e38\u7528\u6307\u4ee4\uff0c\u7b2c\u4e8c\u4e2a\u662f\u6570\u636e\u5e93\u7684\u5e38\u7528\u6307\u4ee4\u3002\u548c\u524d\u9762\u6211\u4eec\u5b66\u6570\u636e\u7c7b\u578b\u505a\u4e00\u4e0b\u533a\u5206\uff0c\u524d\u9762\u4f60\u5b66\u7684\u90a3\u4e9b\u6307\u4ee4\u5462\uff0c\u90fd\u662f\u9488\u5bf9\u67d0\u4e00\u4e2a\u6570\u636e\u7c7b\u578b\u64cd\u4f5c\u7684\uff0c\u73b0\u5728\u5b66\u7684\u90fd\u662f\u5bf9\u6240\u6709\u7684\u64cd\u4f5c\u7684\uff0c\u6765\u770b\u4e00\u4e0b\uff0c\u6211\u4eec\u5728\u5b66\u4e60Key\u7684\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5148\u60f3\u4e00\u4e0b\u7684\u64cd\u4f5c\u6211\u4eec\u5e94\u8be5\u5b66\u54ea\u4e9b\u4e1c\u897f:","title":"3. \u5e38\u7528\u6307\u4ee4"},{"location":"redis/day01/#31_key","text":"","title":"3.1  key \u64cd\u4f5c\u5206\u6790"},{"location":"redis/day01/#311_key","text":"key\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u901a\u8fc7key\u83b7\u53d6redis\u4e2d\u4fdd\u5b58\u7684\u6570\u636e \u5bf9\u4e8ekey\u81ea\u8eab\u72b6\u6001\u7684\u76f8\u5173\u64cd\u4f5c\uff0c\u4f8b\u5982\uff1a\u5220\u9664\uff0c\u5224\u5b9a\u5b58\u5728\uff0c\u83b7\u53d6\u7c7b\u578b\u7b49 \u5bf9\u4e8ekey\u6709\u6548\u6027\u63a7\u5236\u76f8\u5173\u64cd\u4f5c\uff0c\u4f8b\u5982\uff1a\u6709\u6548\u671f\u8bbe\u5b9a\uff0c\u5224\u5b9a\u662f\u5426\u6709\u6548\uff0c\u6709\u6548\u72b6\u6001\u7684\u5207\u6362\u7b49 \u5bf9\u4e8ekey\u5feb\u901f\u67e5\u8be2\u64cd\u4f5c\uff0c\u4f8b\u5982\uff1a\u6309\u6307\u5b9a\u7b56\u7565\u67e5\u8be2key","title":"3.1.1  key\u5e94\u8be5\u8bbe\u8ba1\u54ea\u4e9b\u64cd\u4f5c\uff1f"},{"location":"redis/day01/#312_key","text":"\u5220\u9664\u6307\u5b9akey del key \u83b7\u53d6key\u662f\u5426\u5b58\u5728 exists key \u83b7\u53d6key\u7684\u7c7b\u578b type key 3.1.3 \u62d3\u5c55\u64cd\u4f5c \u6392\u5e8f sort \u6539\u540d rename key newkey renamenx key newkey","title":"3.1.2  key \u57fa\u672c\u64cd\u4f5c"},{"location":"redis/day01/#313_key","text":"\u4e3a\u6307\u5b9akey\u8bbe\u7f6e\u6709\u6548\u671f expire key seconds pexpire key milliseconds expireat key timestamp pexpireat key milliseconds-timestamp \u83b7\u53d6key\u7684\u6709\u6548\u65f6\u95f4 ttl key pttl key \u5207\u6362key\u4ece\u65f6\u6548\u6027\u8f6c\u6362\u4e3a\u6c38\u4e45\u6027 persist key","title":"3.1.3  key \u6269\u5c55\u64cd\u4f5c\uff08\u65f6\u6548\u6027\u63a7\u5236\uff09"},{"location":"redis/day01/#314_key","text":"\u67e5\u8be2key keys pattern \u67e5\u8be2\u6a21\u5f0f\u89c4\u5219 *\u5339\u914d\u4efb\u610f\u6570\u91cf\u7684\u4efb\u610f\u7b26\u53f7 ? \u914d\u5408\u4e00\u4e2a\u4efb\u610f\u7b26\u53f7 [] \u5339\u914d\u4e00\u4e2a\u6307\u5b9a\u7b26\u53f7 keys * keys \u67e5\u8be2\u6240\u6709 it* keys \u67e5\u8be2\u6240\u6709\u4ee5it\u5f00\u5934 *heima \u67e5\u8be2\u6240\u6709\u4ee5heima\u7ed3\u5c3e keys ??heima \u67e5\u8be2\u6240\u6709\u524d\u9762\u4e24\u4e2a\u5b57\u7b26\u4efb\u610f\uff0c\u540e\u9762\u4ee5heima\u7ed3\u5c3e \u67e5\u8be2\u6240\u6709\u4ee5 keys user:? user:\u5f00\u5934\uff0c\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u4efb\u610f keys u [ st ] er:1 \u67e5\u8be2\u6240\u6709\u4ee5u\u5f00\u5934\uff0c\u4ee5er:1\u7ed3\u5c3e\uff0c\u4e2d\u95f4\u5305\u542b\u4e00\u4e2a\u5b57\u6bcd\uff0cs\u6216t","title":"3.1.4  key \u6269\u5c55\u64cd\u4f5c\uff08\u67e5\u8be2\u6a21\u5f0f\uff09"},{"location":"redis/day01/#32","text":"","title":"3.2  \u6570\u636e\u5e93\u6307\u4ee4"},{"location":"redis/day01/#321_key","text":"\u5728\u8fd9\u4e2a\u5730\u65b9\u6211\u4eec\u6765\u8bb2\u4e00\u4e0b\u6570\u636e\u5e93\u7684\u5e38\u7528\u6307\u4ee4\uff0c\u5728\u8bb2\u8fd9\u4e2a\u4e1c\u897f\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u601d\u8003\u4e00\u4e2a\u95ee\u9898\uff1a \u5047\u5982\u8bf4\u4f60\u4eec\u5341\u4e2a\u4eba\u540c\u65f6\u64cd\u4f5credis\uff0c\u4f1a\u4e0d\u4f1a\u51fa\u73b0key\u540d\u5b57\u547d\u540d\u51b2\u7a81\u7684\u95ee\u9898\u3002 \u4e00\u5b9a\u4f1a\uff0c\u4e3a\u4ec0\u4e48?\u56e0\u4e3a\u4f60\u7684key\u662f\u7531\u7a0b\u5e8f\u800c\u5b9a\u4e49\u7684\u3002\u4f60\u60f3\u5199\u4ec0\u4e48\u5199\u4ec0\u4e48\uff0c\u90a3\u5728\u4f7f\u7528\u7684\u8fc7\u7a0b\u4e2d\u5927\u5bb6\u90fd\u5728\u4e0d\u505c\u7684\u52a0\uff0c\u65e9\u665a\u6709\u4e00\u5929\u4ed6\u4f1a\u51b2\u7a81\u7684\u3002 redis\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u4f34\u968f\u7740\u64cd\u4f5c\u6570\u636e\u91cf\u7684\u589e\u52a0\uff0c\u4f1a\u51fa\u73b0\u5927\u91cf\u7684\u6570\u636e\u4ee5\u53ca\u5bf9\u5e94\u7684key\u3002 \u90a3\u8fd9\u4e2a\u95ee\u9898\u6211\u4eec\u8981\u4e0d\u8981\u89e3\u51b3\uff1f\u8981\uff01\u600e\u4e48\u89e3\u51b3\u5462\uff1f\u6211\u4eec\u6700\u597d\u628a\u6570\u636e\u8fdb\u884c\u4e00\u4e2a\u5206\u7c7b\uff0c\u9664\u4e86\u547d\u540d\u89c4\u8303\u6211\u4eec\u505a\u7edf\u4e00\u4ee5\u5916\uff0c\u5982\u679c\u8fd8\u80fd\u628a\u5b83\u5206\u5f00\uff0c\u8fd9\u6837\u662f\u4e0d\u662f\u51b2\u7a81\u7684\u673a\u7387\u5c31\u4f1a\u5c0f\u4e00\u4e9b\u4e86\uff0c\u8fd9\u5c31\u662f\u54b1\u4eec\u4e0b\u9762\u8981\u8bf4\u7684\u89e3\u51b3\u65b9\u6848\uff01","title":"3.2.1  key \u7684\u91cd\u590d\u95ee\u9898"},{"location":"redis/day01/#322","text":"redis\u4e3a\u6bcf\u4e2a\u670d\u52a1\u63d0\u4f9b\u670916\u4e2a\u6570\u636e\u5e93\uff0c\u7f16\u53f7\u4ece0\u523015 \u6bcf\u4e2a\u6570\u636e\u5e93\u4e4b\u95f4\u7684\u6570\u636e\u76f8\u4e92\u72ec\u7acb \u5728\u5bf9\u5e94\u7684\u6570\u636e\u5e93\u4e2d\u5212\u51fa\u4e00\u5757\u533a\u57df\uff0c\u8bf4\u4ed6\u5c31\u662f\u51e0\uff0c\u4f60\u5c31\u7528\u51e0\u90a3\u5757\uff0c\u540c\u65f6\uff0c\u5176\u4ed6\u7684\u8fd9\u4e9b\u90fd\u53ef\u4ee5\u8fdb\u884c\u5b9a\u4e49\uff0c\u4e00\u5171\u662f16\u4e2a\uff0c\u8fd9\u91cc\u8fb9\u9700\u8981\u6ce8\u610f\u4e00\u70b9\uff0c\u4ed6\u4eec\u8fd916\u4e2a\u5171\u7528redis\u7684\u5185\u5b58\u3002\u6ca1\u6709\u8bf4\u8c01\u5927\u8c01\u5c0f\uff0c\u4e5f\u5c31\u662f\u8bf4\u6570\u5b57\u53ea\u662f\u4ee3\u8868\u4e86\u4e00\u5757\u513f\u533a\u57df\uff0c\u533a\u57df\u5177\u4f53\u591a\u5927\u672a\u77e5\u3002\u8fd9\u662f\u6570\u636e\u5e93\u7684\u4e00\u4e2a\u5206\u533a\u7684\u4e00\u4e2a\u7b56\u7565\uff01","title":"3.2.2  \u89e3\u51b3\u65b9\u6848"},{"location":"redis/day01/#323","text":"\u5207\u6362\u6570\u636e\u5e93 select index \u5176\u4ed6\u64cd\u4f5c ping","title":"3.2.3   \u6570\u636e\u5e93\u7684\u57fa\u672c\u64cd\u4f5c"},{"location":"redis/day01/#324","text":"\u6570\u636e\u79fb\u52a8 move key db \u6570\u636e\u603b\u91cf dbsize \u6570\u636e\u6e05\u9664 flushdb flushall","title":"3.2.4  \u6570\u636e\u5e93\u6269\u5c55\u64cd\u4f5c"},{"location":"redis/day01/#4_jedis","text":"\u5728\u5b66\u4e60\u5b8credis\u540e\uff0c\u6211\u4eec\u73b0\u5728\u5c31\u8981\u7528Java\u6765\u8fde\u63a5redis\u4e86\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u7684\u8fd9\u4e00\u7ae0\u8981\u5b66\u7684Jedis\u4e86\u3002\u5728\u8fd9\u4e2a\u90e8\u5206\uff0c\u6211\u4eec\u4e3b\u8981\u8bb2\u89e3\u4ee5\u4e0b3\u4e2a\u5185\u5bb9\uff1a HelloWorld\uff08Jedis\u7248\uff09 Jedis\u7b80\u6613\u5de5\u5177\u7c7b\u5f00\u53d1 \u53ef\u89c6\u5316\u5ba2\u6237\u7aef","title":"4. Jedis"},{"location":"redis/day01/#41_jedis","text":"","title":"4.1  Jedis\u7b80\u4ecb"},{"location":"redis/day01/#411_redis","text":"\u5bf9\u4e8e\u6211\u4eec\u73b0\u5728\u7684\u6570\u636e\u6765\u8bf4\uff0c\u5b83\u662f\u5728\u6211\u4eec\u7684redis\u4e2d\uff0c\u800c\u6700\u7ec8\u6211\u4eec\u662f\u8981\u505a\u7a0b\u5e8f\u3002\u90a3\u4e48\u7a0b\u5e8f\u5c31\u8981\u548c\u6211\u4eec\u7684redis\u8fdb\u884c\u8fde\u63a5\u3002\u5e72\u4ec0\u4e48\u4e8b\u60c5\u5462\uff1f\u4e24\u4ef6\u4e8b\uff1a\u7a0b\u5e8f\u4e2d\u6709\u6570\u636e\u7684\u65f6\u5019\uff0c\u6211\u4eec\u8981\u628a\u8fd9\u4e9b\u6570\u636e\u5168\u90e8\u4ea4\u7ed9redis\u7ba1\u7406\u3002\u540c\u65f6\uff0credis\u4e2d\u7684\u6570\u636e\u8fd8\u80fd\u53d6\u51fa\u6765\uff0c\u56de\u5230\u6211\u4eec\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u3002\u90a3\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u5728Java\u4e0eredis\u4e4b\u95f4\u6253\u4ea4\u9053\u7684\u8fd9\u4e2a\u4e1c\u897f\u5c31\u53eb\u505aJedis.\u7b80\u5355\u8bf4\uff0cJedis\u5c31\u662f\u63d0\u4f9b\u4e86Java\u4e0eredis\u7684\u8fde\u63a5\u670d\u52a1\u7684\uff0c\u91cc\u8fb9\u6709\u5404\u79cd\u5404\u6837\u7684API\u63a5\u53e3\uff0c\u4f60\u53ef\u4ee5\u53bb\u8c03\u7528\u5b83\u3002 \u9664\u4e86Jedis\u5916\uff0c\u8fd8\u6709\u6ca1\u6709\u5176\u4ed6\u7684\u8fd9\u79cd\u8fde\u63a5\u670d\u52a1\u5462\uff1f\u5176\u5b9e\u8fd8\u6709\u5f88\u591a\uff0c\u4e86\u89e3\u4e00\u4e0b\uff1a Java\u8bed\u8a00\u8fde\u63a5redis\u670d\u52a1 Jedis\uff08SpringData\u3001Redis \u3001 Lettuce\uff09 \u5176\u5b83\u8bed\u8a00\uff1aC \u3001C++ \u3001C# \u3001Erlang\u3001Lua \u3001Objective-C \u3001Perl \u3001PHP \u3001Python \u3001Ruby \u3001Scala","title":"4.1.1  \u7f16\u7a0b\u8bed\u8a00\u4e0eredis"},{"location":"redis/day01/#412","text":"(1)jar\u5305\u5bfc\u5165 \u4e0b\u8f7d\u5730\u5740\uff1ahttps://mvnrepository.com/artifact/redis.clients/jedis \u57fa\u4e8emaven <dependency> <groupId> redis.clients </groupId> <artifactId> jedis </artifactId> <version> 2.9.0 </version> </dependency> (2)\u5ba2\u6237\u7aef\u8fde\u63a5redis \u8fde\u63a5redis Jedis jedis = new Jedis(\"localhost\", 6379); \u64cd\u4f5credis jedis.set(\"name\", \"itheima\"); jedis.get(\"name\"); \u5173\u95edredis\u8fde\u63a5 jedis.close(); API\u6587\u6863 http://xetorthio.github.io/jedis/","title":"4.1.2  \u51c6\u5907\u5de5\u4f5c"},{"location":"redis/day01/#413","text":"\u521b\u5efa\uff1acom.itheima.JedisTest public class JedisTest { public static void main ( String [] args ) { //1.\u83b7\u53d6\u8fde\u63a5\u5bf9\u8c61 Jedis jedis = new Jedis ( \"192.168.40.130\" , 6379 ); //2.\u6267\u884c\u64cd\u4f5c jedis . set ( \"age\" , \"39\" ); String hello = jedis . get ( \"hello\" ); System . out . println ( hello ); jedis . lpush ( \"list1\" , \"a\" , \"b\" , \"c\" , \"d\" ); List < String > list1 = jedis . lrange ( \"list1\" , 0 , - 1 ); for ( String s : list1 ) { System . out . println ( s ); } jedis . sadd ( \"set1\" , \"abc\" , \"abc\" , \"def\" , \"poi\" , \"cba\" ); Long len = jedis . scard ( \"set1\" ); System . out . println ( len ); //3.\u5173\u95ed\u8fde\u63a5 jedis . close (); } }","title":"4.1.3 \u4ee3\u7801\u5b9e\u73b0"},{"location":"redis/day01/#42_jedis","text":"\u524d\u9762\u6211\u4eec\u505a\u7684\u7a0b\u5e8f\u8fd8\u662f\u6709\u70b9\u513f\u5c0f\u95ee\u9898\uff0c\u5c31\u662f\u6211\u4eec\u7684Jedis\u5bf9\u8c61\u7684\u7ba1\u7406\u662f\u6211\u4eec\u81ea\u5df1\u521b\u5efa\u7684\uff0c\u771f\u5b9e\u4f01\u4e1a\u5f00\u53d1\u4e2d\u662f\u4e0d\u53ef\u80fd\u8ba9\u4f60\u53bbnew\u4e00\u4e2a\u7684\uff0c\u90a3\u63a5\u4e0b\u6765\u54b1\u4eec\u5c31\u8981\u505a\u4e00\u4e2a\u5de5\u5177\u7c7b\uff0c\u7b80\u5355\u6765\u8bf4\uff0c\u5c31\u662f\u505a\u4e00\u4e2a\u521b\u5efaJedis\u7684\u8fd9\u6837\u7684\u4e00\u4e2a\u5de5\u5177\u3002","title":"4.2  Jedis\u7b80\u6613\u5de5\u5177\u7c7b\u5f00\u53d1"},{"location":"redis/day01/#421","text":"JedisPool\uff1aJedis\u63d0\u4f9b\u7684\u8fde\u63a5\u6c60\u6280\u672f poolConfig:\u8fde\u63a5\u6c60\u914d\u7f6e\u5bf9\u8c61 host:redis\u670d\u52a1\u5730\u5740 port:redis\u670d\u52a1\u7aef\u53e3\u53f7 JedisPool\u7684\u6784\u9020\u5668\u5982\u4e0b\uff1a public JedisPool ( GenericObjectPoolConfig poolConfig , String host , int port ) { this ( poolConfig , host , port , 2000 , ( String ) null , 0 , ( String ) null ); }","title":"4.2.1  \u57fa\u4e8e\u8fde\u63a5\u6c60\u83b7\u53d6\u8fde\u63a5"},{"location":"redis/day01/#422","text":"\u521b\u5efajedis\u7684\u914d\u7f6e\u6587\u4ef6\uff1ajedis.properties jedis.host = 192.168.40.130 jedis.port = 6379 jedis.maxTotal = 50 jedis.maxIdle = 10","title":"4.2.2  \u5c01\u88c5\u8fde\u63a5\u53c2\u6570"},{"location":"redis/day01/#423","text":"\u521b\u5efaJedisUtils\uff1acom.itheima.util.JedisUtils\uff0c\u4f7f\u7528\u9759\u6001\u4ee3\u7801\u5757\u521d\u59cb\u5316\u8d44\u6e90 public class JedisUtils { private static int maxTotal ; private static int maxIdel ; private static String host ; private static int port ; private static JedisPoolConfig jpc ; private static JedisPool jp ; static { ResourceBundle bundle = ResourceBundle . getBundle ( \"redis\" ); maxTotal = Integer . parseInt ( bundle . getString ( \"redis.maxTotal\" )); maxIdel = Integer . parseInt ( bundle . getString ( \"redis.maxIdel\" )); host = bundle . getString ( \"redis.host\" ); port = Integer . parseInt ( bundle . getString ( \"redis.port\" )); //Jedis\u8fde\u63a5\u6c60\u914d\u7f6e jpc = new JedisPoolConfig (); jpc . setMaxTotal ( maxTotal ); jpc . setMaxIdle ( maxIdel ); jp = new JedisPool ( jpc , host , port ); } }","title":"4.2.3  \u52a0\u8f7d\u914d\u7f6e\u4fe1\u606f"},{"location":"redis/day01/#424","text":"\u5bf9\u5916\u8bbf\u95ee\u63a5\u53e3\uff0c\u63d0\u4f9bjedis\u8fde\u63a5\u5bf9\u8c61\uff0c\u8fde\u63a5\u4ece\u8fde\u63a5\u6c60\u83b7\u53d6\uff0c\u5728JedisUtils\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u83b7\u53d6jedis\u7684\u65b9\u6cd5\uff1agetJedis public static Jedis getJedis (){ Jedis jedis = jedisPool . getResource (); return jedis ; }","title":"4.2.4  \u83b7\u53d6\u8fde\u63a5"},{"location":"redis/day01/#43","text":"4.3.1 Redis Desktop Manager","title":"4.3  \u53ef\u89c6\u5316\u5ba2\u6237\u7aef"},{"location":"redis/day01/#5","text":"\u4e0b\u9762\u5462\uff0c\u8fdb\u5165\u5230\u6301\u4e45\u5316\u7684\u5b66\u4e60.\u8fd9\u90e8\u5206\u5185\u5bb9\u7406\u89e3\u7684\u4e1c\u897f\u591a\uff0c\u64cd\u4f5c\u7684\u4e1c\u897f\u5c11\u3002\u5728\u8fd9\u4e2a\u90e8\u5206\uff0c\u6211\u4eec\u5c06\u8bb2\u89e3\u56db\u4e2a\u4e1c\u897f\uff1a \u6301\u4e45\u5316\u7b80\u4ecb RDB AOF RDB\u4e0eAOF\u533a\u522b","title":"5. \u6301\u4e45\u5316"},{"location":"redis/day01/#51","text":"","title":"5.1  \u6301\u4e45\u5316\u7b80\u4ecb"},{"location":"redis/day01/#511_-","text":"\u4e0d\u77e5\u9053\u5927\u5bb6\u6709\u6ca1\u6709\u9047\u89c1\u8fc7\uff0c\u5c31\u662f\u6b63\u5de5\u4f5c\u7684\u65f6\u5019\u505c\u7535\u4e86\uff0c\u5982\u679c\u4f60\u7528\u7684\u662f\u7b14\u8bb0\u672c\u7535\u8111\u8fd8\u597d\uff0c\u4f60\u6709\u7535\u6c60\uff0c\u4f46\u5982\u679c\u4f60\u7528\u7684\u662f\u53f0\u5f0f\u673a\u5462\uff0c\u90a3\u6050\u6015\u5c31\u6bd4\u8f83\u707e\u96be\u4e86\uff0c\u5047\u5982\u4f60\u73b0\u5728\u6b63\u5728\u5199\u4e00\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u6587\u6863\uff0c\u5982\u679c\u4f60\u8981\u4f7f\u7528\u7684\u662fword\uff0c\u8fd9\u79cd\u529e\u516c\u81ea\u52a8\u5316\u8f6f\u4ef6\u7684\u8bdd\uff0c\u4ed6\u4e00\u65e6\u9047\u5230\u505c\u7535\uff0c\u5176\u5b9e\u4f60\u4e0d\u7528\u62c5\u5fc3\uff0c\u56e0\u4e3a\u5b83\u4f1a\u7ed9\u4f60\u751f\u6210\u4e00\u4e9b\u5176\u4ed6\u7684\u6587\u4ef6\u3002 \u5176\u5b9e\u4ed6\u4eec\u90fd\u5728\u505a\u4e00\u4ef6\u4e8b\u513f\uff0c\u5e2e\u4f60\u81ea\u52a8\u6062\u590d\uff0c\u6709\u4e86\u8fd9\u4e2a\u6587\u4ef6\uff0c\u4f60\u524d\u9762\u7684\u4e1c\u897f\u5c31\u4e0d\u518d\u4e22\u4e86\u3002\u90a3\u4ec0\u4e48\u662f\u81ea\u52a8\u6062\u590d\u5462\uff1f\u4f60\u8981\u5148\u4e86\u89e3\u4ed6\u7684\u6574\u4e2a\u8fc7\u7a0b\u3002 \u6211\u4eec\u8bf4\u81ea\u52a8\u6062\u590d\uff0c\u5176\u5b9e\u57fa\u4e8e\u7684\u4e00\u4e2a\u524d\u63d0\u5c31\u662f\u4ed6\u63d0\u524d\u628a\u4f60\u7684\u6570\u636e\u7ed9\u5b58\u8d77\u6765\u4e86\u3002\u4f60\u5e73\u5e38\u64cd\u4f5c\u7684\u6240\u6709\u4fe1\u606f\u90fd\u662f\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u800c\u6211\u4eec\u771f\u6b63\u7684\u4fe1\u606f\u662f\u4fdd\u5b58\u5728\u786c\u76d8\u4e2d\u7684\uff0c\u5185\u5b58\u4e2d\u7684\u4fe1\u606f\u65ad\u7535\u4ee5\u540e\u5c31\u6d88\u5931\u4e86\uff0c\u786c\u76d8\u4e2d\u7684\u4fe1\u606f\u65ad\u7535\u4ee5\u540e\u8fd8\u53ef\u4ee5\u4fdd\u7559\u4e0b\u6765\uff01 \u6211\u4eec\u5c06\u6587\u4ef6\u7531\u5185\u5b58\u4e2d\u4fdd\u5b58\u5230\u786c\u76d8\u4e2d\u7684\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u6211\u4eec\u53eb\u505a\u6570\u636e\u4fdd\u5b58\uff0c\u4e5f\u5c31\u53eb\u505a\u6301\u4e45\u5316\u3002\u4f46\u662f\u628a\u5b83\u4fdd\u5b58\u4e0b\u6765\u4e0d\u662f\u4f60\u7684\u76ee\u7684\uff0c\u6700\u7ec8\u4f60\u8fd8\u8981\u628a\u5b83\u518d\u8bfb\u53d6\u51fa\u6765\uff0c\u5b83\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u6211\u4eec\u53eb\u505a\u6570\u636e\u6062\u590d\uff0c\u8fd9\u5c31\u662f\u6211\u4eec\u6240\u8bf4\u7684word\u4e3a\u4ec0\u4e48\u65ad\u7535\u4ee5\u540e\u8fd8\u80fd\u591f\u7ed9\u4f60\u4fdd\u7559\u6587\u4ef6\uff0c\u56e0\u4e3a\u5b83\u6267\u884c\u4e86\u4e00\u4e2a\u81ea\u52a8\u5907\u4efd\u7684\u8fc7\u7a0b\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u81ea\u52a8\u7684\u5f62\u5f0f\uff0c\u628a\u4f60\u7684\u6570\u636e\u5b58\u50a8\u8d77\u6765\uff0c\u90a3\u4e48\u6709\u4e86\u8fd9\u79cd\u5f62\u5f0f\u4ee5\u540e\uff0c\u6211\u4eec\u7684\u6570\u636e\u5c31\u53ef\u4ee5\u7531\u5185\u5b58\u5230\u786c\u76d8\u4e0a\u5b9e\u73b0\u4fdd\u5b58\u3002","title":"5.1.1  \u573a\u666f-\u610f\u5916\u65ad\u7535"},{"location":"redis/day01/#512","text":"(1)\u4ec0\u4e48\u662f\u6301\u4e45\u5316 \u5229\u7528\u6c38\u4e45\u6027\u5b58\u50a8\u4ecb\u8d28\u5c06\u6570\u636e\u8fdb\u884c\u4fdd\u5b58\uff0c\u5728\u7279\u5b9a\u7684\u65f6\u95f4\u5c06\u4fdd\u5b58\u7684\u6570\u636e\u8fdb\u884c\u6062\u590d\u7684\u5de5\u4f5c\u673a\u5236\u79f0\u4e3a\u6301\u4e45\u5316 \u3002 \u6301\u4e45\u5316\u7528\u4e8e\u9632\u6b62\u6570\u636e\u7684\u610f\u5916\u4e22\u5931\uff0c\u786e\u4fdd\u6570\u636e\u5b89\u5168\u6027\u3002 (2)\u6301\u4e45\u5316\u8fc7\u7a0b\u4fdd\u5b58\u4ec0\u4e48\uff1f \u6211\u4eec\u77e5\u9053\u4e00\u70b9\uff0c\u8ba1\u7b97\u673a\u4e2d\u7684\u6570\u636e\u5168\u90e8\u90fd\u662f\u4e8c\u8fdb\u5236\uff0c\u5982\u679c\u73b0\u5728\u6211\u8981\u4f60\u7ed9\u6211\u4fdd\u5b58\u4e00\u7ec4\u6570\u636e\u7684\u8bdd\uff0c\u4f60\u6709\u4ec0\u4e48\u6837\u7684\u65b9\u5f0f\u5462\uff0c\u5176\u5b9e\u6700\u7b80\u5355\u7684\u5c31\u662f\u73b0\u5728\u957f\u4ec0\u4e48\u6837\uff0c\u6211\u5c31\u8bb0\u4e0b\u6765\u5c31\u884c\u4e86\uff0c\u90a3\u4e48\u8fd9\u79cd\u662f\u8bb0\u5f55\u7eaf\u7cb9\u7684\u6570\u636e\uff0c\u4e5f\u53eb\u505a\u5feb\u7167\u5b58\u50a8\uff0c\u4e5f\u5c31\u662f\u5b83\u4fdd\u5b58\u7684\u662f\u67d0\u4e00\u65f6\u523b\u7684\u6570\u636e\u72b6\u6001\u3002 \u8fd8\u6709\u4e00\u79cd\u5f62\u5f0f\uff0c\u5b83\u4e0d\u8bb0\u5f55\u4f60\u7684\u6570\u636e\uff0c\u5b83\u8bb0\u5f55\u4f60\u6240\u6709\u7684\u64cd\u4f5c\u8fc7\u7a0b\uff0c\u6bd4\u5982\u8bf4\u5927\u5bb6\u7528idea\u7684\u65f6\u5019\uff0c\u6709\u6ca1\u6709\u9047\u5230\u8fc7\u5199\u9519\u4e86ctrl+z\u64a4\u9500\uff0c\u7136\u540ectrl+y\u8fd8\u80fd\u6062\u590d\uff0c\u8fd9\u4e2a\u5730\u65b9\u5b83\u4e5f\u662f\u5728\u8bb0\u5f55\uff0c\u4f46\u662f\u8bb0\u5f55\u7684\u662f\u4f60\u6240\u6709\u7684\u64cd\u4f5c\u8fc7\u7a0b\uff0c\u90a3\u6211\u60f3\u95ee\u4e00\u4e0b\uff0c\u64cd\u4f5c\u8fc7\u7a0b\uff0c\u6211\u90fd\u7ed9\u4f60\u7559\u4e0b\u6765\u4e86\uff0c\u4f60\u8bf4\u6570\u636e\u8fd8\u4f1a\u4e22\u5417\uff1f\u80af\u5b9a\u4e0d\u4f1a\u4e22\uff0c\u56e0\u4e3a\u4f60\u6240\u6709\u7684\u64cd\u4f5c\u8fc7\u7a0b\u6211\u90fd\u4fdd\u5b58\u4e86\u3002\u8fd9\u79cd\u4fdd\u5b58\u64cd\u4f5c\u8fc7\u7a0b\u7684\u5b58\u50a8\uff0c\u7528\u4e13\u4e1a\u672f\u8bed\u6765\u8bf4\u53ef\u4ee5\u8bf4\u662f\u65e5\u5fd7\uff0c\u8fd9\u662f\u4e24\u79cd\u4e0d\u540c\u7684\u4fdd\u5b58\u6570\u636e\u7684\u5f62\u5f0f\u554a\u3002 \u603b\u7ed3\u4e00\u4e0b\uff1a \u7b2c\u4e00\u79cd\uff1a\u5c06\u5f53\u524d\u6570\u636e\u72b6\u6001\u8fdb\u884c\u4fdd\u5b58\uff0c\u5feb\u7167\u5f62\u5f0f\uff0c\u5b58\u50a8\u6570\u636e\u7ed3\u679c\uff0c\u5b58\u50a8\u683c\u5f0f\u7b80\u5355\uff0c\u5173\u6ce8\u70b9\u5728\u6570\u636e\u3002 \u7b2c\u4e8c\u79cd\uff1a\u5c06\u6570\u636e\u7684\u64cd\u4f5c\u8fc7\u7a0b\u8fdb\u884c\u4fdd\u5b58\uff0c\u65e5\u5fd7\u5f62\u5f0f\uff0c\u5b58\u50a8\u64cd\u4f5c\u8fc7\u7a0b\uff0c\u5b58\u50a8\u683c\u5f0f\u590d\u6742\uff0c\u5173\u6ce8\u70b9\u5728\u6570\u636e\u7684\u64cd\u4f5c\u8fc7\u7a0b\u3002","title":"5.1.2  \u4ec0\u4e48\u662f\u6301\u4e45\u5316"},{"location":"redis/day01/#52_rdb","text":"","title":"5.2  RDB"},{"location":"redis/day01/#521_save","text":"\u624b\u52a8\u6267\u884c\u4e00\u6b21\u4fdd\u5b58\u64cd\u4f5c save save\u6307\u4ee4\u76f8\u5173\u914d\u7f6e \u8bbe\u7f6e\u672c\u5730\u6570\u636e\u5e93\u6587\u4ef6\u540d\uff0c\u9ed8\u8ba4\u503c\u4e3a dump.rdb\uff0c\u901a\u5e38\u8bbe\u7f6e\u4e3adump-\u7aef\u53e3\u53f7.rdb dbfilename filename \u8bbe\u7f6e\u5b58\u50a8.rdb\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u901a\u5e38\u8bbe\u7f6e\u6210\u5b58\u50a8\u7a7a\u95f4\u8f83\u5927\u7684\u76ee\u5f55\u4e2d\uff0c\u76ee\u5f55\u540d\u79f0data dir path \u8bbe\u7f6e\u5b58\u50a8\u81f3\u672c\u5730\u6570\u636e\u5e93\u65f6\u662f\u5426\u538b\u7f29\u6570\u636e\uff0c\u9ed8\u8ba4yes\uff0c\u8bbe\u7f6e\u4e3ano\uff0c\u8282\u7701 CPU \u8fd0\u884c\u65f6\u95f4\uff0c\u4f46\u5b58\u50a8\u6587\u4ef6\u53d8\u5927 rdbcompression yes|no \u8bbe\u7f6e\u8bfb\u5199\u6587\u4ef6\u8fc7\u7a0b\u662f\u5426\u8fdb\u884cRDB\u683c\u5f0f\u6821\u9a8c\uff0c\u9ed8\u8ba4yes\uff0c\u8bbe\u7f6e\u4e3ano\uff0c\u8282\u7ea6\u8bfb\u519910%\u65f6\u95f4\u6d88\u8017\uff0c\u5355\u5b58\u5728\u6570\u636e\u635f\u574f\u7684\u98ce\u9669 rdbchecksum yes|no save\u6307\u4ee4\u5de5\u4f5c\u539f\u7406 \u9700\u8981\u6ce8\u610f\u4e00\u4e2a\u95ee\u9898\uff0c\u6765\u770b\u4e00\u4e0b\uff0c\u73b0\u5728\u6709\u56db\u4e2a\u5ba2\u6237\u7aef\u5404\u81ea\u8981\u6267\u884c\u4e00\u4e2a\u6307\u4ee4\uff0c\u628a\u8fd9\u4e9b\u6307\u4ee4\u53d1\u9001\u5230redis\u670d\u52a1\u5668\u540e\uff0c\u4ed6\u4eec\u6267\u884c\u6709\u4e00\u4e2a\u5148\u540e\u987a\u5e8f\u95ee\u9898\uff0c\u5047\u5b9a\u5c31\u662f\u6309\u71671234\u7684\u987a\u5e8f\u653e\u8fc7\u53bb\u7684\u8bdd\uff0c\u90a3\u4f1a\u662f\u4ec0\u4e48\u6837\u7684\uff1f \u8bb0\u5f97redis\u662f\u4e2a\u5355\u7ebf\u7a0b\u7684\u5de5\u4f5c\u6a21\u5f0f\uff0c\u5b83\u4f1a\u521b\u5efa\u4e00\u4e2a\u4efb\u52a1\u961f\u5217\uff0c\u6240\u6709\u7684\u547d\u4ee4\u90fd\u4f1a\u8fdb\u5230\u8fd9\u4e2a\u961f\u5217\u91cc\u8fb9\uff0c\u5728\u8fd9\u513f\u6392\u961f\u6267\u884c\uff0c\u6267\u884c\u5b8c\u4e00\u4e2a\u6d88\u5931\u4e00\u4e2a\uff0c\u5f53\u6240\u6709\u7684\u547d\u4ee4\u90fd\u6267\u884c\u5b8c\u4e86\uff0cOK\uff0c\u7ed3\u679c\u8fbe\u5230\u4e86\u3002 \u4f46\u662f\u5982\u679c\u73b0\u5728\u6211\u4eec\u6267\u884c\u7684\u65f6\u5019save\u6307\u4ee4\u4fdd\u5b58\u7684\u6570\u636e\u91cf\u5f88\u5927\u4f1a\u662f\u4ec0\u4e48\u73b0\u8c61\u5462\uff1f \u4ed6\u4f1a\u975e\u5e38\u8017\u65f6\uff0c\u4ee5\u81f3\u4e8e\u5f71\u54cd\u5230\u5b83\u5728\u6267\u884c\u7684\u65f6\u5019\uff0c\u540e\u9762\u7684\u6307\u4ee4\u90fd\u8981\u7b49\uff0c\u6240\u4ee5\u8bf4\u8fd9\u79cd\u6a21\u5f0f\u662f\u4e0d\u53cb\u597d\u7684\uff0c\u8fd9\u662fsave\u6307\u4ee4\u5bf9\u5e94\u7684\u4e00\u4e2a\u95ee\u9898\uff0c\u5f53cpu\u6267\u884c\u7684\u65f6\u5019\u4f1a\u963b\u585eredis\u670d\u52a1\u5668\uff0c\u76f4\u5230\u4ed6\u6267\u884c\u5b8c\u6bd5\uff0c\u6240\u4ee5\u8bf4\u6211\u4eec\u4e0d\u5efa\u8bae\u5927\u5bb6\u5728\u7ebf\u4e0a\u73af\u5883\u7528save\u6307\u4ee4\u3002","title":"5.2.1  save\u6307\u4ee4"},{"location":"redis/day01/#522_bgsave","text":"\u4e4b\u524d\u6211\u4eec\u8bb2\u5230\u4e86\u5f53save\u6307\u4ee4\u7684\u6570\u636e\u91cf\u8fc7\u5927\u65f6\uff0c\u5355\u7ebf\u7a0b\u6267\u884c\u65b9\u5f0f\u9020\u6210\u6548\u7387\u8fc7\u4f4e\uff0c\u90a3\u5e94\u8be5\u5982\u4f55\u5904\u7406\uff1f \u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\uff1a bgsave \u6307\u4ee4\uff0cbg\u5176\u5b9e\u662fbackground\u7684\u610f\u601d\uff0c\u540e\u53f0\u6267\u884c\u7684\u610f\u601d \u624b\u52a8\u542f\u52a8\u540e\u53f0\u4fdd\u5b58\u64cd\u4f5c\uff0c\u4f46\u4e0d\u662f\u7acb\u5373\u6267\u884c bgsave bgsave\u6307\u4ee4\u76f8\u5173\u914d\u7f6e \u540e\u53f0\u5b58\u50a8\u8fc7\u7a0b\u4e2d\u5982\u679c\u51fa\u73b0\u9519\u8bef\u73b0\u8c61\uff0c\u662f\u5426\u505c\u6b62\u4fdd\u5b58\u64cd\u4f5c\uff0c\u9ed8\u8ba4yes stop-writes-on-bgsave-error yes|no \u5176 \u4ed6 dbfilename filename dir path rdbcompression yes|no rdbchecksum yes|no bgsave\u6307\u4ee4\u5de5\u4f5c\u539f\u7406 \u5f53\u6267\u884cbgsave\u7684\u65f6\u5019\uff0c\u5ba2\u6237\u7aef\u53d1\u51fabgsave\u6307\u4ee4\u7ed9\u5230redis\u670d\u52a1\u5668\u3002\u6ce8\u610f\uff0c\u8fd9\u4e2a\u65f6\u5019\u670d\u52a1\u5668\u9a6c\u4e0a\u56de\u4e00\u4e2a\u7ed3\u679c\u544a\u8bc9\u5ba2\u6237\u7aef\u540e\u53f0\u5df2\u7ecf\u5f00\u59cb\u4e86\uff0c\u4e0e\u6b64\u540c\u65f6\u5b83\u4f1a\u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u4f7f\u7528Linux\u7684fork\u51fd\u6570\u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u8ba9\u8fd9\u4e2a\u5b50\u8fdb\u7a0b\u53bb\u6267\u884csave\u76f8\u5173\u7684\u64cd\u4f5c\uff0c\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u60f3\u4e00\u4e0b\uff0c\u6211\u4eec\u4e3b\u8fdb\u7a0b\u4e00\u76f4\u5728\u5904\u7406\u6307\u4ee4\uff0c\u800c\u5b50\u8fdb\u7a0b\u5728\u6267\u884c\u540e\u53f0\u7684\u4fdd\u5b58\uff0c\u5b83\u4f1a\u4e0d\u4f1a\u5e72\u6270\u5230\u4e3b\u8fdb\u7a0b\u7684\u6267\u884c\u5417\uff1f \u7b54\u6848\u662f\u4e0d\u4f1a\uff0c\u6240\u4ee5\u8bf4\u4ed6\u624d\u662f\u4e3b\u6d41\u65b9\u6848\u3002\u5b50\u8fdb\u7a0b\u5f00\u59cb\u6267\u884c\u4e4b\u540e\uff0c\u5b83\u5c31\u4f1a\u521b\u5efa\u554aRDB\u6587\u4ef6\u628a\u5b83\u5b58\u8d77\u6765\uff0c\u64cd\u4f5c\u5b8c\u4ee5\u540e\u4ed6\u4f1a\u628a\u8fd9\u4e2a\u7ed3\u679c\u8fd4\u56de\uff0c\u4e5f\u5c31\u662f\u8bf4bgsave\u7684\u8fc7\u7a0b\u5206\u6210\u4e24\u4e2a\u8fc7\u7a0b\uff0c\u7b2c\u4e00\u4e2a\u662f\u670d\u52a1\u7aef\u62ff\u5230\u6307\u4ee4\u76f4\u63a5\u544a\u8bc9\u5ba2\u6237\u7aef\u5f00\u59cb\u6267\u884c\u4e86\uff1b\u53e6\u5916\u4e00\u4e2a\u8fc7\u7a0b\u662f\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u5728\u5b8c\u6210\u540e\u53f0\u7684\u4fdd\u5b58\u64cd\u4f5c\uff0c\u64cd\u4f5c\u5b8c\u4ee5\u540e\u56de\u4e00\u4e2a\u6d88\u606f\u3002","title":"5.2.2  bgsave\u6307\u4ee4"},{"location":"redis/day01/#523_save","text":"\u8bbe\u7f6e\u81ea\u52a8\u6301\u4e45\u5316\u7684\u6761\u4ef6\uff0c\u6ee1\u8db3\u9650\u5b9a\u65f6\u95f4\u8303\u56f4\u5185key\u7684\u53d8\u5316\u6570\u91cf\u8fbe\u5230\u6307\u5b9a\u6570\u91cf\u5373\u8fdb\u884c\u6301\u4e45\u5316 save second changes \u53c2\u6570 second\uff1a\u76d1\u63a7\u65f6\u95f4\u8303\u56f4 changes\uff1a\u76d1\u63a7key\u7684\u53d8\u5316\u91cf \u8303\u4f8b\uff1a save 900 1 save 300 10 save 60 10000 \u5176\u4ed6\u76f8\u5173\u914d\u7f6e\uff1a dbfilename filename dir path rdbcompression yes|no rdbchecksum yes|no stop-writes-on-bgsave-error yes|no save\u914d\u7f6e\u5de5\u4f5c\u539f\u7406","title":"5.2.3 save\u914d\u7f6e\u81ea\u52a8\u6267\u884c"},{"location":"redis/day01/#524_rdb","text":"\u65b9\u5f0f save\u6307\u4ee4 bgsave\u6307\u4ee4 \u8bfb\u5199 \u540c\u6b65 \u5f02\u6b65 \u963b\u585e\u5ba2\u6237\u7aef\u6307\u4ee4 \u662f \u5426 \u989d\u5916\u5185\u5b58\u6d88\u8017 \u5426 \u662f \u542f\u52a8\u65b0\u8fdb\u7a0b \u5426 \u662f RDB\u7279\u6b8a\u542f\u52a8\u5f62\u5f0f \u670d\u52a1\u5668\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u91cd\u542f debug reload \u5173\u95ed\u670d\u52a1\u5668\u65f6\u6307\u5b9a\u4fdd\u5b58\u6570\u636e shutdown save \u5168\u91cf\u590d\u5236\uff08\u5728\u4e3b\u4ece\u590d\u5236\u4e2d\u8be6\u7ec6\u8bb2\u89e3\uff09 RDB\u4f18\u70b9\uff1a RDB\u662f\u4e00\u4e2a\u7d27\u51d1\u538b\u7f29\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5b58\u50a8\u6548\u7387\u8f83\u9ad8 RDB\u5185\u90e8\u5b58\u50a8\u7684\u662fredis\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\u7684\u6570\u636e\u5feb\u7167\uff0c\u975e\u5e38\u9002\u5408\u7528\u4e8e\u6570\u636e\u5907\u4efd\uff0c\u5168\u91cf\u590d\u5236\u7b49\u573a\u666f RDB\u6062\u590d\u6570\u636e\u7684\u901f\u5ea6\u8981\u6bd4AOF\u5feb\u5f88\u591a \u5e94\u7528\uff1a\u670d\u52a1\u5668\u4e2d\u6bcfX\u5c0f\u65f6\u6267\u884cbgsave\u5907\u4efd\uff0c\u5e76\u5c06RDB\u6587\u4ef6\u62f7\u8d1d\u5230\u8fdc\u7a0b\u673a\u5668\u4e2d\uff0c\u7528\u4e8e\u707e\u96be\u6062\u590d\u3002 RDB\u7f3a\u70b9 RDB\u65b9\u5f0f\u65e0\u8bba\u662f\u6267\u884c\u6307\u4ee4\u8fd8\u662f\u5229\u7528\u914d\u7f6e\uff0c\u65e0\u6cd5\u505a\u5230\u5b9e\u65f6\u6301\u4e45\u5316\uff0c\u5177\u6709\u8f83\u5927\u7684\u53ef\u80fd\u6027\u4e22\u5931\u6570\u636e bgsave\u6307\u4ee4\u6bcf\u6b21\u8fd0\u884c\u8981\u6267\u884cfork\u64cd\u4f5c\u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u8981\u727a\u7272\u6389\u4e00\u4e9b\u6027\u80fd Redis\u7684\u4f17\u591a\u7248\u672c\u4e2d\u672a\u8fdb\u884cRDB\u6587\u4ef6\u683c\u5f0f\u7684\u7248\u672c\u7edf\u4e00\uff0c\u6709\u53ef\u80fd\u51fa\u73b0\u5404\u7248\u672c\u670d\u52a1\u4e4b\u95f4\u6570\u636e\u683c\u5f0f\u65e0\u6cd5\u517c\u5bb9\u73b0\u8c61","title":"5.2.4 RDB\u4e09\u79cd\u542f\u52a8\u65b9\u5f0f\u5bf9\u6bd4"},{"location":"redis/day01/#53_aof","text":"\u4e3a\u4ec0\u4e48\u8981\u6709AOF,\u8fd9\u5f97\u4eceRDB\u7684\u5b58\u50a8\u7684\u5f0a\u7aef\u8bf4\u8d77\uff1a \u5b58\u50a8\u6570\u636e\u91cf\u8f83\u5927\uff0c\u6548\u7387\u8f83\u4f4e\uff0c\u57fa\u4e8e\u5feb\u7167\u601d\u60f3\uff0c\u6bcf\u6b21\u8bfb\u5199\u90fd\u662f\u5168\u90e8\u6570\u636e\uff0c\u5f53\u6570\u636e\u91cf\u5de8\u5927\u65f6\uff0c\u6548\u7387\u975e\u5e38\u4f4e \u5927\u6570\u636e\u91cf\u4e0b\u7684IO\u6027\u80fd\u8f83\u4f4e \u57fa\u4e8efork\u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u5185\u5b58\u4ea7\u751f\u989d\u5916\u6d88\u8017 \u5b95\u673a\u5e26\u6765\u7684\u6570\u636e\u4e22\u5931\u98ce\u9669 \u90a3\u89e3\u51b3\u7684\u601d\u8def\u662f\u4ec0\u4e48\u5462\uff1f \u4e0d\u5199\u5168\u6570\u636e\uff0c\u4ec5\u8bb0\u5f55\u90e8\u5206\u6570\u636e \u964d\u4f4e\u533a\u5206\u6570\u636e\u662f\u5426\u6539\u53d8\u7684\u96be\u5ea6\uff0c\u6539\u8bb0\u5f55\u6570\u636e\u4e3a\u8bb0\u5f55\u64cd\u4f5c\u8fc7\u7a0b \u5bf9\u6240\u6709\u64cd\u4f5c\u5747\u8fdb\u884c\u8bb0\u5f55\uff0c\u6392\u9664\u4e22\u5931\u6570\u636e\u7684\u98ce\u9669","title":"5.3  AOF"},{"location":"redis/day01/#531_aof","text":"AOF (append only file)\u6301\u4e45\u5316\uff1a\u4ee5\u72ec\u7acb\u65e5\u5fd7\u7684\u65b9\u5f0f\u8bb0\u5f55\u6bcf\u6b21\u5199\u547d\u4ee4\uff0c\u91cd\u542f\u65f6\u518d\u91cd\u65b0\u6267\u884cAOF\u6587\u4ef6\u4e2d\u547d\u4ee4 \u8fbe\u5230\u6062\u590d\u6570\u636e\u7684\u76ee\u7684\u3002 \u4e0eRDB\u76f8\u6bd4\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u4e3a\u7531\u8bb0\u5f55\u6570\u636e\u6539\u4e3a\u8bb0\u5f55\u6570\u636e\u4ea7\u751f\u7684\u53d8\u5316 AOF\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u89e3\u51b3\u4e86\u6570\u636e\u6301\u4e45\u5316\u7684\u5b9e\u65f6\u6027\uff0c\u76ee\u524d\u5df2\u7ecf\u662fRedis\u6301\u4e45\u5316\u7684\u4e3b\u6d41\u65b9\u5f0f AOF\u5199\u6570\u636e\u8fc7\u7a0b \u542f\u52a8AOF\u76f8\u5173\u914d\u7f6e \u5f00\u542fAOF\u6301\u4e45\u5316\u529f\u80fd\uff0c\u9ed8\u8ba4no\uff0c\u5373\u4e0d\u5f00\u542f\u72b6\u6001 appendonly yes|no AOF\u6301\u4e45\u5316\u6587\u4ef6\u540d\uff0c\u9ed8\u8ba4\u6587\u4ef6\u540d\u4e3aappendonly.aof\uff0c\u5efa\u8bae\u914d\u7f6e\u4e3aappendonly-\u7aef\u53e3\u53f7.aof appendfilename filename AOF\u6301\u4e45\u5316\u6587\u4ef6\u4fdd\u5b58\u8def\u5f84\uff0c\u4e0eRDB\u6301\u4e45\u5316\u6587\u4ef6\u4fdd\u6301\u4e00\u81f4\u5373\u53ef dir AOF\u5199\u6570\u636e\u7b56\u7565\uff0c\u9ed8\u8ba4\u4e3aeverysec appendfsync always|everysec|no","title":"5.3.1 AOF\u6982\u5ff5"},{"location":"redis/day01/#532_aof","text":"AOF\u5199\u6570\u636e\u4e09\u79cd\u7b56\u7565(appendfsync) always (\u6bcf\u6b21\uff09\uff1a\u6bcf\u6b21\u5199\u5165\u64cd\u4f5c\u5747\u540c\u6b65\u5230AOF\u6587\u4ef6\u4e2d\u6570\u636e\u96f6\u8bef\u5dee\uff0c\u6027\u80fd\u8f83\u4f4e\uff0c\u4e0d\u5efa\u8bae\u4f7f\u7528\u3002 everysec \uff08\u6bcf\u79d2\uff09\uff1a\u6bcf\u79d2\u5c06\u7f13\u51b2\u533a\u4e2d\u7684\u6307\u4ee4\u540c\u6b65\u5230AOF\u6587\u4ef6\u4e2d\uff0c\u5728\u7cfb\u7edf\u7a81\u7136\u5b95\u673a\u7684\u60c5\u51b5\u4e0b\u4e22\u59311\u79d2\u5185\u7684\u6570\u636e \u6570\u636e\u51c6\u786e\u6027\u8f83\u9ad8\uff0c\u6027\u80fd\u8f83\u9ad8\uff0c\u5efa\u8bae\u4f7f\u7528\uff0c\u4e5f\u662f\u9ed8\u8ba4\u914d\u7f6e no \uff08\u7cfb\u7edf\u63a7\u5236\uff09\uff1a\u7531\u64cd\u4f5c\u7cfb\u7edf\u63a7\u5236\u6bcf\u6b21\u540c\u6b65\u5230AOF\u6587\u4ef6\u7684\u5468\u671f\uff0c\u6574\u4f53\u8fc7\u7a0b\u4e0d\u53ef\u63a7","title":"5.3.2 AOF\u6267\u884c\u7b56\u7565"},{"location":"redis/day01/#533_aof","text":"\u573a\u666f\uff1aAOF\u5199\u6570\u636e\u9047\u5230\u7684\u95ee\u9898\uff0c\u5982\u679c\u8fde\u7eed\u6267\u884c\u5982\u4e0b\u6307\u4ee4\u8be5\u5982\u4f55\u5904\u7406 \u4ec0\u4e48\u53ebAOF\u91cd\u5199\uff1f \u968f\u7740\u547d\u4ee4\u4e0d\u65ad\u5199\u5165AOF\uff0c\u6587\u4ef6\u4f1a\u8d8a\u6765\u8d8a\u5927\uff0c\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cRedis\u5f15\u5165\u4e86AOF\u91cd\u5199\u673a\u5236\u538b\u7f29\u6587\u4ef6\u4f53\u79ef\u3002AOF\u6587\u4ef6\u91cd \u5199\u662f\u5c06Redis\u8fdb\u7a0b\u5185\u7684\u6570\u636e\u8f6c\u5316\u4e3a\u5199\u547d\u4ee4\u540c\u6b65\u5230\u65b0AOF\u6587\u4ef6\u7684\u8fc7\u7a0b\u3002\u7b80\u5355\u8bf4\u5c31\u662f\u5c06\u5bf9\u540c\u4e00\u4e2a\u6570\u636e\u7684\u82e5\u5e72\u4e2a\u6761\u547d\u4ee4\u6267\u884c\u7ed3 \u679c\u8f6c\u5316\u6210\u6700\u7ec8\u7ed3\u679c\u6570\u636e\u5bf9\u5e94\u7684\u6307\u4ee4\u8fdb\u884c\u8bb0\u5f55\u3002 AOF\u91cd\u5199\u4f5c\u7528 \u964d\u4f4e\u78c1\u76d8\u5360\u7528\u91cf\uff0c\u63d0\u9ad8\u78c1\u76d8\u5229\u7528\u7387 \u63d0\u9ad8\u6301\u4e45\u5316\u6548\u7387\uff0c\u964d\u4f4e\u6301\u4e45\u5316\u5199\u65f6\u95f4\uff0c\u63d0\u9ad8IO\u6027\u80fd \u964d\u4f4e\u6570\u636e\u6062\u590d\u7528\u65f6\uff0c\u63d0\u9ad8\u6570\u636e\u6062\u590d\u6548\u7387 AOF\u91cd\u5199\u89c4\u5219 \u8fdb\u7a0b\u5185\u5177\u6709\u65f6\u6548\u6027\u7684\u6570\u636e\uff0c\u5e76\u4e14\u6570\u636e\u5df2\u8d85\u65f6\u5c06\u4e0d\u518d\u5199\u5165\u6587\u4ef6 \u975e\u5199\u5165\u7c7b\u7684\u65e0\u6548\u6307\u4ee4\u5c06\u88ab\u5ffd\u7565\uff0c\u53ea\u4fdd\u7559\u6700\u7ec8\u6570\u636e\u7684\u5199\u5165\u547d\u4ee4 \u5982del key1\u3001 hdel key2\u3001srem key3\u3001set key4 111\u3001set key4 222\u7b49 \u5982select\u6307\u4ee4\u867d\u7136\u4e0d\u66f4\u6539\u6570\u636e\uff0c\u4f46\u662f\u66f4\u6539\u4e86\u6570\u636e\u7684\u5b58\u50a8\u4f4d\u7f6e\uff0c\u6b64\u7c7b\u547d\u4ee4\u540c\u6837\u9700\u8981\u8bb0\u5f55 \u5bf9\u540c\u4e00\u6570\u636e\u7684\u591a\u6761\u5199\u547d\u4ee4\u5408\u5e76\u4e3a\u4e00\u6761\u547d\u4ee4 \u5982lpushlist1 a\u3001lpush list1 b\u3001lpush list1 c\u53ef\u4ee5\u8f6c\u5316\u4e3a\uff1alpush list1 a b c\u3002 \u4e3a\u9632\u6b62\u6570\u636e\u91cf\u8fc7\u5927\u9020\u6210\u5ba2\u6237\u7aef\u7f13\u51b2\u533a\u6ea2\u51fa\uff0c\u5bf9list\u3001set\u3001hash\u3001zset\u7b49\u7c7b\u578b\uff0c\u6bcf\u6761\u6307\u4ee4\u6700\u591a\u5199\u516564\u4e2a\u5143\u7d20 AOF\u91cd\u5199\u65b9\u5f0f \u624b\u52a8\u91cd\u5199 bgrewriteaof \u624b\u52a8\u91cd\u5199\u539f\u7406\u5206\u6790\uff1a \u81ea\u52a8\u91cd\u5199 auto-aof-rewrite-min-size size auto-aof-rewrite-percentage percentage \u81ea\u52a8\u91cd\u5199\u89e6\u53d1\u6761\u4ef6\u8bbe\u7f6e auto-aof-rewrite-min-size size auto-aof-rewrite-percentage percent \u81ea\u52a8\u91cd\u5199\u89e6\u53d1\u6bd4\u5bf9\u53c2\u6570\uff08 \u8fd0\u884c\u6307\u4ee4info Persistence\u83b7\u53d6\u5177\u4f53\u4fe1\u606f \uff09 aof_current_size aof_base_size \u81ea\u52a8\u91cd\u5199\u89e6\u53d1\u6761\u4ef6\u516c\u5f0f\uff1a","title":"5.3.3 AOF\u91cd\u5199"},{"location":"redis/day01/#534_aof","text":"","title":"5.3.4 AOF\u5de5\u4f5c\u6d41\u7a0b\u53ca\u91cd\u5199\u6d41\u7a0b"},{"location":"redis/day01/#54_rdbaof","text":"","title":"5.4  RDB\u4e0eAOF\u533a\u522b"},{"location":"redis/day01/#541_rdbaof","text":"\u6301\u4e45\u5316\u65b9\u5f0f RDB AOF \u5360\u7528\u5b58\u50a8\u7a7a\u95f4 \u5c0f\uff08\u6570\u636e\u7ea7\uff1a\u538b\u7f29\uff09 \u5927\uff08\u6307\u4ee4\u7ea7\uff1a\u91cd\u5199\uff09 \u5b58\u50a8\u901f\u5ea6 \u6162 \u5feb \u6062\u590d\u901f\u5ea6 \u5feb \u6162 \u6570\u636e\u5b89\u5168\u6027 \u4f1a\u4e22\u5931\u6570\u636e \u4f9d\u636e\u7b56\u7565\u51b3\u5b9a \u8d44\u6e90\u6d88\u8017 \u9ad8/\u91cd\u91cf\u7ea7 \u4f4e/\u8f7b\u91cf\u7ea7 \u542f\u52a8\u4f18\u5148\u7ea7 \u4f4e \u9ad8","title":"5.4.1 RDB\u4e0eAOF\u5bf9\u6bd4\uff08\u4f18\u7f3a\u70b9\uff09"},{"location":"redis/day01/#542_rdbaof","text":"RDB\u4e0eAOF\u7684\u9009\u62e9\u4e4b\u60d1 \u5bf9\u6570\u636e\u975e\u5e38\u654f\u611f\uff0c\u5efa\u8bae\u4f7f\u7528\u9ed8\u8ba4\u7684AOF\u6301\u4e45\u5316\u65b9\u6848 AOF\u6301\u4e45\u5316\u7b56\u7565\u4f7f\u7528everysecond\uff0c\u6bcf\u79d2\u949ffsync\u4e00\u6b21\u3002\u8be5\u7b56\u7565redis\u4ecd\u53ef\u4ee5\u4fdd\u6301\u5f88\u597d\u7684\u5904\u7406\u6027\u80fd\uff0c\u5f53\u51fa \u73b0\u95ee\u9898\u65f6\uff0c\u6700\u591a\u4e22\u59310-1\u79d2\u5185\u7684\u6570\u636e\u3002 \u6ce8\u610f\uff1a\u7531\u4e8eAOF\u6587\u4ef6\u5b58\u50a8\u4f53\u79ef\u8f83\u5927\uff0c\u4e14\u6062\u590d\u901f\u5ea6\u8f83\u6162 \u6570\u636e\u5448\u73b0\u9636\u6bb5\u6709\u6548\u6027\uff0c\u5efa\u8bae\u4f7f\u7528RDB\u6301\u4e45\u5316\u65b9\u6848 \u6570\u636e\u53ef\u4ee5\u826f\u597d\u7684\u505a\u5230\u9636\u6bb5\u5185\u65e0\u4e22\u5931\uff08\u8be5\u9636\u6bb5\u662f\u5f00\u53d1\u8005\u6216\u8fd0\u7ef4\u4eba\u5458\u624b\u5de5\u7ef4\u62a4\u7684\uff09\uff0c\u4e14\u6062\u590d\u901f\u5ea6\u8f83\u5feb\uff0c\u9636\u6bb5 \u70b9\u6570\u636e\u6062\u590d\u901a\u5e38\u91c7\u7528RDB\u65b9\u6848 \u6ce8\u610f\uff1a\u5229\u7528RDB\u5b9e\u73b0\u7d27\u51d1\u7684\u6570\u636e\u6301\u4e45\u5316\u4f1a\u4f7fRedis\u964d\u7684\u5f88\u4f4e\uff0c\u614e\u91cd\u603b\u7ed3\uff1a \u7efc\u5408\u6bd4\u5bf9 RDB\u4e0eAOF\u7684\u9009\u62e9\u5b9e\u9645\u4e0a\u662f\u5728\u505a\u4e00\u79cd\u6743\u8861\uff0c\u6bcf\u79cd\u90fd\u6709\u5229\u6709\u5f0a \u5982\u4e0d\u80fd\u627f\u53d7\u6570\u5206\u949f\u4ee5\u5185\u7684\u6570\u636e\u4e22\u5931\uff0c\u5bf9\u4e1a\u52a1\u6570\u636e\u975e\u5e38\u654f\u611f\uff0c\u9009\u7528AOF \u5982\u80fd\u627f\u53d7\u6570\u5206\u949f\u4ee5\u5185\u7684\u6570\u636e\u4e22\u5931\uff0c\u4e14\u8ffd\u6c42\u5927\u6570\u636e\u96c6\u7684\u6062\u590d\u901f\u5ea6\uff0c\u9009\u7528RDB \u707e\u96be\u6062\u590d\u9009\u7528RDB \u53cc\u4fdd\u9669\u7b56\u7565\uff0c\u540c\u65f6\u5f00\u542f RDB\u548c AOF\uff0c\u91cd\u542f\u540e\uff0cRedis\u4f18\u5148\u4f7f\u7528 AOF \u6765\u6062\u590d\u6570\u636e\uff0c\u964d\u4f4e\u4e22\u5931\u6570\u636e\u7684\u91cf # \u5ba2\u6237\u7aef\u600e\u4e48\u8bbf\u95ee\u90fd\u884c bind 0 .0.0.0 port 6379 timeout 0 # \u540e\u53f0\u542f\u52a8 daemonize yes logfile \"log_6379.log\" dir /usr/local/redis/data # rdb \u65b9\u5f0f\u6587\u4ef6\u540d\u79f0 dbfilename \"dump6379.rdb\" # \u5b58\u50a8\u7b56\u7565 2s \u4e2d\u5185\u5982\u679c\u6709\u4e24\u4e2a \u4fee\u6539\u547d\u4ee4 \u5219\u6267\u884c\u5b58\u50a8 save 2 2 # aop \u914d\u7f6e appendonly yes appendfilename \"dump6379.aof\" appendfsync always # aof \u81ea\u52a8\u91cd\u5199 # \u6bcf4M \u6570\u636e \u91cd\u5199\u4e00\u6b21 auto-aof-rewrite-min-size 4mb # \u548c\u4e0a\u6b21\u5907\u4efd\u505a\u5bf9\u6bd4,\u5982\u679c \u8d85\u8fc7\u4e8610% \u5219\u91cd\u5199\u6587\u4ef6 auto-aof-rewrite-percentage 10 %","title":"5.4.2 RDB\u4e0eAOF\u5e94\u7528\u573a\u666f"},{"location":"redis/day02/","text":"\u5b66\u4e60\u76ee\u6807 \u00b6 \u76ee\u68071\uff1a\u80fd\u591f\u8bf4\u51faredis\u4e2d\u7684\u6570\u636e\u5220\u9664\u7b56\u4e0e\u7565\u6dd8\u6c70\u7b56\u7565 \u76ee\u68072\uff1a\u80fd\u591f\u8bf4\u51fa\u4e3b\u4ece\u590d\u5236\u7684\u6982\u5ff5\uff0c\u5de5\u4f5c\u6d41\u7a0b\u4ee5\u53ca\u573a\u666f\u95ee\u9898\u53ca\u89e3\u51b3\u65b9\u6848 \u76ee\u68073\uff1a\u80fd\u591f\u8bf4\u51fa\u54e8\u5175\u7684\u4f5c\u7528\u4ee5\u53ca\u5de5\u4f5c\u539f\u7406\uff0c\u4ee5\u53ca\u5982\u4f55\u542f\u7528\u54e8\u5175 \u76ee\u68074\uff1a\u80fd\u591f\u8bf4\u51fa\u96c6\u7fa4\u7684\u67b6\u6784\u8bbe\u8ba1\uff0c\u5b8c\u6210\u96c6\u7fa4\u7684\u642d\u5efa \u76ee\u68075\uff1a\u80fd\u591f\u8bf4\u51fa\u7f13\u5b58\u9884\u70ed\uff0c\u96ea\u5d29\uff0c\u51fb\u7a7f\uff0c\u7a7f\u900f\u7684\u6982\u5ff5\uff0c\u80fd\u8bf4\u51faredis\u7684\u76f8\u5173\u76d1\u63a7\u6307\u6807 1.\u6570\u636e\u5220\u9664\u4e0e\u6dd8\u6c70\u7b56\u7565 \u00b6 1.1 \u8fc7\u671f\u6570\u636e \u00b6 1.1.1 Redis\u4e2d\u7684\u6570\u636e\u7279\u5f81 \u00b6 Redis\u662f\u4e00\u79cd\u5185\u5b58\u7ea7\u6570\u636e\u5e93\uff0c\u6240\u6709\u6570\u636e\u5747\u5b58\u653e\u5728\u5185\u5b58\u4e2d\uff0c\u5185\u5b58\u4e2d\u7684\u6570\u636e\u53ef\u4ee5\u901a\u8fc7TTL\u6307\u4ee4\u83b7\u53d6\u5176\u72b6\u6001 TTL\u8fd4\u56de\u7684\u503c\u6709\u4e09\u79cd\u60c5\u51b5\uff1a\u6b63\u6570\uff0c-1\uff0c-2 \u6b63\u6570 \uff1a\u4ee3\u8868\u8be5\u6570\u636e\u5728\u5185\u5b58\u4e2d\u8fd8\u80fd\u5b58\u6d3b\u7684\u65f6\u95f4 -1 \uff1a\u6c38\u4e45\u6709\u6548\u7684\u6570\u636e 2 \uff1a\u5df2\u7ecf\u8fc7\u671f\u7684\u6570\u636e \u6216\u88ab\u5220\u9664\u7684\u6570\u636e \u6216 \u672a\u5b9a\u4e49\u7684\u6570\u636e \u5220\u9664\u7b56\u7565\u5c31\u662f\u9488\u5bf9\u5df2\u8fc7\u671f\u6570\u636e\u7684\u5904\u7406\u7b56\u7565 \uff0c\u5df2\u8fc7\u671f\u7684\u6570\u636e\u662f\u771f\u7684\u5c31\u7acb\u5373\u5220\u9664\u4e86\u5417\uff1f\u5176\u5b9e\u4e5f\u4e0d\u662f\uff0c\u6211\u4eec\u4f1a\u6709\u591a\u79cd\u5220\u9664\u7b56\u7565\uff0c\u662f\u5206\u60c5\u51b5\u7684\uff0c\u5728\u4e0d\u540c\u7684\u573a\u666f\u4e0b\u4f7f\u7528\u4e0d\u540c\u7684\u5220\u9664\u65b9\u5f0f\u4f1a\u6709\u4e0d\u540c\u6548\u679c\uff0c\u8fd9\u4e5f\u6b63\u662f\u6211\u4eec\u8981\u5c06\u7684\u6570\u636e\u7684\u5220\u9664\u7b56\u7565\u7684\u95ee\u9898 1.1.2 \u65f6\u6548\u6027\u6570\u636e\u7684\u5b58\u50a8\u7ed3\u6784 \u00b6 \u5728Redis\u4e2d\uff0c\u5982\u4f55\u7ed9\u6570\u636e\u8bbe\u7f6e\u5b83\u7684\u5931\u6548\u5468\u671f\u5462\uff1f\u6570\u636e\u7684\u65f6\u6548\u5728redis\u4e2d\u5982\u4f55\u5b58\u50a8\u5462\uff1f \u8fc7\u671f\u6570\u636e\u662f\u4e00\u5757\u72ec\u7acb\u7684\u5b58\u50a8\u7a7a\u95f4\uff0cHash\u7ed3\u6784\uff0cfield\u662f\u5185\u5b58\u5730\u5740\uff0cvalue\u662f\u8fc7\u671f\u65f6\u95f4\uff0c\u4fdd\u5b58\u4e86\u6240\u6709key\u7684\u8fc7\u671f\u63cf\u8ff0\uff0c\u5728\u6700\u7ec8\u8fdb\u884c\u8fc7\u671f\u5904\u7406\u7684\u65f6\u5019\uff0c\u5bf9\u8be5\u7a7a\u95f4\u7684\u6570\u636e\u8fdb\u884c\u68c0\u6d4b\uff0c \u5f53\u65f6\u95f4\u5230\u671f\u4e4b\u540e\u901a\u8fc7field\u627e\u5230\u5185\u5b58\u8be5\u5730\u5740\u5904\u7684\u6570\u636e\uff0c\u7136\u540e\u8fdb\u884c\u76f8\u5173\u64cd\u4f5c\u3002 1.2 \u6570\u636e\u5220\u9664\u7b56\u7565 \u00b6 1.2.1 \u6570\u636e\u5220\u9664\u7b56\u7565\u7684\u76ee\u6807 \u00b6 \u5728\u5185\u5b58\u5360\u7528\u4e0eCPU\u5360\u7528\u4e4b\u95f4\u5bfb\u627e\u4e00\u79cd\u5e73\u8861\uff0c\u987e\u6b64\u5931\u5f7c\u90fd\u4f1a\u9020\u6210\u6574\u4f53redis\u6027\u80fd\u7684\u4e0b\u964d\uff0c\u751a\u81f3\u5f15\u53d1\u670d\u52a1\u5668\u5b95\u673a\u6216 \u5185\u5b58\u6cc4\u9732 \u9488\u5bf9\u8fc7\u671f\u6570\u636e\u8981\u8fdb\u884c\u5220\u9664\u7684\u65f6\u5019\u90fd\u6709\u54ea\u4e9b\u5220\u9664\u7b56\u7565\u5462\uff1f 1.\u5b9a\u65f6\u5220\u9664 2.\u60f0\u6027\u5220\u9664 3.\u5b9a\u671f\u5220\u9664 1.2.2 \u5b9a\u65f6\u5220\u9664 \u00b6 \u521b\u5efa\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u5f53key\u8bbe\u7f6e\u6709\u8fc7\u671f\u65f6\u95f4\uff0c\u4e14\u8fc7\u671f\u65f6\u95f4\u5230\u8fbe\u65f6\uff0c\u7531\u5b9a\u65f6\u5668\u4efb\u52a1\u7acb\u5373\u6267\u884c\u5bf9\u952e\u7684\u5220\u9664\u64cd\u4f5c \u4f18\u70b9 \uff1a\u8282\u7ea6\u5185\u5b58\uff0c\u5230\u65f6\u5c31\u5220\u9664\uff0c\u5feb\u901f\u91ca\u653e\u6389\u4e0d\u5fc5\u8981\u7684\u5185\u5b58\u5360\u7528 \u7f3a\u70b9 \uff1aCPU\u538b\u529b\u5f88\u5927\uff0c\u65e0\u8bbaCPU\u6b64\u65f6\u8d1f\u8f7d\u91cf\u591a\u9ad8\uff0c\u5747\u5360\u7528CPU\uff0c\u4f1a\u5f71\u54cdredis\u670d\u52a1\u5668\u54cd\u5e94\u65f6\u95f4\u548c\u6307\u4ee4\u541e\u5410\u91cf \u603b\u7ed3 \uff1a\u7528\u5904\u7406\u5668\u6027\u80fd\u6362\u53d6\u5b58\u50a8\u7a7a\u95f4\uff08\u62ff\u65f6\u95f4\u6362\u7a7a\u95f4\uff09 1.2.3 \u60f0\u6027\u5220\u9664 \u00b6 \u6570\u636e\u5230\u8fbe\u8fc7\u671f\u65f6\u95f4\uff0c\u4e0d\u505a\u5904\u7406\u3002\u7b49\u4e0b\u6b21\u8bbf\u95ee\u8be5\u6570\u636e\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5224\u65ad \u5982\u679c\u672a\u8fc7\u671f\uff0c\u8fd4\u56de\u6570\u636e \u53d1\u73b0\u5df2\u8fc7\u671f\uff0c\u5220\u9664\uff0c\u8fd4\u56de\u4e0d\u5b58\u5728 \u4f18\u70b9 \uff1a\u8282\u7ea6CPU\u6027\u80fd\uff0c\u53d1\u73b0\u5fc5\u987b\u5220\u9664\u7684\u65f6\u5019\u624d\u5220\u9664 \u7f3a\u70b9 \uff1a\u5185\u5b58\u538b\u529b\u5f88\u5927\uff0c\u51fa\u73b0\u957f\u671f\u5360\u7528\u5185\u5b58\u7684\u6570\u636e \u603b\u7ed3 \uff1a\u7528\u5b58\u50a8\u7a7a\u95f4\u6362\u53d6\u5904\u7406\u5668\u6027\u80fd\uff08\u62ff\u65f6\u95f4\u6362\u7a7a\u95f4\uff09 1.2.4 \u5b9a\u671f\u5220\u9664 \u00b6 \u5b9a\u65f6\u5220\u9664\u548c\u60f0\u6027\u5220\u9664\u8fd9\u4e24\u79cd\u65b9\u6848\u90fd\u662f\u8d70\u7684\u6781\u7aef\uff0c\u90a3\u6709\u6ca1\u6709\u6298\u4e2d\u65b9\u6848\uff1f \u6211\u4eec\u6765\u8bb2redis\u7684\u5b9a\u671f\u5220\u9664\u65b9\u6848\uff1a Redis\u542f\u52a8\u670d\u52a1\u5668\u521d\u59cb\u5316\u65f6\uff0c\u8bfb\u53d6\u914d\u7f6eserver.hz\u7684\u503c\uff0c\u9ed8\u8ba4\u4e3a10 \u6bcf\u79d2\u949f\u6267\u884cserver.hz\u6b21 serverCron() --------> databasesCron() ---------> activeExpireCycle() activeExpireCycle() \u5bf9\u6bcf\u4e2aexpires[*]\u9010\u4e00\u8fdb\u884c\u68c0\u6d4b\uff0c\u6bcf\u6b21\u6267\u884c\u8017\u65f6\uff1a250ms/server.hz \u5bf9\u67d0\u4e2aexpires[*]\u68c0\u6d4b\u65f6\uff0c\u968f\u673a\u6311\u9009W\u4e2akey\u68c0\u6d4b \u5982\u679ckey\u8d85\u65f6\uff0c\u5220\u9664key \u5982\u679c\u4e00\u8f6e\u4e2d\u5220\u9664\u7684key\u7684\u6570\u91cf>W*25%\uff0c\u5faa\u73af\u8be5\u8fc7\u7a0b \u5982\u679c\u4e00\u8f6e\u4e2d\u5220\u9664\u7684key\u7684\u6570\u91cf\u2264W*25%\uff0c\u68c0\u67e5\u4e0b\u4e00\u4e2aexpires[*]\uff0c0-15\u5faa\u73af W\u53d6\u503c=ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP\u5c5e\u6027\u503c \u53c2\u6570current_db\u7528\u4e8e\u8bb0\u5f55 activeExpireCycle() \u8fdb\u5165\u54ea\u4e2aexpires[*] \u6267\u884c \u5982\u679cactiveExpireCycle()\u6267\u884c\u65f6\u95f4\u5230\u671f\uff0c\u4e0b\u6b21\u4ececurrent_db\u7ee7\u7eed\u5411\u4e0b\u6267\u884c \u603b\u7684\u6765\u8bf4\uff1a\u5b9a\u671f\u5220\u9664\u5c31\u662f\u5468\u671f\u6027\u8f6e\u8be2redis\u5e93\u4e2d\u7684\u65f6\u6548\u6027\u6570\u636e\uff0c\u91c7\u7528\u968f\u673a\u62bd\u53d6\u7684\u7b56\u7565\uff0c\u5229\u7528\u8fc7\u671f\u6570\u636e\u5360\u6bd4\u7684\u65b9\u5f0f\u63a7\u5236\u5220\u9664\u9891\u5ea6 \u7279\u70b91 \uff1aCPU\u6027\u80fd\u5360\u7528\u8bbe\u7f6e\u6709\u5cf0\u503c\uff0c\u68c0\u6d4b\u9891\u5ea6\u53ef\u81ea\u5b9a\u4e49\u8bbe\u7f6e \u7279\u70b92 \uff1a\u5185\u5b58\u538b\u529b\u4e0d\u662f\u5f88\u5927\uff0c\u957f\u671f\u5360\u7528\u5185\u5b58\u7684\u51b7\u6570\u636e\u4f1a\u88ab\u6301\u7eed\u6e05\u7406 \u603b\u7ed3 \uff1a\u5468\u671f\u6027\u62bd\u67e5\u5b58\u50a8\u7a7a\u95f4\uff08\u968f\u673a\u62bd\u67e5\uff0c\u91cd\u70b9\u62bd\u67e5\uff09 1.2.5 \u5220\u9664\u7b56\u7565\u5bf9\u6bd4 \u00b6 1\uff1a\u5b9a\u65f6\u5220\u9664\uff1a \u8282\u7ea6\u5185\u5b58\uff0c\u65e0\u5360\u7528, \u4e0d\u5206\u65f6\u6bb5\u5360\u7528CPU\u8d44\u6e90\uff0c\u9891\u5ea6\u9ad8, \u62ff\u65f6\u95f4\u6362\u7a7a\u95f4 2\uff1a\u60f0\u6027\u5220\u9664\uff1a \u5185\u5b58\u5360\u7528\u4e25\u91cd \u5ef6\u65f6\u6267\u884c\uff0cCPU\u5229\u7528\u7387\u9ad8 \u62ff\u7a7a\u95f4\u6362\u65f6\u95f4 3\uff1a\u5b9a\u671f\u5220\u9664\uff1a \u5185\u5b58\u5b9a\u671f\u968f\u673a\u6e05\u7406 \u6bcf\u79d2\u82b1\u8d39\u56fa\u5b9a\u7684CPU\u8d44\u6e90\u7ef4\u62a4\u5185\u5b58 \u968f\u673a\u62bd\u67e5\uff0c\u91cd\u70b9\u62bd\u67e5 1.3 \u6570\u636e\u6dd8\u6c70\u7b56\u7565\uff08\u9010\u51fa\u7b97\u6cd5\uff09 \u00b6 1.3.1 \u6dd8\u6c70\u7b56\u7565\u6982\u8ff0 \u00b6 \u4ec0\u4e48\u53eb\u6570\u636e\u6dd8\u6c70\u7b56\u7565\uff1f\u4ec0\u4e48\u6837\u7684\u5e94\u7528\u573a\u666f\u9700\u8981\u7528\u5230\u6570\u636e\u6dd8\u6c70\u7b56\u7565\uff1f \u5f53\u65b0\u6570\u636e\u8fdb\u5165redis\u65f6\uff0c\u5982\u679c\u5185\u5b58\u4e0d\u8db3\u600e\u4e48\u529e\uff1f\u5728\u6267\u884c\u6bcf\u4e00\u4e2a\u547d\u4ee4\u524d\uff0c\u4f1a\u8c03\u7528 freeMemoryIfNeeded() \u68c0\u6d4b\u5185\u5b58\u662f\u5426\u5145\u8db3\u3002\u5982\u679c\u5185\u5b58\u4e0d\u6ee1\u8db3\u65b0 \u52a0\u5165\u6570\u636e\u7684\u6700\u4f4e\u5b58\u50a8\u8981\u6c42\uff0credis\u8981\u4e34\u65f6\u5220\u9664\u4e00\u4e9b\u6570\u636e\u4e3a\u5f53\u524d\u6307\u4ee4\u6e05\u7406\u5b58\u50a8\u7a7a\u95f4\u3002\u6e05\u7406\u6570\u636e\u7684\u7b56\u7565\u79f0\u4e3a\u9010\u51fa\u7b97\u6cd5\u3002 \u6ce8\u610f\uff1a\u9010\u51fa\u6570\u636e\u7684\u8fc7\u7a0b\u4e0d\u662f100%\u80fd\u591f\u6e05\u7406\u51fa\u8db3\u591f\u7684\u53ef\u4f7f\u7528\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5982\u679c\u4e0d\u6210\u529f\u5219\u53cd\u590d\u6267\u884c\u3002\u5f53\u5bf9\u6240\u6709\u6570\u636e\u5c1d\u8bd5\u5b8c\u6bd5\uff0c \u5982\u4e0d\u80fd\u8fbe\u5230\u5185\u5b58\u6e05\u7406\u7684\u8981\u6c42\uff0c\u5c06\u51fa\u73b0\u9519\u8bef\u4fe1\u606f\u5982\u4e0b ( error ) OOM command not allowed when used memory > 'maxmemory' 1.3.2 \u7b56\u7565\u914d\u7f6e \u00b6 \u5f71\u54cd\u6570\u636e\u6dd8\u6c70\u7684\u76f8\u5173\u914d\u7f6e\u5982\u4e0b\uff1a 1\uff1a\u6700\u5927\u53ef\u4f7f\u7528\u5185\u5b58\uff0c\u5373\u5360\u7528\u7269\u7406\u5185\u5b58\u7684\u6bd4\u4f8b\uff0c\u9ed8\u8ba4\u503c\u4e3a0\uff0c\u8868\u793a\u4e0d\u9650\u5236\u3002\u751f\u4ea7\u73af\u5883\u4e2d\u6839\u636e\u9700\u6c42\u8bbe\u5b9a\uff0c\u901a\u5e38\u8bbe\u7f6e\u572850%\u4ee5\u4e0a maxmemory ?mb 2\uff1a\u6bcf\u6b21\u9009\u53d6\u5f85\u5220\u9664\u6570\u636e\u7684\u4e2a\u6570\uff0c\u91c7\u7528\u968f\u673a\u83b7\u53d6\u6570\u636e\u7684\u65b9\u5f0f\u4f5c\u4e3a\u5f85\u68c0\u6d4b\u5220\u9664\u6570\u636e maxmemory-samples count 3\uff1a\u5bf9\u6570\u636e\u8fdb\u884c\u5220\u9664\u7684\u9009\u62e9\u7b56\u7565 maxmemory-policy policy \u90a3\u6570\u636e\u5220\u9664\u7684\u7b56\u7565policy\u5230\u5e95\u6709\u51e0\u79cd\u5462\uff1f\u4e00\u5171\u662f 3\u7c7b8\u79cd \u7b2c\u4e00\u7c7b \uff1a\u68c0\u6d4b\u6613\u5931\u6570\u636e\uff08\u53ef\u80fd\u4f1a\u8fc7\u671f\u7684\u6570\u636e\u96c6server.db[i].expires \uff09 volatile-lru\uff1a\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70 volatile-lfu\uff1a\u6311\u9009\u6700\u8fd1\u4f7f\u7528\u6b21\u6570\u6700\u5c11\u7684\u6570\u636e\u6dd8\u6c70 volatile-ttl\uff1a\u6311\u9009\u5c06\u8981\u8fc7\u671f\u7684\u6570\u636e\u6dd8\u6c70 volatile-random\uff1a\u4efb\u610f\u9009\u62e9\u6570\u636e\u6dd8\u6c70 \u7b2c\u4e8c\u7c7b \uff1a\u68c0\u6d4b\u5168\u5e93\u6570\u636e\uff08\u6240\u6709\u6570\u636e\u96c6server.db[i].dict \uff09 allkeys-lru\uff1a\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70 allkeLyRs-lfu\uff1a\uff1a\u6311\u9009\u6700\u8fd1\u4f7f\u7528\u6b21\u6570\u6700\u5c11\u7684\u6570\u636e\u6dd8\u6c70 allkeys-random\uff1a\u4efb\u610f\u9009\u62e9\u6570\u636e\u6dd8\u6c70\uff0c\u76f8\u5f53\u4e8e\u968f\u673a \u7b2c\u4e09\u7c7b \uff1a\u653e\u5f03\u6570\u636e\u9a71\u9010 no-enviction\uff08\u9a71\u9010\uff09\uff1a\u7981\u6b62\u9a71\u9010\u6570\u636e(redis4.0\u4e2d\u9ed8\u8ba4\u7b56\u7565)\uff0c\u4f1a\u5f15\u53d1OOM(Out Of Memory) \u6ce8\u610f\uff1a\u8fd9\u4e9b\u7b56\u7565\u662f\u914d\u7f6e\u5230\u54ea\u4e2a\u5c5e\u6027\u4e0a\uff1f\u600e\u4e48\u914d\u7f6e\uff1f\u5982\u4e0b\u6240\u793a maxmemory-policy volatile-lru \u6570\u636e\u6dd8\u6c70\u7b56\u7565\u914d\u7f6e\u4f9d\u636e \u4f7f\u7528INFO\u547d\u4ee4\u8f93\u51fa\u76d1\u63a7\u4fe1\u606f\uff0c\u67e5\u8be2\u7f13\u5b58 hit \u548c miss \u7684\u6b21\u6570\uff0c\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u8c03\u4f18Redis\u914d\u7f6e 2.\u4e3b\u4ece\u590d\u5236 \u00b6 2.1 \u4e3b\u4ece\u590d\u5236\u7b80\u4ecb \u00b6 2.1.1 \u9ad8\u53ef\u7528 \u00b6 \u9996\u5148\u6211\u4eec\u8981\u7406\u89e3\u4e92\u8054\u7f51\u5e94\u7528\u56e0\u4e3a\u5176\u72ec\u6709\u7684\u7279\u6027\u6211\u4eec\u6f14\u5316\u51fa\u7684 \u4e09\u9ad8 \u67b6\u6784 \u9ad8\u5e76\u53d1 \u5e94\u7528\u8981\u63d0\u4f9b\u67d0\u4e00\u4e1a\u52a1\u8981\u80fd\u652f\u6301\u5f88\u591a\u5ba2\u6237\u7aef\u540c\u65f6\u8bbf\u95ee\u7684\u80fd\u529b\uff0c\u6211\u4eec\u79f0\u4e3a\u5e76\u53d1\uff0c\u9ad8\u5e76\u53d1\u610f\u601d\u5c31\u5f88\u660e\u786e\u4e86 \u9ad8\u6027\u80fd \u6027\u80fd\u5e26\u7ed9\u6211\u4eec\u6700\u76f4\u89c2\u7684\u611f\u53d7\u5c31\u662f\uff1a\u901f\u5ea6\u5feb\uff0c\u65f6\u95f4\u77ed \u9ad8\u53ef\u7528 \u53ef\u7528\u6027 \uff1a\u4e00\u5e74\u4e2d\u5e94\u7528\u670d\u52a1\u6b63\u5e38\u8fd0\u884c\u7684\u65f6\u95f4\u5360\u5168\u5e74\u65f6\u95f4\u7684\u767e\u5206\u6bd4\uff0c\u5982\u4e0b\u56fe\uff1a\u8868\u793a\u4e86\u5e94\u7528\u670d\u52a1\u5728\u5168\u5e74\u5b95\u673a\u7684\u65f6\u95f4 \u6211\u4eec\u628a\u8fd9\u4e9b\u65f6\u95f4\u52a0\u5728\u4e00\u8d77\u5c31\u662f\u5168\u5e74\u5e94\u7528\u670d\u52a1\u4e0d\u53ef\u7528\u7684\u65f6\u95f4\uff0c\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u5e94\u7528\u670d\u52a1\u5168\u5e74\u53ef\u7528\u7684\u65f6\u95f4 4\u5c0f\u65f627\u520615\u79d2+11\u520636\u79d2+2\u520616\u79d2=4\u5c0f\u65f641\u52067\u79d2=16867\u79d2 1\u5e74=365 24 60*60=31536000\u79d2 \u53ef\u7528\u6027=\uff0831536000-16867\uff09/31536000*100%=99.9465151% \u4e1a\u754c\u53ef\u7528\u6027\u76ee\u6807 5\u4e2a9\uff0c\u537399.999% \uff0c\u5373\u670d\u52a1\u5668\u5e74\u5b95\u673a\u65f6\u957f\u4f4e\u4e8e315\u79d2\uff0c\u7ea65.25\u5206\u949f 2.1.2 \u4e3b\u4ece\u590d\u5236\u6982\u5ff5 \u00b6 \u77e5\u9053\u4e86\u4e09\u9ad8\u7684\u6982\u5ff5\u4e4b\u540e\uff0c\u6211\u4eec\u60f3\uff1a\u4f60\u7684\u201cRedis\u201d\u662f\u5426\u9ad8\u53ef\u7528\uff1f\u90a3\u6211\u4eec\u8981\u6765\u5206\u6790\u5355\u673aredis\u7684\u98ce\u9669\u4e0e\u95ee\u9898 \u95ee\u98981.\u673a\u5668\u6545\u969c \u73b0\u8c61\uff1a\u786c\u76d8\u6545\u969c\u3001\u7cfb\u7edf\u5d29\u6e83 \u672c\u8d28\uff1a\u6570\u636e\u4e22\u5931\uff0c\u5f88\u53ef\u80fd\u5bf9\u4e1a\u52a1\u9020\u6210\u707e\u96be\u6027\u6253\u51fb \u7ed3\u8bba\uff1a\u57fa\u672c\u4e0a\u4f1a\u653e\u5f03\u4f7f\u7528redis. \u95ee\u98982.\u5bb9\u91cf\u74f6\u9888 \u73b0\u8c61\uff1a\u5185\u5b58\u4e0d\u8db3\uff0c\u4ece16G\u5347\u7ea7\u523064G\uff0c\u4ece64G\u5347\u7ea7\u5230128G\uff0c\u65e0\u9650\u5347\u7ea7\u5185\u5b58 \u672c\u8d28\uff1a\u7a77\uff0c\u786c\u4ef6\u6761\u4ef6\u8ddf\u4e0d\u4e0a \u7ed3\u8bba\uff1a\u653e\u5f03\u4f7f\u7528redis \u7ed3\u8bba\uff1a \u4e3a\u4e86\u907f\u514d\u5355\u70b9Redis\u670d\u52a1\u5668\u6545\u969c\uff0c\u51c6\u5907\u591a\u53f0\u670d\u52a1\u5668\uff0c\u4e92\u76f8\u8fde\u901a\u3002\u5c06\u6570\u636e\u590d\u5236\u591a\u4e2a\u526f\u672c\u4fdd\u5b58\u5728\u4e0d\u540c\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u8fde\u63a5\u5728\u4e00\u8d77\uff0c\u5e76\u4fdd\u8bc1\u6570\u636e\u662f\u540c\u6b65\u7684\u3002\u5373\u4f7f\u6709\u5176\u4e2d\u4e00\u53f0\u670d\u52a1\u5668\u5b95\u673a\uff0c\u5176\u4ed6\u670d\u52a1\u5668\u4f9d\u7136\u53ef\u4ee5\u7ee7\u7eed\u63d0\u4f9b\u670d\u52a1\uff0c\u5b9e\u73b0Redis\u7684\u9ad8\u53ef\u7528\uff0c\u540c\u65f6\u5b9e\u73b0\u6570\u636e\u5197\u4f59\u5907\u4efd\u3002 \u591a\u53f0\u670d\u52a1\u5668\u8fde\u63a5\u65b9\u6848\uff1a \u63d0\u4f9b\u6570\u636e\u65b9\uff1a master \u4e3b\u670d\u52a1\u5668\uff0c\u4e3b\u8282\u70b9\uff0c\u4e3b\u5e93\u4e3b\u5ba2\u6237\u7aef \u63a5\u6536\u6570\u636e\u65b9\uff1a slave \u4ece\u670d\u52a1\u5668\uff0c\u4ece\u8282\u70b9\uff0c\u4ece\u5e93 \u4ece\u5ba2\u6237\u7aef \u9700\u8981\u89e3\u51b3\u7684\u95ee\u9898\uff1a \u6570\u636e\u540c\u6b65\uff08master\u7684\u6570\u636e\u590d\u5236\u5230slave\u4e2d\uff09 \u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u6765\u89e3\u91ca\u4e3b\u4ece\u590d\u5236\u7684\u6982\u5ff5\uff1a \u6982\u5ff5\uff1a\u4e3b\u4ece\u590d\u5236\u5373\u5c06master\u4e2d\u7684\u6570\u636e\u5373\u65f6\u3001\u6709\u6548\u7684\u590d\u5236\u5230slave\u4e2d \u7279\u5f81 \uff1a\u4e00\u4e2amaster\u53ef\u4ee5\u62e5\u6709\u591a\u4e2aslave\uff0c\u4e00\u4e2aslave\u53ea\u5bf9\u5e94\u4e00\u4e2amaster \u804c\u8d23 \uff1amaster\u548cslave\u5404\u81ea\u7684\u804c\u8d23\u4e0d\u4e00\u6837 master: \u5199\u6570\u636e \u6267\u884c\u5199\u64cd\u4f5c\u65f6\uff0c\u5c06\u51fa\u73b0\u53d8\u5316\u7684\u6570\u636e\u81ea\u52a8\u540c\u6b65\u5230slave \u8bfb\u6570\u636e\uff08\u53ef\u5ffd\u7565\uff09 slave: \u8bfb\u6570\u636e \u5199\u6570\u636e\uff08\u7981\u6b62\uff09 2.1.3 \u4e3b\u4ece\u590d\u5236\u7684\u4f5c\u7528 \u00b6 \u8bfb\u5199\u5206\u79bb\uff1amaster\u5199\u3001slave\u8bfb\uff0c\u63d0\u9ad8\u670d\u52a1\u5668\u7684\u8bfb\u5199\u8d1f\u8f7d\u80fd\u529b \u8d1f\u8f7d\u5747\u8861\uff1a\u57fa\u4e8e\u4e3b\u4ece\u7ed3\u6784\uff0c\u914d\u5408\u8bfb\u5199\u5206\u79bb\uff0c\u7531slave\u5206\u62c5master\u8d1f\u8f7d\uff0c\u5e76\u6839\u636e\u9700\u6c42\u7684\u53d8\u5316\uff0c\u6539\u53d8slave\u7684\u6570 \u91cf\uff0c\u901a\u8fc7\u591a\u4e2a\u4ece\u8282\u70b9\u5206\u62c5\u6570\u636e\u8bfb\u53d6\u8d1f\u8f7d\uff0c\u5927\u5927\u63d0\u9ad8Redis\u670d\u52a1\u5668\u5e76\u53d1\u91cf\u4e0e\u6570\u636e\u541e\u5410\u91cf \u6545\u969c\u6062\u590d\uff1a\u5f53master\u51fa\u73b0\u95ee\u9898\u65f6\uff0c\u7531slave\u63d0\u4f9b\u670d\u52a1\uff0c\u5b9e\u73b0\u5feb\u901f\u7684\u6545\u969c\u6062\u590d \u6570\u636e\u5197\u4f59\uff1a\u5b9e\u73b0\u6570\u636e\u70ed\u5907\u4efd\uff0c\u662f\u6301\u4e45\u5316\u4e4b\u5916\u7684\u4e00\u79cd\u6570\u636e\u5197\u4f59\u65b9\u5f0f \u9ad8\u53ef\u7528\u57fa\u77f3\uff1a\u57fa\u4e8e\u4e3b\u4ece\u590d\u5236\uff0c\u6784\u5efa\u54e8\u5175\u6a21\u5f0f\u4e0e\u96c6\u7fa4\uff0c\u5b9e\u73b0Redis\u7684\u9ad8\u53ef\u7528\u65b9\u6848 2.2 \u4e3b\u4ece\u590d\u5236\u5de5\u4f5c\u6d41\u7a0b \u00b6 \u4e3b\u4ece\u590d\u5236\u8fc7\u7a0b\u5927\u4f53\u53ef\u4ee5\u5206\u4e3a3\u4e2a\u9636\u6bb5 \u5efa\u7acb\u8fde\u63a5\u9636\u6bb5\uff08\u5373\u51c6\u5907\u9636\u6bb5\uff09 \u6570\u636e\u540c\u6b65\u9636\u6bb5 \u547d\u4ee4\u4f20\u64ad\u9636\u6bb5\uff08\u53cd\u590d\u540c\u6b65\uff09 \u800c\u547d\u4ee4\u7684\u4f20\u64ad\u5176\u5b9e\u67094\u79cd\uff0c\u5206\u522b\u5982\u4e0b\uff1a 2.2.1 \u4e3b\u4ece\u590d\u5236\u7684\u5de5\u4f5c\u6d41\u7a0b\uff08\u4e09\u4e2a\u9636\u6bb5\uff09 \u00b6 2.2.1.1 \u9636\u6bb5\u4e00\uff1a\u5efa\u7acb\u8fde\u63a5 \u00b6 \u5efa\u7acbslave\u5230master\u7684\u8fde\u63a5\uff0c\u4f7fmaster\u80fd\u591f\u8bc6\u522bslave\uff0c\u5e76\u4fdd\u5b58slave\u7aef\u53e3\u53f7 \u6d41\u7a0b\u5982\u4e0b\uff1a \u6b65\u9aa41\uff1a\u8bbe\u7f6emaster\u7684\u5730\u5740\u548c\u7aef\u53e3\uff0c\u4fdd\u5b58master\u4fe1\u606f \u6b65\u9aa42\uff1a\u5efa\u7acbsocket\u8fde\u63a5 \u6b65\u9aa43\uff1a\u53d1\u9001ping\u547d\u4ee4\uff08\u5b9a\u65f6\u5668\u4efb\u52a1\uff09 \u6b65\u9aa44\uff1a\u8eab\u4efd\u9a8c\u8bc1 \u6b65\u9aa45\uff1a\u53d1\u9001slave\u7aef\u53e3\u4fe1\u606f \u81f3\u6b64\uff0c\u4e3b\u4ece\u8fde\u63a5\u6210\u529f\uff01 \u5f53\u524d\u72b6\u6001\uff1a slave\uff1a\u4fdd\u5b58master\u7684\u5730\u5740\u4e0e\u7aef\u53e3 master\uff1a\u4fdd\u5b58slave\u7684\u7aef\u53e3 \u603b\u4f53\uff1a\u4e4b\u95f4\u521b\u5efa\u4e86\u8fde\u63a5\u7684socket master\u548cslave\u4e92\u8054 \u63a5\u4e0b\u6765\u5c31\u8981\u901a\u8fc7\u67d0\u79cd\u65b9\u5f0f\u5c06master\u548cslave\u8fde\u63a5\u5230\u4e00\u8d77 \u65b9\u5f0f\u4e00\uff1a\u5ba2\u6237\u7aef\u53d1\u9001\u547d\u4ee4 slaveof masterip masterport \u65b9\u5f0f\u4e8c\uff1a\u542f\u52a8\u670d\u52a1\u5668\u53c2\u6570 redis-server --slaveof masterip masterport \u65b9\u5f0f\u4e09\uff1a\u670d\u52a1\u5668\u914d\u7f6e\uff08 \u4e3b\u6d41\u65b9\u5f0f \uff09 slaveof masterip masterport slave\u7cfb\u7edf\u4fe1\u606f master_link_down_since_seconds masterhost & masterport master\u7cfb\u7edf\u4fe1\u606f uslave_listening_port(\u591a\u4e2a) \u4e3b\u4ece\u65ad\u5f00\u8fde\u63a5 \u65ad\u5f00slave\u4e0emaster\u7684\u8fde\u63a5\uff0cslave\u65ad\u5f00\u8fde\u63a5\u540e\uff0c\u4e0d\u4f1a\u5220\u9664\u5df2\u6709\u6570\u636e\uff0c\u53ea\u662f\u4e0d\u518d\u63a5\u53d7master\u53d1\u9001\u7684\u6570\u636e slaveof no one \u6388\u6743\u8bbf\u95ee master\u5ba2\u6237\u7aef\u53d1\u9001\u547d\u4ee4\u8bbe\u7f6e\u5bc6\u7801 requirepass password master\u914d\u7f6e\u6587\u4ef6\u8bbe\u7f6e\u5bc6\u7801 config set requirepass password config get requirepass slave\u5ba2\u6237\u7aef\u53d1\u9001\u547d\u4ee4\u8bbe\u7f6e\u5bc6\u7801 auth password slave\u914d\u7f6e\u6587\u4ef6\u8bbe\u7f6e\u5bc6\u7801 masterauth password slave\u542f\u52a8\u670d\u52a1\u5668\u8bbe\u7f6e\u5bc6\u7801 redis-server \u2013a password 2.2.1.2 \u9636\u6bb5\u4e8c\uff1a\u6570\u636e\u540c\u6b65 \u00b6 \u5728slave\u521d\u6b21\u8fde\u63a5master\u540e\uff0c\u590d\u5236master\u4e2d\u7684\u6240\u6709\u6570\u636e\u5230slave \u5c06slave\u7684\u6570\u636e\u5e93\u72b6\u6001\u66f4\u65b0\u6210master\u5f53\u524d\u7684\u6570\u636e\u5e93\u72b6\u6001 \u540c\u6b65\u8fc7\u7a0b\u5982\u4e0b\uff1a \u6b65\u9aa41\uff1a\u8bf7\u6c42\u540c\u6b65\u6570\u636e \u6b65\u9aa42\uff1a\u521b\u5efaRDB\u540c\u6b65\u6570\u636e \u6b65\u9aa43\uff1a\u6062\u590dRDB\u540c\u6b65\u6570\u636e \u6b65\u9aa44\uff1a\u8bf7\u6c42\u90e8\u5206\u540c\u6b65\u6570\u636e \u6b65\u9aa45\uff1a\u6062\u590d\u90e8\u5206\u540c\u6b65\u6570\u636e \u81f3\u6b64\uff0c\u6570\u636e\u540c\u6b65\u5de5\u4f5c\u5b8c\u6210\uff01 \u5f53\u524d\u72b6\u6001\uff1a slave\uff1a\u5177\u6709master\u7aef\u5168\u90e8\u6570\u636e\uff0c\u5305\u542bRDB\u8fc7\u7a0b\u63a5\u6536\u7684\u6570\u636e master\uff1a\u4fdd\u5b58slave\u5f53\u524d\u6570\u636e\u540c\u6b65\u7684\u4f4d\u7f6e \u603b\u4f53\uff1a\u4e4b\u95f4\u5b8c\u6210\u4e86\u6570\u636e\u514b\u9686 \u6570\u636e\u540c\u6b65\u9636\u6bb5master\u8bf4\u660e 1\uff1a\u5982\u679cmaster\u6570\u636e\u91cf\u5de8\u5927\uff0c\u6570\u636e\u540c\u6b65\u9636\u6bb5\u5e94\u907f\u5f00\u6d41\u91cf\u9ad8\u5cf0\u671f\uff0c\u907f\u514d\u9020\u6210master\u963b\u585e\uff0c\u5f71\u54cd\u4e1a\u52a1\u6b63\u5e38\u6267\u884c 2\uff1a\u590d\u5236\u7f13\u51b2\u533a\u5927\u5c0f\u8bbe\u5b9a\u4e0d\u5408\u7406\uff0c\u4f1a\u5bfc\u81f4\u6570\u636e\u6ea2\u51fa\u3002\u5982\u8fdb\u884c\u5168\u91cf\u590d\u5236\u5468\u671f\u592a\u957f\uff0c\u8fdb\u884c\u90e8\u5206\u590d\u5236\u65f6\u53d1\u73b0\u6570\u636e\u5df2\u7ecf\u5b58\u5728\u4e22\u5931\u7684\u60c5\u51b5\uff0c\u5fc5\u987b\u8fdb\u884c\u7b2c\u4e8c\u6b21\u5168\u91cf\u590d\u5236\uff0c\u81f4\u4f7fslave\u9677\u5165\u6b7b\u5faa\u73af\u72b6\u6001\u3002 repl-backlog-size ?mb master\u5355\u673a\u5185\u5b58\u5360\u7528\u4e3b\u673a\u5185\u5b58\u7684\u6bd4\u4f8b\u4e0d\u5e94\u8fc7\u5927\uff0c\u5efa\u8bae\u4f7f\u752850%-70%\u7684\u5185\u5b58\uff0c\u7559\u4e0b30%-50%\u7684\u5185\u5b58\u7528\u4e8e\u6267 \u884cbgsave\u547d\u4ee4\u548c\u521b\u5efa\u590d\u5236\u7f13\u51b2\u533a \u6570\u636e\u540c\u6b65\u9636\u6bb5slave\u8bf4\u660e \u4e3a\u907f\u514dslave\u8fdb\u884c\u5168\u91cf\u590d\u5236\u3001\u90e8\u5206\u590d\u5236\u65f6\u670d\u52a1\u5668\u54cd\u5e94\u963b\u585e\u6216\u6570\u636e\u4e0d\u540c\u6b65\uff0c\u5efa\u8bae\u5173\u95ed\u6b64\u671f\u95f4\u7684\u5bf9\u5916\u670d\u52a1 slave-serve-stale-data yes|no \u6570\u636e\u540c\u6b65\u9636\u6bb5\uff0cmaster\u53d1\u9001\u7ed9slave\u4fe1\u606f\u53ef\u4ee5\u7406\u89e3master\u662fslave\u7684\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0c\u4e3b\u52a8\u5411slave\u53d1\u9001\u547d\u4ee4 \u591a\u4e2aslave\u540c\u65f6\u5bf9master\u8bf7\u6c42\u6570\u636e\u540c\u6b65\uff0cmaster\u53d1\u9001\u7684RDB\u6587\u4ef6\u589e\u591a\uff0c\u4f1a\u5bf9\u5e26\u5bbd\u9020\u6210\u5de8\u5927\u51b2\u51fb\uff0c\u5982\u679cmaster\u5e26\u5bbd\u4e0d\u8db3\uff0c\u56e0\u6b64\u6570\u636e\u540c\u6b65\u9700\u8981\u6839\u636e\u4e1a\u52a1\u9700\u6c42\uff0c\u9002\u91cf\u9519\u5cf0 slave\u8fc7\u591a\u65f6\uff0c\u5efa\u8bae\u8c03\u6574\u62d3\u6251\u7ed3\u6784\uff0c\u7531\u4e00\u4e3b\u591a\u4ece\u7ed3\u6784\u53d8\u4e3a\u6811\u72b6\u7ed3\u6784\uff0c\u4e2d\u95f4\u7684\u8282\u70b9\u65e2\u662fmaster\uff0c\u4e5f\u662f slave\u3002\u6ce8\u610f\u4f7f\u7528\u6811\u72b6\u7ed3\u6784\u65f6\uff0c\u7531\u4e8e\u5c42\u7ea7\u6df1\u5ea6\uff0c\u5bfc\u81f4\u6df1\u5ea6\u8d8a\u9ad8\u7684slave\u4e0e\u6700\u9876\u5c42master\u95f4\u6570\u636e\u540c\u6b65\u5ef6\u8fdf \u8f83\u5927\uff0c\u6570\u636e\u4e00\u81f4\u6027\u53d8\u5dee\uff0c\u5e94\u8c28\u614e\u9009\u62e9 2.2.1.3 \u9636\u6bb5\u4e09\uff1a\u547d\u4ee4\u4f20\u64ad \u00b6 \u5f53master\u6570\u636e\u5e93\u72b6\u6001\u88ab\u4fee\u6539\u540e\uff0c\u5bfc\u81f4\u4e3b\u4ece\u670d\u52a1\u5668\u6570\u636e\u5e93\u72b6\u6001\u4e0d\u4e00\u81f4\uff0c\u6b64\u65f6\u9700\u8981\u8ba9\u4e3b\u4ece\u6570\u636e\u540c\u6b65\u5230\u4e00\u81f4\u7684\u72b6\u6001\uff0c\u540c\u6b65\u7684\u52a8\u4f5c\u79f0\u4e3a\u547d\u4ee4\u4f20\u64ad master\u5c06\u63a5\u6536\u5230\u7684\u6570\u636e\u53d8\u66f4\u547d\u4ee4\u53d1\u9001\u7ed9slave\uff0cslave\u63a5\u6536\u547d\u4ee4\u540e\u6267\u884c\u547d\u4ee4 \u547d\u4ee4\u4f20\u64ad\u9636\u6bb5\u7684\u90e8\u5206\u590d\u5236 \u547d\u4ee4\u4f20\u64ad\u9636\u6bb5\u51fa\u73b0\u4e86\u65ad\u7f51\u73b0\u8c61\uff1a \u7f51\u7edc\u95ea\u65ad\u95ea\u8fde\uff1a\u5ffd\u7565 \u77ed\u65f6\u95f4\u7f51\u7edc\u4e2d\u65ad\uff1a\u90e8\u5206\u590d\u5236 \u957f\u65f6\u95f4\u7f51\u7edc\u4e2d\u65ad\uff1a\u5168\u91cf\u590d\u5236 \u8fd9\u91cc\u6211\u4eec\u4e3b\u8981\u6765\u770b\u90e8\u5206\u590d\u5236\uff0c\u90e8\u5206\u590d\u5236\u7684\u4e09\u4e2a\u6838\u5fc3\u8981\u7d20 \u670d\u52a1\u5668\u7684\u8fd0\u884c id\uff08run id\uff09 \u4e3b\u670d\u52a1\u5668\u7684\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a \u4e3b\u4ece\u670d\u52a1\u5668\u7684\u590d\u5236\u504f\u79fb\u91cf \u670d\u52a1\u5668\u8fd0\u884cID\uff08runid\uff09 \u6982\u5ff5\uff1a\u670d\u52a1\u5668\u8fd0\u884cID\u662f\u6bcf\u4e00\u53f0\u670d\u52a1\u5668\u6bcf\u6b21\u8fd0\u884c\u7684\u8eab\u4efd\u8bc6\u522b\u7801\uff0c\u4e00\u53f0\u670d\u52a1\u5668\u591a\u6b21\u8fd0\u884c\u53ef\u4ee5\u751f\u6210\u591a\u4e2a\u8fd0\u884cid \u7ec4\u6210\uff1a\u8fd0\u884cid\u753140\u4f4d\u5b57\u7b26\u7ec4\u6210\uff0c\u662f\u4e00\u4e2a\u968f\u673a\u7684\u5341\u516d\u8fdb\u5236\u5b57\u7b26 \u4f8b\u5982\uff1afdc9ff13b9bbaab28db42b3d50f852bb5e3fcdce \u4f5c\u7528\uff1a\u8fd0\u884cid\u88ab\u7528\u4e8e\u5728\u670d\u52a1\u5668\u95f4\u8fdb\u884c\u4f20\u8f93\uff0c\u8bc6\u522b\u8eab\u4efd \u5982\u679c\u60f3\u4e24\u6b21\u64cd\u4f5c\u5747\u5bf9\u540c\u4e00\u53f0\u670d\u52a1\u5668\u8fdb\u884c\uff0c\u5fc5\u987b\u6bcf\u6b21\u64cd\u4f5c\u643a\u5e26\u5bf9\u5e94\u7684\u8fd0\u884cid\uff0c\u7528\u4e8e\u5bf9\u65b9\u8bc6\u522b \u5b9e\u73b0\u65b9\u5f0f\uff1a\u8fd0\u884cid\u5728\u6bcf\u53f0\u670d\u52a1\u5668\u542f\u52a8\u65f6\u81ea\u52a8\u751f\u6210\u7684\uff0cmaster\u5728\u9996\u6b21\u8fde\u63a5slave\u65f6\uff0c\u4f1a\u5c06\u81ea\u5df1\u7684\u8fd0\u884cID\u53d1\u9001\u7ed9slave\uff0c slave\u4fdd\u5b58\u6b64ID\uff0c\u901a\u8fc7info Server\u547d\u4ee4\uff0c\u53ef\u4ee5\u67e5\u770b\u8282\u70b9\u7684runid \u590d\u5236\u7f13\u51b2\u533a \u6982\u5ff5\uff1a\u590d\u5236\u7f13\u51b2\u533a\uff0c\u53c8\u540d\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\uff0c\u662f\u4e00\u4e2a\u5148\u8fdb\u5148\u51fa\uff08FIFO\uff09\u7684\u961f\u5217\uff0c\u7528\u4e8e\u5b58\u50a8\u670d\u52a1\u5668\u6267\u884c\u8fc7\u7684\u547d\u4ee4\uff0c\u6bcf\u6b21\u4f20\u64ad\u547d\u4ee4\uff0cmaster\u90fd\u4f1a\u5c06\u4f20\u64ad\u7684\u547d\u4ee4\u8bb0\u5f55\u4e0b\u6765\uff0c\u5e76\u5b58\u50a8\u5728\u590d\u5236\u7f13\u51b2\u533a \u590d\u5236\u7f13\u51b2\u533a\u9ed8\u8ba4\u6570\u636e\u5b58\u50a8\u7a7a\u95f4\u5927\u5c0f\u662f1M \u5f53\u5165\u961f\u5143\u7d20\u7684\u6570\u91cf\u5927\u4e8e\u961f\u5217\u957f\u5ea6\u65f6\uff0c\u6700\u5148\u5165\u961f\u7684\u5143\u7d20\u4f1a\u88ab\u5f39\u51fa\uff0c\u800c\u65b0\u5143\u7d20\u4f1a\u88ab\u653e\u5165\u961f\u5217 \u4f5c\u7528\uff1a\u7528\u4e8e\u4fdd\u5b58master\u6536\u5230\u7684\u6240\u6709\u6307\u4ee4\uff08\u4ec5\u5f71\u54cd\u6570\u636e\u53d8\u66f4\u7684\u6307\u4ee4\uff0c\u4f8b\u5982set\uff0cselect\uff09 \u6570\u636e\u6765\u6e90\uff1a\u5f53master\u63a5\u6536\u5230\u4e3b\u5ba2\u6237\u7aef\u7684\u6307\u4ee4\u65f6\uff0c\u9664\u4e86\u5c06\u6307\u4ee4\u6267\u884c\uff0c\u4f1a\u5c06\u8be5\u6307\u4ee4\u5b58\u50a8\u5230\u7f13\u51b2\u533a\u4e2d \u590d\u5236\u7f13\u51b2\u533a\u5185\u90e8\u5de5\u4f5c\u539f\u7406\uff1a \u7ec4\u6210 \u504f\u79fb\u91cf \u6982\u5ff5\uff1a\u4e00\u4e2a\u6570\u5b57\uff0c\u63cf\u8ff0\u590d\u5236\u7f13\u51b2\u533a\u4e2d\u7684\u6307\u4ee4\u5b57\u8282\u4f4d\u7f6e \u5206\u7c7b\uff1a master\u590d\u5236\u504f\u79fb\u91cf\uff1a\u8bb0\u5f55\u53d1\u9001\u7ed9\u6240\u6709slave\u7684\u6307\u4ee4\u5b57\u8282\u5bf9\u5e94\u7684\u4f4d\u7f6e\uff08\u591a\u4e2a\uff09 slave\u590d\u5236\u504f\u79fb\u91cf\uff1a\u8bb0\u5f55slave\u63a5\u6536master\u53d1\u9001\u8fc7\u6765\u7684\u6307\u4ee4\u5b57\u8282\u5bf9\u5e94\u7684\u4f4d\u7f6e\uff08\u4e00\u4e2a\uff09 \u4f5c\u7528\uff1a\u540c\u6b65\u4fe1\u606f\uff0c\u6bd4\u5bf9master\u4e0eslave\u7684\u5dee\u5f02\uff0c\u5f53slave\u65ad\u7ebf\u540e\uff0c\u6062\u590d\u6570\u636e\u4f7f\u7528 \u6570\u636e\u6765\u6e90\uff1a master\u7aef\uff1a\u53d1\u9001\u4e00\u6b21\u8bb0\u5f55\u4e00\u6b21 slave\u7aef\uff1a\u63a5\u6536\u4e00\u6b21\u8bb0\u5f55\u4e00\u6b21 \u5b57\u8282\u503c \u5de5\u4f5c\u539f\u7406 \u901a\u8fc7offset\u533a\u5206\u4e0d\u540c\u7684slave\u5f53\u524d\u6570\u636e\u4f20\u64ad\u7684\u5dee\u5f02 master\u8bb0\u5f55\u5df2\u53d1\u9001\u7684\u4fe1\u606f\u5bf9\u5e94\u7684offset slave\u8bb0\u5f55\u5df2\u63a5\u6536\u7684\u4fe1\u606f\u5bf9\u5e94\u7684offset 2.2.2 \u6d41\u7a0b\u66f4\u65b0(\u5168\u91cf\u590d\u5236/\u90e8\u5206\u590d\u5236) \u00b6 \u6211\u4eec\u518d\u6b21\u7684\u603b\u7ed3\u4e00\u4e0b\u4e3b\u4ece\u590d\u5236\u7684\u4e09\u4e2a\u9636\u6bb5\u7684\u5de5\u4f5c\u6d41\u7a0b\uff1a 2.2.3 \u5fc3\u8df3\u673a\u5236 \u00b6 \u4ec0\u4e48\u662f\u5fc3\u8df3\u673a\u5236\uff1f \u8fdb\u5165\u547d\u4ee4\u4f20\u64ad\u9636\u6bb5\u5019\uff0cmaster\u4e0eslave\u95f4\u9700\u8981\u8fdb\u884c\u4fe1\u606f\u4ea4\u6362\uff0c\u4f7f\u7528\u5fc3\u8df3\u673a\u5236\u8fdb\u884c\u7ef4\u62a4\uff0c\u5b9e\u73b0\u53cc\u65b9\u8fde\u63a5\u4fdd\u6301\u5728\u7ebf master\u5fc3\u8df3\uff1a \u5185\u90e8\u6307\u4ee4\uff1aPING \u5468\u671f\uff1a\u7531repl-ping-slave-period\u51b3\u5b9a\uff0c\u9ed8\u8ba410\u79d2 \u4f5c\u7528\uff1a\u5224\u65adslave\u662f\u5426\u5728\u7ebf \u67e5\u8be2\uff1aINFO replication \u83b7\u53d6slave\u6700\u540e\u4e00\u6b21\u8fde\u63a5\u65f6\u95f4\u95f4\u9694\uff0clag\u9879\u7ef4\u6301\u57280\u62161\u89c6\u4e3a\u6b63\u5e38 slave\u5fc3\u8df3\u4efb\u52a1 \u5185\u90e8\u6307\u4ee4\uff1aREPLCONF ACK {offset} \u5468\u671f\uff1a1\u79d2 \u4f5c\u75281\uff1a\u6c47\u62a5slave\u81ea\u5df1\u7684\u590d\u5236\u504f\u79fb\u91cf\uff0c\u83b7\u53d6\u6700\u65b0\u7684\u6570\u636e\u53d8\u66f4\u6307\u4ee4 \u4f5c\u75282\uff1a\u5224\u65admaster\u662f\u5426\u5728\u7ebf \u5fc3\u8df3\u9636\u6bb5\u6ce8\u610f\u4e8b\u9879\uff1a \u5f53slave\u591a\u6570\u6389\u7ebf\uff0c\u6216\u5ef6\u8fdf\u8fc7\u9ad8\u65f6\uff0cmaster\u4e3a\u4fdd\u969c\u6570\u636e\u7a33\u5b9a\u6027\uff0c\u5c06\u62d2\u7edd\u6240\u6709\u4fe1\u606f\u540c\u6b65 min-slaves-to-write 2 min-slaves-max-lag 8 slave\u6570\u91cf\u5c11\u4e8e2\u4e2a\uff0c\u6216\u8005\u6240\u6709slave\u7684\u5ef6\u8fdf\u90fd\u5927\u4e8e\u7b49\u4e8e8\u79d2\u65f6\uff0c\u5f3a\u5236\u5173\u95edmaster\u5199\u529f\u80fd\uff0c\u505c\u6b62\u6570\u636e\u540c\u6b65 slave\u6570\u91cf\u7531slave\u53d1\u9001REPLCONF ACK\u547d\u4ee4\u505a\u786e\u8ba4 slave\u5ef6\u8fdf\u7531slave\u53d1\u9001REPLCONF ACK\u547d\u4ee4\u505a\u786e\u8ba4 \u81f3\u6b64\uff1a\u6211\u4eec\u53ef\u4ee5\u603b\u7ed3\u51fa\u5b8c\u6574\u7684\u4e3b\u4ece\u590d\u5236\u6d41\u7a0b\uff1a 2.3 \u4e3b\u4ece\u590d\u5236\u5e38\u89c1\u95ee\u9898 \u00b6 2.3.1 \u9891\u7e41\u7684\u5168\u91cf\u590d\u5236 \u00b6 \u4f34\u968f\u7740\u7cfb\u7edf\u7684\u8fd0\u884c\uff0cmaster\u7684\u6570\u636e\u91cf\u4f1a\u8d8a\u6765\u8d8a\u5927\uff0c\u4e00\u65e6master\u91cd\u542f\uff0crunid\u5c06\u53d1\u751f\u53d8\u5316\uff0c\u4f1a\u5bfc\u81f4\u5168\u90e8slave\u7684\u5168\u91cf\u590d\u5236\u64cd\u4f5c \u5185\u90e8\u4f18\u5316\u8c03\u6574\u65b9\u6848\uff1a 1\uff1amaster\u5185\u90e8\u521b\u5efamaster_replid\u53d8\u91cf\uff0c\u4f7f\u7528runid\u76f8\u540c\u7684\u7b56\u7565\u751f\u6210\uff0c\u957f\u5ea641\u4f4d\uff0c\u5e76\u53d1\u9001\u7ed9\u6240\u6709slave 2\uff1a\u5728master\u5173\u95ed\u65f6\u6267\u884c\u547d\u4ee4shutdown save\uff0c\u8fdb\u884cRDB\u6301\u4e45\u5316,\u5c06runid\u4e0eoffset\u4fdd\u5b58\u5230RDB\u6587\u4ef6\u4e2d repl-id repl-offset \u901a\u8fc7redis-check-rdb\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u8be5\u4fe1\u606f 3\uff1amaster\u91cd\u542f\u540e\u52a0\u8f7dRDB\u6587\u4ef6\uff0c\u6062\u590d\u6570\u636e\uff0c\u91cd\u542f\u540e\uff0c\u5c06RDB\u6587\u4ef6\u4e2d\u4fdd\u5b58\u7684repl-id\u4e0erepl-offset\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d master_repl_id=repl master_repl_offset =repl-offset \u901a\u8fc7info\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u8be5\u4fe1\u606f \u4f5c\u7528\uff1a\u672c\u673a\u4fdd\u5b58\u4e0a\u6b21runid\uff0c\u91cd\u542f\u540e\u6062\u590d\u8be5\u503c\uff0c\u4f7f\u6240\u6709slave\u8ba4\u4e3a\u8fd8\u662f\u4e4b\u524d\u7684master \u7b2c\u4e8c\u79cd\u51fa\u73b0\u9891\u7e41\u5168\u91cf\u590d\u5236\u7684\u95ee\u9898\u73b0\u8c61\uff1a\u7f51\u7edc\u73af\u5883\u4e0d\u4f73\uff0c\u51fa\u73b0\u7f51\u7edc\u4e2d\u65ad\uff0cslave\u4e0d\u63d0\u4f9b\u670d\u52a1 \u95ee\u9898\u539f\u56e0\uff1a\u590d\u5236\u7f13\u51b2\u533a\u8fc7\u5c0f\uff0c\u65ad\u7f51\u540eslave\u7684offset\u8d8a\u754c\uff0c\u89e6\u53d1\u5168\u91cf\u590d\u5236 \u6700\u7ec8\u7ed3\u679c\uff1aslave\u53cd\u590d\u8fdb\u884c\u5168\u91cf\u590d\u5236 \u89e3\u51b3\u65b9\u6848\uff1a\u4fee\u6539\u590d\u5236\u7f13\u51b2\u533a\u5927\u5c0f repl-backlog-size ?mb \u5efa\u8bae\u8bbe\u7f6e\u5982\u4e0b\uff1a 1.\u6d4b\u7b97\u4ecemaster\u5230slave\u7684\u91cd\u8fde\u5e73\u5747\u65f6\u957fsecond 2.\u83b7\u53d6master\u5e73\u5747\u6bcf\u79d2\u4ea7\u751f\u5199\u547d\u4ee4\u6570\u636e\u603b\u91cfwrite_size_per_second 3.\u6700\u4f18\u590d\u5236\u7f13\u51b2\u533a\u7a7a\u95f4 = 2 * second * write_size_per_second 2.3.2 \u9891\u7e41\u7684\u7f51\u7edc\u4e2d\u65ad \u00b6 \u95ee\u9898\u73b0\u8c61\uff1amaster\u7684CPU\u5360\u7528\u8fc7\u9ad8 \u6216 slave\u9891\u7e41\u65ad\u5f00\u8fde\u63a5 \u95ee\u9898\u539f\u56e0 slave\u6bcf1\u79d2\u53d1\u9001REPLCONFACK\u547d\u4ee4\u5230master \u5f53slave\u63a5\u5230\u4e86\u6162\u67e5\u8be2\u65f6\uff08keys * \uff0chgetall\u7b49\uff09\uff0c\u4f1a\u5927\u91cf\u5360\u7528CPU\u6027\u80fd master\u6bcf1\u79d2\u8c03\u7528\u590d\u5236\u5b9a\u65f6\u51fd\u6570replicationCron()\uff0c\u6bd4\u5bf9slave\u53d1\u73b0\u957f\u65f6\u95f4\u6ca1\u6709\u8fdb\u884c\u54cd\u5e94 \u6700\u7ec8\u7ed3\u679c\uff1amaster\u5404\u79cd\u8d44\u6e90\uff08\u8f93\u51fa\u7f13\u51b2\u533a\u3001\u5e26\u5bbd\u3001\u8fde\u63a5\u7b49\uff09\u88ab\u4e25\u91cd\u5360\u7528 \u89e3\u51b3\u65b9\u6848\uff1a\u901a\u8fc7\u8bbe\u7f6e\u5408\u7406\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u786e\u8ba4\u662f\u5426\u91ca\u653eslave repl-timeout seconds \u8be5\u53c2\u6570\u5b9a\u4e49\u4e86\u8d85\u65f6\u65f6\u95f4\u7684\u9608\u503c\uff08\u9ed8\u8ba460\u79d2\uff09\uff0c\u8d85\u8fc7\u8be5\u503c\uff0c\u91ca\u653eslave \u95ee\u9898\u73b0\u8c61\uff1aslave\u4e0emaster\u8fde\u63a5\u65ad\u5f00 \u95ee\u9898\u539f\u56e0 master\u53d1\u9001ping\u6307\u4ee4\u9891\u5ea6\u8f83\u4f4e master\u8bbe\u5b9a\u8d85\u65f6\u65f6\u95f4\u8f83\u77ed ping\u6307\u4ee4\u5728\u7f51\u7edc\u4e2d\u5b58\u5728\u4e22\u5305 \u89e3\u51b3\u65b9\u6848\uff1a\u63d0\u9ad8ping\u6307\u4ee4\u53d1\u9001\u7684\u9891\u5ea6 repl-ping-slave-period seconds \u8d85\u65f6\u65f6\u95f4repl-time\u7684\u65f6\u95f4\u81f3\u5c11\u662fping\u6307\u4ee4\u9891\u5ea6\u76845\u523010\u500d\uff0c\u5426\u5219slave\u5f88\u5bb9\u6613\u5224\u5b9a\u8d85\u65f6 2.3.3 \u6570\u636e\u4e0d\u4e00\u81f4 \u00b6 \u95ee\u9898\u73b0\u8c61\uff1a\u591a\u4e2aslave\u83b7\u53d6\u76f8\u540c\u6570\u636e\u4e0d\u540c\u6b65 \u95ee\u9898\u539f\u56e0\uff1a\u7f51\u7edc\u4fe1\u606f\u4e0d\u540c\u6b65\uff0c\u6570\u636e\u53d1\u9001\u6709\u5ef6\u8fdf \u89e3\u51b3\u65b9\u6848 \u4f18\u5316\u4e3b\u4ece\u95f4\u7684\u7f51\u7edc\u73af\u5883\uff0c\u901a\u5e38\u653e\u7f6e\u5728\u540c\u4e00\u4e2a\u673a\u623f\u90e8\u7f72\uff0c\u5982\u4f7f\u7528\u963f\u91cc\u4e91\u7b49\u4e91\u670d\u52a1\u5668\u65f6\u8981\u6ce8\u610f\u6b64\u73b0\u8c61 \u76d1\u63a7\u4e3b\u4ece\u8282\u70b9\u5ef6\u8fdf\uff08\u901a\u8fc7offset\uff09\u5224\u65ad\uff0c\u5982\u679cslave\u5ef6\u8fdf\u8fc7\u5927\uff0c\u6682\u65f6\u5c4f\u853d\u7a0b\u5e8f\u5bf9\u8be5slave\u7684\u6570\u636e\u8bbf\u95ee slave-serve-stale-data yes|no \u5f00\u542f\u540e\u4ec5\u54cd\u5e94info\u3001slaveof\u7b49\u5c11\u6570\u547d\u4ee4\uff08\u614e\u7528\uff0c\u9664\u975e\u5bf9\u6570\u636e\u4e00\u81f4\u6027\u8981\u6c42\u5f88\u9ad8\uff09 3.\u54e8\u5175\u6a21\u5f0f \u00b6 3.1 \u54e8\u5175\u7b80\u4ecb \u00b6 3.1.1 \u54e8\u5175\u6982\u5ff5 \u00b6 \u9996\u5148\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u4e1a\u52a1\u573a\u666f\uff1a\u5982\u679credis\u7684master\u5b95\u673a\u4e86\uff0c\u6b64\u65f6\u5e94\u8be5\u600e\u4e48\u529e\uff1f \u90a3\u6b64\u65f6\u6211\u4eec\u53ef\u80fd\u9700\u8981\u4ece\u4e00\u5806\u7684slave\u4e2d\u91cd\u65b0\u9009\u4e3e\u51fa\u4e00\u4e2a\u65b0\u7684master\uff0c\u90a3\u8fd9\u4e2a\u64cd\u4f5c\u8fc7\u7a0b\u662f\u4ec0\u4e48\u6837\u7684\u5462\uff1f\u8fd9\u91cc\u9762\u4f1a\u6709\u4ec0\u4e48\u95ee\u9898\u51fa\u73b0\u5462\uff1f \u8981\u5b9e\u73b0\u8fd9\u4e9b\u529f\u80fd\uff0c\u6211\u4eec\u5c31\u9700\u8981redis\u7684\u54e8\u5175\uff0c\u90a3\u54e8\u5175\u662f\u4ec0\u4e48\u5462\uff1f \u54e8\u5175 \u54e8\u5175(sentinel) \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u7528\u4e8e\u5bf9\u4e3b\u4ece\u7ed3\u6784\u4e2d\u7684\u6bcf\u53f0\u670d\u52a1\u5668\u8fdb\u884c \u76d1\u63a7 \uff0c\u5f53\u51fa\u73b0\u6545\u969c\u65f6\u901a\u8fc7 \u6295\u7968 \u673a\u5236 \u9009\u62e9 \u65b0\u7684master\u5e76\u5c06\u6240\u6709slave\u8fde\u63a5\u5230\u65b0\u7684master\u3002 3.1.2 \u54e8\u5175\u4f5c\u7528 \u00b6 \u54e8\u5175\u7684\u4f5c\u7528\uff1a \u76d1\u63a7\uff1a\u76d1\u63a7master\u548cslave \u4e0d\u65ad\u7684\u68c0\u67e5master\u548cslave\u662f\u5426\u6b63\u5e38\u8fd0\u884c master\u5b58\u6d3b\u68c0\u6d4b\u3001master\u4e0eslave\u8fd0\u884c\u60c5\u51b5\u68c0\u6d4b \u901a\u77e5\uff08\u63d0\u9192\uff09\uff1a\u5f53\u88ab\u76d1\u63a7\u7684\u670d\u52a1\u5668\u51fa\u73b0\u95ee\u9898\u65f6\uff0c\u5411\u5176\u4ed6\uff08\u54e8\u5175\u95f4\uff0c\u5ba2\u6237\u7aef\uff09\u53d1\u9001\u901a\u77e5 \u81ea\u52a8\u6545\u969c\u8f6c\u79fb\uff1a\u65ad\u5f00master\u4e0eslave\u8fde\u63a5\uff0c\u9009\u53d6\u4e00\u4e2aslave\u4f5c\u4e3amaster\uff0c\u5c06\u5176\u4ed6slave\u8fde\u63a5\u65b0\u7684master\uff0c\u5e76\u544a\u77e5\u5ba2\u6237\u7aef\u65b0\u7684\u670d\u52a1\u5668\u5730\u5740 \u6ce8\u610f\uff1a\u54e8\u5175\u4e5f\u662f\u4e00\u53f0redis\u670d\u52a1\u5668\uff0c\u53ea\u662f\u4e0d\u63d0\u4f9b\u6570\u636e\u76f8\u5173\u670d\u52a1\uff0c\u901a\u5e38\u54e8\u5175\u7684\u6570\u91cf\u914d\u7f6e\u4e3a\u5355\u6570 3.2 \u542f\u7528\u54e8\u5175 \u00b6 \u914d\u7f6e\u54e8\u5175 \u914d\u7f6e\u4e00\u62d6\u4e8c\u7684\u4e3b\u4ece\u7ed3\u6784\uff08\u5229\u7528\u4e4b\u524d\u7684\u65b9\u5f0f\u542f\u52a8\u5373\u53ef\uff09 \u914d\u7f6e\u4e09\u4e2a\u54e8\u5175\uff08\u914d\u7f6e\u76f8\u540c\uff0c\u7aef\u53e3\u4e0d\u540c\uff09\uff0c\u53c2\u770bsentinel.conf 1\uff1a\u8bbe\u7f6e\u54e8\u5175\u76d1\u542c\u7684\u4e3b\u670d\u52a1\u5668\u4fe1\u606f\uff0c sentinel_number\u8868\u793a\u53c2\u4e0e\u6295\u7968\u7684\u54e8\u5175\u6570\u91cf sentinel monitor master_name master_host master_port sentinel_number 2\uff1a\u8bbe\u7f6e\u5224\u5b9a\u670d\u52a1\u5668\u5b95\u673a\u65f6\u957f\uff0c\u8be5\u8bbe\u7f6e\u63a7\u5236\u662f\u5426\u8fdb\u884c\u4e3b\u4ece\u5207\u6362 sentinel down-after-milliseconds master_name million_seconds 3\uff1a\u8bbe\u7f6e\u6545\u969c\u5207\u6362\u7684\u6700\u5927\u8d85\u65f6\u65f6 sentinel failover-timeout master_name million_seconds 4\uff1a\u8bbe\u7f6e\u4e3b\u4ece\u5207\u6362\u540e\uff0c\u540c\u65f6\u8fdb\u884c\u6570\u636e\u540c\u6b65\u7684slave\u6570\u91cf\uff0c\u6570\u503c\u8d8a\u5927\uff0c\u8981\u6c42\u7f51\u7edc\u8d44\u6e90\u8d8a\u9ad8\uff0c\u6570\u503c\u8d8a\u5c0f\uff0c\u540c\u6b65\u65f6\u95f4\u8d8a\u957f sentinel parallel-syncs master_name sync_slave_number \u542f\u52a8\u54e8\u5175 redis-sentinel filename 3.3 \u54e8\u5175\u5de5\u4f5c\u539f\u7406 \u00b6 \u54e8\u5175\u5728\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\u8fc7\u7a0b\u4e2d\u7ecf\u5386\u4e09\u4e2a\u9636\u6bb5 \u76d1\u63a7 \u901a\u77e5 \u6545\u969c\u8f6c\u79fb 3.3.1 \u76d1\u63a7 \u00b6 \u7528\u4e8e\u540c\u6b65\u5404\u4e2a\u8282\u70b9\u7684\u72b6\u6001\u4fe1\u606f \u83b7\u53d6\u5404\u4e2asentinel\u7684\u72b6\u6001\uff08\u662f\u5426\u5728\u7ebf\uff09 \u83b7\u53d6master\u7684\u72b6\u6001 master\u5c5e\u6027 prunid prole\uff1amaster \u5404\u4e2aslave\u7684\u8be6\u7ec6\u4fe1\u606f \u83b7\u53d6\u6240\u6709slave\u7684\u72b6\u6001\uff08\u6839\u636emaster\u4e2d\u7684slave\u4fe1\u606f\uff09 slave\u5c5e\u6027 prunid prole\uff1aslave pmaster_host\u3001master_port poffset \u5176\u5185\u90e8\u7684\u5de5\u4f5c\u539f\u7406\u5177\u4f53\u5982\u4e0b\uff1a 3.3.2 \u901a\u77e5 \u00b6 sentinel\u5728\u901a\u77e5\u9636\u6bb5\u8981\u4e0d\u65ad\u7684\u53bb\u83b7\u53d6master/slave\u7684\u4fe1\u606f\uff0c\u7136\u540e\u5728\u5404\u4e2asentinel\u4e4b\u95f4\u8fdb\u884c\u5171\u4eab\uff0c\u5177\u4f53\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a 3.3.3 \u6545\u969c\u8f6c\u79fb \u00b6 \u5f53master\u5b95\u673a\u540esentinel\u662f\u5982\u4f55\u77e5\u6653\u5e76\u5224\u65ad\u51famaster\u662f\u771f\u7684\u5b95\u673a\u4e86\u5462\uff1f\u6211\u4eec\u6765\u770b\u5177\u4f53\u7684\u64cd\u4f5c\u6d41\u7a0b \u5f53sentinel\u8ba4\u5b9amaster\u4e0b\u7ebf\u4e4b\u540e\uff0c\u6b64\u65f6\u9700\u8981\u51b3\u5b9a\u66f4\u6362master\uff0c\u90a3\u8fd9\u4ef6\u4e8b\u7531\u54ea\u4e2asentinel\u6765\u505a\u5462\uff1f\u8fd9\u65f6\u5019sentinel\u4e4b\u95f4\u8981\u8fdb\u884c\u9009\u4e3e\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u5728\u9009\u4e3e\u7684\u65f6\u5019\u6bcf\u4e00\u4e2a\u4eba\u624b\u91cc\u90fd\u6709\u4e00\u7968\uff0c\u800c\u6bcf\u4e00\u4e2a\u4eba\u7684\u53c8\u90fd\u60f3\u5f53\u8fd9\u4e2a\u5904\u7406\u4e8b\u6545\u7684\u4eba\uff0c\u90a3\u600e\u4e48\u529e\uff1f\u5927\u5bb6\u5c31\u5f00\u59cb\u62a2\uff0c\u4e8e\u662f\u6bcf\u4e2a\u4eba\u90fd\u4f1a\u53d1\u51fa\u4e00\u4e2a\u6307\u4ee4\uff0c\u5728\u5185\u7f51\u91cc\u8fb9\u544a\u8bc9\u5927\u5bb6\u6211\u8981\u5f53\u9009\u4e3e\u4eba\uff0c\u6bd4\u5982\u8bf4\u73b0\u5728\u7684sentinel1\u548csentinel4\u53d1\u51fa\u8fd9\u4e2a\u9009\u4e3e\u6307\u4ee4\u4e86\uff0c\u90a3\u4e48sentinel2\u65e2\u80fd\u63a5\u5230sentinel1\u7684\u4e5f\u80fd\u63a5\u5230sentinel4\u7684\uff0c\u63a5\u5230\u4e86\u4ed6\u4eec\u7684\u7533\u8bf7\u4ee5\u540e\u5462\uff0csentinel2\u4ed6\u5c31\u4f1a\u628a\u4ed6\u7684\u4e00\u7968\u6295\u7ed9\u5176\u4e2d\u4e00\u65b9\uff0c\u6295\u7ed9\u8c01\u5462\uff1f\u8c01\u5148\u8fc7\u6765\u6211\u6295\u7ed9\u8c01\uff0c\u5047\u8bbesentinel1\u5148\u8fc7\u6765\uff0c\u6240\u4ee5\u8fd9\u4e2a\u7968\u5c31\u7ed9\u5230\u4e86sentinel1\u3002\u90a3\u4e48\u7ed9\u8fc7\u53bb\u4ee5\u540e\u5462\uff0c\u73b0\u5728sentinel1\u5c31\u62ff\u5230\u4e86\u4e00\u7968\uff0c\u6309\u7167\u8fd9\u6837\u7684\u4e00\u79cd\u5f62\u5f0f\uff0c\u6700\u7ec8\u4f1a\u6709\u4e00\u4e2a\u9009\u4e3e\u7ed3\u679c\u3002\u5bf9\u5e94\u7684\u9009\u4e3e\u6700\u7ec8\u5f97\u7968\u591a\u7684\uff0c\u90a3\u81ea\u7136\u5c31\u6210\u4e3a\u4e86\u5904\u7406\u4e8b\u6545\u7684\u4eba\u3002\u9700\u8981\u6ce8\u610f\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u6709\u53ef\u80fd\u4f1a\u5b58\u5728\u5931\u8d25\u7684\u73b0\u8c61\uff0c\u5c31\u662f\u4e00\u8f6e\u9009\u4e3e\u5b8c\u6ca1\u6709\u9009\u53d6\uff0c\u90a3\u5c31\u4f1a\u63a5\u7740\u8fdb\u884c\u7b2c\u4e8c\u8f6e\u7b2c\u4e09\u8f6e\u76f4\u5230\u5b8c\u6210\u9009\u4e3e\u3002 \u63a5\u4e0b\u6765\u5c31\u662f\u7531\u9009\u4e3e\u80dc\u51fa\u7684sentinel\u53bb\u4eceslave\u4e2d\u9009\u4e00\u4e2a\u65b0\u7684master\u51fa\u6765\u7684\u5de5\u4f5c\uff0c\u8fd9\u4e2a\u6d41\u7a0b\u662f\u4ec0\u4e48\u6837\u7684\u5462\uff1f \u9996\u5148\u5b83\u6709\u4e00\u4e2a\u5728\u670d\u52a1\u5668\u5217\u8868\u4e2d\u6311\u9009\u5907\u9009master\u7684\u539f\u5219 \u4e0d\u5728\u7ebf\u7684OUT \u54cd\u5e94\u6162\u7684OUT \u4e0e\u539fmaster\u65ad\u5f00\u65f6\u95f4\u4e45\u7684OUT \u4f18\u5148\u539f\u5219 \u4f18\u5148\u7ea7 offset runid \u9009\u51fa\u65b0\u7684master\u4e4b\u540e\uff0c\u53d1\u9001\u6307\u4ee4\uff08 sentinel \uff09\u7ed9\u5176\u4ed6\u7684slave\uff1a \u5411\u65b0\u7684master\u53d1\u9001slaveof no one \u5411\u5176\u4ed6slave\u53d1\u9001slaveof \u65b0masterIP\u7aef\u53e3 \u603b\u7ed3 \uff1a\u6545\u969c\u8f6c\u79fb\u9636\u6bb5 \u53d1\u73b0\u95ee\u9898\uff0c\u4e3b\u89c2\u4e0b\u7ebf\u4e0e\u5ba2\u89c2\u4e0b\u7ebf \u7ade\u9009\u8d1f\u8d23\u4eba \u4f18\u9009\u65b0master \u65b0master\u4e0a\u4efb\uff0c\u5176\u4ed6slave\u5207\u6362master\uff0c\u539fmaster\u4f5c\u4e3aslave\u6545\u969c\u6062\u590d\u540e\u8fde\u63a5 4.\u96c6\u7fa4cluster \u00b6 \u73b0\u72b6\u95ee\u9898\uff1a\u4e1a\u52a1\u53d1\u5c55\u8fc7\u7a0b\u4e2d\u9047\u5230\u7684\u5cf0\u503c\u74f6\u9888 redis\u63d0\u4f9b\u7684\u670d\u52a1OPS\u53ef\u4ee5\u8fbe\u523010\u4e07/\u79d2\uff0c\u5f53\u524d\u4e1a\u52a1OPS\u5df2\u7ecf\u8fbe\u523010\u4e07/\u79d2 \u5185\u5b58\u5355\u673a\u5bb9\u91cf\u8fbe\u5230256G\uff0c\u5f53\u524d\u4e1a\u52a1\u9700\u6c42\u5185\u5b58\u5bb9\u91cf1T \u4f7f\u7528\u96c6\u7fa4\u7684\u65b9\u5f0f\u53ef\u4ee5\u5feb\u901f\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898 4.1 \u96c6\u7fa4\u7b80\u4ecb \u00b6 \u96c6\u7fa4\u5c31\u662f\u4f7f\u7528\u7f51\u7edc\u5c06\u82e5\u5e72\u53f0\u8ba1\u7b97\u673a\u8054\u901a\u8d77\u6765\uff0c\u5e76\u63d0\u4f9b\u7edf\u4e00\u7684\u7ba1\u7406\u65b9\u5f0f\uff0c\u4f7f\u5176\u5bf9\u5916\u5448\u73b0\u5355\u673a\u7684\u670d\u52a1\u6548\u679c \u96c6\u7fa4\u4f5c\u7528\uff1a \u5206\u6563\u5355\u53f0\u670d\u52a1\u5668\u7684\u8bbf\u95ee\u538b\u529b\uff0c\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861 \u5206\u6563\u5355\u53f0\u670d\u52a1\u5668\u7684\u5b58\u50a8\u538b\u529b\uff0c\u5b9e\u73b0\u53ef\u6269\u5c55\u6027 \u964d\u4f4e\u5355\u53f0\u670d\u52a1\u5668\u5b95\u673a\u5e26\u6765\u7684\u4e1a\u52a1\u707e\u96be 4.2 Cluster\u96c6\u7fa4\u7ed3\u6784\u8bbe\u8ba1 \u00b6 \u6570\u636e\u5b58\u50a8\u8bbe\u8ba1\uff1a \u901a\u8fc7\u7b97\u6cd5\u8bbe\u8ba1\uff0c\u8ba1\u7b97\u51fakey\u5e94\u8be5\u4fdd\u5b58\u7684\u4f4d\u7f6e \u5c06\u6240\u6709\u7684\u5b58\u50a8\u7a7a\u95f4\u8ba1\u5212\u5207\u5272\u621016384\u4efd\uff0c\u6bcf\u53f0\u4e3b\u673a\u4fdd\u5b58\u4e00\u90e8\u5206 \u6ce8\u610f\uff1a\u6bcf\u4efd\u4ee3\u8868\u7684\u662f\u4e00\u4e2a\u5b58\u50a8\u7a7a\u95f4\uff0c\u4e0d\u662f\u4e00\u4e2akey\u7684\u4fdd\u5b58\u7a7a\u95f4 \u5c06key\u6309\u7167\u8ba1\u7b97\u51fa\u7684\u7ed3\u679c\u653e\u5230\u5bf9\u5e94\u7684\u5b58\u50a8\u7a7a\u95f4 \u90a3redis\u7684\u96c6\u7fa4\u662f\u5982\u4f55\u589e\u5f3a\u53ef\u6269\u5c55\u6027\u7684\u5462\uff1f\u8b6c\u5982\u6211\u4eec\u8981\u589e\u52a0\u4e00\u4e2a\u96c6\u7fa4\u8282\u70b9 \u5f53\u6211\u4eec\u67e5\u627e\u6570\u636e\u65f6\uff0c\u96c6\u7fa4\u662f\u5982\u4f55\u64cd\u4f5c\u7684\u5462\uff1f \u5404\u4e2a\u6570\u636e\u5e93\u76f8\u4e92\u901a\u4fe1\uff0c\u4fdd\u5b58\u5404\u4e2a\u5e93\u4e2d\u69fd\u7684\u7f16\u53f7\u6570\u636e \u4e00\u6b21\u547d\u4e2d\uff0c\u76f4\u63a5\u8fd4\u56de \u4e00\u6b21\u672a\u547d\u4e2d\uff0c\u544a\u77e5\u5177\u4f53\u4f4d\u7f6e 4.3 Cluster\u96c6\u7fa4\u7ed3\u6784\u642d\u5efa \u00b6 \u9996\u5148\u8981\u660e\u786e\u7684\u51e0\u4e2a\u8981\u70b9\uff1a \u914d\u7f6e\u670d\u52a1\u5668\uff083\u4e3b3\u4ece\uff09 \u5efa\u7acb\u901a\u4fe1\uff08Meet\uff09 \u5206\u69fd\uff08Slot\uff09 \u642d\u5efa\u4e3b\u4ece\uff08master-slave\uff09 Cluster\u914d\u7f6e \u662f\u5426\u542f\u7528cluster\uff0c\u52a0\u5165cluster\u8282\u70b9 cluster-enabled yes|no cluster\u914d\u7f6e\u6587\u4ef6\u540d\uff0c\u8be5\u6587\u4ef6\u5c5e\u4e8e\u81ea\u52a8\u751f\u6210\uff0c\u4ec5\u7528\u4e8e\u5feb\u901f\u67e5\u627e\u6587\u4ef6\u5e76\u67e5\u8be2\u6587\u4ef6\u5185\u5bb9 cluster-config-file filename \u8282\u70b9\u670d\u52a1\u54cd\u5e94\u8d85\u65f6\u65f6\u95f4\uff0c\u7528\u4e8e\u5224\u5b9a\u8be5\u8282\u70b9\u662f\u5426\u4e0b\u7ebf\u6216\u5207\u6362\u4e3a\u4ece\u8282\u70b9 cluster-node-timeout milliseconds master\u8fde\u63a5\u7684slave\u6700\u5c0f\u6570\u91cf cluster-migration-barrier min_slave_number Cluster\u8282\u70b9\u64cd\u4f5c\u547d\u4ee4 \u67e5\u770b\u96c6\u7fa4\u8282\u70b9\u4fe1\u606f cluster nodes \u66f4\u6539slave\u6307\u5411\u65b0\u7684master cluster replicate master-id \u53d1\u73b0\u4e00\u4e2a\u65b0\u8282\u70b9\uff0c\u65b0\u589emaster cluster meet ip : port \u5ffd\u7565\u4e00\u4e2a\u6ca1\u6709solt\u7684\u8282\u70b9 cluster forget server_id \u624b\u52a8\u6545\u969c\u8f6c\u79fb cluster failover \u96c6\u7fa4\u64cd\u4f5c\u547d\u4ee4\uff1a \u521b\u5efa\u96c6\u7fa4 redis-cli \u2013-cluster create masterhost1 : masterport1 masterhost2:masterport2 masterhost3:masterport3 [masterhostn:masterportn \u2026] slavehost1:slaveport1 slavehost2:slaveport2 slavehost3:slaveport3 -\u2013cluster-replicas n \u6ce8\u610f\uff1amaster\u4e0eslave\u7684\u6570\u91cf\u8981\u5339\u914d\uff0c\u4e00\u4e2amaster\u5bf9\u5e94n\u4e2aslave\uff0c\u7531\u6700\u540e\u7684\u53c2\u6570n\u51b3\u5b9a master\u4e0eslave\u7684\u5339\u914d\u987a\u5e8f\u4e3a\u7b2c\u4e00\u4e2amaster\u4e0e\u524dn\u4e2aslave\u5206\u4e3a\u4e00\u7ec4\uff0c\u5f62\u6210\u4e3b\u4ece\u7ed3\u6784 \u6dfb\u52a0master\u5230\u5f53\u524d\u96c6\u7fa4\u4e2d\uff0c\u8fde\u63a5\u65f6\u53ef\u4ee5\u6307\u5b9a\u4efb\u610f\u73b0\u6709\u8282\u70b9\u5730\u5740\u4e0e\u7aef\u53e3 redis-cli --cluster add-node new-master-host : new-master-port now-host:now-port \u6dfb\u52a0slave redis-cli --cluster add-node new-slave-host : new-slave-port master-host:master-port --cluster-slave --cluster-master-id masterid \u5220\u9664\u8282\u70b9\uff0c\u5982\u679c\u5220\u9664\u7684\u8282\u70b9\u662fmaster\uff0c\u5fc5\u987b\u4fdd\u969c\u5176\u4e2d\u6ca1\u6709\u69fdslot redis-cli --cluster del-node del-slave-host : del-slave-port del-slave-id \u91cd\u65b0\u5206\u69fd\uff0c\u5206\u69fd\u662f\u4ece\u5177\u6709\u69fd\u7684master\u4e2d\u5212\u5206\u4e00\u90e8\u5206\u7ed9\u5176\u4ed6master\uff0c\u8fc7\u7a0b\u4e2d\u4e0d\u521b\u5efa\u65b0\u7684\u69fd redis-cli --cluster reshard new-master-host : new-master:port --cluster-from src- master-id1, src-master-id2, src-master-idn --cluster-to target-master-id -- cluster-slots slots \u6ce8\u610f\uff1a\u5c06\u9700\u8981\u53c2\u4e0e\u5206\u69fd\u7684\u6240\u6709masterid\u4e0d\u5206\u5148\u540e\u987a\u5e8f\u6dfb\u52a0\u5230\u53c2\u6570\u4e2d\uff0c\u4f7f\u7528\uff0c\u5206\u9694 \u6307\u5b9a\u76ee\u6807\u5f97\u5230\u7684\u69fd\u7684\u6570\u91cf\uff0c\u6240\u6709\u7684\u69fd\u5c06\u5e73\u5747\u4ece\u6bcf\u4e2a\u6765\u6e90\u7684master\u5904\u83b7\u53d6 \u91cd\u65b0\u5206\u914d\u69fd\uff0c\u4ece\u5177\u6709\u69fd\u7684master\u4e2d\u5206\u914d\u6307\u5b9a\u6570\u91cf\u7684\u69fd\u5230\u53e6\u4e00\u4e2amaster\u4e2d\uff0c\u5e38\u7528\u4e8e\u6e05\u7a7a\u6307\u5b9amaster\u4e2d\u7684\u69fd redis-cli --cluster reshard src-master-host : src-master-port --cluster-from src- master-id --cluster-to target-master-id --cluster-slots slots --cluster-yes 5.\u4f01\u4e1a\u7ea7\u89e3\u51b3\u65b9\u6848 \u00b6 5.1 \u7f13\u5b58\u9884\u70ed \u00b6 \u573a\u666f \uff1a\u201c\u5b95\u673a\u201d \u670d\u52a1\u5668\u542f\u52a8\u540e\u8fc5\u901f\u5b95\u673a \u95ee\u9898\u6392\u67e5 \uff1a 1.\u8bf7\u6c42\u6570\u91cf\u8f83\u9ad8\uff0c\u5927\u91cf\u7684\u8bf7\u6c42\u8fc7\u6765\u4e4b\u540e\u90fd\u9700\u8981\u53bb\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u6570\u636e\uff0c\u4f46\u662f\u7f13\u5b58\u4e2d\u53c8\u6ca1\u6709\uff0c\u6b64\u65f6\u4ece\u6570\u636e\u5e93\u4e2d\u67e5\u627e\u6570\u636e\u7136\u540e\u5c06\u6570\u636e\u518d\u5b58\u5165\u7f13\u5b58\uff0c\u9020\u6210\u4e86\u77ed\u671f\u5185\u5bf9redis\u7684\u9ad8\u5f3a\u5ea6\u64cd\u4f5c\u4ece\u800c\u5bfc\u81f4\u95ee\u9898 2.\u4e3b\u4ece\u4e4b\u95f4\u6570\u636e\u541e\u5410\u91cf\u8f83\u5927\uff0c\u6570\u636e\u540c\u6b65\u64cd\u4f5c\u9891\u5ea6\u8f83\u9ad8 \u89e3\u51b3\u65b9\u6848\uff1a \u524d\u7f6e\u51c6\u5907\u5de5\u4f5c\uff1a 1.\u65e5\u5e38\u4f8b\u884c\u7edf\u8ba1\u6570\u636e\u8bbf\u95ee\u8bb0\u5f55\uff0c\u7edf\u8ba1\u8bbf\u95ee\u9891\u5ea6\u8f83\u9ad8\u7684\u70ed\u70b9\u6570\u636e 2.\u5229\u7528LRU\u6570\u636e\u5220\u9664\u7b56\u7565\uff0c\u6784\u5efa\u6570\u636e\u7559\u5b58\u961f\u5217\u4f8b\u5982\uff1astorm\u4e0ekafka\u914d\u5408 \u51c6\u5907\u5de5\u4f5c\uff1a 1.\u5c06\u7edf\u8ba1\u7ed3\u679c\u4e2d\u7684\u6570\u636e\u5206\u7c7b\uff0c\u6839\u636e\u7ea7\u522b\uff0credis\u4f18\u5148\u52a0\u8f7d\u7ea7\u522b\u8f83\u9ad8\u7684\u70ed\u70b9\u6570\u636e 2.\u5229\u7528\u5206\u5e03\u5f0f\u591a\u670d\u52a1\u5668\u540c\u65f6\u8fdb\u884c\u6570\u636e\u8bfb\u53d6\uff0c\u63d0\u901f\u6570\u636e\u52a0\u8f7d\u8fc7\u7a0b 3.\u70ed\u70b9\u6570\u636e\u4e3b\u4ece\u540c\u65f6\u9884\u70ed \u5b9e\u65bd\uff1a 4.\u4f7f\u7528\u811a\u672c\u7a0b\u5e8f\u56fa\u5b9a\u89e6\u53d1\u6570\u636e\u9884\u70ed\u8fc7\u7a0b 5.\u5982\u679c\u6761\u4ef6\u5141\u8bb8\uff0c\u4f7f\u7528\u4e86CDN\uff08\u5185\u5bb9\u5206\u53d1\u7f51\u7edc\uff09\uff0c\u6548\u679c\u4f1a\u66f4\u597d \u603b\u7684\u6765\u8bf4 \uff1a\u7f13\u5b58\u9884\u70ed\u5c31\u662f\u7cfb\u7edf\u542f\u52a8\u524d\uff0c\u63d0\u524d\u5c06\u76f8\u5173\u7684\u7f13\u5b58\u6570\u636e\u76f4\u63a5\u52a0\u8f7d\u5230\u7f13\u5b58\u7cfb\u7edf\u3002\u907f\u514d\u5728\u7528\u6237\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u5148\u67e5\u8be2\u6570\u636e\u5e93\uff0c\u7136\u540e\u518d\u5c06\u6570\u636e\u7f13\u5b58\u7684\u95ee\u9898\uff01\u7528\u6237\u76f4\u63a5\u67e5\u8be2\u4e8b\u5148\u88ab\u9884\u70ed\u7684\u7f13\u5b58\u6570\u636e\uff01 5.2 \u7f13\u5b58\u96ea\u5d29 \u00b6 \u573a\u666f \uff1a\u6570\u636e\u5e93\u670d\u52a1\u5668\u5d29\u6e83\uff0c\u4e00\u8fde\u4e32\u7684\u573a\u666f\u4f1a\u968f\u4e4b\u513f\u6765 1.\u7cfb\u7edf\u5e73\u7a33\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u5ffd\u7136\u6570\u636e\u5e93\u8fde\u63a5\u91cf\u6fc0\u589e 2.\u5e94\u7528\u670d\u52a1\u5668\u65e0\u6cd5\u53ca\u65f6\u5904\u7406\u8bf7\u6c42 3.\u5927\u91cf408\uff0c500\u9519\u8bef\u9875\u9762\u51fa\u73b0 4.\u5ba2\u6237\u53cd\u590d\u5237\u65b0\u9875\u9762\u83b7\u53d6\u6570\u636e 5.\u6570\u636e\u5e93\u5d29\u6e83 6.\u5e94\u7528\u670d\u52a1\u5668\u5d29\u6e83 7.\u91cd\u542f\u5e94\u7528\u670d\u52a1\u5668\u65e0\u6548 8.Redis\u670d\u52a1\u5668\u5d29\u6e83 9.Redis\u96c6\u7fa4\u5d29\u6e83 10.\u91cd\u542f\u6570\u636e\u5e93\u540e\u518d\u6b21\u88ab\u77ac\u95f4\u6d41\u91cf\u653e\u5012 \u95ee\u9898\u6392\u67e5 \uff1a 1.\u5728\u4e00\u4e2a\u8f83\u77ed\u7684\u65f6\u95f4\u5185\uff0c\u7f13\u5b58\u4e2d\u8f83\u591a\u7684key\u96c6\u4e2d\u8fc7\u671f 2.\u6b64\u5468\u671f\u5185\u8bf7\u6c42\u8bbf\u95ee\u8fc7\u671f\u7684\u6570\u636e\uff0credis\u672a\u547d\u4e2d\uff0credis\u5411\u6570\u636e\u5e93\u83b7\u53d6\u6570\u636e 3.\u6570\u636e\u5e93\u540c\u65f6\u63a5\u6536\u5230\u5927\u91cf\u7684\u8bf7\u6c42\u65e0\u6cd5\u53ca\u65f6\u5904\u7406 4.Redis\u5927\u91cf\u8bf7\u6c42\u88ab\u79ef\u538b\uff0c\u5f00\u59cb\u51fa\u73b0\u8d85\u65f6\u73b0\u8c61 5.\u6570\u636e\u5e93\u6d41\u91cf\u6fc0\u589e\uff0c\u6570\u636e\u5e93\u5d29\u6e83 6.\u91cd\u542f\u540e\u4ecd\u7136\u9762\u5bf9\u7f13\u5b58\u4e2d\u65e0\u6570\u636e\u53ef\u7528 7.Redis\u670d\u52a1\u5668\u8d44\u6e90\u88ab\u4e25\u91cd\u5360\u7528\uff0cRedis\u670d\u52a1\u5668\u5d29\u6e83 8.Redis\u96c6\u7fa4\u5448\u73b0\u5d29\u584c\uff0c\u96c6\u7fa4\u74e6\u89e3 9.\u5e94\u7528\u670d\u52a1\u5668\u65e0\u6cd5\u53ca\u65f6\u5f97\u5230\u6570\u636e\u54cd\u5e94\u8bf7\u6c42\uff0c\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u6570\u91cf\u8d8a\u6765\u8d8a\u591a\uff0c\u5e94\u7528\u670d\u52a1\u5668\u5d29\u6e83 10.\u5e94\u7528\u670d\u52a1\u5668\uff0credis\uff0c\u6570\u636e\u5e93\u5168\u90e8\u91cd\u542f\uff0c\u6548\u679c\u4e0d\u7406\u60f3 \u603b\u800c\u8a00\u4e4b\u5c31\u4e24\u70b9\uff1a\u77ed\u65f6\u95f4\u8303\u56f4\u5185\uff0c\u5927\u91cfkey\u96c6\u4e2d\u8fc7\u671f \u89e3\u51b3\u65b9\u6848 \u601d\u8def\uff1a 1.\u66f4\u591a\u7684\u9875\u9762\u9759\u6001\u5316\u5904\u7406 2.\u6784\u5efa\u591a\u7ea7\u7f13\u5b58\u67b6\u6784 Nginx\u7f13\u5b58+redis\u7f13\u5b58+ehcache\u7f13\u5b58 3.\u68c0\u6d4bMysql\u4e25\u91cd\u8017\u65f6\u4e1a\u52a1\u8fdb\u884c\u4f18\u5316 \u5bf9\u6570\u636e\u5e93\u7684\u74f6\u9888\u6392\u67e5\uff1a\u4f8b\u5982\u8d85\u65f6\u67e5\u8be2\u3001\u8017\u65f6\u8f83\u9ad8\u4e8b\u52a1\u7b49 4.\u707e\u96be\u9884\u8b66\u673a\u5236 \u76d1\u63a7redis\u670d\u52a1\u5668\u6027\u80fd\u6307\u6807 CPU\u5360\u7528\u3001CPU\u4f7f\u7528\u7387 \u5185\u5b58\u5bb9\u91cf \u67e5\u8be2\u5e73\u5747\u54cd\u5e94\u65f6\u95f4 \u7ebf\u7a0b\u6570 5.\u9650\u6d41\u3001\u964d\u7ea7 \u77ed\u65f6\u95f4\u8303\u56f4\u5185\u727a\u7272\u4e00\u4e9b\u5ba2\u6237\u4f53\u9a8c\uff0c\u9650\u5236\u4e00\u90e8\u5206\u8bf7\u6c42\u8bbf\u95ee\uff0c\u964d\u4f4e\u5e94\u7528\u670d\u52a1\u5668\u538b\u529b\uff0c\u5f85\u4e1a\u52a1\u4f4e\u901f\u8fd0\u8f6c\u540e\u518d\u9010\u6b65\u653e\u5f00\u8bbf\u95ee \u843d\u5730\u5b9e\u8df5\uff1a 1.LRU\u4e0eLFU\u5207\u6362 2.\u6570\u636e\u6709\u6548\u671f\u7b56\u7565\u8c03\u6574 \u6839\u636e\u4e1a\u52a1\u6570\u636e\u6709\u6548\u671f\u8fdb\u884c\u5206\u7c7b\u9519\u5cf0\uff0cA\u7c7b90\u5206\u949f\uff0cB\u7c7b80\u5206\u949f\uff0cC\u7c7b70\u5206\u949f \u8fc7\u671f\u65f6\u95f4\u4f7f\u7528\u56fa\u5b9a\u65f6\u95f4+\u968f\u673a\u503c\u7684\u5f62\u5f0f\uff0c\u7a00\u91ca\u96c6\u4e2d\u5230\u671f\u7684key\u7684\u6570\u91cf 3.\u8d85\u70ed\u6570\u636e\u4f7f\u7528\u6c38\u4e45key 4.\u5b9a\u671f\u7ef4\u62a4\uff08\u81ea\u52a8+\u4eba\u5de5\uff09 \u5bf9\u5373\u5c06\u8fc7\u671f\u6570\u636e\u505a\u8bbf\u95ee\u91cf\u5206\u6790\uff0c\u786e\u8ba4\u662f\u5426\u5ef6\u65f6\uff0c\u914d\u5408\u8bbf\u95ee\u91cf\u7edf\u8ba1\uff0c\u505a\u70ed\u70b9\u6570\u636e\u7684\u5ef6\u65f6 5.\u52a0\u9501\uff1a\u614e\u7528\uff01 \u603b\u7684\u6765\u8bf4 \uff1a\u7f13\u5b58\u96ea\u5d29\u5c31\u662f\u77ac\u95f4\u8fc7\u671f\u6570\u636e\u91cf\u592a\u5927\uff0c\u5bfc\u81f4\u5bf9\u6570\u636e\u5e93\u670d\u52a1\u5668\u9020\u6210\u538b\u529b\u3002\u5982\u80fd\u591f\u6709\u6548\u907f\u514d\u8fc7\u671f\u65f6\u95f4\u96c6\u4e2d\uff0c\u53ef\u4ee5\u6709\u6548\u89e3\u51b3\u96ea\u5d29\u73b0\u8c61\u7684 \u51fa\u73b0\uff08\u7ea640%\uff09\uff0c\u914d\u5408\u5176\u4ed6\u7b56\u7565\u4e00\u8d77\u4f7f\u7528\uff0c\u5e76\u76d1\u63a7\u670d\u52a1\u5668\u7684\u8fd0\u884c\u6570\u636e\uff0c\u6839\u636e\u8fd0\u884c\u8bb0\u5f55\u505a\u5feb\u901f\u8c03\u6574\u3002 5.3 \u7f13\u5b58\u51fb\u7a7f \u00b6 \u573a\u666f \uff1a\u8fd8\u662f\u6570\u636e\u5e93\u670d\u52a1\u5668\u5d29\u6e83\uff0c\u4f46\u662f\u8ddf\u4e4b\u524d\u7684\u573a\u666f\u6709\u70b9\u4e0d\u592a\u4e00\u6837 1.\u7cfb\u7edf\u5e73\u7a33\u8fd0\u884c\u8fc7\u7a0b\u4e2d 2.\u6570\u636e\u5e93\u8fde\u63a5\u91cf\u77ac\u95f4\u6fc0\u589e 3.Redis\u670d\u52a1\u5668\u65e0\u5927\u91cfkey\u8fc7\u671f 4.Redis\u5185\u5b58\u5e73\u7a33\uff0c\u65e0\u6ce2\u52a8 5.Redis\u670d\u52a1\u5668CPU\u6b63\u5e38 6.\u6570\u636e\u5e93\u5d29\u6e83 \u95ee\u9898\u6392\u67e5\uff1a 1.Redis\u4e2d\u67d0\u4e2akey\u8fc7\u671f\uff0c\u8be5key\u8bbf\u95ee\u91cf\u5de8\u5927 2.\u591a\u4e2a\u6570\u636e\u8bf7\u6c42\u4ece\u670d\u52a1\u5668\u76f4\u63a5\u538b\u5230Redis\u540e\uff0c\u5747\u672a\u547d\u4e2d 3.Redis\u5728\u77ed\u65f6\u95f4\u5185\u53d1\u8d77\u4e86\u5927\u91cf\u5bf9\u6570\u636e\u5e93\u4e2d\u540c\u4e00\u6570\u636e\u7684\u8bbf\u95ee \u603b\u800c\u8a00\u4e4b\u5c31\u4e24\u70b9\uff1a\u5355\u4e2akey\u9ad8\u70ed\u6570\u636e\uff0ckey\u8fc7\u671f \u89e3\u51b3\u65b9\u6848 \uff1a 1.\u9884\u5148\u8bbe\u5b9a \u4ee5\u7535\u5546\u4e3a\u4f8b\uff0c\u6bcf\u4e2a\u5546\u5bb6\u6839\u636e\u5e97\u94fa\u7b49\u7ea7\uff0c\u6307\u5b9a\u82e5\u5e72\u6b3e\u4e3b\u6253\u5546\u54c1\uff0c\u5728\u8d2d\u7269\u8282\u671f\u95f4\uff0c\u52a0\u5927\u6b64\u7c7b\u4fe1\u606fkey\u7684\u8fc7\u671f\u65f6\u957f \u6ce8\u610f\uff1a\u8d2d\u7269\u8282\u4e0d\u4ec5\u4ec5\u6307\u5f53\u5929\uff0c\u4ee5\u53ca\u540e\u7eed\u82e5\u5e72\u5929\uff0c\u8bbf\u95ee\u5cf0\u503c\u5448\u73b0\u9010\u6e10\u964d\u4f4e\u7684\u8d8b\u52bf 2.\u73b0\u573a\u8c03\u6574 \u76d1\u63a7\u8bbf\u95ee\u91cf\uff0c\u5bf9\u81ea\u7136\u6d41\u91cf\u6fc0\u589e\u7684\u6570\u636e\u5ef6\u957f\u8fc7\u671f\u65f6\u95f4\u6216\u8bbe\u7f6e\u4e3a\u6c38\u4e45\u6027key 3.\u540e\u53f0\u5237\u65b0\u6570\u636e \u542f\u52a8\u5b9a\u65f6\u4efb\u52a1\uff0c\u9ad8\u5cf0\u671f\u6765\u4e34\u4e4b\u524d\uff0c\u5237\u65b0\u6570\u636e\u6709\u6548\u671f\uff0c\u786e\u4fdd\u4e0d\u4e22\u5931 4.\u4e8c\u7ea7\u7f13\u5b58 \u8bbe\u7f6e\u4e0d\u540c\u7684\u5931\u6548\u65f6\u95f4\uff0c\u4fdd\u969c\u4e0d\u4f1a\u88ab\u540c\u65f6\u6dd8\u6c70\u5c31\u884c 5.\u52a0\u9501 \u5206\u5e03\u5f0f\u9501\uff0c\u9632\u6b62\u88ab\u51fb\u7a7f\uff0c\u4f46\u662f\u8981\u6ce8\u610f\u4e5f\u662f\u6027\u80fd\u74f6\u9888\uff0c\u614e\u91cd\uff01 \u603b\u7684\u6765\u8bf4 \uff1a\u7f13\u5b58\u51fb\u7a7f\u5c31\u662f\u5355\u4e2a\u9ad8\u70ed\u6570\u636e\u8fc7\u671f\u7684\u77ac\u95f4\uff0c\u6570\u636e\u8bbf\u95ee\u91cf\u8f83\u5927\uff0c\u672a\u547d\u4e2dredis\u540e\uff0c\u53d1\u8d77\u4e86\u5927\u91cf\u5bf9\u540c\u4e00\u6570\u636e\u7684\u6570\u636e\u5e93\u8bbf\u95ee\uff0c\u5bfc\u81f4\u5bf9\u6570 \u636e\u5e93\u670d\u52a1\u5668\u9020\u6210\u538b\u529b\u3002\u5e94\u5bf9\u7b56\u7565\u5e94\u8be5\u5728\u4e1a\u52a1\u6570\u636e\u5206\u6790\u4e0e\u9884\u9632\u65b9\u9762\u8fdb\u884c\uff0c\u914d\u5408\u8fd0\u884c\u76d1\u63a7\u6d4b\u8bd5\u4e0e\u5373\u65f6\u8c03\u6574\u7b56\u7565\uff0c\u6bd5\u7adf\u5355\u4e2akey\u7684\u8fc7 \u671f\u76d1\u63a7\u96be\u5ea6\u8f83\u9ad8\uff0c\u914d\u5408\u96ea\u5d29\u5904\u7406\u7b56\u7565\u5373\u53ef\u3002 5.4 \u7f13\u5b58\u7a7f\u900f \u00b6 \u573a\u666f \uff1a\u6570\u636e\u5e93\u670d\u52a1\u5668\u53c8\u5d29\u6e83\u4e86\uff0c\u8ddf\u4e4b\u524d\u7684\u4e00\u6837\u5417\uff1f 1.\u7cfb\u7edf\u5e73\u7a33\u8fd0\u884c\u8fc7\u7a0b\u4e2d 2.\u5e94\u7528\u670d\u52a1\u5668\u6d41\u91cf\u968f\u65f6\u95f4\u589e\u91cf\u8f83\u5927 3.Redis\u670d\u52a1\u5668\u547d\u4e2d\u7387\u968f\u65f6\u95f4\u9010\u6b65\u964d\u4f4e 4.Redis\u5185\u5b58\u5e73\u7a33\uff0c\u5185\u5b58\u65e0\u538b\u529b 5.Redis\u670d\u52a1\u5668CPU\u5360\u7528\u6fc0\u589e 6.\u6570\u636e\u5e93\u670d\u52a1\u5668\u538b\u529b\u6fc0\u589e 7.\u6570\u636e\u5e93\u5d29\u6e83 \u95ee\u9898\u6392\u67e5\uff1a 1.Redis\u4e2d\u5927\u9762\u79ef\u51fa\u73b0\u672a\u547d\u4e2d 2.\u51fa\u73b0\u975e\u6b63\u5e38URL\u8bbf\u95ee \u95ee\u9898\u5206\u6790 \uff1a \u83b7\u53d6\u7684\u6570\u636e\u5728\u6570\u636e\u5e93\u4e2d\u4e5f\u4e0d\u5b58\u5728\uff0c\u6570\u636e\u5e93\u67e5\u8be2\u672a\u5f97\u5230\u5bf9\u5e94\u6570\u636e Redis\u83b7\u53d6\u5230null\u6570\u636e\u672a\u8fdb\u884c\u6301\u4e45\u5316\uff0c\u76f4\u63a5\u8fd4\u56de \u4e0b\u6b21\u6b64\u7c7b\u6570\u636e\u5230\u8fbe\u91cd\u590d\u4e0a\u8ff0\u8fc7\u7a0b \u51fa\u73b0\u9ed1\u5ba2\u653b\u51fb\u670d\u52a1\u5668 \u89e3\u51b3\u65b9\u6848 \uff1a 1.\u7f13\u5b58null \u5bf9\u67e5\u8be2\u7ed3\u679c\u4e3anull\u7684\u6570\u636e\u8fdb\u884c\u7f13\u5b58\uff08\u957f\u671f\u4f7f\u7528\uff0c\u5b9a\u671f\u6e05\u7406\uff09\uff0c\u8bbe\u5b9a\u77ed\u65f6\u9650\uff0c\u4f8b\u598230-60\u79d2\uff0c\u6700\u9ad85\u5206\u949f 2.\u767d\u540d\u5355\u7b56\u7565 \u63d0\u524d\u9884\u70ed\u5404\u79cd\u5206\u7c7b\u6570\u636eid\u5bf9\u5e94\u7684bitmaps\uff0cid\u4f5c\u4e3abitmaps\u7684offset\uff0c\u76f8\u5f53\u4e8e\u8bbe\u7f6e\u4e86\u6570\u636e\u767d\u540d\u5355\u3002\u5f53\u52a0\u8f7d\u6b63\u5e38\u6570\u636e\u65f6\u653e\u884c\uff0c\u52a0\u8f7d\u5f02\u5e38\u6570\u636e\u65f6\u76f4\u63a5\u62e6\u622a\uff08\u6548\u7387\u504f\u4f4e\uff09 \u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\uff08\u6709\u5173\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u547d\u4e2d\u95ee\u9898\u5bf9\u5f53\u524d\u72b6\u51b5\u53ef\u4ee5\u5ffd\u7565\uff09 2.\u5b9e\u65bd\u76d1\u63a7 \u5b9e\u65f6\u76d1\u63a7redis\u547d\u4e2d\u7387\uff08\u4e1a\u52a1\u6b63\u5e38\u8303\u56f4\u65f6\uff0c\u901a\u5e38\u4f1a\u6709\u4e00\u4e2a\u6ce2\u52a8\u503c\uff09\u4e0enull\u6570\u636e\u7684\u5360\u6bd4 \u975e\u6d3b\u52a8\u65f6\u6bb5\u6ce2\u52a8\uff1a\u901a\u5e38\u68c0\u6d4b3-5\u500d\uff0c\u8d85\u8fc75\u500d\u7eb3\u5165\u91cd\u70b9\u6392\u67e5\u5bf9\u8c61 \u6d3b\u52a8\u65f6\u6bb5\u6ce2\u52a8\uff1a\u901a\u5e38\u68c0\u6d4b10-50\u500d\uff0c\u8d85\u8fc750\u500d\u7eb3\u5165\u91cd\u70b9\u6392\u67e5\u5bf9\u8c61 \u6839\u636e\u500d\u6570\u4e0d\u540c\uff0c\u542f\u52a8\u4e0d\u540c\u7684\u6392\u67e5\u6d41\u7a0b\u3002\u7136\u540e\u4f7f\u7528\u9ed1\u540d\u5355\u8fdb\u884c\u9632\u63a7\uff08\u8fd0\u8425\uff09 4.key\u52a0\u5bc6 \u95ee\u9898\u51fa\u73b0\u540e\uff0c\u4e34\u65f6\u542f\u52a8\u9632\u707e\u4e1a\u52a1key\uff0c\u5bf9key\u8fdb\u884c\u4e1a\u52a1\u5c42\u4f20\u8f93\u52a0\u5bc6\u670d\u52a1\uff0c\u8bbe\u5b9a\u6821\u9a8c\u7a0b\u5e8f\uff0c\u8fc7\u6765\u7684key\u6821\u9a8c \u4f8b\u5982\u6bcf\u5929\u968f\u673a\u5206\u914d60\u4e2a\u52a0\u5bc6\u4e32\uff0c\u6311\u90092\u52303\u4e2a\uff0c\u6df7\u6dc6\u5230\u9875\u9762\u6570\u636eid\u4e2d\uff0c\u53d1\u73b0\u8bbf\u95eekey\u4e0d\u6ee1\u8db3\u89c4\u5219\uff0c\u9a73\u56de\u6570\u636e\u8bbf\u95ee \u603b\u7684\u6765\u8bf4 \uff1a\u7f13\u5b58\u51fb\u7a7f\u662f\u6307\u8bbf\u95ee\u4e86\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u8df3\u8fc7\u4e86\u5408\u6cd5\u6570\u636e\u7684redis\u6570\u636e\u7f13\u5b58\u9636\u6bb5\uff0c\u6bcf\u6b21\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u5bfc\u81f4\u5bf9\u6570\u636e\u5e93\u670d\u52a1\u5668\u9020\u6210\u538b\u529b\u3002\u901a\u5e38\u6b64\u7c7b\u6570\u636e\u7684\u51fa\u73b0\u91cf\u662f\u4e00\u4e2a\u8f83\u4f4e\u7684\u503c\uff0c\u5f53\u51fa\u73b0\u6b64\u7c7b\u60c5\u51b5\u4ee5\u6bd2\u653b\u6bd2\uff0c\u5e76\u53ca\u65f6\u62a5\u8b66\u3002\u5e94\u5bf9\u7b56\u7565\u5e94\u8be5\u5728\u4e34\u65f6\u9884\u6848\u9632\u8303\u65b9\u9762\u591a\u505a\u6587\u7ae0\u3002 \u65e0\u8bba\u662f\u9ed1\u540d\u5355\u8fd8\u662f\u767d\u540d\u5355\uff0c\u90fd\u662f\u5bf9\u6574\u4f53\u7cfb\u7edf\u7684\u538b\u529b\uff0c\u8b66\u62a5\u89e3\u9664\u540e\u5c3d\u5feb\u79fb\u9664\u3002 5.5 \u6027\u80fd\u6307\u6807\u76d1\u63a7 \u00b6 redis\u4e2d\u7684\u76d1\u63a7\u6307\u6807\u5982\u4e0b\uff1a \u6027\u80fd\u6307\u6807\uff1aPerformance \u54cd\u5e94\u8bf7\u6c42\u7684\u5e73\u5747\u65f6\u95f4: properties latency \u5e73\u5747\u6bcf\u79d2\u5904\u7406\u8bf7\u6c42\u603b\u6570 properties instantaneous_ops_per_sec \u7f13\u5b58\u67e5\u8be2\u547d\u4e2d\u7387\uff08\u901a\u8fc7\u67e5\u8be2\u603b\u6b21\u6570\u4e0e\u67e5\u8be2\u5f97\u5230\u975enil\u6570\u636e\u603b\u6b21\u6570\u8ba1\u7b97\u800c\u6765\uff09 ```properties hit_rate(calculated) ``` \u5185\u5b58\u6307\u6807\uff1aMemory \u5f53\u524d\u5185\u5b58\u4f7f\u7528\u91cf properties used_memory \u5185\u5b58\u788e\u7247\u7387\uff08\u5173\u7cfb\u5230\u662f\u5426\u8fdb\u884c\u788e\u7247\u6574\u7406\uff09 properties mem_fragmentation_ratio \u4e3a\u907f\u514d\u5185\u5b58\u6ea2\u51fa\u5220\u9664\u7684key\u7684\u603b\u6570\u91cf properties evicted_keys \u57fa\u4e8e\u963b\u585e\u64cd\u4f5c\uff08BLPOP\u7b49\uff09\u5f71\u54cd\u7684\u5ba2\u6237\u7aef\u6570\u91cf properties blocked_clients \u57fa\u672c\u6d3b\u52a8\u6307\u6807\uff1aBasic_activity \u5f53\u524d\u5ba2\u6237\u7aef\u8fde\u63a5\u603b\u6570 properties connected_clients \u5f53\u524d\u8fde\u63a5slave\u603b\u6570 properties connected_slaves \u6700\u540e\u4e00\u6b21\u4e3b\u4ece\u4fe1\u606f\u4ea4\u6362\u8ddd\u73b0\u5728\u7684\u79d2 properties master_last_io_seconds_ago key\u7684\u603b\u6570 properties keyspace \u6301\u4e45\u6027\u6307\u6807\uff1aPersistence \u5f53\u524d\u670d\u52a1\u5668\u6700\u540e\u4e00\u6b21RDB\u6301\u4e45\u5316\u7684\u65f6\u95f4 properties rdb_last_save_time \u5f53\u524d\u670d\u52a1\u5668\u6700\u540e\u4e00\u6b21RDB\u6301\u4e45\u5316\u540e\u6570\u636e\u53d8\u5316\u603b\u91cf properties rdb_changes_since_last_save \u9519\u8bef\u6307\u6807\uff1aError \u88ab\u62d2\u7edd\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u603b\u6570\uff08\u57fa\u4e8e\u8fbe\u5230\u6700\u5927\u8fde\u63a5\u503c\u7684\u56e0\u7d20\uff09 properties rejected_connections key\u672a\u547d\u4e2d\u7684\u603b\u6b21\u6570 properties keyspace_misses \u4e3b\u4ece\u65ad\u5f00\u7684\u79d2\u6570 properties master_link_down_since_seconds \u8981\u5bf9redis\u7684\u76f8\u5173\u6307\u6807\u8fdb\u884c\u76d1\u63a7\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u4e00\u4e9b\u7528\u5177\uff1a CloudInsight Redis Prometheus Redis-stat Redis-faina RedisLive zabbix \u4e5f\u6709\u4e00\u4e9b\u547d\u4ee4\u5de5\u5177\uff1a benchmark \u6d4b\u8bd5\u5f53\u524d\u670d\u52a1\u5668\u7684\u5e76\u53d1\u6027\u80fd properties redis-benchmark [-h ] [-p ] [-c ] [-n <requests]> [-k ] \u8303\u4f8b1\uff1a50\u4e2a\u8fde\u63a5\uff0c10000\u6b21\u8bf7\u6c42\u5bf9\u5e94\u7684\u6027\u80fd properties redis-benchmark \u8303\u4f8b2\uff1a100\u4e2a\u8fde\u63a5\uff0c5000\u6b21\u8bf7\u6c42\u5bf9\u5e94\u7684\u6027\u80fd properties redis-benchmark -c 100 -n 5000 redis-cli monitor\uff1a\u542f\u52a8\u670d\u52a1\u5668\u8c03\u8bd5\u4fe1\u606f properties monitor slowlog\uff1a\u6162\u65e5\u5fd7 \u83b7\u53d6\u6162\u67e5\u8be2\u65e5\u5fd7 properties slowlog [operator] get \uff1a\u83b7\u53d6\u6162\u67e5\u8be2\u65e5\u5fd7\u4fe1\u606f len \uff1a\u83b7\u53d6\u6162\u67e5\u8be2\u65e5\u5fd7\u6761\u76ee\u6570 reset \uff1a\u91cd\u7f6e\u6162\u67e5\u8be2\u65e5\u5fd7 \u76f8\u5173\u914d\u7f6e properties slowlog-log-slower-than 1000 #\u8bbe\u7f6e\u6162\u67e5\u8be2\u7684\u65f6\u95f4\u4e0b\u7ebf\uff0c\u5355\u4f4d\uff1a\u5fae\u5999 slowlog-max-len 100 #\u8bbe\u7f6e\u6162\u67e5\u8be2\u547d\u4ee4\u5bf9\u5e94\u7684\u65e5\u5fd7\u663e\u793a\u957f\u5ea6\uff0c\u5355\u4f4d\uff1a\u547d\u4ee4\u6570","title":"day02"},{"location":"redis/day02/#_1","text":"\u76ee\u68071\uff1a\u80fd\u591f\u8bf4\u51faredis\u4e2d\u7684\u6570\u636e\u5220\u9664\u7b56\u4e0e\u7565\u6dd8\u6c70\u7b56\u7565 \u76ee\u68072\uff1a\u80fd\u591f\u8bf4\u51fa\u4e3b\u4ece\u590d\u5236\u7684\u6982\u5ff5\uff0c\u5de5\u4f5c\u6d41\u7a0b\u4ee5\u53ca\u573a\u666f\u95ee\u9898\u53ca\u89e3\u51b3\u65b9\u6848 \u76ee\u68073\uff1a\u80fd\u591f\u8bf4\u51fa\u54e8\u5175\u7684\u4f5c\u7528\u4ee5\u53ca\u5de5\u4f5c\u539f\u7406\uff0c\u4ee5\u53ca\u5982\u4f55\u542f\u7528\u54e8\u5175 \u76ee\u68074\uff1a\u80fd\u591f\u8bf4\u51fa\u96c6\u7fa4\u7684\u67b6\u6784\u8bbe\u8ba1\uff0c\u5b8c\u6210\u96c6\u7fa4\u7684\u642d\u5efa \u76ee\u68075\uff1a\u80fd\u591f\u8bf4\u51fa\u7f13\u5b58\u9884\u70ed\uff0c\u96ea\u5d29\uff0c\u51fb\u7a7f\uff0c\u7a7f\u900f\u7684\u6982\u5ff5\uff0c\u80fd\u8bf4\u51faredis\u7684\u76f8\u5173\u76d1\u63a7\u6307\u6807","title":"\u5b66\u4e60\u76ee\u6807"},{"location":"redis/day02/#1","text":"","title":"1.\u6570\u636e\u5220\u9664\u4e0e\u6dd8\u6c70\u7b56\u7565"},{"location":"redis/day02/#11","text":"","title":"1.1 \u8fc7\u671f\u6570\u636e"},{"location":"redis/day02/#111_redis","text":"Redis\u662f\u4e00\u79cd\u5185\u5b58\u7ea7\u6570\u636e\u5e93\uff0c\u6240\u6709\u6570\u636e\u5747\u5b58\u653e\u5728\u5185\u5b58\u4e2d\uff0c\u5185\u5b58\u4e2d\u7684\u6570\u636e\u53ef\u4ee5\u901a\u8fc7TTL\u6307\u4ee4\u83b7\u53d6\u5176\u72b6\u6001 TTL\u8fd4\u56de\u7684\u503c\u6709\u4e09\u79cd\u60c5\u51b5\uff1a\u6b63\u6570\uff0c-1\uff0c-2 \u6b63\u6570 \uff1a\u4ee3\u8868\u8be5\u6570\u636e\u5728\u5185\u5b58\u4e2d\u8fd8\u80fd\u5b58\u6d3b\u7684\u65f6\u95f4 -1 \uff1a\u6c38\u4e45\u6709\u6548\u7684\u6570\u636e 2 \uff1a\u5df2\u7ecf\u8fc7\u671f\u7684\u6570\u636e \u6216\u88ab\u5220\u9664\u7684\u6570\u636e \u6216 \u672a\u5b9a\u4e49\u7684\u6570\u636e \u5220\u9664\u7b56\u7565\u5c31\u662f\u9488\u5bf9\u5df2\u8fc7\u671f\u6570\u636e\u7684\u5904\u7406\u7b56\u7565 \uff0c\u5df2\u8fc7\u671f\u7684\u6570\u636e\u662f\u771f\u7684\u5c31\u7acb\u5373\u5220\u9664\u4e86\u5417\uff1f\u5176\u5b9e\u4e5f\u4e0d\u662f\uff0c\u6211\u4eec\u4f1a\u6709\u591a\u79cd\u5220\u9664\u7b56\u7565\uff0c\u662f\u5206\u60c5\u51b5\u7684\uff0c\u5728\u4e0d\u540c\u7684\u573a\u666f\u4e0b\u4f7f\u7528\u4e0d\u540c\u7684\u5220\u9664\u65b9\u5f0f\u4f1a\u6709\u4e0d\u540c\u6548\u679c\uff0c\u8fd9\u4e5f\u6b63\u662f\u6211\u4eec\u8981\u5c06\u7684\u6570\u636e\u7684\u5220\u9664\u7b56\u7565\u7684\u95ee\u9898","title":"1.1.1 Redis\u4e2d\u7684\u6570\u636e\u7279\u5f81"},{"location":"redis/day02/#112","text":"\u5728Redis\u4e2d\uff0c\u5982\u4f55\u7ed9\u6570\u636e\u8bbe\u7f6e\u5b83\u7684\u5931\u6548\u5468\u671f\u5462\uff1f\u6570\u636e\u7684\u65f6\u6548\u5728redis\u4e2d\u5982\u4f55\u5b58\u50a8\u5462\uff1f \u8fc7\u671f\u6570\u636e\u662f\u4e00\u5757\u72ec\u7acb\u7684\u5b58\u50a8\u7a7a\u95f4\uff0cHash\u7ed3\u6784\uff0cfield\u662f\u5185\u5b58\u5730\u5740\uff0cvalue\u662f\u8fc7\u671f\u65f6\u95f4\uff0c\u4fdd\u5b58\u4e86\u6240\u6709key\u7684\u8fc7\u671f\u63cf\u8ff0\uff0c\u5728\u6700\u7ec8\u8fdb\u884c\u8fc7\u671f\u5904\u7406\u7684\u65f6\u5019\uff0c\u5bf9\u8be5\u7a7a\u95f4\u7684\u6570\u636e\u8fdb\u884c\u68c0\u6d4b\uff0c \u5f53\u65f6\u95f4\u5230\u671f\u4e4b\u540e\u901a\u8fc7field\u627e\u5230\u5185\u5b58\u8be5\u5730\u5740\u5904\u7684\u6570\u636e\uff0c\u7136\u540e\u8fdb\u884c\u76f8\u5173\u64cd\u4f5c\u3002","title":"1.1.2 \u65f6\u6548\u6027\u6570\u636e\u7684\u5b58\u50a8\u7ed3\u6784"},{"location":"redis/day02/#12","text":"","title":"1.2 \u6570\u636e\u5220\u9664\u7b56\u7565"},{"location":"redis/day02/#121","text":"\u5728\u5185\u5b58\u5360\u7528\u4e0eCPU\u5360\u7528\u4e4b\u95f4\u5bfb\u627e\u4e00\u79cd\u5e73\u8861\uff0c\u987e\u6b64\u5931\u5f7c\u90fd\u4f1a\u9020\u6210\u6574\u4f53redis\u6027\u80fd\u7684\u4e0b\u964d\uff0c\u751a\u81f3\u5f15\u53d1\u670d\u52a1\u5668\u5b95\u673a\u6216 \u5185\u5b58\u6cc4\u9732 \u9488\u5bf9\u8fc7\u671f\u6570\u636e\u8981\u8fdb\u884c\u5220\u9664\u7684\u65f6\u5019\u90fd\u6709\u54ea\u4e9b\u5220\u9664\u7b56\u7565\u5462\uff1f 1.\u5b9a\u65f6\u5220\u9664 2.\u60f0\u6027\u5220\u9664 3.\u5b9a\u671f\u5220\u9664","title":"1.2.1 \u6570\u636e\u5220\u9664\u7b56\u7565\u7684\u76ee\u6807"},{"location":"redis/day02/#122","text":"\u521b\u5efa\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u5f53key\u8bbe\u7f6e\u6709\u8fc7\u671f\u65f6\u95f4\uff0c\u4e14\u8fc7\u671f\u65f6\u95f4\u5230\u8fbe\u65f6\uff0c\u7531\u5b9a\u65f6\u5668\u4efb\u52a1\u7acb\u5373\u6267\u884c\u5bf9\u952e\u7684\u5220\u9664\u64cd\u4f5c \u4f18\u70b9 \uff1a\u8282\u7ea6\u5185\u5b58\uff0c\u5230\u65f6\u5c31\u5220\u9664\uff0c\u5feb\u901f\u91ca\u653e\u6389\u4e0d\u5fc5\u8981\u7684\u5185\u5b58\u5360\u7528 \u7f3a\u70b9 \uff1aCPU\u538b\u529b\u5f88\u5927\uff0c\u65e0\u8bbaCPU\u6b64\u65f6\u8d1f\u8f7d\u91cf\u591a\u9ad8\uff0c\u5747\u5360\u7528CPU\uff0c\u4f1a\u5f71\u54cdredis\u670d\u52a1\u5668\u54cd\u5e94\u65f6\u95f4\u548c\u6307\u4ee4\u541e\u5410\u91cf \u603b\u7ed3 \uff1a\u7528\u5904\u7406\u5668\u6027\u80fd\u6362\u53d6\u5b58\u50a8\u7a7a\u95f4\uff08\u62ff\u65f6\u95f4\u6362\u7a7a\u95f4\uff09","title":"1.2.2 \u5b9a\u65f6\u5220\u9664"},{"location":"redis/day02/#123","text":"\u6570\u636e\u5230\u8fbe\u8fc7\u671f\u65f6\u95f4\uff0c\u4e0d\u505a\u5904\u7406\u3002\u7b49\u4e0b\u6b21\u8bbf\u95ee\u8be5\u6570\u636e\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5224\u65ad \u5982\u679c\u672a\u8fc7\u671f\uff0c\u8fd4\u56de\u6570\u636e \u53d1\u73b0\u5df2\u8fc7\u671f\uff0c\u5220\u9664\uff0c\u8fd4\u56de\u4e0d\u5b58\u5728 \u4f18\u70b9 \uff1a\u8282\u7ea6CPU\u6027\u80fd\uff0c\u53d1\u73b0\u5fc5\u987b\u5220\u9664\u7684\u65f6\u5019\u624d\u5220\u9664 \u7f3a\u70b9 \uff1a\u5185\u5b58\u538b\u529b\u5f88\u5927\uff0c\u51fa\u73b0\u957f\u671f\u5360\u7528\u5185\u5b58\u7684\u6570\u636e \u603b\u7ed3 \uff1a\u7528\u5b58\u50a8\u7a7a\u95f4\u6362\u53d6\u5904\u7406\u5668\u6027\u80fd\uff08\u62ff\u65f6\u95f4\u6362\u7a7a\u95f4\uff09","title":"1.2.3 \u60f0\u6027\u5220\u9664"},{"location":"redis/day02/#124","text":"\u5b9a\u65f6\u5220\u9664\u548c\u60f0\u6027\u5220\u9664\u8fd9\u4e24\u79cd\u65b9\u6848\u90fd\u662f\u8d70\u7684\u6781\u7aef\uff0c\u90a3\u6709\u6ca1\u6709\u6298\u4e2d\u65b9\u6848\uff1f \u6211\u4eec\u6765\u8bb2redis\u7684\u5b9a\u671f\u5220\u9664\u65b9\u6848\uff1a Redis\u542f\u52a8\u670d\u52a1\u5668\u521d\u59cb\u5316\u65f6\uff0c\u8bfb\u53d6\u914d\u7f6eserver.hz\u7684\u503c\uff0c\u9ed8\u8ba4\u4e3a10 \u6bcf\u79d2\u949f\u6267\u884cserver.hz\u6b21 serverCron() --------> databasesCron() ---------> activeExpireCycle() activeExpireCycle() \u5bf9\u6bcf\u4e2aexpires[*]\u9010\u4e00\u8fdb\u884c\u68c0\u6d4b\uff0c\u6bcf\u6b21\u6267\u884c\u8017\u65f6\uff1a250ms/server.hz \u5bf9\u67d0\u4e2aexpires[*]\u68c0\u6d4b\u65f6\uff0c\u968f\u673a\u6311\u9009W\u4e2akey\u68c0\u6d4b \u5982\u679ckey\u8d85\u65f6\uff0c\u5220\u9664key \u5982\u679c\u4e00\u8f6e\u4e2d\u5220\u9664\u7684key\u7684\u6570\u91cf>W*25%\uff0c\u5faa\u73af\u8be5\u8fc7\u7a0b \u5982\u679c\u4e00\u8f6e\u4e2d\u5220\u9664\u7684key\u7684\u6570\u91cf\u2264W*25%\uff0c\u68c0\u67e5\u4e0b\u4e00\u4e2aexpires[*]\uff0c0-15\u5faa\u73af W\u53d6\u503c=ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP\u5c5e\u6027\u503c \u53c2\u6570current_db\u7528\u4e8e\u8bb0\u5f55 activeExpireCycle() \u8fdb\u5165\u54ea\u4e2aexpires[*] \u6267\u884c \u5982\u679cactiveExpireCycle()\u6267\u884c\u65f6\u95f4\u5230\u671f\uff0c\u4e0b\u6b21\u4ececurrent_db\u7ee7\u7eed\u5411\u4e0b\u6267\u884c \u603b\u7684\u6765\u8bf4\uff1a\u5b9a\u671f\u5220\u9664\u5c31\u662f\u5468\u671f\u6027\u8f6e\u8be2redis\u5e93\u4e2d\u7684\u65f6\u6548\u6027\u6570\u636e\uff0c\u91c7\u7528\u968f\u673a\u62bd\u53d6\u7684\u7b56\u7565\uff0c\u5229\u7528\u8fc7\u671f\u6570\u636e\u5360\u6bd4\u7684\u65b9\u5f0f\u63a7\u5236\u5220\u9664\u9891\u5ea6 \u7279\u70b91 \uff1aCPU\u6027\u80fd\u5360\u7528\u8bbe\u7f6e\u6709\u5cf0\u503c\uff0c\u68c0\u6d4b\u9891\u5ea6\u53ef\u81ea\u5b9a\u4e49\u8bbe\u7f6e \u7279\u70b92 \uff1a\u5185\u5b58\u538b\u529b\u4e0d\u662f\u5f88\u5927\uff0c\u957f\u671f\u5360\u7528\u5185\u5b58\u7684\u51b7\u6570\u636e\u4f1a\u88ab\u6301\u7eed\u6e05\u7406 \u603b\u7ed3 \uff1a\u5468\u671f\u6027\u62bd\u67e5\u5b58\u50a8\u7a7a\u95f4\uff08\u968f\u673a\u62bd\u67e5\uff0c\u91cd\u70b9\u62bd\u67e5\uff09","title":"1.2.4 \u5b9a\u671f\u5220\u9664"},{"location":"redis/day02/#125","text":"1\uff1a\u5b9a\u65f6\u5220\u9664\uff1a \u8282\u7ea6\u5185\u5b58\uff0c\u65e0\u5360\u7528, \u4e0d\u5206\u65f6\u6bb5\u5360\u7528CPU\u8d44\u6e90\uff0c\u9891\u5ea6\u9ad8, \u62ff\u65f6\u95f4\u6362\u7a7a\u95f4 2\uff1a\u60f0\u6027\u5220\u9664\uff1a \u5185\u5b58\u5360\u7528\u4e25\u91cd \u5ef6\u65f6\u6267\u884c\uff0cCPU\u5229\u7528\u7387\u9ad8 \u62ff\u7a7a\u95f4\u6362\u65f6\u95f4 3\uff1a\u5b9a\u671f\u5220\u9664\uff1a \u5185\u5b58\u5b9a\u671f\u968f\u673a\u6e05\u7406 \u6bcf\u79d2\u82b1\u8d39\u56fa\u5b9a\u7684CPU\u8d44\u6e90\u7ef4\u62a4\u5185\u5b58 \u968f\u673a\u62bd\u67e5\uff0c\u91cd\u70b9\u62bd\u67e5","title":"1.2.5 \u5220\u9664\u7b56\u7565\u5bf9\u6bd4"},{"location":"redis/day02/#13","text":"","title":"1.3 \u6570\u636e\u6dd8\u6c70\u7b56\u7565\uff08\u9010\u51fa\u7b97\u6cd5\uff09"},{"location":"redis/day02/#131","text":"\u4ec0\u4e48\u53eb\u6570\u636e\u6dd8\u6c70\u7b56\u7565\uff1f\u4ec0\u4e48\u6837\u7684\u5e94\u7528\u573a\u666f\u9700\u8981\u7528\u5230\u6570\u636e\u6dd8\u6c70\u7b56\u7565\uff1f \u5f53\u65b0\u6570\u636e\u8fdb\u5165redis\u65f6\uff0c\u5982\u679c\u5185\u5b58\u4e0d\u8db3\u600e\u4e48\u529e\uff1f\u5728\u6267\u884c\u6bcf\u4e00\u4e2a\u547d\u4ee4\u524d\uff0c\u4f1a\u8c03\u7528 freeMemoryIfNeeded() \u68c0\u6d4b\u5185\u5b58\u662f\u5426\u5145\u8db3\u3002\u5982\u679c\u5185\u5b58\u4e0d\u6ee1\u8db3\u65b0 \u52a0\u5165\u6570\u636e\u7684\u6700\u4f4e\u5b58\u50a8\u8981\u6c42\uff0credis\u8981\u4e34\u65f6\u5220\u9664\u4e00\u4e9b\u6570\u636e\u4e3a\u5f53\u524d\u6307\u4ee4\u6e05\u7406\u5b58\u50a8\u7a7a\u95f4\u3002\u6e05\u7406\u6570\u636e\u7684\u7b56\u7565\u79f0\u4e3a\u9010\u51fa\u7b97\u6cd5\u3002 \u6ce8\u610f\uff1a\u9010\u51fa\u6570\u636e\u7684\u8fc7\u7a0b\u4e0d\u662f100%\u80fd\u591f\u6e05\u7406\u51fa\u8db3\u591f\u7684\u53ef\u4f7f\u7528\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5982\u679c\u4e0d\u6210\u529f\u5219\u53cd\u590d\u6267\u884c\u3002\u5f53\u5bf9\u6240\u6709\u6570\u636e\u5c1d\u8bd5\u5b8c\u6bd5\uff0c \u5982\u4e0d\u80fd\u8fbe\u5230\u5185\u5b58\u6e05\u7406\u7684\u8981\u6c42\uff0c\u5c06\u51fa\u73b0\u9519\u8bef\u4fe1\u606f\u5982\u4e0b ( error ) OOM command not allowed when used memory > 'maxmemory'","title":"1.3.1 \u6dd8\u6c70\u7b56\u7565\u6982\u8ff0"},{"location":"redis/day02/#132","text":"\u5f71\u54cd\u6570\u636e\u6dd8\u6c70\u7684\u76f8\u5173\u914d\u7f6e\u5982\u4e0b\uff1a 1\uff1a\u6700\u5927\u53ef\u4f7f\u7528\u5185\u5b58\uff0c\u5373\u5360\u7528\u7269\u7406\u5185\u5b58\u7684\u6bd4\u4f8b\uff0c\u9ed8\u8ba4\u503c\u4e3a0\uff0c\u8868\u793a\u4e0d\u9650\u5236\u3002\u751f\u4ea7\u73af\u5883\u4e2d\u6839\u636e\u9700\u6c42\u8bbe\u5b9a\uff0c\u901a\u5e38\u8bbe\u7f6e\u572850%\u4ee5\u4e0a maxmemory ?mb 2\uff1a\u6bcf\u6b21\u9009\u53d6\u5f85\u5220\u9664\u6570\u636e\u7684\u4e2a\u6570\uff0c\u91c7\u7528\u968f\u673a\u83b7\u53d6\u6570\u636e\u7684\u65b9\u5f0f\u4f5c\u4e3a\u5f85\u68c0\u6d4b\u5220\u9664\u6570\u636e maxmemory-samples count 3\uff1a\u5bf9\u6570\u636e\u8fdb\u884c\u5220\u9664\u7684\u9009\u62e9\u7b56\u7565 maxmemory-policy policy \u90a3\u6570\u636e\u5220\u9664\u7684\u7b56\u7565policy\u5230\u5e95\u6709\u51e0\u79cd\u5462\uff1f\u4e00\u5171\u662f 3\u7c7b8\u79cd \u7b2c\u4e00\u7c7b \uff1a\u68c0\u6d4b\u6613\u5931\u6570\u636e\uff08\u53ef\u80fd\u4f1a\u8fc7\u671f\u7684\u6570\u636e\u96c6server.db[i].expires \uff09 volatile-lru\uff1a\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70 volatile-lfu\uff1a\u6311\u9009\u6700\u8fd1\u4f7f\u7528\u6b21\u6570\u6700\u5c11\u7684\u6570\u636e\u6dd8\u6c70 volatile-ttl\uff1a\u6311\u9009\u5c06\u8981\u8fc7\u671f\u7684\u6570\u636e\u6dd8\u6c70 volatile-random\uff1a\u4efb\u610f\u9009\u62e9\u6570\u636e\u6dd8\u6c70 \u7b2c\u4e8c\u7c7b \uff1a\u68c0\u6d4b\u5168\u5e93\u6570\u636e\uff08\u6240\u6709\u6570\u636e\u96c6server.db[i].dict \uff09 allkeys-lru\uff1a\u6311\u9009\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u6dd8\u6c70 allkeLyRs-lfu\uff1a\uff1a\u6311\u9009\u6700\u8fd1\u4f7f\u7528\u6b21\u6570\u6700\u5c11\u7684\u6570\u636e\u6dd8\u6c70 allkeys-random\uff1a\u4efb\u610f\u9009\u62e9\u6570\u636e\u6dd8\u6c70\uff0c\u76f8\u5f53\u4e8e\u968f\u673a \u7b2c\u4e09\u7c7b \uff1a\u653e\u5f03\u6570\u636e\u9a71\u9010 no-enviction\uff08\u9a71\u9010\uff09\uff1a\u7981\u6b62\u9a71\u9010\u6570\u636e(redis4.0\u4e2d\u9ed8\u8ba4\u7b56\u7565)\uff0c\u4f1a\u5f15\u53d1OOM(Out Of Memory) \u6ce8\u610f\uff1a\u8fd9\u4e9b\u7b56\u7565\u662f\u914d\u7f6e\u5230\u54ea\u4e2a\u5c5e\u6027\u4e0a\uff1f\u600e\u4e48\u914d\u7f6e\uff1f\u5982\u4e0b\u6240\u793a maxmemory-policy volatile-lru \u6570\u636e\u6dd8\u6c70\u7b56\u7565\u914d\u7f6e\u4f9d\u636e \u4f7f\u7528INFO\u547d\u4ee4\u8f93\u51fa\u76d1\u63a7\u4fe1\u606f\uff0c\u67e5\u8be2\u7f13\u5b58 hit \u548c miss \u7684\u6b21\u6570\uff0c\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u8c03\u4f18Redis\u914d\u7f6e","title":"1.3.2 \u7b56\u7565\u914d\u7f6e"},{"location":"redis/day02/#2","text":"","title":"2.\u4e3b\u4ece\u590d\u5236"},{"location":"redis/day02/#21","text":"","title":"2.1 \u4e3b\u4ece\u590d\u5236\u7b80\u4ecb"},{"location":"redis/day02/#211","text":"\u9996\u5148\u6211\u4eec\u8981\u7406\u89e3\u4e92\u8054\u7f51\u5e94\u7528\u56e0\u4e3a\u5176\u72ec\u6709\u7684\u7279\u6027\u6211\u4eec\u6f14\u5316\u51fa\u7684 \u4e09\u9ad8 \u67b6\u6784 \u9ad8\u5e76\u53d1 \u5e94\u7528\u8981\u63d0\u4f9b\u67d0\u4e00\u4e1a\u52a1\u8981\u80fd\u652f\u6301\u5f88\u591a\u5ba2\u6237\u7aef\u540c\u65f6\u8bbf\u95ee\u7684\u80fd\u529b\uff0c\u6211\u4eec\u79f0\u4e3a\u5e76\u53d1\uff0c\u9ad8\u5e76\u53d1\u610f\u601d\u5c31\u5f88\u660e\u786e\u4e86 \u9ad8\u6027\u80fd \u6027\u80fd\u5e26\u7ed9\u6211\u4eec\u6700\u76f4\u89c2\u7684\u611f\u53d7\u5c31\u662f\uff1a\u901f\u5ea6\u5feb\uff0c\u65f6\u95f4\u77ed \u9ad8\u53ef\u7528 \u53ef\u7528\u6027 \uff1a\u4e00\u5e74\u4e2d\u5e94\u7528\u670d\u52a1\u6b63\u5e38\u8fd0\u884c\u7684\u65f6\u95f4\u5360\u5168\u5e74\u65f6\u95f4\u7684\u767e\u5206\u6bd4\uff0c\u5982\u4e0b\u56fe\uff1a\u8868\u793a\u4e86\u5e94\u7528\u670d\u52a1\u5728\u5168\u5e74\u5b95\u673a\u7684\u65f6\u95f4 \u6211\u4eec\u628a\u8fd9\u4e9b\u65f6\u95f4\u52a0\u5728\u4e00\u8d77\u5c31\u662f\u5168\u5e74\u5e94\u7528\u670d\u52a1\u4e0d\u53ef\u7528\u7684\u65f6\u95f4\uff0c\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u5e94\u7528\u670d\u52a1\u5168\u5e74\u53ef\u7528\u7684\u65f6\u95f4 4\u5c0f\u65f627\u520615\u79d2+11\u520636\u79d2+2\u520616\u79d2=4\u5c0f\u65f641\u52067\u79d2=16867\u79d2 1\u5e74=365 24 60*60=31536000\u79d2 \u53ef\u7528\u6027=\uff0831536000-16867\uff09/31536000*100%=99.9465151% \u4e1a\u754c\u53ef\u7528\u6027\u76ee\u6807 5\u4e2a9\uff0c\u537399.999% \uff0c\u5373\u670d\u52a1\u5668\u5e74\u5b95\u673a\u65f6\u957f\u4f4e\u4e8e315\u79d2\uff0c\u7ea65.25\u5206\u949f","title":"2.1.1 \u9ad8\u53ef\u7528"},{"location":"redis/day02/#212","text":"\u77e5\u9053\u4e86\u4e09\u9ad8\u7684\u6982\u5ff5\u4e4b\u540e\uff0c\u6211\u4eec\u60f3\uff1a\u4f60\u7684\u201cRedis\u201d\u662f\u5426\u9ad8\u53ef\u7528\uff1f\u90a3\u6211\u4eec\u8981\u6765\u5206\u6790\u5355\u673aredis\u7684\u98ce\u9669\u4e0e\u95ee\u9898 \u95ee\u98981.\u673a\u5668\u6545\u969c \u73b0\u8c61\uff1a\u786c\u76d8\u6545\u969c\u3001\u7cfb\u7edf\u5d29\u6e83 \u672c\u8d28\uff1a\u6570\u636e\u4e22\u5931\uff0c\u5f88\u53ef\u80fd\u5bf9\u4e1a\u52a1\u9020\u6210\u707e\u96be\u6027\u6253\u51fb \u7ed3\u8bba\uff1a\u57fa\u672c\u4e0a\u4f1a\u653e\u5f03\u4f7f\u7528redis. \u95ee\u98982.\u5bb9\u91cf\u74f6\u9888 \u73b0\u8c61\uff1a\u5185\u5b58\u4e0d\u8db3\uff0c\u4ece16G\u5347\u7ea7\u523064G\uff0c\u4ece64G\u5347\u7ea7\u5230128G\uff0c\u65e0\u9650\u5347\u7ea7\u5185\u5b58 \u672c\u8d28\uff1a\u7a77\uff0c\u786c\u4ef6\u6761\u4ef6\u8ddf\u4e0d\u4e0a \u7ed3\u8bba\uff1a\u653e\u5f03\u4f7f\u7528redis \u7ed3\u8bba\uff1a \u4e3a\u4e86\u907f\u514d\u5355\u70b9Redis\u670d\u52a1\u5668\u6545\u969c\uff0c\u51c6\u5907\u591a\u53f0\u670d\u52a1\u5668\uff0c\u4e92\u76f8\u8fde\u901a\u3002\u5c06\u6570\u636e\u590d\u5236\u591a\u4e2a\u526f\u672c\u4fdd\u5b58\u5728\u4e0d\u540c\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u8fde\u63a5\u5728\u4e00\u8d77\uff0c\u5e76\u4fdd\u8bc1\u6570\u636e\u662f\u540c\u6b65\u7684\u3002\u5373\u4f7f\u6709\u5176\u4e2d\u4e00\u53f0\u670d\u52a1\u5668\u5b95\u673a\uff0c\u5176\u4ed6\u670d\u52a1\u5668\u4f9d\u7136\u53ef\u4ee5\u7ee7\u7eed\u63d0\u4f9b\u670d\u52a1\uff0c\u5b9e\u73b0Redis\u7684\u9ad8\u53ef\u7528\uff0c\u540c\u65f6\u5b9e\u73b0\u6570\u636e\u5197\u4f59\u5907\u4efd\u3002 \u591a\u53f0\u670d\u52a1\u5668\u8fde\u63a5\u65b9\u6848\uff1a \u63d0\u4f9b\u6570\u636e\u65b9\uff1a master \u4e3b\u670d\u52a1\u5668\uff0c\u4e3b\u8282\u70b9\uff0c\u4e3b\u5e93\u4e3b\u5ba2\u6237\u7aef \u63a5\u6536\u6570\u636e\u65b9\uff1a slave \u4ece\u670d\u52a1\u5668\uff0c\u4ece\u8282\u70b9\uff0c\u4ece\u5e93 \u4ece\u5ba2\u6237\u7aef \u9700\u8981\u89e3\u51b3\u7684\u95ee\u9898\uff1a \u6570\u636e\u540c\u6b65\uff08master\u7684\u6570\u636e\u590d\u5236\u5230slave\u4e2d\uff09 \u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u6765\u89e3\u91ca\u4e3b\u4ece\u590d\u5236\u7684\u6982\u5ff5\uff1a \u6982\u5ff5\uff1a\u4e3b\u4ece\u590d\u5236\u5373\u5c06master\u4e2d\u7684\u6570\u636e\u5373\u65f6\u3001\u6709\u6548\u7684\u590d\u5236\u5230slave\u4e2d \u7279\u5f81 \uff1a\u4e00\u4e2amaster\u53ef\u4ee5\u62e5\u6709\u591a\u4e2aslave\uff0c\u4e00\u4e2aslave\u53ea\u5bf9\u5e94\u4e00\u4e2amaster \u804c\u8d23 \uff1amaster\u548cslave\u5404\u81ea\u7684\u804c\u8d23\u4e0d\u4e00\u6837 master: \u5199\u6570\u636e \u6267\u884c\u5199\u64cd\u4f5c\u65f6\uff0c\u5c06\u51fa\u73b0\u53d8\u5316\u7684\u6570\u636e\u81ea\u52a8\u540c\u6b65\u5230slave \u8bfb\u6570\u636e\uff08\u53ef\u5ffd\u7565\uff09 slave: \u8bfb\u6570\u636e \u5199\u6570\u636e\uff08\u7981\u6b62\uff09","title":"2.1.2 \u4e3b\u4ece\u590d\u5236\u6982\u5ff5"},{"location":"redis/day02/#213","text":"\u8bfb\u5199\u5206\u79bb\uff1amaster\u5199\u3001slave\u8bfb\uff0c\u63d0\u9ad8\u670d\u52a1\u5668\u7684\u8bfb\u5199\u8d1f\u8f7d\u80fd\u529b \u8d1f\u8f7d\u5747\u8861\uff1a\u57fa\u4e8e\u4e3b\u4ece\u7ed3\u6784\uff0c\u914d\u5408\u8bfb\u5199\u5206\u79bb\uff0c\u7531slave\u5206\u62c5master\u8d1f\u8f7d\uff0c\u5e76\u6839\u636e\u9700\u6c42\u7684\u53d8\u5316\uff0c\u6539\u53d8slave\u7684\u6570 \u91cf\uff0c\u901a\u8fc7\u591a\u4e2a\u4ece\u8282\u70b9\u5206\u62c5\u6570\u636e\u8bfb\u53d6\u8d1f\u8f7d\uff0c\u5927\u5927\u63d0\u9ad8Redis\u670d\u52a1\u5668\u5e76\u53d1\u91cf\u4e0e\u6570\u636e\u541e\u5410\u91cf \u6545\u969c\u6062\u590d\uff1a\u5f53master\u51fa\u73b0\u95ee\u9898\u65f6\uff0c\u7531slave\u63d0\u4f9b\u670d\u52a1\uff0c\u5b9e\u73b0\u5feb\u901f\u7684\u6545\u969c\u6062\u590d \u6570\u636e\u5197\u4f59\uff1a\u5b9e\u73b0\u6570\u636e\u70ed\u5907\u4efd\uff0c\u662f\u6301\u4e45\u5316\u4e4b\u5916\u7684\u4e00\u79cd\u6570\u636e\u5197\u4f59\u65b9\u5f0f \u9ad8\u53ef\u7528\u57fa\u77f3\uff1a\u57fa\u4e8e\u4e3b\u4ece\u590d\u5236\uff0c\u6784\u5efa\u54e8\u5175\u6a21\u5f0f\u4e0e\u96c6\u7fa4\uff0c\u5b9e\u73b0Redis\u7684\u9ad8\u53ef\u7528\u65b9\u6848","title":"2.1.3 \u4e3b\u4ece\u590d\u5236\u7684\u4f5c\u7528"},{"location":"redis/day02/#22","text":"\u4e3b\u4ece\u590d\u5236\u8fc7\u7a0b\u5927\u4f53\u53ef\u4ee5\u5206\u4e3a3\u4e2a\u9636\u6bb5 \u5efa\u7acb\u8fde\u63a5\u9636\u6bb5\uff08\u5373\u51c6\u5907\u9636\u6bb5\uff09 \u6570\u636e\u540c\u6b65\u9636\u6bb5 \u547d\u4ee4\u4f20\u64ad\u9636\u6bb5\uff08\u53cd\u590d\u540c\u6b65\uff09 \u800c\u547d\u4ee4\u7684\u4f20\u64ad\u5176\u5b9e\u67094\u79cd\uff0c\u5206\u522b\u5982\u4e0b\uff1a","title":"2.2 \u4e3b\u4ece\u590d\u5236\u5de5\u4f5c\u6d41\u7a0b"},{"location":"redis/day02/#221","text":"","title":"2.2.1 \u4e3b\u4ece\u590d\u5236\u7684\u5de5\u4f5c\u6d41\u7a0b\uff08\u4e09\u4e2a\u9636\u6bb5\uff09"},{"location":"redis/day02/#2211","text":"\u5efa\u7acbslave\u5230master\u7684\u8fde\u63a5\uff0c\u4f7fmaster\u80fd\u591f\u8bc6\u522bslave\uff0c\u5e76\u4fdd\u5b58slave\u7aef\u53e3\u53f7 \u6d41\u7a0b\u5982\u4e0b\uff1a \u6b65\u9aa41\uff1a\u8bbe\u7f6emaster\u7684\u5730\u5740\u548c\u7aef\u53e3\uff0c\u4fdd\u5b58master\u4fe1\u606f \u6b65\u9aa42\uff1a\u5efa\u7acbsocket\u8fde\u63a5 \u6b65\u9aa43\uff1a\u53d1\u9001ping\u547d\u4ee4\uff08\u5b9a\u65f6\u5668\u4efb\u52a1\uff09 \u6b65\u9aa44\uff1a\u8eab\u4efd\u9a8c\u8bc1 \u6b65\u9aa45\uff1a\u53d1\u9001slave\u7aef\u53e3\u4fe1\u606f \u81f3\u6b64\uff0c\u4e3b\u4ece\u8fde\u63a5\u6210\u529f\uff01 \u5f53\u524d\u72b6\u6001\uff1a slave\uff1a\u4fdd\u5b58master\u7684\u5730\u5740\u4e0e\u7aef\u53e3 master\uff1a\u4fdd\u5b58slave\u7684\u7aef\u53e3 \u603b\u4f53\uff1a\u4e4b\u95f4\u521b\u5efa\u4e86\u8fde\u63a5\u7684socket master\u548cslave\u4e92\u8054 \u63a5\u4e0b\u6765\u5c31\u8981\u901a\u8fc7\u67d0\u79cd\u65b9\u5f0f\u5c06master\u548cslave\u8fde\u63a5\u5230\u4e00\u8d77 \u65b9\u5f0f\u4e00\uff1a\u5ba2\u6237\u7aef\u53d1\u9001\u547d\u4ee4 slaveof masterip masterport \u65b9\u5f0f\u4e8c\uff1a\u542f\u52a8\u670d\u52a1\u5668\u53c2\u6570 redis-server --slaveof masterip masterport \u65b9\u5f0f\u4e09\uff1a\u670d\u52a1\u5668\u914d\u7f6e\uff08 \u4e3b\u6d41\u65b9\u5f0f \uff09 slaveof masterip masterport slave\u7cfb\u7edf\u4fe1\u606f master_link_down_since_seconds masterhost & masterport master\u7cfb\u7edf\u4fe1\u606f uslave_listening_port(\u591a\u4e2a) \u4e3b\u4ece\u65ad\u5f00\u8fde\u63a5 \u65ad\u5f00slave\u4e0emaster\u7684\u8fde\u63a5\uff0cslave\u65ad\u5f00\u8fde\u63a5\u540e\uff0c\u4e0d\u4f1a\u5220\u9664\u5df2\u6709\u6570\u636e\uff0c\u53ea\u662f\u4e0d\u518d\u63a5\u53d7master\u53d1\u9001\u7684\u6570\u636e slaveof no one \u6388\u6743\u8bbf\u95ee master\u5ba2\u6237\u7aef\u53d1\u9001\u547d\u4ee4\u8bbe\u7f6e\u5bc6\u7801 requirepass password master\u914d\u7f6e\u6587\u4ef6\u8bbe\u7f6e\u5bc6\u7801 config set requirepass password config get requirepass slave\u5ba2\u6237\u7aef\u53d1\u9001\u547d\u4ee4\u8bbe\u7f6e\u5bc6\u7801 auth password slave\u914d\u7f6e\u6587\u4ef6\u8bbe\u7f6e\u5bc6\u7801 masterauth password slave\u542f\u52a8\u670d\u52a1\u5668\u8bbe\u7f6e\u5bc6\u7801 redis-server \u2013a password","title":"2.2.1.1 \u9636\u6bb5\u4e00\uff1a\u5efa\u7acb\u8fde\u63a5"},{"location":"redis/day02/#2212","text":"\u5728slave\u521d\u6b21\u8fde\u63a5master\u540e\uff0c\u590d\u5236master\u4e2d\u7684\u6240\u6709\u6570\u636e\u5230slave \u5c06slave\u7684\u6570\u636e\u5e93\u72b6\u6001\u66f4\u65b0\u6210master\u5f53\u524d\u7684\u6570\u636e\u5e93\u72b6\u6001 \u540c\u6b65\u8fc7\u7a0b\u5982\u4e0b\uff1a \u6b65\u9aa41\uff1a\u8bf7\u6c42\u540c\u6b65\u6570\u636e \u6b65\u9aa42\uff1a\u521b\u5efaRDB\u540c\u6b65\u6570\u636e \u6b65\u9aa43\uff1a\u6062\u590dRDB\u540c\u6b65\u6570\u636e \u6b65\u9aa44\uff1a\u8bf7\u6c42\u90e8\u5206\u540c\u6b65\u6570\u636e \u6b65\u9aa45\uff1a\u6062\u590d\u90e8\u5206\u540c\u6b65\u6570\u636e \u81f3\u6b64\uff0c\u6570\u636e\u540c\u6b65\u5de5\u4f5c\u5b8c\u6210\uff01 \u5f53\u524d\u72b6\u6001\uff1a slave\uff1a\u5177\u6709master\u7aef\u5168\u90e8\u6570\u636e\uff0c\u5305\u542bRDB\u8fc7\u7a0b\u63a5\u6536\u7684\u6570\u636e master\uff1a\u4fdd\u5b58slave\u5f53\u524d\u6570\u636e\u540c\u6b65\u7684\u4f4d\u7f6e \u603b\u4f53\uff1a\u4e4b\u95f4\u5b8c\u6210\u4e86\u6570\u636e\u514b\u9686 \u6570\u636e\u540c\u6b65\u9636\u6bb5master\u8bf4\u660e 1\uff1a\u5982\u679cmaster\u6570\u636e\u91cf\u5de8\u5927\uff0c\u6570\u636e\u540c\u6b65\u9636\u6bb5\u5e94\u907f\u5f00\u6d41\u91cf\u9ad8\u5cf0\u671f\uff0c\u907f\u514d\u9020\u6210master\u963b\u585e\uff0c\u5f71\u54cd\u4e1a\u52a1\u6b63\u5e38\u6267\u884c 2\uff1a\u590d\u5236\u7f13\u51b2\u533a\u5927\u5c0f\u8bbe\u5b9a\u4e0d\u5408\u7406\uff0c\u4f1a\u5bfc\u81f4\u6570\u636e\u6ea2\u51fa\u3002\u5982\u8fdb\u884c\u5168\u91cf\u590d\u5236\u5468\u671f\u592a\u957f\uff0c\u8fdb\u884c\u90e8\u5206\u590d\u5236\u65f6\u53d1\u73b0\u6570\u636e\u5df2\u7ecf\u5b58\u5728\u4e22\u5931\u7684\u60c5\u51b5\uff0c\u5fc5\u987b\u8fdb\u884c\u7b2c\u4e8c\u6b21\u5168\u91cf\u590d\u5236\uff0c\u81f4\u4f7fslave\u9677\u5165\u6b7b\u5faa\u73af\u72b6\u6001\u3002 repl-backlog-size ?mb master\u5355\u673a\u5185\u5b58\u5360\u7528\u4e3b\u673a\u5185\u5b58\u7684\u6bd4\u4f8b\u4e0d\u5e94\u8fc7\u5927\uff0c\u5efa\u8bae\u4f7f\u752850%-70%\u7684\u5185\u5b58\uff0c\u7559\u4e0b30%-50%\u7684\u5185\u5b58\u7528\u4e8e\u6267 \u884cbgsave\u547d\u4ee4\u548c\u521b\u5efa\u590d\u5236\u7f13\u51b2\u533a \u6570\u636e\u540c\u6b65\u9636\u6bb5slave\u8bf4\u660e \u4e3a\u907f\u514dslave\u8fdb\u884c\u5168\u91cf\u590d\u5236\u3001\u90e8\u5206\u590d\u5236\u65f6\u670d\u52a1\u5668\u54cd\u5e94\u963b\u585e\u6216\u6570\u636e\u4e0d\u540c\u6b65\uff0c\u5efa\u8bae\u5173\u95ed\u6b64\u671f\u95f4\u7684\u5bf9\u5916\u670d\u52a1 slave-serve-stale-data yes|no \u6570\u636e\u540c\u6b65\u9636\u6bb5\uff0cmaster\u53d1\u9001\u7ed9slave\u4fe1\u606f\u53ef\u4ee5\u7406\u89e3master\u662fslave\u7684\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0c\u4e3b\u52a8\u5411slave\u53d1\u9001\u547d\u4ee4 \u591a\u4e2aslave\u540c\u65f6\u5bf9master\u8bf7\u6c42\u6570\u636e\u540c\u6b65\uff0cmaster\u53d1\u9001\u7684RDB\u6587\u4ef6\u589e\u591a\uff0c\u4f1a\u5bf9\u5e26\u5bbd\u9020\u6210\u5de8\u5927\u51b2\u51fb\uff0c\u5982\u679cmaster\u5e26\u5bbd\u4e0d\u8db3\uff0c\u56e0\u6b64\u6570\u636e\u540c\u6b65\u9700\u8981\u6839\u636e\u4e1a\u52a1\u9700\u6c42\uff0c\u9002\u91cf\u9519\u5cf0 slave\u8fc7\u591a\u65f6\uff0c\u5efa\u8bae\u8c03\u6574\u62d3\u6251\u7ed3\u6784\uff0c\u7531\u4e00\u4e3b\u591a\u4ece\u7ed3\u6784\u53d8\u4e3a\u6811\u72b6\u7ed3\u6784\uff0c\u4e2d\u95f4\u7684\u8282\u70b9\u65e2\u662fmaster\uff0c\u4e5f\u662f slave\u3002\u6ce8\u610f\u4f7f\u7528\u6811\u72b6\u7ed3\u6784\u65f6\uff0c\u7531\u4e8e\u5c42\u7ea7\u6df1\u5ea6\uff0c\u5bfc\u81f4\u6df1\u5ea6\u8d8a\u9ad8\u7684slave\u4e0e\u6700\u9876\u5c42master\u95f4\u6570\u636e\u540c\u6b65\u5ef6\u8fdf \u8f83\u5927\uff0c\u6570\u636e\u4e00\u81f4\u6027\u53d8\u5dee\uff0c\u5e94\u8c28\u614e\u9009\u62e9","title":"2.2.1.2 \u9636\u6bb5\u4e8c\uff1a\u6570\u636e\u540c\u6b65"},{"location":"redis/day02/#2213","text":"\u5f53master\u6570\u636e\u5e93\u72b6\u6001\u88ab\u4fee\u6539\u540e\uff0c\u5bfc\u81f4\u4e3b\u4ece\u670d\u52a1\u5668\u6570\u636e\u5e93\u72b6\u6001\u4e0d\u4e00\u81f4\uff0c\u6b64\u65f6\u9700\u8981\u8ba9\u4e3b\u4ece\u6570\u636e\u540c\u6b65\u5230\u4e00\u81f4\u7684\u72b6\u6001\uff0c\u540c\u6b65\u7684\u52a8\u4f5c\u79f0\u4e3a\u547d\u4ee4\u4f20\u64ad master\u5c06\u63a5\u6536\u5230\u7684\u6570\u636e\u53d8\u66f4\u547d\u4ee4\u53d1\u9001\u7ed9slave\uff0cslave\u63a5\u6536\u547d\u4ee4\u540e\u6267\u884c\u547d\u4ee4 \u547d\u4ee4\u4f20\u64ad\u9636\u6bb5\u7684\u90e8\u5206\u590d\u5236 \u547d\u4ee4\u4f20\u64ad\u9636\u6bb5\u51fa\u73b0\u4e86\u65ad\u7f51\u73b0\u8c61\uff1a \u7f51\u7edc\u95ea\u65ad\u95ea\u8fde\uff1a\u5ffd\u7565 \u77ed\u65f6\u95f4\u7f51\u7edc\u4e2d\u65ad\uff1a\u90e8\u5206\u590d\u5236 \u957f\u65f6\u95f4\u7f51\u7edc\u4e2d\u65ad\uff1a\u5168\u91cf\u590d\u5236 \u8fd9\u91cc\u6211\u4eec\u4e3b\u8981\u6765\u770b\u90e8\u5206\u590d\u5236\uff0c\u90e8\u5206\u590d\u5236\u7684\u4e09\u4e2a\u6838\u5fc3\u8981\u7d20 \u670d\u52a1\u5668\u7684\u8fd0\u884c id\uff08run id\uff09 \u4e3b\u670d\u52a1\u5668\u7684\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a \u4e3b\u4ece\u670d\u52a1\u5668\u7684\u590d\u5236\u504f\u79fb\u91cf \u670d\u52a1\u5668\u8fd0\u884cID\uff08runid\uff09 \u6982\u5ff5\uff1a\u670d\u52a1\u5668\u8fd0\u884cID\u662f\u6bcf\u4e00\u53f0\u670d\u52a1\u5668\u6bcf\u6b21\u8fd0\u884c\u7684\u8eab\u4efd\u8bc6\u522b\u7801\uff0c\u4e00\u53f0\u670d\u52a1\u5668\u591a\u6b21\u8fd0\u884c\u53ef\u4ee5\u751f\u6210\u591a\u4e2a\u8fd0\u884cid \u7ec4\u6210\uff1a\u8fd0\u884cid\u753140\u4f4d\u5b57\u7b26\u7ec4\u6210\uff0c\u662f\u4e00\u4e2a\u968f\u673a\u7684\u5341\u516d\u8fdb\u5236\u5b57\u7b26 \u4f8b\u5982\uff1afdc9ff13b9bbaab28db42b3d50f852bb5e3fcdce \u4f5c\u7528\uff1a\u8fd0\u884cid\u88ab\u7528\u4e8e\u5728\u670d\u52a1\u5668\u95f4\u8fdb\u884c\u4f20\u8f93\uff0c\u8bc6\u522b\u8eab\u4efd \u5982\u679c\u60f3\u4e24\u6b21\u64cd\u4f5c\u5747\u5bf9\u540c\u4e00\u53f0\u670d\u52a1\u5668\u8fdb\u884c\uff0c\u5fc5\u987b\u6bcf\u6b21\u64cd\u4f5c\u643a\u5e26\u5bf9\u5e94\u7684\u8fd0\u884cid\uff0c\u7528\u4e8e\u5bf9\u65b9\u8bc6\u522b \u5b9e\u73b0\u65b9\u5f0f\uff1a\u8fd0\u884cid\u5728\u6bcf\u53f0\u670d\u52a1\u5668\u542f\u52a8\u65f6\u81ea\u52a8\u751f\u6210\u7684\uff0cmaster\u5728\u9996\u6b21\u8fde\u63a5slave\u65f6\uff0c\u4f1a\u5c06\u81ea\u5df1\u7684\u8fd0\u884cID\u53d1\u9001\u7ed9slave\uff0c slave\u4fdd\u5b58\u6b64ID\uff0c\u901a\u8fc7info Server\u547d\u4ee4\uff0c\u53ef\u4ee5\u67e5\u770b\u8282\u70b9\u7684runid \u590d\u5236\u7f13\u51b2\u533a \u6982\u5ff5\uff1a\u590d\u5236\u7f13\u51b2\u533a\uff0c\u53c8\u540d\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\uff0c\u662f\u4e00\u4e2a\u5148\u8fdb\u5148\u51fa\uff08FIFO\uff09\u7684\u961f\u5217\uff0c\u7528\u4e8e\u5b58\u50a8\u670d\u52a1\u5668\u6267\u884c\u8fc7\u7684\u547d\u4ee4\uff0c\u6bcf\u6b21\u4f20\u64ad\u547d\u4ee4\uff0cmaster\u90fd\u4f1a\u5c06\u4f20\u64ad\u7684\u547d\u4ee4\u8bb0\u5f55\u4e0b\u6765\uff0c\u5e76\u5b58\u50a8\u5728\u590d\u5236\u7f13\u51b2\u533a \u590d\u5236\u7f13\u51b2\u533a\u9ed8\u8ba4\u6570\u636e\u5b58\u50a8\u7a7a\u95f4\u5927\u5c0f\u662f1M \u5f53\u5165\u961f\u5143\u7d20\u7684\u6570\u91cf\u5927\u4e8e\u961f\u5217\u957f\u5ea6\u65f6\uff0c\u6700\u5148\u5165\u961f\u7684\u5143\u7d20\u4f1a\u88ab\u5f39\u51fa\uff0c\u800c\u65b0\u5143\u7d20\u4f1a\u88ab\u653e\u5165\u961f\u5217 \u4f5c\u7528\uff1a\u7528\u4e8e\u4fdd\u5b58master\u6536\u5230\u7684\u6240\u6709\u6307\u4ee4\uff08\u4ec5\u5f71\u54cd\u6570\u636e\u53d8\u66f4\u7684\u6307\u4ee4\uff0c\u4f8b\u5982set\uff0cselect\uff09 \u6570\u636e\u6765\u6e90\uff1a\u5f53master\u63a5\u6536\u5230\u4e3b\u5ba2\u6237\u7aef\u7684\u6307\u4ee4\u65f6\uff0c\u9664\u4e86\u5c06\u6307\u4ee4\u6267\u884c\uff0c\u4f1a\u5c06\u8be5\u6307\u4ee4\u5b58\u50a8\u5230\u7f13\u51b2\u533a\u4e2d \u590d\u5236\u7f13\u51b2\u533a\u5185\u90e8\u5de5\u4f5c\u539f\u7406\uff1a \u7ec4\u6210 \u504f\u79fb\u91cf \u6982\u5ff5\uff1a\u4e00\u4e2a\u6570\u5b57\uff0c\u63cf\u8ff0\u590d\u5236\u7f13\u51b2\u533a\u4e2d\u7684\u6307\u4ee4\u5b57\u8282\u4f4d\u7f6e \u5206\u7c7b\uff1a master\u590d\u5236\u504f\u79fb\u91cf\uff1a\u8bb0\u5f55\u53d1\u9001\u7ed9\u6240\u6709slave\u7684\u6307\u4ee4\u5b57\u8282\u5bf9\u5e94\u7684\u4f4d\u7f6e\uff08\u591a\u4e2a\uff09 slave\u590d\u5236\u504f\u79fb\u91cf\uff1a\u8bb0\u5f55slave\u63a5\u6536master\u53d1\u9001\u8fc7\u6765\u7684\u6307\u4ee4\u5b57\u8282\u5bf9\u5e94\u7684\u4f4d\u7f6e\uff08\u4e00\u4e2a\uff09 \u4f5c\u7528\uff1a\u540c\u6b65\u4fe1\u606f\uff0c\u6bd4\u5bf9master\u4e0eslave\u7684\u5dee\u5f02\uff0c\u5f53slave\u65ad\u7ebf\u540e\uff0c\u6062\u590d\u6570\u636e\u4f7f\u7528 \u6570\u636e\u6765\u6e90\uff1a master\u7aef\uff1a\u53d1\u9001\u4e00\u6b21\u8bb0\u5f55\u4e00\u6b21 slave\u7aef\uff1a\u63a5\u6536\u4e00\u6b21\u8bb0\u5f55\u4e00\u6b21 \u5b57\u8282\u503c \u5de5\u4f5c\u539f\u7406 \u901a\u8fc7offset\u533a\u5206\u4e0d\u540c\u7684slave\u5f53\u524d\u6570\u636e\u4f20\u64ad\u7684\u5dee\u5f02 master\u8bb0\u5f55\u5df2\u53d1\u9001\u7684\u4fe1\u606f\u5bf9\u5e94\u7684offset slave\u8bb0\u5f55\u5df2\u63a5\u6536\u7684\u4fe1\u606f\u5bf9\u5e94\u7684offset","title":"2.2.1.3 \u9636\u6bb5\u4e09\uff1a\u547d\u4ee4\u4f20\u64ad"},{"location":"redis/day02/#222","text":"\u6211\u4eec\u518d\u6b21\u7684\u603b\u7ed3\u4e00\u4e0b\u4e3b\u4ece\u590d\u5236\u7684\u4e09\u4e2a\u9636\u6bb5\u7684\u5de5\u4f5c\u6d41\u7a0b\uff1a","title":"2.2.2 \u6d41\u7a0b\u66f4\u65b0(\u5168\u91cf\u590d\u5236/\u90e8\u5206\u590d\u5236)"},{"location":"redis/day02/#223","text":"\u4ec0\u4e48\u662f\u5fc3\u8df3\u673a\u5236\uff1f \u8fdb\u5165\u547d\u4ee4\u4f20\u64ad\u9636\u6bb5\u5019\uff0cmaster\u4e0eslave\u95f4\u9700\u8981\u8fdb\u884c\u4fe1\u606f\u4ea4\u6362\uff0c\u4f7f\u7528\u5fc3\u8df3\u673a\u5236\u8fdb\u884c\u7ef4\u62a4\uff0c\u5b9e\u73b0\u53cc\u65b9\u8fde\u63a5\u4fdd\u6301\u5728\u7ebf master\u5fc3\u8df3\uff1a \u5185\u90e8\u6307\u4ee4\uff1aPING \u5468\u671f\uff1a\u7531repl-ping-slave-period\u51b3\u5b9a\uff0c\u9ed8\u8ba410\u79d2 \u4f5c\u7528\uff1a\u5224\u65adslave\u662f\u5426\u5728\u7ebf \u67e5\u8be2\uff1aINFO replication \u83b7\u53d6slave\u6700\u540e\u4e00\u6b21\u8fde\u63a5\u65f6\u95f4\u95f4\u9694\uff0clag\u9879\u7ef4\u6301\u57280\u62161\u89c6\u4e3a\u6b63\u5e38 slave\u5fc3\u8df3\u4efb\u52a1 \u5185\u90e8\u6307\u4ee4\uff1aREPLCONF ACK {offset} \u5468\u671f\uff1a1\u79d2 \u4f5c\u75281\uff1a\u6c47\u62a5slave\u81ea\u5df1\u7684\u590d\u5236\u504f\u79fb\u91cf\uff0c\u83b7\u53d6\u6700\u65b0\u7684\u6570\u636e\u53d8\u66f4\u6307\u4ee4 \u4f5c\u75282\uff1a\u5224\u65admaster\u662f\u5426\u5728\u7ebf \u5fc3\u8df3\u9636\u6bb5\u6ce8\u610f\u4e8b\u9879\uff1a \u5f53slave\u591a\u6570\u6389\u7ebf\uff0c\u6216\u5ef6\u8fdf\u8fc7\u9ad8\u65f6\uff0cmaster\u4e3a\u4fdd\u969c\u6570\u636e\u7a33\u5b9a\u6027\uff0c\u5c06\u62d2\u7edd\u6240\u6709\u4fe1\u606f\u540c\u6b65 min-slaves-to-write 2 min-slaves-max-lag 8 slave\u6570\u91cf\u5c11\u4e8e2\u4e2a\uff0c\u6216\u8005\u6240\u6709slave\u7684\u5ef6\u8fdf\u90fd\u5927\u4e8e\u7b49\u4e8e8\u79d2\u65f6\uff0c\u5f3a\u5236\u5173\u95edmaster\u5199\u529f\u80fd\uff0c\u505c\u6b62\u6570\u636e\u540c\u6b65 slave\u6570\u91cf\u7531slave\u53d1\u9001REPLCONF ACK\u547d\u4ee4\u505a\u786e\u8ba4 slave\u5ef6\u8fdf\u7531slave\u53d1\u9001REPLCONF ACK\u547d\u4ee4\u505a\u786e\u8ba4 \u81f3\u6b64\uff1a\u6211\u4eec\u53ef\u4ee5\u603b\u7ed3\u51fa\u5b8c\u6574\u7684\u4e3b\u4ece\u590d\u5236\u6d41\u7a0b\uff1a","title":"2.2.3 \u5fc3\u8df3\u673a\u5236"},{"location":"redis/day02/#23","text":"","title":"2.3 \u4e3b\u4ece\u590d\u5236\u5e38\u89c1\u95ee\u9898"},{"location":"redis/day02/#231","text":"\u4f34\u968f\u7740\u7cfb\u7edf\u7684\u8fd0\u884c\uff0cmaster\u7684\u6570\u636e\u91cf\u4f1a\u8d8a\u6765\u8d8a\u5927\uff0c\u4e00\u65e6master\u91cd\u542f\uff0crunid\u5c06\u53d1\u751f\u53d8\u5316\uff0c\u4f1a\u5bfc\u81f4\u5168\u90e8slave\u7684\u5168\u91cf\u590d\u5236\u64cd\u4f5c \u5185\u90e8\u4f18\u5316\u8c03\u6574\u65b9\u6848\uff1a 1\uff1amaster\u5185\u90e8\u521b\u5efamaster_replid\u53d8\u91cf\uff0c\u4f7f\u7528runid\u76f8\u540c\u7684\u7b56\u7565\u751f\u6210\uff0c\u957f\u5ea641\u4f4d\uff0c\u5e76\u53d1\u9001\u7ed9\u6240\u6709slave 2\uff1a\u5728master\u5173\u95ed\u65f6\u6267\u884c\u547d\u4ee4shutdown save\uff0c\u8fdb\u884cRDB\u6301\u4e45\u5316,\u5c06runid\u4e0eoffset\u4fdd\u5b58\u5230RDB\u6587\u4ef6\u4e2d repl-id repl-offset \u901a\u8fc7redis-check-rdb\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u8be5\u4fe1\u606f 3\uff1amaster\u91cd\u542f\u540e\u52a0\u8f7dRDB\u6587\u4ef6\uff0c\u6062\u590d\u6570\u636e\uff0c\u91cd\u542f\u540e\uff0c\u5c06RDB\u6587\u4ef6\u4e2d\u4fdd\u5b58\u7684repl-id\u4e0erepl-offset\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d master_repl_id=repl master_repl_offset =repl-offset \u901a\u8fc7info\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u8be5\u4fe1\u606f \u4f5c\u7528\uff1a\u672c\u673a\u4fdd\u5b58\u4e0a\u6b21runid\uff0c\u91cd\u542f\u540e\u6062\u590d\u8be5\u503c\uff0c\u4f7f\u6240\u6709slave\u8ba4\u4e3a\u8fd8\u662f\u4e4b\u524d\u7684master \u7b2c\u4e8c\u79cd\u51fa\u73b0\u9891\u7e41\u5168\u91cf\u590d\u5236\u7684\u95ee\u9898\u73b0\u8c61\uff1a\u7f51\u7edc\u73af\u5883\u4e0d\u4f73\uff0c\u51fa\u73b0\u7f51\u7edc\u4e2d\u65ad\uff0cslave\u4e0d\u63d0\u4f9b\u670d\u52a1 \u95ee\u9898\u539f\u56e0\uff1a\u590d\u5236\u7f13\u51b2\u533a\u8fc7\u5c0f\uff0c\u65ad\u7f51\u540eslave\u7684offset\u8d8a\u754c\uff0c\u89e6\u53d1\u5168\u91cf\u590d\u5236 \u6700\u7ec8\u7ed3\u679c\uff1aslave\u53cd\u590d\u8fdb\u884c\u5168\u91cf\u590d\u5236 \u89e3\u51b3\u65b9\u6848\uff1a\u4fee\u6539\u590d\u5236\u7f13\u51b2\u533a\u5927\u5c0f repl-backlog-size ?mb \u5efa\u8bae\u8bbe\u7f6e\u5982\u4e0b\uff1a 1.\u6d4b\u7b97\u4ecemaster\u5230slave\u7684\u91cd\u8fde\u5e73\u5747\u65f6\u957fsecond 2.\u83b7\u53d6master\u5e73\u5747\u6bcf\u79d2\u4ea7\u751f\u5199\u547d\u4ee4\u6570\u636e\u603b\u91cfwrite_size_per_second 3.\u6700\u4f18\u590d\u5236\u7f13\u51b2\u533a\u7a7a\u95f4 = 2 * second * write_size_per_second","title":"2.3.1 \u9891\u7e41\u7684\u5168\u91cf\u590d\u5236"},{"location":"redis/day02/#232","text":"\u95ee\u9898\u73b0\u8c61\uff1amaster\u7684CPU\u5360\u7528\u8fc7\u9ad8 \u6216 slave\u9891\u7e41\u65ad\u5f00\u8fde\u63a5 \u95ee\u9898\u539f\u56e0 slave\u6bcf1\u79d2\u53d1\u9001REPLCONFACK\u547d\u4ee4\u5230master \u5f53slave\u63a5\u5230\u4e86\u6162\u67e5\u8be2\u65f6\uff08keys * \uff0chgetall\u7b49\uff09\uff0c\u4f1a\u5927\u91cf\u5360\u7528CPU\u6027\u80fd master\u6bcf1\u79d2\u8c03\u7528\u590d\u5236\u5b9a\u65f6\u51fd\u6570replicationCron()\uff0c\u6bd4\u5bf9slave\u53d1\u73b0\u957f\u65f6\u95f4\u6ca1\u6709\u8fdb\u884c\u54cd\u5e94 \u6700\u7ec8\u7ed3\u679c\uff1amaster\u5404\u79cd\u8d44\u6e90\uff08\u8f93\u51fa\u7f13\u51b2\u533a\u3001\u5e26\u5bbd\u3001\u8fde\u63a5\u7b49\uff09\u88ab\u4e25\u91cd\u5360\u7528 \u89e3\u51b3\u65b9\u6848\uff1a\u901a\u8fc7\u8bbe\u7f6e\u5408\u7406\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u786e\u8ba4\u662f\u5426\u91ca\u653eslave repl-timeout seconds \u8be5\u53c2\u6570\u5b9a\u4e49\u4e86\u8d85\u65f6\u65f6\u95f4\u7684\u9608\u503c\uff08\u9ed8\u8ba460\u79d2\uff09\uff0c\u8d85\u8fc7\u8be5\u503c\uff0c\u91ca\u653eslave \u95ee\u9898\u73b0\u8c61\uff1aslave\u4e0emaster\u8fde\u63a5\u65ad\u5f00 \u95ee\u9898\u539f\u56e0 master\u53d1\u9001ping\u6307\u4ee4\u9891\u5ea6\u8f83\u4f4e master\u8bbe\u5b9a\u8d85\u65f6\u65f6\u95f4\u8f83\u77ed ping\u6307\u4ee4\u5728\u7f51\u7edc\u4e2d\u5b58\u5728\u4e22\u5305 \u89e3\u51b3\u65b9\u6848\uff1a\u63d0\u9ad8ping\u6307\u4ee4\u53d1\u9001\u7684\u9891\u5ea6 repl-ping-slave-period seconds \u8d85\u65f6\u65f6\u95f4repl-time\u7684\u65f6\u95f4\u81f3\u5c11\u662fping\u6307\u4ee4\u9891\u5ea6\u76845\u523010\u500d\uff0c\u5426\u5219slave\u5f88\u5bb9\u6613\u5224\u5b9a\u8d85\u65f6","title":"2.3.2 \u9891\u7e41\u7684\u7f51\u7edc\u4e2d\u65ad"},{"location":"redis/day02/#233","text":"\u95ee\u9898\u73b0\u8c61\uff1a\u591a\u4e2aslave\u83b7\u53d6\u76f8\u540c\u6570\u636e\u4e0d\u540c\u6b65 \u95ee\u9898\u539f\u56e0\uff1a\u7f51\u7edc\u4fe1\u606f\u4e0d\u540c\u6b65\uff0c\u6570\u636e\u53d1\u9001\u6709\u5ef6\u8fdf \u89e3\u51b3\u65b9\u6848 \u4f18\u5316\u4e3b\u4ece\u95f4\u7684\u7f51\u7edc\u73af\u5883\uff0c\u901a\u5e38\u653e\u7f6e\u5728\u540c\u4e00\u4e2a\u673a\u623f\u90e8\u7f72\uff0c\u5982\u4f7f\u7528\u963f\u91cc\u4e91\u7b49\u4e91\u670d\u52a1\u5668\u65f6\u8981\u6ce8\u610f\u6b64\u73b0\u8c61 \u76d1\u63a7\u4e3b\u4ece\u8282\u70b9\u5ef6\u8fdf\uff08\u901a\u8fc7offset\uff09\u5224\u65ad\uff0c\u5982\u679cslave\u5ef6\u8fdf\u8fc7\u5927\uff0c\u6682\u65f6\u5c4f\u853d\u7a0b\u5e8f\u5bf9\u8be5slave\u7684\u6570\u636e\u8bbf\u95ee slave-serve-stale-data yes|no \u5f00\u542f\u540e\u4ec5\u54cd\u5e94info\u3001slaveof\u7b49\u5c11\u6570\u547d\u4ee4\uff08\u614e\u7528\uff0c\u9664\u975e\u5bf9\u6570\u636e\u4e00\u81f4\u6027\u8981\u6c42\u5f88\u9ad8\uff09","title":"2.3.3 \u6570\u636e\u4e0d\u4e00\u81f4"},{"location":"redis/day02/#3","text":"","title":"3.\u54e8\u5175\u6a21\u5f0f"},{"location":"redis/day02/#31","text":"","title":"3.1 \u54e8\u5175\u7b80\u4ecb"},{"location":"redis/day02/#311","text":"\u9996\u5148\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u4e1a\u52a1\u573a\u666f\uff1a\u5982\u679credis\u7684master\u5b95\u673a\u4e86\uff0c\u6b64\u65f6\u5e94\u8be5\u600e\u4e48\u529e\uff1f \u90a3\u6b64\u65f6\u6211\u4eec\u53ef\u80fd\u9700\u8981\u4ece\u4e00\u5806\u7684slave\u4e2d\u91cd\u65b0\u9009\u4e3e\u51fa\u4e00\u4e2a\u65b0\u7684master\uff0c\u90a3\u8fd9\u4e2a\u64cd\u4f5c\u8fc7\u7a0b\u662f\u4ec0\u4e48\u6837\u7684\u5462\uff1f\u8fd9\u91cc\u9762\u4f1a\u6709\u4ec0\u4e48\u95ee\u9898\u51fa\u73b0\u5462\uff1f \u8981\u5b9e\u73b0\u8fd9\u4e9b\u529f\u80fd\uff0c\u6211\u4eec\u5c31\u9700\u8981redis\u7684\u54e8\u5175\uff0c\u90a3\u54e8\u5175\u662f\u4ec0\u4e48\u5462\uff1f \u54e8\u5175 \u54e8\u5175(sentinel) \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u7528\u4e8e\u5bf9\u4e3b\u4ece\u7ed3\u6784\u4e2d\u7684\u6bcf\u53f0\u670d\u52a1\u5668\u8fdb\u884c \u76d1\u63a7 \uff0c\u5f53\u51fa\u73b0\u6545\u969c\u65f6\u901a\u8fc7 \u6295\u7968 \u673a\u5236 \u9009\u62e9 \u65b0\u7684master\u5e76\u5c06\u6240\u6709slave\u8fde\u63a5\u5230\u65b0\u7684master\u3002","title":"3.1.1 \u54e8\u5175\u6982\u5ff5"},{"location":"redis/day02/#312","text":"\u54e8\u5175\u7684\u4f5c\u7528\uff1a \u76d1\u63a7\uff1a\u76d1\u63a7master\u548cslave \u4e0d\u65ad\u7684\u68c0\u67e5master\u548cslave\u662f\u5426\u6b63\u5e38\u8fd0\u884c master\u5b58\u6d3b\u68c0\u6d4b\u3001master\u4e0eslave\u8fd0\u884c\u60c5\u51b5\u68c0\u6d4b \u901a\u77e5\uff08\u63d0\u9192\uff09\uff1a\u5f53\u88ab\u76d1\u63a7\u7684\u670d\u52a1\u5668\u51fa\u73b0\u95ee\u9898\u65f6\uff0c\u5411\u5176\u4ed6\uff08\u54e8\u5175\u95f4\uff0c\u5ba2\u6237\u7aef\uff09\u53d1\u9001\u901a\u77e5 \u81ea\u52a8\u6545\u969c\u8f6c\u79fb\uff1a\u65ad\u5f00master\u4e0eslave\u8fde\u63a5\uff0c\u9009\u53d6\u4e00\u4e2aslave\u4f5c\u4e3amaster\uff0c\u5c06\u5176\u4ed6slave\u8fde\u63a5\u65b0\u7684master\uff0c\u5e76\u544a\u77e5\u5ba2\u6237\u7aef\u65b0\u7684\u670d\u52a1\u5668\u5730\u5740 \u6ce8\u610f\uff1a\u54e8\u5175\u4e5f\u662f\u4e00\u53f0redis\u670d\u52a1\u5668\uff0c\u53ea\u662f\u4e0d\u63d0\u4f9b\u6570\u636e\u76f8\u5173\u670d\u52a1\uff0c\u901a\u5e38\u54e8\u5175\u7684\u6570\u91cf\u914d\u7f6e\u4e3a\u5355\u6570","title":"3.1.2 \u54e8\u5175\u4f5c\u7528"},{"location":"redis/day02/#32","text":"\u914d\u7f6e\u54e8\u5175 \u914d\u7f6e\u4e00\u62d6\u4e8c\u7684\u4e3b\u4ece\u7ed3\u6784\uff08\u5229\u7528\u4e4b\u524d\u7684\u65b9\u5f0f\u542f\u52a8\u5373\u53ef\uff09 \u914d\u7f6e\u4e09\u4e2a\u54e8\u5175\uff08\u914d\u7f6e\u76f8\u540c\uff0c\u7aef\u53e3\u4e0d\u540c\uff09\uff0c\u53c2\u770bsentinel.conf 1\uff1a\u8bbe\u7f6e\u54e8\u5175\u76d1\u542c\u7684\u4e3b\u670d\u52a1\u5668\u4fe1\u606f\uff0c sentinel_number\u8868\u793a\u53c2\u4e0e\u6295\u7968\u7684\u54e8\u5175\u6570\u91cf sentinel monitor master_name master_host master_port sentinel_number 2\uff1a\u8bbe\u7f6e\u5224\u5b9a\u670d\u52a1\u5668\u5b95\u673a\u65f6\u957f\uff0c\u8be5\u8bbe\u7f6e\u63a7\u5236\u662f\u5426\u8fdb\u884c\u4e3b\u4ece\u5207\u6362 sentinel down-after-milliseconds master_name million_seconds 3\uff1a\u8bbe\u7f6e\u6545\u969c\u5207\u6362\u7684\u6700\u5927\u8d85\u65f6\u65f6 sentinel failover-timeout master_name million_seconds 4\uff1a\u8bbe\u7f6e\u4e3b\u4ece\u5207\u6362\u540e\uff0c\u540c\u65f6\u8fdb\u884c\u6570\u636e\u540c\u6b65\u7684slave\u6570\u91cf\uff0c\u6570\u503c\u8d8a\u5927\uff0c\u8981\u6c42\u7f51\u7edc\u8d44\u6e90\u8d8a\u9ad8\uff0c\u6570\u503c\u8d8a\u5c0f\uff0c\u540c\u6b65\u65f6\u95f4\u8d8a\u957f sentinel parallel-syncs master_name sync_slave_number \u542f\u52a8\u54e8\u5175 redis-sentinel filename","title":"3.2 \u542f\u7528\u54e8\u5175"},{"location":"redis/day02/#33","text":"\u54e8\u5175\u5728\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\u8fc7\u7a0b\u4e2d\u7ecf\u5386\u4e09\u4e2a\u9636\u6bb5 \u76d1\u63a7 \u901a\u77e5 \u6545\u969c\u8f6c\u79fb","title":"3.3 \u54e8\u5175\u5de5\u4f5c\u539f\u7406"},{"location":"redis/day02/#331","text":"\u7528\u4e8e\u540c\u6b65\u5404\u4e2a\u8282\u70b9\u7684\u72b6\u6001\u4fe1\u606f \u83b7\u53d6\u5404\u4e2asentinel\u7684\u72b6\u6001\uff08\u662f\u5426\u5728\u7ebf\uff09 \u83b7\u53d6master\u7684\u72b6\u6001 master\u5c5e\u6027 prunid prole\uff1amaster \u5404\u4e2aslave\u7684\u8be6\u7ec6\u4fe1\u606f \u83b7\u53d6\u6240\u6709slave\u7684\u72b6\u6001\uff08\u6839\u636emaster\u4e2d\u7684slave\u4fe1\u606f\uff09 slave\u5c5e\u6027 prunid prole\uff1aslave pmaster_host\u3001master_port poffset \u5176\u5185\u90e8\u7684\u5de5\u4f5c\u539f\u7406\u5177\u4f53\u5982\u4e0b\uff1a","title":"3.3.1 \u76d1\u63a7"},{"location":"redis/day02/#332","text":"sentinel\u5728\u901a\u77e5\u9636\u6bb5\u8981\u4e0d\u65ad\u7684\u53bb\u83b7\u53d6master/slave\u7684\u4fe1\u606f\uff0c\u7136\u540e\u5728\u5404\u4e2asentinel\u4e4b\u95f4\u8fdb\u884c\u5171\u4eab\uff0c\u5177\u4f53\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a","title":"3.3.2 \u901a\u77e5"},{"location":"redis/day02/#333","text":"\u5f53master\u5b95\u673a\u540esentinel\u662f\u5982\u4f55\u77e5\u6653\u5e76\u5224\u65ad\u51famaster\u662f\u771f\u7684\u5b95\u673a\u4e86\u5462\uff1f\u6211\u4eec\u6765\u770b\u5177\u4f53\u7684\u64cd\u4f5c\u6d41\u7a0b \u5f53sentinel\u8ba4\u5b9amaster\u4e0b\u7ebf\u4e4b\u540e\uff0c\u6b64\u65f6\u9700\u8981\u51b3\u5b9a\u66f4\u6362master\uff0c\u90a3\u8fd9\u4ef6\u4e8b\u7531\u54ea\u4e2asentinel\u6765\u505a\u5462\uff1f\u8fd9\u65f6\u5019sentinel\u4e4b\u95f4\u8981\u8fdb\u884c\u9009\u4e3e\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u5728\u9009\u4e3e\u7684\u65f6\u5019\u6bcf\u4e00\u4e2a\u4eba\u624b\u91cc\u90fd\u6709\u4e00\u7968\uff0c\u800c\u6bcf\u4e00\u4e2a\u4eba\u7684\u53c8\u90fd\u60f3\u5f53\u8fd9\u4e2a\u5904\u7406\u4e8b\u6545\u7684\u4eba\uff0c\u90a3\u600e\u4e48\u529e\uff1f\u5927\u5bb6\u5c31\u5f00\u59cb\u62a2\uff0c\u4e8e\u662f\u6bcf\u4e2a\u4eba\u90fd\u4f1a\u53d1\u51fa\u4e00\u4e2a\u6307\u4ee4\uff0c\u5728\u5185\u7f51\u91cc\u8fb9\u544a\u8bc9\u5927\u5bb6\u6211\u8981\u5f53\u9009\u4e3e\u4eba\uff0c\u6bd4\u5982\u8bf4\u73b0\u5728\u7684sentinel1\u548csentinel4\u53d1\u51fa\u8fd9\u4e2a\u9009\u4e3e\u6307\u4ee4\u4e86\uff0c\u90a3\u4e48sentinel2\u65e2\u80fd\u63a5\u5230sentinel1\u7684\u4e5f\u80fd\u63a5\u5230sentinel4\u7684\uff0c\u63a5\u5230\u4e86\u4ed6\u4eec\u7684\u7533\u8bf7\u4ee5\u540e\u5462\uff0csentinel2\u4ed6\u5c31\u4f1a\u628a\u4ed6\u7684\u4e00\u7968\u6295\u7ed9\u5176\u4e2d\u4e00\u65b9\uff0c\u6295\u7ed9\u8c01\u5462\uff1f\u8c01\u5148\u8fc7\u6765\u6211\u6295\u7ed9\u8c01\uff0c\u5047\u8bbesentinel1\u5148\u8fc7\u6765\uff0c\u6240\u4ee5\u8fd9\u4e2a\u7968\u5c31\u7ed9\u5230\u4e86sentinel1\u3002\u90a3\u4e48\u7ed9\u8fc7\u53bb\u4ee5\u540e\u5462\uff0c\u73b0\u5728sentinel1\u5c31\u62ff\u5230\u4e86\u4e00\u7968\uff0c\u6309\u7167\u8fd9\u6837\u7684\u4e00\u79cd\u5f62\u5f0f\uff0c\u6700\u7ec8\u4f1a\u6709\u4e00\u4e2a\u9009\u4e3e\u7ed3\u679c\u3002\u5bf9\u5e94\u7684\u9009\u4e3e\u6700\u7ec8\u5f97\u7968\u591a\u7684\uff0c\u90a3\u81ea\u7136\u5c31\u6210\u4e3a\u4e86\u5904\u7406\u4e8b\u6545\u7684\u4eba\u3002\u9700\u8981\u6ce8\u610f\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u6709\u53ef\u80fd\u4f1a\u5b58\u5728\u5931\u8d25\u7684\u73b0\u8c61\uff0c\u5c31\u662f\u4e00\u8f6e\u9009\u4e3e\u5b8c\u6ca1\u6709\u9009\u53d6\uff0c\u90a3\u5c31\u4f1a\u63a5\u7740\u8fdb\u884c\u7b2c\u4e8c\u8f6e\u7b2c\u4e09\u8f6e\u76f4\u5230\u5b8c\u6210\u9009\u4e3e\u3002 \u63a5\u4e0b\u6765\u5c31\u662f\u7531\u9009\u4e3e\u80dc\u51fa\u7684sentinel\u53bb\u4eceslave\u4e2d\u9009\u4e00\u4e2a\u65b0\u7684master\u51fa\u6765\u7684\u5de5\u4f5c\uff0c\u8fd9\u4e2a\u6d41\u7a0b\u662f\u4ec0\u4e48\u6837\u7684\u5462\uff1f \u9996\u5148\u5b83\u6709\u4e00\u4e2a\u5728\u670d\u52a1\u5668\u5217\u8868\u4e2d\u6311\u9009\u5907\u9009master\u7684\u539f\u5219 \u4e0d\u5728\u7ebf\u7684OUT \u54cd\u5e94\u6162\u7684OUT \u4e0e\u539fmaster\u65ad\u5f00\u65f6\u95f4\u4e45\u7684OUT \u4f18\u5148\u539f\u5219 \u4f18\u5148\u7ea7 offset runid \u9009\u51fa\u65b0\u7684master\u4e4b\u540e\uff0c\u53d1\u9001\u6307\u4ee4\uff08 sentinel \uff09\u7ed9\u5176\u4ed6\u7684slave\uff1a \u5411\u65b0\u7684master\u53d1\u9001slaveof no one \u5411\u5176\u4ed6slave\u53d1\u9001slaveof \u65b0masterIP\u7aef\u53e3 \u603b\u7ed3 \uff1a\u6545\u969c\u8f6c\u79fb\u9636\u6bb5 \u53d1\u73b0\u95ee\u9898\uff0c\u4e3b\u89c2\u4e0b\u7ebf\u4e0e\u5ba2\u89c2\u4e0b\u7ebf \u7ade\u9009\u8d1f\u8d23\u4eba \u4f18\u9009\u65b0master \u65b0master\u4e0a\u4efb\uff0c\u5176\u4ed6slave\u5207\u6362master\uff0c\u539fmaster\u4f5c\u4e3aslave\u6545\u969c\u6062\u590d\u540e\u8fde\u63a5","title":"3.3.3 \u6545\u969c\u8f6c\u79fb"},{"location":"redis/day02/#4cluster","text":"\u73b0\u72b6\u95ee\u9898\uff1a\u4e1a\u52a1\u53d1\u5c55\u8fc7\u7a0b\u4e2d\u9047\u5230\u7684\u5cf0\u503c\u74f6\u9888 redis\u63d0\u4f9b\u7684\u670d\u52a1OPS\u53ef\u4ee5\u8fbe\u523010\u4e07/\u79d2\uff0c\u5f53\u524d\u4e1a\u52a1OPS\u5df2\u7ecf\u8fbe\u523010\u4e07/\u79d2 \u5185\u5b58\u5355\u673a\u5bb9\u91cf\u8fbe\u5230256G\uff0c\u5f53\u524d\u4e1a\u52a1\u9700\u6c42\u5185\u5b58\u5bb9\u91cf1T \u4f7f\u7528\u96c6\u7fa4\u7684\u65b9\u5f0f\u53ef\u4ee5\u5feb\u901f\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898","title":"4.\u96c6\u7fa4cluster"},{"location":"redis/day02/#41","text":"\u96c6\u7fa4\u5c31\u662f\u4f7f\u7528\u7f51\u7edc\u5c06\u82e5\u5e72\u53f0\u8ba1\u7b97\u673a\u8054\u901a\u8d77\u6765\uff0c\u5e76\u63d0\u4f9b\u7edf\u4e00\u7684\u7ba1\u7406\u65b9\u5f0f\uff0c\u4f7f\u5176\u5bf9\u5916\u5448\u73b0\u5355\u673a\u7684\u670d\u52a1\u6548\u679c \u96c6\u7fa4\u4f5c\u7528\uff1a \u5206\u6563\u5355\u53f0\u670d\u52a1\u5668\u7684\u8bbf\u95ee\u538b\u529b\uff0c\u5b9e\u73b0\u8d1f\u8f7d\u5747\u8861 \u5206\u6563\u5355\u53f0\u670d\u52a1\u5668\u7684\u5b58\u50a8\u538b\u529b\uff0c\u5b9e\u73b0\u53ef\u6269\u5c55\u6027 \u964d\u4f4e\u5355\u53f0\u670d\u52a1\u5668\u5b95\u673a\u5e26\u6765\u7684\u4e1a\u52a1\u707e\u96be","title":"4.1 \u96c6\u7fa4\u7b80\u4ecb"},{"location":"redis/day02/#42_cluster","text":"\u6570\u636e\u5b58\u50a8\u8bbe\u8ba1\uff1a \u901a\u8fc7\u7b97\u6cd5\u8bbe\u8ba1\uff0c\u8ba1\u7b97\u51fakey\u5e94\u8be5\u4fdd\u5b58\u7684\u4f4d\u7f6e \u5c06\u6240\u6709\u7684\u5b58\u50a8\u7a7a\u95f4\u8ba1\u5212\u5207\u5272\u621016384\u4efd\uff0c\u6bcf\u53f0\u4e3b\u673a\u4fdd\u5b58\u4e00\u90e8\u5206 \u6ce8\u610f\uff1a\u6bcf\u4efd\u4ee3\u8868\u7684\u662f\u4e00\u4e2a\u5b58\u50a8\u7a7a\u95f4\uff0c\u4e0d\u662f\u4e00\u4e2akey\u7684\u4fdd\u5b58\u7a7a\u95f4 \u5c06key\u6309\u7167\u8ba1\u7b97\u51fa\u7684\u7ed3\u679c\u653e\u5230\u5bf9\u5e94\u7684\u5b58\u50a8\u7a7a\u95f4 \u90a3redis\u7684\u96c6\u7fa4\u662f\u5982\u4f55\u589e\u5f3a\u53ef\u6269\u5c55\u6027\u7684\u5462\uff1f\u8b6c\u5982\u6211\u4eec\u8981\u589e\u52a0\u4e00\u4e2a\u96c6\u7fa4\u8282\u70b9 \u5f53\u6211\u4eec\u67e5\u627e\u6570\u636e\u65f6\uff0c\u96c6\u7fa4\u662f\u5982\u4f55\u64cd\u4f5c\u7684\u5462\uff1f \u5404\u4e2a\u6570\u636e\u5e93\u76f8\u4e92\u901a\u4fe1\uff0c\u4fdd\u5b58\u5404\u4e2a\u5e93\u4e2d\u69fd\u7684\u7f16\u53f7\u6570\u636e \u4e00\u6b21\u547d\u4e2d\uff0c\u76f4\u63a5\u8fd4\u56de \u4e00\u6b21\u672a\u547d\u4e2d\uff0c\u544a\u77e5\u5177\u4f53\u4f4d\u7f6e","title":"4.2 Cluster\u96c6\u7fa4\u7ed3\u6784\u8bbe\u8ba1"},{"location":"redis/day02/#43_cluster","text":"\u9996\u5148\u8981\u660e\u786e\u7684\u51e0\u4e2a\u8981\u70b9\uff1a \u914d\u7f6e\u670d\u52a1\u5668\uff083\u4e3b3\u4ece\uff09 \u5efa\u7acb\u901a\u4fe1\uff08Meet\uff09 \u5206\u69fd\uff08Slot\uff09 \u642d\u5efa\u4e3b\u4ece\uff08master-slave\uff09 Cluster\u914d\u7f6e \u662f\u5426\u542f\u7528cluster\uff0c\u52a0\u5165cluster\u8282\u70b9 cluster-enabled yes|no cluster\u914d\u7f6e\u6587\u4ef6\u540d\uff0c\u8be5\u6587\u4ef6\u5c5e\u4e8e\u81ea\u52a8\u751f\u6210\uff0c\u4ec5\u7528\u4e8e\u5feb\u901f\u67e5\u627e\u6587\u4ef6\u5e76\u67e5\u8be2\u6587\u4ef6\u5185\u5bb9 cluster-config-file filename \u8282\u70b9\u670d\u52a1\u54cd\u5e94\u8d85\u65f6\u65f6\u95f4\uff0c\u7528\u4e8e\u5224\u5b9a\u8be5\u8282\u70b9\u662f\u5426\u4e0b\u7ebf\u6216\u5207\u6362\u4e3a\u4ece\u8282\u70b9 cluster-node-timeout milliseconds master\u8fde\u63a5\u7684slave\u6700\u5c0f\u6570\u91cf cluster-migration-barrier min_slave_number Cluster\u8282\u70b9\u64cd\u4f5c\u547d\u4ee4 \u67e5\u770b\u96c6\u7fa4\u8282\u70b9\u4fe1\u606f cluster nodes \u66f4\u6539slave\u6307\u5411\u65b0\u7684master cluster replicate master-id \u53d1\u73b0\u4e00\u4e2a\u65b0\u8282\u70b9\uff0c\u65b0\u589emaster cluster meet ip : port \u5ffd\u7565\u4e00\u4e2a\u6ca1\u6709solt\u7684\u8282\u70b9 cluster forget server_id \u624b\u52a8\u6545\u969c\u8f6c\u79fb cluster failover \u96c6\u7fa4\u64cd\u4f5c\u547d\u4ee4\uff1a \u521b\u5efa\u96c6\u7fa4 redis-cli \u2013-cluster create masterhost1 : masterport1 masterhost2:masterport2 masterhost3:masterport3 [masterhostn:masterportn \u2026] slavehost1:slaveport1 slavehost2:slaveport2 slavehost3:slaveport3 -\u2013cluster-replicas n \u6ce8\u610f\uff1amaster\u4e0eslave\u7684\u6570\u91cf\u8981\u5339\u914d\uff0c\u4e00\u4e2amaster\u5bf9\u5e94n\u4e2aslave\uff0c\u7531\u6700\u540e\u7684\u53c2\u6570n\u51b3\u5b9a master\u4e0eslave\u7684\u5339\u914d\u987a\u5e8f\u4e3a\u7b2c\u4e00\u4e2amaster\u4e0e\u524dn\u4e2aslave\u5206\u4e3a\u4e00\u7ec4\uff0c\u5f62\u6210\u4e3b\u4ece\u7ed3\u6784 \u6dfb\u52a0master\u5230\u5f53\u524d\u96c6\u7fa4\u4e2d\uff0c\u8fde\u63a5\u65f6\u53ef\u4ee5\u6307\u5b9a\u4efb\u610f\u73b0\u6709\u8282\u70b9\u5730\u5740\u4e0e\u7aef\u53e3 redis-cli --cluster add-node new-master-host : new-master-port now-host:now-port \u6dfb\u52a0slave redis-cli --cluster add-node new-slave-host : new-slave-port master-host:master-port --cluster-slave --cluster-master-id masterid \u5220\u9664\u8282\u70b9\uff0c\u5982\u679c\u5220\u9664\u7684\u8282\u70b9\u662fmaster\uff0c\u5fc5\u987b\u4fdd\u969c\u5176\u4e2d\u6ca1\u6709\u69fdslot redis-cli --cluster del-node del-slave-host : del-slave-port del-slave-id \u91cd\u65b0\u5206\u69fd\uff0c\u5206\u69fd\u662f\u4ece\u5177\u6709\u69fd\u7684master\u4e2d\u5212\u5206\u4e00\u90e8\u5206\u7ed9\u5176\u4ed6master\uff0c\u8fc7\u7a0b\u4e2d\u4e0d\u521b\u5efa\u65b0\u7684\u69fd redis-cli --cluster reshard new-master-host : new-master:port --cluster-from src- master-id1, src-master-id2, src-master-idn --cluster-to target-master-id -- cluster-slots slots \u6ce8\u610f\uff1a\u5c06\u9700\u8981\u53c2\u4e0e\u5206\u69fd\u7684\u6240\u6709masterid\u4e0d\u5206\u5148\u540e\u987a\u5e8f\u6dfb\u52a0\u5230\u53c2\u6570\u4e2d\uff0c\u4f7f\u7528\uff0c\u5206\u9694 \u6307\u5b9a\u76ee\u6807\u5f97\u5230\u7684\u69fd\u7684\u6570\u91cf\uff0c\u6240\u6709\u7684\u69fd\u5c06\u5e73\u5747\u4ece\u6bcf\u4e2a\u6765\u6e90\u7684master\u5904\u83b7\u53d6 \u91cd\u65b0\u5206\u914d\u69fd\uff0c\u4ece\u5177\u6709\u69fd\u7684master\u4e2d\u5206\u914d\u6307\u5b9a\u6570\u91cf\u7684\u69fd\u5230\u53e6\u4e00\u4e2amaster\u4e2d\uff0c\u5e38\u7528\u4e8e\u6e05\u7a7a\u6307\u5b9amaster\u4e2d\u7684\u69fd redis-cli --cluster reshard src-master-host : src-master-port --cluster-from src- master-id --cluster-to target-master-id --cluster-slots slots --cluster-yes","title":"4.3 Cluster\u96c6\u7fa4\u7ed3\u6784\u642d\u5efa"},{"location":"redis/day02/#5","text":"","title":"5.\u4f01\u4e1a\u7ea7\u89e3\u51b3\u65b9\u6848"},{"location":"redis/day02/#51","text":"\u573a\u666f \uff1a\u201c\u5b95\u673a\u201d \u670d\u52a1\u5668\u542f\u52a8\u540e\u8fc5\u901f\u5b95\u673a \u95ee\u9898\u6392\u67e5 \uff1a 1.\u8bf7\u6c42\u6570\u91cf\u8f83\u9ad8\uff0c\u5927\u91cf\u7684\u8bf7\u6c42\u8fc7\u6765\u4e4b\u540e\u90fd\u9700\u8981\u53bb\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u6570\u636e\uff0c\u4f46\u662f\u7f13\u5b58\u4e2d\u53c8\u6ca1\u6709\uff0c\u6b64\u65f6\u4ece\u6570\u636e\u5e93\u4e2d\u67e5\u627e\u6570\u636e\u7136\u540e\u5c06\u6570\u636e\u518d\u5b58\u5165\u7f13\u5b58\uff0c\u9020\u6210\u4e86\u77ed\u671f\u5185\u5bf9redis\u7684\u9ad8\u5f3a\u5ea6\u64cd\u4f5c\u4ece\u800c\u5bfc\u81f4\u95ee\u9898 2.\u4e3b\u4ece\u4e4b\u95f4\u6570\u636e\u541e\u5410\u91cf\u8f83\u5927\uff0c\u6570\u636e\u540c\u6b65\u64cd\u4f5c\u9891\u5ea6\u8f83\u9ad8 \u89e3\u51b3\u65b9\u6848\uff1a \u524d\u7f6e\u51c6\u5907\u5de5\u4f5c\uff1a 1.\u65e5\u5e38\u4f8b\u884c\u7edf\u8ba1\u6570\u636e\u8bbf\u95ee\u8bb0\u5f55\uff0c\u7edf\u8ba1\u8bbf\u95ee\u9891\u5ea6\u8f83\u9ad8\u7684\u70ed\u70b9\u6570\u636e 2.\u5229\u7528LRU\u6570\u636e\u5220\u9664\u7b56\u7565\uff0c\u6784\u5efa\u6570\u636e\u7559\u5b58\u961f\u5217\u4f8b\u5982\uff1astorm\u4e0ekafka\u914d\u5408 \u51c6\u5907\u5de5\u4f5c\uff1a 1.\u5c06\u7edf\u8ba1\u7ed3\u679c\u4e2d\u7684\u6570\u636e\u5206\u7c7b\uff0c\u6839\u636e\u7ea7\u522b\uff0credis\u4f18\u5148\u52a0\u8f7d\u7ea7\u522b\u8f83\u9ad8\u7684\u70ed\u70b9\u6570\u636e 2.\u5229\u7528\u5206\u5e03\u5f0f\u591a\u670d\u52a1\u5668\u540c\u65f6\u8fdb\u884c\u6570\u636e\u8bfb\u53d6\uff0c\u63d0\u901f\u6570\u636e\u52a0\u8f7d\u8fc7\u7a0b 3.\u70ed\u70b9\u6570\u636e\u4e3b\u4ece\u540c\u65f6\u9884\u70ed \u5b9e\u65bd\uff1a 4.\u4f7f\u7528\u811a\u672c\u7a0b\u5e8f\u56fa\u5b9a\u89e6\u53d1\u6570\u636e\u9884\u70ed\u8fc7\u7a0b 5.\u5982\u679c\u6761\u4ef6\u5141\u8bb8\uff0c\u4f7f\u7528\u4e86CDN\uff08\u5185\u5bb9\u5206\u53d1\u7f51\u7edc\uff09\uff0c\u6548\u679c\u4f1a\u66f4\u597d \u603b\u7684\u6765\u8bf4 \uff1a\u7f13\u5b58\u9884\u70ed\u5c31\u662f\u7cfb\u7edf\u542f\u52a8\u524d\uff0c\u63d0\u524d\u5c06\u76f8\u5173\u7684\u7f13\u5b58\u6570\u636e\u76f4\u63a5\u52a0\u8f7d\u5230\u7f13\u5b58\u7cfb\u7edf\u3002\u907f\u514d\u5728\u7528\u6237\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u5148\u67e5\u8be2\u6570\u636e\u5e93\uff0c\u7136\u540e\u518d\u5c06\u6570\u636e\u7f13\u5b58\u7684\u95ee\u9898\uff01\u7528\u6237\u76f4\u63a5\u67e5\u8be2\u4e8b\u5148\u88ab\u9884\u70ed\u7684\u7f13\u5b58\u6570\u636e\uff01","title":"5.1 \u7f13\u5b58\u9884\u70ed"},{"location":"redis/day02/#52","text":"\u573a\u666f \uff1a\u6570\u636e\u5e93\u670d\u52a1\u5668\u5d29\u6e83\uff0c\u4e00\u8fde\u4e32\u7684\u573a\u666f\u4f1a\u968f\u4e4b\u513f\u6765 1.\u7cfb\u7edf\u5e73\u7a33\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u5ffd\u7136\u6570\u636e\u5e93\u8fde\u63a5\u91cf\u6fc0\u589e 2.\u5e94\u7528\u670d\u52a1\u5668\u65e0\u6cd5\u53ca\u65f6\u5904\u7406\u8bf7\u6c42 3.\u5927\u91cf408\uff0c500\u9519\u8bef\u9875\u9762\u51fa\u73b0 4.\u5ba2\u6237\u53cd\u590d\u5237\u65b0\u9875\u9762\u83b7\u53d6\u6570\u636e 5.\u6570\u636e\u5e93\u5d29\u6e83 6.\u5e94\u7528\u670d\u52a1\u5668\u5d29\u6e83 7.\u91cd\u542f\u5e94\u7528\u670d\u52a1\u5668\u65e0\u6548 8.Redis\u670d\u52a1\u5668\u5d29\u6e83 9.Redis\u96c6\u7fa4\u5d29\u6e83 10.\u91cd\u542f\u6570\u636e\u5e93\u540e\u518d\u6b21\u88ab\u77ac\u95f4\u6d41\u91cf\u653e\u5012 \u95ee\u9898\u6392\u67e5 \uff1a 1.\u5728\u4e00\u4e2a\u8f83\u77ed\u7684\u65f6\u95f4\u5185\uff0c\u7f13\u5b58\u4e2d\u8f83\u591a\u7684key\u96c6\u4e2d\u8fc7\u671f 2.\u6b64\u5468\u671f\u5185\u8bf7\u6c42\u8bbf\u95ee\u8fc7\u671f\u7684\u6570\u636e\uff0credis\u672a\u547d\u4e2d\uff0credis\u5411\u6570\u636e\u5e93\u83b7\u53d6\u6570\u636e 3.\u6570\u636e\u5e93\u540c\u65f6\u63a5\u6536\u5230\u5927\u91cf\u7684\u8bf7\u6c42\u65e0\u6cd5\u53ca\u65f6\u5904\u7406 4.Redis\u5927\u91cf\u8bf7\u6c42\u88ab\u79ef\u538b\uff0c\u5f00\u59cb\u51fa\u73b0\u8d85\u65f6\u73b0\u8c61 5.\u6570\u636e\u5e93\u6d41\u91cf\u6fc0\u589e\uff0c\u6570\u636e\u5e93\u5d29\u6e83 6.\u91cd\u542f\u540e\u4ecd\u7136\u9762\u5bf9\u7f13\u5b58\u4e2d\u65e0\u6570\u636e\u53ef\u7528 7.Redis\u670d\u52a1\u5668\u8d44\u6e90\u88ab\u4e25\u91cd\u5360\u7528\uff0cRedis\u670d\u52a1\u5668\u5d29\u6e83 8.Redis\u96c6\u7fa4\u5448\u73b0\u5d29\u584c\uff0c\u96c6\u7fa4\u74e6\u89e3 9.\u5e94\u7528\u670d\u52a1\u5668\u65e0\u6cd5\u53ca\u65f6\u5f97\u5230\u6570\u636e\u54cd\u5e94\u8bf7\u6c42\uff0c\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u6570\u91cf\u8d8a\u6765\u8d8a\u591a\uff0c\u5e94\u7528\u670d\u52a1\u5668\u5d29\u6e83 10.\u5e94\u7528\u670d\u52a1\u5668\uff0credis\uff0c\u6570\u636e\u5e93\u5168\u90e8\u91cd\u542f\uff0c\u6548\u679c\u4e0d\u7406\u60f3 \u603b\u800c\u8a00\u4e4b\u5c31\u4e24\u70b9\uff1a\u77ed\u65f6\u95f4\u8303\u56f4\u5185\uff0c\u5927\u91cfkey\u96c6\u4e2d\u8fc7\u671f \u89e3\u51b3\u65b9\u6848 \u601d\u8def\uff1a 1.\u66f4\u591a\u7684\u9875\u9762\u9759\u6001\u5316\u5904\u7406 2.\u6784\u5efa\u591a\u7ea7\u7f13\u5b58\u67b6\u6784 Nginx\u7f13\u5b58+redis\u7f13\u5b58+ehcache\u7f13\u5b58 3.\u68c0\u6d4bMysql\u4e25\u91cd\u8017\u65f6\u4e1a\u52a1\u8fdb\u884c\u4f18\u5316 \u5bf9\u6570\u636e\u5e93\u7684\u74f6\u9888\u6392\u67e5\uff1a\u4f8b\u5982\u8d85\u65f6\u67e5\u8be2\u3001\u8017\u65f6\u8f83\u9ad8\u4e8b\u52a1\u7b49 4.\u707e\u96be\u9884\u8b66\u673a\u5236 \u76d1\u63a7redis\u670d\u52a1\u5668\u6027\u80fd\u6307\u6807 CPU\u5360\u7528\u3001CPU\u4f7f\u7528\u7387 \u5185\u5b58\u5bb9\u91cf \u67e5\u8be2\u5e73\u5747\u54cd\u5e94\u65f6\u95f4 \u7ebf\u7a0b\u6570 5.\u9650\u6d41\u3001\u964d\u7ea7 \u77ed\u65f6\u95f4\u8303\u56f4\u5185\u727a\u7272\u4e00\u4e9b\u5ba2\u6237\u4f53\u9a8c\uff0c\u9650\u5236\u4e00\u90e8\u5206\u8bf7\u6c42\u8bbf\u95ee\uff0c\u964d\u4f4e\u5e94\u7528\u670d\u52a1\u5668\u538b\u529b\uff0c\u5f85\u4e1a\u52a1\u4f4e\u901f\u8fd0\u8f6c\u540e\u518d\u9010\u6b65\u653e\u5f00\u8bbf\u95ee \u843d\u5730\u5b9e\u8df5\uff1a 1.LRU\u4e0eLFU\u5207\u6362 2.\u6570\u636e\u6709\u6548\u671f\u7b56\u7565\u8c03\u6574 \u6839\u636e\u4e1a\u52a1\u6570\u636e\u6709\u6548\u671f\u8fdb\u884c\u5206\u7c7b\u9519\u5cf0\uff0cA\u7c7b90\u5206\u949f\uff0cB\u7c7b80\u5206\u949f\uff0cC\u7c7b70\u5206\u949f \u8fc7\u671f\u65f6\u95f4\u4f7f\u7528\u56fa\u5b9a\u65f6\u95f4+\u968f\u673a\u503c\u7684\u5f62\u5f0f\uff0c\u7a00\u91ca\u96c6\u4e2d\u5230\u671f\u7684key\u7684\u6570\u91cf 3.\u8d85\u70ed\u6570\u636e\u4f7f\u7528\u6c38\u4e45key 4.\u5b9a\u671f\u7ef4\u62a4\uff08\u81ea\u52a8+\u4eba\u5de5\uff09 \u5bf9\u5373\u5c06\u8fc7\u671f\u6570\u636e\u505a\u8bbf\u95ee\u91cf\u5206\u6790\uff0c\u786e\u8ba4\u662f\u5426\u5ef6\u65f6\uff0c\u914d\u5408\u8bbf\u95ee\u91cf\u7edf\u8ba1\uff0c\u505a\u70ed\u70b9\u6570\u636e\u7684\u5ef6\u65f6 5.\u52a0\u9501\uff1a\u614e\u7528\uff01 \u603b\u7684\u6765\u8bf4 \uff1a\u7f13\u5b58\u96ea\u5d29\u5c31\u662f\u77ac\u95f4\u8fc7\u671f\u6570\u636e\u91cf\u592a\u5927\uff0c\u5bfc\u81f4\u5bf9\u6570\u636e\u5e93\u670d\u52a1\u5668\u9020\u6210\u538b\u529b\u3002\u5982\u80fd\u591f\u6709\u6548\u907f\u514d\u8fc7\u671f\u65f6\u95f4\u96c6\u4e2d\uff0c\u53ef\u4ee5\u6709\u6548\u89e3\u51b3\u96ea\u5d29\u73b0\u8c61\u7684 \u51fa\u73b0\uff08\u7ea640%\uff09\uff0c\u914d\u5408\u5176\u4ed6\u7b56\u7565\u4e00\u8d77\u4f7f\u7528\uff0c\u5e76\u76d1\u63a7\u670d\u52a1\u5668\u7684\u8fd0\u884c\u6570\u636e\uff0c\u6839\u636e\u8fd0\u884c\u8bb0\u5f55\u505a\u5feb\u901f\u8c03\u6574\u3002","title":"5.2 \u7f13\u5b58\u96ea\u5d29"},{"location":"redis/day02/#53","text":"\u573a\u666f \uff1a\u8fd8\u662f\u6570\u636e\u5e93\u670d\u52a1\u5668\u5d29\u6e83\uff0c\u4f46\u662f\u8ddf\u4e4b\u524d\u7684\u573a\u666f\u6709\u70b9\u4e0d\u592a\u4e00\u6837 1.\u7cfb\u7edf\u5e73\u7a33\u8fd0\u884c\u8fc7\u7a0b\u4e2d 2.\u6570\u636e\u5e93\u8fde\u63a5\u91cf\u77ac\u95f4\u6fc0\u589e 3.Redis\u670d\u52a1\u5668\u65e0\u5927\u91cfkey\u8fc7\u671f 4.Redis\u5185\u5b58\u5e73\u7a33\uff0c\u65e0\u6ce2\u52a8 5.Redis\u670d\u52a1\u5668CPU\u6b63\u5e38 6.\u6570\u636e\u5e93\u5d29\u6e83 \u95ee\u9898\u6392\u67e5\uff1a 1.Redis\u4e2d\u67d0\u4e2akey\u8fc7\u671f\uff0c\u8be5key\u8bbf\u95ee\u91cf\u5de8\u5927 2.\u591a\u4e2a\u6570\u636e\u8bf7\u6c42\u4ece\u670d\u52a1\u5668\u76f4\u63a5\u538b\u5230Redis\u540e\uff0c\u5747\u672a\u547d\u4e2d 3.Redis\u5728\u77ed\u65f6\u95f4\u5185\u53d1\u8d77\u4e86\u5927\u91cf\u5bf9\u6570\u636e\u5e93\u4e2d\u540c\u4e00\u6570\u636e\u7684\u8bbf\u95ee \u603b\u800c\u8a00\u4e4b\u5c31\u4e24\u70b9\uff1a\u5355\u4e2akey\u9ad8\u70ed\u6570\u636e\uff0ckey\u8fc7\u671f \u89e3\u51b3\u65b9\u6848 \uff1a 1.\u9884\u5148\u8bbe\u5b9a \u4ee5\u7535\u5546\u4e3a\u4f8b\uff0c\u6bcf\u4e2a\u5546\u5bb6\u6839\u636e\u5e97\u94fa\u7b49\u7ea7\uff0c\u6307\u5b9a\u82e5\u5e72\u6b3e\u4e3b\u6253\u5546\u54c1\uff0c\u5728\u8d2d\u7269\u8282\u671f\u95f4\uff0c\u52a0\u5927\u6b64\u7c7b\u4fe1\u606fkey\u7684\u8fc7\u671f\u65f6\u957f \u6ce8\u610f\uff1a\u8d2d\u7269\u8282\u4e0d\u4ec5\u4ec5\u6307\u5f53\u5929\uff0c\u4ee5\u53ca\u540e\u7eed\u82e5\u5e72\u5929\uff0c\u8bbf\u95ee\u5cf0\u503c\u5448\u73b0\u9010\u6e10\u964d\u4f4e\u7684\u8d8b\u52bf 2.\u73b0\u573a\u8c03\u6574 \u76d1\u63a7\u8bbf\u95ee\u91cf\uff0c\u5bf9\u81ea\u7136\u6d41\u91cf\u6fc0\u589e\u7684\u6570\u636e\u5ef6\u957f\u8fc7\u671f\u65f6\u95f4\u6216\u8bbe\u7f6e\u4e3a\u6c38\u4e45\u6027key 3.\u540e\u53f0\u5237\u65b0\u6570\u636e \u542f\u52a8\u5b9a\u65f6\u4efb\u52a1\uff0c\u9ad8\u5cf0\u671f\u6765\u4e34\u4e4b\u524d\uff0c\u5237\u65b0\u6570\u636e\u6709\u6548\u671f\uff0c\u786e\u4fdd\u4e0d\u4e22\u5931 4.\u4e8c\u7ea7\u7f13\u5b58 \u8bbe\u7f6e\u4e0d\u540c\u7684\u5931\u6548\u65f6\u95f4\uff0c\u4fdd\u969c\u4e0d\u4f1a\u88ab\u540c\u65f6\u6dd8\u6c70\u5c31\u884c 5.\u52a0\u9501 \u5206\u5e03\u5f0f\u9501\uff0c\u9632\u6b62\u88ab\u51fb\u7a7f\uff0c\u4f46\u662f\u8981\u6ce8\u610f\u4e5f\u662f\u6027\u80fd\u74f6\u9888\uff0c\u614e\u91cd\uff01 \u603b\u7684\u6765\u8bf4 \uff1a\u7f13\u5b58\u51fb\u7a7f\u5c31\u662f\u5355\u4e2a\u9ad8\u70ed\u6570\u636e\u8fc7\u671f\u7684\u77ac\u95f4\uff0c\u6570\u636e\u8bbf\u95ee\u91cf\u8f83\u5927\uff0c\u672a\u547d\u4e2dredis\u540e\uff0c\u53d1\u8d77\u4e86\u5927\u91cf\u5bf9\u540c\u4e00\u6570\u636e\u7684\u6570\u636e\u5e93\u8bbf\u95ee\uff0c\u5bfc\u81f4\u5bf9\u6570 \u636e\u5e93\u670d\u52a1\u5668\u9020\u6210\u538b\u529b\u3002\u5e94\u5bf9\u7b56\u7565\u5e94\u8be5\u5728\u4e1a\u52a1\u6570\u636e\u5206\u6790\u4e0e\u9884\u9632\u65b9\u9762\u8fdb\u884c\uff0c\u914d\u5408\u8fd0\u884c\u76d1\u63a7\u6d4b\u8bd5\u4e0e\u5373\u65f6\u8c03\u6574\u7b56\u7565\uff0c\u6bd5\u7adf\u5355\u4e2akey\u7684\u8fc7 \u671f\u76d1\u63a7\u96be\u5ea6\u8f83\u9ad8\uff0c\u914d\u5408\u96ea\u5d29\u5904\u7406\u7b56\u7565\u5373\u53ef\u3002","title":"5.3 \u7f13\u5b58\u51fb\u7a7f"},{"location":"redis/day02/#54","text":"\u573a\u666f \uff1a\u6570\u636e\u5e93\u670d\u52a1\u5668\u53c8\u5d29\u6e83\u4e86\uff0c\u8ddf\u4e4b\u524d\u7684\u4e00\u6837\u5417\uff1f 1.\u7cfb\u7edf\u5e73\u7a33\u8fd0\u884c\u8fc7\u7a0b\u4e2d 2.\u5e94\u7528\u670d\u52a1\u5668\u6d41\u91cf\u968f\u65f6\u95f4\u589e\u91cf\u8f83\u5927 3.Redis\u670d\u52a1\u5668\u547d\u4e2d\u7387\u968f\u65f6\u95f4\u9010\u6b65\u964d\u4f4e 4.Redis\u5185\u5b58\u5e73\u7a33\uff0c\u5185\u5b58\u65e0\u538b\u529b 5.Redis\u670d\u52a1\u5668CPU\u5360\u7528\u6fc0\u589e 6.\u6570\u636e\u5e93\u670d\u52a1\u5668\u538b\u529b\u6fc0\u589e 7.\u6570\u636e\u5e93\u5d29\u6e83 \u95ee\u9898\u6392\u67e5\uff1a 1.Redis\u4e2d\u5927\u9762\u79ef\u51fa\u73b0\u672a\u547d\u4e2d 2.\u51fa\u73b0\u975e\u6b63\u5e38URL\u8bbf\u95ee \u95ee\u9898\u5206\u6790 \uff1a \u83b7\u53d6\u7684\u6570\u636e\u5728\u6570\u636e\u5e93\u4e2d\u4e5f\u4e0d\u5b58\u5728\uff0c\u6570\u636e\u5e93\u67e5\u8be2\u672a\u5f97\u5230\u5bf9\u5e94\u6570\u636e Redis\u83b7\u53d6\u5230null\u6570\u636e\u672a\u8fdb\u884c\u6301\u4e45\u5316\uff0c\u76f4\u63a5\u8fd4\u56de \u4e0b\u6b21\u6b64\u7c7b\u6570\u636e\u5230\u8fbe\u91cd\u590d\u4e0a\u8ff0\u8fc7\u7a0b \u51fa\u73b0\u9ed1\u5ba2\u653b\u51fb\u670d\u52a1\u5668 \u89e3\u51b3\u65b9\u6848 \uff1a 1.\u7f13\u5b58null \u5bf9\u67e5\u8be2\u7ed3\u679c\u4e3anull\u7684\u6570\u636e\u8fdb\u884c\u7f13\u5b58\uff08\u957f\u671f\u4f7f\u7528\uff0c\u5b9a\u671f\u6e05\u7406\uff09\uff0c\u8bbe\u5b9a\u77ed\u65f6\u9650\uff0c\u4f8b\u598230-60\u79d2\uff0c\u6700\u9ad85\u5206\u949f 2.\u767d\u540d\u5355\u7b56\u7565 \u63d0\u524d\u9884\u70ed\u5404\u79cd\u5206\u7c7b\u6570\u636eid\u5bf9\u5e94\u7684bitmaps\uff0cid\u4f5c\u4e3abitmaps\u7684offset\uff0c\u76f8\u5f53\u4e8e\u8bbe\u7f6e\u4e86\u6570\u636e\u767d\u540d\u5355\u3002\u5f53\u52a0\u8f7d\u6b63\u5e38\u6570\u636e\u65f6\u653e\u884c\uff0c\u52a0\u8f7d\u5f02\u5e38\u6570\u636e\u65f6\u76f4\u63a5\u62e6\u622a\uff08\u6548\u7387\u504f\u4f4e\uff09 \u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\uff08\u6709\u5173\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u547d\u4e2d\u95ee\u9898\u5bf9\u5f53\u524d\u72b6\u51b5\u53ef\u4ee5\u5ffd\u7565\uff09 2.\u5b9e\u65bd\u76d1\u63a7 \u5b9e\u65f6\u76d1\u63a7redis\u547d\u4e2d\u7387\uff08\u4e1a\u52a1\u6b63\u5e38\u8303\u56f4\u65f6\uff0c\u901a\u5e38\u4f1a\u6709\u4e00\u4e2a\u6ce2\u52a8\u503c\uff09\u4e0enull\u6570\u636e\u7684\u5360\u6bd4 \u975e\u6d3b\u52a8\u65f6\u6bb5\u6ce2\u52a8\uff1a\u901a\u5e38\u68c0\u6d4b3-5\u500d\uff0c\u8d85\u8fc75\u500d\u7eb3\u5165\u91cd\u70b9\u6392\u67e5\u5bf9\u8c61 \u6d3b\u52a8\u65f6\u6bb5\u6ce2\u52a8\uff1a\u901a\u5e38\u68c0\u6d4b10-50\u500d\uff0c\u8d85\u8fc750\u500d\u7eb3\u5165\u91cd\u70b9\u6392\u67e5\u5bf9\u8c61 \u6839\u636e\u500d\u6570\u4e0d\u540c\uff0c\u542f\u52a8\u4e0d\u540c\u7684\u6392\u67e5\u6d41\u7a0b\u3002\u7136\u540e\u4f7f\u7528\u9ed1\u540d\u5355\u8fdb\u884c\u9632\u63a7\uff08\u8fd0\u8425\uff09 4.key\u52a0\u5bc6 \u95ee\u9898\u51fa\u73b0\u540e\uff0c\u4e34\u65f6\u542f\u52a8\u9632\u707e\u4e1a\u52a1key\uff0c\u5bf9key\u8fdb\u884c\u4e1a\u52a1\u5c42\u4f20\u8f93\u52a0\u5bc6\u670d\u52a1\uff0c\u8bbe\u5b9a\u6821\u9a8c\u7a0b\u5e8f\uff0c\u8fc7\u6765\u7684key\u6821\u9a8c \u4f8b\u5982\u6bcf\u5929\u968f\u673a\u5206\u914d60\u4e2a\u52a0\u5bc6\u4e32\uff0c\u6311\u90092\u52303\u4e2a\uff0c\u6df7\u6dc6\u5230\u9875\u9762\u6570\u636eid\u4e2d\uff0c\u53d1\u73b0\u8bbf\u95eekey\u4e0d\u6ee1\u8db3\u89c4\u5219\uff0c\u9a73\u56de\u6570\u636e\u8bbf\u95ee \u603b\u7684\u6765\u8bf4 \uff1a\u7f13\u5b58\u51fb\u7a7f\u662f\u6307\u8bbf\u95ee\u4e86\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u8df3\u8fc7\u4e86\u5408\u6cd5\u6570\u636e\u7684redis\u6570\u636e\u7f13\u5b58\u9636\u6bb5\uff0c\u6bcf\u6b21\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u5bfc\u81f4\u5bf9\u6570\u636e\u5e93\u670d\u52a1\u5668\u9020\u6210\u538b\u529b\u3002\u901a\u5e38\u6b64\u7c7b\u6570\u636e\u7684\u51fa\u73b0\u91cf\u662f\u4e00\u4e2a\u8f83\u4f4e\u7684\u503c\uff0c\u5f53\u51fa\u73b0\u6b64\u7c7b\u60c5\u51b5\u4ee5\u6bd2\u653b\u6bd2\uff0c\u5e76\u53ca\u65f6\u62a5\u8b66\u3002\u5e94\u5bf9\u7b56\u7565\u5e94\u8be5\u5728\u4e34\u65f6\u9884\u6848\u9632\u8303\u65b9\u9762\u591a\u505a\u6587\u7ae0\u3002 \u65e0\u8bba\u662f\u9ed1\u540d\u5355\u8fd8\u662f\u767d\u540d\u5355\uff0c\u90fd\u662f\u5bf9\u6574\u4f53\u7cfb\u7edf\u7684\u538b\u529b\uff0c\u8b66\u62a5\u89e3\u9664\u540e\u5c3d\u5feb\u79fb\u9664\u3002","title":"5.4 \u7f13\u5b58\u7a7f\u900f"},{"location":"redis/day02/#55","text":"redis\u4e2d\u7684\u76d1\u63a7\u6307\u6807\u5982\u4e0b\uff1a \u6027\u80fd\u6307\u6807\uff1aPerformance \u54cd\u5e94\u8bf7\u6c42\u7684\u5e73\u5747\u65f6\u95f4: properties latency \u5e73\u5747\u6bcf\u79d2\u5904\u7406\u8bf7\u6c42\u603b\u6570 properties instantaneous_ops_per_sec \u7f13\u5b58\u67e5\u8be2\u547d\u4e2d\u7387\uff08\u901a\u8fc7\u67e5\u8be2\u603b\u6b21\u6570\u4e0e\u67e5\u8be2\u5f97\u5230\u975enil\u6570\u636e\u603b\u6b21\u6570\u8ba1\u7b97\u800c\u6765\uff09 ```properties hit_rate(calculated) ``` \u5185\u5b58\u6307\u6807\uff1aMemory \u5f53\u524d\u5185\u5b58\u4f7f\u7528\u91cf properties used_memory \u5185\u5b58\u788e\u7247\u7387\uff08\u5173\u7cfb\u5230\u662f\u5426\u8fdb\u884c\u788e\u7247\u6574\u7406\uff09 properties mem_fragmentation_ratio \u4e3a\u907f\u514d\u5185\u5b58\u6ea2\u51fa\u5220\u9664\u7684key\u7684\u603b\u6570\u91cf properties evicted_keys \u57fa\u4e8e\u963b\u585e\u64cd\u4f5c\uff08BLPOP\u7b49\uff09\u5f71\u54cd\u7684\u5ba2\u6237\u7aef\u6570\u91cf properties blocked_clients \u57fa\u672c\u6d3b\u52a8\u6307\u6807\uff1aBasic_activity \u5f53\u524d\u5ba2\u6237\u7aef\u8fde\u63a5\u603b\u6570 properties connected_clients \u5f53\u524d\u8fde\u63a5slave\u603b\u6570 properties connected_slaves \u6700\u540e\u4e00\u6b21\u4e3b\u4ece\u4fe1\u606f\u4ea4\u6362\u8ddd\u73b0\u5728\u7684\u79d2 properties master_last_io_seconds_ago key\u7684\u603b\u6570 properties keyspace \u6301\u4e45\u6027\u6307\u6807\uff1aPersistence \u5f53\u524d\u670d\u52a1\u5668\u6700\u540e\u4e00\u6b21RDB\u6301\u4e45\u5316\u7684\u65f6\u95f4 properties rdb_last_save_time \u5f53\u524d\u670d\u52a1\u5668\u6700\u540e\u4e00\u6b21RDB\u6301\u4e45\u5316\u540e\u6570\u636e\u53d8\u5316\u603b\u91cf properties rdb_changes_since_last_save \u9519\u8bef\u6307\u6807\uff1aError \u88ab\u62d2\u7edd\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u603b\u6570\uff08\u57fa\u4e8e\u8fbe\u5230\u6700\u5927\u8fde\u63a5\u503c\u7684\u56e0\u7d20\uff09 properties rejected_connections key\u672a\u547d\u4e2d\u7684\u603b\u6b21\u6570 properties keyspace_misses \u4e3b\u4ece\u65ad\u5f00\u7684\u79d2\u6570 properties master_link_down_since_seconds \u8981\u5bf9redis\u7684\u76f8\u5173\u6307\u6807\u8fdb\u884c\u76d1\u63a7\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u4e00\u4e9b\u7528\u5177\uff1a CloudInsight Redis Prometheus Redis-stat Redis-faina RedisLive zabbix \u4e5f\u6709\u4e00\u4e9b\u547d\u4ee4\u5de5\u5177\uff1a benchmark \u6d4b\u8bd5\u5f53\u524d\u670d\u52a1\u5668\u7684\u5e76\u53d1\u6027\u80fd properties redis-benchmark [-h ] [-p ] [-c ] [-n <requests]> [-k ] \u8303\u4f8b1\uff1a50\u4e2a\u8fde\u63a5\uff0c10000\u6b21\u8bf7\u6c42\u5bf9\u5e94\u7684\u6027\u80fd properties redis-benchmark \u8303\u4f8b2\uff1a100\u4e2a\u8fde\u63a5\uff0c5000\u6b21\u8bf7\u6c42\u5bf9\u5e94\u7684\u6027\u80fd properties redis-benchmark -c 100 -n 5000 redis-cli monitor\uff1a\u542f\u52a8\u670d\u52a1\u5668\u8c03\u8bd5\u4fe1\u606f properties monitor slowlog\uff1a\u6162\u65e5\u5fd7 \u83b7\u53d6\u6162\u67e5\u8be2\u65e5\u5fd7 properties slowlog [operator] get \uff1a\u83b7\u53d6\u6162\u67e5\u8be2\u65e5\u5fd7\u4fe1\u606f len \uff1a\u83b7\u53d6\u6162\u67e5\u8be2\u65e5\u5fd7\u6761\u76ee\u6570 reset \uff1a\u91cd\u7f6e\u6162\u67e5\u8be2\u65e5\u5fd7 \u76f8\u5173\u914d\u7f6e properties slowlog-log-slower-than 1000 #\u8bbe\u7f6e\u6162\u67e5\u8be2\u7684\u65f6\u95f4\u4e0b\u7ebf\uff0c\u5355\u4f4d\uff1a\u5fae\u5999 slowlog-max-len 100 #\u8bbe\u7f6e\u6162\u67e5\u8be2\u547d\u4ee4\u5bf9\u5e94\u7684\u65e5\u5fd7\u663e\u793a\u957f\u5ea6\uff0c\u5355\u4f4d\uff1a\u547d\u4ee4\u6570","title":"5.5 \u6027\u80fd\u6307\u6807\u76d1\u63a7"},{"location":"tantan/day01/","text":"\u8bfe\u7a0b\u4ecb\u7ecd \u300a\u63a2\u82b1\u4ea4\u53cb\u300b \u00b6 \u529f\u80fd\u4ecb\u7ecd \u9879\u76ee\u4ecb\u7ecd \u5de5\u7a0b\u642d\u5efa \u77ed\u4fe1\u9a8c\u8bc1\u7801 \u5b9e\u73b0\u7528\u6237\u767b\u5f55\u529f\u80fd 1\u3001\u529f\u80fd\u4ecb\u7ecd \u00b6 \u63a2\u82b1\u4ea4\u53cb\u662f\u4e00\u4e2a\u964c\u751f\u4eba\u7684\u5728\u7ebf\u4ea4\u53cb\u5e73\u53f0\uff0c\u5728\u8be5\u5e73\u53f0\u4e2d\u53ef\u4ee5\u641c\u7d22\u9644\u8fd1\u7684\u4eba\uff0c\u67e5\u770b\u597d\u53cb\u52a8\u6001\uff0c\u5e73\u53f0\u8fd8\u4f1a\u901a\u8fc7\u5927\u6570\u636e\u8ba1\u7b97\u8fdb\u884c\u667a\u80fd\u63a8\u8350\uff0c\u901a\u8fc7\u667a\u80fd\u63a8\u8350\u53ef\u4ee5\u627e\u5230\u66f4\u52a0\u5339\u914d\u7684\u597d\u53cb\uff0c\u8fd9\u6837\u624d\u80fd\u589e\u8fdb\u7528\u6237\u5bf9\u4ea7\u54c1\u7684\u559c\u7231\u5ea6\u3002\u63a2\u82b1\u5e73\u53f0\u8fd8\u63d0\u4f9b\u4e86\u5728\u7ebf\u5373\u65f6\u901a\u8baf\u529f\u80fd\uff0c\u53ef\u4ee5\u5b9e\u65f6\u7684\u4e0e\u597d\u53cb\u8fdb\u884c\u6c9f\u901a\uff0c\u8ba9\u6c9f\u901a\u968f\u65f6\u968f\u5730\u7684\u8fdb\u884c\u3002 1.1\u3001\u529f\u80fd\u5217\u8868 \u00b6 \u529f\u80fd \u8bf4\u660e \u5907\u6ce8 \u6ce8\u518c\u3001\u767b\u5f55 \u7528\u6237\u65e0\u9700\u5355\u72ec\u6ce8\u518c\uff0c\u76f4\u63a5\u901a\u8fc7\u624b\u673a\u53f7\u767b\u5f55\u5373\u53ef \u9996\u6b21\u767b\u5f55\u6210\u529f\u540e\u9700\u8981\u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f \u4ea4\u53cb \u4e3b\u8981\u529f\u80fd\u6709\uff1a\u6d4b\u7075\u9b42\u3001\u6843\u82b1\u4f20\u97f3\u3001\u641c\u9644\u8fd1\u3001\u63a2\u82b1\u7b49 \u5708\u5b50 \u7c7b\u4f3c\u5fae\u4fe1\u670b\u53cb\u5708\uff0c\u7528\u6237\u53ef\u4ee5\u53d1\u52a8\u6001\u3001\u67e5\u770b\u597d\u53cb\u52a8\u6001\u7b49 \u6d88\u606f \u901a\u77e5\u7c7b\u6d88\u606f + \u5373\u65f6\u901a\u8baf\u6d88\u606f \u5c0f\u89c6\u9891 \u7c7b\u4f3c\u6296\u97f3\uff0c\u7528\u6237\u53ef\u4ee5\u53d1\u5c0f\u89c6\u9891\uff0c\u8bc4\u8bba\u7b49 \u663e\u793a\u5c0f\u89c6\u9891\u5217\u8868\u9700\u8981\u8fdb\u884c\u63a8\u8350\u7b97\u6cd5\u8ba1\u7b97\u540e\u8fdb\u884c\u5c55\u73b0\u3002 \u6211\u7684 \u6211\u7684\u52a8\u6001\u3001\u5173\u6ce8\u6570\u3001\u7c89\u4e1d\u6570\u3001\u901a\u7528\u8bbe\u7f6e\u7b49 1.2\u3001\u6ce8\u518c\u767b\u5f55 \u00b6 \u4e1a\u52a1\u8bf4\u660e\uff1a \u7528\u6237\u901a\u8fc7\u624b\u673a\u9a8c\u8bc1\u7801\u8fdb\u884c\u767b\u5f55\uff0c\u5982\u679c\u662f\u7b2c\u4e00\u6b21\u767b\u5f55\u5219\u9700\u8981\u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f\uff0c\u5728\u4e0a\u4f20\u56fe\u7247\u65f6\uff0c\u9700\u8981\u5bf9\u4e0a\u4f20\u7684\u56fe\u7247\u505a\u4eba\u50cf\u7684\u6821\u9a8c\uff0c\u9632\u6b62\u7528\u6237\u4e0a\u4f20\u975e\u4eba\u50cf\u7684\u56fe\u7247\u4f5c\u4e3a\u5934\u50cf\u3002\u6d41\u7a0b\u5b8c\u6210\u540e\uff0c\u5219\u767b\u5f55\u6210\u529f\u3002 1.3\u3001\u4ea4\u53cb \u00b6 \u4ea4\u53cb\u662f\u63a2\u82b1\u9879\u76ee\u7684\u6838\u5fc3\u529f\u80fd\u4e4b\u4e00\uff0c\u7528\u6237\u53ef\u4ee5\u67e5\u770b\u597d\u53cb\uff0c\u6dfb\u52a0\u597d\u53cb\uff0c\u641c\u7d22\u597d\u53cb\u7b49\u64cd\u4f5c\u3002 1.3.1\u3001\u9996\u9875 \u00b6 \u5728\u9996\u9875\u4e2d\uff0c\u4e3b\u8981\u529f\u80fd\u6709\u201c\u4eca\u65e5\u4f73\u4eba\u201d\u3001\u201c\u63a8\u8350\u201d\u3001\u201c\u6700\u8fd1\u8bbf\u5ba2\u201d\u7b49 \u4eca\u65e5\u4f73\u4eba \u6309\u7167\u201c\u7f18\u5206\u503c\u201d\u8fdb\u884c\u5339\u914d\uff0c\u5c06\u201c\u7f18\u5206\u503c\u201d\u6700\u9ad8\u7684\u7528\u6237\u5c55\u73b0\u51fa\u6765 \u63a8\u8350 \u6309\u7167\u201c\u7f18\u5206\u503c\u201d\u8fdb\u884c\u63a8\u8350\uff0c\u7531\u540e\u53f0\u7684\u63a8\u8350\u7cfb\u7edf\u8ba1\u7b97\u5f97\u51fa\uff0c\u5c55\u73b0\u51fa\u6765 \u6700\u8fd1\u8bbf\u5ba2 \u663e\u793a\u6700\u8fd1\u6765\u770b\u201c\u6211\u201d\u7684\u7528\u6237 1.3.2\u3001\u63a2\u82b1 \u00b6 \u8bf4\u660e\uff1a\u5de6\u5212\u559c\u6b22\uff0c\u53f3\u5212\u4e0d\u559c\u6b22\uff0c\u6bcf\u5929\u9650\u91cf\u4e0d\u8d85\u8fc7100\u4e2a\uff0c\u5f00\u901a\u4f1a\u5458\u53ef\u589e\u52a0\u9650\u989d\u3002\u53cc\u65b9\u4e92\u76f8\u559c\u6b22\u5219\u914d\u5bf9\u6210\u529f\u3002 \u5b9e\u73b0\uff1a\u6570\u636e\u6765\u6e90\u63a8\u8350\u7cfb\u7edf\u8ba1\u7b97\u540e\u7684\u7ed3\u679c\u3002 1.3.3\u3001\u641c\u9644\u8fd1 \u00b6 \u6839\u636e\u7528\u6237\u5f53\u524d\u6240\u5728\u7684\u4f4d\u7f6e\u8fdb\u884c\u67e5\u8be2\uff0c\u5e76\u4e14\u572810km\u7684\u8303\u56f4\u5185\u8fdb\u884c\u67e5\u8be2\uff0c\u53ef\u4ee5\u901a\u8fc7\u7b5b\u9009\u6309\u94ae\u8fdb\u884c\u6761\u4ef6\u7b5b\u9009\u3002 1.3.4\u3001\u6843\u82b1\u4f20\u97f3 \u00b6 \u529f\u80fd\u7c7b\u4f3cQQ\u4e2d\u7684\u6f02\u6d41\u74f6\uff0c\u7528\u6237\u53ef\u4ee5\u53d1\u9001\u548c\u63a5\u6536\u8bed\u97f3\u6d88\u606f\uff0c\u964c\u751f\u4eba\u5c31\u4f1a\u63a5\u6536\u5230\u6d88\u606f\u3002 1.3.5\u3001\u6d4b\u7075\u9b42 \u00b6 \u6d4b\u8bd5\u9898\u7528\u4e8e\u5bf9\u7528\u6237\u8fdb\u884c\u5206\u7c7b\uff0c\u6bcf\u6b21\u63d0\u4ea4\u7b54\u6848\u540e\u66f4\u65b0\u7528\u6237\u5c5e\u6027 \u6d4b\u8bd5\u9898\u5728\u540e\u53f0\u8fdb\u884c\u7ef4\u62a4 \u6d4b\u8bd5\u9898\u6d4b\u8bd5\u5b8c\u540e\u4ea7\u751f\u7ed3\u679c\u9875\u53ef\u4ee5\u8fdb\u884c\u5206\u4eab \u6d4b\u8bd5\u9898\u4e3a\u987a\u5e8f\u56de\u7b54\uff0c\u56de\u7b54\u5b8c\u521d\u7ea7\u9898\u89e3\u9501\u4e0b\u4e00\u7ea7\u95ee\u9898 \u70b9\u51fb\u9501\u5b9a\u95ee\u9898 \u663e\u793a\u63d0\u793a \u8bf7\u5148\u56de\u7b54\u4e0a\u4e00\u7ea7\u95ee\u9898 1.4\u3001\u5708\u5b50 \u00b6 1\u3001\u63a8\u8350\u9891\u9053\u4e3a\u6839\u636e\u95ee\u5377\u53ca\u559c\u597d\u63a8\u8350\u76f8\u4f3c\u7528\u6237\u52a8\u6001 2\u3001\u663e\u793a\u5185\u5bb9\u4e3a\u7528\u6237\u5934\u50cf\u3001\u7528\u6237\u6635\u79f0\u3001\u7528\u6237\u6027\u522b\u3001\u7528\u6237\u5e74\u9f84\u3001\u7528\u6237\u6807\u7b7e\u548c\u7528\u6237\u53d1\u5e03\u52a8\u6001 3\u3001\u56fe\u7247\u6700\u591a\u4e0d\u8d85\u8fc76\u5f20\u6216\u53d1\u5e03\u4e00\u4e2a\u5c0f\u89c6\u9891 4\u3001\u52a8\u6001\u4e0b\u65b9\u663e\u793a\u53d1\u5e03\u65f6\u95f4\u8ddd\u79bb\u5f53\u65f6\u65f6\u95f4\uff0c\u4f8b\u598210\u5206\u949f\u524d\u30013\u5c0f\u65f6\u524d\u30012\u5929\u524d\uff0c\u663e\u793a\u65f6\u95f4\u8fdb\u884c\u53d6\u6574 5\u3001\u52a8\u6001\u4e0b\u65b9\u663e\u793a\u8ddd\u79bb\u4e3a\u53d1\u5e03\u52a8\u6001\u5730\u4e0e\u672c\u5730\u8ddd\u79bb 6\u3001\u663e\u793a\u7528\u6237\u6d4f\u89c8\u91cf 7\u3001\u663e\u793a\u70b9\u8d5e\u6570\u3001\u8bc4\u8bba\u6570 \u8f6c\u53d1\u6570 1.5\u3001\u6d88\u606f \u00b6 \u6d88\u606f\u5305\u542b\u901a\u77e5\u7c7b\u7684\u6d88\u606f\u548c\u597d\u53cb\u6d88\u606f\u3002 1.6\u3001\u5c0f\u89c6\u9891 \u00b6 \u7528\u6237\u53ef\u4ee5\u4e0a\u4f20\u5c0f\u89c6\u9891\uff0c\u4e5f\u53ef\u4ee5\u67e5\u770b\u5c0f\u89c6\u9891\u5217\u8868\uff0c\u5e76\u4e14\u53ef\u4ee5\u8fdb\u884c\u70b9\u8d5e\u64cd\u4f5c\u3002 1.7\u3001\u6211\u7684 \u00b6 \u663e\u793a\u5173\u6ce8\u6570\u3001\u559c\u6b22\u6570\u3001\u7c89\u4e1d\u6570\u3001\u6211\u7684\u52a8\u6001\u7b49\u4fe1\u606f\u3002 2\u3001\u9879\u76ee\u4ecb\u7ecd \u00b6 2.1\u3001\u9879\u76ee\u80cc\u666f \u00b6 \u5728\u7ebf\u793e\u4ea4\u662f\u4e92\u8054\u7f51\u65f6\u4ee3\u7684\u4ea7\u7269\uff0c\u5df2\u6210\u4e3a\u4e92\u8054\u7f51\u7528\u6237\u7684\u57fa\u7840\u9700\u6c42\u4e4b\u4e00\u3002\u79fb\u52a8\u4e92\u8054\u7f51\u81ea2003\u5e74\u8d77\u5feb\u901f\u53d1\u5c55\uff0c\u4fc3\u4f7f\u5728\u7ebf\u793e\u4ea4\u9010\u6e10\u4ecePC\u7aef\u8f6c\u79fb\u81f3\u79fb\u52a8\u7aef\u3002\u79fb\u52a8\u793e\u4ea4\u6700\u521d\u4ee5\u719f\u4eba\u793e\u4ea4\u4e3a\u4e3b\uff0c\u4ee5\u7ef4\u7cfb\u719f\u4eba\u5173\u7cfb\u3001\u5171\u4eab\u8d44\u6e90\u4fe1\u606f\u7684\u5f62\u5f0f\u5b58\u5728\u3002\u968f\u7740\u4eba\u4eec\u4ea4\u53cb\u9700\u6c42\u7684\u5ef6\u4f38\uff0c\u79fb\u52a8\u793e\u4ea4\u5f00\u59cb\u5411\u964c\u751f\u4eba\u793e\u4ea4\u3001\u5174\u8da3\u793e\u4ea4\u7b49\u5782\u76f4\u65b9\u5411\u53d1\u5c55\uff0c\u5f62\u5f0f\u4e30\u5bcc\u591a\u6837\u3002 2.2\u3001\u5e02\u573a\u5206\u6790 \u00b6 \u63a2\u82b1\u4ea4\u53cb\u9879\u76ee\u5b9a\u4f4d\u4e8e \u964c\u751f\u4eba\u4ea4\u53cb\u5e02\u573a \u3002 \u6839\u636e\u300a2018\u793e\u4ea4\u9886\u57df\u6295\u878d\u8d44\u62a5\u544a\u300b\u4e2d\u6307\u51fa\uff1a\u867d\u7136\u76f8\u6bd42017\u5e74\uff0c\u6295\u878d\u8d44\u4e8b\u4ef6\u51cf\u5c1129.5%\uff0c\u4f46\u662f\u878d\u8d44\u7684\u603b\u989d\u5374\u5927\u5e45\u589e\u957f\uff0c\u8fbe\u523068%\u3002 \u8fd9\u4e9b\u8ff9\u8c61\u8bf4\u660e\uff1a\u793e\u4ea4\u9886\u57df\u7684\u53d1\u5c55\u89c4\u6a21\u6b63\u5728\u6269\u5927\uff0c\u800c\u5f88\u591a\u6ca1\u6709\u7279\u8272\u7684\u4ea7\u54c1\u4e5f\u4f1a\u88ab\u6dd8\u6c70\u3002\u800c\u968f\u7740\u90a3\u4e9b\u5c3e\u90e8\u4ea7\u54c1\u7684\u5012\u4e0b\uff0c\u5bf9\u6211\u4eec\u6765\u8bf4\u5c31\u662f\u673a\u4f1a\uff0c\u53ca\u65f6\u6293\u4f4f\u4e0d\u540c\u793e\u4ea4\u9700\u6c42\u7684\u673a\u4f1a\u3002\u4ee5\u793e\u4ea4\u4e3a\u6838\u5fc3\u5411\u4e0d\u540c\u7684\u7ec6\u5206\u9886\u57df\u884d\u751f\u6b63\u5728\u9010\u6e10\u8d70\u5411\u6210\u719f\u5316\u3002 \u800c\u6211\u4eec\u6309\u7167\u5a31\u4e50\u5f62\u5f0f\u548c\u5185\u5bb9\u4e3a\u4e3b\u4e24\u4e2a\u7ef4\u5ea6\uff0c\u5c06\u793e\u4ea4\u884c\u4e1a\u516c\u53f8\u5206\u7c7b\u4e3a\uff1a\u5373\u65f6\u901a\u4fe1\u3001\u5185\u5bb9\u793e\u7fa4\u3001\u964c\u751f\u4eba\u793e\u4ea4\u3001\u6cdb\u5a31\u4e50\u793e\u4ea4\u4ee5\u53ca\u5174\u8da3\u793e\u4ea4\u51e0\u4e2a\u9886\u57df\u3002 \u800c\u57282018\u5e74\u793e\u4ea4\u7684\u5404\u4e2a\u7ec6\u5206\u9886\u57df\u4e0b\uff0c\u5747\u6709\u5907\u53d7\u8d44\u672c\u6240\u5173\u6ce8\u7684\u9879\u76ee\uff0c\u6839\u636e\u70ef\u725b\u6570\u636e2018\u5e74\u7684\u62a5\u544a\u4e2d\uff0c\u4e5f\u540c\u6837\u6307\u51fa\uff1a\u5185\u5bb9\u793e\u4ea4\u53ca\u964c\u751f\u4eba\u793e\u4ea4\u4e3a\u8d44\u672c\u91cd\u8981\u5173\u6ce8\u9886\u57df\uff0c\u5408\u8ba1\u878d\u8d44\u5360\u6bd4\u8fbe73%\u3002 \u6839\u636e\u5e02\u573a\u73b0\u72b6\u4ee5\u53ca\u878d\u8d44\u4e8b\u4ef6\u6765\u770b\uff1a\u964c\u751f\u4eba\u793e\u4ea4\u3001\u5185\u5bb9\u793e\u7fa4\u3001\u5174\u8da3\u793e\u4ea4\u57282019\u5e74\u4ecd\u7136\u4fdd\u6301\u5f3a\u52b2\u7684\u52a8\u529b\uff0c\u5360\u5230\u8fd170%\u7684\u6bd4\u4f8b\uff0c\u5b83\u4eec\u4ecd\u7136\u662f\u8d44\u672c\u5e02\u573a\u4e3b\u8981\u5173\u6ce8\u9886\u57df\u3002\u4ece\u589e\u957f\u7387\u6765\u770b\u964c\u751f\u4eba\u793e\u4ea4\u7684\u589e\u957f\u901f\u5ea6\u8fdc\u8fdc\u5927\u4e8e\u5176\u4ed6\u51e0\u7c7b\uff0c\u56e0\u6b64\u6211\u4eec\u8981\u4ece\u8fd9\u4e2a\u65b9\u5411\u5165\u624b\u3002 2.3\u3001\u76ee\u6807\u7528\u6237\u7fa4\u4f53 \u00b6 \u4ece\u6574\u4f53\u5e74\u9f84\u6bb5\u6765\u770b\uff1a\u76ee\u524d\u76ee\u6807\u7528\u6237\u7fa4\u4f53\u4e3b\u8981\u4ee530\u5c81\u4ee5\u4e0b\u4e3a\u4e3b\uff0c\u5176\u4e2d\u4ee518-25\u5c81\u5e74\u9f84\u7fa4\u4f53\u4e3a\u4e3b\u8981\u53d7\u4f17\u4eba\u7fa4\u3002 \u4e0a\u73ed\u7fa4\u4f53\uff1a \u70ed\u8877\u4e8e\u901a\u8fc7\u5206\u4eab\u5185\u5bb9\u6216\u8868\u8fbe\u201c\u4e2a\u4eba\u60c5\u7eea\u201d\u5728\u964c\u751f\u4eba\u9762\u524d\u5efa\u7acb\u7279\u6b8a\u7684\u4eba\u8bbe\uff0c\u5e76\u501f\u6b64\u63d0\u5347\u81ea\u6211\u4ef7\u503c\u6269\u5927\u81ea\u5df1\u7684\u4ea4\u9645\u5708\uff1b \u5b66\u751f\u7fa4\u4f53\uff1a \u8ffd\u6c42\u4e2a\u6027\u9009\u62e9\uff0c\u66f4\u503e\u5411\u627e\u5230\u6709\u5171\u540c\u8bdd\u9898\u7684\u964c\u751f\u4eba\u5bf9\u8c61\u5e76\u5efa\u7acb\u957f\u671f\u7684\u5173\u7cfb\uff0c\u4e50\u4e8e\u5c55\u73b0\u81ea\u6211\uff1b \u6587\u827a\u7fa4\u4f53\uff1a \u62e5\u6709\u81ea\u5df1\u72ec\u7279\u7684\u7231\u597d\u4e14\u62e5\u6709\u7279\u522b\u7684\u4e2a\u4eba\u8ffd\u6c42\uff0c\u8ffd\u6c42\u6587\u827a\u5708\u5b50\u5185\u7684\u4ea4\u6d41\uff0c\u5e0c\u671b\u901a\u8fc7\u5206\u4eab\u7ed3\u4ea4\u66f4\u591a\u597d\u53cb\uff1b \u6c9f\u901a\u5f31\u52bf\u7fa4\u4f53\uff1a \u5bf9\u73b0\u6709\u957f\u671f\u4fdd\u6301\u7ebf\u4e0a\u5bf9\u793e\u4ea4\u6a21\u5f0f\u8868\u73b0\u65e0\u529b\u4e14\u65e0\u6548\uff0c\u6e34\u671b\u6709\u66f4\u52a0\u6709\u6548\u4e14\u5b89\u5168\u7684\u793e\u4ea4\u65b9\u5f0f\u51fa\u73b0\uff0c\u89e3\u51b3\u76ee\u524d\u5355\u8c03\u4e4f\u5473\u7684\u6c9f\u901a\u65b9\u5f0f\uff1b 2.4\u3001\u6280\u672f\u65b9\u6848 \u00b6 \u524d\u7aef\uff1a flutter + android + \u73af\u4fe1SDK + redux + shared_preferences + connectivity + iconfont + webview + sqflite \u540e\u7aef\uff1a Spring Boot + SpringMVC + Mybatis + MybatisPlus + Dubbo Elasticsearch geo \u5b9e\u73b0\u5730\u7406\u4f4d\u7f6e\u67e5\u8be2 MongoDB \u5b9e\u73b0\u6d77\u91cf\u6570\u636e\u7684\u5b58\u50a8 Redis \u6570\u636e\u7684\u7f13\u5b58 Spark + MLlib \u5b9e\u73b0\u667a\u80fd\u63a8\u8350 \u7b2c\u4e09\u65b9\u670d\u52a1 \u73af\u4fe1\u5373\u65f6\u901a\u8baf \u7b2c\u4e09\u65b9\u670d\u52a1 \u963f\u91cc\u4e91 OSS \u3001 \u77ed\u4fe1\u670d\u52a1 \u7b2c\u4e09\u65b9\u670d\u52a1 \u8679\u8f6f\u5f00\u653e\u5e73\u53f0 2.5\u3001\u6280\u672f\u67b6\u6784 \u00b6 2.6\u3001\u6280\u672f\u89e3\u51b3\u65b9\u6848 \u00b6 \u4f7f\u7528Elasticsearch geo\u5b9e\u73b0\u9644\u8fd1\u7684\u4eba\u7684\u89e3\u51b3\u65b9\u6848 \u4f7f\u7528Spark + Mllib\u5b9e\u73b0\u667a\u80fd\u63a8\u8350\u7684\u89e3\u51b3\u65b9\u6848 \u4f7f\u7528MongoDB\u8fdb\u884c\u6d77\u91cf\u6570\u636e\u7684\u5b58\u50a8\u7684\u89e3\u51b3\u65b9\u6848 \u4f7f\u7528\u91c7\u7528\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u5b58\u50a8\u5c0f\u89c6\u9891\u6570\u636e\u7684\u89e3\u51b3\u65b9\u6848 \u4f7f\u7528\u8679\u8f6f\u5f00\u653e\u5e73\u53f0\u8fdb\u884c\u4eba\u8138\u8bc6\u522b\u7684\u89e3\u51b3\u65b9\u6848 2.7\u3001\u6280\u672f\u4eae\u70b9 \u00b6 \u91c7\u7528Elasticsearch geo\u5b9e\u73b0\u5730\u7406\u4f4d\u7f6e\u67e5\u8be2 \u91c7\u7528RocketMQ\u4f5c\u4e3a\u6d88\u606f\u670d\u52a1\u4e2d\u95f4\u4ef6 \u91c7\u7528MongoDB\u8fdb\u884c\u6d77\u91cf\u6570\u636e\u7684\u5b58\u50a8 \u91c7\u7528Spark + Mllib\u5b9e\u73b0\u667a\u80fd\u63a8\u8350 \u91c7\u7528\u73af\u4fe1\u670d\u52a1\u5b9e\u73b0\u5373\u65f6\u901a\u8baf \u91c7\u7528\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u5b58\u50a8\u5c0f\u89c6\u9891\u6570\u636e \u91c7\u7528Apache Dobbo\u4f5c\u4e3a\u5fae\u670d\u52a1\u67b6\u6784\u6280\u672f \u91c7\u7528SpringBoot + Mybatis\u5b9e\u73b0\u7cfb\u7edf\u4e3b\u67b6\u6784 \u91c7\u7528Redis\u96c6\u7fa4\u5b9e\u73b0\u7f13\u5b58\u7684\u9ad8\u53ef\u7528 2.8\u3001\u5f00\u53d1\u65b9\u5f0f \u00b6 \u63a2\u82b1\u4ea4\u53cb\u9879\u76ee\u91c7\u7528\u524d\u540e\u7aef\u5206\u79bb\u7684\u65b9\u5f0f\u5f00\u53d1\uff0c\u5c31\u662f\u524d\u7aef\u7531\u524d\u7aef\u56e2\u961f\u8d1f\u8d23\u5f00\u53d1\uff0c\u540e\u7aef\u8d1f\u8d23\u63a5\u53e3\u7684\u5f00\u53d1\uff0c\u8fd9\u79cd\u5f00\u53d1\u65b9\u5f0f\u67092\u70b9\u597d\u5904\uff1a \u626c\u957f\u907f\u77ed\uff0c\u6bcf\u4e2a\u56e2\u961f\u505a\u81ea\u5df1\u64c5\u957f\u7684\u4e8b\u60c5 \u524d\u540e\u7aef\u5e76\u884c\u5f00\u53d1\uff0c\u9700\u8981\u4e8b\u5148\u7ea6\u5b9a\u597d\u63a5\u53e3\u5730\u5740\u4ee5\u53ca\u5404\u79cd\u53c2\u6570\u3001\u54cd\u5e94\u6570\u636e\u7ed3\u6784\u7b49 \u5bf9\u4e8e\u63a5\u53e3\u7684\u5b9a\u4e49\u6211\u4eec\u91c7\u7528YApi\u8fdb\u884c\u7ba1\u7406\uff0cYApi\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u5b9a\u4e49\u3001\u7ba1\u7406\u3001\u63d0\u4f9bmock\u6570\u636e\u7684\u7ba1\u7406\u5e73\u53f0\u3002 \u5730\u5740\uff1ahttps://mock-java.itheima.net/ \u7528\u6237\u540d\uff1atanhua@itcast.cn \u5bc6\u7801\uff1a123456 \u63a5\u53e3\u5b9a\u4e49\uff1a mock\u6570\u636e\uff0cYApi\u63d0\u4f9b\u4e86mock\u529f\u80fd\uff0c\u5c31\u662f\u6a21\u62df\u670d\u52a1\u7aef\u8fd4\u56de\u6d4b\u8bd5\u6570\u636e\uff1a \u8fd8\u53ef\u4ee5\u8fd0\u884chttp\u8bf7\u6c42\uff08\u9700\u8981\u5728Chrome\u4e2d\u5b89\u88c5\u652f\u6301\u8de8\u57df\u6269\u5c55 https://juejin.im/post/6844904057707085832\uff09\uff1a 2.9\u3001\u57fa\u7840\u73af\u5883 \u00b6 \u63a2\u82b1\u4ea4\u53cb\u9879\u76ee\u7684\u5f00\u53d1\u7edf\u4e00\u4f7f\u7528\u63d0\u4f9b\u7684Centos7\u73af\u5883\uff0c\u8be5\u73af\u5883\u4e2d\u90e8\u7f72\u5b89\u88c5\u4e86\u9879\u76ee\u6240\u9700\u8981\u7684\u5404\u79cd\u670d\u52a1\uff0c\u5982\uff1aMySQL\u3001MongoDB\u3001Redis\u3001RocketMQ\u7b49\u3002 \u865a\u62df\u673a\u7684root\u7528\u6237\u5bc6\u7801\u4e3a\uff1aroot123 \u9ed8\u8ba4\u53c2\u6570\uff1aCPU\uff1a2\u6838\uff0c\u5185\u5b58\uff1a4G\uff0c\u786c\u76d8\uff1a60G IP\u5730\u5740\u5efa\u8bae\u8bbe\u7f6e\u4e3a192.168.31.81\uff0c\u5426\u5219\u6709\u4e9b\u670d\u52a1\u5c06\u4e0d\u53ef\u7528\uff0c\u6bd4\u5982\uff1aRedis\u3001RocketMQ\u7b49\u3002 3\u3001\u6ce8\u518c\u767b\u5f55 \u00b6 \u4e1a\u52a1\u8bf4\u660e\uff1a \u7528\u6237\u901a\u8fc7\u624b\u673a\u9a8c\u8bc1\u7801\u8fdb\u884c\u767b\u5f55\uff0c\u5982\u679c\u662f\u7b2c\u4e00\u6b21\u767b\u5f55\u5219\u9700\u8981\u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f\uff0c\u5728\u4e0a\u4f20\u56fe\u7247\u65f6\uff0c\u9700\u8981\u5bf9\u4e0a\u4f20\u7684\u56fe\u7247\u505a\u4eba\u50cf\u7684\u6821\u9a8c\uff0c\u9632\u6b62\u7528\u6237\u4e0a\u4f20\u975e\u4eba\u50cf\u7684\u56fe\u7247\u4f5c\u4e3a\u5934\u50cf\u3002\u6d41\u7a0b\u5b8c\u6210\u540e\uff0c\u5219\u767b\u5f55\u6210\u529f\u3002 \u6d41\u7a0b\uff1a 3.1\u3001\u5355\u70b9\u767b\u5f55\u7cfb\u7edf \u00b6 \u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u5355\u70b9\u767b\u5f55\u7cfb\u7edf\uff1f \u4ee5\u524d\u5b9e\u73b0\u7684\u767b\u5f55\u548c\u6ce8\u518c\u662f\u5728\u540c\u4e00\u4e2atomcat\u5185\u90e8\u5b8c\u6210\uff0c\u6211\u4eec\u73b0\u5728\u7684\u7cfb\u7edf\u67b6\u6784\u662f\u6bcf\u4e00\u4e2a\u7cfb\u7edf\u90fd\u662f\u7531\u4e00\u4e2a\u56e2\u961f\u8fdb\u884c\u7ef4\u62a4\uff0c\u6bcf\u4e2a\u7cfb\u7edf\u90fd\u662f\u5355\u72ec\u90e8\u7f72\u8fd0\u884c\u4e00\u4e2a\u5355\u72ec\u7684tomcat\uff0c\u6240\u4ee5\uff0c\u4e0d\u80fd\u5c06\u7528\u6237\u7684\u767b\u5f55\u4fe1\u606f\u4fdd\u5b58\u5230session\u4e2d\uff08\u591a\u4e2atomcat\u7684session\u662f\u4e0d\u80fd\u5171\u4eab\u7684\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u5355\u72ec\u7684\u7cfb\u7edf\u6765\u7ef4\u62a4\u7528\u6237\u7684\u767b\u5f55\u4fe1\u606f\u3002 \u7531\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff1a \u5ba2\u6237\u7aef\u9700\u8981\u901a\u8fc7SSO\u7cfb\u7edf\u624d\u80fd\u83b7\u53d6\u5230token\uff1b \u5ba2\u6237\u7aef\u5728\u8bf7\u6c42\u670d\u52a1\u7cfb\u7edf\u65f6\uff0c\u670d\u52a1\u7cfb\u7edf\u9700\u8981\u901a\u8fc7SSO\u7cfb\u7edf\u8fdb\u884c\u5bf9token\u8fdb\u884c\u6821\u9a8c\uff1b SSO\u7cfb\u7edf\u5728\u6574\u4e2a\u7cfb\u7edf\u67b6\u6784\u4e2d\u5904\u4e8e\u6838\u5fc3\u4f4d\u7f6e\uff1b 3.2\u3001\u642d\u5efa\u5de5\u7a0b \u00b6 3.2.1\u3001my-tanhua \u00b6 itcast-tanhua\u662f\u7236\u5de5\u7a0b\uff0c\u96c6\u4e2d\u5b9a\u4e49\u4e86\u4f9d\u8d56\u7684\u7248\u672c\u4ee5\u53ca\u6240\u9700\u8981\u7684\u4f9d\u8d56\u4fe1\u606f\u3002 <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <modelVersion> 4.0.0 </modelVersion> <parent> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-parent </artifactId> <version> 2.1.0.RELEASE </version> </parent> <groupId> cn.itcast.tanhua </groupId> <artifactId> my-tanhua </artifactId> <version> 1.0-SNAPSHOT </version> <!-- \u96c6\u4e2d\u5b9a\u4e49\u4f9d\u8d56\u7248\u672c\u53f7 --> <properties> <mysql.version> 5.1.47 </mysql.version> <jackson.version> 2.9.9 </jackson.version> <druid.version> 1.0.9 </druid.version> <servlet-api.version> 2.5 </servlet-api.version> <jsp-api.version> 2.0 </jsp-api.version> <joda-time.version> 2.9.9 </joda-time.version> <commons-lang3.version> 3.7 </commons-lang3.version> <commons-io.version> 1.3.2 </commons-io.version> <mybatis.version> 3.2.8 </mybatis.version> <mybatis.mybatis-plus> 3.1.1 </mybatis.mybatis-plus> <lombok.version> 1.18.4 </lombok.version> </properties> <!--\u901a\u7528\u4f9d\u8d56--> <dependencies> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-test </artifactId> <scope> test </scope> </dependency> <dependency> <groupId> junit </groupId> <artifactId> junit </artifactId> <version> 4.12 </version> <scope> test </scope> </dependency> </dependencies> <dependencyManagement> <dependencies> <!-- mybatis-plus\u63d2\u4ef6\u4f9d\u8d56 --> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus </artifactId> <version> ${mybatis.mybatis-plus} </version> </dependency> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus-boot-starter </artifactId> <version> ${mybatis.mybatis-plus} </version> </dependency> <!-- MySql --> <dependency> <groupId> mysql </groupId> <artifactId> mysql-connector-java </artifactId> <version> ${mysql.version} </version> </dependency> <dependency> <groupId> org.mongodb </groupId> <artifactId> mongodb-driver-sync </artifactId> <version> 3.9.1 </version> </dependency> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> <optional> true </optional> <version> ${lombok.version} </version> </dependency> <dependency> <groupId> org.apache.commons </groupId> <artifactId> commons-lang3 </artifactId> <version> ${commons-lang3.version} </version> </dependency> <!--RocketMQ\u76f8\u5173--> <dependency> <groupId> org.apache.rocketmq </groupId> <artifactId> rocketmq-spring-boot-starter </artifactId> <version> 2.0.3 </version> </dependency> <dependency> <groupId> org.apache.rocketmq </groupId> <artifactId> rocketmq-client </artifactId> <version> 4.6.0 </version> </dependency> <!-- Jackson Json\u5904\u7406\u5de5\u5177\u5305 --> <dependency> <groupId> com.fasterxml.jackson.core </groupId> <artifactId> jackson-databind </artifactId> <version> ${jackson.version} </version> </dependency> <dependency> <groupId> com.alibaba </groupId> <artifactId> druid </artifactId> <version> ${druid.version} </version> </dependency> <dependency> <groupId> commons-codec </groupId> <artifactId> commons-codec </artifactId> <version> 1.11 </version> </dependency> <dependency> <groupId> joda-time </groupId> <artifactId> joda-time </artifactId> <version> ${joda-time.version} </version> </dependency> <dependency> <groupId> io.netty </groupId> <artifactId> netty-all </artifactId> <version> 4.1.32.Final </version> </dependency> <!--zk\u4f9d\u8d56--> <dependency> <groupId> org.apache.zookeeper </groupId> <artifactId> zookeeper </artifactId> <version> 3.4.13 </version> </dependency> <dependency> <groupId> com.github.sgroschupf </groupId> <artifactId> zkclient </artifactId> <version> 0.1 </version> </dependency> <!--dubbo\u7684springboot\u652f\u6301--> <dependency> <groupId> com.alibaba.boot </groupId> <artifactId> dubbo-spring-boot-starter </artifactId> <version> 0.2.0 </version> </dependency> <!--dubbo\u6846\u67b6--> <dependency> <groupId> com.alibaba </groupId> <artifactId> dubbo </artifactId> <version> 2.6.4 </version> </dependency> <dependency> <groupId> com.aliyun.oss </groupId> <artifactId> aliyun-sdk-oss </artifactId> <version> 2.8.3 </version> </dependency> <dependency> <groupId> com.aliyun </groupId> <artifactId> aliyun-java-sdk-core </artifactId> <version> 4.5.3 </version> </dependency> <dependency> <groupId> com.github.tobato </groupId> <artifactId> fastdfs-client </artifactId> <version> 1.26.7 </version> <exclusions> <exclusion> <groupId> ch.qos.logback </groupId> <artifactId> logback-classic </artifactId> </exclusion> </exclusions> </dependency> <dependency> <groupId> io.jsonwebtoken </groupId> <artifactId> jjwt </artifactId> <version> 0.9.1 </version> </dependency> </dependencies> </dependencyManagement> <build> <plugins> <!-- java\u7f16\u8bd1\u63d2\u4ef6 --> <plugin> <groupId> org.apache.maven.plugins </groupId> <artifactId> maven-compiler-plugin </artifactId> <version> 3.2 </version> <configuration> <source> 1.8 </source> <target> 1.8 </target> <encoding> UTF-8 </encoding> </configuration> </plugin> </plugins> </build> </project> 3.2.2\u3001my-tanhua-sso \u00b6 <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <parent> <artifactId> my-tanhua </artifactId> <groupId> cn.itcast.tanhua </groupId> <version> 1.0-SNAPSHOT </version> </parent> <modelVersion> 4.0.0 </modelVersion> <artifactId> my-tanhua-sso </artifactId> <dependencies> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-web </artifactId> </dependency> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus </artifactId> </dependency> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus-boot-starter </artifactId> </dependency> <dependency> <groupId> mysql </groupId> <artifactId> mysql-connector-java </artifactId> </dependency> <dependency> <groupId> com.alibaba </groupId> <artifactId> druid </artifactId> </dependency> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> </dependency> <dependency> <groupId> org.apache.commons </groupId> <artifactId> commons-lang3 </artifactId> </dependency> <dependency> <groupId> com.fasterxml.jackson.core </groupId> <artifactId> jackson-databind </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-redis </artifactId> </dependency> <dependency> <groupId> commons-codec </groupId> <artifactId> commons-codec </artifactId> </dependency> <!--RocketMQ\u76f8\u5173--> <dependency> <groupId> org.apache.rocketmq </groupId> <artifactId> rocketmq-spring-boot-starter </artifactId> </dependency> <dependency> <groupId> org.apache.rocketmq </groupId> <artifactId> rocketmq-client </artifactId> </dependency> <!--\u7b80\u5316\u4ee3\u7801\u7684\u5de5\u5177\u5305--> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> <optional> true </optional> </dependency> <dependency> <groupId> com.aliyun </groupId> <artifactId> aliyun-java-sdk-core </artifactId> </dependency> <dependency> <groupId> io.jsonwebtoken </groupId> <artifactId> jjwt </artifactId> </dependency> <dependency> <groupId> joda-time </groupId> <artifactId> joda-time </artifactId> </dependency> </dependencies> </project> 3.2.3\u3001\u7f51\u6613\u6a21\u62df\u5668 \u00b6 \u63a2\u82b1\u4ea4\u53cb\u9879\u76ee\u7684\u524d\u7aef\u91c7\u7528Android APP\u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4f7f\u7528\u6a21\u62df\u5668\u6216\u771f\u673a\u8fdb\u884c\u6d4b\u8bd5\u3002 \u5bf9\u4e8e\u6a21\u62df\u5668\u8fd9\u91cc\u63a8\u8350\u4f7f\u7528\u7f51\u6613\u6a21\u62df\u5668\uff0c\u5176\u517c\u5bb9\u6027\u597d\u3001\u529f\u80fd\u5b8c\u5584\u800c\u4e14\u8fd8\u7b80\u6d01\uff0c\u7f3a\u70b9\u662f\u5b83\u4e0d\u652f\u6301\u865a\u62df\u673a\u4e2d\u5b89\u88c5\u3002 \u4e0b\u8f7d\uff1ahttps://mumu.163.com/ 3.3\u3001\u6570\u636e\u5e93\u8868 \u00b6 \u6570\u636e\u5e93\u4f7f\u7528\u7684mysql\uff1a CREATE TABLE ` tb_user ` ( ` id ` bigint ( 20 ) NOT NULL AUTO_INCREMENT , ` mobile ` varchar ( 11 ) DEFAULT NULL COMMENT '\u624b\u673a\u53f7' , ` password ` varchar ( 32 ) DEFAULT NULL COMMENT '\u5bc6\u7801\uff0c\u9700\u8981\u52a0\u5bc6' , ` created ` datetime DEFAULT NULL , ` updated ` datetime DEFAULT NULL , PRIMARY KEY ( ` id ` ), KEY ` mobile ` ( ` mobile ` ) USING BTREE ) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 COMMENT = '\u7528\u6237\u8868' ; CREATE TABLE ` tb_user_info ` ( ` id ` bigint ( 20 ) NOT NULL AUTO_INCREMENT , ` user_id ` bigint ( 20 ) NOT NULL COMMENT '\u7528\u6237id' , ` nick_name ` varchar ( 50 ) DEFAULT NULL COMMENT '\u6635\u79f0' , ` logo ` varchar ( 100 ) DEFAULT NULL COMMENT '\u7528\u6237\u5934\u50cf' , ` tags ` varchar ( 50 ) DEFAULT NULL COMMENT '\u7528\u6237\u6807\u7b7e\uff1a\u591a\u4e2a\u7528\u9017\u53f7\u5206\u9694' , ` sex ` int ( 1 ) DEFAULT '3' COMMENT '\u6027\u522b\uff0c1-\u7537\uff0c2-\u5973\uff0c3-\u672a\u77e5' , ` age ` int ( 11 ) DEFAULT NULL COMMENT '\u7528\u6237\u5e74\u9f84' , ` edu ` varchar ( 20 ) DEFAULT NULL COMMENT '\u5b66\u5386' , ` city ` varchar ( 20 ) DEFAULT NULL COMMENT '\u5c45\u4f4f\u57ce\u5e02' , ` birthday ` varchar ( 20 ) DEFAULT NULL COMMENT '\u751f\u65e5' , ` cover_pic ` varchar ( 50 ) DEFAULT NULL COMMENT '\u5c01\u9762\u56fe\u7247' , ` industry ` varchar ( 20 ) DEFAULT NULL COMMENT '\u884c\u4e1a' , ` income ` varchar ( 20 ) DEFAULT NULL COMMENT '\u6536\u5165' , ` marriage ` varchar ( 20 ) DEFAULT NULL COMMENT '\u5a5a\u59fb\u72b6\u6001' , ` created ` datetime DEFAULT NULL , ` updated ` datetime DEFAULT NULL , PRIMARY KEY ( ` id ` ), KEY ` user_id ` ( ` user_id ` ) ) ENGINE = InnoDB DEFAULT CHARSET = utf8 COMMENT = '\u7528\u6237\u4fe1\u606f\u8868' ; 3.4\u3001\u7f16\u5199\u914d\u7f6e \u00b6 application.properties\uff1a spring.application.name = itcast-tanhua-sso server.port = 18080 spring.datasource.driver-class-name = com.mysql.jdbc.Driver spring.datasource.url = jdbc:mysql://192.168.31.81:3306/mytanhua?useUnicode=true&characterEncoding=utf8&autoReconnect=true&allowMultiQueries=true&useSSL=false spring.datasource.username = root spring.datasource.password = root # \u679a\u4e3e\u5305\u626b\u63cf mybatis-plus.type-enums-package = com.tanhua.sso.enums # \u8868\u540d\u524d\u7f00 mybatis-plus.global-config.db-config.table-prefix = tb_ # id\u7b56\u7565\u4e3a\u81ea\u589e\u957f mybatis-plus.global-config.db-config.id-type = auto # Redis\u76f8\u5173\u914d\u7f6e spring.redis.jedis.pool.max-wait = 5000ms spring.redis.jedis.pool.max-Idle = 100 spring.redis.jedis.pool.min-Idle = 10 spring.redis.timeout = 10s spring.redis.cluster.nodes = 192.168.31.81:6379,192.168.31.81:6380,192.168.31.81:6381 spring.redis.cluster.max-redirects = 5 # RocketMQ\u76f8\u5173\u914d\u7f6e rocketmq.name-server = 192.168.31.81:9876 rocketmq.producer.group = tanhua #itcast_tanhua #\u76d0 \u503c jwt.secret = 76bd425b6f29f7fcc2e0bfc286043df1 #\u8679\u8f6f\u76f8\u5173\u914d\u7f6e arcsoft.appid = ***** arcsoft.sdkKey = **** arcsoft.libPath = F:\\\\code\\\\WIN64 3.5\u3001\u7f16\u5199\u57fa\u7840\u4ee3\u7801 \u00b6 3.5.1\u3001Lombok \u00b6 lombok \u63d0\u4f9b\u4e86\u7b80\u5355\u7684\u6ce8\u89e3\u7684\u5f62\u5f0f\u6765\u5e2e\u52a9\u6211\u4eec\u7b80\u5316\u6d88\u9664\u4e00\u4e9b\u5fc5\u987b\u6709\u4f46\u663e\u5f97\u5f88\u81c3\u80bf\u7684 java \u4ee3\u7801\uff0c\u5c24\u5176\u662f\u9488\u5bf9pojo\u3002 \u5b98\u7f51\uff1ahttps://projectlombok.org/ 3.5.1.1\u3001\u914d\u7f6e\u5b89\u88c5 \u00b6 \u5bfc\u5165\u4f9d\u8d56\uff1a <!--\u7b80\u5316\u4ee3\u7801\u7684\u5de5\u5177\u5305--> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> <optional> true </optional> </dependency> \u5b89\u88c5IDEA\u63d2\u4ef6\uff1a \u5982\u679c\u4e0d\u5b89\u88c5\u63d2\u4ef6\uff0c\u7a0b\u5e8f\u53ef\u4ee5\u6b63\u5e38\u6267\u884c\uff0c\u4f46\u662f\u770b\u4e0d\u5230\u751f\u6210\u7684\u4e00\u4e9b\u4ee3\u7801\uff0c\u5982\uff1aget\u3001set\u65b9\u6cd5\u3002 3.5.1.2\u3001\u5e38\u7528\u6ce8\u89e3 \u00b6 @Data\uff1a\u6ce8\u89e3\u5728\u7c7b\u4e0a\uff1b\u63d0\u4f9b\u7c7b\u6240\u6709\u5c5e\u6027\u7684 getting \u548c setting \u65b9\u6cd5\uff0c\u6b64\u5916\u8fd8\u63d0\u4f9b\u4e86equals\u3001canEqual\u3001hashCode\u3001toString \u65b9\u6cd5 @Setter\uff1a\u6ce8\u89e3\u5728\u5c5e\u6027\u4e0a\uff1b\u4e3a\u5c5e\u6027\u63d0\u4f9b setting \u65b9\u6cd5 @Getter\uff1a\u6ce8\u89e3\u5728\u5c5e\u6027\u4e0a\uff1b\u4e3a\u5c5e\u6027\u63d0\u4f9b getting \u65b9\u6cd5 @Slf4j\uff1a\u6ce8\u89e3\u5728\u7c7b\u4e0a\uff1b\u4e3a\u7c7b\u63d0\u4f9b\u4e00\u4e2a \u5c5e\u6027\u540d\u4e3alog \u7684 slf4j\u65e5\u5fd7\u5bf9\u8c61 @NoArgsConstructor\uff1a\u6ce8\u89e3\u5728\u7c7b\u4e0a\uff1b\u4e3a\u7c7b\u63d0\u4f9b\u4e00\u4e2a\u65e0\u53c2\u7684\u6784\u9020\u65b9\u6cd5 @AllArgsConstructor\uff1a\u6ce8\u89e3\u5728\u7c7b\u4e0a\uff1b\u4e3a\u7c7b\u63d0\u4f9b\u4e00\u4e2a\u5168\u53c2\u7684\u6784\u9020\u65b9\u6cd5 @Builder\uff1a\u4f7f\u7528Builder\u6a21\u5f0f\u6784\u5efa\u5bf9\u8c61 \u6d4b\u8bd5\u4e00\uff1a\u4f7f\u7528@Data\u6ce8\u89e3 \u662f\u4e0d\u662f\u5f88\u795e\u5947\uff1f\uff01 \u6d4b\u8bd5\u4e8c\uff1a\u4f7f\u7528@Slf4j\u6ce8\u89e3 \u6d4b\u8bd5\uff1a \u6d4b\u8bd5\u4e09\uff1a@AllArgsConstructor\u3001@NoArgsConstructor\u6ce8\u89e3\u7684\u4f7f\u7528 \u6d4b\u8bd5\u56db\uff1a@Builder \u6d4b\u8bd5\u7ed3\u679c\uff1a 3.5.2\u3001SexEnum \u00b6 \u7528\u6237\u7684\u6027\u522b\u7528\u679a\u4e3e\u8fdb\u884c\u8868\u793a\u3002 package com.tanhua.sso.enums ; import com.baomidou.mybatisplus.core.enums.IEnum ; public enum SexEnum implements IEnum < Integer > { MAN ( 1 , \"\u7537\" ), WOMAN ( 2 , \"\u5973\" ), UNKNOWN ( 3 , \"\u672a\u77e5\" ); private int value ; private String desc ; SexEnum ( int value , String desc ) { this . value = value ; this . desc = desc ; } @Override public Integer getValue () { return this . value ; } @Override public String toString () { return this . desc ; } } 3.5.3\u3001User\u3001UserInfo \u00b6 package com.tanhua.sso.pojo ; import com.baomidou.mybatisplus.annotation.FieldFill ; import com.baomidou.mybatisplus.annotation.TableField ; import lombok.Data ; import java.util.Date ; @Data public abstract class BasePojo { @TableField ( fill = FieldFill . INSERT ) //MP\u81ea\u52a8\u586b\u5145 private Date created ; @TableField ( fill = FieldFill . INSERT_UPDATE ) private Date updated ; } package com.tanhua.sso.pojo ; import com.fasterxml.jackson.annotation.JsonIgnore ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class User extends BasePojo { private Long id ; private String mobile ; //\u624b\u673a\u53f7 @JsonIgnore private String password ; //\u5bc6\u7801\uff0cjson\u5e8f\u5217\u5316\u65f6\u5ffd\u7565 } package com.tanhua.sso.pojo ; import com.tanhua.sso.enums.SexEnum ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class UserInfo extends BasePojo { private Long id ; private Long userId ; //\u7528\u6237id private String nickName ; //\u6635\u79f0 private String logo ; //\u7528\u6237\u5934\u50cf private String tags ; //\u7528\u6237\u6807\u7b7e\uff1a\u591a\u4e2a\u7528\u9017\u53f7\u5206\u9694 private SexEnum sex ; //\u6027\u522b private Integer age ; //\u5e74\u9f84 private String edu ; //\u5b66\u5386 private String city ; //\u57ce\u5e02 private String birthday ; //\u751f\u65e5 private String coverPic ; // \u5c01\u9762\u56fe\u7247 private String industry ; //\u884c\u4e1a private String income ; //\u6536\u5165 private String marriage ; //\u5a5a\u59fb\u72b6\u6001 } 3.5.4\u3001MyMetaObjectHandler \u00b6 \u5bf9\u81ea\u52a8\u586b\u5145\u5b57\u6bb5\u7684\u5904\u7406\uff1a package com.tanhua.sso.handler ; import com.baomidou.mybatisplus.core.handlers.MetaObjectHandler ; import org.apache.ibatis.reflection.MetaObject ; import org.springframework.stereotype.Component ; import java.util.Date ; @Component public class MyMetaObjectHandler implements MetaObjectHandler { @Override public void insertFill ( MetaObject metaObject ) { Object created = getFieldValByName ( \"created\" , metaObject ); if ( null == created ) { //\u5b57\u6bb5\u4e3a\u7a7a\uff0c\u53ef\u4ee5\u8fdb\u884c\u586b\u5145 setFieldValByName ( \"created\" , new Date (), metaObject ); } Object updated = getFieldValByName ( \"updated\" , metaObject ); if ( null == updated ) { //\u5b57\u6bb5\u4e3a\u7a7a\uff0c\u53ef\u4ee5\u8fdb\u884c\u586b\u5145 setFieldValByName ( \"updated\" , new Date (), metaObject ); } } @Override public void updateFill ( MetaObject metaObject ) { //\u66f4\u65b0\u6570\u636e\u65f6\uff0c\u76f4\u63a5\u66f4\u65b0\u5b57\u6bb5 setFieldValByName ( \"updated\" , new Date (), metaObject ); } } 3.5.5\u3001UserMapper \u00b6 package com.tanhua.sso.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.sso.pojo.User ; public interface UserMapper extends BaseMapper < User > { } package com.tanhua.sso.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.sso.pojo.UserInfo ; public interface UserInfoMapper extends BaseMapper < UserInfo > { } 3.5.6\u3001MyApplication \u00b6 SpringBoot\u7684\u542f\u52a8\u7c7b\u3002 package com.tanhua.sso ; import org.mybatis.spring.annotation.MapperScan ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; @MapperScan ( \"com.tanhua.sso.mapper\" ) //\u8bbe\u7f6emapper\u63a5\u53e3\u7684\u626b\u63cf\u5305 @SpringBootApplication public class MyApplication { public static void main ( String [] args ) { SpringApplication . run ( MyApplication . class , args ); } } 3.6\u3001\u77ed\u4fe1\u9a8c\u8bc1\u7801 \u00b6 \u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u7684\u6d41\u7a0b\uff1a \u6d41\u7a0b\u8bf4\u660e\uff1a \u7528\u6237\u5411SSO\u7cfb\u7edf\u53d1\u9001\u8bf7\u6c42\uff0c\u5728\u8bf7\u6c42\u4e2d\u4f20\u9012\u624b\u673a\u53f7\uff1b SSO\u7cfb\u7edf\u63a5\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u751f\u6210\u968f\u673a\u9a8c\u8bc1\u7801\u4ee5\u53ca\u77ed\u4fe1\u5185\u5bb9\uff0c\u8bf7\u6c42\u963f\u91cc\u4e91\u77ed\u4fe1\u670d\u52a1\uff1b \u963f\u91cc\u4e91\u77ed\u4fe1\u670d\u52a1\u63a5\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u4f1a\u8fdb\u884c\u4e00\u7cfb\u5217\u7684\u9a8c\u8bc1\uff0c\u6bd4\u5982\u8d26\u53f7\u4f59\u989d\u3001\u77ed\u4fe1\u6a21\u677f\u662f\u5426\u6b63\u786e\u7b49\uff0c\u6700\u540e\u5411\u8fd0\u8425\u5546\u53d1\u8d77\u8bf7\u6c42\uff1b \u8fd0\u8425\u5546\u63a5\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u5411\u8be5\u624b\u673a\u53f7\u4e0b\u53d1\u77ed\u4fe1\uff0c\u7528\u6237\u5373\u53ef\u6536\u5230\u77ed\u4fe1\uff1b 3.6.1\u3001\u963f\u91cc\u4e91\u77ed\u4fe1\u670d\u52a1 \u00b6 3.6.1.1\u3001\u7533\u8bf7\u7b7e\u540d\u4e0e\u6a21\u677f \u00b6 https://dysms.console.aliyun.com/dysms.htm?spm=5176.12818093.0.ddysms.2a4316d0ql6PyD \u8bf4\u660e\uff1a\u7533\u8bf7\u7b7e\u540d\u65f6\uff0c\u4e2a\u4eba\u7528\u6237\u53ea\u80fd\u7533\u8bf7\u4e00\u4e2a\u5e76\u4e14\u7b7e\u540d\u7684\u540d\u79f0\u5fc5\u987b\u4e3a\u201cABC\u5546\u57ce\u201d\uff0c\u5426\u5219\u5ba1\u6838\u4e0d\u901a\u8fc7\u3002 \u7533\u8bf7\u6a21\u677f\uff1a \u5ba1\u6838\u65f6\u95f4\u9700\u89811~2\u5c0f\u65f6\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85~ 3.6.1.2\u3001\u8bbe\u7f6e\u7528\u6237\u6743\u9650 \u00b6 \u5728\u963f\u91cc\u4e91\u4e2d\uff0c\u9700\u8981\u5728RAM\u670d\u52a1\u4e2d\u521b\u5efa\u7528\u6237\u4ee5\u53ca\u6743\u9650\uff0c\u624d\u80fd\u901a\u8fc7api\u8fdb\u884c\u8bbf\u95ee\u63a5\u53e3\u3002 \u521b\u5efa\u7528\u6237\uff1a \u521b\u5efa\u5b8c\u6210\u540e\u8981\u4fdd\u5b58AccessKey Secret\u548cAccessKey ID\uff0cAccessKey Secret\u53ea\u663e\u793a\u8fd9\u4e00\u6b21\uff0c\u540e\u9762\u5c06\u4e0d\u518d\u663e\u793a\u3002 \u6dfb\u52a0\u6743\u9650\uff1a 3.6.1.3\u3001\u793a\u4f8b\u4ee3\u7801 \u00b6 \u6587\u6863\uff1ahttps://help.aliyun.com/document_detail/101414.html?spm=a2c4g.11186623.6.625.18705ffa8u4lwj\uff1a package com.tanhua.sso.service ; import com.aliyuncs.CommonRequest ; import com.aliyuncs.CommonResponse ; import com.aliyuncs.DefaultAcsClient ; import com.aliyuncs.IAcsClient ; import com.aliyuncs.exceptions.ClientException ; import com.aliyuncs.exceptions.ServerException ; import com.aliyuncs.http.MethodType ; import com.aliyuncs.profile.DefaultProfile ; /* pom.xml <dependency> <groupId>com.aliyun</groupId> <artifactId>aliyun-java-sdk-core</artifactId> <version>4.5.3</version> </dependency> */ public class SendSms { public static void main ( String [] args ) { DefaultProfile profile = DefaultProfile . getProfile ( \"cn-hangzhou\" , \"LTAI4G7d2Q9CHc741gighjTF\" , \"uKOOGdIKvmoGhHlej8cJY8H3nlU6Fj\" ); IAcsClient client = new DefaultAcsClient ( profile ); CommonRequest request = new CommonRequest (); request . setSysMethod ( MethodType . POST ); request . setSysDomain ( \"dysmsapi.aliyuncs.com\" ); request . setSysVersion ( \"2017-05-25\" ); request . setSysAction ( \"SendSms\" ); request . putQueryParameter ( \"RegionId\" , \"cn-hangzhou\" ); request . putQueryParameter ( \"PhoneNumbers\" , \"158****7944\" ); //\u76ee\u6807\u624b\u673a\u53f7 request . putQueryParameter ( \"SignName\" , \"ABC\u5546\u57ce\" ); //\u7b7e\u540d\u540d\u79f0 request . putQueryParameter ( \"TemplateCode\" , \"SMS_204756062\" ); //\u77ed\u4fe1\u6a21\u677fcode request . putQueryParameter ( \"TemplateParam\" , \"{\\\"code\\\":\\\"123456\\\"}\" ); //\u6a21\u677f\u4e2d\u53d8\u91cf\u66ff\u6362 try { CommonResponse response = client . getCommonResponse ( request ); //{\"Message\":\"OK\",\"RequestId\":\"EC2D4C9A-0EAC-4213-BE45-CE6176E1DF23\",\"BizId\":\"110903802851113360^0\",\"Code\":\"OK\"} System . out . println ( response . getData ()); } catch ( ServerException e ) { e . printStackTrace (); } catch ( ClientException e ) { e . printStackTrace (); } } } 3.6.1.4\u3001\u5b9e\u73b0\u53d1\u9001\u77ed\u4fe1\u65b9\u6cd5 \u00b6 \u914d\u7f6e\u6587\u4ef6\uff1aaliyun.properties aliyun.sms.regionId = cn-hangzhou aliyun.sms.accessKeyId = LTAI4G7d2Q9CHc741gighjTF aliyun.sms.accessKeySecret = uKOOGdIKvmoGhHlej8cJY8H3nlU6Fj aliyun.sms.domain = dysmsapi.aliyuncs.com aliyun.sms.signName = ABC\u5546\u57ce aliyun.sms.templateCode = SMS_204756062 \u9700\u8981\u6ce8\u610f\u4e2d\u6587\u7f16\u7801\u95ee\u9898\uff1a \u8bfb\u53d6\u914d\u7f6e\uff1a package com.tanhua.sso.config ; import lombok.Data ; import org.springframework.boot.context.properties.ConfigurationProperties ; import org.springframework.context.annotation.Configuration ; import org.springframework.context.annotation.PropertySource ; @Configuration @PropertySource ( \"classpath:aliyun.properties\" ) @ConfigurationProperties ( prefix = \"aliyun.sms\" ) @Data public class AliyunSMSConfig { private String regionId ; private String accessKeyId ; private String accessKeySecret ; private String domain ; private String signName ; private String templateCode ; } \u4ee3\u7801\u5b9e\u73b0\uff1a //SmsService.java /** * \u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801 * * @param mobile * @return */ public String sendSms ( String mobile ) { DefaultProfile profile = DefaultProfile . getProfile ( this . aliyunSMSConfig . getRegionId (), this . aliyunSMSConfig . getAccessKeyId (), this . aliyunSMSConfig . getAccessKeySecret ()); IAcsClient client = new DefaultAcsClient ( profile ); String code = RandomUtils . nextInt ( 100000 , 999999 ) + \"\" ; CommonRequest request = new CommonRequest (); request . setSysMethod ( MethodType . POST ); request . setSysDomain ( this . aliyunSMSConfig . getDomain ()); request . setSysVersion ( \"2017-05-25\" ); request . setSysAction ( \"SendSms\" ); request . putQueryParameter ( \"RegionId\" , this . aliyunSMSConfig . getRegionId ()); request . putQueryParameter ( \"PhoneNumbers\" , mobile ); //\u76ee\u6807\u624b\u673a\u53f7 request . putQueryParameter ( \"SignName\" , this . aliyunSMSConfig . getSignName ()); //\u7b7e\u540d\u540d\u79f0 request . putQueryParameter ( \"TemplateCode\" , this . aliyunSMSConfig . getTemplateCode ()); //\u77ed\u4fe1\u6a21\u677fcode request . putQueryParameter ( \"TemplateParam\" , \"{\\\"code\\\":\\\"\" + code + \"\\\"}\" ); //\u6a21\u677f\u4e2d\u53d8\u91cf\u66ff\u6362 try { CommonResponse response = client . getCommonResponse ( request ); String data = response . getData (); if ( StringUtils . contains ( data , \"\\\"Message\\\":\\\"OK\\\"\" )) { return code ; } log . info ( \"\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u5931\u8d25~ data = \" + data ); } catch ( Exception e ) { log . error ( \"\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u5931\u8d25~ mobile = \" + mobile , e ); } return null ; } 3.6.2\u3001SSO\u77ed\u4fe1\u63a5\u53e3\u670d\u52a1 \u00b6 3.6.2.1\u3001mock\u63a5\u53e3 \u00b6 \u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/581 3.6.2.2\u3001\u7f16\u5199\u63a5\u53e3\u670d\u52a1 \u00b6 \u7f16\u5199ErrorResult\uff0cErrorResult\u5bf9\u8c61\u662f\u4e0e\u524d\u7aef\u7ea6\u5b9a\u597d\u7684\u7ed3\u6784\uff0c\u5982\u679c\u53d1\u751f\u9519\u8bef\u9700\u8981\u8fd4\u56de\u8be5\u5bf9\u8c61\uff0c\u5982\u679c\u672a\u53d1\u751f\u9519\u8bef\u54cd\u5e94200\u5373\u53ef\u3002 package com.tanhua.sso.vo ; import lombok.Builder ; import lombok.Data ; @Data @Builder public class ErrorResult { private String errCode ; private String errMessage ; } SmsController\uff1a package com.tanhua.sso.controller ; import com.tanhua.sso.service.SmsService ; import com.tanhua.sso.vo.ErrorResult ; import lombok.extern.slf4j.Slf4j ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestBody ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RestController ; import java.util.Map ; @RestController @RequestMapping ( \"user\" ) @Slf4j public class SmsController { @Autowired private SmsService smsService ; /** * \u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u63a5\u53e3 * * @param param * @return */ @PostMapping ( \"login\" ) public ResponseEntity < ErrorResult > sendCheckCode ( @RequestBody Map < String , String > param ) { ErrorResult errorResult = null ; String phone = param . get ( \"phone\" ); try { errorResult = this . smsService . sendCheckCode ( phone ); if ( null == errorResult ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { log . error ( \"\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u5931\u8d25~ phone = \" + phone , e ); errorResult = ErrorResult . builder (). errCode ( \"000002\" ). errMessage ( \"\u77ed\u4fe1\u9a8c\u8bc1\u7801\u53d1\u9001\u5931\u8d25\uff01\" ). build (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). body ( errorResult ); } } SmsService\uff1a package com.tanhua.sso.service ; import com.aliyuncs.CommonRequest ; import com.aliyuncs.CommonResponse ; import com.aliyuncs.DefaultAcsClient ; import com.aliyuncs.IAcsClient ; import com.aliyuncs.exceptions.ClientException ; import com.aliyuncs.exceptions.ServerException ; import com.aliyuncs.http.MethodType ; import com.aliyuncs.profile.DefaultProfile ; import com.tanhua.sso.config.AliyunSMSConfig ; import com.tanhua.sso.vo.ErrorResult ; import lombok.extern.slf4j.Slf4j ; import org.apache.commons.lang3.RandomUtils ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.redis.core.RedisTemplate ; import org.springframework.stereotype.Service ; import java.time.Duration ; @Service @Slf4j public class SmsService { @Autowired private AliyunSMSConfig aliyunSMSConfig ; @Autowired private RedisTemplate < String , String > redisTemplate ; /** * \u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801 * * @param mobile * @return */ public String sendSms ( String mobile ) { DefaultProfile profile = DefaultProfile . getProfile ( this . aliyunSMSConfig . getRegionId (), this . aliyunSMSConfig . getAccessKeyId (), this . aliyunSMSConfig . getAccessKeySecret ()); IAcsClient client = new DefaultAcsClient ( profile ); String code = RandomUtils . nextInt ( 100000 , 999999 ) + \"\" ; CommonRequest request = new CommonRequest (); request . setSysMethod ( MethodType . POST ); request . setSysDomain ( this . aliyunSMSConfig . getDomain ()); request . setSysVersion ( \"2017-05-25\" ); request . setSysAction ( \"SendSms\" ); request . putQueryParameter ( \"RegionId\" , this . aliyunSMSConfig . getRegionId ()); request . putQueryParameter ( \"PhoneNumbers\" , mobile ); //\u76ee\u6807\u624b\u673a\u53f7 request . putQueryParameter ( \"SignName\" , this . aliyunSMSConfig . getSignName ()); //\u7b7e\u540d\u540d\u79f0 request . putQueryParameter ( \"TemplateCode\" , this . aliyunSMSConfig . getTemplateCode ()); //\u77ed\u4fe1\u6a21\u677fcode request . putQueryParameter ( \"TemplateParam\" , \"{\\\"code\\\":\\\"\" + code + \"\\\"}\" ); //\u6a21\u677f\u4e2d\u53d8\u91cf\u66ff\u6362 try { CommonResponse response = client . getCommonResponse ( request ); String data = response . getData (); if ( StringUtils . contains ( data , \"\\\"Message\\\":\\\"OK\\\"\" )) { return code ; } log . info ( \"\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u5931\u8d25~ data = \" + data ); } catch ( Exception e ) { log . error ( \"\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u5931\u8d25~ mobile = \" + mobile , e ); } return null ; } /** * \u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801 * \u5b9e\u73b0\uff1a\u53d1\u9001\u5b8c\u6210\u77ed\u4fe1\u9a8c\u8bc1\u7801\u540e\uff0c\u9700\u8981\u5c06\u9a8c\u8bc1\u7801\u4fdd\u5b58\u5230redis\u4e2d * @param phone * @return */ public ErrorResult sendCheckCode ( String phone ) { String redisKey = \"CHECK_CODE_\" + phone ; //\u5148\u5224\u65ad\u8be5\u624b\u673a\u53f7\u53d1\u9001\u7684\u9a8c\u8bc1\u7801\u662f\u5426\u8fd8\u672a\u5931\u6548 if ( this . redisTemplate . hasKey ( redisKey )){ String msg = \"\u4e0a\u4e00\u6b21\u53d1\u9001\u7684\u9a8c\u8bc1\u7801\u8fd8\u672a\u5931\u6548\uff01\" ; return ErrorResult . builder (). errCode ( \"000001\" ). errMessage ( msg ). build (); } String code = this . sendSms ( phone ); if ( StringUtils . isEmpty ( code )){ String msg = \"\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u5931\u8d25\uff01\" ; return ErrorResult . builder (). errCode ( \"000000\" ). errMessage ( msg ). build (); } //\u77ed\u4fe1\u53d1\u9001\u6210\u529f\uff0c\u5c06\u9a8c\u8bc1\u7801\u4fdd\u5b58\u5230redis\u4e2d\uff0c\u6709\u6548\u671f\u4e3a5\u5206\u949f this . redisTemplate . opsForValue (). set ( redisKey , code , Duration . ofMinutes ( 5 )); return null ; } } 3.7\u3001JWT \u00b6 3.7.1\u3001\u7b80\u4ecb \u00b6 JSON Web token\u7b80\u79f0JWT\uff0c \u662f\u7528\u4e8e\u5bf9\u5e94\u7528\u7a0b\u5e8f\u4e0a\u7684\u7528\u6237\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u7684\u6807\u8bb0\u3002\u4e5f\u5c31\u662f\u8bf4, \u4f7f\u7528 JWTS \u7684\u5e94\u7528\u7a0b\u5e8f\u4e0d\u518d\u9700\u8981\u4fdd\u5b58\u6709\u5173\u5176\u7528\u6237\u7684 cookie \u6216\u5176\u4ed6session\u6570\u636e\u3002\u6b64\u7279\u6027\u4fbf\u4e8e\u53ef\u4f38\u7f29\u6027, \u540c\u65f6\u4fdd\u8bc1\u5e94\u7528\u7a0b\u5e8f\u7684\u5b89\u5168\u3002 \u5728\u8eab\u4efd\u9a8c\u8bc1\u8fc7\u7a0b\u4e2d, \u5f53\u7528\u6237\u4f7f\u7528\u5176\u51ed\u636e\u6210\u529f\u767b\u5f55\u65f6, \u5c06\u8fd4\u56de JSON Web token, \u5e76\u4e14\u5fc5\u987b\u5728\u672c\u5730\u4fdd\u5b58 (\u901a\u5e38\u5728\u672c\u5730\u5b58\u50a8\u4e2d)\u3002 \u6bcf\u5f53\u7528\u6237\u8981\u8bbf\u95ee\u53d7\u4fdd\u62a4\u7684\u8def\u7531\u6216\u8d44\u6e90 (\u7aef\u70b9) \u65f6, \u7528\u6237\u4ee3\u7406(user agent)\u5fc5\u987b\u8fde\u540c\u8bf7\u6c42\u4e00\u8d77\u53d1\u9001 JWT, \u901a\u5e38\u5728\u6388\u6743\u6807\u5934\u4e2d\u4f7f\u7528Bearer schema\u3002\u540e\u7aef\u670d\u52a1\u5668\u63a5\u6536\u5230\u5e26\u6709 JWT \u7684\u8bf7\u6c42\u65f6, \u9996\u5148\u8981\u505a\u7684\u662f\u9a8c\u8bc1token\u3002 3.7.2\u3001\u683c\u5f0f \u00b6 JWT\u5c31\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u7ecf\u8fc7\u52a0\u5bc6\u5904\u7406\u4e0e\u6821\u9a8c\u5904\u7406\u7684\u5b57\u7b26\u4e32\uff0c\u5f62\u5f0f\u4e3a\uff1aA.B.C A\u7531JWT\u5934\u90e8\u4fe1\u606fheader\u7ecf\u8fc7base64\u52a0\u5bc6\u5f97\u5230 ~~~json #\u9ed8\u8ba4\u7684\u5934\u4fe1\u606f { \"alg\": \"HS256\", \"typ\": \"JWT\" } \u5b98\u7f51\u6d4b\u8bd5\uff1ahttps://jwt.io/ \u00b6 base64\u52a0\u5bc6\u540e\u7684\u5b57\u7b26\u4e32\u4e3a\uff1aeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9 \u00b6 ~~~ B\u662fpayload\uff0c\u5b58\u653e\u6709\u6548\u4fe1\u606f\u7684\u5730\u65b9\uff0c\u8fd9\u4e9b\u4fe1\u606f\u5305\u542b\u4e09\u4e2a\u90e8\u5206\uff1a \u6807\u51c6\u4e2d\u6ce8\u518c\u7684\u58f0\u660e (\u5efa\u8bae\u4f46\u4e0d\u5f3a\u5236\u4f7f\u7528) iss: jwt\u7b7e\u53d1\u8005 sub: jwt\u6240\u9762\u5411\u7684\u7528\u6237 aud: \u63a5\u6536jwt\u7684\u4e00\u65b9 exp: jwt\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u8fd9\u4e2a\u8fc7\u671f\u65f6\u95f4\u5fc5\u987b\u8981\u5927\u4e8e\u7b7e\u53d1\u65f6\u95f4 nbf: \u5b9a\u4e49\u5728\u4ec0\u4e48\u65f6\u95f4\u4e4b\u524d\uff0c\u8be5jwt\u90fd\u662f\u4e0d\u53ef\u7528\u7684. iat: jwt\u7684\u7b7e\u53d1\u65f6\u95f4 jti: jwt\u7684\u552f\u4e00\u8eab\u4efd\u6807\u8bc6\uff0c\u4e3b\u8981\u7528\u6765\u4f5c\u4e3a\u4e00\u6b21\u6027token,\u4ece\u800c\u56de\u907f\u91cd\u653e\u653b\u51fb\u3002 \u516c\u5171\u7684\u58f0\u660e \u516c\u5171\u7684\u58f0\u660e\u53ef\u4ee5\u6dfb\u52a0\u4efb\u4f55\u7684\u4fe1\u606f\uff0c\u4e00\u822c\u6dfb\u52a0\u7528\u6237\u7684\u76f8\u5173\u4fe1\u606f\u6216\u5176\u4ed6\u4e1a\u52a1\u9700\u8981\u7684\u5fc5\u8981\u4fe1\u606f.\u4f46\u4e0d\u5efa\u8bae\u6dfb\u52a0\u654f\u611f\u4fe1\u606f\uff0c\u56e0\u4e3a\u8be5\u90e8\u5206\u5728\u5ba2\u6237\u7aef\u53ef\u89e3\u5bc6. \u79c1\u6709\u7684\u58f0\u660e \u79c1\u6709\u58f0\u660e\u662f\u63d0\u4f9b\u8005\u548c\u6d88\u8d39\u8005\u6240\u5171\u540c\u5b9a\u4e49\u7684\u58f0\u660e\uff0c\u4e00\u822c\u4e0d\u5efa\u8bae\u5b58\u653e\u654f\u611f\u4fe1\u606f\uff0c\u56e0\u4e3abase64\u662f\u5bf9\u79f0\u89e3\u5bc6\u7684\uff0c\u610f\u5473\u7740\u8be5\u90e8\u5206\u4fe1\u606f\u53ef\u4ee5\u5f52\u7c7b\u4e3a\u660e\u6587\u4fe1\u606f\u3002 ~~~json #\u5b58\u653e\u7684\u6570\u636e\uff1a { \"sub\": \"1234567890\", \"name\": \"John Doe\", \"iat\": 1516239022 } base64\u540e\u7684\u5b57\u7b26\u4e32\u4e3a\uff1a \u00b6 eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ ~~~ C\u7531A\u548cB\u901a\u8fc7\u52a0\u5bc6\u7b97\u6cd5\u5f97\u5230\uff0c\u7528\u4f5c\u5bf9token\u8fdb\u884c\u6821\u9a8c\uff0c\u770b\u662f\u5426\u6709\u6548 \u8fd9\u4e2a\u90e8\u5206\u9700\u8981base64\u52a0\u5bc6\u540e\u7684header\u548cbase64\u52a0\u5bc6\u540e\u7684payload\u4f7f\u7528 . \u8fde\u63a5\u7ec4\u6210\u7684\u5b57\u7b26\u4e32\uff0c\u7136\u540e\u901a\u8fc7header\u4e2d\u58f0\u660e\u7684\u52a0\u5bc6\u65b9\u5f0f\u8fdb\u884c\u52a0\u76d0 secret \u7ec4\u5408\u52a0\u5bc6\uff0c\u7136\u540e\u5c31\u6784\u6210\u4e86jwt\u7684\u7b2c\u4e09\u90e8\u5206\u3002 ~~~json #secret\u4e3a\uff1aitcast #\u5f97\u5230\u7684\u52a0\u5bc6\u5b57\u7b26\u4e32\u4e3a\uff1aDwMTjJktoFFdClHqjJMRgYzICo6FJOUc3Jmev9EScBc \u6574\u4f53\u7684token\u4e3a\uff1aeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.DwMTjJktoFFdClHqjJMRgYzICo6FJOUc3Jmev9EScBc \u00b6 ~~~ 3.7.3\u3001\u6d41\u7a0b \u00b6 3.7.4\u3001\u793a\u4f8b \u00b6 \u5bfc\u5165\u4f9d\u8d56\uff1a <dependency> <groupId> io.jsonwebtoken </groupId> <artifactId> jjwt </artifactId> <version> 0.9.1 </version> </dependency> \u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b\uff1a package com.tanhua.sso.service ; import io.jsonwebtoken.ExpiredJwtException ; import io.jsonwebtoken.JwsHeader ; import io.jsonwebtoken.Jwts ; import io.jsonwebtoken.SignatureAlgorithm ; import org.junit.Test ; import java.util.Date ; import java.util.HashMap ; import java.util.Map ; public class TestJWT { String secret = \"itcast\" ; @Test public void testCreateToken (){ Map < String , Object > header = new HashMap < String , Object > (); header . put ( JwsHeader . TYPE , JwsHeader . JWT_TYPE ); header . put ( JwsHeader . ALGORITHM , \"HS256\" ); Map < String , Object > claims = new HashMap < String , Object > (); claims . put ( \"mobile\" , \"1333333333\" ); claims . put ( \"id\" , \"2\" ); // \u751f\u6210token String jwt = Jwts . builder () . setHeader ( header ) //header\uff0c\u53ef\u7701\u7565 . setClaims ( claims ) //payload\uff0c\u5b58\u653e\u6570\u636e\u7684\u4f4d\u7f6e\uff0c\u4e0d\u80fd\u653e\u7f6e\u654f\u611f\u6570\u636e\uff0c\u5982\uff1a\u5bc6\u7801\u7b49 . signWith ( SignatureAlgorithm . HS256 , secret ) //\u8bbe\u7f6e\u52a0\u5bc6\u65b9\u6cd5\u548c\u52a0\u5bc6\u76d0 . setExpiration ( new Date ( System . currentTimeMillis () + 3000 )) //\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c3\u79d2\u540e\u8fc7\u671f . compact (); System . out . println ( jwt ); } @Test public void testDecodeToken (){ String token = \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJtb2JpbGUiOiIxMzMzMzMzMzMzIiwiaWQiOiIyIiwiZXhwIjoxNjA1NTEzMDA2fQ.1eG3LpudD4XBycUG39UQDaKVBQHgaup-E1OLWo_m8m8\" ; try { // \u901a\u8fc7token\u89e3\u6790\u6570\u636e Map < String , Object > body = Jwts . parser () . setSigningKey ( secret ) . parseClaimsJws ( token ) . getBody (); System . out . println ( body ); //{mobile=1333333333, id=2, exp=1605513392} } catch ( ExpiredJwtException e ) { System . out . println ( \"token\u5df2\u7ecf\u8fc7\u671f\uff01\" ); } catch ( Exception e ) { System . out . println ( \"token\u4e0d\u5408\u6cd5\uff01\" ); } } } 3.8\u3001\u7528\u6237\u767b\u5f55 \u00b6 \u7528\u6237\u63a5\u6536\u5230\u9a8c\u8bc1\u7801\u540e\uff0c\u8fdb\u884c\u8f93\u5165\u9a8c\u8bc1\u7801\uff0c\u70b9\u51fb\u767b\u5f55\uff0c\u524d\u7aef\u7cfb\u7edf\u5c06\u624b\u673a\u53f7\u4ee5\u53ca\u9a8c\u8bc1\u7801\u63d0\u4ea4\u5230SSO\u8fdb\u884c\u6821\u9a8c\u3002 3.7.1\u3001mock\u63a5\u53e3 \u00b6 \u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/164/interface/api/12593 3.7.2\u3001UserController \u00b6 package com.tanhua.sso.controller ; import com.tanhua.sso.service.UserService ; import com.tanhua.sso.vo.ErrorResult ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestBody ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RestController ; import java.util.HashMap ; import java.util.Map ; @RestController @RequestMapping ( \"user\" ) public class UserController { @Autowired private UserService userService ; /** * \u7528\u6237\u767b\u5f55 * * @param param * @return */ @PostMapping ( \"loginVerification\" ) public ResponseEntity < Object > login ( @RequestBody Map < String , String > param ){ try { String phone = param . get ( \"phone\" ); String code = param . get ( \"verificationCode\" ); String data = this . userService . login ( phone , code ); if ( StringUtils . isNotEmpty ( data )){ //\u767b\u5f55\u6210\u529f Map < String , Object > result = new HashMap <> ( 2 ); String [] ss = StringUtils . split ( data , '|' ); result . put ( \"token\" , ss [ 0 ] ); result . put ( \"isNew\" , Boolean . valueOf ( ss [ 1 ] )); return ResponseEntity . ok ( result ); } } catch ( Exception e ) { e . printStackTrace (); } ErrorResult errorResult = ErrorResult . builder (). errCode ( \"000002\" ). errMessage ( \"\u767b\u5f55\u5931\u8d25\uff01\" ). build (); return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). body ( errorResult ); } } 3.7.3\u3001UserService \u00b6 package com.tanhua.sso.service ; import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.tanhua.sso.mapper.UserMapper ; import com.tanhua.sso.pojo.User ; import io.jsonwebtoken.Jwts ; import io.jsonwebtoken.SignatureAlgorithm ; import lombok.extern.slf4j.Slf4j ; import org.apache.commons.codec.digest.DigestUtils ; import org.apache.commons.lang3.StringUtils ; import org.apache.rocketmq.spring.core.RocketMQTemplate ; import org.joda.time.DateTime ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.data.redis.core.RedisTemplate ; import org.springframework.messaging.MessagingException ; import org.springframework.stereotype.Service ; import java.util.HashMap ; import java.util.Map ; @Service @Slf4j public class UserService { @Autowired private RedisTemplate < String , String > redisTemplate ; @Autowired private UserMapper userMapper ; @Value ( \"${jwt.secret}\" ) private String secret ; @Autowired private RocketMQTemplate rocketMQTemplate ; /** * \u7528\u6237\u767b\u5f55 * * @param phone \u624b\u673a\u53f7 * @param code \u9a8c\u8bc1\u7801 * @return */ public String login ( String phone , String code ) { String redisKey = \"CHECK_CODE_\" + phone ; boolean isNew = false ; //\u6821\u9a8c\u9a8c\u8bc1\u7801 String redisData = this . redisTemplate . opsForValue (). get ( redisKey ); if ( ! StringUtils . equals ( code , redisData )) { return null ; //\u9a8c\u8bc1\u7801\u9519\u8bef } //\u9a8c\u8bc1\u7801\u5728\u6821\u9a8c\u5b8c\u6210\u540e\uff0c\u9700\u8981\u5e9f\u5f03 this . redisTemplate . delete ( redisKey ); QueryWrapper < User > queryWrapper = new QueryWrapper <> (); queryWrapper . eq ( \"mobile\" , phone ); User user = this . userMapper . selectOne ( queryWrapper ); if ( null == user ) { //\u9700\u8981\u6ce8\u518c\u8be5\u7528\u6237 user = new User (); user . setMobile ( phone ); user . setPassword ( DigestUtils . md5Hex ( \"123456\" )); //\u6ce8\u518c\u65b0\u7528\u6237 this . userMapper . insert ( user ); isNew = true ; } //\u751f\u6210token Map < String , Object > claims = new HashMap < String , Object > (); claims . put ( \"id\" , user . getId ()); // \u751f\u6210token String token = Jwts . builder () . setClaims ( claims ) //payload\uff0c\u5b58\u653e\u6570\u636e\u7684\u4f4d\u7f6e\uff0c\u4e0d\u80fd\u653e\u7f6e\u654f\u611f\u6570\u636e\uff0c\u5982\uff1a\u5bc6\u7801\u7b49 . signWith ( SignatureAlgorithm . HS256 , secret ) //\u8bbe\u7f6e\u52a0\u5bc6\u65b9\u6cd5\u548c\u52a0\u5bc6\u76d0 . setExpiration ( new DateTime (). plusHours ( 12 ). toDate ()) //\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c12\u5c0f\u65f6\u540e\u8fc7\u671f . compact (); try { //\u53d1\u9001\u7528\u6237\u767b\u5f55\u6210\u529f\u7684\u6d88\u606f Map < String , Object > msg = new HashMap <> (); msg . put ( \"id\" , user . getId ()); msg . put ( \"date\" , System . currentTimeMillis ()); this . rocketMQTemplate . convertAndSend ( \"tanhua-sso-login\" , msg ); } catch ( MessagingException e ) { log . error ( \"\u53d1\u9001\u6d88\u606f\u5931\u8d25\uff01\" , e ); } return token + \"|\" + isNew ; } } 3.7.4\u3001\u6d4b\u8bd5 \u00b6","title":"day01"},{"location":"tantan/day01/#_1","text":"\u529f\u80fd\u4ecb\u7ecd \u9879\u76ee\u4ecb\u7ecd \u5de5\u7a0b\u642d\u5efa \u77ed\u4fe1\u9a8c\u8bc1\u7801 \u5b9e\u73b0\u7528\u6237\u767b\u5f55\u529f\u80fd","title":"\u8bfe\u7a0b\u4ecb\u7ecd  \u300a\u63a2\u82b1\u4ea4\u53cb\u300b"},{"location":"tantan/day01/#1","text":"\u63a2\u82b1\u4ea4\u53cb\u662f\u4e00\u4e2a\u964c\u751f\u4eba\u7684\u5728\u7ebf\u4ea4\u53cb\u5e73\u53f0\uff0c\u5728\u8be5\u5e73\u53f0\u4e2d\u53ef\u4ee5\u641c\u7d22\u9644\u8fd1\u7684\u4eba\uff0c\u67e5\u770b\u597d\u53cb\u52a8\u6001\uff0c\u5e73\u53f0\u8fd8\u4f1a\u901a\u8fc7\u5927\u6570\u636e\u8ba1\u7b97\u8fdb\u884c\u667a\u80fd\u63a8\u8350\uff0c\u901a\u8fc7\u667a\u80fd\u63a8\u8350\u53ef\u4ee5\u627e\u5230\u66f4\u52a0\u5339\u914d\u7684\u597d\u53cb\uff0c\u8fd9\u6837\u624d\u80fd\u589e\u8fdb\u7528\u6237\u5bf9\u4ea7\u54c1\u7684\u559c\u7231\u5ea6\u3002\u63a2\u82b1\u5e73\u53f0\u8fd8\u63d0\u4f9b\u4e86\u5728\u7ebf\u5373\u65f6\u901a\u8baf\u529f\u80fd\uff0c\u53ef\u4ee5\u5b9e\u65f6\u7684\u4e0e\u597d\u53cb\u8fdb\u884c\u6c9f\u901a\uff0c\u8ba9\u6c9f\u901a\u968f\u65f6\u968f\u5730\u7684\u8fdb\u884c\u3002","title":"1\u3001\u529f\u80fd\u4ecb\u7ecd"},{"location":"tantan/day01/#11","text":"\u529f\u80fd \u8bf4\u660e \u5907\u6ce8 \u6ce8\u518c\u3001\u767b\u5f55 \u7528\u6237\u65e0\u9700\u5355\u72ec\u6ce8\u518c\uff0c\u76f4\u63a5\u901a\u8fc7\u624b\u673a\u53f7\u767b\u5f55\u5373\u53ef \u9996\u6b21\u767b\u5f55\u6210\u529f\u540e\u9700\u8981\u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f \u4ea4\u53cb \u4e3b\u8981\u529f\u80fd\u6709\uff1a\u6d4b\u7075\u9b42\u3001\u6843\u82b1\u4f20\u97f3\u3001\u641c\u9644\u8fd1\u3001\u63a2\u82b1\u7b49 \u5708\u5b50 \u7c7b\u4f3c\u5fae\u4fe1\u670b\u53cb\u5708\uff0c\u7528\u6237\u53ef\u4ee5\u53d1\u52a8\u6001\u3001\u67e5\u770b\u597d\u53cb\u52a8\u6001\u7b49 \u6d88\u606f \u901a\u77e5\u7c7b\u6d88\u606f + \u5373\u65f6\u901a\u8baf\u6d88\u606f \u5c0f\u89c6\u9891 \u7c7b\u4f3c\u6296\u97f3\uff0c\u7528\u6237\u53ef\u4ee5\u53d1\u5c0f\u89c6\u9891\uff0c\u8bc4\u8bba\u7b49 \u663e\u793a\u5c0f\u89c6\u9891\u5217\u8868\u9700\u8981\u8fdb\u884c\u63a8\u8350\u7b97\u6cd5\u8ba1\u7b97\u540e\u8fdb\u884c\u5c55\u73b0\u3002 \u6211\u7684 \u6211\u7684\u52a8\u6001\u3001\u5173\u6ce8\u6570\u3001\u7c89\u4e1d\u6570\u3001\u901a\u7528\u8bbe\u7f6e\u7b49","title":"1.1\u3001\u529f\u80fd\u5217\u8868"},{"location":"tantan/day01/#12","text":"\u4e1a\u52a1\u8bf4\u660e\uff1a \u7528\u6237\u901a\u8fc7\u624b\u673a\u9a8c\u8bc1\u7801\u8fdb\u884c\u767b\u5f55\uff0c\u5982\u679c\u662f\u7b2c\u4e00\u6b21\u767b\u5f55\u5219\u9700\u8981\u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f\uff0c\u5728\u4e0a\u4f20\u56fe\u7247\u65f6\uff0c\u9700\u8981\u5bf9\u4e0a\u4f20\u7684\u56fe\u7247\u505a\u4eba\u50cf\u7684\u6821\u9a8c\uff0c\u9632\u6b62\u7528\u6237\u4e0a\u4f20\u975e\u4eba\u50cf\u7684\u56fe\u7247\u4f5c\u4e3a\u5934\u50cf\u3002\u6d41\u7a0b\u5b8c\u6210\u540e\uff0c\u5219\u767b\u5f55\u6210\u529f\u3002","title":"1.2\u3001\u6ce8\u518c\u767b\u5f55"},{"location":"tantan/day01/#13","text":"\u4ea4\u53cb\u662f\u63a2\u82b1\u9879\u76ee\u7684\u6838\u5fc3\u529f\u80fd\u4e4b\u4e00\uff0c\u7528\u6237\u53ef\u4ee5\u67e5\u770b\u597d\u53cb\uff0c\u6dfb\u52a0\u597d\u53cb\uff0c\u641c\u7d22\u597d\u53cb\u7b49\u64cd\u4f5c\u3002","title":"1.3\u3001\u4ea4\u53cb"},{"location":"tantan/day01/#131","text":"\u5728\u9996\u9875\u4e2d\uff0c\u4e3b\u8981\u529f\u80fd\u6709\u201c\u4eca\u65e5\u4f73\u4eba\u201d\u3001\u201c\u63a8\u8350\u201d\u3001\u201c\u6700\u8fd1\u8bbf\u5ba2\u201d\u7b49 \u4eca\u65e5\u4f73\u4eba \u6309\u7167\u201c\u7f18\u5206\u503c\u201d\u8fdb\u884c\u5339\u914d\uff0c\u5c06\u201c\u7f18\u5206\u503c\u201d\u6700\u9ad8\u7684\u7528\u6237\u5c55\u73b0\u51fa\u6765 \u63a8\u8350 \u6309\u7167\u201c\u7f18\u5206\u503c\u201d\u8fdb\u884c\u63a8\u8350\uff0c\u7531\u540e\u53f0\u7684\u63a8\u8350\u7cfb\u7edf\u8ba1\u7b97\u5f97\u51fa\uff0c\u5c55\u73b0\u51fa\u6765 \u6700\u8fd1\u8bbf\u5ba2 \u663e\u793a\u6700\u8fd1\u6765\u770b\u201c\u6211\u201d\u7684\u7528\u6237","title":"1.3.1\u3001\u9996\u9875"},{"location":"tantan/day01/#132","text":"\u8bf4\u660e\uff1a\u5de6\u5212\u559c\u6b22\uff0c\u53f3\u5212\u4e0d\u559c\u6b22\uff0c\u6bcf\u5929\u9650\u91cf\u4e0d\u8d85\u8fc7100\u4e2a\uff0c\u5f00\u901a\u4f1a\u5458\u53ef\u589e\u52a0\u9650\u989d\u3002\u53cc\u65b9\u4e92\u76f8\u559c\u6b22\u5219\u914d\u5bf9\u6210\u529f\u3002 \u5b9e\u73b0\uff1a\u6570\u636e\u6765\u6e90\u63a8\u8350\u7cfb\u7edf\u8ba1\u7b97\u540e\u7684\u7ed3\u679c\u3002","title":"1.3.2\u3001\u63a2\u82b1"},{"location":"tantan/day01/#133","text":"\u6839\u636e\u7528\u6237\u5f53\u524d\u6240\u5728\u7684\u4f4d\u7f6e\u8fdb\u884c\u67e5\u8be2\uff0c\u5e76\u4e14\u572810km\u7684\u8303\u56f4\u5185\u8fdb\u884c\u67e5\u8be2\uff0c\u53ef\u4ee5\u901a\u8fc7\u7b5b\u9009\u6309\u94ae\u8fdb\u884c\u6761\u4ef6\u7b5b\u9009\u3002","title":"1.3.3\u3001\u641c\u9644\u8fd1"},{"location":"tantan/day01/#134","text":"\u529f\u80fd\u7c7b\u4f3cQQ\u4e2d\u7684\u6f02\u6d41\u74f6\uff0c\u7528\u6237\u53ef\u4ee5\u53d1\u9001\u548c\u63a5\u6536\u8bed\u97f3\u6d88\u606f\uff0c\u964c\u751f\u4eba\u5c31\u4f1a\u63a5\u6536\u5230\u6d88\u606f\u3002","title":"1.3.4\u3001\u6843\u82b1\u4f20\u97f3"},{"location":"tantan/day01/#135","text":"\u6d4b\u8bd5\u9898\u7528\u4e8e\u5bf9\u7528\u6237\u8fdb\u884c\u5206\u7c7b\uff0c\u6bcf\u6b21\u63d0\u4ea4\u7b54\u6848\u540e\u66f4\u65b0\u7528\u6237\u5c5e\u6027 \u6d4b\u8bd5\u9898\u5728\u540e\u53f0\u8fdb\u884c\u7ef4\u62a4 \u6d4b\u8bd5\u9898\u6d4b\u8bd5\u5b8c\u540e\u4ea7\u751f\u7ed3\u679c\u9875\u53ef\u4ee5\u8fdb\u884c\u5206\u4eab \u6d4b\u8bd5\u9898\u4e3a\u987a\u5e8f\u56de\u7b54\uff0c\u56de\u7b54\u5b8c\u521d\u7ea7\u9898\u89e3\u9501\u4e0b\u4e00\u7ea7\u95ee\u9898 \u70b9\u51fb\u9501\u5b9a\u95ee\u9898 \u663e\u793a\u63d0\u793a \u8bf7\u5148\u56de\u7b54\u4e0a\u4e00\u7ea7\u95ee\u9898","title":"1.3.5\u3001\u6d4b\u7075\u9b42"},{"location":"tantan/day01/#14","text":"1\u3001\u63a8\u8350\u9891\u9053\u4e3a\u6839\u636e\u95ee\u5377\u53ca\u559c\u597d\u63a8\u8350\u76f8\u4f3c\u7528\u6237\u52a8\u6001 2\u3001\u663e\u793a\u5185\u5bb9\u4e3a\u7528\u6237\u5934\u50cf\u3001\u7528\u6237\u6635\u79f0\u3001\u7528\u6237\u6027\u522b\u3001\u7528\u6237\u5e74\u9f84\u3001\u7528\u6237\u6807\u7b7e\u548c\u7528\u6237\u53d1\u5e03\u52a8\u6001 3\u3001\u56fe\u7247\u6700\u591a\u4e0d\u8d85\u8fc76\u5f20\u6216\u53d1\u5e03\u4e00\u4e2a\u5c0f\u89c6\u9891 4\u3001\u52a8\u6001\u4e0b\u65b9\u663e\u793a\u53d1\u5e03\u65f6\u95f4\u8ddd\u79bb\u5f53\u65f6\u65f6\u95f4\uff0c\u4f8b\u598210\u5206\u949f\u524d\u30013\u5c0f\u65f6\u524d\u30012\u5929\u524d\uff0c\u663e\u793a\u65f6\u95f4\u8fdb\u884c\u53d6\u6574 5\u3001\u52a8\u6001\u4e0b\u65b9\u663e\u793a\u8ddd\u79bb\u4e3a\u53d1\u5e03\u52a8\u6001\u5730\u4e0e\u672c\u5730\u8ddd\u79bb 6\u3001\u663e\u793a\u7528\u6237\u6d4f\u89c8\u91cf 7\u3001\u663e\u793a\u70b9\u8d5e\u6570\u3001\u8bc4\u8bba\u6570 \u8f6c\u53d1\u6570","title":"1.4\u3001\u5708\u5b50"},{"location":"tantan/day01/#15","text":"\u6d88\u606f\u5305\u542b\u901a\u77e5\u7c7b\u7684\u6d88\u606f\u548c\u597d\u53cb\u6d88\u606f\u3002","title":"1.5\u3001\u6d88\u606f"},{"location":"tantan/day01/#16","text":"\u7528\u6237\u53ef\u4ee5\u4e0a\u4f20\u5c0f\u89c6\u9891\uff0c\u4e5f\u53ef\u4ee5\u67e5\u770b\u5c0f\u89c6\u9891\u5217\u8868\uff0c\u5e76\u4e14\u53ef\u4ee5\u8fdb\u884c\u70b9\u8d5e\u64cd\u4f5c\u3002","title":"1.6\u3001\u5c0f\u89c6\u9891"},{"location":"tantan/day01/#17","text":"\u663e\u793a\u5173\u6ce8\u6570\u3001\u559c\u6b22\u6570\u3001\u7c89\u4e1d\u6570\u3001\u6211\u7684\u52a8\u6001\u7b49\u4fe1\u606f\u3002","title":"1.7\u3001\u6211\u7684"},{"location":"tantan/day01/#2","text":"","title":"2\u3001\u9879\u76ee\u4ecb\u7ecd"},{"location":"tantan/day01/#21","text":"\u5728\u7ebf\u793e\u4ea4\u662f\u4e92\u8054\u7f51\u65f6\u4ee3\u7684\u4ea7\u7269\uff0c\u5df2\u6210\u4e3a\u4e92\u8054\u7f51\u7528\u6237\u7684\u57fa\u7840\u9700\u6c42\u4e4b\u4e00\u3002\u79fb\u52a8\u4e92\u8054\u7f51\u81ea2003\u5e74\u8d77\u5feb\u901f\u53d1\u5c55\uff0c\u4fc3\u4f7f\u5728\u7ebf\u793e\u4ea4\u9010\u6e10\u4ecePC\u7aef\u8f6c\u79fb\u81f3\u79fb\u52a8\u7aef\u3002\u79fb\u52a8\u793e\u4ea4\u6700\u521d\u4ee5\u719f\u4eba\u793e\u4ea4\u4e3a\u4e3b\uff0c\u4ee5\u7ef4\u7cfb\u719f\u4eba\u5173\u7cfb\u3001\u5171\u4eab\u8d44\u6e90\u4fe1\u606f\u7684\u5f62\u5f0f\u5b58\u5728\u3002\u968f\u7740\u4eba\u4eec\u4ea4\u53cb\u9700\u6c42\u7684\u5ef6\u4f38\uff0c\u79fb\u52a8\u793e\u4ea4\u5f00\u59cb\u5411\u964c\u751f\u4eba\u793e\u4ea4\u3001\u5174\u8da3\u793e\u4ea4\u7b49\u5782\u76f4\u65b9\u5411\u53d1\u5c55\uff0c\u5f62\u5f0f\u4e30\u5bcc\u591a\u6837\u3002","title":"2.1\u3001\u9879\u76ee\u80cc\u666f"},{"location":"tantan/day01/#22","text":"\u63a2\u82b1\u4ea4\u53cb\u9879\u76ee\u5b9a\u4f4d\u4e8e \u964c\u751f\u4eba\u4ea4\u53cb\u5e02\u573a \u3002 \u6839\u636e\u300a2018\u793e\u4ea4\u9886\u57df\u6295\u878d\u8d44\u62a5\u544a\u300b\u4e2d\u6307\u51fa\uff1a\u867d\u7136\u76f8\u6bd42017\u5e74\uff0c\u6295\u878d\u8d44\u4e8b\u4ef6\u51cf\u5c1129.5%\uff0c\u4f46\u662f\u878d\u8d44\u7684\u603b\u989d\u5374\u5927\u5e45\u589e\u957f\uff0c\u8fbe\u523068%\u3002 \u8fd9\u4e9b\u8ff9\u8c61\u8bf4\u660e\uff1a\u793e\u4ea4\u9886\u57df\u7684\u53d1\u5c55\u89c4\u6a21\u6b63\u5728\u6269\u5927\uff0c\u800c\u5f88\u591a\u6ca1\u6709\u7279\u8272\u7684\u4ea7\u54c1\u4e5f\u4f1a\u88ab\u6dd8\u6c70\u3002\u800c\u968f\u7740\u90a3\u4e9b\u5c3e\u90e8\u4ea7\u54c1\u7684\u5012\u4e0b\uff0c\u5bf9\u6211\u4eec\u6765\u8bf4\u5c31\u662f\u673a\u4f1a\uff0c\u53ca\u65f6\u6293\u4f4f\u4e0d\u540c\u793e\u4ea4\u9700\u6c42\u7684\u673a\u4f1a\u3002\u4ee5\u793e\u4ea4\u4e3a\u6838\u5fc3\u5411\u4e0d\u540c\u7684\u7ec6\u5206\u9886\u57df\u884d\u751f\u6b63\u5728\u9010\u6e10\u8d70\u5411\u6210\u719f\u5316\u3002 \u800c\u6211\u4eec\u6309\u7167\u5a31\u4e50\u5f62\u5f0f\u548c\u5185\u5bb9\u4e3a\u4e3b\u4e24\u4e2a\u7ef4\u5ea6\uff0c\u5c06\u793e\u4ea4\u884c\u4e1a\u516c\u53f8\u5206\u7c7b\u4e3a\uff1a\u5373\u65f6\u901a\u4fe1\u3001\u5185\u5bb9\u793e\u7fa4\u3001\u964c\u751f\u4eba\u793e\u4ea4\u3001\u6cdb\u5a31\u4e50\u793e\u4ea4\u4ee5\u53ca\u5174\u8da3\u793e\u4ea4\u51e0\u4e2a\u9886\u57df\u3002 \u800c\u57282018\u5e74\u793e\u4ea4\u7684\u5404\u4e2a\u7ec6\u5206\u9886\u57df\u4e0b\uff0c\u5747\u6709\u5907\u53d7\u8d44\u672c\u6240\u5173\u6ce8\u7684\u9879\u76ee\uff0c\u6839\u636e\u70ef\u725b\u6570\u636e2018\u5e74\u7684\u62a5\u544a\u4e2d\uff0c\u4e5f\u540c\u6837\u6307\u51fa\uff1a\u5185\u5bb9\u793e\u4ea4\u53ca\u964c\u751f\u4eba\u793e\u4ea4\u4e3a\u8d44\u672c\u91cd\u8981\u5173\u6ce8\u9886\u57df\uff0c\u5408\u8ba1\u878d\u8d44\u5360\u6bd4\u8fbe73%\u3002 \u6839\u636e\u5e02\u573a\u73b0\u72b6\u4ee5\u53ca\u878d\u8d44\u4e8b\u4ef6\u6765\u770b\uff1a\u964c\u751f\u4eba\u793e\u4ea4\u3001\u5185\u5bb9\u793e\u7fa4\u3001\u5174\u8da3\u793e\u4ea4\u57282019\u5e74\u4ecd\u7136\u4fdd\u6301\u5f3a\u52b2\u7684\u52a8\u529b\uff0c\u5360\u5230\u8fd170%\u7684\u6bd4\u4f8b\uff0c\u5b83\u4eec\u4ecd\u7136\u662f\u8d44\u672c\u5e02\u573a\u4e3b\u8981\u5173\u6ce8\u9886\u57df\u3002\u4ece\u589e\u957f\u7387\u6765\u770b\u964c\u751f\u4eba\u793e\u4ea4\u7684\u589e\u957f\u901f\u5ea6\u8fdc\u8fdc\u5927\u4e8e\u5176\u4ed6\u51e0\u7c7b\uff0c\u56e0\u6b64\u6211\u4eec\u8981\u4ece\u8fd9\u4e2a\u65b9\u5411\u5165\u624b\u3002","title":"2.2\u3001\u5e02\u573a\u5206\u6790"},{"location":"tantan/day01/#23","text":"\u4ece\u6574\u4f53\u5e74\u9f84\u6bb5\u6765\u770b\uff1a\u76ee\u524d\u76ee\u6807\u7528\u6237\u7fa4\u4f53\u4e3b\u8981\u4ee530\u5c81\u4ee5\u4e0b\u4e3a\u4e3b\uff0c\u5176\u4e2d\u4ee518-25\u5c81\u5e74\u9f84\u7fa4\u4f53\u4e3a\u4e3b\u8981\u53d7\u4f17\u4eba\u7fa4\u3002 \u4e0a\u73ed\u7fa4\u4f53\uff1a \u70ed\u8877\u4e8e\u901a\u8fc7\u5206\u4eab\u5185\u5bb9\u6216\u8868\u8fbe\u201c\u4e2a\u4eba\u60c5\u7eea\u201d\u5728\u964c\u751f\u4eba\u9762\u524d\u5efa\u7acb\u7279\u6b8a\u7684\u4eba\u8bbe\uff0c\u5e76\u501f\u6b64\u63d0\u5347\u81ea\u6211\u4ef7\u503c\u6269\u5927\u81ea\u5df1\u7684\u4ea4\u9645\u5708\uff1b \u5b66\u751f\u7fa4\u4f53\uff1a \u8ffd\u6c42\u4e2a\u6027\u9009\u62e9\uff0c\u66f4\u503e\u5411\u627e\u5230\u6709\u5171\u540c\u8bdd\u9898\u7684\u964c\u751f\u4eba\u5bf9\u8c61\u5e76\u5efa\u7acb\u957f\u671f\u7684\u5173\u7cfb\uff0c\u4e50\u4e8e\u5c55\u73b0\u81ea\u6211\uff1b \u6587\u827a\u7fa4\u4f53\uff1a \u62e5\u6709\u81ea\u5df1\u72ec\u7279\u7684\u7231\u597d\u4e14\u62e5\u6709\u7279\u522b\u7684\u4e2a\u4eba\u8ffd\u6c42\uff0c\u8ffd\u6c42\u6587\u827a\u5708\u5b50\u5185\u7684\u4ea4\u6d41\uff0c\u5e0c\u671b\u901a\u8fc7\u5206\u4eab\u7ed3\u4ea4\u66f4\u591a\u597d\u53cb\uff1b \u6c9f\u901a\u5f31\u52bf\u7fa4\u4f53\uff1a \u5bf9\u73b0\u6709\u957f\u671f\u4fdd\u6301\u7ebf\u4e0a\u5bf9\u793e\u4ea4\u6a21\u5f0f\u8868\u73b0\u65e0\u529b\u4e14\u65e0\u6548\uff0c\u6e34\u671b\u6709\u66f4\u52a0\u6709\u6548\u4e14\u5b89\u5168\u7684\u793e\u4ea4\u65b9\u5f0f\u51fa\u73b0\uff0c\u89e3\u51b3\u76ee\u524d\u5355\u8c03\u4e4f\u5473\u7684\u6c9f\u901a\u65b9\u5f0f\uff1b","title":"2.3\u3001\u76ee\u6807\u7528\u6237\u7fa4\u4f53"},{"location":"tantan/day01/#24","text":"\u524d\u7aef\uff1a flutter + android + \u73af\u4fe1SDK + redux + shared_preferences + connectivity + iconfont + webview + sqflite \u540e\u7aef\uff1a Spring Boot + SpringMVC + Mybatis + MybatisPlus + Dubbo Elasticsearch geo \u5b9e\u73b0\u5730\u7406\u4f4d\u7f6e\u67e5\u8be2 MongoDB \u5b9e\u73b0\u6d77\u91cf\u6570\u636e\u7684\u5b58\u50a8 Redis \u6570\u636e\u7684\u7f13\u5b58 Spark + MLlib \u5b9e\u73b0\u667a\u80fd\u63a8\u8350 \u7b2c\u4e09\u65b9\u670d\u52a1 \u73af\u4fe1\u5373\u65f6\u901a\u8baf \u7b2c\u4e09\u65b9\u670d\u52a1 \u963f\u91cc\u4e91 OSS \u3001 \u77ed\u4fe1\u670d\u52a1 \u7b2c\u4e09\u65b9\u670d\u52a1 \u8679\u8f6f\u5f00\u653e\u5e73\u53f0","title":"2.4\u3001\u6280\u672f\u65b9\u6848"},{"location":"tantan/day01/#25","text":"","title":"2.5\u3001\u6280\u672f\u67b6\u6784"},{"location":"tantan/day01/#26","text":"\u4f7f\u7528Elasticsearch geo\u5b9e\u73b0\u9644\u8fd1\u7684\u4eba\u7684\u89e3\u51b3\u65b9\u6848 \u4f7f\u7528Spark + Mllib\u5b9e\u73b0\u667a\u80fd\u63a8\u8350\u7684\u89e3\u51b3\u65b9\u6848 \u4f7f\u7528MongoDB\u8fdb\u884c\u6d77\u91cf\u6570\u636e\u7684\u5b58\u50a8\u7684\u89e3\u51b3\u65b9\u6848 \u4f7f\u7528\u91c7\u7528\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u5b58\u50a8\u5c0f\u89c6\u9891\u6570\u636e\u7684\u89e3\u51b3\u65b9\u6848 \u4f7f\u7528\u8679\u8f6f\u5f00\u653e\u5e73\u53f0\u8fdb\u884c\u4eba\u8138\u8bc6\u522b\u7684\u89e3\u51b3\u65b9\u6848","title":"2.6\u3001\u6280\u672f\u89e3\u51b3\u65b9\u6848"},{"location":"tantan/day01/#27","text":"\u91c7\u7528Elasticsearch geo\u5b9e\u73b0\u5730\u7406\u4f4d\u7f6e\u67e5\u8be2 \u91c7\u7528RocketMQ\u4f5c\u4e3a\u6d88\u606f\u670d\u52a1\u4e2d\u95f4\u4ef6 \u91c7\u7528MongoDB\u8fdb\u884c\u6d77\u91cf\u6570\u636e\u7684\u5b58\u50a8 \u91c7\u7528Spark + Mllib\u5b9e\u73b0\u667a\u80fd\u63a8\u8350 \u91c7\u7528\u73af\u4fe1\u670d\u52a1\u5b9e\u73b0\u5373\u65f6\u901a\u8baf \u91c7\u7528\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u5b58\u50a8\u5c0f\u89c6\u9891\u6570\u636e \u91c7\u7528Apache Dobbo\u4f5c\u4e3a\u5fae\u670d\u52a1\u67b6\u6784\u6280\u672f \u91c7\u7528SpringBoot + Mybatis\u5b9e\u73b0\u7cfb\u7edf\u4e3b\u67b6\u6784 \u91c7\u7528Redis\u96c6\u7fa4\u5b9e\u73b0\u7f13\u5b58\u7684\u9ad8\u53ef\u7528","title":"2.7\u3001\u6280\u672f\u4eae\u70b9"},{"location":"tantan/day01/#28","text":"\u63a2\u82b1\u4ea4\u53cb\u9879\u76ee\u91c7\u7528\u524d\u540e\u7aef\u5206\u79bb\u7684\u65b9\u5f0f\u5f00\u53d1\uff0c\u5c31\u662f\u524d\u7aef\u7531\u524d\u7aef\u56e2\u961f\u8d1f\u8d23\u5f00\u53d1\uff0c\u540e\u7aef\u8d1f\u8d23\u63a5\u53e3\u7684\u5f00\u53d1\uff0c\u8fd9\u79cd\u5f00\u53d1\u65b9\u5f0f\u67092\u70b9\u597d\u5904\uff1a \u626c\u957f\u907f\u77ed\uff0c\u6bcf\u4e2a\u56e2\u961f\u505a\u81ea\u5df1\u64c5\u957f\u7684\u4e8b\u60c5 \u524d\u540e\u7aef\u5e76\u884c\u5f00\u53d1\uff0c\u9700\u8981\u4e8b\u5148\u7ea6\u5b9a\u597d\u63a5\u53e3\u5730\u5740\u4ee5\u53ca\u5404\u79cd\u53c2\u6570\u3001\u54cd\u5e94\u6570\u636e\u7ed3\u6784\u7b49 \u5bf9\u4e8e\u63a5\u53e3\u7684\u5b9a\u4e49\u6211\u4eec\u91c7\u7528YApi\u8fdb\u884c\u7ba1\u7406\uff0cYApi\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u63a5\u53e3\u5b9a\u4e49\u3001\u7ba1\u7406\u3001\u63d0\u4f9bmock\u6570\u636e\u7684\u7ba1\u7406\u5e73\u53f0\u3002 \u5730\u5740\uff1ahttps://mock-java.itheima.net/ \u7528\u6237\u540d\uff1atanhua@itcast.cn \u5bc6\u7801\uff1a123456 \u63a5\u53e3\u5b9a\u4e49\uff1a mock\u6570\u636e\uff0cYApi\u63d0\u4f9b\u4e86mock\u529f\u80fd\uff0c\u5c31\u662f\u6a21\u62df\u670d\u52a1\u7aef\u8fd4\u56de\u6d4b\u8bd5\u6570\u636e\uff1a \u8fd8\u53ef\u4ee5\u8fd0\u884chttp\u8bf7\u6c42\uff08\u9700\u8981\u5728Chrome\u4e2d\u5b89\u88c5\u652f\u6301\u8de8\u57df\u6269\u5c55 https://juejin.im/post/6844904057707085832\uff09\uff1a","title":"2.8\u3001\u5f00\u53d1\u65b9\u5f0f"},{"location":"tantan/day01/#29","text":"\u63a2\u82b1\u4ea4\u53cb\u9879\u76ee\u7684\u5f00\u53d1\u7edf\u4e00\u4f7f\u7528\u63d0\u4f9b\u7684Centos7\u73af\u5883\uff0c\u8be5\u73af\u5883\u4e2d\u90e8\u7f72\u5b89\u88c5\u4e86\u9879\u76ee\u6240\u9700\u8981\u7684\u5404\u79cd\u670d\u52a1\uff0c\u5982\uff1aMySQL\u3001MongoDB\u3001Redis\u3001RocketMQ\u7b49\u3002 \u865a\u62df\u673a\u7684root\u7528\u6237\u5bc6\u7801\u4e3a\uff1aroot123 \u9ed8\u8ba4\u53c2\u6570\uff1aCPU\uff1a2\u6838\uff0c\u5185\u5b58\uff1a4G\uff0c\u786c\u76d8\uff1a60G IP\u5730\u5740\u5efa\u8bae\u8bbe\u7f6e\u4e3a192.168.31.81\uff0c\u5426\u5219\u6709\u4e9b\u670d\u52a1\u5c06\u4e0d\u53ef\u7528\uff0c\u6bd4\u5982\uff1aRedis\u3001RocketMQ\u7b49\u3002","title":"2.9\u3001\u57fa\u7840\u73af\u5883"},{"location":"tantan/day01/#3","text":"\u4e1a\u52a1\u8bf4\u660e\uff1a \u7528\u6237\u901a\u8fc7\u624b\u673a\u9a8c\u8bc1\u7801\u8fdb\u884c\u767b\u5f55\uff0c\u5982\u679c\u662f\u7b2c\u4e00\u6b21\u767b\u5f55\u5219\u9700\u8981\u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f\uff0c\u5728\u4e0a\u4f20\u56fe\u7247\u65f6\uff0c\u9700\u8981\u5bf9\u4e0a\u4f20\u7684\u56fe\u7247\u505a\u4eba\u50cf\u7684\u6821\u9a8c\uff0c\u9632\u6b62\u7528\u6237\u4e0a\u4f20\u975e\u4eba\u50cf\u7684\u56fe\u7247\u4f5c\u4e3a\u5934\u50cf\u3002\u6d41\u7a0b\u5b8c\u6210\u540e\uff0c\u5219\u767b\u5f55\u6210\u529f\u3002 \u6d41\u7a0b\uff1a","title":"3\u3001\u6ce8\u518c\u767b\u5f55"},{"location":"tantan/day01/#31","text":"\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u5355\u70b9\u767b\u5f55\u7cfb\u7edf\uff1f \u4ee5\u524d\u5b9e\u73b0\u7684\u767b\u5f55\u548c\u6ce8\u518c\u662f\u5728\u540c\u4e00\u4e2atomcat\u5185\u90e8\u5b8c\u6210\uff0c\u6211\u4eec\u73b0\u5728\u7684\u7cfb\u7edf\u67b6\u6784\u662f\u6bcf\u4e00\u4e2a\u7cfb\u7edf\u90fd\u662f\u7531\u4e00\u4e2a\u56e2\u961f\u8fdb\u884c\u7ef4\u62a4\uff0c\u6bcf\u4e2a\u7cfb\u7edf\u90fd\u662f\u5355\u72ec\u90e8\u7f72\u8fd0\u884c\u4e00\u4e2a\u5355\u72ec\u7684tomcat\uff0c\u6240\u4ee5\uff0c\u4e0d\u80fd\u5c06\u7528\u6237\u7684\u767b\u5f55\u4fe1\u606f\u4fdd\u5b58\u5230session\u4e2d\uff08\u591a\u4e2atomcat\u7684session\u662f\u4e0d\u80fd\u5171\u4eab\u7684\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u5355\u72ec\u7684\u7cfb\u7edf\u6765\u7ef4\u62a4\u7528\u6237\u7684\u767b\u5f55\u4fe1\u606f\u3002 \u7531\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff1a \u5ba2\u6237\u7aef\u9700\u8981\u901a\u8fc7SSO\u7cfb\u7edf\u624d\u80fd\u83b7\u53d6\u5230token\uff1b \u5ba2\u6237\u7aef\u5728\u8bf7\u6c42\u670d\u52a1\u7cfb\u7edf\u65f6\uff0c\u670d\u52a1\u7cfb\u7edf\u9700\u8981\u901a\u8fc7SSO\u7cfb\u7edf\u8fdb\u884c\u5bf9token\u8fdb\u884c\u6821\u9a8c\uff1b SSO\u7cfb\u7edf\u5728\u6574\u4e2a\u7cfb\u7edf\u67b6\u6784\u4e2d\u5904\u4e8e\u6838\u5fc3\u4f4d\u7f6e\uff1b","title":"3.1\u3001\u5355\u70b9\u767b\u5f55\u7cfb\u7edf"},{"location":"tantan/day01/#32","text":"","title":"3.2\u3001\u642d\u5efa\u5de5\u7a0b"},{"location":"tantan/day01/#321my-tanhua","text":"itcast-tanhua\u662f\u7236\u5de5\u7a0b\uff0c\u96c6\u4e2d\u5b9a\u4e49\u4e86\u4f9d\u8d56\u7684\u7248\u672c\u4ee5\u53ca\u6240\u9700\u8981\u7684\u4f9d\u8d56\u4fe1\u606f\u3002 <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <modelVersion> 4.0.0 </modelVersion> <parent> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-parent </artifactId> <version> 2.1.0.RELEASE </version> </parent> <groupId> cn.itcast.tanhua </groupId> <artifactId> my-tanhua </artifactId> <version> 1.0-SNAPSHOT </version> <!-- \u96c6\u4e2d\u5b9a\u4e49\u4f9d\u8d56\u7248\u672c\u53f7 --> <properties> <mysql.version> 5.1.47 </mysql.version> <jackson.version> 2.9.9 </jackson.version> <druid.version> 1.0.9 </druid.version> <servlet-api.version> 2.5 </servlet-api.version> <jsp-api.version> 2.0 </jsp-api.version> <joda-time.version> 2.9.9 </joda-time.version> <commons-lang3.version> 3.7 </commons-lang3.version> <commons-io.version> 1.3.2 </commons-io.version> <mybatis.version> 3.2.8 </mybatis.version> <mybatis.mybatis-plus> 3.1.1 </mybatis.mybatis-plus> <lombok.version> 1.18.4 </lombok.version> </properties> <!--\u901a\u7528\u4f9d\u8d56--> <dependencies> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-test </artifactId> <scope> test </scope> </dependency> <dependency> <groupId> junit </groupId> <artifactId> junit </artifactId> <version> 4.12 </version> <scope> test </scope> </dependency> </dependencies> <dependencyManagement> <dependencies> <!-- mybatis-plus\u63d2\u4ef6\u4f9d\u8d56 --> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus </artifactId> <version> ${mybatis.mybatis-plus} </version> </dependency> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus-boot-starter </artifactId> <version> ${mybatis.mybatis-plus} </version> </dependency> <!-- MySql --> <dependency> <groupId> mysql </groupId> <artifactId> mysql-connector-java </artifactId> <version> ${mysql.version} </version> </dependency> <dependency> <groupId> org.mongodb </groupId> <artifactId> mongodb-driver-sync </artifactId> <version> 3.9.1 </version> </dependency> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> <optional> true </optional> <version> ${lombok.version} </version> </dependency> <dependency> <groupId> org.apache.commons </groupId> <artifactId> commons-lang3 </artifactId> <version> ${commons-lang3.version} </version> </dependency> <!--RocketMQ\u76f8\u5173--> <dependency> <groupId> org.apache.rocketmq </groupId> <artifactId> rocketmq-spring-boot-starter </artifactId> <version> 2.0.3 </version> </dependency> <dependency> <groupId> org.apache.rocketmq </groupId> <artifactId> rocketmq-client </artifactId> <version> 4.6.0 </version> </dependency> <!-- Jackson Json\u5904\u7406\u5de5\u5177\u5305 --> <dependency> <groupId> com.fasterxml.jackson.core </groupId> <artifactId> jackson-databind </artifactId> <version> ${jackson.version} </version> </dependency> <dependency> <groupId> com.alibaba </groupId> <artifactId> druid </artifactId> <version> ${druid.version} </version> </dependency> <dependency> <groupId> commons-codec </groupId> <artifactId> commons-codec </artifactId> <version> 1.11 </version> </dependency> <dependency> <groupId> joda-time </groupId> <artifactId> joda-time </artifactId> <version> ${joda-time.version} </version> </dependency> <dependency> <groupId> io.netty </groupId> <artifactId> netty-all </artifactId> <version> 4.1.32.Final </version> </dependency> <!--zk\u4f9d\u8d56--> <dependency> <groupId> org.apache.zookeeper </groupId> <artifactId> zookeeper </artifactId> <version> 3.4.13 </version> </dependency> <dependency> <groupId> com.github.sgroschupf </groupId> <artifactId> zkclient </artifactId> <version> 0.1 </version> </dependency> <!--dubbo\u7684springboot\u652f\u6301--> <dependency> <groupId> com.alibaba.boot </groupId> <artifactId> dubbo-spring-boot-starter </artifactId> <version> 0.2.0 </version> </dependency> <!--dubbo\u6846\u67b6--> <dependency> <groupId> com.alibaba </groupId> <artifactId> dubbo </artifactId> <version> 2.6.4 </version> </dependency> <dependency> <groupId> com.aliyun.oss </groupId> <artifactId> aliyun-sdk-oss </artifactId> <version> 2.8.3 </version> </dependency> <dependency> <groupId> com.aliyun </groupId> <artifactId> aliyun-java-sdk-core </artifactId> <version> 4.5.3 </version> </dependency> <dependency> <groupId> com.github.tobato </groupId> <artifactId> fastdfs-client </artifactId> <version> 1.26.7 </version> <exclusions> <exclusion> <groupId> ch.qos.logback </groupId> <artifactId> logback-classic </artifactId> </exclusion> </exclusions> </dependency> <dependency> <groupId> io.jsonwebtoken </groupId> <artifactId> jjwt </artifactId> <version> 0.9.1 </version> </dependency> </dependencies> </dependencyManagement> <build> <plugins> <!-- java\u7f16\u8bd1\u63d2\u4ef6 --> <plugin> <groupId> org.apache.maven.plugins </groupId> <artifactId> maven-compiler-plugin </artifactId> <version> 3.2 </version> <configuration> <source> 1.8 </source> <target> 1.8 </target> <encoding> UTF-8 </encoding> </configuration> </plugin> </plugins> </build> </project>","title":"3.2.1\u3001my-tanhua"},{"location":"tantan/day01/#322my-tanhua-sso","text":"<?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <parent> <artifactId> my-tanhua </artifactId> <groupId> cn.itcast.tanhua </groupId> <version> 1.0-SNAPSHOT </version> </parent> <modelVersion> 4.0.0 </modelVersion> <artifactId> my-tanhua-sso </artifactId> <dependencies> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-web </artifactId> </dependency> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus </artifactId> </dependency> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus-boot-starter </artifactId> </dependency> <dependency> <groupId> mysql </groupId> <artifactId> mysql-connector-java </artifactId> </dependency> <dependency> <groupId> com.alibaba </groupId> <artifactId> druid </artifactId> </dependency> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> </dependency> <dependency> <groupId> org.apache.commons </groupId> <artifactId> commons-lang3 </artifactId> </dependency> <dependency> <groupId> com.fasterxml.jackson.core </groupId> <artifactId> jackson-databind </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-redis </artifactId> </dependency> <dependency> <groupId> commons-codec </groupId> <artifactId> commons-codec </artifactId> </dependency> <!--RocketMQ\u76f8\u5173--> <dependency> <groupId> org.apache.rocketmq </groupId> <artifactId> rocketmq-spring-boot-starter </artifactId> </dependency> <dependency> <groupId> org.apache.rocketmq </groupId> <artifactId> rocketmq-client </artifactId> </dependency> <!--\u7b80\u5316\u4ee3\u7801\u7684\u5de5\u5177\u5305--> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> <optional> true </optional> </dependency> <dependency> <groupId> com.aliyun </groupId> <artifactId> aliyun-java-sdk-core </artifactId> </dependency> <dependency> <groupId> io.jsonwebtoken </groupId> <artifactId> jjwt </artifactId> </dependency> <dependency> <groupId> joda-time </groupId> <artifactId> joda-time </artifactId> </dependency> </dependencies> </project>","title":"3.2.2\u3001my-tanhua-sso"},{"location":"tantan/day01/#323","text":"\u63a2\u82b1\u4ea4\u53cb\u9879\u76ee\u7684\u524d\u7aef\u91c7\u7528Android APP\u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4f7f\u7528\u6a21\u62df\u5668\u6216\u771f\u673a\u8fdb\u884c\u6d4b\u8bd5\u3002 \u5bf9\u4e8e\u6a21\u62df\u5668\u8fd9\u91cc\u63a8\u8350\u4f7f\u7528\u7f51\u6613\u6a21\u62df\u5668\uff0c\u5176\u517c\u5bb9\u6027\u597d\u3001\u529f\u80fd\u5b8c\u5584\u800c\u4e14\u8fd8\u7b80\u6d01\uff0c\u7f3a\u70b9\u662f\u5b83\u4e0d\u652f\u6301\u865a\u62df\u673a\u4e2d\u5b89\u88c5\u3002 \u4e0b\u8f7d\uff1ahttps://mumu.163.com/","title":"3.2.3\u3001\u7f51\u6613\u6a21\u62df\u5668"},{"location":"tantan/day01/#33","text":"\u6570\u636e\u5e93\u4f7f\u7528\u7684mysql\uff1a CREATE TABLE ` tb_user ` ( ` id ` bigint ( 20 ) NOT NULL AUTO_INCREMENT , ` mobile ` varchar ( 11 ) DEFAULT NULL COMMENT '\u624b\u673a\u53f7' , ` password ` varchar ( 32 ) DEFAULT NULL COMMENT '\u5bc6\u7801\uff0c\u9700\u8981\u52a0\u5bc6' , ` created ` datetime DEFAULT NULL , ` updated ` datetime DEFAULT NULL , PRIMARY KEY ( ` id ` ), KEY ` mobile ` ( ` mobile ` ) USING BTREE ) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 COMMENT = '\u7528\u6237\u8868' ; CREATE TABLE ` tb_user_info ` ( ` id ` bigint ( 20 ) NOT NULL AUTO_INCREMENT , ` user_id ` bigint ( 20 ) NOT NULL COMMENT '\u7528\u6237id' , ` nick_name ` varchar ( 50 ) DEFAULT NULL COMMENT '\u6635\u79f0' , ` logo ` varchar ( 100 ) DEFAULT NULL COMMENT '\u7528\u6237\u5934\u50cf' , ` tags ` varchar ( 50 ) DEFAULT NULL COMMENT '\u7528\u6237\u6807\u7b7e\uff1a\u591a\u4e2a\u7528\u9017\u53f7\u5206\u9694' , ` sex ` int ( 1 ) DEFAULT '3' COMMENT '\u6027\u522b\uff0c1-\u7537\uff0c2-\u5973\uff0c3-\u672a\u77e5' , ` age ` int ( 11 ) DEFAULT NULL COMMENT '\u7528\u6237\u5e74\u9f84' , ` edu ` varchar ( 20 ) DEFAULT NULL COMMENT '\u5b66\u5386' , ` city ` varchar ( 20 ) DEFAULT NULL COMMENT '\u5c45\u4f4f\u57ce\u5e02' , ` birthday ` varchar ( 20 ) DEFAULT NULL COMMENT '\u751f\u65e5' , ` cover_pic ` varchar ( 50 ) DEFAULT NULL COMMENT '\u5c01\u9762\u56fe\u7247' , ` industry ` varchar ( 20 ) DEFAULT NULL COMMENT '\u884c\u4e1a' , ` income ` varchar ( 20 ) DEFAULT NULL COMMENT '\u6536\u5165' , ` marriage ` varchar ( 20 ) DEFAULT NULL COMMENT '\u5a5a\u59fb\u72b6\u6001' , ` created ` datetime DEFAULT NULL , ` updated ` datetime DEFAULT NULL , PRIMARY KEY ( ` id ` ), KEY ` user_id ` ( ` user_id ` ) ) ENGINE = InnoDB DEFAULT CHARSET = utf8 COMMENT = '\u7528\u6237\u4fe1\u606f\u8868' ;","title":"3.3\u3001\u6570\u636e\u5e93\u8868"},{"location":"tantan/day01/#34","text":"application.properties\uff1a spring.application.name = itcast-tanhua-sso server.port = 18080 spring.datasource.driver-class-name = com.mysql.jdbc.Driver spring.datasource.url = jdbc:mysql://192.168.31.81:3306/mytanhua?useUnicode=true&characterEncoding=utf8&autoReconnect=true&allowMultiQueries=true&useSSL=false spring.datasource.username = root spring.datasource.password = root # \u679a\u4e3e\u5305\u626b\u63cf mybatis-plus.type-enums-package = com.tanhua.sso.enums # \u8868\u540d\u524d\u7f00 mybatis-plus.global-config.db-config.table-prefix = tb_ # id\u7b56\u7565\u4e3a\u81ea\u589e\u957f mybatis-plus.global-config.db-config.id-type = auto # Redis\u76f8\u5173\u914d\u7f6e spring.redis.jedis.pool.max-wait = 5000ms spring.redis.jedis.pool.max-Idle = 100 spring.redis.jedis.pool.min-Idle = 10 spring.redis.timeout = 10s spring.redis.cluster.nodes = 192.168.31.81:6379,192.168.31.81:6380,192.168.31.81:6381 spring.redis.cluster.max-redirects = 5 # RocketMQ\u76f8\u5173\u914d\u7f6e rocketmq.name-server = 192.168.31.81:9876 rocketmq.producer.group = tanhua #itcast_tanhua #\u76d0 \u503c jwt.secret = 76bd425b6f29f7fcc2e0bfc286043df1 #\u8679\u8f6f\u76f8\u5173\u914d\u7f6e arcsoft.appid = ***** arcsoft.sdkKey = **** arcsoft.libPath = F:\\\\code\\\\WIN64","title":"3.4\u3001\u7f16\u5199\u914d\u7f6e"},{"location":"tantan/day01/#35","text":"","title":"3.5\u3001\u7f16\u5199\u57fa\u7840\u4ee3\u7801"},{"location":"tantan/day01/#351lombok","text":"lombok \u63d0\u4f9b\u4e86\u7b80\u5355\u7684\u6ce8\u89e3\u7684\u5f62\u5f0f\u6765\u5e2e\u52a9\u6211\u4eec\u7b80\u5316\u6d88\u9664\u4e00\u4e9b\u5fc5\u987b\u6709\u4f46\u663e\u5f97\u5f88\u81c3\u80bf\u7684 java \u4ee3\u7801\uff0c\u5c24\u5176\u662f\u9488\u5bf9pojo\u3002 \u5b98\u7f51\uff1ahttps://projectlombok.org/","title":"3.5.1\u3001Lombok"},{"location":"tantan/day01/#3511","text":"\u5bfc\u5165\u4f9d\u8d56\uff1a <!--\u7b80\u5316\u4ee3\u7801\u7684\u5de5\u5177\u5305--> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> <optional> true </optional> </dependency> \u5b89\u88c5IDEA\u63d2\u4ef6\uff1a \u5982\u679c\u4e0d\u5b89\u88c5\u63d2\u4ef6\uff0c\u7a0b\u5e8f\u53ef\u4ee5\u6b63\u5e38\u6267\u884c\uff0c\u4f46\u662f\u770b\u4e0d\u5230\u751f\u6210\u7684\u4e00\u4e9b\u4ee3\u7801\uff0c\u5982\uff1aget\u3001set\u65b9\u6cd5\u3002","title":"3.5.1.1\u3001\u914d\u7f6e\u5b89\u88c5"},{"location":"tantan/day01/#3512","text":"@Data\uff1a\u6ce8\u89e3\u5728\u7c7b\u4e0a\uff1b\u63d0\u4f9b\u7c7b\u6240\u6709\u5c5e\u6027\u7684 getting \u548c setting \u65b9\u6cd5\uff0c\u6b64\u5916\u8fd8\u63d0\u4f9b\u4e86equals\u3001canEqual\u3001hashCode\u3001toString \u65b9\u6cd5 @Setter\uff1a\u6ce8\u89e3\u5728\u5c5e\u6027\u4e0a\uff1b\u4e3a\u5c5e\u6027\u63d0\u4f9b setting \u65b9\u6cd5 @Getter\uff1a\u6ce8\u89e3\u5728\u5c5e\u6027\u4e0a\uff1b\u4e3a\u5c5e\u6027\u63d0\u4f9b getting \u65b9\u6cd5 @Slf4j\uff1a\u6ce8\u89e3\u5728\u7c7b\u4e0a\uff1b\u4e3a\u7c7b\u63d0\u4f9b\u4e00\u4e2a \u5c5e\u6027\u540d\u4e3alog \u7684 slf4j\u65e5\u5fd7\u5bf9\u8c61 @NoArgsConstructor\uff1a\u6ce8\u89e3\u5728\u7c7b\u4e0a\uff1b\u4e3a\u7c7b\u63d0\u4f9b\u4e00\u4e2a\u65e0\u53c2\u7684\u6784\u9020\u65b9\u6cd5 @AllArgsConstructor\uff1a\u6ce8\u89e3\u5728\u7c7b\u4e0a\uff1b\u4e3a\u7c7b\u63d0\u4f9b\u4e00\u4e2a\u5168\u53c2\u7684\u6784\u9020\u65b9\u6cd5 @Builder\uff1a\u4f7f\u7528Builder\u6a21\u5f0f\u6784\u5efa\u5bf9\u8c61 \u6d4b\u8bd5\u4e00\uff1a\u4f7f\u7528@Data\u6ce8\u89e3 \u662f\u4e0d\u662f\u5f88\u795e\u5947\uff1f\uff01 \u6d4b\u8bd5\u4e8c\uff1a\u4f7f\u7528@Slf4j\u6ce8\u89e3 \u6d4b\u8bd5\uff1a \u6d4b\u8bd5\u4e09\uff1a@AllArgsConstructor\u3001@NoArgsConstructor\u6ce8\u89e3\u7684\u4f7f\u7528 \u6d4b\u8bd5\u56db\uff1a@Builder \u6d4b\u8bd5\u7ed3\u679c\uff1a","title":"3.5.1.2\u3001\u5e38\u7528\u6ce8\u89e3"},{"location":"tantan/day01/#352sexenum","text":"\u7528\u6237\u7684\u6027\u522b\u7528\u679a\u4e3e\u8fdb\u884c\u8868\u793a\u3002 package com.tanhua.sso.enums ; import com.baomidou.mybatisplus.core.enums.IEnum ; public enum SexEnum implements IEnum < Integer > { MAN ( 1 , \"\u7537\" ), WOMAN ( 2 , \"\u5973\" ), UNKNOWN ( 3 , \"\u672a\u77e5\" ); private int value ; private String desc ; SexEnum ( int value , String desc ) { this . value = value ; this . desc = desc ; } @Override public Integer getValue () { return this . value ; } @Override public String toString () { return this . desc ; } }","title":"3.5.2\u3001SexEnum"},{"location":"tantan/day01/#353useruserinfo","text":"package com.tanhua.sso.pojo ; import com.baomidou.mybatisplus.annotation.FieldFill ; import com.baomidou.mybatisplus.annotation.TableField ; import lombok.Data ; import java.util.Date ; @Data public abstract class BasePojo { @TableField ( fill = FieldFill . INSERT ) //MP\u81ea\u52a8\u586b\u5145 private Date created ; @TableField ( fill = FieldFill . INSERT_UPDATE ) private Date updated ; } package com.tanhua.sso.pojo ; import com.fasterxml.jackson.annotation.JsonIgnore ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class User extends BasePojo { private Long id ; private String mobile ; //\u624b\u673a\u53f7 @JsonIgnore private String password ; //\u5bc6\u7801\uff0cjson\u5e8f\u5217\u5316\u65f6\u5ffd\u7565 } package com.tanhua.sso.pojo ; import com.tanhua.sso.enums.SexEnum ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class UserInfo extends BasePojo { private Long id ; private Long userId ; //\u7528\u6237id private String nickName ; //\u6635\u79f0 private String logo ; //\u7528\u6237\u5934\u50cf private String tags ; //\u7528\u6237\u6807\u7b7e\uff1a\u591a\u4e2a\u7528\u9017\u53f7\u5206\u9694 private SexEnum sex ; //\u6027\u522b private Integer age ; //\u5e74\u9f84 private String edu ; //\u5b66\u5386 private String city ; //\u57ce\u5e02 private String birthday ; //\u751f\u65e5 private String coverPic ; // \u5c01\u9762\u56fe\u7247 private String industry ; //\u884c\u4e1a private String income ; //\u6536\u5165 private String marriage ; //\u5a5a\u59fb\u72b6\u6001 }","title":"3.5.3\u3001User\u3001UserInfo"},{"location":"tantan/day01/#354mymetaobjecthandler","text":"\u5bf9\u81ea\u52a8\u586b\u5145\u5b57\u6bb5\u7684\u5904\u7406\uff1a package com.tanhua.sso.handler ; import com.baomidou.mybatisplus.core.handlers.MetaObjectHandler ; import org.apache.ibatis.reflection.MetaObject ; import org.springframework.stereotype.Component ; import java.util.Date ; @Component public class MyMetaObjectHandler implements MetaObjectHandler { @Override public void insertFill ( MetaObject metaObject ) { Object created = getFieldValByName ( \"created\" , metaObject ); if ( null == created ) { //\u5b57\u6bb5\u4e3a\u7a7a\uff0c\u53ef\u4ee5\u8fdb\u884c\u586b\u5145 setFieldValByName ( \"created\" , new Date (), metaObject ); } Object updated = getFieldValByName ( \"updated\" , metaObject ); if ( null == updated ) { //\u5b57\u6bb5\u4e3a\u7a7a\uff0c\u53ef\u4ee5\u8fdb\u884c\u586b\u5145 setFieldValByName ( \"updated\" , new Date (), metaObject ); } } @Override public void updateFill ( MetaObject metaObject ) { //\u66f4\u65b0\u6570\u636e\u65f6\uff0c\u76f4\u63a5\u66f4\u65b0\u5b57\u6bb5 setFieldValByName ( \"updated\" , new Date (), metaObject ); } }","title":"3.5.4\u3001MyMetaObjectHandler"},{"location":"tantan/day01/#355usermapper","text":"package com.tanhua.sso.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.sso.pojo.User ; public interface UserMapper extends BaseMapper < User > { } package com.tanhua.sso.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.sso.pojo.UserInfo ; public interface UserInfoMapper extends BaseMapper < UserInfo > { }","title":"3.5.5\u3001UserMapper"},{"location":"tantan/day01/#356myapplication","text":"SpringBoot\u7684\u542f\u52a8\u7c7b\u3002 package com.tanhua.sso ; import org.mybatis.spring.annotation.MapperScan ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; @MapperScan ( \"com.tanhua.sso.mapper\" ) //\u8bbe\u7f6emapper\u63a5\u53e3\u7684\u626b\u63cf\u5305 @SpringBootApplication public class MyApplication { public static void main ( String [] args ) { SpringApplication . run ( MyApplication . class , args ); } }","title":"3.5.6\u3001MyApplication"},{"location":"tantan/day01/#36","text":"\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u7684\u6d41\u7a0b\uff1a \u6d41\u7a0b\u8bf4\u660e\uff1a \u7528\u6237\u5411SSO\u7cfb\u7edf\u53d1\u9001\u8bf7\u6c42\uff0c\u5728\u8bf7\u6c42\u4e2d\u4f20\u9012\u624b\u673a\u53f7\uff1b SSO\u7cfb\u7edf\u63a5\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u751f\u6210\u968f\u673a\u9a8c\u8bc1\u7801\u4ee5\u53ca\u77ed\u4fe1\u5185\u5bb9\uff0c\u8bf7\u6c42\u963f\u91cc\u4e91\u77ed\u4fe1\u670d\u52a1\uff1b \u963f\u91cc\u4e91\u77ed\u4fe1\u670d\u52a1\u63a5\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u4f1a\u8fdb\u884c\u4e00\u7cfb\u5217\u7684\u9a8c\u8bc1\uff0c\u6bd4\u5982\u8d26\u53f7\u4f59\u989d\u3001\u77ed\u4fe1\u6a21\u677f\u662f\u5426\u6b63\u786e\u7b49\uff0c\u6700\u540e\u5411\u8fd0\u8425\u5546\u53d1\u8d77\u8bf7\u6c42\uff1b \u8fd0\u8425\u5546\u63a5\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u5411\u8be5\u624b\u673a\u53f7\u4e0b\u53d1\u77ed\u4fe1\uff0c\u7528\u6237\u5373\u53ef\u6536\u5230\u77ed\u4fe1\uff1b","title":"3.6\u3001\u77ed\u4fe1\u9a8c\u8bc1\u7801"},{"location":"tantan/day01/#361","text":"","title":"3.6.1\u3001\u963f\u91cc\u4e91\u77ed\u4fe1\u670d\u52a1"},{"location":"tantan/day01/#3611","text":"https://dysms.console.aliyun.com/dysms.htm?spm=5176.12818093.0.ddysms.2a4316d0ql6PyD \u8bf4\u660e\uff1a\u7533\u8bf7\u7b7e\u540d\u65f6\uff0c\u4e2a\u4eba\u7528\u6237\u53ea\u80fd\u7533\u8bf7\u4e00\u4e2a\u5e76\u4e14\u7b7e\u540d\u7684\u540d\u79f0\u5fc5\u987b\u4e3a\u201cABC\u5546\u57ce\u201d\uff0c\u5426\u5219\u5ba1\u6838\u4e0d\u901a\u8fc7\u3002 \u7533\u8bf7\u6a21\u677f\uff1a \u5ba1\u6838\u65f6\u95f4\u9700\u89811~2\u5c0f\u65f6\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85~","title":"3.6.1.1\u3001\u7533\u8bf7\u7b7e\u540d\u4e0e\u6a21\u677f"},{"location":"tantan/day01/#3612","text":"\u5728\u963f\u91cc\u4e91\u4e2d\uff0c\u9700\u8981\u5728RAM\u670d\u52a1\u4e2d\u521b\u5efa\u7528\u6237\u4ee5\u53ca\u6743\u9650\uff0c\u624d\u80fd\u901a\u8fc7api\u8fdb\u884c\u8bbf\u95ee\u63a5\u53e3\u3002 \u521b\u5efa\u7528\u6237\uff1a \u521b\u5efa\u5b8c\u6210\u540e\u8981\u4fdd\u5b58AccessKey Secret\u548cAccessKey ID\uff0cAccessKey Secret\u53ea\u663e\u793a\u8fd9\u4e00\u6b21\uff0c\u540e\u9762\u5c06\u4e0d\u518d\u663e\u793a\u3002 \u6dfb\u52a0\u6743\u9650\uff1a","title":"3.6.1.2\u3001\u8bbe\u7f6e\u7528\u6237\u6743\u9650"},{"location":"tantan/day01/#3613","text":"\u6587\u6863\uff1ahttps://help.aliyun.com/document_detail/101414.html?spm=a2c4g.11186623.6.625.18705ffa8u4lwj\uff1a package com.tanhua.sso.service ; import com.aliyuncs.CommonRequest ; import com.aliyuncs.CommonResponse ; import com.aliyuncs.DefaultAcsClient ; import com.aliyuncs.IAcsClient ; import com.aliyuncs.exceptions.ClientException ; import com.aliyuncs.exceptions.ServerException ; import com.aliyuncs.http.MethodType ; import com.aliyuncs.profile.DefaultProfile ; /* pom.xml <dependency> <groupId>com.aliyun</groupId> <artifactId>aliyun-java-sdk-core</artifactId> <version>4.5.3</version> </dependency> */ public class SendSms { public static void main ( String [] args ) { DefaultProfile profile = DefaultProfile . getProfile ( \"cn-hangzhou\" , \"LTAI4G7d2Q9CHc741gighjTF\" , \"uKOOGdIKvmoGhHlej8cJY8H3nlU6Fj\" ); IAcsClient client = new DefaultAcsClient ( profile ); CommonRequest request = new CommonRequest (); request . setSysMethod ( MethodType . POST ); request . setSysDomain ( \"dysmsapi.aliyuncs.com\" ); request . setSysVersion ( \"2017-05-25\" ); request . setSysAction ( \"SendSms\" ); request . putQueryParameter ( \"RegionId\" , \"cn-hangzhou\" ); request . putQueryParameter ( \"PhoneNumbers\" , \"158****7944\" ); //\u76ee\u6807\u624b\u673a\u53f7 request . putQueryParameter ( \"SignName\" , \"ABC\u5546\u57ce\" ); //\u7b7e\u540d\u540d\u79f0 request . putQueryParameter ( \"TemplateCode\" , \"SMS_204756062\" ); //\u77ed\u4fe1\u6a21\u677fcode request . putQueryParameter ( \"TemplateParam\" , \"{\\\"code\\\":\\\"123456\\\"}\" ); //\u6a21\u677f\u4e2d\u53d8\u91cf\u66ff\u6362 try { CommonResponse response = client . getCommonResponse ( request ); //{\"Message\":\"OK\",\"RequestId\":\"EC2D4C9A-0EAC-4213-BE45-CE6176E1DF23\",\"BizId\":\"110903802851113360^0\",\"Code\":\"OK\"} System . out . println ( response . getData ()); } catch ( ServerException e ) { e . printStackTrace (); } catch ( ClientException e ) { e . printStackTrace (); } } }","title":"3.6.1.3\u3001\u793a\u4f8b\u4ee3\u7801"},{"location":"tantan/day01/#3614","text":"\u914d\u7f6e\u6587\u4ef6\uff1aaliyun.properties aliyun.sms.regionId = cn-hangzhou aliyun.sms.accessKeyId = LTAI4G7d2Q9CHc741gighjTF aliyun.sms.accessKeySecret = uKOOGdIKvmoGhHlej8cJY8H3nlU6Fj aliyun.sms.domain = dysmsapi.aliyuncs.com aliyun.sms.signName = ABC\u5546\u57ce aliyun.sms.templateCode = SMS_204756062 \u9700\u8981\u6ce8\u610f\u4e2d\u6587\u7f16\u7801\u95ee\u9898\uff1a \u8bfb\u53d6\u914d\u7f6e\uff1a package com.tanhua.sso.config ; import lombok.Data ; import org.springframework.boot.context.properties.ConfigurationProperties ; import org.springframework.context.annotation.Configuration ; import org.springframework.context.annotation.PropertySource ; @Configuration @PropertySource ( \"classpath:aliyun.properties\" ) @ConfigurationProperties ( prefix = \"aliyun.sms\" ) @Data public class AliyunSMSConfig { private String regionId ; private String accessKeyId ; private String accessKeySecret ; private String domain ; private String signName ; private String templateCode ; } \u4ee3\u7801\u5b9e\u73b0\uff1a //SmsService.java /** * \u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801 * * @param mobile * @return */ public String sendSms ( String mobile ) { DefaultProfile profile = DefaultProfile . getProfile ( this . aliyunSMSConfig . getRegionId (), this . aliyunSMSConfig . getAccessKeyId (), this . aliyunSMSConfig . getAccessKeySecret ()); IAcsClient client = new DefaultAcsClient ( profile ); String code = RandomUtils . nextInt ( 100000 , 999999 ) + \"\" ; CommonRequest request = new CommonRequest (); request . setSysMethod ( MethodType . POST ); request . setSysDomain ( this . aliyunSMSConfig . getDomain ()); request . setSysVersion ( \"2017-05-25\" ); request . setSysAction ( \"SendSms\" ); request . putQueryParameter ( \"RegionId\" , this . aliyunSMSConfig . getRegionId ()); request . putQueryParameter ( \"PhoneNumbers\" , mobile ); //\u76ee\u6807\u624b\u673a\u53f7 request . putQueryParameter ( \"SignName\" , this . aliyunSMSConfig . getSignName ()); //\u7b7e\u540d\u540d\u79f0 request . putQueryParameter ( \"TemplateCode\" , this . aliyunSMSConfig . getTemplateCode ()); //\u77ed\u4fe1\u6a21\u677fcode request . putQueryParameter ( \"TemplateParam\" , \"{\\\"code\\\":\\\"\" + code + \"\\\"}\" ); //\u6a21\u677f\u4e2d\u53d8\u91cf\u66ff\u6362 try { CommonResponse response = client . getCommonResponse ( request ); String data = response . getData (); if ( StringUtils . contains ( data , \"\\\"Message\\\":\\\"OK\\\"\" )) { return code ; } log . info ( \"\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u5931\u8d25~ data = \" + data ); } catch ( Exception e ) { log . error ( \"\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u5931\u8d25~ mobile = \" + mobile , e ); } return null ; }","title":"3.6.1.4\u3001\u5b9e\u73b0\u53d1\u9001\u77ed\u4fe1\u65b9\u6cd5"},{"location":"tantan/day01/#362sso","text":"","title":"3.6.2\u3001SSO\u77ed\u4fe1\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day01/#3621mock","text":"\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/581","title":"3.6.2.1\u3001mock\u63a5\u53e3"},{"location":"tantan/day01/#3622","text":"\u7f16\u5199ErrorResult\uff0cErrorResult\u5bf9\u8c61\u662f\u4e0e\u524d\u7aef\u7ea6\u5b9a\u597d\u7684\u7ed3\u6784\uff0c\u5982\u679c\u53d1\u751f\u9519\u8bef\u9700\u8981\u8fd4\u56de\u8be5\u5bf9\u8c61\uff0c\u5982\u679c\u672a\u53d1\u751f\u9519\u8bef\u54cd\u5e94200\u5373\u53ef\u3002 package com.tanhua.sso.vo ; import lombok.Builder ; import lombok.Data ; @Data @Builder public class ErrorResult { private String errCode ; private String errMessage ; } SmsController\uff1a package com.tanhua.sso.controller ; import com.tanhua.sso.service.SmsService ; import com.tanhua.sso.vo.ErrorResult ; import lombok.extern.slf4j.Slf4j ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestBody ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RestController ; import java.util.Map ; @RestController @RequestMapping ( \"user\" ) @Slf4j public class SmsController { @Autowired private SmsService smsService ; /** * \u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u63a5\u53e3 * * @param param * @return */ @PostMapping ( \"login\" ) public ResponseEntity < ErrorResult > sendCheckCode ( @RequestBody Map < String , String > param ) { ErrorResult errorResult = null ; String phone = param . get ( \"phone\" ); try { errorResult = this . smsService . sendCheckCode ( phone ); if ( null == errorResult ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { log . error ( \"\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u5931\u8d25~ phone = \" + phone , e ); errorResult = ErrorResult . builder (). errCode ( \"000002\" ). errMessage ( \"\u77ed\u4fe1\u9a8c\u8bc1\u7801\u53d1\u9001\u5931\u8d25\uff01\" ). build (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). body ( errorResult ); } } SmsService\uff1a package com.tanhua.sso.service ; import com.aliyuncs.CommonRequest ; import com.aliyuncs.CommonResponse ; import com.aliyuncs.DefaultAcsClient ; import com.aliyuncs.IAcsClient ; import com.aliyuncs.exceptions.ClientException ; import com.aliyuncs.exceptions.ServerException ; import com.aliyuncs.http.MethodType ; import com.aliyuncs.profile.DefaultProfile ; import com.tanhua.sso.config.AliyunSMSConfig ; import com.tanhua.sso.vo.ErrorResult ; import lombok.extern.slf4j.Slf4j ; import org.apache.commons.lang3.RandomUtils ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.redis.core.RedisTemplate ; import org.springframework.stereotype.Service ; import java.time.Duration ; @Service @Slf4j public class SmsService { @Autowired private AliyunSMSConfig aliyunSMSConfig ; @Autowired private RedisTemplate < String , String > redisTemplate ; /** * \u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801 * * @param mobile * @return */ public String sendSms ( String mobile ) { DefaultProfile profile = DefaultProfile . getProfile ( this . aliyunSMSConfig . getRegionId (), this . aliyunSMSConfig . getAccessKeyId (), this . aliyunSMSConfig . getAccessKeySecret ()); IAcsClient client = new DefaultAcsClient ( profile ); String code = RandomUtils . nextInt ( 100000 , 999999 ) + \"\" ; CommonRequest request = new CommonRequest (); request . setSysMethod ( MethodType . POST ); request . setSysDomain ( this . aliyunSMSConfig . getDomain ()); request . setSysVersion ( \"2017-05-25\" ); request . setSysAction ( \"SendSms\" ); request . putQueryParameter ( \"RegionId\" , this . aliyunSMSConfig . getRegionId ()); request . putQueryParameter ( \"PhoneNumbers\" , mobile ); //\u76ee\u6807\u624b\u673a\u53f7 request . putQueryParameter ( \"SignName\" , this . aliyunSMSConfig . getSignName ()); //\u7b7e\u540d\u540d\u79f0 request . putQueryParameter ( \"TemplateCode\" , this . aliyunSMSConfig . getTemplateCode ()); //\u77ed\u4fe1\u6a21\u677fcode request . putQueryParameter ( \"TemplateParam\" , \"{\\\"code\\\":\\\"\" + code + \"\\\"}\" ); //\u6a21\u677f\u4e2d\u53d8\u91cf\u66ff\u6362 try { CommonResponse response = client . getCommonResponse ( request ); String data = response . getData (); if ( StringUtils . contains ( data , \"\\\"Message\\\":\\\"OK\\\"\" )) { return code ; } log . info ( \"\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u5931\u8d25~ data = \" + data ); } catch ( Exception e ) { log . error ( \"\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u5931\u8d25~ mobile = \" + mobile , e ); } return null ; } /** * \u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801 * \u5b9e\u73b0\uff1a\u53d1\u9001\u5b8c\u6210\u77ed\u4fe1\u9a8c\u8bc1\u7801\u540e\uff0c\u9700\u8981\u5c06\u9a8c\u8bc1\u7801\u4fdd\u5b58\u5230redis\u4e2d * @param phone * @return */ public ErrorResult sendCheckCode ( String phone ) { String redisKey = \"CHECK_CODE_\" + phone ; //\u5148\u5224\u65ad\u8be5\u624b\u673a\u53f7\u53d1\u9001\u7684\u9a8c\u8bc1\u7801\u662f\u5426\u8fd8\u672a\u5931\u6548 if ( this . redisTemplate . hasKey ( redisKey )){ String msg = \"\u4e0a\u4e00\u6b21\u53d1\u9001\u7684\u9a8c\u8bc1\u7801\u8fd8\u672a\u5931\u6548\uff01\" ; return ErrorResult . builder (). errCode ( \"000001\" ). errMessage ( msg ). build (); } String code = this . sendSms ( phone ); if ( StringUtils . isEmpty ( code )){ String msg = \"\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u5931\u8d25\uff01\" ; return ErrorResult . builder (). errCode ( \"000000\" ). errMessage ( msg ). build (); } //\u77ed\u4fe1\u53d1\u9001\u6210\u529f\uff0c\u5c06\u9a8c\u8bc1\u7801\u4fdd\u5b58\u5230redis\u4e2d\uff0c\u6709\u6548\u671f\u4e3a5\u5206\u949f this . redisTemplate . opsForValue (). set ( redisKey , code , Duration . ofMinutes ( 5 )); return null ; } }","title":"3.6.2.2\u3001\u7f16\u5199\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day01/#37jwt","text":"","title":"3.7\u3001JWT"},{"location":"tantan/day01/#371","text":"JSON Web token\u7b80\u79f0JWT\uff0c \u662f\u7528\u4e8e\u5bf9\u5e94\u7528\u7a0b\u5e8f\u4e0a\u7684\u7528\u6237\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u7684\u6807\u8bb0\u3002\u4e5f\u5c31\u662f\u8bf4, \u4f7f\u7528 JWTS \u7684\u5e94\u7528\u7a0b\u5e8f\u4e0d\u518d\u9700\u8981\u4fdd\u5b58\u6709\u5173\u5176\u7528\u6237\u7684 cookie \u6216\u5176\u4ed6session\u6570\u636e\u3002\u6b64\u7279\u6027\u4fbf\u4e8e\u53ef\u4f38\u7f29\u6027, \u540c\u65f6\u4fdd\u8bc1\u5e94\u7528\u7a0b\u5e8f\u7684\u5b89\u5168\u3002 \u5728\u8eab\u4efd\u9a8c\u8bc1\u8fc7\u7a0b\u4e2d, \u5f53\u7528\u6237\u4f7f\u7528\u5176\u51ed\u636e\u6210\u529f\u767b\u5f55\u65f6, \u5c06\u8fd4\u56de JSON Web token, \u5e76\u4e14\u5fc5\u987b\u5728\u672c\u5730\u4fdd\u5b58 (\u901a\u5e38\u5728\u672c\u5730\u5b58\u50a8\u4e2d)\u3002 \u6bcf\u5f53\u7528\u6237\u8981\u8bbf\u95ee\u53d7\u4fdd\u62a4\u7684\u8def\u7531\u6216\u8d44\u6e90 (\u7aef\u70b9) \u65f6, \u7528\u6237\u4ee3\u7406(user agent)\u5fc5\u987b\u8fde\u540c\u8bf7\u6c42\u4e00\u8d77\u53d1\u9001 JWT, \u901a\u5e38\u5728\u6388\u6743\u6807\u5934\u4e2d\u4f7f\u7528Bearer schema\u3002\u540e\u7aef\u670d\u52a1\u5668\u63a5\u6536\u5230\u5e26\u6709 JWT \u7684\u8bf7\u6c42\u65f6, \u9996\u5148\u8981\u505a\u7684\u662f\u9a8c\u8bc1token\u3002","title":"3.7.1\u3001\u7b80\u4ecb"},{"location":"tantan/day01/#372","text":"JWT\u5c31\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u7ecf\u8fc7\u52a0\u5bc6\u5904\u7406\u4e0e\u6821\u9a8c\u5904\u7406\u7684\u5b57\u7b26\u4e32\uff0c\u5f62\u5f0f\u4e3a\uff1aA.B.C A\u7531JWT\u5934\u90e8\u4fe1\u606fheader\u7ecf\u8fc7base64\u52a0\u5bc6\u5f97\u5230 ~~~json #\u9ed8\u8ba4\u7684\u5934\u4fe1\u606f { \"alg\": \"HS256\", \"typ\": \"JWT\" }","title":"3.7.2\u3001\u683c\u5f0f"},{"location":"tantan/day01/#httpsjwtio","text":"","title":"\u5b98\u7f51\u6d4b\u8bd5\uff1ahttps://jwt.io/"},{"location":"tantan/day01/#base64eyjhbgcioijiuzi1niisinr5cci6ikpxvcj9","text":"~~~ B\u662fpayload\uff0c\u5b58\u653e\u6709\u6548\u4fe1\u606f\u7684\u5730\u65b9\uff0c\u8fd9\u4e9b\u4fe1\u606f\u5305\u542b\u4e09\u4e2a\u90e8\u5206\uff1a \u6807\u51c6\u4e2d\u6ce8\u518c\u7684\u58f0\u660e (\u5efa\u8bae\u4f46\u4e0d\u5f3a\u5236\u4f7f\u7528) iss: jwt\u7b7e\u53d1\u8005 sub: jwt\u6240\u9762\u5411\u7684\u7528\u6237 aud: \u63a5\u6536jwt\u7684\u4e00\u65b9 exp: jwt\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u8fd9\u4e2a\u8fc7\u671f\u65f6\u95f4\u5fc5\u987b\u8981\u5927\u4e8e\u7b7e\u53d1\u65f6\u95f4 nbf: \u5b9a\u4e49\u5728\u4ec0\u4e48\u65f6\u95f4\u4e4b\u524d\uff0c\u8be5jwt\u90fd\u662f\u4e0d\u53ef\u7528\u7684. iat: jwt\u7684\u7b7e\u53d1\u65f6\u95f4 jti: jwt\u7684\u552f\u4e00\u8eab\u4efd\u6807\u8bc6\uff0c\u4e3b\u8981\u7528\u6765\u4f5c\u4e3a\u4e00\u6b21\u6027token,\u4ece\u800c\u56de\u907f\u91cd\u653e\u653b\u51fb\u3002 \u516c\u5171\u7684\u58f0\u660e \u516c\u5171\u7684\u58f0\u660e\u53ef\u4ee5\u6dfb\u52a0\u4efb\u4f55\u7684\u4fe1\u606f\uff0c\u4e00\u822c\u6dfb\u52a0\u7528\u6237\u7684\u76f8\u5173\u4fe1\u606f\u6216\u5176\u4ed6\u4e1a\u52a1\u9700\u8981\u7684\u5fc5\u8981\u4fe1\u606f.\u4f46\u4e0d\u5efa\u8bae\u6dfb\u52a0\u654f\u611f\u4fe1\u606f\uff0c\u56e0\u4e3a\u8be5\u90e8\u5206\u5728\u5ba2\u6237\u7aef\u53ef\u89e3\u5bc6. \u79c1\u6709\u7684\u58f0\u660e \u79c1\u6709\u58f0\u660e\u662f\u63d0\u4f9b\u8005\u548c\u6d88\u8d39\u8005\u6240\u5171\u540c\u5b9a\u4e49\u7684\u58f0\u660e\uff0c\u4e00\u822c\u4e0d\u5efa\u8bae\u5b58\u653e\u654f\u611f\u4fe1\u606f\uff0c\u56e0\u4e3abase64\u662f\u5bf9\u79f0\u89e3\u5bc6\u7684\uff0c\u610f\u5473\u7740\u8be5\u90e8\u5206\u4fe1\u606f\u53ef\u4ee5\u5f52\u7c7b\u4e3a\u660e\u6587\u4fe1\u606f\u3002 ~~~json #\u5b58\u653e\u7684\u6570\u636e\uff1a { \"sub\": \"1234567890\", \"name\": \"John Doe\", \"iat\": 1516239022 }","title":"base64\u52a0\u5bc6\u540e\u7684\u5b57\u7b26\u4e32\u4e3a\uff1aeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"},{"location":"tantan/day01/#base64","text":"eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ ~~~ C\u7531A\u548cB\u901a\u8fc7\u52a0\u5bc6\u7b97\u6cd5\u5f97\u5230\uff0c\u7528\u4f5c\u5bf9token\u8fdb\u884c\u6821\u9a8c\uff0c\u770b\u662f\u5426\u6709\u6548 \u8fd9\u4e2a\u90e8\u5206\u9700\u8981base64\u52a0\u5bc6\u540e\u7684header\u548cbase64\u52a0\u5bc6\u540e\u7684payload\u4f7f\u7528 . \u8fde\u63a5\u7ec4\u6210\u7684\u5b57\u7b26\u4e32\uff0c\u7136\u540e\u901a\u8fc7header\u4e2d\u58f0\u660e\u7684\u52a0\u5bc6\u65b9\u5f0f\u8fdb\u884c\u52a0\u76d0 secret \u7ec4\u5408\u52a0\u5bc6\uff0c\u7136\u540e\u5c31\u6784\u6210\u4e86jwt\u7684\u7b2c\u4e09\u90e8\u5206\u3002 ~~~json #secret\u4e3a\uff1aitcast #\u5f97\u5230\u7684\u52a0\u5bc6\u5b57\u7b26\u4e32\u4e3a\uff1aDwMTjJktoFFdClHqjJMRgYzICo6FJOUc3Jmev9EScBc","title":"base64\u540e\u7684\u5b57\u7b26\u4e32\u4e3a\uff1a"},{"location":"tantan/day01/#tokeneyjhbgcioijiuzi1niisinr5cci6ikpxvcj9eyjzdwiioiixmjm0nty3odkwiiwibmftzsi6ikpvag4grg9liiwiawf0ijoxnte2mjm5mdiyfqdwmtjjktoffdclhqjjmrgyzico6fjouc3jmev9escbc","text":"~~~","title":"\u6574\u4f53\u7684token\u4e3a\uff1aeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.DwMTjJktoFFdClHqjJMRgYzICo6FJOUc3Jmev9EScBc"},{"location":"tantan/day01/#373","text":"","title":"3.7.3\u3001\u6d41\u7a0b"},{"location":"tantan/day01/#374","text":"\u5bfc\u5165\u4f9d\u8d56\uff1a <dependency> <groupId> io.jsonwebtoken </groupId> <artifactId> jjwt </artifactId> <version> 0.9.1 </version> </dependency> \u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b\uff1a package com.tanhua.sso.service ; import io.jsonwebtoken.ExpiredJwtException ; import io.jsonwebtoken.JwsHeader ; import io.jsonwebtoken.Jwts ; import io.jsonwebtoken.SignatureAlgorithm ; import org.junit.Test ; import java.util.Date ; import java.util.HashMap ; import java.util.Map ; public class TestJWT { String secret = \"itcast\" ; @Test public void testCreateToken (){ Map < String , Object > header = new HashMap < String , Object > (); header . put ( JwsHeader . TYPE , JwsHeader . JWT_TYPE ); header . put ( JwsHeader . ALGORITHM , \"HS256\" ); Map < String , Object > claims = new HashMap < String , Object > (); claims . put ( \"mobile\" , \"1333333333\" ); claims . put ( \"id\" , \"2\" ); // \u751f\u6210token String jwt = Jwts . builder () . setHeader ( header ) //header\uff0c\u53ef\u7701\u7565 . setClaims ( claims ) //payload\uff0c\u5b58\u653e\u6570\u636e\u7684\u4f4d\u7f6e\uff0c\u4e0d\u80fd\u653e\u7f6e\u654f\u611f\u6570\u636e\uff0c\u5982\uff1a\u5bc6\u7801\u7b49 . signWith ( SignatureAlgorithm . HS256 , secret ) //\u8bbe\u7f6e\u52a0\u5bc6\u65b9\u6cd5\u548c\u52a0\u5bc6\u76d0 . setExpiration ( new Date ( System . currentTimeMillis () + 3000 )) //\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c3\u79d2\u540e\u8fc7\u671f . compact (); System . out . println ( jwt ); } @Test public void testDecodeToken (){ String token = \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJtb2JpbGUiOiIxMzMzMzMzMzMzIiwiaWQiOiIyIiwiZXhwIjoxNjA1NTEzMDA2fQ.1eG3LpudD4XBycUG39UQDaKVBQHgaup-E1OLWo_m8m8\" ; try { // \u901a\u8fc7token\u89e3\u6790\u6570\u636e Map < String , Object > body = Jwts . parser () . setSigningKey ( secret ) . parseClaimsJws ( token ) . getBody (); System . out . println ( body ); //{mobile=1333333333, id=2, exp=1605513392} } catch ( ExpiredJwtException e ) { System . out . println ( \"token\u5df2\u7ecf\u8fc7\u671f\uff01\" ); } catch ( Exception e ) { System . out . println ( \"token\u4e0d\u5408\u6cd5\uff01\" ); } } }","title":"3.7.4\u3001\u793a\u4f8b"},{"location":"tantan/day01/#38","text":"\u7528\u6237\u63a5\u6536\u5230\u9a8c\u8bc1\u7801\u540e\uff0c\u8fdb\u884c\u8f93\u5165\u9a8c\u8bc1\u7801\uff0c\u70b9\u51fb\u767b\u5f55\uff0c\u524d\u7aef\u7cfb\u7edf\u5c06\u624b\u673a\u53f7\u4ee5\u53ca\u9a8c\u8bc1\u7801\u63d0\u4ea4\u5230SSO\u8fdb\u884c\u6821\u9a8c\u3002","title":"3.8\u3001\u7528\u6237\u767b\u5f55"},{"location":"tantan/day01/#371mock","text":"\u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/164/interface/api/12593","title":"3.7.1\u3001mock\u63a5\u53e3"},{"location":"tantan/day01/#372usercontroller","text":"package com.tanhua.sso.controller ; import com.tanhua.sso.service.UserService ; import com.tanhua.sso.vo.ErrorResult ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestBody ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RestController ; import java.util.HashMap ; import java.util.Map ; @RestController @RequestMapping ( \"user\" ) public class UserController { @Autowired private UserService userService ; /** * \u7528\u6237\u767b\u5f55 * * @param param * @return */ @PostMapping ( \"loginVerification\" ) public ResponseEntity < Object > login ( @RequestBody Map < String , String > param ){ try { String phone = param . get ( \"phone\" ); String code = param . get ( \"verificationCode\" ); String data = this . userService . login ( phone , code ); if ( StringUtils . isNotEmpty ( data )){ //\u767b\u5f55\u6210\u529f Map < String , Object > result = new HashMap <> ( 2 ); String [] ss = StringUtils . split ( data , '|' ); result . put ( \"token\" , ss [ 0 ] ); result . put ( \"isNew\" , Boolean . valueOf ( ss [ 1 ] )); return ResponseEntity . ok ( result ); } } catch ( Exception e ) { e . printStackTrace (); } ErrorResult errorResult = ErrorResult . builder (). errCode ( \"000002\" ). errMessage ( \"\u767b\u5f55\u5931\u8d25\uff01\" ). build (); return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). body ( errorResult ); } }","title":"3.7.2\u3001UserController"},{"location":"tantan/day01/#373userservice","text":"package com.tanhua.sso.service ; import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper ; import com.baomidou.mybatisplus.core.toolkit.Wrappers ; import com.tanhua.sso.mapper.UserMapper ; import com.tanhua.sso.pojo.User ; import io.jsonwebtoken.Jwts ; import io.jsonwebtoken.SignatureAlgorithm ; import lombok.extern.slf4j.Slf4j ; import org.apache.commons.codec.digest.DigestUtils ; import org.apache.commons.lang3.StringUtils ; import org.apache.rocketmq.spring.core.RocketMQTemplate ; import org.joda.time.DateTime ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.data.redis.core.RedisTemplate ; import org.springframework.messaging.MessagingException ; import org.springframework.stereotype.Service ; import java.util.HashMap ; import java.util.Map ; @Service @Slf4j public class UserService { @Autowired private RedisTemplate < String , String > redisTemplate ; @Autowired private UserMapper userMapper ; @Value ( \"${jwt.secret}\" ) private String secret ; @Autowired private RocketMQTemplate rocketMQTemplate ; /** * \u7528\u6237\u767b\u5f55 * * @param phone \u624b\u673a\u53f7 * @param code \u9a8c\u8bc1\u7801 * @return */ public String login ( String phone , String code ) { String redisKey = \"CHECK_CODE_\" + phone ; boolean isNew = false ; //\u6821\u9a8c\u9a8c\u8bc1\u7801 String redisData = this . redisTemplate . opsForValue (). get ( redisKey ); if ( ! StringUtils . equals ( code , redisData )) { return null ; //\u9a8c\u8bc1\u7801\u9519\u8bef } //\u9a8c\u8bc1\u7801\u5728\u6821\u9a8c\u5b8c\u6210\u540e\uff0c\u9700\u8981\u5e9f\u5f03 this . redisTemplate . delete ( redisKey ); QueryWrapper < User > queryWrapper = new QueryWrapper <> (); queryWrapper . eq ( \"mobile\" , phone ); User user = this . userMapper . selectOne ( queryWrapper ); if ( null == user ) { //\u9700\u8981\u6ce8\u518c\u8be5\u7528\u6237 user = new User (); user . setMobile ( phone ); user . setPassword ( DigestUtils . md5Hex ( \"123456\" )); //\u6ce8\u518c\u65b0\u7528\u6237 this . userMapper . insert ( user ); isNew = true ; } //\u751f\u6210token Map < String , Object > claims = new HashMap < String , Object > (); claims . put ( \"id\" , user . getId ()); // \u751f\u6210token String token = Jwts . builder () . setClaims ( claims ) //payload\uff0c\u5b58\u653e\u6570\u636e\u7684\u4f4d\u7f6e\uff0c\u4e0d\u80fd\u653e\u7f6e\u654f\u611f\u6570\u636e\uff0c\u5982\uff1a\u5bc6\u7801\u7b49 . signWith ( SignatureAlgorithm . HS256 , secret ) //\u8bbe\u7f6e\u52a0\u5bc6\u65b9\u6cd5\u548c\u52a0\u5bc6\u76d0 . setExpiration ( new DateTime (). plusHours ( 12 ). toDate ()) //\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c12\u5c0f\u65f6\u540e\u8fc7\u671f . compact (); try { //\u53d1\u9001\u7528\u6237\u767b\u5f55\u6210\u529f\u7684\u6d88\u606f Map < String , Object > msg = new HashMap <> (); msg . put ( \"id\" , user . getId ()); msg . put ( \"date\" , System . currentTimeMillis ()); this . rocketMQTemplate . convertAndSend ( \"tanhua-sso-login\" , msg ); } catch ( MessagingException e ) { log . error ( \"\u53d1\u9001\u6d88\u606f\u5931\u8d25\uff01\" , e ); } return token + \"|\" + isNew ; } }","title":"3.7.3\u3001UserService"},{"location":"tantan/day01/#374_1","text":"","title":"3.7.4\u3001\u6d4b\u8bd5"},{"location":"tantan/day01/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/","text":"\u4e86\u89e3\u9879\u76ee\u7684\u80cc\u666f \u4e86\u89e3\u9879\u76ee\u7684\u6280\u672f\u67b6\u6784\u3001\u65b9\u6848 \u4e86\u89e3\u9879\u76ee\u7684\u529f\u80fd\u8bbe\u8ba1 \u638c\u63e1\u6a21\u62df\u5668\u7684\u4f7f\u7528 \u638c\u63e1\u5de5\u7a0b\u7684\u642d\u5efa \u638c\u63e1\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801 \u5b8c\u6210\u7528\u6237\u767b\u5f55\u529f\u80fd","title":"\u5b66\u4e60\u76ee\u6807"},{"location":"tantan/day02/","text":"\u8bfe\u7a0b\u4ecb\u7ecd \u00b6 \u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f \u963f\u91cc\u4e91OSS\u670d\u52a1\u5e94\u7528 \u4eba\u8138\u8bc6\u522b MongoDB\u5feb\u901f\u5165\u95e8 SpringBoot\u6574\u5408MongoDB 1\u3001\u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f \u00b6 \u7528\u6237\u5728\u9996\u6b21\u767b\u5f55\u65f6\u9700\u8981\u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f\uff0c\u5305\u62ec\u6027\u522b\u3001\u6635\u79f0\u3001\u751f\u65e5\u3001\u57ce\u5e02\u3001\u5934\u50cf\u7b49\u3002 \u5176\u4e2d\uff0c\u5934\u50cf\u6570\u636e\u9700\u8981\u505a\u56fe\u7247\u4e0a\u4f20\uff0c\u8fd9\u91cc\u91c7\u7528\u963f\u91cc\u4e91\u7684OSS\u670d\u52a1\u4f5c\u4e3a\u6211\u4eec\u7684\u56fe\u7247\u670d\u52a1\u5668\uff0c\u5e76\u4e14\u5bf9\u5934\u50cf\u8981\u505a\u4eba\u8138\u8bc6\u522b\uff0c\u975e\u4eba\u8138\u7167\u7247\u4e0d\u5f97\u4e0a\u4f20\u3002 1.1\u3001\u56fe\u7247\u4e0a\u4f20 \u00b6 1.1.1\u3001\u56fe\u7247\u5b58\u50a8\u89e3\u51b3\u65b9\u6848 \u00b6 \u5b9e\u73b0\u56fe\u7247\u4e0a\u4f20\u670d\u52a1\uff0c\u9700\u8981\u6709\u5b58\u50a8\u7684\u652f\u6301\uff0c\u90a3\u4e48\u6211\u4eec\u7684\u89e3\u51b3\u65b9\u6848\u5c06\u4ee5\u4e0b\u51e0\u79cd\uff1a \u76f4\u63a5\u5c06\u56fe\u7247\u4fdd\u5b58\u5230\u670d\u52a1\u7684\u786c\u76d8 \u4f18\u70b9\uff1a\u5f00\u53d1\u4fbf\u6377\uff0c\u6210\u672c\u4f4e \u7f3a\u70b9\uff1a\u6269\u5bb9\u56f0\u96be \u4f7f\u7528\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u8fdb\u884c\u5b58\u50a8 \u4f18\u70b9\uff1a\u5bb9\u6613\u5b9e\u73b0\u6269\u5bb9 \u7f3a\u70b9\uff1a\u5f00\u53d1\u590d\u6742\u5ea6\u7a0d\u5927\uff08\u6709\u6210\u719f\u7684\u4ea7\u54c1\u53ef\u4ee5\u4f7f\u7528\uff0c\u6bd4\u5982\uff1aFastDFS\uff09 \u4f7f\u7528nfs\u505a\u5b58\u50a8 \u4f18\u70b9\uff1a\u5f00\u53d1\u8f83\u4e3a\u4fbf\u6377 \u7f3a\u70b9\uff1a\u9700\u8981\u6709\u4e00\u5b9a\u7684\u8fd0\u7ef4\u77e5\u8bc6\u8fdb\u884c\u90e8\u7f72\u548c\u7ef4\u62a4 \u4f7f\u7528\u7b2c\u4e09\u65b9\u7684\u5b58\u50a8\u670d\u52a1 \u4f18\u70b9\uff1a\u5f00\u53d1\u7b80\u5355\uff0c\u62e5\u6709\u5f3a\u5927\u529f\u80fd\uff0c\u514d\u7ef4\u62a4 \u7f3a\u70b9\uff1a\u4ed8\u8d39 \u5728\u672c\u5957\u8bfe\u7a0b\u4e2d\u9009\u7528\u963f\u91cc\u4e91\u7684OSS\u670d\u52a1\u8fdb\u884c\u56fe\u7247\u5b58\u50a8\u3002 1.1.2\u3001\u963f\u91cc\u4e91OSS\u5b58\u50a8 \u00b6 \u6d41\u7a0b\uff1a 1.1.2.1\u3001\u4ec0\u4e48\u662fOSS\u670d\u52a1\uff1f \u00b6 \u5730\u5740\uff1ahttps://www.aliyun.com/product/oss 1.1.2.2\u3001\u8d2d\u4e70\u670d\u52a1 \u00b6 \u4f7f\u7528\u7b2c\u4e09\u65b9\u670d\u52a1\u6700\u5927\u7684\u7f3a\u70b9\u5c31\u662f\u9700\u8981\u4ed8\u8d39\uff0c\u4e0b\u9762\uff0c\u6211\u4eec\u770b\u4e0b\u5982\u4f55\u8d2d\u4e70\u5f00\u901a\u670d\u52a1\u3002 \u8d2d\u4e70\u4e0b\u884c\u6d41\u91cf\u5305\uff1a \uff08\u4e0d\u8d2d\u4e70\u4e5f\u53ef\u4ee5\u4f7f\u7528\uff0c\u6309\u7167\u6d41\u91cf\u4ed8\u8d39\uff09 \u8bf4\u660e\uff1aOSS\u7684\u4e0a\u884c\u6d41\u91cf\u662f\u514d\u8d39\u7684\uff0c\u4f46\u662f\u4e0b\u884c\u6d41\u91cf\u662f\u9700\u8981\u8d2d\u4e70\u7684\u3002 1.1.2.3\u3001\u521b\u5efaBucket \u00b6 \u4f7f\u7528OSS\uff0c\u9996\u5148\u9700\u8981\u521b\u5efaBucket\uff0cBucket\u7ffb\u8bd1\u6210\u4e2d\u6587\u662f\u6c34\u6876\u7684\u610f\u601d\uff0c\u628a\u5b58\u50a8\u7684\u56fe\u7247\u8d44\u6e90\u770b\u505a\u662f\u6c34\uff0c\u60f3\u8981\u76db\u6c34\u5fc5\u987b\u5f97\u6709\u6876\uff0c\u5c31\u662f\u8fd9\u4e2a\u610f\u601d\u4e86\u3002 \u8fdb\u5165\u63a7\u5236\u53f0\uff0chttps://oss.console.aliyun.com/overview \u9009\u62e9Bucket\u540e\uff0c\u5373\u53ef\u770b\u5230\u5bf9\u5e94\u7684\u4fe1\u606f\uff0c\u5982\uff1aurl\u3001\u6d88\u8017\u6d41\u91cf\u7b49 : \u6587\u4ef6\u7ba1\u7406\uff1a \u67e5\u770b\u6587\u4ef6\uff1a 1.1.2.4\u3001\u521b\u5efa\u7528\u6237 \u00b6 \u521b\u5efa\u7528\u6237\u7684\u65b9\u5f0f\u4e0e\u77ed\u4fe1\u63a5\u53e3\u4e2d\u7684\u65b9\u5f0f\u4e00\u6837\uff0c\u9700\u8981\u8bbe\u7f6eoss\u6743\u9650\u3002 1.1.3\u3001\u5bfc\u5165\u4f9d\u8d56 \u00b6 <dependency> <groupId> com.aliyun.oss </groupId> <artifactId> aliyun-sdk-oss </artifactId> <version> 2.8.3 </version> </dependency> 1.1.4\u3001OSS\u914d\u7f6e \u00b6 aliyun.properties\uff1a aliyun.endpoint = http://oss-cn-zhangjiakou.aliyuncs.com aliyun.accessKeyId = *********** aliyun.accessKeySecret = *************** aliyun.bucketName = tanhua-dev aliyun.urlPrefix = http://tanhua-dev.oss-cn-zhangjiakou.aliyuncs.com/ AliyunConfig\uff1a package com.tanhua.sso.config ; import com.aliyun.oss.OSSClient ; import lombok.Data ; import org.springframework.boot.context.properties.ConfigurationProperties ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; import org.springframework.context.annotation.PropertySource ; @Configuration @PropertySource ( \"classpath:aliyun.properties\" ) @ConfigurationProperties ( prefix = \"aliyun\" ) @Data public class AliyunConfig { private String endpoint ; private String accessKeyId ; private String accessKeySecret ; private String bucketName ; private String urlPrefix ; @Bean public OSSClient oSSClient () { return new OSSClient ( endpoint , accessKeyId , accessKeySecret ); } } 1.1.5\u3001PicUploadService \u00b6 package com.tanhua.sso.service ; import com.aliyun.oss.OSSClient ; import com.tanhua.sso.config.AliyunConfig ; import com.tanhua.sso.vo.PicUploadResult ; import org.apache.commons.lang3.RandomUtils ; import org.apache.commons.lang3.StringUtils ; import org.joda.time.DateTime ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import org.springframework.web.multipart.MultipartFile ; import java.io.ByteArrayInputStream ; @Service public class PicUploadService { // \u5141\u8bb8\u4e0a\u4f20\u7684\u683c\u5f0f private static final String [] IMAGE_TYPE = new String [] { \".bmp\" , \".jpg\" , \".jpeg\" , \".gif\" , \".png\" }; @Autowired private OSSClient ossClient ; @Autowired private AliyunConfig aliyunConfig ; public PicUploadResult upload ( MultipartFile uploadFile ) { PicUploadResult fileUploadResult = new PicUploadResult (); //\u56fe\u7247\u505a\u6821\u9a8c\uff0c\u5bf9\u540e\u7f00\u540d boolean isLegal = false ; for ( String type : IMAGE_TYPE ) { if ( StringUtils . endsWithIgnoreCase ( uploadFile . getOriginalFilename (), type )) { isLegal = true ; break ; } } if ( ! isLegal ) { fileUploadResult . setStatus ( \"error\" ); return fileUploadResult ; } // \u6587\u4ef6\u65b0\u8def\u5f84 String fileName = uploadFile . getOriginalFilename (); String filePath = getFilePath ( fileName ); // \u4e0a\u4f20\u5230\u963f\u91cc\u4e91 try { // \u76ee\u5f55\u7ed3\u6784\uff1aimages/2018/12/29/xxxx.jpg ossClient . putObject ( aliyunConfig . getBucketName (), filePath , new ByteArrayInputStream ( uploadFile . getBytes ())); } catch ( Exception e ) { e . printStackTrace (); //\u4e0a\u4f20\u5931\u8d25 fileUploadResult . setStatus ( \"error\" ); return fileUploadResult ; } // \u4e0a\u4f20\u6210\u529f fileUploadResult . setStatus ( \"done\" ); fileUploadResult . setName ( this . aliyunConfig . getUrlPrefix () + filePath ); fileUploadResult . setUid ( String . valueOf ( System . currentTimeMillis ())); return fileUploadResult ; } private String getFilePath ( String sourceFileName ) { DateTime dateTime = new DateTime (); return \"images/\" + dateTime . toString ( \"yyyy\" ) + \"/\" + dateTime . toString ( \"MM\" ) + \"/\" + dateTime . toString ( \"dd\" ) + \"/\" + System . currentTimeMillis () + RandomUtils . nextInt ( 100 , 9999 ) + \".\" + StringUtils . substringAfterLast ( sourceFileName , \".\" ); } } \u6240\u9700\u5176\u4ed6\u7684\u4ee3\u7801\uff1a PicUploadResult: package com.tanhua.sso.vo ; import lombok.Data ; @Data public class PicUploadResult { // \u6587\u4ef6\u552f\u4e00\u6807\u8bc6 private String uid ; // \u6587\u4ef6\u540d private String name ; // \u72b6\u6001\u6709\uff1auploading done error removed private String status ; // \u670d\u52a1\u7aef\u54cd\u5e94\u5185\u5bb9\uff0c\u5982\uff1a'{\"status\": \"success\"}' private String response ; } 1.1.6\u3001PicUploadController \u00b6 package com.tanhua.sso.controller ; import com.tanhua.sso.service.PicUploadService ; import com.tanhua.sso.vo.PicUploadResult ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Controller ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RequestParam ; import org.springframework.web.bind.annotation.ResponseBody ; import org.springframework.web.multipart.MultipartFile ; @RequestMapping ( \"pic/upload\" ) @Controller public class PicUploadController { @Autowired private PicUploadService picUploadService ; @PostMapping @ResponseBody public PicUploadResult upload ( @RequestParam ( \"file\" ) MultipartFile multipartFile ) { return this . picUploadService . upload ( multipartFile ); } } 1.1.7\u3001\u6d4b\u8bd5 \u00b6 1.2\u3001\u4eba\u8138\u8bc6\u522b \u00b6 \u4eba\u8138\u8bc6\u522b\u6280\u672f\u91c7\u7528\u8679\u8f6f\u5f00\u653e\u5e73\u53f0\u5b9e\u73b0\uff08\u514d\u8d39\u4f7f\u7528\uff09\u3002\u5b98\u7f51\uff1ahttps://www.arcsoft.com.cn/ 1.2.1\u3001\u4f7f\u7528\u8bf4\u660e \u00b6 \u4f7f\u7528\u8679\u8f6f\u5e73\u53f0\u9700\u8981\u5148\u6ce8\u518c\u5f00\u53d1\u8005\u8d26\u53f7\uff1ahttps://ai.arcsoft.com.cn/ucenter/user/userlogin \u6ce8\u518c\u5b8c\u6210\u540e\u8fdb\u884c\u767b\u5f55\uff0c\u7136\u540e\u8fdb\u884c\u521b\u5efa\u5e94\u7528\uff1a \u521b\u5efa\u5b8c\u6210\u540e\uff0c\u9700\u8981\u8fdb\u884c\u5b9e\u540d\u8ba4\u8bc1\uff0c\u5426\u5219\u76f8\u5173\u7684SDK\u662f\u4e0d\u80fd\u4f7f\u7528\u7684\u3002 \u5b9e\u540d\u8ba4\u8bc1\u540e\u5373\u53ef\u4e0b\u8f7d\u5bf9\u5e94\u5e73\u53f0\u7684SDk\uff0c\u6211\u4eec\u9700\u8981\u4e0b\u8f7dwindows\u4ee5\u53calinux\u5e73\u53f0\u3002 \u6dfb\u52a0SDK\uff08Linux\u4e0eWindows\u5e73\u53f0\uff09\uff1a \u4e0b\u8f7dSDK\uff0c\u6253\u5f00\u89e3\u538b\u5305\uff0c\u53ef\u4ee5\u770b\u5230\u6709\u63d0\u4f9b\u76f8\u5e94\u7684jar\u5305\u4ee5\u53ca\u793a\u4f8b\u4ee3\u7801\uff1a \u9700\u8981\u7279\u522b\u8bf4\u660e\u7684\u662f\uff1a\u6bcf\u4e2a\u8d26\u53f7\u7684SDK\u5305\u4e0d\u901a\u7528\uff0c\u6240\u4ee5\u81ea\u5df1\u8981\u4e0b\u8f7d\u81ea\u5df1\u7684SDK\u5305\u3002 1.2.2\u3001\u5b89\u88c5jar\u5230\u672c\u5730\u4ed3\u5e93 \u00b6 \u8fdb\u5165\u5230libs\u76ee\u5f55\uff0c\u9700\u8981\u5c06arcsoft-sdk-face-3.0.0.0.jar\u5b89\u88c5\u5230\u672c\u5730\u4ed3\u5e93\uff1a mvn install:install-file -DgroupId = com.arcsoft.face -DartifactId = arcsoft-sdk-face -Dversion = 3 .0.0.0 -Dpackaging = jar -Dfile = arcsoft-sdk-face-3.0.0.0.jar \u5b89\u88c5\u6210\u529f\u540e\uff0c\u5373\u53ef\u901a\u8fc7maven\u5750\u6807\u5f15\u7528\u4e86\uff1a <dependency> <groupId> com.arcsoft.face </groupId> <artifactId> arcsoft-sdk-face </artifactId> <version> 3.0.0.0 </version> <!--<scope>system</scope>--> <!--\u5982\u679c\u6ca1\u6709\u5b89\u88c5\u5230\u672c\u5730\u4ed3\u5e93\uff0c\u53ef\u4ee5\u5c06jar\u5305\u62f7\u8d1d\u5230\u5de5\u7a0b\u7684lib\u4e0b\u9762\u4e0b\uff0c\u76f4\u63a5\u5f15\u7528--> <!--<systemPath>${project.basedir}/lib/arcsoft-sdk-face-3.0.0.0.jar</systemPath>--> </dependency> 1.2.3\u3001\u5f00\u59cb\u4f7f\u7528 \u00b6 \u8bf4\u660e\uff1a\u8679\u8f6f\u7684SDK\u662f\u514d\u8d39\u4f7f\u7528\u7684\uff0c\u4f46\u662f\u9996\u6b21\u4f7f\u7528\u65f6\u9700\u8981\u8054\u7f51\u6fc0\u6d3b\uff0c\u6fc0\u6d3b\u540e\u53ef\u79bb\u7ebf\u4f7f\u7528\u3002\u4f7f\u7528\u5468\u671f\u4e3a1\u5e74\uff0c1\u5e74\u540e\u9700\u8981\u8054\u7f51\u518d\u6b21\u6fc0\u6d3b\u3002 \u4e2a\u4eba\u514d\u8d39\u6fc0\u6d3bSDK\u603b\u6570\u91cf\u4e3a100\u3002 \u914d\u7f6e\uff1aapplication.properties #\u8679\u8f6f\u76f8\u5173\u914d\u7f6e(\u5728\u8679\u8f6f\u5e94\u7528\u4e2d\u627e\u5230\u5bf9\u5e94\u7684\u53c2\u6570) arcsoft.appid = ****************** arcsoft.sdkKey = ***************** arcsoft.libPath = F:\\\\code\\\\WIN64 FaceEngineService\uff1a package com.tanhua.sso.service ; import com.arcsoft.face.EngineConfiguration ; import com.arcsoft.face.FaceEngine ; import com.arcsoft.face.FaceInfo ; import com.arcsoft.face.FunctionConfiguration ; import com.arcsoft.face.enums.DetectMode ; import com.arcsoft.face.enums.DetectOrient ; import com.arcsoft.face.enums.ErrorInfo ; import com.arcsoft.face.enums.ImageFormat ; import com.arcsoft.face.toolkit.ImageFactory ; import com.arcsoft.face.toolkit.ImageInfo ; import org.slf4j.Logger ; import org.slf4j.LoggerFactory ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.stereotype.Service ; import javax.annotation.PostConstruct ; import java.io.File ; import java.util.ArrayList ; import java.util.List ; @Service public class FaceEngineService { private static final Logger LOGGER = LoggerFactory . getLogger ( FaceEngineService . class ); @Value ( \"${arcsoft.appid}\" ) private String appid ; @Value ( \"${arcsoft.sdkKey}\" ) private String sdkKey ; @Value ( \"${arcsoft.libPath}\" ) private String libPath ; private FaceEngine faceEngine ; @PostConstruct public void init () { // \u6fc0\u6d3b\u5e76\u4e14\u521d\u59cb\u5316\u5f15\u64ce FaceEngine faceEngine = new FaceEngine ( libPath ); int activeCode = faceEngine . activeOnline ( appid , sdkKey ); if ( activeCode != ErrorInfo . MOK . getValue () && activeCode != ErrorInfo . MERR_ASF_ALREADY_ACTIVATED . getValue ()) { LOGGER . error ( \"\u5f15\u64ce\u6fc0\u6d3b\u5931\u8d25\" ); throw new RuntimeException ( \"\u5f15\u64ce\u6fc0\u6d3b\u5931\u8d25\" ); } //\u5f15\u64ce\u914d\u7f6e EngineConfiguration engineConfiguration = new EngineConfiguration (); //IMAGE\u68c0\u6d4b\u6a21\u5f0f\uff0c\u7528\u4e8e\u5904\u7406\u5355\u5f20\u7684\u56fe\u50cf\u6570\u636e engineConfiguration . setDetectMode ( DetectMode . ASF_DETECT_MODE_IMAGE ); //\u4eba\u8138\u68c0\u6d4b\u89d2\u5ea6\uff0c\u5168\u89d2\u5ea6 engineConfiguration . setDetectFaceOrientPriority ( DetectOrient . ASF_OP_ALL_OUT ); //\u529f\u80fd\u914d\u7f6e FunctionConfiguration functionConfiguration = new FunctionConfiguration (); functionConfiguration . setSupportAge ( true ); functionConfiguration . setSupportFace3dAngle ( true ); functionConfiguration . setSupportFaceDetect ( true ); functionConfiguration . setSupportFaceRecognition ( true ); functionConfiguration . setSupportGender ( true ); functionConfiguration . setSupportLiveness ( true ); functionConfiguration . setSupportIRLiveness ( true ); engineConfiguration . setFunctionConfiguration ( functionConfiguration ); //\u521d\u59cb\u5316\u5f15\u64ce int initCode = faceEngine . init ( engineConfiguration ); if ( initCode != ErrorInfo . MOK . getValue ()) { LOGGER . error ( \"\u521d\u59cb\u5316\u5f15\u64ce\u51fa\u9519!\" ); throw new RuntimeException ( \"\u521d\u59cb\u5316\u5f15\u64ce\u51fa\u9519!\" ); } this . faceEngine = faceEngine ; } /** * \u68c0\u6d4b\u56fe\u7247\u662f\u5426\u4e3a\u4eba\u50cf * * @param imageInfo \u56fe\u50cf\u5bf9\u8c61 * @return true:\u4eba\u50cf\uff0cfalse:\u975e\u4eba\u50cf */ public boolean checkIsPortrait ( ImageInfo imageInfo ) { // \u5b9a\u4e49\u4eba\u8138\u5217\u8868 List < FaceInfo > faceInfoList = new ArrayList < FaceInfo > (); faceEngine . detectFaces ( imageInfo . getImageData (), imageInfo . getWidth (), imageInfo . getHeight (), ImageFormat . CP_PAF_BGR24 , faceInfoList ); return ! faceInfoList . isEmpty (); } public boolean checkIsPortrait ( byte [] imageData ) { return this . checkIsPortrait ( ImageFactory . getRGBData ( imageData )); } public boolean checkIsPortrait ( File file ) { return this . checkIsPortrait ( ImageFactory . getRGBData ( file )); } } #\u95ee\u9898\uff1a Caused by: java.lang.UnsatisfiedLinkError: D: \\g ongju \\r enlian \\h aha \\l ibs \\W IN64 \\l ibarcsoft_face.dll: Can ' t find dependent libraries \u89e3\u51b3\uff1a \u5b89\u88c5\u8d44\u6599\u4e2d\u7684\uff1avcredist_x64.exe\uff0c\u5373\u53ef\u89e3\u51b3\u3002 1.2.4\u3001\u6d4b\u8bd5 \u00b6 package com.tanhua.sso.service ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringJUnit4ClassRunner ; import java.io.File ; @SpringBootTest @RunWith ( SpringJUnit4ClassRunner . class ) public class TestFaceEngineService { @Autowired private FaceEngineService faceEngineService ; @Test public void testCheckIsPortrait (){ File file = new File ( \"F:\\\\1.jpg\" ); boolean checkIsPortrait = this . faceEngineService . checkIsPortrait ( file ); System . out . println ( checkIsPortrait ); // true|false } } 1.3\u3001\u5b9e\u73b0\u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f \u00b6 \u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f\u7684\u529f\u80fd\u5b9e\u73b0\uff0c\u5206\u4e3a2\u4e2a\u63a5\u53e3\u5b8c\u6210\uff0c\u5206\u522b\u662f\uff1a\u5b8c\u5584\u4e2a\u4eba\u8d44\u6599\u4fe1\u606f\u3001\u5934\u50cf\u4e0a\u4f20\u3002 mock\u63a5\u53e3\uff1a \u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f https://mock.boxuegu.com/project/164/interface/api/28553 \u4e0a\u4f20\u5934\u50cf https://mock.boxuegu.com/project/164/interface/api/39725 1.3.1\u3001UserInfoMapper \u00b6 package com.tanhua.sso.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.sso.pojo.UserInfo ; public interface UserInfoMapper extends BaseMapper < UserInfo > { } 1.3.2\u3001UserInfoService \u00b6 package com.tanhua.sso.service ; import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper ; import com.tanhua.sso.enums.SexEnum ; import com.tanhua.sso.mapper.UserInfoMapper ; import com.tanhua.sso.pojo.User ; import com.tanhua.sso.pojo.UserInfo ; import com.tanhua.sso.vo.PicUploadResult ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import org.springframework.web.multipart.MultipartFile ; import java.io.IOException ; import java.util.Map ; @Service public class UserInfoService { @Autowired private UserService userService ; @Autowired private UserInfoMapper userInfoMapper ; @Autowired private FaceEngineService faceEngineService ; @Autowired private PicUploadService picUploadService ; public Boolean saveUserInfo ( Map < String , String > param , String token ) { //\u6821\u9a8ctoken User user = this . userService . queryUserByToken ( token ); if ( null == user ) { return false ; } UserInfo userInfo = new UserInfo (); userInfo . setUserId ( user . getId ()); userInfo . setSex ( StringUtils . equalsIgnoreCase ( param . get ( \"gender\" ), \"man\" ) ? SexEnum . MAN : SexEnum . WOMAN ); userInfo . setNickName ( param . get ( \"nickname\" )); userInfo . setBirthday ( param . get ( \"birthday\" )); userInfo . setCity ( param . get ( \"city\" )); return this . userInfoMapper . insert ( userInfo ) == 1 ; } public Boolean saveUserLogo ( MultipartFile file , String token ) { //\u6821\u9a8ctoken User user = this . userService . queryUserByToken ( token ); if ( null == user ) { return false ; } try { //\u6821\u9a8c\u56fe\u7247\u662f\u5426\u662f\u4eba\u50cf\uff0c\u5982\u679c\u4e0d\u662f\u4eba\u50cf\u5c31\u8fd4\u56defalse boolean b = this . faceEngineService . checkIsPortrait ( file . getBytes ()); if ( ! b ) { return false ; } } catch ( IOException e ) { e . printStackTrace (); } //\u56fe\u7247\u4e0a\u4f20\u5230\u963f\u91cc\u4e91OSS PicUploadResult result = this . picUploadService . upload ( file ); if ( StringUtils . isEmpty ( result . getName ())) { //\u4e0a\u4f20\u5931\u8d25 return false ; } //\u628a\u5934\u50cf\u4fdd\u5b58\u5230\u7528\u6237\u4fe1\u606f\u8868\u4e2d UserInfo userInfo = new UserInfo (); userInfo . setLogo ( result . getName ()); QueryWrapper < UserInfo > queryWrapper = new QueryWrapper <> (); queryWrapper . eq ( \"user_id\" , user . getId ()); return this . userInfoMapper . update ( userInfo , queryWrapper ) == 1 ; } } 1.3.3\u3001UserInfoController \u00b6 package com.tanhua.sso.controller ; import com.tanhua.sso.service.UserInfoService ; import com.tanhua.sso.service.UserService ; import com.tanhua.sso.vo.ErrorResult ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.* ; import org.springframework.web.multipart.MultipartFile ; import java.util.HashMap ; import java.util.Map ; @RestController @RequestMapping ( \"user\" ) public class UserInfoController { @Autowired private UserInfoService userInfoService ; /** * \u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f-\u57fa\u672c\u4fe1\u606f * * @param param * @return */ @PostMapping ( \"loginReginfo\" ) public ResponseEntity < Object > saveUserInfo ( @RequestBody Map < String , String > param , @RequestHeader ( \"Authorization\" ) String token ) { try { Boolean bool = this . userInfoService . saveUserInfo ( param , token ); if ( bool ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } ErrorResult errorResult = ErrorResult . builder (). errCode ( \"000001\" ). errMessage ( \"\u4fdd\u5b58\u7528\u6237\u4fe1\u606f\u5931\u8d25\uff01\" ). build (); return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). body ( errorResult ); } /** * \u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f-\u7528\u6237\u5934\u50cf * * @return */ @PostMapping ( \"loginReginfo/head\" ) public ResponseEntity < Object > saveUserLogo ( @RequestParam ( \"headPhoto\" ) MultipartFile file , @RequestHeader ( \"Authorization\" ) String token ) { try { Boolean bool = this . userInfoService . saveUserLogo ( file , token ); if ( bool ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } ErrorResult errorResult = ErrorResult . builder (). errCode ( \"000001\" ). errMessage ( \"\u4fdd\u5b58\u7528\u6237logo\u5931\u8d25\uff01\" ). build (); return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). body ( errorResult ); } } 1.4.4\u3001\u6d4b\u8bd5 \u00b6 \u56fe\u7247\u4e0a\u4f20\u8d85\u8fc71MB\u51fa\u9519\u7684\u89e3\u51b3\u65b9\u6848\uff1a #\u5728application.properties\u6587\u4ef6\u4e2d\uff0c\u586b\u5165\u4e0b\u9762\u7684\u914d\u7f6e #\u8bbe\u7f6e\u6700\u5927\u7684\u6587\u4ef6\u4e0a\u4f20\u5927\u5c0f spring.servlet.multipart.max-request-size = 30MB spring.servlet.multipart.max-file-size = 30MB 2\u3001\u6821\u9a8ctoken \u00b6 \u5728\u6574\u4e2a\u7cfb\u7edf\u67b6\u6784\u4e2d\uff0c\u53ea\u6709SSO\u4fdd\u5b58\u4e86JWT\u4e2d\u7684\u79d8\u94a5\uff0c\u6240\u4ee5\u53ea\u80fd\u901a\u8fc7SSO\u7cfb\u7edf\u63d0\u4f9b\u7684\u63a5\u53e3\u670d\u52a1\u8fdb\u884c\u5bf9token\u7684\u6821\u9a8c\uff0c\u6240\u4ee5\u5728SSO\u7cfb\u7edf\u4e2d\uff0c\u9700\u8981\u5bf9\u5916\u5f00\u653e\u63a5\u53e3\uff0c\u901a\u8fc7token\u8fdb\u884c\u67e5\u8be2\u7528\u6237\u4fe1\u606f\uff0c\u5982\u679c\u8fd4\u56denull\u8bf4\u660e\u7528\u6237\u72b6\u6001\u5df2\u8fc7\u671f\u6216\u8005\u662f\u975e\u6cd5\u7684token\uff0c\u5426\u5219\u8fd4\u56deUser\u5bf9\u8c61\u6570\u636e\u3002 2.1\u3001UserController \u00b6 /** * \u6821\u9a8ctoken\uff0c\u6839\u636etoken\u67e5\u8be2\u7528\u6237\u6570\u636e * * @param token * @return */ @GetMapping ( \"{token}\" ) public User queryUserByToken ( @PathVariable ( \"token\" ) String token ) { return this . userService . queryUserByToken ( token ); } 2.2\u3001UserService \u00b6 public User queryUserByToken ( String token ) { try { // \u901a\u8fc7token\u89e3\u6790\u6570\u636e Map < String , Object > body = Jwts . parser () . setSigningKey ( secret ) . parseClaimsJws ( token ) . getBody (); User user = new User (); user . setId ( Long . valueOf ( body . get ( \"id\" ). toString ())); //\u9700\u8981\u8fd4\u56deuser\u5bf9\u8c61\u4e2d\u7684mobile\uff0c\u9700\u8981\u67e5\u8be2\u6570\u636e\u5e93\u83b7\u53d6\u5230mobile\u6570\u636e //\u5982\u679c\u6bcf\u6b21\u90fd\u67e5\u8be2\u6570\u636e\u5e93\uff0c\u5fc5\u7136\u4f1a\u5bfc\u81f4\u6027\u80fd\u95ee\u9898\uff0c\u9700\u8981\u5bf9\u7528\u6237\u7684\u624b\u673a\u53f7\u8fdb\u884c\u7f13\u5b58\u64cd\u4f5c //\u6570\u636e\u7f13\u5b58\u65f6\uff0c\u9700\u8981\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u8fc7\u671f\u65f6\u95f4\u8981\u4e0etoken\u7684\u65f6\u95f4\u4e00\u81f4 //\u5982\u679c\u7528\u6237\u4fee\u6539\u4e86\u624b\u673a\u53f7\uff0c\u9700\u8981\u540c\u6b65\u4fee\u6539redis\u4e2d\u7684\u6570\u636e String redisKey = \"TANHUA_USER_MOBILE_\" + user . getId (); if ( this . redisTemplate . hasKey ( redisKey )){ String mobile = this . redisTemplate . opsForValue (). get ( redisKey ); user . setMobile ( mobile ); } else { //\u67e5\u8be2\u6570\u636e\u5e93 User u = this . userMapper . selectById ( user . getId ()); user . setMobile ( u . getMobile ()); //\u5c06\u624b\u673a\u53f7\u5199\u5165\u5230redis\u4e2d //\u5728jwt\u4e2d\u7684\u8fc7\u671f\u65f6\u95f4\u7684\u5355\u4f4d\u4e3a\uff1a\u79d2 long timeout = Long . valueOf ( body . get ( \"exp\" ). toString ()) * 1000 - System . currentTimeMillis (); this . redisTemplate . opsForValue (). set ( redisKey , u . getMobile (), timeout , TimeUnit . MILLISECONDS ); } return user ; } catch ( ExpiredJwtException e ) { log . info ( \"token\u5df2\u7ecf\u8fc7\u671f\uff01 token = \" + token ); } catch ( Exception e ) { log . error ( \"token\u4e0d\u5408\u6cd5\uff01 token = \" + token , e ); } return null ; } 2.3\u3001\u6d4b\u8bd5 \u00b6 \u6570\u636e\u5df2\u7ecf\u5b58\u50a8\u5230redis\u4e2d\uff1a 3\u3001MongoDB\u5feb\u901f\u5165\u95e8 \u00b6 3.1\u3001MongoDB\u7b80\u4ecb \u00b6 MongoDB\u662f\u4e00\u4e2a\u57fa\u4e8e\u5206\u5e03\u5f0f\u6587\u4ef6\u5b58\u50a8\u7684\u6570\u636e\u5e93\u3002\u7531C++\u8bed\u8a00\u7f16\u5199\u3002\u65e8\u5728\u4e3aWEB\u5e94\u7528\u63d0\u4f9b\u53ef\u6269\u5c55\u7684\u9ad8\u6027\u80fd\u6570\u636e\u5b58\u50a8\u89e3\u51b3\u65b9\u6848\u3002 MongoDB\u662f\u4e00\u4e2a\u4ecb\u4e8e\u5173\u7cfb\u6570\u636e\u5e93\u548c\u975e\u5173\u7cfb\u6570\u636e\u5e93\u4e4b\u95f4\u7684\u4ea7\u54c1\uff0c\u662f\u975e\u5173\u7cfb\u6570\u636e\u5e93\u5f53\u4e2d\u529f\u80fd\u6700\u4e30\u5bcc\uff0c\u6700\u50cf\u5173\u7cfb\u6570\u636e\u5e93\u7684\uff0c\u5b83\u652f\u6301\u7684\u6570\u636e\u7ed3\u6784\u975e\u5e38\u677e\u6563\uff0c\u662f\u7c7b\u4f3cjson\u7684bson\u683c\u5f0f\uff0c\u56e0\u6b64\u53ef\u4ee5\u5b58\u50a8\u6bd4\u8f83\u590d\u6742\u7684\u6570\u636e\u7c7b\u578b\u3002 MongoDB\u6700\u5927\u7684\u7279\u70b9\u662f\u5b83\u652f\u6301\u7684\u67e5\u8be2\u8bed\u8a00\u975e\u5e38\u5f3a\u5927\uff0c\u5176\u8bed\u6cd5\u6709\u70b9\u7c7b\u4f3c\u4e8e\u9762\u5411\u5bf9\u8c61\u7684\u67e5\u8be2\u8bed\u8a00\uff0c\u51e0\u4e4e\u53ef\u4ee5\u5b9e\u73b0\u7c7b\u4f3c\u5173\u7cfb\u6570\u636e\u5e93\u5355\u8868\u67e5\u8be2\u7684\u7edd\u5927\u90e8\u5206\u529f\u80fd\uff0c\u800c\u4e14\u8fd8\u652f\u6301\u5bf9\u6570\u636e\u5efa\u7acb\u7d22\u5f15\u3002 \u5b98\u7f51\uff1ahttps://www.mongodb.com 3.2\u3001\u901a\u8fc7docker\u5b89\u88c5MongoDB \u00b6 #\u62c9\u53d6\u955c\u50cf docker pull mongo:4.0.3 #\u521b\u5efa\u5bb9\u5668 docker create --name mongodb-server -p 27018 :27017 -v mongodb-data:/data/db mongo:4.0.3 --auth #\u542f\u52a8\u5bb9\u5668 docker start mongodb-server #\u8fdb\u5165\u5bb9\u5668 docker exec -it mongodb-server /bin/bash #\u8fdb\u5165admin\u6570\u636e\u5e93 mongo use admin #\u6dfb\u52a0\u7ba1\u7406\u5458\uff0c\u5176\u62e5\u6709\u7ba1\u7406\u7528\u6237\u548c\u89d2\u8272\u7684\u6743\u9650 db.createUser ({ user: 'root' , pwd: 'root' , roles: [ { role: \"root\" , db: \"admin\" } ] }) #\u6d4b\u8bd5\uff0c\u53d1\u73b0\u662f\u6ca1\u6709\u6743\u9650\u64cd\u4f5c\u7684 > show dbs 2020 -10-20T09:09:15.543+0000 E QUERY [ js ] Error: listDatabases failed: { \"ok\" : 0 , \"errmsg\" : \"command listDatabases requires authentication\" , \"code\" : 13 , \"codeName\" : \"Unauthorized\" } : #\u8fdb\u884c\u8ba4\u8bc1 mongo -u \"root\" -p \"root\" --authenticationDatabase \"admin\" #\u901a\u8fc7admin\u6dfb\u52a0\u666e\u901a\u7528\u6237 use admin db.createUser ({ user: 'tanhua' , pwd: 'l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV' , roles: [ { role: \"readWrite\" , db: \"tanhua\" } ] }) ; #\u901a\u8fc7tanhua\u7528\u6237\u767b\u5f55\u8fdb\u884c\u6d4b\u8bd5 mongo -u \"tanhua\" -p \"l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV\" --authenticationDatabase \"admin\" #\u6d4b\u8bd5 root@5d848955ff7e:/# mongo -u \"tanhua\" -p \"tanhua123\" --authenticationDatabase \"admin\" MongoDB shell version v4.0.3 connecting to: mongodb://127.0.0.1:27017 Implicit session: session { \"id\" : UUID ( \"6c368269-30f0-4b29-a224-05a38b5847e2\" ) } MongoDB server version: 4 .0.3 > use tanhua switched to db tanhua > db.user.insert ({ id:1,username: 'zhangsan' ,age:20 }) WriteResult ({ \"nInserted\" : 1 }) > db.user.find () { \"_id\" : ObjectId ( \"5f8eb2726e0de0aa9517afd3\" ) , \"id\" : 1 , \"username\" : \"zhangsan\" , \"age\" : 20 } 3.3\u3001MongoDB\u57fa\u672c\u64cd\u4f5c \u00b6 3.3.1\u3001\u57fa\u672c\u6982\u5ff5 \u00b6 \u4e3a\u4e86\u66f4\u597d\u7684\u7406\u89e3\uff0c\u4e0b\u9762\u4e0eSQL\u4e2d\u7684\u6982\u5ff5\u8fdb\u884c\u5bf9\u6bd4\uff1a SQL\u672f\u8bed/\u6982\u5ff5 MongoDB\u672f\u8bed/\u6982\u5ff5 \u89e3\u91ca/\u8bf4\u660e database database \u6570\u636e\u5e93 table collection \u6570\u636e\u5e93\u8868/\u96c6\u5408 row document \u6570\u636e\u8bb0\u5f55\u884c/\u6587\u6863 column field \u6570\u636e\u5b57\u6bb5/\u57df index index \u7d22\u5f15 table joins \u8868\u8fde\u63a5,MongoDB\u4e0d\u652f\u6301 primary key primary key \u4e3b\u952e,MongoDB\u81ea\u52a8\u5c06_id\u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u4e3b\u952e 3.3.2\u3001\u6570\u636e\u5e93\u4ee5\u53ca\u8868\u7684\u64cd\u4f5c \u00b6 #\u67e5\u770b\u6240\u6709\u7684\u6570\u636e\u5e93 > show dbs admin 0 .000GB config 0 .000GB local 0 .000GB #\u901a\u8fc7use\u5173\u952e\u5b57\u5207\u6362\u6570\u636e\u5e93 > use admin switched to db admin #\u521b\u5efa\u6570\u636e\u5e93 #\u8bf4\u660e\uff1a\u5728MongoDB\u4e2d\uff0c\u6570\u636e\u5e93\u662f\u81ea\u52a8\u521b\u5efa\u7684\uff0c\u901a\u8fc7use\u5207\u6362\u5230\u65b0\u6570\u636e\u5e93\u4e2d\uff0c\u8fdb\u884c\u63d2\u5165\u6570\u636e\u5373\u53ef\u81ea\u52a8\u521b\u5efa\u6570\u636e\u5e93 > use testdb switched to db testdb > show dbs #\u5e76\u6ca1\u6709\u521b\u5efa\u6570\u636e\u5e93 admin 0 .000GB config 0 .000GB local 0 .000GB > db.user.insert ({ id:1,name: 'zhangsan' }) #\u63d2\u5165\u6570\u636e WriteResult ({ \"nInserted\" : 1 }) > show dbs admin 0 .000GB config 0 .000GB local 0 .000GB testdb 0 .000GB #\u6570\u636e\u5e93\u81ea\u52a8\u521b\u5efa #\u67e5\u770b\u8868 > show tables user > show collections user > #\u5220\u9664\u96c6\u5408\uff08\u8868\uff09 > db.user.drop () true #\u5982\u679c\u6210\u529f\u5220\u9664\u9009\u5b9a\u96c6\u5408\uff0c\u5219 drop() \u65b9\u6cd5\u8fd4\u56de true\uff0c\u5426\u5219\u8fd4\u56de false\u3002 #\u5220\u9664\u6570\u636e\u5e93 > use testdb #\u5148\u5207\u6362\u5230\u8981\u5220\u9664\u7684\u6570\u636e\u5e93\u4e2d switched to db testdb > db.dropDatabase () #\u5220\u9664\u6570\u636e\u5e93 { \"dropped\" : \"testdb\" , \"ok\" : 1 } > show dbs admin 0 .000GB config 0 .000GB local 0 .000GB 3.3.3\u3001\u65b0\u589e\u6570\u636e \u00b6 \u5728MongoDB\u4e2d\uff0c\u5b58\u50a8\u7684\u6587\u6863\u7ed3\u6784\u662f\u4e00\u79cd\u7c7b\u4f3c\u4e8ejson\u7684\u7ed3\u6784\uff0c\u79f0\u4e4b\u4e3abson\uff08\u5168\u79f0\u4e3a\uff1aBinary JSON\uff09\u3002 #\u63d2\u5165\u6570\u636e #\u8bed\u6cd5\uff1adb.COLLECTION_NAME.insert(document) > db.user.insert ({ id:1,username: 'zhangsan' ,age:20 }) WriteResult ({ \"nInserted\" : 1 }) > db.user.save ({ id:2,username: 'lisi' ,age:25 }) WriteResult ({ \"nInserted\" : 1 }) > db.user.find () #\u67e5\u8be2\u6570\u636e { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"id\" : 1 , \"username\" : \"zhangsan\" , \"age\" : 20 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 } 3.3.4\u3001\u66f4\u65b0\u6570\u636e \u00b6 update() \u65b9\u6cd5\u7528\u4e8e\u66f4\u65b0\u5df2\u5b58\u5728\u7684\u6587\u6863\u3002\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a db.collection.update ( <query>, <update>, [ upsert: <boolean>, multi: <boolean>, writeConcern: <document> ] ) \u53c2\u6570\u8bf4\u660e\uff1a query : update\u7684\u67e5\u8be2\u6761\u4ef6\uff0c\u7c7b\u4f3csql update\u67e5\u8be2\u5185where\u540e\u9762\u7684\u3002 update : update\u7684\u5bf9\u8c61\u548c\u4e00\u4e9b\u66f4\u65b0\u7684\u64cd\u4f5c\u7b26\uff08\u5982 , inc...\uff09\u7b49\uff0c\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3asql update\u67e5\u8be2\u5185set\u540e\u9762\u7684 upsert : \u53ef\u9009\uff0c\u8fd9\u4e2a\u53c2\u6570\u7684\u610f\u601d\u662f\uff0c\u5982\u679c\u4e0d\u5b58\u5728update\u7684\u8bb0\u5f55\uff0c\u662f\u5426\u63d2\u5165objNew,true\u4e3a\u63d2\u5165\uff0c\u9ed8\u8ba4\u662ffalse\uff0c\u4e0d\u63d2\u5165\u3002 multi : \u53ef\u9009\uff0cmongodb \u9ed8\u8ba4\u662ffalse,\u53ea\u66f4\u65b0\u627e\u5230\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u5982\u679c\u8fd9\u4e2a\u53c2\u6570\u4e3atrue,\u5c31\u628a\u6309\u6761\u4ef6\u67e5\u51fa\u6765\u591a\u6761\u8bb0\u5f55\u5168\u90e8\u66f4\u65b0\u3002 writeConcern :\u53ef\u9009\uff0c\u629b\u51fa\u5f02\u5e38\u7684\u7ea7\u522b\u3002 > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"id\" : 1 , \"username\" : \"zhangsan\" , \"age\" : 20 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 } > db.user.update ({ id:1 } , { $set : { age:22 }}) #\u66f4\u65b0\u6570\u636e WriteResult ({ \"nMatched\" : 1 , \"nUpserted\" : 0 , \"nModified\" : 1 }) > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"id\" : 1 , \"username\" : \"zhangsan\" , \"age\" : 22 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 } #\u6ce8\u610f\uff1a\u5982\u679c\u8fd9\u6837\u5199\uff0c\u4f1a\u5220\u9664\u6389\u5176\u4ed6\u7684\u5b57\u6bb5 > db.user.update ({ id:1 } , { age:25 }) WriteResult ({ \"nMatched\" : 1 , \"nUpserted\" : 0 , \"nModified\" : 1 }) > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"age\" : 25 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 } #\u66f4\u65b0\u4e0d\u5b58\u5728\u7684\u5b57\u6bb5\uff0c\u4f1a\u65b0\u589e\u5b57\u6bb5 > db.user.update ({ id:2 } , { $set : { sex:1 }}) #\u66f4\u65b0\u6570\u636e > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"age\" : 25 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 , \"sex\" : 1 } #\u66f4\u65b0\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u9ed8\u8ba4\u4e0d\u4f1a\u65b0\u589e\u6570\u636e > db.user.update ({ id:3 } , { $set : { sex:1 }}) WriteResult ({ \"nMatched\" : 0 , \"nUpserted\" : 0 , \"nModified\" : 0 }) > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"age\" : 25 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 , \"sex\" : 1 } #\u5982\u679c\u8bbe\u7f6e\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3atrue\uff0c\u5c31\u662f\u65b0\u589e\u6570\u636e > db.user.update ({ id:3 } , { $set : { sex:1 }} ,true ) WriteResult ({ \"nMatched\" : 0 , \"nUpserted\" : 1 , \"nModified\" : 0 , \"_id\" : ObjectId ( \"5c08cb281418d073246bc642\" ) }) > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"age\" : 25 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 , \"sex\" : 1 } { \"_id\" : ObjectId ( \"5c08cb281418d073246bc642\" ) , \"id\" : 3 , \"sex\" : 1 } 3.3.5\u3001\u5220\u9664\u6570\u636e \u00b6 \u901a\u8fc7remove()\u65b9\u6cd5\u8fdb\u884c\u5220\u9664\u6570\u636e\uff0c\u8bed\u6cd5\u5982\u4e0b\uff1a db.collection.remove ( <query>, { justOne: <boolean>, writeConcern: <document> } ) \u53c2\u6570\u8bf4\u660e\uff1a query :\uff08\u53ef\u9009\uff09\u5220\u9664\u7684\u6587\u6863\u7684\u6761\u4ef6\u3002 justOne : \uff08\u53ef\u9009\uff09\u5982\u679c\u8bbe\u4e3a true \u6216 1\uff0c\u5219\u53ea\u5220\u9664\u4e00\u4e2a\u6587\u6863\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\u8be5\u53c2\u6570\uff0c\u6216\u4f7f\u7528\u9ed8\u8ba4\u503c false\uff0c\u5219\u5220\u9664\u6240\u6709\u5339\u914d\u6761\u4ef6\u7684\u6587\u6863\u3002 writeConcern :\uff08\u53ef\u9009\uff09\u629b\u51fa\u5f02\u5e38\u7684\u7ea7\u522b\u3002 \u5b9e\u4f8b\uff1a > db.user.remove ({ age:25 }) WriteResult ({ \"nRemoved\" : 2 }) #\u5220\u9664\u4e862\u6761\u6570\u636e #\u63d2\u51654\u6761\u6d4b\u8bd5\u6570\u636e db.user.insert ({ id:1,username: 'zhangsan' ,age:20 }) db.user.insert ({ id:2,username: 'lisi' ,age:21 }) db.user.insert ({ id:3,username: 'wangwu' ,age:22 }) db.user.insert ({ id:4,username: 'zhaoliu' ,age:22 }) > db.user.remove ({ age:22 } ,true ) WriteResult ({ \"nRemoved\" : 1 }) #\u5220\u9664\u4e861\u6761\u6570\u636e #\u5220\u9664\u6240\u6709\u6570\u636e > db.user.remove ({}) #\u8bf4\u660e\uff1a\u4e3a\u4e86\u7b80\u5316\u64cd\u4f5c\uff0c\u5b98\u65b9\u63a8\u8350\u4f7f\u7528deleteOne()\u4e0edeleteMany()\u8fdb\u884c\u5220\u9664\u6570\u636e\u64cd\u4f5c\u3002 db.user.deleteOne ({ id:1 }) db.user.deleteMany ({}) #\u5220\u9664\u6240\u6709\u6570\u636e 3.3.6\u3001\u67e5\u8be2\u6570\u636e \u00b6 MongoDB \u67e5\u8be2\u6570\u636e\u7684\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a db . user . find ( [ query ] , [ fields ] ) query \uff1a\u53ef\u9009\uff0c\u4f7f\u7528\u67e5\u8be2\u64cd\u4f5c\u7b26\u6307\u5b9a\u67e5\u8be2\u6761\u4ef6 fields \uff1a\u53ef\u9009\uff0c\u4f7f\u7528\u6295\u5f71\u64cd\u4f5c\u7b26\u6307\u5b9a\u8fd4\u56de\u7684\u952e\u3002\u67e5\u8be2\u65f6\u8fd4\u56de\u6587\u6863\u4e2d\u6240\u6709\u952e\u503c\uff0c \u53ea\u9700\u7701\u7565\u8be5\u53c2\u6570\u5373\u53ef\uff08\u9ed8\u8ba4\u7701\u7565\uff09\u3002 \u5982\u679c\u4f60\u9700\u8981\u4ee5\u6613\u8bfb\u7684\u65b9\u5f0f\u6765\u8bfb\u53d6\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528 pretty() \u65b9\u6cd5\uff0c\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a >db.col.find().pretty() pretty() \u65b9\u6cd5\u4ee5\u683c\u5f0f\u5316\u7684\u65b9\u5f0f\u6765\u663e\u793a\u6240\u6709\u6587\u6863\u3002 \u6761\u4ef6\u67e5\u8be2\uff1a \u64cd\u4f5c \u683c\u5f0f \u8303\u4f8b RDBMS\u4e2d\u7684\u7c7b\u4f3c\u8bed\u53e5 \u7b49\u4e8e {<key>:<value> } db.col.find({\"by\":\"\u9ed1\u9a6c\u7a0b\u5e8f\u5458\"}).pretty() where by = '\u9ed1\u9a6c\u7a0b\u5e8f\u5458' \u5c0f\u4e8e {<key>:{$lt:<value>}} db.col.find({\"likes\":{$lt:50}}).pretty() where likes < 50 \u5c0f\u4e8e\u6216\u7b49\u4e8e {<key>:{$lte:<value>}} db.col.find({\"likes\":{$lte:50}}).pretty() where likes <= 50 \u5927\u4e8e {<key>:{$gt:<value>}} db.col.find({\"likes\":{$gt:50}}).pretty() where likes > 50 \u5927\u4e8e\u6216\u7b49\u4e8e {<key>:{$gte:<value>}} db.col.find({\"likes\":{$gte:50}}).pretty() where likes >= 50 \u4e0d\u7b49\u4e8e {<key>:{$ne:<value>}} db.col.find({\"likes\":{$ne:50}}).pretty() where likes != 50 \u5b9e\u4f8b\uff1a #\u63d2\u5165\u6d4b\u8bd5\u6570\u636e db.user.insert ({ id:1,username: 'zhangsan' ,age:20 }) db.user.insert ({ id:2,username: 'lisi' ,age:21 }) db.user.insert ({ id:3,username: 'wangwu' ,age:22 }) db.user.insert ({ id:4,username: 'zhaoliu' ,age:22 }) db.user.find () #\u67e5\u8be2\u5168\u90e8\u6570\u636e db.user.find ({} , { id:1,username:1 }) #\u53ea\u67e5\u8be2id\u4e0eusername\u5b57\u6bb5 db.user.find () .count () #\u67e5\u8be2\u6570\u636e\u6761\u6570 db.user.find ({ id:1 }) #\u67e5\u8be2id\u4e3a1\u7684\u6570\u636e db.user.find ({ age: { $lte :21 }}) #\u67e5\u8be2\u5c0f\u4e8e\u7b49\u4e8e21\u7684\u6570\u636e db.user.find ({ age: { $lte :21 } , id: { $gte :2 }}) #and\u67e5\u8be2\uff0cage\u5c0f\u4e8e\u7b49\u4e8e21\u5e76\u4e14id\u5927\u4e8e\u7b49\u4e8e2 db.user.find ({ $or : [{ id:1 } , { id:2 }]}) #\u67e5\u8be2id=1 or id=2 #\u5206\u9875\u67e5\u8be2\uff1aSkip()\u8df3\u8fc7\u51e0\u6761\uff0climit()\u67e5\u8be2\u6761\u6570 db.user.find () .limit ( 2 ) .skip ( 1 ) #\u8df3\u8fc71\u6761\u6570\u636e\uff0c\u67e5\u8be22\u6761\u6570\u636e db.user.find () .sort ({ id:-1 }) #\u6309\u7167age\u5012\u5e8f\u6392\u5e8f\uff0c-1\u4e3a\u5012\u5e8f\uff0c1\u4e3a\u6b63\u5e8f 3.4\u3001\u7d22\u5f15 \u00b6 \u7d22\u5f15\u901a\u5e38\u80fd\u591f\u6781\u5927\u7684\u63d0\u9ad8\u67e5\u8be2\u7684\u6548\u7387\uff0c\u5982\u679c\u6ca1\u6709\u7d22\u5f15\uff0cMongoDB\u5728\u8bfb\u53d6\u6570\u636e\u65f6\u5fc5\u987b\u626b\u63cf\u96c6\u5408\u4e2d\u7684\u6bcf\u4e2a\u6587\u4ef6\u5e76\u9009\u53d6\u90a3\u4e9b\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\u3002 \u8fd9\u79cd\u626b\u63cf\u5168\u96c6\u5408\u7684\u67e5\u8be2\u6548\u7387\u662f\u975e\u5e38\u4f4e\u7684\uff0c\u7279\u522b\u5728\u5904\u7406\u5927\u91cf\u7684\u6570\u636e\u65f6\uff0c\u67e5\u8be2\u53ef\u4ee5\u8981\u82b1\u8d39\u51e0\u5341\u79d2\u751a\u81f3\u51e0\u5206\u949f\uff0c\u8fd9\u5bf9\u7f51\u7ad9\u7684\u6027\u80fd\u662f\u975e\u5e38\u81f4\u547d\u7684\u3002 \u7d22\u5f15\u662f\u7279\u6b8a\u7684\u6570\u636e\u7ed3\u6784\uff0c\u7d22\u5f15\u5b58\u50a8\u5728\u4e00\u4e2a\u6613\u4e8e\u904d\u5386\u8bfb\u53d6\u7684\u6570\u636e\u96c6\u5408\u4e2d\uff0c\u7d22\u5f15\u662f\u5bf9\u6570\u636e\u5e93\u8868\u4e2d\u4e00\u5217\u6216\u591a\u5217\u7684\u503c\u8fdb\u884c\u6392\u5e8f\u7684\u4e00\u79cd\u7ed3\u6784 #\u67e5\u770b\u7d22\u5f15 > db.user.getIndexes () [ { \"v\" : 2 , \"key\" : { \"_id\" : 1 } , \"name\" : \"_id_\" , \"ns\" : \"testdb.user\" } ] #\u8bf4\u660e\uff1a1\u8868\u793a\u5347\u5e8f\u521b\u5efa\u7d22\u5f15\uff0c-1\u8868\u793a\u964d\u5e8f\u521b\u5efa\u7d22\u5f15\u3002 #\u521b\u5efa\u7d22\u5f15 > db.user.createIndex ({ 'age' :1 }) { \"createdCollectionAutomatically\" : false, \"numIndexesBefore\" : 1 , \"numIndexesAfter\" : 2 , \"ok\" : 1 } #\u5220\u9664\u7d22\u5f15 db.user.dropIndex ( \"age_1\" ) #\u6216\u8005\uff0c\u5220\u9664\u9664\u4e86_id\u4e4b\u5916\u7684\u7d22\u5f15 db.user.dropIndexes () #\u521b\u5efa\u8054\u5408\u7d22\u5f15 db.user.createIndex ({ 'age' :1, 'id' :-1 }) #\u67e5\u770b\u7d22\u5f15\u5927\u5c0f\uff0c\u5355\u4f4d\uff1a\u5b57\u8282 db.user.totalIndexSize () 3.5\u3001\u6267\u884c\u8ba1\u5212 \u00b6 MongoDB \u67e5\u8be2\u5206\u6790\u53ef\u4ee5\u786e\u4fdd\u6211\u4eec\u5efa\u8bae\u7684\u7d22\u5f15\u662f\u5426\u6709\u6548\uff0c\u662f\u67e5\u8be2\u8bed\u53e5\u6027\u80fd\u5206\u6790\u7684\u91cd\u8981\u5de5\u5177\u3002 #\u63d2\u51651000\u6761\u6570\u636e for ( var i = 1 ; i< 1000 ; i++ ) db.user.insert ({ id:100+i,username: 'name_' +i,age:10+i }) #\u67e5\u770b\u6267\u884c\u8ba1\u5212 > db.user.find ({ age: { $gt :100 } ,id: { $lt :200 }}) .explain () { \"queryPlanner\" : { \"plannerVersion\" : 1 , \"namespace\" : \"testdb.user\" , \"indexFilterSet\" : false, \"parsedQuery\" : { \" $and \" : [ { \"id\" : { \" $lt \" : 200 } } , { \"age\" : { \" $gt \" : 100 } } ] } , \"winningPlan\" : { #\u6700\u4f73\u6267\u884c\u8ba1\u5212 \"stage\" : \"FETCH\" , #\u67e5\u8be2\u65b9\u5f0f\uff0c\u5e38\u89c1\u7684\u6709COLLSCAN/\u5168\u8868\u626b\u63cf\u3001IXSCAN/\u7d22\u5f15\u626b\u63cf\u3001FETCH/\u6839\u636e\u7d22\u5f15\u53bb\u68c0\u7d22\u6587\u6863\u3001SHARD_MERGE/\u5408\u5e76\u5206\u7247\u7ed3\u679c\u3001IDHACK/\u9488\u5bf9_id\u8fdb\u884c\u67e5\u8be2 \"inputStage\" : { \"stage\" : \"IXSCAN\" , \"keyPattern\" : { \"age\" : 1 , \"id\" : -1 } , \"indexName\" : \"age_1_id_-1\" , \"isMultiKey\" : false, \"multiKeyPaths\" : { \"age\" : [ ] , \"id\" : [ ] } , \"isUnique\" : false, \"isSparse\" : false, \"isPartial\" : false, \"indexVersion\" : 2 , \"direction\" : \"forward\" , \"indexBounds\" : { \"age\" : [ \"(100.0, inf.0]\" ] , \"id\" : [ \"(200.0, -inf.0]\" ] } } } , \"rejectedPlans\" : [ ] } , \"serverInfo\" : { \"host\" : \"c493d5ff750a\" , \"port\" : 27017 , \"version\" : \"4.0.3\" , \"gitVersion\" : \"7ea530946fa7880364d88c8d8b6026bbc9ffa48c\" } , \"ok\" : 1 } #\u6d4b\u8bd5\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15 > db.user.find ({ username: 'zhangsan' }) .explain () { \"queryPlanner\" : { \"plannerVersion\" : 1 , \"namespace\" : \"testdb.user\" , \"indexFilterSet\" : false, \"parsedQuery\" : { \"username\" : { \" $eq \" : \"zhangsan\" } } , \"winningPlan\" : { \"stage\" : \"COLLSCAN\" , #\u5168\u8868\u626b\u63cf \"filter\" : { \"username\" : { \" $eq \" : \"zhangsan\" } } , \"direction\" : \"forward\" } , \"rejectedPlans\" : [ ] } , \"serverInfo\" : { \"host\" : \"c493d5ff750a\" , \"port\" : 27017 , \"version\" : \"4.0.3\" , \"gitVersion\" : \"7ea530946fa7880364d88c8d8b6026bbc9ffa48c\" } , \"ok\" : 1 } 3.6\u3001UI\u5ba2\u6237\u7aef\u5de5\u5177 \u00b6 Robo 3T\u662fMongoDB\u7684\u5ba2\u6237\u7aef\u5de5\u5177\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u64cd\u4f5cMongoDB\u3002 \u67e5\u770b\u6570\u636e\uff1a \u6216\u4f7f\u7528Navicat Premium 15\uff1a 4\u3001SpringBoot\u6574\u5408MongoDB \u00b6 spring-data\u5bf9MongoDB\u505a\u4e86\u652f\u6301\uff0c\u4f7f\u7528spring-data-mongodb\u53ef\u4ee5\u7b80\u5316MongoDB\u7684\u64cd\u4f5c\u3002 \u5730\u5740\uff1ahttps://spring.io/projects/spring-data-mongodb 4.1\u3001\u5bfc\u5165\u4f9d\u8d56 \u00b6 <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <modelVersion> 4.0.0 </modelVersion> <parent> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-parent </artifactId> <version> 2.1.0.RELEASE </version> </parent> <groupId> cn.itcast.mongodb </groupId> <artifactId> itcast-mongodb </artifactId> <version> 1.0-SNAPSHOT </version> <dependencies> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-mongodb </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-test </artifactId> <scope> test </scope> </dependency> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> <optional> true </optional> <version> 1.18.4 </version> </dependency> </dependencies> <build> <plugins> <!-- java\u7f16\u8bd1\u63d2\u4ef6 --> <plugin> <groupId> org.apache.maven.plugins </groupId> <artifactId> maven-compiler-plugin </artifactId> <version> 3.2 </version> <configuration> <source> 1.8 </source> <target> 1.8 </target> <encoding> UTF-8 </encoding> </configuration> </plugin> </plugins> </build> </project> 4.2\u3001\u7f16\u5199application.properties\u914d\u7f6e\u6587\u4ef6 \u00b6 # Spring boot application spring.application.name = itcast-mongodb #\u65e0\u8ba4\u8bc1\u4fe1\u606f\u7684\u914d\u7f6e #spring.data.mongodb.uri=mongodb://192.168.31.81:27017/tanhua #springboot \u914d\u7f6e spring.data.mongodb.username = tanhua spring.data.mongodb.password = l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV spring.data.mongodb.authentication-database = admin spring.data.mongodb.database = tanhua spring.data.mongodb.port = 27018 spring.data.mongodb.host = 192.168.31.81 4.3\u3001\u7f16\u5199\u5b9e\u4f53 \u00b6 package cn.itcast.mongodb.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; @Data @AllArgsConstructor @NoArgsConstructor public class Person { private ObjectId id ; private String name ; private int age ; private Address address ; } package cn.itcast.mongodb.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @AllArgsConstructor @NoArgsConstructor public class Address { private String street ; private String city ; private String zip ; } 4.4\u3001\u7f16\u5199dao \u00b6 package cn.itcast.mongodb.dao ; import cn.itcast.mongodb.pojo.Person ; import com.mongodb.client.result.DeleteResult ; import com.mongodb.client.result.UpdateResult ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; import org.springframework.data.mongodb.core.query.Update ; import org.springframework.stereotype.Component ; import java.util.List ; @Component public class PersonDao { @Autowired private MongoTemplate mongoTemplate ; public void savePerson ( Person person ) { this . mongoTemplate . save ( person ); } public List < Person > queryPersonListByName ( String name ) { Query query = Query . query ( Criteria . where ( \"name\" ). is ( name )); return this . mongoTemplate . find ( query , Person . class ); } public List < Person > queryPersonPageList ( Integer page , Integer rows ) { Query query = new Query (). limit ( rows ). skip (( page - 1 ) * rows ); return this . mongoTemplate . find ( query , Person . class ); } public UpdateResult update ( Person person ) { Query query = Query . query ( Criteria . where ( \"id\" ). is ( person . getId ())); Update update = Update . update ( \"age\" , person . getAge ()); return this . mongoTemplate . updateFirst ( query , update , Person . class ); } public DeleteResult deleteById ( String id ) { Query query = Query . query ( Criteria . where ( \"id\" ). is ( id )); return this . mongoTemplate . remove ( query , Person . class ); } } 4.5\u3001\u7f16\u5199\u542f\u52a8\u7c7b \u00b6 package cn.itcast.mongodb ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; @SpringBootApplication public class MongoApplication { public static void main ( String [] args ) { SpringApplication . run ( MongoApplication . class , args ); } } 4.6\u3001\u7f16\u5199\u5355\u5143\u6d4b\u8bd5 \u00b6 package cn.itcast.mongodb ; import cn.itcast.mongodb.dao.PersonDao ; import cn.itcast.mongodb.pojo.Address ; import cn.itcast.mongodb.pojo.Person ; import org.bson.types.ObjectId ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; import java.util.List ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestPersonDao { @Autowired private PersonDao personDao ; @Test public void testSave () { Person person = new Person ( ObjectId . get (), \"\u5f20\u4e09\" , 20 , new Address ( \"\u4eba\u6c11\u8def\" , \"\u4e0a\u6d77\u5e02\" , \"666666\" )); this . personDao . savePerson ( person ); } @Test public void testQuery () { List < Person > personList = this . personDao . queryPersonListByName ( \"\u5f20\u4e09\" ); for ( Person person : personList ) { System . out . println ( person ); } } @Test public void testQuery2 () { List < Person > personList = this . personDao . queryPersonPageList ( 2 , 2 ); for ( Person person : personList ) { System . out . println ( person ); } } @Test public void testUpdate () { Person person = new Person (); person . setId ( new ObjectId ( \"5c0956ce235e192520086736\" )); person . setAge ( 30 ); this . personDao . update ( person ); } @Test public void testDelete () { this . personDao . deleteById ( \"5c09ca05235e192d8887a389\" ); } }","title":"day02"},{"location":"tantan/day02/#_1","text":"\u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f \u963f\u91cc\u4e91OSS\u670d\u52a1\u5e94\u7528 \u4eba\u8138\u8bc6\u522b MongoDB\u5feb\u901f\u5165\u95e8 SpringBoot\u6574\u5408MongoDB","title":"\u8bfe\u7a0b\u4ecb\u7ecd"},{"location":"tantan/day02/#1","text":"\u7528\u6237\u5728\u9996\u6b21\u767b\u5f55\u65f6\u9700\u8981\u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f\uff0c\u5305\u62ec\u6027\u522b\u3001\u6635\u79f0\u3001\u751f\u65e5\u3001\u57ce\u5e02\u3001\u5934\u50cf\u7b49\u3002 \u5176\u4e2d\uff0c\u5934\u50cf\u6570\u636e\u9700\u8981\u505a\u56fe\u7247\u4e0a\u4f20\uff0c\u8fd9\u91cc\u91c7\u7528\u963f\u91cc\u4e91\u7684OSS\u670d\u52a1\u4f5c\u4e3a\u6211\u4eec\u7684\u56fe\u7247\u670d\u52a1\u5668\uff0c\u5e76\u4e14\u5bf9\u5934\u50cf\u8981\u505a\u4eba\u8138\u8bc6\u522b\uff0c\u975e\u4eba\u8138\u7167\u7247\u4e0d\u5f97\u4e0a\u4f20\u3002","title":"1\u3001\u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f"},{"location":"tantan/day02/#11","text":"","title":"1.1\u3001\u56fe\u7247\u4e0a\u4f20"},{"location":"tantan/day02/#111","text":"\u5b9e\u73b0\u56fe\u7247\u4e0a\u4f20\u670d\u52a1\uff0c\u9700\u8981\u6709\u5b58\u50a8\u7684\u652f\u6301\uff0c\u90a3\u4e48\u6211\u4eec\u7684\u89e3\u51b3\u65b9\u6848\u5c06\u4ee5\u4e0b\u51e0\u79cd\uff1a \u76f4\u63a5\u5c06\u56fe\u7247\u4fdd\u5b58\u5230\u670d\u52a1\u7684\u786c\u76d8 \u4f18\u70b9\uff1a\u5f00\u53d1\u4fbf\u6377\uff0c\u6210\u672c\u4f4e \u7f3a\u70b9\uff1a\u6269\u5bb9\u56f0\u96be \u4f7f\u7528\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u8fdb\u884c\u5b58\u50a8 \u4f18\u70b9\uff1a\u5bb9\u6613\u5b9e\u73b0\u6269\u5bb9 \u7f3a\u70b9\uff1a\u5f00\u53d1\u590d\u6742\u5ea6\u7a0d\u5927\uff08\u6709\u6210\u719f\u7684\u4ea7\u54c1\u53ef\u4ee5\u4f7f\u7528\uff0c\u6bd4\u5982\uff1aFastDFS\uff09 \u4f7f\u7528nfs\u505a\u5b58\u50a8 \u4f18\u70b9\uff1a\u5f00\u53d1\u8f83\u4e3a\u4fbf\u6377 \u7f3a\u70b9\uff1a\u9700\u8981\u6709\u4e00\u5b9a\u7684\u8fd0\u7ef4\u77e5\u8bc6\u8fdb\u884c\u90e8\u7f72\u548c\u7ef4\u62a4 \u4f7f\u7528\u7b2c\u4e09\u65b9\u7684\u5b58\u50a8\u670d\u52a1 \u4f18\u70b9\uff1a\u5f00\u53d1\u7b80\u5355\uff0c\u62e5\u6709\u5f3a\u5927\u529f\u80fd\uff0c\u514d\u7ef4\u62a4 \u7f3a\u70b9\uff1a\u4ed8\u8d39 \u5728\u672c\u5957\u8bfe\u7a0b\u4e2d\u9009\u7528\u963f\u91cc\u4e91\u7684OSS\u670d\u52a1\u8fdb\u884c\u56fe\u7247\u5b58\u50a8\u3002","title":"1.1.1\u3001\u56fe\u7247\u5b58\u50a8\u89e3\u51b3\u65b9\u6848"},{"location":"tantan/day02/#112oss","text":"\u6d41\u7a0b\uff1a","title":"1.1.2\u3001\u963f\u91cc\u4e91OSS\u5b58\u50a8"},{"location":"tantan/day02/#1121oss","text":"\u5730\u5740\uff1ahttps://www.aliyun.com/product/oss","title":"1.1.2.1\u3001\u4ec0\u4e48\u662fOSS\u670d\u52a1\uff1f"},{"location":"tantan/day02/#1122","text":"\u4f7f\u7528\u7b2c\u4e09\u65b9\u670d\u52a1\u6700\u5927\u7684\u7f3a\u70b9\u5c31\u662f\u9700\u8981\u4ed8\u8d39\uff0c\u4e0b\u9762\uff0c\u6211\u4eec\u770b\u4e0b\u5982\u4f55\u8d2d\u4e70\u5f00\u901a\u670d\u52a1\u3002 \u8d2d\u4e70\u4e0b\u884c\u6d41\u91cf\u5305\uff1a \uff08\u4e0d\u8d2d\u4e70\u4e5f\u53ef\u4ee5\u4f7f\u7528\uff0c\u6309\u7167\u6d41\u91cf\u4ed8\u8d39\uff09 \u8bf4\u660e\uff1aOSS\u7684\u4e0a\u884c\u6d41\u91cf\u662f\u514d\u8d39\u7684\uff0c\u4f46\u662f\u4e0b\u884c\u6d41\u91cf\u662f\u9700\u8981\u8d2d\u4e70\u7684\u3002","title":"1.1.2.2\u3001\u8d2d\u4e70\u670d\u52a1"},{"location":"tantan/day02/#1123bucket","text":"\u4f7f\u7528OSS\uff0c\u9996\u5148\u9700\u8981\u521b\u5efaBucket\uff0cBucket\u7ffb\u8bd1\u6210\u4e2d\u6587\u662f\u6c34\u6876\u7684\u610f\u601d\uff0c\u628a\u5b58\u50a8\u7684\u56fe\u7247\u8d44\u6e90\u770b\u505a\u662f\u6c34\uff0c\u60f3\u8981\u76db\u6c34\u5fc5\u987b\u5f97\u6709\u6876\uff0c\u5c31\u662f\u8fd9\u4e2a\u610f\u601d\u4e86\u3002 \u8fdb\u5165\u63a7\u5236\u53f0\uff0chttps://oss.console.aliyun.com/overview \u9009\u62e9Bucket\u540e\uff0c\u5373\u53ef\u770b\u5230\u5bf9\u5e94\u7684\u4fe1\u606f\uff0c\u5982\uff1aurl\u3001\u6d88\u8017\u6d41\u91cf\u7b49 : \u6587\u4ef6\u7ba1\u7406\uff1a \u67e5\u770b\u6587\u4ef6\uff1a","title":"1.1.2.3\u3001\u521b\u5efaBucket"},{"location":"tantan/day02/#1124","text":"\u521b\u5efa\u7528\u6237\u7684\u65b9\u5f0f\u4e0e\u77ed\u4fe1\u63a5\u53e3\u4e2d\u7684\u65b9\u5f0f\u4e00\u6837\uff0c\u9700\u8981\u8bbe\u7f6eoss\u6743\u9650\u3002","title":"1.1.2.4\u3001\u521b\u5efa\u7528\u6237"},{"location":"tantan/day02/#113","text":"<dependency> <groupId> com.aliyun.oss </groupId> <artifactId> aliyun-sdk-oss </artifactId> <version> 2.8.3 </version> </dependency>","title":"1.1.3\u3001\u5bfc\u5165\u4f9d\u8d56"},{"location":"tantan/day02/#114oss","text":"aliyun.properties\uff1a aliyun.endpoint = http://oss-cn-zhangjiakou.aliyuncs.com aliyun.accessKeyId = *********** aliyun.accessKeySecret = *************** aliyun.bucketName = tanhua-dev aliyun.urlPrefix = http://tanhua-dev.oss-cn-zhangjiakou.aliyuncs.com/ AliyunConfig\uff1a package com.tanhua.sso.config ; import com.aliyun.oss.OSSClient ; import lombok.Data ; import org.springframework.boot.context.properties.ConfigurationProperties ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; import org.springframework.context.annotation.PropertySource ; @Configuration @PropertySource ( \"classpath:aliyun.properties\" ) @ConfigurationProperties ( prefix = \"aliyun\" ) @Data public class AliyunConfig { private String endpoint ; private String accessKeyId ; private String accessKeySecret ; private String bucketName ; private String urlPrefix ; @Bean public OSSClient oSSClient () { return new OSSClient ( endpoint , accessKeyId , accessKeySecret ); } }","title":"1.1.4\u3001OSS\u914d\u7f6e"},{"location":"tantan/day02/#115picuploadservice","text":"package com.tanhua.sso.service ; import com.aliyun.oss.OSSClient ; import com.tanhua.sso.config.AliyunConfig ; import com.tanhua.sso.vo.PicUploadResult ; import org.apache.commons.lang3.RandomUtils ; import org.apache.commons.lang3.StringUtils ; import org.joda.time.DateTime ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import org.springframework.web.multipart.MultipartFile ; import java.io.ByteArrayInputStream ; @Service public class PicUploadService { // \u5141\u8bb8\u4e0a\u4f20\u7684\u683c\u5f0f private static final String [] IMAGE_TYPE = new String [] { \".bmp\" , \".jpg\" , \".jpeg\" , \".gif\" , \".png\" }; @Autowired private OSSClient ossClient ; @Autowired private AliyunConfig aliyunConfig ; public PicUploadResult upload ( MultipartFile uploadFile ) { PicUploadResult fileUploadResult = new PicUploadResult (); //\u56fe\u7247\u505a\u6821\u9a8c\uff0c\u5bf9\u540e\u7f00\u540d boolean isLegal = false ; for ( String type : IMAGE_TYPE ) { if ( StringUtils . endsWithIgnoreCase ( uploadFile . getOriginalFilename (), type )) { isLegal = true ; break ; } } if ( ! isLegal ) { fileUploadResult . setStatus ( \"error\" ); return fileUploadResult ; } // \u6587\u4ef6\u65b0\u8def\u5f84 String fileName = uploadFile . getOriginalFilename (); String filePath = getFilePath ( fileName ); // \u4e0a\u4f20\u5230\u963f\u91cc\u4e91 try { // \u76ee\u5f55\u7ed3\u6784\uff1aimages/2018/12/29/xxxx.jpg ossClient . putObject ( aliyunConfig . getBucketName (), filePath , new ByteArrayInputStream ( uploadFile . getBytes ())); } catch ( Exception e ) { e . printStackTrace (); //\u4e0a\u4f20\u5931\u8d25 fileUploadResult . setStatus ( \"error\" ); return fileUploadResult ; } // \u4e0a\u4f20\u6210\u529f fileUploadResult . setStatus ( \"done\" ); fileUploadResult . setName ( this . aliyunConfig . getUrlPrefix () + filePath ); fileUploadResult . setUid ( String . valueOf ( System . currentTimeMillis ())); return fileUploadResult ; } private String getFilePath ( String sourceFileName ) { DateTime dateTime = new DateTime (); return \"images/\" + dateTime . toString ( \"yyyy\" ) + \"/\" + dateTime . toString ( \"MM\" ) + \"/\" + dateTime . toString ( \"dd\" ) + \"/\" + System . currentTimeMillis () + RandomUtils . nextInt ( 100 , 9999 ) + \".\" + StringUtils . substringAfterLast ( sourceFileName , \".\" ); } } \u6240\u9700\u5176\u4ed6\u7684\u4ee3\u7801\uff1a PicUploadResult: package com.tanhua.sso.vo ; import lombok.Data ; @Data public class PicUploadResult { // \u6587\u4ef6\u552f\u4e00\u6807\u8bc6 private String uid ; // \u6587\u4ef6\u540d private String name ; // \u72b6\u6001\u6709\uff1auploading done error removed private String status ; // \u670d\u52a1\u7aef\u54cd\u5e94\u5185\u5bb9\uff0c\u5982\uff1a'{\"status\": \"success\"}' private String response ; }","title":"1.1.5\u3001PicUploadService"},{"location":"tantan/day02/#116picuploadcontroller","text":"package com.tanhua.sso.controller ; import com.tanhua.sso.service.PicUploadService ; import com.tanhua.sso.vo.PicUploadResult ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Controller ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RequestParam ; import org.springframework.web.bind.annotation.ResponseBody ; import org.springframework.web.multipart.MultipartFile ; @RequestMapping ( \"pic/upload\" ) @Controller public class PicUploadController { @Autowired private PicUploadService picUploadService ; @PostMapping @ResponseBody public PicUploadResult upload ( @RequestParam ( \"file\" ) MultipartFile multipartFile ) { return this . picUploadService . upload ( multipartFile ); } }","title":"1.1.6\u3001PicUploadController"},{"location":"tantan/day02/#117","text":"","title":"1.1.7\u3001\u6d4b\u8bd5"},{"location":"tantan/day02/#12","text":"\u4eba\u8138\u8bc6\u522b\u6280\u672f\u91c7\u7528\u8679\u8f6f\u5f00\u653e\u5e73\u53f0\u5b9e\u73b0\uff08\u514d\u8d39\u4f7f\u7528\uff09\u3002\u5b98\u7f51\uff1ahttps://www.arcsoft.com.cn/","title":"1.2\u3001\u4eba\u8138\u8bc6\u522b"},{"location":"tantan/day02/#121","text":"\u4f7f\u7528\u8679\u8f6f\u5e73\u53f0\u9700\u8981\u5148\u6ce8\u518c\u5f00\u53d1\u8005\u8d26\u53f7\uff1ahttps://ai.arcsoft.com.cn/ucenter/user/userlogin \u6ce8\u518c\u5b8c\u6210\u540e\u8fdb\u884c\u767b\u5f55\uff0c\u7136\u540e\u8fdb\u884c\u521b\u5efa\u5e94\u7528\uff1a \u521b\u5efa\u5b8c\u6210\u540e\uff0c\u9700\u8981\u8fdb\u884c\u5b9e\u540d\u8ba4\u8bc1\uff0c\u5426\u5219\u76f8\u5173\u7684SDK\u662f\u4e0d\u80fd\u4f7f\u7528\u7684\u3002 \u5b9e\u540d\u8ba4\u8bc1\u540e\u5373\u53ef\u4e0b\u8f7d\u5bf9\u5e94\u5e73\u53f0\u7684SDk\uff0c\u6211\u4eec\u9700\u8981\u4e0b\u8f7dwindows\u4ee5\u53calinux\u5e73\u53f0\u3002 \u6dfb\u52a0SDK\uff08Linux\u4e0eWindows\u5e73\u53f0\uff09\uff1a \u4e0b\u8f7dSDK\uff0c\u6253\u5f00\u89e3\u538b\u5305\uff0c\u53ef\u4ee5\u770b\u5230\u6709\u63d0\u4f9b\u76f8\u5e94\u7684jar\u5305\u4ee5\u53ca\u793a\u4f8b\u4ee3\u7801\uff1a \u9700\u8981\u7279\u522b\u8bf4\u660e\u7684\u662f\uff1a\u6bcf\u4e2a\u8d26\u53f7\u7684SDK\u5305\u4e0d\u901a\u7528\uff0c\u6240\u4ee5\u81ea\u5df1\u8981\u4e0b\u8f7d\u81ea\u5df1\u7684SDK\u5305\u3002","title":"1.2.1\u3001\u4f7f\u7528\u8bf4\u660e"},{"location":"tantan/day02/#122jar","text":"\u8fdb\u5165\u5230libs\u76ee\u5f55\uff0c\u9700\u8981\u5c06arcsoft-sdk-face-3.0.0.0.jar\u5b89\u88c5\u5230\u672c\u5730\u4ed3\u5e93\uff1a mvn install:install-file -DgroupId = com.arcsoft.face -DartifactId = arcsoft-sdk-face -Dversion = 3 .0.0.0 -Dpackaging = jar -Dfile = arcsoft-sdk-face-3.0.0.0.jar \u5b89\u88c5\u6210\u529f\u540e\uff0c\u5373\u53ef\u901a\u8fc7maven\u5750\u6807\u5f15\u7528\u4e86\uff1a <dependency> <groupId> com.arcsoft.face </groupId> <artifactId> arcsoft-sdk-face </artifactId> <version> 3.0.0.0 </version> <!--<scope>system</scope>--> <!--\u5982\u679c\u6ca1\u6709\u5b89\u88c5\u5230\u672c\u5730\u4ed3\u5e93\uff0c\u53ef\u4ee5\u5c06jar\u5305\u62f7\u8d1d\u5230\u5de5\u7a0b\u7684lib\u4e0b\u9762\u4e0b\uff0c\u76f4\u63a5\u5f15\u7528--> <!--<systemPath>${project.basedir}/lib/arcsoft-sdk-face-3.0.0.0.jar</systemPath>--> </dependency>","title":"1.2.2\u3001\u5b89\u88c5jar\u5230\u672c\u5730\u4ed3\u5e93"},{"location":"tantan/day02/#123","text":"\u8bf4\u660e\uff1a\u8679\u8f6f\u7684SDK\u662f\u514d\u8d39\u4f7f\u7528\u7684\uff0c\u4f46\u662f\u9996\u6b21\u4f7f\u7528\u65f6\u9700\u8981\u8054\u7f51\u6fc0\u6d3b\uff0c\u6fc0\u6d3b\u540e\u53ef\u79bb\u7ebf\u4f7f\u7528\u3002\u4f7f\u7528\u5468\u671f\u4e3a1\u5e74\uff0c1\u5e74\u540e\u9700\u8981\u8054\u7f51\u518d\u6b21\u6fc0\u6d3b\u3002 \u4e2a\u4eba\u514d\u8d39\u6fc0\u6d3bSDK\u603b\u6570\u91cf\u4e3a100\u3002 \u914d\u7f6e\uff1aapplication.properties #\u8679\u8f6f\u76f8\u5173\u914d\u7f6e(\u5728\u8679\u8f6f\u5e94\u7528\u4e2d\u627e\u5230\u5bf9\u5e94\u7684\u53c2\u6570) arcsoft.appid = ****************** arcsoft.sdkKey = ***************** arcsoft.libPath = F:\\\\code\\\\WIN64 FaceEngineService\uff1a package com.tanhua.sso.service ; import com.arcsoft.face.EngineConfiguration ; import com.arcsoft.face.FaceEngine ; import com.arcsoft.face.FaceInfo ; import com.arcsoft.face.FunctionConfiguration ; import com.arcsoft.face.enums.DetectMode ; import com.arcsoft.face.enums.DetectOrient ; import com.arcsoft.face.enums.ErrorInfo ; import com.arcsoft.face.enums.ImageFormat ; import com.arcsoft.face.toolkit.ImageFactory ; import com.arcsoft.face.toolkit.ImageInfo ; import org.slf4j.Logger ; import org.slf4j.LoggerFactory ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.stereotype.Service ; import javax.annotation.PostConstruct ; import java.io.File ; import java.util.ArrayList ; import java.util.List ; @Service public class FaceEngineService { private static final Logger LOGGER = LoggerFactory . getLogger ( FaceEngineService . class ); @Value ( \"${arcsoft.appid}\" ) private String appid ; @Value ( \"${arcsoft.sdkKey}\" ) private String sdkKey ; @Value ( \"${arcsoft.libPath}\" ) private String libPath ; private FaceEngine faceEngine ; @PostConstruct public void init () { // \u6fc0\u6d3b\u5e76\u4e14\u521d\u59cb\u5316\u5f15\u64ce FaceEngine faceEngine = new FaceEngine ( libPath ); int activeCode = faceEngine . activeOnline ( appid , sdkKey ); if ( activeCode != ErrorInfo . MOK . getValue () && activeCode != ErrorInfo . MERR_ASF_ALREADY_ACTIVATED . getValue ()) { LOGGER . error ( \"\u5f15\u64ce\u6fc0\u6d3b\u5931\u8d25\" ); throw new RuntimeException ( \"\u5f15\u64ce\u6fc0\u6d3b\u5931\u8d25\" ); } //\u5f15\u64ce\u914d\u7f6e EngineConfiguration engineConfiguration = new EngineConfiguration (); //IMAGE\u68c0\u6d4b\u6a21\u5f0f\uff0c\u7528\u4e8e\u5904\u7406\u5355\u5f20\u7684\u56fe\u50cf\u6570\u636e engineConfiguration . setDetectMode ( DetectMode . ASF_DETECT_MODE_IMAGE ); //\u4eba\u8138\u68c0\u6d4b\u89d2\u5ea6\uff0c\u5168\u89d2\u5ea6 engineConfiguration . setDetectFaceOrientPriority ( DetectOrient . ASF_OP_ALL_OUT ); //\u529f\u80fd\u914d\u7f6e FunctionConfiguration functionConfiguration = new FunctionConfiguration (); functionConfiguration . setSupportAge ( true ); functionConfiguration . setSupportFace3dAngle ( true ); functionConfiguration . setSupportFaceDetect ( true ); functionConfiguration . setSupportFaceRecognition ( true ); functionConfiguration . setSupportGender ( true ); functionConfiguration . setSupportLiveness ( true ); functionConfiguration . setSupportIRLiveness ( true ); engineConfiguration . setFunctionConfiguration ( functionConfiguration ); //\u521d\u59cb\u5316\u5f15\u64ce int initCode = faceEngine . init ( engineConfiguration ); if ( initCode != ErrorInfo . MOK . getValue ()) { LOGGER . error ( \"\u521d\u59cb\u5316\u5f15\u64ce\u51fa\u9519!\" ); throw new RuntimeException ( \"\u521d\u59cb\u5316\u5f15\u64ce\u51fa\u9519!\" ); } this . faceEngine = faceEngine ; } /** * \u68c0\u6d4b\u56fe\u7247\u662f\u5426\u4e3a\u4eba\u50cf * * @param imageInfo \u56fe\u50cf\u5bf9\u8c61 * @return true:\u4eba\u50cf\uff0cfalse:\u975e\u4eba\u50cf */ public boolean checkIsPortrait ( ImageInfo imageInfo ) { // \u5b9a\u4e49\u4eba\u8138\u5217\u8868 List < FaceInfo > faceInfoList = new ArrayList < FaceInfo > (); faceEngine . detectFaces ( imageInfo . getImageData (), imageInfo . getWidth (), imageInfo . getHeight (), ImageFormat . CP_PAF_BGR24 , faceInfoList ); return ! faceInfoList . isEmpty (); } public boolean checkIsPortrait ( byte [] imageData ) { return this . checkIsPortrait ( ImageFactory . getRGBData ( imageData )); } public boolean checkIsPortrait ( File file ) { return this . checkIsPortrait ( ImageFactory . getRGBData ( file )); } } #\u95ee\u9898\uff1a Caused by: java.lang.UnsatisfiedLinkError: D: \\g ongju \\r enlian \\h aha \\l ibs \\W IN64 \\l ibarcsoft_face.dll: Can ' t find dependent libraries \u89e3\u51b3\uff1a \u5b89\u88c5\u8d44\u6599\u4e2d\u7684\uff1avcredist_x64.exe\uff0c\u5373\u53ef\u89e3\u51b3\u3002","title":"1.2.3\u3001\u5f00\u59cb\u4f7f\u7528"},{"location":"tantan/day02/#124","text":"package com.tanhua.sso.service ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringJUnit4ClassRunner ; import java.io.File ; @SpringBootTest @RunWith ( SpringJUnit4ClassRunner . class ) public class TestFaceEngineService { @Autowired private FaceEngineService faceEngineService ; @Test public void testCheckIsPortrait (){ File file = new File ( \"F:\\\\1.jpg\" ); boolean checkIsPortrait = this . faceEngineService . checkIsPortrait ( file ); System . out . println ( checkIsPortrait ); // true|false } }","title":"1.2.4\u3001\u6d4b\u8bd5"},{"location":"tantan/day02/#13","text":"\u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f\u7684\u529f\u80fd\u5b9e\u73b0\uff0c\u5206\u4e3a2\u4e2a\u63a5\u53e3\u5b8c\u6210\uff0c\u5206\u522b\u662f\uff1a\u5b8c\u5584\u4e2a\u4eba\u8d44\u6599\u4fe1\u606f\u3001\u5934\u50cf\u4e0a\u4f20\u3002 mock\u63a5\u53e3\uff1a \u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f https://mock.boxuegu.com/project/164/interface/api/28553 \u4e0a\u4f20\u5934\u50cf https://mock.boxuegu.com/project/164/interface/api/39725","title":"1.3\u3001\u5b9e\u73b0\u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f"},{"location":"tantan/day02/#131userinfomapper","text":"package com.tanhua.sso.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.sso.pojo.UserInfo ; public interface UserInfoMapper extends BaseMapper < UserInfo > { }","title":"1.3.1\u3001UserInfoMapper"},{"location":"tantan/day02/#132userinfoservice","text":"package com.tanhua.sso.service ; import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper ; import com.tanhua.sso.enums.SexEnum ; import com.tanhua.sso.mapper.UserInfoMapper ; import com.tanhua.sso.pojo.User ; import com.tanhua.sso.pojo.UserInfo ; import com.tanhua.sso.vo.PicUploadResult ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import org.springframework.web.multipart.MultipartFile ; import java.io.IOException ; import java.util.Map ; @Service public class UserInfoService { @Autowired private UserService userService ; @Autowired private UserInfoMapper userInfoMapper ; @Autowired private FaceEngineService faceEngineService ; @Autowired private PicUploadService picUploadService ; public Boolean saveUserInfo ( Map < String , String > param , String token ) { //\u6821\u9a8ctoken User user = this . userService . queryUserByToken ( token ); if ( null == user ) { return false ; } UserInfo userInfo = new UserInfo (); userInfo . setUserId ( user . getId ()); userInfo . setSex ( StringUtils . equalsIgnoreCase ( param . get ( \"gender\" ), \"man\" ) ? SexEnum . MAN : SexEnum . WOMAN ); userInfo . setNickName ( param . get ( \"nickname\" )); userInfo . setBirthday ( param . get ( \"birthday\" )); userInfo . setCity ( param . get ( \"city\" )); return this . userInfoMapper . insert ( userInfo ) == 1 ; } public Boolean saveUserLogo ( MultipartFile file , String token ) { //\u6821\u9a8ctoken User user = this . userService . queryUserByToken ( token ); if ( null == user ) { return false ; } try { //\u6821\u9a8c\u56fe\u7247\u662f\u5426\u662f\u4eba\u50cf\uff0c\u5982\u679c\u4e0d\u662f\u4eba\u50cf\u5c31\u8fd4\u56defalse boolean b = this . faceEngineService . checkIsPortrait ( file . getBytes ()); if ( ! b ) { return false ; } } catch ( IOException e ) { e . printStackTrace (); } //\u56fe\u7247\u4e0a\u4f20\u5230\u963f\u91cc\u4e91OSS PicUploadResult result = this . picUploadService . upload ( file ); if ( StringUtils . isEmpty ( result . getName ())) { //\u4e0a\u4f20\u5931\u8d25 return false ; } //\u628a\u5934\u50cf\u4fdd\u5b58\u5230\u7528\u6237\u4fe1\u606f\u8868\u4e2d UserInfo userInfo = new UserInfo (); userInfo . setLogo ( result . getName ()); QueryWrapper < UserInfo > queryWrapper = new QueryWrapper <> (); queryWrapper . eq ( \"user_id\" , user . getId ()); return this . userInfoMapper . update ( userInfo , queryWrapper ) == 1 ; } }","title":"1.3.2\u3001UserInfoService"},{"location":"tantan/day02/#133userinfocontroller","text":"package com.tanhua.sso.controller ; import com.tanhua.sso.service.UserInfoService ; import com.tanhua.sso.service.UserService ; import com.tanhua.sso.vo.ErrorResult ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.* ; import org.springframework.web.multipart.MultipartFile ; import java.util.HashMap ; import java.util.Map ; @RestController @RequestMapping ( \"user\" ) public class UserInfoController { @Autowired private UserInfoService userInfoService ; /** * \u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f-\u57fa\u672c\u4fe1\u606f * * @param param * @return */ @PostMapping ( \"loginReginfo\" ) public ResponseEntity < Object > saveUserInfo ( @RequestBody Map < String , String > param , @RequestHeader ( \"Authorization\" ) String token ) { try { Boolean bool = this . userInfoService . saveUserInfo ( param , token ); if ( bool ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } ErrorResult errorResult = ErrorResult . builder (). errCode ( \"000001\" ). errMessage ( \"\u4fdd\u5b58\u7528\u6237\u4fe1\u606f\u5931\u8d25\uff01\" ). build (); return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). body ( errorResult ); } /** * \u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f-\u7528\u6237\u5934\u50cf * * @return */ @PostMapping ( \"loginReginfo/head\" ) public ResponseEntity < Object > saveUserLogo ( @RequestParam ( \"headPhoto\" ) MultipartFile file , @RequestHeader ( \"Authorization\" ) String token ) { try { Boolean bool = this . userInfoService . saveUserLogo ( file , token ); if ( bool ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } ErrorResult errorResult = ErrorResult . builder (). errCode ( \"000001\" ). errMessage ( \"\u4fdd\u5b58\u7528\u6237logo\u5931\u8d25\uff01\" ). build (); return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). body ( errorResult ); } }","title":"1.3.3\u3001UserInfoController"},{"location":"tantan/day02/#144","text":"\u56fe\u7247\u4e0a\u4f20\u8d85\u8fc71MB\u51fa\u9519\u7684\u89e3\u51b3\u65b9\u6848\uff1a #\u5728application.properties\u6587\u4ef6\u4e2d\uff0c\u586b\u5165\u4e0b\u9762\u7684\u914d\u7f6e #\u8bbe\u7f6e\u6700\u5927\u7684\u6587\u4ef6\u4e0a\u4f20\u5927\u5c0f spring.servlet.multipart.max-request-size = 30MB spring.servlet.multipart.max-file-size = 30MB","title":"1.4.4\u3001\u6d4b\u8bd5"},{"location":"tantan/day02/#2token","text":"\u5728\u6574\u4e2a\u7cfb\u7edf\u67b6\u6784\u4e2d\uff0c\u53ea\u6709SSO\u4fdd\u5b58\u4e86JWT\u4e2d\u7684\u79d8\u94a5\uff0c\u6240\u4ee5\u53ea\u80fd\u901a\u8fc7SSO\u7cfb\u7edf\u63d0\u4f9b\u7684\u63a5\u53e3\u670d\u52a1\u8fdb\u884c\u5bf9token\u7684\u6821\u9a8c\uff0c\u6240\u4ee5\u5728SSO\u7cfb\u7edf\u4e2d\uff0c\u9700\u8981\u5bf9\u5916\u5f00\u653e\u63a5\u53e3\uff0c\u901a\u8fc7token\u8fdb\u884c\u67e5\u8be2\u7528\u6237\u4fe1\u606f\uff0c\u5982\u679c\u8fd4\u56denull\u8bf4\u660e\u7528\u6237\u72b6\u6001\u5df2\u8fc7\u671f\u6216\u8005\u662f\u975e\u6cd5\u7684token\uff0c\u5426\u5219\u8fd4\u56deUser\u5bf9\u8c61\u6570\u636e\u3002","title":"2\u3001\u6821\u9a8ctoken"},{"location":"tantan/day02/#21usercontroller","text":"/** * \u6821\u9a8ctoken\uff0c\u6839\u636etoken\u67e5\u8be2\u7528\u6237\u6570\u636e * * @param token * @return */ @GetMapping ( \"{token}\" ) public User queryUserByToken ( @PathVariable ( \"token\" ) String token ) { return this . userService . queryUserByToken ( token ); }","title":"2.1\u3001UserController"},{"location":"tantan/day02/#22userservice","text":"public User queryUserByToken ( String token ) { try { // \u901a\u8fc7token\u89e3\u6790\u6570\u636e Map < String , Object > body = Jwts . parser () . setSigningKey ( secret ) . parseClaimsJws ( token ) . getBody (); User user = new User (); user . setId ( Long . valueOf ( body . get ( \"id\" ). toString ())); //\u9700\u8981\u8fd4\u56deuser\u5bf9\u8c61\u4e2d\u7684mobile\uff0c\u9700\u8981\u67e5\u8be2\u6570\u636e\u5e93\u83b7\u53d6\u5230mobile\u6570\u636e //\u5982\u679c\u6bcf\u6b21\u90fd\u67e5\u8be2\u6570\u636e\u5e93\uff0c\u5fc5\u7136\u4f1a\u5bfc\u81f4\u6027\u80fd\u95ee\u9898\uff0c\u9700\u8981\u5bf9\u7528\u6237\u7684\u624b\u673a\u53f7\u8fdb\u884c\u7f13\u5b58\u64cd\u4f5c //\u6570\u636e\u7f13\u5b58\u65f6\uff0c\u9700\u8981\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u8fc7\u671f\u65f6\u95f4\u8981\u4e0etoken\u7684\u65f6\u95f4\u4e00\u81f4 //\u5982\u679c\u7528\u6237\u4fee\u6539\u4e86\u624b\u673a\u53f7\uff0c\u9700\u8981\u540c\u6b65\u4fee\u6539redis\u4e2d\u7684\u6570\u636e String redisKey = \"TANHUA_USER_MOBILE_\" + user . getId (); if ( this . redisTemplate . hasKey ( redisKey )){ String mobile = this . redisTemplate . opsForValue (). get ( redisKey ); user . setMobile ( mobile ); } else { //\u67e5\u8be2\u6570\u636e\u5e93 User u = this . userMapper . selectById ( user . getId ()); user . setMobile ( u . getMobile ()); //\u5c06\u624b\u673a\u53f7\u5199\u5165\u5230redis\u4e2d //\u5728jwt\u4e2d\u7684\u8fc7\u671f\u65f6\u95f4\u7684\u5355\u4f4d\u4e3a\uff1a\u79d2 long timeout = Long . valueOf ( body . get ( \"exp\" ). toString ()) * 1000 - System . currentTimeMillis (); this . redisTemplate . opsForValue (). set ( redisKey , u . getMobile (), timeout , TimeUnit . MILLISECONDS ); } return user ; } catch ( ExpiredJwtException e ) { log . info ( \"token\u5df2\u7ecf\u8fc7\u671f\uff01 token = \" + token ); } catch ( Exception e ) { log . error ( \"token\u4e0d\u5408\u6cd5\uff01 token = \" + token , e ); } return null ; }","title":"2.2\u3001UserService"},{"location":"tantan/day02/#23","text":"\u6570\u636e\u5df2\u7ecf\u5b58\u50a8\u5230redis\u4e2d\uff1a","title":"2.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day02/#3mongodb","text":"","title":"3\u3001MongoDB\u5feb\u901f\u5165\u95e8"},{"location":"tantan/day02/#31mongodb","text":"MongoDB\u662f\u4e00\u4e2a\u57fa\u4e8e\u5206\u5e03\u5f0f\u6587\u4ef6\u5b58\u50a8\u7684\u6570\u636e\u5e93\u3002\u7531C++\u8bed\u8a00\u7f16\u5199\u3002\u65e8\u5728\u4e3aWEB\u5e94\u7528\u63d0\u4f9b\u53ef\u6269\u5c55\u7684\u9ad8\u6027\u80fd\u6570\u636e\u5b58\u50a8\u89e3\u51b3\u65b9\u6848\u3002 MongoDB\u662f\u4e00\u4e2a\u4ecb\u4e8e\u5173\u7cfb\u6570\u636e\u5e93\u548c\u975e\u5173\u7cfb\u6570\u636e\u5e93\u4e4b\u95f4\u7684\u4ea7\u54c1\uff0c\u662f\u975e\u5173\u7cfb\u6570\u636e\u5e93\u5f53\u4e2d\u529f\u80fd\u6700\u4e30\u5bcc\uff0c\u6700\u50cf\u5173\u7cfb\u6570\u636e\u5e93\u7684\uff0c\u5b83\u652f\u6301\u7684\u6570\u636e\u7ed3\u6784\u975e\u5e38\u677e\u6563\uff0c\u662f\u7c7b\u4f3cjson\u7684bson\u683c\u5f0f\uff0c\u56e0\u6b64\u53ef\u4ee5\u5b58\u50a8\u6bd4\u8f83\u590d\u6742\u7684\u6570\u636e\u7c7b\u578b\u3002 MongoDB\u6700\u5927\u7684\u7279\u70b9\u662f\u5b83\u652f\u6301\u7684\u67e5\u8be2\u8bed\u8a00\u975e\u5e38\u5f3a\u5927\uff0c\u5176\u8bed\u6cd5\u6709\u70b9\u7c7b\u4f3c\u4e8e\u9762\u5411\u5bf9\u8c61\u7684\u67e5\u8be2\u8bed\u8a00\uff0c\u51e0\u4e4e\u53ef\u4ee5\u5b9e\u73b0\u7c7b\u4f3c\u5173\u7cfb\u6570\u636e\u5e93\u5355\u8868\u67e5\u8be2\u7684\u7edd\u5927\u90e8\u5206\u529f\u80fd\uff0c\u800c\u4e14\u8fd8\u652f\u6301\u5bf9\u6570\u636e\u5efa\u7acb\u7d22\u5f15\u3002 \u5b98\u7f51\uff1ahttps://www.mongodb.com","title":"3.1\u3001MongoDB\u7b80\u4ecb"},{"location":"tantan/day02/#32dockermongodb","text":"#\u62c9\u53d6\u955c\u50cf docker pull mongo:4.0.3 #\u521b\u5efa\u5bb9\u5668 docker create --name mongodb-server -p 27018 :27017 -v mongodb-data:/data/db mongo:4.0.3 --auth #\u542f\u52a8\u5bb9\u5668 docker start mongodb-server #\u8fdb\u5165\u5bb9\u5668 docker exec -it mongodb-server /bin/bash #\u8fdb\u5165admin\u6570\u636e\u5e93 mongo use admin #\u6dfb\u52a0\u7ba1\u7406\u5458\uff0c\u5176\u62e5\u6709\u7ba1\u7406\u7528\u6237\u548c\u89d2\u8272\u7684\u6743\u9650 db.createUser ({ user: 'root' , pwd: 'root' , roles: [ { role: \"root\" , db: \"admin\" } ] }) #\u6d4b\u8bd5\uff0c\u53d1\u73b0\u662f\u6ca1\u6709\u6743\u9650\u64cd\u4f5c\u7684 > show dbs 2020 -10-20T09:09:15.543+0000 E QUERY [ js ] Error: listDatabases failed: { \"ok\" : 0 , \"errmsg\" : \"command listDatabases requires authentication\" , \"code\" : 13 , \"codeName\" : \"Unauthorized\" } : #\u8fdb\u884c\u8ba4\u8bc1 mongo -u \"root\" -p \"root\" --authenticationDatabase \"admin\" #\u901a\u8fc7admin\u6dfb\u52a0\u666e\u901a\u7528\u6237 use admin db.createUser ({ user: 'tanhua' , pwd: 'l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV' , roles: [ { role: \"readWrite\" , db: \"tanhua\" } ] }) ; #\u901a\u8fc7tanhua\u7528\u6237\u767b\u5f55\u8fdb\u884c\u6d4b\u8bd5 mongo -u \"tanhua\" -p \"l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV\" --authenticationDatabase \"admin\" #\u6d4b\u8bd5 root@5d848955ff7e:/# mongo -u \"tanhua\" -p \"tanhua123\" --authenticationDatabase \"admin\" MongoDB shell version v4.0.3 connecting to: mongodb://127.0.0.1:27017 Implicit session: session { \"id\" : UUID ( \"6c368269-30f0-4b29-a224-05a38b5847e2\" ) } MongoDB server version: 4 .0.3 > use tanhua switched to db tanhua > db.user.insert ({ id:1,username: 'zhangsan' ,age:20 }) WriteResult ({ \"nInserted\" : 1 }) > db.user.find () { \"_id\" : ObjectId ( \"5f8eb2726e0de0aa9517afd3\" ) , \"id\" : 1 , \"username\" : \"zhangsan\" , \"age\" : 20 }","title":"3.2\u3001\u901a\u8fc7docker\u5b89\u88c5MongoDB"},{"location":"tantan/day02/#33mongodb","text":"","title":"3.3\u3001MongoDB\u57fa\u672c\u64cd\u4f5c"},{"location":"tantan/day02/#331","text":"\u4e3a\u4e86\u66f4\u597d\u7684\u7406\u89e3\uff0c\u4e0b\u9762\u4e0eSQL\u4e2d\u7684\u6982\u5ff5\u8fdb\u884c\u5bf9\u6bd4\uff1a SQL\u672f\u8bed/\u6982\u5ff5 MongoDB\u672f\u8bed/\u6982\u5ff5 \u89e3\u91ca/\u8bf4\u660e database database \u6570\u636e\u5e93 table collection \u6570\u636e\u5e93\u8868/\u96c6\u5408 row document \u6570\u636e\u8bb0\u5f55\u884c/\u6587\u6863 column field \u6570\u636e\u5b57\u6bb5/\u57df index index \u7d22\u5f15 table joins \u8868\u8fde\u63a5,MongoDB\u4e0d\u652f\u6301 primary key primary key \u4e3b\u952e,MongoDB\u81ea\u52a8\u5c06_id\u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u4e3b\u952e","title":"3.3.1\u3001\u57fa\u672c\u6982\u5ff5"},{"location":"tantan/day02/#332","text":"#\u67e5\u770b\u6240\u6709\u7684\u6570\u636e\u5e93 > show dbs admin 0 .000GB config 0 .000GB local 0 .000GB #\u901a\u8fc7use\u5173\u952e\u5b57\u5207\u6362\u6570\u636e\u5e93 > use admin switched to db admin #\u521b\u5efa\u6570\u636e\u5e93 #\u8bf4\u660e\uff1a\u5728MongoDB\u4e2d\uff0c\u6570\u636e\u5e93\u662f\u81ea\u52a8\u521b\u5efa\u7684\uff0c\u901a\u8fc7use\u5207\u6362\u5230\u65b0\u6570\u636e\u5e93\u4e2d\uff0c\u8fdb\u884c\u63d2\u5165\u6570\u636e\u5373\u53ef\u81ea\u52a8\u521b\u5efa\u6570\u636e\u5e93 > use testdb switched to db testdb > show dbs #\u5e76\u6ca1\u6709\u521b\u5efa\u6570\u636e\u5e93 admin 0 .000GB config 0 .000GB local 0 .000GB > db.user.insert ({ id:1,name: 'zhangsan' }) #\u63d2\u5165\u6570\u636e WriteResult ({ \"nInserted\" : 1 }) > show dbs admin 0 .000GB config 0 .000GB local 0 .000GB testdb 0 .000GB #\u6570\u636e\u5e93\u81ea\u52a8\u521b\u5efa #\u67e5\u770b\u8868 > show tables user > show collections user > #\u5220\u9664\u96c6\u5408\uff08\u8868\uff09 > db.user.drop () true #\u5982\u679c\u6210\u529f\u5220\u9664\u9009\u5b9a\u96c6\u5408\uff0c\u5219 drop() \u65b9\u6cd5\u8fd4\u56de true\uff0c\u5426\u5219\u8fd4\u56de false\u3002 #\u5220\u9664\u6570\u636e\u5e93 > use testdb #\u5148\u5207\u6362\u5230\u8981\u5220\u9664\u7684\u6570\u636e\u5e93\u4e2d switched to db testdb > db.dropDatabase () #\u5220\u9664\u6570\u636e\u5e93 { \"dropped\" : \"testdb\" , \"ok\" : 1 } > show dbs admin 0 .000GB config 0 .000GB local 0 .000GB","title":"3.3.2\u3001\u6570\u636e\u5e93\u4ee5\u53ca\u8868\u7684\u64cd\u4f5c"},{"location":"tantan/day02/#333","text":"\u5728MongoDB\u4e2d\uff0c\u5b58\u50a8\u7684\u6587\u6863\u7ed3\u6784\u662f\u4e00\u79cd\u7c7b\u4f3c\u4e8ejson\u7684\u7ed3\u6784\uff0c\u79f0\u4e4b\u4e3abson\uff08\u5168\u79f0\u4e3a\uff1aBinary JSON\uff09\u3002 #\u63d2\u5165\u6570\u636e #\u8bed\u6cd5\uff1adb.COLLECTION_NAME.insert(document) > db.user.insert ({ id:1,username: 'zhangsan' ,age:20 }) WriteResult ({ \"nInserted\" : 1 }) > db.user.save ({ id:2,username: 'lisi' ,age:25 }) WriteResult ({ \"nInserted\" : 1 }) > db.user.find () #\u67e5\u8be2\u6570\u636e { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"id\" : 1 , \"username\" : \"zhangsan\" , \"age\" : 20 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 }","title":"3.3.3\u3001\u65b0\u589e\u6570\u636e"},{"location":"tantan/day02/#334","text":"update() \u65b9\u6cd5\u7528\u4e8e\u66f4\u65b0\u5df2\u5b58\u5728\u7684\u6587\u6863\u3002\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a db.collection.update ( <query>, <update>, [ upsert: <boolean>, multi: <boolean>, writeConcern: <document> ] ) \u53c2\u6570\u8bf4\u660e\uff1a query : update\u7684\u67e5\u8be2\u6761\u4ef6\uff0c\u7c7b\u4f3csql update\u67e5\u8be2\u5185where\u540e\u9762\u7684\u3002 update : update\u7684\u5bf9\u8c61\u548c\u4e00\u4e9b\u66f4\u65b0\u7684\u64cd\u4f5c\u7b26\uff08\u5982 , inc...\uff09\u7b49\uff0c\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3asql update\u67e5\u8be2\u5185set\u540e\u9762\u7684 upsert : \u53ef\u9009\uff0c\u8fd9\u4e2a\u53c2\u6570\u7684\u610f\u601d\u662f\uff0c\u5982\u679c\u4e0d\u5b58\u5728update\u7684\u8bb0\u5f55\uff0c\u662f\u5426\u63d2\u5165objNew,true\u4e3a\u63d2\u5165\uff0c\u9ed8\u8ba4\u662ffalse\uff0c\u4e0d\u63d2\u5165\u3002 multi : \u53ef\u9009\uff0cmongodb \u9ed8\u8ba4\u662ffalse,\u53ea\u66f4\u65b0\u627e\u5230\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u5982\u679c\u8fd9\u4e2a\u53c2\u6570\u4e3atrue,\u5c31\u628a\u6309\u6761\u4ef6\u67e5\u51fa\u6765\u591a\u6761\u8bb0\u5f55\u5168\u90e8\u66f4\u65b0\u3002 writeConcern :\u53ef\u9009\uff0c\u629b\u51fa\u5f02\u5e38\u7684\u7ea7\u522b\u3002 > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"id\" : 1 , \"username\" : \"zhangsan\" , \"age\" : 20 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 } > db.user.update ({ id:1 } , { $set : { age:22 }}) #\u66f4\u65b0\u6570\u636e WriteResult ({ \"nMatched\" : 1 , \"nUpserted\" : 0 , \"nModified\" : 1 }) > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"id\" : 1 , \"username\" : \"zhangsan\" , \"age\" : 22 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 } #\u6ce8\u610f\uff1a\u5982\u679c\u8fd9\u6837\u5199\uff0c\u4f1a\u5220\u9664\u6389\u5176\u4ed6\u7684\u5b57\u6bb5 > db.user.update ({ id:1 } , { age:25 }) WriteResult ({ \"nMatched\" : 1 , \"nUpserted\" : 0 , \"nModified\" : 1 }) > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"age\" : 25 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 } #\u66f4\u65b0\u4e0d\u5b58\u5728\u7684\u5b57\u6bb5\uff0c\u4f1a\u65b0\u589e\u5b57\u6bb5 > db.user.update ({ id:2 } , { $set : { sex:1 }}) #\u66f4\u65b0\u6570\u636e > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"age\" : 25 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 , \"sex\" : 1 } #\u66f4\u65b0\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u9ed8\u8ba4\u4e0d\u4f1a\u65b0\u589e\u6570\u636e > db.user.update ({ id:3 } , { $set : { sex:1 }}) WriteResult ({ \"nMatched\" : 0 , \"nUpserted\" : 0 , \"nModified\" : 0 }) > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"age\" : 25 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 , \"sex\" : 1 } #\u5982\u679c\u8bbe\u7f6e\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3atrue\uff0c\u5c31\u662f\u65b0\u589e\u6570\u636e > db.user.update ({ id:3 } , { $set : { sex:1 }} ,true ) WriteResult ({ \"nMatched\" : 0 , \"nUpserted\" : 1 , \"nModified\" : 0 , \"_id\" : ObjectId ( \"5c08cb281418d073246bc642\" ) }) > db.user.find () { \"_id\" : ObjectId ( \"5c08c0024b318926e0c1f6dc\" ) , \"age\" : 25 } { \"_id\" : ObjectId ( \"5c08c0134b318926e0c1f6dd\" ) , \"id\" : 2 , \"username\" : \"lisi\" , \"age\" : 25 , \"sex\" : 1 } { \"_id\" : ObjectId ( \"5c08cb281418d073246bc642\" ) , \"id\" : 3 , \"sex\" : 1 }","title":"3.3.4\u3001\u66f4\u65b0\u6570\u636e"},{"location":"tantan/day02/#335","text":"\u901a\u8fc7remove()\u65b9\u6cd5\u8fdb\u884c\u5220\u9664\u6570\u636e\uff0c\u8bed\u6cd5\u5982\u4e0b\uff1a db.collection.remove ( <query>, { justOne: <boolean>, writeConcern: <document> } ) \u53c2\u6570\u8bf4\u660e\uff1a query :\uff08\u53ef\u9009\uff09\u5220\u9664\u7684\u6587\u6863\u7684\u6761\u4ef6\u3002 justOne : \uff08\u53ef\u9009\uff09\u5982\u679c\u8bbe\u4e3a true \u6216 1\uff0c\u5219\u53ea\u5220\u9664\u4e00\u4e2a\u6587\u6863\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\u8be5\u53c2\u6570\uff0c\u6216\u4f7f\u7528\u9ed8\u8ba4\u503c false\uff0c\u5219\u5220\u9664\u6240\u6709\u5339\u914d\u6761\u4ef6\u7684\u6587\u6863\u3002 writeConcern :\uff08\u53ef\u9009\uff09\u629b\u51fa\u5f02\u5e38\u7684\u7ea7\u522b\u3002 \u5b9e\u4f8b\uff1a > db.user.remove ({ age:25 }) WriteResult ({ \"nRemoved\" : 2 }) #\u5220\u9664\u4e862\u6761\u6570\u636e #\u63d2\u51654\u6761\u6d4b\u8bd5\u6570\u636e db.user.insert ({ id:1,username: 'zhangsan' ,age:20 }) db.user.insert ({ id:2,username: 'lisi' ,age:21 }) db.user.insert ({ id:3,username: 'wangwu' ,age:22 }) db.user.insert ({ id:4,username: 'zhaoliu' ,age:22 }) > db.user.remove ({ age:22 } ,true ) WriteResult ({ \"nRemoved\" : 1 }) #\u5220\u9664\u4e861\u6761\u6570\u636e #\u5220\u9664\u6240\u6709\u6570\u636e > db.user.remove ({}) #\u8bf4\u660e\uff1a\u4e3a\u4e86\u7b80\u5316\u64cd\u4f5c\uff0c\u5b98\u65b9\u63a8\u8350\u4f7f\u7528deleteOne()\u4e0edeleteMany()\u8fdb\u884c\u5220\u9664\u6570\u636e\u64cd\u4f5c\u3002 db.user.deleteOne ({ id:1 }) db.user.deleteMany ({}) #\u5220\u9664\u6240\u6709\u6570\u636e","title":"3.3.5\u3001\u5220\u9664\u6570\u636e"},{"location":"tantan/day02/#336","text":"MongoDB \u67e5\u8be2\u6570\u636e\u7684\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a db . user . find ( [ query ] , [ fields ] ) query \uff1a\u53ef\u9009\uff0c\u4f7f\u7528\u67e5\u8be2\u64cd\u4f5c\u7b26\u6307\u5b9a\u67e5\u8be2\u6761\u4ef6 fields \uff1a\u53ef\u9009\uff0c\u4f7f\u7528\u6295\u5f71\u64cd\u4f5c\u7b26\u6307\u5b9a\u8fd4\u56de\u7684\u952e\u3002\u67e5\u8be2\u65f6\u8fd4\u56de\u6587\u6863\u4e2d\u6240\u6709\u952e\u503c\uff0c \u53ea\u9700\u7701\u7565\u8be5\u53c2\u6570\u5373\u53ef\uff08\u9ed8\u8ba4\u7701\u7565\uff09\u3002 \u5982\u679c\u4f60\u9700\u8981\u4ee5\u6613\u8bfb\u7684\u65b9\u5f0f\u6765\u8bfb\u53d6\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528 pretty() \u65b9\u6cd5\uff0c\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a >db.col.find().pretty() pretty() \u65b9\u6cd5\u4ee5\u683c\u5f0f\u5316\u7684\u65b9\u5f0f\u6765\u663e\u793a\u6240\u6709\u6587\u6863\u3002 \u6761\u4ef6\u67e5\u8be2\uff1a \u64cd\u4f5c \u683c\u5f0f \u8303\u4f8b RDBMS\u4e2d\u7684\u7c7b\u4f3c\u8bed\u53e5 \u7b49\u4e8e {<key>:<value> } db.col.find({\"by\":\"\u9ed1\u9a6c\u7a0b\u5e8f\u5458\"}).pretty() where by = '\u9ed1\u9a6c\u7a0b\u5e8f\u5458' \u5c0f\u4e8e {<key>:{$lt:<value>}} db.col.find({\"likes\":{$lt:50}}).pretty() where likes < 50 \u5c0f\u4e8e\u6216\u7b49\u4e8e {<key>:{$lte:<value>}} db.col.find({\"likes\":{$lte:50}}).pretty() where likes <= 50 \u5927\u4e8e {<key>:{$gt:<value>}} db.col.find({\"likes\":{$gt:50}}).pretty() where likes > 50 \u5927\u4e8e\u6216\u7b49\u4e8e {<key>:{$gte:<value>}} db.col.find({\"likes\":{$gte:50}}).pretty() where likes >= 50 \u4e0d\u7b49\u4e8e {<key>:{$ne:<value>}} db.col.find({\"likes\":{$ne:50}}).pretty() where likes != 50 \u5b9e\u4f8b\uff1a #\u63d2\u5165\u6d4b\u8bd5\u6570\u636e db.user.insert ({ id:1,username: 'zhangsan' ,age:20 }) db.user.insert ({ id:2,username: 'lisi' ,age:21 }) db.user.insert ({ id:3,username: 'wangwu' ,age:22 }) db.user.insert ({ id:4,username: 'zhaoliu' ,age:22 }) db.user.find () #\u67e5\u8be2\u5168\u90e8\u6570\u636e db.user.find ({} , { id:1,username:1 }) #\u53ea\u67e5\u8be2id\u4e0eusername\u5b57\u6bb5 db.user.find () .count () #\u67e5\u8be2\u6570\u636e\u6761\u6570 db.user.find ({ id:1 }) #\u67e5\u8be2id\u4e3a1\u7684\u6570\u636e db.user.find ({ age: { $lte :21 }}) #\u67e5\u8be2\u5c0f\u4e8e\u7b49\u4e8e21\u7684\u6570\u636e db.user.find ({ age: { $lte :21 } , id: { $gte :2 }}) #and\u67e5\u8be2\uff0cage\u5c0f\u4e8e\u7b49\u4e8e21\u5e76\u4e14id\u5927\u4e8e\u7b49\u4e8e2 db.user.find ({ $or : [{ id:1 } , { id:2 }]}) #\u67e5\u8be2id=1 or id=2 #\u5206\u9875\u67e5\u8be2\uff1aSkip()\u8df3\u8fc7\u51e0\u6761\uff0climit()\u67e5\u8be2\u6761\u6570 db.user.find () .limit ( 2 ) .skip ( 1 ) #\u8df3\u8fc71\u6761\u6570\u636e\uff0c\u67e5\u8be22\u6761\u6570\u636e db.user.find () .sort ({ id:-1 }) #\u6309\u7167age\u5012\u5e8f\u6392\u5e8f\uff0c-1\u4e3a\u5012\u5e8f\uff0c1\u4e3a\u6b63\u5e8f","title":"3.3.6\u3001\u67e5\u8be2\u6570\u636e"},{"location":"tantan/day02/#34","text":"\u7d22\u5f15\u901a\u5e38\u80fd\u591f\u6781\u5927\u7684\u63d0\u9ad8\u67e5\u8be2\u7684\u6548\u7387\uff0c\u5982\u679c\u6ca1\u6709\u7d22\u5f15\uff0cMongoDB\u5728\u8bfb\u53d6\u6570\u636e\u65f6\u5fc5\u987b\u626b\u63cf\u96c6\u5408\u4e2d\u7684\u6bcf\u4e2a\u6587\u4ef6\u5e76\u9009\u53d6\u90a3\u4e9b\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\u3002 \u8fd9\u79cd\u626b\u63cf\u5168\u96c6\u5408\u7684\u67e5\u8be2\u6548\u7387\u662f\u975e\u5e38\u4f4e\u7684\uff0c\u7279\u522b\u5728\u5904\u7406\u5927\u91cf\u7684\u6570\u636e\u65f6\uff0c\u67e5\u8be2\u53ef\u4ee5\u8981\u82b1\u8d39\u51e0\u5341\u79d2\u751a\u81f3\u51e0\u5206\u949f\uff0c\u8fd9\u5bf9\u7f51\u7ad9\u7684\u6027\u80fd\u662f\u975e\u5e38\u81f4\u547d\u7684\u3002 \u7d22\u5f15\u662f\u7279\u6b8a\u7684\u6570\u636e\u7ed3\u6784\uff0c\u7d22\u5f15\u5b58\u50a8\u5728\u4e00\u4e2a\u6613\u4e8e\u904d\u5386\u8bfb\u53d6\u7684\u6570\u636e\u96c6\u5408\u4e2d\uff0c\u7d22\u5f15\u662f\u5bf9\u6570\u636e\u5e93\u8868\u4e2d\u4e00\u5217\u6216\u591a\u5217\u7684\u503c\u8fdb\u884c\u6392\u5e8f\u7684\u4e00\u79cd\u7ed3\u6784 #\u67e5\u770b\u7d22\u5f15 > db.user.getIndexes () [ { \"v\" : 2 , \"key\" : { \"_id\" : 1 } , \"name\" : \"_id_\" , \"ns\" : \"testdb.user\" } ] #\u8bf4\u660e\uff1a1\u8868\u793a\u5347\u5e8f\u521b\u5efa\u7d22\u5f15\uff0c-1\u8868\u793a\u964d\u5e8f\u521b\u5efa\u7d22\u5f15\u3002 #\u521b\u5efa\u7d22\u5f15 > db.user.createIndex ({ 'age' :1 }) { \"createdCollectionAutomatically\" : false, \"numIndexesBefore\" : 1 , \"numIndexesAfter\" : 2 , \"ok\" : 1 } #\u5220\u9664\u7d22\u5f15 db.user.dropIndex ( \"age_1\" ) #\u6216\u8005\uff0c\u5220\u9664\u9664\u4e86_id\u4e4b\u5916\u7684\u7d22\u5f15 db.user.dropIndexes () #\u521b\u5efa\u8054\u5408\u7d22\u5f15 db.user.createIndex ({ 'age' :1, 'id' :-1 }) #\u67e5\u770b\u7d22\u5f15\u5927\u5c0f\uff0c\u5355\u4f4d\uff1a\u5b57\u8282 db.user.totalIndexSize ()","title":"3.4\u3001\u7d22\u5f15"},{"location":"tantan/day02/#35","text":"MongoDB \u67e5\u8be2\u5206\u6790\u53ef\u4ee5\u786e\u4fdd\u6211\u4eec\u5efa\u8bae\u7684\u7d22\u5f15\u662f\u5426\u6709\u6548\uff0c\u662f\u67e5\u8be2\u8bed\u53e5\u6027\u80fd\u5206\u6790\u7684\u91cd\u8981\u5de5\u5177\u3002 #\u63d2\u51651000\u6761\u6570\u636e for ( var i = 1 ; i< 1000 ; i++ ) db.user.insert ({ id:100+i,username: 'name_' +i,age:10+i }) #\u67e5\u770b\u6267\u884c\u8ba1\u5212 > db.user.find ({ age: { $gt :100 } ,id: { $lt :200 }}) .explain () { \"queryPlanner\" : { \"plannerVersion\" : 1 , \"namespace\" : \"testdb.user\" , \"indexFilterSet\" : false, \"parsedQuery\" : { \" $and \" : [ { \"id\" : { \" $lt \" : 200 } } , { \"age\" : { \" $gt \" : 100 } } ] } , \"winningPlan\" : { #\u6700\u4f73\u6267\u884c\u8ba1\u5212 \"stage\" : \"FETCH\" , #\u67e5\u8be2\u65b9\u5f0f\uff0c\u5e38\u89c1\u7684\u6709COLLSCAN/\u5168\u8868\u626b\u63cf\u3001IXSCAN/\u7d22\u5f15\u626b\u63cf\u3001FETCH/\u6839\u636e\u7d22\u5f15\u53bb\u68c0\u7d22\u6587\u6863\u3001SHARD_MERGE/\u5408\u5e76\u5206\u7247\u7ed3\u679c\u3001IDHACK/\u9488\u5bf9_id\u8fdb\u884c\u67e5\u8be2 \"inputStage\" : { \"stage\" : \"IXSCAN\" , \"keyPattern\" : { \"age\" : 1 , \"id\" : -1 } , \"indexName\" : \"age_1_id_-1\" , \"isMultiKey\" : false, \"multiKeyPaths\" : { \"age\" : [ ] , \"id\" : [ ] } , \"isUnique\" : false, \"isSparse\" : false, \"isPartial\" : false, \"indexVersion\" : 2 , \"direction\" : \"forward\" , \"indexBounds\" : { \"age\" : [ \"(100.0, inf.0]\" ] , \"id\" : [ \"(200.0, -inf.0]\" ] } } } , \"rejectedPlans\" : [ ] } , \"serverInfo\" : { \"host\" : \"c493d5ff750a\" , \"port\" : 27017 , \"version\" : \"4.0.3\" , \"gitVersion\" : \"7ea530946fa7880364d88c8d8b6026bbc9ffa48c\" } , \"ok\" : 1 } #\u6d4b\u8bd5\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15 > db.user.find ({ username: 'zhangsan' }) .explain () { \"queryPlanner\" : { \"plannerVersion\" : 1 , \"namespace\" : \"testdb.user\" , \"indexFilterSet\" : false, \"parsedQuery\" : { \"username\" : { \" $eq \" : \"zhangsan\" } } , \"winningPlan\" : { \"stage\" : \"COLLSCAN\" , #\u5168\u8868\u626b\u63cf \"filter\" : { \"username\" : { \" $eq \" : \"zhangsan\" } } , \"direction\" : \"forward\" } , \"rejectedPlans\" : [ ] } , \"serverInfo\" : { \"host\" : \"c493d5ff750a\" , \"port\" : 27017 , \"version\" : \"4.0.3\" , \"gitVersion\" : \"7ea530946fa7880364d88c8d8b6026bbc9ffa48c\" } , \"ok\" : 1 }","title":"3.5\u3001\u6267\u884c\u8ba1\u5212"},{"location":"tantan/day02/#36ui","text":"Robo 3T\u662fMongoDB\u7684\u5ba2\u6237\u7aef\u5de5\u5177\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u64cd\u4f5cMongoDB\u3002 \u67e5\u770b\u6570\u636e\uff1a \u6216\u4f7f\u7528Navicat Premium 15\uff1a","title":"3.6\u3001UI\u5ba2\u6237\u7aef\u5de5\u5177"},{"location":"tantan/day02/#4springbootmongodb","text":"spring-data\u5bf9MongoDB\u505a\u4e86\u652f\u6301\uff0c\u4f7f\u7528spring-data-mongodb\u53ef\u4ee5\u7b80\u5316MongoDB\u7684\u64cd\u4f5c\u3002 \u5730\u5740\uff1ahttps://spring.io/projects/spring-data-mongodb","title":"4\u3001SpringBoot\u6574\u5408MongoDB"},{"location":"tantan/day02/#41","text":"<?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <modelVersion> 4.0.0 </modelVersion> <parent> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-parent </artifactId> <version> 2.1.0.RELEASE </version> </parent> <groupId> cn.itcast.mongodb </groupId> <artifactId> itcast-mongodb </artifactId> <version> 1.0-SNAPSHOT </version> <dependencies> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-mongodb </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-test </artifactId> <scope> test </scope> </dependency> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> <optional> true </optional> <version> 1.18.4 </version> </dependency> </dependencies> <build> <plugins> <!-- java\u7f16\u8bd1\u63d2\u4ef6 --> <plugin> <groupId> org.apache.maven.plugins </groupId> <artifactId> maven-compiler-plugin </artifactId> <version> 3.2 </version> <configuration> <source> 1.8 </source> <target> 1.8 </target> <encoding> UTF-8 </encoding> </configuration> </plugin> </plugins> </build> </project>","title":"4.1\u3001\u5bfc\u5165\u4f9d\u8d56"},{"location":"tantan/day02/#42applicationproperties","text":"# Spring boot application spring.application.name = itcast-mongodb #\u65e0\u8ba4\u8bc1\u4fe1\u606f\u7684\u914d\u7f6e #spring.data.mongodb.uri=mongodb://192.168.31.81:27017/tanhua #springboot \u914d\u7f6e spring.data.mongodb.username = tanhua spring.data.mongodb.password = l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV spring.data.mongodb.authentication-database = admin spring.data.mongodb.database = tanhua spring.data.mongodb.port = 27018 spring.data.mongodb.host = 192.168.31.81","title":"4.2\u3001\u7f16\u5199application.properties\u914d\u7f6e\u6587\u4ef6"},{"location":"tantan/day02/#43","text":"package cn.itcast.mongodb.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; @Data @AllArgsConstructor @NoArgsConstructor public class Person { private ObjectId id ; private String name ; private int age ; private Address address ; } package cn.itcast.mongodb.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @AllArgsConstructor @NoArgsConstructor public class Address { private String street ; private String city ; private String zip ; }","title":"4.3\u3001\u7f16\u5199\u5b9e\u4f53"},{"location":"tantan/day02/#44dao","text":"package cn.itcast.mongodb.dao ; import cn.itcast.mongodb.pojo.Person ; import com.mongodb.client.result.DeleteResult ; import com.mongodb.client.result.UpdateResult ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; import org.springframework.data.mongodb.core.query.Update ; import org.springframework.stereotype.Component ; import java.util.List ; @Component public class PersonDao { @Autowired private MongoTemplate mongoTemplate ; public void savePerson ( Person person ) { this . mongoTemplate . save ( person ); } public List < Person > queryPersonListByName ( String name ) { Query query = Query . query ( Criteria . where ( \"name\" ). is ( name )); return this . mongoTemplate . find ( query , Person . class ); } public List < Person > queryPersonPageList ( Integer page , Integer rows ) { Query query = new Query (). limit ( rows ). skip (( page - 1 ) * rows ); return this . mongoTemplate . find ( query , Person . class ); } public UpdateResult update ( Person person ) { Query query = Query . query ( Criteria . where ( \"id\" ). is ( person . getId ())); Update update = Update . update ( \"age\" , person . getAge ()); return this . mongoTemplate . updateFirst ( query , update , Person . class ); } public DeleteResult deleteById ( String id ) { Query query = Query . query ( Criteria . where ( \"id\" ). is ( id )); return this . mongoTemplate . remove ( query , Person . class ); } }","title":"4.4\u3001\u7f16\u5199dao"},{"location":"tantan/day02/#45","text":"package cn.itcast.mongodb ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; @SpringBootApplication public class MongoApplication { public static void main ( String [] args ) { SpringApplication . run ( MongoApplication . class , args ); } }","title":"4.5\u3001\u7f16\u5199\u542f\u52a8\u7c7b"},{"location":"tantan/day02/#46","text":"package cn.itcast.mongodb ; import cn.itcast.mongodb.dao.PersonDao ; import cn.itcast.mongodb.pojo.Address ; import cn.itcast.mongodb.pojo.Person ; import org.bson.types.ObjectId ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; import java.util.List ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestPersonDao { @Autowired private PersonDao personDao ; @Test public void testSave () { Person person = new Person ( ObjectId . get (), \"\u5f20\u4e09\" , 20 , new Address ( \"\u4eba\u6c11\u8def\" , \"\u4e0a\u6d77\u5e02\" , \"666666\" )); this . personDao . savePerson ( person ); } @Test public void testQuery () { List < Person > personList = this . personDao . queryPersonListByName ( \"\u5f20\u4e09\" ); for ( Person person : personList ) { System . out . println ( person ); } } @Test public void testQuery2 () { List < Person > personList = this . personDao . queryPersonPageList ( 2 , 2 ); for ( Person person : personList ) { System . out . println ( person ); } } @Test public void testUpdate () { Person person = new Person (); person . setId ( new ObjectId ( \"5c0956ce235e192520086736\" )); person . setAge ( 30 ); this . personDao . update ( person ); } @Test public void testDelete () { this . personDao . deleteById ( \"5c09ca05235e192d8887a389\" ); } }","title":"4.6\u3001\u7f16\u5199\u5355\u5143\u6d4b\u8bd5"},{"location":"tantan/day02/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/","text":"\u638c\u63e1\u963f\u91cc\u4e91OSS\u7684\u5e94\u7528 \u638c\u63e1\u4eba\u8138\u8bc6\u522b\u6280\u672f\u7684\u4f7f\u7528 \u72ec\u7acb\u5b8c\u6210\u767b\u5f55\u7684\u529f\u80fd \u72ec\u7acb\u5b8c\u6210\u5b8c\u5584\u4e2a\u4eba\u4fe1\u606f\u529f\u80fd \u5b8c\u6210MongoDB\u7684\u90e8\u7f72 \u638c\u63e1MongoDB\u7684CRUD \u638c\u63e1SpringBoot\u6574\u5408MongoDB","title":"\u5b66\u4e60\u76ee\u6807"},{"location":"tantan/day03/","text":"\u8bfe\u7a0b\u8bf4\u660e \u00b6 \u9996\u9875\u529f\u80fd\u8bf4\u660e \u7cfb\u7edf\u67b6\u6784\u8bf4\u660e \u5b9e\u73b0\u4eca\u65e5\u4f73\u4eba\u529f\u80fd \u5b9e\u73b0\u63a8\u8350\u7528\u6237\u7684\u5217\u8868 \u63a5\u53e3\u589e\u52a0\u7f13\u5b58\u529f\u80fd \u6574\u5408\u524d\u7aef\u8054\u8c03\u6d4b\u8bd5 1\u3001\u9996\u9875 \u00b6 \u5728\u7528\u6237\u767b\u5f55\u6210\u529f\u540e\uff0c\u5c31\u4f1a\u8fdb\u5165\u9996\u9875\uff0c\u9996\u9875\u4e2d\u6709\u4eca\u65e5\u4f73\u4eba\u3001\u63a8\u8350\u597d\u53cb\u3001\u63a2\u82b1\u3001\u641c\u9644\u8fd1\u7b49\u529f\u80fd\u3002 2\u3001\u7cfb\u7edf\u67b6\u6784 \u00b6 \u5728\u5f00\u53d1\u5b8cSSO\u7cfb\u7edf\u4e2d\u7684\u767b\u5f55\u529f\u80fd\u540e\uff0c\u63a5\u4e0b\u6765\u5c31\u9700\u8981\u5b9e\u73b0\u5176\u4ed6\u7684\u529f\u80fd\uff0c\u5728\u6574\u4f53\u67b6\u6784\u4e2d\uff0c\u5b8c\u6210\u4e0eAPP\u5bf9\u63a5\u7684\u670d\u52a1\u5de5\u7a0b\u53ebmy-tanhua-server\uff0c\u771f\u6b63\u7684\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\u4f7f\u7528dubbo\u5b8c\u6210\uff0c\u5176\u5de5\u7a0b\u540d\u53eb\uff1amy-tanhua-dubbo\uff0c\u5b83\u4eec\u7684\u67b6\u6784\u793a\u610f\u56fe\u5982\u4e0b\uff1a \u8bf4\u660e\uff1a \u5ba2\u6237\u7aefAPP\u53d1\u8d77\u8bf7\u6c42\u5230Nginx\uff0c\u5728Nginx\u4e2d\u5bf9\u8bf7\u6c42\u505a\u51fa\u5224\u65ad\uff0c\u5c06\u8bf7\u6c42\u8f6c\u53d1\u81f3sso\u7cfb\u7edf\u6216server\u7cfb\u7edf\u3002 sso\u7cfb\u7edf\u4e2d\uff0c\u5c06\u5bf9\u63a5\u7b2c\u4e09\u65b9\u5e73\u53f0\u4ee5\u53ca\u5b8c\u6210\u6570\u636e\u7684\u7f13\u5b58\u3001\u6d88\u606f\u53d1\u9001\u3001\u7528\u6237\u7684\u6ce8\u518c\u767b\u5f55\u529f\u80fd\u3002 server\u7cfb\u7edf\u4e3aAPP\u63d0\u4f9b\u4e86\u63a5\u53e3\u670d\u52a1\u7684\u652f\u6491 \u7528\u6237\u8bf7\u6c42\u4e2d\u643a\u5e26\u7684token\u9700\u8981\u5230sso\u7cfb\u7edf\u4e2d\u8fdb\u884c\u6821\u9a8c \u901a\u8fc7rpc\u8c03\u7528dubbo\u4e2d\u63d0\u4f9b\u7684\u670d\u52a1\uff0c\u5728dubbo\u670d\u52a1\u4e2d\u4e0eMongoDB\u5bf9\u63a5\uff0c\u5b8c\u6210\u6570\u636e\u7684CRUD\u64cd\u4f5c \u5c06\u4e00\u4e9b\u6570\u636e\u7f13\u5b58\u5230Redis\uff0c\u4ece\u800c\u63d0\u5347\u6570\u636e\u67e5\u8be2\u6027\u80fd \u7528\u6237\u6570\u636e\u7684\u67e5\u8be2\u5c06\u57fa\u4e8eMySQL\u6570\u636e\u5e93\u8fdb\u884c\u67e5\u8be2 2.1\u3001nginx\u670d\u52a1 \u00b6 2.1.1\u3001\u90e8\u7f72\u5b89\u88c5 \u00b6 \u5b89\u88c5\u5305\u5728\u8d44\u6599\u4e2d\uff1anginx-1.17.3.zip \u5b89\u88c5\u5728\u4efb\u610f\u76ee\u5f55\uff0c\u901a\u8fc7\u547d\u4ee4\uff1astart nginx.exe \u542f\u52a8\uff1a \u91cd\u542f\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\u547d\u4ee4\uff1anginx.exe -s reload 2.1.2\u3001\u914d\u7f6e \u00b6 \u4fee\u6539conf\u76ee\u5f55\u4e0b\u7684nginx.conf\u6587\u4ef6\uff1a #user nobody; worker_processes 1 ; #error_log logs/error.log; #error_log logs/error.log notice; #error_log logs/error.log info; #pid logs/nginx.pid; events { worker_connections 1024 ; } http { include mime.types ; default_type application/octet-stream ; #log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' # '$status $body_bytes_sent \"$http_referer\" ' # '\"$http_user_agent\" \"$http_x_forwarded_for\"'; #access_log logs/access.log main; sendfile on ; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65 ; #gzip on; server { listen 80 ; server_name localhost ; #charset koi8-r; #access_log logs/host.access.log main; #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html ; location = /50x.html { root html ; } location /user/ { #\u8bf7\u6c42\u8def\u5f84\u4e2d\u51e1\u662f\u4ee5/user/\u5f00\u5934\u7684\u8bf7\u6c42\uff0c\u8f6c\u53d1\u5230sso\u7cfb\u7edf client_max_body_size 300m ; #\u8bbe\u7f6e\u6700\u5927\u7684\u8bf7\u6c42\u4f53\u5927\u5c0f\uff0c\u89e3\u51b3\u5927\u6587\u4ef6\u4e0a\u4f20\u4e0d\u4e86\u7684\u95ee\u9898 proxy_connect_timeout 300s ; #\u4ee3\u7406\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4 proxy_send_timeout 300s ; #\u4ee3\u7406\u53d1\u9001\u6570\u636e\u7684\u8d85\u65f6\u65f6\u95f4 proxy_read_timeout 300s ; #\u4ee3\u7406\u8bfb\u53d6\u6570\u636e\u7684\u8d85\u65f6\u65f6\u95f4 proxy_pass http://127.0.0.1:18080 ; #\u8f6c\u53d1\u8bf7\u6c42 } location / { #\u4e0a\u9762\u672a\u5339\u914d\u5230\u7684\u5728\u8fd9\u91cc\u5904\u7406 client_max_body_size 300m ; proxy_connect_timeout 300s ; proxy_send_timeout 300s ; proxy_read_timeout 300s ; proxy_pass http://127.0.0.1:18081 ; #\u8f6c\u53d1\u8bf7\u6c42\u5230server\u7cfb\u7edf } } } 2.1.3\u3001\u6d4b\u8bd5 \u00b6 2.2\u3001\u642d\u5efaserver\u5de5\u7a0b \u00b6 2.2.1\u3001\u5bfc\u5165\u4f9d\u8d56 \u00b6 pom.xml\u6587\u4ef6\uff1a <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <parent> <artifactId> my-tanhua </artifactId> <groupId> cn.itcast.tanhua </groupId> <version> 1.0-SNAPSHOT </version> </parent> <modelVersion> 4.0.0 </modelVersion> <artifactId> my-tanhua-server </artifactId> <dependencies> <dependency> <groupId> cn.itcast.tanhua </groupId> <artifactId> my-tanhua-dubbo-interface </artifactId> <version> 1.0-SNAPSHOT </version> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-web </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-test </artifactId> <scope> test </scope> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-redis </artifactId> </dependency> <!--dubbo\u7684springboot\u652f\u6301--> <dependency> <groupId> com.alibaba.boot </groupId> <artifactId> dubbo-spring-boot-starter </artifactId> </dependency> <!--dubbo\u6846\u67b6--> <dependency> <groupId> com.alibaba </groupId> <artifactId> dubbo </artifactId> </dependency> <!--zk\u4f9d\u8d56--> <dependency> <groupId> org.apache.zookeeper </groupId> <artifactId> zookeeper </artifactId> </dependency> <dependency> <groupId> com.github.sgroschupf </groupId> <artifactId> zkclient </artifactId> </dependency> <dependency> <groupId> org.apache.commons </groupId> <artifactId> commons-lang3 </artifactId> </dependency> <dependency> <groupId> org.apache.commons </groupId> <artifactId> commons-collections4 </artifactId> <version> 4.4 </version> </dependency> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus </artifactId> </dependency> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus-boot-starter </artifactId> </dependency> <dependency> <groupId> mysql </groupId> <artifactId> mysql-connector-java </artifactId> </dependency> <dependency> <groupId> commons-io </groupId> <artifactId> commons-io </artifactId> <version> 2.6 </version> </dependency> <dependency> <groupId> commons-codec </groupId> <artifactId> commons-codec </artifactId> </dependency> </dependencies> </project> 2.2.2\u3001application.properties \u00b6 spring.application.name = itcast-tanhua-server server.port = 18081 #\u6570\u636e\u5e93\u8fde\u63a5\u4fe1\u606f spring.datasource.driver-class-name = com.mysql.jdbc.Driver spring.datasource.url = jdbc:mysql://192.168.31.81:3306/mytanhua?useUnicode=true&characterEncoding=utf8&autoReconnect=true&allowMultiQueries=true&useSSL=false spring.datasource.username = root spring.datasource.password = root # \u679a\u4e3e\u5305\u626b\u63cf mybatis-plus.type-enums-package = com.tanhua.server.enums # \u8868\u540d\u524d\u7f00 mybatis-plus.global-config.db-config.table-prefix = tb_ # id\u7b56\u7565\u4e3a\u81ea\u589e\u957f mybatis-plus.global-config.db-config.id-type = auto #dubbo\u6ce8\u518c\u4e2d\u5fc3\u914d\u7f6e dubbo.application.name = itcast-tanhua-server dubbo.registry.address = zookeeper://192.168.31.81:2181 dubbo.registry.client = zkclient dubbo.registry.timeout = 60000 dubbo.consumer.timeout = 60000 #sso\u7cfb\u7edf\u670d\u52a1\u5730\u5740 tanhua.sso.url = http://127.0.0.1 #\u9ed8\u8ba4\u4eca\u65e5\u4f73\u4eba\u63a8\u8350\u7528\u6237 tanhua.sso.default.user = 2 2.2.3\u3001ServerApplication \u00b6 package com.tanhua.server ; import org.mybatis.spring.annotation.MapperScan ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; @MapperScan ( \"com.tanhua.server.mapper\" ) //\u8bbe\u7f6emapper\u63a5\u53e3\u7684\u626b\u63cf\u5305 @SpringBootApplication public class ServerApplication { public static void main ( String [] args ) { SpringApplication . run ( ServerApplication . class , args ); } } 2.3\u3001\u642d\u5efadubbo\u5de5\u7a0b \u00b6 my-tanhua-dubbo\u662fdubbo\u5de5\u7a0b\u7684\u7236\u5de5\u7a0b\uff1a ~~~xml my-tanhua cn.itcast.tanhua 1.0-SNAPSHOT 4.0.0 <artifactId> my-tanhua-dubbo </artifactId> <packaging> pom </packaging> <modules> <module> my-tanhua-dubbo-interface </module> <module> my-tanhua-dubbo-service </module> </modules> ~~~ 2.3.1\u3001\u521b\u5efamy-tanhua-dubbo-interface\u5de5\u7a0b \u00b6 \u8be5\u5de5\u7a0b\u4e2d\u5b9a\u4e49\u4e86dubbo\u670d\u52a1\u4e2d\u7684interface\u4e0e\u5b9e\u4f53\u5bf9\u8c61\u3002 <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <parent> <artifactId> my-tanhua-dubbo </artifactId> <groupId> cn.itcast.tanhua </groupId> <version> 1.0-SNAPSHOT </version> </parent> <modelVersion> 4.0.0 </modelVersion> <artifactId> my-tanhua-dubbo-interface </artifactId> <dependencies> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-mongodb </artifactId> </dependency> </dependencies> </project> 2.3.2\u3001\u521b\u5efamy-tanhua-dubbo-service\u5de5\u7a0b \u00b6 <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <parent> <artifactId> my-tanhua-dubbo </artifactId> <groupId> cn.itcast.tanhua </groupId> <version> 1.0-SNAPSHOT </version> </parent> <modelVersion> 4.0.0 </modelVersion> <artifactId> my-tanhua-dubbo-service </artifactId> <dependencies> <!--\u5f15\u5165interface\u4f9d\u8d56--> <dependency> <groupId> cn.itcast.tanhua </groupId> <artifactId> my-tanhua-dubbo-interface </artifactId> <version> 1.0-SNAPSHOT </version> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-test </artifactId> <scope> test </scope> </dependency> <!--dubbo\u7684springboot\u652f\u6301--> <dependency> <groupId> com.alibaba.boot </groupId> <artifactId> dubbo-spring-boot-starter </artifactId> </dependency> <!--dubbo\u6846\u67b6--> <dependency> <groupId> com.alibaba </groupId> <artifactId> dubbo </artifactId> </dependency> <!--zk\u4f9d\u8d56--> <dependency> <groupId> org.apache.zookeeper </groupId> <artifactId> zookeeper </artifactId> </dependency> <dependency> <groupId> com.github.sgroschupf </groupId> <artifactId> zkclient </artifactId> </dependency> <!--MongoDB\u76f8\u5173\u4f9d\u8d56--> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-mongodb </artifactId> </dependency> <dependency> <groupId> org.mongodb </groupId> <artifactId> mongodb-driver-sync </artifactId> </dependency> <!--\u5176\u4ed6\u5de5\u5177\u5305\u4f9d\u8d56--> <dependency> <groupId> org.apache.commons </groupId> <artifactId> commons-lang3 </artifactId> </dependency> <dependency> <groupId> joda-time </groupId> <artifactId> joda-time </artifactId> </dependency> <dependency> <groupId> io.netty </groupId> <artifactId> netty-all </artifactId> </dependency> </dependencies> </project> application.properties\uff1a # Spring boot application spring.application.name = itcast-tanhua-dubbo-service # dubbo \u626b\u63cf\u5305\u914d\u7f6e dubbo.scan.basePackages = com.tanhua.dubbo.server dubbo.application.name = dubbo-provider-tanhua #dubbo \u5bf9\u5916\u66b4\u9732\u7684\u7aef\u53e3\u4fe1\u606f dubbo.protocol.name = dubbo dubbo.protocol.port = 20880 #dubbo\u6ce8\u518c\u4e2d\u5fc3\u7684\u914d\u7f6e dubbo.registry.address = zookeeper://192.168.31.81:2181 dubbo.registry.client = zkclient dubbo.registry.timeout = 60000 #springboot MongoDB\u914d\u7f6e spring.data.mongodb.username = tanhua spring.data.mongodb.password = l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV spring.data.mongodb.authentication-database = admin spring.data.mongodb.database = tanhua spring.data.mongodb.port = 27017 spring.data.mongodb.host = 192.168.31.81 \u7f16\u5199\u542f\u52a8\u7c7b\uff1a package com.tanhua.dubbo.server ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; @SpringBootApplication public class DubboApplication { public static void main ( String [] args ) { SpringApplication . run ( DubboApplication . class , args ); } } 2.4\u3001\u5de5\u7a0b\u7ed3\u6784 \u00b6 \u6700\u7ec8\u642d\u5efa\u5b8c\u6210\u7684\u6548\u679c\u5982\u4e0b\uff1a 3\u3001\u4eca\u65e5\u4f73\u4eba \u00b6 \u4eca\u65e5\u4f73\u4eba\uff0c\u4f1a\u63a8\u8350\u7f18\u5206\u503c\u6700\u5927\u7684\u7528\u6237\uff0c\u8fdb\u884c\u5c55\u73b0\u51fa\u6765\u3002\u7f18\u5206\u503c\u7684\u8ba1\u7b97\u662f\u7531\u7528\u6237\u7684\u884c\u4e3a\u8fdb\u884c\u6253\u5206\uff0c\u5982\uff1a\u70b9\u51fb\u3001\u70b9\u8d5e\u3001\u8bc4\u8bba\u3001\u5b66\u5386\u3001\u5a5a\u59fb\u72b6\u6001\u7b49\u4fe1\u606f\u7ec4\u5408\u800c\u6210\u7684\u3002 \u5b9e\u73b0\uff1a\u6211\u4eec\u5148\u4e0d\u8003\u8651\u63a8\u8350\u7684\u903b\u8f91\uff0c\u5047\u8bbe\u73b0\u5728\u5df2\u7ecf\u6709\u63a8\u8350\u7684\u7ed3\u679c\uff0c\u6211\u4eec\u53ea\u9700\u8981\u4ece\u7ed3\u679c\u4e2d\u67e5\u8be2\u5230\u7f18\u5206\u503c\u6700\u9ad8\u7684\u7528\u6237\u5c31\u53ef\u4ee5\u4e86\u3002\u81f3\u4e8e\u63a8\u8350\u7684\u903b\u8f91\u4ee5\u53ca\u5b9e\u73b0\uff0c\u6211\u4eec\u5c06\u540e\u9762\u7684\u8bfe\u7a0b\u4e2d\u8bb2\u89e3\u3002 \u6d41\u7a0b\uff1a 3.1\u3001\u8868\u7ed3\u6784 \u00b6 #\u8868\u7ed3\u6784\uff0c\u8868\u540d\uff1arecommend_user { \"userId\" :1001, #\u63a8\u8350\u7684\u7528\u6237id \"toUserId\" :1002, #\u7528\u6237id \"score\" :90, #\u63a8\u8350\u5f97\u5206 \"date\" : \"2019/1/1\" #\u65e5\u671f } \u5df2\u7ecf\u63d0\u4f9b\u7684\u6d4b\u8bd5\u6570\u636e\uff084855\u6761\u6570\u636e\uff09\uff1a 3.2\u3001\u7f16\u5199dubbo\u670d\u52a1 \u00b6 3.2.1\u3001\u7f16\u5199\u63a5\u53e3 \u00b6 \u5728my-tanhua-dubbo-interface\u5de5\u7a0b\u4e2d\u5b9a\u4e49\u63a5\u53e3\uff1a package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.vo.PageInfo ; import com.tanhua.dubbo.server.pojo.RecommendUser ; public interface RecommendUserApi { /** * \u67e5\u8be2\u4e00\u4f4d\u5f97\u5206\u6700\u9ad8\u7684\u63a8\u8350\u7528\u6237 * * @param userId * @return */ RecommendUser queryWithMaxScore ( Long userId ); /** * \u6309\u7167\u5f97\u5206\u5012\u5e8f * * @param userId * @param pageNum * @param pageSize * @return */ PageInfo < RecommendUser > queryPageInfo ( Long userId , Integer pageNum , Integer pageSize ); } package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.annotation.Id ; import org.springframework.data.mongodb.core.index.Indexed ; import org.springframework.data.mongodb.core.mapping.Document ; @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"recommend_user\" ) public class RecommendUser implements java . io . Serializable { private static final long serialVersionUID = - 4296017160071130962L ; @Id private ObjectId id ; //\u4e3b\u952eid @Indexed private Long userId ; //\u63a8\u8350\u7684\u7528\u6237id private Long toUserId ; //\u7528\u6237id @Indexed private Double score ; //\u63a8\u8350\u5f97\u5206 private String date ; //\u65e5\u671f } package com.tanhua.dubbo.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import java.util.Collections ; import java.util.List ; @Data @AllArgsConstructor public class PageInfo < T > implements java . io . Serializable { private static final long serialVersionUID = - 2105385689859184204L ; /** * \u603b\u6761\u6570 */ private Integer total = 0 ; /** * \u5f53\u524d\u9875 */ private Integer pageNum = 0 ; /** * \u4e00\u9875\u663e\u793a\u7684\u5927\u5c0f */ private Integer pageSize = 0 ; /** * \u6570\u636e\u5217\u8868 */ private List < T > records = Collections . emptyList (); } 3.2.2\u3001\u7f16\u5199\u5b9e\u73b0 \u00b6 package com.tanhua.dubbo.server.api ; import com.alibaba.dubbo.config.annotation.Service ; import com.tanhua.dubbo.server.pojo.RecommendUser ; import com.tanhua.dubbo.server.vo.PageInfo ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.domain.PageRequest ; import org.springframework.data.domain.Sort ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; import java.util.List ; @Service ( version = \"1.0.0\" ) //\u7533\u660e\u8fd9\u662f\u4e00\u4e2adubbo\u670d\u52a1 public class RecommendUserApiImpl implements RecommendUserApi { @Autowired private MongoTemplate mongoTemplate ; @Override public RecommendUser queryWithMaxScore ( Long userId ) { //\u67e5\u8be2\u5f97\u5206\u6700\u9ad8\u7684\u7528\u6237\uff0c\u6309\u7167\u5f97\u5206\u5012\u5e8f\u6392\u5e8f Query query = Query . query ( Criteria . where ( \"toUserId\" ). is ( userId )) . with ( Sort . by ( Sort . Order . desc ( \"score\" ))). limit ( 1 ); return this . mongoTemplate . findOne ( query , RecommendUser . class ); } @Override public PageInfo < RecommendUser > queryPageInfo ( Long userId , Integer pageNum , Integer pageSize ) { //\u5206\u9875\u5e76\u4e14\u6392\u5e8f\u53c2\u6570 PageRequest pageRequest = PageRequest . of ( pageNum - 1 , pageSize , Sort . by ( Sort . Order . desc ( \"score\" ))); //\u67e5\u8be2\u53c2\u6570 Query query = Query . query ( Criteria . where ( \"toUserId\" ). is ( userId )). with ( pageRequest ); List < RecommendUser > recommendUserList = this . mongoTemplate . find ( query , RecommendUser . class ); //\u6682\u65f6\u4e0d\u63d0\u4f9b\u6570\u636e\u603b\u6570 return new PageInfo <> ( 0 , pageNum , pageSize , recommendUserList ); } } 3.2.3\u3001\u6d4b\u8bd5 \u00b6 package com.tanhua.dubbo.server.api ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestRecommendUserApi { @Autowired private RecommendUserApi recommendUserApi ; @Test public void testQueryWithMaxScore (){ System . out . println ( this . recommendUserApi . queryWithMaxScore ( 1L )); System . out . println ( this . recommendUserApi . queryWithMaxScore ( 8L )); System . out . println ( this . recommendUserApi . queryWithMaxScore ( 26L )); } @Test public void testQueryPageInfo (){ System . out . println ( this . recommendUserApi . queryPageInfo ( 1L , 1 , 5 )); System . out . println ( this . recommendUserApi . queryPageInfo ( 1L , 2 , 5 )); System . out . println ( this . recommendUserApi . queryPageInfo ( 1L , 3 , 5 )); } } 3.3\u3001\u5b9e\u73b0\u4eca\u65e5\u4f73\u4eba\u670d\u52a1 \u00b6 3.3.1\u3001mock\u670d\u52a1 \u00b6 \u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/617 3.3.2\u3001\u57fa\u7840\u4ee3\u7801 \u00b6 3.3.2.1\u3001SexEnum \u00b6 package com.tanhua.server.enums ; import com.baomidou.mybatisplus.core.enums.IEnum ; public enum SexEnum implements IEnum < Integer > { MAN ( 1 , \"\u7537\" ), WOMAN ( 2 , \"\u5973\" ), UNKNOWN ( 3 , \"\u672a\u77e5\" ); private int value ; private String desc ; SexEnum ( int value , String desc ) { this . value = value ; this . desc = desc ; } @Override public Integer getValue () { return this . value ; } @Override public String toString () { return this . desc ; } } 3.3.2.2\u3001BasePojo \u00b6 package com.tanhua.server.pojo ; import com.baomidou.mybatisplus.annotation.FieldFill ; import com.baomidou.mybatisplus.annotation.TableField ; import java.util.Date ; public abstract class BasePojo { @TableField ( fill = FieldFill . INSERT ) private Date created ; @TableField ( fill = FieldFill . INSERT_UPDATE ) private Date updated ; } 3.3.2.3\u3001User \u00b6 package com.tanhua.server.pojo ; import com.fasterxml.jackson.annotation.JsonIgnore ; import com.fasterxml.jackson.annotation.JsonIgnoreProperties ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor @JsonIgnoreProperties ( ignoreUnknown = true ) public class User extends BasePojo { private Long id ; private String mobile ; //\u624b\u673a\u53f7 @JsonIgnore private String password ; //\u5bc6\u7801\uff0cjson\u5e8f\u5217\u5316\u65f6\u5ffd\u7565 } 3.3.2.4\u3001UserInfo \u00b6 package com.tanhua.server.pojo ; import com.tanhua.server.enums.SexEnum ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class UserInfo extends BasePojo { private Long id ; private Long userId ; //\u7528\u6237id private String nickName ; //\u6635\u79f0 private String logo ; //\u7528\u6237\u5934\u50cf private String tags ; //\u7528\u6237\u6807\u7b7e\uff1a\u591a\u4e2a\u7528\u9017\u53f7\u5206\u9694 private SexEnum sex ; //\u6027\u522b private Integer age ; //\u5e74\u9f84 private String edu ; //\u5b66\u5386 private String city ; //\u57ce\u5e02 private String birthday ; //\u751f\u65e5 private String coverPic ; // \u5c01\u9762\u56fe\u7247 private String industry ; //\u884c\u4e1a private String income ; //\u6536\u5165 private String marriage ; //\u5a5a\u59fb\u72b6\u6001 } 3.3.3\u3001\u5b9e\u73b0\u529f\u80fd \u00b6 \u5b9e\u73b0\u63cf\u8ff0\uff1a \u9700\u8981\u6839\u636e\u524d\u7aef\u5b9a\u4e49\u7684\u7ed3\u6784\u5b9a\u4e49java\u5bf9\u8c61 \u6839\u636esso\u7cfb\u7edf\u63d0\u4f9b\u7684\u63a5\u53e3\u67e5\u8be2\u5f53\u524d\u767b\u5f55\u7528\u6237\u7684\u4fe1\u606f \u6839\u636edubbo\u7cfb\u7edf\u63d0\u4f9b\u7684\u670d\u52a1\u8fdb\u884c\u67e5\u8be2\u4eca\u65e5\u4f73\u4eba\u6570\u636e 3.3.3.1\u3001TodayBest \u00b6 package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; /** * \u4eca\u65e5\u4f73\u4eba */ @Data @NoArgsConstructor @AllArgsConstructor public class TodayBest { private Long id ; private String avatar ; private String nickname ; private String gender ; //\u6027\u522b man woman private Integer age ; private String [] tags ; private Long fateValue ; //\u7f18\u5206\u503c } 3.3.3.2\u3001TodayBestController \u00b6 package com.tanhua.server.controller ; import com.tanhua.server.service.TodayBestService ; import com.tanhua.server.vo.TodayBest ; import lombok.extern.slf4j.Slf4j ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.RequestHeader ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RestController ; @RestController @RequestMapping ( \"tanhua\" ) @Slf4j public class TodayBestController { @Autowired private TodayBestService todayBestService ; /** * \u67e5\u8be2\u4eca\u65e5\u4f73\u4eba * * @param token * @return */ @GetMapping ( \"todayBest\" ) public ResponseEntity < TodayBest > queryTodayBest ( @RequestHeader ( \"Authorization\" ) String token ) { try { TodayBest todayBest = this . todayBestService . queryTodayBest ( token ); if ( null != todayBest ) { return ResponseEntity . ok ( todayBest ); } } catch ( Exception e ) { log . error ( \"\u67e5\u8be2\u4eca\u65e5\u4f73\u4eba\u51fa\u9519~ token = \" + token , e ); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). body ( null ); } } 3.3.3.3\u3001TodayBestService \u00b6 package com.tanhua.server.service ; import com.tanhua.server.pojo.User ; import com.tanhua.server.pojo.UserInfo ; import com.tanhua.server.vo.TodayBest ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.stereotype.Service ; @Service public class TodayBestService { @Autowired private UserService userService ; @Autowired private RecommendUserService recommendUserService ; @Autowired private UserInfoService userInfoService ; @Value ( \"${tanhua.sso.default.user}\" ) private Long defaultUser ; public TodayBest queryTodayBest ( String token ) { //\u6821\u9a8ctoken\u662f\u5426\u6709\u6548\uff0c\u901a\u8fc7SSO\u7684\u63a5\u53e3\u8fdb\u884c\u6821\u9a8c User user = this . userService . queryUserByToken ( token ); if ( null == user ) { //token\u975e\u6cd5\u6216\u5df2\u7ecf\u8fc7\u671f return null ; } //\u67e5\u8be2\u63a8\u8350\u7528\u6237\uff08\u4eca\u65e5\u4f73\u4eba\uff09 TodayBest todayBest = this . recommendUserService . queryTodayBest ( user . getId ()); if ( null == todayBest ){ //\u7ed9\u51fa\u9ed8\u8ba4\u7684\u63a8\u8350\u7528\u6237 todayBest = new TodayBest (); todayBest . setId ( defaultUser ); todayBest . setFateValue ( 80L ); //\u56fa\u5b9a\u503c } //\u8865\u5168\u4e2a\u4eba\u4fe1\u606f UserInfo userInfo = this . userInfoService . queryUserInfoByUserId ( todayBest . getId ()); if ( null == userInfo ){ return null ; } todayBest . setAvatar ( userInfo . getLogo ()); todayBest . setNickname ( userInfo . getNickName ()); todayBest . setTags ( StringUtils . split ( userInfo . getTags (), ',' )); todayBest . setGender ( userInfo . getSex (). getValue () == 1 ? \"man\" : \"woman\" ); todayBest . setAge ( userInfo . getAge ()); return todayBest ; } } 3.3.3.4\u3001UserService \u00b6 package com.tanhua.server.service ; import com.fasterxml.jackson.databind.ObjectMapper ; import com.tanhua.server.pojo.User ; import lombok.extern.slf4j.Slf4j ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.stereotype.Service ; import org.springframework.web.client.RestTemplate ; @Service @Slf4j public class UserService { @Autowired private RestTemplate restTemplate ; @Value ( \"${tanhua.sso.url}\" ) private String ssoUrl ; private static final ObjectMapper MAPPER = new ObjectMapper (); /** * \u901a\u8fc7sso\u7684rest\u63a5\u53e3\u67e5\u8be2 * * @param token * @return */ public User queryUserByToken ( String token ) { String url = ssoUrl + \"/user/\" + token ; try { String data = this . restTemplate . getForObject ( url , String . class ); if ( StringUtils . isEmpty ( data )) { return null ; } return MAPPER . readValue ( data , User . class ); } catch ( Exception e ) { log . error ( \"\u6821\u9a8ctoken\u51fa\u9519\uff0ctoken = \" + token , e ); } return null ; } } package com.tanhua.server.config ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; import org.springframework.http.client.ClientHttpRequestFactory ; import org.springframework.http.client.SimpleClientHttpRequestFactory ; import org.springframework.http.converter.StringHttpMessageConverter ; import org.springframework.web.client.RestTemplate ; import java.nio.charset.Charset ; @Configuration public class RestTemplateConfig { @Bean public RestTemplate restTemplate ( ClientHttpRequestFactory factory ) { RestTemplate restTemplate = new RestTemplate ( factory ); // \u652f\u6301\u4e2d\u6587\u7f16\u7801 restTemplate . getMessageConverters (). set ( 1 , new StringHttpMessageConverter ( Charset . forName ( \"UTF-8\" ))); return restTemplate ; } @Bean public ClientHttpRequestFactory simpleClientHttpRequestFactory () { SimpleClientHttpRequestFactory factory = new SimpleClientHttpRequestFactory (); factory . setReadTimeout ( 5000 ); //\u5355\u4f4d\u4e3ams factory . setConnectTimeout ( 5000 ); //\u5355\u4f4d\u4e3ams return factory ; } } 3.3.3.5\u3001RecommendUserService \u00b6 package com.tanhua.server.service ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.dubbo.server.api.RecommendUserApi ; import com.tanhua.dubbo.server.pojo.RecommendUser ; import com.tanhua.server.vo.TodayBest ; import org.springframework.stereotype.Service ; /** * \u8d1f\u8d23\u4e0edubbo\u670d\u52a1\u8fdb\u884c\u4ea4\u4e92 */ @Service public class RecommendUserService { @Reference ( version = \"1.0.0\" ) private RecommendUserApi recommendUserApi ; public TodayBest queryTodayBest ( Long userId ) { RecommendUser recommendUser = this . recommendUserApi . queryWithMaxScore ( userId ); if ( null == recommendUser ){ return null ; } TodayBest todayBest = new TodayBest (); todayBest . setId ( recommendUser . getUserId ()); //\u7f18\u5206\u503c double score = Math . floor ( recommendUser . getScore ()); //\u53d6\u6574,98.2 -> 98 todayBest . setFateValue ( Double . valueOf ( score ). longValue ()); return todayBest ; } } 3.3.3.6\u3001UserInfoService \u00b6 package com.tanhua.server.service ; import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper ; import com.tanhua.server.mapper.UserInfoMapper ; import com.tanhua.server.pojo.UserInfo ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; @Service public class UserInfoService { @Autowired private UserInfoMapper userInfoMapper ; public UserInfo queryUserInfoByUserId ( Long userId ) { QueryWrapper < UserInfo > queryWrapper = new QueryWrapper <> (); queryWrapper . eq ( \"user_id\" , userId ); return this . userInfoMapper . selectOne ( queryWrapper ); } } 3.3.3.7\u3001UserInfoMapper \u00b6 package com.tanhua.server.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.common.pojo.UserInfo ; public interface UserInfoMapper extends BaseMapper < UserInfo > { } 3.3.4\u3001\u6d4b\u8bd5 \u00b6 \u5355\u5143\u6d4b\u8bd5\uff0c\u6d4b\u8bd5dubbo\u670d\u52a1\uff1a package com.tanhua.server ; import com.tanhua.server.service.RecommendUserService ; import com.tanhua.server.vo.TodayBest ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringJUnit4ClassRunner ; @SpringBootTest @RunWith ( SpringJUnit4ClassRunner . class ) public class TestRecommendUserApi { @Autowired private RecommendUserService recommendUserService ; @Test public void testQueryTodayBest (){ TodayBest todayBest = this . recommendUserService . queryTodayBest ( 1L ); System . out . println ( todayBest ); } } \u6574\u5408\u529f\u80fd\u6d4b\u8bd5\uff0c\u9700\u8981\u5c06sso\u3001dubbo\u670d\u52a1\u542f\u52a8\u5b8c\u6210\u540e\u8fdb\u884c\u6d4b\u8bd5\u3002 3.3.5\u3001\u89e3\u51b3MongoDB\u542f\u52a8bug \u00b6 \u5728\u9879\u76ee\u4e2d\uff0c\u6dfb\u52a0\u4e86mongo\u7684\u4f9d\u8d56\u7684\u8bdd\uff0cspringboot\u5c31\u4f1a\u81ea\u52a8\u53bb\u8fde\u63a5\u672c\u5730\u7684mongo\uff0c\u7531\u4e8e\u4ed6\u8fde\u63a5\u4e0d\u4e0a\u4f1a\u5bfc\u81f4\u51fa\u9519\u3002 \u89e3\u51b3\uff1a springboot\u4e2d\u6dfb\u52a0\u6392\u9664\u81ea\u52a8\u914d\u7f6e\u7684\u6ce8\u89e3 package com.tanhua.server ; import org.mybatis.spring.annotation.MapperScan ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; import org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration ; import org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration ; @MapperScan ( \"com.tanhua.server.mapper\" ) //\u8bbe\u7f6emapper\u63a5\u53e3\u7684\u626b\u63cf\u5305 @SpringBootApplication ( exclude = { MongoAutoConfiguration . class , MongoDataAutoConfiguration . class }) //\u6392\u9664mongo\u7684\u81ea\u52a8\u914d\u7f6e public class ServerApplication { public static void main ( String [] args ) { SpringApplication . run ( ServerApplication . class , args ); } } 4\u3001\u63a8\u8350\u5217\u8868 \u00b6 4.1\u3001mock\u63a5\u53e3 \u00b6 \u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/623 4.2\u3001\u67e5\u8be2\u53c2\u6570\u5bf9\u8c61 \u00b6 package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class RecommendUserQueryParam { private Integer page = 1 ; //\u5f53\u524d\u9875\u6570 private Integer pagesize = 10 ; //\u9875\u5c3a\u5bf8 private String gender ; //\u6027\u522b man woman private String lastLogin ; //\u8fd1\u671f\u767b\u9646\u65f6\u95f4 private Integer age ; //\u5e74\u9f84 private String city ; //\u5c45\u4f4f\u5730 private String education ; //\u5b66\u5386 } 4.3\u3001\u7ed3\u679c\u5bf9\u8c61 \u00b6 package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import java.util.Collections ; import java.util.List ; @Data @AllArgsConstructor @NoArgsConstructor public class PageResult { private Integer counts = 0 ; //\u603b\u8bb0\u5f55\u6570 private Integer pagesize = 0 ; //\u9875\u5927\u5c0f private Integer pages = 0 ; //\u603b\u9875\u6570 private Integer page = 0 ; //\u5f53\u524d\u9875\u7801 private List <?> items = Collections . emptyList (); //\u5217\u8868 } 4.4\u3001Controller \u00b6 /** * \u67e5\u8be2\u63a8\u8350\u7528\u6237\u5217\u8868 * * @param token * @param queryParam * @return */ @GetMapping ( \"recommendation\" ) public ResponseEntity < PageResult > queryRecommendation ( @RequestHeader ( \"Authorization\" ) String token , RecommendUserQueryParam queryParam ){ try { PageResult pageResult = this . todayBestService . queryRecommendation ( token , queryParam ); if ( null != pageResult ) { return ResponseEntity . ok ( pageResult ); } } catch ( Exception e ) { log . error ( \"\u67e5\u8be2\u63a8\u8350\u7528\u6237\u5217\u8868\u51fa\u9519~ token = \" + token , e ); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). body ( null ); } 4.5\u3001Service \u00b6 /** * \u67e5\u8be2\u63a8\u8350\u7528\u6237\u5217\u8868 * * @param queryParam * @param token * @return */ public PageResult queryRecommendation ( String token , RecommendUserQueryParam queryParam ) { //\u6821\u9a8ctoken\u662f\u5426\u6709\u6548\uff0c\u901a\u8fc7SSO\u7684\u63a5\u53e3\u8fdb\u884c\u6821\u9a8c User user = this . userService . queryUserByToken ( token ); if ( null == user ) { //token\u975e\u6cd5\u6216\u5df2\u7ecf\u8fc7\u671f return null ; } PageResult pageResult = new PageResult (); pageResult . setPage ( queryParam . getPage ()); pageResult . setPagesize ( queryParam . getPagesize ()); PageInfo < RecommendUser > pageInfo = this . recommendUserService . queryRecommendUserList ( user . getId (), queryParam . getPage (), queryParam . getPagesize ()); List < RecommendUser > records = pageInfo . getRecords (); if ( CollectionUtils . isEmpty ( records )) { //\u6ca1\u6709\u67e5\u8be2\u5230\u63a8\u8350\u7684\u7528\u6237\u5217\u8868 return pageResult ; } //\u586b\u5145\u4e2a\u4eba\u4fe1\u606f //\u6536\u96c6\u63a8\u8350\u7528\u6237\u7684id Set < Long > userIds = new HashSet <> (); for ( RecommendUser record : records ) { userIds . add ( record . getUserId ()); } QueryWrapper < UserInfo > queryWrapper = new QueryWrapper <> (); //\u7528\u6237id\u53c2\u6570 queryWrapper . in ( \"user_id\" , userIds ); if ( StringUtils . isNotEmpty ( queryParam . getGender ())) { //\u9700\u8981\u6027\u522b\u53c2\u6570\u67e5\u8be2 queryWrapper . eq ( \"sex\" , StringUtils . equals ( queryParam . getGender (), \"man\" ) ? 1 : 2 ); } if ( StringUtils . isNotEmpty ( queryParam . getCity ())) { //\u9700\u8981\u57ce\u5e02\u53c2\u6570\u67e5\u8be2 queryWrapper . like ( \"city\" , queryParam . getCity ()); } if ( queryParam . getAge () != null ) { //\u8bbe\u7f6e\u5e74\u9f84\u53c2\u6570\uff0c\u6761\u4ef6\uff1a\u5c0f\u4e8e\u7b49\u4e8e queryWrapper . le ( \"age\" , queryParam . getAge ()); } List < UserInfo > userInfoList = this . userInfoService . queryUserInfoList ( queryWrapper ); if ( CollectionUtils . isEmpty ( userInfoList )){ //\u6ca1\u6709\u67e5\u8be2\u5230\u7528\u6237\u7684\u57fa\u672c\u4fe1\u606f return pageResult ; } List < TodayBest > todayBests = new ArrayList <> (); for ( UserInfo userInfo : userInfoList ) { TodayBest todayBest = new TodayBest (); todayBest . setId ( userInfo . getUserId ()); todayBest . setAvatar ( userInfo . getLogo ()); todayBest . setNickname ( userInfo . getNickName ()); todayBest . setTags ( StringUtils . split ( userInfo . getTags (), ',' )); todayBest . setGender ( userInfo . getSex (). getValue () == 1 ? \"man\" : \"woman\" ); todayBest . setAge ( userInfo . getAge ()); //\u7f18\u5206\u503c for ( RecommendUser record : records ) { if ( record . getUserId (). longValue () == userInfo . getUserId (). longValue ()){ double score = Math . floor ( record . getScore ()); //\u53d6\u6574,98.2 -> 98 todayBest . setFateValue ( Double . valueOf ( score ). longValue ()); break ; } } todayBests . add ( todayBest ); } //\u6309\u7167\u7f18\u5206\u503c\u8fdb\u884c\u5012\u5e8f\u6392\u5e8f Collections . sort ( todayBests , ( o1 , o2 ) -> new Long ( o2 . getFateValue () - o1 . getFateValue ()). intValue ()); pageResult . setItems ( todayBests ); return pageResult ; } //RecommendUserService public PageInfo < RecommendUser > queryRecommendUserList ( Long id , Integer page , Integer pagesize ) { return this . recommendUserApi . queryPageInfo ( id , page , pagesize ); } //UserInfoService /** * \u67e5\u8be2\u7528\u6237\u4fe1\u606f\u5217\u8868 * * @param queryWrapper * @return */ public List < UserInfo > queryUserInfoList ( QueryWrapper queryWrapper ) { return this . userInfoMapper . selectList ( queryWrapper ); } 4.6\u3001\u6d4b\u8bd5 \u00b6 5\u3001\u7f13\u5b58 \u00b6 \u5728\u63a5\u53e3\u670d\u52a1\u4e2d\uff0c\u6709\u5fc5\u8981\u5bf9\u4e8e\u63a5\u53e3\u8fdb\u884c\u7f13\u5b58\u5904\u7406\uff0c\u5c24\u5176\u662fGET\u8bf7\u6c42\uff0c\u5982\u679c\u6bcf\u4e2a\u63a5\u53e3\u5355\u72ec\u6dfb\u52a0\u7684\u8bdd\u4f1a\u5b58\u5728\u5f88\u591a\u7684\u91cd\u590d\u7684\u903b\u8f91\uff0c\u6240\u4ee5\u53ef\u4ee5\u7f16\u5199\u4e00\u5957\u901a\u7528\u7684\u89e3\u51b3\u65b9\u6848\u3002 \u5b9e\u73b0\u601d\u8def\uff1a \u901a\u8fc7\u62e6\u622a\u5668\u5b9e\u73b0\u5bf9\u8bf7\u6c42\u7684\u62e6\u622a\uff0c\u5728\u62e6\u622a\u5668\u4e2d\u5b9e\u73b0\u7f13\u5b58\u7684\u547d\u4e2d\u3002 \u901a\u8fc7ResponseBodyAdvice\u8fdb\u884c\u5bf9\u54cd\u5e94\u7684\u62e6\u622a\uff0c\u53ef\u4ee5\u5c06\u6570\u636e\u7f13\u5b58\u5230Redis\u4e2d\u3002 \u8003\u8651\u5230\uff0c\u4e0d\u80fd\u5bf9\u4e8e\u6240\u6709\u7684\u8bf7\u6c42\u90fd\u4e00\u5200\u5207\uff0c\u6240\u4ee5\u9700\u8981\u521b\u5efa@Cache\u6ce8\u89e3\u8fdb\u884c\u6807\u8bb0\uff0c\u53ea\u6709\u6807\u8bb0\u7684Controller\u624d\u8fdb\u884c\u7f13\u5b58\u5904\u7406\u3002 \u7f13\u5b58\u7684\u5904\u7406\u4e2d\uff0c\u4ec5\u9488\u5bf9GET\u8bf7\u6c42\u5904\u7406\uff0c\u5176\u4ed6\u7684\u8bf7\u6c42\u5747\u4e0d\u505a\u5904\u7406\u3002 5.1\u3001\u81ea\u5b9a\u4e49\u6ce8\u89e3 \u00b6 package com.tanhua.server.utils ; import java.lang.annotation.* ; /** * \u88ab\u6807\u8bb0\u4e3aCache\u7684Controller\u8fdb\u884c\u7f13\u5b58\uff0c\u5176\u4ed6\u60c5\u51b5\u4e0d\u8fdb\u884c\u7f13\u5b58 */ @Target ( ElementType . METHOD ) @Retention ( RetentionPolicy . RUNTIME ) @Documented //\u6807\u8bb0\u6ce8\u89e3 public @interface Cache { /** * \u7f13\u5b58\u65f6\u95f4\uff0c\u9ed8\u8ba4\u4e3a60\u79d2 * @return */ String time () default \"60\" ; } 5.2\u3001\u91c7\u7528\u62e6\u622a\u5668\u8fdb\u884c\u7f13\u5b58\u547d\u4e2d \u00b6 \u7f16\u5199\u62e6\u622a\u5668\uff1aRedisCacheInterceptor\u3002 package com.tanhua.server.interceptor ; import com.fasterxml.jackson.databind.ObjectMapper ; import com.tanhua.server.utils.Cache ; import org.apache.commons.codec.digest.DigestUtils ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.data.redis.core.RedisTemplate ; import org.springframework.stereotype.Component ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.method.HandlerMethod ; import org.springframework.web.servlet.HandlerInterceptor ; import javax.servlet.http.HttpServletRequest ; import javax.servlet.http.HttpServletResponse ; @Component public class RedisCacheInterceptor implements HandlerInterceptor { @Value ( \"${tanhua.cache.enable}\" ) private Boolean enable ; @Autowired private RedisTemplate < String , String > redisTemplate ; private static final ObjectMapper MAPPER = new ObjectMapper (); @Override public boolean preHandle ( HttpServletRequest request , HttpServletResponse response , Object handler ) throws Exception { //\u7f13\u5b58\u7684\u5168\u5c40\u5f00\u5173\u7684\u6821\u9a8c if ( ! enable ) { return true ; } //\u6821\u9a8chandler\u662f\u5426\u662fHandlerMethod if ( ! ( handler instanceof HandlerMethod )) { return true ; } //\u5224\u65ad\u662f\u5426\u4e3aget\u8bf7\u6c42 if ( ! (( HandlerMethod ) handler ). hasMethodAnnotation ( GetMapping . class )) { return true ; } //\u5224\u65ad\u662f\u5426\u6dfb\u52a0\u4e86@Cache\u6ce8\u89e3 if ( ! (( HandlerMethod ) handler ). hasMethodAnnotation ( Cache . class )) { return true ; } //\u7f13\u5b58\u547d\u4e2d String redisKey = createRedisKey ( request ); String cacheData = this . redisTemplate . opsForValue (). get ( redisKey ); if ( StringUtils . isEmpty ( cacheData )){ //\u7f13\u5b58\u672a\u547d\u4e2d return true ; } // \u5c06data\u6570\u636e\u8fdb\u884c\u54cd\u5e94 response . setCharacterEncoding ( \"UTF-8\" ); response . setContentType ( \"application/json; charset=utf-8\" ); response . getWriter (). write ( cacheData ); return false ; } /** * \u751f\u6210redis\u4e2d\u7684key\uff0c\u89c4\u5219\uff1aSERVER_CACHE_DATA_MD5(url + param + token) * * @param request * @return */ public static String createRedisKey ( HttpServletRequest request ) throws Exception { String url = request . getRequestURI (); String param = MAPPER . writeValueAsString ( request . getParameterMap ()); String token = request . getHeader ( \"Authorization\" ); String data = url + \"_\" + param + \"_\" + token ; return \"SERVER_CACHE_DATA_\" + DigestUtils . md5Hex ( data ); } } application.properties\uff1a #\u662f\u5426\u5f00\u542f\u6570\u636e\u7f13\u5b58 tanhua.cache.enable = false # Redis\u76f8\u5173\u914d\u7f6e spring.redis.jedis.pool.max-wait = 5000ms spring.redis.jedis.pool.max-Idle = 100 spring.redis.jedis.pool.min-Idle = 10 spring.redis.timeout = 10s spring.redis.cluster.nodes = 192.168.31.81:6379,192.168.31.81:6380,192.168.31.81:6381 spring.redis.cluster.max-redirects = 5 \u6ce8\u518c\u62e6\u622a\u5668\u5230Spring\u5bb9\u5668\uff1a package com.tanhua.server.config ; import com.tanhua.server.interceptor.RedisCacheInterceptor ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.context.annotation.Configuration ; import org.springframework.web.servlet.config.annotation.InterceptorRegistry ; import org.springframework.web.servlet.config.annotation.WebMvcConfigurer ; @Configuration public class WebConfig implements WebMvcConfigurer { @Autowired private RedisCacheInterceptor redisCacheInterceptor ; @Override public void addInterceptors ( InterceptorRegistry registry ) { registry . addInterceptor ( this . redisCacheInterceptor ). addPathPatterns ( \"/**\" ); } } 4.3\u3001\u54cd\u5e94\u7ed3\u679c\u5199\u5165\u5230\u7f13\u5b58 \u00b6 \u4f7f\u7528ResponseBodyAdvice\u8fdb\u884c\u5bf9\u54cd\u5e94\u7ed3\u679c\u5904\u7406\uff0c\u5c06\u7ed3\u679c\u5199\u5165\u5230Redis\u4e2d\uff1a \u5177\u4f53\u5b9e\u73b0\uff1a package com.tanhua.server.interceptor ; import com.fasterxml.jackson.databind.ObjectMapper ; import com.tanhua.server.utils.Cache ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.core.MethodParameter ; import org.springframework.data.redis.core.RedisTemplate ; import org.springframework.http.MediaType ; import org.springframework.http.server.ServerHttpRequest ; import org.springframework.http.server.ServerHttpResponse ; import org.springframework.http.server.ServletServerHttpRequest ; import org.springframework.web.bind.annotation.ControllerAdvice ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.servlet.mvc.method.annotation.ResponseBodyAdvice ; import java.util.concurrent.TimeUnit ; @ControllerAdvice public class MyResponseBodyAdvice implements ResponseBodyAdvice { @Value ( \"${tanhua.cache.enable}\" ) private Boolean enable ; @Autowired private RedisTemplate < String , String > redisTemplate ; private static final ObjectMapper MAPPER = new ObjectMapper (); @Override public boolean supports ( MethodParameter returnType , Class converterType ) { // \u5f00\u5173\u5904\u4e8e\u5f00\u542f\u72b6\u6001 \u662fget\u8bf7\u6c42 \u5305\u542b\u4e86@Cache\u6ce8\u89e3 return enable && returnType . hasMethodAnnotation ( GetMapping . class ) && returnType . hasMethodAnnotation ( Cache . class ); } @Override public Object beforeBodyWrite ( Object body , MethodParameter returnType , MediaType selectedContentType , Class selectedConverterType , ServerHttpRequest request , ServerHttpResponse response ) { if ( null == body ) { return null ; } try { String redisValue = null ; if ( body instanceof String ) { redisValue = ( String ) body ; } else { redisValue = MAPPER . writeValueAsString ( body ); } String redisKey = RedisCacheInterceptor . createRedisKey ((( ServletServerHttpRequest ) request ). getServletRequest ()); Cache cache = returnType . getMethodAnnotation ( Cache . class ); //\u7f13\u5b58\u7684\u65f6\u95f4\u5355\u4f4d\u662f\u79d2 this . redisTemplate . opsForValue (). set ( redisKey , redisValue , Long . valueOf ( cache . time ()), TimeUnit . SECONDS ); } catch ( Exception e ) { e . printStackTrace (); } return body ; } } 4.4\u3001\u6d4b\u8bd5 \u00b6 \u53ef\u4ee5\u770b\u5230\u6570\u636e\u5df2\u7ecf\u7f13\u5b58\u5230Redis\u4e2d\uff0c\u5e76\u4e14\u5176\u7f13\u5b58\u65f6\u95f4\u4e5f\u662f30\u79d2\uff0c\u4e0e\u9884\u671f\u4e00\u81f4\u3002 6\u3001\u6574\u5408\u6d4b\u8bd5 \u00b6 \u6d4b\u8bd5\u65f6\u9700\u8981\u6ce8\u610f\uff0c\u7531\u4e8e\u7528\u6237\u6570\u636e\u8f83\u5c11\uff0c\u6240\u4ee5\u6d4b\u8bd5\u65f6\u9700\u8981\u628a\u6761\u4ef6\u6ce8\u91ca\u6389\uff0c\u5426\u5219\u67e5\u8be2\u4e0d\u5230\u6570\u636e\uff1a \u6548\u679c\uff1a","title":"day03"},{"location":"tantan/day03/#_1","text":"\u9996\u9875\u529f\u80fd\u8bf4\u660e \u7cfb\u7edf\u67b6\u6784\u8bf4\u660e \u5b9e\u73b0\u4eca\u65e5\u4f73\u4eba\u529f\u80fd \u5b9e\u73b0\u63a8\u8350\u7528\u6237\u7684\u5217\u8868 \u63a5\u53e3\u589e\u52a0\u7f13\u5b58\u529f\u80fd \u6574\u5408\u524d\u7aef\u8054\u8c03\u6d4b\u8bd5","title":"\u8bfe\u7a0b\u8bf4\u660e"},{"location":"tantan/day03/#1","text":"\u5728\u7528\u6237\u767b\u5f55\u6210\u529f\u540e\uff0c\u5c31\u4f1a\u8fdb\u5165\u9996\u9875\uff0c\u9996\u9875\u4e2d\u6709\u4eca\u65e5\u4f73\u4eba\u3001\u63a8\u8350\u597d\u53cb\u3001\u63a2\u82b1\u3001\u641c\u9644\u8fd1\u7b49\u529f\u80fd\u3002","title":"1\u3001\u9996\u9875"},{"location":"tantan/day03/#2","text":"\u5728\u5f00\u53d1\u5b8cSSO\u7cfb\u7edf\u4e2d\u7684\u767b\u5f55\u529f\u80fd\u540e\uff0c\u63a5\u4e0b\u6765\u5c31\u9700\u8981\u5b9e\u73b0\u5176\u4ed6\u7684\u529f\u80fd\uff0c\u5728\u6574\u4f53\u67b6\u6784\u4e2d\uff0c\u5b8c\u6210\u4e0eAPP\u5bf9\u63a5\u7684\u670d\u52a1\u5de5\u7a0b\u53ebmy-tanhua-server\uff0c\u771f\u6b63\u7684\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\u4f7f\u7528dubbo\u5b8c\u6210\uff0c\u5176\u5de5\u7a0b\u540d\u53eb\uff1amy-tanhua-dubbo\uff0c\u5b83\u4eec\u7684\u67b6\u6784\u793a\u610f\u56fe\u5982\u4e0b\uff1a \u8bf4\u660e\uff1a \u5ba2\u6237\u7aefAPP\u53d1\u8d77\u8bf7\u6c42\u5230Nginx\uff0c\u5728Nginx\u4e2d\u5bf9\u8bf7\u6c42\u505a\u51fa\u5224\u65ad\uff0c\u5c06\u8bf7\u6c42\u8f6c\u53d1\u81f3sso\u7cfb\u7edf\u6216server\u7cfb\u7edf\u3002 sso\u7cfb\u7edf\u4e2d\uff0c\u5c06\u5bf9\u63a5\u7b2c\u4e09\u65b9\u5e73\u53f0\u4ee5\u53ca\u5b8c\u6210\u6570\u636e\u7684\u7f13\u5b58\u3001\u6d88\u606f\u53d1\u9001\u3001\u7528\u6237\u7684\u6ce8\u518c\u767b\u5f55\u529f\u80fd\u3002 server\u7cfb\u7edf\u4e3aAPP\u63d0\u4f9b\u4e86\u63a5\u53e3\u670d\u52a1\u7684\u652f\u6491 \u7528\u6237\u8bf7\u6c42\u4e2d\u643a\u5e26\u7684token\u9700\u8981\u5230sso\u7cfb\u7edf\u4e2d\u8fdb\u884c\u6821\u9a8c \u901a\u8fc7rpc\u8c03\u7528dubbo\u4e2d\u63d0\u4f9b\u7684\u670d\u52a1\uff0c\u5728dubbo\u670d\u52a1\u4e2d\u4e0eMongoDB\u5bf9\u63a5\uff0c\u5b8c\u6210\u6570\u636e\u7684CRUD\u64cd\u4f5c \u5c06\u4e00\u4e9b\u6570\u636e\u7f13\u5b58\u5230Redis\uff0c\u4ece\u800c\u63d0\u5347\u6570\u636e\u67e5\u8be2\u6027\u80fd \u7528\u6237\u6570\u636e\u7684\u67e5\u8be2\u5c06\u57fa\u4e8eMySQL\u6570\u636e\u5e93\u8fdb\u884c\u67e5\u8be2","title":"2\u3001\u7cfb\u7edf\u67b6\u6784"},{"location":"tantan/day03/#21nginx","text":"","title":"2.1\u3001nginx\u670d\u52a1"},{"location":"tantan/day03/#211","text":"\u5b89\u88c5\u5305\u5728\u8d44\u6599\u4e2d\uff1anginx-1.17.3.zip \u5b89\u88c5\u5728\u4efb\u610f\u76ee\u5f55\uff0c\u901a\u8fc7\u547d\u4ee4\uff1astart nginx.exe \u542f\u52a8\uff1a \u91cd\u542f\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\u547d\u4ee4\uff1anginx.exe -s reload","title":"2.1.1\u3001\u90e8\u7f72\u5b89\u88c5"},{"location":"tantan/day03/#212","text":"\u4fee\u6539conf\u76ee\u5f55\u4e0b\u7684nginx.conf\u6587\u4ef6\uff1a #user nobody; worker_processes 1 ; #error_log logs/error.log; #error_log logs/error.log notice; #error_log logs/error.log info; #pid logs/nginx.pid; events { worker_connections 1024 ; } http { include mime.types ; default_type application/octet-stream ; #log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' # '$status $body_bytes_sent \"$http_referer\" ' # '\"$http_user_agent\" \"$http_x_forwarded_for\"'; #access_log logs/access.log main; sendfile on ; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65 ; #gzip on; server { listen 80 ; server_name localhost ; #charset koi8-r; #access_log logs/host.access.log main; #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html ; location = /50x.html { root html ; } location /user/ { #\u8bf7\u6c42\u8def\u5f84\u4e2d\u51e1\u662f\u4ee5/user/\u5f00\u5934\u7684\u8bf7\u6c42\uff0c\u8f6c\u53d1\u5230sso\u7cfb\u7edf client_max_body_size 300m ; #\u8bbe\u7f6e\u6700\u5927\u7684\u8bf7\u6c42\u4f53\u5927\u5c0f\uff0c\u89e3\u51b3\u5927\u6587\u4ef6\u4e0a\u4f20\u4e0d\u4e86\u7684\u95ee\u9898 proxy_connect_timeout 300s ; #\u4ee3\u7406\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4 proxy_send_timeout 300s ; #\u4ee3\u7406\u53d1\u9001\u6570\u636e\u7684\u8d85\u65f6\u65f6\u95f4 proxy_read_timeout 300s ; #\u4ee3\u7406\u8bfb\u53d6\u6570\u636e\u7684\u8d85\u65f6\u65f6\u95f4 proxy_pass http://127.0.0.1:18080 ; #\u8f6c\u53d1\u8bf7\u6c42 } location / { #\u4e0a\u9762\u672a\u5339\u914d\u5230\u7684\u5728\u8fd9\u91cc\u5904\u7406 client_max_body_size 300m ; proxy_connect_timeout 300s ; proxy_send_timeout 300s ; proxy_read_timeout 300s ; proxy_pass http://127.0.0.1:18081 ; #\u8f6c\u53d1\u8bf7\u6c42\u5230server\u7cfb\u7edf } } }","title":"2.1.2\u3001\u914d\u7f6e"},{"location":"tantan/day03/#213","text":"","title":"2.1.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day03/#22server","text":"","title":"2.2\u3001\u642d\u5efaserver\u5de5\u7a0b"},{"location":"tantan/day03/#221","text":"pom.xml\u6587\u4ef6\uff1a <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <parent> <artifactId> my-tanhua </artifactId> <groupId> cn.itcast.tanhua </groupId> <version> 1.0-SNAPSHOT </version> </parent> <modelVersion> 4.0.0 </modelVersion> <artifactId> my-tanhua-server </artifactId> <dependencies> <dependency> <groupId> cn.itcast.tanhua </groupId> <artifactId> my-tanhua-dubbo-interface </artifactId> <version> 1.0-SNAPSHOT </version> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-web </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-test </artifactId> <scope> test </scope> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-redis </artifactId> </dependency> <!--dubbo\u7684springboot\u652f\u6301--> <dependency> <groupId> com.alibaba.boot </groupId> <artifactId> dubbo-spring-boot-starter </artifactId> </dependency> <!--dubbo\u6846\u67b6--> <dependency> <groupId> com.alibaba </groupId> <artifactId> dubbo </artifactId> </dependency> <!--zk\u4f9d\u8d56--> <dependency> <groupId> org.apache.zookeeper </groupId> <artifactId> zookeeper </artifactId> </dependency> <dependency> <groupId> com.github.sgroschupf </groupId> <artifactId> zkclient </artifactId> </dependency> <dependency> <groupId> org.apache.commons </groupId> <artifactId> commons-lang3 </artifactId> </dependency> <dependency> <groupId> org.apache.commons </groupId> <artifactId> commons-collections4 </artifactId> <version> 4.4 </version> </dependency> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus </artifactId> </dependency> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus-boot-starter </artifactId> </dependency> <dependency> <groupId> mysql </groupId> <artifactId> mysql-connector-java </artifactId> </dependency> <dependency> <groupId> commons-io </groupId> <artifactId> commons-io </artifactId> <version> 2.6 </version> </dependency> <dependency> <groupId> commons-codec </groupId> <artifactId> commons-codec </artifactId> </dependency> </dependencies> </project>","title":"2.2.1\u3001\u5bfc\u5165\u4f9d\u8d56"},{"location":"tantan/day03/#222applicationproperties","text":"spring.application.name = itcast-tanhua-server server.port = 18081 #\u6570\u636e\u5e93\u8fde\u63a5\u4fe1\u606f spring.datasource.driver-class-name = com.mysql.jdbc.Driver spring.datasource.url = jdbc:mysql://192.168.31.81:3306/mytanhua?useUnicode=true&characterEncoding=utf8&autoReconnect=true&allowMultiQueries=true&useSSL=false spring.datasource.username = root spring.datasource.password = root # \u679a\u4e3e\u5305\u626b\u63cf mybatis-plus.type-enums-package = com.tanhua.server.enums # \u8868\u540d\u524d\u7f00 mybatis-plus.global-config.db-config.table-prefix = tb_ # id\u7b56\u7565\u4e3a\u81ea\u589e\u957f mybatis-plus.global-config.db-config.id-type = auto #dubbo\u6ce8\u518c\u4e2d\u5fc3\u914d\u7f6e dubbo.application.name = itcast-tanhua-server dubbo.registry.address = zookeeper://192.168.31.81:2181 dubbo.registry.client = zkclient dubbo.registry.timeout = 60000 dubbo.consumer.timeout = 60000 #sso\u7cfb\u7edf\u670d\u52a1\u5730\u5740 tanhua.sso.url = http://127.0.0.1 #\u9ed8\u8ba4\u4eca\u65e5\u4f73\u4eba\u63a8\u8350\u7528\u6237 tanhua.sso.default.user = 2","title":"2.2.2\u3001application.properties"},{"location":"tantan/day03/#223serverapplication","text":"package com.tanhua.server ; import org.mybatis.spring.annotation.MapperScan ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; @MapperScan ( \"com.tanhua.server.mapper\" ) //\u8bbe\u7f6emapper\u63a5\u53e3\u7684\u626b\u63cf\u5305 @SpringBootApplication public class ServerApplication { public static void main ( String [] args ) { SpringApplication . run ( ServerApplication . class , args ); } }","title":"2.2.3\u3001ServerApplication"},{"location":"tantan/day03/#23dubbo","text":"my-tanhua-dubbo\u662fdubbo\u5de5\u7a0b\u7684\u7236\u5de5\u7a0b\uff1a ~~~xml my-tanhua cn.itcast.tanhua 1.0-SNAPSHOT 4.0.0 <artifactId> my-tanhua-dubbo </artifactId> <packaging> pom </packaging> <modules> <module> my-tanhua-dubbo-interface </module> <module> my-tanhua-dubbo-service </module> </modules> ~~~","title":"2.3\u3001\u642d\u5efadubbo\u5de5\u7a0b"},{"location":"tantan/day03/#231my-tanhua-dubbo-interface","text":"\u8be5\u5de5\u7a0b\u4e2d\u5b9a\u4e49\u4e86dubbo\u670d\u52a1\u4e2d\u7684interface\u4e0e\u5b9e\u4f53\u5bf9\u8c61\u3002 <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <parent> <artifactId> my-tanhua-dubbo </artifactId> <groupId> cn.itcast.tanhua </groupId> <version> 1.0-SNAPSHOT </version> </parent> <modelVersion> 4.0.0 </modelVersion> <artifactId> my-tanhua-dubbo-interface </artifactId> <dependencies> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-mongodb </artifactId> </dependency> </dependencies> </project>","title":"2.3.1\u3001\u521b\u5efamy-tanhua-dubbo-interface\u5de5\u7a0b"},{"location":"tantan/day03/#232my-tanhua-dubbo-service","text":"<?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <parent> <artifactId> my-tanhua-dubbo </artifactId> <groupId> cn.itcast.tanhua </groupId> <version> 1.0-SNAPSHOT </version> </parent> <modelVersion> 4.0.0 </modelVersion> <artifactId> my-tanhua-dubbo-service </artifactId> <dependencies> <!--\u5f15\u5165interface\u4f9d\u8d56--> <dependency> <groupId> cn.itcast.tanhua </groupId> <artifactId> my-tanhua-dubbo-interface </artifactId> <version> 1.0-SNAPSHOT </version> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-test </artifactId> <scope> test </scope> </dependency> <!--dubbo\u7684springboot\u652f\u6301--> <dependency> <groupId> com.alibaba.boot </groupId> <artifactId> dubbo-spring-boot-starter </artifactId> </dependency> <!--dubbo\u6846\u67b6--> <dependency> <groupId> com.alibaba </groupId> <artifactId> dubbo </artifactId> </dependency> <!--zk\u4f9d\u8d56--> <dependency> <groupId> org.apache.zookeeper </groupId> <artifactId> zookeeper </artifactId> </dependency> <dependency> <groupId> com.github.sgroschupf </groupId> <artifactId> zkclient </artifactId> </dependency> <!--MongoDB\u76f8\u5173\u4f9d\u8d56--> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-mongodb </artifactId> </dependency> <dependency> <groupId> org.mongodb </groupId> <artifactId> mongodb-driver-sync </artifactId> </dependency> <!--\u5176\u4ed6\u5de5\u5177\u5305\u4f9d\u8d56--> <dependency> <groupId> org.apache.commons </groupId> <artifactId> commons-lang3 </artifactId> </dependency> <dependency> <groupId> joda-time </groupId> <artifactId> joda-time </artifactId> </dependency> <dependency> <groupId> io.netty </groupId> <artifactId> netty-all </artifactId> </dependency> </dependencies> </project> application.properties\uff1a # Spring boot application spring.application.name = itcast-tanhua-dubbo-service # dubbo \u626b\u63cf\u5305\u914d\u7f6e dubbo.scan.basePackages = com.tanhua.dubbo.server dubbo.application.name = dubbo-provider-tanhua #dubbo \u5bf9\u5916\u66b4\u9732\u7684\u7aef\u53e3\u4fe1\u606f dubbo.protocol.name = dubbo dubbo.protocol.port = 20880 #dubbo\u6ce8\u518c\u4e2d\u5fc3\u7684\u914d\u7f6e dubbo.registry.address = zookeeper://192.168.31.81:2181 dubbo.registry.client = zkclient dubbo.registry.timeout = 60000 #springboot MongoDB\u914d\u7f6e spring.data.mongodb.username = tanhua spring.data.mongodb.password = l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV spring.data.mongodb.authentication-database = admin spring.data.mongodb.database = tanhua spring.data.mongodb.port = 27017 spring.data.mongodb.host = 192.168.31.81 \u7f16\u5199\u542f\u52a8\u7c7b\uff1a package com.tanhua.dubbo.server ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; @SpringBootApplication public class DubboApplication { public static void main ( String [] args ) { SpringApplication . run ( DubboApplication . class , args ); } }","title":"2.3.2\u3001\u521b\u5efamy-tanhua-dubbo-service\u5de5\u7a0b"},{"location":"tantan/day03/#24","text":"\u6700\u7ec8\u642d\u5efa\u5b8c\u6210\u7684\u6548\u679c\u5982\u4e0b\uff1a","title":"2.4\u3001\u5de5\u7a0b\u7ed3\u6784"},{"location":"tantan/day03/#3","text":"\u4eca\u65e5\u4f73\u4eba\uff0c\u4f1a\u63a8\u8350\u7f18\u5206\u503c\u6700\u5927\u7684\u7528\u6237\uff0c\u8fdb\u884c\u5c55\u73b0\u51fa\u6765\u3002\u7f18\u5206\u503c\u7684\u8ba1\u7b97\u662f\u7531\u7528\u6237\u7684\u884c\u4e3a\u8fdb\u884c\u6253\u5206\uff0c\u5982\uff1a\u70b9\u51fb\u3001\u70b9\u8d5e\u3001\u8bc4\u8bba\u3001\u5b66\u5386\u3001\u5a5a\u59fb\u72b6\u6001\u7b49\u4fe1\u606f\u7ec4\u5408\u800c\u6210\u7684\u3002 \u5b9e\u73b0\uff1a\u6211\u4eec\u5148\u4e0d\u8003\u8651\u63a8\u8350\u7684\u903b\u8f91\uff0c\u5047\u8bbe\u73b0\u5728\u5df2\u7ecf\u6709\u63a8\u8350\u7684\u7ed3\u679c\uff0c\u6211\u4eec\u53ea\u9700\u8981\u4ece\u7ed3\u679c\u4e2d\u67e5\u8be2\u5230\u7f18\u5206\u503c\u6700\u9ad8\u7684\u7528\u6237\u5c31\u53ef\u4ee5\u4e86\u3002\u81f3\u4e8e\u63a8\u8350\u7684\u903b\u8f91\u4ee5\u53ca\u5b9e\u73b0\uff0c\u6211\u4eec\u5c06\u540e\u9762\u7684\u8bfe\u7a0b\u4e2d\u8bb2\u89e3\u3002 \u6d41\u7a0b\uff1a","title":"3\u3001\u4eca\u65e5\u4f73\u4eba"},{"location":"tantan/day03/#31","text":"#\u8868\u7ed3\u6784\uff0c\u8868\u540d\uff1arecommend_user { \"userId\" :1001, #\u63a8\u8350\u7684\u7528\u6237id \"toUserId\" :1002, #\u7528\u6237id \"score\" :90, #\u63a8\u8350\u5f97\u5206 \"date\" : \"2019/1/1\" #\u65e5\u671f } \u5df2\u7ecf\u63d0\u4f9b\u7684\u6d4b\u8bd5\u6570\u636e\uff084855\u6761\u6570\u636e\uff09\uff1a","title":"3.1\u3001\u8868\u7ed3\u6784"},{"location":"tantan/day03/#32dubbo","text":"","title":"3.2\u3001\u7f16\u5199dubbo\u670d\u52a1"},{"location":"tantan/day03/#321","text":"\u5728my-tanhua-dubbo-interface\u5de5\u7a0b\u4e2d\u5b9a\u4e49\u63a5\u53e3\uff1a package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.vo.PageInfo ; import com.tanhua.dubbo.server.pojo.RecommendUser ; public interface RecommendUserApi { /** * \u67e5\u8be2\u4e00\u4f4d\u5f97\u5206\u6700\u9ad8\u7684\u63a8\u8350\u7528\u6237 * * @param userId * @return */ RecommendUser queryWithMaxScore ( Long userId ); /** * \u6309\u7167\u5f97\u5206\u5012\u5e8f * * @param userId * @param pageNum * @param pageSize * @return */ PageInfo < RecommendUser > queryPageInfo ( Long userId , Integer pageNum , Integer pageSize ); } package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.annotation.Id ; import org.springframework.data.mongodb.core.index.Indexed ; import org.springframework.data.mongodb.core.mapping.Document ; @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"recommend_user\" ) public class RecommendUser implements java . io . Serializable { private static final long serialVersionUID = - 4296017160071130962L ; @Id private ObjectId id ; //\u4e3b\u952eid @Indexed private Long userId ; //\u63a8\u8350\u7684\u7528\u6237id private Long toUserId ; //\u7528\u6237id @Indexed private Double score ; //\u63a8\u8350\u5f97\u5206 private String date ; //\u65e5\u671f } package com.tanhua.dubbo.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import java.util.Collections ; import java.util.List ; @Data @AllArgsConstructor public class PageInfo < T > implements java . io . Serializable { private static final long serialVersionUID = - 2105385689859184204L ; /** * \u603b\u6761\u6570 */ private Integer total = 0 ; /** * \u5f53\u524d\u9875 */ private Integer pageNum = 0 ; /** * \u4e00\u9875\u663e\u793a\u7684\u5927\u5c0f */ private Integer pageSize = 0 ; /** * \u6570\u636e\u5217\u8868 */ private List < T > records = Collections . emptyList (); }","title":"3.2.1\u3001\u7f16\u5199\u63a5\u53e3"},{"location":"tantan/day03/#322","text":"package com.tanhua.dubbo.server.api ; import com.alibaba.dubbo.config.annotation.Service ; import com.tanhua.dubbo.server.pojo.RecommendUser ; import com.tanhua.dubbo.server.vo.PageInfo ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.domain.PageRequest ; import org.springframework.data.domain.Sort ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; import java.util.List ; @Service ( version = \"1.0.0\" ) //\u7533\u660e\u8fd9\u662f\u4e00\u4e2adubbo\u670d\u52a1 public class RecommendUserApiImpl implements RecommendUserApi { @Autowired private MongoTemplate mongoTemplate ; @Override public RecommendUser queryWithMaxScore ( Long userId ) { //\u67e5\u8be2\u5f97\u5206\u6700\u9ad8\u7684\u7528\u6237\uff0c\u6309\u7167\u5f97\u5206\u5012\u5e8f\u6392\u5e8f Query query = Query . query ( Criteria . where ( \"toUserId\" ). is ( userId )) . with ( Sort . by ( Sort . Order . desc ( \"score\" ))). limit ( 1 ); return this . mongoTemplate . findOne ( query , RecommendUser . class ); } @Override public PageInfo < RecommendUser > queryPageInfo ( Long userId , Integer pageNum , Integer pageSize ) { //\u5206\u9875\u5e76\u4e14\u6392\u5e8f\u53c2\u6570 PageRequest pageRequest = PageRequest . of ( pageNum - 1 , pageSize , Sort . by ( Sort . Order . desc ( \"score\" ))); //\u67e5\u8be2\u53c2\u6570 Query query = Query . query ( Criteria . where ( \"toUserId\" ). is ( userId )). with ( pageRequest ); List < RecommendUser > recommendUserList = this . mongoTemplate . find ( query , RecommendUser . class ); //\u6682\u65f6\u4e0d\u63d0\u4f9b\u6570\u636e\u603b\u6570 return new PageInfo <> ( 0 , pageNum , pageSize , recommendUserList ); } }","title":"3.2.2\u3001\u7f16\u5199\u5b9e\u73b0"},{"location":"tantan/day03/#323","text":"package com.tanhua.dubbo.server.api ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestRecommendUserApi { @Autowired private RecommendUserApi recommendUserApi ; @Test public void testQueryWithMaxScore (){ System . out . println ( this . recommendUserApi . queryWithMaxScore ( 1L )); System . out . println ( this . recommendUserApi . queryWithMaxScore ( 8L )); System . out . println ( this . recommendUserApi . queryWithMaxScore ( 26L )); } @Test public void testQueryPageInfo (){ System . out . println ( this . recommendUserApi . queryPageInfo ( 1L , 1 , 5 )); System . out . println ( this . recommendUserApi . queryPageInfo ( 1L , 2 , 5 )); System . out . println ( this . recommendUserApi . queryPageInfo ( 1L , 3 , 5 )); } }","title":"3.2.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day03/#33","text":"","title":"3.3\u3001\u5b9e\u73b0\u4eca\u65e5\u4f73\u4eba\u670d\u52a1"},{"location":"tantan/day03/#331mock","text":"\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/617","title":"3.3.1\u3001mock\u670d\u52a1"},{"location":"tantan/day03/#332","text":"","title":"3.3.2\u3001\u57fa\u7840\u4ee3\u7801"},{"location":"tantan/day03/#3321sexenum","text":"package com.tanhua.server.enums ; import com.baomidou.mybatisplus.core.enums.IEnum ; public enum SexEnum implements IEnum < Integer > { MAN ( 1 , \"\u7537\" ), WOMAN ( 2 , \"\u5973\" ), UNKNOWN ( 3 , \"\u672a\u77e5\" ); private int value ; private String desc ; SexEnum ( int value , String desc ) { this . value = value ; this . desc = desc ; } @Override public Integer getValue () { return this . value ; } @Override public String toString () { return this . desc ; } }","title":"3.3.2.1\u3001SexEnum"},{"location":"tantan/day03/#3322basepojo","text":"package com.tanhua.server.pojo ; import com.baomidou.mybatisplus.annotation.FieldFill ; import com.baomidou.mybatisplus.annotation.TableField ; import java.util.Date ; public abstract class BasePojo { @TableField ( fill = FieldFill . INSERT ) private Date created ; @TableField ( fill = FieldFill . INSERT_UPDATE ) private Date updated ; }","title":"3.3.2.2\u3001BasePojo"},{"location":"tantan/day03/#3323user","text":"package com.tanhua.server.pojo ; import com.fasterxml.jackson.annotation.JsonIgnore ; import com.fasterxml.jackson.annotation.JsonIgnoreProperties ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor @JsonIgnoreProperties ( ignoreUnknown = true ) public class User extends BasePojo { private Long id ; private String mobile ; //\u624b\u673a\u53f7 @JsonIgnore private String password ; //\u5bc6\u7801\uff0cjson\u5e8f\u5217\u5316\u65f6\u5ffd\u7565 }","title":"3.3.2.3\u3001User"},{"location":"tantan/day03/#3324userinfo","text":"package com.tanhua.server.pojo ; import com.tanhua.server.enums.SexEnum ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class UserInfo extends BasePojo { private Long id ; private Long userId ; //\u7528\u6237id private String nickName ; //\u6635\u79f0 private String logo ; //\u7528\u6237\u5934\u50cf private String tags ; //\u7528\u6237\u6807\u7b7e\uff1a\u591a\u4e2a\u7528\u9017\u53f7\u5206\u9694 private SexEnum sex ; //\u6027\u522b private Integer age ; //\u5e74\u9f84 private String edu ; //\u5b66\u5386 private String city ; //\u57ce\u5e02 private String birthday ; //\u751f\u65e5 private String coverPic ; // \u5c01\u9762\u56fe\u7247 private String industry ; //\u884c\u4e1a private String income ; //\u6536\u5165 private String marriage ; //\u5a5a\u59fb\u72b6\u6001 }","title":"3.3.2.4\u3001UserInfo"},{"location":"tantan/day03/#333","text":"\u5b9e\u73b0\u63cf\u8ff0\uff1a \u9700\u8981\u6839\u636e\u524d\u7aef\u5b9a\u4e49\u7684\u7ed3\u6784\u5b9a\u4e49java\u5bf9\u8c61 \u6839\u636esso\u7cfb\u7edf\u63d0\u4f9b\u7684\u63a5\u53e3\u67e5\u8be2\u5f53\u524d\u767b\u5f55\u7528\u6237\u7684\u4fe1\u606f \u6839\u636edubbo\u7cfb\u7edf\u63d0\u4f9b\u7684\u670d\u52a1\u8fdb\u884c\u67e5\u8be2\u4eca\u65e5\u4f73\u4eba\u6570\u636e","title":"3.3.3\u3001\u5b9e\u73b0\u529f\u80fd"},{"location":"tantan/day03/#3331todaybest","text":"package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; /** * \u4eca\u65e5\u4f73\u4eba */ @Data @NoArgsConstructor @AllArgsConstructor public class TodayBest { private Long id ; private String avatar ; private String nickname ; private String gender ; //\u6027\u522b man woman private Integer age ; private String [] tags ; private Long fateValue ; //\u7f18\u5206\u503c }","title":"3.3.3.1\u3001TodayBest"},{"location":"tantan/day03/#3332todaybestcontroller","text":"package com.tanhua.server.controller ; import com.tanhua.server.service.TodayBestService ; import com.tanhua.server.vo.TodayBest ; import lombok.extern.slf4j.Slf4j ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.RequestHeader ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RestController ; @RestController @RequestMapping ( \"tanhua\" ) @Slf4j public class TodayBestController { @Autowired private TodayBestService todayBestService ; /** * \u67e5\u8be2\u4eca\u65e5\u4f73\u4eba * * @param token * @return */ @GetMapping ( \"todayBest\" ) public ResponseEntity < TodayBest > queryTodayBest ( @RequestHeader ( \"Authorization\" ) String token ) { try { TodayBest todayBest = this . todayBestService . queryTodayBest ( token ); if ( null != todayBest ) { return ResponseEntity . ok ( todayBest ); } } catch ( Exception e ) { log . error ( \"\u67e5\u8be2\u4eca\u65e5\u4f73\u4eba\u51fa\u9519~ token = \" + token , e ); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). body ( null ); } }","title":"3.3.3.2\u3001TodayBestController"},{"location":"tantan/day03/#3333todaybestservice","text":"package com.tanhua.server.service ; import com.tanhua.server.pojo.User ; import com.tanhua.server.pojo.UserInfo ; import com.tanhua.server.vo.TodayBest ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.stereotype.Service ; @Service public class TodayBestService { @Autowired private UserService userService ; @Autowired private RecommendUserService recommendUserService ; @Autowired private UserInfoService userInfoService ; @Value ( \"${tanhua.sso.default.user}\" ) private Long defaultUser ; public TodayBest queryTodayBest ( String token ) { //\u6821\u9a8ctoken\u662f\u5426\u6709\u6548\uff0c\u901a\u8fc7SSO\u7684\u63a5\u53e3\u8fdb\u884c\u6821\u9a8c User user = this . userService . queryUserByToken ( token ); if ( null == user ) { //token\u975e\u6cd5\u6216\u5df2\u7ecf\u8fc7\u671f return null ; } //\u67e5\u8be2\u63a8\u8350\u7528\u6237\uff08\u4eca\u65e5\u4f73\u4eba\uff09 TodayBest todayBest = this . recommendUserService . queryTodayBest ( user . getId ()); if ( null == todayBest ){ //\u7ed9\u51fa\u9ed8\u8ba4\u7684\u63a8\u8350\u7528\u6237 todayBest = new TodayBest (); todayBest . setId ( defaultUser ); todayBest . setFateValue ( 80L ); //\u56fa\u5b9a\u503c } //\u8865\u5168\u4e2a\u4eba\u4fe1\u606f UserInfo userInfo = this . userInfoService . queryUserInfoByUserId ( todayBest . getId ()); if ( null == userInfo ){ return null ; } todayBest . setAvatar ( userInfo . getLogo ()); todayBest . setNickname ( userInfo . getNickName ()); todayBest . setTags ( StringUtils . split ( userInfo . getTags (), ',' )); todayBest . setGender ( userInfo . getSex (). getValue () == 1 ? \"man\" : \"woman\" ); todayBest . setAge ( userInfo . getAge ()); return todayBest ; } }","title":"3.3.3.3\u3001TodayBestService"},{"location":"tantan/day03/#3334userservice","text":"package com.tanhua.server.service ; import com.fasterxml.jackson.databind.ObjectMapper ; import com.tanhua.server.pojo.User ; import lombok.extern.slf4j.Slf4j ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.stereotype.Service ; import org.springframework.web.client.RestTemplate ; @Service @Slf4j public class UserService { @Autowired private RestTemplate restTemplate ; @Value ( \"${tanhua.sso.url}\" ) private String ssoUrl ; private static final ObjectMapper MAPPER = new ObjectMapper (); /** * \u901a\u8fc7sso\u7684rest\u63a5\u53e3\u67e5\u8be2 * * @param token * @return */ public User queryUserByToken ( String token ) { String url = ssoUrl + \"/user/\" + token ; try { String data = this . restTemplate . getForObject ( url , String . class ); if ( StringUtils . isEmpty ( data )) { return null ; } return MAPPER . readValue ( data , User . class ); } catch ( Exception e ) { log . error ( \"\u6821\u9a8ctoken\u51fa\u9519\uff0ctoken = \" + token , e ); } return null ; } } package com.tanhua.server.config ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; import org.springframework.http.client.ClientHttpRequestFactory ; import org.springframework.http.client.SimpleClientHttpRequestFactory ; import org.springframework.http.converter.StringHttpMessageConverter ; import org.springframework.web.client.RestTemplate ; import java.nio.charset.Charset ; @Configuration public class RestTemplateConfig { @Bean public RestTemplate restTemplate ( ClientHttpRequestFactory factory ) { RestTemplate restTemplate = new RestTemplate ( factory ); // \u652f\u6301\u4e2d\u6587\u7f16\u7801 restTemplate . getMessageConverters (). set ( 1 , new StringHttpMessageConverter ( Charset . forName ( \"UTF-8\" ))); return restTemplate ; } @Bean public ClientHttpRequestFactory simpleClientHttpRequestFactory () { SimpleClientHttpRequestFactory factory = new SimpleClientHttpRequestFactory (); factory . setReadTimeout ( 5000 ); //\u5355\u4f4d\u4e3ams factory . setConnectTimeout ( 5000 ); //\u5355\u4f4d\u4e3ams return factory ; } }","title":"3.3.3.4\u3001UserService"},{"location":"tantan/day03/#3335recommenduserservice","text":"package com.tanhua.server.service ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.dubbo.server.api.RecommendUserApi ; import com.tanhua.dubbo.server.pojo.RecommendUser ; import com.tanhua.server.vo.TodayBest ; import org.springframework.stereotype.Service ; /** * \u8d1f\u8d23\u4e0edubbo\u670d\u52a1\u8fdb\u884c\u4ea4\u4e92 */ @Service public class RecommendUserService { @Reference ( version = \"1.0.0\" ) private RecommendUserApi recommendUserApi ; public TodayBest queryTodayBest ( Long userId ) { RecommendUser recommendUser = this . recommendUserApi . queryWithMaxScore ( userId ); if ( null == recommendUser ){ return null ; } TodayBest todayBest = new TodayBest (); todayBest . setId ( recommendUser . getUserId ()); //\u7f18\u5206\u503c double score = Math . floor ( recommendUser . getScore ()); //\u53d6\u6574,98.2 -> 98 todayBest . setFateValue ( Double . valueOf ( score ). longValue ()); return todayBest ; } }","title":"3.3.3.5\u3001RecommendUserService"},{"location":"tantan/day03/#3336userinfoservice","text":"package com.tanhua.server.service ; import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper ; import com.tanhua.server.mapper.UserInfoMapper ; import com.tanhua.server.pojo.UserInfo ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; @Service public class UserInfoService { @Autowired private UserInfoMapper userInfoMapper ; public UserInfo queryUserInfoByUserId ( Long userId ) { QueryWrapper < UserInfo > queryWrapper = new QueryWrapper <> (); queryWrapper . eq ( \"user_id\" , userId ); return this . userInfoMapper . selectOne ( queryWrapper ); } }","title":"3.3.3.6\u3001UserInfoService"},{"location":"tantan/day03/#3337userinfomapper","text":"package com.tanhua.server.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.common.pojo.UserInfo ; public interface UserInfoMapper extends BaseMapper < UserInfo > { }","title":"3.3.3.7\u3001UserInfoMapper"},{"location":"tantan/day03/#334","text":"\u5355\u5143\u6d4b\u8bd5\uff0c\u6d4b\u8bd5dubbo\u670d\u52a1\uff1a package com.tanhua.server ; import com.tanhua.server.service.RecommendUserService ; import com.tanhua.server.vo.TodayBest ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringJUnit4ClassRunner ; @SpringBootTest @RunWith ( SpringJUnit4ClassRunner . class ) public class TestRecommendUserApi { @Autowired private RecommendUserService recommendUserService ; @Test public void testQueryTodayBest (){ TodayBest todayBest = this . recommendUserService . queryTodayBest ( 1L ); System . out . println ( todayBest ); } } \u6574\u5408\u529f\u80fd\u6d4b\u8bd5\uff0c\u9700\u8981\u5c06sso\u3001dubbo\u670d\u52a1\u542f\u52a8\u5b8c\u6210\u540e\u8fdb\u884c\u6d4b\u8bd5\u3002","title":"3.3.4\u3001\u6d4b\u8bd5"},{"location":"tantan/day03/#335mongodbbug","text":"\u5728\u9879\u76ee\u4e2d\uff0c\u6dfb\u52a0\u4e86mongo\u7684\u4f9d\u8d56\u7684\u8bdd\uff0cspringboot\u5c31\u4f1a\u81ea\u52a8\u53bb\u8fde\u63a5\u672c\u5730\u7684mongo\uff0c\u7531\u4e8e\u4ed6\u8fde\u63a5\u4e0d\u4e0a\u4f1a\u5bfc\u81f4\u51fa\u9519\u3002 \u89e3\u51b3\uff1a springboot\u4e2d\u6dfb\u52a0\u6392\u9664\u81ea\u52a8\u914d\u7f6e\u7684\u6ce8\u89e3 package com.tanhua.server ; import org.mybatis.spring.annotation.MapperScan ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; import org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration ; import org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration ; @MapperScan ( \"com.tanhua.server.mapper\" ) //\u8bbe\u7f6emapper\u63a5\u53e3\u7684\u626b\u63cf\u5305 @SpringBootApplication ( exclude = { MongoAutoConfiguration . class , MongoDataAutoConfiguration . class }) //\u6392\u9664mongo\u7684\u81ea\u52a8\u914d\u7f6e public class ServerApplication { public static void main ( String [] args ) { SpringApplication . run ( ServerApplication . class , args ); } }","title":"3.3.5\u3001\u89e3\u51b3MongoDB\u542f\u52a8bug"},{"location":"tantan/day03/#4","text":"","title":"4\u3001\u63a8\u8350\u5217\u8868"},{"location":"tantan/day03/#41mock","text":"\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/623","title":"4.1\u3001mock\u63a5\u53e3"},{"location":"tantan/day03/#42","text":"package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class RecommendUserQueryParam { private Integer page = 1 ; //\u5f53\u524d\u9875\u6570 private Integer pagesize = 10 ; //\u9875\u5c3a\u5bf8 private String gender ; //\u6027\u522b man woman private String lastLogin ; //\u8fd1\u671f\u767b\u9646\u65f6\u95f4 private Integer age ; //\u5e74\u9f84 private String city ; //\u5c45\u4f4f\u5730 private String education ; //\u5b66\u5386 }","title":"4.2\u3001\u67e5\u8be2\u53c2\u6570\u5bf9\u8c61"},{"location":"tantan/day03/#43","text":"package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import java.util.Collections ; import java.util.List ; @Data @AllArgsConstructor @NoArgsConstructor public class PageResult { private Integer counts = 0 ; //\u603b\u8bb0\u5f55\u6570 private Integer pagesize = 0 ; //\u9875\u5927\u5c0f private Integer pages = 0 ; //\u603b\u9875\u6570 private Integer page = 0 ; //\u5f53\u524d\u9875\u7801 private List <?> items = Collections . emptyList (); //\u5217\u8868 }","title":"4.3\u3001\u7ed3\u679c\u5bf9\u8c61"},{"location":"tantan/day03/#44controller","text":"/** * \u67e5\u8be2\u63a8\u8350\u7528\u6237\u5217\u8868 * * @param token * @param queryParam * @return */ @GetMapping ( \"recommendation\" ) public ResponseEntity < PageResult > queryRecommendation ( @RequestHeader ( \"Authorization\" ) String token , RecommendUserQueryParam queryParam ){ try { PageResult pageResult = this . todayBestService . queryRecommendation ( token , queryParam ); if ( null != pageResult ) { return ResponseEntity . ok ( pageResult ); } } catch ( Exception e ) { log . error ( \"\u67e5\u8be2\u63a8\u8350\u7528\u6237\u5217\u8868\u51fa\u9519~ token = \" + token , e ); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). body ( null ); }","title":"4.4\u3001Controller"},{"location":"tantan/day03/#45service","text":"/** * \u67e5\u8be2\u63a8\u8350\u7528\u6237\u5217\u8868 * * @param queryParam * @param token * @return */ public PageResult queryRecommendation ( String token , RecommendUserQueryParam queryParam ) { //\u6821\u9a8ctoken\u662f\u5426\u6709\u6548\uff0c\u901a\u8fc7SSO\u7684\u63a5\u53e3\u8fdb\u884c\u6821\u9a8c User user = this . userService . queryUserByToken ( token ); if ( null == user ) { //token\u975e\u6cd5\u6216\u5df2\u7ecf\u8fc7\u671f return null ; } PageResult pageResult = new PageResult (); pageResult . setPage ( queryParam . getPage ()); pageResult . setPagesize ( queryParam . getPagesize ()); PageInfo < RecommendUser > pageInfo = this . recommendUserService . queryRecommendUserList ( user . getId (), queryParam . getPage (), queryParam . getPagesize ()); List < RecommendUser > records = pageInfo . getRecords (); if ( CollectionUtils . isEmpty ( records )) { //\u6ca1\u6709\u67e5\u8be2\u5230\u63a8\u8350\u7684\u7528\u6237\u5217\u8868 return pageResult ; } //\u586b\u5145\u4e2a\u4eba\u4fe1\u606f //\u6536\u96c6\u63a8\u8350\u7528\u6237\u7684id Set < Long > userIds = new HashSet <> (); for ( RecommendUser record : records ) { userIds . add ( record . getUserId ()); } QueryWrapper < UserInfo > queryWrapper = new QueryWrapper <> (); //\u7528\u6237id\u53c2\u6570 queryWrapper . in ( \"user_id\" , userIds ); if ( StringUtils . isNotEmpty ( queryParam . getGender ())) { //\u9700\u8981\u6027\u522b\u53c2\u6570\u67e5\u8be2 queryWrapper . eq ( \"sex\" , StringUtils . equals ( queryParam . getGender (), \"man\" ) ? 1 : 2 ); } if ( StringUtils . isNotEmpty ( queryParam . getCity ())) { //\u9700\u8981\u57ce\u5e02\u53c2\u6570\u67e5\u8be2 queryWrapper . like ( \"city\" , queryParam . getCity ()); } if ( queryParam . getAge () != null ) { //\u8bbe\u7f6e\u5e74\u9f84\u53c2\u6570\uff0c\u6761\u4ef6\uff1a\u5c0f\u4e8e\u7b49\u4e8e queryWrapper . le ( \"age\" , queryParam . getAge ()); } List < UserInfo > userInfoList = this . userInfoService . queryUserInfoList ( queryWrapper ); if ( CollectionUtils . isEmpty ( userInfoList )){ //\u6ca1\u6709\u67e5\u8be2\u5230\u7528\u6237\u7684\u57fa\u672c\u4fe1\u606f return pageResult ; } List < TodayBest > todayBests = new ArrayList <> (); for ( UserInfo userInfo : userInfoList ) { TodayBest todayBest = new TodayBest (); todayBest . setId ( userInfo . getUserId ()); todayBest . setAvatar ( userInfo . getLogo ()); todayBest . setNickname ( userInfo . getNickName ()); todayBest . setTags ( StringUtils . split ( userInfo . getTags (), ',' )); todayBest . setGender ( userInfo . getSex (). getValue () == 1 ? \"man\" : \"woman\" ); todayBest . setAge ( userInfo . getAge ()); //\u7f18\u5206\u503c for ( RecommendUser record : records ) { if ( record . getUserId (). longValue () == userInfo . getUserId (). longValue ()){ double score = Math . floor ( record . getScore ()); //\u53d6\u6574,98.2 -> 98 todayBest . setFateValue ( Double . valueOf ( score ). longValue ()); break ; } } todayBests . add ( todayBest ); } //\u6309\u7167\u7f18\u5206\u503c\u8fdb\u884c\u5012\u5e8f\u6392\u5e8f Collections . sort ( todayBests , ( o1 , o2 ) -> new Long ( o2 . getFateValue () - o1 . getFateValue ()). intValue ()); pageResult . setItems ( todayBests ); return pageResult ; } //RecommendUserService public PageInfo < RecommendUser > queryRecommendUserList ( Long id , Integer page , Integer pagesize ) { return this . recommendUserApi . queryPageInfo ( id , page , pagesize ); } //UserInfoService /** * \u67e5\u8be2\u7528\u6237\u4fe1\u606f\u5217\u8868 * * @param queryWrapper * @return */ public List < UserInfo > queryUserInfoList ( QueryWrapper queryWrapper ) { return this . userInfoMapper . selectList ( queryWrapper ); }","title":"4.5\u3001Service"},{"location":"tantan/day03/#46","text":"","title":"4.6\u3001\u6d4b\u8bd5"},{"location":"tantan/day03/#5","text":"\u5728\u63a5\u53e3\u670d\u52a1\u4e2d\uff0c\u6709\u5fc5\u8981\u5bf9\u4e8e\u63a5\u53e3\u8fdb\u884c\u7f13\u5b58\u5904\u7406\uff0c\u5c24\u5176\u662fGET\u8bf7\u6c42\uff0c\u5982\u679c\u6bcf\u4e2a\u63a5\u53e3\u5355\u72ec\u6dfb\u52a0\u7684\u8bdd\u4f1a\u5b58\u5728\u5f88\u591a\u7684\u91cd\u590d\u7684\u903b\u8f91\uff0c\u6240\u4ee5\u53ef\u4ee5\u7f16\u5199\u4e00\u5957\u901a\u7528\u7684\u89e3\u51b3\u65b9\u6848\u3002 \u5b9e\u73b0\u601d\u8def\uff1a \u901a\u8fc7\u62e6\u622a\u5668\u5b9e\u73b0\u5bf9\u8bf7\u6c42\u7684\u62e6\u622a\uff0c\u5728\u62e6\u622a\u5668\u4e2d\u5b9e\u73b0\u7f13\u5b58\u7684\u547d\u4e2d\u3002 \u901a\u8fc7ResponseBodyAdvice\u8fdb\u884c\u5bf9\u54cd\u5e94\u7684\u62e6\u622a\uff0c\u53ef\u4ee5\u5c06\u6570\u636e\u7f13\u5b58\u5230Redis\u4e2d\u3002 \u8003\u8651\u5230\uff0c\u4e0d\u80fd\u5bf9\u4e8e\u6240\u6709\u7684\u8bf7\u6c42\u90fd\u4e00\u5200\u5207\uff0c\u6240\u4ee5\u9700\u8981\u521b\u5efa@Cache\u6ce8\u89e3\u8fdb\u884c\u6807\u8bb0\uff0c\u53ea\u6709\u6807\u8bb0\u7684Controller\u624d\u8fdb\u884c\u7f13\u5b58\u5904\u7406\u3002 \u7f13\u5b58\u7684\u5904\u7406\u4e2d\uff0c\u4ec5\u9488\u5bf9GET\u8bf7\u6c42\u5904\u7406\uff0c\u5176\u4ed6\u7684\u8bf7\u6c42\u5747\u4e0d\u505a\u5904\u7406\u3002","title":"5\u3001\u7f13\u5b58"},{"location":"tantan/day03/#51","text":"package com.tanhua.server.utils ; import java.lang.annotation.* ; /** * \u88ab\u6807\u8bb0\u4e3aCache\u7684Controller\u8fdb\u884c\u7f13\u5b58\uff0c\u5176\u4ed6\u60c5\u51b5\u4e0d\u8fdb\u884c\u7f13\u5b58 */ @Target ( ElementType . METHOD ) @Retention ( RetentionPolicy . RUNTIME ) @Documented //\u6807\u8bb0\u6ce8\u89e3 public @interface Cache { /** * \u7f13\u5b58\u65f6\u95f4\uff0c\u9ed8\u8ba4\u4e3a60\u79d2 * @return */ String time () default \"60\" ; }","title":"5.1\u3001\u81ea\u5b9a\u4e49\u6ce8\u89e3"},{"location":"tantan/day03/#52","text":"\u7f16\u5199\u62e6\u622a\u5668\uff1aRedisCacheInterceptor\u3002 package com.tanhua.server.interceptor ; import com.fasterxml.jackson.databind.ObjectMapper ; import com.tanhua.server.utils.Cache ; import org.apache.commons.codec.digest.DigestUtils ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.data.redis.core.RedisTemplate ; import org.springframework.stereotype.Component ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.method.HandlerMethod ; import org.springframework.web.servlet.HandlerInterceptor ; import javax.servlet.http.HttpServletRequest ; import javax.servlet.http.HttpServletResponse ; @Component public class RedisCacheInterceptor implements HandlerInterceptor { @Value ( \"${tanhua.cache.enable}\" ) private Boolean enable ; @Autowired private RedisTemplate < String , String > redisTemplate ; private static final ObjectMapper MAPPER = new ObjectMapper (); @Override public boolean preHandle ( HttpServletRequest request , HttpServletResponse response , Object handler ) throws Exception { //\u7f13\u5b58\u7684\u5168\u5c40\u5f00\u5173\u7684\u6821\u9a8c if ( ! enable ) { return true ; } //\u6821\u9a8chandler\u662f\u5426\u662fHandlerMethod if ( ! ( handler instanceof HandlerMethod )) { return true ; } //\u5224\u65ad\u662f\u5426\u4e3aget\u8bf7\u6c42 if ( ! (( HandlerMethod ) handler ). hasMethodAnnotation ( GetMapping . class )) { return true ; } //\u5224\u65ad\u662f\u5426\u6dfb\u52a0\u4e86@Cache\u6ce8\u89e3 if ( ! (( HandlerMethod ) handler ). hasMethodAnnotation ( Cache . class )) { return true ; } //\u7f13\u5b58\u547d\u4e2d String redisKey = createRedisKey ( request ); String cacheData = this . redisTemplate . opsForValue (). get ( redisKey ); if ( StringUtils . isEmpty ( cacheData )){ //\u7f13\u5b58\u672a\u547d\u4e2d return true ; } // \u5c06data\u6570\u636e\u8fdb\u884c\u54cd\u5e94 response . setCharacterEncoding ( \"UTF-8\" ); response . setContentType ( \"application/json; charset=utf-8\" ); response . getWriter (). write ( cacheData ); return false ; } /** * \u751f\u6210redis\u4e2d\u7684key\uff0c\u89c4\u5219\uff1aSERVER_CACHE_DATA_MD5(url + param + token) * * @param request * @return */ public static String createRedisKey ( HttpServletRequest request ) throws Exception { String url = request . getRequestURI (); String param = MAPPER . writeValueAsString ( request . getParameterMap ()); String token = request . getHeader ( \"Authorization\" ); String data = url + \"_\" + param + \"_\" + token ; return \"SERVER_CACHE_DATA_\" + DigestUtils . md5Hex ( data ); } } application.properties\uff1a #\u662f\u5426\u5f00\u542f\u6570\u636e\u7f13\u5b58 tanhua.cache.enable = false # Redis\u76f8\u5173\u914d\u7f6e spring.redis.jedis.pool.max-wait = 5000ms spring.redis.jedis.pool.max-Idle = 100 spring.redis.jedis.pool.min-Idle = 10 spring.redis.timeout = 10s spring.redis.cluster.nodes = 192.168.31.81:6379,192.168.31.81:6380,192.168.31.81:6381 spring.redis.cluster.max-redirects = 5 \u6ce8\u518c\u62e6\u622a\u5668\u5230Spring\u5bb9\u5668\uff1a package com.tanhua.server.config ; import com.tanhua.server.interceptor.RedisCacheInterceptor ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.context.annotation.Configuration ; import org.springframework.web.servlet.config.annotation.InterceptorRegistry ; import org.springframework.web.servlet.config.annotation.WebMvcConfigurer ; @Configuration public class WebConfig implements WebMvcConfigurer { @Autowired private RedisCacheInterceptor redisCacheInterceptor ; @Override public void addInterceptors ( InterceptorRegistry registry ) { registry . addInterceptor ( this . redisCacheInterceptor ). addPathPatterns ( \"/**\" ); } }","title":"5.2\u3001\u91c7\u7528\u62e6\u622a\u5668\u8fdb\u884c\u7f13\u5b58\u547d\u4e2d"},{"location":"tantan/day03/#43_1","text":"\u4f7f\u7528ResponseBodyAdvice\u8fdb\u884c\u5bf9\u54cd\u5e94\u7ed3\u679c\u5904\u7406\uff0c\u5c06\u7ed3\u679c\u5199\u5165\u5230Redis\u4e2d\uff1a \u5177\u4f53\u5b9e\u73b0\uff1a package com.tanhua.server.interceptor ; import com.fasterxml.jackson.databind.ObjectMapper ; import com.tanhua.server.utils.Cache ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.beans.factory.annotation.Value ; import org.springframework.core.MethodParameter ; import org.springframework.data.redis.core.RedisTemplate ; import org.springframework.http.MediaType ; import org.springframework.http.server.ServerHttpRequest ; import org.springframework.http.server.ServerHttpResponse ; import org.springframework.http.server.ServletServerHttpRequest ; import org.springframework.web.bind.annotation.ControllerAdvice ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.servlet.mvc.method.annotation.ResponseBodyAdvice ; import java.util.concurrent.TimeUnit ; @ControllerAdvice public class MyResponseBodyAdvice implements ResponseBodyAdvice { @Value ( \"${tanhua.cache.enable}\" ) private Boolean enable ; @Autowired private RedisTemplate < String , String > redisTemplate ; private static final ObjectMapper MAPPER = new ObjectMapper (); @Override public boolean supports ( MethodParameter returnType , Class converterType ) { // \u5f00\u5173\u5904\u4e8e\u5f00\u542f\u72b6\u6001 \u662fget\u8bf7\u6c42 \u5305\u542b\u4e86@Cache\u6ce8\u89e3 return enable && returnType . hasMethodAnnotation ( GetMapping . class ) && returnType . hasMethodAnnotation ( Cache . class ); } @Override public Object beforeBodyWrite ( Object body , MethodParameter returnType , MediaType selectedContentType , Class selectedConverterType , ServerHttpRequest request , ServerHttpResponse response ) { if ( null == body ) { return null ; } try { String redisValue = null ; if ( body instanceof String ) { redisValue = ( String ) body ; } else { redisValue = MAPPER . writeValueAsString ( body ); } String redisKey = RedisCacheInterceptor . createRedisKey ((( ServletServerHttpRequest ) request ). getServletRequest ()); Cache cache = returnType . getMethodAnnotation ( Cache . class ); //\u7f13\u5b58\u7684\u65f6\u95f4\u5355\u4f4d\u662f\u79d2 this . redisTemplate . opsForValue (). set ( redisKey , redisValue , Long . valueOf ( cache . time ()), TimeUnit . SECONDS ); } catch ( Exception e ) { e . printStackTrace (); } return body ; } }","title":"4.3\u3001\u54cd\u5e94\u7ed3\u679c\u5199\u5165\u5230\u7f13\u5b58"},{"location":"tantan/day03/#44","text":"\u53ef\u4ee5\u770b\u5230\u6570\u636e\u5df2\u7ecf\u7f13\u5b58\u5230Redis\u4e2d\uff0c\u5e76\u4e14\u5176\u7f13\u5b58\u65f6\u95f4\u4e5f\u662f30\u79d2\uff0c\u4e0e\u9884\u671f\u4e00\u81f4\u3002","title":"4.4\u3001\u6d4b\u8bd5"},{"location":"tantan/day03/#6","text":"\u6d4b\u8bd5\u65f6\u9700\u8981\u6ce8\u610f\uff0c\u7531\u4e8e\u7528\u6237\u6570\u636e\u8f83\u5c11\uff0c\u6240\u4ee5\u6d4b\u8bd5\u65f6\u9700\u8981\u628a\u6761\u4ef6\u6ce8\u91ca\u6389\uff0c\u5426\u5219\u67e5\u8be2\u4e0d\u5230\u6570\u636e\uff1a \u6548\u679c\uff1a","title":"6\u3001\u6574\u5408\u6d4b\u8bd5"},{"location":"tantan/day03/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/","text":"\u4e86\u89e3\u9996\u9875\u529f\u80fd \u7406\u89e3\u7cfb\u7edf\u67b6\u6784\u4ee5\u53ca\u642d\u5efa\u5de5\u7a0b \u72ec\u7acb\u5b8c\u6210dubbo\u670d\u52a1\u7684\u5f00\u53d1 \u72ec\u7acb\u5b8c\u6210\u4eca\u65e5\u4f73\u4eba\u7684\u529f\u80fd \u72ec\u7acb\u5b8c\u6210\u63a8\u8350\u7528\u6237\u5217\u8868\u7684\u529f\u80fd \u638c\u63e1\u7f13\u5b58\u7684\u6dfb\u52a0\u903b\u8f91 \u638c\u63e1\u6574\u5408\u6d4b\u8bd5","title":"\u5b66\u4e60\u76ee\u6807"},{"location":"tantan/day04/","text":"\u8bfe\u7a0b\u8bf4\u660e \u00b6 \u62bd\u53d6common\u5de5\u7a0b \u5708\u5b50\u529f\u80fd\u8bf4\u660e \u5708\u5b50\u6280\u672f\u5b9e\u73b0 \u5708\u5b50\u6280\u672f\u65b9\u6848 \u5708\u5b50\u5b9e\u73b0\u53d1\u5e03\u52a8\u6001 \u5708\u5b50\u5b9e\u73b0\u597d\u53cb\u52a8\u6001 \u5708\u5b50\u5b9e\u73b0\u63a8\u8350\u52a8\u6001 1\u3001\u62bd\u53d6common\u5de5\u7a0b \u00b6 \u5728\u9879\u76ee\u4e2d\u4e00\u822c\u9700\u8981\u5c06\u516c\u7528\u7684\u5bf9\u8c61\u8fdb\u884c\u62bd\u53d6\u653e\u5230common\u5de5\u7a0b\u4e2d\uff0c\u5176\u4ed6\u7684\u5de5\u7a0b\u4f9d\u8d56\u6b64\u5de5\u7a0b\u5373\u53ef\u3002\u4e0b\u9762\u6211\u4eec\u5c06sso\u4ee5\u53caserver\u5de5\u7a0b\u4e2d\u7684\u516c\u7528\u7684\u5bf9\u8c61\u8fdb\u884c\u62bd\u53d6\u3002 1.1\u3001\u521b\u5efamy-tanhua-common\u5de5\u7a0b \u00b6 <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <parent> <artifactId> my-tanhua </artifactId> <groupId> cn.itcast.tanhua </groupId> <version> 1.0-SNAPSHOT </version> </parent> <modelVersion> 4.0.0 </modelVersion> <artifactId> my-tanhua-common </artifactId> <dependencies> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> </dependency> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus-boot-starter </artifactId> </dependency> <dependency> <groupId> com.fasterxml.jackson.core </groupId> <artifactId> jackson-databind </artifactId> </dependency> </dependencies> </project> 1.2\u3001\u901a\u7528\u679a\u4e3e \u00b6 \u5c06SexEnum\u679a\u4e3e\u79fb\u52a8\u81f3common\u5de5\u7a0b\uff0c\u5e76\u4e14\u540e\u7eed\u521b\u5efa\u7684\u679a\u4e3e\u4e5f\u8981\u653e\u5230\u6b21\u5de5\u7a0b\u4e2d\uff0c\u4ee5\u8fbe\u5230\u516c\u7528\u7684\u76ee\u7684\u3002 package com.tanhua.common.enums ; import com.baomidou.mybatisplus.core.enums.IEnum ; public enum SexEnum implements IEnum < Integer > { MAN ( 1 , \"\u7537\" ), WOMAN ( 2 , \"\u5973\" ), UNKNOWN ( 3 , \"\u672a\u77e5\" ); private int value ; private String desc ; SexEnum ( int value , String desc ) { this . value = value ; this . desc = desc ; } @Override public Integer getValue () { return this . value ; } @Override public String toString () { return this . desc ; } } \u9700\u8981\u4fee\u6539server\u4e0esso\u5de5\u7a0b\u4e2d\u7684application.properties\u914d\u7f6e\uff1a # \u679a\u4e3e\u5305\u626b\u63cf mybatis-plus.type-enums-package = com.tanhua.common.enums \u5c06server\u4e0esso\u5de5\u7a0b\u4e2d\u7684SexEnum\u5bf9\u8c61\u5220\u9664\u4ee5\u53ca\u5c06\u76f8\u5173\u7684\u7c7b\u5f15\u7528\u8fdb\u884c\u4fee\u6539\u3002 1.3\u3001\u62bd\u53d6mapper \u00b6 \u9700\u8981\u5c06UserInfoMapper\u4ee5\u53caUserMapper\u653e\u7f6e\u5230common\u5de5\u7a0b\u7684com.tanhua.common.mapper\u5305\u4e0b\u3002 package com.tanhua.common.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.common.pojo.User ; public interface UserMapper extends BaseMapper < User > { } package com.tanhua.common.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.common.pojo.UserInfo ; public interface UserInfoMapper extends BaseMapper < UserInfo > { } \u8bf4\u660e\uff1a\u62bd\u53d6\u5b8c\u6210\u540e\uff0c\u9700\u8981\u5c06\u539f\u5de5\u7a0b\u7684\u4ee3\u7801\u5220\u9664\u4ee5\u53ca\u4fee\u6539\u5176\u4ed6\u4ee3\u7801\u4e2d\u5f15\u5165\u7684\u4f9d\u8d56\u3002 1.4\u3001\u62bd\u53d6pojo \u00b6 \u5c06BasePojo\u3001User\u3001UserInfo\u79fb\u52a8\u81f3common\u5de5\u7a0b\uff1a 1.5\u3001\u62bd\u53d6utils \u00b6 \u5c06server\u5de5\u7a0b\u7684utils\u8fdb\u884c\u62bd\u53d6\u516c\u7528\uff0c\u540e\u7eed\u7684\u5de5\u5177\u7c7b\u4e5f\u653e\u7f6e\u5230common\u5de5\u7a0b\u4e2d\u3002 \u62bd\u53d6\u5b8c\u6210\u540e\u8fdb\u884c\u6d4b\u8bd5\uff0c\u786e\u4fdd\u53ef\u4ee5\u6b63\u5e38\u542f\u52a8\u4ee5\u53ca\u529f\u80fd\u90fd\u6b63\u5e38\u3002 2\u3001\u5708\u5b50\u529f\u80fd \u00b6 2.1\u3001\u529f\u80fd\u8bf4\u660e \u00b6 \u63a2\u82b1\u4ea4\u53cb\u9879\u76ee\u4e2d\u7684\u5708\u5b50\u529f\u80fd\uff0c\u7c7b\u4f3c\u5fae\u4fe1\u7684\u670b\u53cb\u5708\uff0c\u57fa\u672c\u7684\u529f\u80fd\u4e3a\uff1a\u53d1\u5e03\u52a8\u6001\u3001\u6d4f\u89c8\u597d\u53cb\u52a8\u6001\u3001\u6d4f\u89c8\u63a8\u8350\u52a8\u6001\u3001\u70b9\u8d5e\u3001\u8bc4\u8bba\u3001\u559c\u6b22\u7b49\u529f\u80fd\u3002 \u53d1\u5e03\uff1a 2.2\u3001\u5b9e\u73b0\u65b9\u6848\u5206\u6790 \u00b6 \u5bf9\u4e8e\u5708\u5b50\u529f\u80fd\u7684\u5b9e\u73b0\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u5b83\u7684\u529f\u80fd\u7279\u70b9\u505a\u5206\u6790\uff1a \u6570\u636e\u91cf\u4f1a\u968f\u7740\u7528\u6237\u6570\u589e\u5927\u800c\u589e\u5927 \u8bfb\u591a\u5199\u5c11\uff0c\u4e00\u822c\u800c\u8a00\uff0c\u6d4f\u89c8\u670b\u53cb\u5708\u52a8\u6001\u4f1a\u591a\u4e00\u4e9b\uff0c\u53d1\u52a8\u6001\u76f8\u5bf9\u5c31\u4f1a\u5c11\u4e00\u4e9b \u975e\u597d\u53cb\u770b\u4e0d\u5230\u5176\u52a8\u6001\u5185\u5bb9 \u2026\u2026 \u9488\u5bf9\u4ee5\u4e0a\u7279\u70b9\uff0c\u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\uff1a \u5bf9\u4e8e\u6570\u636e\u91cf\u5927\u800c\u8a00\uff0c\u663e\u7136\u4e0d\u80fd\u591f\u4f7f\u7528\u5173\u7cfb\u578b\u6570\u636e\u5e93\u8fdb\u884c\u5b58\u50a8\uff0c\u6211\u4eec\u9700\u8981\u901a\u8fc7MongoDB\u8fdb\u884c\u5b58\u50a8 \u5bf9\u4e8e\u8bfb\u591a\u5199\u5c11\u7684\u5e94\u7528\uff0c\u5c3d\u53ef\u80fd\u7684\u51cf\u5c11\u8bfb\u53d6\u6570\u636e\u7684\u6210\u672c \u6bd4\u5982\u8bf4\uff0c\u4e00\u6761SQL\u8bed\u53e5\uff0c\u5355\u5f20\u8868\u67e5\u8be2\u4e00\u5b9a\u6bd4\u591a\u5f20\u8868\u67e5\u8be2\u8981\u5feb \u6761\u4ef6\u8d8a\u591a\u7684\u67e5\u8be2\u901f\u5ea6\u5c06\u8d8a\u6162\uff0c\u5c3d\u53ef\u80fd\u7684\u51cf\u5c11\u6761\u4ef6\u4ee5\u63d0\u5347\u67e5\u8be2\u901f\u5ea6 \u6240\u4ee5\u5bf9\u4e8e\u5b58\u50a8\u800c\u8a00\uff0c\u4e3b\u8981\u662f\u6838\u5fc3\u76844\u5f20\u8868\uff1a \u53d1\u5e03\u8868\uff1a\u8bb0\u5f55\u4e86\u6240\u6709\u7528\u6237\u7684\u53d1\u5e03\u7684\u4e1c\u897f\u4fe1\u606f\uff0c\u5982\u56fe\u7247\u3001\u89c6\u9891\u7b49\u3002 \u76f8\u518c\uff1a\u76f8\u518c\u662f\u6bcf\u4e2a\u7528\u6237\u72ec\u7acb\u7684\uff0c\u8bb0\u5f55\u4e86\u8be5\u7528\u6237\u6240\u53d1\u5e03\u7684\u6240\u6709\u5185\u5bb9\u3002 \u8bc4\u8bba\uff1a\u9488\u5bf9\u67d0\u4e2a\u5177\u4f53\u53d1\u5e03\u7684\u670b\u53cb\u8bc4\u8bba\u548c\u70b9\u8d5e\u64cd\u4f5c\u3002 \u65f6\u95f4\u7ebf\uff1a\u6240\u8c13\u201c\u5237\u670b\u53cb\u5708\u201d\uff0c\u5c31\u662f\u5237\u65f6\u95f4\u7ebf\uff0c\u5c31\u662f\u4e00\u4e2a\u7528\u6237\u6240\u6709\u7684\u670b\u53cb\u7684\u53d1\u5e03\u5185\u5bb9\u3002 \u6d41\u7a0b\uff1a \u6d41\u7a0b\u8bf4\u660e\uff1a \u7528\u6237\u53d1\u5e03\u52a8\u6001\uff0c\u52a8\u6001\u4e2d\u4e00\u822c\u5305\u542b\u4e86\u56fe\u7247\u548c\u6587\u5b57\uff0c\u56fe\u7247\u4e0a\u4f20\u5230\u963f\u91cc\u4e91\uff0c\u4e0a\u4f20\u6210\u529f\u540e\u62ff\u5230\u56fe\u7247\u5730\u5740\uff0c\u5c06\u6587\u5b57\u548c\u56fe\u7247\u5730\u5740\u8fdb\u884c\u6301\u4e45\u5316\u5b58\u50a8 \u9996\u5148\uff0c\u9700\u8981\u5c06\u52a8\u6001\u6570\u636e\u5199\u5165\u5230\u53d1\u5e03\u8868\u4e2d\uff0c\u5176\u6b21\uff0c\u518d\u5199\u5165\u5230\u81ea\u5df1\u7684\u76f8\u518c\u8868\u4e2d\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u76f8\u518c\u8868\u4e2d\u53ea\u5305\u542b\u4e86\u53d1\u5e03id\uff0c\u4e0d\u4f1a\u5197\u4f59\u5b58\u50a8\u53d1\u5e03\u6570\u636e \u6700\u540e\uff0c\u9700\u8981\u5c06\u53d1\u5e03\u6570\u636e\u5f02\u6b65\u7684\u5199\u5165\u5230\u597d\u53cb\u7684\u65f6\u95f4\u7ebf\u8868\u4e2d\uff0c\u4e4b\u6240\u4ee5\u8003\u8651\u5f02\u6b65\u64cd\u4f5c\uff0c\u662f\u56e0\u4e3a\u5e0c\u671b\u53d1\u5e03\u80fd\u591f\u5c3d\u5feb\u7ed9\u7528\u6237\u53cd\u9988\uff0c\u53d1\u5e03\u6210\u529f \u597d\u53cb\u5237\u670b\u53cb\u5708\u65f6\uff0c\u5b9e\u9645\u4e0a\u53ea\u9700\u8981\u67e5\u8be2\u81ea\u5df1\u7684\u65f6\u95f4\u7ebf\u8868\u5373\u53ef\uff0c\u8fd9\u6837\u6700\u5927\u9650\u5ea6\u7684\u63d0\u5347\u4e86\u67e5\u8be2\u901f\u5ea6\uff0c\u518d\u914d\u5408redis\u7684\u7f13\u5b58\uff0c\u90a3\u901f\u5ea6\u5c06\u662f\u98de\u5feb\u7684 \u7528\u6237\u5728\u5bf9\u52a8\u6001\u5185\u5bb9\u8fdb\u884c\u70b9\u8d5e\u3001\u559c\u6b22\u3001\u8bc4\u8bba\u64cd\u4f5c\u65f6\uff0c\u53ea\u9700\u8981\u5199\u5165\u5230\u8bc4\u8bba\u8868\u5373\u53ef\uff0c\u8be5\u8868\u4e2d\u4e5f\u662f\u53ea\u4f1a\u8bb0\u5f55\u53d1\u5e03id\uff0c\u5e76\u4e0d\u4f1a\u5197\u4f59\u5b58\u50a8\u53d1\u5e03\u6570\u636e 2.3\u3001\u8868\u7ed3\u6784\u8bbe\u8ba1 \u00b6 \u53d1\u5e03\u8868\uff1a #\u8868\u540d\uff1aqua n zi_publish { \"_id\" : \"5fae53d17e52992e78a3db61\" , #\u4e3b\u952eid \"pid\" : 1001 , #\u53d1\u5e03id\uff08Lo n g\u7c7b\u578b\uff09 \"userId\" : 1 , #\u7528\u6237id \"text\" : \"\u4eca\u5929\u5fc3\u60c5\u5f88\u597d\" , #\u6587\u672c\u5185\u5bb9 \"medias\" : \"http://xxxx/x/y/z.jpg\" , #\u5a92\u4f53\u6570\u636e\uff0c\u56fe\u7247\u6216\u5c0f\u89c6\u9891 url \"seeType\" : 1 , #\u8c01\u53ef\u4ee5\u770b\uff0c 1- \u516c\u5f00\uff0c 2- \u79c1\u5bc6\uff0c 3- \u90e8\u5206\u53ef\u89c1\uff0c 4- \u4e0d\u7ed9\u8c01\u770b \"seeList\" :[ 1 , 2 , 3 ], #\u90e8\u5206\u53ef\u89c1\u7684\u5217\u8868 \"notSeeList\" :[ 4 , 5 , 6 ], #\u4e0d\u7ed9\u8c01\u770b\u7684\u5217\u8868 \"longitude\" : 108.840974298098 , #\u7ecf\u5ea6 \"latitude\" : 34.2789316522934 , #\u7eac\u5ea6 \"locationName\" : \"\u4e0a\u6d77\u5e02\u6d66\u4e1c\u533a\" , #\u4f4d\u7f6e\u540d\u79f0 \"created\" , 1568012791171 #\u53d1\u5e03\u65f6\u95f4 } \u76f8\u518c\u8868\uff1a #\u8868\u540d\uff1aqua n zi_album_ { userId } { \"_id\" : \"5fae539d7e52992e78a3b684\" , #\u4e3b\u952eid \"publishId\" : \"5fae53d17e52992e78a3db61\" , #\u53d1\u5e03id \"created\" : 1568012791171 #\u53d1\u5e03\u65f6\u95f4 } \u65f6\u95f4\u7ebf\u8868\uff1a #\u8868\u540d\uff1aqua n zi_ t ime_li ne _ { userId } { \"_id\" : \"5fae539b7e52992e78a3b4ae\" , #\u4e3b\u952eid , \"userId\" : 2 , #\u597d\u53cbid \"publishId\" : \"5fae53d17e52992e78a3db61\" , #\u53d1\u5e03id \"date\" : 1568012791171 #\u53d1\u5e03\u65f6\u95f4 } \u8bc4\u8bba\u8868\uff1a #\u8868\u540d\uff1aqua n zi_comme nt { \"_id\" : \"5fae539d7e52992e78a3b648\" , #\u4e3b\u952eid \"publishId\" : \"5fae53d17e52992e78a3db61\" , #\u53d1\u5e03id \"commentType\" : 1 , #\u8bc4\u8bba\u7c7b\u578b\uff0c 1- \u70b9\u8d5e\uff0c 2- \u8bc4\u8bba\uff0c 3- \u559c\u6b22 \"content\" : \"\u7ed9\u529b\uff01\" , #\u8bc4\u8bba\u5185\u5bb9 \"userId\" : 2 , #\u8bc4\u8bba\u4eba \"publishUserId\" : 9 , #\u53d1\u5e03\u52a8\u6001\u7684\u4eba\u7684id \"isParent\" : false , #\u662f\u5426\u4e3a\u7236\u8282\u70b9\uff0c\u9ed8\u8ba4\u662f\u5426 \"parentId\" : 1001 , #\u7236\u8282\u70b9id \"created\" : 1568012791171 } 3\u3001\u597d\u53cb\u5173\u7cfb\u6570\u636e \u00b6 \u7531\u4e8e\u5708\u5b50\u4e2d\u4f1a\u6d89\u53ca\u7684\u597d\u53cb\u5173\u7cfb\u6570\u636e\uff0c\u867d\u7136\u73b0\u5728\u4e3b\u7ebf\u662f\u5f00\u53d1\u5708\u5b50\u529f\u80fd\uff0c\u4f46\u662f\u4e5f\u9700\u8981\u5bf9\u4e8e\u597d\u53cb\u5173\u7cfb\u6709\u6240\u4e86\u89e3\uff0c\u5728\u6211\u4eec\u63d0\u4f9b\u7684Mongodb\u6570\u636e\u5e93\u4e2d\u6709\u4e00\u4e9bmock\u6570\u636e\u3002 \u597d\u53cb\u5173\u7cfb\u7ed3\u6784\uff1a package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.mongodb.core.mapping.Document ; @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"tanhua_users\" ) public class Users implements java . io . Serializable { private static final long serialVersionUID = 6003135946820874230L ; private ObjectId id ; private Long userId ; //\u7528\u6237id private Long friendId ; //\u597d\u53cbid private Long date ; //\u65f6\u95f4 } \u5728mock\u6570\u636e\u4e2d\uff0c\u4e3a\u6bcf\u4e2a\u7528\u6237\u6784\u9020\u4e8610\u4e2a\u597d\u53cb\u6570\u636e\uff1a 4\u3001\u67e5\u8be2\u597d\u53cb\u52a8\u6001 \u00b6 \u67e5\u8be2\u597d\u53cb\u52a8\u6001\u4e0e\u67e5\u8be2\u63a8\u8350\u52a8\u6001\u663e\u793a\u7684\u7ed3\u6784\u662f\u4e00\u6837\u7684\uff0c\u53ea\u662f\u5176\u67e5\u8be2\u6570\u636e\u6e90\u4e0d\u540c\uff1a 4.1\u3001\u57fa\u7840\u4ee3\u7801 \u00b6 \u5728my-tanhua-dubbo-interface\u4e2d\u7f16\u5199\uff1a package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.annotation.Id ; import org.springframework.data.mongodb.core.mapping.Document ; import java.util.Date ; import java.util.List ; /** * \u53d1\u5e03\u8868\uff0c\u52a8\u6001\u5185\u5bb9 */ @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"quanzi_publish\" ) public class Publish implements java . io . Serializable { private static final long serialVersionUID = 8732308321082804771L ; @Id private ObjectId id ; //\u4e3b\u952eid private Long pid ; //\u53d1\u5e03id private Long userId ; //\u53d1\u5e03\u7528\u6237id private String text ; //\u6587\u5b57 private List < String > medias ; //\u5a92\u4f53\u6570\u636e\uff0c\u56fe\u7247\u6216\u5c0f\u89c6\u9891 url private Integer seeType ; // \u8c01\u53ef\u4ee5\u770b\uff0c1-\u516c\u5f00\uff0c2-\u79c1\u5bc6\uff0c3-\u90e8\u5206\u53ef\u89c1\uff0c4-\u4e0d\u7ed9\u8c01\u770b private List < Long > seeList ; //\u90e8\u5206\u53ef\u89c1\u7684\u5217\u8868 private List < Long > notSeeList ; //\u4e0d\u7ed9\u8c01\u770b\u7684\u5217\u8868 private String longitude ; //\u7ecf\u5ea6 private String latitude ; //\u7eac\u5ea6 private String locationName ; //\u4f4d\u7f6e\u540d\u79f0 private Long created ; //\u53d1\u5e03\u65f6\u95f4 } package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.annotation.Id ; import org.springframework.data.mongodb.core.mapping.Document ; import java.util.Date ; /** * \u76f8\u518c\u8868\uff0c\u7528\u4e8e\u5b58\u50a8\u81ea\u5df1\u53d1\u5e03\u7684\u6570\u636e\uff0c\u6bcf\u4e00\u4e2a\u7528\u6237\u4e00\u5f20\u8868\u8fdb\u884c\u5b58\u50a8 */ @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"quanzi_album_{userId}\" ) public class Album implements java . io . Serializable { private static final long serialVersionUID = 432183095092216817L ; @Id private ObjectId id ; //\u4e3b\u952eid private ObjectId publishId ; //\u53d1\u5e03id private Long created ; //\u53d1\u5e03\u65f6\u95f4 } package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.annotation.Id ; import org.springframework.data.mongodb.core.mapping.Document ; import java.util.Date ; /** * \u65f6\u95f4\u7ebf\u8868\uff0c\u7528\u4e8e\u5b58\u50a8\u53d1\u5e03\u7684\u6570\u636e\uff0c\u6bcf\u4e00\u4e2a\u7528\u6237\u4e00\u5f20\u8868\u8fdb\u884c\u5b58\u50a8 */ @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"quanzi_time_line_{userId}\" ) public class TimeLine implements java . io . Serializable { private static final long serialVersionUID = 9096178416317502524L ; @Id private ObjectId id ; private Long userId ; // \u597d\u53cbid private ObjectId publishId ; //\u53d1\u5e03id private Long date ; //\u53d1\u5e03\u7684\u65f6\u95f4 } package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.annotation.Id ; import org.springframework.data.mongodb.core.mapping.Document ; import java.util.Date ; /** * \u8bc4\u8bba\u8868 */ @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"quanzi_comment\" ) public class Comment implements java . io . Serializable { private static final long serialVersionUID = - 291788258125767614L ; @Id private ObjectId id ; private ObjectId publishId ; //\u53d1\u5e03id private Integer commentType ; //\u8bc4\u8bba\u7c7b\u578b\uff0c1-\u70b9\u8d5e\uff0c2-\u8bc4\u8bba\uff0c3-\u559c\u6b22 private String content ; //\u8bc4\u8bba\u5185\u5bb9 private Long userId ; //\u8bc4\u8bba\u4eba private Long publishUserId ; //\u53d1\u5e03\u52a8\u6001\u7684\u7528\u6237id private Boolean isParent = false ; //\u662f\u5426\u4e3a\u7236\u8282\u70b9\uff0c\u9ed8\u8ba4\u662f\u5426 private ObjectId parentId ; // \u7236\u8282\u70b9id private Long created ; //\u53d1\u8868\u65f6\u95f4 } 4.2\u3001dubbo\u670d\u52a1 \u00b6 \u5708\u5b50\u7684\u5177\u4f53\u4e1a\u52a1\u903b\u8f91\u7684\u5b9e\u73b0\u9700\u8981\u5728dubbo\u4e2d\u5b8c\u6210\uff0c\u6240\u4ee5\u9700\u8981\u5f00\u53d1dubbo\u670d\u52a1\u3002 4.2.1\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 \u5728my-tanhua-dubbo-interface\u5de5\u7a0b\u4e2d\uff1a package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.pojo.Publish ; import com.tanhua.dubbo.server.vo.PageInfo ; public interface QuanZiApi { /** * \u67e5\u8be2\u597d\u53cb\u52a8\u6001 * * @param userId \u7528\u6237id * @param page \u5f53\u524d\u9875\u6570 * @param pageSize \u6bcf\u4e00\u9875\u67e5\u8be2\u7684\u6570\u636e\u6761\u6570 * @return */ PageInfo < Publish > queryPublishList ( Long userId , Integer page , Integer pageSize ); } 4.2.2\u3001\u5b9e\u73b0\u63a5\u53e3 \u00b6 \u5728my-tanhua-dubbo-service\u4e2d\u5b8c\u6210\uff1a package com.tanhua.dubbo.server.api ; import cn.hutool.core.collection.CollUtil ; import com.alibaba.dubbo.config.annotation.Service ; import com.tanhua.dubbo.server.pojo.Publish ; import com.tanhua.dubbo.server.pojo.TimeLine ; import com.tanhua.dubbo.server.vo.PageInfo ; import org.bson.types.ObjectId ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.domain.PageRequest ; import org.springframework.data.domain.Pageable ; import org.springframework.data.domain.Sort ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; import java.util.ArrayList ; import java.util.List ; @Service ( version = \"1.0.0\" ) public class QuanZiApiImpl implements QuanZiApi { @Autowired private MongoTemplate mongoTemplate ; @Override public PageInfo < Publish > queryPublishList ( Long userId , Integer page , Integer pageSize ) { //\u5206\u6790\uff1a\u67e5\u8be2\u597d\u53cb\u7684\u52a8\u6001\uff0c\u5b9e\u9645\u4e0a\u67e5\u8be2\u65f6\u95f4\u7ebf\u8868 PageInfo < Publish > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); Pageable pageable = PageRequest . of ( page - 1 , pageSize , Sort . by ( Sort . Order . desc ( \"date\" ))); Query query = new Query (). with ( pageable ); List < TimeLine > timeLineList = this . mongoTemplate . find ( query , TimeLine . class , \"quanzi_time_line_\" + userId ); if ( CollUtil . isEmpty ( timeLineList )){ //\u6ca1\u6709\u67e5\u8be2\u5230\u6570\u636e return pageInfo ; } //\u83b7\u53d6\u65f6\u95f4\u7ebf\u5217\u8868\u4e2d\u7684\u53d1\u5e03id\u7684\u5217\u8868 List < Object > ids = CollUtil . getFieldValues ( timeLineList , \"publishId\" ); //\u6839\u636e\u52a8\u6001id\u67e5\u8be2\u52a8\u6001\u5217\u8868 Query queryPublish = Query . query ( Criteria . where ( \"id\" ). in ( ids )) . with ( Sort . by ( Sort . Order . desc ( \"created\" ))); List < Publish > publishList = this . mongoTemplate . find ( queryPublish , Publish . class ); pageInfo . setRecords ( publishList ); return pageInfo ; } } \u5f15\u5165Hutool\u5de5\u5177\u5305\uff0c\u5b98\u65b9\u6587\u6863\uff1ahttps://www.hutool.cn/docs/#/ <!-- \u5728my-tanhua\u5de5\u7a0b\u4e2d\u5b9a\u4e49\u4f9d\u8d56 --> <dependency> <groupId> cn.hutool </groupId> <artifactId> hutool-all </artifactId> <version> 5.5.2 </version> </dependency> <!-- \u5728my-tanhua-dubbo-service\u4e2d\u5f15\u5165\u4f7f\u7528 --> <dependency> <groupId> cn.hutool </groupId> <artifactId> hutool-all </artifactId> </dependency> 4.2.3\u3001\u6d4b\u8bd5\u7528\u4f8b \u00b6 package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.pojo.Publish ; import com.tanhua.dubbo.server.vo.PageInfo ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestQuanZiApi { @Autowired private QuanZiApi quanZiApi ; @Test public void testQueryPublishList (){ this . quanZiApi . queryPublishList ( 1L , 1 , 2 ) . getRecords (). forEach ( publish -> System . out . println ( publish )); System . out . println ( \"------------\" ); this . quanZiApi . queryPublishList ( 1L , 2 , 2 ) . getRecords (). forEach ( publish -> System . out . println ( publish )); System . out . println ( \"------------\" ); this . quanZiApi . queryPublishList ( 1L , 3 , 2 ) . getRecords (). forEach ( publish -> System . out . println ( publish )); } } \u6d4b\u8bd5\u7ed3\u679c\uff1a 4.3\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 \u5f00\u53d1\u5b8c\u6210dubbo\u670d\u52a1\u540e\uff0c\u6211\u4eec\u5c06\u5f00\u53d1APP\u7aef\u7684\u63a5\u53e3\u670d\u52a1\uff0c\u4f9d\u7136\u662f\u9700\u8981\u6309\u7167mock\u63a5\u53e3\u7684\u4e2d\u7684\u63a5\u53e3\u5b9a\u4e49\u5b9e\u73b0\u3002 \u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/683 4.3.1\u3001QuanZiVo \u00b6 \u6839\u636e\u63a5\u53e3\u4e2d\u54cd\u5e94\u7684\u6570\u636e\u7ed3\u6784\u8fdb\u884c\u5b9a\u4e49vo\u5bf9\u8c61\uff1a(\u5728my-tanhua-server\u5de5\u7a0b\u4e2d) package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class QuanZiVo { private String id ; //\u52a8\u6001id private Long userId ; //\u7528\u6237id private String avatar ; //\u5934\u50cf private String nickname ; //\u6635\u79f0 private String gender ; //\u6027\u522b man woman private Integer age ; //\u5e74\u9f84 private String [] tags ; //\u6807\u7b7e private String textContent ; //\u6587\u5b57\u52a8\u6001 private String [] imageContent ; //\u56fe\u7247\u52a8\u6001 private String distance ; //\u8ddd\u79bb private String createDate ; //\u53d1\u5e03\u65f6\u95f4 \u5982: 10\u5206\u949f\u524d private Integer likeCount ; //\u70b9\u8d5e\u6570 private Integer commentCount ; //\u8bc4\u8bba\u6570 private Integer loveCount ; //\u559c\u6b22\u6570 private Integer hasLiked ; //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 private Integer hasLoved ; //\u662f\u5426\u559c\u6b22\uff081\u662f\uff0c0\u5426\uff09 } 4.3.2\u3001QuanZiController \u00b6 \u6839\u636e\u670d\u52a1\u63a5\u53e3\u7f16\u5199QuanZiController\uff0c\u5176\u8bf7\u6c42\u65b9\u6cd5\u4e3aGET\u8bf7\u6c42\uff0c\u4f1a\u4f20\u9012page\u3001pageSize\u3001token\u7b49\u4fe1\u606f\u3002 \u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b\uff1a package com.tanhua.server.controller ; import com.tanhua.server.service.QuanZiService ; import com.tanhua.server.vo.PageResult ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.* ; @RestController @RequestMapping ( \"movements\" ) public class QuanZiController { @Autowired private QuanZiService quanZiService ; /** * \u67e5\u8be2\u597d\u53cb\u52a8\u6001 * * @param page * @param pageSize * @return */ @GetMapping public PageResult queryPublishList ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize , @RequestHeader ( \"Authorization\" ) String token ) { return this . quanZiService . queryPublishList ( page , pageSize , token ); } } 4.3.3\u3001QuanZiService \u00b6 \u5728QuanZiService\u4e2d\u5c06\u5b9e\u73b0\u5177\u4f53\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u9700\u8981\u8c03\u7528quanzi\u7684dubbo\u670d\u52a1\u5b8c\u6210\u6570\u636e\u7684\u67e5\u8be2\uff0c\u5e76\u4e14\u8981\u5b8c\u6210\u7528\u6237\u767b\u5f55\u662f\u5426\u6709\u6548\u7684\u6821\u9a8c\uff0c\u6700\u540e\u6309\u7167\u670d\u52a1\u63a5\u53e3\u4e2d\u5b9a\u4e49\u7684\u7ed3\u6784\u8fdb\u884c\u5c01\u88c5\u6570\u636e\u3002 package com.tanhua.server.service ; import cn.hutool.core.bean.BeanUtil ; import cn.hutool.core.collection.CollUtil ; import cn.hutool.core.util.StrUtil ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.common.pojo.User ; import com.tanhua.common.pojo.UserInfo ; import com.tanhua.common.utils.RelativeDateFormat ; import com.tanhua.dubbo.server.api.QuanZiApi ; import com.tanhua.dubbo.server.pojo.Publish ; import com.tanhua.dubbo.server.vo.PageInfo ; import com.tanhua.server.vo.PageResult ; import com.tanhua.server.vo.QuanZiVo ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import java.util.ArrayList ; import java.util.Date ; import java.util.List ; @Service public class QuanZiService { @Reference ( version = \"1.0.0\" ) private QuanZiApi quanZiApi ; @Autowired private UserService userService ; @Autowired private UserInfoService userInfoService ; public PageResult queryPublishList ( Integer page , Integer pageSize , String token ) { //\u5206\u6790\uff1a\u901a\u8fc7dubbo\u4e2d\u7684\u670d\u52a1\u67e5\u8be2\u7528\u6237\u7684\u597d\u53cb\u52a8\u6001 //\u901a\u8fc7mysql\u67e5\u8be2\u7528\u6237\u7684\u4fe1\u606f\uff0c\u56de\u5199\u5230\u7ed3\u679c\u5bf9\u8c61\u4e2d\uff08QuanZiVo\uff09 PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); //\u6821\u9a8ctoken\u662f\u5426\u6709\u6548 User user = this . userService . queryUserByToken ( token ); if ( user == null ) { //token\u5df2\u7ecf\u5931\u6548 return pageResult ; } //\u901a\u8fc7dubbo\u67e5\u8be2\u6570\u636e PageInfo < Publish > pageInfo = this . quanZiApi . queryPublishList ( user . getId (), page , pageSize ); List < Publish > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )) { return pageResult ; } List < QuanZiVo > quanZiVoList = new ArrayList <> (); records . forEach ( publish -> { QuanZiVo quanZiVo = new QuanZiVo (); quanZiVo . setId ( publish . getId (). toHexString ()); quanZiVo . setTextContent ( publish . getText ()); quanZiVo . setImageContent ( publish . getMedias (). toArray ( new String [] {})); quanZiVo . setUserId ( publish . getUserId ()); quanZiVo . setCreateDate ( RelativeDateFormat . format ( new Date ( publish . getCreated ()))); quanZiVoList . add ( quanZiVo ); }); //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIds = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); for ( QuanZiVo quanZiVo : quanZiVoList ) { //\u627e\u5230\u5bf9\u5e94\u7684\u7528\u6237\u4fe1\u606f for ( UserInfo userInfo : userInfoList ) { if ( quanZiVo . getUserId (). longValue () == userInfo . getUserId (). longValue ()){ this . fillUserInfoToQuanZiVo ( userInfo , quanZiVo ); break ; } } } pageResult . setItems ( quanZiVoList ); return pageResult ; } /** * \u586b\u5145\u7528\u6237\u4fe1\u606f * * @param userInfo * @param quanZiVo */ private void fillUserInfoToQuanZiVo ( UserInfo userInfo , QuanZiVo quanZiVo ){ BeanUtil . copyProperties ( userInfo , quanZiVo , \"id\" ); quanZiVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); quanZiVo . setTags ( StringUtils . split ( userInfo . getTags (), ',' )); quanZiVo . setCommentCount ( 0 ); //TODO \u8bc4\u8bba\u6570 quanZiVo . setDistance ( \"1.2\u516c\u91cc\" ); //TODO \u8ddd\u79bb quanZiVo . setHasLiked ( 0 ); //TODO \u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLikeCount ( 0 ); //TODO \u70b9\u8d5e\u6570 quanZiVo . setHasLoved ( 0 ); //TODO \u662f\u5426\u559c\u6b22\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLoveCount ( 0 ); //TODO \u559c\u6b22\u6570 } } // com.tanhua.server.service.UserInfoService /** * \u6839\u636e\u7528\u6237id\u7684\u96c6\u5408\u67e5\u8be2\u7528\u6237\u5217\u8868 * * @param userIds * @return */ public List < UserInfo > queryUserInfoList ( Collection <?> userIds ) { QueryWrapper < UserInfo > queryWrapper = new QueryWrapper <> (); queryWrapper . in ( \"user_id\" , userIds ); return this . queryUserInfoList ( queryWrapper ); } \u5728com.tanhua.server.vo.QuanZiVo\u4e2d\u589e\u52a0\u5b57\u6bb5\u522b\u540d\uff0c\u65b9\u4fbf\u76f4\u63a5\u62f7\u8d1d\u5c5e\u6027\u6570\u636e\uff1a package com.tanhua.server.vo ; import cn.hutool.core.annotation.Alias ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class QuanZiVo { private String id ; //\u52a8\u6001id private Long userId ; //\u7528\u6237id @Alias ( \"logo\" ) //\u522b\u540d private String avatar ; //\u5934\u50cf @Alias ( \"nickName\" ) //\u522b\u540d private String nickname ; //\u6635\u79f0 private String gender ; //\u6027\u522b man woman private Integer age ; //\u5e74\u9f84 private String [] tags ; //\u6807\u7b7e private String textContent ; //\u6587\u5b57\u52a8\u6001 private String [] imageContent ; //\u56fe\u7247\u52a8\u6001 private String distance ; //\u8ddd\u79bb private String createDate ; //\u53d1\u5e03\u65f6\u95f4 \u5982: 10\u5206\u949f\u524d private Integer likeCount ; //\u70b9\u8d5e\u6570 private Integer commentCount ; //\u8bc4\u8bba\u6570 private Integer loveCount ; //\u559c\u6b22\u6570 private Integer hasLiked ; //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 private Integer hasLoved ; //\u662f\u5426\u559c\u6b22\uff081\u662f\uff0c0\u5426\uff09 } 4.3.4\u3001\u6d4b\u8bd5 \u00b6 5\u3001\u7edf\u4e00\u6821\u9a8ctoken \u00b6 \u5728\u4e4b\u524d\u7684\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u4f1a\u5728\u6bcf\u4e00\u4e2aService\u4e2d\u5bf9token\u505a\u5904\u7406\uff0c\u76f8\u540c\u7684\u903b\u8f91\u4e00\u5b9a\u662f\u8981\u8fdb\u884c\u7edf\u4e00\u5904\u7406\u7684\uff0c\u8be5\u5982\u4f55\u5904\u7406\u5462\uff1f \u7531\u4e8e\u7a0b\u5e8f\u662f\u8fd0\u884c\u5728web\u5bb9\u5668\u4e2d\uff0c\u6bcf\u4e00\u4e2aHTTP\u8bf7\u6c42\u90fd\u662f\u4e00\u4e2a\u72ec\u7acb\u7ebf\u7a0b\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5\u7406\u89e3\u6210\u6211\u4eec\u7f16\u5199\u7684\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u5728\u4e00\u4e2a\u591a\u7ebf\u7a0b\u7684\u73af\u5883\u4e2d\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528ThreadLocal\u5728HTTP\u8bf7\u6c42\u7684\u751f\u547d\u5468\u671f\u5185\u8fdb\u884c\u5b58\u503c\u3001\u53d6\u503c\u64cd\u4f5c\u3002 \u5982\u4e0b\u56fe\uff1a \u8bf4\u660e\uff1a \u7528\u6237\u7684\u6bcf\u4e00\u4e2a\u8bf7\u6c42\uff0c\u90fd\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u7ebf\u7a0b \u56fe\u4e2d\u7684TL\u5c31\u662fThreadLocal\uff0c\u4e00\u65e6\u5c06\u6570\u636e\u7ed1\u5b9a\u5230ThreadLocal\u4e2d\uff0c\u90a3\u4e48\u5728\u6574\u4e2a\u8bf7\u6c42\u7684\u751f\u547d\u5468\u671f\u5185\u90fd\u53ef\u4ee5\u968f\u65f6\u62ff\u5230ThreadLocal\u4e2d\u5f53\u524d\u7ebf\u7a0b\u7684\u6570\u636e\u3002 \u6839\u636e\u4e0a\u9762\u7684\u5206\u6790\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5728Controller\u8bf7\u6c42\u4e4b\u524d\u8fdb\u884c\u5bf9token\u505a\u6821\u9a8c\uff0c\u5982\u679ctoken\u6709\u6548\uff0c\u5219\u4f1a\u62ff\u5230User\u5bf9\u8c61\uff0c\u7136\u540e\u5c06\u8be5User\u5bf9\u8c61\u4fdd\u5b58\u5230ThreadLocal\u4e2d\u5373\u53ef\uff0c\u6700\u540e\u653e\u884c\u8bf7\u6c42\uff0c\u5728\u540e\u7eed\u7684\u5404\u4e2a\u73af\u8282\u4e2d\u90fd\u53ef\u4ee5\u83b7\u53d6\u5230\u8be5\u6570\u636e\u4e86\u3002 \u5982\u679ctoken\u65e0\u6548\uff0c\u7ed9\u5ba2\u6237\u7aef\u54cd\u5e94401\u72b6\u6001\u7801\uff0c\u62e6\u622a\u8bf7\u6c42\uff0c\u4e0d\u518d\u653e\u884c\u5230Controller\u4e2d\u3002 \u7531\u6b64\u53ef\u89c1\uff0c\u8fd9\u4e2a\u6821\u9a8c\u7684\u903b\u8f91\u662f\u6bd4\u8f83\u9002\u5408\u653e\u5728\u62e6\u622a\u5668\u4e2d\u5b8c\u6210\u7684\u3002 5.1\u3001\u7f16\u5199UserThreadLocal \u00b6 \u5728my-tanhua-common\u5de5\u7a0b\u4e2d\uff0c\u7f16\u5199UserThreadLocal\u3002 package com.tanhua.common.utils ; import com.tanhua.common.pojo.User ; public class UserThreadLocal { private static final ThreadLocal < User > LOCAL = new ThreadLocal <> (); private UserThreadLocal (){ } /** * \u5c06\u5bf9\u8c61\u653e\u5165\u5230ThreadLocal * * @param user */ public static void set ( User user ){ LOCAL . set ( user ); } /** * \u8fd4\u56de\u5f53\u524d\u7ebf\u7a0b\u4e2d\u7684User\u5bf9\u8c61 * * @return */ public static User get (){ return LOCAL . get (); } /** * \u5220\u9664\u5f53\u524d\u7ebf\u7a0b\u4e2d\u7684User\u5bf9\u8c61 */ public static void remove (){ LOCAL . remove (); } } 5.2\u3001\u7f16\u5199TokenInterceptor \u00b6 package com.tanhua.server.interceptor ; import cn.hutool.core.util.StrUtil ; import com.tanhua.common.pojo.User ; import com.tanhua.common.utils.NoAuthorization ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.server.service.UserService ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Component ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.method.HandlerMethod ; import org.springframework.web.servlet.HandlerInterceptor ; import javax.servlet.http.HttpServletRequest ; import javax.servlet.http.HttpServletResponse ; @Component public class UserTokenInterceptor implements HandlerInterceptor { @Autowired private UserService userService ; @Override public boolean preHandle ( HttpServletRequest request , HttpServletResponse response , Object handler ) throws Exception { //\u6821\u9a8chandler\u662f\u5426\u662fHandlerMethod if ( ! ( handler instanceof HandlerMethod )) { return true ; } //\u5224\u65ad\u662f\u5426\u5305\u542b@NoAuthorization\u6ce8\u89e3\uff0c\u5982\u679c\u5305\u542b\uff0c\u76f4\u63a5\u653e\u884c if ((( HandlerMethod ) handler ). hasMethodAnnotation ( NoAuthorization . class )) { return true ; } //\u4ece\u8bf7\u6c42\u5934\u4e2d\u83b7\u53d6token String token = request . getHeader ( \"Authorization\" ); if ( StrUtil . isNotEmpty ( token )){ User user = this . userService . queryUserByToken ( token ); if ( user != null ){ //token\u6709\u6548 //\u5c06User\u5bf9\u8c61\u653e\u5165\u5230ThreadLocal\u4e2d UserThreadLocal . set ( user ); return true ; } } //token\u65e0\u6548\uff0c\u54cd\u5e94\u72b6\u6001\u4e3a401 response . setStatus ( 401 ); //\u65e0\u6743\u9650 return false ; } @Override public void afterCompletion ( HttpServletRequest request , HttpServletResponse response , Object handler , Exception ex ) throws Exception { //\u4eceThreadLocal\u4e2d\u79fb\u9664User\u5bf9\u8c61 UserThreadLocal . remove (); } } 5.3\u3001\u7f16\u5199\u6ce8\u89e3NoAuthorization \u00b6 package com.tanhua.common.utils ; import java.lang.annotation.* ; @Target ( ElementType . METHOD ) @Retention ( RetentionPolicy . RUNTIME ) @Documented //\u6807\u8bb0\u6ce8\u89e3 public @interface NoAuthorization { } 5.4\u3001\u6ce8\u518c\u62e6\u622a\u5668 \u00b6 package com.tanhua.server.config ; import com.tanhua.server.interceptor.RedisCacheInterceptor ; import com.tanhua.server.interceptor.UserTokenInterceptor ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.context.annotation.Configuration ; import org.springframework.web.servlet.config.annotation.InterceptorRegistry ; import org.springframework.web.servlet.config.annotation.WebMvcConfigurer ; @Configuration public class WebConfig implements WebMvcConfigurer { @Autowired private RedisCacheInterceptor redisCacheInterceptor ; @Autowired private UserTokenInterceptor userTokenInterceptor ; @Override public void addInterceptors ( InterceptorRegistry registry ) { //\u8003\u8651\u62e6\u622a\u5668\u7684\u987a\u5e8f registry . addInterceptor ( this . userTokenInterceptor ). addPathPatterns ( \"/**\" ); registry . addInterceptor ( this . redisCacheInterceptor ). addPathPatterns ( \"/**\" ); } } 5.5\u3001\u4f7f\u7528ThreadLocal \u00b6 \u5728\u6240\u6709\u7684Service\u4e2d\uff0c\u5982\u679c\u9700\u8981\u83b7\u53d6User\u5bf9\u8c61\u7684\uff0c\u76f4\u63a5\u4eceUserThreadLocal\u83b7\u53d6\u5373\u53ef\uff0c\u540c\u65f6\u5728Controller\u4e2d\u4e5f\u65e0\u9700\u8fdb\u884c\u83b7\u53d6token\u64cd\u4f5c\u3002 \u4f8b\u5982\uff1a //com.tanhua.server.service.QuanZiService public PageResult queryPublishList ( Integer page , Integer pageSize ) { PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); //\u83b7\u53d6User\u5bf9\u8c61\uff0c\u65e0\u9700\u5bf9User\u5bf9\u8c61\u6821\u9a8c\uff0c\u5176\u4e00\u5b9a\u4e0d\u4e3anull User user = UserThreadLocal . get (); PageInfo < Publish > pageInfo = this . quanZiApi . queryPublishList ( user . getId (), page , pageSize ); //\u3002\u3002\u3002\u3002\u4ee3\u7801\u7565\u3002\u3002\u3002\u3002\u3002 return pageResult ; } \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728APP\u4e2d\uff0c\u5982\u679c\u8bf7\u6c42\u54cd\u5e94401\uff0c\u4f1a\u8df3\u8f6c\u5230\u767b\u5f55\u9875\u9762\u3002 6\u3001\u53d1\u5e03\u52a8\u6001 \u00b6 \u7528\u6237\u53ef\u4ee5\u5728\u5708\u5b50\u4e2d\u53d1\u5e03\u52a8\u6001\uff0c\u52a8\u6001\u5185\u5bb9\u4e2d\u53ef\u4ee5\u6709\u6587\u5b57\u548c\u56fe\u7247\u3002\u5982\u4e0b\u56fe\uff1a 6.1\u3001dubbo\u670d\u52a1 \u00b6 6.1.1\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.pojo.Publish ; import com.tanhua.dubbo.server.vo.PageInfo ; public interface QuanZiApi { /** * \u67e5\u8be2\u597d\u53cb\u52a8\u6001 * * @param userId \u7528\u6237id * @param page \u5f53\u524d\u9875\u6570 * @param pageSize \u6bcf\u4e00\u9875\u67e5\u8be2\u7684\u6570\u636e\u6761\u6570 * @return */ PageInfo < Publish > queryPublishList ( Long userId , Integer page , Integer pageSize ); /** * \u53d1\u5e03\u52a8\u6001 * * @param publish * @return \u53d1\u5e03\u6210\u529f\u8fd4\u56de\u52a8\u6001id */ String savePublish ( Publish publish ); } 6.1.2\u3001\u5b9e\u73b0\u63a5\u53e3 \u00b6 /** * \u53d1\u5e03\u52a8\u6001 * * @param publish * @return \u53d1\u5e03\u6210\u529f\u8fd4\u56de\u52a8\u6001id */ public String savePublish ( Publish publish ) { //\u5bf9publish\u5bf9\u8c61\u6821\u9a8c if ( ! ObjectUtil . isAllNotEmpty ( publish . getText (), publish . getUserId ())) { //\u53d1\u5e03\u5931\u8d25 return null ; } //\u8bbe\u7f6e\u4e3b\u952eid publish . setId ( ObjectId . get ()); try { //\u8bbe\u7f6e\u81ea\u589e\u957f\u7684pid publish . setPid ( this . idService . createId ( IdType . PUBLISH )); publish . setCreated ( System . currentTimeMillis ()); //\u5199\u5165\u5230publish\u8868\u4e2d this . mongoTemplate . save ( publish ); //\u5199\u5165\u76f8\u518c\u8868 Album album = new Album (); album . setId ( ObjectId . get ()); album . setCreated ( System . currentTimeMillis ()); album . setPublishId ( publish . getId ()); this . mongoTemplate . save ( album , \"quanzi_album_\" + publish . getUserId ()); //\u5199\u5165\u597d\u53cb\u7684\u65f6\u95f4\u7ebf\u8868\uff08\u5f02\u6b65\u5199\u5165\uff09 this . timeLineService . saveTimeLine ( publish . getUserId (), publish . getId ()); } catch ( Exception e ) { //TODO \u9700\u8981\u505a\u4e8b\u52a1\u7684\u56de\u6eda\uff0cMongodb\u7684\u5355\u8282\u70b9\u670d\u52a1\uff0c\u4e0d\u652f\u6301\u4e8b\u52a1\uff0c\u5bf9\u4e8e\u56de\u6eda\u6211\u4eec\u6682\u65f6\u4e0d\u5b9e\u73b0\u4e86 log . error ( \"\u53d1\u5e03\u52a8\u6001\u5931\u8d25~ publish = \" + publish , e ); } return publish . getId (). toHexString (); } package com.tanhua.dubbo.server.service ; import com.tanhua.dubbo.server.enums.IdType ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.redis.core.RedisTemplate ; import org.springframework.stereotype.Service ; //\u751f\u6210\u81ea\u589e\u957f\u7684id\uff0c\u539f\u7406\uff1a\u4f7f\u7528redis\u7684\u81ea\u589e\u957f\u503c @Service public class IdService { @Autowired private RedisTemplate < String , String > redisTemplate ; public Long createId ( IdType idType ) { String idKey = \"TANHUA_ID_\" + idType . toString (); return this . redisTemplate . opsForValue (). increment ( idKey ); } } package com.tanhua.dubbo.server.enums ; public enum IdType { PUBLISH , VIDEO ; } 6.1.3\u3001\u597d\u53cb\u65f6\u95f4\u7ebf\u6570\u636e \u00b6 \u597d\u53cb\u7684\u65f6\u95f4\u7ebf\u6570\u636e\u9700\u8981\u5f02\u6b65\u6267\u884c\u3002\u8fd9\u91cc\u4f7f\u7528Spring\u7684@Async\u6ce8\u89e3\u5b9e\u73b0\u5f02\u6b65\u6267\u884c\uff0c\u5176\u5e95\u5c42\u662f\u901a\u8fc7\u542f\u52a8\u72ec\u7acb\u7ebf\u7a0b\u6765\u6267\u884c\uff0c\u4ece\u800c\u53ef\u4ee5\u5f02\u6b65\u6267\u884c\u3002\u901a\u8fc7\u8fd4\u56de\u7684CompletableFuture\u6765\u5224\u65ad\u662f\u5426\u6267\u884c\u6210\u529f\u4ee5\u53ca\u662f\u5426\u5b58\u5728\u5f02\u5e38\u3002\u540c\u65f6\u9700\u8981\u5728\u542f\u52a8\u7c7b\u4e2d\u6dfb\u52a0@EnableAsync \u5f00\u542f\u5f02\u6b65\u7684\u652f\u6301\u3002 package com.tanhua.dubbo.server.service ; import cn.hutool.core.collection.CollUtil ; import com.tanhua.dubbo.server.pojo.TimeLine ; import com.tanhua.dubbo.server.pojo.Users ; import lombok.extern.slf4j.Slf4j ; import org.bson.types.ObjectId ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; import org.springframework.scheduling.annotation.Async ; import org.springframework.stereotype.Service ; import java.util.List ; import java.util.concurrent.CompletableFuture ; @Service @Slf4j public class TimeLineService { @Autowired private MongoTemplate mongoTemplate ; @Async //\u5f02\u6b65\u6267\u884c\uff0c\u539f\u7406\uff1a\u5e95\u5c42\u5f00\u4e00\u4e2a\u7ebf\u7a0b\u53bb\u6267\u884c\u8be5\u65b9\u6cd5 public CompletableFuture < String > saveTimeLine ( Long userId , ObjectId publishId ) { //\u5199\u5165\u597d\u53cb\u7684\u65f6\u95f4\u7ebf\u8868 try { //\u67e5\u8be2\u597d\u53cb\u5217\u8868 Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId )); List < Users > usersList = this . mongoTemplate . find ( query , Users . class ); if ( CollUtil . isEmpty ( usersList )) { //\u8fd4\u56de\u6210\u529f return CompletableFuture . completedFuture ( \"ok\" ); } //\u4f9d\u6b21\u5199\u5165\u5230\u597d\u53cb\u7684\u65f6\u95f4\u7ebf\u8868\u4e2d for ( Users users : usersList ) { TimeLine timeLine = new TimeLine (); timeLine . setId ( ObjectId . get ()); timeLine . setDate ( System . currentTimeMillis ()); timeLine . setPublishId ( publishId ); timeLine . setUserId ( userId ); //\u5199\u5165\u6570\u636e this . mongoTemplate . save ( timeLine , \"quanzi_time_line_\" + users . getFriendId ()); } } catch ( Exception e ) { log . error ( \"\u5199\u5165\u597d\u53cb\u65f6\u95f4\u7ebf\u8868\u5931\u8d25~ userId = \" + userId + \", publishId = \" + publishId , e ); //TODO \u4e8b\u52a1\u56de\u6eda\u95ee\u9898 return CompletableFuture . completedFuture ( \"error\" ); } return CompletableFuture . completedFuture ( \"ok\" ); } } \u5f00\u542f\u5f02\u6b65\u6267\u884c\uff1a package com.tanhua.dubbo.server ; import cn.hutool.core.util.StrUtil ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; import org.springframework.scheduling.annotation.EnableAsync ; @SpringBootApplication @EnableAsync //\u5f00\u542f\u5f02\u6b65\u6267\u884c\u7684\u652f\u6301 public class DubboApplication { public static void main ( String [] args ) { SpringApplication . run ( DubboApplication . class , args ); } } 6.1.4\u3001\u6d4b\u8bd5\u597d\u53cb\u65f6\u95f4\u7ebf \u00b6 package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.service.TimeLineService ; import org.bson.types.ObjectId ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; import java.util.concurrent.CompletableFuture ; import java.util.concurrent.ExecutionException ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestTimeLineService { @Autowired private TimeLineService timeLineService ; @Test public void testSaveTimeLine () { ObjectId objectId = ObjectId . get (); System . out . println ( \"\u751f\u6210\u7684id\u4e3a\uff1a\" + objectId . toHexString ()); CompletableFuture < String > future = this . timeLineService . saveTimeLine ( 1L , objectId ); future . whenComplete (( s , throwable ) -> { System . out . println ( \"\u6267\u884c\u5b8c\u6210\uff1a\" + s ); }); System . out . println ( \"\u5f02\u6b65\u65b9\u6cd5\u6267\u884c\u5b8c\u6210\" ); try { future . get (); //\u963b\u585e\u5f53\u524d\u7684\u4e3b\u7ebf\u7a0b\uff0c\u7b49\u5f85\u5f02\u6b65\u6267\u884c\u7684\u7ed3\u675f } catch ( Exception e ) { e . printStackTrace (); } } } 6.1.5\u3001\u6d4b\u8bd5\u53d1\u5e03\u52a8\u6001 \u00b6 \u5c06dubbo\u670d\u52a1\u542f\u52a8\u8d77\u6765\uff0c\u5728my-tanhua-server\u5de5\u7a0b\u4e2d\u8fdb\u884c\u529f\u80fd\u7684\u6d4b\u8bd5\uff1a package com.tanhua.server ; import cn.hutool.core.collection.ListUtil ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.dubbo.server.api.QuanZiApi ; import com.tanhua.dubbo.server.pojo.Publish ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestQuanZiApi { @Reference ( version = \"1.0.0\" ) private QuanZiApi quanZiApi ; @Test public void testSavePublish (){ Publish publish = new Publish (); publish . setText ( \"\u4eba\u751f\u4e0d\u5982\u610f\u4e8b\u5341\u4e4b\u516b\u4e5d\uff0c\u771f\u6b63\u6709\u683c\u5c40\u7684\u4eba\uff0c\u65e2\u80fd\u4eab\u53d7\u6700\u597d\u7684\uff0c\u4e5f\u80fd\u627f\u53d7\u6700\u574f\u7684\u3002\" ); publish . setMedias ( ListUtil . toList ( \"https://tanhua-dev.oss-cn-zhangjiakou.aliyuncs.com/photo/6/1.jpg\" , \"https://tanhua-dev.oss-cn-zhangjiakou.aliyuncs.com/photo/6/CL-3.jpg\" )); publish . setUserId ( 1L ); publish . setSeeType ( 1 ); publish . setLongitude ( \"116.350426\" ); publish . setLatitude ( \"40.066355\" ); publish . setLocationName ( \"\u4e2d\u56fd\u5317\u4eac\u5e02\u660c\u5e73\u533a\u5efa\u6750\u57ce\u897f\u8def16\u53f7\" ); this . quanZiApi . savePublish ( publish ); } } 6.2\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 \u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/701 \u4ece\u63a5\u53e3\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u4e3b\u8981\u7684\u53c2\u6570\u6709\uff1a\u6587\u5b57\u3001\u56fe\u7247\u3001\u4f4d\u7f6e\u7b49\u5185\u5bb9\u3002 6.2.1\u3001\u56fe\u7247\u4e0a\u4f20 \u00b6 \u56fe\u7247\u4e0a\u4f20\u529f\u80fd\u539f\u6765\u662f\u5728sso\u4e2d\u5b8c\u6210\u7684\uff0c\u4e3a\u4e86\u80fd\u516c\u7528\u8be5\u529f\u80fd\uff0c\u6240\u4ee5\u9700\u8981\u5c06\u56fe\u7247\u4e0a\u4f20\u7684Service\u4ee5\u53ca\u914d\u7f6e\u79fb\u52a8\u81f3common\u5de5\u7a0b\u4e2d\u3002 pom.xml\uff1a <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <parent> <artifactId> my-tanhua </artifactId> <groupId> cn.itcast.tanhua </groupId> <version> 1.0-SNAPSHOT </version> </parent> <modelVersion> 4.0.0 </modelVersion> <artifactId> my-tanhua-common </artifactId> <dependencies> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-web </artifactId> </dependency> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> </dependency> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus-boot-starter </artifactId> </dependency> <dependency> <groupId> com.fasterxml.jackson.core </groupId> <artifactId> jackson-databind </artifactId> </dependency> <dependency> <groupId> com.aliyun.oss </groupId> <artifactId> aliyun-sdk-oss </artifactId> </dependency> <dependency> <groupId> org.apache.commons </groupId> <artifactId> commons-lang3 </artifactId> </dependency> <dependency> <groupId> joda-time </groupId> <artifactId> joda-time </artifactId> </dependency> </dependencies> </project> \u9700\u8981\u6ce8\u610f3\u70b9\uff1a \u5c06sso\u7cfb\u7edf\u4e2d\u7684\u76f8\u5173\u4ee3\u7801\u5220\u9664 \u5c06aliyun.properties\u590d\u5236\u5230my-tanhua-server\u4e2d \u542f\u52a8\u7c7b\u4e2d\u9700\u8981\u5c06\u5305\u626b\u63cf\u8303\u56f4\u6269\u5927\u5230comm.tanhua\uff0c\u56e0\u4e3a\u76f8\u5173\u7c7b\u88ab\u79fb\u52a8\u5230com.tanhua.common\u4e0b\uff0c\u9ed8\u8ba4\u626b\u63cf\u4e0d\u80fd\u88ab\u626b\u63cf\u5230\u3002 sso\u4e0eserver\u7cfb\u7edf\u90fd\u9700\u8981\u8bbe\u7f6e\uff1a ~~~java package com.tanhua.server; @MapperScan(\"com.tanhua.common.mapper\") //\u8bbe\u7f6emapper\u63a5\u53e3\u7684\u626b\u63cf\u5305 @SpringBootApplication(exclude = {MongoAutoConfiguration.class, MongoDataAutoConfiguration.class}) //\u6392\u9664mongo\u7684\u81ea\u52a8\u914d\u7f6e @ComponentScan(basePackages={\"com.tanhua\"}) //\u8bbe\u7f6e\u626b\u63cf\u5305\u8303\u56f4 public class ServerApplication { public static void main(String[] args) { SpringApplication.run(ServerApplication.class, args); } } ~~~ 6.2.2\u3001\u63a5\u53e3\u670d\u52a1 \u00b6 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6587\u5b57\u662f\u5fc5\u987b\u63d0\u4ea4\u7684\uff0c\u56fe\u7247\u662f\u975e\u5fc5\u987b\u7684\u3002 //com.tanhua.server.controller.QuanZiController /** * \u53d1\u9001\u52a8\u6001 * * @param textContent * @param location * @param multipartFile * @return */ @PostMapping public ResponseEntity < Void > savePublish ( @RequestParam ( \"textContent\" ) String textContent , @RequestParam ( value = \"location\" , required = false ) String location , @RequestParam ( value = \"latitude\" , required = false ) String latitude , @RequestParam ( value = \"longitude\" , required = false ) String longitude , @RequestParam ( value = \"imageContent\" , required = false ) MultipartFile [] multipartFile ) { try { String publishId = this . quanZiService . savePublish ( textContent , location , latitude , longitude , multipartFile ); if ( StrUtil . isNotEmpty ( publishId )) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 6.2.3\u3001QuanZiService\u5b9e\u73b0 \u00b6 // com.tanhua.server.service.QuanZiService @Autowired private PicUploadService picUploadService ; public String savePublish ( String textContent , String location , String latitude , String longitude , MultipartFile [] multipartFile ) { //\u67e5\u8be2\u5f53\u524d\u7684\u767b\u5f55\u4fe1\u606f User user = UserThreadLocal . get (); Publish publish = new Publish (); publish . setUserId ( user . getId ()); publish . setText ( textContent ); publish . setLocationName ( location ); publish . setLatitude ( latitude ); publish . setLongitude ( longitude ); publish . setSeeType ( 1 ); List < String > picUrls = new ArrayList <> (); //\u56fe\u7247\u4e0a\u4f20 for ( MultipartFile file : multipartFile ) { PicUploadResult picUploadResult = this . picUploadService . upload ( file ); picUrls . add ( picUploadResult . getName ()); } publish . setMedias ( picUrls ); return this . quanZiApi . savePublish ( publish ); } 7\u3001\u67e5\u8be2\u63a8\u8350\u52a8\u6001 \u00b6 \u63a8\u8350\u52a8\u6001\u662f\u901a\u8fc7\u63a8\u8350\u7cfb\u7edf\u8ba1\u7b97\u51fa\u7684\u7ed3\u679c\uff0c\u73b0\u5728\u6211\u4eec\u53ea\u9700\u8981\u5b9e\u73b0\u67e5\u8be2\u5373\u53ef\uff0c\u63a8\u8350\u7cfb\u7edf\u5728\u540e\u9762\u7684\u8bfe\u7a0b\u4e2d\u5b8c\u6210\u3002 \u63a8\u8350\u7cfb\u7edf\u8ba1\u7b97\u5b8c\u6210\u540e\uff0c\u4f1a\u5c06\u7ed3\u679c\u6570\u636e\u5199\u5165\u5230Redis\u4e2d\uff0c\u6570\u636e\u5982\u4e0b\uff1a 192 .168.31.81:6379> get QUANZI_PUBLISH_RECOMMEND_1 \"2562,3639,2063,3448,2128,2597,2893,2333,3330,2642,2541,3002,3561,3649,2384,2504,3397,2843,2341,2249\" \u53ef\u4ee5\u770b\u5230\uff0c\u5728Redis\u4e2d\u7684\u6570\u636e\u662f\u6709\u591a\u4e2a\u53d1\u5e03id\u7ec4\u6210\uff08pid\uff09\u7531\u9017\u53f7\u5206\u9694\u3002\u6240\u4ee5\u5b9e\u73b0\u4e2d\u9700\u8981\u81ea\u5df1\u5bf9\u8fd9\u4e9b\u6570\u636e\u505a\u5206\u9875\u5904\u7406\u3002 7.1\u3001dubbo\u670d\u52a1 \u00b6 7.1.1\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 //com.tanhua.dubbo.server.api.QuanZiApi /** * \u67e5\u8be2\u63a8\u8350\u52a8\u6001 * * @param userId \u7528\u6237id * @param page \u5f53\u524d\u9875\u6570 * @param pageSize \u6bcf\u4e00\u9875\u67e5\u8be2\u7684\u6570\u636e\u6761\u6570 * @return */ PageInfo < Publish > queryRecommendPublishList ( Long userId , Integer page , Integer pageSize ); 7.1.2\u3001\u7f16\u5199\u5b9e\u73b0 \u00b6 //com.tanhua.dubbo.server.api.QuanZiApiImpl @Autowired private RedisTemplate < String , String > redisTemplate ; public PageInfo < Publish > queryRecommendPublishList ( Long userId , Integer page , Integer pageSize ) { PageInfo < Publish > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); // \u67e5\u8be2\u63a8\u8350\u7ed3\u679c\u6570\u636e String key = \"QUANZI_PUBLISH_RECOMMEND_\" + userId ; String data = this . redisTemplate . opsForValue (). get ( key ); if ( StrUtil . isEmpty ( data )) { return pageInfo ; } //\u67e5\u8be2\u5230\u7684pid\u8fdb\u884c\u5206\u9875\u5904\u7406 List < String > pids = StrUtil . split ( data , ',' ); //\u8ba1\u7b97\u5206\u9875 //[0, 10] int [] startEnd = PageUtil . transToStartEnd ( page - 1 , pageSize ); int startIndex = startEnd [ 0 ] ; //\u5f00\u59cb int endIndex = Math . min ( startEnd [ 1 ] , pids . size ()); //\u7ed3\u675f List < Long > pidLongList = new ArrayList <> (); for ( int i = startIndex ; i < endIndex ; i ++ ) { pidLongList . add ( Long . valueOf ( pids . get ( i ))); } if ( CollUtil . isEmpty ( pidLongList )) { //\u6ca1\u6709\u67e5\u8be2\u5230\u6570\u636e return pageInfo ; } //\u6839\u636epid\u67e5\u8be2publish Query query = Query . query ( Criteria . where ( \"pid\" ). in ( pidLongList )) . with ( Sort . by ( Sort . Order . desc ( \"created\" ))); List < Publish > publishList = this . mongoTemplate . find ( query , Publish . class ); if ( CollUtil . isEmpty ( publishList )) { //\u6ca1\u6709\u67e5\u8be2\u5230\u6570\u636e return pageInfo ; } pageInfo . setRecords ( publishList ); return pageInfo ; } 7.2\u3001APP\u670d\u52a1 \u00b6 \u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/677 \u901a\u8fc7\u63a5\u53e3\u7684\u5b9a\u4e49\u53ef\u4ee5\u770b\u51fa\uff0c\u5176\u54cd\u5e94\u7684\u6570\u636e\u7ed3\u6784\u4e0e\u597d\u53cb\u52a8\u6001\u7ed3\u6784\u4e00\u6837\uff0c\u6240\u4ee5\u53ef\u4ee5\u590d\u7528QuanZiVo\u5bf9\u8c61\u3002 7.2.1\u3001QuanZiController \u00b6 //com.tanhua.server.controller.QuanZiController /** * \u67e5\u8be2\u63a8\u8350\u52a8\u6001 * * @param page * @param pageSize * @return */ @GetMapping ( \"recommend\" ) public PageResult queryRecommendPublishList ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize ) { return this . quanZiService . queryRecommendPublishList ( page , pageSize ); } 7.2.2\u3001QuanZiService \u00b6 \u5728\u5b9e\u73b0\u4e2d\uff0c\u5c06\u67e5\u8be2\u597d\u53cb\u52a8\u6001\u7684\u65b9\u6cd5\u4e2d\u516c\u5171\u7684\u5185\u5bb9\uff0c\u8fdb\u884c\u62bd\u53d6\uff0c\u5177\u4f53\u5982\u4e0b\uff1a //com.tanhua.server.service.QuanZiService public PageResult queryRecommendPublishList ( Integer page , Integer pageSize ) { //\u5206\u6790\uff1a\u901a\u8fc7dubbo\u4e2d\u7684\u670d\u52a1\u67e5\u8be2\u7cfb\u7edf\u63a8\u8350\u52a8\u6001 //\u901a\u8fc7mysql\u67e5\u8be2\u7528\u6237\u7684\u4fe1\u606f\uff0c\u56de\u5199\u5230\u7ed3\u679c\u5bf9\u8c61\u4e2d\uff08QuanZiVo\uff09 PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); //\u76f4\u63a5\u4eceThreadLocal\u4e2d\u83b7\u53d6\u5bf9\u8c61 User user = UserThreadLocal . get (); //\u901a\u8fc7dubbo\u67e5\u8be2\u6570\u636e PageInfo < Publish > pageInfo = this . quanZiApi . queryRecommendPublishList ( user . getId (), page , pageSize ); List < Publish > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )) { return pageResult ; } pageResult . setItems ( this . fillQuanZiVo ( records )); return pageResult ; } /** * \u586b\u5145\u7528\u6237\u4fe1\u606f * * @param userInfo * @param quanZiVo */ private void fillUserInfoToQuanZiVo ( UserInfo userInfo , QuanZiVo quanZiVo ){ BeanUtil . copyProperties ( userInfo , quanZiVo , \"id\" ); quanZiVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); quanZiVo . setTags ( StringUtils . split ( userInfo . getTags (), ',' )); quanZiVo . setCommentCount ( 0 ); //TODO \u8bc4\u8bba\u6570 quanZiVo . setDistance ( \"1.2\u516c\u91cc\" ); //TODO \u8ddd\u79bb quanZiVo . setHasLiked ( 0 ); //TODO \u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLikeCount ( 0 ); //TODO \u70b9\u8d5e\u6570 quanZiVo . setHasLoved ( 0 ); //TODO \u662f\u5426\u559c\u6b22\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLoveCount ( 0 ); //TODO \u559c\u6b22\u6570 } /** * \u6839\u636e\u67e5\u8be2\u5230\u7684publish\u96c6\u5408\u586b\u5145QuanZiVo\u5bf9\u8c61 * * @param records * @return */ private List < QuanZiVo > fillQuanZiVo ( List < Publish > records ){ List < QuanZiVo > quanZiVoList = new ArrayList <> (); records . forEach ( publish -> { QuanZiVo quanZiVo = new QuanZiVo (); quanZiVo . setId ( publish . getId (). toHexString ()); quanZiVo . setTextContent ( publish . getText ()); quanZiVo . setImageContent ( publish . getMedias (). toArray ( new String [] {})); quanZiVo . setUserId ( publish . getUserId ()); quanZiVo . setCreateDate ( RelativeDateFormat . format ( new Date ( publish . getCreated ()))); quanZiVoList . add ( quanZiVo ); }); //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIds = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); for ( QuanZiVo quanZiVo : quanZiVoList ) { //\u627e\u5230\u5bf9\u5e94\u7684\u7528\u6237\u4fe1\u606f for ( UserInfo userInfo : userInfoList ) { if ( quanZiVo . getUserId (). longValue () == userInfo . getUserId (). longValue ()){ this . fillUserInfoToQuanZiVo ( userInfo , quanZiVo ); break ; } } } return quanZiVoList ; } 7.3\u3001\u6d4b\u8bd5 \u00b6","title":"day04"},{"location":"tantan/day04/#_1","text":"\u62bd\u53d6common\u5de5\u7a0b \u5708\u5b50\u529f\u80fd\u8bf4\u660e \u5708\u5b50\u6280\u672f\u5b9e\u73b0 \u5708\u5b50\u6280\u672f\u65b9\u6848 \u5708\u5b50\u5b9e\u73b0\u53d1\u5e03\u52a8\u6001 \u5708\u5b50\u5b9e\u73b0\u597d\u53cb\u52a8\u6001 \u5708\u5b50\u5b9e\u73b0\u63a8\u8350\u52a8\u6001","title":"\u8bfe\u7a0b\u8bf4\u660e"},{"location":"tantan/day04/#1common","text":"\u5728\u9879\u76ee\u4e2d\u4e00\u822c\u9700\u8981\u5c06\u516c\u7528\u7684\u5bf9\u8c61\u8fdb\u884c\u62bd\u53d6\u653e\u5230common\u5de5\u7a0b\u4e2d\uff0c\u5176\u4ed6\u7684\u5de5\u7a0b\u4f9d\u8d56\u6b64\u5de5\u7a0b\u5373\u53ef\u3002\u4e0b\u9762\u6211\u4eec\u5c06sso\u4ee5\u53caserver\u5de5\u7a0b\u4e2d\u7684\u516c\u7528\u7684\u5bf9\u8c61\u8fdb\u884c\u62bd\u53d6\u3002","title":"1\u3001\u62bd\u53d6common\u5de5\u7a0b"},{"location":"tantan/day04/#11my-tanhua-common","text":"<?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <parent> <artifactId> my-tanhua </artifactId> <groupId> cn.itcast.tanhua </groupId> <version> 1.0-SNAPSHOT </version> </parent> <modelVersion> 4.0.0 </modelVersion> <artifactId> my-tanhua-common </artifactId> <dependencies> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> </dependency> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus-boot-starter </artifactId> </dependency> <dependency> <groupId> com.fasterxml.jackson.core </groupId> <artifactId> jackson-databind </artifactId> </dependency> </dependencies> </project>","title":"1.1\u3001\u521b\u5efamy-tanhua-common\u5de5\u7a0b"},{"location":"tantan/day04/#12","text":"\u5c06SexEnum\u679a\u4e3e\u79fb\u52a8\u81f3common\u5de5\u7a0b\uff0c\u5e76\u4e14\u540e\u7eed\u521b\u5efa\u7684\u679a\u4e3e\u4e5f\u8981\u653e\u5230\u6b21\u5de5\u7a0b\u4e2d\uff0c\u4ee5\u8fbe\u5230\u516c\u7528\u7684\u76ee\u7684\u3002 package com.tanhua.common.enums ; import com.baomidou.mybatisplus.core.enums.IEnum ; public enum SexEnum implements IEnum < Integer > { MAN ( 1 , \"\u7537\" ), WOMAN ( 2 , \"\u5973\" ), UNKNOWN ( 3 , \"\u672a\u77e5\" ); private int value ; private String desc ; SexEnum ( int value , String desc ) { this . value = value ; this . desc = desc ; } @Override public Integer getValue () { return this . value ; } @Override public String toString () { return this . desc ; } } \u9700\u8981\u4fee\u6539server\u4e0esso\u5de5\u7a0b\u4e2d\u7684application.properties\u914d\u7f6e\uff1a # \u679a\u4e3e\u5305\u626b\u63cf mybatis-plus.type-enums-package = com.tanhua.common.enums \u5c06server\u4e0esso\u5de5\u7a0b\u4e2d\u7684SexEnum\u5bf9\u8c61\u5220\u9664\u4ee5\u53ca\u5c06\u76f8\u5173\u7684\u7c7b\u5f15\u7528\u8fdb\u884c\u4fee\u6539\u3002","title":"1.2\u3001\u901a\u7528\u679a\u4e3e"},{"location":"tantan/day04/#13mapper","text":"\u9700\u8981\u5c06UserInfoMapper\u4ee5\u53caUserMapper\u653e\u7f6e\u5230common\u5de5\u7a0b\u7684com.tanhua.common.mapper\u5305\u4e0b\u3002 package com.tanhua.common.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.common.pojo.User ; public interface UserMapper extends BaseMapper < User > { } package com.tanhua.common.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.common.pojo.UserInfo ; public interface UserInfoMapper extends BaseMapper < UserInfo > { } \u8bf4\u660e\uff1a\u62bd\u53d6\u5b8c\u6210\u540e\uff0c\u9700\u8981\u5c06\u539f\u5de5\u7a0b\u7684\u4ee3\u7801\u5220\u9664\u4ee5\u53ca\u4fee\u6539\u5176\u4ed6\u4ee3\u7801\u4e2d\u5f15\u5165\u7684\u4f9d\u8d56\u3002","title":"1.3\u3001\u62bd\u53d6mapper"},{"location":"tantan/day04/#14pojo","text":"\u5c06BasePojo\u3001User\u3001UserInfo\u79fb\u52a8\u81f3common\u5de5\u7a0b\uff1a","title":"1.4\u3001\u62bd\u53d6pojo"},{"location":"tantan/day04/#15utils","text":"\u5c06server\u5de5\u7a0b\u7684utils\u8fdb\u884c\u62bd\u53d6\u516c\u7528\uff0c\u540e\u7eed\u7684\u5de5\u5177\u7c7b\u4e5f\u653e\u7f6e\u5230common\u5de5\u7a0b\u4e2d\u3002 \u62bd\u53d6\u5b8c\u6210\u540e\u8fdb\u884c\u6d4b\u8bd5\uff0c\u786e\u4fdd\u53ef\u4ee5\u6b63\u5e38\u542f\u52a8\u4ee5\u53ca\u529f\u80fd\u90fd\u6b63\u5e38\u3002","title":"1.5\u3001\u62bd\u53d6utils"},{"location":"tantan/day04/#2","text":"","title":"2\u3001\u5708\u5b50\u529f\u80fd"},{"location":"tantan/day04/#21","text":"\u63a2\u82b1\u4ea4\u53cb\u9879\u76ee\u4e2d\u7684\u5708\u5b50\u529f\u80fd\uff0c\u7c7b\u4f3c\u5fae\u4fe1\u7684\u670b\u53cb\u5708\uff0c\u57fa\u672c\u7684\u529f\u80fd\u4e3a\uff1a\u53d1\u5e03\u52a8\u6001\u3001\u6d4f\u89c8\u597d\u53cb\u52a8\u6001\u3001\u6d4f\u89c8\u63a8\u8350\u52a8\u6001\u3001\u70b9\u8d5e\u3001\u8bc4\u8bba\u3001\u559c\u6b22\u7b49\u529f\u80fd\u3002 \u53d1\u5e03\uff1a","title":"2.1\u3001\u529f\u80fd\u8bf4\u660e"},{"location":"tantan/day04/#22","text":"\u5bf9\u4e8e\u5708\u5b50\u529f\u80fd\u7684\u5b9e\u73b0\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u5b83\u7684\u529f\u80fd\u7279\u70b9\u505a\u5206\u6790\uff1a \u6570\u636e\u91cf\u4f1a\u968f\u7740\u7528\u6237\u6570\u589e\u5927\u800c\u589e\u5927 \u8bfb\u591a\u5199\u5c11\uff0c\u4e00\u822c\u800c\u8a00\uff0c\u6d4f\u89c8\u670b\u53cb\u5708\u52a8\u6001\u4f1a\u591a\u4e00\u4e9b\uff0c\u53d1\u52a8\u6001\u76f8\u5bf9\u5c31\u4f1a\u5c11\u4e00\u4e9b \u975e\u597d\u53cb\u770b\u4e0d\u5230\u5176\u52a8\u6001\u5185\u5bb9 \u2026\u2026 \u9488\u5bf9\u4ee5\u4e0a\u7279\u70b9\uff0c\u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\uff1a \u5bf9\u4e8e\u6570\u636e\u91cf\u5927\u800c\u8a00\uff0c\u663e\u7136\u4e0d\u80fd\u591f\u4f7f\u7528\u5173\u7cfb\u578b\u6570\u636e\u5e93\u8fdb\u884c\u5b58\u50a8\uff0c\u6211\u4eec\u9700\u8981\u901a\u8fc7MongoDB\u8fdb\u884c\u5b58\u50a8 \u5bf9\u4e8e\u8bfb\u591a\u5199\u5c11\u7684\u5e94\u7528\uff0c\u5c3d\u53ef\u80fd\u7684\u51cf\u5c11\u8bfb\u53d6\u6570\u636e\u7684\u6210\u672c \u6bd4\u5982\u8bf4\uff0c\u4e00\u6761SQL\u8bed\u53e5\uff0c\u5355\u5f20\u8868\u67e5\u8be2\u4e00\u5b9a\u6bd4\u591a\u5f20\u8868\u67e5\u8be2\u8981\u5feb \u6761\u4ef6\u8d8a\u591a\u7684\u67e5\u8be2\u901f\u5ea6\u5c06\u8d8a\u6162\uff0c\u5c3d\u53ef\u80fd\u7684\u51cf\u5c11\u6761\u4ef6\u4ee5\u63d0\u5347\u67e5\u8be2\u901f\u5ea6 \u6240\u4ee5\u5bf9\u4e8e\u5b58\u50a8\u800c\u8a00\uff0c\u4e3b\u8981\u662f\u6838\u5fc3\u76844\u5f20\u8868\uff1a \u53d1\u5e03\u8868\uff1a\u8bb0\u5f55\u4e86\u6240\u6709\u7528\u6237\u7684\u53d1\u5e03\u7684\u4e1c\u897f\u4fe1\u606f\uff0c\u5982\u56fe\u7247\u3001\u89c6\u9891\u7b49\u3002 \u76f8\u518c\uff1a\u76f8\u518c\u662f\u6bcf\u4e2a\u7528\u6237\u72ec\u7acb\u7684\uff0c\u8bb0\u5f55\u4e86\u8be5\u7528\u6237\u6240\u53d1\u5e03\u7684\u6240\u6709\u5185\u5bb9\u3002 \u8bc4\u8bba\uff1a\u9488\u5bf9\u67d0\u4e2a\u5177\u4f53\u53d1\u5e03\u7684\u670b\u53cb\u8bc4\u8bba\u548c\u70b9\u8d5e\u64cd\u4f5c\u3002 \u65f6\u95f4\u7ebf\uff1a\u6240\u8c13\u201c\u5237\u670b\u53cb\u5708\u201d\uff0c\u5c31\u662f\u5237\u65f6\u95f4\u7ebf\uff0c\u5c31\u662f\u4e00\u4e2a\u7528\u6237\u6240\u6709\u7684\u670b\u53cb\u7684\u53d1\u5e03\u5185\u5bb9\u3002 \u6d41\u7a0b\uff1a \u6d41\u7a0b\u8bf4\u660e\uff1a \u7528\u6237\u53d1\u5e03\u52a8\u6001\uff0c\u52a8\u6001\u4e2d\u4e00\u822c\u5305\u542b\u4e86\u56fe\u7247\u548c\u6587\u5b57\uff0c\u56fe\u7247\u4e0a\u4f20\u5230\u963f\u91cc\u4e91\uff0c\u4e0a\u4f20\u6210\u529f\u540e\u62ff\u5230\u56fe\u7247\u5730\u5740\uff0c\u5c06\u6587\u5b57\u548c\u56fe\u7247\u5730\u5740\u8fdb\u884c\u6301\u4e45\u5316\u5b58\u50a8 \u9996\u5148\uff0c\u9700\u8981\u5c06\u52a8\u6001\u6570\u636e\u5199\u5165\u5230\u53d1\u5e03\u8868\u4e2d\uff0c\u5176\u6b21\uff0c\u518d\u5199\u5165\u5230\u81ea\u5df1\u7684\u76f8\u518c\u8868\u4e2d\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u76f8\u518c\u8868\u4e2d\u53ea\u5305\u542b\u4e86\u53d1\u5e03id\uff0c\u4e0d\u4f1a\u5197\u4f59\u5b58\u50a8\u53d1\u5e03\u6570\u636e \u6700\u540e\uff0c\u9700\u8981\u5c06\u53d1\u5e03\u6570\u636e\u5f02\u6b65\u7684\u5199\u5165\u5230\u597d\u53cb\u7684\u65f6\u95f4\u7ebf\u8868\u4e2d\uff0c\u4e4b\u6240\u4ee5\u8003\u8651\u5f02\u6b65\u64cd\u4f5c\uff0c\u662f\u56e0\u4e3a\u5e0c\u671b\u53d1\u5e03\u80fd\u591f\u5c3d\u5feb\u7ed9\u7528\u6237\u53cd\u9988\uff0c\u53d1\u5e03\u6210\u529f \u597d\u53cb\u5237\u670b\u53cb\u5708\u65f6\uff0c\u5b9e\u9645\u4e0a\u53ea\u9700\u8981\u67e5\u8be2\u81ea\u5df1\u7684\u65f6\u95f4\u7ebf\u8868\u5373\u53ef\uff0c\u8fd9\u6837\u6700\u5927\u9650\u5ea6\u7684\u63d0\u5347\u4e86\u67e5\u8be2\u901f\u5ea6\uff0c\u518d\u914d\u5408redis\u7684\u7f13\u5b58\uff0c\u90a3\u901f\u5ea6\u5c06\u662f\u98de\u5feb\u7684 \u7528\u6237\u5728\u5bf9\u52a8\u6001\u5185\u5bb9\u8fdb\u884c\u70b9\u8d5e\u3001\u559c\u6b22\u3001\u8bc4\u8bba\u64cd\u4f5c\u65f6\uff0c\u53ea\u9700\u8981\u5199\u5165\u5230\u8bc4\u8bba\u8868\u5373\u53ef\uff0c\u8be5\u8868\u4e2d\u4e5f\u662f\u53ea\u4f1a\u8bb0\u5f55\u53d1\u5e03id\uff0c\u5e76\u4e0d\u4f1a\u5197\u4f59\u5b58\u50a8\u53d1\u5e03\u6570\u636e","title":"2.2\u3001\u5b9e\u73b0\u65b9\u6848\u5206\u6790"},{"location":"tantan/day04/#23","text":"\u53d1\u5e03\u8868\uff1a #\u8868\u540d\uff1aqua n zi_publish { \"_id\" : \"5fae53d17e52992e78a3db61\" , #\u4e3b\u952eid \"pid\" : 1001 , #\u53d1\u5e03id\uff08Lo n g\u7c7b\u578b\uff09 \"userId\" : 1 , #\u7528\u6237id \"text\" : \"\u4eca\u5929\u5fc3\u60c5\u5f88\u597d\" , #\u6587\u672c\u5185\u5bb9 \"medias\" : \"http://xxxx/x/y/z.jpg\" , #\u5a92\u4f53\u6570\u636e\uff0c\u56fe\u7247\u6216\u5c0f\u89c6\u9891 url \"seeType\" : 1 , #\u8c01\u53ef\u4ee5\u770b\uff0c 1- \u516c\u5f00\uff0c 2- \u79c1\u5bc6\uff0c 3- \u90e8\u5206\u53ef\u89c1\uff0c 4- \u4e0d\u7ed9\u8c01\u770b \"seeList\" :[ 1 , 2 , 3 ], #\u90e8\u5206\u53ef\u89c1\u7684\u5217\u8868 \"notSeeList\" :[ 4 , 5 , 6 ], #\u4e0d\u7ed9\u8c01\u770b\u7684\u5217\u8868 \"longitude\" : 108.840974298098 , #\u7ecf\u5ea6 \"latitude\" : 34.2789316522934 , #\u7eac\u5ea6 \"locationName\" : \"\u4e0a\u6d77\u5e02\u6d66\u4e1c\u533a\" , #\u4f4d\u7f6e\u540d\u79f0 \"created\" , 1568012791171 #\u53d1\u5e03\u65f6\u95f4 } \u76f8\u518c\u8868\uff1a #\u8868\u540d\uff1aqua n zi_album_ { userId } { \"_id\" : \"5fae539d7e52992e78a3b684\" , #\u4e3b\u952eid \"publishId\" : \"5fae53d17e52992e78a3db61\" , #\u53d1\u5e03id \"created\" : 1568012791171 #\u53d1\u5e03\u65f6\u95f4 } \u65f6\u95f4\u7ebf\u8868\uff1a #\u8868\u540d\uff1aqua n zi_ t ime_li ne _ { userId } { \"_id\" : \"5fae539b7e52992e78a3b4ae\" , #\u4e3b\u952eid , \"userId\" : 2 , #\u597d\u53cbid \"publishId\" : \"5fae53d17e52992e78a3db61\" , #\u53d1\u5e03id \"date\" : 1568012791171 #\u53d1\u5e03\u65f6\u95f4 } \u8bc4\u8bba\u8868\uff1a #\u8868\u540d\uff1aqua n zi_comme nt { \"_id\" : \"5fae539d7e52992e78a3b648\" , #\u4e3b\u952eid \"publishId\" : \"5fae53d17e52992e78a3db61\" , #\u53d1\u5e03id \"commentType\" : 1 , #\u8bc4\u8bba\u7c7b\u578b\uff0c 1- \u70b9\u8d5e\uff0c 2- \u8bc4\u8bba\uff0c 3- \u559c\u6b22 \"content\" : \"\u7ed9\u529b\uff01\" , #\u8bc4\u8bba\u5185\u5bb9 \"userId\" : 2 , #\u8bc4\u8bba\u4eba \"publishUserId\" : 9 , #\u53d1\u5e03\u52a8\u6001\u7684\u4eba\u7684id \"isParent\" : false , #\u662f\u5426\u4e3a\u7236\u8282\u70b9\uff0c\u9ed8\u8ba4\u662f\u5426 \"parentId\" : 1001 , #\u7236\u8282\u70b9id \"created\" : 1568012791171 }","title":"2.3\u3001\u8868\u7ed3\u6784\u8bbe\u8ba1"},{"location":"tantan/day04/#3","text":"\u7531\u4e8e\u5708\u5b50\u4e2d\u4f1a\u6d89\u53ca\u7684\u597d\u53cb\u5173\u7cfb\u6570\u636e\uff0c\u867d\u7136\u73b0\u5728\u4e3b\u7ebf\u662f\u5f00\u53d1\u5708\u5b50\u529f\u80fd\uff0c\u4f46\u662f\u4e5f\u9700\u8981\u5bf9\u4e8e\u597d\u53cb\u5173\u7cfb\u6709\u6240\u4e86\u89e3\uff0c\u5728\u6211\u4eec\u63d0\u4f9b\u7684Mongodb\u6570\u636e\u5e93\u4e2d\u6709\u4e00\u4e9bmock\u6570\u636e\u3002 \u597d\u53cb\u5173\u7cfb\u7ed3\u6784\uff1a package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.mongodb.core.mapping.Document ; @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"tanhua_users\" ) public class Users implements java . io . Serializable { private static final long serialVersionUID = 6003135946820874230L ; private ObjectId id ; private Long userId ; //\u7528\u6237id private Long friendId ; //\u597d\u53cbid private Long date ; //\u65f6\u95f4 } \u5728mock\u6570\u636e\u4e2d\uff0c\u4e3a\u6bcf\u4e2a\u7528\u6237\u6784\u9020\u4e8610\u4e2a\u597d\u53cb\u6570\u636e\uff1a","title":"3\u3001\u597d\u53cb\u5173\u7cfb\u6570\u636e"},{"location":"tantan/day04/#4","text":"\u67e5\u8be2\u597d\u53cb\u52a8\u6001\u4e0e\u67e5\u8be2\u63a8\u8350\u52a8\u6001\u663e\u793a\u7684\u7ed3\u6784\u662f\u4e00\u6837\u7684\uff0c\u53ea\u662f\u5176\u67e5\u8be2\u6570\u636e\u6e90\u4e0d\u540c\uff1a","title":"4\u3001\u67e5\u8be2\u597d\u53cb\u52a8\u6001"},{"location":"tantan/day04/#41","text":"\u5728my-tanhua-dubbo-interface\u4e2d\u7f16\u5199\uff1a package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.annotation.Id ; import org.springframework.data.mongodb.core.mapping.Document ; import java.util.Date ; import java.util.List ; /** * \u53d1\u5e03\u8868\uff0c\u52a8\u6001\u5185\u5bb9 */ @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"quanzi_publish\" ) public class Publish implements java . io . Serializable { private static final long serialVersionUID = 8732308321082804771L ; @Id private ObjectId id ; //\u4e3b\u952eid private Long pid ; //\u53d1\u5e03id private Long userId ; //\u53d1\u5e03\u7528\u6237id private String text ; //\u6587\u5b57 private List < String > medias ; //\u5a92\u4f53\u6570\u636e\uff0c\u56fe\u7247\u6216\u5c0f\u89c6\u9891 url private Integer seeType ; // \u8c01\u53ef\u4ee5\u770b\uff0c1-\u516c\u5f00\uff0c2-\u79c1\u5bc6\uff0c3-\u90e8\u5206\u53ef\u89c1\uff0c4-\u4e0d\u7ed9\u8c01\u770b private List < Long > seeList ; //\u90e8\u5206\u53ef\u89c1\u7684\u5217\u8868 private List < Long > notSeeList ; //\u4e0d\u7ed9\u8c01\u770b\u7684\u5217\u8868 private String longitude ; //\u7ecf\u5ea6 private String latitude ; //\u7eac\u5ea6 private String locationName ; //\u4f4d\u7f6e\u540d\u79f0 private Long created ; //\u53d1\u5e03\u65f6\u95f4 } package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.annotation.Id ; import org.springframework.data.mongodb.core.mapping.Document ; import java.util.Date ; /** * \u76f8\u518c\u8868\uff0c\u7528\u4e8e\u5b58\u50a8\u81ea\u5df1\u53d1\u5e03\u7684\u6570\u636e\uff0c\u6bcf\u4e00\u4e2a\u7528\u6237\u4e00\u5f20\u8868\u8fdb\u884c\u5b58\u50a8 */ @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"quanzi_album_{userId}\" ) public class Album implements java . io . Serializable { private static final long serialVersionUID = 432183095092216817L ; @Id private ObjectId id ; //\u4e3b\u952eid private ObjectId publishId ; //\u53d1\u5e03id private Long created ; //\u53d1\u5e03\u65f6\u95f4 } package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.annotation.Id ; import org.springframework.data.mongodb.core.mapping.Document ; import java.util.Date ; /** * \u65f6\u95f4\u7ebf\u8868\uff0c\u7528\u4e8e\u5b58\u50a8\u53d1\u5e03\u7684\u6570\u636e\uff0c\u6bcf\u4e00\u4e2a\u7528\u6237\u4e00\u5f20\u8868\u8fdb\u884c\u5b58\u50a8 */ @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"quanzi_time_line_{userId}\" ) public class TimeLine implements java . io . Serializable { private static final long serialVersionUID = 9096178416317502524L ; @Id private ObjectId id ; private Long userId ; // \u597d\u53cbid private ObjectId publishId ; //\u53d1\u5e03id private Long date ; //\u53d1\u5e03\u7684\u65f6\u95f4 } package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.annotation.Id ; import org.springframework.data.mongodb.core.mapping.Document ; import java.util.Date ; /** * \u8bc4\u8bba\u8868 */ @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"quanzi_comment\" ) public class Comment implements java . io . Serializable { private static final long serialVersionUID = - 291788258125767614L ; @Id private ObjectId id ; private ObjectId publishId ; //\u53d1\u5e03id private Integer commentType ; //\u8bc4\u8bba\u7c7b\u578b\uff0c1-\u70b9\u8d5e\uff0c2-\u8bc4\u8bba\uff0c3-\u559c\u6b22 private String content ; //\u8bc4\u8bba\u5185\u5bb9 private Long userId ; //\u8bc4\u8bba\u4eba private Long publishUserId ; //\u53d1\u5e03\u52a8\u6001\u7684\u7528\u6237id private Boolean isParent = false ; //\u662f\u5426\u4e3a\u7236\u8282\u70b9\uff0c\u9ed8\u8ba4\u662f\u5426 private ObjectId parentId ; // \u7236\u8282\u70b9id private Long created ; //\u53d1\u8868\u65f6\u95f4 }","title":"4.1\u3001\u57fa\u7840\u4ee3\u7801"},{"location":"tantan/day04/#42dubbo","text":"\u5708\u5b50\u7684\u5177\u4f53\u4e1a\u52a1\u903b\u8f91\u7684\u5b9e\u73b0\u9700\u8981\u5728dubbo\u4e2d\u5b8c\u6210\uff0c\u6240\u4ee5\u9700\u8981\u5f00\u53d1dubbo\u670d\u52a1\u3002","title":"4.2\u3001dubbo\u670d\u52a1"},{"location":"tantan/day04/#421","text":"\u5728my-tanhua-dubbo-interface\u5de5\u7a0b\u4e2d\uff1a package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.pojo.Publish ; import com.tanhua.dubbo.server.vo.PageInfo ; public interface QuanZiApi { /** * \u67e5\u8be2\u597d\u53cb\u52a8\u6001 * * @param userId \u7528\u6237id * @param page \u5f53\u524d\u9875\u6570 * @param pageSize \u6bcf\u4e00\u9875\u67e5\u8be2\u7684\u6570\u636e\u6761\u6570 * @return */ PageInfo < Publish > queryPublishList ( Long userId , Integer page , Integer pageSize ); }","title":"4.2.1\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day04/#422","text":"\u5728my-tanhua-dubbo-service\u4e2d\u5b8c\u6210\uff1a package com.tanhua.dubbo.server.api ; import cn.hutool.core.collection.CollUtil ; import com.alibaba.dubbo.config.annotation.Service ; import com.tanhua.dubbo.server.pojo.Publish ; import com.tanhua.dubbo.server.pojo.TimeLine ; import com.tanhua.dubbo.server.vo.PageInfo ; import org.bson.types.ObjectId ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.domain.PageRequest ; import org.springframework.data.domain.Pageable ; import org.springframework.data.domain.Sort ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; import java.util.ArrayList ; import java.util.List ; @Service ( version = \"1.0.0\" ) public class QuanZiApiImpl implements QuanZiApi { @Autowired private MongoTemplate mongoTemplate ; @Override public PageInfo < Publish > queryPublishList ( Long userId , Integer page , Integer pageSize ) { //\u5206\u6790\uff1a\u67e5\u8be2\u597d\u53cb\u7684\u52a8\u6001\uff0c\u5b9e\u9645\u4e0a\u67e5\u8be2\u65f6\u95f4\u7ebf\u8868 PageInfo < Publish > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); Pageable pageable = PageRequest . of ( page - 1 , pageSize , Sort . by ( Sort . Order . desc ( \"date\" ))); Query query = new Query (). with ( pageable ); List < TimeLine > timeLineList = this . mongoTemplate . find ( query , TimeLine . class , \"quanzi_time_line_\" + userId ); if ( CollUtil . isEmpty ( timeLineList )){ //\u6ca1\u6709\u67e5\u8be2\u5230\u6570\u636e return pageInfo ; } //\u83b7\u53d6\u65f6\u95f4\u7ebf\u5217\u8868\u4e2d\u7684\u53d1\u5e03id\u7684\u5217\u8868 List < Object > ids = CollUtil . getFieldValues ( timeLineList , \"publishId\" ); //\u6839\u636e\u52a8\u6001id\u67e5\u8be2\u52a8\u6001\u5217\u8868 Query queryPublish = Query . query ( Criteria . where ( \"id\" ). in ( ids )) . with ( Sort . by ( Sort . Order . desc ( \"created\" ))); List < Publish > publishList = this . mongoTemplate . find ( queryPublish , Publish . class ); pageInfo . setRecords ( publishList ); return pageInfo ; } } \u5f15\u5165Hutool\u5de5\u5177\u5305\uff0c\u5b98\u65b9\u6587\u6863\uff1ahttps://www.hutool.cn/docs/#/ <!-- \u5728my-tanhua\u5de5\u7a0b\u4e2d\u5b9a\u4e49\u4f9d\u8d56 --> <dependency> <groupId> cn.hutool </groupId> <artifactId> hutool-all </artifactId> <version> 5.5.2 </version> </dependency> <!-- \u5728my-tanhua-dubbo-service\u4e2d\u5f15\u5165\u4f7f\u7528 --> <dependency> <groupId> cn.hutool </groupId> <artifactId> hutool-all </artifactId> </dependency>","title":"4.2.2\u3001\u5b9e\u73b0\u63a5\u53e3"},{"location":"tantan/day04/#423","text":"package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.pojo.Publish ; import com.tanhua.dubbo.server.vo.PageInfo ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestQuanZiApi { @Autowired private QuanZiApi quanZiApi ; @Test public void testQueryPublishList (){ this . quanZiApi . queryPublishList ( 1L , 1 , 2 ) . getRecords (). forEach ( publish -> System . out . println ( publish )); System . out . println ( \"------------\" ); this . quanZiApi . queryPublishList ( 1L , 2 , 2 ) . getRecords (). forEach ( publish -> System . out . println ( publish )); System . out . println ( \"------------\" ); this . quanZiApi . queryPublishList ( 1L , 3 , 2 ) . getRecords (). forEach ( publish -> System . out . println ( publish )); } } \u6d4b\u8bd5\u7ed3\u679c\uff1a","title":"4.2.3\u3001\u6d4b\u8bd5\u7528\u4f8b"},{"location":"tantan/day04/#43app","text":"\u5f00\u53d1\u5b8c\u6210dubbo\u670d\u52a1\u540e\uff0c\u6211\u4eec\u5c06\u5f00\u53d1APP\u7aef\u7684\u63a5\u53e3\u670d\u52a1\uff0c\u4f9d\u7136\u662f\u9700\u8981\u6309\u7167mock\u63a5\u53e3\u7684\u4e2d\u7684\u63a5\u53e3\u5b9a\u4e49\u5b9e\u73b0\u3002 \u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/683","title":"4.3\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day04/#431quanzivo","text":"\u6839\u636e\u63a5\u53e3\u4e2d\u54cd\u5e94\u7684\u6570\u636e\u7ed3\u6784\u8fdb\u884c\u5b9a\u4e49vo\u5bf9\u8c61\uff1a(\u5728my-tanhua-server\u5de5\u7a0b\u4e2d) package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class QuanZiVo { private String id ; //\u52a8\u6001id private Long userId ; //\u7528\u6237id private String avatar ; //\u5934\u50cf private String nickname ; //\u6635\u79f0 private String gender ; //\u6027\u522b man woman private Integer age ; //\u5e74\u9f84 private String [] tags ; //\u6807\u7b7e private String textContent ; //\u6587\u5b57\u52a8\u6001 private String [] imageContent ; //\u56fe\u7247\u52a8\u6001 private String distance ; //\u8ddd\u79bb private String createDate ; //\u53d1\u5e03\u65f6\u95f4 \u5982: 10\u5206\u949f\u524d private Integer likeCount ; //\u70b9\u8d5e\u6570 private Integer commentCount ; //\u8bc4\u8bba\u6570 private Integer loveCount ; //\u559c\u6b22\u6570 private Integer hasLiked ; //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 private Integer hasLoved ; //\u662f\u5426\u559c\u6b22\uff081\u662f\uff0c0\u5426\uff09 }","title":"4.3.1\u3001QuanZiVo"},{"location":"tantan/day04/#432quanzicontroller","text":"\u6839\u636e\u670d\u52a1\u63a5\u53e3\u7f16\u5199QuanZiController\uff0c\u5176\u8bf7\u6c42\u65b9\u6cd5\u4e3aGET\u8bf7\u6c42\uff0c\u4f1a\u4f20\u9012page\u3001pageSize\u3001token\u7b49\u4fe1\u606f\u3002 \u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b\uff1a package com.tanhua.server.controller ; import com.tanhua.server.service.QuanZiService ; import com.tanhua.server.vo.PageResult ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.web.bind.annotation.* ; @RestController @RequestMapping ( \"movements\" ) public class QuanZiController { @Autowired private QuanZiService quanZiService ; /** * \u67e5\u8be2\u597d\u53cb\u52a8\u6001 * * @param page * @param pageSize * @return */ @GetMapping public PageResult queryPublishList ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize , @RequestHeader ( \"Authorization\" ) String token ) { return this . quanZiService . queryPublishList ( page , pageSize , token ); } }","title":"4.3.2\u3001QuanZiController"},{"location":"tantan/day04/#433quanziservice","text":"\u5728QuanZiService\u4e2d\u5c06\u5b9e\u73b0\u5177\u4f53\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u9700\u8981\u8c03\u7528quanzi\u7684dubbo\u670d\u52a1\u5b8c\u6210\u6570\u636e\u7684\u67e5\u8be2\uff0c\u5e76\u4e14\u8981\u5b8c\u6210\u7528\u6237\u767b\u5f55\u662f\u5426\u6709\u6548\u7684\u6821\u9a8c\uff0c\u6700\u540e\u6309\u7167\u670d\u52a1\u63a5\u53e3\u4e2d\u5b9a\u4e49\u7684\u7ed3\u6784\u8fdb\u884c\u5c01\u88c5\u6570\u636e\u3002 package com.tanhua.server.service ; import cn.hutool.core.bean.BeanUtil ; import cn.hutool.core.collection.CollUtil ; import cn.hutool.core.util.StrUtil ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.common.pojo.User ; import com.tanhua.common.pojo.UserInfo ; import com.tanhua.common.utils.RelativeDateFormat ; import com.tanhua.dubbo.server.api.QuanZiApi ; import com.tanhua.dubbo.server.pojo.Publish ; import com.tanhua.dubbo.server.vo.PageInfo ; import com.tanhua.server.vo.PageResult ; import com.tanhua.server.vo.QuanZiVo ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import java.util.ArrayList ; import java.util.Date ; import java.util.List ; @Service public class QuanZiService { @Reference ( version = \"1.0.0\" ) private QuanZiApi quanZiApi ; @Autowired private UserService userService ; @Autowired private UserInfoService userInfoService ; public PageResult queryPublishList ( Integer page , Integer pageSize , String token ) { //\u5206\u6790\uff1a\u901a\u8fc7dubbo\u4e2d\u7684\u670d\u52a1\u67e5\u8be2\u7528\u6237\u7684\u597d\u53cb\u52a8\u6001 //\u901a\u8fc7mysql\u67e5\u8be2\u7528\u6237\u7684\u4fe1\u606f\uff0c\u56de\u5199\u5230\u7ed3\u679c\u5bf9\u8c61\u4e2d\uff08QuanZiVo\uff09 PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); //\u6821\u9a8ctoken\u662f\u5426\u6709\u6548 User user = this . userService . queryUserByToken ( token ); if ( user == null ) { //token\u5df2\u7ecf\u5931\u6548 return pageResult ; } //\u901a\u8fc7dubbo\u67e5\u8be2\u6570\u636e PageInfo < Publish > pageInfo = this . quanZiApi . queryPublishList ( user . getId (), page , pageSize ); List < Publish > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )) { return pageResult ; } List < QuanZiVo > quanZiVoList = new ArrayList <> (); records . forEach ( publish -> { QuanZiVo quanZiVo = new QuanZiVo (); quanZiVo . setId ( publish . getId (). toHexString ()); quanZiVo . setTextContent ( publish . getText ()); quanZiVo . setImageContent ( publish . getMedias (). toArray ( new String [] {})); quanZiVo . setUserId ( publish . getUserId ()); quanZiVo . setCreateDate ( RelativeDateFormat . format ( new Date ( publish . getCreated ()))); quanZiVoList . add ( quanZiVo ); }); //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIds = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); for ( QuanZiVo quanZiVo : quanZiVoList ) { //\u627e\u5230\u5bf9\u5e94\u7684\u7528\u6237\u4fe1\u606f for ( UserInfo userInfo : userInfoList ) { if ( quanZiVo . getUserId (). longValue () == userInfo . getUserId (). longValue ()){ this . fillUserInfoToQuanZiVo ( userInfo , quanZiVo ); break ; } } } pageResult . setItems ( quanZiVoList ); return pageResult ; } /** * \u586b\u5145\u7528\u6237\u4fe1\u606f * * @param userInfo * @param quanZiVo */ private void fillUserInfoToQuanZiVo ( UserInfo userInfo , QuanZiVo quanZiVo ){ BeanUtil . copyProperties ( userInfo , quanZiVo , \"id\" ); quanZiVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); quanZiVo . setTags ( StringUtils . split ( userInfo . getTags (), ',' )); quanZiVo . setCommentCount ( 0 ); //TODO \u8bc4\u8bba\u6570 quanZiVo . setDistance ( \"1.2\u516c\u91cc\" ); //TODO \u8ddd\u79bb quanZiVo . setHasLiked ( 0 ); //TODO \u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLikeCount ( 0 ); //TODO \u70b9\u8d5e\u6570 quanZiVo . setHasLoved ( 0 ); //TODO \u662f\u5426\u559c\u6b22\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLoveCount ( 0 ); //TODO \u559c\u6b22\u6570 } } // com.tanhua.server.service.UserInfoService /** * \u6839\u636e\u7528\u6237id\u7684\u96c6\u5408\u67e5\u8be2\u7528\u6237\u5217\u8868 * * @param userIds * @return */ public List < UserInfo > queryUserInfoList ( Collection <?> userIds ) { QueryWrapper < UserInfo > queryWrapper = new QueryWrapper <> (); queryWrapper . in ( \"user_id\" , userIds ); return this . queryUserInfoList ( queryWrapper ); } \u5728com.tanhua.server.vo.QuanZiVo\u4e2d\u589e\u52a0\u5b57\u6bb5\u522b\u540d\uff0c\u65b9\u4fbf\u76f4\u63a5\u62f7\u8d1d\u5c5e\u6027\u6570\u636e\uff1a package com.tanhua.server.vo ; import cn.hutool.core.annotation.Alias ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class QuanZiVo { private String id ; //\u52a8\u6001id private Long userId ; //\u7528\u6237id @Alias ( \"logo\" ) //\u522b\u540d private String avatar ; //\u5934\u50cf @Alias ( \"nickName\" ) //\u522b\u540d private String nickname ; //\u6635\u79f0 private String gender ; //\u6027\u522b man woman private Integer age ; //\u5e74\u9f84 private String [] tags ; //\u6807\u7b7e private String textContent ; //\u6587\u5b57\u52a8\u6001 private String [] imageContent ; //\u56fe\u7247\u52a8\u6001 private String distance ; //\u8ddd\u79bb private String createDate ; //\u53d1\u5e03\u65f6\u95f4 \u5982: 10\u5206\u949f\u524d private Integer likeCount ; //\u70b9\u8d5e\u6570 private Integer commentCount ; //\u8bc4\u8bba\u6570 private Integer loveCount ; //\u559c\u6b22\u6570 private Integer hasLiked ; //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 private Integer hasLoved ; //\u662f\u5426\u559c\u6b22\uff081\u662f\uff0c0\u5426\uff09 }","title":"4.3.3\u3001QuanZiService"},{"location":"tantan/day04/#434","text":"","title":"4.3.4\u3001\u6d4b\u8bd5"},{"location":"tantan/day04/#5token","text":"\u5728\u4e4b\u524d\u7684\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u4f1a\u5728\u6bcf\u4e00\u4e2aService\u4e2d\u5bf9token\u505a\u5904\u7406\uff0c\u76f8\u540c\u7684\u903b\u8f91\u4e00\u5b9a\u662f\u8981\u8fdb\u884c\u7edf\u4e00\u5904\u7406\u7684\uff0c\u8be5\u5982\u4f55\u5904\u7406\u5462\uff1f \u7531\u4e8e\u7a0b\u5e8f\u662f\u8fd0\u884c\u5728web\u5bb9\u5668\u4e2d\uff0c\u6bcf\u4e00\u4e2aHTTP\u8bf7\u6c42\u90fd\u662f\u4e00\u4e2a\u72ec\u7acb\u7ebf\u7a0b\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5\u7406\u89e3\u6210\u6211\u4eec\u7f16\u5199\u7684\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u5728\u4e00\u4e2a\u591a\u7ebf\u7a0b\u7684\u73af\u5883\u4e2d\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528ThreadLocal\u5728HTTP\u8bf7\u6c42\u7684\u751f\u547d\u5468\u671f\u5185\u8fdb\u884c\u5b58\u503c\u3001\u53d6\u503c\u64cd\u4f5c\u3002 \u5982\u4e0b\u56fe\uff1a \u8bf4\u660e\uff1a \u7528\u6237\u7684\u6bcf\u4e00\u4e2a\u8bf7\u6c42\uff0c\u90fd\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u7ebf\u7a0b \u56fe\u4e2d\u7684TL\u5c31\u662fThreadLocal\uff0c\u4e00\u65e6\u5c06\u6570\u636e\u7ed1\u5b9a\u5230ThreadLocal\u4e2d\uff0c\u90a3\u4e48\u5728\u6574\u4e2a\u8bf7\u6c42\u7684\u751f\u547d\u5468\u671f\u5185\u90fd\u53ef\u4ee5\u968f\u65f6\u62ff\u5230ThreadLocal\u4e2d\u5f53\u524d\u7ebf\u7a0b\u7684\u6570\u636e\u3002 \u6839\u636e\u4e0a\u9762\u7684\u5206\u6790\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5728Controller\u8bf7\u6c42\u4e4b\u524d\u8fdb\u884c\u5bf9token\u505a\u6821\u9a8c\uff0c\u5982\u679ctoken\u6709\u6548\uff0c\u5219\u4f1a\u62ff\u5230User\u5bf9\u8c61\uff0c\u7136\u540e\u5c06\u8be5User\u5bf9\u8c61\u4fdd\u5b58\u5230ThreadLocal\u4e2d\u5373\u53ef\uff0c\u6700\u540e\u653e\u884c\u8bf7\u6c42\uff0c\u5728\u540e\u7eed\u7684\u5404\u4e2a\u73af\u8282\u4e2d\u90fd\u53ef\u4ee5\u83b7\u53d6\u5230\u8be5\u6570\u636e\u4e86\u3002 \u5982\u679ctoken\u65e0\u6548\uff0c\u7ed9\u5ba2\u6237\u7aef\u54cd\u5e94401\u72b6\u6001\u7801\uff0c\u62e6\u622a\u8bf7\u6c42\uff0c\u4e0d\u518d\u653e\u884c\u5230Controller\u4e2d\u3002 \u7531\u6b64\u53ef\u89c1\uff0c\u8fd9\u4e2a\u6821\u9a8c\u7684\u903b\u8f91\u662f\u6bd4\u8f83\u9002\u5408\u653e\u5728\u62e6\u622a\u5668\u4e2d\u5b8c\u6210\u7684\u3002","title":"5\u3001\u7edf\u4e00\u6821\u9a8ctoken"},{"location":"tantan/day04/#51userthreadlocal","text":"\u5728my-tanhua-common\u5de5\u7a0b\u4e2d\uff0c\u7f16\u5199UserThreadLocal\u3002 package com.tanhua.common.utils ; import com.tanhua.common.pojo.User ; public class UserThreadLocal { private static final ThreadLocal < User > LOCAL = new ThreadLocal <> (); private UserThreadLocal (){ } /** * \u5c06\u5bf9\u8c61\u653e\u5165\u5230ThreadLocal * * @param user */ public static void set ( User user ){ LOCAL . set ( user ); } /** * \u8fd4\u56de\u5f53\u524d\u7ebf\u7a0b\u4e2d\u7684User\u5bf9\u8c61 * * @return */ public static User get (){ return LOCAL . get (); } /** * \u5220\u9664\u5f53\u524d\u7ebf\u7a0b\u4e2d\u7684User\u5bf9\u8c61 */ public static void remove (){ LOCAL . remove (); } }","title":"5.1\u3001\u7f16\u5199UserThreadLocal"},{"location":"tantan/day04/#52tokeninterceptor","text":"package com.tanhua.server.interceptor ; import cn.hutool.core.util.StrUtil ; import com.tanhua.common.pojo.User ; import com.tanhua.common.utils.NoAuthorization ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.server.service.UserService ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Component ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.method.HandlerMethod ; import org.springframework.web.servlet.HandlerInterceptor ; import javax.servlet.http.HttpServletRequest ; import javax.servlet.http.HttpServletResponse ; @Component public class UserTokenInterceptor implements HandlerInterceptor { @Autowired private UserService userService ; @Override public boolean preHandle ( HttpServletRequest request , HttpServletResponse response , Object handler ) throws Exception { //\u6821\u9a8chandler\u662f\u5426\u662fHandlerMethod if ( ! ( handler instanceof HandlerMethod )) { return true ; } //\u5224\u65ad\u662f\u5426\u5305\u542b@NoAuthorization\u6ce8\u89e3\uff0c\u5982\u679c\u5305\u542b\uff0c\u76f4\u63a5\u653e\u884c if ((( HandlerMethod ) handler ). hasMethodAnnotation ( NoAuthorization . class )) { return true ; } //\u4ece\u8bf7\u6c42\u5934\u4e2d\u83b7\u53d6token String token = request . getHeader ( \"Authorization\" ); if ( StrUtil . isNotEmpty ( token )){ User user = this . userService . queryUserByToken ( token ); if ( user != null ){ //token\u6709\u6548 //\u5c06User\u5bf9\u8c61\u653e\u5165\u5230ThreadLocal\u4e2d UserThreadLocal . set ( user ); return true ; } } //token\u65e0\u6548\uff0c\u54cd\u5e94\u72b6\u6001\u4e3a401 response . setStatus ( 401 ); //\u65e0\u6743\u9650 return false ; } @Override public void afterCompletion ( HttpServletRequest request , HttpServletResponse response , Object handler , Exception ex ) throws Exception { //\u4eceThreadLocal\u4e2d\u79fb\u9664User\u5bf9\u8c61 UserThreadLocal . remove (); } }","title":"5.2\u3001\u7f16\u5199TokenInterceptor"},{"location":"tantan/day04/#53noauthorization","text":"package com.tanhua.common.utils ; import java.lang.annotation.* ; @Target ( ElementType . METHOD ) @Retention ( RetentionPolicy . RUNTIME ) @Documented //\u6807\u8bb0\u6ce8\u89e3 public @interface NoAuthorization { }","title":"5.3\u3001\u7f16\u5199\u6ce8\u89e3NoAuthorization"},{"location":"tantan/day04/#54","text":"package com.tanhua.server.config ; import com.tanhua.server.interceptor.RedisCacheInterceptor ; import com.tanhua.server.interceptor.UserTokenInterceptor ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.context.annotation.Configuration ; import org.springframework.web.servlet.config.annotation.InterceptorRegistry ; import org.springframework.web.servlet.config.annotation.WebMvcConfigurer ; @Configuration public class WebConfig implements WebMvcConfigurer { @Autowired private RedisCacheInterceptor redisCacheInterceptor ; @Autowired private UserTokenInterceptor userTokenInterceptor ; @Override public void addInterceptors ( InterceptorRegistry registry ) { //\u8003\u8651\u62e6\u622a\u5668\u7684\u987a\u5e8f registry . addInterceptor ( this . userTokenInterceptor ). addPathPatterns ( \"/**\" ); registry . addInterceptor ( this . redisCacheInterceptor ). addPathPatterns ( \"/**\" ); } }","title":"5.4\u3001\u6ce8\u518c\u62e6\u622a\u5668"},{"location":"tantan/day04/#55threadlocal","text":"\u5728\u6240\u6709\u7684Service\u4e2d\uff0c\u5982\u679c\u9700\u8981\u83b7\u53d6User\u5bf9\u8c61\u7684\uff0c\u76f4\u63a5\u4eceUserThreadLocal\u83b7\u53d6\u5373\u53ef\uff0c\u540c\u65f6\u5728Controller\u4e2d\u4e5f\u65e0\u9700\u8fdb\u884c\u83b7\u53d6token\u64cd\u4f5c\u3002 \u4f8b\u5982\uff1a //com.tanhua.server.service.QuanZiService public PageResult queryPublishList ( Integer page , Integer pageSize ) { PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); //\u83b7\u53d6User\u5bf9\u8c61\uff0c\u65e0\u9700\u5bf9User\u5bf9\u8c61\u6821\u9a8c\uff0c\u5176\u4e00\u5b9a\u4e0d\u4e3anull User user = UserThreadLocal . get (); PageInfo < Publish > pageInfo = this . quanZiApi . queryPublishList ( user . getId (), page , pageSize ); //\u3002\u3002\u3002\u3002\u4ee3\u7801\u7565\u3002\u3002\u3002\u3002\u3002 return pageResult ; } \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728APP\u4e2d\uff0c\u5982\u679c\u8bf7\u6c42\u54cd\u5e94401\uff0c\u4f1a\u8df3\u8f6c\u5230\u767b\u5f55\u9875\u9762\u3002","title":"5.5\u3001\u4f7f\u7528ThreadLocal"},{"location":"tantan/day04/#6","text":"\u7528\u6237\u53ef\u4ee5\u5728\u5708\u5b50\u4e2d\u53d1\u5e03\u52a8\u6001\uff0c\u52a8\u6001\u5185\u5bb9\u4e2d\u53ef\u4ee5\u6709\u6587\u5b57\u548c\u56fe\u7247\u3002\u5982\u4e0b\u56fe\uff1a","title":"6\u3001\u53d1\u5e03\u52a8\u6001"},{"location":"tantan/day04/#61dubbo","text":"","title":"6.1\u3001dubbo\u670d\u52a1"},{"location":"tantan/day04/#611","text":"package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.pojo.Publish ; import com.tanhua.dubbo.server.vo.PageInfo ; public interface QuanZiApi { /** * \u67e5\u8be2\u597d\u53cb\u52a8\u6001 * * @param userId \u7528\u6237id * @param page \u5f53\u524d\u9875\u6570 * @param pageSize \u6bcf\u4e00\u9875\u67e5\u8be2\u7684\u6570\u636e\u6761\u6570 * @return */ PageInfo < Publish > queryPublishList ( Long userId , Integer page , Integer pageSize ); /** * \u53d1\u5e03\u52a8\u6001 * * @param publish * @return \u53d1\u5e03\u6210\u529f\u8fd4\u56de\u52a8\u6001id */ String savePublish ( Publish publish ); }","title":"6.1.1\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day04/#612","text":"/** * \u53d1\u5e03\u52a8\u6001 * * @param publish * @return \u53d1\u5e03\u6210\u529f\u8fd4\u56de\u52a8\u6001id */ public String savePublish ( Publish publish ) { //\u5bf9publish\u5bf9\u8c61\u6821\u9a8c if ( ! ObjectUtil . isAllNotEmpty ( publish . getText (), publish . getUserId ())) { //\u53d1\u5e03\u5931\u8d25 return null ; } //\u8bbe\u7f6e\u4e3b\u952eid publish . setId ( ObjectId . get ()); try { //\u8bbe\u7f6e\u81ea\u589e\u957f\u7684pid publish . setPid ( this . idService . createId ( IdType . PUBLISH )); publish . setCreated ( System . currentTimeMillis ()); //\u5199\u5165\u5230publish\u8868\u4e2d this . mongoTemplate . save ( publish ); //\u5199\u5165\u76f8\u518c\u8868 Album album = new Album (); album . setId ( ObjectId . get ()); album . setCreated ( System . currentTimeMillis ()); album . setPublishId ( publish . getId ()); this . mongoTemplate . save ( album , \"quanzi_album_\" + publish . getUserId ()); //\u5199\u5165\u597d\u53cb\u7684\u65f6\u95f4\u7ebf\u8868\uff08\u5f02\u6b65\u5199\u5165\uff09 this . timeLineService . saveTimeLine ( publish . getUserId (), publish . getId ()); } catch ( Exception e ) { //TODO \u9700\u8981\u505a\u4e8b\u52a1\u7684\u56de\u6eda\uff0cMongodb\u7684\u5355\u8282\u70b9\u670d\u52a1\uff0c\u4e0d\u652f\u6301\u4e8b\u52a1\uff0c\u5bf9\u4e8e\u56de\u6eda\u6211\u4eec\u6682\u65f6\u4e0d\u5b9e\u73b0\u4e86 log . error ( \"\u53d1\u5e03\u52a8\u6001\u5931\u8d25~ publish = \" + publish , e ); } return publish . getId (). toHexString (); } package com.tanhua.dubbo.server.service ; import com.tanhua.dubbo.server.enums.IdType ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.redis.core.RedisTemplate ; import org.springframework.stereotype.Service ; //\u751f\u6210\u81ea\u589e\u957f\u7684id\uff0c\u539f\u7406\uff1a\u4f7f\u7528redis\u7684\u81ea\u589e\u957f\u503c @Service public class IdService { @Autowired private RedisTemplate < String , String > redisTemplate ; public Long createId ( IdType idType ) { String idKey = \"TANHUA_ID_\" + idType . toString (); return this . redisTemplate . opsForValue (). increment ( idKey ); } } package com.tanhua.dubbo.server.enums ; public enum IdType { PUBLISH , VIDEO ; }","title":"6.1.2\u3001\u5b9e\u73b0\u63a5\u53e3"},{"location":"tantan/day04/#613","text":"\u597d\u53cb\u7684\u65f6\u95f4\u7ebf\u6570\u636e\u9700\u8981\u5f02\u6b65\u6267\u884c\u3002\u8fd9\u91cc\u4f7f\u7528Spring\u7684@Async\u6ce8\u89e3\u5b9e\u73b0\u5f02\u6b65\u6267\u884c\uff0c\u5176\u5e95\u5c42\u662f\u901a\u8fc7\u542f\u52a8\u72ec\u7acb\u7ebf\u7a0b\u6765\u6267\u884c\uff0c\u4ece\u800c\u53ef\u4ee5\u5f02\u6b65\u6267\u884c\u3002\u901a\u8fc7\u8fd4\u56de\u7684CompletableFuture\u6765\u5224\u65ad\u662f\u5426\u6267\u884c\u6210\u529f\u4ee5\u53ca\u662f\u5426\u5b58\u5728\u5f02\u5e38\u3002\u540c\u65f6\u9700\u8981\u5728\u542f\u52a8\u7c7b\u4e2d\u6dfb\u52a0@EnableAsync \u5f00\u542f\u5f02\u6b65\u7684\u652f\u6301\u3002 package com.tanhua.dubbo.server.service ; import cn.hutool.core.collection.CollUtil ; import com.tanhua.dubbo.server.pojo.TimeLine ; import com.tanhua.dubbo.server.pojo.Users ; import lombok.extern.slf4j.Slf4j ; import org.bson.types.ObjectId ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; import org.springframework.scheduling.annotation.Async ; import org.springframework.stereotype.Service ; import java.util.List ; import java.util.concurrent.CompletableFuture ; @Service @Slf4j public class TimeLineService { @Autowired private MongoTemplate mongoTemplate ; @Async //\u5f02\u6b65\u6267\u884c\uff0c\u539f\u7406\uff1a\u5e95\u5c42\u5f00\u4e00\u4e2a\u7ebf\u7a0b\u53bb\u6267\u884c\u8be5\u65b9\u6cd5 public CompletableFuture < String > saveTimeLine ( Long userId , ObjectId publishId ) { //\u5199\u5165\u597d\u53cb\u7684\u65f6\u95f4\u7ebf\u8868 try { //\u67e5\u8be2\u597d\u53cb\u5217\u8868 Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId )); List < Users > usersList = this . mongoTemplate . find ( query , Users . class ); if ( CollUtil . isEmpty ( usersList )) { //\u8fd4\u56de\u6210\u529f return CompletableFuture . completedFuture ( \"ok\" ); } //\u4f9d\u6b21\u5199\u5165\u5230\u597d\u53cb\u7684\u65f6\u95f4\u7ebf\u8868\u4e2d for ( Users users : usersList ) { TimeLine timeLine = new TimeLine (); timeLine . setId ( ObjectId . get ()); timeLine . setDate ( System . currentTimeMillis ()); timeLine . setPublishId ( publishId ); timeLine . setUserId ( userId ); //\u5199\u5165\u6570\u636e this . mongoTemplate . save ( timeLine , \"quanzi_time_line_\" + users . getFriendId ()); } } catch ( Exception e ) { log . error ( \"\u5199\u5165\u597d\u53cb\u65f6\u95f4\u7ebf\u8868\u5931\u8d25~ userId = \" + userId + \", publishId = \" + publishId , e ); //TODO \u4e8b\u52a1\u56de\u6eda\u95ee\u9898 return CompletableFuture . completedFuture ( \"error\" ); } return CompletableFuture . completedFuture ( \"ok\" ); } } \u5f00\u542f\u5f02\u6b65\u6267\u884c\uff1a package com.tanhua.dubbo.server ; import cn.hutool.core.util.StrUtil ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; import org.springframework.scheduling.annotation.EnableAsync ; @SpringBootApplication @EnableAsync //\u5f00\u542f\u5f02\u6b65\u6267\u884c\u7684\u652f\u6301 public class DubboApplication { public static void main ( String [] args ) { SpringApplication . run ( DubboApplication . class , args ); } }","title":"6.1.3\u3001\u597d\u53cb\u65f6\u95f4\u7ebf\u6570\u636e"},{"location":"tantan/day04/#614","text":"package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.service.TimeLineService ; import org.bson.types.ObjectId ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; import java.util.concurrent.CompletableFuture ; import java.util.concurrent.ExecutionException ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestTimeLineService { @Autowired private TimeLineService timeLineService ; @Test public void testSaveTimeLine () { ObjectId objectId = ObjectId . get (); System . out . println ( \"\u751f\u6210\u7684id\u4e3a\uff1a\" + objectId . toHexString ()); CompletableFuture < String > future = this . timeLineService . saveTimeLine ( 1L , objectId ); future . whenComplete (( s , throwable ) -> { System . out . println ( \"\u6267\u884c\u5b8c\u6210\uff1a\" + s ); }); System . out . println ( \"\u5f02\u6b65\u65b9\u6cd5\u6267\u884c\u5b8c\u6210\" ); try { future . get (); //\u963b\u585e\u5f53\u524d\u7684\u4e3b\u7ebf\u7a0b\uff0c\u7b49\u5f85\u5f02\u6b65\u6267\u884c\u7684\u7ed3\u675f } catch ( Exception e ) { e . printStackTrace (); } } }","title":"6.1.4\u3001\u6d4b\u8bd5\u597d\u53cb\u65f6\u95f4\u7ebf"},{"location":"tantan/day04/#615","text":"\u5c06dubbo\u670d\u52a1\u542f\u52a8\u8d77\u6765\uff0c\u5728my-tanhua-server\u5de5\u7a0b\u4e2d\u8fdb\u884c\u529f\u80fd\u7684\u6d4b\u8bd5\uff1a package com.tanhua.server ; import cn.hutool.core.collection.ListUtil ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.dubbo.server.api.QuanZiApi ; import com.tanhua.dubbo.server.pojo.Publish ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestQuanZiApi { @Reference ( version = \"1.0.0\" ) private QuanZiApi quanZiApi ; @Test public void testSavePublish (){ Publish publish = new Publish (); publish . setText ( \"\u4eba\u751f\u4e0d\u5982\u610f\u4e8b\u5341\u4e4b\u516b\u4e5d\uff0c\u771f\u6b63\u6709\u683c\u5c40\u7684\u4eba\uff0c\u65e2\u80fd\u4eab\u53d7\u6700\u597d\u7684\uff0c\u4e5f\u80fd\u627f\u53d7\u6700\u574f\u7684\u3002\" ); publish . setMedias ( ListUtil . toList ( \"https://tanhua-dev.oss-cn-zhangjiakou.aliyuncs.com/photo/6/1.jpg\" , \"https://tanhua-dev.oss-cn-zhangjiakou.aliyuncs.com/photo/6/CL-3.jpg\" )); publish . setUserId ( 1L ); publish . setSeeType ( 1 ); publish . setLongitude ( \"116.350426\" ); publish . setLatitude ( \"40.066355\" ); publish . setLocationName ( \"\u4e2d\u56fd\u5317\u4eac\u5e02\u660c\u5e73\u533a\u5efa\u6750\u57ce\u897f\u8def16\u53f7\" ); this . quanZiApi . savePublish ( publish ); } }","title":"6.1.5\u3001\u6d4b\u8bd5\u53d1\u5e03\u52a8\u6001"},{"location":"tantan/day04/#62app","text":"\u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/701 \u4ece\u63a5\u53e3\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u4e3b\u8981\u7684\u53c2\u6570\u6709\uff1a\u6587\u5b57\u3001\u56fe\u7247\u3001\u4f4d\u7f6e\u7b49\u5185\u5bb9\u3002","title":"6.2\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day04/#621","text":"\u56fe\u7247\u4e0a\u4f20\u529f\u80fd\u539f\u6765\u662f\u5728sso\u4e2d\u5b8c\u6210\u7684\uff0c\u4e3a\u4e86\u80fd\u516c\u7528\u8be5\u529f\u80fd\uff0c\u6240\u4ee5\u9700\u8981\u5c06\u56fe\u7247\u4e0a\u4f20\u7684Service\u4ee5\u53ca\u914d\u7f6e\u79fb\u52a8\u81f3common\u5de5\u7a0b\u4e2d\u3002 pom.xml\uff1a <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <parent> <artifactId> my-tanhua </artifactId> <groupId> cn.itcast.tanhua </groupId> <version> 1.0-SNAPSHOT </version> </parent> <modelVersion> 4.0.0 </modelVersion> <artifactId> my-tanhua-common </artifactId> <dependencies> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-web </artifactId> </dependency> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> </dependency> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus-boot-starter </artifactId> </dependency> <dependency> <groupId> com.fasterxml.jackson.core </groupId> <artifactId> jackson-databind </artifactId> </dependency> <dependency> <groupId> com.aliyun.oss </groupId> <artifactId> aliyun-sdk-oss </artifactId> </dependency> <dependency> <groupId> org.apache.commons </groupId> <artifactId> commons-lang3 </artifactId> </dependency> <dependency> <groupId> joda-time </groupId> <artifactId> joda-time </artifactId> </dependency> </dependencies> </project> \u9700\u8981\u6ce8\u610f3\u70b9\uff1a \u5c06sso\u7cfb\u7edf\u4e2d\u7684\u76f8\u5173\u4ee3\u7801\u5220\u9664 \u5c06aliyun.properties\u590d\u5236\u5230my-tanhua-server\u4e2d \u542f\u52a8\u7c7b\u4e2d\u9700\u8981\u5c06\u5305\u626b\u63cf\u8303\u56f4\u6269\u5927\u5230comm.tanhua\uff0c\u56e0\u4e3a\u76f8\u5173\u7c7b\u88ab\u79fb\u52a8\u5230com.tanhua.common\u4e0b\uff0c\u9ed8\u8ba4\u626b\u63cf\u4e0d\u80fd\u88ab\u626b\u63cf\u5230\u3002 sso\u4e0eserver\u7cfb\u7edf\u90fd\u9700\u8981\u8bbe\u7f6e\uff1a ~~~java package com.tanhua.server; @MapperScan(\"com.tanhua.common.mapper\") //\u8bbe\u7f6emapper\u63a5\u53e3\u7684\u626b\u63cf\u5305 @SpringBootApplication(exclude = {MongoAutoConfiguration.class, MongoDataAutoConfiguration.class}) //\u6392\u9664mongo\u7684\u81ea\u52a8\u914d\u7f6e @ComponentScan(basePackages={\"com.tanhua\"}) //\u8bbe\u7f6e\u626b\u63cf\u5305\u8303\u56f4 public class ServerApplication { public static void main(String[] args) { SpringApplication.run(ServerApplication.class, args); } } ~~~","title":"6.2.1\u3001\u56fe\u7247\u4e0a\u4f20"},{"location":"tantan/day04/#622","text":"\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6587\u5b57\u662f\u5fc5\u987b\u63d0\u4ea4\u7684\uff0c\u56fe\u7247\u662f\u975e\u5fc5\u987b\u7684\u3002 //com.tanhua.server.controller.QuanZiController /** * \u53d1\u9001\u52a8\u6001 * * @param textContent * @param location * @param multipartFile * @return */ @PostMapping public ResponseEntity < Void > savePublish ( @RequestParam ( \"textContent\" ) String textContent , @RequestParam ( value = \"location\" , required = false ) String location , @RequestParam ( value = \"latitude\" , required = false ) String latitude , @RequestParam ( value = \"longitude\" , required = false ) String longitude , @RequestParam ( value = \"imageContent\" , required = false ) MultipartFile [] multipartFile ) { try { String publishId = this . quanZiService . savePublish ( textContent , location , latitude , longitude , multipartFile ); if ( StrUtil . isNotEmpty ( publishId )) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"6.2.2\u3001\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day04/#623quanziservice","text":"// com.tanhua.server.service.QuanZiService @Autowired private PicUploadService picUploadService ; public String savePublish ( String textContent , String location , String latitude , String longitude , MultipartFile [] multipartFile ) { //\u67e5\u8be2\u5f53\u524d\u7684\u767b\u5f55\u4fe1\u606f User user = UserThreadLocal . get (); Publish publish = new Publish (); publish . setUserId ( user . getId ()); publish . setText ( textContent ); publish . setLocationName ( location ); publish . setLatitude ( latitude ); publish . setLongitude ( longitude ); publish . setSeeType ( 1 ); List < String > picUrls = new ArrayList <> (); //\u56fe\u7247\u4e0a\u4f20 for ( MultipartFile file : multipartFile ) { PicUploadResult picUploadResult = this . picUploadService . upload ( file ); picUrls . add ( picUploadResult . getName ()); } publish . setMedias ( picUrls ); return this . quanZiApi . savePublish ( publish ); }","title":"6.2.3\u3001QuanZiService\u5b9e\u73b0"},{"location":"tantan/day04/#7","text":"\u63a8\u8350\u52a8\u6001\u662f\u901a\u8fc7\u63a8\u8350\u7cfb\u7edf\u8ba1\u7b97\u51fa\u7684\u7ed3\u679c\uff0c\u73b0\u5728\u6211\u4eec\u53ea\u9700\u8981\u5b9e\u73b0\u67e5\u8be2\u5373\u53ef\uff0c\u63a8\u8350\u7cfb\u7edf\u5728\u540e\u9762\u7684\u8bfe\u7a0b\u4e2d\u5b8c\u6210\u3002 \u63a8\u8350\u7cfb\u7edf\u8ba1\u7b97\u5b8c\u6210\u540e\uff0c\u4f1a\u5c06\u7ed3\u679c\u6570\u636e\u5199\u5165\u5230Redis\u4e2d\uff0c\u6570\u636e\u5982\u4e0b\uff1a 192 .168.31.81:6379> get QUANZI_PUBLISH_RECOMMEND_1 \"2562,3639,2063,3448,2128,2597,2893,2333,3330,2642,2541,3002,3561,3649,2384,2504,3397,2843,2341,2249\" \u53ef\u4ee5\u770b\u5230\uff0c\u5728Redis\u4e2d\u7684\u6570\u636e\u662f\u6709\u591a\u4e2a\u53d1\u5e03id\u7ec4\u6210\uff08pid\uff09\u7531\u9017\u53f7\u5206\u9694\u3002\u6240\u4ee5\u5b9e\u73b0\u4e2d\u9700\u8981\u81ea\u5df1\u5bf9\u8fd9\u4e9b\u6570\u636e\u505a\u5206\u9875\u5904\u7406\u3002","title":"7\u3001\u67e5\u8be2\u63a8\u8350\u52a8\u6001"},{"location":"tantan/day04/#71dubbo","text":"","title":"7.1\u3001dubbo\u670d\u52a1"},{"location":"tantan/day04/#711","text":"//com.tanhua.dubbo.server.api.QuanZiApi /** * \u67e5\u8be2\u63a8\u8350\u52a8\u6001 * * @param userId \u7528\u6237id * @param page \u5f53\u524d\u9875\u6570 * @param pageSize \u6bcf\u4e00\u9875\u67e5\u8be2\u7684\u6570\u636e\u6761\u6570 * @return */ PageInfo < Publish > queryRecommendPublishList ( Long userId , Integer page , Integer pageSize );","title":"7.1.1\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day04/#712","text":"//com.tanhua.dubbo.server.api.QuanZiApiImpl @Autowired private RedisTemplate < String , String > redisTemplate ; public PageInfo < Publish > queryRecommendPublishList ( Long userId , Integer page , Integer pageSize ) { PageInfo < Publish > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); // \u67e5\u8be2\u63a8\u8350\u7ed3\u679c\u6570\u636e String key = \"QUANZI_PUBLISH_RECOMMEND_\" + userId ; String data = this . redisTemplate . opsForValue (). get ( key ); if ( StrUtil . isEmpty ( data )) { return pageInfo ; } //\u67e5\u8be2\u5230\u7684pid\u8fdb\u884c\u5206\u9875\u5904\u7406 List < String > pids = StrUtil . split ( data , ',' ); //\u8ba1\u7b97\u5206\u9875 //[0, 10] int [] startEnd = PageUtil . transToStartEnd ( page - 1 , pageSize ); int startIndex = startEnd [ 0 ] ; //\u5f00\u59cb int endIndex = Math . min ( startEnd [ 1 ] , pids . size ()); //\u7ed3\u675f List < Long > pidLongList = new ArrayList <> (); for ( int i = startIndex ; i < endIndex ; i ++ ) { pidLongList . add ( Long . valueOf ( pids . get ( i ))); } if ( CollUtil . isEmpty ( pidLongList )) { //\u6ca1\u6709\u67e5\u8be2\u5230\u6570\u636e return pageInfo ; } //\u6839\u636epid\u67e5\u8be2publish Query query = Query . query ( Criteria . where ( \"pid\" ). in ( pidLongList )) . with ( Sort . by ( Sort . Order . desc ( \"created\" ))); List < Publish > publishList = this . mongoTemplate . find ( query , Publish . class ); if ( CollUtil . isEmpty ( publishList )) { //\u6ca1\u6709\u67e5\u8be2\u5230\u6570\u636e return pageInfo ; } pageInfo . setRecords ( publishList ); return pageInfo ; }","title":"7.1.2\u3001\u7f16\u5199\u5b9e\u73b0"},{"location":"tantan/day04/#72app","text":"\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/677 \u901a\u8fc7\u63a5\u53e3\u7684\u5b9a\u4e49\u53ef\u4ee5\u770b\u51fa\uff0c\u5176\u54cd\u5e94\u7684\u6570\u636e\u7ed3\u6784\u4e0e\u597d\u53cb\u52a8\u6001\u7ed3\u6784\u4e00\u6837\uff0c\u6240\u4ee5\u53ef\u4ee5\u590d\u7528QuanZiVo\u5bf9\u8c61\u3002","title":"7.2\u3001APP\u670d\u52a1"},{"location":"tantan/day04/#721quanzicontroller","text":"//com.tanhua.server.controller.QuanZiController /** * \u67e5\u8be2\u63a8\u8350\u52a8\u6001 * * @param page * @param pageSize * @return */ @GetMapping ( \"recommend\" ) public PageResult queryRecommendPublishList ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize ) { return this . quanZiService . queryRecommendPublishList ( page , pageSize ); }","title":"7.2.1\u3001QuanZiController"},{"location":"tantan/day04/#722quanziservice","text":"\u5728\u5b9e\u73b0\u4e2d\uff0c\u5c06\u67e5\u8be2\u597d\u53cb\u52a8\u6001\u7684\u65b9\u6cd5\u4e2d\u516c\u5171\u7684\u5185\u5bb9\uff0c\u8fdb\u884c\u62bd\u53d6\uff0c\u5177\u4f53\u5982\u4e0b\uff1a //com.tanhua.server.service.QuanZiService public PageResult queryRecommendPublishList ( Integer page , Integer pageSize ) { //\u5206\u6790\uff1a\u901a\u8fc7dubbo\u4e2d\u7684\u670d\u52a1\u67e5\u8be2\u7cfb\u7edf\u63a8\u8350\u52a8\u6001 //\u901a\u8fc7mysql\u67e5\u8be2\u7528\u6237\u7684\u4fe1\u606f\uff0c\u56de\u5199\u5230\u7ed3\u679c\u5bf9\u8c61\u4e2d\uff08QuanZiVo\uff09 PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); //\u76f4\u63a5\u4eceThreadLocal\u4e2d\u83b7\u53d6\u5bf9\u8c61 User user = UserThreadLocal . get (); //\u901a\u8fc7dubbo\u67e5\u8be2\u6570\u636e PageInfo < Publish > pageInfo = this . quanZiApi . queryRecommendPublishList ( user . getId (), page , pageSize ); List < Publish > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )) { return pageResult ; } pageResult . setItems ( this . fillQuanZiVo ( records )); return pageResult ; } /** * \u586b\u5145\u7528\u6237\u4fe1\u606f * * @param userInfo * @param quanZiVo */ private void fillUserInfoToQuanZiVo ( UserInfo userInfo , QuanZiVo quanZiVo ){ BeanUtil . copyProperties ( userInfo , quanZiVo , \"id\" ); quanZiVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); quanZiVo . setTags ( StringUtils . split ( userInfo . getTags (), ',' )); quanZiVo . setCommentCount ( 0 ); //TODO \u8bc4\u8bba\u6570 quanZiVo . setDistance ( \"1.2\u516c\u91cc\" ); //TODO \u8ddd\u79bb quanZiVo . setHasLiked ( 0 ); //TODO \u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLikeCount ( 0 ); //TODO \u70b9\u8d5e\u6570 quanZiVo . setHasLoved ( 0 ); //TODO \u662f\u5426\u559c\u6b22\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLoveCount ( 0 ); //TODO \u559c\u6b22\u6570 } /** * \u6839\u636e\u67e5\u8be2\u5230\u7684publish\u96c6\u5408\u586b\u5145QuanZiVo\u5bf9\u8c61 * * @param records * @return */ private List < QuanZiVo > fillQuanZiVo ( List < Publish > records ){ List < QuanZiVo > quanZiVoList = new ArrayList <> (); records . forEach ( publish -> { QuanZiVo quanZiVo = new QuanZiVo (); quanZiVo . setId ( publish . getId (). toHexString ()); quanZiVo . setTextContent ( publish . getText ()); quanZiVo . setImageContent ( publish . getMedias (). toArray ( new String [] {})); quanZiVo . setUserId ( publish . getUserId ()); quanZiVo . setCreateDate ( RelativeDateFormat . format ( new Date ( publish . getCreated ()))); quanZiVoList . add ( quanZiVo ); }); //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIds = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); for ( QuanZiVo quanZiVo : quanZiVoList ) { //\u627e\u5230\u5bf9\u5e94\u7684\u7528\u6237\u4fe1\u606f for ( UserInfo userInfo : userInfoList ) { if ( quanZiVo . getUserId (). longValue () == userInfo . getUserId (). longValue ()){ this . fillUserInfoToQuanZiVo ( userInfo , quanZiVo ); break ; } } } return quanZiVoList ; }","title":"7.2.2\u3001QuanZiService"},{"location":"tantan/day04/#73","text":"","title":"7.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day04/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/","text":"\u72ec\u7acb\u5b8c\u6210common\u7684\u62bd\u53d6 \u4e86\u89e3\u5708\u5b50\u529f\u80fd \u4e86\u89e3\u5708\u5b50\u7684\u6280\u672f\u65b9\u6848 \u72ec\u7acb\u5b8c\u6210\u5708\u5b50\u7684\u597d\u53cb\u52a8\u6001\u529f\u80fd \u72ec\u7acb\u5b8c\u6210\u5708\u5b50\u7684\u53d1\u5e03\u52a8\u6001\u529f\u80fd \u72ec\u7acb\u5b8c\u6210\u5708\u5b50\u7684\u63a8\u8350\u52a8\u6001\u529f\u80fd","title":"\u5b66\u4e60\u76ee\u6807"},{"location":"tantan/day05/","text":"\u8bfe\u7a0b\u8bf4\u660e \u00b6 \u5708\u5b50\u5b9e\u73b0\u70b9\u8d5e\u3001\u559c\u6b22\u529f\u80fd \u5708\u5b50\u5b9e\u73b0\u8bc4\u8bba \u5708\u5b50\u5b9e\u73b0\u8bc4\u8bba\u7684\u70b9\u8d5e \u5c0f\u89c6\u9891\u529f\u80fd\u4ecb\u7ecd FastDFS\u5165\u95e8\u5b66\u4e60 \u5b9e\u73b0\u53d1\u5e03\u5c0f\u89c6\u9891\u529f\u80fd \u5b9e\u73b0\u67e5\u8be2\u5c0f\u89c6\u9891\u5217\u8868\u529f\u80fd 1\u3001\u5708\u5b50\u70b9\u8d5e\u5b9e\u73b0\u5206\u6790 \u00b6 \u5728\u5708\u5b50\u529f\u80fd\u4e2d\uff0c\u5bf9\u4e8e\u5708\u5b50\u7684\u70b9\u8d5e\u3001\u559c\u6b22\u3001\u8bc4\u8bba\u7b49\u5747\u53ef\u7406\u89e3\u4e3a\u7528\u6237\u5bf9\u52a8\u6001\u7684\u8bc4\u8bba\uff08Comment\uff09\uff0c\u5728quanzi_comment\u8868\u4e2d\u4f7f\u7528commentType\u8fdb\u884c\u533a\u5206\u3002 \u5728\u5177\u4f53\u7684\u5b9e\u73b0\u4e2d\uff0c\u9700\u8981\u5c06\u70b9\u8d5e\u6570\u3001\u67d0\u7528\u6237\u662f\u5426\u70b9\u8d5e\u7b49\u6570\u636e\u4fdd\u5b58\u5230Reds\u4e2d\uff0c\u4ee5\u51cf\u8f7bMongoDB\u7684\u538b\u529b\u3002 \u5177\u4f53\u5b58\u50a8\u7ed3\u6784\u5982\u4e0b\uff1a \u8bf4\u660e\uff1a\u5728Redis\u7684\u5b58\u50a8\u7ed3\u6784\u4e2d\uff0c\u91c7\u7528\u7684\u662fHash\u5b58\u50a8\uff0c\u8fd9\u6837\u7684\u597d\u5904\u5c31\u5728\u4e8e\u4e00\u6761\u52a8\u6001\u7684\u70b9\u8d5e\u3001\u559c\u6b22\u7b49\u6570\u636e\u90fd\u4f1a\u96c6\u4e2d\u7684\u5b58\u50a8\u5230\u4e00\u8d77\uff0c\u4ece\u800c\u51cf\u5c11\u4e86Redis\u4e2d\u6570\u636e\u6761\u6570\u3002 2\u3001\u70b9\u8d5e \u00b6 2.1\u3001\u5b9a\u4e49\u679a\u4e3e \u00b6 \u4e3a\u4e86\u89c4\u8303\u4f7f\u7528CommentType\uff0c\u6240\u4ee5\u5c06\u5176\u5b9a\u4e49\u4e3a\u679a\u4e3e\u7c7b\u578b\u3002 package com.tanhua.dubbo.server.enums ; /** * \u8bc4\u8bba\u7c7b\u578b\uff1a1-\u70b9\u8d5e\uff0c2-\u8bc4\u8bba\uff0c3-\u559c\u6b22 */ public enum CommentType { LIKE ( 1 ), COMMENT ( 2 ), LOVE ( 3 ); int type ; CommentType ( int type ) { this . type = type ; } public int getType () { return type ; } } 2.2\u3001dubbo\u670d\u52a1 \u00b6 2.2.1\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.pojo.Publish ; import com.tanhua.dubbo.server.vo.PageInfo ; public interface QuanZiApi { //........\u6b64\u5904\u5ffd\u7565\u5176\u4ed6\u4ee3\u7801.......... /** * \u6839\u636eid\u67e5\u8be2\u52a8\u6001 * * @param id \u52a8\u6001id * @return */ Publish queryPublishById ( String id ); /** * \u70b9\u8d5e * * @param userId * @param publishId * @return */ Boolean likeComment ( Long userId , String publishId ); /** * \u53d6\u6d88\u70b9\u8d5e * * @param userId * @param publishId * @return */ Boolean disLikeComment ( Long userId , String publishId ); /** * \u67e5\u8be2\u70b9\u8d5e\u6570 * * @param publishId * @return */ Long queryLikeCount ( String publishId ); /** * \u67e5\u8be2\u7528\u6237\u662f\u5426\u70b9\u8d5e\u8be5\u52a8\u6001 * * @param userId * @param publishId * @return */ Boolean queryUserIsLike ( Long userId , String publishId ); } 2.2.2\u3001\u7f16\u5199\u5b9e\u73b0 \u00b6 package com.tanhua.dubbo.server.api ; @Service ( version = \"1.0.0\" ) @Slf4j public class QuanZiApiImpl implements QuanZiApi { //\u8bc4\u8bba\u6570\u636e\u5b58\u50a8\u5728Redis\u4e2dkey\u7684\u524d\u7f00 private static final String COMMENT_REDIS_KEY_PREFIX = \"QUANZI_COMMENT_\" ; //\u7528\u6237\u662f\u5426\u70b9\u8d5e\u7684\u524d\u7f00 private static final String COMMENT_USER_LIEK_REDIS_KEY_PREFIX = \"USER_LIKE_\" ; //\u7528\u6237\u662f\u5426\u559c\u6b22\u7684\u524d\u7f00 private static final String COMMENT_USER_LOVE_REDIS_KEY_PREFIX = \"USER_LOVE_\" ; @Autowired private MongoTemplate mongoTemplate ; @Autowired private RedisTemplate < String , String > redisTemplate ; //........\u6b64\u5904\u5ffd\u7565\u5176\u4ed6\u4ee3\u7801.......... @Override public Publish queryPublishById ( String id ) { return this . mongoTemplate . findById ( new ObjectId ( id ), Publish . class ); } @Override public Boolean likeComment ( Long userId , String publishId ) { //\u5224\u65ad\u8be5\u7528\u6237\u662f\u5426\u5df2\u7ecf\u70b9\u8d5e\uff0c\u5982\u679c\u5df2\u7ecf\u70b9\u8d5e\u5c31\u76f4\u63a5\u8fd4\u56de if ( this . queryUserIsLike ( userId , publishId )) { return false ; } //\u4fdd\u5b58Comment\u6570\u636e Boolean result = this . saveComment ( userId , publishId , CommentType . LIKE , null ); if ( ! result ) { return false ; } //\u4fee\u6539redis\u4e2d\u7684\u70b9\u8d5e\u6570\u4ee5\u53ca\u662f\u5426\u70b9\u8d5e //\u4fee\u6539\u70b9\u8d5e\u6570 String redisKey = this . getCommentRedisKeyPrefix ( publishId ); String hashKey = CommentType . LIKE . toString (); this . redisTemplate . opsForHash (). increment ( redisKey , hashKey , 1 ); //\u7528\u6237\u662f\u5426\u70b9\u8d5e String userHashKey = this . getCommentUserLikeRedisKeyPrefix ( userId ); this . redisTemplate . opsForHash (). put ( redisKey , userHashKey , \"1\" ); return true ; } private String getCommentRedisKeyPrefix ( String publishId ) { return COMMENT_REDIS_KEY_PREFIX + publishId ; } private String getCommentUserLikeRedisKeyPrefix ( Long userId ) { return COMMENT_USER_LIKE_REDIS_KEY_PREFIX + userId ; } @Override public Boolean disLikeComment ( Long userId , String publishId ) { //\u5224\u65ad\u7528\u6237\u662f\u5426\u5df2\u7ecf\u70b9\u8d5e\uff0c\u5982\u679c\u6ca1\u6709\u70b9\u8d5e\u5c31\u8fd4\u56de if ( ! this . queryUserIsLike ( userId , publishId )) { return false ; } //\u5220\u9664\u8bc4\u8bba\u6570\u636e Boolean result = this . removeComment ( userId , publishId , CommentType . LIKE ); if ( ! result ) { return false ; } //\u4fee\u6539Redis\u4e2d\u7684\u6570\u636e //\u4fee\u6539\u70b9\u8d5e\u6570 String redisKey = this . getCommentRedisKeyPrefix ( publishId ); String hashKey = CommentType . LIKE . toString (); this . redisTemplate . opsForHash (). increment ( redisKey , hashKey , - 1 ); //\u7528\u6237\u662f\u5426\u70b9\u8d5e String userHashKey = this . getCommentUserLikeRedisKeyPrefix ( userId ); this . redisTemplate . opsForHash (). delete ( redisKey , userHashKey ); return true ; } @Override public Long queryLikeCount ( String publishId ) { //\u4eceRedis\u4e2d\u547d\u4e2d\u67e5\u8be2\uff0c\u5982\u679c\u547d\u4e2d\u76f4\u63a5\u8fd4\u56de\u5373\u53ef String redisKey = this . getCommentRedisKeyPrefix ( publishId ); String hashKey = CommentType . LIKE . toString (); Object data = this . redisTemplate . opsForHash (). get ( redisKey , hashKey ); if ( ObjectUtil . isNotEmpty ( data )) { return Convert . toLong ( data ); } //\u67e5\u8be2Mongodb Long count = this . queryCommentCount ( publishId , CommentType . LIKE ); //\u5199\u5165Redis\u4e2d this . redisTemplate . opsForHash (). put ( redisKey , hashKey , String . valueOf ( count )); return count ; } @Override public Boolean queryUserIsLike ( Long userId , String publishId ) { //\u4eceredis\u4e2d\u67e5\u8be2\u6570\u636e String redisKey = this . getCommentRedisKeyPrefix ( publishId ); String userHashKey = this . getCommentUserLikeRedisKeyPrefix ( userId ); Object data = this . redisTemplate . opsForHash (). get ( redisKey , userHashKey ); if ( ObjectUtil . isNotEmpty ( data )) { return StrUtil . equals ( Convert . toStr ( data ), \"1\" ); } //\u67e5\u8be2Mongodb\uff0c\u786e\u5b9a\u662f\u5426\u5df2\u7ecf\u70b9\u8d5e Query query = Query . query ( Criteria . where ( \"publishId\" ). is ( new ObjectId ( publishId )) . and ( \"userId\" ). is ( userId ) . and ( \"commentType\" ). is ( CommentType . LIKE ) ); long count = this . mongoTemplate . count ( query , Comment . class ); if ( count == 0 ){ return false ; } //\u5199\u5165\u5230redis\u4e2d this . redisTemplate . opsForHash (). put ( redisKey , userHashKey , \"1\" ); return true ; } /** * \u4fdd\u5b58Comment * * @return */ private Boolean saveComment ( Long userId , String publishId , CommentType commentType , String content ) { try { Comment comment = new Comment (); comment . setId ( ObjectId . get ()); comment . setUserId ( userId ); comment . setPublishId ( new ObjectId ( publishId )); // \u8bc4\u8bba\u7c7b\u578b comment . setCommentType ( commentType . getType ()); // \u5185\u5bb9 comment . setContent ( content ); comment . setCreated ( System . currentTimeMillis ()); Publish publish = this . queryPublishById ( publishId ); //TODO \u5176\u4ed6\u8bc4\u8bba\u5bf9\u8c61\uff0c\u6682\u4e0d\u5904\u7406 comment . setPublishUserId ( publish . getUserId ()); this . mongoTemplate . save ( comment ); return true ; } catch ( Exception e ) { log . error ( \"\u4fdd\u5b58Comment\u51fa\u9519~ userId = \" + userId + \", publishId = \" + publishId + \", commentType = \" + commentType , e ); } return false ; } /** * \u5220\u9664\u8bc4\u8bba\u6570\u636e * * @param userId * @param publishId * @param commentType * @return */ private Boolean removeComment ( Long userId , String publishId , CommentType commentType ) { Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId ) . and ( \"publishId\" ). is ( new ObjectId ( publishId )) . and ( \"commentType\" ). is ( commentType . getType ()) ); return this . mongoTemplate . remove ( query , Comment . class ). getDeletedCount () > 0 ; } /** * \u67e5\u8be2\u6570\u91cf * * @param publishId * @param commentType * @return */ private Long queryCommentCount ( String publishId , CommentType commentType ) { Query query = Query . query ( Criteria . where ( \"publishId\" ). is ( new ObjectId ( publishId )) . and ( \"commentType\" ). is ( commentType . getType ()) ); return this . mongoTemplate . count ( query , Comment . class ); } } 2.2.3\u3001\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b \u00b6 package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.pojo.Publish ; import com.tanhua.dubbo.server.vo.PageInfo ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestQuanZiApi { @Autowired private QuanZiApi quanZiApi ; //........\u6b64\u5904\u5ffd\u7565\u5176\u4ed6\u4ee3\u7801.......... @Test public void testLike (){ Long userId = 1L ; String publishId = \"5fae53947e52992e78a3afb1\" ; Boolean data = this . quanZiApi . queryUserIsLike ( userId , publishId ); System . out . println ( data ); System . out . println ( this . quanZiApi . likeComment ( userId , publishId )); System . out . println ( this . quanZiApi . queryLikeCount ( publishId )); System . out . println ( this . quanZiApi . disLikeComment ( userId , publishId )); System . out . println ( this . quanZiApi . queryLikeCount ( publishId )); } } 2.3\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 \u70b9\u8d5e\u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/707 \u4ece\u63a5\u53e3\u6587\u6863\u6765\u770b\uff0c\u70b9\u8d5e\u5b8c\u6210\u540e\u9700\u8981\u8fd4\u56de\u70b9\u8d5e\u6570\u3002 2.3.1\u3001\u7f16\u5199\u63a5\u53e3\u670d\u52a1 \u00b6 //com.tanhua.server.controller.QuanZiController /** * \u70b9\u8d5e * * @param publishId * @return */ @GetMapping ( \"/{id}/like\" ) public ResponseEntity < Long > likeComment ( @PathVariable ( \"id\" ) String publishId ) { try { Long likeCount = this . quanZiService . likeComment ( publishId ); if ( likeCount != null ) { return ResponseEntity . ok ( likeCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u53d6\u6d88\u70b9\u8d5e * * @param publishId * @return */ @GetMapping ( \"/{id}/dislike\" ) public ResponseEntity < Long > disLikeComment ( @PathVariable ( \"id\" ) String publishId ) { try { Long likeCount = this . quanZiService . disLikeComment ( publishId ); if ( null != likeCount ) { return ResponseEntity . ok ( likeCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 2.3.2\u3001\u7f16\u5199\u670d\u52a1\u5b9e\u73b0 \u00b6 //com.tanhua.server.service.QuanZiService public Long likeComment ( String publishId ) { User user = UserThreadLocal . get (); //\u70b9\u8d5e Boolean result = this . quanZiApi . likeComment ( user . getId (), publishId ); if ( result ){ //\u67e5\u8be2\u70b9\u8d5e\u6570 return this . quanZiApi . queryLikeCount ( publishId ); } return null ; } public Long disLikeComment ( String publishId ) { User user = UserThreadLocal . get (); //\u53d6\u6d88\u70b9\u8d5e Boolean result = this . quanZiApi . disLikeComment ( user . getId (), publishId ); if ( result ){ //\u67e5\u8be2\u70b9\u8d5e\u6570 return this . quanZiApi . queryLikeCount ( publishId ); } return null ; } 2.3.3\u3001\u4fee\u6539\u67e5\u8be2\u52a8\u6001\u70b9\u8d5e\u6570 \u00b6 \u67e5\u8be2\u70b9\u8d5e\u6570\u3001\u662f\u5426\u70b9\u8d5e\uff0c\u9700\u8981\u901a\u8fc7dubbo\u670d\u52a1\u8fdb\u884c\u67e5\u8be2\u3002 //com.tanhua.server.service.QuanZiService /** * \u586b\u5145\u7528\u6237\u4fe1\u606f * * @param userInfo * @param quanZiVo */ private void fillUserInfoToQuanZiVo ( UserInfo userInfo , QuanZiVo quanZiVo ) { BeanUtil . copyProperties ( userInfo , quanZiVo , \"id\" ); quanZiVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); quanZiVo . setTags ( StringUtils . split ( userInfo . getTags (), ',' )); //\u5f53\u524d\u7528\u6237 User user = UserThreadLocal . get (); quanZiVo . setCommentCount ( 0 ); //TODO \u8bc4\u8bba\u6570 quanZiVo . setDistance ( \"1.2\u516c\u91cc\" ); //TODO \u8ddd\u79bb quanZiVo . setHasLiked ( this . quanZiApi . queryUserIsLike ( user . getId (), quanZiVo . getId ()) ? 1 : 0 ); //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLikeCount ( Convert . toInt ( this . quanZiApi . queryLikeCount ( quanZiVo . getId ()))); //\u70b9\u8d5e\u6570 quanZiVo . setHasLoved ( 0 ); //TODO \u662f\u5426\u559c\u6b22\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLoveCount ( 0 ); //TODO \u559c\u6b22\u6570 } 2.3.4\u3001\u6d4b\u8bd5 \u00b6 \u4ece\u6d4b\u8bd5\u7ed3\u679c\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u5728\u54cd\u5e94\u7ed3\u679c\u4e2d\u8fd4\u56de\u4e86\u70b9\u8d5e\u6570\u4ee5\u53ca\u662f\u5426\u70b9\u8d5e\u7684\u6570\u636e\u3002 3\u3001\u559c\u6b22 \u00b6 \u559c\u6b22\u7684\u5b9e\u73b0\u4e0e\u70b9\u8d5e\u7c7b\u4f3c\uff0c\u53ea\u662f\u5176\u7c7b\u578b\u4e0d\u540c\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728\u63a8\u8350\u52a8\u6001\u4e2d\u624d\u6709\u559c\u6b22\u529f\u80fd\uff0c\u597d\u53cb\u52a8\u6001\u4e2d\u662f\u6ca1\u6709\u6b64\u529f\u80fd\u7684\u3002 3.1\u3001dubbo\u670d\u52a1 \u00b6 3.1.1\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 //com.tanhua.dubbo.server.api.QuanZiApi /** * \u559c\u6b22 * * @param userId * @param publishId * @return */ Boolean loveComment ( Long userId , String publishId ); /** * \u53d6\u6d88\u559c\u6b22 * * @param userId * @param publishId * @return */ Boolean disLoveComment ( Long userId , String publishId ); /** * \u67e5\u8be2\u559c\u6b22\u6570 * * @param publishId * @return */ Long queryLoveCount ( String publishId ); /** * \u67e5\u8be2\u7528\u6237\u662f\u5426\u559c\u6b22\u8be5\u52a8\u6001 * * @param userId * @param publishId * @return */ Boolean queryUserIsLove ( Long userId , String publishId ); 3.1.2\u3001\u7f16\u5199\u5b9e\u73b0 \u00b6 //com.tanhua.dubbo.server.api.QuanZiApiImpl @Override public Boolean loveComment ( Long userId , String publishId ) { //\u67e5\u8be2\u8be5\u7528\u6237\u662f\u5426\u5df2\u7ecf\u559c\u6b22 if ( this . queryUserIsLove ( userId , publishId )) { return false ; } //\u559c\u6b22 boolean result = this . saveComment ( userId , publishId , CommentType . LOVE , null ); if ( ! result ) { return false ; } //\u559c\u6b22\u6210\u529f\u540e\uff0c\u4fee\u6539Redis\u4e2d\u7684\u603b\u7684\u559c\u6b22\u6570 String redisKey = this . getCommentRedisKeyPrefix ( publishId ); String hashKey = CommentType . LOVE . toString (); this . redisTemplate . opsForHash (). increment ( redisKey , hashKey , 1 ); //\u6807\u8bb0\u7528\u6237\u5df2\u7ecf\u559c\u6b22 hashKey = this . getCommentUserLoveRedisKey ( userId ); this . redisTemplate . opsForHash (). put ( redisKey , hashKey , \"1\" ); return true ; } private String getCommentUserLoveRedisKey ( Long userId ) { return COMMENT_USER_LOVE_REDIS_KEY_PREFIX + userId ; } @Override public Boolean disLoveComment ( Long userId , String publishId ) { if ( ! this . queryUserIsLove ( userId , publishId )) { //\u5982\u679c\u7528\u6237\u6ca1\u6709\u559c\u6b22\uff0c\u5c31\u76f4\u63a5\u8fd4\u56de return false ; } boolean result = this . removeComment ( userId , publishId , CommentType . LOVE ); if ( ! result ) { //\u5220\u9664\u5931\u8d25 return false ; } //\u5220\u9664redis\u4e2d\u7684\u8bb0\u5f55 String redisKey = this . getCommentRedisKeyPrefix ( publishId ); String hashKey = this . getCommentUserLoveRedisKey ( userId ); this . redisTemplate . opsForHash (). delete ( redisKey , hashKey ); this . redisTemplate . opsForHash (). increment ( redisKey , CommentType . LOVE . toString (), - 1 ); return true ; } @Override public Long queryLoveCount ( String publishId ) { //\u9996\u5148\u4eceredis\u4e2d\u547d\u4e2d\uff0c\u5982\u679c\u547d\u4e2d\u7684\u8bdd\u5c31\u8fd4\u56de\uff0c\u6ca1\u6709\u547d\u4e2d\u5c31\u67e5\u8be2Mongodb String redisKey = this . getCommentRedisKeyPrefix ( publishId ); String hashKey = CommentType . LOVE . toString (); Object value = this . redisTemplate . opsForHash (). get ( redisKey , hashKey ); if ( ObjectUtil . isNotEmpty ( value )) { return Convert . toLong ( value ); } //\u67e5\u8be2count Long count = this . queryCommentCount ( publishId , CommentType . LOVE ); //\u5b58\u50a8\u5230redis\u4e2d this . redisTemplate . opsForHash (). put ( redisKey , hashKey , String . valueOf ( count )); return count ; } @Override public Boolean queryUserIsLove ( Long userId , String publishId ) { String redisKey = this . getCommentRedisKeyPrefix ( publishId ); String hashKey = this . getCommentUserLoveRedisKey ( userId ); Object value = this . redisTemplate . opsForHash (). get ( redisKey , hashKey ); if ( ObjectUtil . isNotEmpty ( value )) { return StrUtil . equals ( Convert . toStr ( value ), \"1\" ); } //\u67e5\u8be2mongodb Query query = Query . query ( Criteria . where ( \"publishId\" ) . is ( new ObjectId ( publishId )) . and ( \"userId\" ). is ( userId ) . and ( \"commentType\" ). is ( CommentType . LOVE . getType ())); long count = this . mongoTemplate . count ( query , Comment . class ); if ( count == 0 ) { return false ; } //\u6807\u8bb0\u7528\u6237\u5df2\u7ecf\u559c\u6b22 this . redisTemplate . opsForHash (). put ( redisKey , hashKey , \"1\" ); return true ; } 3.2\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 3.2.1\u3001\u7f16\u5199\u63a5\u53e3\u670d\u52a1 \u00b6 //com.tanhua.server.controller.QuanZiController /** * \u559c\u6b22 * * @param publishId * @return */ @GetMapping ( \"/{id}/love\" ) public ResponseEntity < Long > loveComment ( @PathVariable ( \"id\" ) String publishId ) { try { Long loveCount = this . quanZiService . loveComment ( publishId ); if ( null != loveCount ) { return ResponseEntity . ok ( loveCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u53d6\u6d88\u559c\u6b22 * * @param publishId * @return */ @GetMapping ( \"/{id}/unlove\" ) public ResponseEntity < Long > disLoveComment ( @PathVariable ( \"id\" ) String publishId ) { try { Long loveCount = this . quanZiService . disLoveComment ( publishId ); if ( null != loveCount ) { return ResponseEntity . ok ( loveCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 3.2.2\u3001\u7f16\u5199\u670d\u52a1\u5b9e\u73b0 \u00b6 //com.tanhua.server.service.QuanZiService public Long loveComment ( String publishId ) { User user = UserThreadLocal . get (); //\u559c\u6b22 Boolean result = this . quanZiApi . loveComment ( user . getId (), publishId ); if ( result ){ //\u67e5\u8be2\u559c\u6b22\u6570 return this . quanZiApi . queryLoveCount ( publishId ); } return null ; } public Long disLoveComment ( String publishId ) { User user = UserThreadLocal . get (); //\u53d6\u6d88\u559c\u6b22 Boolean result = this . quanZiApi . disLoveComment ( user . getId (), publishId ); if ( result ){ //\u67e5\u8be2\u559c\u6b22\u6570 return this . quanZiApi . queryLoveCount ( publishId ); } return null ; } /** * \u586b\u5145\u7528\u6237\u4fe1\u606f * * @param userInfo * @param quanZiVo */ private void fillUserInfoToQuanZiVo ( UserInfo userInfo , QuanZiVo quanZiVo ) { BeanUtil . copyProperties ( userInfo , quanZiVo , \"id\" ); quanZiVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); quanZiVo . setTags ( StringUtils . split ( userInfo . getTags (), ',' )); //\u5f53\u524d\u7528\u6237 User user = UserThreadLocal . get (); quanZiVo . setCommentCount ( 0 ); //TODO \u8bc4\u8bba\u6570 quanZiVo . setDistance ( \"1.2\u516c\u91cc\" ); //TODO \u8ddd\u79bb quanZiVo . setHasLiked ( this . quanZiApi . queryUserIsLike ( user . getId (), quanZiVo . getId ()) ? 1 : 0 ); //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLikeCount ( Convert . toInt ( this . quanZiApi . queryLikeCount ( quanZiVo . getId ()))); //\u70b9\u8d5e\u6570 quanZiVo . setHasLoved ( this . quanZiApi . queryUserIsLove ( user . getId (), quanZiVo . getId ()) ? 1 : 0 ); //\u662f\u5426\u559c\u6b22\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLoveCount ( Convert . toInt ( this . quanZiApi . queryLoveCount ( quanZiVo . getId ()))); //\u559c\u6b22\u6570 } 1.2.3\u3001\u6d4b\u8bd5 \u00b6 4\u3001\u67e5\u8be2\u5355\u6761\u52a8\u6001 \u00b6 \u7528\u6237\u70b9\u51fb\u8bc4\u8bba\u65f6\u9700\u8981\u67e5\u8be2\u5355\u6761\u52a8\u6001\u8be6\u60c5\uff0c\u9700\u8981\u6709\u63a5\u53e3\u652f\u6301\u3002 \u670d\u52a1\u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/695 \u54cd\u5e94\u7684\u6570\u636e\u63a5\u53e3\u4e0e\u67e5\u8be2\u597d\u53cb\u52a8\u6001\u4e00\u81f4\uff0c\u53ea\u662f\u5355\u6761\u8fd4\u56de\u800c\u4e0d\u662f\u96c6\u5408\u3002 \u8981\u6ce8\u610f\u7684\u662f\uff0cdubbo\u670d\u52a1\u63a5\u53e3\u5728\u524d\u9762\u5df2\u7ecf\u5f00\u53d1\u5b8c\u6210\uff0c\u73b0\u5728\u53ea\u8981\u60f3\u5b9e\u73b0APP\u7aef\u7684\u63a5\u53e3\u670d\u52a1\u5373\u53ef\u3002 4.1\u3001\u5b9a\u4e49\u670d\u52a1\u63a5\u53e3 \u00b6 //com.tanhua.server.controller.QuanZiController /** * \u67e5\u8be2\u5355\u6761\u52a8\u6001\u4fe1\u606f * * @param publishId * @return */ @GetMapping ( \"/{id}\" ) public ResponseEntity < QuanZiVo > queryById ( @PathVariable ( \"id\" ) String publishId ) { try { QuanZiVo movements = this . quanZiService . queryById ( publishId ); if ( null != movements ){ return ResponseEntity . ok ( movements ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 4.2\u3001\u670d\u52a1\u5b9e\u73b0 \u00b6 //com.tanhua.server.service.QuanZiService public QuanZiVo queryById ( String publishId ) { Publish publish = this . quanZiApi . queryPublishById ( publishId ); if ( publish == null ) { return null ; } return this . fillQuanZiVo ( Arrays . asList ( publish )). get ( 0 ); } 4.3\u3001\u6d4b\u8bd5 \u00b6 \u53ef\u4ee5\u770b\u5230\uff0c\u8fd4\u56de\u4e86\u5355\u6761\u6570\u636e\u3002 4.4\u3001\u5f02\u5e38\u7684\u89e3\u51b3 \u00b6 \u5728\u5b8c\u6210\u67e5\u8be2\u5355\u6761\u52a8\u6001\u63a5\u53e3\u540e\uff0c\u4f1a\u53d1\u73b0\uff0c\u5237\u65b0\u9996\u9875\u65f6\u4f1a\u51fa\u73b0\u5982\u4e0b\u5f02\u5e38\uff1a java.lang.IllegalArgumentException: invalid hexadecimal representation of an ObjectId: [ visitors ] at org.bson.types.ObjectId.parseHexString ( ObjectId.java:550 ) at org.bson.types.ObjectId.<init> ( ObjectId.java:239 ) at com.tanhua.dubbo.server.api.QuanZiApiImpl.queryPublishById ( QuanZiApiImpl.java:411 ) at com.alibaba.dubbo.common.bytecode.Wrapper1.invokeMethod ( Wrapper1.java ) at com.alibaba.dubbo.rpc.proxy.javassist.JavassistProxyFactory $1 .doInvoke ( JavassistProxyFactory.java:47 ) at com.alibaba.dubbo.rpc.proxy.AbstractProxyInvoker.invoke ( AbstractProxyInvoker.java:76 ) at com.alibaba.dubbo.config.invoker.DelegateProviderMetaDataInvoker.invoke ( DelegateProviderMetaDataInvoker.java:52 ) at com.alibaba.dubbo.rpc.protocol.InvokerWrapper.invoke ( InvokerWrapper.java:56 ) \u539f\u56e0\u662f\uff1a\u8c01\u770b\u8fc7\u6211\u7684\u63a5\u53e3\u8fd8\u6ca1\u5b9e\u73b0\uff0c\u5bfc\u81f4\u4e86\u6620\u5c04\u5230\u4e86\u67e5\u8be2\u5355\u6761\u52a8\u6001\u7684\u63a5\u53e3\uff0c\u5bfc\u81f4\u7684\u5f02\u5e38\uff0c\u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/743 \u89e3\u51b3\u65b9\u6cd5\uff1a\u7f16\u5199\u4e00\u4e2a\u7a7a\u7684\u65b9\u6cd5\u300a\u8c01\u770b\u8fc7\u6211\u300b\u7684\u63a5\u53e3\u5b9e\u73b0\u3002 //com.tanhua.server.controller.QuanZiController /** * TODO\uff1a\u8c01\u770b\u8fc7\u6211 * * @return */ @GetMapping ( \"visitors\" ) public ResponseEntity < Object > queryVisitors () { return ResponseEntity . ok ( Collections . EMPTY_LIST ); } 5\u3001\u8bc4\u8bba \u00b6 \u5728\u5355\u6761\u52a8\u6001\u6253\u5f00\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u6709\u8bc4\u8bba\u5217\u8868\uff0c\u529f\u80fd\u5305\u62ec\uff1a\u67e5\u8be2\u8bc4\u8bba\u5217\u8868\uff0c\u8bc4\u8bba\u70b9\u8d5e\u3001\u53d6\u6d88\u70b9\u8d5e\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8bc4\u8bba\u7684\u70b9\u8d5e\u64cd\u4f5c\u4e0e\u5708\u5b50\u52a8\u6001\u7684\u70b9\u8d5e\u4f7f\u7528\u540c\u4e00\u5957\u903b\u8f91\u3002 5.1\u3001dubbo\u670d\u52a1 \u00b6 5.1.1\u3001\u5b9a\u4e49\u670d\u52a1\u63a5\u53e3 \u00b6 //com.tanhua.dubbo.server.api.QuanZiApi /** * \u67e5\u8be2\u8bc4\u8bba * * @return */ PageInfo < Comment > queryCommentList ( String publishId , Integer page , Integer pageSize ); /** * \u53d1\u8868\u8bc4\u8bba * * @param userId * @param publishId * @param content * @return */ Boolean saveComment ( Long userId , String publishId , String content ); 5.1.2\u3001\u7f16\u5199\u5b9e\u73b0 \u00b6 /** * \u67e5\u8be2\u8bc4\u8bba\u5217\u8868 * * @param publishId * @param page * @param pageSize * @return */ @Override public PageInfo < Comment > queryCommentList ( String publishId , Integer page , Integer pageSize ) { PageRequest pageRequest = PageRequest . of ( page - 1 , pageSize , Sort . by ( Sort . Order . asc ( \"created\" ))); Query query = new Query ( Criteria . where ( \"publishId\" ). is ( new ObjectId ( publishId )) . and ( \"commentType\" ). is ( CommentType . COMMENT . getType ())). with ( pageRequest ); //\u67e5\u8be2\u8bc4\u8bba\u5217\u8868 List < Comment > commentList = this . mongoTemplate . find ( query , Comment . class ); PageInfo < Comment > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); pageInfo . setRecords ( commentList ); return pageInfo ; } /** * \u53d1\u8868\u8bc4\u8bba * * @param userId * @param publishId * @param content * @return */ @Override public Boolean saveComment ( Long userId , String publishId , String content ) { return this . saveComment ( userId , publishId , CommentType . COMMENT , content ); } 5.2\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 5.2.1\u3001CommentVo \u00b6 \u6839\u636e\u54cd\u5e94\u7ed3\u679c\u7684\u6570\u636e\u7ed3\u6784\u5b9a\u4e49\u5bf9\u8c61\uff1a package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; /** * \u8bc4\u8bba */ @Data @NoArgsConstructor @AllArgsConstructor public class CommentVo { private String id ; //\u8bc4\u8bbaid private String avatar ; //\u5934\u50cf private String nickname ; //\u6635\u79f0 private String content ; //\u8bc4\u8bba private String createDate ; //\u8bc4\u8bba\u65f6\u95f4: 08:27 private Integer likeCount ; //\u70b9\u8d5e\u6570 private Integer hasLiked ; //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 } 5.2.2\u3001\u7f16\u5199Controller \u00b6 \u5728APP\u63a5\u53e3\u670d\u52a1\u4e2d\uff0c\u9700\u8981\u5f00\u53d14\u4e2a\u63a5\u53e3\uff0c\u5206\u522b\u662f\u67e5\u8be2\u8bc4\u8bba\u5217\u8868\u3001\u53d1\u8868\u8bc4\u8bba\u3001\u70b9\u8d5e\u3001\u53d6\u6d88\u70b9\u8d5e\u3002 \u7531\u4e8e\u5176\u63a5\u53e3\u7684url\u5730\u5740\u4e0eQuanZiConroller\u5730\u5740\u4e0d\u540c\uff0c\u6240\u4ee5\u9700\u8981\u521b\u5efa\u4e0d\u540c\u7684Controller\u7c7b\u3002 package com.tanhua.server.controller ; import com.tanhua.server.service.QuanZiService ; import com.tanhua.server.vo.PageResult ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.* ; import java.util.Map ; /** * \u5708\u5b50\u529f\u80fd\u4e2d\u7684\u8bc4\u8bba */ @RestController @RequestMapping ( \"comments\" ) public class QuanZiCommentController { @Autowired private QuanZiService quanZiService ; /** * \u67e5\u8be2\u8bc4\u8bba\u5217\u8868 * * @return */ @GetMapping public ResponseEntity < PageResult > queryCommentsList ( @RequestParam ( \"movementId\" ) String publishId , @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize ) { try { PageResult pageResult = this . quanZiService . queryCommentList ( publishId , page , pageSize ); return ResponseEntity . ok ( pageResult ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u4fdd\u5b58\u8bc4\u8bba */ @PostMapping public ResponseEntity < Void > saveComments ( @RequestBody Map < String , String > param ) { try { String publishId = param . get ( \"movementId\" ); String content = param . get ( \"comment\" ); Boolean result = this . quanZiService . saveComments ( publishId , content ); if ( result ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u70b9\u8d5e * * @param publishId * @return */ @GetMapping ( \"{id}/like\" ) public ResponseEntity < Long > likeComment ( @PathVariable ( \"id\" ) String publishId ) { try { Long likeCount = this . quanZiService . likeComment ( publishId ); if ( likeCount != null ) { return ResponseEntity . ok ( likeCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u53d6\u6d88\u70b9\u8d5e * * @param publishId * @return */ @GetMapping ( \"{id}/dislike\" ) public ResponseEntity < Long > disLikeComment ( @PathVariable ( \"id\" ) String publishId ) { try { Long likeCount = this . quanZiService . disLikeComment ( publishId ); if ( null != likeCount ) { return ResponseEntity . ok ( likeCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } } 5.2.3\u3001\u7f16\u5199Service\u5b9e\u73b0 \u00b6 Service\u7684\u5177\u4f53\u5b9e\u73b0\u4f9d\u7136\u662f\u653e\u5230QuanZiSerivce\u4e2d\u5b8c\u6210\u3002 //com.tanhua.server.service.QuanZiService /** * \u67e5\u8be2\u8bc4\u8bba\u5217\u8868 * * @param publishId * @param page * @param pageSize * @return */ public PageResult queryCommentList ( String publishId , Integer page , Integer pageSize ) { PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); User user = UserThreadLocal . get (); //\u67e5\u8be2\u8bc4\u8bba\u5217\u8868\u6570\u636e PageInfo < Comment > pageInfo = this . quanZiApi . queryCommentList ( publishId , page , pageSize ); List < Comment > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )){ return pageResult ; } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIdList = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIdList ); List < CommentVo > result = new ArrayList <> (); for ( Comment record : records ) { CommentVo commentVo = new CommentVo (); commentVo . setContent ( record . getContent ()); commentVo . setId ( record . getId (). toHexString ()); commentVo . setCreateDate ( DateUtil . format ( new Date ( record . getCreated ()), \"HH:mm\" )); //\u662f\u5426\u70b9\u8d5e commentVo . setHasLiked ( this . quanZiApi . queryUserIsLike ( user . getId (), commentVo . getId ()) ? 1 : 0 ); //\u70b9\u8d5e\u6570 commentVo . setLikeCount ( Convert . toInt ( this . quanZiApi . queryLikeCount ( commentVo . getId ()))); for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( record . getUserId (), userInfo . getUserId ())){ commentVo . setAvatar ( userInfo . getLogo ()); commentVo . setNickname ( userInfo . getNickName ()); break ; } } result . add ( commentVo ); } pageResult . setItems ( result ); return pageResult ; } /** * \u53d1\u8868\u8bc4\u8bba * @param publishId * @param content * @return */ public Boolean saveComments ( String publishId , String content ) { User user = UserThreadLocal . get (); return this . quanZiApi . saveComment ( user . getId (), publishId , content ); } 5.2.4\u3001\u6d4b\u8bd5 \u00b6 \u6d4b\u8bd5\u70b9\u8d5e\u65f6\u4f1a\u53d1\u73b0dubbo\u670d\u52a1\u4e2d\u4f1a\u51fa\u73b0null\u6307\u9488\u5f02\u5e38\uff0c\u5982\u4e0b\uff1a java.lang.NullPointerException at com.tanhua.dubbo.server.api.QuanZiApiImpl.saveComment ( QuanZiApiImpl.java:386 ) at com.tanhua.dubbo.server.api.QuanZiApiImpl.likeComment ( QuanZiApiImpl.java:180 ) at com.alibaba.dubbo.common.bytecode.Wrapper1.invokeMethod ( Wrapper1.java ) at com.alibaba.dubbo.rpc.proxy.javassist.JavassistProxyFactory $1 .doInvoke ( JavassistProxyFactory.java:47 ) at com.alibaba.dubbo.rpc.proxy.AbstractProxyInvoker.invoke ( AbstractProxyInvoker.java:76 ) at com.alibaba.dubbo.config.invoker.DelegateProviderMetaDataInvoker.invoke ( DelegateProviderMetaDataInvoker.java:52 ) at com.alibaba.dubbo.rpc.protocol.InvokerWrapper.invoke ( InvokerWrapper.java:56 ) \u539f\u56e0\u662f\uff1a\u539f\u6709\u7684\u70b9\u8d5e\u5b9e\u73b0\u4e2d\uff0c\u9700\u8981\u67e5\u8be2Publish\u5bf9\u8c61\uff0c\u4f46\u662f\u73b0\u5728\u5b9e\u73b0\u7684\u662f\u9488\u5bf9\u8bc4\u8bba\u7684\u70b9\u8d5e\uff0c\u662f\u67e5\u8be2\u4e0d\u5230Publish\u5bf9\u8c61\u7684\uff0c\u6240\u4ee5\u629b\u51fa\u4e86\u7a7a\u6307\u9488\u5f02\u5e38\u3002 \u89e3\u51b3\u5982\u4e0b\uff1a //com.tanhua.dubbo.server.api.QuanZiApiImpl /** * \u4fdd\u5b58Comment * * @return */ private Boolean saveComment ( Long userId , String publishId , CommentType commentType , String content ) { try { Comment comment = new Comment (); comment . setId ( ObjectId . get ()); comment . setUserId ( userId ); comment . setPublishId ( new ObjectId ( publishId )); // \u8bc4\u8bba\u7c7b\u578b comment . setCommentType ( commentType . getType ()); // \u5185\u5bb9 comment . setContent ( content ); comment . setCreated ( System . currentTimeMillis ()); Publish publish = this . queryPublishById ( publishId ); if ( ObjectUtil . isNotEmpty ( publish )) { comment . setPublishUserId ( publish . getUserId ()); } else { //\u67e5\u8be2\u8bc4\u8bba Comment myComment = this . queryCommentById ( publishId ); if ( ObjectUtil . isNotEmpty ( myComment )){ comment . setPublishUserId ( myComment . getUserId ()); } else { //TODO \u5176\u4ed6\u60c5\u51b5\uff0c\u6bd4\u5982\u5c0f\u89c6\u9891\u7b49 } } this . mongoTemplate . save ( comment ); return true ; } catch ( Exception e ) { log . error ( \"\u4fdd\u5b58Comment\u51fa\u9519~ userId = \" + userId + \", publishId = \" + publishId + \", commentType = \" + commentType , e ); } return false ; } /** * \u6839\u636eid\u67e5\u8be2Comment\u5bf9\u8c61 * * @param id * @return */ private Comment queryCommentById ( String id ) { return this . mongoTemplate . findById ( new ObjectId ( id ), Comment . class ); } \u8fd9\u6837\uff0c\u70b9\u8d5e\u529f\u80fd\u6b63\u5e38\u4e86\u3002 6\u3001\u5c0f\u89c6\u9891 \u00b6 6.1\u3001\u529f\u80fd\u8bf4\u660e \u00b6 \u5c0f\u89c6\u9891\u529f\u80fd\u7c7b\u4f3c\u4e8e\u6296\u97f3\u3001\u5feb\u624b\u5c0f\u89c6\u9891\u7684\u5e94\u7528\uff0c\u7528\u6237\u53ef\u4ee5\u4e0a\u4f20\u5c0f\u89c6\u9891\u8fdb\u884c\u5206\u4eab\uff0c\u4e5f\u53ef\u4ee5\u6d4f\u89c8\u67e5\u770b\u522b\u4eba\u5206\u4eab\u7684\u89c6\u9891\uff0c\u5e76\u4e14\u53ef\u4ee5\u5bf9\u89c6\u9891\u8bc4\u8bba\u548c\u70b9\u8d5e\u64cd\u4f5c\u3002 \u6548\u679c\uff1a \u67e5\u770b\u8be6\u60c5\uff1a \u8bc4\u8bba\uff1a \u70b9\u8d5e\uff1a 6.2\u3001\u6280\u672f\u65b9\u6848 \u00b6 \u5bf9\u4e8e\u5c0f\u89c6\u9891\u7684\u529f\u80fd\u7684\u5f00\u53d1\uff0c\u6838\u5fc3\u70b9\u5c31\u662f\uff1a\u5b58\u50a8 + \u63a8\u8350 + \u52a0\u8f7d\u901f\u5ea6 \u3002 \u5bf9\u4e8e\u5b58\u50a8\u800c\u8a00\uff0c\u5c0f\u89c6\u9891\u7684\u5b58\u50a8\u91cf\u4ee5\u53ca\u5bb9\u91cf\u90fd\u662f\u975e\u5e38\u5de8\u5927\u7684\u3002 \u6240\u4ee5\u6211\u4eec\u9009\u62e9\u81ea\u5df1\u642d\u5efa\u5206\u5e03\u5f0f\u5b58\u50a8\u7cfb\u7edf FastDFS\u8fdb\u884c\u5b58\u50a8\u3002 \u5bf9\u4e8e\u63a8\u8350\u7b97\u6cd5\uff0c\u6211\u4eec\u5c06\u91c7\u7528\u591a\u79cd\u6743\u91cd\u7684\u8ba1\u7b97\u65b9\u5f0f\u8fdb\u884c\u8ba1\u7b97\u3002 \u5bf9\u4e8e\u52a0\u8f7d\u901f\u5ea6\uff0c\u9664\u4e86\u63d0\u5347\u670d\u52a1\u5668\u5e26\u5bbd\u5916\u53ef\u4ee5\u901a\u8fc7CDN\u7684\u65b9\u5f0f\u8fdb\u884c\u52a0\u901f\uff0c\u5f53\u7136\u4e86\u8fd9\u9700\u8981\u989d\u5916\u8d2d\u4e70CDN\u670d\u52a1\u3002 7\u3001FastDFS \u00b6 7.1\u3001FastDFS\u662f\u4ec0\u4e48\uff1f \u00b6 FastDFS\u662f\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u3002\u4f7f\u7528 FastDFS\u5f88\u5bb9\u6613\u642d\u5efa\u4e00\u5957\u9ad8\u6027\u80fd\u7684\u6587\u4ef6\u670d\u52a1\u5668\u96c6\u7fa4\u63d0\u4f9b\u6587\u4ef6\u4e0a\u4f20\u3001\u4e0b\u8f7d\u7b49\u670d\u52a1\u3002 7.2\u3001\u5de5\u4f5c\u539f\u7406 \u00b6 FastDFS \u67b6\u6784\u5305\u62ec Tracker server \u548c Storage server\u3002\u5ba2\u6237\u7aef\u8bf7\u6c42 Tracker server \u8fdb\u884c\u6587\u4ef6\u4e0a\u4f20\u3001\u4e0b\u8f7d\uff0c\u901a\u8fc7 Tracker server \u8c03\u5ea6\u6700\u7ec8\u7531 Storage server \u5b8c\u6210\u6587\u4ef6\u4e0a\u4f20\u548c\u4e0b\u8f7d\u3002 Tracker server \u4f5c\u7528\u662f\u8d1f\u8f7d\u5747\u8861\u548c\u8c03\u5ea6\uff0c\u901a\u8fc7 Tracker server \u5728\u6587\u4ef6\u4e0a\u4f20\u65f6\u53ef\u4ee5\u6839\u636e\u4e00\u4e9b\u7b56\u7565\u627e\u5230 Storage server \u63d0\u4f9b\u6587\u4ef6\u4e0a\u4f20\u670d\u52a1\u3002\u53ef\u4ee5\u5c06 tracker \u79f0\u4e3a\u8ffd\u8e2a\u670d\u52a1\u5668\u6216\u8c03\u5ea6\u670d\u52a1\u5668\u3002 Storage server \u4f5c\u7528\u662f\u6587\u4ef6\u5b58\u50a8\uff0c\u5ba2\u6237\u7aef\u4e0a\u4f20\u7684\u6587\u4ef6\u6700\u7ec8\u5b58\u50a8\u5728 Storage \u670d\u52a1\u5668\u4e0a\uff0cStorage server \u6ca1\u6709\u5b9e\u73b0\u81ea\u5df1\u7684\u6587\u4ef6\u7cfb\u7edf\u800c\u662f\u5229\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u7cfb\u7edf\u6765\u7ba1\u7406\u6587\u4ef6\u3002\u53ef\u4ee5\u5c06storage\u79f0\u4e3a\u5b58\u50a8\u670d\u52a1\u5668\u3002 \u6bcf\u4e2a tracker \u8282\u70b9\u5730\u4f4d\u5e73\u7b49\uff0c\u6536\u96c6 Storage \u96c6\u7fa4\u7684\u72b6\u6001\u3002 Storage \u5206\u4e3a\u591a\u4e2a\u7ec4\uff0c\u6bcf\u4e2a\u7ec4\u4e4b\u95f4\u4fdd\u5b58\u7684\u6587\u4ef6\u662f\u4e0d\u540c\u7684\u3002\u6bcf\u4e2a\u7ec4\u5185\u90e8\u53ef\u4ee5\u6709\u591a\u4e2a\u6210\u5458\uff0c\u7ec4\u6210\u5458\u5185\u90e8\u4fdd\u5b58\u7684\u5185\u5bb9\u662f\u4e00\u6837\u7684\uff0c\u7ec4\u6210\u5458\u7684\u5730\u4f4d\u662f\u4e00\u81f4\u7684\uff0c\u6ca1\u6709\u4e3b\u4ece\u7684\u6982\u5ff5\u3002 7.3\u3001\u6587\u4ef6\u7684\u4e0a\u4f20 \u00b6 \u5ba2\u6237\u7aef\u4e0a\u4f20\u6587\u4ef6\u540e\u5b58\u50a8\u670d\u52a1\u5668\u5c06\u6587\u4ef6 ID \u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u6b64\u6587\u4ef6 ID \u7528\u4e8e\u4ee5\u540e\u8bbf\u95ee\u8be5\u6587\u4ef6\u7684\u7d22\u5f15\u4fe1\u606f\u3002\u6587\u4ef6\u7d22\u5f15\u4fe1\u606f\u5305\u62ec\uff1a\u7ec4\u540d\uff0c\u865a\u62df\u78c1\u76d8\u8def\u5f84\uff0c\u6570\u636e\u4e24\u7ea7\u76ee\u5f55\uff0c\u6587\u4ef6\u540d\u3002 7.4\u3001\u6587\u4ef6\u7684\u4e0b\u8f7d \u00b6 \u5ba2\u6237\u7aef\u4e0b\u8f7d\u8bf7\u6c42\u5230Tracker\u670d\u52a1\uff0cTracker\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aefstorage\u7684\u4fe1\u606f\uff0c\u5ba2\u6237\u7aef\u6839\u636e\u8fd9\u4e9b\u4fe1\u606f\u8fdb\u884c\u8bf7\u6c42storage\u83b7\u53d6\u5230\u6587\u4ef6\u3002 7.5\u3001\u5f00\u59cb\u4f7f\u7528 \u00b6 \u5728\u6211\u4eec\u63d0\u4f9b\u7684\u865a\u62df\u673a\u4e2d\u5df2\u7ecf\u901a\u8fc7docker\u642d\u5efa\u4e86FastDFS\u73af\u5883\uff0c\u4e0b\u9762\u6211\u4eec\u6765\u5b66\u4e60\u4e0b\u5982\u4f55\u901a\u8fc7Java\u7a0b\u5e8f\u6765\u4f7f\u7528FastDFS\u3002 7.5.1\u3001\u5f15\u5165\u4f9d\u8d56 \u00b6 \u5173\u4e8e\u4f7f\u7528FastDFS\u4e0a\u4f20\u5c0f\u89c6\u9891\u7684\u903b\u8f91\u6211\u4eec\u5728server\u5de5\u7a0b\u4e2d\u5b8c\u6210\uff0c\u6240\u4ee5\u9700\u8981\u5728server\u5de5\u7a0b\u4e2d\u5f15\u5165\u4f9d\u8d56\u3002 <dependency> <groupId> com.github.tobato </groupId> <artifactId> fastdfs-client </artifactId> <version> 1.26.7 </version> <exclusions> <exclusion> <groupId> ch.qos.logback </groupId> <artifactId> logback-classic </artifactId> </exclusion> </exclusions> </dependency> 7.5.2\u3001\u7f16\u5199\u914d\u7f6e\u6587\u4ef6 \u00b6 \u5728application.properties\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\u5165\u5982\u4e0b\u5185\u5bb9\uff1a # =================================================================== # \u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edfFDFS\u914d\u7f6e # =================================================================== fdfs.so-timeout = 1501 fdfs.connect-timeout = 601 #\u7f29\u7565\u56fe\u751f\u6210\u53c2\u6570 fdfs.thumb-image.width = 150 fdfs.thumb-image.height = 150 #TrackerList\u53c2\u6570,\u652f\u6301\u591a\u4e2a fdfs.tracker-list = 192.168.31.81:22122 #\u8bbf\u95ee\u8def\u5f84 fdfs.web-server-url = http://192.168.31.81:8888/ 7.5.3\u3001\u6d4b\u8bd5\u4ee3\u7801 \u00b6 package com.tanhua.server ; import com.github.tobato.fastdfs.domain.conn.FdfsWebServer ; import com.github.tobato.fastdfs.domain.fdfs.StorePath ; import com.github.tobato.fastdfs.service.FastFileStorageClient ; import org.apache.commons.io.FileUtils ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; import java.io.File ; import java.io.IOException ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestFastDFS { @Autowired protected FastFileStorageClient storageClient ; @Autowired private FdfsWebServer fdfsWebServer ; @Test public void testUpload (){ String path = \"F:\\\\1.jpg\" ; File file = new File ( path ); try { StorePath storePath = this . storageClient . uploadFile ( FileUtils . openInputStream ( file ), file . length (), \"jpg\" , null ); System . out . println ( storePath ); //StorePath [group=group1, path=M00/00/00/wKgfUV2GJSuAOUd_AAHnjh7KpOc1.1.jpg] System . out . println ( fdfsWebServer . getWebServerUrl () + storePath . getFullPath ()); //group1/M00/00/00/wKgfUV2GJSuAOUd_AAHnjh7KpOc1.1.jpg } catch ( IOException e ) { e . printStackTrace (); } } } \u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95ee\u56fe\u7247\uff1a 8\u3001\u53d1\u5e03\u5c0f\u89c6\u9891 \u00b6 \u53d1\u5e03\u5c0f\u89c6\u9891\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a \u8bf4\u660e\uff1a \u7528\u6237\u53d1\u901a\u8fc7\u5ba2\u6237\u7aefAPP\u4e0a\u4f20\u89c6\u9891\u5230server\u670d\u52a1 server\u670d\u52a1\u4e0a\u4f20\u89c6\u9891\u5230FastDFS\u6587\u4ef6\u7cfb\u7edf\uff0c\u4e0a\u4f20\u6210\u529f\u540e\u8fd4\u56de\u89c6\u9891\u7684url\u5730\u5740 server\u901a\u8fc7rpc\u7684\u8c03\u7528dubbo\u670d\u52a1\u8fdb\u884c\u4fdd\u5b58\u5c0f\u89c6\u9891\u6570\u636e 8.1\u3001dubbo\u670d\u52a1 \u00b6 8.1.1\u3001\u7f16\u5199pojo \u00b6 \u5728dubbo\u63a5\u53e3\u5de5\u7a0b\u4e2d\u7f16\u5199pojo\uff1a package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.mongodb.core.mapping.Document ; import java.util.List ; @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"video\" ) public class Video implements java . io . Serializable { private static final long serialVersionUID = - 3136732836884933873L ; private ObjectId id ; //\u4e3b\u952eid private Long vid ; //\u81ea\u589e\u957fid private Long userId ; private String text ; //\u6587\u5b57 private String picUrl ; //\u89c6\u9891\u5c01\u9762\u6587\u4ef6 private String videoUrl ; //\u89c6\u9891\u6587\u4ef6 private Long created ; //\u521b\u5efa\u65f6\u95f4 private Integer seeType ; // \u8c01\u53ef\u4ee5\u770b\uff0c1-\u516c\u5f00\uff0c2-\u79c1\u5bc6\uff0c3-\u90e8\u5206\u53ef\u89c1\uff0c4-\u4e0d\u7ed9\u8c01\u770b private List < Long > seeList ; //\u90e8\u5206\u53ef\u89c1\u7684\u5217\u8868 private List < Long > notSeeList ; //\u4e0d\u7ed9\u8c01\u770b\u7684\u5217\u8868 private String longitude ; //\u7ecf\u5ea6 private String latitude ; //\u7eac\u5ea6 private String locationName ; //\u4f4d\u7f6e\u540d\u79f0 } 8.1.2\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.pojo.Video ; public interface VideoApi { /** * \u4fdd\u5b58\u5c0f\u89c6\u9891 * * @param video * @return \u4fdd\u5b58\u6210\u529f\u540e\uff0c\u8fd4\u56de\u89c6\u9891id */ String saveVideo ( Video video ); } 8.1.3\u3001\u7f16\u5199\u5b9e\u73b0 \u00b6 package com.tanhua.dubbo.server.api ; import cn.hutool.core.util.ObjectUtil ; import com.alibaba.dubbo.config.annotation.Service ; import com.mongodb.Mongo ; import com.tanhua.dubbo.server.enums.IdType ; import com.tanhua.dubbo.server.pojo.Video ; import com.tanhua.dubbo.server.service.IdService ; import lombok.extern.slf4j.Slf4j ; import org.bson.types.ObjectId ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.mongodb.core.MongoTemplate ; @Service ( version = \"1.0.0\" ) @Slf4j public class VideoApiImpl implements VideoApi { @Autowired private IdService idService ; @Autowired private MongoTemplate mongoTemplate ; /** * \u53d1\u5e03\u5c0f\u89c6\u9891 * * @param video * @return */ @Override public String saveVideo ( Video video ) { try { //\u6821\u9a8c if ( ! ObjectUtil . isAllNotEmpty ( video . getUserId (), video . getPicUrl (), video . getVideoUrl ())){ return null ; } //\u8bbe\u7f6eid video . setId ( ObjectId . get ()); video . setVid ( this . idService . createId ( IdType . VIDEO )); //\u53d1\u5e03\u65f6\u95f4 video . setCreated ( System . currentTimeMillis ()); //\u4fdd\u5b58\u5230Mongodb\u4e2d this . mongoTemplate . save ( video ); return video . getId (). toHexString (); } catch ( Exception e ) { log . error ( \"\u5c0f\u89c6\u9891\u53d1\u5e03\u5931\u8d25~ video = \" + video , e ); } return null ; } } 8.2\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 \u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/821 8.2.1\u3001VideoController \u00b6 package com.tanhua.server.controller ; import com.tanhua.server.service.VideoService ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RequestParam ; import org.springframework.web.bind.annotation.RestController ; import org.springframework.web.multipart.MultipartFile ; @RestController @RequestMapping ( \"smallVideos\" ) public class VideoController { @Autowired private VideoService videoService ; /** * \u53d1\u5e03\u5c0f\u89c6\u9891 * * @param picFile * @param videoFile * @return */ @PostMapping public ResponseEntity < Void > saveVideo ( @RequestParam ( \"videoThumbnail\" ) MultipartFile picFile , @RequestParam ( \"videoFile\" ) MultipartFile videoFile ) { try { Boolean bool = this . videoService . saveVideo ( picFile , videoFile ); if ( bool ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } } 8.2.2\u3001VideoService \u00b6 package com.tanhua.server.service ; import cn.hutool.core.util.StrUtil ; import com.alibaba.dubbo.config.annotation.Reference ; import com.github.tobato.fastdfs.domain.conn.FdfsWebServer ; import com.github.tobato.fastdfs.domain.fdfs.StorePath ; import com.github.tobato.fastdfs.service.FastFileStorageClient ; import com.tanhua.common.pojo.User ; import com.tanhua.common.service.PicUploadService ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.common.vo.PicUploadResult ; import com.tanhua.dubbo.server.api.VideoApi ; import com.tanhua.dubbo.server.pojo.Video ; import lombok.extern.slf4j.Slf4j ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import org.springframework.web.multipart.MultipartFile ; @Service @Slf4j public class VideoService { @Autowired private PicUploadService picUploadService ; @Autowired protected FastFileStorageClient storageClient ; @Autowired private FdfsWebServer fdfsWebServer ; @Reference ( version = \"1.0.0\" ) private VideoApi videoApi ; /** * \u53d1\u5e03\u5c0f\u89c6\u9891 * * @param picFile * @param videoFile * @return */ public Boolean saveVideo ( MultipartFile picFile , MultipartFile videoFile ) { User user = UserThreadLocal . get (); Video video = new Video (); video . setUserId ( user . getId ()); video . setSeeType ( 1 ); //\u9ed8\u8ba4\u516c\u5f00 try { //\u4e0a\u4f20\u5c01\u9762\u56fe\u7247 PicUploadResult picUploadResult = this . picUploadService . upload ( picFile ); video . setPicUrl ( picUploadResult . getName ()); //\u56fe\u7247\u8def\u5f84 //\u4e0a\u4f20\u89c6\u9891 StorePath storePath = storageClient . uploadFile ( videoFile . getInputStream (), videoFile . getSize (), StrUtil . subAfter ( videoFile . getOriginalFilename (), '.' , true ), null ); //\u8bbe\u7f6e\u89c6\u9891url video . setVideoUrl ( fdfsWebServer . getWebServerUrl () + storePath . getFullPath ()); String videoId = this . videoApi . saveVideo ( video ); return StrUtil . isNotEmpty ( videoId ); } catch ( Exception e ) { log . error ( \"\u53d1\u5e03\u5c0f\u89c6\u9891\u5931\u8d25\uff01file = \" + picFile . getOriginalFilename () , e ); } return false ; } } 5.4.3\u3001\u6d4b\u8bd5 \u00b6 \u5982\u679c\u4e0a\u4f20\u89c6\u9891\uff0c\u4f1a\u5bfc\u81f4\u5f02\u5e38\uff0c\u662f\u56e0\u4e3a\u8bf7\u6c42\u592a\u5927\u7684\u7f18\u6545\uff1a \u89e3\u51b3\uff1aapplication.properties spring.servlet.multipart.max-file-size = 30MB spring.servlet.multipart.max-request-size = 30MB \u6d4b\u8bd5\uff1a \u53ef\u4ee5\u770b\u5230\u6570\u636e\u5df2\u7ecf\u5199\u5165\u5230\u4e86MongoDB\u4e2d\u3002 9\u3001\u5c0f\u89c6\u9891\u5217\u8868 \u00b6 \u5c0f\u89c6\u9891\u7684\u5217\u8868\u67e5\u8be2\u7684\u5b9e\u73b0\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u6709\u63a8\u8350\u89c6\u9891\uff0c\u4f18\u5148\u8fd4\u56de\u63a8\u8350\u89c6\u9891\uff0c\u5982\u679c\u4e0d\u591f\u6216\u6ca1\u6709\uff0c\u6309\u7167\u65f6\u95f4\u5012\u5e8f\u67e5\u8be2\u89c6\u9891\u8868\u3002 \u63a8\u8350\u6570\u636e\uff1a 9.1\u3001dubbo\u670d\u52a1 \u00b6 9.1.1\u3001\u5b9a\u4e49dubbo\u670d\u52a1 \u00b6 package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.pojo.Video ; import com.tanhua.dubbo.server.vo.PageInfo ; public interface VideoApi { /** * \u4fdd\u5b58\u5c0f\u89c6\u9891 * * @param video * @return */ Boolean saveVideo ( Video video ); /** * \u5206\u9875\u67e5\u8be2\u5c0f\u89c6\u9891\u5217\u8868\uff0c\u6309\u7167\u65f6\u95f4\u5012\u5e8f\u6392\u5e8f * * @param userId * @param page * @param pageSize * @return */ PageInfo < Video > queryVideoList ( Long userId , Integer page , Integer pageSize ); } 9.1.2\u3001\u5b9e\u73b0dubbo\u670d\u52a1 \u00b6 //com.tanhua.dubbo.server.api.VideoApiImpl /** * \u67e5\u8be2\u5c0f\u89c6\u9891\u5217\u8868\uff0c\u4f18\u5148\u5c55\u73b0\u63a8\u8350\u7684\u89c6\u9891\uff0c\u5982\u679c\u6ca1\u6709\u63a8\u8350\u7684\u89c6\u9891\u6216\u5df2\u7ecf\u67e5\u8be2\u5b8c\u6210\uff0c\u5c31\u9700\u8981\u67e5\u8be2\u7cfb\u7edf\u89c6\u9891\u6570\u636e * * @param userId * @param page * @param pageSize * @return */ @Override public PageInfo < Video > queryVideoList ( Long userId , Integer page , Integer pageSize ) { PageInfo < Video > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); //\u4eceredis\u4e2d\u83b7\u53d6\u63a8\u8350\u89c6\u9891\u7684\u6570\u636e String redisKey = \"QUANZI_VIDEO_RECOMMEND_\" + userId ; String redisData = this . redisTemplate . opsForValue (). get ( redisKey ); List < Long > vids = new ArrayList <> (); int recommendCount = 0 ; if ( StrUtil . isNotEmpty ( redisData )) { //\u624b\u52a8\u5206\u9875\u67e5\u8be2\u6570\u636e List < String > vidList = StrUtil . split ( redisData , ',' ); //\u8ba1\u7b97\u5206\u9875 //[0, 10] int [] startEnd = PageUtil . transToStartEnd ( page - 1 , pageSize ); int startIndex = startEnd [ 0 ] ; //\u5f00\u59cb int endIndex = Math . min ( startEnd [ 1 ] , vidList . size ()); //\u7ed3\u675f for ( int i = startIndex ; i < endIndex ; i ++ ) { vids . add ( Convert . toLong ( vidList . get ( i ))); } recommendCount = vidList . size (); } if ( CollUtil . isEmpty ( vids )) { //\u6ca1\u6709\u63a8\u8350\u6216\u524d\u9762\u63a8\u8350\u5df2\u7ecf\u67e5\u8be2\u5b8c\u6bd5\uff0c\u67e5\u8be2\u7cfb\u7edf\u7684\u89c6\u9891\u6570\u636e //\u8ba1\u7b97\u524d\u9762\u7684\u63a8\u8350\u89c6\u9891\u9875\u6570 int totalPage = PageUtil . totalPage ( recommendCount , pageSize ); PageRequest pageRequest = PageRequest . of ( page - totalPage - 1 , pageSize , Sort . by ( Sort . Order . desc ( \"created\" ))); Query query = new Query (). with ( pageRequest ); List < Video > videoList = this . mongoTemplate . find ( query , Video . class ); pageInfo . setRecords ( videoList ); return pageInfo ; } //\u6839\u636evid\u67e5\u8be2\u5bf9\u5e94\u7684\u89c6\u9891\u6570\u636e\u4e86 Query query = Query . query ( Criteria . where ( \"vid\" ). in ( vids )); List < Video > videoList = this . mongoTemplate . find ( query , Video . class ); pageInfo . setRecords ( videoList ); return pageInfo ; } 9.1.3\u3001\u6d4b\u8bd5\u7528\u4f8b \u00b6 package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.pojo.Video ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestVideoApi { @Autowired private VideoApi videoApi ; @Test public void testQueryVideoList () { //\u8fd4\u56de\u7684\u63a8\u8350\u7ed3\u679c\u6570\u636e System . out . println ( this . videoApi . queryVideoList ( 1L , 1 , 8 )); //\u8fd4\u56de\u5c11\u4e8epageSize\u6570\u636e\uff0c\u56e0\u4e3a\u63a8\u8350\u6570\u636e\u4e0d\u591f\u4e86 System . out . println ( this . videoApi . queryVideoList ( 1L , 3 , 8 )); //\u8fd4\u56de\u7cfb\u7edf\u6570\u636e System . out . println ( this . videoApi . queryVideoList ( 1L , 4 , 8 )); } } 9.2\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 \u670d\u52a1\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/815 9.2.1\u3001\u5b9a\u4e49VideoVo \u00b6 package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class VideoVo { private String id ; private Long userId ; private String avatar ; //\u5934\u50cf private String nickname ; //\u6635\u79f0 private String cover ; //\u5c01\u9762 private String videoUrl ; //\u89c6\u9891URL private String signature ; //\u7b7e\u540d private Integer likeCount ; //\u70b9\u8d5e\u6570\u91cf private Integer hasLiked ; //\u662f\u5426\u5df2\u8d5e\uff081\u662f\uff0c0\u5426\uff09 private Integer hasFocus ; //\u662f\u662f\u5426\u5173\u6ce8 \uff081\u662f\uff0c0\u5426\uff09 private Integer commentCount ; //\u8bc4\u8bba\u6570\u91cf } 9.2.2\u3001VideoController \u00b6 @RestController @RequestMapping ( \"smallVideos\" ) public class VideoController { /** * \u67e5\u8be2\u5c0f\u89c6\u9891\u5217\u8868 * * @param page * @param pageSize * @return */ @GetMapping public ResponseEntity < PageResult > queryVideoList ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize ) { try { if ( page <= 0 ) { page = 1 ; } PageResult pageResult = this . videoService . queryVideoList ( page , pageSize ); if ( null != pageResult ) { return ResponseEntity . ok ( pageResult ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } } 9.2.3\u3001VideoService \u00b6 //com.tanhua.server.service.VideoService public PageResult queryVideoList ( Integer page , Integer pageSize ) { User user = UserThreadLocal . get (); PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); PageInfo < Video > pageInfo = this . videoApi . queryVideoList ( user . getId (), page , pageSize ); List < Video > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )){ return pageResult ; } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIds = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); List < VideoVo > videoVoList = new ArrayList <> (); for ( Video record : records ) { VideoVo videoVo = new VideoVo (); videoVo . setUserId ( record . getUserId ()); videoVo . setCover ( record . getPicUrl ()); videoVo . setVideoUrl ( record . getVideoUrl ()); videoVo . setId ( record . getId (). toHexString ()); videoVo . setSignature ( \"\u6211\u5c31\u662f\u6211~\" ); //TODO \u7b7e\u540d videoVo . setCommentCount ( 0 ); //TODO \u8bc4\u8bba\u6570 videoVo . setHasFocus ( 0 ); //TODO \u662f\u5426\u5173\u6ce8 videoVo . setHasLiked ( 0 ); //TODO \u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 videoVo . setLikeCount ( 0 ); //TODO \u70b9\u8d5e\u6570 //\u586b\u5145\u7528\u6237\u4fe1\u606f for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( videoVo . getUserId (), userInfo . getUserId ())) { videoVo . setNickname ( userInfo . getNickName ()); videoVo . setAvatar ( userInfo . getLogo ()); break ; } } videoVoList . add ( videoVo ); } pageResult . setItems ( videoVoList ); return pageResult ; } 9.2.5\u3001\u6d4b\u8bd5 \u00b6 \u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u67e5\u8be2\u5230\u6570\u636e\u3002\u4e0b\u9762\u4f7f\u7528\u624b\u673a\u8fdb\u884c\u6d4b\u8bd5\uff1a","title":"day05"},{"location":"tantan/day05/#_1","text":"\u5708\u5b50\u5b9e\u73b0\u70b9\u8d5e\u3001\u559c\u6b22\u529f\u80fd \u5708\u5b50\u5b9e\u73b0\u8bc4\u8bba \u5708\u5b50\u5b9e\u73b0\u8bc4\u8bba\u7684\u70b9\u8d5e \u5c0f\u89c6\u9891\u529f\u80fd\u4ecb\u7ecd FastDFS\u5165\u95e8\u5b66\u4e60 \u5b9e\u73b0\u53d1\u5e03\u5c0f\u89c6\u9891\u529f\u80fd \u5b9e\u73b0\u67e5\u8be2\u5c0f\u89c6\u9891\u5217\u8868\u529f\u80fd","title":"\u8bfe\u7a0b\u8bf4\u660e"},{"location":"tantan/day05/#1","text":"\u5728\u5708\u5b50\u529f\u80fd\u4e2d\uff0c\u5bf9\u4e8e\u5708\u5b50\u7684\u70b9\u8d5e\u3001\u559c\u6b22\u3001\u8bc4\u8bba\u7b49\u5747\u53ef\u7406\u89e3\u4e3a\u7528\u6237\u5bf9\u52a8\u6001\u7684\u8bc4\u8bba\uff08Comment\uff09\uff0c\u5728quanzi_comment\u8868\u4e2d\u4f7f\u7528commentType\u8fdb\u884c\u533a\u5206\u3002 \u5728\u5177\u4f53\u7684\u5b9e\u73b0\u4e2d\uff0c\u9700\u8981\u5c06\u70b9\u8d5e\u6570\u3001\u67d0\u7528\u6237\u662f\u5426\u70b9\u8d5e\u7b49\u6570\u636e\u4fdd\u5b58\u5230Reds\u4e2d\uff0c\u4ee5\u51cf\u8f7bMongoDB\u7684\u538b\u529b\u3002 \u5177\u4f53\u5b58\u50a8\u7ed3\u6784\u5982\u4e0b\uff1a \u8bf4\u660e\uff1a\u5728Redis\u7684\u5b58\u50a8\u7ed3\u6784\u4e2d\uff0c\u91c7\u7528\u7684\u662fHash\u5b58\u50a8\uff0c\u8fd9\u6837\u7684\u597d\u5904\u5c31\u5728\u4e8e\u4e00\u6761\u52a8\u6001\u7684\u70b9\u8d5e\u3001\u559c\u6b22\u7b49\u6570\u636e\u90fd\u4f1a\u96c6\u4e2d\u7684\u5b58\u50a8\u5230\u4e00\u8d77\uff0c\u4ece\u800c\u51cf\u5c11\u4e86Redis\u4e2d\u6570\u636e\u6761\u6570\u3002","title":"1\u3001\u5708\u5b50\u70b9\u8d5e\u5b9e\u73b0\u5206\u6790"},{"location":"tantan/day05/#2","text":"","title":"2\u3001\u70b9\u8d5e"},{"location":"tantan/day05/#21","text":"\u4e3a\u4e86\u89c4\u8303\u4f7f\u7528CommentType\uff0c\u6240\u4ee5\u5c06\u5176\u5b9a\u4e49\u4e3a\u679a\u4e3e\u7c7b\u578b\u3002 package com.tanhua.dubbo.server.enums ; /** * \u8bc4\u8bba\u7c7b\u578b\uff1a1-\u70b9\u8d5e\uff0c2-\u8bc4\u8bba\uff0c3-\u559c\u6b22 */ public enum CommentType { LIKE ( 1 ), COMMENT ( 2 ), LOVE ( 3 ); int type ; CommentType ( int type ) { this . type = type ; } public int getType () { return type ; } }","title":"2.1\u3001\u5b9a\u4e49\u679a\u4e3e"},{"location":"tantan/day05/#22dubbo","text":"","title":"2.2\u3001dubbo\u670d\u52a1"},{"location":"tantan/day05/#221","text":"package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.pojo.Publish ; import com.tanhua.dubbo.server.vo.PageInfo ; public interface QuanZiApi { //........\u6b64\u5904\u5ffd\u7565\u5176\u4ed6\u4ee3\u7801.......... /** * \u6839\u636eid\u67e5\u8be2\u52a8\u6001 * * @param id \u52a8\u6001id * @return */ Publish queryPublishById ( String id ); /** * \u70b9\u8d5e * * @param userId * @param publishId * @return */ Boolean likeComment ( Long userId , String publishId ); /** * \u53d6\u6d88\u70b9\u8d5e * * @param userId * @param publishId * @return */ Boolean disLikeComment ( Long userId , String publishId ); /** * \u67e5\u8be2\u70b9\u8d5e\u6570 * * @param publishId * @return */ Long queryLikeCount ( String publishId ); /** * \u67e5\u8be2\u7528\u6237\u662f\u5426\u70b9\u8d5e\u8be5\u52a8\u6001 * * @param userId * @param publishId * @return */ Boolean queryUserIsLike ( Long userId , String publishId ); }","title":"2.2.1\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day05/#222","text":"package com.tanhua.dubbo.server.api ; @Service ( version = \"1.0.0\" ) @Slf4j public class QuanZiApiImpl implements QuanZiApi { //\u8bc4\u8bba\u6570\u636e\u5b58\u50a8\u5728Redis\u4e2dkey\u7684\u524d\u7f00 private static final String COMMENT_REDIS_KEY_PREFIX = \"QUANZI_COMMENT_\" ; //\u7528\u6237\u662f\u5426\u70b9\u8d5e\u7684\u524d\u7f00 private static final String COMMENT_USER_LIEK_REDIS_KEY_PREFIX = \"USER_LIKE_\" ; //\u7528\u6237\u662f\u5426\u559c\u6b22\u7684\u524d\u7f00 private static final String COMMENT_USER_LOVE_REDIS_KEY_PREFIX = \"USER_LOVE_\" ; @Autowired private MongoTemplate mongoTemplate ; @Autowired private RedisTemplate < String , String > redisTemplate ; //........\u6b64\u5904\u5ffd\u7565\u5176\u4ed6\u4ee3\u7801.......... @Override public Publish queryPublishById ( String id ) { return this . mongoTemplate . findById ( new ObjectId ( id ), Publish . class ); } @Override public Boolean likeComment ( Long userId , String publishId ) { //\u5224\u65ad\u8be5\u7528\u6237\u662f\u5426\u5df2\u7ecf\u70b9\u8d5e\uff0c\u5982\u679c\u5df2\u7ecf\u70b9\u8d5e\u5c31\u76f4\u63a5\u8fd4\u56de if ( this . queryUserIsLike ( userId , publishId )) { return false ; } //\u4fdd\u5b58Comment\u6570\u636e Boolean result = this . saveComment ( userId , publishId , CommentType . LIKE , null ); if ( ! result ) { return false ; } //\u4fee\u6539redis\u4e2d\u7684\u70b9\u8d5e\u6570\u4ee5\u53ca\u662f\u5426\u70b9\u8d5e //\u4fee\u6539\u70b9\u8d5e\u6570 String redisKey = this . getCommentRedisKeyPrefix ( publishId ); String hashKey = CommentType . LIKE . toString (); this . redisTemplate . opsForHash (). increment ( redisKey , hashKey , 1 ); //\u7528\u6237\u662f\u5426\u70b9\u8d5e String userHashKey = this . getCommentUserLikeRedisKeyPrefix ( userId ); this . redisTemplate . opsForHash (). put ( redisKey , userHashKey , \"1\" ); return true ; } private String getCommentRedisKeyPrefix ( String publishId ) { return COMMENT_REDIS_KEY_PREFIX + publishId ; } private String getCommentUserLikeRedisKeyPrefix ( Long userId ) { return COMMENT_USER_LIKE_REDIS_KEY_PREFIX + userId ; } @Override public Boolean disLikeComment ( Long userId , String publishId ) { //\u5224\u65ad\u7528\u6237\u662f\u5426\u5df2\u7ecf\u70b9\u8d5e\uff0c\u5982\u679c\u6ca1\u6709\u70b9\u8d5e\u5c31\u8fd4\u56de if ( ! this . queryUserIsLike ( userId , publishId )) { return false ; } //\u5220\u9664\u8bc4\u8bba\u6570\u636e Boolean result = this . removeComment ( userId , publishId , CommentType . LIKE ); if ( ! result ) { return false ; } //\u4fee\u6539Redis\u4e2d\u7684\u6570\u636e //\u4fee\u6539\u70b9\u8d5e\u6570 String redisKey = this . getCommentRedisKeyPrefix ( publishId ); String hashKey = CommentType . LIKE . toString (); this . redisTemplate . opsForHash (). increment ( redisKey , hashKey , - 1 ); //\u7528\u6237\u662f\u5426\u70b9\u8d5e String userHashKey = this . getCommentUserLikeRedisKeyPrefix ( userId ); this . redisTemplate . opsForHash (). delete ( redisKey , userHashKey ); return true ; } @Override public Long queryLikeCount ( String publishId ) { //\u4eceRedis\u4e2d\u547d\u4e2d\u67e5\u8be2\uff0c\u5982\u679c\u547d\u4e2d\u76f4\u63a5\u8fd4\u56de\u5373\u53ef String redisKey = this . getCommentRedisKeyPrefix ( publishId ); String hashKey = CommentType . LIKE . toString (); Object data = this . redisTemplate . opsForHash (). get ( redisKey , hashKey ); if ( ObjectUtil . isNotEmpty ( data )) { return Convert . toLong ( data ); } //\u67e5\u8be2Mongodb Long count = this . queryCommentCount ( publishId , CommentType . LIKE ); //\u5199\u5165Redis\u4e2d this . redisTemplate . opsForHash (). put ( redisKey , hashKey , String . valueOf ( count )); return count ; } @Override public Boolean queryUserIsLike ( Long userId , String publishId ) { //\u4eceredis\u4e2d\u67e5\u8be2\u6570\u636e String redisKey = this . getCommentRedisKeyPrefix ( publishId ); String userHashKey = this . getCommentUserLikeRedisKeyPrefix ( userId ); Object data = this . redisTemplate . opsForHash (). get ( redisKey , userHashKey ); if ( ObjectUtil . isNotEmpty ( data )) { return StrUtil . equals ( Convert . toStr ( data ), \"1\" ); } //\u67e5\u8be2Mongodb\uff0c\u786e\u5b9a\u662f\u5426\u5df2\u7ecf\u70b9\u8d5e Query query = Query . query ( Criteria . where ( \"publishId\" ). is ( new ObjectId ( publishId )) . and ( \"userId\" ). is ( userId ) . and ( \"commentType\" ). is ( CommentType . LIKE ) ); long count = this . mongoTemplate . count ( query , Comment . class ); if ( count == 0 ){ return false ; } //\u5199\u5165\u5230redis\u4e2d this . redisTemplate . opsForHash (). put ( redisKey , userHashKey , \"1\" ); return true ; } /** * \u4fdd\u5b58Comment * * @return */ private Boolean saveComment ( Long userId , String publishId , CommentType commentType , String content ) { try { Comment comment = new Comment (); comment . setId ( ObjectId . get ()); comment . setUserId ( userId ); comment . setPublishId ( new ObjectId ( publishId )); // \u8bc4\u8bba\u7c7b\u578b comment . setCommentType ( commentType . getType ()); // \u5185\u5bb9 comment . setContent ( content ); comment . setCreated ( System . currentTimeMillis ()); Publish publish = this . queryPublishById ( publishId ); //TODO \u5176\u4ed6\u8bc4\u8bba\u5bf9\u8c61\uff0c\u6682\u4e0d\u5904\u7406 comment . setPublishUserId ( publish . getUserId ()); this . mongoTemplate . save ( comment ); return true ; } catch ( Exception e ) { log . error ( \"\u4fdd\u5b58Comment\u51fa\u9519~ userId = \" + userId + \", publishId = \" + publishId + \", commentType = \" + commentType , e ); } return false ; } /** * \u5220\u9664\u8bc4\u8bba\u6570\u636e * * @param userId * @param publishId * @param commentType * @return */ private Boolean removeComment ( Long userId , String publishId , CommentType commentType ) { Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId ) . and ( \"publishId\" ). is ( new ObjectId ( publishId )) . and ( \"commentType\" ). is ( commentType . getType ()) ); return this . mongoTemplate . remove ( query , Comment . class ). getDeletedCount () > 0 ; } /** * \u67e5\u8be2\u6570\u91cf * * @param publishId * @param commentType * @return */ private Long queryCommentCount ( String publishId , CommentType commentType ) { Query query = Query . query ( Criteria . where ( \"publishId\" ). is ( new ObjectId ( publishId )) . and ( \"commentType\" ). is ( commentType . getType ()) ); return this . mongoTemplate . count ( query , Comment . class ); } }","title":"2.2.2\u3001\u7f16\u5199\u5b9e\u73b0"},{"location":"tantan/day05/#223","text":"package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.pojo.Publish ; import com.tanhua.dubbo.server.vo.PageInfo ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestQuanZiApi { @Autowired private QuanZiApi quanZiApi ; //........\u6b64\u5904\u5ffd\u7565\u5176\u4ed6\u4ee3\u7801.......... @Test public void testLike (){ Long userId = 1L ; String publishId = \"5fae53947e52992e78a3afb1\" ; Boolean data = this . quanZiApi . queryUserIsLike ( userId , publishId ); System . out . println ( data ); System . out . println ( this . quanZiApi . likeComment ( userId , publishId )); System . out . println ( this . quanZiApi . queryLikeCount ( publishId )); System . out . println ( this . quanZiApi . disLikeComment ( userId , publishId )); System . out . println ( this . quanZiApi . queryLikeCount ( publishId )); } }","title":"2.2.3\u3001\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b"},{"location":"tantan/day05/#23app","text":"\u70b9\u8d5e\u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/707 \u4ece\u63a5\u53e3\u6587\u6863\u6765\u770b\uff0c\u70b9\u8d5e\u5b8c\u6210\u540e\u9700\u8981\u8fd4\u56de\u70b9\u8d5e\u6570\u3002","title":"2.3\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day05/#231","text":"//com.tanhua.server.controller.QuanZiController /** * \u70b9\u8d5e * * @param publishId * @return */ @GetMapping ( \"/{id}/like\" ) public ResponseEntity < Long > likeComment ( @PathVariable ( \"id\" ) String publishId ) { try { Long likeCount = this . quanZiService . likeComment ( publishId ); if ( likeCount != null ) { return ResponseEntity . ok ( likeCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u53d6\u6d88\u70b9\u8d5e * * @param publishId * @return */ @GetMapping ( \"/{id}/dislike\" ) public ResponseEntity < Long > disLikeComment ( @PathVariable ( \"id\" ) String publishId ) { try { Long likeCount = this . quanZiService . disLikeComment ( publishId ); if ( null != likeCount ) { return ResponseEntity . ok ( likeCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"2.3.1\u3001\u7f16\u5199\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day05/#232","text":"//com.tanhua.server.service.QuanZiService public Long likeComment ( String publishId ) { User user = UserThreadLocal . get (); //\u70b9\u8d5e Boolean result = this . quanZiApi . likeComment ( user . getId (), publishId ); if ( result ){ //\u67e5\u8be2\u70b9\u8d5e\u6570 return this . quanZiApi . queryLikeCount ( publishId ); } return null ; } public Long disLikeComment ( String publishId ) { User user = UserThreadLocal . get (); //\u53d6\u6d88\u70b9\u8d5e Boolean result = this . quanZiApi . disLikeComment ( user . getId (), publishId ); if ( result ){ //\u67e5\u8be2\u70b9\u8d5e\u6570 return this . quanZiApi . queryLikeCount ( publishId ); } return null ; }","title":"2.3.2\u3001\u7f16\u5199\u670d\u52a1\u5b9e\u73b0"},{"location":"tantan/day05/#233","text":"\u67e5\u8be2\u70b9\u8d5e\u6570\u3001\u662f\u5426\u70b9\u8d5e\uff0c\u9700\u8981\u901a\u8fc7dubbo\u670d\u52a1\u8fdb\u884c\u67e5\u8be2\u3002 //com.tanhua.server.service.QuanZiService /** * \u586b\u5145\u7528\u6237\u4fe1\u606f * * @param userInfo * @param quanZiVo */ private void fillUserInfoToQuanZiVo ( UserInfo userInfo , QuanZiVo quanZiVo ) { BeanUtil . copyProperties ( userInfo , quanZiVo , \"id\" ); quanZiVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); quanZiVo . setTags ( StringUtils . split ( userInfo . getTags (), ',' )); //\u5f53\u524d\u7528\u6237 User user = UserThreadLocal . get (); quanZiVo . setCommentCount ( 0 ); //TODO \u8bc4\u8bba\u6570 quanZiVo . setDistance ( \"1.2\u516c\u91cc\" ); //TODO \u8ddd\u79bb quanZiVo . setHasLiked ( this . quanZiApi . queryUserIsLike ( user . getId (), quanZiVo . getId ()) ? 1 : 0 ); //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLikeCount ( Convert . toInt ( this . quanZiApi . queryLikeCount ( quanZiVo . getId ()))); //\u70b9\u8d5e\u6570 quanZiVo . setHasLoved ( 0 ); //TODO \u662f\u5426\u559c\u6b22\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLoveCount ( 0 ); //TODO \u559c\u6b22\u6570 }","title":"2.3.3\u3001\u4fee\u6539\u67e5\u8be2\u52a8\u6001\u70b9\u8d5e\u6570"},{"location":"tantan/day05/#234","text":"\u4ece\u6d4b\u8bd5\u7ed3\u679c\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u5728\u54cd\u5e94\u7ed3\u679c\u4e2d\u8fd4\u56de\u4e86\u70b9\u8d5e\u6570\u4ee5\u53ca\u662f\u5426\u70b9\u8d5e\u7684\u6570\u636e\u3002","title":"2.3.4\u3001\u6d4b\u8bd5"},{"location":"tantan/day05/#3","text":"\u559c\u6b22\u7684\u5b9e\u73b0\u4e0e\u70b9\u8d5e\u7c7b\u4f3c\uff0c\u53ea\u662f\u5176\u7c7b\u578b\u4e0d\u540c\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728\u63a8\u8350\u52a8\u6001\u4e2d\u624d\u6709\u559c\u6b22\u529f\u80fd\uff0c\u597d\u53cb\u52a8\u6001\u4e2d\u662f\u6ca1\u6709\u6b64\u529f\u80fd\u7684\u3002","title":"3\u3001\u559c\u6b22"},{"location":"tantan/day05/#31dubbo","text":"","title":"3.1\u3001dubbo\u670d\u52a1"},{"location":"tantan/day05/#311","text":"//com.tanhua.dubbo.server.api.QuanZiApi /** * \u559c\u6b22 * * @param userId * @param publishId * @return */ Boolean loveComment ( Long userId , String publishId ); /** * \u53d6\u6d88\u559c\u6b22 * * @param userId * @param publishId * @return */ Boolean disLoveComment ( Long userId , String publishId ); /** * \u67e5\u8be2\u559c\u6b22\u6570 * * @param publishId * @return */ Long queryLoveCount ( String publishId ); /** * \u67e5\u8be2\u7528\u6237\u662f\u5426\u559c\u6b22\u8be5\u52a8\u6001 * * @param userId * @param publishId * @return */ Boolean queryUserIsLove ( Long userId , String publishId );","title":"3.1.1\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day05/#312","text":"//com.tanhua.dubbo.server.api.QuanZiApiImpl @Override public Boolean loveComment ( Long userId , String publishId ) { //\u67e5\u8be2\u8be5\u7528\u6237\u662f\u5426\u5df2\u7ecf\u559c\u6b22 if ( this . queryUserIsLove ( userId , publishId )) { return false ; } //\u559c\u6b22 boolean result = this . saveComment ( userId , publishId , CommentType . LOVE , null ); if ( ! result ) { return false ; } //\u559c\u6b22\u6210\u529f\u540e\uff0c\u4fee\u6539Redis\u4e2d\u7684\u603b\u7684\u559c\u6b22\u6570 String redisKey = this . getCommentRedisKeyPrefix ( publishId ); String hashKey = CommentType . LOVE . toString (); this . redisTemplate . opsForHash (). increment ( redisKey , hashKey , 1 ); //\u6807\u8bb0\u7528\u6237\u5df2\u7ecf\u559c\u6b22 hashKey = this . getCommentUserLoveRedisKey ( userId ); this . redisTemplate . opsForHash (). put ( redisKey , hashKey , \"1\" ); return true ; } private String getCommentUserLoveRedisKey ( Long userId ) { return COMMENT_USER_LOVE_REDIS_KEY_PREFIX + userId ; } @Override public Boolean disLoveComment ( Long userId , String publishId ) { if ( ! this . queryUserIsLove ( userId , publishId )) { //\u5982\u679c\u7528\u6237\u6ca1\u6709\u559c\u6b22\uff0c\u5c31\u76f4\u63a5\u8fd4\u56de return false ; } boolean result = this . removeComment ( userId , publishId , CommentType . LOVE ); if ( ! result ) { //\u5220\u9664\u5931\u8d25 return false ; } //\u5220\u9664redis\u4e2d\u7684\u8bb0\u5f55 String redisKey = this . getCommentRedisKeyPrefix ( publishId ); String hashKey = this . getCommentUserLoveRedisKey ( userId ); this . redisTemplate . opsForHash (). delete ( redisKey , hashKey ); this . redisTemplate . opsForHash (). increment ( redisKey , CommentType . LOVE . toString (), - 1 ); return true ; } @Override public Long queryLoveCount ( String publishId ) { //\u9996\u5148\u4eceredis\u4e2d\u547d\u4e2d\uff0c\u5982\u679c\u547d\u4e2d\u7684\u8bdd\u5c31\u8fd4\u56de\uff0c\u6ca1\u6709\u547d\u4e2d\u5c31\u67e5\u8be2Mongodb String redisKey = this . getCommentRedisKeyPrefix ( publishId ); String hashKey = CommentType . LOVE . toString (); Object value = this . redisTemplate . opsForHash (). get ( redisKey , hashKey ); if ( ObjectUtil . isNotEmpty ( value )) { return Convert . toLong ( value ); } //\u67e5\u8be2count Long count = this . queryCommentCount ( publishId , CommentType . LOVE ); //\u5b58\u50a8\u5230redis\u4e2d this . redisTemplate . opsForHash (). put ( redisKey , hashKey , String . valueOf ( count )); return count ; } @Override public Boolean queryUserIsLove ( Long userId , String publishId ) { String redisKey = this . getCommentRedisKeyPrefix ( publishId ); String hashKey = this . getCommentUserLoveRedisKey ( userId ); Object value = this . redisTemplate . opsForHash (). get ( redisKey , hashKey ); if ( ObjectUtil . isNotEmpty ( value )) { return StrUtil . equals ( Convert . toStr ( value ), \"1\" ); } //\u67e5\u8be2mongodb Query query = Query . query ( Criteria . where ( \"publishId\" ) . is ( new ObjectId ( publishId )) . and ( \"userId\" ). is ( userId ) . and ( \"commentType\" ). is ( CommentType . LOVE . getType ())); long count = this . mongoTemplate . count ( query , Comment . class ); if ( count == 0 ) { return false ; } //\u6807\u8bb0\u7528\u6237\u5df2\u7ecf\u559c\u6b22 this . redisTemplate . opsForHash (). put ( redisKey , hashKey , \"1\" ); return true ; }","title":"3.1.2\u3001\u7f16\u5199\u5b9e\u73b0"},{"location":"tantan/day05/#32app","text":"","title":"3.2\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day05/#321","text":"//com.tanhua.server.controller.QuanZiController /** * \u559c\u6b22 * * @param publishId * @return */ @GetMapping ( \"/{id}/love\" ) public ResponseEntity < Long > loveComment ( @PathVariable ( \"id\" ) String publishId ) { try { Long loveCount = this . quanZiService . loveComment ( publishId ); if ( null != loveCount ) { return ResponseEntity . ok ( loveCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u53d6\u6d88\u559c\u6b22 * * @param publishId * @return */ @GetMapping ( \"/{id}/unlove\" ) public ResponseEntity < Long > disLoveComment ( @PathVariable ( \"id\" ) String publishId ) { try { Long loveCount = this . quanZiService . disLoveComment ( publishId ); if ( null != loveCount ) { return ResponseEntity . ok ( loveCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"3.2.1\u3001\u7f16\u5199\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day05/#322","text":"//com.tanhua.server.service.QuanZiService public Long loveComment ( String publishId ) { User user = UserThreadLocal . get (); //\u559c\u6b22 Boolean result = this . quanZiApi . loveComment ( user . getId (), publishId ); if ( result ){ //\u67e5\u8be2\u559c\u6b22\u6570 return this . quanZiApi . queryLoveCount ( publishId ); } return null ; } public Long disLoveComment ( String publishId ) { User user = UserThreadLocal . get (); //\u53d6\u6d88\u559c\u6b22 Boolean result = this . quanZiApi . disLoveComment ( user . getId (), publishId ); if ( result ){ //\u67e5\u8be2\u559c\u6b22\u6570 return this . quanZiApi . queryLoveCount ( publishId ); } return null ; } /** * \u586b\u5145\u7528\u6237\u4fe1\u606f * * @param userInfo * @param quanZiVo */ private void fillUserInfoToQuanZiVo ( UserInfo userInfo , QuanZiVo quanZiVo ) { BeanUtil . copyProperties ( userInfo , quanZiVo , \"id\" ); quanZiVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); quanZiVo . setTags ( StringUtils . split ( userInfo . getTags (), ',' )); //\u5f53\u524d\u7528\u6237 User user = UserThreadLocal . get (); quanZiVo . setCommentCount ( 0 ); //TODO \u8bc4\u8bba\u6570 quanZiVo . setDistance ( \"1.2\u516c\u91cc\" ); //TODO \u8ddd\u79bb quanZiVo . setHasLiked ( this . quanZiApi . queryUserIsLike ( user . getId (), quanZiVo . getId ()) ? 1 : 0 ); //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLikeCount ( Convert . toInt ( this . quanZiApi . queryLikeCount ( quanZiVo . getId ()))); //\u70b9\u8d5e\u6570 quanZiVo . setHasLoved ( this . quanZiApi . queryUserIsLove ( user . getId (), quanZiVo . getId ()) ? 1 : 0 ); //\u662f\u5426\u559c\u6b22\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLoveCount ( Convert . toInt ( this . quanZiApi . queryLoveCount ( quanZiVo . getId ()))); //\u559c\u6b22\u6570 }","title":"3.2.2\u3001\u7f16\u5199\u670d\u52a1\u5b9e\u73b0"},{"location":"tantan/day05/#123","text":"","title":"1.2.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day05/#4","text":"\u7528\u6237\u70b9\u51fb\u8bc4\u8bba\u65f6\u9700\u8981\u67e5\u8be2\u5355\u6761\u52a8\u6001\u8be6\u60c5\uff0c\u9700\u8981\u6709\u63a5\u53e3\u652f\u6301\u3002 \u670d\u52a1\u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/695 \u54cd\u5e94\u7684\u6570\u636e\u63a5\u53e3\u4e0e\u67e5\u8be2\u597d\u53cb\u52a8\u6001\u4e00\u81f4\uff0c\u53ea\u662f\u5355\u6761\u8fd4\u56de\u800c\u4e0d\u662f\u96c6\u5408\u3002 \u8981\u6ce8\u610f\u7684\u662f\uff0cdubbo\u670d\u52a1\u63a5\u53e3\u5728\u524d\u9762\u5df2\u7ecf\u5f00\u53d1\u5b8c\u6210\uff0c\u73b0\u5728\u53ea\u8981\u60f3\u5b9e\u73b0APP\u7aef\u7684\u63a5\u53e3\u670d\u52a1\u5373\u53ef\u3002","title":"4\u3001\u67e5\u8be2\u5355\u6761\u52a8\u6001"},{"location":"tantan/day05/#41","text":"//com.tanhua.server.controller.QuanZiController /** * \u67e5\u8be2\u5355\u6761\u52a8\u6001\u4fe1\u606f * * @param publishId * @return */ @GetMapping ( \"/{id}\" ) public ResponseEntity < QuanZiVo > queryById ( @PathVariable ( \"id\" ) String publishId ) { try { QuanZiVo movements = this . quanZiService . queryById ( publishId ); if ( null != movements ){ return ResponseEntity . ok ( movements ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"4.1\u3001\u5b9a\u4e49\u670d\u52a1\u63a5\u53e3"},{"location":"tantan/day05/#42","text":"//com.tanhua.server.service.QuanZiService public QuanZiVo queryById ( String publishId ) { Publish publish = this . quanZiApi . queryPublishById ( publishId ); if ( publish == null ) { return null ; } return this . fillQuanZiVo ( Arrays . asList ( publish )). get ( 0 ); }","title":"4.2\u3001\u670d\u52a1\u5b9e\u73b0"},{"location":"tantan/day05/#43","text":"\u53ef\u4ee5\u770b\u5230\uff0c\u8fd4\u56de\u4e86\u5355\u6761\u6570\u636e\u3002","title":"4.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day05/#44","text":"\u5728\u5b8c\u6210\u67e5\u8be2\u5355\u6761\u52a8\u6001\u63a5\u53e3\u540e\uff0c\u4f1a\u53d1\u73b0\uff0c\u5237\u65b0\u9996\u9875\u65f6\u4f1a\u51fa\u73b0\u5982\u4e0b\u5f02\u5e38\uff1a java.lang.IllegalArgumentException: invalid hexadecimal representation of an ObjectId: [ visitors ] at org.bson.types.ObjectId.parseHexString ( ObjectId.java:550 ) at org.bson.types.ObjectId.<init> ( ObjectId.java:239 ) at com.tanhua.dubbo.server.api.QuanZiApiImpl.queryPublishById ( QuanZiApiImpl.java:411 ) at com.alibaba.dubbo.common.bytecode.Wrapper1.invokeMethod ( Wrapper1.java ) at com.alibaba.dubbo.rpc.proxy.javassist.JavassistProxyFactory $1 .doInvoke ( JavassistProxyFactory.java:47 ) at com.alibaba.dubbo.rpc.proxy.AbstractProxyInvoker.invoke ( AbstractProxyInvoker.java:76 ) at com.alibaba.dubbo.config.invoker.DelegateProviderMetaDataInvoker.invoke ( DelegateProviderMetaDataInvoker.java:52 ) at com.alibaba.dubbo.rpc.protocol.InvokerWrapper.invoke ( InvokerWrapper.java:56 ) \u539f\u56e0\u662f\uff1a\u8c01\u770b\u8fc7\u6211\u7684\u63a5\u53e3\u8fd8\u6ca1\u5b9e\u73b0\uff0c\u5bfc\u81f4\u4e86\u6620\u5c04\u5230\u4e86\u67e5\u8be2\u5355\u6761\u52a8\u6001\u7684\u63a5\u53e3\uff0c\u5bfc\u81f4\u7684\u5f02\u5e38\uff0c\u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/743 \u89e3\u51b3\u65b9\u6cd5\uff1a\u7f16\u5199\u4e00\u4e2a\u7a7a\u7684\u65b9\u6cd5\u300a\u8c01\u770b\u8fc7\u6211\u300b\u7684\u63a5\u53e3\u5b9e\u73b0\u3002 //com.tanhua.server.controller.QuanZiController /** * TODO\uff1a\u8c01\u770b\u8fc7\u6211 * * @return */ @GetMapping ( \"visitors\" ) public ResponseEntity < Object > queryVisitors () { return ResponseEntity . ok ( Collections . EMPTY_LIST ); }","title":"4.4\u3001\u5f02\u5e38\u7684\u89e3\u51b3"},{"location":"tantan/day05/#5","text":"\u5728\u5355\u6761\u52a8\u6001\u6253\u5f00\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u6709\u8bc4\u8bba\u5217\u8868\uff0c\u529f\u80fd\u5305\u62ec\uff1a\u67e5\u8be2\u8bc4\u8bba\u5217\u8868\uff0c\u8bc4\u8bba\u70b9\u8d5e\u3001\u53d6\u6d88\u70b9\u8d5e\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8bc4\u8bba\u7684\u70b9\u8d5e\u64cd\u4f5c\u4e0e\u5708\u5b50\u52a8\u6001\u7684\u70b9\u8d5e\u4f7f\u7528\u540c\u4e00\u5957\u903b\u8f91\u3002","title":"5\u3001\u8bc4\u8bba"},{"location":"tantan/day05/#51dubbo","text":"","title":"5.1\u3001dubbo\u670d\u52a1"},{"location":"tantan/day05/#511","text":"//com.tanhua.dubbo.server.api.QuanZiApi /** * \u67e5\u8be2\u8bc4\u8bba * * @return */ PageInfo < Comment > queryCommentList ( String publishId , Integer page , Integer pageSize ); /** * \u53d1\u8868\u8bc4\u8bba * * @param userId * @param publishId * @param content * @return */ Boolean saveComment ( Long userId , String publishId , String content );","title":"5.1.1\u3001\u5b9a\u4e49\u670d\u52a1\u63a5\u53e3"},{"location":"tantan/day05/#512","text":"/** * \u67e5\u8be2\u8bc4\u8bba\u5217\u8868 * * @param publishId * @param page * @param pageSize * @return */ @Override public PageInfo < Comment > queryCommentList ( String publishId , Integer page , Integer pageSize ) { PageRequest pageRequest = PageRequest . of ( page - 1 , pageSize , Sort . by ( Sort . Order . asc ( \"created\" ))); Query query = new Query ( Criteria . where ( \"publishId\" ). is ( new ObjectId ( publishId )) . and ( \"commentType\" ). is ( CommentType . COMMENT . getType ())). with ( pageRequest ); //\u67e5\u8be2\u8bc4\u8bba\u5217\u8868 List < Comment > commentList = this . mongoTemplate . find ( query , Comment . class ); PageInfo < Comment > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); pageInfo . setRecords ( commentList ); return pageInfo ; } /** * \u53d1\u8868\u8bc4\u8bba * * @param userId * @param publishId * @param content * @return */ @Override public Boolean saveComment ( Long userId , String publishId , String content ) { return this . saveComment ( userId , publishId , CommentType . COMMENT , content ); }","title":"5.1.2\u3001\u7f16\u5199\u5b9e\u73b0"},{"location":"tantan/day05/#52app","text":"","title":"5.2\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day05/#521commentvo","text":"\u6839\u636e\u54cd\u5e94\u7ed3\u679c\u7684\u6570\u636e\u7ed3\u6784\u5b9a\u4e49\u5bf9\u8c61\uff1a package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; /** * \u8bc4\u8bba */ @Data @NoArgsConstructor @AllArgsConstructor public class CommentVo { private String id ; //\u8bc4\u8bbaid private String avatar ; //\u5934\u50cf private String nickname ; //\u6635\u79f0 private String content ; //\u8bc4\u8bba private String createDate ; //\u8bc4\u8bba\u65f6\u95f4: 08:27 private Integer likeCount ; //\u70b9\u8d5e\u6570 private Integer hasLiked ; //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 }","title":"5.2.1\u3001CommentVo"},{"location":"tantan/day05/#522controller","text":"\u5728APP\u63a5\u53e3\u670d\u52a1\u4e2d\uff0c\u9700\u8981\u5f00\u53d14\u4e2a\u63a5\u53e3\uff0c\u5206\u522b\u662f\u67e5\u8be2\u8bc4\u8bba\u5217\u8868\u3001\u53d1\u8868\u8bc4\u8bba\u3001\u70b9\u8d5e\u3001\u53d6\u6d88\u70b9\u8d5e\u3002 \u7531\u4e8e\u5176\u63a5\u53e3\u7684url\u5730\u5740\u4e0eQuanZiConroller\u5730\u5740\u4e0d\u540c\uff0c\u6240\u4ee5\u9700\u8981\u521b\u5efa\u4e0d\u540c\u7684Controller\u7c7b\u3002 package com.tanhua.server.controller ; import com.tanhua.server.service.QuanZiService ; import com.tanhua.server.vo.PageResult ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.* ; import java.util.Map ; /** * \u5708\u5b50\u529f\u80fd\u4e2d\u7684\u8bc4\u8bba */ @RestController @RequestMapping ( \"comments\" ) public class QuanZiCommentController { @Autowired private QuanZiService quanZiService ; /** * \u67e5\u8be2\u8bc4\u8bba\u5217\u8868 * * @return */ @GetMapping public ResponseEntity < PageResult > queryCommentsList ( @RequestParam ( \"movementId\" ) String publishId , @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize ) { try { PageResult pageResult = this . quanZiService . queryCommentList ( publishId , page , pageSize ); return ResponseEntity . ok ( pageResult ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u4fdd\u5b58\u8bc4\u8bba */ @PostMapping public ResponseEntity < Void > saveComments ( @RequestBody Map < String , String > param ) { try { String publishId = param . get ( \"movementId\" ); String content = param . get ( \"comment\" ); Boolean result = this . quanZiService . saveComments ( publishId , content ); if ( result ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u70b9\u8d5e * * @param publishId * @return */ @GetMapping ( \"{id}/like\" ) public ResponseEntity < Long > likeComment ( @PathVariable ( \"id\" ) String publishId ) { try { Long likeCount = this . quanZiService . likeComment ( publishId ); if ( likeCount != null ) { return ResponseEntity . ok ( likeCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u53d6\u6d88\u70b9\u8d5e * * @param publishId * @return */ @GetMapping ( \"{id}/dislike\" ) public ResponseEntity < Long > disLikeComment ( @PathVariable ( \"id\" ) String publishId ) { try { Long likeCount = this . quanZiService . disLikeComment ( publishId ); if ( null != likeCount ) { return ResponseEntity . ok ( likeCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } }","title":"5.2.2\u3001\u7f16\u5199Controller"},{"location":"tantan/day05/#523service","text":"Service\u7684\u5177\u4f53\u5b9e\u73b0\u4f9d\u7136\u662f\u653e\u5230QuanZiSerivce\u4e2d\u5b8c\u6210\u3002 //com.tanhua.server.service.QuanZiService /** * \u67e5\u8be2\u8bc4\u8bba\u5217\u8868 * * @param publishId * @param page * @param pageSize * @return */ public PageResult queryCommentList ( String publishId , Integer page , Integer pageSize ) { PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); User user = UserThreadLocal . get (); //\u67e5\u8be2\u8bc4\u8bba\u5217\u8868\u6570\u636e PageInfo < Comment > pageInfo = this . quanZiApi . queryCommentList ( publishId , page , pageSize ); List < Comment > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )){ return pageResult ; } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIdList = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIdList ); List < CommentVo > result = new ArrayList <> (); for ( Comment record : records ) { CommentVo commentVo = new CommentVo (); commentVo . setContent ( record . getContent ()); commentVo . setId ( record . getId (). toHexString ()); commentVo . setCreateDate ( DateUtil . format ( new Date ( record . getCreated ()), \"HH:mm\" )); //\u662f\u5426\u70b9\u8d5e commentVo . setHasLiked ( this . quanZiApi . queryUserIsLike ( user . getId (), commentVo . getId ()) ? 1 : 0 ); //\u70b9\u8d5e\u6570 commentVo . setLikeCount ( Convert . toInt ( this . quanZiApi . queryLikeCount ( commentVo . getId ()))); for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( record . getUserId (), userInfo . getUserId ())){ commentVo . setAvatar ( userInfo . getLogo ()); commentVo . setNickname ( userInfo . getNickName ()); break ; } } result . add ( commentVo ); } pageResult . setItems ( result ); return pageResult ; } /** * \u53d1\u8868\u8bc4\u8bba * @param publishId * @param content * @return */ public Boolean saveComments ( String publishId , String content ) { User user = UserThreadLocal . get (); return this . quanZiApi . saveComment ( user . getId (), publishId , content ); }","title":"5.2.3\u3001\u7f16\u5199Service\u5b9e\u73b0"},{"location":"tantan/day05/#524","text":"\u6d4b\u8bd5\u70b9\u8d5e\u65f6\u4f1a\u53d1\u73b0dubbo\u670d\u52a1\u4e2d\u4f1a\u51fa\u73b0null\u6307\u9488\u5f02\u5e38\uff0c\u5982\u4e0b\uff1a java.lang.NullPointerException at com.tanhua.dubbo.server.api.QuanZiApiImpl.saveComment ( QuanZiApiImpl.java:386 ) at com.tanhua.dubbo.server.api.QuanZiApiImpl.likeComment ( QuanZiApiImpl.java:180 ) at com.alibaba.dubbo.common.bytecode.Wrapper1.invokeMethod ( Wrapper1.java ) at com.alibaba.dubbo.rpc.proxy.javassist.JavassistProxyFactory $1 .doInvoke ( JavassistProxyFactory.java:47 ) at com.alibaba.dubbo.rpc.proxy.AbstractProxyInvoker.invoke ( AbstractProxyInvoker.java:76 ) at com.alibaba.dubbo.config.invoker.DelegateProviderMetaDataInvoker.invoke ( DelegateProviderMetaDataInvoker.java:52 ) at com.alibaba.dubbo.rpc.protocol.InvokerWrapper.invoke ( InvokerWrapper.java:56 ) \u539f\u56e0\u662f\uff1a\u539f\u6709\u7684\u70b9\u8d5e\u5b9e\u73b0\u4e2d\uff0c\u9700\u8981\u67e5\u8be2Publish\u5bf9\u8c61\uff0c\u4f46\u662f\u73b0\u5728\u5b9e\u73b0\u7684\u662f\u9488\u5bf9\u8bc4\u8bba\u7684\u70b9\u8d5e\uff0c\u662f\u67e5\u8be2\u4e0d\u5230Publish\u5bf9\u8c61\u7684\uff0c\u6240\u4ee5\u629b\u51fa\u4e86\u7a7a\u6307\u9488\u5f02\u5e38\u3002 \u89e3\u51b3\u5982\u4e0b\uff1a //com.tanhua.dubbo.server.api.QuanZiApiImpl /** * \u4fdd\u5b58Comment * * @return */ private Boolean saveComment ( Long userId , String publishId , CommentType commentType , String content ) { try { Comment comment = new Comment (); comment . setId ( ObjectId . get ()); comment . setUserId ( userId ); comment . setPublishId ( new ObjectId ( publishId )); // \u8bc4\u8bba\u7c7b\u578b comment . setCommentType ( commentType . getType ()); // \u5185\u5bb9 comment . setContent ( content ); comment . setCreated ( System . currentTimeMillis ()); Publish publish = this . queryPublishById ( publishId ); if ( ObjectUtil . isNotEmpty ( publish )) { comment . setPublishUserId ( publish . getUserId ()); } else { //\u67e5\u8be2\u8bc4\u8bba Comment myComment = this . queryCommentById ( publishId ); if ( ObjectUtil . isNotEmpty ( myComment )){ comment . setPublishUserId ( myComment . getUserId ()); } else { //TODO \u5176\u4ed6\u60c5\u51b5\uff0c\u6bd4\u5982\u5c0f\u89c6\u9891\u7b49 } } this . mongoTemplate . save ( comment ); return true ; } catch ( Exception e ) { log . error ( \"\u4fdd\u5b58Comment\u51fa\u9519~ userId = \" + userId + \", publishId = \" + publishId + \", commentType = \" + commentType , e ); } return false ; } /** * \u6839\u636eid\u67e5\u8be2Comment\u5bf9\u8c61 * * @param id * @return */ private Comment queryCommentById ( String id ) { return this . mongoTemplate . findById ( new ObjectId ( id ), Comment . class ); } \u8fd9\u6837\uff0c\u70b9\u8d5e\u529f\u80fd\u6b63\u5e38\u4e86\u3002","title":"5.2.4\u3001\u6d4b\u8bd5"},{"location":"tantan/day05/#6","text":"","title":"6\u3001\u5c0f\u89c6\u9891"},{"location":"tantan/day05/#61","text":"\u5c0f\u89c6\u9891\u529f\u80fd\u7c7b\u4f3c\u4e8e\u6296\u97f3\u3001\u5feb\u624b\u5c0f\u89c6\u9891\u7684\u5e94\u7528\uff0c\u7528\u6237\u53ef\u4ee5\u4e0a\u4f20\u5c0f\u89c6\u9891\u8fdb\u884c\u5206\u4eab\uff0c\u4e5f\u53ef\u4ee5\u6d4f\u89c8\u67e5\u770b\u522b\u4eba\u5206\u4eab\u7684\u89c6\u9891\uff0c\u5e76\u4e14\u53ef\u4ee5\u5bf9\u89c6\u9891\u8bc4\u8bba\u548c\u70b9\u8d5e\u64cd\u4f5c\u3002 \u6548\u679c\uff1a \u67e5\u770b\u8be6\u60c5\uff1a \u8bc4\u8bba\uff1a \u70b9\u8d5e\uff1a","title":"6.1\u3001\u529f\u80fd\u8bf4\u660e"},{"location":"tantan/day05/#62","text":"\u5bf9\u4e8e\u5c0f\u89c6\u9891\u7684\u529f\u80fd\u7684\u5f00\u53d1\uff0c\u6838\u5fc3\u70b9\u5c31\u662f\uff1a\u5b58\u50a8 + \u63a8\u8350 + \u52a0\u8f7d\u901f\u5ea6 \u3002 \u5bf9\u4e8e\u5b58\u50a8\u800c\u8a00\uff0c\u5c0f\u89c6\u9891\u7684\u5b58\u50a8\u91cf\u4ee5\u53ca\u5bb9\u91cf\u90fd\u662f\u975e\u5e38\u5de8\u5927\u7684\u3002 \u6240\u4ee5\u6211\u4eec\u9009\u62e9\u81ea\u5df1\u642d\u5efa\u5206\u5e03\u5f0f\u5b58\u50a8\u7cfb\u7edf FastDFS\u8fdb\u884c\u5b58\u50a8\u3002 \u5bf9\u4e8e\u63a8\u8350\u7b97\u6cd5\uff0c\u6211\u4eec\u5c06\u91c7\u7528\u591a\u79cd\u6743\u91cd\u7684\u8ba1\u7b97\u65b9\u5f0f\u8fdb\u884c\u8ba1\u7b97\u3002 \u5bf9\u4e8e\u52a0\u8f7d\u901f\u5ea6\uff0c\u9664\u4e86\u63d0\u5347\u670d\u52a1\u5668\u5e26\u5bbd\u5916\u53ef\u4ee5\u901a\u8fc7CDN\u7684\u65b9\u5f0f\u8fdb\u884c\u52a0\u901f\uff0c\u5f53\u7136\u4e86\u8fd9\u9700\u8981\u989d\u5916\u8d2d\u4e70CDN\u670d\u52a1\u3002","title":"6.2\u3001\u6280\u672f\u65b9\u6848"},{"location":"tantan/day05/#7fastdfs","text":"","title":"7\u3001FastDFS"},{"location":"tantan/day05/#71fastdfs","text":"FastDFS\u662f\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u3002\u4f7f\u7528 FastDFS\u5f88\u5bb9\u6613\u642d\u5efa\u4e00\u5957\u9ad8\u6027\u80fd\u7684\u6587\u4ef6\u670d\u52a1\u5668\u96c6\u7fa4\u63d0\u4f9b\u6587\u4ef6\u4e0a\u4f20\u3001\u4e0b\u8f7d\u7b49\u670d\u52a1\u3002","title":"7.1\u3001FastDFS\u662f\u4ec0\u4e48\uff1f"},{"location":"tantan/day05/#72","text":"FastDFS \u67b6\u6784\u5305\u62ec Tracker server \u548c Storage server\u3002\u5ba2\u6237\u7aef\u8bf7\u6c42 Tracker server \u8fdb\u884c\u6587\u4ef6\u4e0a\u4f20\u3001\u4e0b\u8f7d\uff0c\u901a\u8fc7 Tracker server \u8c03\u5ea6\u6700\u7ec8\u7531 Storage server \u5b8c\u6210\u6587\u4ef6\u4e0a\u4f20\u548c\u4e0b\u8f7d\u3002 Tracker server \u4f5c\u7528\u662f\u8d1f\u8f7d\u5747\u8861\u548c\u8c03\u5ea6\uff0c\u901a\u8fc7 Tracker server \u5728\u6587\u4ef6\u4e0a\u4f20\u65f6\u53ef\u4ee5\u6839\u636e\u4e00\u4e9b\u7b56\u7565\u627e\u5230 Storage server \u63d0\u4f9b\u6587\u4ef6\u4e0a\u4f20\u670d\u52a1\u3002\u53ef\u4ee5\u5c06 tracker \u79f0\u4e3a\u8ffd\u8e2a\u670d\u52a1\u5668\u6216\u8c03\u5ea6\u670d\u52a1\u5668\u3002 Storage server \u4f5c\u7528\u662f\u6587\u4ef6\u5b58\u50a8\uff0c\u5ba2\u6237\u7aef\u4e0a\u4f20\u7684\u6587\u4ef6\u6700\u7ec8\u5b58\u50a8\u5728 Storage \u670d\u52a1\u5668\u4e0a\uff0cStorage server \u6ca1\u6709\u5b9e\u73b0\u81ea\u5df1\u7684\u6587\u4ef6\u7cfb\u7edf\u800c\u662f\u5229\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u7cfb\u7edf\u6765\u7ba1\u7406\u6587\u4ef6\u3002\u53ef\u4ee5\u5c06storage\u79f0\u4e3a\u5b58\u50a8\u670d\u52a1\u5668\u3002 \u6bcf\u4e2a tracker \u8282\u70b9\u5730\u4f4d\u5e73\u7b49\uff0c\u6536\u96c6 Storage \u96c6\u7fa4\u7684\u72b6\u6001\u3002 Storage \u5206\u4e3a\u591a\u4e2a\u7ec4\uff0c\u6bcf\u4e2a\u7ec4\u4e4b\u95f4\u4fdd\u5b58\u7684\u6587\u4ef6\u662f\u4e0d\u540c\u7684\u3002\u6bcf\u4e2a\u7ec4\u5185\u90e8\u53ef\u4ee5\u6709\u591a\u4e2a\u6210\u5458\uff0c\u7ec4\u6210\u5458\u5185\u90e8\u4fdd\u5b58\u7684\u5185\u5bb9\u662f\u4e00\u6837\u7684\uff0c\u7ec4\u6210\u5458\u7684\u5730\u4f4d\u662f\u4e00\u81f4\u7684\uff0c\u6ca1\u6709\u4e3b\u4ece\u7684\u6982\u5ff5\u3002","title":"7.2\u3001\u5de5\u4f5c\u539f\u7406"},{"location":"tantan/day05/#73","text":"\u5ba2\u6237\u7aef\u4e0a\u4f20\u6587\u4ef6\u540e\u5b58\u50a8\u670d\u52a1\u5668\u5c06\u6587\u4ef6 ID \u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u6b64\u6587\u4ef6 ID \u7528\u4e8e\u4ee5\u540e\u8bbf\u95ee\u8be5\u6587\u4ef6\u7684\u7d22\u5f15\u4fe1\u606f\u3002\u6587\u4ef6\u7d22\u5f15\u4fe1\u606f\u5305\u62ec\uff1a\u7ec4\u540d\uff0c\u865a\u62df\u78c1\u76d8\u8def\u5f84\uff0c\u6570\u636e\u4e24\u7ea7\u76ee\u5f55\uff0c\u6587\u4ef6\u540d\u3002","title":"7.3\u3001\u6587\u4ef6\u7684\u4e0a\u4f20"},{"location":"tantan/day05/#74","text":"\u5ba2\u6237\u7aef\u4e0b\u8f7d\u8bf7\u6c42\u5230Tracker\u670d\u52a1\uff0cTracker\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aefstorage\u7684\u4fe1\u606f\uff0c\u5ba2\u6237\u7aef\u6839\u636e\u8fd9\u4e9b\u4fe1\u606f\u8fdb\u884c\u8bf7\u6c42storage\u83b7\u53d6\u5230\u6587\u4ef6\u3002","title":"7.4\u3001\u6587\u4ef6\u7684\u4e0b\u8f7d"},{"location":"tantan/day05/#75","text":"\u5728\u6211\u4eec\u63d0\u4f9b\u7684\u865a\u62df\u673a\u4e2d\u5df2\u7ecf\u901a\u8fc7docker\u642d\u5efa\u4e86FastDFS\u73af\u5883\uff0c\u4e0b\u9762\u6211\u4eec\u6765\u5b66\u4e60\u4e0b\u5982\u4f55\u901a\u8fc7Java\u7a0b\u5e8f\u6765\u4f7f\u7528FastDFS\u3002","title":"7.5\u3001\u5f00\u59cb\u4f7f\u7528"},{"location":"tantan/day05/#751","text":"\u5173\u4e8e\u4f7f\u7528FastDFS\u4e0a\u4f20\u5c0f\u89c6\u9891\u7684\u903b\u8f91\u6211\u4eec\u5728server\u5de5\u7a0b\u4e2d\u5b8c\u6210\uff0c\u6240\u4ee5\u9700\u8981\u5728server\u5de5\u7a0b\u4e2d\u5f15\u5165\u4f9d\u8d56\u3002 <dependency> <groupId> com.github.tobato </groupId> <artifactId> fastdfs-client </artifactId> <version> 1.26.7 </version> <exclusions> <exclusion> <groupId> ch.qos.logback </groupId> <artifactId> logback-classic </artifactId> </exclusion> </exclusions> </dependency>","title":"7.5.1\u3001\u5f15\u5165\u4f9d\u8d56"},{"location":"tantan/day05/#752","text":"\u5728application.properties\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\u5165\u5982\u4e0b\u5185\u5bb9\uff1a # =================================================================== # \u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edfFDFS\u914d\u7f6e # =================================================================== fdfs.so-timeout = 1501 fdfs.connect-timeout = 601 #\u7f29\u7565\u56fe\u751f\u6210\u53c2\u6570 fdfs.thumb-image.width = 150 fdfs.thumb-image.height = 150 #TrackerList\u53c2\u6570,\u652f\u6301\u591a\u4e2a fdfs.tracker-list = 192.168.31.81:22122 #\u8bbf\u95ee\u8def\u5f84 fdfs.web-server-url = http://192.168.31.81:8888/","title":"7.5.2\u3001\u7f16\u5199\u914d\u7f6e\u6587\u4ef6"},{"location":"tantan/day05/#753","text":"package com.tanhua.server ; import com.github.tobato.fastdfs.domain.conn.FdfsWebServer ; import com.github.tobato.fastdfs.domain.fdfs.StorePath ; import com.github.tobato.fastdfs.service.FastFileStorageClient ; import org.apache.commons.io.FileUtils ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; import java.io.File ; import java.io.IOException ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestFastDFS { @Autowired protected FastFileStorageClient storageClient ; @Autowired private FdfsWebServer fdfsWebServer ; @Test public void testUpload (){ String path = \"F:\\\\1.jpg\" ; File file = new File ( path ); try { StorePath storePath = this . storageClient . uploadFile ( FileUtils . openInputStream ( file ), file . length (), \"jpg\" , null ); System . out . println ( storePath ); //StorePath [group=group1, path=M00/00/00/wKgfUV2GJSuAOUd_AAHnjh7KpOc1.1.jpg] System . out . println ( fdfsWebServer . getWebServerUrl () + storePath . getFullPath ()); //group1/M00/00/00/wKgfUV2GJSuAOUd_AAHnjh7KpOc1.1.jpg } catch ( IOException e ) { e . printStackTrace (); } } } \u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95ee\u56fe\u7247\uff1a","title":"7.5.3\u3001\u6d4b\u8bd5\u4ee3\u7801"},{"location":"tantan/day05/#8","text":"\u53d1\u5e03\u5c0f\u89c6\u9891\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a \u8bf4\u660e\uff1a \u7528\u6237\u53d1\u901a\u8fc7\u5ba2\u6237\u7aefAPP\u4e0a\u4f20\u89c6\u9891\u5230server\u670d\u52a1 server\u670d\u52a1\u4e0a\u4f20\u89c6\u9891\u5230FastDFS\u6587\u4ef6\u7cfb\u7edf\uff0c\u4e0a\u4f20\u6210\u529f\u540e\u8fd4\u56de\u89c6\u9891\u7684url\u5730\u5740 server\u901a\u8fc7rpc\u7684\u8c03\u7528dubbo\u670d\u52a1\u8fdb\u884c\u4fdd\u5b58\u5c0f\u89c6\u9891\u6570\u636e","title":"8\u3001\u53d1\u5e03\u5c0f\u89c6\u9891"},{"location":"tantan/day05/#81dubbo","text":"","title":"8.1\u3001dubbo\u670d\u52a1"},{"location":"tantan/day05/#811pojo","text":"\u5728dubbo\u63a5\u53e3\u5de5\u7a0b\u4e2d\u7f16\u5199pojo\uff1a package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.mongodb.core.mapping.Document ; import java.util.List ; @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"video\" ) public class Video implements java . io . Serializable { private static final long serialVersionUID = - 3136732836884933873L ; private ObjectId id ; //\u4e3b\u952eid private Long vid ; //\u81ea\u589e\u957fid private Long userId ; private String text ; //\u6587\u5b57 private String picUrl ; //\u89c6\u9891\u5c01\u9762\u6587\u4ef6 private String videoUrl ; //\u89c6\u9891\u6587\u4ef6 private Long created ; //\u521b\u5efa\u65f6\u95f4 private Integer seeType ; // \u8c01\u53ef\u4ee5\u770b\uff0c1-\u516c\u5f00\uff0c2-\u79c1\u5bc6\uff0c3-\u90e8\u5206\u53ef\u89c1\uff0c4-\u4e0d\u7ed9\u8c01\u770b private List < Long > seeList ; //\u90e8\u5206\u53ef\u89c1\u7684\u5217\u8868 private List < Long > notSeeList ; //\u4e0d\u7ed9\u8c01\u770b\u7684\u5217\u8868 private String longitude ; //\u7ecf\u5ea6 private String latitude ; //\u7eac\u5ea6 private String locationName ; //\u4f4d\u7f6e\u540d\u79f0 }","title":"8.1.1\u3001\u7f16\u5199pojo"},{"location":"tantan/day05/#812","text":"package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.pojo.Video ; public interface VideoApi { /** * \u4fdd\u5b58\u5c0f\u89c6\u9891 * * @param video * @return \u4fdd\u5b58\u6210\u529f\u540e\uff0c\u8fd4\u56de\u89c6\u9891id */ String saveVideo ( Video video ); }","title":"8.1.2\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day05/#813","text":"package com.tanhua.dubbo.server.api ; import cn.hutool.core.util.ObjectUtil ; import com.alibaba.dubbo.config.annotation.Service ; import com.mongodb.Mongo ; import com.tanhua.dubbo.server.enums.IdType ; import com.tanhua.dubbo.server.pojo.Video ; import com.tanhua.dubbo.server.service.IdService ; import lombok.extern.slf4j.Slf4j ; import org.bson.types.ObjectId ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.mongodb.core.MongoTemplate ; @Service ( version = \"1.0.0\" ) @Slf4j public class VideoApiImpl implements VideoApi { @Autowired private IdService idService ; @Autowired private MongoTemplate mongoTemplate ; /** * \u53d1\u5e03\u5c0f\u89c6\u9891 * * @param video * @return */ @Override public String saveVideo ( Video video ) { try { //\u6821\u9a8c if ( ! ObjectUtil . isAllNotEmpty ( video . getUserId (), video . getPicUrl (), video . getVideoUrl ())){ return null ; } //\u8bbe\u7f6eid video . setId ( ObjectId . get ()); video . setVid ( this . idService . createId ( IdType . VIDEO )); //\u53d1\u5e03\u65f6\u95f4 video . setCreated ( System . currentTimeMillis ()); //\u4fdd\u5b58\u5230Mongodb\u4e2d this . mongoTemplate . save ( video ); return video . getId (). toHexString (); } catch ( Exception e ) { log . error ( \"\u5c0f\u89c6\u9891\u53d1\u5e03\u5931\u8d25~ video = \" + video , e ); } return null ; } }","title":"8.1.3\u3001\u7f16\u5199\u5b9e\u73b0"},{"location":"tantan/day05/#82app","text":"\u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/821","title":"8.2\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day05/#821videocontroller","text":"package com.tanhua.server.controller ; import com.tanhua.server.service.VideoService ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RequestParam ; import org.springframework.web.bind.annotation.RestController ; import org.springframework.web.multipart.MultipartFile ; @RestController @RequestMapping ( \"smallVideos\" ) public class VideoController { @Autowired private VideoService videoService ; /** * \u53d1\u5e03\u5c0f\u89c6\u9891 * * @param picFile * @param videoFile * @return */ @PostMapping public ResponseEntity < Void > saveVideo ( @RequestParam ( \"videoThumbnail\" ) MultipartFile picFile , @RequestParam ( \"videoFile\" ) MultipartFile videoFile ) { try { Boolean bool = this . videoService . saveVideo ( picFile , videoFile ); if ( bool ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } }","title":"8.2.1\u3001VideoController"},{"location":"tantan/day05/#822videoservice","text":"package com.tanhua.server.service ; import cn.hutool.core.util.StrUtil ; import com.alibaba.dubbo.config.annotation.Reference ; import com.github.tobato.fastdfs.domain.conn.FdfsWebServer ; import com.github.tobato.fastdfs.domain.fdfs.StorePath ; import com.github.tobato.fastdfs.service.FastFileStorageClient ; import com.tanhua.common.pojo.User ; import com.tanhua.common.service.PicUploadService ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.common.vo.PicUploadResult ; import com.tanhua.dubbo.server.api.VideoApi ; import com.tanhua.dubbo.server.pojo.Video ; import lombok.extern.slf4j.Slf4j ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import org.springframework.web.multipart.MultipartFile ; @Service @Slf4j public class VideoService { @Autowired private PicUploadService picUploadService ; @Autowired protected FastFileStorageClient storageClient ; @Autowired private FdfsWebServer fdfsWebServer ; @Reference ( version = \"1.0.0\" ) private VideoApi videoApi ; /** * \u53d1\u5e03\u5c0f\u89c6\u9891 * * @param picFile * @param videoFile * @return */ public Boolean saveVideo ( MultipartFile picFile , MultipartFile videoFile ) { User user = UserThreadLocal . get (); Video video = new Video (); video . setUserId ( user . getId ()); video . setSeeType ( 1 ); //\u9ed8\u8ba4\u516c\u5f00 try { //\u4e0a\u4f20\u5c01\u9762\u56fe\u7247 PicUploadResult picUploadResult = this . picUploadService . upload ( picFile ); video . setPicUrl ( picUploadResult . getName ()); //\u56fe\u7247\u8def\u5f84 //\u4e0a\u4f20\u89c6\u9891 StorePath storePath = storageClient . uploadFile ( videoFile . getInputStream (), videoFile . getSize (), StrUtil . subAfter ( videoFile . getOriginalFilename (), '.' , true ), null ); //\u8bbe\u7f6e\u89c6\u9891url video . setVideoUrl ( fdfsWebServer . getWebServerUrl () + storePath . getFullPath ()); String videoId = this . videoApi . saveVideo ( video ); return StrUtil . isNotEmpty ( videoId ); } catch ( Exception e ) { log . error ( \"\u53d1\u5e03\u5c0f\u89c6\u9891\u5931\u8d25\uff01file = \" + picFile . getOriginalFilename () , e ); } return false ; } }","title":"8.2.2\u3001VideoService"},{"location":"tantan/day05/#543","text":"\u5982\u679c\u4e0a\u4f20\u89c6\u9891\uff0c\u4f1a\u5bfc\u81f4\u5f02\u5e38\uff0c\u662f\u56e0\u4e3a\u8bf7\u6c42\u592a\u5927\u7684\u7f18\u6545\uff1a \u89e3\u51b3\uff1aapplication.properties spring.servlet.multipart.max-file-size = 30MB spring.servlet.multipart.max-request-size = 30MB \u6d4b\u8bd5\uff1a \u53ef\u4ee5\u770b\u5230\u6570\u636e\u5df2\u7ecf\u5199\u5165\u5230\u4e86MongoDB\u4e2d\u3002","title":"5.4.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day05/#9","text":"\u5c0f\u89c6\u9891\u7684\u5217\u8868\u67e5\u8be2\u7684\u5b9e\u73b0\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u6709\u63a8\u8350\u89c6\u9891\uff0c\u4f18\u5148\u8fd4\u56de\u63a8\u8350\u89c6\u9891\uff0c\u5982\u679c\u4e0d\u591f\u6216\u6ca1\u6709\uff0c\u6309\u7167\u65f6\u95f4\u5012\u5e8f\u67e5\u8be2\u89c6\u9891\u8868\u3002 \u63a8\u8350\u6570\u636e\uff1a","title":"9\u3001\u5c0f\u89c6\u9891\u5217\u8868"},{"location":"tantan/day05/#91dubbo","text":"","title":"9.1\u3001dubbo\u670d\u52a1"},{"location":"tantan/day05/#911dubbo","text":"package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.pojo.Video ; import com.tanhua.dubbo.server.vo.PageInfo ; public interface VideoApi { /** * \u4fdd\u5b58\u5c0f\u89c6\u9891 * * @param video * @return */ Boolean saveVideo ( Video video ); /** * \u5206\u9875\u67e5\u8be2\u5c0f\u89c6\u9891\u5217\u8868\uff0c\u6309\u7167\u65f6\u95f4\u5012\u5e8f\u6392\u5e8f * * @param userId * @param page * @param pageSize * @return */ PageInfo < Video > queryVideoList ( Long userId , Integer page , Integer pageSize ); }","title":"9.1.1\u3001\u5b9a\u4e49dubbo\u670d\u52a1"},{"location":"tantan/day05/#912dubbo","text":"//com.tanhua.dubbo.server.api.VideoApiImpl /** * \u67e5\u8be2\u5c0f\u89c6\u9891\u5217\u8868\uff0c\u4f18\u5148\u5c55\u73b0\u63a8\u8350\u7684\u89c6\u9891\uff0c\u5982\u679c\u6ca1\u6709\u63a8\u8350\u7684\u89c6\u9891\u6216\u5df2\u7ecf\u67e5\u8be2\u5b8c\u6210\uff0c\u5c31\u9700\u8981\u67e5\u8be2\u7cfb\u7edf\u89c6\u9891\u6570\u636e * * @param userId * @param page * @param pageSize * @return */ @Override public PageInfo < Video > queryVideoList ( Long userId , Integer page , Integer pageSize ) { PageInfo < Video > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); //\u4eceredis\u4e2d\u83b7\u53d6\u63a8\u8350\u89c6\u9891\u7684\u6570\u636e String redisKey = \"QUANZI_VIDEO_RECOMMEND_\" + userId ; String redisData = this . redisTemplate . opsForValue (). get ( redisKey ); List < Long > vids = new ArrayList <> (); int recommendCount = 0 ; if ( StrUtil . isNotEmpty ( redisData )) { //\u624b\u52a8\u5206\u9875\u67e5\u8be2\u6570\u636e List < String > vidList = StrUtil . split ( redisData , ',' ); //\u8ba1\u7b97\u5206\u9875 //[0, 10] int [] startEnd = PageUtil . transToStartEnd ( page - 1 , pageSize ); int startIndex = startEnd [ 0 ] ; //\u5f00\u59cb int endIndex = Math . min ( startEnd [ 1 ] , vidList . size ()); //\u7ed3\u675f for ( int i = startIndex ; i < endIndex ; i ++ ) { vids . add ( Convert . toLong ( vidList . get ( i ))); } recommendCount = vidList . size (); } if ( CollUtil . isEmpty ( vids )) { //\u6ca1\u6709\u63a8\u8350\u6216\u524d\u9762\u63a8\u8350\u5df2\u7ecf\u67e5\u8be2\u5b8c\u6bd5\uff0c\u67e5\u8be2\u7cfb\u7edf\u7684\u89c6\u9891\u6570\u636e //\u8ba1\u7b97\u524d\u9762\u7684\u63a8\u8350\u89c6\u9891\u9875\u6570 int totalPage = PageUtil . totalPage ( recommendCount , pageSize ); PageRequest pageRequest = PageRequest . of ( page - totalPage - 1 , pageSize , Sort . by ( Sort . Order . desc ( \"created\" ))); Query query = new Query (). with ( pageRequest ); List < Video > videoList = this . mongoTemplate . find ( query , Video . class ); pageInfo . setRecords ( videoList ); return pageInfo ; } //\u6839\u636evid\u67e5\u8be2\u5bf9\u5e94\u7684\u89c6\u9891\u6570\u636e\u4e86 Query query = Query . query ( Criteria . where ( \"vid\" ). in ( vids )); List < Video > videoList = this . mongoTemplate . find ( query , Video . class ); pageInfo . setRecords ( videoList ); return pageInfo ; }","title":"9.1.2\u3001\u5b9e\u73b0dubbo\u670d\u52a1"},{"location":"tantan/day05/#913","text":"package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.pojo.Video ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestVideoApi { @Autowired private VideoApi videoApi ; @Test public void testQueryVideoList () { //\u8fd4\u56de\u7684\u63a8\u8350\u7ed3\u679c\u6570\u636e System . out . println ( this . videoApi . queryVideoList ( 1L , 1 , 8 )); //\u8fd4\u56de\u5c11\u4e8epageSize\u6570\u636e\uff0c\u56e0\u4e3a\u63a8\u8350\u6570\u636e\u4e0d\u591f\u4e86 System . out . println ( this . videoApi . queryVideoList ( 1L , 3 , 8 )); //\u8fd4\u56de\u7cfb\u7edf\u6570\u636e System . out . println ( this . videoApi . queryVideoList ( 1L , 4 , 8 )); } }","title":"9.1.3\u3001\u6d4b\u8bd5\u7528\u4f8b"},{"location":"tantan/day05/#92app","text":"\u670d\u52a1\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/815","title":"9.2\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day05/#921videovo","text":"package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class VideoVo { private String id ; private Long userId ; private String avatar ; //\u5934\u50cf private String nickname ; //\u6635\u79f0 private String cover ; //\u5c01\u9762 private String videoUrl ; //\u89c6\u9891URL private String signature ; //\u7b7e\u540d private Integer likeCount ; //\u70b9\u8d5e\u6570\u91cf private Integer hasLiked ; //\u662f\u5426\u5df2\u8d5e\uff081\u662f\uff0c0\u5426\uff09 private Integer hasFocus ; //\u662f\u662f\u5426\u5173\u6ce8 \uff081\u662f\uff0c0\u5426\uff09 private Integer commentCount ; //\u8bc4\u8bba\u6570\u91cf }","title":"9.2.1\u3001\u5b9a\u4e49VideoVo"},{"location":"tantan/day05/#922videocontroller","text":"@RestController @RequestMapping ( \"smallVideos\" ) public class VideoController { /** * \u67e5\u8be2\u5c0f\u89c6\u9891\u5217\u8868 * * @param page * @param pageSize * @return */ @GetMapping public ResponseEntity < PageResult > queryVideoList ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize ) { try { if ( page <= 0 ) { page = 1 ; } PageResult pageResult = this . videoService . queryVideoList ( page , pageSize ); if ( null != pageResult ) { return ResponseEntity . ok ( pageResult ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } }","title":"9.2.2\u3001VideoController"},{"location":"tantan/day05/#923videoservice","text":"//com.tanhua.server.service.VideoService public PageResult queryVideoList ( Integer page , Integer pageSize ) { User user = UserThreadLocal . get (); PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); PageInfo < Video > pageInfo = this . videoApi . queryVideoList ( user . getId (), page , pageSize ); List < Video > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )){ return pageResult ; } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIds = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); List < VideoVo > videoVoList = new ArrayList <> (); for ( Video record : records ) { VideoVo videoVo = new VideoVo (); videoVo . setUserId ( record . getUserId ()); videoVo . setCover ( record . getPicUrl ()); videoVo . setVideoUrl ( record . getVideoUrl ()); videoVo . setId ( record . getId (). toHexString ()); videoVo . setSignature ( \"\u6211\u5c31\u662f\u6211~\" ); //TODO \u7b7e\u540d videoVo . setCommentCount ( 0 ); //TODO \u8bc4\u8bba\u6570 videoVo . setHasFocus ( 0 ); //TODO \u662f\u5426\u5173\u6ce8 videoVo . setHasLiked ( 0 ); //TODO \u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 videoVo . setLikeCount ( 0 ); //TODO \u70b9\u8d5e\u6570 //\u586b\u5145\u7528\u6237\u4fe1\u606f for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( videoVo . getUserId (), userInfo . getUserId ())) { videoVo . setNickname ( userInfo . getNickName ()); videoVo . setAvatar ( userInfo . getLogo ()); break ; } } videoVoList . add ( videoVo ); } pageResult . setItems ( videoVoList ); return pageResult ; }","title":"9.2.3\u3001VideoService"},{"location":"tantan/day05/#925","text":"\u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u67e5\u8be2\u5230\u6570\u636e\u3002\u4e0b\u9762\u4f7f\u7528\u624b\u673a\u8fdb\u884c\u6d4b\u8bd5\uff1a","title":"9.2.5\u3001\u6d4b\u8bd5"},{"location":"tantan/day05/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/","text":"\u72ec\u7acb\u5b8c\u6210\u5708\u5b50\u7684\u70b9\u8d5e\u529f\u80fd \u72ec\u7acb\u5b8c\u6210\u5708\u5b50\u7684\u559c\u6b22\u529f\u80fd \u72ec\u7acb\u5b8c\u6210\u5708\u5b50\u7684\u8bc4\u8bba\u529f\u80fd \u4e86\u89e3\u5c0f\u89c6\u9891\u7684\u529f\u80fd \u4e86\u89e3FastDFS\u662f\u4ec0\u4e48 \u72ec\u7acb\u5b8c\u6210\u5c0f\u89c6\u9891\u7684\u53d1\u5e03 \u72ec\u7acb\u5b8c\u6210\u5c0f\u89c6\u9891\u7684\u67e5\u8be2","title":"\u5b66\u4e60\u76ee\u6807"},{"location":"tantan/day06/","text":"\u8bfe\u7a0b\u8bf4\u660e \u00b6 \u5b9e\u73b0\u89c6\u9891\u70b9\u8d5e\u3001\u8bc4\u8bba\u3001\u5173\u6ce8\u529f\u80fd \u4e86\u89e3\u4ec0\u4e48\u662f\u5373\u65f6\u901a\u4fe1 \u4e86\u89e3\u63a2\u82b1\u4ea4\u53cb\u7684\u6d88\u606f\u529f\u80fd \u4e86\u89e3\u5373\u65f6\u901a\u4fe1\u7684\u6280\u672f\u65b9\u6848 \u4e86\u89e3\u73af\u4fe1\u7684\u5373\u65f6\u901a\u8baf \u5b9e\u73b0\u73af\u4fe1\u7684\u7528\u6237\u4f53\u7cfb\u96c6\u6210 \u5b9e\u73b0\u6dfb\u52a0\u8054\u7cfb\u4eba\u3001\u8054\u7cfb\u4eba\u5217\u8868\u529f\u80fd 1\u3001\u89c6\u9891\u70b9\u8d5e \u00b6 \u70b9\u8d5e\u903b\u8f91\u4e0e\u5708\u5b50\u70b9\u8d5e\u903b\u8f91\u4e00\u81f4\uff0c\u6240\u4ee5\u53ef\u4ee5\u590d\u7528\u5708\u5b50\u70b9\u8d5e\u7684\u903b\u8f91\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\u70b9\u8d5e\u5bf9\u8c61\u662fVideo\uff0c\u8bbe\u7f6epublishUserId\u7684\u903b\u8f91\u4e5f\u9700\u8981\u5b8c\u5584\u4e0b\u3002 1.1\u3001dubbo\u670d\u52a1 \u00b6 \u4fee\u6539\u4fdd\u5b58Comment\u903b\u8f91\uff0c\u5728\u539f\u6709\u903b\u8f91\u4e2d\u589e\u52a0\u5bf9\u5c0f\u89c6\u9891\u7684\u652f\u6301\uff1a //com.tanhua.dubbo.server.api.QuanZiApiImpl /** * \u4fdd\u5b58Comment * * @return */ private Boolean saveComment ( Long userId , String publishId , CommentType commentType , String content ) { try { Comment comment = new Comment (); comment . setId ( ObjectId . get ()); comment . setUserId ( userId ); comment . setPublishId ( new ObjectId ( publishId )); // \u8bc4\u8bba\u7c7b\u578b comment . setCommentType ( commentType . getType ()); // \u5185\u5bb9 comment . setContent ( content ); comment . setCreated ( System . currentTimeMillis ()); Publish publish = this . queryPublishById ( publishId ); if ( ObjectUtil . isNotEmpty ( publish )) { comment . setPublishUserId ( publish . getUserId ()); } else { //\u67e5\u8be2\u8bc4\u8bba Comment myComment = this . queryCommentById ( publishId ); if ( ObjectUtil . isNotEmpty ( myComment )){ comment . setPublishUserId ( myComment . getUserId ()); } else { //\u67e5\u8be2\u5c0f\u89c6\u9891 Video video = this . videoApi . queryVideoById ( publishId ); if ( ObjectUtil . isNotEmpty ( video )){ comment . setPublishUserId ( video . getUserId ()); } else { // \u5176\u4ed6\u60c5\u51b5\uff0c\u76f4\u63a5\u8fd4\u56de return false ; } } } this . mongoTemplate . save ( comment ); return true ; } catch ( Exception e ) { log . error ( \"\u4fdd\u5b58Comment\u51fa\u9519~ userId = \" + userId + \", publishId = \" + publishId + \", commentType = \" + commentType , e ); } return false ; } \u5728VideoApi\u4e2d\u5b9a\u4e49\u6839\u636eid\u67e5\u8be2Video\u7684\u65b9\u6cd5\uff1a // com.tanhua.dubbo.server.api.VideoApi /** * \u6839\u636eid\u67e5\u8be2\u89c6\u9891\u5bf9\u8c61 * * @param videoId \u5c0f\u89c6\u9891id * @return */ Video queryVideoById ( String videoId ); \u7f16\u5199\u5b9e\u73b0\uff1a // com.tanhua.dubbo.server.api.VideoApiImpl @Override public Video queryVideoById ( String videoId ) { return this . mongoTemplate . findById ( new ObjectId ( videoId ), Video . class ); } 1.2\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 \u63a5\u53e3\u5730\u5740\uff1a \u70b9\u8d5e https://mock-java.itheima.net/project/35/interface/api/827 \u53d6\u6d88\u70b9\u8d5e\uff1ahttps://mock-java.itheima.net/project/35/interface/api/833 1.2.1\u3001VideoController \u00b6 /** * \u89c6\u9891\u70b9\u8d5e * * @param videoId \u89c6\u9891id * @return */ @PostMapping ( \"/{id}/like\" ) public ResponseEntity < Long > likeComment ( @PathVariable ( \"id\" ) String videoId ) { try { Long likeCount = this . videoService . likeComment ( videoId ); if ( likeCount != null ) { return ResponseEntity . ok ( likeCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u53d6\u6d88\u70b9\u8d5e * * @param videoId * @return */ @PostMapping ( \"/{id}/dislike\" ) public ResponseEntity < Long > disLikeComment ( @PathVariable ( \"id\" ) String videoId ) { try { Long likeCount = this . videoService . disLikeComment ( videoId ); if ( null != likeCount ) { return ResponseEntity . ok ( likeCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 1.2.2\u3001VideoService \u00b6 //com.tanhua.server.service.VideoService /** * \u70b9\u8d5e * * @param videoId * @return */ public Long likeComment ( String videoId ) { User user = UserThreadLocal . get (); Boolean result = this . quanZiApi . likeComment ( user . getId (), videoId ); if ( result ) { return this . quanZiApi . queryLikeCount ( videoId ); } return null ; } /** * \u53d6\u6d88\u70b9\u8d5e * * @param videoId * @return */ public Long disLikeComment ( String videoId ) { User user = UserThreadLocal . get (); Boolean result = this . quanZiApi . disLikeComment ( user . getId (), videoId ); if ( result ) { return this . quanZiApi . queryLikeCount ( videoId ); } return null ; } 1.2.3\u3001\u4fee\u6539\u70b9\u8d5e\u6570\u67e5\u8be2 \u00b6 \u5728\u67e5\u8be2\u5c0f\u89c6\u9891\u5217\u8868\u4e2d\uff0c\u9700\u8981\u5b8c\u5584\u4e4b\u524dTODO\u7684\u90e8\u5206\u3002 //com.tanhua.server.service.VideoService public PageResult queryVideoList ( Integer page , Integer pageSize ) { User user = UserThreadLocal . get (); PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); PageInfo < Video > pageInfo = this . videoApi . queryVideoList ( user . getId (), page , pageSize ); List < Video > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )) { return pageResult ; } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIds = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); List < VideoVo > videoVoList = new ArrayList <> (); for ( Video record : records ) { VideoVo videoVo = new VideoVo (); videoVo . setUserId ( record . getUserId ()); videoVo . setCover ( record . getPicUrl ()); videoVo . setVideoUrl ( record . getVideoUrl ()); videoVo . setId ( record . getId (). toHexString ()); videoVo . setSignature ( \"\u6211\u5c31\u662f\u6211~\" ); //TODO \u7b7e\u540d videoVo . setCommentCount ( 0 ); //TODO \u8bc4\u8bba\u6570 videoVo . setHasFocus ( 0 ); //TODO \u662f\u5426\u5173\u6ce8 videoVo . setHasLiked ( this . quanZiApi . queryUserIsLike ( user . getId (), videoVo . getId ()) ? 1 : 0 ); //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 videoVo . setLikeCount ( Convert . toInt ( this . quanZiApi . queryLikeCount ( videoVo . getId ()))); //\u70b9\u8d5e\u6570 //\u586b\u5145\u7528\u6237\u4fe1\u606f for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( videoVo . getUserId (), userInfo . getUserId ())) { videoVo . setNickname ( userInfo . getNickName ()); videoVo . setAvatar ( userInfo . getLogo ()); break ; } } videoVoList . add ( videoVo ); } pageResult . setItems ( videoVoList ); return pageResult ; } 2\u3001\u89c6\u9891\u8bc4\u8bba \u00b6 \u5c0f\u89c6\u9891\u7684\u8bc4\u8bba\u4e0e\u5708\u5b50\u7684\u8bc4\u8bba\u903b\u8f91\u7c7b\u4f3c\uff0c\u6240\u4ee5\u4e5f\u53ef\u4ee5\u4f7f\u7528\u540c\u4e00\u5957\u903b\u8f91\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u5f00\u53d1APP\u63a5\u53e3\u529f\u80fd\u5373\u53ef\u3002 \u8bc4\u8bba\u76f8\u5173\u7684\u63a5\u53e3\u5b9a\u4e49\uff1a \u53d1\u5e03\u8bc4\u8bba\uff1ahttps://mock-java.itheima.net/project/35/interface/api/857 \u8bc4\u8bba\u5217\u8868\uff1ahttps://mock-java.itheima.net/project/35/interface/api/851 \u8bc4\u8bba\u70b9\u8d5e\uff1ahttps://mock-java.itheima.net/project/35/interface/api/863 \u8bc4\u8bba\u53d6\u6d88\u70b9\u8d5e\uff1ahttps://mock-java.itheima.net/project/35/interface/api/869 2.1\u3001VideoController \u00b6 //com.tanhua.server.controller.VideoController /** * \u8bc4\u8bba\u5217\u8868 */ @GetMapping ( \"/{id}/comments\" ) public ResponseEntity < PageResult > queryCommentsList ( @PathVariable ( \"id\" ) String videoId , @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize ) { try { PageResult pageResult = this . videoService . queryCommentList ( videoId , page , pageSize ); return ResponseEntity . ok ( pageResult ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u63d0\u4ea4\u8bc4\u8bba * * @param param * @param videoId * @return */ @PostMapping ( \"/{id}/comments\" ) public ResponseEntity < Void > saveComments ( @RequestBody Map < String , String > param , @PathVariable ( \"id\" ) String videoId ) { try { String content = param . get ( \"comment\" ); Boolean result = this . videoService . saveComment ( videoId , content ); if ( result ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u8bc4\u8bba\u70b9\u8d5e * * @param videoCommentId \u89c6\u9891\u4e2d\u7684\u8bc4\u8bbaid * @return */ @PostMapping ( \"/comments/{id}/like\" ) public ResponseEntity < Long > commentsLikeComment ( @PathVariable ( \"id\" ) String videoCommentId ) { try { Long likeCount = this . videoService . likeComment ( videoCommentId ); if ( likeCount != null ) { return ResponseEntity . ok ( likeCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u8bc4\u8bba\u53d6\u6d88\u70b9\u8d5e * * @param videoCommentId \u89c6\u9891\u4e2d\u7684\u8bc4\u8bbaid * @return */ @PostMapping ( \"/comments/{id}/dislike\" ) public ResponseEntity < Long > disCommentsLikeComment ( @PathVariable ( \"id\" ) String videoCommentId ) { try { Long likeCount = this . videoService . disLikeComment ( videoCommentId ); if ( null != likeCount ) { return ResponseEntity . ok ( likeCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 2.2\u3001VideoService \u00b6 // com.tanhua.server.service.VideoService public PageResult queryCommentList ( String videoId , Integer page , Integer pageSize ) { return this . quanZiService . queryCommentList ( videoId , page , pageSize ); } public Boolean saveComment ( String videoId , String content ) { return this . quanZiService . saveComments ( videoId , content ); } 2.3\u3001\u67e5\u8be2\u8bc4\u8bba\u6570 \u00b6 \u5728\u5c0f\u89c6\u9891\u5217\u8868\u67e5\u8be2\u7ed3\u679c\u4e2d\uff0c\u9700\u8981\u8fd4\u56de\u8be5\u89c6\u9891\u7684\u8bc4\u8bba\u6570\u636e\uff0c\u7531\u4e8e\u4e4b\u524d\u5728dubbo\u670d\u52a1\u4e2d\u6ca1\u6709\u63d0\u4f9b\u67e5\u8be2\u65b9\u6cd5\uff0c\u6240\u4ee5\u9700\u8981\u5148\u5b9e\u73b0\u67e5\u8be2\u65b9\u6cd5\u3002 2.3.1\u3001dubbo\u670d\u52a1 \u00b6 2.3.1.1\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 //com.tanhua.dubbo.server.api.QuanZiApi /** * \u67e5\u8be2\u8bc4\u8bba\u6570 * * @param publishId * @return */ Long queryCommentCount ( String publishId ); 2.3.1.2\u3001\u7f16\u5199\u5b9e\u73b0 \u00b6 // com.tanhua.dubbo.server.api.QuanZiApiImpl @Override public Long queryCommentCount ( String publishId ) { return this . queryCommentCount ( publishId , CommentType . COMMENT ); } 2.3.2\u3001\u67e5\u8be2\u8bc4\u8bba\u6570 \u00b6 //com.tanhua.server.service.VideoService public PageResult queryVideoList ( Integer page , Integer pageSize ) { User user = UserThreadLocal . get (); PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); PageInfo < Video > pageInfo = this . videoApi . queryVideoList ( user . getId (), page , pageSize ); List < Video > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )) { return pageResult ; } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIds = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); List < VideoVo > videoVoList = new ArrayList <> (); for ( Video record : records ) { VideoVo videoVo = new VideoVo (); videoVo . setUserId ( record . getUserId ()); videoVo . setCover ( record . getPicUrl ()); videoVo . setVideoUrl ( record . getVideoUrl ()); videoVo . setId ( record . getId (). toHexString ()); videoVo . setSignature ( \"\u6211\u5c31\u662f\u6211~\" ); //TODO \u7b7e\u540d videoVo . setCommentCount ( Convert . toInt ( this . quanZiApi . queryCommentCount ( videoVo . getId ()))); //\u8bc4\u8bba\u6570 videoVo . setHasFocus ( 0 ); //TODO \u662f\u5426\u5173\u6ce8 videoVo . setHasLiked ( this . quanZiApi . queryUserIsLike ( user . getId (), videoVo . getId ()) ? 1 : 0 ); //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 videoVo . setLikeCount ( Convert . toInt ( this . quanZiApi . queryLikeCount ( videoVo . getId ()))); //\u70b9\u8d5e\u6570 //\u586b\u5145\u7528\u6237\u4fe1\u606f for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( videoVo . getUserId (), userInfo . getUserId ())) { videoVo . setNickname ( userInfo . getNickName ()); videoVo . setAvatar ( userInfo . getLogo ()); break ; } } videoVoList . add ( videoVo ); } pageResult . setItems ( videoVoList ); return pageResult ; } 2.4\u3001\u6d4b\u8bd5 \u00b6 3\u3001\u5173\u6ce8\u7528\u6237 \u00b6 \u5173\u6ce8\u7528\u6237\u662f\u5173\u6ce8\u5c0f\u89c6\u9891\u53d1\u5e03\u7684\u4f5c\u8005\uff0c\u9700\u8981\u5728dubbo\u670d\u52a1\u4e2d\u63d0\u4f9b\u7ed9\u76f8\u5173\u7684\u670d\u52a1\u3002 3.1\u3001dubbo\u670d\u52a1 \u00b6 3.1.1\u3001FollowUser \u00b6 package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.mongodb.core.mapping.Document ; /** * \u5173\u6ce8\u7528\u6237 */ @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"follow_user\" ) public class FollowUser implements java . io . Serializable { private static final long serialVersionUID = 3148619072405056052L ; private ObjectId id ; //\u4e3b\u952eid private Long userId ; //\u7528\u6237id private Long followUserId ; //\u5173\u6ce8\u7684\u7528\u6237id private Long created ; //\u5173\u6ce8\u65f6\u95f4 } 3.1.2\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 //com.tanhua.dubbo.server.api.VideoApi /** * \u5173\u6ce8\u7528\u6237 * * @param userId \u5f53\u524d\u7528\u6237 * @param followUserId \u5173\u6ce8\u7684\u76ee\u6807\u7528\u6237 * @return */ Boolean followUser ( Long userId , Long followUserId ); /** * \u53d6\u6d88\u5173\u6ce8\u7528\u6237 * * @param userId \u5f53\u524d\u7528\u6237 * @param followUserId \u5173\u6ce8\u7684\u76ee\u6807\u7528\u6237 * @return */ Boolean disFollowUser ( Long userId , Long followUserId ); /** * \u67e5\u8be2\u7528\u6237\u662f\u5426\u5173\u6ce8\u67d0\u4e2a\u7528\u6237 * * @param userId \u5f53\u524d\u7528\u6237 * @param followUserId \u5173\u6ce8\u7684\u76ee\u6807\u7528\u6237 * @return */ Boolean isFollowUser ( Long userId , Long followUserId ); 3.1.3\u3001\u7f16\u5199\u5b9e\u73b0 \u00b6 //com.tanhua.dubbo.server.api.VideoApiImpl private static final String VIDEO_FOLLOW_USER_KEY_PREFIX = \"VIDEO_FOLLOW_USER_\" ; @Override public Boolean followUser ( Long userId , Long followUserId ) { if ( ! ObjectUtil . isAllNotEmpty ( userId , followUserId )) { return false ; } try { //\u9700\u8981\u5c06\u7528\u6237\u7684\u5173\u6ce8\u5217\u8868\uff0c\u4fdd\u5b58\u5230redis\u4e2d\uff0c\u65b9\u4fbf\u540e\u7eed\u7684\u67e5\u8be2 //\u4f7f\u7528redis\u7684hash\u7ed3\u6784 if ( this . isFollowUser ( userId , followUserId )) { return false ; } FollowUser followUser = new FollowUser (); followUser . setId ( ObjectId . get ()); followUser . setUserId ( userId ); followUser . setFollowUserId ( followUserId ); followUser . setCreated ( System . currentTimeMillis ()); this . mongoTemplate . save ( followUser ); //\u4fdd\u5b58\u6570\u636e\u5230redis String redisKey = this . getVideoFollowUserKey ( userId ); String hashKey = String . valueOf ( followUserId ); this . redisTemplate . opsForHash (). put ( redisKey , hashKey , \"1\" ); return true ; } catch ( Exception e ) { e . printStackTrace (); } return false ; } @Override public Boolean disFollowUser ( Long userId , Long followUserId ) { if ( ! ObjectUtil . isAllNotEmpty ( userId , followUserId )) { return false ; } if ( ! this . isFollowUser ( userId , followUserId )) { return false ; } //\u53d6\u6d88\u5173\u6ce8\uff0c\u5220\u9664\u5173\u6ce8\u6570\u636e\u5373\u53ef Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId ) . and ( \"followUserId\" ). is ( followUserId ) ); DeleteResult result = this . mongoTemplate . remove ( query , FollowUser . class ); if ( result . getDeletedCount () > 0 ) { //\u540c\u65f6\u5220\u9664redis\u4e2d\u7684\u6570\u636e String redisKey = this . getVideoFollowUserKey ( userId ); String hashKey = String . valueOf ( followUserId ); this . redisTemplate . opsForHash (). delete ( redisKey , hashKey ); return true ; } return false ; } @Override public Boolean isFollowUser ( Long userId , Long followUserId ) { String redisKey = this . getVideoFollowUserKey ( userId ); String hashKey = String . valueOf ( followUserId ); return this . redisTemplate . opsForHash (). hasKey ( redisKey , hashKey ); } private String getVideoFollowUserKey ( Long userId ) { return VIDEO_FOLLOW_USER_KEY_PREFIX + userId ; } 3.2\u3001APP\u670d\u52a1 \u00b6 \u5173\u6ce8\u7528\u6237\uff1ahttps://mock-java.itheima.net/project/35/interface/api/839 \u53d6\u6d88\u5173\u6ce8\uff1ahttps://mock-java.itheima.net/project/35/interface/api/845 3.2.1\u3001VideoController \u00b6 //com.tanhua.server.controller.VideoController /** * \u89c6\u9891\u7528\u6237\u5173\u6ce8 */ @PostMapping ( \"/{id}/userFocus\" ) public ResponseEntity < Void > saveUserFocusComments ( @PathVariable ( \"id\" ) Long userId ) { try { Boolean bool = this . videoService . followUser ( userId ); if ( bool ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u53d6\u6d88\u89c6\u9891\u7528\u6237\u5173\u6ce8 */ @PostMapping ( \"/{id}/userUnFocus\" ) public ResponseEntity < Void > saveUserUnFocusComments ( @PathVariable ( \"id\" ) Long userId ) { try { Boolean bool = this . videoService . disFollowUser ( userId ); if ( bool ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 3.2.2\u3001VideoService \u00b6 //com.tanhua.server.service.VideoService /** * \u5173\u6ce8\u7528\u6237 * * @param userId * @return */ public Boolean followUser ( Long userId ) { User user = UserThreadLocal . get (); return this . videoApi . followUser ( user . getId (), userId ); } /** * \u53d6\u6d88\u5173\u6ce8 * * @param userId * @return */ public Boolean disFollowUser ( Long userId ) { User user = UserThreadLocal . get (); return this . videoApi . disFollowUser ( user . getId (), userId ); } 3.2.3\u3001\u67e5\u8be2\u662f\u5426\u5173\u6ce8 \u00b6 //com.tanhua.server.service.VideoService public PageResult queryVideoList ( Integer page , Integer pageSize ) { User user = UserThreadLocal . get (); PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); PageInfo < Video > pageInfo = this . videoApi . queryVideoList ( user . getId (), page , pageSize ); List < Video > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )) { return pageResult ; } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIds = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); List < VideoVo > videoVoList = new ArrayList <> (); for ( Video record : records ) { VideoVo videoVo = new VideoVo (); videoVo . setUserId ( record . getUserId ()); videoVo . setCover ( record . getPicUrl ()); videoVo . setVideoUrl ( record . getVideoUrl ()); videoVo . setId ( record . getId (). toHexString ()); videoVo . setSignature ( \"\u6211\u5c31\u662f\u6211~\" ); //TODO \u7b7e\u540d videoVo . setCommentCount ( Convert . toInt ( this . quanZiApi . queryCommentCount ( videoVo . getId ()))); //\u8bc4\u8bba\u6570 videoVo . setHasFocus ( this . videoApi . isFollowUser ( user . getId (), videoVo . getUserId ()) ? 1 : 0 ); //\u662f\u5426\u5173\u6ce8 videoVo . setHasLiked ( this . quanZiApi . queryUserIsLike ( user . getId (), videoVo . getId ()) ? 1 : 0 ); //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 videoVo . setLikeCount ( Convert . toInt ( this . quanZiApi . queryLikeCount ( videoVo . getId ()))); //\u70b9\u8d5e\u6570 //\u586b\u5145\u7528\u6237\u4fe1\u606f for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( videoVo . getUserId (), userInfo . getUserId ())) { videoVo . setNickname ( userInfo . getNickName ()); videoVo . setAvatar ( userInfo . getLogo ()); break ; } } videoVoList . add ( videoVo ); } pageResult . setItems ( videoVoList ); return pageResult ; } 3.3\u3001\u6d4b\u8bd5 \u00b6 \u53ef\u4ee5\u770b\u5230\uff0c\u5df2\u7ecf\u5b8c\u6210\u4e86\u5173\u6ce8\u7528\u6237\u3002 4\u3001\u5373\u65f6\u901a\u4fe1 \u00b6 4.1\u3001\u4ec0\u4e48\u662f\u5373\u65f6\u901a\u4fe1\uff1f \u00b6 4.2\u3001\u529f\u80fd\u8bf4\u660e \u00b6 \u5728\u63a2\u82b1\u4ea4\u53cb\u9879\u76ee\u4e2d\u4e5f\u63d0\u4f9b\u4e86\u7c7b\u4f3c\u5fae\u4fe1\u7684\u804a\u5929\u529f\u80fd\uff0c\u7528\u6237\u53ef\u4ee5\u548c\u597d\u53cb\u6216\u964c\u751f\u4eba\u804a\u5929\u3002 \u5982\u679c\u662f\u964c\u751f\u4eba\uff0c\u901a\u8fc7\u300a\u804a\u4e00\u4e0b\u300b\u529f\u80fd\u8fdb\u884c\u6253\u62db\u547c\uff0c\u5982\u679c\u5bf9\u65b9\u540c\u610f\u540e\uff0c\u5c31\u6210\u4e3a\u4e86\u597d\u53cb\uff0c\u53ef\u4ee5\u8fdb\u884c\u804a\u5929\u4e86\u3002 \u964c\u751f\u4eba\u4e4b\u95f4\u5982\u679c\u76f8\u4e92\u559c\u6b22\uff0c\u90a3\u4e48\u5c31\u4f1a\u6210\u4e3a\u597d\u53cb\uff0c\u4e5f\u5c31\u53ef\u4ee5\u804a\u5929\u4e86\u3002 \u5728\u6d88\u606f\u754c\u9762\u4e2d\u4e5f\u53ef\u4ee5\u67e5\u770b\uff1a\u70b9\u8d5e\u3001\u8bc4\u8bba\u3001\u559c\u6b22\u3001\u516c\u544a\u7b49\u6d88\u606f\u4fe1\u606f\u3002 5\u3001\u6280\u672f\u65b9\u6848 \u00b6 \u5bf9\u4e8e\u9ad8\u5e76\u53d1\u7684\u5373\u65f6\u901a\u8baf\u5b9e\u73b0\uff0c\u8fd8\u662f\u5f88\u6709\u6311\u6218\u7684\uff0c\u6240\u9700\u8981\u8003\u8651\u7684\u70b9\u975e\u5e38\u591a\uff0c\u9664\u4e86\u8981\u5b9e\u73b0\u529f\u80fd\uff0c\u8fd8\u8981\u8003\u8651\u5e76\u53d1\u3001\u6d41\u91cf\u3001\u8d1f\u8f7d\u3001\u670d\u52a1\u5668\u3001\u5bb9\u707e\u7b49\u7b49\u3002\u867d\u7136\u6709\u96be\u5ea6\u4e5f\u5e76\u4e0d\u662f\u9ad8\u4e0d\u53ef\u6500\u3002 \u5bf9\u4e8e\u73b0\u5b9e\u5373\u65f6\u901a\u8baf\u5f80\u5f80\u6709\u4e24\u79cd\u65b9\u6848\uff1a \u65b9\u6848\u4e00\uff1a \u81ea\u4e3b\u5b9e\u73b0\uff0c\u4ece\u8bbe\u8ba1\u5230\u67b6\u6784\uff0c\u518d\u5230\u5b9e\u73b0\u3002 \u6280\u672f\u65b9\u9762\u53ef\u4ee5\u91c7\u7528\uff1aNetty + WebSocket + RocketMQ + MongoDB + Redis + ZooKeeper + MySQL \u65b9\u6848\u4e8c\uff1a \u5bf9\u63a5\u7b2c\u4e09\u65b9\u670d\u52a1\u5b8c\u6210\u3002 \u8fd9\u79cd\u65b9\u5f0f\u7b80\u5355\uff0c\u53ea\u9700\u8981\u6309\u7167\u7b2c\u4e09\u65b9\u7684api\u8fdb\u884c\u5bf9\u63a5\u5c31\u53ef\u4ee5\u4e86\u3002 \u5982\uff1a\u73af\u4fe1\u3001\u7f51\u6613\u3001\u5bb9\u8054\u4e91\u901a\u8baf\u7b49\u3002 \u5982\u4f55\u9009\u62e9\u5462\uff1f \u5982\u679c\u662f\u4e2d\u5927\u578b\u4f01\u4e1a\u505a\u9879\u76ee\u53ef\u4ee5\u9009\u62e9\u81ea\u4e3b\u7814\u53d1\uff0c\u5982\u679c\u662f\u4e2d\u5c0f\u578b\u4f01\u4e1a\u7814\u53d1\u4e2d\u5c0f\u578b\u7684\u9879\u76ee\uff0c\u9009\u62e9\u7b2c\u4e8c\u79cd\u65b9\u6848\u5373\u53ef\u3002\u65b9\u6848\u4e00\u9700\u8981\u6709\u5927\u91cf\u7684\u4eba\u529b\u3001\u7269\u529b\u7684\u652f\u6301\uff0c\u5f00\u53d1\u5468\u671f\u957f\uff0c\u6210\u672c\u9ad8\uff0c\u4f46\u53ef\u63a7\u6027\u5f3a\u3002\u65b9\u6848\u4e8c\uff0c\u6210\u672c\u4f4e\uff0c\u5f00\u53d1\u5468\u671f\u77ed\uff0c\u80fd\u591f\u5feb\u901f\u7684\u96c6\u6210\u8d77\u6765\u8fdb\u884c\u529f\u80fd\u7684\u5f00\u53d1\uff0c\u53ea\u662f\u5728\u53ef\u63a7\u6027\u65b9\u9762\u6765\u8bf4\u5c31\u5dee\u4e86\u4e00\u4e9b\u3002 \u63a2\u82b1\u4ea4\u53cb\u9879\u76ee\u9009\u62e9\u65b9\u6848\u4e8c\u8fdb\u884c\u5b9e\u73b0\u3002 6\u3001\u73af\u4fe1 \u00b6 \u5b98\u7f51\uff1ahttps://www.easemob.com/ \u7a33\u5b9a\u5065\u58ee\uff0c\u6d88\u606f\u5fc5\u8fbe\uff0c\u4ebf\u7ea7\u5e76\u53d1\u7684\u5373\u65f6\u901a\u8baf\u4e91 \u73af\u4fe1\u5e73\u53f0\u4e3a\u9ed1\u9a6c\u5b66\u5458\u5f00\u8bbe\u7684\u4e13\u7528\u6ce8\u518c\u5730\u5740\uff1ahttps://datayi.cn/w/woVL50vR 6.1\u3001\u5f00\u53d1\u7b80\u4ecb \u00b6 \u6587\u6863\u5730\u5740\uff1ahttp://docs-im.easemob.com/ \u5e73\u53f0\u67b6\u6784\uff1a \u96c6\u6210\uff1a \u73af\u4fe1\u548c\u7528\u6237\u4f53\u7cfb\u7684\u96c6\u6210\u4e3b\u8981\u53d1\u751f\u57282\u4e2a\u5730\u65b9\uff0c\u670d\u52a1\u5668\u7aef\u96c6\u6210\u548c\u5ba2\u6237\u7aef\u96c6\u6210\u3002 \u63a2\u82b1\u96c6\u6210\uff1a \u63a2\u82b1\u524d\u7aef\u4f7f\u7528AndroidSDK\u8fdb\u884c\u96c6\u6210 \u6587\u6863\uff1ahttp://docs-im.easemob.com/im/android/sdk/import \u540e\u7aef\u96c6\u6210\u7528\u6237\u4f53\u7cfb \u6587\u6863\uff1ahttp://docs-im.easemob.com/im/server/ready/user 6.2\u3001\u73af\u4fe1Console \u00b6 \u9700\u8981\u4f7f\u7528\u73af\u4fe1\u5e73\u53f0\uff0c\u90a3\u4e48\u5fc5\u987b\u8981\u8fdb\u884c\u6ce8\u518c\uff0c\u767b\u5f55\u4e4b\u540e\u5373\u53ef\u521b\u5efa\u5e94\u7528\u3002\u73af\u4fe1100\u4ee5\u5185\u7684\u7528\u6237\u514d\u8d39\u4f7f\u7528\uff0c100\u4ee5\u4e0a\u5c31\u8981\u6ce8\u518c\u4f01\u4e1a\u7248\u4e86\u3002 \u4f01\u4e1a\u7248\u4ef7\u683c\uff1a \u521b\u5efa\u5e94\u7528\uff1a \u521b\u5efa\u5b8c\u6210\uff1a 6.3\u3001\u6574\u4f53\u6d41\u7a0b\u56fe \u00b6 \u8bf4\u660e\uff1a \u5728APP\u7aef\u4e0e\u540e\u7aef\u7cfb\u7edf\uff0c\u90fd\u9700\u8981\u5b8c\u6210\u4e0e\u73af\u4fe1\u7684\u96c6\u6210\u3002 \u5728APP\u7aef\uff0c\u4f7f\u7528Android\u7684SDK\u4e0e\u73af\u4fe1\u8fdb\u884c\u901a\u4fe1\uff0c\u901a\u4fe1\u65f6\u9700\u8981\u901a\u8fc7\u540e\u53f0\u7cfb\u7edf\u7684\u63a5\u53e3\u67e5\u8be2\u5f53\u524d\u7528\u6237\u7684\u73af\u4fe1\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u8fdb\u884c\u767b\u5f55\u73af\u4fe1\u3002 \u540e\u53f0\u7cfb\u7edf\uff0c\u5728\u7528\u6237\u6ce8\u518c\u540e\uff0c\u540c\u6b65\u6ce8\u518c\u73af\u4fe1\u7528\u6237\u5230\u73af\u4fe1\u5e73\u53f0\uff0c\u5728\u540e\u53f0\u7cfb\u7edf\u4e2d\u4fdd\u5b58\u73af\u4fe1\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u3002 APP\u62ff\u5230\u7528\u6237\u540d\u548c\u5bc6\u7801\u540e\uff0c\u8fdb\u884c\u767b\u5f55\u73af\u4fe1\uff0c\u767b\u5f55\u6210\u529f\u540e\u5373\u53ef\u5411\u73af\u4fe1\u53d1\u9001\u6d88\u606f\u7ed9\u597d\u53cb\u3002 \u540e\u53f0\u7cfb\u7edf\u4e5f\u53ef\u4ee5\u901a\u8fc7\u7ba1\u7406\u5458\u7684\u8eab\u4efd\u7ed9\u7528\u6237\u53d1\u9001\u7cfb\u7edf\u4fe1\u606f\u3002 7\u3001\u83b7\u53d6\u7ba1\u7406\u5458\u6743\u9650 \u00b6 \u73af\u4fe1\u63d0\u4f9b\u7684 REST API \u9700\u8981\u6743\u9650\u624d\u80fd\u8bbf\u95ee\uff0c\u6743\u9650\u901a\u8fc7\u53d1\u9001 HTTP \u8bf7\u6c42\u65f6\u643a\u5e26 token \u6765\u4f53\u73b0\u3002 \u5b98\u65b9\u6587\u6863\uff1a \u83b7\u53d6\u7ba1\u7406\u5458\u6743\u9650 \u4e0e\u73af\u4fe1\u7684\u96c6\u6210\uff0c\u6211\u4eec\u5c06\u76f8\u5173\u7684\u4ee3\u7801\u903b\u8f91\u5199\u5165\u5230\u65b0\u7684dubbo\u5de5\u7a0b\u4e2d\uff0c\u540d\u5b57\u53eb\uff1amy-tanhua-dubbo-huanxin\u3002 7.1\u3001\u521b\u5efadubbo\u5de5\u7a0b \u00b6 pom.xml\uff1a <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <parent> <artifactId> my-tanhua-dubbo </artifactId> <groupId> cn.itcast.tanhua </groupId> <version> 1.0-SNAPSHOT </version> </parent> <modelVersion> 4.0.0 </modelVersion> <artifactId> my-tanhua-dubbo-huanxin </artifactId> <dependencies> <!--\u5f15\u5165interface\u4f9d\u8d56--> <dependency> <groupId> cn.itcast.tanhua </groupId> <artifactId> my-tanhua-dubbo-interface </artifactId> <version> 1.0-SNAPSHOT </version> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-redis </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-test </artifactId> <scope> test </scope> </dependency> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus </artifactId> </dependency> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus-boot-starter </artifactId> </dependency> <dependency> <groupId> mysql </groupId> <artifactId> mysql-connector-java </artifactId> </dependency> <!--dubbo\u7684springboot\u652f\u6301--> <dependency> <groupId> com.alibaba.boot </groupId> <artifactId> dubbo-spring-boot-starter </artifactId> </dependency> <!--dubbo\u6846\u67b6--> <dependency> <groupId> com.alibaba </groupId> <artifactId> dubbo </artifactId> </dependency> <!--zk\u4f9d\u8d56--> <dependency> <groupId> org.apache.zookeeper </groupId> <artifactId> zookeeper </artifactId> </dependency> <dependency> <groupId> com.github.sgroschupf </groupId> <artifactId> zkclient </artifactId> </dependency> <dependency> <groupId> io.netty </groupId> <artifactId> netty-all </artifactId> </dependency> <dependency> <groupId> cn.hutool </groupId> <artifactId> hutool-all </artifactId> </dependency> </dependencies> </project> application.properties: # Spring boot application spring.application.name = itcast-tanhua-dubbo-huanxin # dubbo \u626b\u63cf\u5305\u914d\u7f6e dubbo.scan.basePackages = com.tanhua.dubbo.server dubbo.application.name = dubbo-provider-huanxin #dubbo \u5bf9\u5916\u66b4\u9732\u7684\u7aef\u53e3\u4fe1\u606f dubbo.protocol.name = dubbo dubbo.protocol.port = 20881 #dubbo\u6ce8\u518c\u4e2d\u5fc3\u7684\u914d\u7f6e dubbo.registry.address = zookeeper://192.168.31.81:2181 dubbo.registry.client = zkclient dubbo.registry.timeout = 60000 # Redis\u76f8\u5173\u914d\u7f6e spring.redis.jedis.pool.max-wait = 5000ms spring.redis.jedis.pool.max-Idle = 100 spring.redis.jedis.pool.min-Idle = 10 spring.redis.timeout = 10s spring.redis.cluster.nodes = 192.168.31.81:6379,192.168.31.81:6380,192.168.31.81:6381 spring.redis.cluster.max-redirects = 5 #\u6570\u636e\u5e93\u8fde\u63a5\u4fe1\u606f spring.datasource.driver-class-name = com.mysql.jdbc.Driver spring.datasource.url = jdbc:mysql://192.168.31.81:3306/mytanhua?useUnicode=true&characterEncoding=utf8&autoReconnect=true&allowMultiQueries=true&useSSL=false spring.datasource.username = root spring.datasource.password = root # \u8868\u540d\u524d\u7f00 mybatis-plus.global-config.db-config.table-prefix = tb_ # id\u7b56\u7565\u4e3a\u81ea\u589e\u957f mybatis-plus.global-config.db-config.id-type = auto \u5165\u53e3\u542f\u52a8\u7c7b\uff1a package com.tanhua.dubbo.server ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; import org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration ; import org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration ; @SpringBootApplication ( exclude = { MongoAutoConfiguration . class , MongoDataAutoConfiguration . class }) //\u6392\u9664mongo\u7684\u81ea\u52a8\u914d\u7f6e public class HuanXinDubboApplication { public static void main ( String [] args ) { SpringApplication . run ( HuanXinDubboApplication . class , args ); } } 7.2\u3001\u914d\u7f6e \u00b6 \u76f8\u5173\u7684\u914d\u7f6e\uff0c\u5728\u73af\u4fe1\u7ba1\u7406\u63a7\u5236\u53f0\u4e2d\uff0c\u53ef\u4ee5\u627e\u5230\u76f8\u5173\u7684\u53c2\u6570\u3002 #huanxin.properties tanhua.huanxin.url = http://a1.easemob.com/ tanhua.huanxin.orgName = 1105190515097562 tanhua.huanxin.appName = tanhua tanhua.huanxin.clientId = YXA67ZofwHblEems-_Fh-17T2g tanhua.huanxin.clientSecret = YXA60r45rNy2Ux5wQ7YYoEPwynHmUZk \u7f16\u5199\u914d\u7f6e\u7c7b\uff1a package com.tanhua.dubbo.server.config ; import lombok.Data ; import org.springframework.boot.context.properties.ConfigurationProperties ; import org.springframework.context.annotation.Configuration ; import org.springframework.context.annotation.PropertySource ; @Configuration @PropertySource ( \"classpath:huanxin.properties\" ) @ConfigurationProperties ( prefix = \"tanhua.huanxin\" ) @Data public class HuanXinConfig { private String url ; private String orgName ; private String appName ; private String clientId ; private String clientSecret ; } 7.3\u3001\u7f16\u5199\u5b9e\u73b0 \u00b6 \u5177\u4f53\u7684\u83b7\u53d6token\u7684\u4e1a\u52a1\u903b\u8f91\u5728TokenService\u4e2d\u5b8c\u6210\u3002\u5b9e\u73b0\u8981\u70b9\uff1a \u5206\u6790\u5b98\u65b9\u6587\u6863\u4e2d\u7684\u8bf7\u6c42url\u3001\u53c2\u6570\u3001\u54cd\u5e94\u6570\u636e\u7b49\u5185\u5bb9 \u8bf7\u6c42\u5230token\u9700\u8981\u7f13\u5b58\u5230redis\u4e2d\uff0c\u4e0d\u80fd\u9891\u7e41\u7684\u83b7\u53d6token\u64cd\u4f5c\uff0c\u53ef\u80fd\u4f1a\u88ab\u5c01\u53f7 package com.tanhua.dubbo.server.service ; import cn.hutool.core.util.StrUtil ; import cn.hutool.http.HttpRequest ; import cn.hutool.http.HttpResponse ; import cn.hutool.json.JSONObject ; import cn.hutool.json.JSONUtil ; import com.tanhua.dubbo.server.config.HuanXinConfig ; import lombok.extern.slf4j.Slf4j ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.redis.core.RedisTemplate ; import org.springframework.stereotype.Service ; import java.util.HashMap ; import java.util.Map ; import java.util.concurrent.TimeUnit ; @Service @Slf4j public class TokenService { @Autowired private RedisTemplate < String , String > redisTemplate ; private static final String REDIS_KEY = \"HX_TOKEN\" ; @Autowired private HuanXinConfig huanXinConfig ; /** * \u83b7\u53d6token\uff0c\u5148\u4eceredis\u4e2d\u83b7\u53d6\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u518d\u53bb\u73af\u4fe1\u63a5\u53e3\u83b7\u53d6 * * @return */ public String getToken () { String token = this . redisTemplate . opsForValue (). get ( REDIS_KEY ); if ( StrUtil . isNotEmpty ( token )) { return token ; } //\u8bbf\u95ee\u73af\u4fe1\u63a5\u53e3\u83b7\u53d6token return this . refreshToken (); } /** * \u5237\u65b0token\uff0c\u8bf7\u6c42\u73af\u4fe1\u63a5\u53e3\uff0c\u5c06token\u5b58\u50a8\u5230redis\u4e2d * * @return */ public String refreshToken () { String targetUrl = this . huanXinConfig . getUrl () + this . huanXinConfig . getOrgName () + \"/\" + this . huanXinConfig . getAppName () + \"/token\" ; Map < String , Object > param = new HashMap <> (); param . put ( \"grant_type\" , \"client_credentials\" ); param . put ( \"client_id\" , this . huanXinConfig . getClientId ()); param . put ( \"client_secret\" , this . huanXinConfig . getClientSecret ()); HttpResponse response = HttpRequest . post ( targetUrl ) . body ( JSONUtil . toJsonStr ( param )) . timeout ( 20000 ) //\u8bf7\u6c42\u8d85\u65f6\u65f6\u95f4 . execute (); if ( ! response . isOk ()) { log . error ( \"\u5237\u65b0token\u5931\u8d25~~~ \" ); return null ; } String jsonBody = response . body (); JSONObject jsonObject = JSONUtil . parseObj ( jsonBody ); String token = jsonObject . getStr ( \"access_token\" ); if ( StrUtil . isNotEmpty ( token )) { //\u5c06token\u6570\u636e\u7f13\u5b58\u5230redis\u4e2d\uff0c\u7f13\u5b58\u65f6\u95f4\u7531expires_in\u51b3\u5b9a //\u63d0\u524d1\u5c0f\u65f6\u5931\u6548 long timeout = jsonObject . getLong ( \"expires_in\" ) - 3600 ; this . redisTemplate . opsForValue (). set ( REDIS_KEY , token , timeout , TimeUnit . SECONDS ); return token ; } return null ; } } 7.4\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 \u63a5\u53e3\u5b9a\u4e49\u5728my-tanhua-dubbo-interface\u5de5\u7a0b\u4e2d\u3002 package com.tanhua.dubbo.server.api ; /** * \u4e0e\u73af\u4fe1\u5e73\u53f0\u96c6\u6210\u7684\u76f8\u5173\u64cd\u4f5c */ public interface HuanXinApi { /** * \u83b7\u53d6\u73af\u4fe1token\uff08\u83b7\u53d6\u7ba1\u7406\u5458\u6743\u9650\uff09 * \u53c2\u89c1\uff1ahttp://docs-im.easemob.com/im/server/ready/user#%E8%8E%B7%E5%8F%96%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90 * * @return */ String getToken (); } 7.5\u3001\u5b9e\u73b0\u63a5\u53e3 \u00b6 \u5728my-tanhua-dubbo-huanxin\u4e2d\u5b8c\u6210\u3002 package com.tanhua.dubbo.server.api ; @Service ( version = \"1.0.0\" ) @Slf4j public class HuanXinApiImpl implements HuanXinApi { @Autowired private TokenService tokenService ; @Override public String getToken () { return this . tokenService . getToken (); } } 7.6\u3001\u6d4b\u8bd5 \u00b6 package com.tanhua.dubbo.server ; import com.tanhua.dubbo.server.api.HuanXinApi ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @SpringBootTest @RunWith ( SpringRunner . class ) public class TestHuanXinApi { @Autowired private HuanXinApi huanXinApi ; @Test public void testGetToken (){ String token = this . huanXinApi . getToken (); System . out . println ( token ); } } \u6d4b\u8bd5\u7ed3\u679c\uff0c\u5df2\u7ecf\u4fdd\u5b58\u5230redis\u4e2d\u4e86\uff1a 8\u3001\u7528\u6237\u7cfb\u7edf\u96c6\u6210 \u00b6 \u4f7f\u7528\u73af\u4fe1\u5e73\u53f0\uff0c\u6700\u91cd\u8981\u7684\u5c31\u662f\u96c6\u6210\u7528\u6237\u4f53\u7cfb\uff0c\u57fa\u672c\u7684\u903b\u8f91\u662f\u8fd9\u6837\u7684\uff1a\u65b0\u7528\u6237\u5728\u6ce8\u518c\u540e\uff0c\u540c\u65f6\u9700\u8981\u6ce8\u518c\u73af\u4fe1\u7528\u6237\u3002 \u6d41\u7a0b\u5982\u4e0b\uff1a \u6d41\u7a0b\u8bf4\u660e\uff1a \u7528\u6237\u5728\u767b\u5f55\u65f6\u5728sso\u7cfb\u7edf\u4e2d\u8fdb\u884c\u5224\u65ad\uff0c\u5982\u679c\u662f\u65b0\u7528\u6237\uff0c\u5728\u6ce8\u518c\u5b8c\u6210\u540e\uff0c\u9700\u8981\u8c03\u7528dubbo\u4e2d\u7684\u73af\u4fe1\u670d\u52a1\u8fdb\u884c\u6ce8\u518c\u73af\u4fe1\u7528\u6237\u3002 dubbo-huanxin\u670d\u52a1\u5728\u6ce8\u518c\u73af\u4fe1\u7528\u6237\u65f6\uff0c\u9700\u8981\u968f\u673a\u751f\u6210\u5bc6\u7801\uff0c\u643a\u5e26token\u8bf7\u6c42\u73af\u4fe1\u7684REST API\u8fdb\u884c\u7528\u6237\u6ce8\u518c\u3002 \u6ce8\u518c\u6210\u529f\u540e\uff0c\u9700\u8981\u5c06\u73af\u4fe1\u7684\u7528\u6237\u4fe1\u606f\u4fdd\u5b58\u5230MySQL\u4e2d\u3002 \u7528\u6237\u5728APP\u7aef\u4f7f\u7528\u5373\u65f6\u901a\u8baf\u529f\u80fd\u65f6\uff0c\u9700\u8981\u901a\u8fc7\u73af\u4fe1\u7528\u6237\u4fe1\u606f\u767b\u5f55\u5230\u73af\u4fe1\u5e73\u53f0\uff0c\u7531\u4e8e\u6570\u636e\u5b58\u50a8\u5230\u670d\u52a1\u7aef\uff0c\u6240\u4ee5\u9700\u8981\u901a\u8fc7dubbo-huanxin\u8fdb\u884c\u67e5\u8be2\u3002 \u5728\u62ff\u5230\u73af\u4fe1\u8d26\u53f7\u4fe1\u606f\u540e\uff0c\u767b\u5f55\u73af\u4fe1\uff0c\u767b\u5f55\u6210\u529f\u540e\u5373\u53ef\u4e0e\u73af\u4fe1\u5e73\u53f0\u8fdb\u884c\u4ea4\u4e92\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cAPP\u7aef\u4e0e\u73af\u4fe1\u5e73\u53f0\u4ea4\u4e92\uff0c\u662f\u4e0d\u8d70\u540e\u7aef\u7cfb\u7edf\u7684\uff0c\u662f\u76f4\u8fde\u64cd\u4f5c\u3002 \u5b98\u65b9\u6587\u6863\uff1a \u300a\u7528\u6237\u7ba1\u7406\u300b 8.1\u3001\u901a\u7528\u8bf7\u6c42\u903b\u8f91 \u00b6 \u5728\u4e0e\u73af\u4fe1\u63a5\u53e3\u901a\u4fe1\u65f6\uff0c\u4f7f\u7528\u7684\u662f\u73af\u4fe1\u7684REST\u63a5\u53e3\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5c01\u88c5\u4e00\u4e2a\u901a\u7528\u7684\u8bf7\u6c42\u670d\u52a1\uff0c\u5728\u4e0e\u6240\u6709\u73af\u4fe1\u63a5\u53e3\u5bf9\u63a5\u65f6\u4f7f\u7528\u3002 \u53e6\u5916\uff0c\u8bf7\u6c42\u63a5\u53e3\u65f6\u90fd\u9700\u8981\u643a\u5e26token\uff0c\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u5c06token\u5b58\u50a8\u5230redis\u4e2d\uff0c\u4f46\u662f\uff0c\u53ef\u80fd\u5b58\u5728\u8fd9\u6837\u4e00\u79cd\u60c5\u51b5\uff0ctoken\u5728\u6211\u4eecredis\u4e2d\u6709\u6548\uff0c\u4f46\u662f\u5728\u73af\u4fe1\u5e73\u53f0\u5df2\u7ecf\u5931\u6548\uff0c\u8fd9\u6837\u73af\u4fe1\u5e73\u53f0\u4f1a\u7ed9\u6211\u4eec\u54cd\u5e94401\u72b6\u6001\u7801\u3002 \u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u5c31\u9700\u8981\u68c0\u6d4b\u72b6\u6001\u7801\u662f\u5426\u4e3a401\uff0c\u5982\u679c\u662f401\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u91cd\u65b0\u5237\u65b0token\uff0c\u518d\u91cd\u65b0\u6267\u884c\u6b64\u6b21\u8bf7\u6c42\u3002 \u4e5f\u5c31\u662f\u8981\u652f\u6301\u8bf7\u6c42\u7684\u91cd\u8bd5\u3002 8.1.1\u3001Spring-Retry \u00b6 Spring\u63d0\u4f9b\u4e86\u91cd\u8bd5\u7684\u529f\u80fd\uff0c\u4f7f\u7528\u975e\u5e38\u7684\u7b80\u5355\u3001\u4f18\u96c5\u3002 \u7b2c\u4e00\u6b65\uff0c\u5bfc\u5165\u4f9d\u8d56\uff1a <!--Spring\u91cd\u8bd5\u6a21\u5757--> <dependency> <groupId> org.springframework.retry </groupId> <artifactId> spring-retry </artifactId> </dependency> <dependency> <groupId> org.aspectj </groupId> <artifactId> aspectjweaver </artifactId> </dependency> \u7b2c\u4e8c\u6b65\uff0c\u5728\u542f\u52a8\u7c7b\u4e2d\u6dfb\u52a0@EnableRetry\u6ce8\u89e3\u6765\u6fc0\u6d3b\u91cd\u8bd5\u529f\u80fd\uff1a package com.tanhua.dubbo.server ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; import org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration ; import org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration ; import org.springframework.retry.annotation.EnableRetry ; @SpringBootApplication ( exclude = { MongoAutoConfiguration . class , MongoDataAutoConfiguration . class }) //\u6392\u9664mongo\u7684\u81ea\u52a8\u914d\u7f6e @EnableRetry public class HuanXinDubboApplication { public static void main ( String [] args ) { SpringApplication . run ( HuanXinDubboApplication . class , args ); } } \u7b2c\u4e09\u6b65\uff0c\u5728\u9700\u8981\u652f\u6301\u91cd\u8bd5\u64cd\u4f5c\u7684Service\u65b9\u6cd5\u4e2d\u6dfb\u52a0@Retryable\u6ce8\u89e3\uff0cdemo\u5982\u4e0b\uff1a //\u5c06\u6b64\u7c7b\u653e\u5230test\u5305\u4e0b\u6d4b\u8bd5\u5373\u53ef package com.tanhua.dubbo.server ; import cn.hutool.core.util.RandomUtil ; import org.springframework.retry.annotation.Backoff ; import org.springframework.retry.annotation.Recover ; import org.springframework.retry.annotation.Retryable ; import org.springframework.stereotype.Service ; @Service public class RetryService { @Retryable ( value = RuntimeException . class , maxAttempts = 3 , backoff = @Backoff ( delay = 2000L , multiplier = 2 )) public int execute ( int max ) { int data = RandomUtil . randomInt ( 1 , 99 ); System . out . println ( \"\u751f\u6210\uff1a\" + data ); if ( data < max ) { throw new RuntimeException (); } return data ; } @Recover //\u5168\u90e8\u91cd\u8bd5\u5931\u8d25\u540e\u6267\u884c public int recover ( Exception e ) { System . out . println ( \"\u5168\u90e8\u91cd\u8bd5\u5b8c\u6210\u3002\u3002\u3002\u3002\u3002\" ); return 88 ; //\u8fd4\u56de\u9ed8\u8ba4 } } @Retryable\u53c2\u6570\u8bf4\u660e\uff1a value\uff1a\u629b\u51fa\u6307\u5b9a\u5f02\u5e38\u624d\u4f1a\u91cd\u8bd5 maxAttempts\uff1a\u6700\u5927\u91cd\u8bd5\u6b21\u6570\uff0c\u9ed8\u8ba43\u6b21 backoff\uff1a\u91cd\u8bd5\u7b49\u5f85\u7b56\u7565\uff0c\u9ed8\u8ba4\u4f7f\u7528@Backoff @Backoff \u7684value\u9ed8\u8ba4\u4e3a1000L\uff0c\u6211\u4eec\u8bbe\u7f6e\u4e3a2000L\uff1b multiplier\uff08\u6307\u5b9a\u5ef6\u8fdf\u500d\u6570\uff09\u9ed8\u8ba4\u4e3a0\uff0c\u8868\u793a\u56fa\u5b9a\u6682\u505c1\u79d2\u540e\u8fdb\u884c\u91cd\u8bd5\uff0c\u5982\u679c\u628amultiplier\u8bbe\u7f6e\u4e3a2\uff0c\u5219\u7b2c\u4e00\u6b21\u91cd\u8bd5\u4e3a2\u79d2\uff0c\u7b2c\u4e8c\u6b21\u4e3a4\u79d2\uff0c\u7b2c\u4e09\u6b21\u4e3a6\u79d2\u3002 @Recover\u6807\u6ce8\u7684\u65b9\u6cd5\uff0c\u662f\u5728\u6240\u6709\u7684\u91cd\u8bd5\u90fd\u5931\u8d25\u7684\u60c5\u51b5\u4e0b\uff0c\u6700\u540e\u6267\u884c\u8be5\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u67092\u4e2a\u8981\u6c42\uff1a \u65b9\u6cd5\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u5fc5\u987b\u662f Throwable \u7c7b\u578b\uff0c\u6700\u597d\u4e0e @Retryable \u4e2d\u7684 value\u4e00\u81f4\u3002 \u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u5fc5\u987b\u4e0e@Retryable\u7684\u65b9\u6cd5\u8fd4\u56de\u503c\u4e00\u81f4\uff0c\u5426\u5219\u8be5\u65b9\u6cd5\u4e0d\u80fd\u88ab\u6267\u884c\u3002 \u6d4b\u8bd5\u7c7b\uff1a package com.tanhua.dubbo.server ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @SpringBootTest @RunWith ( SpringRunner . class ) public class TestRetryService { @Autowired private RetryService retryService ; @Test public void testRetry () { System . out . println ( this . retryService . execute ( 90 )); } } \u6d4b\u8bd5\u7ed3\u679c\uff0c\u4f1a\u67093\u6b21\u91cd\u8bd5\u673a\u4f1a\u8fdb\u884c\u751f\u6210\u968f\u673a\u6570\uff0c\u5982\u679c3\u6b21\u968f\u673a\u6570\u90fd\u5c0f\u4e8e90\uff0c\u6700\u540e\u8fd4\u56de88\u3002 8.1.2\u3001RequestService \u00b6 package com.tanhua.dubbo.server.service ; import cn.hutool.http.HttpRequest ; import cn.hutool.http.HttpResponse ; import cn.hutool.http.Method ; import com.tanhua.dubbo.server.exception.UnauthorizedException ; import lombok.extern.slf4j.Slf4j ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.retry.annotation.Backoff ; import org.springframework.retry.annotation.Recover ; import org.springframework.retry.annotation.Retryable ; import org.springframework.stereotype.Service ; /** * \u73af\u4fe1\u63a5\u53e3\u901a\u7528\u8bf7\u6c42\u670d\u52a1 */ @Service @Slf4j public class RequestService { @Autowired private TokenService tokenService ; /** * \u901a\u7528\u7684\u53d1\u9001\u8bf7\u6c42\u65b9\u6cd5 * * @param url \u8bf7\u6c42\u5730\u5740 * @param body \u8bf7\u6c42\u53c2\u6570 * @param method \u8bf7\u6c42\u65b9\u6cd5 * @return */ @Retryable ( value = UnauthorizedException . class , maxAttempts = 5 , backoff = @Backoff ( delay = 2000L , multiplier = 2 )) public HttpResponse execute ( String url , String body , Method method ) { String token = this . tokenService . getToken (); HttpRequest httpRequest ; switch ( method ) { case POST : { httpRequest = HttpRequest . post ( url ); break ; } case DELETE : { httpRequest = HttpRequest . delete ( url ); break ; } case PUT : { httpRequest = HttpRequest . put ( url ); break ; } case GET : { httpRequest = HttpRequest . get ( url ); break ; } default : { return null ; } } HttpResponse response = httpRequest . header ( \"Content-Type\" , \"application/json\" ) //\u8bbe\u7f6e\u8bf7\u6c42\u5185\u5bb9\u7c7b\u578b . header ( \"Authorization\" , \"Bearer \" + token ) //\u8bbe\u7f6etoken . body ( body ) // \u8bbe\u7f6e\u8bf7\u6c42\u6570\u636e . timeout ( 20000 ) // \u8d85\u65f6\u65f6\u95f4 . execute (); // \u6267\u884c\u8bf7\u6c42 if ( response . getStatus () == 401 ) { //token\u5931\u6548\uff0c\u91cd\u65b0\u5237\u65b0token this . tokenService . refreshToken (); //\u629b\u51fa\u5f02\u5e38\uff0c\u9700\u8981\u8fdb\u884c\u91cd\u8bd5 throw new UnauthorizedException ( url , body , method ); } return response ; } @Recover //\u5168\u90e8\u91cd\u8bd5\u5931\u8d25\u540e\u6267\u884c public HttpResponse recover ( UnauthorizedException e ) { log . error ( \"\u83b7\u53d6token\u5931\u8d25\uff01url = \" + e . getUrl () + \", body = \" + e . getBody () + \", method = \" + e . getMethod (). toString ()); //\u5982\u679c\u91cd\u8bd55\u6b21\u540e\uff0c\u4f9d\u7136\u4e0d\u80fd\u83b7\u53d6\u5230token\uff0c\u8bf4\u660e\u7f51\u7edc\u6216\u8d26\u53f7\u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u53ea\u80fd\u8fd4\u56denull\u4e86\uff0c\u540e\u7eed\u7684\u8bf7\u6c42\u5c06\u65e0\u6cd5\u518d\u6267\u884c return null ; } } package com.tanhua.dubbo.server.exception ; import cn.hutool.http.Method ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @AllArgsConstructor @NoArgsConstructor @Data public class UnauthorizedException extends RuntimeException { private String url ; private String body ; private Method method ; } \u6d4b\u8bd5\u7528\u4f8b\uff1a package com.tanhua.dubbo.server ; import cn.hutool.http.HttpResponse ; import cn.hutool.http.Method ; import com.tanhua.dubbo.server.config.HuanXinConfig ; import com.tanhua.dubbo.server.service.RequestService ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @SpringBootTest @RunWith ( SpringRunner . class ) public class TestRequestService { @Autowired private RequestService requestService ; @Autowired private HuanXinConfig huanXinConfig ; @Test public void testQueryHuanXinUser () { String targetUrl = this . huanXinConfig . getUrl () + this . huanXinConfig . getOrgName () + \"/\" + this . huanXinConfig . getAppName () + \"/users/1\" ; HttpResponse response = this . requestService . execute ( targetUrl , null , Method . GET ); System . out . println ( response ); } } 8.2\u3001\u6ce8\u518c\u73af\u4fe1\u7528\u6237 \u00b6 \u6ce8\u518c\u73af\u4fe1\u7528\u6237\u5206\u4e3a2\u79cd\uff0c\u5f00\u653e\u6ce8\u518c\u3001\u6388\u6743\u6ce8\u518c\uff0c\u533a\u522b\u5728\u4e8e\u5f00\u53d1\u6ce8\u518c\u4e0d\u9700\u8981token\uff0c\u6388\u6743\u6ce8\u518c\u9700\u8981token\u3002\u6211\u4eec\u4f7f\u7528\u7684\u6388\u6743\u6ce8\u518c\u3002 \u5b98\u65b9\u6587\u6863\uff1a \u300a\u6ce8\u518c\u5355\u4e2a\u7528\u6237(\u6388\u6743)\u300b \u8bf4\u660e\uff1a\u73af\u4fe1\u7528\u6237\u6570\u636e\u9700\u8981\u4fdd\u5b58\u5230\u6570\u636e\u4e2d\u3002 8.2.1\u3001HuanXinUser \u00b6 \u5728my-tanhua-dubbo-interface\u5de5\u7a0b\u4e2d\u521b\u5efa\u8be5\u7c7b\uff1a \u9700\u8981\u5728\u6b64\u5de5\u7a0b\u4e2d\u6dfb\u52a0MybatisPlus\u4f9d\u8d56\uff1a <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus </artifactId> </dependency> package com.tanhua.dubbo.server.pojo ; import com.baomidou.mybatisplus.annotation.TableName ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import java.util.Date ; /** * \u73af\u4fe1\u7528\u6237\u5bf9\u8c61 */ @Data @NoArgsConstructor @AllArgsConstructor @TableName ( \"tb_huanxin_user\" ) public class HuanXinUser implements java . io . Serializable { private static final long serialVersionUID = - 6400630011196593976L ; private Long id ; //\u4e3b\u952eId /** * \u73af\u4fe1 ID ;\u4e5f\u5c31\u662f IM \u7528\u6237\u540d\u7684\u552f\u4e00\u767b\u5f55\u8d26\u53f7\uff0c\u957f\u5ea6\u4e0d\u53ef\u8d85\u8fc764\u4e2a\u5b57\u7b26\u957f\u5ea6 */ private String username ; /** * \u767b\u5f55\u5bc6\u7801\uff0c\u957f\u5ea6\u4e0d\u53ef\u8d85\u8fc764\u4e2a\u5b57\u7b26\u957f\u5ea6 */ private String password ; /** * \u6635\u79f0\uff08\u53ef\u9009\uff09\uff0c\u5728 iOS Apns \u63a8\u9001\u65f6\u4f1a\u4f7f\u7528\u7684\u6635\u79f0\uff08\u4ec5\u5728\u63a8\u9001\u901a\u77e5\u680f\u5185\u663e\u793a\u7684\u6635\u79f0\uff09\uff0c * \u5e76\u4e0d\u662f\u7528\u6237\u4e2a\u4eba\u4fe1\u606f\u7684\u6635\u79f0\uff0c\u73af\u4fe1\u662f\u4e0d\u4fdd\u5b58\u7528\u6237\u6635\u79f0\uff0c\u5934\u50cf\u7b49\u4e2a\u4eba\u4fe1\u606f\u7684\uff0c * \u9700\u8981\u81ea\u5df1\u670d\u52a1\u5668\u4fdd\u5b58\u5e76\u4e0e\u7ed9\u81ea\u5df1\u7528\u6237\u6ce8\u518c\u7684IM\u7528\u6237\u540d\u7ed1\u5b9a\uff0c\u957f\u5ea6\u4e0d\u53ef\u8d85\u8fc7100\u4e2a\u5b57\u7b26 */ private String nickname ; private Long userId ; //\u7528\u6237id private Date created ; //\u521b\u5efa\u65f6\u95f4 private Date updated ; //\u66f4\u65b0\u65f6\u95f4 } \u6570\u636e\u5e93\u8868\u7ed3\u6784\uff1a CREATE TABLE ` tb_huanxin_user ` ( ` id ` bigint ( 20 ) NOT NULL AUTO_INCREMENT , ` user_id ` bigint ( 20 ) NOT NULL COMMENT '\u7528\u6237id' , ` username ` varchar ( 32 ) NOT NULL COMMENT '\u73af\u4fe1\u7528\u6237\u540d' , ` password ` varchar ( 32 ) NOT NULL COMMENT '\u73af\u4fe1\u5bc6\u7801' , ` nickname ` varchar ( 100 ) DEFAULT NULL COMMENT '\u6635\u79f0' , ` created ` datetime DEFAULT NULL COMMENT '\u521b\u5efa\u65f6\u95f4' , ` updated ` datetime DEFAULT NULL COMMENT '\u66f4\u65b0\u65f6\u95f4' , PRIMARY KEY ( ` id ` ), KEY ` user_id ` ( ` user_id ` ), KEY ` username ` ( ` username ` ) ) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 ; 8.2.2\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 //com.tanhua.dubbo.server.api.HuanXinApi /** * \u6ce8\u518c\u73af\u4fe1\u7528\u6237 * \u53c2\u89c1\uff1ahttp://docs-im.easemob.com/im/server/ready/user#%E6%B3%A8%E5%86%8C%E5%8D%95%E4%B8%AA%E7%94%A8%E6%88%B7_%E5%BC%80%E6%94%BE * * @param userId \u7528\u6237id * @return */ Boolean register ( Long userId ); /** * \u6839\u636e\u7528\u6237Id\u8be2\u73af\u4fe1\u8d26\u6237\u4fe1\u606f * * @param userId * @return */ HuanXinUser queryHuanXinUser ( Long userId ); 8.2.3\u3001\u5b9e\u73b0\u63a5\u53e3 \u00b6 //com.tanhua.dubbo.server.api.HuanXinApiImpl @Override public Boolean register ( Long userId ) { String targetUrl = this . huanXinConfig . getUrl () + this . huanXinConfig . getOrgName () + \"/\" + this . huanXinConfig . getAppName () + \"/users\" ; HuanXinUser huanXinUser = new HuanXinUser (); huanXinUser . setUsername ( \"HX_\" + userId ); // \u7528\u6237\u540d huanXinUser . setPassword ( IdUtil . simpleUUID ()); //\u968f\u673a\u751f\u6210\u7684\u5bc6\u7801 HttpResponse response = this . requestService . execute ( targetUrl , JSONUtil . toJsonStr ( Arrays . asList ( huanXinUser )), Method . POST ); if ( response . isOk ()) { //\u5c06\u73af\u4fe1\u7684\u8d26\u53f7\u4fe1\u606f\u4fdd\u5b58\u5230\u6570\u636e\u5e93 huanXinUser . setUserId ( userId ); huanXinUser . setCreated ( new Date ()); huanXinUser . setUpdated ( huanXinUser . getCreated ()); this . huanXinUserMapper . insert ( huanXinUser ); return true ; } return false ; } @Override public HuanXinUser queryHuanXinUser ( Long userId ) { QueryWrapper < HuanXinUser > wrapper = new QueryWrapper <> (); wrapper . eq ( \"user_id\" , userId ); return this . huanXinUserMapper . selectOne ( wrapper ); } package com.tanhua.dubbo.server.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.dubbo.server.pojo.HuanXinUser ; import org.apache.ibatis.annotations.Mapper ; @Mapper public interface HuanXinUserMapper extends BaseMapper < HuanXinUser > { } 8.2.4\u3001\u6d4b\u8bd5\u7528\u4f8b \u00b6 package com.tanhua.dubbo.server ; import com.tanhua.dubbo.server.api.HuanXinApi ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @SpringBootTest @RunWith ( SpringRunner . class ) public class TestHuanXinApi { @Autowired private HuanXinApi huanXinApi ; @Test public void testRegister (){ //\u6ce8\u518c\u7528\u6237id\u4e3a1\u7684\u7528\u6237\u5230\u73af\u4fe1 System . out . println ( this . huanXinApi . register ( 1L )); } @Test public void testQueryHuanXinUser (){ //\u6839\u636e\u7528\u6237id\u67e5\u8be2\u73af\u4fe1\u7528\u6237\u4fe1\u606f System . out . println ( this . huanXinApi . queryHuanXinUser ( 1L )); } } 8.2.5\u3001\u5728sso\u4e2d\u6ce8\u518c\u73af\u4fe1\u7528\u6237 \u00b6 \u9700\u8981\u5728sso\u7cfb\u7edf\u4e2d\u4f7f\u7528dubbo\u670d\u52a1\u8fdb\u884c\u6ce8\u518c\u73af\u4fe1\u7528\u6237\u3002 \u7b2c\u4e00\u6b65\uff0c\u5bfc\u5165\u4f9d\u8d56\uff1a <dependency> <groupId> cn.itcast.tanhua </groupId> <artifactId> my-tanhua-dubbo-interface </artifactId> <version> 1.0-SNAPSHOT </version> </dependency> <!--dubbo\u7684springboot\u652f\u6301--> <dependency> <groupId> com.alibaba.boot </groupId> <artifactId> dubbo-spring-boot-starter </artifactId> </dependency> <!--dubbo\u6846\u67b6--> <dependency> <groupId> com.alibaba </groupId> <artifactId> dubbo </artifactId> </dependency> <!--zk\u4f9d\u8d56--> <dependency> <groupId> org.apache.zookeeper </groupId> <artifactId> zookeeper </artifactId> </dependency> <dependency> <groupId> com.github.sgroschupf </groupId> <artifactId> zkclient </artifactId> </dependency> \u7b2c\u4e8c\u6b65\uff0c\u589e\u52a0dubbo\u6ce8\u518c\u4e2d\u5fc3\u914d\u7f6e application.properties\uff1a #dubbo\u6ce8\u518c\u4e2d\u5fc3\u914d\u7f6e dubbo.application.name = itcast-tanhua-server dubbo.registry.address = zookeeper://192.168.31.81:2181 dubbo.registry.client = zkclient dubbo.registry.timeout = 60000 dubbo.consumer.timeout = 60000 \u7b2c\u4e09\u6b65\uff0c\u5728UserService\u4e2d\u589e\u52a0\u76f8\u5e94\u7684\u903b\u8f91\uff1a @Reference ( version = \"1.0.0\" ) private HuanXinApi huanXinApi ; /** * \u7528\u6237\u767b\u5f55 * * @param phone \u624b\u673a\u53f7 * @param code \u9a8c\u8bc1\u7801 * @return */ public String login ( String phone , String code ) { String redisKey = \"CHECK_CODE_\" + phone ; boolean isNew = false ; //\u6821\u9a8c\u9a8c\u8bc1\u7801 String redisData = this . redisTemplate . opsForValue (). get ( redisKey ); if ( ! StringUtils . equals ( code , redisData )) { return null ; //\u9a8c\u8bc1\u7801\u9519\u8bef } //\u9a8c\u8bc1\u7801\u5728\u6821\u9a8c\u5b8c\u6210\u540e\uff0c\u9700\u8981\u5e9f\u5f03 this . redisTemplate . delete ( redisKey ); QueryWrapper < User > queryWrapper = new QueryWrapper <> (); queryWrapper . eq ( \"mobile\" , phone ); User user = this . userMapper . selectOne ( queryWrapper ); if ( null == user ) { //\u9700\u8981\u6ce8\u518c\u8be5\u7528\u6237 user = new User (); user . setMobile ( phone ); user . setPassword ( DigestUtils . md5Hex ( \"123456\" )); //\u6ce8\u518c\u65b0\u7528\u6237 this . userMapper . insert ( user ); isNew = true ; //\u6ce8\u518c\u73af\u4fe1\u7528\u6237 Boolean result = this . huanXinApi . register ( user . getId ()); if ( ! result ) { //\u6ce8\u518c\u73af\u4fe1\u5931\u8d25\uff0c\u8bb0\u5f55\u65e5\u5fd7 log . error ( \"\u6ce8\u518c\u73af\u4fe1\u7528\u6237\u5931\u8d25~ userId = \" + user . getId ()); } } //\u751f\u6210token Map < String , Object > claims = new HashMap < String , Object > (); claims . put ( \"id\" , user . getId ()); // \u751f\u6210token String token = Jwts . builder () . setClaims ( claims ) //payload\uff0c\u5b58\u653e\u6570\u636e\u7684\u4f4d\u7f6e\uff0c\u4e0d\u80fd\u653e\u7f6e\u654f\u611f\u6570\u636e\uff0c\u5982\uff1a\u5bc6\u7801\u7b49 . signWith ( SignatureAlgorithm . HS256 , secret ) //\u8bbe\u7f6e\u52a0\u5bc6\u65b9\u6cd5\u548c\u52a0\u5bc6\u76d0 . setExpiration ( new DateTime (). plusHours ( 12 ). toDate ()) //\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c12\u5c0f\u65f6\u540e\u8fc7\u671f . compact (); try { //\u53d1\u9001\u7528\u6237\u767b\u5f55\u6210\u529f\u7684\u6d88\u606f Map < String , Object > msg = new HashMap <> (); msg . put ( \"id\" , user . getId ()); msg . put ( \"date\" , System . currentTimeMillis ()); this . rocketMQTemplate . convertAndSend ( \"tanhua-sso-login\" , msg ); } catch ( MessagingException e ) { log . error ( \"\u53d1\u9001\u6d88\u606f\u5931\u8d25\uff01\" , e ); } return token + \"|\" + isNew ; } 8.2.6\u3001\u6d4b\u8bd5 \u00b6 \u5c06\u670d\u52a1\u5168\u90e8\u8dd1\u8d77\u6765\uff0c\u4f7f\u7528APP\u8fdb\u884c\u6d4b\u8bd5\uff0c\u4f7f\u7528\u65b0\u624b\u673a\u53f7\u8fdb\u884c\u767b\u5f55\u6d4b\u8bd5\u3002 \u65b0\u6ce8\u518c\u7684\u7528\u6237\uff1a \u6240\u5bf9\u5e94\u7684\u73af\u4fe1\u7528\u6237\uff1a \u73af\u4fe1\u5e73\u53f0\uff1a \u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u6ce8\u518c\u5230\u4e86\u73af\u4fe1\u3002 8.3\u3001\u67e5\u8be2\u73af\u4fe1\u7528\u6237\u4fe1\u606f \u00b6 \u5728app\u4e2d\uff0c\u7528\u6237\u767b\u5f55\u540e\u9700\u8981\u6839\u636e\u7528\u6237\u540d\u5bc6\u7801\u767b\u5f55\u73af\u4fe1\uff0c\u7531\u4e8e\u7528\u6237\u540d\u5bc6\u7801\u4fdd\u5b58\u5728\u540e\u53f0\uff0c\u6240\u4ee5\u9700\u8981\u63d0\u4f9b\u63a5\u53e3\u8fdb\u884c\u8fd4\u56de\u3002 mock\u5730\u5740\uff1a https://mock-java.itheima.net/project/35/interface/api/563 8.3.1\u3001HuanXinUserVo \u00b6 package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class HuanXinUserVo { private String username ; private String password ; } 8.3.2\u3001HuanXinController \u00b6 package com.tanhua.server.controller ; import com.tanhua.server.service.HuanXinService ; import com.tanhua.server.vo.HuanXinUserVo ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RestController ; @RestController @RequestMapping ( \"huanxin\" ) public class HuanXinController { @Autowired private HuanXinService huanXinService ; @GetMapping ( \"user\" ) public HuanXinUserVo queryHuanXinUser (){ return this . huanXinService . queryHuanXinUser (); } } 8.3.3\u3001HuanXinService \u00b6 package com.tanhua.server.service ; import cn.hutool.core.util.ObjectUtil ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.common.pojo.User ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.dubbo.server.api.HuanXinApi ; import com.tanhua.dubbo.server.pojo.HuanXinUser ; import com.tanhua.server.vo.HuanXinUserVo ; import org.springframework.stereotype.Service ; @Service public class HuanXinService { @Reference ( version = \"1.0.0\" ) private HuanXinApi huanXinApi ; public HuanXinUserVo queryHuanXinUser () { User user = UserThreadLocal . get (); //\u901a\u8fc7dubbo\u670d\u52a1\u67e5\u8be2\u73af\u4fe1\u7528\u6237 HuanXinUser huanXinUser = this . huanXinApi . queryHuanXinUser ( user . getId ()); if ( ObjectUtil . isNotEmpty ( huanXinUser )) { return new HuanXinUserVo ( huanXinUser . getUsername (), huanXinUser . getPassword ()); } return null ; } } 8.3.4\u3001\u6d4b\u8bd5 \u00b6 8.4\u3001\u67e5\u8be2\u4e2a\u4eba\u4fe1\u606f \u00b6 \u5728\u6d88\u606f\u6a21\u5757\u4e2d\uff0c\u9700\u8981\u5b9e\u73b0\u6839\u636e\u73af\u4fe1\u7528\u6237\u540d\u67e5\u8be2\u4e2a\u4eba\u7684\u7528\u6237\u4fe1\u606f\u3002 \u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/2921 8.4.1\u3001dubbo\u670d\u52a1 \u00b6 8.4.1.1\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 //com.tanhua.dubbo.server.api.HuanXinApi /** * \u6839\u636e\u73af\u4fe1\u7528\u6237\u540d\u67e5\u8be2\u7528\u6237\u4fe1\u606f * * @param userName * @return */ HuanXinUser queryUserByUserName ( String userName ); 8.4.1.2\u3001\u7f16\u5199\u5b9e\u73b0 \u00b6 //com.tanhua.dubbo.server.api.HuanXinApiImpl @Override public HuanXinUser queryUserByUserName ( String userName ) { QueryWrapper < HuanXinUser > wrapper = new QueryWrapper <> (); wrapper . eq ( \"username\" , userName ); return this . huanXinUserMapper . selectOne ( wrapper ); } 8.4.2\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 8.4.2.1\u3001UserInfoVo \u00b6 package com.tanhua.server.vo ; import cn.hutool.core.annotation.Alias ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @AllArgsConstructor @NoArgsConstructor public class UserInfoVo { @Alias ( \"userId\" ) private Long id ; //\u7528\u6237id @Alias ( \"logo\" ) private String avatar ; //\u5934\u50cf @Alias ( \"nickName\" ) private String nickname ; //\u6635\u79f0 private String birthday ; //\u751f\u65e5 2019-09-11 private String age ; //\u5e74\u9f84 private String gender ; //\u6027\u522b man woman private String city ; //\u57ce\u5e02 @Alias ( \"edu\" ) private String education ; //\u5b66\u5386 private String income ; //\u6708\u6536\u5165 @Alias ( \"industry\" ) private String profession ; //\u884c\u4e1a private Integer marriage ; //\u5a5a\u59fb\u72b6\u6001\uff080\u672a\u5a5a\uff0c1\u5df2\u5a5a\uff09 } 8.4.2.2\u3001IMController \u00b6 //com.tanhua.server.controller.IMController package com.tanhua.server.controller ; import cn.hutool.core.util.ObjectUtil ; import com.tanhua.server.service.IMService ; import com.tanhua.server.vo.UserInfoVo ; import lombok.extern.slf4j.Slf4j ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RequestParam ; import org.springframework.web.bind.annotation.RestController ; @RequestMapping ( \"messages\" ) @RestController @Slf4j public class IMController { @Autowired private IMService imService ; /** * \u6839\u636e\u73af\u4fe1\u7528\u6237\u540d\u67e5\u8be2\u7528\u6237\u4fe1\u606f * * @param userName \u73af\u4fe1\u7528\u6237 * @return */ @GetMapping ( \"userinfo\" ) public ResponseEntity < UserInfoVo > queryUserInfoByUserName ( @RequestParam ( \"huanxinId\" ) String userName ) { try { UserInfoVo userInfoVo = this . imService . queryUserInfoByUserName ( userName ); if ( ObjectUtil . isNotEmpty ( userInfoVo )) { return ResponseEntity . ok ( userInfoVo ); } } catch ( Exception e ) { log . error ( \"\u6839\u636e\u73af\u4fe1id\u67e5\u8be2\u7528\u6237\u4fe1\u606f! userName = \" + userName , e ); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } } 8.4.2.3\u3001IMService \u00b6 //com.tanhua.server.service.IMService package com.tanhua.server.service ; import cn.hutool.core.bean.BeanUtil ; import cn.hutool.core.util.ObjectUtil ; import cn.hutool.core.util.StrUtil ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.common.pojo.UserInfo ; import com.tanhua.dubbo.server.api.HuanXinApi ; import com.tanhua.dubbo.server.pojo.HuanXinUser ; import com.tanhua.server.vo.UserInfoVo ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; @Service public class IMService { @Reference ( version = \"1.0.0\" ) private HuanXinApi huanXinApi ; @Autowired private UserInfoService userInfoService ; public UserInfoVo queryUserInfoByUserName ( String userName ) { //\u67e5\u8be2\u73af\u4fe1\u8d26\u6237 HuanXinUser huanXinUser = this . huanXinApi . queryUserByUserName ( userName ); if ( ObjectUtil . isEmpty ( huanXinUser )) { return null ; } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f UserInfo userInfo = this . userInfoService . queryUserInfoByUserId ( huanXinUser . getUserId ()); if ( ObjectUtil . isEmpty ( userInfo )) { return null ; } UserInfoVo userInfoVo = BeanUtil . copyProperties ( userInfo , UserInfoVo . class , \"marriage\" ); userInfoVo . setGender ( userInfo . getSex (). toString (). toLowerCase ()); userInfoVo . setMarriage ( StrUtil . equals ( \"\u5df2\u5a5a\" , userInfo . getMarriage ()) ? 1 : 0 ); return userInfoVo ; } } 8.4.2.4\u3001\u6d4b\u8bd5 \u00b6 8.5\u3001\u6839\u636e\u7528\u6237id\u67e5\u8be2\u4e2a\u4eba\u4fe1\u606f \u00b6 \u5728\u6d88\u606f\u6a21\u5757\u4e0e\u6211\u7684\u6a21\u5757\u4e2d\uff0c\u9700\u8981\u6839\u636e\u7528\u6237id\u67e5\u8be2\u4e2a\u4eba\u4fe1\u606f\uff0c\u5176\u54cd\u5e94\u7684\u6570\u636e\u7ed3\u6784\u4e0e\u4e0a\u9762\u4e00\u81f4\uff0c\u5747\u4e3a\uff1aUserInfoVo\u5bf9\u8c61\u3002 \u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/875 8.5.1\u3001MyCenterController \u00b6 package com.tanhua.server.controller ; import cn.hutool.core.util.ObjectUtil ; import com.tanhua.server.service.MyCenterService ; import com.tanhua.server.vo.UserInfoVo ; import lombok.extern.slf4j.Slf4j ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RequestParam ; import org.springframework.web.bind.annotation.RestController ; @RequestMapping ( \"users\" ) @RestController @Slf4j public class MyCenterController { @Autowired private MyCenterService myCenterService ; /** * \u6839\u636e\u7528\u6237id\u67e5\u8be2\u7528\u6237\u4fe1\u606f * * @param userId \u7528\u6237id\uff0c\u5982\u679c\u4e3a\u7a7a\uff0c\u8868\u793a\u67e5\u8be2\u5f53\u524d\u767b\u5f55\u4eba\u7684\u4fe1\u606f * @return */ @GetMapping public ResponseEntity < UserInfoVo > queryUserInfoByUserId ( @RequestParam ( value = \"userID\" , required = false ) Long userId ) { try { UserInfoVo userInfoVo = this . myCenterService . queryUserInfoByUserId ( userId ); if ( ObjectUtil . isNotEmpty ( userInfoVo )) { return ResponseEntity . ok ( userInfoVo ); } } catch ( Exception e ) { log . error ( \"\u6839\u636e\u7528\u6237id\u67e5\u8be2\u7528\u6237\u4fe1\u606f\u51fa\u9519~ userId = \" + userId , e ); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } } 8.5.2\u3001MyCenterService \u00b6 package com.tanhua.server.service ; import cn.hutool.core.bean.BeanUtil ; import cn.hutool.core.util.ObjectUtil ; import cn.hutool.core.util.StrUtil ; import com.tanhua.common.pojo.UserInfo ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.server.vo.UserInfoVo ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; @Service public class MyCenterService { @Autowired private UserInfoService userInfoService ; public UserInfoVo queryUserInfoByUserId ( Long userId ) { if ( ObjectUtil . isEmpty ( userId )) { //\u5982\u679c\u67e5\u8be2id\u4e3anull\uff0c\u5c31\u8868\u793a\u67e5\u8be2\u5f53\u524d\u7528\u6237\u4fe1\u606f userId = UserThreadLocal . get (). getId (); } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f UserInfo userInfo = this . userInfoService . queryUserInfoByUserId ( userId ); if ( ObjectUtil . isEmpty ( userInfo )) { return null ; } UserInfoVo userInfoVo = BeanUtil . copyProperties ( userInfo , UserInfoVo . class , \"marriage\" ); userInfoVo . setGender ( userInfo . getSex (). toString (). toLowerCase ()); userInfoVo . setMarriage ( StrUtil . equals ( \"\u5df2\u5a5a\" , userInfo . getMarriage ()) ? 1 : 0 ); return userInfoVo ; } } 8.5.3\u3001\u6d4b\u8bd5 \u00b6 8.6\u3001\u53d1\u9001\u6d88\u606f\u7ed9\u5ba2\u6237\u7aef \u00b6 \u76ee\u524d\u5df2\u7ecf\u5b8c\u6210\u4e86\u7528\u6237\u4f53\u7cfb\u7684\u5bf9\u63a5\uff0c\u4e0b\u9762\u6211\u4eec\u8fdb\u884c\u6d4b\u8bd5\u53d1\u9001\u6d88\u606f\uff0c\u573a\u666f\u662f\u8fd9\u6837\u7684\uff1a \u70b9\u51fb\u201c\u804a\u4e00\u4e0b\u201d\uff0c\u5c31\u4f1a\u7ed9\u5bf9\u65b9\u53d1\u9001\u4e00\u6761\u964c\u751f\u4eba\u4fe1\u606f\uff0c\u8fd9\u4e2a\u6d88\u606f\u7531\u7cfb\u7edf\u53d1\u9001\u5b8c\u6210\u3002 \u6211\u4eec\u6682\u65f6\u901a\u8fc7\u73af\u4fe1\u7684\u63a7\u5236\u53f0\u8fdb\u884c\u53d1\u9001\uff1a \u6d88\u606f\u5185\u5bb9\uff1a { \"userId\" :1, \"huanXinId\" : \"HX_1\" , \"nickname\" : \"\u9ed1\u9a6c\u5c0f\u59b9\" , \"strangerQuestion\" : \"\u4f60\u559c\u6b22\u53bb\u770b\u851a\u84dd\u7684\u5927\u6d77\u8fd8\u662f\u53bb\u722c\u5dcd\u5ce8\u7684\u9ad8\u5c71\uff1f\" , \"reply\" : \"\u6211\u559c\u6b22\u79cb\u5929\u7684\u843d\u53f6\uff0c\u590f\u5929\u7684\u6cc9\u6c34\uff0c\u51ac\u5929\u7684\u96ea\u5730\uff0c\u53ea\u8981\u6709\u4f60\u4e00\u5207\u7686\u53ef~\" } \u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u63a5\u6536\u5230\u4e86\u6d88\u606f\u3002 8.7\u3001\u5c06\u7528\u6237\u6570\u636e\u540c\u6b65\u5230\u73af\u4fe1 \u00b6 \u9700\u8981\u5c061~99\u7528\u6237\u6ce8\u518c\u5230\u73af\u4fe1\uff0c\u56e0\u4e3a\u6211\u4eec\u63d0\u4f9b\u7684\u6570\u636e\u90fd\u662f\u8fd9\u4e9b\u7528\u6237\u7684\u6570\u636e\u3002 //com.tanhua.dubbo.server.TestHuanXinApi @Test public void testRegisterAllUser (){ for ( int i = 1 ; i < 100 ; i ++ ) { this . huanXinApi . register ( Long . valueOf ( i )); } } \u73af\u4fe1\uff1a 9\u3001 \u6dfb\u52a0\u8054\u7cfb\u4eba \u00b6 \u70b9\u51fb\u201c\u804a\u4e00\u4e0b\u201d\uff0c\u5c31\u4f1a\u6210\u4e3a\u8054\u7cfb\u4eba\uff08\u597d\u53cb\uff09\u3002 \u5b9e\u73b0\uff1a \u5c06\u597d\u53cb\u5199\u5165\u5230MongoDB\u4e2d \u5c06\u597d\u53cb\u5173\u7cfb\u6ce8\u518c\u5230\u73af\u4fe1 \u5177\u4f53\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a 9.1\u3001\u597d\u53cbdubbo\u670d\u52a1 \u00b6 9.1.1\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 package com.tanhua.dubbo.server.api ; public interface UsersApi { /** * \u4fdd\u5b58\u597d\u53cb\u5173\u7cfb * * @param userId \u7528\u6237id * @param friendId \u597d\u53cbid * @return */ String saveUsers ( Long userId , Long friendId ); /** * \u5220\u9664\u597d\u53cb\u6570\u636e * * @param userId \u7528\u6237id * @param friendId \u597d\u53cbid * @return */ Boolean removeUsers ( Long userId , Long friendId ); } 9.1.2\u3001\u7f16\u5199\u5b9e\u73b0 \u00b6 package com.tanhua.dubbo.server.api ; import cn.hutool.core.util.ObjectUtil ; import com.alibaba.dubbo.config.annotation.Service ; import com.tanhua.dubbo.server.pojo.Users ; import org.bson.types.ObjectId ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; @Service ( version = \"1.0.0\" ) public class UsersApiImpl implements UsersApi { @Autowired private MongoTemplate mongoTemplate ; @Override public String saveUsers ( Long userId , Long friendId ) { if ( ! ObjectUtil . isAllNotEmpty ( userId , friendId )) { return null ; } // \u68c0\u6d4b\u662f\u5426\u8be5\u597d\u53cb\u5173\u7cfb\u662f\u5426\u5b58\u5728 Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId ) . and ( \"friendId\" ). is ( friendId )); long count = this . mongoTemplate . count ( query , Users . class ); if ( count > 0 ) { return null ; } Users users = new Users (); users . setId ( ObjectId . get ()); users . setDate ( System . currentTimeMillis ()); users . setUserId ( userId ); users . setFriendId ( friendId ); //\u6ce8\u518c\u6211\u4e0e\u597d\u53cb\u7684\u5173\u7cfb this . mongoTemplate . save ( users ); //\u6ce8\u518c\u597d\u53cb\u4e0e\u6211\u7684\u5173\u7cfb users . setId ( ObjectId . get ()); users . setUserId ( friendId ); users . setFriendId ( userId ); this . mongoTemplate . save ( users ); return users . getId (). toHexString (); } @Override public Boolean removeUsers ( Long userId , Long friendId ) { Query query1 = Query . query ( Criteria . where ( \"userId\" ). is ( userId ) . and ( \"friendId\" ). is ( friendId )); //\u5220\u9664\u6211\u4e0e\u597d\u53cb\u7684\u5173\u7cfb\u6570\u636e long count1 = this . mongoTemplate . remove ( query1 , Users . class ). getDeletedCount (); Query query2 = Query . query ( Criteria . where ( \"userId\" ). is ( friendId ) . and ( \"friendId\" ). is ( userId )); //\u5220\u9664\u597d\u53cb\u4e0e\u6211\u7684\u5173\u7cfb\u6570\u636e long count2 = this . mongoTemplate . remove ( query2 , Users . class ). getDeletedCount (); return count1 > 0 && count2 > 0 ; } } 9.2\u3001\u73af\u4fe1dubbo\u670d\u52a1 \u00b6 9.2.1\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 \u5728my-tanhua-dubbo-interface\u4e2d\u5b9a\u4e49\u3002 //com.tanhua.dubbo.server.api.HuanXinApi /** * \u6dfb\u52a0\u597d\u53cb\uff08\u53cc\u5411\u597d\u53cb\u5173\u7cfb\uff09 * \u53c2\u89c1\uff1ahttp://docs-im.easemob.com/im/server/ready/user#%E6%B7%BB%E5%8A%A0%E5%A5%BD%E5%8F%8B * * @param userId \u81ea\u5df1\u7684id * @param friendId \u597d\u53cb\u7684id * @return */ Boolean addUserFriend ( Long userId , Long friendId ); /** * \u5220\u9664\u597d\u53cb\u5173\u7cfb\uff08\u53cc\u5411\u5220\u9664\uff09 * \u53c2\u89c1\uff1ahttp://docs-im.easemob.com/im/server/ready/user#%E7%A7%BB%E9%99%A4%E5%A5%BD%E5%8F%8B * * @param userId \u81ea\u5df1\u7684id * @param friendId \u597d\u53cb\u7684id * @return */ Boolean removeUserFriend ( Long userId , Long friendId ); 9.2.2\u3001\u7f16\u5199\u5b9e\u73b0 \u00b6 \u5728my-tanhua-dubbo-huanxin\u4e2d\u5b9e\u73b0\u3002 //com.tanhua.dubbo.server.api.HuanXinApiImpl @Override public Boolean addUserFriend ( Long userId , Long friendId ) { String targetUrl = this . huanXinConfig . getUrl () + this . huanXinConfig . getOrgName () + \"/\" + this . huanXinConfig . getAppName () + \"/users/HX_\" + userId + \"/contacts/users/HX_\" + friendId ; try { // 404 -> \u5bf9\u65b9\u672a\u5728\u73af\u4fe1\u6ce8\u518c return this . requestService . execute ( targetUrl , null , Method . POST ). isOk (); } catch ( Exception e ) { e . printStackTrace (); } // \u6dfb\u52a0\u5931\u8d25 return false ; } @Override public Boolean removeUserFriend ( Long userId , Long friendId ) { String targetUrl = this . huanXinConfig . getUrl () + this . huanXinConfig . getOrgName () + \"/\" + this . huanXinConfig . getAppName () + \"/users/HX_\" + userId + \"/contacts/users/HX_\" + friendId ; try { // 404 -> \u5bf9\u65b9\u672a\u5728\u73af\u4fe1\u6ce8\u518c return this . requestService . execute ( targetUrl , null , Method . DELETE ). isOk (); } catch ( Exception e ) { e . printStackTrace (); } // \u6dfb\u52a0\u5931\u8d25 return false ; } 9.3\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 \u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/809 \u5728my-tanhua-server\u4e2d\u5b8c\u6210\u3002 //com.tanhua.server.controller.IMController /** * \u6dfb\u52a0\u597d\u53cb * * @param param * @return */ @PostMapping ( \"contacts\" ) public ResponseEntity < Void > contactUser ( @RequestBody Map < String , Object > param ) { try { Long friendId = Long . valueOf ( param . get ( \"userId\" ). toString ()); boolean result = this . imService . contactUser ( friendId ); if ( result ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { log . error ( \"\u6dfb\u52a0\u8054\u7cfb\u4eba\u5931\u8d25! param = \" + param , e ); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } package com.tanhua.server.service ; import cn.hutool.core.util.StrUtil ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.common.pojo.User ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.dubbo.server.api.HuanXinApi ; import com.tanhua.dubbo.server.api.UsersApi ; import org.springframework.stereotype.Service ; @Service public class IMService { @Reference ( version = \"1.0.0\" ) private UsersApi usersApi ; @Reference ( version = \"1.0.0\" ) private HuanXinApi huanXinApi ; /** * \u6dfb\u52a0\u597d\u53cb * * @param friendId \u597d\u53cbid */ public boolean contactUser ( Long friendId ) { User user = UserThreadLocal . get (); String id = this . usersApi . saveUsers ( user . getId (), friendId ); if ( StrUtil . isNotEmpty ( id )) { //\u6ce8\u518c\u597d\u53cb\u5173\u7cfb\u5230\u73af\u4fe1 return this . huanXinApi . addUserFriend ( user . getId (), friendId ); } return false ; } } 9.4\u3001\u6d4b\u8bd5 \u00b6 \u63a5\u53e3\u6d4b\u8bd5\uff1a Monodb\u6570\u636e\uff1a \u73af\u4fe1\u5e73\u53f0\u597d\u53cb\u6570\u636e\uff1a 9.5\u3001\u91cd\u65b0\u751f\u6210\u597d\u53cb\u5173\u7cfb\u6570\u636e \u00b6 \u7531\u4e8e\u4e4b\u524d\u7684\u6570\u636e\u5e76\u6ca1\u6709\u5b8c\u6574\u7684\u53cc\u5411\u6570\u636e\uff0c\u6240\u4ee5\u9700\u8981\u91cd\u65b0\u751f\u6210\uff0c\u5982\u4e0b\uff1a package com.tanhua.server ; import cn.hutool.core.convert.Convert ; import cn.hutool.core.util.RandomUtil ; import com.tanhua.common.pojo.User ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.server.service.IMService ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestIMService { @Autowired private IMService imService ; /** * \u6784\u9020\u597d\u53cb\u6570\u636e\uff0c\u4e3a1~99\u7528\u6237\u6784\u902010\u4e2a\u597d\u53cb */ @Test public void testUsers () { for ( int i = 1 ; i <= 99 ; i ++ ) { for ( int j = 0 ; j < 10 ; j ++ ) { User user = new User (); user . setId ( Convert . toLong ( i )); UserThreadLocal . set ( user ); this . imService . contactUser ( this . getFriendId ( user . getId ())); } } } private Long getFriendId ( Long userId ) { Long friendId = RandomUtil . randomLong ( 1 , 100 ); if ( friendId . intValue () == userId . intValue ()) { getFriendId ( userId ); } return friendId ; } } 10\u3001\u8054\u7cfb\u4eba\u5217\u8868 \u00b6 \u7528\u6237\u5728\u6d88\u606f\u6a21\u5757\u4e2d\uff0c\u53ef\u4ee5\u67e5\u770b\u8054\u7cfb\u4eba\u5217\u8868\uff08\u597d\u53cb\u5217\u8868\uff09\u3002 \u63a5\u53e3\u6587\u6863\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/803 10.1\u3001dubbo\u670d\u52a1 \u00b6 10.1.1\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 //com.tanhua.dubbo.server.api.UsersApi /** * \u6839\u636e\u7528\u6237id\u67e5\u8be2\u5168\u90e8Users\u5217\u8868 * * @param userId * @return */ List < Users > queryAllUsersList ( Long userId ); /** * \u6839\u636e\u7528\u6237id\u67e5\u8be2Users\u5217\u8868(\u5206\u9875\u67e5\u8be2) * * @param userId * @return */ PageInfo < Users > queryUsersList ( Long userId , Integer page , Integer pageSize ); 10.1.2\u3001\u63a5\u53e3\u5b9e\u73b0 \u00b6 //com.tanhua.dubbo.server.api.UsersApiImpl @Override public List < Users > queryAllUsersList ( Long userId ) { Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId )); return this . mongoTemplate . find ( query , Users . class ); } @Override public PageInfo < Users > queryUsersList ( Long userId , Integer page , Integer pageSize ) { PageRequest pageRequest = PageRequest . of ( page - 1 , pageSize , Sort . by ( Sort . Order . desc ( \"created\" ))); Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId )). with ( pageRequest ); List < Users > usersList = this . mongoTemplate . find ( query , Users . class ); PageInfo < Users > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); pageInfo . setRecords ( usersList ); return pageInfo ; } 10.2\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 10.2.1\u3001UsersVo \u00b6 package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class UsersVo { private Long id ; private String userId ; private String avatar ; private String nickname ; private String gender ; private Integer age ; private String city ; } 10.2.2\u3001IMController \u00b6 //com.tanhua.server.controller.IMController /** * \u67e5\u8be2\u8054\u7cfb\u4eba\u5217\u8868 * * @param page * @param pageSize * @param keyword * @return */ @GetMapping ( \"contacts\" ) public ResponseEntity < PageResult > queryContactsList ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize , @RequestParam ( value = \"keyword\" , required = false ) String keyword ) { PageResult pageResult = this . imService . queryContactsList ( page , pageSize , keyword ); return ResponseEntity . ok ( pageResult ); } 10.2.3\u3001IMService \u00b6 //com.tanhua.server.service.IMService public PageResult queryContactsList ( Integer page , Integer pageSize , String keyword ) { PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); User user = UserThreadLocal . get (); List < Users > usersList ; if ( StringUtils . isNotEmpty ( keyword )) { //\u5173\u952e\u4e0d\u4e3a\u7a7a\uff0c\u67e5\u8be2\u6240\u6709\u7684\u597d\u53cb\uff0c\u5728\u540e\u9762\u8fdb\u884c\u5173\u952e\u5b57\u8fc7\u6ee4 usersList = this . usersApi . queryAllUsersList ( user . getId ()); } else { //\u5173\u952e\u5b57\u4e3a\u7a7a\uff0c\u8fdb\u884c\u5206\u9875\u67e5\u8be2 PageInfo < Users > usersPageInfo = this . usersApi . queryUsersList ( user . getId (), page , pageSize ); usersList = usersPageInfo . getRecords (); } if ( CollUtil . isEmpty ( usersList )) { return pageResult ; } List < Object > userIds = CollUtil . getFieldValues ( usersList , \"friendId\" ); QueryWrapper < UserInfo > queryWrapper = new QueryWrapper <> (); queryWrapper . in ( \"user_id\" , userIds ); if ( StringUtils . isNotEmpty ( keyword )) { queryWrapper . like ( \"nick_name\" , keyword ); } List < UserInfo > userInfoList = this . userInfoService . queryUserInfoList ( queryWrapper ); List < UsersVo > contactsList = new ArrayList <> (); //\u586b\u5145\u7528\u6237\u4fe1\u606f for ( UserInfo userInfo : userInfoList ) { UsersVo usersVo = new UsersVo (); usersVo . setId ( userInfo . getUserId ()); usersVo . setAge ( userInfo . getAge ()); usersVo . setAvatar ( userInfo . getLogo ()); usersVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); usersVo . setNickname ( userInfo . getNickName ()); //\u73af\u4fe1\u7528\u6237\u8d26\u53f7 usersVo . setUserId ( \"HX_\" + String . valueOf ( userInfo . getUserId ())); usersVo . setCity ( StringUtils . substringBefore ( userInfo . getCity (), \"-\" )); contactsList . add ( usersVo ); } pageResult . setItems ( contactsList ); return pageResult ; } 10.3\u3001\u6d4b\u8bd5 \u00b6","title":"day06"},{"location":"tantan/day06/#_1","text":"\u5b9e\u73b0\u89c6\u9891\u70b9\u8d5e\u3001\u8bc4\u8bba\u3001\u5173\u6ce8\u529f\u80fd \u4e86\u89e3\u4ec0\u4e48\u662f\u5373\u65f6\u901a\u4fe1 \u4e86\u89e3\u63a2\u82b1\u4ea4\u53cb\u7684\u6d88\u606f\u529f\u80fd \u4e86\u89e3\u5373\u65f6\u901a\u4fe1\u7684\u6280\u672f\u65b9\u6848 \u4e86\u89e3\u73af\u4fe1\u7684\u5373\u65f6\u901a\u8baf \u5b9e\u73b0\u73af\u4fe1\u7684\u7528\u6237\u4f53\u7cfb\u96c6\u6210 \u5b9e\u73b0\u6dfb\u52a0\u8054\u7cfb\u4eba\u3001\u8054\u7cfb\u4eba\u5217\u8868\u529f\u80fd","title":"\u8bfe\u7a0b\u8bf4\u660e"},{"location":"tantan/day06/#1","text":"\u70b9\u8d5e\u903b\u8f91\u4e0e\u5708\u5b50\u70b9\u8d5e\u903b\u8f91\u4e00\u81f4\uff0c\u6240\u4ee5\u53ef\u4ee5\u590d\u7528\u5708\u5b50\u70b9\u8d5e\u7684\u903b\u8f91\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\u70b9\u8d5e\u5bf9\u8c61\u662fVideo\uff0c\u8bbe\u7f6epublishUserId\u7684\u903b\u8f91\u4e5f\u9700\u8981\u5b8c\u5584\u4e0b\u3002","title":"1\u3001\u89c6\u9891\u70b9\u8d5e"},{"location":"tantan/day06/#11dubbo","text":"\u4fee\u6539\u4fdd\u5b58Comment\u903b\u8f91\uff0c\u5728\u539f\u6709\u903b\u8f91\u4e2d\u589e\u52a0\u5bf9\u5c0f\u89c6\u9891\u7684\u652f\u6301\uff1a //com.tanhua.dubbo.server.api.QuanZiApiImpl /** * \u4fdd\u5b58Comment * * @return */ private Boolean saveComment ( Long userId , String publishId , CommentType commentType , String content ) { try { Comment comment = new Comment (); comment . setId ( ObjectId . get ()); comment . setUserId ( userId ); comment . setPublishId ( new ObjectId ( publishId )); // \u8bc4\u8bba\u7c7b\u578b comment . setCommentType ( commentType . getType ()); // \u5185\u5bb9 comment . setContent ( content ); comment . setCreated ( System . currentTimeMillis ()); Publish publish = this . queryPublishById ( publishId ); if ( ObjectUtil . isNotEmpty ( publish )) { comment . setPublishUserId ( publish . getUserId ()); } else { //\u67e5\u8be2\u8bc4\u8bba Comment myComment = this . queryCommentById ( publishId ); if ( ObjectUtil . isNotEmpty ( myComment )){ comment . setPublishUserId ( myComment . getUserId ()); } else { //\u67e5\u8be2\u5c0f\u89c6\u9891 Video video = this . videoApi . queryVideoById ( publishId ); if ( ObjectUtil . isNotEmpty ( video )){ comment . setPublishUserId ( video . getUserId ()); } else { // \u5176\u4ed6\u60c5\u51b5\uff0c\u76f4\u63a5\u8fd4\u56de return false ; } } } this . mongoTemplate . save ( comment ); return true ; } catch ( Exception e ) { log . error ( \"\u4fdd\u5b58Comment\u51fa\u9519~ userId = \" + userId + \", publishId = \" + publishId + \", commentType = \" + commentType , e ); } return false ; } \u5728VideoApi\u4e2d\u5b9a\u4e49\u6839\u636eid\u67e5\u8be2Video\u7684\u65b9\u6cd5\uff1a // com.tanhua.dubbo.server.api.VideoApi /** * \u6839\u636eid\u67e5\u8be2\u89c6\u9891\u5bf9\u8c61 * * @param videoId \u5c0f\u89c6\u9891id * @return */ Video queryVideoById ( String videoId ); \u7f16\u5199\u5b9e\u73b0\uff1a // com.tanhua.dubbo.server.api.VideoApiImpl @Override public Video queryVideoById ( String videoId ) { return this . mongoTemplate . findById ( new ObjectId ( videoId ), Video . class ); }","title":"1.1\u3001dubbo\u670d\u52a1"},{"location":"tantan/day06/#12app","text":"\u63a5\u53e3\u5730\u5740\uff1a \u70b9\u8d5e https://mock-java.itheima.net/project/35/interface/api/827 \u53d6\u6d88\u70b9\u8d5e\uff1ahttps://mock-java.itheima.net/project/35/interface/api/833","title":"1.2\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day06/#121videocontroller","text":"/** * \u89c6\u9891\u70b9\u8d5e * * @param videoId \u89c6\u9891id * @return */ @PostMapping ( \"/{id}/like\" ) public ResponseEntity < Long > likeComment ( @PathVariable ( \"id\" ) String videoId ) { try { Long likeCount = this . videoService . likeComment ( videoId ); if ( likeCount != null ) { return ResponseEntity . ok ( likeCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u53d6\u6d88\u70b9\u8d5e * * @param videoId * @return */ @PostMapping ( \"/{id}/dislike\" ) public ResponseEntity < Long > disLikeComment ( @PathVariable ( \"id\" ) String videoId ) { try { Long likeCount = this . videoService . disLikeComment ( videoId ); if ( null != likeCount ) { return ResponseEntity . ok ( likeCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"1.2.1\u3001VideoController"},{"location":"tantan/day06/#122videoservice","text":"//com.tanhua.server.service.VideoService /** * \u70b9\u8d5e * * @param videoId * @return */ public Long likeComment ( String videoId ) { User user = UserThreadLocal . get (); Boolean result = this . quanZiApi . likeComment ( user . getId (), videoId ); if ( result ) { return this . quanZiApi . queryLikeCount ( videoId ); } return null ; } /** * \u53d6\u6d88\u70b9\u8d5e * * @param videoId * @return */ public Long disLikeComment ( String videoId ) { User user = UserThreadLocal . get (); Boolean result = this . quanZiApi . disLikeComment ( user . getId (), videoId ); if ( result ) { return this . quanZiApi . queryLikeCount ( videoId ); } return null ; }","title":"1.2.2\u3001VideoService"},{"location":"tantan/day06/#123","text":"\u5728\u67e5\u8be2\u5c0f\u89c6\u9891\u5217\u8868\u4e2d\uff0c\u9700\u8981\u5b8c\u5584\u4e4b\u524dTODO\u7684\u90e8\u5206\u3002 //com.tanhua.server.service.VideoService public PageResult queryVideoList ( Integer page , Integer pageSize ) { User user = UserThreadLocal . get (); PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); PageInfo < Video > pageInfo = this . videoApi . queryVideoList ( user . getId (), page , pageSize ); List < Video > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )) { return pageResult ; } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIds = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); List < VideoVo > videoVoList = new ArrayList <> (); for ( Video record : records ) { VideoVo videoVo = new VideoVo (); videoVo . setUserId ( record . getUserId ()); videoVo . setCover ( record . getPicUrl ()); videoVo . setVideoUrl ( record . getVideoUrl ()); videoVo . setId ( record . getId (). toHexString ()); videoVo . setSignature ( \"\u6211\u5c31\u662f\u6211~\" ); //TODO \u7b7e\u540d videoVo . setCommentCount ( 0 ); //TODO \u8bc4\u8bba\u6570 videoVo . setHasFocus ( 0 ); //TODO \u662f\u5426\u5173\u6ce8 videoVo . setHasLiked ( this . quanZiApi . queryUserIsLike ( user . getId (), videoVo . getId ()) ? 1 : 0 ); //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 videoVo . setLikeCount ( Convert . toInt ( this . quanZiApi . queryLikeCount ( videoVo . getId ()))); //\u70b9\u8d5e\u6570 //\u586b\u5145\u7528\u6237\u4fe1\u606f for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( videoVo . getUserId (), userInfo . getUserId ())) { videoVo . setNickname ( userInfo . getNickName ()); videoVo . setAvatar ( userInfo . getLogo ()); break ; } } videoVoList . add ( videoVo ); } pageResult . setItems ( videoVoList ); return pageResult ; }","title":"1.2.3\u3001\u4fee\u6539\u70b9\u8d5e\u6570\u67e5\u8be2"},{"location":"tantan/day06/#2","text":"\u5c0f\u89c6\u9891\u7684\u8bc4\u8bba\u4e0e\u5708\u5b50\u7684\u8bc4\u8bba\u903b\u8f91\u7c7b\u4f3c\uff0c\u6240\u4ee5\u4e5f\u53ef\u4ee5\u4f7f\u7528\u540c\u4e00\u5957\u903b\u8f91\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u5f00\u53d1APP\u63a5\u53e3\u529f\u80fd\u5373\u53ef\u3002 \u8bc4\u8bba\u76f8\u5173\u7684\u63a5\u53e3\u5b9a\u4e49\uff1a \u53d1\u5e03\u8bc4\u8bba\uff1ahttps://mock-java.itheima.net/project/35/interface/api/857 \u8bc4\u8bba\u5217\u8868\uff1ahttps://mock-java.itheima.net/project/35/interface/api/851 \u8bc4\u8bba\u70b9\u8d5e\uff1ahttps://mock-java.itheima.net/project/35/interface/api/863 \u8bc4\u8bba\u53d6\u6d88\u70b9\u8d5e\uff1ahttps://mock-java.itheima.net/project/35/interface/api/869","title":"2\u3001\u89c6\u9891\u8bc4\u8bba"},{"location":"tantan/day06/#21videocontroller","text":"//com.tanhua.server.controller.VideoController /** * \u8bc4\u8bba\u5217\u8868 */ @GetMapping ( \"/{id}/comments\" ) public ResponseEntity < PageResult > queryCommentsList ( @PathVariable ( \"id\" ) String videoId , @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize ) { try { PageResult pageResult = this . videoService . queryCommentList ( videoId , page , pageSize ); return ResponseEntity . ok ( pageResult ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u63d0\u4ea4\u8bc4\u8bba * * @param param * @param videoId * @return */ @PostMapping ( \"/{id}/comments\" ) public ResponseEntity < Void > saveComments ( @RequestBody Map < String , String > param , @PathVariable ( \"id\" ) String videoId ) { try { String content = param . get ( \"comment\" ); Boolean result = this . videoService . saveComment ( videoId , content ); if ( result ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u8bc4\u8bba\u70b9\u8d5e * * @param videoCommentId \u89c6\u9891\u4e2d\u7684\u8bc4\u8bbaid * @return */ @PostMapping ( \"/comments/{id}/like\" ) public ResponseEntity < Long > commentsLikeComment ( @PathVariable ( \"id\" ) String videoCommentId ) { try { Long likeCount = this . videoService . likeComment ( videoCommentId ); if ( likeCount != null ) { return ResponseEntity . ok ( likeCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u8bc4\u8bba\u53d6\u6d88\u70b9\u8d5e * * @param videoCommentId \u89c6\u9891\u4e2d\u7684\u8bc4\u8bbaid * @return */ @PostMapping ( \"/comments/{id}/dislike\" ) public ResponseEntity < Long > disCommentsLikeComment ( @PathVariable ( \"id\" ) String videoCommentId ) { try { Long likeCount = this . videoService . disLikeComment ( videoCommentId ); if ( null != likeCount ) { return ResponseEntity . ok ( likeCount ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"2.1\u3001VideoController"},{"location":"tantan/day06/#22videoservice","text":"// com.tanhua.server.service.VideoService public PageResult queryCommentList ( String videoId , Integer page , Integer pageSize ) { return this . quanZiService . queryCommentList ( videoId , page , pageSize ); } public Boolean saveComment ( String videoId , String content ) { return this . quanZiService . saveComments ( videoId , content ); }","title":"2.2\u3001VideoService"},{"location":"tantan/day06/#23","text":"\u5728\u5c0f\u89c6\u9891\u5217\u8868\u67e5\u8be2\u7ed3\u679c\u4e2d\uff0c\u9700\u8981\u8fd4\u56de\u8be5\u89c6\u9891\u7684\u8bc4\u8bba\u6570\u636e\uff0c\u7531\u4e8e\u4e4b\u524d\u5728dubbo\u670d\u52a1\u4e2d\u6ca1\u6709\u63d0\u4f9b\u67e5\u8be2\u65b9\u6cd5\uff0c\u6240\u4ee5\u9700\u8981\u5148\u5b9e\u73b0\u67e5\u8be2\u65b9\u6cd5\u3002","title":"2.3\u3001\u67e5\u8be2\u8bc4\u8bba\u6570"},{"location":"tantan/day06/#231dubbo","text":"","title":"2.3.1\u3001dubbo\u670d\u52a1"},{"location":"tantan/day06/#2311","text":"//com.tanhua.dubbo.server.api.QuanZiApi /** * \u67e5\u8be2\u8bc4\u8bba\u6570 * * @param publishId * @return */ Long queryCommentCount ( String publishId );","title":"2.3.1.1\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day06/#2312","text":"// com.tanhua.dubbo.server.api.QuanZiApiImpl @Override public Long queryCommentCount ( String publishId ) { return this . queryCommentCount ( publishId , CommentType . COMMENT ); }","title":"2.3.1.2\u3001\u7f16\u5199\u5b9e\u73b0"},{"location":"tantan/day06/#232","text":"//com.tanhua.server.service.VideoService public PageResult queryVideoList ( Integer page , Integer pageSize ) { User user = UserThreadLocal . get (); PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); PageInfo < Video > pageInfo = this . videoApi . queryVideoList ( user . getId (), page , pageSize ); List < Video > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )) { return pageResult ; } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIds = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); List < VideoVo > videoVoList = new ArrayList <> (); for ( Video record : records ) { VideoVo videoVo = new VideoVo (); videoVo . setUserId ( record . getUserId ()); videoVo . setCover ( record . getPicUrl ()); videoVo . setVideoUrl ( record . getVideoUrl ()); videoVo . setId ( record . getId (). toHexString ()); videoVo . setSignature ( \"\u6211\u5c31\u662f\u6211~\" ); //TODO \u7b7e\u540d videoVo . setCommentCount ( Convert . toInt ( this . quanZiApi . queryCommentCount ( videoVo . getId ()))); //\u8bc4\u8bba\u6570 videoVo . setHasFocus ( 0 ); //TODO \u662f\u5426\u5173\u6ce8 videoVo . setHasLiked ( this . quanZiApi . queryUserIsLike ( user . getId (), videoVo . getId ()) ? 1 : 0 ); //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 videoVo . setLikeCount ( Convert . toInt ( this . quanZiApi . queryLikeCount ( videoVo . getId ()))); //\u70b9\u8d5e\u6570 //\u586b\u5145\u7528\u6237\u4fe1\u606f for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( videoVo . getUserId (), userInfo . getUserId ())) { videoVo . setNickname ( userInfo . getNickName ()); videoVo . setAvatar ( userInfo . getLogo ()); break ; } } videoVoList . add ( videoVo ); } pageResult . setItems ( videoVoList ); return pageResult ; }","title":"2.3.2\u3001\u67e5\u8be2\u8bc4\u8bba\u6570"},{"location":"tantan/day06/#24","text":"","title":"2.4\u3001\u6d4b\u8bd5"},{"location":"tantan/day06/#3","text":"\u5173\u6ce8\u7528\u6237\u662f\u5173\u6ce8\u5c0f\u89c6\u9891\u53d1\u5e03\u7684\u4f5c\u8005\uff0c\u9700\u8981\u5728dubbo\u670d\u52a1\u4e2d\u63d0\u4f9b\u7ed9\u76f8\u5173\u7684\u670d\u52a1\u3002","title":"3\u3001\u5173\u6ce8\u7528\u6237"},{"location":"tantan/day06/#31dubbo","text":"","title":"3.1\u3001dubbo\u670d\u52a1"},{"location":"tantan/day06/#311followuser","text":"package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.mongodb.core.mapping.Document ; /** * \u5173\u6ce8\u7528\u6237 */ @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"follow_user\" ) public class FollowUser implements java . io . Serializable { private static final long serialVersionUID = 3148619072405056052L ; private ObjectId id ; //\u4e3b\u952eid private Long userId ; //\u7528\u6237id private Long followUserId ; //\u5173\u6ce8\u7684\u7528\u6237id private Long created ; //\u5173\u6ce8\u65f6\u95f4 }","title":"3.1.1\u3001FollowUser"},{"location":"tantan/day06/#312","text":"//com.tanhua.dubbo.server.api.VideoApi /** * \u5173\u6ce8\u7528\u6237 * * @param userId \u5f53\u524d\u7528\u6237 * @param followUserId \u5173\u6ce8\u7684\u76ee\u6807\u7528\u6237 * @return */ Boolean followUser ( Long userId , Long followUserId ); /** * \u53d6\u6d88\u5173\u6ce8\u7528\u6237 * * @param userId \u5f53\u524d\u7528\u6237 * @param followUserId \u5173\u6ce8\u7684\u76ee\u6807\u7528\u6237 * @return */ Boolean disFollowUser ( Long userId , Long followUserId ); /** * \u67e5\u8be2\u7528\u6237\u662f\u5426\u5173\u6ce8\u67d0\u4e2a\u7528\u6237 * * @param userId \u5f53\u524d\u7528\u6237 * @param followUserId \u5173\u6ce8\u7684\u76ee\u6807\u7528\u6237 * @return */ Boolean isFollowUser ( Long userId , Long followUserId );","title":"3.1.2\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day06/#313","text":"//com.tanhua.dubbo.server.api.VideoApiImpl private static final String VIDEO_FOLLOW_USER_KEY_PREFIX = \"VIDEO_FOLLOW_USER_\" ; @Override public Boolean followUser ( Long userId , Long followUserId ) { if ( ! ObjectUtil . isAllNotEmpty ( userId , followUserId )) { return false ; } try { //\u9700\u8981\u5c06\u7528\u6237\u7684\u5173\u6ce8\u5217\u8868\uff0c\u4fdd\u5b58\u5230redis\u4e2d\uff0c\u65b9\u4fbf\u540e\u7eed\u7684\u67e5\u8be2 //\u4f7f\u7528redis\u7684hash\u7ed3\u6784 if ( this . isFollowUser ( userId , followUserId )) { return false ; } FollowUser followUser = new FollowUser (); followUser . setId ( ObjectId . get ()); followUser . setUserId ( userId ); followUser . setFollowUserId ( followUserId ); followUser . setCreated ( System . currentTimeMillis ()); this . mongoTemplate . save ( followUser ); //\u4fdd\u5b58\u6570\u636e\u5230redis String redisKey = this . getVideoFollowUserKey ( userId ); String hashKey = String . valueOf ( followUserId ); this . redisTemplate . opsForHash (). put ( redisKey , hashKey , \"1\" ); return true ; } catch ( Exception e ) { e . printStackTrace (); } return false ; } @Override public Boolean disFollowUser ( Long userId , Long followUserId ) { if ( ! ObjectUtil . isAllNotEmpty ( userId , followUserId )) { return false ; } if ( ! this . isFollowUser ( userId , followUserId )) { return false ; } //\u53d6\u6d88\u5173\u6ce8\uff0c\u5220\u9664\u5173\u6ce8\u6570\u636e\u5373\u53ef Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId ) . and ( \"followUserId\" ). is ( followUserId ) ); DeleteResult result = this . mongoTemplate . remove ( query , FollowUser . class ); if ( result . getDeletedCount () > 0 ) { //\u540c\u65f6\u5220\u9664redis\u4e2d\u7684\u6570\u636e String redisKey = this . getVideoFollowUserKey ( userId ); String hashKey = String . valueOf ( followUserId ); this . redisTemplate . opsForHash (). delete ( redisKey , hashKey ); return true ; } return false ; } @Override public Boolean isFollowUser ( Long userId , Long followUserId ) { String redisKey = this . getVideoFollowUserKey ( userId ); String hashKey = String . valueOf ( followUserId ); return this . redisTemplate . opsForHash (). hasKey ( redisKey , hashKey ); } private String getVideoFollowUserKey ( Long userId ) { return VIDEO_FOLLOW_USER_KEY_PREFIX + userId ; }","title":"3.1.3\u3001\u7f16\u5199\u5b9e\u73b0"},{"location":"tantan/day06/#32app","text":"\u5173\u6ce8\u7528\u6237\uff1ahttps://mock-java.itheima.net/project/35/interface/api/839 \u53d6\u6d88\u5173\u6ce8\uff1ahttps://mock-java.itheima.net/project/35/interface/api/845","title":"3.2\u3001APP\u670d\u52a1"},{"location":"tantan/day06/#321videocontroller","text":"//com.tanhua.server.controller.VideoController /** * \u89c6\u9891\u7528\u6237\u5173\u6ce8 */ @PostMapping ( \"/{id}/userFocus\" ) public ResponseEntity < Void > saveUserFocusComments ( @PathVariable ( \"id\" ) Long userId ) { try { Boolean bool = this . videoService . followUser ( userId ); if ( bool ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u53d6\u6d88\u89c6\u9891\u7528\u6237\u5173\u6ce8 */ @PostMapping ( \"/{id}/userUnFocus\" ) public ResponseEntity < Void > saveUserUnFocusComments ( @PathVariable ( \"id\" ) Long userId ) { try { Boolean bool = this . videoService . disFollowUser ( userId ); if ( bool ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"3.2.1\u3001VideoController"},{"location":"tantan/day06/#322videoservice","text":"//com.tanhua.server.service.VideoService /** * \u5173\u6ce8\u7528\u6237 * * @param userId * @return */ public Boolean followUser ( Long userId ) { User user = UserThreadLocal . get (); return this . videoApi . followUser ( user . getId (), userId ); } /** * \u53d6\u6d88\u5173\u6ce8 * * @param userId * @return */ public Boolean disFollowUser ( Long userId ) { User user = UserThreadLocal . get (); return this . videoApi . disFollowUser ( user . getId (), userId ); }","title":"3.2.2\u3001VideoService"},{"location":"tantan/day06/#323","text":"//com.tanhua.server.service.VideoService public PageResult queryVideoList ( Integer page , Integer pageSize ) { User user = UserThreadLocal . get (); PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); PageInfo < Video > pageInfo = this . videoApi . queryVideoList ( user . getId (), page , pageSize ); List < Video > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )) { return pageResult ; } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIds = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); List < VideoVo > videoVoList = new ArrayList <> (); for ( Video record : records ) { VideoVo videoVo = new VideoVo (); videoVo . setUserId ( record . getUserId ()); videoVo . setCover ( record . getPicUrl ()); videoVo . setVideoUrl ( record . getVideoUrl ()); videoVo . setId ( record . getId (). toHexString ()); videoVo . setSignature ( \"\u6211\u5c31\u662f\u6211~\" ); //TODO \u7b7e\u540d videoVo . setCommentCount ( Convert . toInt ( this . quanZiApi . queryCommentCount ( videoVo . getId ()))); //\u8bc4\u8bba\u6570 videoVo . setHasFocus ( this . videoApi . isFollowUser ( user . getId (), videoVo . getUserId ()) ? 1 : 0 ); //\u662f\u5426\u5173\u6ce8 videoVo . setHasLiked ( this . quanZiApi . queryUserIsLike ( user . getId (), videoVo . getId ()) ? 1 : 0 ); //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 videoVo . setLikeCount ( Convert . toInt ( this . quanZiApi . queryLikeCount ( videoVo . getId ()))); //\u70b9\u8d5e\u6570 //\u586b\u5145\u7528\u6237\u4fe1\u606f for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( videoVo . getUserId (), userInfo . getUserId ())) { videoVo . setNickname ( userInfo . getNickName ()); videoVo . setAvatar ( userInfo . getLogo ()); break ; } } videoVoList . add ( videoVo ); } pageResult . setItems ( videoVoList ); return pageResult ; }","title":"3.2.3\u3001\u67e5\u8be2\u662f\u5426\u5173\u6ce8"},{"location":"tantan/day06/#33","text":"\u53ef\u4ee5\u770b\u5230\uff0c\u5df2\u7ecf\u5b8c\u6210\u4e86\u5173\u6ce8\u7528\u6237\u3002","title":"3.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day06/#4","text":"","title":"4\u3001\u5373\u65f6\u901a\u4fe1"},{"location":"tantan/day06/#41","text":"","title":"4.1\u3001\u4ec0\u4e48\u662f\u5373\u65f6\u901a\u4fe1\uff1f"},{"location":"tantan/day06/#42","text":"\u5728\u63a2\u82b1\u4ea4\u53cb\u9879\u76ee\u4e2d\u4e5f\u63d0\u4f9b\u4e86\u7c7b\u4f3c\u5fae\u4fe1\u7684\u804a\u5929\u529f\u80fd\uff0c\u7528\u6237\u53ef\u4ee5\u548c\u597d\u53cb\u6216\u964c\u751f\u4eba\u804a\u5929\u3002 \u5982\u679c\u662f\u964c\u751f\u4eba\uff0c\u901a\u8fc7\u300a\u804a\u4e00\u4e0b\u300b\u529f\u80fd\u8fdb\u884c\u6253\u62db\u547c\uff0c\u5982\u679c\u5bf9\u65b9\u540c\u610f\u540e\uff0c\u5c31\u6210\u4e3a\u4e86\u597d\u53cb\uff0c\u53ef\u4ee5\u8fdb\u884c\u804a\u5929\u4e86\u3002 \u964c\u751f\u4eba\u4e4b\u95f4\u5982\u679c\u76f8\u4e92\u559c\u6b22\uff0c\u90a3\u4e48\u5c31\u4f1a\u6210\u4e3a\u597d\u53cb\uff0c\u4e5f\u5c31\u53ef\u4ee5\u804a\u5929\u4e86\u3002 \u5728\u6d88\u606f\u754c\u9762\u4e2d\u4e5f\u53ef\u4ee5\u67e5\u770b\uff1a\u70b9\u8d5e\u3001\u8bc4\u8bba\u3001\u559c\u6b22\u3001\u516c\u544a\u7b49\u6d88\u606f\u4fe1\u606f\u3002","title":"4.2\u3001\u529f\u80fd\u8bf4\u660e"},{"location":"tantan/day06/#5","text":"\u5bf9\u4e8e\u9ad8\u5e76\u53d1\u7684\u5373\u65f6\u901a\u8baf\u5b9e\u73b0\uff0c\u8fd8\u662f\u5f88\u6709\u6311\u6218\u7684\uff0c\u6240\u9700\u8981\u8003\u8651\u7684\u70b9\u975e\u5e38\u591a\uff0c\u9664\u4e86\u8981\u5b9e\u73b0\u529f\u80fd\uff0c\u8fd8\u8981\u8003\u8651\u5e76\u53d1\u3001\u6d41\u91cf\u3001\u8d1f\u8f7d\u3001\u670d\u52a1\u5668\u3001\u5bb9\u707e\u7b49\u7b49\u3002\u867d\u7136\u6709\u96be\u5ea6\u4e5f\u5e76\u4e0d\u662f\u9ad8\u4e0d\u53ef\u6500\u3002 \u5bf9\u4e8e\u73b0\u5b9e\u5373\u65f6\u901a\u8baf\u5f80\u5f80\u6709\u4e24\u79cd\u65b9\u6848\uff1a \u65b9\u6848\u4e00\uff1a \u81ea\u4e3b\u5b9e\u73b0\uff0c\u4ece\u8bbe\u8ba1\u5230\u67b6\u6784\uff0c\u518d\u5230\u5b9e\u73b0\u3002 \u6280\u672f\u65b9\u9762\u53ef\u4ee5\u91c7\u7528\uff1aNetty + WebSocket + RocketMQ + MongoDB + Redis + ZooKeeper + MySQL \u65b9\u6848\u4e8c\uff1a \u5bf9\u63a5\u7b2c\u4e09\u65b9\u670d\u52a1\u5b8c\u6210\u3002 \u8fd9\u79cd\u65b9\u5f0f\u7b80\u5355\uff0c\u53ea\u9700\u8981\u6309\u7167\u7b2c\u4e09\u65b9\u7684api\u8fdb\u884c\u5bf9\u63a5\u5c31\u53ef\u4ee5\u4e86\u3002 \u5982\uff1a\u73af\u4fe1\u3001\u7f51\u6613\u3001\u5bb9\u8054\u4e91\u901a\u8baf\u7b49\u3002 \u5982\u4f55\u9009\u62e9\u5462\uff1f \u5982\u679c\u662f\u4e2d\u5927\u578b\u4f01\u4e1a\u505a\u9879\u76ee\u53ef\u4ee5\u9009\u62e9\u81ea\u4e3b\u7814\u53d1\uff0c\u5982\u679c\u662f\u4e2d\u5c0f\u578b\u4f01\u4e1a\u7814\u53d1\u4e2d\u5c0f\u578b\u7684\u9879\u76ee\uff0c\u9009\u62e9\u7b2c\u4e8c\u79cd\u65b9\u6848\u5373\u53ef\u3002\u65b9\u6848\u4e00\u9700\u8981\u6709\u5927\u91cf\u7684\u4eba\u529b\u3001\u7269\u529b\u7684\u652f\u6301\uff0c\u5f00\u53d1\u5468\u671f\u957f\uff0c\u6210\u672c\u9ad8\uff0c\u4f46\u53ef\u63a7\u6027\u5f3a\u3002\u65b9\u6848\u4e8c\uff0c\u6210\u672c\u4f4e\uff0c\u5f00\u53d1\u5468\u671f\u77ed\uff0c\u80fd\u591f\u5feb\u901f\u7684\u96c6\u6210\u8d77\u6765\u8fdb\u884c\u529f\u80fd\u7684\u5f00\u53d1\uff0c\u53ea\u662f\u5728\u53ef\u63a7\u6027\u65b9\u9762\u6765\u8bf4\u5c31\u5dee\u4e86\u4e00\u4e9b\u3002 \u63a2\u82b1\u4ea4\u53cb\u9879\u76ee\u9009\u62e9\u65b9\u6848\u4e8c\u8fdb\u884c\u5b9e\u73b0\u3002","title":"5\u3001\u6280\u672f\u65b9\u6848"},{"location":"tantan/day06/#6","text":"\u5b98\u7f51\uff1ahttps://www.easemob.com/ \u7a33\u5b9a\u5065\u58ee\uff0c\u6d88\u606f\u5fc5\u8fbe\uff0c\u4ebf\u7ea7\u5e76\u53d1\u7684\u5373\u65f6\u901a\u8baf\u4e91 \u73af\u4fe1\u5e73\u53f0\u4e3a\u9ed1\u9a6c\u5b66\u5458\u5f00\u8bbe\u7684\u4e13\u7528\u6ce8\u518c\u5730\u5740\uff1ahttps://datayi.cn/w/woVL50vR","title":"6\u3001\u73af\u4fe1"},{"location":"tantan/day06/#61","text":"\u6587\u6863\u5730\u5740\uff1ahttp://docs-im.easemob.com/ \u5e73\u53f0\u67b6\u6784\uff1a \u96c6\u6210\uff1a \u73af\u4fe1\u548c\u7528\u6237\u4f53\u7cfb\u7684\u96c6\u6210\u4e3b\u8981\u53d1\u751f\u57282\u4e2a\u5730\u65b9\uff0c\u670d\u52a1\u5668\u7aef\u96c6\u6210\u548c\u5ba2\u6237\u7aef\u96c6\u6210\u3002 \u63a2\u82b1\u96c6\u6210\uff1a \u63a2\u82b1\u524d\u7aef\u4f7f\u7528AndroidSDK\u8fdb\u884c\u96c6\u6210 \u6587\u6863\uff1ahttp://docs-im.easemob.com/im/android/sdk/import \u540e\u7aef\u96c6\u6210\u7528\u6237\u4f53\u7cfb \u6587\u6863\uff1ahttp://docs-im.easemob.com/im/server/ready/user","title":"6.1\u3001\u5f00\u53d1\u7b80\u4ecb"},{"location":"tantan/day06/#62console","text":"\u9700\u8981\u4f7f\u7528\u73af\u4fe1\u5e73\u53f0\uff0c\u90a3\u4e48\u5fc5\u987b\u8981\u8fdb\u884c\u6ce8\u518c\uff0c\u767b\u5f55\u4e4b\u540e\u5373\u53ef\u521b\u5efa\u5e94\u7528\u3002\u73af\u4fe1100\u4ee5\u5185\u7684\u7528\u6237\u514d\u8d39\u4f7f\u7528\uff0c100\u4ee5\u4e0a\u5c31\u8981\u6ce8\u518c\u4f01\u4e1a\u7248\u4e86\u3002 \u4f01\u4e1a\u7248\u4ef7\u683c\uff1a \u521b\u5efa\u5e94\u7528\uff1a \u521b\u5efa\u5b8c\u6210\uff1a","title":"6.2\u3001\u73af\u4fe1Console"},{"location":"tantan/day06/#63","text":"\u8bf4\u660e\uff1a \u5728APP\u7aef\u4e0e\u540e\u7aef\u7cfb\u7edf\uff0c\u90fd\u9700\u8981\u5b8c\u6210\u4e0e\u73af\u4fe1\u7684\u96c6\u6210\u3002 \u5728APP\u7aef\uff0c\u4f7f\u7528Android\u7684SDK\u4e0e\u73af\u4fe1\u8fdb\u884c\u901a\u4fe1\uff0c\u901a\u4fe1\u65f6\u9700\u8981\u901a\u8fc7\u540e\u53f0\u7cfb\u7edf\u7684\u63a5\u53e3\u67e5\u8be2\u5f53\u524d\u7528\u6237\u7684\u73af\u4fe1\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u8fdb\u884c\u767b\u5f55\u73af\u4fe1\u3002 \u540e\u53f0\u7cfb\u7edf\uff0c\u5728\u7528\u6237\u6ce8\u518c\u540e\uff0c\u540c\u6b65\u6ce8\u518c\u73af\u4fe1\u7528\u6237\u5230\u73af\u4fe1\u5e73\u53f0\uff0c\u5728\u540e\u53f0\u7cfb\u7edf\u4e2d\u4fdd\u5b58\u73af\u4fe1\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u3002 APP\u62ff\u5230\u7528\u6237\u540d\u548c\u5bc6\u7801\u540e\uff0c\u8fdb\u884c\u767b\u5f55\u73af\u4fe1\uff0c\u767b\u5f55\u6210\u529f\u540e\u5373\u53ef\u5411\u73af\u4fe1\u53d1\u9001\u6d88\u606f\u7ed9\u597d\u53cb\u3002 \u540e\u53f0\u7cfb\u7edf\u4e5f\u53ef\u4ee5\u901a\u8fc7\u7ba1\u7406\u5458\u7684\u8eab\u4efd\u7ed9\u7528\u6237\u53d1\u9001\u7cfb\u7edf\u4fe1\u606f\u3002","title":"6.3\u3001\u6574\u4f53\u6d41\u7a0b\u56fe"},{"location":"tantan/day06/#7","text":"\u73af\u4fe1\u63d0\u4f9b\u7684 REST API \u9700\u8981\u6743\u9650\u624d\u80fd\u8bbf\u95ee\uff0c\u6743\u9650\u901a\u8fc7\u53d1\u9001 HTTP \u8bf7\u6c42\u65f6\u643a\u5e26 token \u6765\u4f53\u73b0\u3002 \u5b98\u65b9\u6587\u6863\uff1a \u83b7\u53d6\u7ba1\u7406\u5458\u6743\u9650 \u4e0e\u73af\u4fe1\u7684\u96c6\u6210\uff0c\u6211\u4eec\u5c06\u76f8\u5173\u7684\u4ee3\u7801\u903b\u8f91\u5199\u5165\u5230\u65b0\u7684dubbo\u5de5\u7a0b\u4e2d\uff0c\u540d\u5b57\u53eb\uff1amy-tanhua-dubbo-huanxin\u3002","title":"7\u3001\u83b7\u53d6\u7ba1\u7406\u5458\u6743\u9650"},{"location":"tantan/day06/#71dubbo","text":"pom.xml\uff1a <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <parent> <artifactId> my-tanhua-dubbo </artifactId> <groupId> cn.itcast.tanhua </groupId> <version> 1.0-SNAPSHOT </version> </parent> <modelVersion> 4.0.0 </modelVersion> <artifactId> my-tanhua-dubbo-huanxin </artifactId> <dependencies> <!--\u5f15\u5165interface\u4f9d\u8d56--> <dependency> <groupId> cn.itcast.tanhua </groupId> <artifactId> my-tanhua-dubbo-interface </artifactId> <version> 1.0-SNAPSHOT </version> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-redis </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-test </artifactId> <scope> test </scope> </dependency> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus </artifactId> </dependency> <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus-boot-starter </artifactId> </dependency> <dependency> <groupId> mysql </groupId> <artifactId> mysql-connector-java </artifactId> </dependency> <!--dubbo\u7684springboot\u652f\u6301--> <dependency> <groupId> com.alibaba.boot </groupId> <artifactId> dubbo-spring-boot-starter </artifactId> </dependency> <!--dubbo\u6846\u67b6--> <dependency> <groupId> com.alibaba </groupId> <artifactId> dubbo </artifactId> </dependency> <!--zk\u4f9d\u8d56--> <dependency> <groupId> org.apache.zookeeper </groupId> <artifactId> zookeeper </artifactId> </dependency> <dependency> <groupId> com.github.sgroschupf </groupId> <artifactId> zkclient </artifactId> </dependency> <dependency> <groupId> io.netty </groupId> <artifactId> netty-all </artifactId> </dependency> <dependency> <groupId> cn.hutool </groupId> <artifactId> hutool-all </artifactId> </dependency> </dependencies> </project> application.properties: # Spring boot application spring.application.name = itcast-tanhua-dubbo-huanxin # dubbo \u626b\u63cf\u5305\u914d\u7f6e dubbo.scan.basePackages = com.tanhua.dubbo.server dubbo.application.name = dubbo-provider-huanxin #dubbo \u5bf9\u5916\u66b4\u9732\u7684\u7aef\u53e3\u4fe1\u606f dubbo.protocol.name = dubbo dubbo.protocol.port = 20881 #dubbo\u6ce8\u518c\u4e2d\u5fc3\u7684\u914d\u7f6e dubbo.registry.address = zookeeper://192.168.31.81:2181 dubbo.registry.client = zkclient dubbo.registry.timeout = 60000 # Redis\u76f8\u5173\u914d\u7f6e spring.redis.jedis.pool.max-wait = 5000ms spring.redis.jedis.pool.max-Idle = 100 spring.redis.jedis.pool.min-Idle = 10 spring.redis.timeout = 10s spring.redis.cluster.nodes = 192.168.31.81:6379,192.168.31.81:6380,192.168.31.81:6381 spring.redis.cluster.max-redirects = 5 #\u6570\u636e\u5e93\u8fde\u63a5\u4fe1\u606f spring.datasource.driver-class-name = com.mysql.jdbc.Driver spring.datasource.url = jdbc:mysql://192.168.31.81:3306/mytanhua?useUnicode=true&characterEncoding=utf8&autoReconnect=true&allowMultiQueries=true&useSSL=false spring.datasource.username = root spring.datasource.password = root # \u8868\u540d\u524d\u7f00 mybatis-plus.global-config.db-config.table-prefix = tb_ # id\u7b56\u7565\u4e3a\u81ea\u589e\u957f mybatis-plus.global-config.db-config.id-type = auto \u5165\u53e3\u542f\u52a8\u7c7b\uff1a package com.tanhua.dubbo.server ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; import org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration ; import org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration ; @SpringBootApplication ( exclude = { MongoAutoConfiguration . class , MongoDataAutoConfiguration . class }) //\u6392\u9664mongo\u7684\u81ea\u52a8\u914d\u7f6e public class HuanXinDubboApplication { public static void main ( String [] args ) { SpringApplication . run ( HuanXinDubboApplication . class , args ); } }","title":"7.1\u3001\u521b\u5efadubbo\u5de5\u7a0b"},{"location":"tantan/day06/#72","text":"\u76f8\u5173\u7684\u914d\u7f6e\uff0c\u5728\u73af\u4fe1\u7ba1\u7406\u63a7\u5236\u53f0\u4e2d\uff0c\u53ef\u4ee5\u627e\u5230\u76f8\u5173\u7684\u53c2\u6570\u3002 #huanxin.properties tanhua.huanxin.url = http://a1.easemob.com/ tanhua.huanxin.orgName = 1105190515097562 tanhua.huanxin.appName = tanhua tanhua.huanxin.clientId = YXA67ZofwHblEems-_Fh-17T2g tanhua.huanxin.clientSecret = YXA60r45rNy2Ux5wQ7YYoEPwynHmUZk \u7f16\u5199\u914d\u7f6e\u7c7b\uff1a package com.tanhua.dubbo.server.config ; import lombok.Data ; import org.springframework.boot.context.properties.ConfigurationProperties ; import org.springframework.context.annotation.Configuration ; import org.springframework.context.annotation.PropertySource ; @Configuration @PropertySource ( \"classpath:huanxin.properties\" ) @ConfigurationProperties ( prefix = \"tanhua.huanxin\" ) @Data public class HuanXinConfig { private String url ; private String orgName ; private String appName ; private String clientId ; private String clientSecret ; }","title":"7.2\u3001\u914d\u7f6e"},{"location":"tantan/day06/#73","text":"\u5177\u4f53\u7684\u83b7\u53d6token\u7684\u4e1a\u52a1\u903b\u8f91\u5728TokenService\u4e2d\u5b8c\u6210\u3002\u5b9e\u73b0\u8981\u70b9\uff1a \u5206\u6790\u5b98\u65b9\u6587\u6863\u4e2d\u7684\u8bf7\u6c42url\u3001\u53c2\u6570\u3001\u54cd\u5e94\u6570\u636e\u7b49\u5185\u5bb9 \u8bf7\u6c42\u5230token\u9700\u8981\u7f13\u5b58\u5230redis\u4e2d\uff0c\u4e0d\u80fd\u9891\u7e41\u7684\u83b7\u53d6token\u64cd\u4f5c\uff0c\u53ef\u80fd\u4f1a\u88ab\u5c01\u53f7 package com.tanhua.dubbo.server.service ; import cn.hutool.core.util.StrUtil ; import cn.hutool.http.HttpRequest ; import cn.hutool.http.HttpResponse ; import cn.hutool.json.JSONObject ; import cn.hutool.json.JSONUtil ; import com.tanhua.dubbo.server.config.HuanXinConfig ; import lombok.extern.slf4j.Slf4j ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.redis.core.RedisTemplate ; import org.springframework.stereotype.Service ; import java.util.HashMap ; import java.util.Map ; import java.util.concurrent.TimeUnit ; @Service @Slf4j public class TokenService { @Autowired private RedisTemplate < String , String > redisTemplate ; private static final String REDIS_KEY = \"HX_TOKEN\" ; @Autowired private HuanXinConfig huanXinConfig ; /** * \u83b7\u53d6token\uff0c\u5148\u4eceredis\u4e2d\u83b7\u53d6\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u518d\u53bb\u73af\u4fe1\u63a5\u53e3\u83b7\u53d6 * * @return */ public String getToken () { String token = this . redisTemplate . opsForValue (). get ( REDIS_KEY ); if ( StrUtil . isNotEmpty ( token )) { return token ; } //\u8bbf\u95ee\u73af\u4fe1\u63a5\u53e3\u83b7\u53d6token return this . refreshToken (); } /** * \u5237\u65b0token\uff0c\u8bf7\u6c42\u73af\u4fe1\u63a5\u53e3\uff0c\u5c06token\u5b58\u50a8\u5230redis\u4e2d * * @return */ public String refreshToken () { String targetUrl = this . huanXinConfig . getUrl () + this . huanXinConfig . getOrgName () + \"/\" + this . huanXinConfig . getAppName () + \"/token\" ; Map < String , Object > param = new HashMap <> (); param . put ( \"grant_type\" , \"client_credentials\" ); param . put ( \"client_id\" , this . huanXinConfig . getClientId ()); param . put ( \"client_secret\" , this . huanXinConfig . getClientSecret ()); HttpResponse response = HttpRequest . post ( targetUrl ) . body ( JSONUtil . toJsonStr ( param )) . timeout ( 20000 ) //\u8bf7\u6c42\u8d85\u65f6\u65f6\u95f4 . execute (); if ( ! response . isOk ()) { log . error ( \"\u5237\u65b0token\u5931\u8d25~~~ \" ); return null ; } String jsonBody = response . body (); JSONObject jsonObject = JSONUtil . parseObj ( jsonBody ); String token = jsonObject . getStr ( \"access_token\" ); if ( StrUtil . isNotEmpty ( token )) { //\u5c06token\u6570\u636e\u7f13\u5b58\u5230redis\u4e2d\uff0c\u7f13\u5b58\u65f6\u95f4\u7531expires_in\u51b3\u5b9a //\u63d0\u524d1\u5c0f\u65f6\u5931\u6548 long timeout = jsonObject . getLong ( \"expires_in\" ) - 3600 ; this . redisTemplate . opsForValue (). set ( REDIS_KEY , token , timeout , TimeUnit . SECONDS ); return token ; } return null ; } }","title":"7.3\u3001\u7f16\u5199\u5b9e\u73b0"},{"location":"tantan/day06/#74","text":"\u63a5\u53e3\u5b9a\u4e49\u5728my-tanhua-dubbo-interface\u5de5\u7a0b\u4e2d\u3002 package com.tanhua.dubbo.server.api ; /** * \u4e0e\u73af\u4fe1\u5e73\u53f0\u96c6\u6210\u7684\u76f8\u5173\u64cd\u4f5c */ public interface HuanXinApi { /** * \u83b7\u53d6\u73af\u4fe1token\uff08\u83b7\u53d6\u7ba1\u7406\u5458\u6743\u9650\uff09 * \u53c2\u89c1\uff1ahttp://docs-im.easemob.com/im/server/ready/user#%E8%8E%B7%E5%8F%96%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90 * * @return */ String getToken (); }","title":"7.4\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day06/#75","text":"\u5728my-tanhua-dubbo-huanxin\u4e2d\u5b8c\u6210\u3002 package com.tanhua.dubbo.server.api ; @Service ( version = \"1.0.0\" ) @Slf4j public class HuanXinApiImpl implements HuanXinApi { @Autowired private TokenService tokenService ; @Override public String getToken () { return this . tokenService . getToken (); } }","title":"7.5\u3001\u5b9e\u73b0\u63a5\u53e3"},{"location":"tantan/day06/#76","text":"package com.tanhua.dubbo.server ; import com.tanhua.dubbo.server.api.HuanXinApi ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @SpringBootTest @RunWith ( SpringRunner . class ) public class TestHuanXinApi { @Autowired private HuanXinApi huanXinApi ; @Test public void testGetToken (){ String token = this . huanXinApi . getToken (); System . out . println ( token ); } } \u6d4b\u8bd5\u7ed3\u679c\uff0c\u5df2\u7ecf\u4fdd\u5b58\u5230redis\u4e2d\u4e86\uff1a","title":"7.6\u3001\u6d4b\u8bd5"},{"location":"tantan/day06/#8","text":"\u4f7f\u7528\u73af\u4fe1\u5e73\u53f0\uff0c\u6700\u91cd\u8981\u7684\u5c31\u662f\u96c6\u6210\u7528\u6237\u4f53\u7cfb\uff0c\u57fa\u672c\u7684\u903b\u8f91\u662f\u8fd9\u6837\u7684\uff1a\u65b0\u7528\u6237\u5728\u6ce8\u518c\u540e\uff0c\u540c\u65f6\u9700\u8981\u6ce8\u518c\u73af\u4fe1\u7528\u6237\u3002 \u6d41\u7a0b\u5982\u4e0b\uff1a \u6d41\u7a0b\u8bf4\u660e\uff1a \u7528\u6237\u5728\u767b\u5f55\u65f6\u5728sso\u7cfb\u7edf\u4e2d\u8fdb\u884c\u5224\u65ad\uff0c\u5982\u679c\u662f\u65b0\u7528\u6237\uff0c\u5728\u6ce8\u518c\u5b8c\u6210\u540e\uff0c\u9700\u8981\u8c03\u7528dubbo\u4e2d\u7684\u73af\u4fe1\u670d\u52a1\u8fdb\u884c\u6ce8\u518c\u73af\u4fe1\u7528\u6237\u3002 dubbo-huanxin\u670d\u52a1\u5728\u6ce8\u518c\u73af\u4fe1\u7528\u6237\u65f6\uff0c\u9700\u8981\u968f\u673a\u751f\u6210\u5bc6\u7801\uff0c\u643a\u5e26token\u8bf7\u6c42\u73af\u4fe1\u7684REST API\u8fdb\u884c\u7528\u6237\u6ce8\u518c\u3002 \u6ce8\u518c\u6210\u529f\u540e\uff0c\u9700\u8981\u5c06\u73af\u4fe1\u7684\u7528\u6237\u4fe1\u606f\u4fdd\u5b58\u5230MySQL\u4e2d\u3002 \u7528\u6237\u5728APP\u7aef\u4f7f\u7528\u5373\u65f6\u901a\u8baf\u529f\u80fd\u65f6\uff0c\u9700\u8981\u901a\u8fc7\u73af\u4fe1\u7528\u6237\u4fe1\u606f\u767b\u5f55\u5230\u73af\u4fe1\u5e73\u53f0\uff0c\u7531\u4e8e\u6570\u636e\u5b58\u50a8\u5230\u670d\u52a1\u7aef\uff0c\u6240\u4ee5\u9700\u8981\u901a\u8fc7dubbo-huanxin\u8fdb\u884c\u67e5\u8be2\u3002 \u5728\u62ff\u5230\u73af\u4fe1\u8d26\u53f7\u4fe1\u606f\u540e\uff0c\u767b\u5f55\u73af\u4fe1\uff0c\u767b\u5f55\u6210\u529f\u540e\u5373\u53ef\u4e0e\u73af\u4fe1\u5e73\u53f0\u8fdb\u884c\u4ea4\u4e92\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cAPP\u7aef\u4e0e\u73af\u4fe1\u5e73\u53f0\u4ea4\u4e92\uff0c\u662f\u4e0d\u8d70\u540e\u7aef\u7cfb\u7edf\u7684\uff0c\u662f\u76f4\u8fde\u64cd\u4f5c\u3002 \u5b98\u65b9\u6587\u6863\uff1a \u300a\u7528\u6237\u7ba1\u7406\u300b","title":"8\u3001\u7528\u6237\u7cfb\u7edf\u96c6\u6210"},{"location":"tantan/day06/#81","text":"\u5728\u4e0e\u73af\u4fe1\u63a5\u53e3\u901a\u4fe1\u65f6\uff0c\u4f7f\u7528\u7684\u662f\u73af\u4fe1\u7684REST\u63a5\u53e3\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5c01\u88c5\u4e00\u4e2a\u901a\u7528\u7684\u8bf7\u6c42\u670d\u52a1\uff0c\u5728\u4e0e\u6240\u6709\u73af\u4fe1\u63a5\u53e3\u5bf9\u63a5\u65f6\u4f7f\u7528\u3002 \u53e6\u5916\uff0c\u8bf7\u6c42\u63a5\u53e3\u65f6\u90fd\u9700\u8981\u643a\u5e26token\uff0c\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u5c06token\u5b58\u50a8\u5230redis\u4e2d\uff0c\u4f46\u662f\uff0c\u53ef\u80fd\u5b58\u5728\u8fd9\u6837\u4e00\u79cd\u60c5\u51b5\uff0ctoken\u5728\u6211\u4eecredis\u4e2d\u6709\u6548\uff0c\u4f46\u662f\u5728\u73af\u4fe1\u5e73\u53f0\u5df2\u7ecf\u5931\u6548\uff0c\u8fd9\u6837\u73af\u4fe1\u5e73\u53f0\u4f1a\u7ed9\u6211\u4eec\u54cd\u5e94401\u72b6\u6001\u7801\u3002 \u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u5c31\u9700\u8981\u68c0\u6d4b\u72b6\u6001\u7801\u662f\u5426\u4e3a401\uff0c\u5982\u679c\u662f401\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u91cd\u65b0\u5237\u65b0token\uff0c\u518d\u91cd\u65b0\u6267\u884c\u6b64\u6b21\u8bf7\u6c42\u3002 \u4e5f\u5c31\u662f\u8981\u652f\u6301\u8bf7\u6c42\u7684\u91cd\u8bd5\u3002","title":"8.1\u3001\u901a\u7528\u8bf7\u6c42\u903b\u8f91"},{"location":"tantan/day06/#811spring-retry","text":"Spring\u63d0\u4f9b\u4e86\u91cd\u8bd5\u7684\u529f\u80fd\uff0c\u4f7f\u7528\u975e\u5e38\u7684\u7b80\u5355\u3001\u4f18\u96c5\u3002 \u7b2c\u4e00\u6b65\uff0c\u5bfc\u5165\u4f9d\u8d56\uff1a <!--Spring\u91cd\u8bd5\u6a21\u5757--> <dependency> <groupId> org.springframework.retry </groupId> <artifactId> spring-retry </artifactId> </dependency> <dependency> <groupId> org.aspectj </groupId> <artifactId> aspectjweaver </artifactId> </dependency> \u7b2c\u4e8c\u6b65\uff0c\u5728\u542f\u52a8\u7c7b\u4e2d\u6dfb\u52a0@EnableRetry\u6ce8\u89e3\u6765\u6fc0\u6d3b\u91cd\u8bd5\u529f\u80fd\uff1a package com.tanhua.dubbo.server ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; import org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration ; import org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration ; import org.springframework.retry.annotation.EnableRetry ; @SpringBootApplication ( exclude = { MongoAutoConfiguration . class , MongoDataAutoConfiguration . class }) //\u6392\u9664mongo\u7684\u81ea\u52a8\u914d\u7f6e @EnableRetry public class HuanXinDubboApplication { public static void main ( String [] args ) { SpringApplication . run ( HuanXinDubboApplication . class , args ); } } \u7b2c\u4e09\u6b65\uff0c\u5728\u9700\u8981\u652f\u6301\u91cd\u8bd5\u64cd\u4f5c\u7684Service\u65b9\u6cd5\u4e2d\u6dfb\u52a0@Retryable\u6ce8\u89e3\uff0cdemo\u5982\u4e0b\uff1a //\u5c06\u6b64\u7c7b\u653e\u5230test\u5305\u4e0b\u6d4b\u8bd5\u5373\u53ef package com.tanhua.dubbo.server ; import cn.hutool.core.util.RandomUtil ; import org.springframework.retry.annotation.Backoff ; import org.springframework.retry.annotation.Recover ; import org.springframework.retry.annotation.Retryable ; import org.springframework.stereotype.Service ; @Service public class RetryService { @Retryable ( value = RuntimeException . class , maxAttempts = 3 , backoff = @Backoff ( delay = 2000L , multiplier = 2 )) public int execute ( int max ) { int data = RandomUtil . randomInt ( 1 , 99 ); System . out . println ( \"\u751f\u6210\uff1a\" + data ); if ( data < max ) { throw new RuntimeException (); } return data ; } @Recover //\u5168\u90e8\u91cd\u8bd5\u5931\u8d25\u540e\u6267\u884c public int recover ( Exception e ) { System . out . println ( \"\u5168\u90e8\u91cd\u8bd5\u5b8c\u6210\u3002\u3002\u3002\u3002\u3002\" ); return 88 ; //\u8fd4\u56de\u9ed8\u8ba4 } } @Retryable\u53c2\u6570\u8bf4\u660e\uff1a value\uff1a\u629b\u51fa\u6307\u5b9a\u5f02\u5e38\u624d\u4f1a\u91cd\u8bd5 maxAttempts\uff1a\u6700\u5927\u91cd\u8bd5\u6b21\u6570\uff0c\u9ed8\u8ba43\u6b21 backoff\uff1a\u91cd\u8bd5\u7b49\u5f85\u7b56\u7565\uff0c\u9ed8\u8ba4\u4f7f\u7528@Backoff @Backoff \u7684value\u9ed8\u8ba4\u4e3a1000L\uff0c\u6211\u4eec\u8bbe\u7f6e\u4e3a2000L\uff1b multiplier\uff08\u6307\u5b9a\u5ef6\u8fdf\u500d\u6570\uff09\u9ed8\u8ba4\u4e3a0\uff0c\u8868\u793a\u56fa\u5b9a\u6682\u505c1\u79d2\u540e\u8fdb\u884c\u91cd\u8bd5\uff0c\u5982\u679c\u628amultiplier\u8bbe\u7f6e\u4e3a2\uff0c\u5219\u7b2c\u4e00\u6b21\u91cd\u8bd5\u4e3a2\u79d2\uff0c\u7b2c\u4e8c\u6b21\u4e3a4\u79d2\uff0c\u7b2c\u4e09\u6b21\u4e3a6\u79d2\u3002 @Recover\u6807\u6ce8\u7684\u65b9\u6cd5\uff0c\u662f\u5728\u6240\u6709\u7684\u91cd\u8bd5\u90fd\u5931\u8d25\u7684\u60c5\u51b5\u4e0b\uff0c\u6700\u540e\u6267\u884c\u8be5\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u67092\u4e2a\u8981\u6c42\uff1a \u65b9\u6cd5\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u5fc5\u987b\u662f Throwable \u7c7b\u578b\uff0c\u6700\u597d\u4e0e @Retryable \u4e2d\u7684 value\u4e00\u81f4\u3002 \u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u5fc5\u987b\u4e0e@Retryable\u7684\u65b9\u6cd5\u8fd4\u56de\u503c\u4e00\u81f4\uff0c\u5426\u5219\u8be5\u65b9\u6cd5\u4e0d\u80fd\u88ab\u6267\u884c\u3002 \u6d4b\u8bd5\u7c7b\uff1a package com.tanhua.dubbo.server ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @SpringBootTest @RunWith ( SpringRunner . class ) public class TestRetryService { @Autowired private RetryService retryService ; @Test public void testRetry () { System . out . println ( this . retryService . execute ( 90 )); } } \u6d4b\u8bd5\u7ed3\u679c\uff0c\u4f1a\u67093\u6b21\u91cd\u8bd5\u673a\u4f1a\u8fdb\u884c\u751f\u6210\u968f\u673a\u6570\uff0c\u5982\u679c3\u6b21\u968f\u673a\u6570\u90fd\u5c0f\u4e8e90\uff0c\u6700\u540e\u8fd4\u56de88\u3002","title":"8.1.1\u3001Spring-Retry"},{"location":"tantan/day06/#812requestservice","text":"package com.tanhua.dubbo.server.service ; import cn.hutool.http.HttpRequest ; import cn.hutool.http.HttpResponse ; import cn.hutool.http.Method ; import com.tanhua.dubbo.server.exception.UnauthorizedException ; import lombok.extern.slf4j.Slf4j ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.retry.annotation.Backoff ; import org.springframework.retry.annotation.Recover ; import org.springframework.retry.annotation.Retryable ; import org.springframework.stereotype.Service ; /** * \u73af\u4fe1\u63a5\u53e3\u901a\u7528\u8bf7\u6c42\u670d\u52a1 */ @Service @Slf4j public class RequestService { @Autowired private TokenService tokenService ; /** * \u901a\u7528\u7684\u53d1\u9001\u8bf7\u6c42\u65b9\u6cd5 * * @param url \u8bf7\u6c42\u5730\u5740 * @param body \u8bf7\u6c42\u53c2\u6570 * @param method \u8bf7\u6c42\u65b9\u6cd5 * @return */ @Retryable ( value = UnauthorizedException . class , maxAttempts = 5 , backoff = @Backoff ( delay = 2000L , multiplier = 2 )) public HttpResponse execute ( String url , String body , Method method ) { String token = this . tokenService . getToken (); HttpRequest httpRequest ; switch ( method ) { case POST : { httpRequest = HttpRequest . post ( url ); break ; } case DELETE : { httpRequest = HttpRequest . delete ( url ); break ; } case PUT : { httpRequest = HttpRequest . put ( url ); break ; } case GET : { httpRequest = HttpRequest . get ( url ); break ; } default : { return null ; } } HttpResponse response = httpRequest . header ( \"Content-Type\" , \"application/json\" ) //\u8bbe\u7f6e\u8bf7\u6c42\u5185\u5bb9\u7c7b\u578b . header ( \"Authorization\" , \"Bearer \" + token ) //\u8bbe\u7f6etoken . body ( body ) // \u8bbe\u7f6e\u8bf7\u6c42\u6570\u636e . timeout ( 20000 ) // \u8d85\u65f6\u65f6\u95f4 . execute (); // \u6267\u884c\u8bf7\u6c42 if ( response . getStatus () == 401 ) { //token\u5931\u6548\uff0c\u91cd\u65b0\u5237\u65b0token this . tokenService . refreshToken (); //\u629b\u51fa\u5f02\u5e38\uff0c\u9700\u8981\u8fdb\u884c\u91cd\u8bd5 throw new UnauthorizedException ( url , body , method ); } return response ; } @Recover //\u5168\u90e8\u91cd\u8bd5\u5931\u8d25\u540e\u6267\u884c public HttpResponse recover ( UnauthorizedException e ) { log . error ( \"\u83b7\u53d6token\u5931\u8d25\uff01url = \" + e . getUrl () + \", body = \" + e . getBody () + \", method = \" + e . getMethod (). toString ()); //\u5982\u679c\u91cd\u8bd55\u6b21\u540e\uff0c\u4f9d\u7136\u4e0d\u80fd\u83b7\u53d6\u5230token\uff0c\u8bf4\u660e\u7f51\u7edc\u6216\u8d26\u53f7\u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u53ea\u80fd\u8fd4\u56denull\u4e86\uff0c\u540e\u7eed\u7684\u8bf7\u6c42\u5c06\u65e0\u6cd5\u518d\u6267\u884c return null ; } } package com.tanhua.dubbo.server.exception ; import cn.hutool.http.Method ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @AllArgsConstructor @NoArgsConstructor @Data public class UnauthorizedException extends RuntimeException { private String url ; private String body ; private Method method ; } \u6d4b\u8bd5\u7528\u4f8b\uff1a package com.tanhua.dubbo.server ; import cn.hutool.http.HttpResponse ; import cn.hutool.http.Method ; import com.tanhua.dubbo.server.config.HuanXinConfig ; import com.tanhua.dubbo.server.service.RequestService ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @SpringBootTest @RunWith ( SpringRunner . class ) public class TestRequestService { @Autowired private RequestService requestService ; @Autowired private HuanXinConfig huanXinConfig ; @Test public void testQueryHuanXinUser () { String targetUrl = this . huanXinConfig . getUrl () + this . huanXinConfig . getOrgName () + \"/\" + this . huanXinConfig . getAppName () + \"/users/1\" ; HttpResponse response = this . requestService . execute ( targetUrl , null , Method . GET ); System . out . println ( response ); } }","title":"8.1.2\u3001RequestService"},{"location":"tantan/day06/#82","text":"\u6ce8\u518c\u73af\u4fe1\u7528\u6237\u5206\u4e3a2\u79cd\uff0c\u5f00\u653e\u6ce8\u518c\u3001\u6388\u6743\u6ce8\u518c\uff0c\u533a\u522b\u5728\u4e8e\u5f00\u53d1\u6ce8\u518c\u4e0d\u9700\u8981token\uff0c\u6388\u6743\u6ce8\u518c\u9700\u8981token\u3002\u6211\u4eec\u4f7f\u7528\u7684\u6388\u6743\u6ce8\u518c\u3002 \u5b98\u65b9\u6587\u6863\uff1a \u300a\u6ce8\u518c\u5355\u4e2a\u7528\u6237(\u6388\u6743)\u300b \u8bf4\u660e\uff1a\u73af\u4fe1\u7528\u6237\u6570\u636e\u9700\u8981\u4fdd\u5b58\u5230\u6570\u636e\u4e2d\u3002","title":"8.2\u3001\u6ce8\u518c\u73af\u4fe1\u7528\u6237"},{"location":"tantan/day06/#821huanxinuser","text":"\u5728my-tanhua-dubbo-interface\u5de5\u7a0b\u4e2d\u521b\u5efa\u8be5\u7c7b\uff1a \u9700\u8981\u5728\u6b64\u5de5\u7a0b\u4e2d\u6dfb\u52a0MybatisPlus\u4f9d\u8d56\uff1a <dependency> <groupId> com.baomidou </groupId> <artifactId> mybatis-plus </artifactId> </dependency> package com.tanhua.dubbo.server.pojo ; import com.baomidou.mybatisplus.annotation.TableName ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import java.util.Date ; /** * \u73af\u4fe1\u7528\u6237\u5bf9\u8c61 */ @Data @NoArgsConstructor @AllArgsConstructor @TableName ( \"tb_huanxin_user\" ) public class HuanXinUser implements java . io . Serializable { private static final long serialVersionUID = - 6400630011196593976L ; private Long id ; //\u4e3b\u952eId /** * \u73af\u4fe1 ID ;\u4e5f\u5c31\u662f IM \u7528\u6237\u540d\u7684\u552f\u4e00\u767b\u5f55\u8d26\u53f7\uff0c\u957f\u5ea6\u4e0d\u53ef\u8d85\u8fc764\u4e2a\u5b57\u7b26\u957f\u5ea6 */ private String username ; /** * \u767b\u5f55\u5bc6\u7801\uff0c\u957f\u5ea6\u4e0d\u53ef\u8d85\u8fc764\u4e2a\u5b57\u7b26\u957f\u5ea6 */ private String password ; /** * \u6635\u79f0\uff08\u53ef\u9009\uff09\uff0c\u5728 iOS Apns \u63a8\u9001\u65f6\u4f1a\u4f7f\u7528\u7684\u6635\u79f0\uff08\u4ec5\u5728\u63a8\u9001\u901a\u77e5\u680f\u5185\u663e\u793a\u7684\u6635\u79f0\uff09\uff0c * \u5e76\u4e0d\u662f\u7528\u6237\u4e2a\u4eba\u4fe1\u606f\u7684\u6635\u79f0\uff0c\u73af\u4fe1\u662f\u4e0d\u4fdd\u5b58\u7528\u6237\u6635\u79f0\uff0c\u5934\u50cf\u7b49\u4e2a\u4eba\u4fe1\u606f\u7684\uff0c * \u9700\u8981\u81ea\u5df1\u670d\u52a1\u5668\u4fdd\u5b58\u5e76\u4e0e\u7ed9\u81ea\u5df1\u7528\u6237\u6ce8\u518c\u7684IM\u7528\u6237\u540d\u7ed1\u5b9a\uff0c\u957f\u5ea6\u4e0d\u53ef\u8d85\u8fc7100\u4e2a\u5b57\u7b26 */ private String nickname ; private Long userId ; //\u7528\u6237id private Date created ; //\u521b\u5efa\u65f6\u95f4 private Date updated ; //\u66f4\u65b0\u65f6\u95f4 } \u6570\u636e\u5e93\u8868\u7ed3\u6784\uff1a CREATE TABLE ` tb_huanxin_user ` ( ` id ` bigint ( 20 ) NOT NULL AUTO_INCREMENT , ` user_id ` bigint ( 20 ) NOT NULL COMMENT '\u7528\u6237id' , ` username ` varchar ( 32 ) NOT NULL COMMENT '\u73af\u4fe1\u7528\u6237\u540d' , ` password ` varchar ( 32 ) NOT NULL COMMENT '\u73af\u4fe1\u5bc6\u7801' , ` nickname ` varchar ( 100 ) DEFAULT NULL COMMENT '\u6635\u79f0' , ` created ` datetime DEFAULT NULL COMMENT '\u521b\u5efa\u65f6\u95f4' , ` updated ` datetime DEFAULT NULL COMMENT '\u66f4\u65b0\u65f6\u95f4' , PRIMARY KEY ( ` id ` ), KEY ` user_id ` ( ` user_id ` ), KEY ` username ` ( ` username ` ) ) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 ;","title":"8.2.1\u3001HuanXinUser"},{"location":"tantan/day06/#822","text":"//com.tanhua.dubbo.server.api.HuanXinApi /** * \u6ce8\u518c\u73af\u4fe1\u7528\u6237 * \u53c2\u89c1\uff1ahttp://docs-im.easemob.com/im/server/ready/user#%E6%B3%A8%E5%86%8C%E5%8D%95%E4%B8%AA%E7%94%A8%E6%88%B7_%E5%BC%80%E6%94%BE * * @param userId \u7528\u6237id * @return */ Boolean register ( Long userId ); /** * \u6839\u636e\u7528\u6237Id\u8be2\u73af\u4fe1\u8d26\u6237\u4fe1\u606f * * @param userId * @return */ HuanXinUser queryHuanXinUser ( Long userId );","title":"8.2.2\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day06/#823","text":"//com.tanhua.dubbo.server.api.HuanXinApiImpl @Override public Boolean register ( Long userId ) { String targetUrl = this . huanXinConfig . getUrl () + this . huanXinConfig . getOrgName () + \"/\" + this . huanXinConfig . getAppName () + \"/users\" ; HuanXinUser huanXinUser = new HuanXinUser (); huanXinUser . setUsername ( \"HX_\" + userId ); // \u7528\u6237\u540d huanXinUser . setPassword ( IdUtil . simpleUUID ()); //\u968f\u673a\u751f\u6210\u7684\u5bc6\u7801 HttpResponse response = this . requestService . execute ( targetUrl , JSONUtil . toJsonStr ( Arrays . asList ( huanXinUser )), Method . POST ); if ( response . isOk ()) { //\u5c06\u73af\u4fe1\u7684\u8d26\u53f7\u4fe1\u606f\u4fdd\u5b58\u5230\u6570\u636e\u5e93 huanXinUser . setUserId ( userId ); huanXinUser . setCreated ( new Date ()); huanXinUser . setUpdated ( huanXinUser . getCreated ()); this . huanXinUserMapper . insert ( huanXinUser ); return true ; } return false ; } @Override public HuanXinUser queryHuanXinUser ( Long userId ) { QueryWrapper < HuanXinUser > wrapper = new QueryWrapper <> (); wrapper . eq ( \"user_id\" , userId ); return this . huanXinUserMapper . selectOne ( wrapper ); } package com.tanhua.dubbo.server.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.dubbo.server.pojo.HuanXinUser ; import org.apache.ibatis.annotations.Mapper ; @Mapper public interface HuanXinUserMapper extends BaseMapper < HuanXinUser > { }","title":"8.2.3\u3001\u5b9e\u73b0\u63a5\u53e3"},{"location":"tantan/day06/#824","text":"package com.tanhua.dubbo.server ; import com.tanhua.dubbo.server.api.HuanXinApi ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @SpringBootTest @RunWith ( SpringRunner . class ) public class TestHuanXinApi { @Autowired private HuanXinApi huanXinApi ; @Test public void testRegister (){ //\u6ce8\u518c\u7528\u6237id\u4e3a1\u7684\u7528\u6237\u5230\u73af\u4fe1 System . out . println ( this . huanXinApi . register ( 1L )); } @Test public void testQueryHuanXinUser (){ //\u6839\u636e\u7528\u6237id\u67e5\u8be2\u73af\u4fe1\u7528\u6237\u4fe1\u606f System . out . println ( this . huanXinApi . queryHuanXinUser ( 1L )); } }","title":"8.2.4\u3001\u6d4b\u8bd5\u7528\u4f8b"},{"location":"tantan/day06/#825sso","text":"\u9700\u8981\u5728sso\u7cfb\u7edf\u4e2d\u4f7f\u7528dubbo\u670d\u52a1\u8fdb\u884c\u6ce8\u518c\u73af\u4fe1\u7528\u6237\u3002 \u7b2c\u4e00\u6b65\uff0c\u5bfc\u5165\u4f9d\u8d56\uff1a <dependency> <groupId> cn.itcast.tanhua </groupId> <artifactId> my-tanhua-dubbo-interface </artifactId> <version> 1.0-SNAPSHOT </version> </dependency> <!--dubbo\u7684springboot\u652f\u6301--> <dependency> <groupId> com.alibaba.boot </groupId> <artifactId> dubbo-spring-boot-starter </artifactId> </dependency> <!--dubbo\u6846\u67b6--> <dependency> <groupId> com.alibaba </groupId> <artifactId> dubbo </artifactId> </dependency> <!--zk\u4f9d\u8d56--> <dependency> <groupId> org.apache.zookeeper </groupId> <artifactId> zookeeper </artifactId> </dependency> <dependency> <groupId> com.github.sgroschupf </groupId> <artifactId> zkclient </artifactId> </dependency> \u7b2c\u4e8c\u6b65\uff0c\u589e\u52a0dubbo\u6ce8\u518c\u4e2d\u5fc3\u914d\u7f6e application.properties\uff1a #dubbo\u6ce8\u518c\u4e2d\u5fc3\u914d\u7f6e dubbo.application.name = itcast-tanhua-server dubbo.registry.address = zookeeper://192.168.31.81:2181 dubbo.registry.client = zkclient dubbo.registry.timeout = 60000 dubbo.consumer.timeout = 60000 \u7b2c\u4e09\u6b65\uff0c\u5728UserService\u4e2d\u589e\u52a0\u76f8\u5e94\u7684\u903b\u8f91\uff1a @Reference ( version = \"1.0.0\" ) private HuanXinApi huanXinApi ; /** * \u7528\u6237\u767b\u5f55 * * @param phone \u624b\u673a\u53f7 * @param code \u9a8c\u8bc1\u7801 * @return */ public String login ( String phone , String code ) { String redisKey = \"CHECK_CODE_\" + phone ; boolean isNew = false ; //\u6821\u9a8c\u9a8c\u8bc1\u7801 String redisData = this . redisTemplate . opsForValue (). get ( redisKey ); if ( ! StringUtils . equals ( code , redisData )) { return null ; //\u9a8c\u8bc1\u7801\u9519\u8bef } //\u9a8c\u8bc1\u7801\u5728\u6821\u9a8c\u5b8c\u6210\u540e\uff0c\u9700\u8981\u5e9f\u5f03 this . redisTemplate . delete ( redisKey ); QueryWrapper < User > queryWrapper = new QueryWrapper <> (); queryWrapper . eq ( \"mobile\" , phone ); User user = this . userMapper . selectOne ( queryWrapper ); if ( null == user ) { //\u9700\u8981\u6ce8\u518c\u8be5\u7528\u6237 user = new User (); user . setMobile ( phone ); user . setPassword ( DigestUtils . md5Hex ( \"123456\" )); //\u6ce8\u518c\u65b0\u7528\u6237 this . userMapper . insert ( user ); isNew = true ; //\u6ce8\u518c\u73af\u4fe1\u7528\u6237 Boolean result = this . huanXinApi . register ( user . getId ()); if ( ! result ) { //\u6ce8\u518c\u73af\u4fe1\u5931\u8d25\uff0c\u8bb0\u5f55\u65e5\u5fd7 log . error ( \"\u6ce8\u518c\u73af\u4fe1\u7528\u6237\u5931\u8d25~ userId = \" + user . getId ()); } } //\u751f\u6210token Map < String , Object > claims = new HashMap < String , Object > (); claims . put ( \"id\" , user . getId ()); // \u751f\u6210token String token = Jwts . builder () . setClaims ( claims ) //payload\uff0c\u5b58\u653e\u6570\u636e\u7684\u4f4d\u7f6e\uff0c\u4e0d\u80fd\u653e\u7f6e\u654f\u611f\u6570\u636e\uff0c\u5982\uff1a\u5bc6\u7801\u7b49 . signWith ( SignatureAlgorithm . HS256 , secret ) //\u8bbe\u7f6e\u52a0\u5bc6\u65b9\u6cd5\u548c\u52a0\u5bc6\u76d0 . setExpiration ( new DateTime (). plusHours ( 12 ). toDate ()) //\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c12\u5c0f\u65f6\u540e\u8fc7\u671f . compact (); try { //\u53d1\u9001\u7528\u6237\u767b\u5f55\u6210\u529f\u7684\u6d88\u606f Map < String , Object > msg = new HashMap <> (); msg . put ( \"id\" , user . getId ()); msg . put ( \"date\" , System . currentTimeMillis ()); this . rocketMQTemplate . convertAndSend ( \"tanhua-sso-login\" , msg ); } catch ( MessagingException e ) { log . error ( \"\u53d1\u9001\u6d88\u606f\u5931\u8d25\uff01\" , e ); } return token + \"|\" + isNew ; }","title":"8.2.5\u3001\u5728sso\u4e2d\u6ce8\u518c\u73af\u4fe1\u7528\u6237"},{"location":"tantan/day06/#826","text":"\u5c06\u670d\u52a1\u5168\u90e8\u8dd1\u8d77\u6765\uff0c\u4f7f\u7528APP\u8fdb\u884c\u6d4b\u8bd5\uff0c\u4f7f\u7528\u65b0\u624b\u673a\u53f7\u8fdb\u884c\u767b\u5f55\u6d4b\u8bd5\u3002 \u65b0\u6ce8\u518c\u7684\u7528\u6237\uff1a \u6240\u5bf9\u5e94\u7684\u73af\u4fe1\u7528\u6237\uff1a \u73af\u4fe1\u5e73\u53f0\uff1a \u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u6ce8\u518c\u5230\u4e86\u73af\u4fe1\u3002","title":"8.2.6\u3001\u6d4b\u8bd5"},{"location":"tantan/day06/#83","text":"\u5728app\u4e2d\uff0c\u7528\u6237\u767b\u5f55\u540e\u9700\u8981\u6839\u636e\u7528\u6237\u540d\u5bc6\u7801\u767b\u5f55\u73af\u4fe1\uff0c\u7531\u4e8e\u7528\u6237\u540d\u5bc6\u7801\u4fdd\u5b58\u5728\u540e\u53f0\uff0c\u6240\u4ee5\u9700\u8981\u63d0\u4f9b\u63a5\u53e3\u8fdb\u884c\u8fd4\u56de\u3002 mock\u5730\u5740\uff1a https://mock-java.itheima.net/project/35/interface/api/563","title":"8.3\u3001\u67e5\u8be2\u73af\u4fe1\u7528\u6237\u4fe1\u606f"},{"location":"tantan/day06/#831huanxinuservo","text":"package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class HuanXinUserVo { private String username ; private String password ; }","title":"8.3.1\u3001HuanXinUserVo"},{"location":"tantan/day06/#832huanxincontroller","text":"package com.tanhua.server.controller ; import com.tanhua.server.service.HuanXinService ; import com.tanhua.server.vo.HuanXinUserVo ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RestController ; @RestController @RequestMapping ( \"huanxin\" ) public class HuanXinController { @Autowired private HuanXinService huanXinService ; @GetMapping ( \"user\" ) public HuanXinUserVo queryHuanXinUser (){ return this . huanXinService . queryHuanXinUser (); } }","title":"8.3.2\u3001HuanXinController"},{"location":"tantan/day06/#833huanxinservice","text":"package com.tanhua.server.service ; import cn.hutool.core.util.ObjectUtil ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.common.pojo.User ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.dubbo.server.api.HuanXinApi ; import com.tanhua.dubbo.server.pojo.HuanXinUser ; import com.tanhua.server.vo.HuanXinUserVo ; import org.springframework.stereotype.Service ; @Service public class HuanXinService { @Reference ( version = \"1.0.0\" ) private HuanXinApi huanXinApi ; public HuanXinUserVo queryHuanXinUser () { User user = UserThreadLocal . get (); //\u901a\u8fc7dubbo\u670d\u52a1\u67e5\u8be2\u73af\u4fe1\u7528\u6237 HuanXinUser huanXinUser = this . huanXinApi . queryHuanXinUser ( user . getId ()); if ( ObjectUtil . isNotEmpty ( huanXinUser )) { return new HuanXinUserVo ( huanXinUser . getUsername (), huanXinUser . getPassword ()); } return null ; } }","title":"8.3.3\u3001HuanXinService"},{"location":"tantan/day06/#834","text":"","title":"8.3.4\u3001\u6d4b\u8bd5"},{"location":"tantan/day06/#84","text":"\u5728\u6d88\u606f\u6a21\u5757\u4e2d\uff0c\u9700\u8981\u5b9e\u73b0\u6839\u636e\u73af\u4fe1\u7528\u6237\u540d\u67e5\u8be2\u4e2a\u4eba\u7684\u7528\u6237\u4fe1\u606f\u3002 \u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/2921","title":"8.4\u3001\u67e5\u8be2\u4e2a\u4eba\u4fe1\u606f"},{"location":"tantan/day06/#841dubbo","text":"","title":"8.4.1\u3001dubbo\u670d\u52a1"},{"location":"tantan/day06/#8411","text":"//com.tanhua.dubbo.server.api.HuanXinApi /** * \u6839\u636e\u73af\u4fe1\u7528\u6237\u540d\u67e5\u8be2\u7528\u6237\u4fe1\u606f * * @param userName * @return */ HuanXinUser queryUserByUserName ( String userName );","title":"8.4.1.1\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day06/#8412","text":"//com.tanhua.dubbo.server.api.HuanXinApiImpl @Override public HuanXinUser queryUserByUserName ( String userName ) { QueryWrapper < HuanXinUser > wrapper = new QueryWrapper <> (); wrapper . eq ( \"username\" , userName ); return this . huanXinUserMapper . selectOne ( wrapper ); }","title":"8.4.1.2\u3001\u7f16\u5199\u5b9e\u73b0"},{"location":"tantan/day06/#842app","text":"","title":"8.4.2\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day06/#8421userinfovo","text":"package com.tanhua.server.vo ; import cn.hutool.core.annotation.Alias ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @AllArgsConstructor @NoArgsConstructor public class UserInfoVo { @Alias ( \"userId\" ) private Long id ; //\u7528\u6237id @Alias ( \"logo\" ) private String avatar ; //\u5934\u50cf @Alias ( \"nickName\" ) private String nickname ; //\u6635\u79f0 private String birthday ; //\u751f\u65e5 2019-09-11 private String age ; //\u5e74\u9f84 private String gender ; //\u6027\u522b man woman private String city ; //\u57ce\u5e02 @Alias ( \"edu\" ) private String education ; //\u5b66\u5386 private String income ; //\u6708\u6536\u5165 @Alias ( \"industry\" ) private String profession ; //\u884c\u4e1a private Integer marriage ; //\u5a5a\u59fb\u72b6\u6001\uff080\u672a\u5a5a\uff0c1\u5df2\u5a5a\uff09 }","title":"8.4.2.1\u3001UserInfoVo"},{"location":"tantan/day06/#8422imcontroller","text":"//com.tanhua.server.controller.IMController package com.tanhua.server.controller ; import cn.hutool.core.util.ObjectUtil ; import com.tanhua.server.service.IMService ; import com.tanhua.server.vo.UserInfoVo ; import lombok.extern.slf4j.Slf4j ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RequestParam ; import org.springframework.web.bind.annotation.RestController ; @RequestMapping ( \"messages\" ) @RestController @Slf4j public class IMController { @Autowired private IMService imService ; /** * \u6839\u636e\u73af\u4fe1\u7528\u6237\u540d\u67e5\u8be2\u7528\u6237\u4fe1\u606f * * @param userName \u73af\u4fe1\u7528\u6237 * @return */ @GetMapping ( \"userinfo\" ) public ResponseEntity < UserInfoVo > queryUserInfoByUserName ( @RequestParam ( \"huanxinId\" ) String userName ) { try { UserInfoVo userInfoVo = this . imService . queryUserInfoByUserName ( userName ); if ( ObjectUtil . isNotEmpty ( userInfoVo )) { return ResponseEntity . ok ( userInfoVo ); } } catch ( Exception e ) { log . error ( \"\u6839\u636e\u73af\u4fe1id\u67e5\u8be2\u7528\u6237\u4fe1\u606f! userName = \" + userName , e ); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } }","title":"8.4.2.2\u3001IMController"},{"location":"tantan/day06/#8423imservice","text":"//com.tanhua.server.service.IMService package com.tanhua.server.service ; import cn.hutool.core.bean.BeanUtil ; import cn.hutool.core.util.ObjectUtil ; import cn.hutool.core.util.StrUtil ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.common.pojo.UserInfo ; import com.tanhua.dubbo.server.api.HuanXinApi ; import com.tanhua.dubbo.server.pojo.HuanXinUser ; import com.tanhua.server.vo.UserInfoVo ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; @Service public class IMService { @Reference ( version = \"1.0.0\" ) private HuanXinApi huanXinApi ; @Autowired private UserInfoService userInfoService ; public UserInfoVo queryUserInfoByUserName ( String userName ) { //\u67e5\u8be2\u73af\u4fe1\u8d26\u6237 HuanXinUser huanXinUser = this . huanXinApi . queryUserByUserName ( userName ); if ( ObjectUtil . isEmpty ( huanXinUser )) { return null ; } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f UserInfo userInfo = this . userInfoService . queryUserInfoByUserId ( huanXinUser . getUserId ()); if ( ObjectUtil . isEmpty ( userInfo )) { return null ; } UserInfoVo userInfoVo = BeanUtil . copyProperties ( userInfo , UserInfoVo . class , \"marriage\" ); userInfoVo . setGender ( userInfo . getSex (). toString (). toLowerCase ()); userInfoVo . setMarriage ( StrUtil . equals ( \"\u5df2\u5a5a\" , userInfo . getMarriage ()) ? 1 : 0 ); return userInfoVo ; } }","title":"8.4.2.3\u3001IMService"},{"location":"tantan/day06/#8424","text":"","title":"8.4.2.4\u3001\u6d4b\u8bd5"},{"location":"tantan/day06/#85id","text":"\u5728\u6d88\u606f\u6a21\u5757\u4e0e\u6211\u7684\u6a21\u5757\u4e2d\uff0c\u9700\u8981\u6839\u636e\u7528\u6237id\u67e5\u8be2\u4e2a\u4eba\u4fe1\u606f\uff0c\u5176\u54cd\u5e94\u7684\u6570\u636e\u7ed3\u6784\u4e0e\u4e0a\u9762\u4e00\u81f4\uff0c\u5747\u4e3a\uff1aUserInfoVo\u5bf9\u8c61\u3002 \u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/875","title":"8.5\u3001\u6839\u636e\u7528\u6237id\u67e5\u8be2\u4e2a\u4eba\u4fe1\u606f"},{"location":"tantan/day06/#851mycentercontroller","text":"package com.tanhua.server.controller ; import cn.hutool.core.util.ObjectUtil ; import com.tanhua.server.service.MyCenterService ; import com.tanhua.server.vo.UserInfoVo ; import lombok.extern.slf4j.Slf4j ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RequestParam ; import org.springframework.web.bind.annotation.RestController ; @RequestMapping ( \"users\" ) @RestController @Slf4j public class MyCenterController { @Autowired private MyCenterService myCenterService ; /** * \u6839\u636e\u7528\u6237id\u67e5\u8be2\u7528\u6237\u4fe1\u606f * * @param userId \u7528\u6237id\uff0c\u5982\u679c\u4e3a\u7a7a\uff0c\u8868\u793a\u67e5\u8be2\u5f53\u524d\u767b\u5f55\u4eba\u7684\u4fe1\u606f * @return */ @GetMapping public ResponseEntity < UserInfoVo > queryUserInfoByUserId ( @RequestParam ( value = \"userID\" , required = false ) Long userId ) { try { UserInfoVo userInfoVo = this . myCenterService . queryUserInfoByUserId ( userId ); if ( ObjectUtil . isNotEmpty ( userInfoVo )) { return ResponseEntity . ok ( userInfoVo ); } } catch ( Exception e ) { log . error ( \"\u6839\u636e\u7528\u6237id\u67e5\u8be2\u7528\u6237\u4fe1\u606f\u51fa\u9519~ userId = \" + userId , e ); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } }","title":"8.5.1\u3001MyCenterController"},{"location":"tantan/day06/#852mycenterservice","text":"package com.tanhua.server.service ; import cn.hutool.core.bean.BeanUtil ; import cn.hutool.core.util.ObjectUtil ; import cn.hutool.core.util.StrUtil ; import com.tanhua.common.pojo.UserInfo ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.server.vo.UserInfoVo ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; @Service public class MyCenterService { @Autowired private UserInfoService userInfoService ; public UserInfoVo queryUserInfoByUserId ( Long userId ) { if ( ObjectUtil . isEmpty ( userId )) { //\u5982\u679c\u67e5\u8be2id\u4e3anull\uff0c\u5c31\u8868\u793a\u67e5\u8be2\u5f53\u524d\u7528\u6237\u4fe1\u606f userId = UserThreadLocal . get (). getId (); } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f UserInfo userInfo = this . userInfoService . queryUserInfoByUserId ( userId ); if ( ObjectUtil . isEmpty ( userInfo )) { return null ; } UserInfoVo userInfoVo = BeanUtil . copyProperties ( userInfo , UserInfoVo . class , \"marriage\" ); userInfoVo . setGender ( userInfo . getSex (). toString (). toLowerCase ()); userInfoVo . setMarriage ( StrUtil . equals ( \"\u5df2\u5a5a\" , userInfo . getMarriage ()) ? 1 : 0 ); return userInfoVo ; } }","title":"8.5.2\u3001MyCenterService"},{"location":"tantan/day06/#853","text":"","title":"8.5.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day06/#86","text":"\u76ee\u524d\u5df2\u7ecf\u5b8c\u6210\u4e86\u7528\u6237\u4f53\u7cfb\u7684\u5bf9\u63a5\uff0c\u4e0b\u9762\u6211\u4eec\u8fdb\u884c\u6d4b\u8bd5\u53d1\u9001\u6d88\u606f\uff0c\u573a\u666f\u662f\u8fd9\u6837\u7684\uff1a \u70b9\u51fb\u201c\u804a\u4e00\u4e0b\u201d\uff0c\u5c31\u4f1a\u7ed9\u5bf9\u65b9\u53d1\u9001\u4e00\u6761\u964c\u751f\u4eba\u4fe1\u606f\uff0c\u8fd9\u4e2a\u6d88\u606f\u7531\u7cfb\u7edf\u53d1\u9001\u5b8c\u6210\u3002 \u6211\u4eec\u6682\u65f6\u901a\u8fc7\u73af\u4fe1\u7684\u63a7\u5236\u53f0\u8fdb\u884c\u53d1\u9001\uff1a \u6d88\u606f\u5185\u5bb9\uff1a { \"userId\" :1, \"huanXinId\" : \"HX_1\" , \"nickname\" : \"\u9ed1\u9a6c\u5c0f\u59b9\" , \"strangerQuestion\" : \"\u4f60\u559c\u6b22\u53bb\u770b\u851a\u84dd\u7684\u5927\u6d77\u8fd8\u662f\u53bb\u722c\u5dcd\u5ce8\u7684\u9ad8\u5c71\uff1f\" , \"reply\" : \"\u6211\u559c\u6b22\u79cb\u5929\u7684\u843d\u53f6\uff0c\u590f\u5929\u7684\u6cc9\u6c34\uff0c\u51ac\u5929\u7684\u96ea\u5730\uff0c\u53ea\u8981\u6709\u4f60\u4e00\u5207\u7686\u53ef~\" } \u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u63a5\u6536\u5230\u4e86\u6d88\u606f\u3002","title":"8.6\u3001\u53d1\u9001\u6d88\u606f\u7ed9\u5ba2\u6237\u7aef"},{"location":"tantan/day06/#87","text":"\u9700\u8981\u5c061~99\u7528\u6237\u6ce8\u518c\u5230\u73af\u4fe1\uff0c\u56e0\u4e3a\u6211\u4eec\u63d0\u4f9b\u7684\u6570\u636e\u90fd\u662f\u8fd9\u4e9b\u7528\u6237\u7684\u6570\u636e\u3002 //com.tanhua.dubbo.server.TestHuanXinApi @Test public void testRegisterAllUser (){ for ( int i = 1 ; i < 100 ; i ++ ) { this . huanXinApi . register ( Long . valueOf ( i )); } } \u73af\u4fe1\uff1a","title":"8.7\u3001\u5c06\u7528\u6237\u6570\u636e\u540c\u6b65\u5230\u73af\u4fe1"},{"location":"tantan/day06/#9","text":"\u70b9\u51fb\u201c\u804a\u4e00\u4e0b\u201d\uff0c\u5c31\u4f1a\u6210\u4e3a\u8054\u7cfb\u4eba\uff08\u597d\u53cb\uff09\u3002 \u5b9e\u73b0\uff1a \u5c06\u597d\u53cb\u5199\u5165\u5230MongoDB\u4e2d \u5c06\u597d\u53cb\u5173\u7cfb\u6ce8\u518c\u5230\u73af\u4fe1 \u5177\u4f53\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a","title":"9\u3001 \u6dfb\u52a0\u8054\u7cfb\u4eba"},{"location":"tantan/day06/#91dubbo","text":"","title":"9.1\u3001\u597d\u53cbdubbo\u670d\u52a1"},{"location":"tantan/day06/#911","text":"package com.tanhua.dubbo.server.api ; public interface UsersApi { /** * \u4fdd\u5b58\u597d\u53cb\u5173\u7cfb * * @param userId \u7528\u6237id * @param friendId \u597d\u53cbid * @return */ String saveUsers ( Long userId , Long friendId ); /** * \u5220\u9664\u597d\u53cb\u6570\u636e * * @param userId \u7528\u6237id * @param friendId \u597d\u53cbid * @return */ Boolean removeUsers ( Long userId , Long friendId ); }","title":"9.1.1\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day06/#912","text":"package com.tanhua.dubbo.server.api ; import cn.hutool.core.util.ObjectUtil ; import com.alibaba.dubbo.config.annotation.Service ; import com.tanhua.dubbo.server.pojo.Users ; import org.bson.types.ObjectId ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; @Service ( version = \"1.0.0\" ) public class UsersApiImpl implements UsersApi { @Autowired private MongoTemplate mongoTemplate ; @Override public String saveUsers ( Long userId , Long friendId ) { if ( ! ObjectUtil . isAllNotEmpty ( userId , friendId )) { return null ; } // \u68c0\u6d4b\u662f\u5426\u8be5\u597d\u53cb\u5173\u7cfb\u662f\u5426\u5b58\u5728 Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId ) . and ( \"friendId\" ). is ( friendId )); long count = this . mongoTemplate . count ( query , Users . class ); if ( count > 0 ) { return null ; } Users users = new Users (); users . setId ( ObjectId . get ()); users . setDate ( System . currentTimeMillis ()); users . setUserId ( userId ); users . setFriendId ( friendId ); //\u6ce8\u518c\u6211\u4e0e\u597d\u53cb\u7684\u5173\u7cfb this . mongoTemplate . save ( users ); //\u6ce8\u518c\u597d\u53cb\u4e0e\u6211\u7684\u5173\u7cfb users . setId ( ObjectId . get ()); users . setUserId ( friendId ); users . setFriendId ( userId ); this . mongoTemplate . save ( users ); return users . getId (). toHexString (); } @Override public Boolean removeUsers ( Long userId , Long friendId ) { Query query1 = Query . query ( Criteria . where ( \"userId\" ). is ( userId ) . and ( \"friendId\" ). is ( friendId )); //\u5220\u9664\u6211\u4e0e\u597d\u53cb\u7684\u5173\u7cfb\u6570\u636e long count1 = this . mongoTemplate . remove ( query1 , Users . class ). getDeletedCount (); Query query2 = Query . query ( Criteria . where ( \"userId\" ). is ( friendId ) . and ( \"friendId\" ). is ( userId )); //\u5220\u9664\u597d\u53cb\u4e0e\u6211\u7684\u5173\u7cfb\u6570\u636e long count2 = this . mongoTemplate . remove ( query2 , Users . class ). getDeletedCount (); return count1 > 0 && count2 > 0 ; } }","title":"9.1.2\u3001\u7f16\u5199\u5b9e\u73b0"},{"location":"tantan/day06/#92dubbo","text":"","title":"9.2\u3001\u73af\u4fe1dubbo\u670d\u52a1"},{"location":"tantan/day06/#921","text":"\u5728my-tanhua-dubbo-interface\u4e2d\u5b9a\u4e49\u3002 //com.tanhua.dubbo.server.api.HuanXinApi /** * \u6dfb\u52a0\u597d\u53cb\uff08\u53cc\u5411\u597d\u53cb\u5173\u7cfb\uff09 * \u53c2\u89c1\uff1ahttp://docs-im.easemob.com/im/server/ready/user#%E6%B7%BB%E5%8A%A0%E5%A5%BD%E5%8F%8B * * @param userId \u81ea\u5df1\u7684id * @param friendId \u597d\u53cb\u7684id * @return */ Boolean addUserFriend ( Long userId , Long friendId ); /** * \u5220\u9664\u597d\u53cb\u5173\u7cfb\uff08\u53cc\u5411\u5220\u9664\uff09 * \u53c2\u89c1\uff1ahttp://docs-im.easemob.com/im/server/ready/user#%E7%A7%BB%E9%99%A4%E5%A5%BD%E5%8F%8B * * @param userId \u81ea\u5df1\u7684id * @param friendId \u597d\u53cb\u7684id * @return */ Boolean removeUserFriend ( Long userId , Long friendId );","title":"9.2.1\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day06/#922","text":"\u5728my-tanhua-dubbo-huanxin\u4e2d\u5b9e\u73b0\u3002 //com.tanhua.dubbo.server.api.HuanXinApiImpl @Override public Boolean addUserFriend ( Long userId , Long friendId ) { String targetUrl = this . huanXinConfig . getUrl () + this . huanXinConfig . getOrgName () + \"/\" + this . huanXinConfig . getAppName () + \"/users/HX_\" + userId + \"/contacts/users/HX_\" + friendId ; try { // 404 -> \u5bf9\u65b9\u672a\u5728\u73af\u4fe1\u6ce8\u518c return this . requestService . execute ( targetUrl , null , Method . POST ). isOk (); } catch ( Exception e ) { e . printStackTrace (); } // \u6dfb\u52a0\u5931\u8d25 return false ; } @Override public Boolean removeUserFriend ( Long userId , Long friendId ) { String targetUrl = this . huanXinConfig . getUrl () + this . huanXinConfig . getOrgName () + \"/\" + this . huanXinConfig . getAppName () + \"/users/HX_\" + userId + \"/contacts/users/HX_\" + friendId ; try { // 404 -> \u5bf9\u65b9\u672a\u5728\u73af\u4fe1\u6ce8\u518c return this . requestService . execute ( targetUrl , null , Method . DELETE ). isOk (); } catch ( Exception e ) { e . printStackTrace (); } // \u6dfb\u52a0\u5931\u8d25 return false ; }","title":"9.2.2\u3001\u7f16\u5199\u5b9e\u73b0"},{"location":"tantan/day06/#93app","text":"\u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/809 \u5728my-tanhua-server\u4e2d\u5b8c\u6210\u3002 //com.tanhua.server.controller.IMController /** * \u6dfb\u52a0\u597d\u53cb * * @param param * @return */ @PostMapping ( \"contacts\" ) public ResponseEntity < Void > contactUser ( @RequestBody Map < String , Object > param ) { try { Long friendId = Long . valueOf ( param . get ( \"userId\" ). toString ()); boolean result = this . imService . contactUser ( friendId ); if ( result ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { log . error ( \"\u6dfb\u52a0\u8054\u7cfb\u4eba\u5931\u8d25! param = \" + param , e ); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } package com.tanhua.server.service ; import cn.hutool.core.util.StrUtil ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.common.pojo.User ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.dubbo.server.api.HuanXinApi ; import com.tanhua.dubbo.server.api.UsersApi ; import org.springframework.stereotype.Service ; @Service public class IMService { @Reference ( version = \"1.0.0\" ) private UsersApi usersApi ; @Reference ( version = \"1.0.0\" ) private HuanXinApi huanXinApi ; /** * \u6dfb\u52a0\u597d\u53cb * * @param friendId \u597d\u53cbid */ public boolean contactUser ( Long friendId ) { User user = UserThreadLocal . get (); String id = this . usersApi . saveUsers ( user . getId (), friendId ); if ( StrUtil . isNotEmpty ( id )) { //\u6ce8\u518c\u597d\u53cb\u5173\u7cfb\u5230\u73af\u4fe1 return this . huanXinApi . addUserFriend ( user . getId (), friendId ); } return false ; } }","title":"9.3\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day06/#94","text":"\u63a5\u53e3\u6d4b\u8bd5\uff1a Monodb\u6570\u636e\uff1a \u73af\u4fe1\u5e73\u53f0\u597d\u53cb\u6570\u636e\uff1a","title":"9.4\u3001\u6d4b\u8bd5"},{"location":"tantan/day06/#95","text":"\u7531\u4e8e\u4e4b\u524d\u7684\u6570\u636e\u5e76\u6ca1\u6709\u5b8c\u6574\u7684\u53cc\u5411\u6570\u636e\uff0c\u6240\u4ee5\u9700\u8981\u91cd\u65b0\u751f\u6210\uff0c\u5982\u4e0b\uff1a package com.tanhua.server ; import cn.hutool.core.convert.Convert ; import cn.hutool.core.util.RandomUtil ; import com.tanhua.common.pojo.User ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.server.service.IMService ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestIMService { @Autowired private IMService imService ; /** * \u6784\u9020\u597d\u53cb\u6570\u636e\uff0c\u4e3a1~99\u7528\u6237\u6784\u902010\u4e2a\u597d\u53cb */ @Test public void testUsers () { for ( int i = 1 ; i <= 99 ; i ++ ) { for ( int j = 0 ; j < 10 ; j ++ ) { User user = new User (); user . setId ( Convert . toLong ( i )); UserThreadLocal . set ( user ); this . imService . contactUser ( this . getFriendId ( user . getId ())); } } } private Long getFriendId ( Long userId ) { Long friendId = RandomUtil . randomLong ( 1 , 100 ); if ( friendId . intValue () == userId . intValue ()) { getFriendId ( userId ); } return friendId ; } }","title":"9.5\u3001\u91cd\u65b0\u751f\u6210\u597d\u53cb\u5173\u7cfb\u6570\u636e"},{"location":"tantan/day06/#10","text":"\u7528\u6237\u5728\u6d88\u606f\u6a21\u5757\u4e2d\uff0c\u53ef\u4ee5\u67e5\u770b\u8054\u7cfb\u4eba\u5217\u8868\uff08\u597d\u53cb\u5217\u8868\uff09\u3002 \u63a5\u53e3\u6587\u6863\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/803","title":"10\u3001\u8054\u7cfb\u4eba\u5217\u8868"},{"location":"tantan/day06/#101dubbo","text":"","title":"10.1\u3001dubbo\u670d\u52a1"},{"location":"tantan/day06/#1011","text":"//com.tanhua.dubbo.server.api.UsersApi /** * \u6839\u636e\u7528\u6237id\u67e5\u8be2\u5168\u90e8Users\u5217\u8868 * * @param userId * @return */ List < Users > queryAllUsersList ( Long userId ); /** * \u6839\u636e\u7528\u6237id\u67e5\u8be2Users\u5217\u8868(\u5206\u9875\u67e5\u8be2) * * @param userId * @return */ PageInfo < Users > queryUsersList ( Long userId , Integer page , Integer pageSize );","title":"10.1.1\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day06/#1012","text":"//com.tanhua.dubbo.server.api.UsersApiImpl @Override public List < Users > queryAllUsersList ( Long userId ) { Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId )); return this . mongoTemplate . find ( query , Users . class ); } @Override public PageInfo < Users > queryUsersList ( Long userId , Integer page , Integer pageSize ) { PageRequest pageRequest = PageRequest . of ( page - 1 , pageSize , Sort . by ( Sort . Order . desc ( \"created\" ))); Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId )). with ( pageRequest ); List < Users > usersList = this . mongoTemplate . find ( query , Users . class ); PageInfo < Users > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); pageInfo . setRecords ( usersList ); return pageInfo ; }","title":"10.1.2\u3001\u63a5\u53e3\u5b9e\u73b0"},{"location":"tantan/day06/#102app","text":"","title":"10.2\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day06/#1021usersvo","text":"package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class UsersVo { private Long id ; private String userId ; private String avatar ; private String nickname ; private String gender ; private Integer age ; private String city ; }","title":"10.2.1\u3001UsersVo"},{"location":"tantan/day06/#1022imcontroller","text":"//com.tanhua.server.controller.IMController /** * \u67e5\u8be2\u8054\u7cfb\u4eba\u5217\u8868 * * @param page * @param pageSize * @param keyword * @return */ @GetMapping ( \"contacts\" ) public ResponseEntity < PageResult > queryContactsList ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize , @RequestParam ( value = \"keyword\" , required = false ) String keyword ) { PageResult pageResult = this . imService . queryContactsList ( page , pageSize , keyword ); return ResponseEntity . ok ( pageResult ); }","title":"10.2.2\u3001IMController"},{"location":"tantan/day06/#1023imservice","text":"//com.tanhua.server.service.IMService public PageResult queryContactsList ( Integer page , Integer pageSize , String keyword ) { PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); User user = UserThreadLocal . get (); List < Users > usersList ; if ( StringUtils . isNotEmpty ( keyword )) { //\u5173\u952e\u4e0d\u4e3a\u7a7a\uff0c\u67e5\u8be2\u6240\u6709\u7684\u597d\u53cb\uff0c\u5728\u540e\u9762\u8fdb\u884c\u5173\u952e\u5b57\u8fc7\u6ee4 usersList = this . usersApi . queryAllUsersList ( user . getId ()); } else { //\u5173\u952e\u5b57\u4e3a\u7a7a\uff0c\u8fdb\u884c\u5206\u9875\u67e5\u8be2 PageInfo < Users > usersPageInfo = this . usersApi . queryUsersList ( user . getId (), page , pageSize ); usersList = usersPageInfo . getRecords (); } if ( CollUtil . isEmpty ( usersList )) { return pageResult ; } List < Object > userIds = CollUtil . getFieldValues ( usersList , \"friendId\" ); QueryWrapper < UserInfo > queryWrapper = new QueryWrapper <> (); queryWrapper . in ( \"user_id\" , userIds ); if ( StringUtils . isNotEmpty ( keyword )) { queryWrapper . like ( \"nick_name\" , keyword ); } List < UserInfo > userInfoList = this . userInfoService . queryUserInfoList ( queryWrapper ); List < UsersVo > contactsList = new ArrayList <> (); //\u586b\u5145\u7528\u6237\u4fe1\u606f for ( UserInfo userInfo : userInfoList ) { UsersVo usersVo = new UsersVo (); usersVo . setId ( userInfo . getUserId ()); usersVo . setAge ( userInfo . getAge ()); usersVo . setAvatar ( userInfo . getLogo ()); usersVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); usersVo . setNickname ( userInfo . getNickName ()); //\u73af\u4fe1\u7528\u6237\u8d26\u53f7 usersVo . setUserId ( \"HX_\" + String . valueOf ( userInfo . getUserId ())); usersVo . setCity ( StringUtils . substringBefore ( userInfo . getCity (), \"-\" )); contactsList . add ( usersVo ); } pageResult . setItems ( contactsList ); return pageResult ; }","title":"10.2.3\u3001IMService"},{"location":"tantan/day06/#103","text":"","title":"10.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day06/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/","text":"\u72ec\u7acb\u5b9e\u73b0\u89c6\u9891\u70b9\u8d5e\u529f\u80fd \u72ec\u7acb\u5b9e\u73b0\u89c6\u9891\u8bc4\u8bba\u529f\u80fd \u72ec\u7acb\u5b9e\u73b0\u89c6\u9891\u5173\u6ce8\u529f\u80fd \u4e86\u89e3\u5373\u65f6\u901a\u8baf\u4ee5\u53ca\u529f\u80fd \u4e86\u89e3\u5373\u65f6\u901a\u4fe1\u7684\u6280\u672f\u65b9\u6848 \u72ec\u7acb\u5b9e\u73b0\u73af\u4fe1\u7684\u7528\u6237\u4f53\u7cfb\u96c6\u6210 \u72ec\u7acb\u5b9e\u73b0\u6dfb\u52a0\u8054\u7cfb\u4eba \u72ec\u7acb\u5b9e\u73b0\u8054\u7cfb\u4eba\u5217\u8868","title":"\u5b66\u4e60\u76ee\u6807"},{"location":"tantan/day07/","text":"\u8bfe\u7a0b\u8bf4\u660e \u00b6 \u70b9\u8d5e\u6d88\u606f\u5217\u8868 \u559c\u6b22\u6d88\u606f\u5217\u8868 \u8bc4\u8bba\u6d88\u606f\u5217\u8868 \u516c\u544a\u5217\u8868 \u4e2a\u4eba\u4e3b\u9875 \u804a\u4e00\u4e0b\u529f\u80fd \u8c01\u770b\u8fc7\u6211\u7684\u529f\u80fd \u200b 1\u3001\u6d88\u606f\u70b9\u8d5e\u3001\u559c\u6b22\u3001\u8bc4\u8bba\u5217\u8868 \u00b6 \u5728\u6d88\u606f\u6a21\u5757\u4e2d\u7684\u70b9\u8d5e\u3001\u559c\u6b22\u3001\u8bc4\u8bba\u5217\u8868\uff0c\u662f\u522b\u4eba\u5bf9\u81ea\u5df1\u53d1\u5e03\u7684\u5185\u5bb9\u7684\u64cd\u4f5c\uff0c\u5176\u5b9e\u73b0\u57fa\u672c\u4e00\u81f4\uff0c\u6240\u4ee5\u5728\u4e00\u8d77\u5b9e\u73b0\u3002 \u6548\u679c\uff1a \u70b9\u8d5e\u5217\u8868\u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/779 \u8bc4\u8bba\u5217\u8868\u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/785 \u559c\u6b22\u5217\u8868\u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/791 1.1\u3001dubbo\u670d\u52a1 \u00b6 1.1.1\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 //com.tanhua.dubbo.server.api.QuanZiApi /** * \u67e5\u8be2\u5bf9\u6211\u7684\u70b9\u8d5e\u6d88\u606f\u5217\u8868 * * @return */ PageInfo < Comment > queryLikeCommentListByUser ( Long userId , Integer page , Integer pageSize ); /** * \u67e5\u8be2\u5bf9\u6211\u7684\u559c\u6b22\u6d88\u606f\u5217\u8868 * * @return */ PageInfo < Comment > queryLoveCommentListByUser ( Long userId , Integer page , Integer pageSize ); /** * \u67e5\u8be2\u5bf9\u6211\u7684\u8bc4\u8bba\u6d88\u606f\u5217\u8868 * * @return */ PageInfo < Comment > queryCommentListByUser ( Long userId , Integer page , Integer pageSize ); 1.1.2\u3001\u7f16\u5199\u5b9e\u73b0 \u00b6 //com.tanhua.dubbo.server.api.QuanziApiImpl @Override public PageInfo < Comment > queryLikeCommentListByUser ( Long userId , Integer page , Integer pageSize ) { return this . queryCommentListByUser ( userId , CommentType . LIKE , page , pageSize ); } @Override public PageInfo < Comment > queryLoveCommentListByUser ( Long userId , Integer page , Integer pageSize ) { return this . queryCommentListByUser ( userId , CommentType . LOVE , page , pageSize ); } @Override public PageInfo < Comment > queryCommentListByUser ( Long userId , Integer page , Integer pageSize ) { return this . queryCommentListByUser ( userId , CommentType . COMMENT , page , pageSize ); } private PageInfo < Comment > queryCommentListByUser ( Long userId , CommentType commentType , Integer page , Integer pageSize ) { PageRequest pageRequest = PageRequest . of ( page - 1 , pageSize , Sort . by ( Sort . Order . desc ( \"created\" ))); Query query = new Query ( Criteria . where ( \"publishUserId\" ). is ( userId ) . and ( \"commentType\" ). is ( commentType . getType ())). with ( pageRequest ); List < Comment > commentList = this . mongoTemplate . find ( query , Comment . class ); PageInfo < Comment > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); pageInfo . setRecords ( commentList ); return pageInfo ; } 1.2\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 1.2.1\u3001MessageCommentVo \u00b6 \u6839\u636e\u63a5\u53e3\u5b9a\u4e49vo\u5bf9\u8c61\u3002 package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class MessageCommentVo { private String id ; private String avatar ; private String nickname ; private String createDate ; //\u683c\u5f0f\uff1a2019-09-08 10:07 } 1.2.3\u3001IMController \u00b6 //com.tanhua.server.controller.IMController /** * \u67e5\u8be2\u6d88\u606f\u70b9\u8d5e\u5217\u8868 * * @param page * @param pageSize * @return */ @GetMapping ( \"likes\" ) public ResponseEntity < PageResult > queryLikeCommentList ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize ) { try { PageResult pageResult = this . imService . queryLikeCommentList ( page , pageSize ); return ResponseEntity . ok ( pageResult ); } catch ( Exception e ) { log . error ( \"\u67e5\u8be2\u70b9\u8d5e\u5217\u8868\u5931\u8d25~ \" , e ); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u67e5\u8be2\u6d88\u606f\u8bc4\u8bba\u5217\u8868 * * @param page * @param pageSize * @return */ @GetMapping ( \"comments\" ) public ResponseEntity < PageResult > queryUserCommentList ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize ) { try { PageResult pageResult = this . imService . queryUserCommentList ( page , pageSize ); return ResponseEntity . ok ( pageResult ); } catch ( Exception e ) { log . error ( \"\u67e5\u8be2\u8bc4\u8bba\u5217\u8868\u5931\u8d25~ \" , e ); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u67e5\u8be2\u6d88\u606f\u559c\u6b22\u5217\u8868 * * @param page * @param pageSize * @return */ @GetMapping ( \"loves\" ) public ResponseEntity < PageResult > queryLoveCommentList ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize ) { try { PageResult pageResult = this . imService . queryLoveCommentList ( page , pageSize ); return ResponseEntity . ok ( pageResult ); } catch ( Exception e ) { log . error ( \"\u67e5\u8be2\u559c\u6b22\u5217\u8868\u5931\u8d25~ \" , e ); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 1.2.4\u3001IMService \u00b6 //com.tanhua.server.service.IMService public PageResult queryLikeCommentList ( Integer page , Integer pageSize ) { User user = UserThreadLocal . get (); PageInfo < Comment > pageInfo = this . quanZiApi . queryLikeCommentListByUser ( user . getId (), page , pageSize ); return this . fillUserCommentList ( pageInfo ); } public PageResult queryLoveCommentList ( Integer page , Integer pageSize ) { User user = UserThreadLocal . get (); PageInfo < Comment > pageInfo = this . quanZiApi . queryLoveCommentListByUser ( user . getId (), page , pageSize ); return this . fillUserCommentList ( pageInfo ); } public PageResult queryUserCommentList ( Integer page , Integer pageSize ) { User user = UserThreadLocal . get (); PageInfo < Comment > pageInfo = this . quanZiApi . queryCommentListByUser ( user . getId (), page , pageSize ); return this . fillUserCommentList ( pageInfo ); } private PageResult fillUserCommentList ( PageInfo < Comment > pageInfo ){ PageResult pageResult = new PageResult (); pageResult . setPage ( pageInfo . getPageNum ()); pageResult . setPagesize ( pageInfo . getPageSize ()); List < Comment > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )){ //\u6ca1\u6709\u67e5\u8be2\u5230\u6570\u636e return pageResult ; } List < Object > userIdList = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIdList ); List < MessageCommentVo > messageCommentVoList = new ArrayList <> (); for ( Comment comment : records ) { for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( comment . getUserId (), userInfo . getUserId ())){ MessageCommentVo messageCommentVo = new MessageCommentVo (); messageCommentVo . setId ( comment . getId (). toHexString ()); messageCommentVo . setAvatar ( userInfo . getLogo ()); messageCommentVo . setNickname ( userInfo . getNickName ()); messageCommentVo . setCreateDate ( DateUtil . format ( new Date ( comment . getCreated ()), \"yyyy-MM-dd HH:mm\" )); messageCommentVoList . add ( messageCommentVo ); break ; } } } pageResult . setItems ( messageCommentVoList ); return pageResult ; } 1.3\u3001\u6d4b\u8bd5 \u00b6 2\u3001\u516c\u544a\u5217\u8868 \u00b6 \u516c\u544a\u662f\u540e\u53f0\u7cfb\u7edf\u5bf9\u6240\u6709\u7528\u6237\u53d1\u5e03\u7684\u516c\u544a\u6d88\u606f\u3002 \u6548\u679c\uff1a \u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/797 2.1\u3001\u8868\u7ed3\u6784 \u00b6 CREATE TABLE ` tb_announcement ` ( ` id ` bigint ( 20 ) NOT NULL AUTO_INCREMENT , ` title ` varchar ( 200 ) DEFAULT NULL COMMENT '\u6807\u9898' , ` description ` text COMMENT '\u63cf\u8ff0' , ` created ` datetime DEFAULT NULL , ` updated ` datetime DEFAULT NULL , PRIMARY KEY ( ` id ` ), KEY ` created ` ( ` created ` ) ) ENGINE = InnoDB AUTO_INCREMENT = 4 DEFAULT CHARSET = utf8 COMMENT = '\u516c\u544a\u8868' ; --\u63d2\u5165\u6570\u636e INSERT INTO ` tb_announcement ` ( ` id ` , ` title ` , ` description ` , ` created ` , ` updated ` ) VALUES ( '1' , '\u63a2\u82b1\u65b0\u7248\u672c\u4e0a\u7ebf\u53d1\u5e03\u5566\uff5e,\u76db\u590fhigh\u8db4\u5f00\u59cb\u4e86\uff0c\u8d76\u7d27\u6765\u62a5\u540d\u5427\uff01' , '\u63a2\u82b1App2019\u5e747\u670823\u65e5\u8d77\u5728\u82f9\u679c\u5546\u5e97\u2026,\u6d53\u60c5\u590f\u65e5\uff0c\u6e05\u723d\u4e00\u805a\uff0c\u63a2\u82b1\u5c06\u5427\u5927\u5bb6\u805a\u2026' , '2019-10-14 11:06:34' , '2019-10-14 11:06:37' ); INSERT INTO ` tb_announcement ` ( ` id ` , ` title ` , ` description ` , ` created ` , ` updated ` ) VALUES ( '2' , '\u63a2\u82b1\u4ea4\u53cb\u7684\u5708\u5b50\u529f\u80fd\u6b63\u5f0f\u4e0a\u7ebf\u5566~~' , '\u63a2\u82b1\u4ea4\u53cb\u7684\u5708\u5b50\u529f\u80fd\u6b63\u5f0f\u4e0a\u7ebf\u5566\uff0c\u6b22\u8fce\u4f7f\u7528~' , '2019-10-14 11:09:31' , '2019-10-14 11:09:33' ); INSERT INTO ` tb_announcement ` ( ` id ` , ` title ` , ` description ` , ` created ` , ` updated ` ) VALUES ( '3' , '\u56fd\u5e86\u653e\u5047\u671f\u95f4\uff0c\u63a2\u82b1\u4ea4\u53cb\u6b63\u5e38\u4f7f\u7528~' , '\u56fd\u5e86\u653e\u5047\u671f\u95f4\uff0c\u63a2\u82b1\u4ea4\u53cb\u6b63\u5e38\u4f7f\u7528~' , '2019-10-14 11:10:01' , '2019-10-14 11:10:04' ); 2.2\u3001pojo \u00b6 package com.tanhua.common.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class Announcement extends BasePojo { private Long id ; private String title ; private String description ; } 2.3\u3001AnnouncementMapper \u00b6 package com.tanhua.common.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.common.pojo.Announcement ; public interface AnnouncementMapper extends BaseMapper < Announcement > { } 2.4\u3001AnnouncementService \u00b6 package com.tanhua.server.service ; import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper ; import com.baomidou.mybatisplus.core.metadata.IPage ; import com.baomidou.mybatisplus.extension.plugins.pagination.Page ; import com.tanhua.common.mapper.AnnouncementMapper ; import com.tanhua.common.pojo.Announcement ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; @Service public class AnnouncementService { @Autowired private AnnouncementMapper announcementMapper ; public IPage < Announcement > queryList ( Integer page , Integer pageSize ) { QueryWrapper queryWrapper = new QueryWrapper (); queryWrapper . orderByDesc ( \"created\" ); return this . announcementMapper . selectPage ( new Page < Announcement > ( page , pageSize ), queryWrapper ); } } 2.5\u3001\u5b9a\u4e49vo\u5bf9\u8c61 \u00b6 package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class AnnouncementVo { private String id ; private String title ; private String description ; private String createDate ; } 2.6\u3001IMController \u00b6 /** * \u67e5\u8be2\u516c\u544a\u5217\u8868 * * @param page * @param pageSize * @return */ @GetMapping ( \"announcements\" ) @NoAuthorization //\u4f18\u5316\uff0c\u65e0\u9700\u8fdb\u884ctoken\u6821\u9a8c public ResponseEntity < PageResult > queryMessageAnnouncementList ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize ) { try { PageResult pageResult = this . imService . queryMessageAnnouncementList ( page , pageSize ); return ResponseEntity . ok ( pageResult ); } catch ( Exception e ) { log . error ( \"\u67e5\u8be2\u516c\u544a\u5217\u8868\u5931\u8d25~ \" , e ); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 2.7\u3001IMService \u00b6 public PageResult queryMessageAnnouncementList ( Integer page , Integer pageSize ) { IPage < Announcement > announcementPage = this . announcementService . queryList ( page , pageSize ); List < AnnouncementVo > announcementVoList = new ArrayList <> (); for ( Announcement record : announcementPage . getRecords ()) { AnnouncementVo announcementVo = new AnnouncementVo (); announcementVo . setId ( record . getId (). toString ()); announcementVo . setTitle ( record . getTitle ()); announcementVo . setDescription ( record . getDescription ()); announcementVo . setCreateDate ( DateUtil . format ( record . getCreated (), \"yyyy-MM-dd HH:mm\" )); announcementVoList . add ( announcementVo ); } PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); pageResult . setItems ( announcementVoList ); return pageResult ; } 2.8\u3001\u6d4b\u8bd5 \u00b6 3\u3001\u4e2a\u4eba\u4e3b\u9875 \u00b6 \u70b9\u51fb\u9996\u9875\u7684\u4eca\u65e5\u4f73\u4eba\u6216\u4efb\u610f\u63a8\u8350\u4eba\u7684\u56fe\u7247\u5c31\u4f1a\u8fdb\u5165\u4e2a\u4eba\u4e3b\u9875\u9875\u9762\uff0c\u6548\u679c\u5982\u4e0b\uff1a \u5728\u4e2a\u4eba\u4e3b\u9875\u7684\u9875\u9762\u4e2d\uff0c\u4f1a\u663e\u793a\u51fa\u4e2a\u4eba\u4fe1\u606f\u3001\u7f18\u5206\u503c\u3001\u4e2a\u4eba\u76f8\u518c\u7b49\u5185\u5bb9\u3002 3.1\u3001\u4e2a\u4eba\u4fe1\u606f \u00b6 3.1.1\u3001dubbo\u670d\u52a1 \u00b6 \u9700\u8981\u5728dubbo\u670d\u52a1\u4e2d\u63d0\u4f9b\u67e5\u8be2\u7f18\u5206\u503c\u7684\u63a5\u53e3\u670d\u52a1\u3002 3.1.1.1\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 //com.tanhua.dubbo.server.api.RecommendUserApi /** * \u67e5\u8be2\u63a8\u8350\u597d\u53cb\u7684\u7f18\u5206\u503c * * @param userId \u597d\u53cb\u7684id * @param toUserId \u6211\u7684id * @return */ Double queryScore ( Long userId , Long toUserId ); 3.1.1.2\u3001\u5b9e\u73b0\u63a5\u53e3 \u00b6 //com.tanhua.dubbo.server.api.RecommendUserApiImpl @Override public Double queryScore ( Long userId , Long toUserId ) { Query query = Query . query ( Criteria . where ( \"toUserId\" ). is ( toUserId ) . and ( \"userId\" ). is ( userId )); RecommendUser recommendUser = this . mongoTemplate . findOne ( query , RecommendUser . class ); if ( null != recommendUser ) { return recommendUser . getScore (); } return null ; } 3.1.2\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 \u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/629 \u8bf4\u660e\uff1a\u8be5\u63a5\u53e3\u7684\u8fd4\u56de\u503c\u63a5\u53e3\u4e0e\u4eca\u65e5\u4f73\u4eba\u7684\u7ed3\u6784\u4e00\u81f4\uff0c\u6240\u4ee5\u53ef\u4ee5\u901a\u7528\u4eca\u65e5\u4f73\u4eba\u7684\u5bf9\u8c61\u3002 3.1.2.1\u3001TanHuaController \u00b6 package com.tanhua.server.controller ; import com.tanhua.server.service.TanHuaService ; import com.tanhua.server.vo.TodayBest ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.PathVariable ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RestController ; @RequestMapping ( \"tanhua\" ) @RestController public class TanHuaController { @Autowired private TanHuaService tanHuaService ; /** * \u67e5\u8be2\u4e2a\u4eba\u4e3b\u9875\u7684\u4e2a\u4eba\u4fe1\u606f * * @param userId * @return */ @GetMapping ( \"{id}/personalInfo\" ) public ResponseEntity < TodayBest > queryUserInfo ( @PathVariable ( \"id\" ) Long userId ) { try { TodayBest todayBest = this . tanHuaService . queryUserInfo ( userId ); return ResponseEntity . ok ( todayBest ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } } 3.1.2.2\u3001TanHuaService \u00b6 package com.tanhua.server.service ; import cn.hutool.core.convert.Convert ; import cn.hutool.core.util.ObjectUtil ; import cn.hutool.core.util.StrUtil ; import com.tanhua.common.pojo.User ; import com.tanhua.common.pojo.UserInfo ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.server.vo.TodayBest ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; @Service public class TanHuaService { @Autowired private UserInfoService userInfoService ; @Autowired private RecommendUserService recommendUserService ; public TodayBest queryUserInfo ( Long userId ) { UserInfo userInfo = this . userInfoService . queryUserInfoByUserId ( userId ); if ( ObjectUtil . isEmpty ( userInfo )){ return null ; } TodayBest todayBest = new TodayBest (); todayBest . setId ( userId ); todayBest . setAge ( userInfo . getAge ()); todayBest . setGender ( userInfo . getSex (). name (). toLowerCase ()); todayBest . setNickname ( userInfo . getNickName ()); todayBest . setTags ( Convert . toStrArray ( StrUtil . split ( userInfo . getTags (), ',' ))); todayBest . setAvatar ( userInfo . getLogo ()); //\u7f18\u5206\u503c User user = UserThreadLocal . get (); todayBest . setFateValue ( this . recommendUserService . queryScore ( userId , user . getId ()). longValue ()); return todayBest ; } } 3.1.2.3\u3001RecommendUserService \u00b6 //com.tanhua.server.service.RecommendUserService /** * \u67e5\u8be2\u63a8\u8350\u597d\u53cb\u7684\u7f18\u5206\u503c * * @param userId * @param toUserId * @return */ public Double queryScore ( Long userId , Long toUserId ){ Double score = this . recommendUserApi . queryScore ( userId , toUserId ); if ( ObjectUtil . isNotEmpty ( score )){ return score ; } //\u9ed8\u8ba4\u503c return 98 d ; } 3.1.3\u3001\u6d4b\u8bd5 \u00b6 3.2\u3001\u4e2a\u4eba\u76f8\u518c \u00b6 3.2.1\u3001dubbo\u670d\u52a1 \u00b6 3.2.1.1\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 //com.tanhua.dubbo.server.api.QuanZiApi /** * \u67e5\u8be2\u76f8\u518c\u8868 * * @param userId * @param page * @param pageSize * @return */ PageInfo < Publish > queryAlbumList ( Long userId , Integer page , Integer pageSize ); 3.2.1.2\u3001\u5b9e\u73b0\u63a5\u53e3 \u00b6 //com.tanhua.dubbo.server.api.QuanZiApiImpl @Override public PageInfo < Publish > queryAlbumList ( Long userId , Integer page , Integer pageSize ) { PageInfo < Publish > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); PageRequest pageRequest = PageRequest . of ( page - 1 , pageSize , Sort . by ( Sort . Order . desc ( \"created\" ))); Query query = new Query (). with ( pageRequest ); //\u67e5\u8be2\u81ea\u5df1\u7684\u76f8\u518c\u8868 List < Album > albumList = this . mongoTemplate . find ( query , Album . class , \"quanzi_album_\" + userId ); if ( CollUtil . isEmpty ( albumList )){ return pageInfo ; } List < Object > publishIdList = CollUtil . getFieldValues ( albumList , \"publishId\" ); Query queryPublish = Query . query ( Criteria . where ( \"id\" ). in ( publishIdList )) . with ( Sort . by ( Sort . Order . desc ( \"created\" ))); List < Publish > publishList = this . mongoTemplate . find ( queryPublish , Publish . class ); pageInfo . setRecords ( publishList ); return pageInfo ; } 3.2.2\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 \u63a5\u53e3\u6587\u6863\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/689 3.2.2.1\u3001QuanZiController \u00b6 //com.tanhua.server.controller.QuanZiController /** * \u81ea\u5df1\u7684\u6240\u6709\u52a8\u6001 * * @return */ @GetMapping ( \"all\" ) public ResponseEntity < PageResult > queryAlbumList ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize , @RequestParam ( value = \"userId\" ) Long userId ) { try { PageResult pageResult = this . quanZiService . queryAlbumList ( userId , page , pageSize ); return ResponseEntity . ok ( pageResult ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 3.2.2.2\u3001QuanZiService \u00b6 //com.tanhua.server.service.QuanZiService public PageResult queryAlbumList ( Long userId , Integer page , Integer pageSize ) { PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); //\u67e5\u8be2\u6570\u636e PageInfo < Publish > pageInfo = this . quanZiApi . queryAlbumList ( userId , page , pageSize ); if ( CollUtil . isEmpty ( pageInfo . getRecords ())){ return pageResult ; } //\u586b\u5145\u6570\u636e pageResult . setItems ( this . fillQuanZiVo ( pageInfo . getRecords ())); return pageResult ; } 3.2.3\u3001\u6d4b\u8bd5 \u00b6 3.3\u3001\u6574\u5408\u6d4b\u8bd5 \u00b6 4\u3001\u804a\u4e00\u4e0b \u00b6 \u5728\u4e2a\u4eba\u4e3b\u9875\u4e2d\uff0c\u70b9\u51fb\u804a\u4e00\u4e0b\u6309\u94ae\uff0c\u4f1a\u5f39\u51fa\u56de\u7b54\u95ee\u9898\u7a97\u53e3\uff0c\u8f93\u5165\u7b54\u6848\u540e\uff0c\u7cfb\u7edf\u4f1a\u5411\u5bf9\u65b9\u53d1\u9001\u4e00\u6761\u964c\u804a\u6d88\u606f\uff0c\u5982\u679c\u5bf9\u65b9\u5728\u964c\u804a\u6d88\u606f\u4e2d\u70b9\u51fb\u804a\u4e00\u4e0b\uff0c\u4ed6\u4eec\u5c31\u4f1a\u6210\u4e3a\u597d\u53cb\u3002 \u7528\u62371\u5728\u7528\u62372\u7684\u4e2a\u4eba\u4e3b\u9875\u4e2d\u70b9\u51fb\u201c\u804a\u4e00\u4e0b\u201d\uff0c\u6d41\u7a0b\u5982\u4e0b\uff1a 4.1\u3001\u964c\u804a\u95ee\u9898 \u00b6 \u70b9\u51fb\u804a\u4e00\u4e0b\u65f6\uff0c\u9700\u8981\u663e\u793a\u51fa\u95ee\u9898\uff0c\u6240\u4ee5\u9700\u8981\u5728mysql\u4e2d\u5b58\u50a8\u7528\u6237\u7684\u95ee\u9898\u3002 4.1.1\u3001\u8868\u7ed3\u6784 \u00b6 CREATE TABLE ` tb_question ` ( ` id ` bigint ( 20 ) NOT NULL AUTO_INCREMENT , ` user_id ` bigint ( 20 ) DEFAULT NULL COMMENT '\u7528\u6237id' , ` txt ` varchar ( 200 ) DEFAULT NULL COMMENT '\u95ee\u9898\u5185\u5bb9' , ` created ` datetime DEFAULT NULL , ` updated ` datetime DEFAULT NULL , PRIMARY KEY ( ` id ` ), KEY ` user_id ` ( ` user_id ` ) ) ENGINE = InnoDB DEFAULT CHARSET = utf8 ; 4.1.2\u3001Question\u5b9e\u4f53\u5bf9\u8c61 \u00b6 \u5728my-tanhua-common\u5de5\u7a0b\u4e2d\u5b8c\u6210\u3002 package com.tanhua.common.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class Question extends BasePojo { private Long id ; private Long userId ; //\u95ee\u9898\u5185\u5bb9 private String txt ; } 4.1.3\u3001QuestionMapper \u00b6 \u5728my-tanhua-common\u5de5\u7a0b\u4e2d\u5b8c\u6210\u3002 package com.tanhua.common.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.common.pojo.Question ; public interface QuestionMapper extends BaseMapper < Question > { } 4.1.4\u3001QuestionService \u00b6 \u5728my-tanhua-server\u5de5\u7a0b\u4e2d\u5b8c\u6210\u3002 package com.tanhua.server.service ; import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper ; import com.tanhua.common.mapper.QuestionMapper ; import com.tanhua.common.pojo.Question ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; @Service public class QuestionService { @Autowired private QuestionMapper questionMapper ; public Question queryQuestion ( Long userId ) { QueryWrapper queryWrapper = new QueryWrapper (); queryWrapper . eq ( \"user_id\" , userId ); return this . questionMapper . selectOne ( queryWrapper ); } } 4.2\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 \u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/635 4.2.1\u3001TanHuaController \u00b6 //com.tanhua.server.controller.TanHuaController /** * \u67e5\u8be2\u964c\u751f\u4eba\u95ee\u9898 * * @param userId * @return */ @GetMapping ( \"strangerQuestions\" ) public ResponseEntity < String > queryQuestion ( @RequestParam ( \"userId\" ) Long userId ) { try { String question = this . tanHuaService . queryQuestion ( userId ); return ResponseEntity . ok ( question ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 4.2.2\u3001TanHuaService \u00b6 //com.tanhua.server.service.TanHuaService public String queryQuestion ( Long userId ) { Question question = this . questionService . queryQuestion ( userId ); if ( ObjectUtil . isNotEmpty ( question )){ return question . getTxt (); } //\u9ed8\u8ba4\u7684\u95ee\u9898 return \"\u4f60\u7684\u7231\u597d\u662f\u4ec0\u4e48\uff1f\" ; } 4.2.3\u3001\u6d4b\u8bd5 \u00b6 4.3\u3001\u56de\u590d\u964c\u751f\u4eba\u95ee\u9898 \u00b6 \u70b9\u51fb\u95ee\u9898\u7a97\u53e3\u4e2d\u7684\u201c\u804a\u4e00\u4e0b\u201d\uff0c\u9700\u8981\u901a\u8fc7admin\u6743\u9650\u53d1\u9001\u7cfb\u7edf\u6d88\u606f\u3002 4.3.1\u3001dubbo\u670d\u52a1 \u00b6 4.3.1.1\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 //com.tanhua.dubbo.server.api.HuanXinApi /** * \u4ee5\u7ba1\u7406\u5458\u8eab\u4efd\u53d1\u9001\u6d88\u606f * \u6587\u6863\u5730\u5740\uff1ahttp://docs-im.easemob.com/im/server/basics/messages#%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF * * @param targetUserName \u53d1\u9001\u76ee\u6807\u7684\u7528\u6237\u540d * @param huanXinMessageType \u6d88\u606f\u7c7b\u578b * @param msg * @return */ Boolean sendMsgFromAdmin ( String targetUserName , HuanXinMessageType huanXinMessageType , String msg ); package com.tanhua.dubbo.server.enums ; /** * \u6d88\u606f\u7c7b\u578b\uff1btxt:\u6587\u672c\u6d88\u606f\uff0cimg\uff1a\u56fe\u7247\u6d88\u606f\uff0cloc\uff1a\u4f4d\u7f6e\u6d88\u606f\uff0caudio\uff1a\u8bed\u97f3\u6d88\u606f\uff0cvideo\uff1a\u89c6\u9891\u6d88\u606f\uff0cfile\uff1a\u6587\u4ef6\u6d88\u606f */ public enum HuanXinMessageType { TXT ( \"txt\" ), IMG ( \"img\" ), LOC ( \"loc\" ), AUDIO ( \"audio\" ), VIDEO ( \"video\" ), FILE ( \"file\" ); String type ; HuanXinMessageType ( String type ) { this . type = type ; } public String getType () { return type ; } } 4.3.1.2\u3001\u5b9e\u73b0\u63a5\u53e3 \u00b6 //com.tanhua.dubbo.server.api.HuanXinApiImpl @Override public Boolean sendMsgFromAdmin ( String targetUserName , HuanXinMessageType huanXinMessageType , String msg ) { String targetUrl = this . huanXinConfig . getUrl () + this . huanXinConfig . getOrgName () + \"/\" + this . huanXinConfig . getAppName () + \"/messages\" ; try { //{\"target_type\": \"users\",\"target\": [\"user2\",\"user3\"],\"msg\": {\"type\": \"txt\",\"msg\": \"testmessage\"},\"from\": \"user1\"} String body = JSONUtil . createObj () . set ( \"target_type\" , \"users\" ) . set ( \"target\" , JSONUtil . createArray (). set ( targetUserName )) . set ( \"msg\" , JSONUtil . createObj () . set ( \"type\" , huanXinMessageType . getType ()) . set ( \"msg\" , msg )). toString (); //\u8868\u793a\u6d88\u606f\u53d1\u9001\u8005;\u65e0\u6b64\u5b57\u6bb5Server\u4f1a\u9ed8\u8ba4\u8bbe\u7f6e\u4e3a\u201cfrom\u201d:\u201cadmin\u201d\uff0c\u6709from\u5b57\u6bb5\u4f46\u503c\u4e3a\u7a7a\u4e32(\u201c\u201d)\u65f6\u8bf7\u6c42\u5931\u8d25 // .set(\"from\", \"\") return this . requestService . execute ( targetUrl , body , Method . POST ). isOk (); } catch ( Exception e ) { log . error ( \"\u53d1\u9001\u6d88\u606f\u5931\u8d25~ targetUserName = \" + targetUserName + \", type = \" + huanXinMessageType . getType () + \", msg = \" + msg , e ); } return false ; } 4.3.2\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 \u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/641 4.3.2.1\u3001TanHuaController \u00b6 //com.tanhua.server.controller.TanHuaController /** * \u56de\u590d\u964c\u751f\u4eba\u95ee\u9898 * * @return */ @PostMapping ( \"strangerQuestions\" ) public ResponseEntity < Void > replyQuestion ( @RequestBody Map < String , Object > param ) { try { Long userId = Long . valueOf ( param . get ( \"userId\" ). toString ()); String reply = param . get ( \"reply\" ). toString (); Boolean result = this . tanHuaService . replyQuestion ( userId , reply ); if ( result ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 4.3.2.2\u3001TanHuaService \u00b6 //com.tanhua.server.service.TanHuaService @Reference ( version = \"1.0.0\" ) private HuanXinApi huanXinApi ; public Boolean replyQuestion ( Long userId , String reply ) { User user = UserThreadLocal . get (); UserInfo userInfo = this . userInfoService . queryUserInfoByUserId ( user . getId ()); //\u6784\u5efa\u6d88\u606f\u5185\u5bb9 Map < String , Object > msg = new HashMap <> (); msg . put ( \"userId\" , user . getId ()); msg . put ( \"huanXinId\" , \"HX_\" + user . getId ()); msg . put ( \"nickname\" , userInfo . getNickName ()); msg . put ( \"strangerQuestion\" , this . queryQuestion ( userId )); msg . put ( \"reply\" , reply ); //\u53d1\u9001\u73af\u4fe1\u6d88\u606f return this . huanXinApi . sendMsgFromAdmin ( \"HX_\" + userId , HuanXinMessageType . TXT , JSONUtil . toJsonStr ( msg )); } 4.3.3\u3001\u6d4b\u8bd5 \u00b6 \u7528\u6237heima_37\u6536\u5230\u964c\u751f\u4eba\u6d88\u606f\uff1a \u53ef\u4ee5\u770b\u5230\u597d\u53cb\u5df2\u7ecf\u6dfb\u52a0\u5b8c\u6210\uff0c\u53ef\u4ee5\u5728\u901a\u8baf\u5f55\u4e2d\u9009\u62e9\u597d\u53cb\u8fdb\u884c\u804a\u5929\u3002 \u5728\u964c\u804a\u6d88\u606f\u4e2d\u7684\u201c\u786e\u8ba4\u6dfb\u52a0\u201d\u529f\u80fd\uff0c\u5c31\u662f\u524d\u9762\u5b9e\u73b0\u7684\u6dfb\u52a0\u8054\u7cfb\u4eba\u63a5\u53e3\u3002 5\u3001\u8c01\u770b\u8fc7\u6211 \u00b6 \u67e5\u8be2\u522b\u4eba\u6765\u8bbf\u4e86\u6211\u7684\u4e3b\u9875\u7684\u4fe1\u606f\uff0c\u5176\u4ed6\u7528\u6237\u5728\u6d4f\u89c8\u6211\u7684\u4e3b\u9875\u65f6\uff0c\u9700\u8981\u8bb0\u5f55\u8bbf\u5ba2\u6570\u636e\u3002\u8bbf\u5ba2\u5728\u4e00\u5929\u5185\u6bcf\u4e2a\u7528\u6237\u53ea\u8bb0\u5f55\u4e00\u6b21\u3002 \u67e5\u8be2\u6570\u636e\u65f6\uff0c\u5982\u679c\u7528\u6237\u67e5\u8be2\u8fc7\u5217\u8868\uff0c\u5c31\u9700\u8981\u8bb0\u5f55\u8fd9\u6b21\u67e5\u8be2\u6570\u636e\u7684\u65f6\u95f4\uff0c\u4e0b\u6b21\u67e5\u8be2\u65f6\u67e5\u8be2\u5927\u4e8e\u7b49\u4e8e\u8be5\u65f6\u95f4\u7684\u6570\u636e\u3002 \u5982\u679c\uff0c\u7528\u6237\u6ca1\u6709\u8bb0\u5f55\u67e5\u8be2\u65f6\u95f4\uff0c\u5c31\u67e5\u8be2\u6700\u8fd1\u76845\u4e2a\u6765\u8bbf\u7528\u6237\u3002 \u9875\u9762\u6548\u679c\u5982\u4e0b\uff1a 5.1\u3001dubbo\u670d\u52a1 \u00b6 5.1.1\u3001\u5b9e\u4f53\u5bf9\u8c61 \u00b6 package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.mongodb.core.mapping.Document ; @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"visitors\" ) public class Visitors implements java . io . Serializable { private static final long serialVersionUID = 2811682148052386573L ; private ObjectId id ; private Long userId ; //\u6211\u7684id private Long visitorUserId ; //\u6765\u8bbf\u7528\u6237id private String from ; //\u6765\u6e90\uff0c\u5982\u9996\u9875\u3001\u5708\u5b50\u7b49 private Long date ; //\u6765\u8bbf\u65f6\u95f4 private Double score ; //\u5f97\u5206 } 5.1.2\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.pojo.Visitors ; import java.util.List ; public interface VisitorsApi { /** * \u4fdd\u5b58\u8bbf\u5ba2\u6570\u636e * * @param userId \u6211\u7684id * @param visitorUserId \u8bbf\u5ba2id * @param from \u6765\u6e90 * @return */ String saveVisitor ( Long userId , Long visitorUserId , String from ); /** * \u67e5\u8be2\u6211\u7684\u8bbf\u5ba2\u6570\u636e\uff0c\u5b58\u57282\u79cd\u60c5\u51b5\uff1a * 1. \u6211\u6ca1\u6709\u770b\u8fc7\u6211\u7684\u8bbf\u5ba2\u6570\u636e\uff0c\u8fd4\u56de\u524d5\u4e2a\u8bbf\u5ba2\u4fe1\u606f * 2. \u4e4b\u524d\u770b\u8fc7\u6211\u7684\u8bbf\u5ba2\uff0c\u4ece\u4e0a\u4e00\u6b21\u67e5\u770b\u7684\u65f6\u95f4\u70b9\u5f80\u540e\u67e5\u8be25\u4e2a\u8bbf\u5ba2\u6570\u636e * * @param userId * @return */ List < Visitors > queryMyVisitor ( Long userId ); } 5.1.3\u3001\u7f16\u5199\u5b9e\u73b0 \u00b6 package com.tanhua.dubbo.server.api ; import cn.hutool.core.convert.Convert ; import cn.hutool.core.date.DateUtil ; import cn.hutool.core.util.ObjectUtil ; import com.alibaba.dubbo.config.annotation.Service ; import com.tanhua.dubbo.server.pojo.RecommendUser ; import com.tanhua.dubbo.server.pojo.Visitors ; import org.bson.types.ObjectId ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.domain.PageRequest ; import org.springframework.data.domain.Sort ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; import org.springframework.data.redis.core.RedisTemplate ; import java.util.List ; @Service ( version = \"1.0.0\" ) public class VisitorsApiImpl implements VisitorsApi { @Autowired private MongoTemplate mongoTemplate ; private static final String VISITOR_REDIS_KEY = \"VISITOR_USER\" ; @Autowired private RedisTemplate < String , String > redisTemplate ; @Override public String saveVisitor ( Long userId , Long visitorUserId , String from ) { //\u6821\u9a8c if ( ! ObjectUtil . isAllNotEmpty ( userId , visitorUserId , from )) { return null ; } //\u67e5\u8be2\u8bbf\u5ba2\u7528\u6237\u5728\u4eca\u5929\u662f\u5426\u5df2\u7ecf\u8bb0\u5f55\u8fc7\uff0c\u5982\u679c\u5df2\u7ecf\u8bb0\u5f55\u8fc7\uff0c\u4e0d\u518d\u8bb0\u5f55 String today = DateUtil . today (); Long minDate = DateUtil . parseDateTime ( today + \" 00:00:00\" ). getTime (); Long maxDate = DateUtil . parseDateTime ( today + \" 23:59:59\" ). getTime (); Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId ) . and ( \"visitorUserId\" ). is ( visitorUserId ) . andOperator ( Criteria . where ( \"date\" ). gte ( minDate ), Criteria . where ( \"date\" ). lte ( maxDate ) ) ); long count = this . mongoTemplate . count ( query , Visitors . class ); if ( count > 0 ) { //\u4eca\u5929\u5df2\u7ecf\u8bb0\u5f55\u8fc7\u7684 return null ; } Visitors visitors = new Visitors (); visitors . setFrom ( from ); visitors . setVisitorUserId ( visitorUserId ); visitors . setUserId ( userId ); visitors . setDate ( System . currentTimeMillis ()); visitors . setId ( ObjectId . get ()); //\u5b58\u50a8\u6570\u636e this . mongoTemplate . save ( visitors ); return visitors . getId (). toHexString (); } @Override public List < Visitors > queryMyVisitor ( Long userId ) { // \u67e5\u8be2\u524d5\u4e2a\u8bbf\u5ba2\u6570\u636e\uff0c\u6309\u7167\u8bbf\u95ee\u65f6\u95f4\u5012\u5e8f\u6392\u5e8f // \u5982\u679c\u7528\u6237\u5df2\u7ecf\u67e5\u8be2\u8fc7\u5217\u8868\uff0c\u8bb0\u5f55\u67e5\u8be2\u65f6\u95f4\uff0c\u540e\u7eed\u67e5\u8be2\u9700\u8981\u6309\u7167\u8fd9\u4e2a\u65f6\u95f4\u5f80\u540e\u67e5\u8be2 // \u4e0a\u4e00\u6b21\u67e5\u8be2\u5217\u8868\u7684\u65f6\u95f4 Long date = Convert . toLong ( this . redisTemplate . opsForHash (). get ( VISITOR_REDIS_KEY , String . valueOf ( userId ))); PageRequest pageRequest = PageRequest . of ( 0 , 5 , Sort . by ( Sort . Order . desc ( \"date\" ))); Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId )) . with ( pageRequest ); if ( ObjectUtil . isNotEmpty ( date )) { query . addCriteria ( Criteria . where ( \"date\" ). gte ( date )); } List < Visitors > visitorsList = this . mongoTemplate . find ( query , Visitors . class ); //\u67e5\u8be2\u6bcf\u4e2a\u6765\u8bbf\u7528\u6237\u7684\u5f97\u5206 for ( Visitors visitors : visitorsList ) { Query queryScore = Query . query ( Criteria . where ( \"toUserId\" ) . is ( userId ). and ( \"userId\" ). is ( visitors . getVisitorUserId ()) ); RecommendUser recommendUser = this . mongoTemplate . findOne ( queryScore , RecommendUser . class ); if ( ObjectUtil . isNotEmpty ( recommendUser )){ visitors . setScore ( recommendUser . getScore ()); } else { //\u9ed8\u8ba4\u5f97\u5206 visitors . setScore ( 90 d ); } } return visitorsList ; } } 5.1.4\u3001\u5355\u5143\u6d4b\u8bd5 \u00b6 package com.tanhua.dubbo.server.api ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestVisitorsApi { @Autowired private VisitorsApi visitorsApi ; @Test public void testSaveVisitor (){ this . visitorsApi . saveVisitor ( 1L , 2L , \"\u4e2a\u4eba\u4e3b\u9875\" ); this . visitorsApi . saveVisitor ( 1L , 3L , \"\u4e2a\u4eba\u4e3b\u9875\" ); this . visitorsApi . saveVisitor ( 1L , 2L , \"\u4e2a\u4eba\u4e3b\u9875\" ); } @Test public void testQueryMyVisitor (){ this . visitorsApi . queryMyVisitor ( 1L ) . forEach ( visitors -> System . out . println ( visitors )); } } 5.2\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 \u6587\u6863\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/743 package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class VisitorsVo { private Long id ; private String avatar ; private String nickname ; private String gender ; private Integer age ; private String [] tags ; private Integer fateValue ; } 5.2.2\u3001QuanZiController \u00b6 //com.tanhua.server.controller.QuanZiController /** * \u8c01\u770b\u8fc7\u6211 * * @return */ @GetMapping ( \"visitors\" ) public ResponseEntity < List < VisitorsVo >> queryVisitorsList (){ try { List < VisitorsVo > list = this . quanZiService . queryVisitorsList (); return ResponseEntity . ok ( list ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 5.2.3\u3001QuanZiService \u00b6 //com.tanhua.server.service.QuanZiService public List < VisitorsVo > queryVisitorsList () { User user = UserThreadLocal . get (); List < Visitors > visitorsList = this . visitorsApi . queryMyVisitor ( user . getId ()); if ( CollUtil . isEmpty ( visitorsList )) { return Collections . emptyList (); } List < Object > userIds = CollUtil . getFieldValues ( visitorsList , \"visitorUserId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); List < VisitorsVo > visitorsVoList = new ArrayList <> (); for ( Visitors visitor : visitorsList ) { for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( visitor . getVisitorUserId (), userInfo . getUserId ())) { VisitorsVo visitorsVo = new VisitorsVo (); visitorsVo . setAge ( userInfo . getAge ()); visitorsVo . setAvatar ( userInfo . getLogo ()); visitorsVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); visitorsVo . setId ( userInfo . getUserId ()); visitorsVo . setNickname ( userInfo . getNickName ()); visitorsVo . setTags ( StringUtils . split ( userInfo . getTags (), ',' )); visitorsVo . setFateValue ( visitor . getScore (). intValue ()); visitorsVoList . add ( visitorsVo ); break ; } } } return visitorsVoList ; } 5.3\u3001\u8bb0\u5f55\u8bbf\u5ba2\u6570\u636e \u00b6 //com.tanhua.server.service.TanHuaService public TodayBest queryUserInfo ( Long userId ) { UserInfo userInfo = this . userInfoService . queryUserInfoByUserId ( userId ); if ( ObjectUtil . isEmpty ( userInfo )){ return null ; } TodayBest todayBest = new TodayBest (); todayBest . setId ( userId ); todayBest . setAge ( userInfo . getAge ()); todayBest . setGender ( userInfo . getSex (). name (). toLowerCase ()); todayBest . setNickname ( userInfo . getNickName ()); todayBest . setTags ( Convert . toStrArray ( StrUtil . split ( userInfo . getTags (), ',' ))); todayBest . setAvatar ( userInfo . getLogo ()); //\u7f18\u5206\u503c User user = UserThreadLocal . get (); todayBest . setFateValue ( this . recommendUserService . queryScore ( userId , user . getId ()). longValue ()); //\u8bb0\u5f55\u6765\u8bbf\u7528\u6237 this . visitorsApi . saveVisitor ( userId , user . getId (), \"\u4e2a\u4eba\u4e3b\u9875\" ); return todayBest ; } 5.4\u3001\u6d4b\u8bd5 \u00b6","title":"day07"},{"location":"tantan/day07/#_1","text":"\u70b9\u8d5e\u6d88\u606f\u5217\u8868 \u559c\u6b22\u6d88\u606f\u5217\u8868 \u8bc4\u8bba\u6d88\u606f\u5217\u8868 \u516c\u544a\u5217\u8868 \u4e2a\u4eba\u4e3b\u9875 \u804a\u4e00\u4e0b\u529f\u80fd \u8c01\u770b\u8fc7\u6211\u7684\u529f\u80fd \u200b","title":"\u8bfe\u7a0b\u8bf4\u660e"},{"location":"tantan/day07/#1","text":"\u5728\u6d88\u606f\u6a21\u5757\u4e2d\u7684\u70b9\u8d5e\u3001\u559c\u6b22\u3001\u8bc4\u8bba\u5217\u8868\uff0c\u662f\u522b\u4eba\u5bf9\u81ea\u5df1\u53d1\u5e03\u7684\u5185\u5bb9\u7684\u64cd\u4f5c\uff0c\u5176\u5b9e\u73b0\u57fa\u672c\u4e00\u81f4\uff0c\u6240\u4ee5\u5728\u4e00\u8d77\u5b9e\u73b0\u3002 \u6548\u679c\uff1a \u70b9\u8d5e\u5217\u8868\u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/779 \u8bc4\u8bba\u5217\u8868\u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/785 \u559c\u6b22\u5217\u8868\u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/791","title":"1\u3001\u6d88\u606f\u70b9\u8d5e\u3001\u559c\u6b22\u3001\u8bc4\u8bba\u5217\u8868"},{"location":"tantan/day07/#11dubbo","text":"","title":"1.1\u3001dubbo\u670d\u52a1"},{"location":"tantan/day07/#111","text":"//com.tanhua.dubbo.server.api.QuanZiApi /** * \u67e5\u8be2\u5bf9\u6211\u7684\u70b9\u8d5e\u6d88\u606f\u5217\u8868 * * @return */ PageInfo < Comment > queryLikeCommentListByUser ( Long userId , Integer page , Integer pageSize ); /** * \u67e5\u8be2\u5bf9\u6211\u7684\u559c\u6b22\u6d88\u606f\u5217\u8868 * * @return */ PageInfo < Comment > queryLoveCommentListByUser ( Long userId , Integer page , Integer pageSize ); /** * \u67e5\u8be2\u5bf9\u6211\u7684\u8bc4\u8bba\u6d88\u606f\u5217\u8868 * * @return */ PageInfo < Comment > queryCommentListByUser ( Long userId , Integer page , Integer pageSize );","title":"1.1.1\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day07/#112","text":"//com.tanhua.dubbo.server.api.QuanziApiImpl @Override public PageInfo < Comment > queryLikeCommentListByUser ( Long userId , Integer page , Integer pageSize ) { return this . queryCommentListByUser ( userId , CommentType . LIKE , page , pageSize ); } @Override public PageInfo < Comment > queryLoveCommentListByUser ( Long userId , Integer page , Integer pageSize ) { return this . queryCommentListByUser ( userId , CommentType . LOVE , page , pageSize ); } @Override public PageInfo < Comment > queryCommentListByUser ( Long userId , Integer page , Integer pageSize ) { return this . queryCommentListByUser ( userId , CommentType . COMMENT , page , pageSize ); } private PageInfo < Comment > queryCommentListByUser ( Long userId , CommentType commentType , Integer page , Integer pageSize ) { PageRequest pageRequest = PageRequest . of ( page - 1 , pageSize , Sort . by ( Sort . Order . desc ( \"created\" ))); Query query = new Query ( Criteria . where ( \"publishUserId\" ). is ( userId ) . and ( \"commentType\" ). is ( commentType . getType ())). with ( pageRequest ); List < Comment > commentList = this . mongoTemplate . find ( query , Comment . class ); PageInfo < Comment > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); pageInfo . setRecords ( commentList ); return pageInfo ; }","title":"1.1.2\u3001\u7f16\u5199\u5b9e\u73b0"},{"location":"tantan/day07/#12app","text":"","title":"1.2\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day07/#121messagecommentvo","text":"\u6839\u636e\u63a5\u53e3\u5b9a\u4e49vo\u5bf9\u8c61\u3002 package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class MessageCommentVo { private String id ; private String avatar ; private String nickname ; private String createDate ; //\u683c\u5f0f\uff1a2019-09-08 10:07 }","title":"1.2.1\u3001MessageCommentVo"},{"location":"tantan/day07/#123imcontroller","text":"//com.tanhua.server.controller.IMController /** * \u67e5\u8be2\u6d88\u606f\u70b9\u8d5e\u5217\u8868 * * @param page * @param pageSize * @return */ @GetMapping ( \"likes\" ) public ResponseEntity < PageResult > queryLikeCommentList ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize ) { try { PageResult pageResult = this . imService . queryLikeCommentList ( page , pageSize ); return ResponseEntity . ok ( pageResult ); } catch ( Exception e ) { log . error ( \"\u67e5\u8be2\u70b9\u8d5e\u5217\u8868\u5931\u8d25~ \" , e ); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u67e5\u8be2\u6d88\u606f\u8bc4\u8bba\u5217\u8868 * * @param page * @param pageSize * @return */ @GetMapping ( \"comments\" ) public ResponseEntity < PageResult > queryUserCommentList ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize ) { try { PageResult pageResult = this . imService . queryUserCommentList ( page , pageSize ); return ResponseEntity . ok ( pageResult ); } catch ( Exception e ) { log . error ( \"\u67e5\u8be2\u8bc4\u8bba\u5217\u8868\u5931\u8d25~ \" , e ); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u67e5\u8be2\u6d88\u606f\u559c\u6b22\u5217\u8868 * * @param page * @param pageSize * @return */ @GetMapping ( \"loves\" ) public ResponseEntity < PageResult > queryLoveCommentList ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize ) { try { PageResult pageResult = this . imService . queryLoveCommentList ( page , pageSize ); return ResponseEntity . ok ( pageResult ); } catch ( Exception e ) { log . error ( \"\u67e5\u8be2\u559c\u6b22\u5217\u8868\u5931\u8d25~ \" , e ); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"1.2.3\u3001IMController"},{"location":"tantan/day07/#124imservice","text":"//com.tanhua.server.service.IMService public PageResult queryLikeCommentList ( Integer page , Integer pageSize ) { User user = UserThreadLocal . get (); PageInfo < Comment > pageInfo = this . quanZiApi . queryLikeCommentListByUser ( user . getId (), page , pageSize ); return this . fillUserCommentList ( pageInfo ); } public PageResult queryLoveCommentList ( Integer page , Integer pageSize ) { User user = UserThreadLocal . get (); PageInfo < Comment > pageInfo = this . quanZiApi . queryLoveCommentListByUser ( user . getId (), page , pageSize ); return this . fillUserCommentList ( pageInfo ); } public PageResult queryUserCommentList ( Integer page , Integer pageSize ) { User user = UserThreadLocal . get (); PageInfo < Comment > pageInfo = this . quanZiApi . queryCommentListByUser ( user . getId (), page , pageSize ); return this . fillUserCommentList ( pageInfo ); } private PageResult fillUserCommentList ( PageInfo < Comment > pageInfo ){ PageResult pageResult = new PageResult (); pageResult . setPage ( pageInfo . getPageNum ()); pageResult . setPagesize ( pageInfo . getPageSize ()); List < Comment > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )){ //\u6ca1\u6709\u67e5\u8be2\u5230\u6570\u636e return pageResult ; } List < Object > userIdList = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIdList ); List < MessageCommentVo > messageCommentVoList = new ArrayList <> (); for ( Comment comment : records ) { for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( comment . getUserId (), userInfo . getUserId ())){ MessageCommentVo messageCommentVo = new MessageCommentVo (); messageCommentVo . setId ( comment . getId (). toHexString ()); messageCommentVo . setAvatar ( userInfo . getLogo ()); messageCommentVo . setNickname ( userInfo . getNickName ()); messageCommentVo . setCreateDate ( DateUtil . format ( new Date ( comment . getCreated ()), \"yyyy-MM-dd HH:mm\" )); messageCommentVoList . add ( messageCommentVo ); break ; } } } pageResult . setItems ( messageCommentVoList ); return pageResult ; }","title":"1.2.4\u3001IMService"},{"location":"tantan/day07/#13","text":"","title":"1.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day07/#2","text":"\u516c\u544a\u662f\u540e\u53f0\u7cfb\u7edf\u5bf9\u6240\u6709\u7528\u6237\u53d1\u5e03\u7684\u516c\u544a\u6d88\u606f\u3002 \u6548\u679c\uff1a \u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/797","title":"2\u3001\u516c\u544a\u5217\u8868"},{"location":"tantan/day07/#21","text":"CREATE TABLE ` tb_announcement ` ( ` id ` bigint ( 20 ) NOT NULL AUTO_INCREMENT , ` title ` varchar ( 200 ) DEFAULT NULL COMMENT '\u6807\u9898' , ` description ` text COMMENT '\u63cf\u8ff0' , ` created ` datetime DEFAULT NULL , ` updated ` datetime DEFAULT NULL , PRIMARY KEY ( ` id ` ), KEY ` created ` ( ` created ` ) ) ENGINE = InnoDB AUTO_INCREMENT = 4 DEFAULT CHARSET = utf8 COMMENT = '\u516c\u544a\u8868' ; --\u63d2\u5165\u6570\u636e INSERT INTO ` tb_announcement ` ( ` id ` , ` title ` , ` description ` , ` created ` , ` updated ` ) VALUES ( '1' , '\u63a2\u82b1\u65b0\u7248\u672c\u4e0a\u7ebf\u53d1\u5e03\u5566\uff5e,\u76db\u590fhigh\u8db4\u5f00\u59cb\u4e86\uff0c\u8d76\u7d27\u6765\u62a5\u540d\u5427\uff01' , '\u63a2\u82b1App2019\u5e747\u670823\u65e5\u8d77\u5728\u82f9\u679c\u5546\u5e97\u2026,\u6d53\u60c5\u590f\u65e5\uff0c\u6e05\u723d\u4e00\u805a\uff0c\u63a2\u82b1\u5c06\u5427\u5927\u5bb6\u805a\u2026' , '2019-10-14 11:06:34' , '2019-10-14 11:06:37' ); INSERT INTO ` tb_announcement ` ( ` id ` , ` title ` , ` description ` , ` created ` , ` updated ` ) VALUES ( '2' , '\u63a2\u82b1\u4ea4\u53cb\u7684\u5708\u5b50\u529f\u80fd\u6b63\u5f0f\u4e0a\u7ebf\u5566~~' , '\u63a2\u82b1\u4ea4\u53cb\u7684\u5708\u5b50\u529f\u80fd\u6b63\u5f0f\u4e0a\u7ebf\u5566\uff0c\u6b22\u8fce\u4f7f\u7528~' , '2019-10-14 11:09:31' , '2019-10-14 11:09:33' ); INSERT INTO ` tb_announcement ` ( ` id ` , ` title ` , ` description ` , ` created ` , ` updated ` ) VALUES ( '3' , '\u56fd\u5e86\u653e\u5047\u671f\u95f4\uff0c\u63a2\u82b1\u4ea4\u53cb\u6b63\u5e38\u4f7f\u7528~' , '\u56fd\u5e86\u653e\u5047\u671f\u95f4\uff0c\u63a2\u82b1\u4ea4\u53cb\u6b63\u5e38\u4f7f\u7528~' , '2019-10-14 11:10:01' , '2019-10-14 11:10:04' );","title":"2.1\u3001\u8868\u7ed3\u6784"},{"location":"tantan/day07/#22pojo","text":"package com.tanhua.common.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class Announcement extends BasePojo { private Long id ; private String title ; private String description ; }","title":"2.2\u3001pojo"},{"location":"tantan/day07/#23announcementmapper","text":"package com.tanhua.common.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.common.pojo.Announcement ; public interface AnnouncementMapper extends BaseMapper < Announcement > { }","title":"2.3\u3001AnnouncementMapper"},{"location":"tantan/day07/#24announcementservice","text":"package com.tanhua.server.service ; import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper ; import com.baomidou.mybatisplus.core.metadata.IPage ; import com.baomidou.mybatisplus.extension.plugins.pagination.Page ; import com.tanhua.common.mapper.AnnouncementMapper ; import com.tanhua.common.pojo.Announcement ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; @Service public class AnnouncementService { @Autowired private AnnouncementMapper announcementMapper ; public IPage < Announcement > queryList ( Integer page , Integer pageSize ) { QueryWrapper queryWrapper = new QueryWrapper (); queryWrapper . orderByDesc ( \"created\" ); return this . announcementMapper . selectPage ( new Page < Announcement > ( page , pageSize ), queryWrapper ); } }","title":"2.4\u3001AnnouncementService"},{"location":"tantan/day07/#25vo","text":"package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class AnnouncementVo { private String id ; private String title ; private String description ; private String createDate ; }","title":"2.5\u3001\u5b9a\u4e49vo\u5bf9\u8c61"},{"location":"tantan/day07/#26imcontroller","text":"/** * \u67e5\u8be2\u516c\u544a\u5217\u8868 * * @param page * @param pageSize * @return */ @GetMapping ( \"announcements\" ) @NoAuthorization //\u4f18\u5316\uff0c\u65e0\u9700\u8fdb\u884ctoken\u6821\u9a8c public ResponseEntity < PageResult > queryMessageAnnouncementList ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize ) { try { PageResult pageResult = this . imService . queryMessageAnnouncementList ( page , pageSize ); return ResponseEntity . ok ( pageResult ); } catch ( Exception e ) { log . error ( \"\u67e5\u8be2\u516c\u544a\u5217\u8868\u5931\u8d25~ \" , e ); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"2.6\u3001IMController"},{"location":"tantan/day07/#27imservice","text":"public PageResult queryMessageAnnouncementList ( Integer page , Integer pageSize ) { IPage < Announcement > announcementPage = this . announcementService . queryList ( page , pageSize ); List < AnnouncementVo > announcementVoList = new ArrayList <> (); for ( Announcement record : announcementPage . getRecords ()) { AnnouncementVo announcementVo = new AnnouncementVo (); announcementVo . setId ( record . getId (). toString ()); announcementVo . setTitle ( record . getTitle ()); announcementVo . setDescription ( record . getDescription ()); announcementVo . setCreateDate ( DateUtil . format ( record . getCreated (), \"yyyy-MM-dd HH:mm\" )); announcementVoList . add ( announcementVo ); } PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); pageResult . setItems ( announcementVoList ); return pageResult ; }","title":"2.7\u3001IMService"},{"location":"tantan/day07/#28","text":"","title":"2.8\u3001\u6d4b\u8bd5"},{"location":"tantan/day07/#3","text":"\u70b9\u51fb\u9996\u9875\u7684\u4eca\u65e5\u4f73\u4eba\u6216\u4efb\u610f\u63a8\u8350\u4eba\u7684\u56fe\u7247\u5c31\u4f1a\u8fdb\u5165\u4e2a\u4eba\u4e3b\u9875\u9875\u9762\uff0c\u6548\u679c\u5982\u4e0b\uff1a \u5728\u4e2a\u4eba\u4e3b\u9875\u7684\u9875\u9762\u4e2d\uff0c\u4f1a\u663e\u793a\u51fa\u4e2a\u4eba\u4fe1\u606f\u3001\u7f18\u5206\u503c\u3001\u4e2a\u4eba\u76f8\u518c\u7b49\u5185\u5bb9\u3002","title":"3\u3001\u4e2a\u4eba\u4e3b\u9875"},{"location":"tantan/day07/#31","text":"","title":"3.1\u3001\u4e2a\u4eba\u4fe1\u606f"},{"location":"tantan/day07/#311dubbo","text":"\u9700\u8981\u5728dubbo\u670d\u52a1\u4e2d\u63d0\u4f9b\u67e5\u8be2\u7f18\u5206\u503c\u7684\u63a5\u53e3\u670d\u52a1\u3002","title":"3.1.1\u3001dubbo\u670d\u52a1"},{"location":"tantan/day07/#3111","text":"//com.tanhua.dubbo.server.api.RecommendUserApi /** * \u67e5\u8be2\u63a8\u8350\u597d\u53cb\u7684\u7f18\u5206\u503c * * @param userId \u597d\u53cb\u7684id * @param toUserId \u6211\u7684id * @return */ Double queryScore ( Long userId , Long toUserId );","title":"3.1.1.1\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day07/#3112","text":"//com.tanhua.dubbo.server.api.RecommendUserApiImpl @Override public Double queryScore ( Long userId , Long toUserId ) { Query query = Query . query ( Criteria . where ( \"toUserId\" ). is ( toUserId ) . and ( \"userId\" ). is ( userId )); RecommendUser recommendUser = this . mongoTemplate . findOne ( query , RecommendUser . class ); if ( null != recommendUser ) { return recommendUser . getScore (); } return null ; }","title":"3.1.1.2\u3001\u5b9e\u73b0\u63a5\u53e3"},{"location":"tantan/day07/#312app","text":"\u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/629 \u8bf4\u660e\uff1a\u8be5\u63a5\u53e3\u7684\u8fd4\u56de\u503c\u63a5\u53e3\u4e0e\u4eca\u65e5\u4f73\u4eba\u7684\u7ed3\u6784\u4e00\u81f4\uff0c\u6240\u4ee5\u53ef\u4ee5\u901a\u7528\u4eca\u65e5\u4f73\u4eba\u7684\u5bf9\u8c61\u3002","title":"3.1.2\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day07/#3121tanhuacontroller","text":"package com.tanhua.server.controller ; import com.tanhua.server.service.TanHuaService ; import com.tanhua.server.vo.TodayBest ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.GetMapping ; import org.springframework.web.bind.annotation.PathVariable ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RestController ; @RequestMapping ( \"tanhua\" ) @RestController public class TanHuaController { @Autowired private TanHuaService tanHuaService ; /** * \u67e5\u8be2\u4e2a\u4eba\u4e3b\u9875\u7684\u4e2a\u4eba\u4fe1\u606f * * @param userId * @return */ @GetMapping ( \"{id}/personalInfo\" ) public ResponseEntity < TodayBest > queryUserInfo ( @PathVariable ( \"id\" ) Long userId ) { try { TodayBest todayBest = this . tanHuaService . queryUserInfo ( userId ); return ResponseEntity . ok ( todayBest ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } }","title":"3.1.2.1\u3001TanHuaController"},{"location":"tantan/day07/#3122tanhuaservice","text":"package com.tanhua.server.service ; import cn.hutool.core.convert.Convert ; import cn.hutool.core.util.ObjectUtil ; import cn.hutool.core.util.StrUtil ; import com.tanhua.common.pojo.User ; import com.tanhua.common.pojo.UserInfo ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.server.vo.TodayBest ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; @Service public class TanHuaService { @Autowired private UserInfoService userInfoService ; @Autowired private RecommendUserService recommendUserService ; public TodayBest queryUserInfo ( Long userId ) { UserInfo userInfo = this . userInfoService . queryUserInfoByUserId ( userId ); if ( ObjectUtil . isEmpty ( userInfo )){ return null ; } TodayBest todayBest = new TodayBest (); todayBest . setId ( userId ); todayBest . setAge ( userInfo . getAge ()); todayBest . setGender ( userInfo . getSex (). name (). toLowerCase ()); todayBest . setNickname ( userInfo . getNickName ()); todayBest . setTags ( Convert . toStrArray ( StrUtil . split ( userInfo . getTags (), ',' ))); todayBest . setAvatar ( userInfo . getLogo ()); //\u7f18\u5206\u503c User user = UserThreadLocal . get (); todayBest . setFateValue ( this . recommendUserService . queryScore ( userId , user . getId ()). longValue ()); return todayBest ; } }","title":"3.1.2.2\u3001TanHuaService"},{"location":"tantan/day07/#3123recommenduserservice","text":"//com.tanhua.server.service.RecommendUserService /** * \u67e5\u8be2\u63a8\u8350\u597d\u53cb\u7684\u7f18\u5206\u503c * * @param userId * @param toUserId * @return */ public Double queryScore ( Long userId , Long toUserId ){ Double score = this . recommendUserApi . queryScore ( userId , toUserId ); if ( ObjectUtil . isNotEmpty ( score )){ return score ; } //\u9ed8\u8ba4\u503c return 98 d ; }","title":"3.1.2.3\u3001RecommendUserService"},{"location":"tantan/day07/#313","text":"","title":"3.1.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day07/#32","text":"","title":"3.2\u3001\u4e2a\u4eba\u76f8\u518c"},{"location":"tantan/day07/#321dubbo","text":"","title":"3.2.1\u3001dubbo\u670d\u52a1"},{"location":"tantan/day07/#3211","text":"//com.tanhua.dubbo.server.api.QuanZiApi /** * \u67e5\u8be2\u76f8\u518c\u8868 * * @param userId * @param page * @param pageSize * @return */ PageInfo < Publish > queryAlbumList ( Long userId , Integer page , Integer pageSize );","title":"3.2.1.1\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day07/#3212","text":"//com.tanhua.dubbo.server.api.QuanZiApiImpl @Override public PageInfo < Publish > queryAlbumList ( Long userId , Integer page , Integer pageSize ) { PageInfo < Publish > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); PageRequest pageRequest = PageRequest . of ( page - 1 , pageSize , Sort . by ( Sort . Order . desc ( \"created\" ))); Query query = new Query (). with ( pageRequest ); //\u67e5\u8be2\u81ea\u5df1\u7684\u76f8\u518c\u8868 List < Album > albumList = this . mongoTemplate . find ( query , Album . class , \"quanzi_album_\" + userId ); if ( CollUtil . isEmpty ( albumList )){ return pageInfo ; } List < Object > publishIdList = CollUtil . getFieldValues ( albumList , \"publishId\" ); Query queryPublish = Query . query ( Criteria . where ( \"id\" ). in ( publishIdList )) . with ( Sort . by ( Sort . Order . desc ( \"created\" ))); List < Publish > publishList = this . mongoTemplate . find ( queryPublish , Publish . class ); pageInfo . setRecords ( publishList ); return pageInfo ; }","title":"3.2.1.2\u3001\u5b9e\u73b0\u63a5\u53e3"},{"location":"tantan/day07/#322app","text":"\u63a5\u53e3\u6587\u6863\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/689","title":"3.2.2\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day07/#3221quanzicontroller","text":"//com.tanhua.server.controller.QuanZiController /** * \u81ea\u5df1\u7684\u6240\u6709\u52a8\u6001 * * @return */ @GetMapping ( \"all\" ) public ResponseEntity < PageResult > queryAlbumList ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize , @RequestParam ( value = \"userId\" ) Long userId ) { try { PageResult pageResult = this . quanZiService . queryAlbumList ( userId , page , pageSize ); return ResponseEntity . ok ( pageResult ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"3.2.2.1\u3001QuanZiController"},{"location":"tantan/day07/#3222quanziservice","text":"//com.tanhua.server.service.QuanZiService public PageResult queryAlbumList ( Long userId , Integer page , Integer pageSize ) { PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); //\u67e5\u8be2\u6570\u636e PageInfo < Publish > pageInfo = this . quanZiApi . queryAlbumList ( userId , page , pageSize ); if ( CollUtil . isEmpty ( pageInfo . getRecords ())){ return pageResult ; } //\u586b\u5145\u6570\u636e pageResult . setItems ( this . fillQuanZiVo ( pageInfo . getRecords ())); return pageResult ; }","title":"3.2.2.2\u3001QuanZiService"},{"location":"tantan/day07/#323","text":"","title":"3.2.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day07/#33","text":"","title":"3.3\u3001\u6574\u5408\u6d4b\u8bd5"},{"location":"tantan/day07/#4","text":"\u5728\u4e2a\u4eba\u4e3b\u9875\u4e2d\uff0c\u70b9\u51fb\u804a\u4e00\u4e0b\u6309\u94ae\uff0c\u4f1a\u5f39\u51fa\u56de\u7b54\u95ee\u9898\u7a97\u53e3\uff0c\u8f93\u5165\u7b54\u6848\u540e\uff0c\u7cfb\u7edf\u4f1a\u5411\u5bf9\u65b9\u53d1\u9001\u4e00\u6761\u964c\u804a\u6d88\u606f\uff0c\u5982\u679c\u5bf9\u65b9\u5728\u964c\u804a\u6d88\u606f\u4e2d\u70b9\u51fb\u804a\u4e00\u4e0b\uff0c\u4ed6\u4eec\u5c31\u4f1a\u6210\u4e3a\u597d\u53cb\u3002 \u7528\u62371\u5728\u7528\u62372\u7684\u4e2a\u4eba\u4e3b\u9875\u4e2d\u70b9\u51fb\u201c\u804a\u4e00\u4e0b\u201d\uff0c\u6d41\u7a0b\u5982\u4e0b\uff1a","title":"4\u3001\u804a\u4e00\u4e0b"},{"location":"tantan/day07/#41","text":"\u70b9\u51fb\u804a\u4e00\u4e0b\u65f6\uff0c\u9700\u8981\u663e\u793a\u51fa\u95ee\u9898\uff0c\u6240\u4ee5\u9700\u8981\u5728mysql\u4e2d\u5b58\u50a8\u7528\u6237\u7684\u95ee\u9898\u3002","title":"4.1\u3001\u964c\u804a\u95ee\u9898"},{"location":"tantan/day07/#411","text":"CREATE TABLE ` tb_question ` ( ` id ` bigint ( 20 ) NOT NULL AUTO_INCREMENT , ` user_id ` bigint ( 20 ) DEFAULT NULL COMMENT '\u7528\u6237id' , ` txt ` varchar ( 200 ) DEFAULT NULL COMMENT '\u95ee\u9898\u5185\u5bb9' , ` created ` datetime DEFAULT NULL , ` updated ` datetime DEFAULT NULL , PRIMARY KEY ( ` id ` ), KEY ` user_id ` ( ` user_id ` ) ) ENGINE = InnoDB DEFAULT CHARSET = utf8 ;","title":"4.1.1\u3001\u8868\u7ed3\u6784"},{"location":"tantan/day07/#412question","text":"\u5728my-tanhua-common\u5de5\u7a0b\u4e2d\u5b8c\u6210\u3002 package com.tanhua.common.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class Question extends BasePojo { private Long id ; private Long userId ; //\u95ee\u9898\u5185\u5bb9 private String txt ; }","title":"4.1.2\u3001Question\u5b9e\u4f53\u5bf9\u8c61"},{"location":"tantan/day07/#413questionmapper","text":"\u5728my-tanhua-common\u5de5\u7a0b\u4e2d\u5b8c\u6210\u3002 package com.tanhua.common.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.common.pojo.Question ; public interface QuestionMapper extends BaseMapper < Question > { }","title":"4.1.3\u3001QuestionMapper"},{"location":"tantan/day07/#414questionservice","text":"\u5728my-tanhua-server\u5de5\u7a0b\u4e2d\u5b8c\u6210\u3002 package com.tanhua.server.service ; import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper ; import com.tanhua.common.mapper.QuestionMapper ; import com.tanhua.common.pojo.Question ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; @Service public class QuestionService { @Autowired private QuestionMapper questionMapper ; public Question queryQuestion ( Long userId ) { QueryWrapper queryWrapper = new QueryWrapper (); queryWrapper . eq ( \"user_id\" , userId ); return this . questionMapper . selectOne ( queryWrapper ); } }","title":"4.1.4\u3001QuestionService"},{"location":"tantan/day07/#42app","text":"\u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/635","title":"4.2\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day07/#421tanhuacontroller","text":"//com.tanhua.server.controller.TanHuaController /** * \u67e5\u8be2\u964c\u751f\u4eba\u95ee\u9898 * * @param userId * @return */ @GetMapping ( \"strangerQuestions\" ) public ResponseEntity < String > queryQuestion ( @RequestParam ( \"userId\" ) Long userId ) { try { String question = this . tanHuaService . queryQuestion ( userId ); return ResponseEntity . ok ( question ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"4.2.1\u3001TanHuaController"},{"location":"tantan/day07/#422tanhuaservice","text":"//com.tanhua.server.service.TanHuaService public String queryQuestion ( Long userId ) { Question question = this . questionService . queryQuestion ( userId ); if ( ObjectUtil . isNotEmpty ( question )){ return question . getTxt (); } //\u9ed8\u8ba4\u7684\u95ee\u9898 return \"\u4f60\u7684\u7231\u597d\u662f\u4ec0\u4e48\uff1f\" ; }","title":"4.2.2\u3001TanHuaService"},{"location":"tantan/day07/#423","text":"","title":"4.2.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day07/#43","text":"\u70b9\u51fb\u95ee\u9898\u7a97\u53e3\u4e2d\u7684\u201c\u804a\u4e00\u4e0b\u201d\uff0c\u9700\u8981\u901a\u8fc7admin\u6743\u9650\u53d1\u9001\u7cfb\u7edf\u6d88\u606f\u3002","title":"4.3\u3001\u56de\u590d\u964c\u751f\u4eba\u95ee\u9898"},{"location":"tantan/day07/#431dubbo","text":"","title":"4.3.1\u3001dubbo\u670d\u52a1"},{"location":"tantan/day07/#4311","text":"//com.tanhua.dubbo.server.api.HuanXinApi /** * \u4ee5\u7ba1\u7406\u5458\u8eab\u4efd\u53d1\u9001\u6d88\u606f * \u6587\u6863\u5730\u5740\uff1ahttp://docs-im.easemob.com/im/server/basics/messages#%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF * * @param targetUserName \u53d1\u9001\u76ee\u6807\u7684\u7528\u6237\u540d * @param huanXinMessageType \u6d88\u606f\u7c7b\u578b * @param msg * @return */ Boolean sendMsgFromAdmin ( String targetUserName , HuanXinMessageType huanXinMessageType , String msg ); package com.tanhua.dubbo.server.enums ; /** * \u6d88\u606f\u7c7b\u578b\uff1btxt:\u6587\u672c\u6d88\u606f\uff0cimg\uff1a\u56fe\u7247\u6d88\u606f\uff0cloc\uff1a\u4f4d\u7f6e\u6d88\u606f\uff0caudio\uff1a\u8bed\u97f3\u6d88\u606f\uff0cvideo\uff1a\u89c6\u9891\u6d88\u606f\uff0cfile\uff1a\u6587\u4ef6\u6d88\u606f */ public enum HuanXinMessageType { TXT ( \"txt\" ), IMG ( \"img\" ), LOC ( \"loc\" ), AUDIO ( \"audio\" ), VIDEO ( \"video\" ), FILE ( \"file\" ); String type ; HuanXinMessageType ( String type ) { this . type = type ; } public String getType () { return type ; } }","title":"4.3.1.1\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day07/#4312","text":"//com.tanhua.dubbo.server.api.HuanXinApiImpl @Override public Boolean sendMsgFromAdmin ( String targetUserName , HuanXinMessageType huanXinMessageType , String msg ) { String targetUrl = this . huanXinConfig . getUrl () + this . huanXinConfig . getOrgName () + \"/\" + this . huanXinConfig . getAppName () + \"/messages\" ; try { //{\"target_type\": \"users\",\"target\": [\"user2\",\"user3\"],\"msg\": {\"type\": \"txt\",\"msg\": \"testmessage\"},\"from\": \"user1\"} String body = JSONUtil . createObj () . set ( \"target_type\" , \"users\" ) . set ( \"target\" , JSONUtil . createArray (). set ( targetUserName )) . set ( \"msg\" , JSONUtil . createObj () . set ( \"type\" , huanXinMessageType . getType ()) . set ( \"msg\" , msg )). toString (); //\u8868\u793a\u6d88\u606f\u53d1\u9001\u8005;\u65e0\u6b64\u5b57\u6bb5Server\u4f1a\u9ed8\u8ba4\u8bbe\u7f6e\u4e3a\u201cfrom\u201d:\u201cadmin\u201d\uff0c\u6709from\u5b57\u6bb5\u4f46\u503c\u4e3a\u7a7a\u4e32(\u201c\u201d)\u65f6\u8bf7\u6c42\u5931\u8d25 // .set(\"from\", \"\") return this . requestService . execute ( targetUrl , body , Method . POST ). isOk (); } catch ( Exception e ) { log . error ( \"\u53d1\u9001\u6d88\u606f\u5931\u8d25~ targetUserName = \" + targetUserName + \", type = \" + huanXinMessageType . getType () + \", msg = \" + msg , e ); } return false ; }","title":"4.3.1.2\u3001\u5b9e\u73b0\u63a5\u53e3"},{"location":"tantan/day07/#432app","text":"\u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/641","title":"4.3.2\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day07/#4321tanhuacontroller","text":"//com.tanhua.server.controller.TanHuaController /** * \u56de\u590d\u964c\u751f\u4eba\u95ee\u9898 * * @return */ @PostMapping ( \"strangerQuestions\" ) public ResponseEntity < Void > replyQuestion ( @RequestBody Map < String , Object > param ) { try { Long userId = Long . valueOf ( param . get ( \"userId\" ). toString ()); String reply = param . get ( \"reply\" ). toString (); Boolean result = this . tanHuaService . replyQuestion ( userId , reply ); if ( result ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"4.3.2.1\u3001TanHuaController"},{"location":"tantan/day07/#4322tanhuaservice","text":"//com.tanhua.server.service.TanHuaService @Reference ( version = \"1.0.0\" ) private HuanXinApi huanXinApi ; public Boolean replyQuestion ( Long userId , String reply ) { User user = UserThreadLocal . get (); UserInfo userInfo = this . userInfoService . queryUserInfoByUserId ( user . getId ()); //\u6784\u5efa\u6d88\u606f\u5185\u5bb9 Map < String , Object > msg = new HashMap <> (); msg . put ( \"userId\" , user . getId ()); msg . put ( \"huanXinId\" , \"HX_\" + user . getId ()); msg . put ( \"nickname\" , userInfo . getNickName ()); msg . put ( \"strangerQuestion\" , this . queryQuestion ( userId )); msg . put ( \"reply\" , reply ); //\u53d1\u9001\u73af\u4fe1\u6d88\u606f return this . huanXinApi . sendMsgFromAdmin ( \"HX_\" + userId , HuanXinMessageType . TXT , JSONUtil . toJsonStr ( msg )); }","title":"4.3.2.2\u3001TanHuaService"},{"location":"tantan/day07/#433","text":"\u7528\u6237heima_37\u6536\u5230\u964c\u751f\u4eba\u6d88\u606f\uff1a \u53ef\u4ee5\u770b\u5230\u597d\u53cb\u5df2\u7ecf\u6dfb\u52a0\u5b8c\u6210\uff0c\u53ef\u4ee5\u5728\u901a\u8baf\u5f55\u4e2d\u9009\u62e9\u597d\u53cb\u8fdb\u884c\u804a\u5929\u3002 \u5728\u964c\u804a\u6d88\u606f\u4e2d\u7684\u201c\u786e\u8ba4\u6dfb\u52a0\u201d\u529f\u80fd\uff0c\u5c31\u662f\u524d\u9762\u5b9e\u73b0\u7684\u6dfb\u52a0\u8054\u7cfb\u4eba\u63a5\u53e3\u3002","title":"4.3.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day07/#5","text":"\u67e5\u8be2\u522b\u4eba\u6765\u8bbf\u4e86\u6211\u7684\u4e3b\u9875\u7684\u4fe1\u606f\uff0c\u5176\u4ed6\u7528\u6237\u5728\u6d4f\u89c8\u6211\u7684\u4e3b\u9875\u65f6\uff0c\u9700\u8981\u8bb0\u5f55\u8bbf\u5ba2\u6570\u636e\u3002\u8bbf\u5ba2\u5728\u4e00\u5929\u5185\u6bcf\u4e2a\u7528\u6237\u53ea\u8bb0\u5f55\u4e00\u6b21\u3002 \u67e5\u8be2\u6570\u636e\u65f6\uff0c\u5982\u679c\u7528\u6237\u67e5\u8be2\u8fc7\u5217\u8868\uff0c\u5c31\u9700\u8981\u8bb0\u5f55\u8fd9\u6b21\u67e5\u8be2\u6570\u636e\u7684\u65f6\u95f4\uff0c\u4e0b\u6b21\u67e5\u8be2\u65f6\u67e5\u8be2\u5927\u4e8e\u7b49\u4e8e\u8be5\u65f6\u95f4\u7684\u6570\u636e\u3002 \u5982\u679c\uff0c\u7528\u6237\u6ca1\u6709\u8bb0\u5f55\u67e5\u8be2\u65f6\u95f4\uff0c\u5c31\u67e5\u8be2\u6700\u8fd1\u76845\u4e2a\u6765\u8bbf\u7528\u6237\u3002 \u9875\u9762\u6548\u679c\u5982\u4e0b\uff1a","title":"5\u3001\u8c01\u770b\u8fc7\u6211"},{"location":"tantan/day07/#51dubbo","text":"","title":"5.1\u3001dubbo\u670d\u52a1"},{"location":"tantan/day07/#511","text":"package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.mongodb.core.mapping.Document ; @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"visitors\" ) public class Visitors implements java . io . Serializable { private static final long serialVersionUID = 2811682148052386573L ; private ObjectId id ; private Long userId ; //\u6211\u7684id private Long visitorUserId ; //\u6765\u8bbf\u7528\u6237id private String from ; //\u6765\u6e90\uff0c\u5982\u9996\u9875\u3001\u5708\u5b50\u7b49 private Long date ; //\u6765\u8bbf\u65f6\u95f4 private Double score ; //\u5f97\u5206 }","title":"5.1.1\u3001\u5b9e\u4f53\u5bf9\u8c61"},{"location":"tantan/day07/#512","text":"package com.tanhua.dubbo.server.api ; import com.tanhua.dubbo.server.pojo.Visitors ; import java.util.List ; public interface VisitorsApi { /** * \u4fdd\u5b58\u8bbf\u5ba2\u6570\u636e * * @param userId \u6211\u7684id * @param visitorUserId \u8bbf\u5ba2id * @param from \u6765\u6e90 * @return */ String saveVisitor ( Long userId , Long visitorUserId , String from ); /** * \u67e5\u8be2\u6211\u7684\u8bbf\u5ba2\u6570\u636e\uff0c\u5b58\u57282\u79cd\u60c5\u51b5\uff1a * 1. \u6211\u6ca1\u6709\u770b\u8fc7\u6211\u7684\u8bbf\u5ba2\u6570\u636e\uff0c\u8fd4\u56de\u524d5\u4e2a\u8bbf\u5ba2\u4fe1\u606f * 2. \u4e4b\u524d\u770b\u8fc7\u6211\u7684\u8bbf\u5ba2\uff0c\u4ece\u4e0a\u4e00\u6b21\u67e5\u770b\u7684\u65f6\u95f4\u70b9\u5f80\u540e\u67e5\u8be25\u4e2a\u8bbf\u5ba2\u6570\u636e * * @param userId * @return */ List < Visitors > queryMyVisitor ( Long userId ); }","title":"5.1.2\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day07/#513","text":"package com.tanhua.dubbo.server.api ; import cn.hutool.core.convert.Convert ; import cn.hutool.core.date.DateUtil ; import cn.hutool.core.util.ObjectUtil ; import com.alibaba.dubbo.config.annotation.Service ; import com.tanhua.dubbo.server.pojo.RecommendUser ; import com.tanhua.dubbo.server.pojo.Visitors ; import org.bson.types.ObjectId ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.domain.PageRequest ; import org.springframework.data.domain.Sort ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; import org.springframework.data.redis.core.RedisTemplate ; import java.util.List ; @Service ( version = \"1.0.0\" ) public class VisitorsApiImpl implements VisitorsApi { @Autowired private MongoTemplate mongoTemplate ; private static final String VISITOR_REDIS_KEY = \"VISITOR_USER\" ; @Autowired private RedisTemplate < String , String > redisTemplate ; @Override public String saveVisitor ( Long userId , Long visitorUserId , String from ) { //\u6821\u9a8c if ( ! ObjectUtil . isAllNotEmpty ( userId , visitorUserId , from )) { return null ; } //\u67e5\u8be2\u8bbf\u5ba2\u7528\u6237\u5728\u4eca\u5929\u662f\u5426\u5df2\u7ecf\u8bb0\u5f55\u8fc7\uff0c\u5982\u679c\u5df2\u7ecf\u8bb0\u5f55\u8fc7\uff0c\u4e0d\u518d\u8bb0\u5f55 String today = DateUtil . today (); Long minDate = DateUtil . parseDateTime ( today + \" 00:00:00\" ). getTime (); Long maxDate = DateUtil . parseDateTime ( today + \" 23:59:59\" ). getTime (); Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId ) . and ( \"visitorUserId\" ). is ( visitorUserId ) . andOperator ( Criteria . where ( \"date\" ). gte ( minDate ), Criteria . where ( \"date\" ). lte ( maxDate ) ) ); long count = this . mongoTemplate . count ( query , Visitors . class ); if ( count > 0 ) { //\u4eca\u5929\u5df2\u7ecf\u8bb0\u5f55\u8fc7\u7684 return null ; } Visitors visitors = new Visitors (); visitors . setFrom ( from ); visitors . setVisitorUserId ( visitorUserId ); visitors . setUserId ( userId ); visitors . setDate ( System . currentTimeMillis ()); visitors . setId ( ObjectId . get ()); //\u5b58\u50a8\u6570\u636e this . mongoTemplate . save ( visitors ); return visitors . getId (). toHexString (); } @Override public List < Visitors > queryMyVisitor ( Long userId ) { // \u67e5\u8be2\u524d5\u4e2a\u8bbf\u5ba2\u6570\u636e\uff0c\u6309\u7167\u8bbf\u95ee\u65f6\u95f4\u5012\u5e8f\u6392\u5e8f // \u5982\u679c\u7528\u6237\u5df2\u7ecf\u67e5\u8be2\u8fc7\u5217\u8868\uff0c\u8bb0\u5f55\u67e5\u8be2\u65f6\u95f4\uff0c\u540e\u7eed\u67e5\u8be2\u9700\u8981\u6309\u7167\u8fd9\u4e2a\u65f6\u95f4\u5f80\u540e\u67e5\u8be2 // \u4e0a\u4e00\u6b21\u67e5\u8be2\u5217\u8868\u7684\u65f6\u95f4 Long date = Convert . toLong ( this . redisTemplate . opsForHash (). get ( VISITOR_REDIS_KEY , String . valueOf ( userId ))); PageRequest pageRequest = PageRequest . of ( 0 , 5 , Sort . by ( Sort . Order . desc ( \"date\" ))); Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId )) . with ( pageRequest ); if ( ObjectUtil . isNotEmpty ( date )) { query . addCriteria ( Criteria . where ( \"date\" ). gte ( date )); } List < Visitors > visitorsList = this . mongoTemplate . find ( query , Visitors . class ); //\u67e5\u8be2\u6bcf\u4e2a\u6765\u8bbf\u7528\u6237\u7684\u5f97\u5206 for ( Visitors visitors : visitorsList ) { Query queryScore = Query . query ( Criteria . where ( \"toUserId\" ) . is ( userId ). and ( \"userId\" ). is ( visitors . getVisitorUserId ()) ); RecommendUser recommendUser = this . mongoTemplate . findOne ( queryScore , RecommendUser . class ); if ( ObjectUtil . isNotEmpty ( recommendUser )){ visitors . setScore ( recommendUser . getScore ()); } else { //\u9ed8\u8ba4\u5f97\u5206 visitors . setScore ( 90 d ); } } return visitorsList ; } }","title":"5.1.3\u3001\u7f16\u5199\u5b9e\u73b0"},{"location":"tantan/day07/#514","text":"package com.tanhua.dubbo.server.api ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestVisitorsApi { @Autowired private VisitorsApi visitorsApi ; @Test public void testSaveVisitor (){ this . visitorsApi . saveVisitor ( 1L , 2L , \"\u4e2a\u4eba\u4e3b\u9875\" ); this . visitorsApi . saveVisitor ( 1L , 3L , \"\u4e2a\u4eba\u4e3b\u9875\" ); this . visitorsApi . saveVisitor ( 1L , 2L , \"\u4e2a\u4eba\u4e3b\u9875\" ); } @Test public void testQueryMyVisitor (){ this . visitorsApi . queryMyVisitor ( 1L ) . forEach ( visitors -> System . out . println ( visitors )); } }","title":"5.1.4\u3001\u5355\u5143\u6d4b\u8bd5"},{"location":"tantan/day07/#52app","text":"\u6587\u6863\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/743 package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class VisitorsVo { private Long id ; private String avatar ; private String nickname ; private String gender ; private Integer age ; private String [] tags ; private Integer fateValue ; }","title":"5.2\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day07/#522quanzicontroller","text":"//com.tanhua.server.controller.QuanZiController /** * \u8c01\u770b\u8fc7\u6211 * * @return */ @GetMapping ( \"visitors\" ) public ResponseEntity < List < VisitorsVo >> queryVisitorsList (){ try { List < VisitorsVo > list = this . quanZiService . queryVisitorsList (); return ResponseEntity . ok ( list ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"5.2.2\u3001QuanZiController"},{"location":"tantan/day07/#523quanziservice","text":"//com.tanhua.server.service.QuanZiService public List < VisitorsVo > queryVisitorsList () { User user = UserThreadLocal . get (); List < Visitors > visitorsList = this . visitorsApi . queryMyVisitor ( user . getId ()); if ( CollUtil . isEmpty ( visitorsList )) { return Collections . emptyList (); } List < Object > userIds = CollUtil . getFieldValues ( visitorsList , \"visitorUserId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); List < VisitorsVo > visitorsVoList = new ArrayList <> (); for ( Visitors visitor : visitorsList ) { for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( visitor . getVisitorUserId (), userInfo . getUserId ())) { VisitorsVo visitorsVo = new VisitorsVo (); visitorsVo . setAge ( userInfo . getAge ()); visitorsVo . setAvatar ( userInfo . getLogo ()); visitorsVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); visitorsVo . setId ( userInfo . getUserId ()); visitorsVo . setNickname ( userInfo . getNickName ()); visitorsVo . setTags ( StringUtils . split ( userInfo . getTags (), ',' )); visitorsVo . setFateValue ( visitor . getScore (). intValue ()); visitorsVoList . add ( visitorsVo ); break ; } } } return visitorsVoList ; }","title":"5.2.3\u3001QuanZiService"},{"location":"tantan/day07/#53","text":"//com.tanhua.server.service.TanHuaService public TodayBest queryUserInfo ( Long userId ) { UserInfo userInfo = this . userInfoService . queryUserInfoByUserId ( userId ); if ( ObjectUtil . isEmpty ( userInfo )){ return null ; } TodayBest todayBest = new TodayBest (); todayBest . setId ( userId ); todayBest . setAge ( userInfo . getAge ()); todayBest . setGender ( userInfo . getSex (). name (). toLowerCase ()); todayBest . setNickname ( userInfo . getNickName ()); todayBest . setTags ( Convert . toStrArray ( StrUtil . split ( userInfo . getTags (), ',' ))); todayBest . setAvatar ( userInfo . getLogo ()); //\u7f18\u5206\u503c User user = UserThreadLocal . get (); todayBest . setFateValue ( this . recommendUserService . queryScore ( userId , user . getId ()). longValue ()); //\u8bb0\u5f55\u6765\u8bbf\u7528\u6237 this . visitorsApi . saveVisitor ( userId , user . getId (), \"\u4e2a\u4eba\u4e3b\u9875\" ); return todayBest ; }","title":"5.3\u3001\u8bb0\u5f55\u8bbf\u5ba2\u6570\u636e"},{"location":"tantan/day07/#54","text":"","title":"5.4\u3001\u6d4b\u8bd5"},{"location":"tantan/day07/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/","text":"\u72ec\u7acb\u5b9e\u73b0\u70b9\u8d5e\u6d88\u606f\u5217\u8868\u529f\u80fd \u72ec\u7acb\u5b9e\u73b0\u559c\u6b22\u6d88\u606f\u5217\u8868\u529f\u80fd \u72ec\u7acb\u5b9e\u73b0\u8bc4\u8bba\u6d88\u606f\u5217\u8868\u529f\u80fd \u72ec\u7acb\u5b9e\u73b0\u516c\u544a\u5217\u8868\u529f\u80fd \u72ec\u7acb\u5b9e\u73b0\u4e2a\u4eba\u4e3b\u9875\u529f\u80fd \u7406\u89e3\u804a\u4e00\u4e0b\u7684\u6d41\u7a0b \u72ec\u7acb\u5b9e\u73b0\u804a\u4e00\u4e0b\u529f\u80fd \u638c\u63e1\u8c01\u770b\u8fc7\u7684\u529f\u80fd\u5b9e\u73b0","title":"\u5b66\u4e60\u76ee\u6807"},{"location":"tantan/day08/","text":"\u8bfe\u7a0b\u8bf4\u660e \u00b6 \u4e0a\u62a5\u5730\u4f4d\u4f4d\u7f6e \u5b9e\u73b0\u641c\u9644\u8fd1\u529f\u80fd \u5b9e\u73b0\u63a2\u82b1\u529f\u80fd \u7528\u6237\u57fa\u672c\u4fe1\u606f\u7ef4\u62a4 1\u3001\u4e0a\u62a5\u5730\u7406\u4f4d\u7f6e \u00b6 \u5f53\u5ba2\u6237\u7aef\u68c0\u6d4b\u7528\u6237\u7684\u5730\u7406\u4f4d\u7f6e\uff0c\u5f53\u53d8\u5316\u5927\u4e8e500\u7c73\u65f6\u6216\u6bcf\u96945\u5206\u949f\uff0c\u5411\u670d\u52a1\u7aef\u4e0a\u62a5\u5730\u7406\u4f4d\u7f6e\u3002 \u7528\u6237\u7684\u5730\u7406\u4f4d\u7f6e\u5b58\u50a8\u5230Elasticsearch\u4e2d\uff0c\u9700\u8981\u4f7f\u7528\u73af\u5883\u63d0\u4f9b\u7684ES\u96c6\u7fa4\uff0c\u5982\u4e0b\uff1a 1.1\u3001dubbo\u670d\u52a1 \u00b6 \u7528\u6237\u5730\u7406\u4f4d\u7f6e\u7684\u670d\u52a1\u72ec\u7acb\u4e00\u4e2a\u65b0\u7684\u5de5\u7a0b\u6765\u5b9e\u73b0\uff0c\u540d\u5b57\u4e3a\uff1amy-tanhua-dubbo-es\u3002 1.1.1\u3001\u521b\u5efa\u5de5\u7a0b \u00b6 pom.ml\u6587\u4ef6\u5982\u4e0b\uff1a <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <parent> <artifactId> my-tanhua-dubbo </artifactId> <groupId> cn.itcast.tanhua </groupId> <version> 1.0-SNAPSHOT </version> </parent> <modelVersion> 4.0.0 </modelVersion> <artifactId> my-tanhua-dubbo-es </artifactId> <dependencies> <!--\u5f15\u5165interface\u4f9d\u8d56--> <dependency> <groupId> cn.itcast.tanhua </groupId> <artifactId> my-tanhua-dubbo-interface </artifactId> <version> 1.0-SNAPSHOT </version> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-test </artifactId> <scope> test </scope> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-elasticsearch </artifactId> </dependency> <!--dubbo\u7684springboot\u652f\u6301--> <dependency> <groupId> com.alibaba.boot </groupId> <artifactId> dubbo-spring-boot-starter </artifactId> </dependency> <!--dubbo\u6846\u67b6--> <dependency> <groupId> com.alibaba </groupId> <artifactId> dubbo </artifactId> </dependency> <!--zk\u4f9d\u8d56--> <dependency> <groupId> org.apache.zookeeper </groupId> <artifactId> zookeeper </artifactId> </dependency> <dependency> <groupId> com.github.sgroschupf </groupId> <artifactId> zkclient </artifactId> </dependency> <dependency> <groupId> io.netty </groupId> <artifactId> netty-all </artifactId> </dependency> <dependency> <groupId> cn.hutool </groupId> <artifactId> hutool-all </artifactId> </dependency> </dependencies> </project> application.properties\u6587\u4ef6\uff1a # Spring boot application spring.application.name = itcast-tanhua-dubbo-es # dubbo \u626b\u63cf\u5305\u914d\u7f6e dubbo.scan.basePackages = com.tanhua.dubbo.es dubbo.application.name = dubbo-provider-es #dubbo \u5bf9\u5916\u66b4\u9732\u7684\u7aef\u53e3\u4fe1\u606f dubbo.protocol.name = dubbo dubbo.protocol.port = 20882 #dubbo\u6ce8\u518c\u4e2d\u5fc3\u7684\u914d\u7f6e dubbo.registry.address = zookeeper://192.168.31.81:2181 dubbo.registry.client = zkclient dubbo.registry.timeout = 60000 #ES\u96c6\u7fa4\u914d\u7f6e spring.data.elasticsearch.cluster-name = es-tanhua-cluster spring.data.elasticsearch.cluster-nodes = 192.168.31.81:9300,192.168.31.81:9301,192.168.31.81:9302 \u542f\u52a8\u7c7b\uff1a package com.tanhua.dubbo.es ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; import org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration ; import org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration ; @SpringBootApplication ( exclude = { MongoAutoConfiguration . class , MongoDataAutoConfiguration . class }) //\u6392\u9664mongo\u7684\u81ea\u52a8\u914d\u7f6e public class ESApplication { public static void main ( String [] args ) { SpringApplication . run ( ESApplication . class , args ); } } 1.1.2\u3001\u5b9a\u4e49pojo \u00b6 \u5728my-tanhua-dubbo-interface\u4e2d\u521b\u5efa\uff1a package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.elasticsearch.common.geo.GeoPoint ; import org.springframework.data.annotation.Id ; import org.springframework.data.elasticsearch.annotations.Document ; import org.springframework.data.elasticsearch.annotations.Field ; import org.springframework.data.elasticsearch.annotations.FieldType ; import org.springframework.data.elasticsearch.annotations.GeoPointField ; @Data @NoArgsConstructor @AllArgsConstructor @Document ( indexName = \"tanhua\" , type = \"user_location\" , shards = 6 , replicas = 2 ) public class UserLocation { @Id private Long userId ; //\u7528\u6237id @GeoPointField private GeoPoint location ; //lon:\u7ecf\u5ea6 lat:\u7eac\u5ea6 @Field ( type = FieldType . Keyword ) private String address ; //\u4f4d\u7f6e\u63cf\u8ff0 @Field ( type = FieldType . Long ) private Long created ; //\u521b\u5efa\u65f6\u95f4 @Field ( type = FieldType . Long ) private Long updated ; //\u66f4\u65b0\u65f6\u95f4 @Field ( type = FieldType . Long ) private Long lastUpdated ; //\u4e0a\u6b21\u66f4\u65b0\u65f6\u95f4 } package com.tanhua.dubbo.server.vo ; import cn.hutool.core.bean.BeanUtil ; import com.tanhua.dubbo.server.pojo.UserLocation ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import java.util.ArrayList ; import java.util.List ; @Data @NoArgsConstructor @AllArgsConstructor public class UserLocationVo implements java . io . Serializable { private static final long serialVersionUID = 4133419501260037769L ; private Long userId ; //\u7528\u6237id private Double longitude ; //\u7ecf\u5ea6 private Double latitude ; //\u7ef4\u5ea6 private String address ; //\u4f4d\u7f6e\u63cf\u8ff0 private Long created ; //\u521b\u5efa\u65f6\u95f4 private Long updated ; //\u66f4\u65b0\u65f6\u95f4 private Long lastUpdated ; //\u4e0a\u6b21\u66f4\u65b0\u65f6\u95f4 public static final UserLocationVo format ( UserLocation userLocation ) { UserLocationVo userLocationVo = BeanUtil . toBean ( userLocation , UserLocationVo . class ); userLocationVo . setLongitude ( userLocation . getLocation (). getLon ()); userLocationVo . setLatitude ( userLocation . getLocation (). getLat ()); return userLocationVo ; } public static final List < UserLocationVo > formatToList ( List < UserLocation > userLocations ) { List < UserLocationVo > list = new ArrayList <> (); for ( UserLocation userLocation : userLocations ) { list . add ( format ( userLocation )); } return list ; } } \u7531\u4e8eUserLocation\u4e0d\u80fd\u5e8f\u5217\u5316\uff0c\u6240\u4ee5\u8981\u518d\u5b9a\u4e49UserLocationVo\u8fdb\u884c\u8fd4\u56de\u6570\u636e\u3002 \u5728my-tanhua-dubbo-interface\u4e2d\u6dfb\u52a0\u4f9d\u8d56\uff1a <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-elasticsearch </artifactId> </dependency> <dependency> <groupId> cn.hutool </groupId> <artifactId> hutool-all </artifactId> </dependency> 1.1.3\u3001\u5b9a\u4e49dubbo\u63a5\u53e3 \u00b6 \u5728my-tanhua-dubbo-interface\u5de5\u7a0b\u4e2d\u3002 package com.tanhua.dubbo.server.api ; public interface UserLocationApi { /** * \u66f4\u65b0\u7528\u6237\u5730\u7406\u4f4d\u7f6e * * @param userId \u7528\u6237id * @param longitude \u7ecf\u5ea6 * @param latitude \u7eac\u5ea6 * @param address \u5730\u5740\u540d\u79f0 * @return */ Boolean updateUserLocation ( Long userId , Double longitude , Double latitude , String address ); } 1.1.4\u3001\u7f16\u5199\u5b9e\u73b0 \u00b6 package com.tanhua.dubbo.es.api ; import cn.hutool.core.util.ObjectUtil ; import com.alibaba.dubbo.config.annotation.Service ; import com.tanhua.dubbo.server.api.UserLocationApi ; import com.tanhua.dubbo.server.pojo.UserLocation ; import lombok.extern.slf4j.Slf4j ; import org.elasticsearch.action.update.UpdateRequest ; import org.elasticsearch.common.geo.GeoPoint ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.elasticsearch.core.ElasticsearchTemplate ; import org.springframework.data.elasticsearch.core.query.* ; import javax.annotation.PostConstruct ; import java.util.HashMap ; import java.util.Map ; @Service ( version = \"1.0.0\" ) @Slf4j public class UserLocationApiImpl implements UserLocationApi { @Autowired private ElasticsearchTemplate elasticsearchTemplate ; /** * \u521d\u59cb\u5316\u7d22\u5f15\u5e93 * */ @PostConstruct public void initIndex (){ //\u5224\u65ad\u7d22\u5f15\u5e93\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u9700\u8981\u521b\u5efa if ( ! this . elasticsearchTemplate . indexExists ( \"tanhua\" )){ this . elasticsearchTemplate . createIndex ( UserLocation . class ); } //\u5224\u65ad\u8868\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u9700\u8981\u521b\u5efa if ( ! this . elasticsearchTemplate . typeExists ( \"tanhua\" , \"user_location\" )){ this . elasticsearchTemplate . putMapping ( UserLocation . class ); } } @Override public Boolean updateUserLocation ( Long userId , Double longitude , Double latitude , String address ) { //\u67e5\u8be2\u4e2a\u4eba\u7684\u5730\u7406\u4f4d\u7f6e\u6570\u636e\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u9700\u8981\u65b0\u589e\uff0c\u5982\u679c\u662f\u5b58\u5728\u6570\u636e\uff0c\u66f4\u65b0\u6570\u636e try { GetQuery getQuery = new GetQuery (); getQuery . setId ( String . valueOf ( userId )); UserLocation userLocation = this . elasticsearchTemplate . queryForObject ( getQuery , UserLocation . class ); if ( ObjectUtil . isEmpty ( userLocation )){ //\u65b0\u589e\u6570\u636e userLocation = new UserLocation (); userLocation . setUserId ( userId ); userLocation . setAddress ( address ); userLocation . setCreated ( System . currentTimeMillis ()); userLocation . setUpdated ( userLocation . getCreated ()); userLocation . setLastUpdated ( userLocation . getCreated ()); userLocation . setLocation ( new GeoPoint ( latitude , longitude )); IndexQuery indexQuery = new IndexQueryBuilder (). withObject ( userLocation ). build (); //\u4fdd\u5b58\u6570\u636e\u5230ES\u4e2d this . elasticsearchTemplate . index ( indexQuery ); } else { //\u66f4\u65b0\u6570\u636e //\u66f4\u65b0\u7684\u5b57\u6bb5 Map < String , Object > map = new HashMap <> (); map . put ( \"location\" , new GeoPoint ( latitude , longitude )); map . put ( \"updated\" , System . currentTimeMillis ()); map . put ( \"lastUpdated\" , userLocation . getUpdated ()); map . put ( \"address\" , address ); UpdateRequest updateRequest = new UpdateRequest (); updateRequest . doc ( map ); UpdateQuery updateQuery = new UpdateQueryBuilder () . withId ( String . valueOf ( userId )) . withClass ( UserLocation . class ) . withUpdateRequest ( updateRequest ). build (); //\u66f4\u65b0\u6570\u636e this . elasticsearchTemplate . update ( updateQuery ); } return true ; } catch ( Exception e ) { log . error ( \"\u66f4\u65b0\u5730\u7406\u4f4d\u7f6e\u5931\u8d25~ userId = \" + userId + \", longitude = \" + longitude + \", latitude = \" + latitude + \", address = \" + address , e ); } return false ; } } 1.1.5\u3001\u5355\u5143\u6d4b\u8bd5 \u00b6 package com.tanhua.dubbo.es ; import com.tanhua.dubbo.server.api.UserLocationApi ; import com.tanhua.dubbo.server.vo.PageInfo ; import com.tanhua.dubbo.server.vo.UserLocationVo ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestUserLocationApi { @Autowired private UserLocationApi userLocationApi ; @Test public void testUpdateUserLocation () { this . userLocationApi . updateUserLocation ( 1L , 121.512253 , 31.24094 , \"\u91d1\u8302\u5927\u53a6\" ); this . userLocationApi . updateUserLocation ( 2L , 121.506377 , 31.245105 , \"\u4e1c\u65b9\u660e\u73e0\u5e7f\u64ad\u7535\u89c6\u5854\" ); this . userLocationApi . updateUserLocation ( 10L , 121.508815 , 31.243844 , \"\u9646\u5bb6\u5634\u5730\u94c1\u7ad9\" ); this . userLocationApi . updateUserLocation ( 12L , 121.511999 , 31.239185 , \"\u4e0a\u6d77\u4e2d\u5fc3\u5927\u53a6\" ); this . userLocationApi . updateUserLocation ( 25L , 121.493444 , 31.240513 , \"\u4e0a\u6d77\u5e02\u516c\u5b89\u5c40\" ); this . userLocationApi . updateUserLocation ( 27L , 121.494108 , 31.247011 , \"\u4e0a\u6d77\u5916\u6ee9\u7f8e\u672f\u9986\" ); this . userLocationApi . updateUserLocation ( 30L , 121.462452 , 31.253463 , \"\u4e0a\u6d77\u706b\u8f66\u7ad9\" ); this . userLocationApi . updateUserLocation ( 32L , 121.81509 , 31.157478 , \"\u4e0a\u6d77\u6d66\u4e1c\u56fd\u9645\u673a\u573a\" ); this . userLocationApi . updateUserLocation ( 34L , 121.327908 , 31.20033 , \"\u8679\u6865\u706b\u8f66\u7ad9\" ); this . userLocationApi . updateUserLocation ( 38L , 121.490155 , 31.277476 , \"\u9c81\u8fc5\u516c\u56ed\" ); this . userLocationApi . updateUserLocation ( 40L , 121.425511 , 31.227831 , \"\u4e2d\u5c71\u516c\u56ed\" ); this . userLocationApi . updateUserLocation ( 43L , 121.594194 , 31.207786 , \"\u5f20\u6c5f\u9ad8\u79d1\" ); } } 1.2\u3001APP\u63a5\u53e3 \u00b6 \u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/557 1.2.1\u3001BaiduController \u00b6 package com.tanhua.server.controller ; import com.tanhua.server.service.BaiduService ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestBody ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RestController ; import java.util.Map ; @RestController @RequestMapping ( \"baidu\" ) public class BaiduController { @Autowired private BaiduService baiduService ; /** * \u66f4\u65b0\u4f4d\u7f6e * * @param param * @return */ @PostMapping ( \"location\" ) public ResponseEntity < Void > updateLocation ( @RequestBody Map < String , Object > param ) { try { Double longitude = Double . valueOf ( param . get ( \"longitude\" ). toString ()); Double latitude = Double . valueOf ( param . get ( \"latitude\" ). toString ()); String address = param . get ( \"addrStr\" ). toString (); Boolean bool = this . baiduService . updateLocation ( longitude , latitude , address ); if ( bool ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } } 1.2.2\u3001BaiduService \u00b6 package com.tanhua.server.service ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.common.pojo.User ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.dubbo.server.api.UserLocationApi ; import lombok.extern.slf4j.Slf4j ; import org.springframework.stereotype.Service ; @Service @Slf4j public class BaiduService { @Reference ( version = \"1.0.0\" ) private UserLocationApi userLocationApi ; public Boolean updateLocation ( Double longitude , Double latitude , String address ) { User user = UserThreadLocal . get (); try { return this . userLocationApi . updateUserLocation ( user . getId (), longitude , latitude , address ); } catch ( Exception e ) { log . error ( \"\u66f4\u65b0\u5730\u7406\u4f4d\u7f6e\u5931\u8d25~ userId = \" + user . getId () + \", longitude = \" + longitude + \", latitude = \" + latitude + \", address = \" + address , e ); } return false ; } } 1.3\u3001\u6d4b\u8bd5 \u00b6 2\u3001\u641c\u9644\u8fd1 \u00b6 \u5728\u9996\u9875\u4e2d\u70b9\u51fb\u201c\u641c\u9644\u8fd1\u201d\u53ef\u4ee5\u641c\u7d22\u9644\u8fd1\u7684\u597d\u53cb\uff0c\u6548\u679c\u5982\u4e0b\uff1a \u5b9e\u73b0\u601d\u8def\uff1a\u6839\u636e\u5f53\u524d\u7528\u6237\u7684\u4f4d\u7f6e\uff0c\u67e5\u8be2\u9644\u8fd1\u8303\u56f4\u5185\u7684\u7528\u6237\u3002\u8303\u56f4\u662f\u53ef\u4ee5\u8bbe\u7f6e\u7684\u3002 2.1\u3001dubbo\u670d\u52a1 \u00b6 2.1.1\u3001\u5b9a\u4e49\u63a5\u53e3\u65b9\u6cd5 \u00b6 //com.tanhua.dubbo.server.api.UserLocationApi /** * \u67e5\u8be2\u7528\u6237\u5730\u7406\u4f4d\u7f6e * * @param userId * @return */ UserLocationVo queryByUserId ( Long userId ); /** * \u6839\u636e\u4f4d\u7f6e\u641c\u7d22 * * @param longitude \u7ecf\u5ea6 * @param latitude \u7eac\u5ea6 * @param distance \u8ddd\u79bb(\u7c73) * @param page \u9875\u6570 * @param pageSize \u9875\u9762\u5927\u5c0f */ PageInfo < UserLocationVo > queryUserFromLocation ( Double longitude , Double latitude , Double distance , Integer page , Integer pageSize ); 2.1.2\u3001\u7f16\u5199\u5b9e\u73b0 \u00b6 //com.tanhua.dubbo.es.api.UserLocationApiImpl /** * \u67e5\u8be2\u7528\u6237\u7684\u4f4d\u7f6e\u4fe1\u606f * * @param userId * @return */ @Override public UserLocationVo queryByUserId ( Long userId ) { GetQuery getQuery = new GetQuery (); getQuery . setId ( String . valueOf ( userId )); UserLocation userLocation = this . elasticsearchTemplate . queryForObject ( getQuery , UserLocation . class ); if ( ObjectUtil . isNotEmpty ( userLocation )){ return UserLocationVo . format ( userLocation ); } return null ; } /** * \u6839\u636e\u4f4d\u7f6e\u641c\u7d22 * * @param longitude \u7ecf\u5ea6 * @param latitude \u7eac\u5ea6 * @param distance \u8ddd\u79bb(\u7c73) * @param page \u9875\u6570 * @param pageSize \u9875\u9762\u5927\u5c0f */ @Override public PageInfo < UserLocationVo > queryUserFromLocation ( Double longitude , Double latitude , Double distance , Integer page , Integer pageSize ) { PageInfo < UserLocationVo > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); String fieldName = \"location\" ; //\u5b9e\u73b0\u4e86SearchQuery\u63a5\u53e3\uff0c\u6784\u9020\u5206\u9875\u3001\u6392\u5e8f NativeSearchQueryBuilder searchQueryBuilder = new NativeSearchQueryBuilder (); //\u5206\u9875 PageRequest pageRequest = PageRequest . of ( page - 1 , pageSize ); searchQueryBuilder . withPageable ( pageRequest ); BoolQueryBuilder boolQueryBuilder = new BoolQueryBuilder (); //\u4ee5\u4e00\u4e2a\u70b9\u4e3a\u4e2d\u5fc3\uff0c\u6307\u5b9a\u8303\u56f4\u67e5\u8be2 GeoDistanceQueryBuilder geoDistanceQueryBuilder = new GeoDistanceQueryBuilder ( fieldName ); //\u4e2d\u5fc3\u70b9 geoDistanceQueryBuilder . point ( new GeoPoint ( latitude , longitude )); //\u8ddd\u79bb\uff08\u753b\u5706\u7684\u534a\u5f84\uff09\u5355\u4f4d\uff1a\u516c\u91cc geoDistanceQueryBuilder . distance ( distance / 1000 , DistanceUnit . KILOMETERS ); boolQueryBuilder . must ( geoDistanceQueryBuilder ); searchQueryBuilder . withQuery ( boolQueryBuilder ); //\u6392\u5e8f\uff0c\u7531\u8fd1\u5230\u8fdc\u6392\u5e8f GeoDistanceSortBuilder geoDistanceSortBuilder = new GeoDistanceSortBuilder ( fieldName , latitude , longitude ); geoDistanceSortBuilder . order ( SortOrder . ASC ); //\u6b63\u5e8f\u6392\u5e8f geoDistanceSortBuilder . unit ( DistanceUnit . KILOMETERS ); //\u8bbe\u7f6e\u5355\u4f4d searchQueryBuilder . withSort ( geoDistanceSortBuilder ); AggregatedPage < UserLocation > aggregatedPage = this . elasticsearchTemplate . queryForPage ( searchQueryBuilder . build (), UserLocation . class ); if ( CollUtil . isEmpty ( aggregatedPage . getContent ())){ return pageInfo ; } pageInfo . setRecords ( UserLocationVo . formatToList ( aggregatedPage . getContent ())); return pageInfo ; } 2.1.3\u3001\u5355\u5143\u6d4b\u8bd5 \u00b6 //com.tanhua.dubbo.es.TestUserLocationApi @Test public void testQueryByUserId (){ UserLocationVo userLocationVo = this . userLocationApi . queryByUserId ( 1L ); System . out . println ( userLocationVo ); } @Test public void testQueryUserFromLocation (){ UserLocationVo userLocationVo = this . userLocationApi . queryByUserId ( 1L ); PageInfo < UserLocationVo > pageInfo = this . userLocationApi . queryUserFromLocation ( userLocationVo . getLongitude (), userLocationVo . getLatitude (), 5000 d , 1 , 10 ); pageInfo . getRecords (). forEach ( vo -> System . out . println ( vo )); } 2.2\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 \u6587\u6863\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/611 2.2.1\u3001NearUserVo \u00b6 package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class NearUserVo { private Long userId ; private String avatar ; private String nickname ; } 2.2.2\u3001TanHuaController \u00b6 //com.tanhua.server.controller.TanHuaController /** * \u641c\u9644\u8fd1 * * @param gender * @param distance * @return */ @GetMapping ( \"search\" ) public ResponseEntity < List < NearUserVo >> queryNearUser ( @RequestParam ( value = \"gender\" , required = false ) String gender , @RequestParam ( value = \"distance\" , defaultValue = \"2000\" ) String distance ) { try { List < NearUserVo > list = this . tanHuaService . queryNearUser ( gender , distance ); return ResponseEntity . ok ( list ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 2.2.3\u3001TanHuaService \u00b6 //com.tanhua.server.service.TanHuaService public List < NearUserVo > queryNearUser ( String gender , String distance ) { //\u67e5\u8be2\u5f53\u524d\u7528\u6237\u7684\u4f4d\u7f6e User user = UserThreadLocal . get (); UserLocationVo userLocationVo = this . userLocationApi . queryByUserId ( user . getId ()); if ( ObjectUtil . isEmpty ( userLocationVo )){ return ListUtil . empty (); } PageInfo < UserLocationVo > pageInfo = this . userLocationApi . queryUserFromLocation ( userLocationVo . getLongitude (), userLocationVo . getLatitude (), Convert . toDouble ( distance ), 1 , 50 ); List < UserLocationVo > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )){ return ListUtil . empty (); } //\u6784\u9020\u7b5b\u9009\u6761\u4ef6 List < Object > userIdList = CollUtil . getFieldValues ( records , \"userId\" ); QueryWrapper < UserInfo > queryWrapper = new QueryWrapper <> (); queryWrapper . in ( \"user_id\" , userIdList ); if ( StrUtil . equalsIgnoreCase ( gender , \"man\" )){ queryWrapper . eq ( \"sex\" , SexEnum . MAN ); } else if ( StrUtil . equalsIgnoreCase ( gender , \"woman\" )){ queryWrapper . eq ( \"sex\" , SexEnum . WOMAN ); } List < UserInfo > userInfoList = this . userInfoService . queryUserInfoList ( queryWrapper ); List < NearUserVo > result = new ArrayList <> (); for ( UserLocationVo locationVo : records ) { //\u6392\u9664\u81ea\u5df1 if ( ObjectUtil . equals ( locationVo . getUserId (), user . getId ())){ continue ; } for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( locationVo . getUserId (), userInfo . getUserId ())){ NearUserVo nearUserVo = new NearUserVo (); nearUserVo . setUserId ( userInfo . getUserId ()); nearUserVo . setAvatar ( userInfo . getLogo ()); nearUserVo . setNickname ( userInfo . getNickName ()); result . add ( nearUserVo ); break ; } } } return result ; } 2.2.4\u3001\u6d4b\u8bd5 \u00b6 3\u3001\u63a2\u82b1 \u00b6 \u63a2\u82b1\u529f\u80fd\u662f\u5c06\u63a8\u8350\u7684\u597d\u53cb\u968f\u673a\u7684\u901a\u8fc7\u5361\u7247\u7684\u5f62\u5f0f\u5c55\u73b0\u51fa\u6765\uff0c\u7528\u6237\u53ef\u4ee5\u9009\u62e9\u5de6\u6ed1\u3001\u53f3\u6ed1\u64cd\u4f5c\uff0c\u5de6\u6ed1\uff1a\u201c\u4e0d\u559c\u6b22\u201d\uff0c\u53f3\u6ed1\uff1a\u201c\u559c\u6b22\u201d\u3002 \u559c\u6b22\uff1a\u5982\u679c\u53cc\u65b9\u559c\u6b22\uff0c\u90a3\u4e48\u5c31\u4f1a\u6210\u4e3a\u597d\u53cb\u3002 \u5982\u679c\u5df2\u7ecf\u559c\u6b22\u6216\u4e0d\u559c\u6b22\u7684\u7528\u6237\u5728\u5217\u8868\u4e2d\u4e0d\u518d\u663e\u793a\u3002 3.1\u3001\u559c\u6b22\u7684dubbo\u670d\u52a1 \u00b6 \u7528\u6237\u7684\u559c\u6b22\u4e0e\u4e0d\u559c\u6b22\u5217\u8868\u9700\u8981\u4fdd\u5b58\u5728redis\u4e2d\uff0c\u4e3a\u4e86\u9632\u6b62redis\u4e2d\u7684\u6570\u636e\u4e22\u5931\uff0c\u540c\u65f6\u9700\u8981\u5c06\u6570\u636e\u4fdd\u5b58\u5230mongodb\u8fdb\u884c\u6301\u4e45\u5316\u4fdd\u5b58\u3002 3.1.1\u3001\u5b9e\u4f53\u5bf9\u8c61 \u00b6 package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.mongodb.core.index.Indexed ; import org.springframework.data.mongodb.core.mapping.Document ; @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"user_like\" ) public class UserLike implements java . io . Serializable { private static final long serialVersionUID = 6739966698394686523L ; private ObjectId id ; @Indexed private Long userId ; //\u7528\u6237id\uff0c\u81ea\u5df1 @Indexed private Long likeUserId ; //\u559c\u6b22\u7684\u7528\u6237id\uff0c\u5bf9\u65b9 private Long created ; //\u521b\u5efa\u65f6\u95f4 } 3.1.2\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 package com.tanhua.dubbo.server.api ; import java.util.List ; public interface UserLikeApi { /** * \u559c\u6b22 * * @param userId * @param likeUserId * @return */ Boolean likeUser ( Long userId , Long likeUserId ); /** * \u4e0d\u559c\u6b22 * * @param userId * @param likeUserId * @return */ Boolean notLikeUser ( Long userId , Long likeUserId ); /** * \u662f\u5426\u76f8\u4e92\u559c\u6b22 * * @param userId * @param likeUserId * @return */ Boolean isMutualLike ( Long userId , Long likeUserId ); /** * \u67e5\u8be2\u559c\u6b22\u5217\u8868 * * @param userId * @return */ List < Long > queryLikeList ( Long userId ); /** * \u67e5\u8be2\u4e0d\u559c\u6b22\u5217\u8868 * * @param userId * @return */ List < Long > queryNotLikeList ( Long userId ); } 3.1.3\u3001\u7f16\u5199\u5b9e\u73b0 \u00b6 package com.tanhua.dubbo.server.api ; import cn.hutool.core.collection.CollUtil ; import cn.hutool.core.collection.ListUtil ; import cn.hutool.core.convert.Convert ; import com.alibaba.dubbo.config.annotation.Service ; import com.tanhua.dubbo.server.pojo.UserLike ; import org.bson.types.ObjectId ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; import org.springframework.data.redis.core.RedisTemplate ; import java.util.ArrayList ; import java.util.List ; import java.util.Set ; @Service ( version = \"1.0.0\" ) public class UserLikeApiImpl implements UserLikeApi { @Autowired private MongoTemplate mongoTemplate ; @Autowired private RedisTemplate < String , String > redisTemplate ; public static final String LIKE_REDIS_KEY_PREFIX = \"USER_LIKE_\" ; public static final String NOT_LIKE_REDIS_KEY_PREFIX = \"USER_NOT_LIKE_\" ; /** * \u559c\u6b22 * * @param userId * @param likeUserId * @return */ @Override public Boolean likeUser ( Long userId , Long likeUserId ) { //\u5224\u65ad\u8be5\u7528\u6237\u662f\u5426\u5df2\u7ecf\u559c\u6b22\uff0c\u5982\u679c\u5df2\u7ecf\u559c\u6b22\u5c31\u8fd4\u56de if ( this . isLike ( userId , likeUserId )){ return false ; } UserLike userLike = new UserLike (); userLike . setId ( ObjectId . get ()); userLike . setUserId ( userId ); userLike . setLikeUserId ( likeUserId ); userLike . setCreated ( System . currentTimeMillis ()); //\u5c06\u6570\u636e\u5b58\u50a8\u5230MongoDB this . mongoTemplate . save ( userLike ); //\u7528\u6237\u7684\u559c\u6b22\u6570\u636e\u4fdd\u5b58\u5230redis //\u7528\u62371\uff1akey -> USER_LIKE_1 , value -> 2, \"1\" //\u7528\u62371\uff1akey -> USER_LIKE_1 , value -> 3, \"1\" //\u7528\u62372\uff1akey -> USER_LIKE_2 , value -> 4, \"1\" String redisKey = this . getLikeRedisKey ( userId ); String hashKey = String . valueOf ( likeUserId ); this . redisTemplate . opsForHash (). put ( redisKey , hashKey , \"1\" ); //\u5224\u65ad\uff0c\u559c\u6b22\u7684\u7528\u6237\u662f\u5426\u5728\u4e0d\u559c\u6b22\u7684\u5217\u8868\u4e2d\uff0c\u5982\u679c\u5728\uff0c\u5c31\u9700\u8981\u5220\u9664\u6570\u636e if ( this . isNotLike ( userId , likeUserId )){ redisKey = this . getNotLikeRedisKey ( userId ); this . redisTemplate . opsForHash (). delete ( redisKey , hashKey ); } return true ; } /** * \u83b7\u53d6\u559c\u6b22\u6570\u636e\u7684redis key * * @param userId * @return */ private String getLikeRedisKey ( Long userId ){ return LIKE_REDIS_KEY_PREFIX + userId ; } /** * \u83b7\u53d6\u4e0d\u559c\u6b22\u6570\u636e\u7684redis key * * @param userId * @return */ private String getNotLikeRedisKey ( Long userId ){ return NOT_LIKE_REDIS_KEY_PREFIX + userId ; } /** * \u662f\u5426\u559c\u6b22 * * @param userId * @param likeUserId * @return */ private Boolean isLike ( Long userId , Long likeUserId ){ String redisKey = this . getLikeRedisKey ( userId ); String hashKey = String . valueOf ( likeUserId ); return this . redisTemplate . opsForHash (). hasKey ( redisKey , hashKey ); } /** * \u662f\u5426\u4e0d\u559c\u6b22 * * @param userId * @param likeUserId * @return */ private Boolean isNotLike ( Long userId , Long likeUserId ){ String redisKey = this . getNotLikeRedisKey ( userId ); String hashKey = String . valueOf ( likeUserId ); return this . redisTemplate . opsForHash (). hasKey ( redisKey , hashKey ); } @Override public Boolean notLikeUser ( Long userId , Long likeUserId ) { //\u5224\u65ad\u7528\u6237\u662f\u5426\u5df2\u7ecf\u4e0d\u559c\u6b22\uff0c\u5982\u679c\u5df2\u7ecf\u4e0d\u559c\u6b22\uff0c\u5c31\u8fd4\u56de if ( this . isNotLike ( userId , likeUserId )){ return false ; } //\u5c06\u7528\u6237\u4fdd\u5b58\u5230\u4e0d\u559c\u6b22\u5217\u8868\u4e2d String redisKey = this . getNotLikeRedisKey ( userId ); String hashKey = String . valueOf ( likeUserId ); this . redisTemplate . opsForHash (). put ( redisKey , hashKey , \"1\" ); //\u5224\u65ad\u7528\u6237\u662f\u5426\u5728\u559c\u6b22\u5217\u8868\u4e2d\uff0c\u5982\u679c\u5b58\u5728\u7684\u8bdd\uff0c\u9700\u8981\u5220\u9664\u6570\u636e if ( this . isLike ( userId , likeUserId )){ //\u5220\u9664MongoDB\u6570\u636e Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId ) . and ( \"likeUserId\" ). is ( likeUserId ) ); this . mongoTemplate . remove ( query , UserLike . class ); //\u5220\u9664redis\u4e2d\u7684\u6570\u636e redisKey = this . getLikeRedisKey ( userId ); this . redisTemplate . opsForHash (). delete ( redisKey , hashKey ); } return true ; } @Override public Boolean isMutualLike ( Long userId , Long likeUserId ) { return this . isLike ( userId , likeUserId ) && this . isLike ( likeUserId , userId ); } @Override public List < Long > queryLikeList ( Long userId ) { // \u67e5\u8be2redis String redisKey = this . getLikeRedisKey ( userId ); Set < Object > keys = this . redisTemplate . opsForHash (). keys ( redisKey ); if ( CollUtil . isEmpty ( keys )){ return ListUtil . empty (); } List < Long > result = new ArrayList <> ( keys . size ()); keys . forEach ( o -> result . add ( Convert . toLong ( o ))); return result ; } @Override public List < Long > queryNotLikeList ( Long userId ) { // \u67e5\u8be2redis String redisKey = this . getNotLikeRedisKey ( userId ); Set < Object > keys = this . redisTemplate . opsForHash (). keys ( redisKey ); if ( CollUtil . isEmpty ( keys )){ return ListUtil . empty (); } List < Long > result = new ArrayList <> ( keys . size ()); keys . forEach ( o -> result . add ( Convert . toLong ( o ))); return result ; } } 3.1.4\u3001\u5355\u5143\u6d4b\u8bd5 \u00b6 package com.tanhua.dubbo.server.api ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestUserLikeApi { @Autowired private UserLikeApi userLikeApi ; @Test public void testUserLike () { System . out . println ( this . userLikeApi . likeUser ( 1L , 2L )); System . out . println ( this . userLikeApi . likeUser ( 1L , 3L )); System . out . println ( this . userLikeApi . likeUser ( 1L , 4L )); System . out . println ( this . userLikeApi . notLikeUser ( 1L , 5L )); System . out . println ( this . userLikeApi . notLikeUser ( 1L , 6L )); System . out . println ( this . userLikeApi . likeUser ( 1L , 5L )); System . out . println ( this . userLikeApi . notLikeUser ( 1L , 2L )); } @Test public void testQueryList (){ this . userLikeApi . queryLikeList ( 1L ). forEach ( a -> System . out . println ( a )); System . out . println ( \"-------\" ); this . userLikeApi . queryNotLikeList ( 1L ). forEach ( a -> System . out . println ( a )); } } 3.2\u3001\u67e5\u8be2\u63a8\u8350\u5217\u8868dubbo\u670d\u52a1 \u00b6 3.2.1\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 //com.tanhua.dubbo.server.api.RecommendUserApi /** * \u67e5\u8be2\u63a2\u82b1\u5217\u8868\uff0c\u67e5\u8be2\u65f6\u9700\u8981\u6392\u9664\u4e0d\u559c\u6b22\u5217\u8868\u7528\u6237 * * @param userId * @param count * @return */ List < RecommendUser > queryCardList ( Long userId , Integer count ); 3.2.2\u3001\u7f16\u5199\u5b9e\u73b0 \u00b6 //com.tanhua.dubbo.server.api.RecommendUserApiImpl @Override public List < RecommendUser > queryCardList ( Long userId , Integer count ) { //\u8bbe\u7f6e\u5206\u9875\u4ee5\u53ca\u6392\u5e8f\uff0c\u6309\u7167\u5f97\u5206\u5012\u5e8f\u6392\u5e8f PageRequest pageRequest = PageRequest . of ( 0 , count , Sort . by ( Sort . Order . desc ( \"score\" ))); //\u6392\u9664\u5df2\u559c\u6b22\u6216\u4e0d\u559c\u6b22\u7684\u7528\u6237 List < Long > userIds = new ArrayList <> (); //\u67e5\u8be2\u559c\u6b22\u5217\u8868 userIds . addAll ( this . userLikeApi . queryLikeList ( userId )); //\u67e5\u8be2\u4e0d\u559c\u6b22\u5217\u8868 userIds . addAll ( this . userLikeApi . queryNotLikeList ( userId )); //\u6784\u9020\u67e5\u8be2\u6761\u4ef6 Criteria criteria = Criteria . where ( \"toUserId\" ). is ( userId ); if ( CollUtil . isNotEmpty ( userIds )){ //\u52a0\u5165\u5230\u67e5\u8be2\u6761\u4ef6\u4e2d\uff0c\u6392\u9664\u8fd9\u4e9b\u7528\u6237 criteria . andOperator ( Criteria . where ( \"userId\" ). nin ( userIds )); } Query query = Query . query ( criteria ). with ( pageRequest ); List < RecommendUser > recommendUserList = this . mongoTemplate . find ( query , RecommendUser . class ); return recommendUserList ; } 3.2.3\u3001\u5355\u5143\u6d4b\u8bd5 \u00b6 //com.tanhua.dubbo.server.api.TestRecommendUserApi @Test public void testQueryCardList (){ this . recommendUserApi . queryCardList ( 2L , 20 ) . forEach ( recommendUser -> System . out . println ( recommendUser )); } 3.3\u3001\u67e5\u8be2\u63a8\u8350\u5217\u8868APP\u63a5\u53e3\u5b9e\u73b0 \u00b6 \u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/593 3.3.1\u3001TanHuaController \u00b6 /** * \u63a2\u82b1 * * @return */ @GetMapping ( \"cards\" ) public ResponseEntity < List < TodayBest >> queryCardsList () { try { List < TodayBest > list = this . tanHuaService . queryCardsList (); return ResponseEntity . ok ( list ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 3.3.2\u3001TanHuaService \u00b6 #\u9ed8\u8ba4\u63a8\u8350\u5217\u8868 tanhua.default.recommend.users = 2,3,8,10,18,20,24,29,27,32,36,37,56,64,75,88 /** * \u67e5\u8be2\u63a8\u8350\u5361\u7247\u5217\u8868\uff0c\u4ece\u63a8\u8350\u5217\u8868\u4e2d\u968f\u673a\u9009\u53d610\u4e2a\u7528\u6237 * * @return */ public List < TodayBest > queryCardsList () { User user = UserThreadLocal . get (); int count = 50 ; //\u67e5\u8be2\u5230\u768450\u6761\u6570\u636e\uff0c\u5e76\u4e0d\u662f\u7528\u6765\u76f4\u63a5\u5c55\u73b0\uff0c\u9700\u8981\u4ece\u8fd950\u6761\u6570\u636e\u4e2d\u968f\u673a\u8fd4\u56de\u4e00\u4e9b\u6570\u636e List < RecommendUser > recommendUserList = this . recommendUserService . queryCardList ( user . getId (), count ); if ( CollUtil . isEmpty ( recommendUserList )) { recommendUserList = new ArrayList <> (); //\u9ed8\u8ba4\u63a8\u8350\u5217\u8868 List < String > list = StrUtil . split ( defaultRecommendUsers , ',' ); for ( String userId : list ) { RecommendUser recommendUser = new RecommendUser (); recommendUser . setToUserId ( user . getId ()); recommendUser . setUserId ( Convert . toLong ( userId )); recommendUserList . add ( recommendUser ); } } //\u8ba1\u7b97\u5c55\u73b0\u7684\u6570\u91cf\uff0c\u9ed8\u8ba4\u5c55\u73b010\u4e2a int showCount = Math . min ( 10 , recommendUserList . size ()); List < RecommendUser > result = new ArrayList <> (); for ( int i = 0 ; i < showCount ; i ++ ) { //TODO \u53ef\u80fd\u91cd\u590d int index = RandomUtil . randomInt ( 0 , recommendUserList . size ()); RecommendUser recommendUser = recommendUserList . get ( index ); result . add ( recommendUser ); } List < Object > userIdList = CollUtil . getFieldValues ( result , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIdList ); List < TodayBest > todayBests = new ArrayList <> (); for ( UserInfo userInfo : userInfoList ) { TodayBest todayBest = new TodayBest (); todayBest . setId ( userInfo . getUserId ()); todayBest . setAge ( userInfo . getAge ()); todayBest . setAvatar ( userInfo . getLogo ()); todayBest . setGender ( userInfo . getSex (). name (). toLowerCase ()); todayBest . setNickname ( userInfo . getNickName ()); todayBest . setTags ( Convert . toStrArray ( StrUtil . split ( userInfo . getTags (), ',' ))); todayBest . setFateValue ( 0 L ); todayBests . add ( todayBest ); } return todayBests ; } 3.3.3\u3001\u6d4b\u8bd5 \u00b6 \u6548\u679c\uff1a 3.4\u3001\u5de6\u6ed1\u53f3\u6ed1 \u00b6 \u5de6\u6ed1\uff1a\u201c\u4e0d\u559c\u6b22\u201d\uff0c\u53f3\u6ed1\uff1a\u201c\u559c\u6b22\u201d\uff0c\u5982\u679c\u53cc\u65b9\u559c\u6b22\uff0c\u90a3\u4e48\u5c31\u4f1a\u6210\u4e3a\u597d\u53cb\u3002 \u559c\u6b22\u7684\u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/599 \u4e0d\u559c\u6b22\u7684\u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/605 3.4.1\u3001TanHuaController \u00b6 /** * \u559c\u6b22 * * @param likeUserId * @return */ @GetMapping ( \"{id}/love\" ) public ResponseEntity < Void > likeUser ( @PathVariable ( \"id\" ) Long likeUserId ) { try { this . tanHuaService . likeUser ( likeUserId ); return ResponseEntity . ok ( null ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u4e0d\u559c\u6b22 * * @param likeUserId * @return */ @GetMapping ( \"{id}/unlove\" ) public ResponseEntity < Void > notLikeUser ( @PathVariable ( \"id\" ) Long likeUserId ) { try { this . tanHuaService . notLikeUser ( likeUserId ); return ResponseEntity . ok ( null ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 3.4.2\u3001TanHuaService \u00b6 //com.tanhua.server.service.TanHuaService public Boolean likeUser ( Long likeUserId ) { User user = UserThreadLocal . get (); Boolean result = this . userLikeApi . likeUser ( user . getId (), likeUserId ); if ( ! result ) { return false ; } if ( this . userLikeApi . isMutualLike ( user . getId (), likeUserId )) { //\u76f8\u4e92\u559c\u6b22\u6210\u4e3a\u597d\u53cb this . imService . contactUser ( likeUserId ); } return true ; } public Boolean notLikeUser ( Long likeUserId ) { User user = UserThreadLocal . get (); return this . userLikeApi . notLikeUser ( user . getId (), likeUserId ); } 3.4.3\u3001\u6d4b\u8bd5 \u00b6 user_like\u8868\uff0c\u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u76f8\u4e92\u559c\u6b22\u4e86\uff1a tanhua_users\u8868\uff0c\u53ef\u4ee5\u770b\u5230\u76f8\u4e92\u662f\u597d\u53cb\u4e86\uff1a \u73af\u4fe1\u5e73\u53f0\uff1a 4\u3001\u7528\u6237\u8d44\u6599 \u00b6 \u5728\u6211\u7684\u4e2d\u5fc3\u6a21\u5757\u4e2d\uff0c\u53ef\u4ee5\u5bf9\u4e2a\u4eba\u4fe1\u606f\u505a\u4fee\u6539\u3002 4.1\u3001\u57fa\u672c\u4fe1\u606f \u00b6 \u5728\u524d\u9762\u5b9e\u73b0\u7684\u67e5\u8be2\u4e2a\u4eba\u4fe1\u606f\u63a5\u53e3\u4e2d\uff0c\u5df2\u7ecf\u8fd4\u56de\u4e2a\u4eba\u57fa\u672c\u6570\u636e\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u5c55\u73b0\u51fa\u4e2a\u4eba\u4fe1\u606f\uff0c\u4e0b\u9762\u53ea\u9700\u8981\u8fdb\u884c\u5b9e\u73b0\u6570\u636e\u7684\u4fdd\u5b58\u5373\u53ef\u3002 4.4.1\u3001\u63a5\u53e3\u4fe1\u606f \u00b6 \u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/887 \u8bf7\u6c42\u53c2\u6570\uff1a \u00b6 4.4.2\u3001MyCenterController \u00b6 //com.tanhua.server.controller.MyCenterController /** * \u66f4\u65b0\u7528\u6237\u4fe1\u606f * * @param userInfoVo * @return */ @PutMapping public ResponseEntity < Void > updateUserInfo ( @RequestBody UserInfoVo userInfoVo ){ try { Boolean bool = this . myCenterService . updateUserInfo ( userInfoVo ); if ( bool ){ return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 4.4.3\u3001MyCenterService \u00b6 //com.tanhua.server.service.MyCenterService public Boolean updateUserInfo ( UserInfoVo userInfoVo ) { User user = UserThreadLocal . get (); UserInfo userInfo = new UserInfo (); userInfo . setUserId ( user . getId ()); userInfo . setAge ( Integer . valueOf ( userInfoVo . getAge ())); userInfo . setSex ( StringUtils . equalsIgnoreCase ( userInfoVo . getGender (), \"man\" ) ? SexEnum . MAN : SexEnum . WOMAN ); userInfo . setBirthday ( userInfoVo . getBirthday ()); userInfo . setCity ( userInfoVo . getCity ()); userInfo . setEdu ( userInfoVo . getEducation ()); userInfo . setIncome ( StringUtils . replaceAll ( userInfoVo . getIncome (), \"K\" , \"\" )); userInfo . setIndustry ( userInfoVo . getProfession ()); userInfo . setMarriage ( userInfoVo . getMarriage () == 1 ? \"\u5df2\u5a5a\" : \"\u672a\u5a5a\" ); return this . userInfoService . updateUserInfoByUserId ( userInfo ); } 4.4.4\u3001UserInfoService \u00b6 //com.tanhua.server.service.UserInfoService public boolean updateUserInfoByUserId ( UserInfo userInfo ) { QueryWrapper < UserInfo > queryWrapper = new QueryWrapper <> (); queryWrapper . eq ( \"user_id\" , userInfo . getUserId ()); return this . userInfoMapper . update ( userInfo , queryWrapper ) > 0 ; } 4.4.5\u3001bug\u4fee\u590d \u00b6 \u5728\u4e4b\u524d\u7684\u67e5\u8be2\u4e2a\u4eba\u4fe1\u606f\u4e2d\u63a5\u53e3\u4e2d\uff0c\u8fd4\u56de\u6570\u636e\u4e2d\u7684\u6027\u522b\u6570\u636e\u6709\u8bef\uff0c\u9700\u8981\u8fd4\u56deman\u6216woman\u3002 \u5982\u4e0b\uff1a //com.tanhua.server.service.MyCenterService public UserInfoVo queryUserInfoByUserId ( Long userId ) { if ( ObjectUtil . isEmpty ( userId )) { //\u5982\u679c\u67e5\u8be2id\u4e3anull\uff0c\u5c31\u8868\u793a\u67e5\u8be2\u5f53\u524d\u7528\u6237\u4fe1\u606f userId = UserThreadLocal . get (). getId (); } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f UserInfo userInfo = this . userInfoService . queryUserInfoByUserId ( userId ); if ( ObjectUtil . isEmpty ( userInfo )) { return null ; } UserInfoVo userInfoVo = BeanUtil . copyProperties ( userInfo , UserInfoVo . class , \"marriage\" ); userInfoVo . setGender ( userInfo . getSex (). getValue () == 1 ? \"man\" : \"women\" ); userInfoVo . setMarriage ( StrUtil . equals ( \"\u5df2\u5a5a\" , userInfo . getMarriage ()) ? 1 : 0 ); return userInfoVo ; } 4.2\u3001\u66f4\u65b0\u5934\u50cf \u00b6 \u4e0a\u4f20\u5934\u50cf\u4f7f\u7528sso\u4e2d\u7684\u4e0a\u4f20\u903b\u8f91\u5373\u53ef\uff0c\u53ea\u662f\u8def\u5f84\u4e0d\u540c\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u4fee\u6539nginx\u914d\u7f6e\u548c\u5728sso\u4e2d\u5b9a\u4e49Controller\u5373\u53ef\u3002 \u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/881 #user nobody; worker_processes 1 ; #error_log logs/error.log; #error_log logs/error.log notice; #error_log logs/error.log info; #pid logs/nginx.pid; events { worker_connections 1024 ; } http { include mime.types ; default_type application/octet-stream ; #log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' # '$status $body_bytes_sent \"$http_referer\" ' # '\"$http_user_agent\" \"$http_x_forwarded_for\"'; #access_log logs/access.log main; sendfile on ; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65 ; #gzip on; server { listen 80 ; server_name localhost ; #charset koi8-r; #access_log logs/host.access.log main; #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html ; location = /50x.html { root html ; } location /user/ { #\u8bf7\u6c42\u8def\u5f84\u4e2d\u51e1\u662f\u4ee5/user/\u5f00\u5934\u7684\u8bf7\u6c42\uff0c\u8f6c\u53d1\u5230sso\u7cfb\u7edf client_max_body_size 300m ; #\u8bbe\u7f6e\u6700\u5927\u7684\u8bf7\u6c42\u4f53\u5927\u5c0f\uff0c\u89e3\u51b3\u5927\u6587\u4ef6\u4e0a\u4f20\u4e0d\u4e86\u7684\u95ee\u9898 proxy_connect_timeout 300s ; #\u4ee3\u7406\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4 proxy_send_timeout 300s ; #\u4ee3\u7406\u53d1\u9001\u6570\u636e\u7684\u8d85\u65f6\u65f6\u95f4 proxy_read_timeout 300s ; #\u4ee3\u7406\u8bfb\u53d6\u6570\u636e\u7684\u8d85\u65f6\u65f6\u95f4 proxy_pass http://127.0.0.1:18080 ; #\u8f6c\u53d1\u8bf7\u6c42 } location /users/header { #\u8bf7\u6c42\u8def\u5f84\u4e2d\u51e1\u662f\u4ee5/user/header\u5f00\u5934\u7684\u8bf7\u6c42\uff0c\u8f6c\u53d1\u5230sso\u7cfb\u7edf client_max_body_size 300m ; #\u8bbe\u7f6e\u6700\u5927\u7684\u8bf7\u6c42\u4f53\u5927\u5c0f\uff0c\u89e3\u51b3\u5927\u6587\u4ef6\u4e0a\u4f20\u4e0d\u4e86\u7684\u95ee\u9898 proxy_connect_timeout 300s ; #\u4ee3\u7406\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4 proxy_send_timeout 300s ; #\u4ee3\u7406\u53d1\u9001\u6570\u636e\u7684\u8d85\u65f6\u65f6\u95f4 proxy_read_timeout 300s ; #\u4ee3\u7406\u8bfb\u53d6\u6570\u636e\u7684\u8d85\u65f6\u65f6\u95f4 proxy_pass http://127.0.0.1:18080 ; #\u8f6c\u53d1\u8bf7\u6c42 } location / { #\u4e0a\u9762\u672a\u5339\u914d\u5230\u7684\u5728\u8fd9\u91cc\u5904\u7406 client_max_body_size 300m ; proxy_connect_timeout 300s ; proxy_send_timeout 300s ; proxy_read_timeout 300s ; proxy_pass http://127.0.0.1:18081 ; #\u8f6c\u53d1\u8bf7\u6c42\u5230server\u7cfb\u7edf } } } 4.2.2\u3001MyCenterController \u00b6 \u5728sso\u5de5\u7a0b\u4e2d\u5b9a\u4e49MyCenterController\u3002 package com.tanhua.sso.controller ; import com.tanhua.sso.vo.ErrorResult ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.* ; import org.springframework.web.multipart.MultipartFile ; @RestController @RequestMapping ( \"users\" ) public class MyCenterController { @Autowired private UserInfoController userInfoController ; /** * \u4e0a\u4f20\u5934\u50cf * * @param file * @param token * @return */ @PostMapping ( \"header\" ) public ResponseEntity < Object > saveLogo ( @RequestParam ( \"headPhoto\" ) MultipartFile file , @RequestHeader ( \"Authorization\" ) String token ) { return this . userInfoController . saveUserLogo ( file , token ); } }","title":"day08"},{"location":"tantan/day08/#_1","text":"\u4e0a\u62a5\u5730\u4f4d\u4f4d\u7f6e \u5b9e\u73b0\u641c\u9644\u8fd1\u529f\u80fd \u5b9e\u73b0\u63a2\u82b1\u529f\u80fd \u7528\u6237\u57fa\u672c\u4fe1\u606f\u7ef4\u62a4","title":"\u8bfe\u7a0b\u8bf4\u660e"},{"location":"tantan/day08/#1","text":"\u5f53\u5ba2\u6237\u7aef\u68c0\u6d4b\u7528\u6237\u7684\u5730\u7406\u4f4d\u7f6e\uff0c\u5f53\u53d8\u5316\u5927\u4e8e500\u7c73\u65f6\u6216\u6bcf\u96945\u5206\u949f\uff0c\u5411\u670d\u52a1\u7aef\u4e0a\u62a5\u5730\u7406\u4f4d\u7f6e\u3002 \u7528\u6237\u7684\u5730\u7406\u4f4d\u7f6e\u5b58\u50a8\u5230Elasticsearch\u4e2d\uff0c\u9700\u8981\u4f7f\u7528\u73af\u5883\u63d0\u4f9b\u7684ES\u96c6\u7fa4\uff0c\u5982\u4e0b\uff1a","title":"1\u3001\u4e0a\u62a5\u5730\u7406\u4f4d\u7f6e"},{"location":"tantan/day08/#11dubbo","text":"\u7528\u6237\u5730\u7406\u4f4d\u7f6e\u7684\u670d\u52a1\u72ec\u7acb\u4e00\u4e2a\u65b0\u7684\u5de5\u7a0b\u6765\u5b9e\u73b0\uff0c\u540d\u5b57\u4e3a\uff1amy-tanhua-dubbo-es\u3002","title":"1.1\u3001dubbo\u670d\u52a1"},{"location":"tantan/day08/#111","text":"pom.ml\u6587\u4ef6\u5982\u4e0b\uff1a <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <parent> <artifactId> my-tanhua-dubbo </artifactId> <groupId> cn.itcast.tanhua </groupId> <version> 1.0-SNAPSHOT </version> </parent> <modelVersion> 4.0.0 </modelVersion> <artifactId> my-tanhua-dubbo-es </artifactId> <dependencies> <!--\u5f15\u5165interface\u4f9d\u8d56--> <dependency> <groupId> cn.itcast.tanhua </groupId> <artifactId> my-tanhua-dubbo-interface </artifactId> <version> 1.0-SNAPSHOT </version> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-test </artifactId> <scope> test </scope> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-elasticsearch </artifactId> </dependency> <!--dubbo\u7684springboot\u652f\u6301--> <dependency> <groupId> com.alibaba.boot </groupId> <artifactId> dubbo-spring-boot-starter </artifactId> </dependency> <!--dubbo\u6846\u67b6--> <dependency> <groupId> com.alibaba </groupId> <artifactId> dubbo </artifactId> </dependency> <!--zk\u4f9d\u8d56--> <dependency> <groupId> org.apache.zookeeper </groupId> <artifactId> zookeeper </artifactId> </dependency> <dependency> <groupId> com.github.sgroschupf </groupId> <artifactId> zkclient </artifactId> </dependency> <dependency> <groupId> io.netty </groupId> <artifactId> netty-all </artifactId> </dependency> <dependency> <groupId> cn.hutool </groupId> <artifactId> hutool-all </artifactId> </dependency> </dependencies> </project> application.properties\u6587\u4ef6\uff1a # Spring boot application spring.application.name = itcast-tanhua-dubbo-es # dubbo \u626b\u63cf\u5305\u914d\u7f6e dubbo.scan.basePackages = com.tanhua.dubbo.es dubbo.application.name = dubbo-provider-es #dubbo \u5bf9\u5916\u66b4\u9732\u7684\u7aef\u53e3\u4fe1\u606f dubbo.protocol.name = dubbo dubbo.protocol.port = 20882 #dubbo\u6ce8\u518c\u4e2d\u5fc3\u7684\u914d\u7f6e dubbo.registry.address = zookeeper://192.168.31.81:2181 dubbo.registry.client = zkclient dubbo.registry.timeout = 60000 #ES\u96c6\u7fa4\u914d\u7f6e spring.data.elasticsearch.cluster-name = es-tanhua-cluster spring.data.elasticsearch.cluster-nodes = 192.168.31.81:9300,192.168.31.81:9301,192.168.31.81:9302 \u542f\u52a8\u7c7b\uff1a package com.tanhua.dubbo.es ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; import org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration ; import org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration ; @SpringBootApplication ( exclude = { MongoAutoConfiguration . class , MongoDataAutoConfiguration . class }) //\u6392\u9664mongo\u7684\u81ea\u52a8\u914d\u7f6e public class ESApplication { public static void main ( String [] args ) { SpringApplication . run ( ESApplication . class , args ); } }","title":"1.1.1\u3001\u521b\u5efa\u5de5\u7a0b"},{"location":"tantan/day08/#112pojo","text":"\u5728my-tanhua-dubbo-interface\u4e2d\u521b\u5efa\uff1a package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.elasticsearch.common.geo.GeoPoint ; import org.springframework.data.annotation.Id ; import org.springframework.data.elasticsearch.annotations.Document ; import org.springframework.data.elasticsearch.annotations.Field ; import org.springframework.data.elasticsearch.annotations.FieldType ; import org.springframework.data.elasticsearch.annotations.GeoPointField ; @Data @NoArgsConstructor @AllArgsConstructor @Document ( indexName = \"tanhua\" , type = \"user_location\" , shards = 6 , replicas = 2 ) public class UserLocation { @Id private Long userId ; //\u7528\u6237id @GeoPointField private GeoPoint location ; //lon:\u7ecf\u5ea6 lat:\u7eac\u5ea6 @Field ( type = FieldType . Keyword ) private String address ; //\u4f4d\u7f6e\u63cf\u8ff0 @Field ( type = FieldType . Long ) private Long created ; //\u521b\u5efa\u65f6\u95f4 @Field ( type = FieldType . Long ) private Long updated ; //\u66f4\u65b0\u65f6\u95f4 @Field ( type = FieldType . Long ) private Long lastUpdated ; //\u4e0a\u6b21\u66f4\u65b0\u65f6\u95f4 } package com.tanhua.dubbo.server.vo ; import cn.hutool.core.bean.BeanUtil ; import com.tanhua.dubbo.server.pojo.UserLocation ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import java.util.ArrayList ; import java.util.List ; @Data @NoArgsConstructor @AllArgsConstructor public class UserLocationVo implements java . io . Serializable { private static final long serialVersionUID = 4133419501260037769L ; private Long userId ; //\u7528\u6237id private Double longitude ; //\u7ecf\u5ea6 private Double latitude ; //\u7ef4\u5ea6 private String address ; //\u4f4d\u7f6e\u63cf\u8ff0 private Long created ; //\u521b\u5efa\u65f6\u95f4 private Long updated ; //\u66f4\u65b0\u65f6\u95f4 private Long lastUpdated ; //\u4e0a\u6b21\u66f4\u65b0\u65f6\u95f4 public static final UserLocationVo format ( UserLocation userLocation ) { UserLocationVo userLocationVo = BeanUtil . toBean ( userLocation , UserLocationVo . class ); userLocationVo . setLongitude ( userLocation . getLocation (). getLon ()); userLocationVo . setLatitude ( userLocation . getLocation (). getLat ()); return userLocationVo ; } public static final List < UserLocationVo > formatToList ( List < UserLocation > userLocations ) { List < UserLocationVo > list = new ArrayList <> (); for ( UserLocation userLocation : userLocations ) { list . add ( format ( userLocation )); } return list ; } } \u7531\u4e8eUserLocation\u4e0d\u80fd\u5e8f\u5217\u5316\uff0c\u6240\u4ee5\u8981\u518d\u5b9a\u4e49UserLocationVo\u8fdb\u884c\u8fd4\u56de\u6570\u636e\u3002 \u5728my-tanhua-dubbo-interface\u4e2d\u6dfb\u52a0\u4f9d\u8d56\uff1a <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-elasticsearch </artifactId> </dependency> <dependency> <groupId> cn.hutool </groupId> <artifactId> hutool-all </artifactId> </dependency>","title":"1.1.2\u3001\u5b9a\u4e49pojo"},{"location":"tantan/day08/#113dubbo","text":"\u5728my-tanhua-dubbo-interface\u5de5\u7a0b\u4e2d\u3002 package com.tanhua.dubbo.server.api ; public interface UserLocationApi { /** * \u66f4\u65b0\u7528\u6237\u5730\u7406\u4f4d\u7f6e * * @param userId \u7528\u6237id * @param longitude \u7ecf\u5ea6 * @param latitude \u7eac\u5ea6 * @param address \u5730\u5740\u540d\u79f0 * @return */ Boolean updateUserLocation ( Long userId , Double longitude , Double latitude , String address ); }","title":"1.1.3\u3001\u5b9a\u4e49dubbo\u63a5\u53e3"},{"location":"tantan/day08/#114","text":"package com.tanhua.dubbo.es.api ; import cn.hutool.core.util.ObjectUtil ; import com.alibaba.dubbo.config.annotation.Service ; import com.tanhua.dubbo.server.api.UserLocationApi ; import com.tanhua.dubbo.server.pojo.UserLocation ; import lombok.extern.slf4j.Slf4j ; import org.elasticsearch.action.update.UpdateRequest ; import org.elasticsearch.common.geo.GeoPoint ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.elasticsearch.core.ElasticsearchTemplate ; import org.springframework.data.elasticsearch.core.query.* ; import javax.annotation.PostConstruct ; import java.util.HashMap ; import java.util.Map ; @Service ( version = \"1.0.0\" ) @Slf4j public class UserLocationApiImpl implements UserLocationApi { @Autowired private ElasticsearchTemplate elasticsearchTemplate ; /** * \u521d\u59cb\u5316\u7d22\u5f15\u5e93 * */ @PostConstruct public void initIndex (){ //\u5224\u65ad\u7d22\u5f15\u5e93\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u9700\u8981\u521b\u5efa if ( ! this . elasticsearchTemplate . indexExists ( \"tanhua\" )){ this . elasticsearchTemplate . createIndex ( UserLocation . class ); } //\u5224\u65ad\u8868\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u9700\u8981\u521b\u5efa if ( ! this . elasticsearchTemplate . typeExists ( \"tanhua\" , \"user_location\" )){ this . elasticsearchTemplate . putMapping ( UserLocation . class ); } } @Override public Boolean updateUserLocation ( Long userId , Double longitude , Double latitude , String address ) { //\u67e5\u8be2\u4e2a\u4eba\u7684\u5730\u7406\u4f4d\u7f6e\u6570\u636e\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u9700\u8981\u65b0\u589e\uff0c\u5982\u679c\u662f\u5b58\u5728\u6570\u636e\uff0c\u66f4\u65b0\u6570\u636e try { GetQuery getQuery = new GetQuery (); getQuery . setId ( String . valueOf ( userId )); UserLocation userLocation = this . elasticsearchTemplate . queryForObject ( getQuery , UserLocation . class ); if ( ObjectUtil . isEmpty ( userLocation )){ //\u65b0\u589e\u6570\u636e userLocation = new UserLocation (); userLocation . setUserId ( userId ); userLocation . setAddress ( address ); userLocation . setCreated ( System . currentTimeMillis ()); userLocation . setUpdated ( userLocation . getCreated ()); userLocation . setLastUpdated ( userLocation . getCreated ()); userLocation . setLocation ( new GeoPoint ( latitude , longitude )); IndexQuery indexQuery = new IndexQueryBuilder (). withObject ( userLocation ). build (); //\u4fdd\u5b58\u6570\u636e\u5230ES\u4e2d this . elasticsearchTemplate . index ( indexQuery ); } else { //\u66f4\u65b0\u6570\u636e //\u66f4\u65b0\u7684\u5b57\u6bb5 Map < String , Object > map = new HashMap <> (); map . put ( \"location\" , new GeoPoint ( latitude , longitude )); map . put ( \"updated\" , System . currentTimeMillis ()); map . put ( \"lastUpdated\" , userLocation . getUpdated ()); map . put ( \"address\" , address ); UpdateRequest updateRequest = new UpdateRequest (); updateRequest . doc ( map ); UpdateQuery updateQuery = new UpdateQueryBuilder () . withId ( String . valueOf ( userId )) . withClass ( UserLocation . class ) . withUpdateRequest ( updateRequest ). build (); //\u66f4\u65b0\u6570\u636e this . elasticsearchTemplate . update ( updateQuery ); } return true ; } catch ( Exception e ) { log . error ( \"\u66f4\u65b0\u5730\u7406\u4f4d\u7f6e\u5931\u8d25~ userId = \" + userId + \", longitude = \" + longitude + \", latitude = \" + latitude + \", address = \" + address , e ); } return false ; } }","title":"1.1.4\u3001\u7f16\u5199\u5b9e\u73b0"},{"location":"tantan/day08/#115","text":"package com.tanhua.dubbo.es ; import com.tanhua.dubbo.server.api.UserLocationApi ; import com.tanhua.dubbo.server.vo.PageInfo ; import com.tanhua.dubbo.server.vo.UserLocationVo ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestUserLocationApi { @Autowired private UserLocationApi userLocationApi ; @Test public void testUpdateUserLocation () { this . userLocationApi . updateUserLocation ( 1L , 121.512253 , 31.24094 , \"\u91d1\u8302\u5927\u53a6\" ); this . userLocationApi . updateUserLocation ( 2L , 121.506377 , 31.245105 , \"\u4e1c\u65b9\u660e\u73e0\u5e7f\u64ad\u7535\u89c6\u5854\" ); this . userLocationApi . updateUserLocation ( 10L , 121.508815 , 31.243844 , \"\u9646\u5bb6\u5634\u5730\u94c1\u7ad9\" ); this . userLocationApi . updateUserLocation ( 12L , 121.511999 , 31.239185 , \"\u4e0a\u6d77\u4e2d\u5fc3\u5927\u53a6\" ); this . userLocationApi . updateUserLocation ( 25L , 121.493444 , 31.240513 , \"\u4e0a\u6d77\u5e02\u516c\u5b89\u5c40\" ); this . userLocationApi . updateUserLocation ( 27L , 121.494108 , 31.247011 , \"\u4e0a\u6d77\u5916\u6ee9\u7f8e\u672f\u9986\" ); this . userLocationApi . updateUserLocation ( 30L , 121.462452 , 31.253463 , \"\u4e0a\u6d77\u706b\u8f66\u7ad9\" ); this . userLocationApi . updateUserLocation ( 32L , 121.81509 , 31.157478 , \"\u4e0a\u6d77\u6d66\u4e1c\u56fd\u9645\u673a\u573a\" ); this . userLocationApi . updateUserLocation ( 34L , 121.327908 , 31.20033 , \"\u8679\u6865\u706b\u8f66\u7ad9\" ); this . userLocationApi . updateUserLocation ( 38L , 121.490155 , 31.277476 , \"\u9c81\u8fc5\u516c\u56ed\" ); this . userLocationApi . updateUserLocation ( 40L , 121.425511 , 31.227831 , \"\u4e2d\u5c71\u516c\u56ed\" ); this . userLocationApi . updateUserLocation ( 43L , 121.594194 , 31.207786 , \"\u5f20\u6c5f\u9ad8\u79d1\" ); } }","title":"1.1.5\u3001\u5355\u5143\u6d4b\u8bd5"},{"location":"tantan/day08/#12app","text":"\u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/557","title":"1.2\u3001APP\u63a5\u53e3"},{"location":"tantan/day08/#121baiducontroller","text":"package com.tanhua.server.controller ; import com.tanhua.server.service.BaiduService ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.PostMapping ; import org.springframework.web.bind.annotation.RequestBody ; import org.springframework.web.bind.annotation.RequestMapping ; import org.springframework.web.bind.annotation.RestController ; import java.util.Map ; @RestController @RequestMapping ( \"baidu\" ) public class BaiduController { @Autowired private BaiduService baiduService ; /** * \u66f4\u65b0\u4f4d\u7f6e * * @param param * @return */ @PostMapping ( \"location\" ) public ResponseEntity < Void > updateLocation ( @RequestBody Map < String , Object > param ) { try { Double longitude = Double . valueOf ( param . get ( \"longitude\" ). toString ()); Double latitude = Double . valueOf ( param . get ( \"latitude\" ). toString ()); String address = param . get ( \"addrStr\" ). toString (); Boolean bool = this . baiduService . updateLocation ( longitude , latitude , address ); if ( bool ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } }","title":"1.2.1\u3001BaiduController"},{"location":"tantan/day08/#122baiduservice","text":"package com.tanhua.server.service ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.common.pojo.User ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.dubbo.server.api.UserLocationApi ; import lombok.extern.slf4j.Slf4j ; import org.springframework.stereotype.Service ; @Service @Slf4j public class BaiduService { @Reference ( version = \"1.0.0\" ) private UserLocationApi userLocationApi ; public Boolean updateLocation ( Double longitude , Double latitude , String address ) { User user = UserThreadLocal . get (); try { return this . userLocationApi . updateUserLocation ( user . getId (), longitude , latitude , address ); } catch ( Exception e ) { log . error ( \"\u66f4\u65b0\u5730\u7406\u4f4d\u7f6e\u5931\u8d25~ userId = \" + user . getId () + \", longitude = \" + longitude + \", latitude = \" + latitude + \", address = \" + address , e ); } return false ; } }","title":"1.2.2\u3001BaiduService"},{"location":"tantan/day08/#13","text":"","title":"1.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day08/#2","text":"\u5728\u9996\u9875\u4e2d\u70b9\u51fb\u201c\u641c\u9644\u8fd1\u201d\u53ef\u4ee5\u641c\u7d22\u9644\u8fd1\u7684\u597d\u53cb\uff0c\u6548\u679c\u5982\u4e0b\uff1a \u5b9e\u73b0\u601d\u8def\uff1a\u6839\u636e\u5f53\u524d\u7528\u6237\u7684\u4f4d\u7f6e\uff0c\u67e5\u8be2\u9644\u8fd1\u8303\u56f4\u5185\u7684\u7528\u6237\u3002\u8303\u56f4\u662f\u53ef\u4ee5\u8bbe\u7f6e\u7684\u3002","title":"2\u3001\u641c\u9644\u8fd1"},{"location":"tantan/day08/#21dubbo","text":"","title":"2.1\u3001dubbo\u670d\u52a1"},{"location":"tantan/day08/#211","text":"//com.tanhua.dubbo.server.api.UserLocationApi /** * \u67e5\u8be2\u7528\u6237\u5730\u7406\u4f4d\u7f6e * * @param userId * @return */ UserLocationVo queryByUserId ( Long userId ); /** * \u6839\u636e\u4f4d\u7f6e\u641c\u7d22 * * @param longitude \u7ecf\u5ea6 * @param latitude \u7eac\u5ea6 * @param distance \u8ddd\u79bb(\u7c73) * @param page \u9875\u6570 * @param pageSize \u9875\u9762\u5927\u5c0f */ PageInfo < UserLocationVo > queryUserFromLocation ( Double longitude , Double latitude , Double distance , Integer page , Integer pageSize );","title":"2.1.1\u3001\u5b9a\u4e49\u63a5\u53e3\u65b9\u6cd5"},{"location":"tantan/day08/#212","text":"//com.tanhua.dubbo.es.api.UserLocationApiImpl /** * \u67e5\u8be2\u7528\u6237\u7684\u4f4d\u7f6e\u4fe1\u606f * * @param userId * @return */ @Override public UserLocationVo queryByUserId ( Long userId ) { GetQuery getQuery = new GetQuery (); getQuery . setId ( String . valueOf ( userId )); UserLocation userLocation = this . elasticsearchTemplate . queryForObject ( getQuery , UserLocation . class ); if ( ObjectUtil . isNotEmpty ( userLocation )){ return UserLocationVo . format ( userLocation ); } return null ; } /** * \u6839\u636e\u4f4d\u7f6e\u641c\u7d22 * * @param longitude \u7ecf\u5ea6 * @param latitude \u7eac\u5ea6 * @param distance \u8ddd\u79bb(\u7c73) * @param page \u9875\u6570 * @param pageSize \u9875\u9762\u5927\u5c0f */ @Override public PageInfo < UserLocationVo > queryUserFromLocation ( Double longitude , Double latitude , Double distance , Integer page , Integer pageSize ) { PageInfo < UserLocationVo > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); String fieldName = \"location\" ; //\u5b9e\u73b0\u4e86SearchQuery\u63a5\u53e3\uff0c\u6784\u9020\u5206\u9875\u3001\u6392\u5e8f NativeSearchQueryBuilder searchQueryBuilder = new NativeSearchQueryBuilder (); //\u5206\u9875 PageRequest pageRequest = PageRequest . of ( page - 1 , pageSize ); searchQueryBuilder . withPageable ( pageRequest ); BoolQueryBuilder boolQueryBuilder = new BoolQueryBuilder (); //\u4ee5\u4e00\u4e2a\u70b9\u4e3a\u4e2d\u5fc3\uff0c\u6307\u5b9a\u8303\u56f4\u67e5\u8be2 GeoDistanceQueryBuilder geoDistanceQueryBuilder = new GeoDistanceQueryBuilder ( fieldName ); //\u4e2d\u5fc3\u70b9 geoDistanceQueryBuilder . point ( new GeoPoint ( latitude , longitude )); //\u8ddd\u79bb\uff08\u753b\u5706\u7684\u534a\u5f84\uff09\u5355\u4f4d\uff1a\u516c\u91cc geoDistanceQueryBuilder . distance ( distance / 1000 , DistanceUnit . KILOMETERS ); boolQueryBuilder . must ( geoDistanceQueryBuilder ); searchQueryBuilder . withQuery ( boolQueryBuilder ); //\u6392\u5e8f\uff0c\u7531\u8fd1\u5230\u8fdc\u6392\u5e8f GeoDistanceSortBuilder geoDistanceSortBuilder = new GeoDistanceSortBuilder ( fieldName , latitude , longitude ); geoDistanceSortBuilder . order ( SortOrder . ASC ); //\u6b63\u5e8f\u6392\u5e8f geoDistanceSortBuilder . unit ( DistanceUnit . KILOMETERS ); //\u8bbe\u7f6e\u5355\u4f4d searchQueryBuilder . withSort ( geoDistanceSortBuilder ); AggregatedPage < UserLocation > aggregatedPage = this . elasticsearchTemplate . queryForPage ( searchQueryBuilder . build (), UserLocation . class ); if ( CollUtil . isEmpty ( aggregatedPage . getContent ())){ return pageInfo ; } pageInfo . setRecords ( UserLocationVo . formatToList ( aggregatedPage . getContent ())); return pageInfo ; }","title":"2.1.2\u3001\u7f16\u5199\u5b9e\u73b0"},{"location":"tantan/day08/#213","text":"//com.tanhua.dubbo.es.TestUserLocationApi @Test public void testQueryByUserId (){ UserLocationVo userLocationVo = this . userLocationApi . queryByUserId ( 1L ); System . out . println ( userLocationVo ); } @Test public void testQueryUserFromLocation (){ UserLocationVo userLocationVo = this . userLocationApi . queryByUserId ( 1L ); PageInfo < UserLocationVo > pageInfo = this . userLocationApi . queryUserFromLocation ( userLocationVo . getLongitude (), userLocationVo . getLatitude (), 5000 d , 1 , 10 ); pageInfo . getRecords (). forEach ( vo -> System . out . println ( vo )); }","title":"2.1.3\u3001\u5355\u5143\u6d4b\u8bd5"},{"location":"tantan/day08/#22app","text":"\u6587\u6863\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/611","title":"2.2\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day08/#221nearuservo","text":"package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class NearUserVo { private Long userId ; private String avatar ; private String nickname ; }","title":"2.2.1\u3001NearUserVo"},{"location":"tantan/day08/#222tanhuacontroller","text":"//com.tanhua.server.controller.TanHuaController /** * \u641c\u9644\u8fd1 * * @param gender * @param distance * @return */ @GetMapping ( \"search\" ) public ResponseEntity < List < NearUserVo >> queryNearUser ( @RequestParam ( value = \"gender\" , required = false ) String gender , @RequestParam ( value = \"distance\" , defaultValue = \"2000\" ) String distance ) { try { List < NearUserVo > list = this . tanHuaService . queryNearUser ( gender , distance ); return ResponseEntity . ok ( list ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"2.2.2\u3001TanHuaController"},{"location":"tantan/day08/#223tanhuaservice","text":"//com.tanhua.server.service.TanHuaService public List < NearUserVo > queryNearUser ( String gender , String distance ) { //\u67e5\u8be2\u5f53\u524d\u7528\u6237\u7684\u4f4d\u7f6e User user = UserThreadLocal . get (); UserLocationVo userLocationVo = this . userLocationApi . queryByUserId ( user . getId ()); if ( ObjectUtil . isEmpty ( userLocationVo )){ return ListUtil . empty (); } PageInfo < UserLocationVo > pageInfo = this . userLocationApi . queryUserFromLocation ( userLocationVo . getLongitude (), userLocationVo . getLatitude (), Convert . toDouble ( distance ), 1 , 50 ); List < UserLocationVo > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )){ return ListUtil . empty (); } //\u6784\u9020\u7b5b\u9009\u6761\u4ef6 List < Object > userIdList = CollUtil . getFieldValues ( records , \"userId\" ); QueryWrapper < UserInfo > queryWrapper = new QueryWrapper <> (); queryWrapper . in ( \"user_id\" , userIdList ); if ( StrUtil . equalsIgnoreCase ( gender , \"man\" )){ queryWrapper . eq ( \"sex\" , SexEnum . MAN ); } else if ( StrUtil . equalsIgnoreCase ( gender , \"woman\" )){ queryWrapper . eq ( \"sex\" , SexEnum . WOMAN ); } List < UserInfo > userInfoList = this . userInfoService . queryUserInfoList ( queryWrapper ); List < NearUserVo > result = new ArrayList <> (); for ( UserLocationVo locationVo : records ) { //\u6392\u9664\u81ea\u5df1 if ( ObjectUtil . equals ( locationVo . getUserId (), user . getId ())){ continue ; } for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( locationVo . getUserId (), userInfo . getUserId ())){ NearUserVo nearUserVo = new NearUserVo (); nearUserVo . setUserId ( userInfo . getUserId ()); nearUserVo . setAvatar ( userInfo . getLogo ()); nearUserVo . setNickname ( userInfo . getNickName ()); result . add ( nearUserVo ); break ; } } } return result ; }","title":"2.2.3\u3001TanHuaService"},{"location":"tantan/day08/#224","text":"","title":"2.2.4\u3001\u6d4b\u8bd5"},{"location":"tantan/day08/#3","text":"\u63a2\u82b1\u529f\u80fd\u662f\u5c06\u63a8\u8350\u7684\u597d\u53cb\u968f\u673a\u7684\u901a\u8fc7\u5361\u7247\u7684\u5f62\u5f0f\u5c55\u73b0\u51fa\u6765\uff0c\u7528\u6237\u53ef\u4ee5\u9009\u62e9\u5de6\u6ed1\u3001\u53f3\u6ed1\u64cd\u4f5c\uff0c\u5de6\u6ed1\uff1a\u201c\u4e0d\u559c\u6b22\u201d\uff0c\u53f3\u6ed1\uff1a\u201c\u559c\u6b22\u201d\u3002 \u559c\u6b22\uff1a\u5982\u679c\u53cc\u65b9\u559c\u6b22\uff0c\u90a3\u4e48\u5c31\u4f1a\u6210\u4e3a\u597d\u53cb\u3002 \u5982\u679c\u5df2\u7ecf\u559c\u6b22\u6216\u4e0d\u559c\u6b22\u7684\u7528\u6237\u5728\u5217\u8868\u4e2d\u4e0d\u518d\u663e\u793a\u3002","title":"3\u3001\u63a2\u82b1"},{"location":"tantan/day08/#31dubbo","text":"\u7528\u6237\u7684\u559c\u6b22\u4e0e\u4e0d\u559c\u6b22\u5217\u8868\u9700\u8981\u4fdd\u5b58\u5728redis\u4e2d\uff0c\u4e3a\u4e86\u9632\u6b62redis\u4e2d\u7684\u6570\u636e\u4e22\u5931\uff0c\u540c\u65f6\u9700\u8981\u5c06\u6570\u636e\u4fdd\u5b58\u5230mongodb\u8fdb\u884c\u6301\u4e45\u5316\u4fdd\u5b58\u3002","title":"3.1\u3001\u559c\u6b22\u7684dubbo\u670d\u52a1"},{"location":"tantan/day08/#311","text":"package com.tanhua.dubbo.server.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.mongodb.core.index.Indexed ; import org.springframework.data.mongodb.core.mapping.Document ; @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"user_like\" ) public class UserLike implements java . io . Serializable { private static final long serialVersionUID = 6739966698394686523L ; private ObjectId id ; @Indexed private Long userId ; //\u7528\u6237id\uff0c\u81ea\u5df1 @Indexed private Long likeUserId ; //\u559c\u6b22\u7684\u7528\u6237id\uff0c\u5bf9\u65b9 private Long created ; //\u521b\u5efa\u65f6\u95f4 }","title":"3.1.1\u3001\u5b9e\u4f53\u5bf9\u8c61"},{"location":"tantan/day08/#312","text":"package com.tanhua.dubbo.server.api ; import java.util.List ; public interface UserLikeApi { /** * \u559c\u6b22 * * @param userId * @param likeUserId * @return */ Boolean likeUser ( Long userId , Long likeUserId ); /** * \u4e0d\u559c\u6b22 * * @param userId * @param likeUserId * @return */ Boolean notLikeUser ( Long userId , Long likeUserId ); /** * \u662f\u5426\u76f8\u4e92\u559c\u6b22 * * @param userId * @param likeUserId * @return */ Boolean isMutualLike ( Long userId , Long likeUserId ); /** * \u67e5\u8be2\u559c\u6b22\u5217\u8868 * * @param userId * @return */ List < Long > queryLikeList ( Long userId ); /** * \u67e5\u8be2\u4e0d\u559c\u6b22\u5217\u8868 * * @param userId * @return */ List < Long > queryNotLikeList ( Long userId ); }","title":"3.1.2\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day08/#313","text":"package com.tanhua.dubbo.server.api ; import cn.hutool.core.collection.CollUtil ; import cn.hutool.core.collection.ListUtil ; import cn.hutool.core.convert.Convert ; import com.alibaba.dubbo.config.annotation.Service ; import com.tanhua.dubbo.server.pojo.UserLike ; import org.bson.types.ObjectId ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.data.mongodb.core.query.Criteria ; import org.springframework.data.mongodb.core.query.Query ; import org.springframework.data.redis.core.RedisTemplate ; import java.util.ArrayList ; import java.util.List ; import java.util.Set ; @Service ( version = \"1.0.0\" ) public class UserLikeApiImpl implements UserLikeApi { @Autowired private MongoTemplate mongoTemplate ; @Autowired private RedisTemplate < String , String > redisTemplate ; public static final String LIKE_REDIS_KEY_PREFIX = \"USER_LIKE_\" ; public static final String NOT_LIKE_REDIS_KEY_PREFIX = \"USER_NOT_LIKE_\" ; /** * \u559c\u6b22 * * @param userId * @param likeUserId * @return */ @Override public Boolean likeUser ( Long userId , Long likeUserId ) { //\u5224\u65ad\u8be5\u7528\u6237\u662f\u5426\u5df2\u7ecf\u559c\u6b22\uff0c\u5982\u679c\u5df2\u7ecf\u559c\u6b22\u5c31\u8fd4\u56de if ( this . isLike ( userId , likeUserId )){ return false ; } UserLike userLike = new UserLike (); userLike . setId ( ObjectId . get ()); userLike . setUserId ( userId ); userLike . setLikeUserId ( likeUserId ); userLike . setCreated ( System . currentTimeMillis ()); //\u5c06\u6570\u636e\u5b58\u50a8\u5230MongoDB this . mongoTemplate . save ( userLike ); //\u7528\u6237\u7684\u559c\u6b22\u6570\u636e\u4fdd\u5b58\u5230redis //\u7528\u62371\uff1akey -> USER_LIKE_1 , value -> 2, \"1\" //\u7528\u62371\uff1akey -> USER_LIKE_1 , value -> 3, \"1\" //\u7528\u62372\uff1akey -> USER_LIKE_2 , value -> 4, \"1\" String redisKey = this . getLikeRedisKey ( userId ); String hashKey = String . valueOf ( likeUserId ); this . redisTemplate . opsForHash (). put ( redisKey , hashKey , \"1\" ); //\u5224\u65ad\uff0c\u559c\u6b22\u7684\u7528\u6237\u662f\u5426\u5728\u4e0d\u559c\u6b22\u7684\u5217\u8868\u4e2d\uff0c\u5982\u679c\u5728\uff0c\u5c31\u9700\u8981\u5220\u9664\u6570\u636e if ( this . isNotLike ( userId , likeUserId )){ redisKey = this . getNotLikeRedisKey ( userId ); this . redisTemplate . opsForHash (). delete ( redisKey , hashKey ); } return true ; } /** * \u83b7\u53d6\u559c\u6b22\u6570\u636e\u7684redis key * * @param userId * @return */ private String getLikeRedisKey ( Long userId ){ return LIKE_REDIS_KEY_PREFIX + userId ; } /** * \u83b7\u53d6\u4e0d\u559c\u6b22\u6570\u636e\u7684redis key * * @param userId * @return */ private String getNotLikeRedisKey ( Long userId ){ return NOT_LIKE_REDIS_KEY_PREFIX + userId ; } /** * \u662f\u5426\u559c\u6b22 * * @param userId * @param likeUserId * @return */ private Boolean isLike ( Long userId , Long likeUserId ){ String redisKey = this . getLikeRedisKey ( userId ); String hashKey = String . valueOf ( likeUserId ); return this . redisTemplate . opsForHash (). hasKey ( redisKey , hashKey ); } /** * \u662f\u5426\u4e0d\u559c\u6b22 * * @param userId * @param likeUserId * @return */ private Boolean isNotLike ( Long userId , Long likeUserId ){ String redisKey = this . getNotLikeRedisKey ( userId ); String hashKey = String . valueOf ( likeUserId ); return this . redisTemplate . opsForHash (). hasKey ( redisKey , hashKey ); } @Override public Boolean notLikeUser ( Long userId , Long likeUserId ) { //\u5224\u65ad\u7528\u6237\u662f\u5426\u5df2\u7ecf\u4e0d\u559c\u6b22\uff0c\u5982\u679c\u5df2\u7ecf\u4e0d\u559c\u6b22\uff0c\u5c31\u8fd4\u56de if ( this . isNotLike ( userId , likeUserId )){ return false ; } //\u5c06\u7528\u6237\u4fdd\u5b58\u5230\u4e0d\u559c\u6b22\u5217\u8868\u4e2d String redisKey = this . getNotLikeRedisKey ( userId ); String hashKey = String . valueOf ( likeUserId ); this . redisTemplate . opsForHash (). put ( redisKey , hashKey , \"1\" ); //\u5224\u65ad\u7528\u6237\u662f\u5426\u5728\u559c\u6b22\u5217\u8868\u4e2d\uff0c\u5982\u679c\u5b58\u5728\u7684\u8bdd\uff0c\u9700\u8981\u5220\u9664\u6570\u636e if ( this . isLike ( userId , likeUserId )){ //\u5220\u9664MongoDB\u6570\u636e Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId ) . and ( \"likeUserId\" ). is ( likeUserId ) ); this . mongoTemplate . remove ( query , UserLike . class ); //\u5220\u9664redis\u4e2d\u7684\u6570\u636e redisKey = this . getLikeRedisKey ( userId ); this . redisTemplate . opsForHash (). delete ( redisKey , hashKey ); } return true ; } @Override public Boolean isMutualLike ( Long userId , Long likeUserId ) { return this . isLike ( userId , likeUserId ) && this . isLike ( likeUserId , userId ); } @Override public List < Long > queryLikeList ( Long userId ) { // \u67e5\u8be2redis String redisKey = this . getLikeRedisKey ( userId ); Set < Object > keys = this . redisTemplate . opsForHash (). keys ( redisKey ); if ( CollUtil . isEmpty ( keys )){ return ListUtil . empty (); } List < Long > result = new ArrayList <> ( keys . size ()); keys . forEach ( o -> result . add ( Convert . toLong ( o ))); return result ; } @Override public List < Long > queryNotLikeList ( Long userId ) { // \u67e5\u8be2redis String redisKey = this . getNotLikeRedisKey ( userId ); Set < Object > keys = this . redisTemplate . opsForHash (). keys ( redisKey ); if ( CollUtil . isEmpty ( keys )){ return ListUtil . empty (); } List < Long > result = new ArrayList <> ( keys . size ()); keys . forEach ( o -> result . add ( Convert . toLong ( o ))); return result ; } }","title":"3.1.3\u3001\u7f16\u5199\u5b9e\u73b0"},{"location":"tantan/day08/#314","text":"package com.tanhua.dubbo.server.api ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringRunner ; @RunWith ( SpringRunner . class ) @SpringBootTest public class TestUserLikeApi { @Autowired private UserLikeApi userLikeApi ; @Test public void testUserLike () { System . out . println ( this . userLikeApi . likeUser ( 1L , 2L )); System . out . println ( this . userLikeApi . likeUser ( 1L , 3L )); System . out . println ( this . userLikeApi . likeUser ( 1L , 4L )); System . out . println ( this . userLikeApi . notLikeUser ( 1L , 5L )); System . out . println ( this . userLikeApi . notLikeUser ( 1L , 6L )); System . out . println ( this . userLikeApi . likeUser ( 1L , 5L )); System . out . println ( this . userLikeApi . notLikeUser ( 1L , 2L )); } @Test public void testQueryList (){ this . userLikeApi . queryLikeList ( 1L ). forEach ( a -> System . out . println ( a )); System . out . println ( \"-------\" ); this . userLikeApi . queryNotLikeList ( 1L ). forEach ( a -> System . out . println ( a )); } }","title":"3.1.4\u3001\u5355\u5143\u6d4b\u8bd5"},{"location":"tantan/day08/#32dubbo","text":"","title":"3.2\u3001\u67e5\u8be2\u63a8\u8350\u5217\u8868dubbo\u670d\u52a1"},{"location":"tantan/day08/#321","text":"//com.tanhua.dubbo.server.api.RecommendUserApi /** * \u67e5\u8be2\u63a2\u82b1\u5217\u8868\uff0c\u67e5\u8be2\u65f6\u9700\u8981\u6392\u9664\u4e0d\u559c\u6b22\u5217\u8868\u7528\u6237 * * @param userId * @param count * @return */ List < RecommendUser > queryCardList ( Long userId , Integer count );","title":"3.2.1\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day08/#322","text":"//com.tanhua.dubbo.server.api.RecommendUserApiImpl @Override public List < RecommendUser > queryCardList ( Long userId , Integer count ) { //\u8bbe\u7f6e\u5206\u9875\u4ee5\u53ca\u6392\u5e8f\uff0c\u6309\u7167\u5f97\u5206\u5012\u5e8f\u6392\u5e8f PageRequest pageRequest = PageRequest . of ( 0 , count , Sort . by ( Sort . Order . desc ( \"score\" ))); //\u6392\u9664\u5df2\u559c\u6b22\u6216\u4e0d\u559c\u6b22\u7684\u7528\u6237 List < Long > userIds = new ArrayList <> (); //\u67e5\u8be2\u559c\u6b22\u5217\u8868 userIds . addAll ( this . userLikeApi . queryLikeList ( userId )); //\u67e5\u8be2\u4e0d\u559c\u6b22\u5217\u8868 userIds . addAll ( this . userLikeApi . queryNotLikeList ( userId )); //\u6784\u9020\u67e5\u8be2\u6761\u4ef6 Criteria criteria = Criteria . where ( \"toUserId\" ). is ( userId ); if ( CollUtil . isNotEmpty ( userIds )){ //\u52a0\u5165\u5230\u67e5\u8be2\u6761\u4ef6\u4e2d\uff0c\u6392\u9664\u8fd9\u4e9b\u7528\u6237 criteria . andOperator ( Criteria . where ( \"userId\" ). nin ( userIds )); } Query query = Query . query ( criteria ). with ( pageRequest ); List < RecommendUser > recommendUserList = this . mongoTemplate . find ( query , RecommendUser . class ); return recommendUserList ; }","title":"3.2.2\u3001\u7f16\u5199\u5b9e\u73b0"},{"location":"tantan/day08/#323","text":"//com.tanhua.dubbo.server.api.TestRecommendUserApi @Test public void testQueryCardList (){ this . recommendUserApi . queryCardList ( 2L , 20 ) . forEach ( recommendUser -> System . out . println ( recommendUser )); }","title":"3.2.3\u3001\u5355\u5143\u6d4b\u8bd5"},{"location":"tantan/day08/#33app","text":"\u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/593","title":"3.3\u3001\u67e5\u8be2\u63a8\u8350\u5217\u8868APP\u63a5\u53e3\u5b9e\u73b0"},{"location":"tantan/day08/#331tanhuacontroller","text":"/** * \u63a2\u82b1 * * @return */ @GetMapping ( \"cards\" ) public ResponseEntity < List < TodayBest >> queryCardsList () { try { List < TodayBest > list = this . tanHuaService . queryCardsList (); return ResponseEntity . ok ( list ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"3.3.1\u3001TanHuaController"},{"location":"tantan/day08/#332tanhuaservice","text":"#\u9ed8\u8ba4\u63a8\u8350\u5217\u8868 tanhua.default.recommend.users = 2,3,8,10,18,20,24,29,27,32,36,37,56,64,75,88 /** * \u67e5\u8be2\u63a8\u8350\u5361\u7247\u5217\u8868\uff0c\u4ece\u63a8\u8350\u5217\u8868\u4e2d\u968f\u673a\u9009\u53d610\u4e2a\u7528\u6237 * * @return */ public List < TodayBest > queryCardsList () { User user = UserThreadLocal . get (); int count = 50 ; //\u67e5\u8be2\u5230\u768450\u6761\u6570\u636e\uff0c\u5e76\u4e0d\u662f\u7528\u6765\u76f4\u63a5\u5c55\u73b0\uff0c\u9700\u8981\u4ece\u8fd950\u6761\u6570\u636e\u4e2d\u968f\u673a\u8fd4\u56de\u4e00\u4e9b\u6570\u636e List < RecommendUser > recommendUserList = this . recommendUserService . queryCardList ( user . getId (), count ); if ( CollUtil . isEmpty ( recommendUserList )) { recommendUserList = new ArrayList <> (); //\u9ed8\u8ba4\u63a8\u8350\u5217\u8868 List < String > list = StrUtil . split ( defaultRecommendUsers , ',' ); for ( String userId : list ) { RecommendUser recommendUser = new RecommendUser (); recommendUser . setToUserId ( user . getId ()); recommendUser . setUserId ( Convert . toLong ( userId )); recommendUserList . add ( recommendUser ); } } //\u8ba1\u7b97\u5c55\u73b0\u7684\u6570\u91cf\uff0c\u9ed8\u8ba4\u5c55\u73b010\u4e2a int showCount = Math . min ( 10 , recommendUserList . size ()); List < RecommendUser > result = new ArrayList <> (); for ( int i = 0 ; i < showCount ; i ++ ) { //TODO \u53ef\u80fd\u91cd\u590d int index = RandomUtil . randomInt ( 0 , recommendUserList . size ()); RecommendUser recommendUser = recommendUserList . get ( index ); result . add ( recommendUser ); } List < Object > userIdList = CollUtil . getFieldValues ( result , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIdList ); List < TodayBest > todayBests = new ArrayList <> (); for ( UserInfo userInfo : userInfoList ) { TodayBest todayBest = new TodayBest (); todayBest . setId ( userInfo . getUserId ()); todayBest . setAge ( userInfo . getAge ()); todayBest . setAvatar ( userInfo . getLogo ()); todayBest . setGender ( userInfo . getSex (). name (). toLowerCase ()); todayBest . setNickname ( userInfo . getNickName ()); todayBest . setTags ( Convert . toStrArray ( StrUtil . split ( userInfo . getTags (), ',' ))); todayBest . setFateValue ( 0 L ); todayBests . add ( todayBest ); } return todayBests ; }","title":"3.3.2\u3001TanHuaService"},{"location":"tantan/day08/#333","text":"\u6548\u679c\uff1a","title":"3.3.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day08/#34","text":"\u5de6\u6ed1\uff1a\u201c\u4e0d\u559c\u6b22\u201d\uff0c\u53f3\u6ed1\uff1a\u201c\u559c\u6b22\u201d\uff0c\u5982\u679c\u53cc\u65b9\u559c\u6b22\uff0c\u90a3\u4e48\u5c31\u4f1a\u6210\u4e3a\u597d\u53cb\u3002 \u559c\u6b22\u7684\u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/599 \u4e0d\u559c\u6b22\u7684\u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/605","title":"3.4\u3001\u5de6\u6ed1\u53f3\u6ed1"},{"location":"tantan/day08/#341tanhuacontroller","text":"/** * \u559c\u6b22 * * @param likeUserId * @return */ @GetMapping ( \"{id}/love\" ) public ResponseEntity < Void > likeUser ( @PathVariable ( \"id\" ) Long likeUserId ) { try { this . tanHuaService . likeUser ( likeUserId ); return ResponseEntity . ok ( null ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } /** * \u4e0d\u559c\u6b22 * * @param likeUserId * @return */ @GetMapping ( \"{id}/unlove\" ) public ResponseEntity < Void > notLikeUser ( @PathVariable ( \"id\" ) Long likeUserId ) { try { this . tanHuaService . notLikeUser ( likeUserId ); return ResponseEntity . ok ( null ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"3.4.1\u3001TanHuaController"},{"location":"tantan/day08/#342tanhuaservice","text":"//com.tanhua.server.service.TanHuaService public Boolean likeUser ( Long likeUserId ) { User user = UserThreadLocal . get (); Boolean result = this . userLikeApi . likeUser ( user . getId (), likeUserId ); if ( ! result ) { return false ; } if ( this . userLikeApi . isMutualLike ( user . getId (), likeUserId )) { //\u76f8\u4e92\u559c\u6b22\u6210\u4e3a\u597d\u53cb this . imService . contactUser ( likeUserId ); } return true ; } public Boolean notLikeUser ( Long likeUserId ) { User user = UserThreadLocal . get (); return this . userLikeApi . notLikeUser ( user . getId (), likeUserId ); }","title":"3.4.2\u3001TanHuaService"},{"location":"tantan/day08/#343","text":"user_like\u8868\uff0c\u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u76f8\u4e92\u559c\u6b22\u4e86\uff1a tanhua_users\u8868\uff0c\u53ef\u4ee5\u770b\u5230\u76f8\u4e92\u662f\u597d\u53cb\u4e86\uff1a \u73af\u4fe1\u5e73\u53f0\uff1a","title":"3.4.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day08/#4","text":"\u5728\u6211\u7684\u4e2d\u5fc3\u6a21\u5757\u4e2d\uff0c\u53ef\u4ee5\u5bf9\u4e2a\u4eba\u4fe1\u606f\u505a\u4fee\u6539\u3002","title":"4\u3001\u7528\u6237\u8d44\u6599"},{"location":"tantan/day08/#41","text":"\u5728\u524d\u9762\u5b9e\u73b0\u7684\u67e5\u8be2\u4e2a\u4eba\u4fe1\u606f\u63a5\u53e3\u4e2d\uff0c\u5df2\u7ecf\u8fd4\u56de\u4e2a\u4eba\u57fa\u672c\u6570\u636e\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u5c55\u73b0\u51fa\u4e2a\u4eba\u4fe1\u606f\uff0c\u4e0b\u9762\u53ea\u9700\u8981\u8fdb\u884c\u5b9e\u73b0\u6570\u636e\u7684\u4fdd\u5b58\u5373\u53ef\u3002","title":"4.1\u3001\u57fa\u672c\u4fe1\u606f"},{"location":"tantan/day08/#441","text":"\u63a5\u53e3\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/887 \u8bf7\u6c42\u53c2\u6570\uff1a","title":"4.4.1\u3001\u63a5\u53e3\u4fe1\u606f"},{"location":"tantan/day08/#_2","text":"","title":""},{"location":"tantan/day08/#442mycentercontroller","text":"//com.tanhua.server.controller.MyCenterController /** * \u66f4\u65b0\u7528\u6237\u4fe1\u606f * * @param userInfoVo * @return */ @PutMapping public ResponseEntity < Void > updateUserInfo ( @RequestBody UserInfoVo userInfoVo ){ try { Boolean bool = this . myCenterService . updateUserInfo ( userInfoVo ); if ( bool ){ return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"4.4.2\u3001MyCenterController"},{"location":"tantan/day08/#443mycenterservice","text":"//com.tanhua.server.service.MyCenterService public Boolean updateUserInfo ( UserInfoVo userInfoVo ) { User user = UserThreadLocal . get (); UserInfo userInfo = new UserInfo (); userInfo . setUserId ( user . getId ()); userInfo . setAge ( Integer . valueOf ( userInfoVo . getAge ())); userInfo . setSex ( StringUtils . equalsIgnoreCase ( userInfoVo . getGender (), \"man\" ) ? SexEnum . MAN : SexEnum . WOMAN ); userInfo . setBirthday ( userInfoVo . getBirthday ()); userInfo . setCity ( userInfoVo . getCity ()); userInfo . setEdu ( userInfoVo . getEducation ()); userInfo . setIncome ( StringUtils . replaceAll ( userInfoVo . getIncome (), \"K\" , \"\" )); userInfo . setIndustry ( userInfoVo . getProfession ()); userInfo . setMarriage ( userInfoVo . getMarriage () == 1 ? \"\u5df2\u5a5a\" : \"\u672a\u5a5a\" ); return this . userInfoService . updateUserInfoByUserId ( userInfo ); }","title":"4.4.3\u3001MyCenterService"},{"location":"tantan/day08/#444userinfoservice","text":"//com.tanhua.server.service.UserInfoService public boolean updateUserInfoByUserId ( UserInfo userInfo ) { QueryWrapper < UserInfo > queryWrapper = new QueryWrapper <> (); queryWrapper . eq ( \"user_id\" , userInfo . getUserId ()); return this . userInfoMapper . update ( userInfo , queryWrapper ) > 0 ; }","title":"4.4.4\u3001UserInfoService"},{"location":"tantan/day08/#445bug","text":"\u5728\u4e4b\u524d\u7684\u67e5\u8be2\u4e2a\u4eba\u4fe1\u606f\u4e2d\u63a5\u53e3\u4e2d\uff0c\u8fd4\u56de\u6570\u636e\u4e2d\u7684\u6027\u522b\u6570\u636e\u6709\u8bef\uff0c\u9700\u8981\u8fd4\u56deman\u6216woman\u3002 \u5982\u4e0b\uff1a //com.tanhua.server.service.MyCenterService public UserInfoVo queryUserInfoByUserId ( Long userId ) { if ( ObjectUtil . isEmpty ( userId )) { //\u5982\u679c\u67e5\u8be2id\u4e3anull\uff0c\u5c31\u8868\u793a\u67e5\u8be2\u5f53\u524d\u7528\u6237\u4fe1\u606f userId = UserThreadLocal . get (). getId (); } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f UserInfo userInfo = this . userInfoService . queryUserInfoByUserId ( userId ); if ( ObjectUtil . isEmpty ( userInfo )) { return null ; } UserInfoVo userInfoVo = BeanUtil . copyProperties ( userInfo , UserInfoVo . class , \"marriage\" ); userInfoVo . setGender ( userInfo . getSex (). getValue () == 1 ? \"man\" : \"women\" ); userInfoVo . setMarriage ( StrUtil . equals ( \"\u5df2\u5a5a\" , userInfo . getMarriage ()) ? 1 : 0 ); return userInfoVo ; }","title":"4.4.5\u3001bug\u4fee\u590d"},{"location":"tantan/day08/#42","text":"\u4e0a\u4f20\u5934\u50cf\u4f7f\u7528sso\u4e2d\u7684\u4e0a\u4f20\u903b\u8f91\u5373\u53ef\uff0c\u53ea\u662f\u8def\u5f84\u4e0d\u540c\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u4fee\u6539nginx\u914d\u7f6e\u548c\u5728sso\u4e2d\u5b9a\u4e49Controller\u5373\u53ef\u3002 \u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/881 #user nobody; worker_processes 1 ; #error_log logs/error.log; #error_log logs/error.log notice; #error_log logs/error.log info; #pid logs/nginx.pid; events { worker_connections 1024 ; } http { include mime.types ; default_type application/octet-stream ; #log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' # '$status $body_bytes_sent \"$http_referer\" ' # '\"$http_user_agent\" \"$http_x_forwarded_for\"'; #access_log logs/access.log main; sendfile on ; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65 ; #gzip on; server { listen 80 ; server_name localhost ; #charset koi8-r; #access_log logs/host.access.log main; #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html ; location = /50x.html { root html ; } location /user/ { #\u8bf7\u6c42\u8def\u5f84\u4e2d\u51e1\u662f\u4ee5/user/\u5f00\u5934\u7684\u8bf7\u6c42\uff0c\u8f6c\u53d1\u5230sso\u7cfb\u7edf client_max_body_size 300m ; #\u8bbe\u7f6e\u6700\u5927\u7684\u8bf7\u6c42\u4f53\u5927\u5c0f\uff0c\u89e3\u51b3\u5927\u6587\u4ef6\u4e0a\u4f20\u4e0d\u4e86\u7684\u95ee\u9898 proxy_connect_timeout 300s ; #\u4ee3\u7406\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4 proxy_send_timeout 300s ; #\u4ee3\u7406\u53d1\u9001\u6570\u636e\u7684\u8d85\u65f6\u65f6\u95f4 proxy_read_timeout 300s ; #\u4ee3\u7406\u8bfb\u53d6\u6570\u636e\u7684\u8d85\u65f6\u65f6\u95f4 proxy_pass http://127.0.0.1:18080 ; #\u8f6c\u53d1\u8bf7\u6c42 } location /users/header { #\u8bf7\u6c42\u8def\u5f84\u4e2d\u51e1\u662f\u4ee5/user/header\u5f00\u5934\u7684\u8bf7\u6c42\uff0c\u8f6c\u53d1\u5230sso\u7cfb\u7edf client_max_body_size 300m ; #\u8bbe\u7f6e\u6700\u5927\u7684\u8bf7\u6c42\u4f53\u5927\u5c0f\uff0c\u89e3\u51b3\u5927\u6587\u4ef6\u4e0a\u4f20\u4e0d\u4e86\u7684\u95ee\u9898 proxy_connect_timeout 300s ; #\u4ee3\u7406\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4 proxy_send_timeout 300s ; #\u4ee3\u7406\u53d1\u9001\u6570\u636e\u7684\u8d85\u65f6\u65f6\u95f4 proxy_read_timeout 300s ; #\u4ee3\u7406\u8bfb\u53d6\u6570\u636e\u7684\u8d85\u65f6\u65f6\u95f4 proxy_pass http://127.0.0.1:18080 ; #\u8f6c\u53d1\u8bf7\u6c42 } location / { #\u4e0a\u9762\u672a\u5339\u914d\u5230\u7684\u5728\u8fd9\u91cc\u5904\u7406 client_max_body_size 300m ; proxy_connect_timeout 300s ; proxy_send_timeout 300s ; proxy_read_timeout 300s ; proxy_pass http://127.0.0.1:18081 ; #\u8f6c\u53d1\u8bf7\u6c42\u5230server\u7cfb\u7edf } } }","title":"4.2\u3001\u66f4\u65b0\u5934\u50cf"},{"location":"tantan/day08/#422mycentercontroller","text":"\u5728sso\u5de5\u7a0b\u4e2d\u5b9a\u4e49MyCenterController\u3002 package com.tanhua.sso.controller ; import com.tanhua.sso.vo.ErrorResult ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.http.HttpStatus ; import org.springframework.http.ResponseEntity ; import org.springframework.web.bind.annotation.* ; import org.springframework.web.multipart.MultipartFile ; @RestController @RequestMapping ( \"users\" ) public class MyCenterController { @Autowired private UserInfoController userInfoController ; /** * \u4e0a\u4f20\u5934\u50cf * * @param file * @param token * @return */ @PostMapping ( \"header\" ) public ResponseEntity < Object > saveLogo ( @RequestParam ( \"headPhoto\" ) MultipartFile file , @RequestHeader ( \"Authorization\" ) String token ) { return this . userInfoController . saveUserLogo ( file , token ); } }","title":"4.2.2\u3001MyCenterController"},{"location":"tantan/day08/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/","text":"\u72ec\u7acb\u5b9e\u73b0\u4e0a\u62a5\u5730\u7406\u4f4d\u7f6e\u7684\u529f\u80fd \u7406\u89e3\u641c\u9644\u8fd1\u7684\u529f\u80fd \u72ec\u7acb\u5b9e\u73b0\u641c\u9644\u8fd1\u7684\u529f\u80fd \u7406\u89e3\u63a2\u82b1\u529f\u80fd \u72ec\u7acb\u5b8c\u6210\u559c\u6b22\u7684dubbo\u670d\u52a1 \u72ec\u7acb\u5b8c\u6210\u67e5\u8be2\u63a8\u8350\u5217\u8868\u7684dubbo\u670d\u52a1 \u80fd\u591f\u6574\u5408APP\u5b8c\u6210\u63a2\u82b1\u529f\u80fd \u72ec\u7acb\u5b8c\u6210\u7528\u6237\u8d44\u6599\u7ef4\u62a4\u66f4\u65b0\u7684\u529f\u80fd","title":"\u5b66\u4e60\u76ee\u6807"},{"location":"tantan/day09/","text":"\u8bfe\u7a0b\u8bf4\u660e \u00b6 \u5b9e\u73b0\u6211\u7684\u559c\u6b22\u529f\u80fd \u5b9e\u73b0\u7528\u6237\u901a\u7528\u8bbe\u7f6e \u5b9e\u73b0\u9ed1\u540d\u5355\u529f\u80fd \u5b9e\u73b0\u4fee\u6539\u624b\u673a\u53f7\u529f\u80fd 1\u3001\u6211\u7684\u559c\u6b22\u7edf\u8ba1\u6570 \u00b6 \u5728\u6211\u7684\u6a21\u5757\u4e2d\uff0c\u5c06\u8be6\u7ec6\u5c55\u73b0\u201c\u559c\u6b22\u201d\u76f8\u5173\u7684\u6570\u636e\uff0c\u5982\u4e0b\uff1a 1.1\u3001\u6982\u5ff5\u8bf4\u660e \u00b6 \u559c\u6b22 \u6211\u559c\u6b22\u522b\u4eba\uff0c\u5982\uff1a\u5f20\u4e09\u559c\u6b22\u674e\u56db\uff0c\u5c31\u662f\u559c\u6b22\u7684\u6570\u636e\uff0c\u5e76\u4e0d\u4ee3\u8868\u674e\u56db\u4e5f\u559c\u6b22\u5f20\u4e09\u3002 \u7c89\u4e1d \u5bf9\u4e8e\u674e\u56db\u800c\u8a00\uff0c\u5f20\u4e09\u5c31\u662f\u4ed6\u7684\u7c89\u4e1d\u3002 \u76f8\u4e92\u5173\u6ce8\uff08\u559c\u6b22\uff09 \u5982\u679c\u674e\u56db\u4e5f\u559c\u6b22\u5f20\u4e09\uff0c\u90a3\u4e48\uff0c\u5f20\u4e09\u548c\u674e\u56db\u5c31\u662f\u76f8\u4e92\u559c\u6b22\u3002 1.2\u3001dubbo\u670d\u52a1 \u00b6 1.2.1\u3001UserLikeApi \u00b6 //com.tanhua.dubbo.server.api.UserLikeApi /** * \u76f8\u4e92\u559c\u6b22\u7684\u6570\u91cf * * @return */ Long queryMutualLikeCount ( Long userId ); /** * \u559c\u6b22\u6570 * * @return */ Long queryLikeCount ( Long userId ); /** * \u7c89\u4e1d\u6570 * * @return */ Long queryFanCount ( Long userId ); 1.2.2\u3001UserLikeApiImpl \u00b6 //com.tanhua.dubbo.server.api.UserLikeApiImpl /** * \u67e5\u8be2\u76f8\u4e92\u559c\u6b22\u6570 * \u5b9e\u73b02\u79cd\u65b9\u5f0f\uff1a\u7b2c\u4e00\u79cd\uff1a\u67e5\u8be2redis\uff0c\u7b2c\u4e8c\u79cd\uff1a\u67e5\u8be2MongoDB * \u5efa\u8bae\uff1a\u4f18\u5148\u4f7f\u7528redis\u67e5\u8be2\uff0c\u5176\u6b21\u8003\u8651\u4f7f\u7528Mongodb * * @param userId * @return */ @Override public Long queryMutualLikeCount ( Long userId ) { //\u67e5\u8be2\u6211\u7684\u559c\u6b22\u5217\u8868 List < Long > likeUserIdList = this . queryLikeList ( userId ); Long count = 0 L ; for ( Long likeUserId : likeUserIdList ) { String redisKey = this . getLikeRedisKey ( likeUserId ); String hashKey = String . valueOf ( userId ); //\u201c\u522b\u4eba\u201d \u7684\u559c\u6b22\u5217\u8868\u4e2d\u662f\u5426\u6709 \u201c\u6211\u201d if ( this . redisTemplate . opsForHash (). hasKey ( redisKey , hashKey )) { count ++ ; } } return count ; } @Override public Long queryLikeCount ( Long userId ) { String redisKey = this . getLikeRedisKey ( userId ); return this . redisTemplate . opsForHash (). size ( redisKey ); } @Override public Long queryFanCount ( Long userId ) { //\u65e0\u6cd5\u901a\u8fc7redis\u67e5\u8be2\u5b8c\u6210\uff0c\u5fc5\u987b\u4eceMongodb\u4e2d\u67e5\u8be2 Query query = Query . query ( Criteria . where ( \"likeUserId\" ). is ( userId )); return this . mongoTemplate . count ( query , UserLike . class ); } 1.2.3\u3001\u5355\u5143\u6d4b\u8bd5 \u00b6 package com.tanhua.dubbo.server.api ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringJUnit4ClassRunner ; @RunWith ( SpringJUnit4ClassRunner . class ) @SpringBootTest public class TestUserLikeApiImpl { @Autowired private UserLikeApi userLikeApi ; @Test public void testQueryCounts (){ System . out . println ( this . userLikeApi . queryEachLikeCount ( 1L )); System . out . println ( this . userLikeApi . queryFanCount ( 1L )); System . out . println ( this . userLikeApi . queryLikeCount ( 1L )); } } 1.3\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 \u6587\u6863\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/899 1.3.1\u3001CountsVo \u00b6 package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class CountsVo { private Long eachLoveCount ; //\u4e92\u76f8\u559c\u6b22 private Long loveCount ; //\u559c\u6b22 private Long fanCount ; //\u7c89\u4e1d } 1.3.2\u3001UsersController \u00b6 //com.tanhua.server.controller.MyCenterController /** * \u4e92\u76f8\u559c\u6b22\uff0c\u559c\u6b22\uff0c\u7c89\u4e1d - \u7edf\u8ba1 * * @return */ @GetMapping ( \"counts\" ) public ResponseEntity < CountsVo > queryCounts (){ try { CountsVo countsVo = this . myCenterService . queryCounts (); if ( null != countsVo ){ return ResponseEntity . ok ( countsVo ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 1.3.3\u3001UsersService \u00b6 //com.tanhua.server.service.MyCenterService public CountsVo queryCounts () { User user = UserThreadLocal . get (); CountsVo countsVo = new CountsVo (); countsVo . setEachLoveCount ( this . userLikeApi . queryMutualLikeCount ( user . getId ())); countsVo . setFanCount ( this . userLikeApi . queryFanCount ( user . getId ())); countsVo . setLoveCount ( this . userLikeApi . queryLikeCount ( user . getId ())); return countsVo ; } 1.3.4\u3001\u6d4b\u8bd5 \u00b6 2\u3001\u559c\u6b22\u5217\u8868 \u00b6 \u63a5\u53e3\u670d\u52a1\uff1ahttps://mock-java.itheima.net/project/35/interface/api/905 \u8be5\u63a5\u53e3\u96c6\u6210\u4e864\u4e2a\u63a5\u53e3\uff0c\u7528type\u505a\u4e86\u533a\u5206\uff1a 1 \u4e92\u76f8\u5173\u6ce8 2 \u6211\u5173\u6ce8 3 \u7c89\u4e1d 4 \u8c01\u770b\u8fc7\u6211 2.1\u3001\u559c\u6b22dubbo\u63a5\u53e3\u670d\u52a1 \u00b6 2.1.1\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 \u5728dubbo\u63a5\u53e3\u4e2d\u5b9a\u4e49\u65b9\u6cd5\uff1a //com.tanhua.dubbo.server.api.UserLikeApi /** * \u67e5\u8be2\u76f8\u4e92\u559c\u6b22\u5217\u8868 * * @param userId * @param page * @param pageSize * @return */ PageInfo < UserLike > queryMutualLikeList ( Long userId , Integer page , Integer pageSize ); /** * \u67e5\u8be2\u6211\u559c\u6b22\u7684\u5217\u8868 * * @param userId * @param page * @param pageSize * @return */ PageInfo < UserLike > queryLikeList ( Long userId , Integer page , Integer pageSize ); /** * \u67e5\u8be2\u7c89\u4e1d\u5217\u8868 * * @param userId * @param page * @param pageSize * @return */ PageInfo < UserLike > queryFanList ( Long userId , Integer page , Integer pageSize ); 2.1.2\u3001\u5b9e\u73b0\u63a5\u53e3 \u00b6 //com.tanhua.dubbo.server.api.UserLikeApiImpl @Override public PageInfo < UserLike > queryMutualLikeList ( Long userId , Integer page , Integer pageSize ) { //\u67e5\u8be2\u6211\u7684\u559c\u6b22\u5217\u8868 List < Long > userLikeIdList = this . queryLikeList ( userId ); //\u67e5\u8be2\u559c\u6b22\u6211\u7684\u4eba Query query = Query . query ( Criteria . where ( \"userId\" ). in ( userLikeIdList ) . and ( \"likeUserId\" ). is ( userId ) ); return this . queryList ( query , page , pageSize ); } @Override public PageInfo < UserLike > queryLikeList ( Long userId , Integer page , Integer pageSize ) { Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId )); return this . queryList ( query , page , pageSize ); } @Override public PageInfo < UserLike > queryFanList ( Long userId , Integer page , Integer pageSize ) { Query query = Query . query ( Criteria . where ( \"likeUserId\" ). is ( userId )); return this . queryList ( query , page , pageSize ); } private PageInfo < UserLike > queryList ( Query query , Integer page , Integer pageSize ) { //\u8bbe\u7f6e\u5206\u9875 PageRequest pageRequest = PageRequest . of ( page - 1 , pageSize , Sort . by ( Sort . Order . desc ( \"created\" ))); query . with ( pageRequest ); List < UserLike > userLikeList = this . mongoTemplate . find ( query , UserLike . class ); PageInfo < UserLike > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); pageInfo . setRecords ( userLikeList ); return pageInfo ; } 2.2\u3001\u6700\u8fd1\u8bbf\u5ba2dubbo\u670d\u52a1 \u00b6 2.2.1\u3001\u5b9a\u4e49\u63a5\u53e3 \u00b6 //com.tanhua.dubbo.server.api.VisitorsApi /** * \u6309\u7167\u65f6\u95f4\u5012\u5e8f\u6392\u5e8f\uff0c\u67e5\u8be2\u6700\u8fd1\u7684\u8bbf\u5ba2\u4fe1\u606f * * @param userId * @param page * @param pageSize * @return */ PageInfo < Visitors > topVisitor ( Long userId , Integer page , Integer pageSize ); 2.2.2\u3001\u7f16\u5199\u5b9e\u73b0 \u00b6 //com.tanhua.dubbo.server.api.VisitorsApiImpl @Override public List < Visitors > queryMyVisitor ( Long userId ) { // \u67e5\u8be2\u524d5\u4e2a\u8bbf\u5ba2\u6570\u636e\uff0c\u6309\u7167\u8bbf\u95ee\u65f6\u95f4\u5012\u5e8f\u6392\u5e8f // \u5982\u679c\u7528\u6237\u5df2\u7ecf\u67e5\u8be2\u8fc7\u5217\u8868\uff0c\u8bb0\u5f55\u67e5\u8be2\u65f6\u95f4\uff0c\u540e\u7eed\u67e5\u8be2\u9700\u8981\u6309\u7167\u8fd9\u4e2a\u65f6\u95f4\u5f80\u540e\u67e5\u8be2 // \u4e0a\u4e00\u6b21\u67e5\u8be2\u5217\u8868\u7684\u65f6\u95f4 Long date = Convert . toLong ( this . redisTemplate . opsForHash (). get ( VISITOR_REDIS_KEY , String . valueOf ( userId ))); PageRequest pageRequest = PageRequest . of ( 0 , 5 , Sort . by ( Sort . Order . desc ( \"date\" ))); Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId )) . with ( pageRequest ); if ( ObjectUtil . isNotEmpty ( date )) { query . addCriteria ( Criteria . where ( \"date\" ). gte ( date )); } return this . queryList ( query , userId ); } private List < Visitors > queryList ( Query query , Long userId ){ List < Visitors > visitorsList = this . mongoTemplate . find ( query , Visitors . class ); //\u67e5\u8be2\u6bcf\u4e2a\u6765\u8bbf\u7528\u6237\u7684\u5f97\u5206 for ( Visitors visitors : visitorsList ) { Query queryScore = Query . query ( Criteria . where ( \"toUserId\" ) . is ( userId ). and ( \"userId\" ). is ( visitors . getVisitorUserId ()) ); RecommendUser recommendUser = this . mongoTemplate . findOne ( queryScore , RecommendUser . class ); if ( ObjectUtil . isNotEmpty ( recommendUser )){ visitors . setScore ( recommendUser . getScore ()); } else { //\u9ed8\u8ba4\u5f97\u5206 visitors . setScore ( 90 d ); } } return visitorsList ; } @Override public PageInfo < Visitors > topVisitor ( Long userId , Integer page , Integer pageSize ) { PageRequest pageRequest = PageRequest . of ( page - 1 , pageSize , Sort . by ( Sort . Order . desc ( \"date\" ))); Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId )). with ( pageRequest ); List < Visitors > visitorsList = this . queryList ( query , userId ); PageInfo < Visitors > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); pageInfo . setRecords ( visitorsList ); //\u8bb0\u5f55\u5f53\u524d\u7684\u65f6\u95f4\u5230redis\u4e2d\uff0c\u5728\u9996\u9875\u67e5\u8be2\u65f6\uff0c\u5c31\u53ef\u4ee5\u5728\u8fd9\u4e2a\u65f6\u95f4\u4e4b\u540e\u67e5\u8be2\u4e86 String redisKey = VISITOR_REDIS_KEY ; String hashKey = String . valueOf ( userId ); String value = String . valueOf ( System . currentTimeMillis ()); this . redisTemplate . opsForHash (). put ( redisKey , hashKey , value ); return pageInfo ; } 2.3\u3001APP\u63a5\u53e3\u670d\u52a1 \u00b6 \u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/905 2.3.1\u3001UserLikeListVo \u00b6 package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class UserLikeListVo { private Long id ; private String avatar ; private String nickname ; private String gender ; private Integer age ; private String city ; private String education ; private Integer marriage ; //\u5a5a\u59fb\u72b6\u6001\uff080\u672a\u5a5a\uff0c1\u5df2\u5a5a\uff09 private Integer matchRate ; //\u5339\u914d\u5ea6 private Boolean alreadyLove ; //\u662f\u5426\u559c\u6b22ta } 2.3.2\u3001MyCenterController \u00b6 //com.tanhua.server.controller.MyCenterController /** * \u4e92\u76f8\u5173\u6ce8\u3001\u6211\u5173\u6ce8\u3001\u7c89\u4e1d\u3001\u8c01\u770b\u8fc7\u6211 - \u7ffb\u9875\u5217\u8868 * * @param type 1 \u4e92\u76f8\u5173\u6ce8 2 \u6211\u5173\u6ce8 3 \u7c89\u4e1d 4 \u8c01\u770b\u8fc7\u6211 * @param page * @param pageSize * @param nickname * @return */ @GetMapping ( \"friends/{type}\" ) public ResponseEntity < PageResult > queryLikeList ( @PathVariable ( \"type\" ) String type , @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize , @RequestParam ( value = \"nickname\" , required = false ) String nickname ) { try { page = Math . max ( 1 , page ); PageResult pageResult = this . myCenterService . queryLikeList ( Integer . valueOf ( type ), page , pageSize , nickname ); return ResponseEntity . ok ( pageResult ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 2.3.3\u3001MyCenterService \u00b6 //com.tanhua.server.service.MyCenterService public PageResult queryLikeList ( Integer type , Integer page , Integer pageSize , String nickname ) { PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); Long userId = UserThreadLocal . get (). getId (); List < Object > userIdList = null ; //1 \u4e92\u76f8\u5173\u6ce8 2 \u6211\u5173\u6ce8 3 \u7c89\u4e1d 4 \u8c01\u770b\u8fc7\u6211 switch ( type ){ case 1 :{ PageInfo < UserLike > pageInfo = this . userLikeApi . queryMutualLikeList ( userId , page , pageSize ); userIdList = CollUtil . getFieldValues ( pageInfo . getRecords (), \"userId\" ); break ; } case 2 :{ PageInfo < UserLike > pageInfo = this . userLikeApi . queryLikeList ( userId , page , pageSize ); userIdList = CollUtil . getFieldValues ( pageInfo . getRecords (), \"likeUserId\" ); break ; } case 3 :{ PageInfo < UserLike > pageInfo = this . userLikeApi . queryFanList ( userId , page , pageSize ); userIdList = CollUtil . getFieldValues ( pageInfo . getRecords (), \"userId\" ); break ; } case 4 :{ PageInfo < Visitors > pageInfo = this . visitorsApi . topVisitor ( userId , page , pageSize ); userIdList = CollUtil . getFieldValues ( pageInfo . getRecords (), \"visitorUserId\" ); break ; } default : return pageResult ; } if ( CollUtil . isEmpty ( userIdList )){ return pageResult ; } QueryWrapper < UserInfo > queryWrapper = new QueryWrapper <> (); queryWrapper . in ( \"user_id\" , userIdList ); if ( StrUtil . isNotEmpty ( nickname )){ queryWrapper . like ( \"nick_name\" , nickname ); } List < UserInfo > userInfoList = this . userInfoService . queryUserInfoList ( queryWrapper ); List < UserLikeListVo > userLikeListVos = new ArrayList <> (); for ( UserInfo userInfo : userInfoList ) { UserLikeListVo userLikeListVo = new UserLikeListVo (); userLikeListVo . setAge ( userInfo . getAge ()); userLikeListVo . setAvatar ( userInfo . getLogo ()); userLikeListVo . setCity ( userInfo . getCity ()); userLikeListVo . setEducation ( userInfo . getEdu ()); userLikeListVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); userLikeListVo . setId ( userInfo . getUserId ()); userLikeListVo . setMarriage ( StringUtils . equals ( userInfo . getMarriage (), \"\u5df2\u5a5a\" ) ? 1 : 0 ); userLikeListVo . setNickname ( userInfo . getNickName ()); //\u662f\u5426\u559c\u6b22 userLikeApi\u4e2d\u7684isLike\u5f00\u653e\u51fa\u6765 userLikeListVo . setAlreadyLove ( this . userLikeApi . isLike ( userId , userInfo . getUserId ())); Double score = this . recommendUserService . queryScore ( userId , userInfo . getUserId ()); userLikeListVo . setMatchRate ( Convert . toInt ( score )); userLikeListVos . add ( userLikeListVo ); } pageResult . setItems ( userLikeListVos ); return pageResult ; } 2.3.4\u3001\u6d4b\u8bd5 \u00b6 2.4\u3001\u53d6\u6d88\u559c\u6b22 \u00b6 \u5728\u5217\u8868\u4e2d\u53ef\u4ee5\u8fdb\u884c\u201c\u53d6\u6d88\u559c\u6b22\u201d\u64cd\u4f5c\u3002 \u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/923 2.4.1\u3001MyCenterController \u00b6 //com.tanhua.server.controller.MyCenterController /** * \u53d6\u6d88\u559c\u6b22 * * @param userId * @return */ @DeleteMapping ( \"like/{uid}\" ) public ResponseEntity < Void > disLike ( @PathVariable ( \"uid\" ) Long userId ) { try { this . myCenterService . disLike ( userId ); return ResponseEntity . ok ( null ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 2.4.2\u3001MyCenterService \u00b6 //com.tanhua.server.service.MyCenterService /** * \u53d6\u6d88\u559c\u6b22 * * @param userId */ public void disLike ( Long userId ) { //\u5224\u65ad\u5f53\u524d\u7528\u6237\u4e0e\u6b64\u7528\u6237\u662f\u5426\u76f8\u4e92\u559c\u6b22 User user = UserThreadLocal . get (); Boolean mutualLike = this . userLikeApi . isMutualLike ( user . getId (), userId ); //\u53d6\u6d88\u559c\u6b22 this . userLikeApi . notLikeUser ( user . getId (), userId ); if ( mutualLike ){ //\u53d6\u6d88\u597d\u53cb\u5173\u7cfb\uff0c\u89e3\u9664\u5728\u73af\u4fe1\u5e73\u53f0\u7684\u597d\u53cb\u5173\u7cfb this . imService . removeUser ( userId ); } } 2.4.3\u3001IMService \u00b6 //com.tanhua.server.service.IMService /** * \u5220\u9664\u597d\u53cb * * @param userId \u597d\u53cbid */ public void removeUser ( Long userId ) { //\u5220\u9664\u597d\u53cb\u5173\u7cfb User user = UserThreadLocal . get (); Boolean result = this . usersApi . removeUsers ( user . getId (), userId ); if ( result ){ //\u5c06\u73af\u4fe1\u5e73\u53f0\u7684\u597d\u53cb\u5173\u7cfb\u89e3\u9664 this . huanXinApi . removeUserFriend ( user . getId (), userId ); } } 2.4.4\u3001\u6d4b\u8bd5 \u00b6 \u6d4b\u8bd5\u65f6\uff0c\u9700\u8981\u5c06MongoDB\u4e2d\u7684user_like\u8868\u6570\u636e\u6e05\u7a7a\u4ee5\u53ca\u5c06Redis\u4e2d\u559c\u6b22\u548c\u4e0d\u559c\u6b22\u6570\u636e\u5220\u9664\u3002 \u4f7f\u7528\u7528\u62372\u8fdb\u884c\u6d4b\u8bd5\uff0c\u73b0\u5728\u548c\u7528\u62371\u662f\u597d\u53cb\uff1a \u53d6\u6d88\u559c\u6b22\uff1a 2.5\u3001 \u559c\u6b22\u7c89\u4e1d \u00b6 \u5728\u67e5\u770b\u7c89\u4e1d\u5217\u8868\u4e2d\uff0c\u53ef\u4ee5\u5bf9\u7c89\u4e1d\u8fdb\u884c\u201c\u559c\u6b22\u64cd\u4f5c\u201d\u3002 \u6587\u6863\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/917 2.5.1\u3001MyCenterController \u00b6 //com.tanhua.server.controller.MyCenterController /** * \u5173\u6ce8\u7c89\u4e1d * * @param userId * @return */ @PostMapping ( \"fans/{uid}\" ) public ResponseEntity < Void > likeFan ( @PathVariable ( \"uid\" ) Long userId ){ try { this . myCenterService . likeFan ( userId ); return ResponseEntity . ok ( null ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 2.5.2\u3001MyCenterService \u00b6 //com.tanhua.server.service.MyCenterService @Autowired private TanHuaService tanHuaService ; /** * \u559c\u6b22 * * @param userId */ public void likeFan ( Long userId ) { //\u559c\u6b22\u7528\u6237\uff0c\u5982\u679c\u7528\u6237\u662f\u76f8\u4e92\u559c\u6b22\u7684\u8bdd\u5c31\u4f1a\u6210\u4e3a\u597d\u53cb this . tanHuaService . likeUser ( userId ); } 2.5.3\u3001\u6d4b\u8bd5 \u00b6 3\u3001\u7528\u6237\u901a\u7528\u8bbe\u7f6e \u00b6 3.1\u3001\u8868\u7ed3\u6784 \u00b6 CREATE TABLE ` tb_settings ` ( ` id ` bigint ( 20 ) NOT NULL AUTO_INCREMENT , ` user_id ` bigint ( 20 ) DEFAULT NULL , ` like_notification ` tinyint ( 4 ) DEFAULT '1' COMMENT '\u63a8\u9001\u559c\u6b22\u901a\u77e5' , ` pinglun_notification ` tinyint ( 4 ) DEFAULT '1' COMMENT '\u63a8\u9001\u8bc4\u8bba\u901a\u77e5' , ` gonggao_notification ` tinyint ( 4 ) DEFAULT '1' COMMENT '\u63a8\u9001\u516c\u544a\u901a\u77e5' , ` created ` datetime DEFAULT NULL , ` updated ` datetime DEFAULT NULL , PRIMARY KEY ( ` id ` ) ) ENGINE = InnoDB DEFAULT CHARSET = utf8 COMMENT = '\u8bbe\u7f6e\u8868' ; 3.2\u3001pojo \u00b6 my-tanhua-common\u5de5\u7a0b\uff1a package com.tanhua.common.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class Settings extends BasePojo { private Long id ; private Long userId ; private Boolean likeNotification = true ; private Boolean pinglunNotification = true ; private Boolean gonggaoNotification = true ; } 3.3\u3001SettingsMapper \u00b6 package com.tanhua.common.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.common.pojo.Settings ; public interface SettingsMapper extends BaseMapper < Settings > { } 3.4\u3001SettingsService \u00b6 package com.tanhua.server.service ; import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper ; import com.tanhua.common.mapper.SettingsMapper ; import com.tanhua.common.pojo.Settings ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; @Service public class SettingsService { @Autowired private SettingsMapper settingsMapper ; /** * \u6839\u636e\u7528\u6237id\u67e5\u8be2\u914d\u7f6e * * @param userId * @return */ public Settings querySettings ( Long userId ) { QueryWrapper < Settings > queryWrapper = new QueryWrapper <> (); queryWrapper . eq ( \"user_id\" , userId ); return this . settingsMapper . selectOne ( queryWrapper ); } } 3.5\u3001\u67e5\u8be2\u914d\u7f6e \u00b6 \u6587\u6863\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/893 3.5.1\u3001SettingsVo \u00b6 package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class SettingsVo { private Long id ; //\u964c\u751f\u4eba\u95ee\u9898 private String strangerQuestion = \"\" ; //\u624b\u673a\u53f7 private String phone ; //\u63a8\u9001\u559c\u6b22\u901a\u77e5 private Boolean likeNotification = true ; //\u63a8\u9001\u8bc4\u8bba\u901a\u77e5 private Boolean pinglunNotification = true ; //\u63a8\u9001\u516c\u544a\u901a\u77e5 private Boolean gonggaoNotification = true ; } 3.5.2\u3001MyCenterController \u00b6 //com.tanhua.server.controller.MyCenterController /** * \u67e5\u8be2\u914d\u7f6e * * @return */ @GetMapping ( \"settings\" ) public ResponseEntity < SettingsVo > querySettings () { try { SettingsVo settingsVo = this . myCenterService . querySettings (); if ( null != settingsVo ) { return ResponseEntity . ok ( settingsVo ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 3.5.3\u3001MyCenterService \u00b6 //com.tanhua.server.service.MyCenterService public SettingsVo querySettings () { SettingsVo settingsVo = new SettingsVo (); User user = UserThreadLocal . get (); //\u8bbe\u7f6e\u7528\u6237\u7684\u57fa\u672c\u4fe1\u606f settingsVo . setId ( user . getId ()); settingsVo . setPhone ( user . getMobile ()); //\u67e5\u8be2\u7528\u6237\u7684\u914d\u7f6e\u6570\u636e Settings settings = this . settingsService . querySettings ( user . getId ()); if ( ObjectUtil . isNotEmpty ( settings )){ settingsVo . setGonggaoNotification ( settings . getGonggaoNotification ()); settingsVo . setLikeNotification ( settings . getLikeNotification ()); settingsVo . setPinglunNotification ( settings . getPinglunNotification ()); } //\u67e5\u8be2\u964c\u751f\u4eba\u95ee\u9898 settingsVo . setStrangerQuestion ( this . tanHuaService . queryQuestion ( user . getId ())); return settingsVo ; } 2.5.4\u3001\u6d4b\u8bd5 \u00b6 3.6\u3001\u4fdd\u5b58\u964c\u751f\u4eba\u95ee\u9898 \u00b6 \u6587\u6863\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/929 3.6.1\u3001MyCenterController \u00b6 //com.tanhua.server.controller.MyCenterController /** * \u8bbe\u7f6e\u964c\u751f\u4eba\u95ee\u9898 * * @return */ @PostMapping ( \"questions\" ) public ResponseEntity < Void > saveQuestions ( @RequestBody Map < String , String > param ) { try { String content = param . get ( \"content\" ); this . myCenterService . saveQuestions ( content ); return ResponseEntity . ok ( null ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 3.6.2\u3001MyCenterService \u00b6 //com.tanhua.server.service.MyCenterService public void saveQuestions ( String content ) { User user = UserThreadLocal . get (); this . questionService . save ( user . getId (), content ); } 3.6.3\u3001QuestionService \u00b6 //com.tanhua.server.service.QuestionService public void save ( Long userId , String content ) { Question question = this . queryQuestion ( userId ); if ( null != question ){ question . setTxt ( content ); this . questionMapper . updateById ( question ); } else { question = new Question (); question . setUserId ( userId ); question . setTxt ( content ); question . setCreated ( new Date ()); question . setUpdated ( question . getCreated ()); this . questionMapper . insert ( question ); } } 3.7\u3001\u9ed1\u540d\u5355\u5217\u8868 \u00b6 \u9ed1\u540d\u5355\u529f\u80fd\u53ef\u4ee5\u7528\u5728\u964c\u751f\u4eba\u6253\u62db\u547c\u65f6\uff0c\u8fdb\u884c\u5224\u65ad\uff0c\u5982\u679c\u662f\u9ed1\u540d\u5355\u7684\u5219\u4e0d\u80fd\u6253\u62db\u547c\u3002 \u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/935 3.7.1\u3001\u8868\u7ed3\u6784 \u00b6 CREATE TABLE ` tb_black_list ` ( ` id ` bigint ( 20 ) NOT NULL AUTO_INCREMENT , ` user_id ` bigint ( 20 ) DEFAULT NULL , ` black_user_id ` bigint ( 20 ) DEFAULT NULL , ` created ` datetime DEFAULT NULL , ` updated ` datetime DEFAULT NULL , PRIMARY KEY ( ` id ` ), KEY ` user_id ` ( ` user_id ` ) ) ENGINE = InnoDB DEFAULT CHARSET = utf8 COMMENT = '\u9ed1\u540d\u5355' ; --\u6d4b\u8bd5\u6570\u636e INSERT INTO ` tb_black_list ` ( ` id ` , ` user_id ` , ` black_user_id ` , ` created ` , ` updated ` ) VALUES ( '1' , '1' , '22' , '2019-11-01 15:47:22' , '2019-11-01 15:47:24' ); INSERT INTO ` tb_black_list ` ( ` id ` , ` user_id ` , ` black_user_id ` , ` created ` , ` updated ` ) VALUES ( '2' , '1' , '23' , '2019-11-01 15:47:39' , '2019-11-01 15:47:42' ); INSERT INTO ` tb_black_list ` ( ` id ` , ` user_id ` , ` black_user_id ` , ` created ` , ` updated ` ) VALUES ( '3' , '1' , '24' , '2019-11-01 15:47:51' , '2019-11-01 15:47:56' ); 3.7.2\u3001pojo \u00b6 package com.tanhua.common.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class BlackList extends BasePojo { private Long id ; private Long userId ; private Long blackUserId ; } 3.7.3\u3001BlackListMapper \u00b6 package com.tanhua.common.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.common.pojo.BlackList ; public interface BlackListMapper extends BaseMapper < BlackList > { } 3.7.4\u3001BlackListService \u00b6 package com.tanhua.server.service ; import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper ; import com.baomidou.mybatisplus.core.metadata.IPage ; import com.baomidou.mybatisplus.extension.plugins.pagination.Page ; import com.tanhua.common.mapper.BlackListMapper ; import com.tanhua.common.pojo.BlackList ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; @Service public class BlackListService { @Autowired private BlackListMapper blackListMapper ; public IPage < BlackList > queryBlacklist ( Long userId , Integer page , Integer pageSize ) { QueryWrapper < BlackList > wrapper = new QueryWrapper < BlackList > (); wrapper . eq ( \"user_id\" , userId ); wrapper . orderByDesc ( \"created\" ); Page < BlackList > pager = new Page <> ( page , pageSize ); return this . blackListMapper . selectPage ( pager , wrapper ); } } \u914d\u7f6e\u5206\u9875\u63d2\u4ef6\uff1a package com.tanhua.server.config ; import com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; @Configuration public class MybatisPlusConfig { /** * \u5206\u9875\u63d2\u4ef6 */ @Bean public PaginationInterceptor paginationInterceptor () { return new PaginationInterceptor (); } } 3.7.5\u3001BlackListVo \u00b6 package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @AllArgsConstructor @NoArgsConstructor public class BlackListVo { private Long id ; private String avatar ; private String nickname ; private String gender ; private Integer age ; } 3.7.6\u3001MyCenterController \u00b6 //com.tanhua.server.controller.MyCenterController /** * \u67e5\u8be2\u9ed1\u540d\u5355 * * @param page * @param pagesize * @return */ @GetMapping ( \"blacklist\" ) public ResponseEntity < PageResult > queryBlacklist ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pagesize ) { try { PageResult pageResult = this . myCenterService . queryBlacklist ( page , pagesize ); return ResponseEntity . ok ( pageResult ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 3.7.7\u3001MyCenterService \u00b6 //com.tanhua.server.service.MyCenterService public PageResult queryBlacklist ( Integer page , Integer pageSize ) { User user = UserThreadLocal . get (); IPage < BlackList > blackListIPage = this . blackListService . queryBlacklist ( user . getId (), page , pageSize ); PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); pageResult . setCounts ( Convert . toInt ( blackListIPage . getTotal ())); pageResult . setPages ( Convert . toInt ( blackListIPage . getPages ())); List < BlackList > records = blackListIPage . getRecords (); if ( CollUtil . isEmpty ( records )){ return pageResult ; } List < Object > userIds = CollUtil . getFieldValues ( records , \"blackUserId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); List < BlackListVo > blackListVos = new ArrayList <> (); for ( UserInfo userInfo : userInfoList ) { BlackListVo blackListVo = new BlackListVo (); blackListVo . setAge ( userInfo . getAge ()); blackListVo . setAvatar ( userInfo . getLogo ()); blackListVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); blackListVo . setId ( userInfo . getUserId ()); blackListVo . setNickname ( userInfo . getNickName ()); blackListVos . add ( blackListVo ); } pageResult . setItems ( blackListVos ); return pageResult ; } 3.7.8\u3001\u6d4b\u8bd5 \u00b6 3.8\u3001\u79fb\u9664\u9ed1\u540d\u5355 \u00b6 \u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/941 3.8.1\u3001MyCenterController \u00b6 /** * \u79fb\u9664\u9ed1\u540d\u5355 * * @return */ @DeleteMapping ( \"blacklist/{uid}\" ) public ResponseEntity < Void > delBlacklist ( @PathVariable ( \"uid\" ) Long userId ) { try { this . myCenterService . delBlacklist ( userId ); return ResponseEntity . ok ( null ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 3.8.2\u3001MyCenterService \u00b6 public void delBlacklist ( Long userId ) { User user = UserThreadLocal . get (); this . blackListService . delBlacklist ( user . getId (), userId ); } 3.8.3\u3001BlackListService \u00b6 public Boolean delBlacklist ( Long userId , Long blackUserId ) { QueryWrapper < BlackList > wrapper = new QueryWrapper < BlackList > (); wrapper . eq ( \"user_id\" , userId ). eq ( \"black_user_id\" , blackUserId ); return this . blackListMapper . delete ( wrapper ) > 0 ; } 3.9\u3001\u66f4\u65b0\u901a\u77e5 \u00b6 \u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/965 3.9.1\u3001MyCenterController \u00b6 //com.tanhua.server.controller.MyCenterController /** * \u66f4\u65b0\u901a\u77e5\u8bbe\u7f6e * * @param param * @return */ @PostMapping ( \"notifications/setting\" ) public ResponseEntity < Void > updateNotification ( @RequestBody Map < String , Boolean > param ) { try { Boolean likeNotification = param . get ( \"likeNotification\" ); Boolean pinglunNotification = param . get ( \"pinglunNotification\" ); Boolean gonggaoNotification = param . get ( \"gonggaoNotification\" ); this . usersService . updateNotification ( likeNotification , pinglunNotification , gonggaoNotification ); return ResponseEntity . ok ( null ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } 2.9.2\u3001MyCenterService \u00b6 //com.tanhua.server.service.MyCenterService public void updateNotification ( Boolean likeNotification , Boolean pinglunNotification , Boolean gonggaoNotification ) { User user = UserThreadLocal . get (); this . settingsService . updateNotification ( user . getId (), likeNotification , pinglunNotification , gonggaoNotification ); } 2.9.3\u3001SettingsService \u00b6 //com.tanhua.server.service.SettingsService public void updateNotification ( Long userId , Boolean likeNotification , Boolean pinglunNotification , Boolean gonggaoNotification ) { QueryWrapper < Settings > queryWrapper = new QueryWrapper <> (); queryWrapper . eq ( \"user_id\" , userId ); Settings settings = this . settingsMapper . selectOne ( queryWrapper ); if ( null == settings ){ //\u5982\u679c\u6ca1\u6709\u6570\u636e\u7684\u8bdd\uff0c\u63d2\u5165\u4e00\u6761\u6570\u636e settings = new Settings (); settings . setUserId ( userId ); this . settingsMapper . insert ( settings ); } else { //\u66f4\u65b0 settings . setLikeNotification ( likeNotification ); settings . setPinglunNotification ( pinglunNotification ); settings . setGonggaoNotification ( gonggaoNotification ); this . settingsMapper . update ( settings , queryWrapper ); } } 3.10\u3001\u66f4\u65b0\u624b\u673a\u53f7 \u00b6 \u66f4\u65b0\u624b\u673a\u53f7\u7684\u903b\u8f91\u5728sso\u7cfb\u7edf\u4e2d\u5b8c\u6210\uff0c\u5176\u6d41\u7a0b\u662f\uff1a\u65e7\u624b\u673a\u53f7\u83b7\u53d6\u9a8c\u8bc1\u7801\uff0c\u9a8c\u8bc1\u7801\u6821\u9a8c\u901a\u8fc7\u540e\uff0c\u8bbe\u7f6e\u65b0\u624b\u673a\u53f7\uff0c\u6700\u540e\u4fdd\u5b58\u65b0\u7684\u624b\u673a\u53f7\u3002 \u6b65\u9aa41\uff0c\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\uff1ahttps://mock-java.itheima.net/project/35/interface/api/947 \u6b65\u9aa42\uff0c\u6821\u9a8c\u9a8c\u8bc1\u7801\uff1ahttps://mock-java.itheima.net/project/35/interface/api/953 \u6b65\u9aa43\uff0c\u4fdd\u5b58\u65b0\u624b\u673a\u53f7\uff1ahttps://mock-java.itheima.net/project/35/interface/api/959 \u914d\u7f6enginx\uff1a location /users/phone { #\u8bf7\u6c42\u8def\u5f84\u4e2d\u51e1\u662f\u4ee5/user/phone\u5f00\u5934\u7684\u8bf7\u6c42\uff0c\u8f6c\u53d1\u5230sso\u7cfb\u7edf client_max_body_size 300m ; #\u8bbe\u7f6e\u6700\u5927\u7684\u8bf7\u6c42\u4f53\u5927\u5c0f\uff0c\u89e3\u51b3\u5927\u6587\u4ef6\u4e0a\u4f20\u4e0d\u4e86\u7684\u95ee\u9898 proxy_connect_timeout 300s ; #\u4ee3\u7406\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4 proxy_send_timeout 300s ; #\u4ee3\u7406\u53d1\u9001\u6570\u636e\u7684\u8d85\u65f6\u65f6\u95f4 proxy_read_timeout 300s ; #\u4ee3\u7406\u8bfb\u53d6\u6570\u636e\u7684\u8d85\u65f6\u65f6\u95f4 proxy_pass http://127.0.0.1:18080 ; #\u8f6c\u53d1\u8bf7\u6c42 } 3.10.1\u3001 \u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801 \u00b6 MyCenterController: //com.tanhua.sso.controller.MyCenterController /** * \u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801 * * @return */ @PostMapping ( \"phone/sendVerificationCode\" ) public ResponseEntity < Void > sendVerificationCode ( @RequestHeader ( \"Authorization\" ) String token ) { try { boolean bool = this . myCenterService . sendVerificationCode ( token ); if ( bool ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } MyCenterService: //com.tanhua.sso.service.MyCenterService package com.tanhua.sso.service ; import com.tanhua.common.pojo.User ; import com.tanhua.sso.vo.ErrorResult ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; @Service public class MyCenterService { @Autowired private UserService userService ; @Autowired private SmsService smsService ; public Boolean sendVerificationCode ( String token ) { //\u6821\u9a8ctoken User user = this . userService . queryUserByToken ( token ); if ( ObjectUtil . isEmpty ( user )){ return false ; } ErrorResult errorResult = this . smsService . sendCheckCode ( user . getMobile ()); return errorResult == null ; } } 3.10.2\u3001 \u6821\u9a8c\u9a8c\u8bc1\u7801 \u00b6 MyCenterController\uff1a //com.tanhua.sso.controller.MyCenterController /** * \u6821\u9a8c\u9a8c\u8bc1\u7801 * * @param param * @param token * @return */ @PostMapping ( \"phone/checkVerificationCode\" ) public ResponseEntity < Map < String , Object >> checkVerificationCode ( @RequestBody Map < String , String > param , @RequestHeader ( \"Authorization\" ) String token ) { try { String code = param . get ( \"verificationCode\" ); Boolean bool = this . myCenterService . checkVerificationCode ( code , token ); Map < String , Object > result = new HashMap <> (); result . put ( \"verification\" , bool ); return ResponseEntity . ok ( result ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } MyCenterService\uff1a //com.tanhua.sso.service.MyCenterService public Boolean checkVerificationCode ( String code , String token ) { //\u6821\u9a8ctoken User user = this . userService . queryUserByToken ( token ); if ( ObjectUtil . isEmpty ( user )){ return false ; } //\u6821\u9a8c\u9a8c\u8bc1\u7801\uff0c\u5148\u67e5\u8be2redis\u4e2d\u7684\u9a8c\u8bc1\u7801 String redisKey = \"CHECK_CODE_\" + user . getMobile (); String value = this . redisTemplate . opsForValue (). get ( redisKey ); if ( StrUtil . equals ( code , value )){ //\u5c06\u9a8c\u8bc1\u7801\u5220\u9664 this . redisTemplate . delete ( redisKey ); return true ; } return false ; } 3.10.3\u3001\u4fdd\u5b58\u65b0\u624b\u673a\u53f7 \u00b6 MyCenterController\uff1a //com.tanhua.sso.controller.MyCenterController /** * \u4fdd\u5b58\u65b0\u624b\u673a\u53f7 * * @return */ @PostMapping ( \"phone\" ) public ResponseEntity < Void > updatePhone ( @RequestBody Map < String , String > param , @RequestHeader ( \"Authorization\" ) String token ) { try { String newPhone = param . get ( \"phone\" ); boolean bool = this . myCenterService . updatePhone ( token , newPhone ); if ( bool ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } MyCenterService\uff1a //com.tanhua.sso.service.MyCenterService public Boolean updatePhone ( String token , String newPhone ) { //\u6821\u9a8ctoken User user = this . userService . queryUserByToken ( token ); if ( ObjectUtil . isEmpty ( user )){ return false ; } Boolean result = this . userService . updatePhone ( user . getId (), newPhone ); if ( result ){ String redisKey = \"TANHUA_USER_MOBILE_\" + user . getId (); this . redisTemplate . delete ( redisKey ); } return result ; } UserService\uff1a //com.tanhua.sso.service.UserService public Boolean updatePhone ( Long userId , String newPhone ) { //\u5148\u67e5\u8be2\u65b0\u624b\u673a\u53f7\u662f\u5426\u5df2\u7ecf\u6ce8\u518c\uff0c\u5982\u679c\u5df2\u7ecf\u6ce8\u518c\uff0c\u5c31\u4e0d\u80fd\u4fee\u6539 QueryWrapper < User > queryWrapper = new QueryWrapper <> (); queryWrapper . eq ( \"mobile\" , newPhone ); User user = this . userMapper . selectOne ( queryWrapper ); if ( ObjectUtil . isNotEmpty ( user )){ //\u65b0\u624b\u673a\u53f7\u5df2\u7ecf\u88ab\u6ce8\u518c return false ; } user = new User (); user . setId ( userId ); user . setMobile ( newPhone ); return this . userMapper . updateById ( user ) > 0 ; }","title":"day09"},{"location":"tantan/day09/#_1","text":"\u5b9e\u73b0\u6211\u7684\u559c\u6b22\u529f\u80fd \u5b9e\u73b0\u7528\u6237\u901a\u7528\u8bbe\u7f6e \u5b9e\u73b0\u9ed1\u540d\u5355\u529f\u80fd \u5b9e\u73b0\u4fee\u6539\u624b\u673a\u53f7\u529f\u80fd","title":"\u8bfe\u7a0b\u8bf4\u660e"},{"location":"tantan/day09/#1","text":"\u5728\u6211\u7684\u6a21\u5757\u4e2d\uff0c\u5c06\u8be6\u7ec6\u5c55\u73b0\u201c\u559c\u6b22\u201d\u76f8\u5173\u7684\u6570\u636e\uff0c\u5982\u4e0b\uff1a","title":"1\u3001\u6211\u7684\u559c\u6b22\u7edf\u8ba1\u6570"},{"location":"tantan/day09/#11","text":"\u559c\u6b22 \u6211\u559c\u6b22\u522b\u4eba\uff0c\u5982\uff1a\u5f20\u4e09\u559c\u6b22\u674e\u56db\uff0c\u5c31\u662f\u559c\u6b22\u7684\u6570\u636e\uff0c\u5e76\u4e0d\u4ee3\u8868\u674e\u56db\u4e5f\u559c\u6b22\u5f20\u4e09\u3002 \u7c89\u4e1d \u5bf9\u4e8e\u674e\u56db\u800c\u8a00\uff0c\u5f20\u4e09\u5c31\u662f\u4ed6\u7684\u7c89\u4e1d\u3002 \u76f8\u4e92\u5173\u6ce8\uff08\u559c\u6b22\uff09 \u5982\u679c\u674e\u56db\u4e5f\u559c\u6b22\u5f20\u4e09\uff0c\u90a3\u4e48\uff0c\u5f20\u4e09\u548c\u674e\u56db\u5c31\u662f\u76f8\u4e92\u559c\u6b22\u3002","title":"1.1\u3001\u6982\u5ff5\u8bf4\u660e"},{"location":"tantan/day09/#12dubbo","text":"","title":"1.2\u3001dubbo\u670d\u52a1"},{"location":"tantan/day09/#121userlikeapi","text":"//com.tanhua.dubbo.server.api.UserLikeApi /** * \u76f8\u4e92\u559c\u6b22\u7684\u6570\u91cf * * @return */ Long queryMutualLikeCount ( Long userId ); /** * \u559c\u6b22\u6570 * * @return */ Long queryLikeCount ( Long userId ); /** * \u7c89\u4e1d\u6570 * * @return */ Long queryFanCount ( Long userId );","title":"1.2.1\u3001UserLikeApi"},{"location":"tantan/day09/#122userlikeapiimpl","text":"//com.tanhua.dubbo.server.api.UserLikeApiImpl /** * \u67e5\u8be2\u76f8\u4e92\u559c\u6b22\u6570 * \u5b9e\u73b02\u79cd\u65b9\u5f0f\uff1a\u7b2c\u4e00\u79cd\uff1a\u67e5\u8be2redis\uff0c\u7b2c\u4e8c\u79cd\uff1a\u67e5\u8be2MongoDB * \u5efa\u8bae\uff1a\u4f18\u5148\u4f7f\u7528redis\u67e5\u8be2\uff0c\u5176\u6b21\u8003\u8651\u4f7f\u7528Mongodb * * @param userId * @return */ @Override public Long queryMutualLikeCount ( Long userId ) { //\u67e5\u8be2\u6211\u7684\u559c\u6b22\u5217\u8868 List < Long > likeUserIdList = this . queryLikeList ( userId ); Long count = 0 L ; for ( Long likeUserId : likeUserIdList ) { String redisKey = this . getLikeRedisKey ( likeUserId ); String hashKey = String . valueOf ( userId ); //\u201c\u522b\u4eba\u201d \u7684\u559c\u6b22\u5217\u8868\u4e2d\u662f\u5426\u6709 \u201c\u6211\u201d if ( this . redisTemplate . opsForHash (). hasKey ( redisKey , hashKey )) { count ++ ; } } return count ; } @Override public Long queryLikeCount ( Long userId ) { String redisKey = this . getLikeRedisKey ( userId ); return this . redisTemplate . opsForHash (). size ( redisKey ); } @Override public Long queryFanCount ( Long userId ) { //\u65e0\u6cd5\u901a\u8fc7redis\u67e5\u8be2\u5b8c\u6210\uff0c\u5fc5\u987b\u4eceMongodb\u4e2d\u67e5\u8be2 Query query = Query . query ( Criteria . where ( \"likeUserId\" ). is ( userId )); return this . mongoTemplate . count ( query , UserLike . class ); }","title":"1.2.2\u3001UserLikeApiImpl"},{"location":"tantan/day09/#123","text":"package com.tanhua.dubbo.server.api ; import org.junit.Test ; import org.junit.runner.RunWith ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.boot.test.context.SpringBootTest ; import org.springframework.test.context.junit4.SpringJUnit4ClassRunner ; @RunWith ( SpringJUnit4ClassRunner . class ) @SpringBootTest public class TestUserLikeApiImpl { @Autowired private UserLikeApi userLikeApi ; @Test public void testQueryCounts (){ System . out . println ( this . userLikeApi . queryEachLikeCount ( 1L )); System . out . println ( this . userLikeApi . queryFanCount ( 1L )); System . out . println ( this . userLikeApi . queryLikeCount ( 1L )); } }","title":"1.2.3\u3001\u5355\u5143\u6d4b\u8bd5"},{"location":"tantan/day09/#13app","text":"\u6587\u6863\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/899","title":"1.3\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day09/#131countsvo","text":"package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class CountsVo { private Long eachLoveCount ; //\u4e92\u76f8\u559c\u6b22 private Long loveCount ; //\u559c\u6b22 private Long fanCount ; //\u7c89\u4e1d }","title":"1.3.1\u3001CountsVo"},{"location":"tantan/day09/#132userscontroller","text":"//com.tanhua.server.controller.MyCenterController /** * \u4e92\u76f8\u559c\u6b22\uff0c\u559c\u6b22\uff0c\u7c89\u4e1d - \u7edf\u8ba1 * * @return */ @GetMapping ( \"counts\" ) public ResponseEntity < CountsVo > queryCounts (){ try { CountsVo countsVo = this . myCenterService . queryCounts (); if ( null != countsVo ){ return ResponseEntity . ok ( countsVo ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"1.3.2\u3001UsersController"},{"location":"tantan/day09/#133usersservice","text":"//com.tanhua.server.service.MyCenterService public CountsVo queryCounts () { User user = UserThreadLocal . get (); CountsVo countsVo = new CountsVo (); countsVo . setEachLoveCount ( this . userLikeApi . queryMutualLikeCount ( user . getId ())); countsVo . setFanCount ( this . userLikeApi . queryFanCount ( user . getId ())); countsVo . setLoveCount ( this . userLikeApi . queryLikeCount ( user . getId ())); return countsVo ; }","title":"1.3.3\u3001UsersService"},{"location":"tantan/day09/#134","text":"","title":"1.3.4\u3001\u6d4b\u8bd5"},{"location":"tantan/day09/#2","text":"\u63a5\u53e3\u670d\u52a1\uff1ahttps://mock-java.itheima.net/project/35/interface/api/905 \u8be5\u63a5\u53e3\u96c6\u6210\u4e864\u4e2a\u63a5\u53e3\uff0c\u7528type\u505a\u4e86\u533a\u5206\uff1a 1 \u4e92\u76f8\u5173\u6ce8 2 \u6211\u5173\u6ce8 3 \u7c89\u4e1d 4 \u8c01\u770b\u8fc7\u6211","title":"2\u3001\u559c\u6b22\u5217\u8868"},{"location":"tantan/day09/#21dubbo","text":"","title":"2.1\u3001\u559c\u6b22dubbo\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day09/#211","text":"\u5728dubbo\u63a5\u53e3\u4e2d\u5b9a\u4e49\u65b9\u6cd5\uff1a //com.tanhua.dubbo.server.api.UserLikeApi /** * \u67e5\u8be2\u76f8\u4e92\u559c\u6b22\u5217\u8868 * * @param userId * @param page * @param pageSize * @return */ PageInfo < UserLike > queryMutualLikeList ( Long userId , Integer page , Integer pageSize ); /** * \u67e5\u8be2\u6211\u559c\u6b22\u7684\u5217\u8868 * * @param userId * @param page * @param pageSize * @return */ PageInfo < UserLike > queryLikeList ( Long userId , Integer page , Integer pageSize ); /** * \u67e5\u8be2\u7c89\u4e1d\u5217\u8868 * * @param userId * @param page * @param pageSize * @return */ PageInfo < UserLike > queryFanList ( Long userId , Integer page , Integer pageSize );","title":"2.1.1\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day09/#212","text":"//com.tanhua.dubbo.server.api.UserLikeApiImpl @Override public PageInfo < UserLike > queryMutualLikeList ( Long userId , Integer page , Integer pageSize ) { //\u67e5\u8be2\u6211\u7684\u559c\u6b22\u5217\u8868 List < Long > userLikeIdList = this . queryLikeList ( userId ); //\u67e5\u8be2\u559c\u6b22\u6211\u7684\u4eba Query query = Query . query ( Criteria . where ( \"userId\" ). in ( userLikeIdList ) . and ( \"likeUserId\" ). is ( userId ) ); return this . queryList ( query , page , pageSize ); } @Override public PageInfo < UserLike > queryLikeList ( Long userId , Integer page , Integer pageSize ) { Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId )); return this . queryList ( query , page , pageSize ); } @Override public PageInfo < UserLike > queryFanList ( Long userId , Integer page , Integer pageSize ) { Query query = Query . query ( Criteria . where ( \"likeUserId\" ). is ( userId )); return this . queryList ( query , page , pageSize ); } private PageInfo < UserLike > queryList ( Query query , Integer page , Integer pageSize ) { //\u8bbe\u7f6e\u5206\u9875 PageRequest pageRequest = PageRequest . of ( page - 1 , pageSize , Sort . by ( Sort . Order . desc ( \"created\" ))); query . with ( pageRequest ); List < UserLike > userLikeList = this . mongoTemplate . find ( query , UserLike . class ); PageInfo < UserLike > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); pageInfo . setRecords ( userLikeList ); return pageInfo ; }","title":"2.1.2\u3001\u5b9e\u73b0\u63a5\u53e3"},{"location":"tantan/day09/#22dubbo","text":"","title":"2.2\u3001\u6700\u8fd1\u8bbf\u5ba2dubbo\u670d\u52a1"},{"location":"tantan/day09/#221","text":"//com.tanhua.dubbo.server.api.VisitorsApi /** * \u6309\u7167\u65f6\u95f4\u5012\u5e8f\u6392\u5e8f\uff0c\u67e5\u8be2\u6700\u8fd1\u7684\u8bbf\u5ba2\u4fe1\u606f * * @param userId * @param page * @param pageSize * @return */ PageInfo < Visitors > topVisitor ( Long userId , Integer page , Integer pageSize );","title":"2.2.1\u3001\u5b9a\u4e49\u63a5\u53e3"},{"location":"tantan/day09/#222","text":"//com.tanhua.dubbo.server.api.VisitorsApiImpl @Override public List < Visitors > queryMyVisitor ( Long userId ) { // \u67e5\u8be2\u524d5\u4e2a\u8bbf\u5ba2\u6570\u636e\uff0c\u6309\u7167\u8bbf\u95ee\u65f6\u95f4\u5012\u5e8f\u6392\u5e8f // \u5982\u679c\u7528\u6237\u5df2\u7ecf\u67e5\u8be2\u8fc7\u5217\u8868\uff0c\u8bb0\u5f55\u67e5\u8be2\u65f6\u95f4\uff0c\u540e\u7eed\u67e5\u8be2\u9700\u8981\u6309\u7167\u8fd9\u4e2a\u65f6\u95f4\u5f80\u540e\u67e5\u8be2 // \u4e0a\u4e00\u6b21\u67e5\u8be2\u5217\u8868\u7684\u65f6\u95f4 Long date = Convert . toLong ( this . redisTemplate . opsForHash (). get ( VISITOR_REDIS_KEY , String . valueOf ( userId ))); PageRequest pageRequest = PageRequest . of ( 0 , 5 , Sort . by ( Sort . Order . desc ( \"date\" ))); Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId )) . with ( pageRequest ); if ( ObjectUtil . isNotEmpty ( date )) { query . addCriteria ( Criteria . where ( \"date\" ). gte ( date )); } return this . queryList ( query , userId ); } private List < Visitors > queryList ( Query query , Long userId ){ List < Visitors > visitorsList = this . mongoTemplate . find ( query , Visitors . class ); //\u67e5\u8be2\u6bcf\u4e2a\u6765\u8bbf\u7528\u6237\u7684\u5f97\u5206 for ( Visitors visitors : visitorsList ) { Query queryScore = Query . query ( Criteria . where ( \"toUserId\" ) . is ( userId ). and ( \"userId\" ). is ( visitors . getVisitorUserId ()) ); RecommendUser recommendUser = this . mongoTemplate . findOne ( queryScore , RecommendUser . class ); if ( ObjectUtil . isNotEmpty ( recommendUser )){ visitors . setScore ( recommendUser . getScore ()); } else { //\u9ed8\u8ba4\u5f97\u5206 visitors . setScore ( 90 d ); } } return visitorsList ; } @Override public PageInfo < Visitors > topVisitor ( Long userId , Integer page , Integer pageSize ) { PageRequest pageRequest = PageRequest . of ( page - 1 , pageSize , Sort . by ( Sort . Order . desc ( \"date\" ))); Query query = Query . query ( Criteria . where ( \"userId\" ). is ( userId )). with ( pageRequest ); List < Visitors > visitorsList = this . queryList ( query , userId ); PageInfo < Visitors > pageInfo = new PageInfo <> (); pageInfo . setPageNum ( page ); pageInfo . setPageSize ( pageSize ); pageInfo . setRecords ( visitorsList ); //\u8bb0\u5f55\u5f53\u524d\u7684\u65f6\u95f4\u5230redis\u4e2d\uff0c\u5728\u9996\u9875\u67e5\u8be2\u65f6\uff0c\u5c31\u53ef\u4ee5\u5728\u8fd9\u4e2a\u65f6\u95f4\u4e4b\u540e\u67e5\u8be2\u4e86 String redisKey = VISITOR_REDIS_KEY ; String hashKey = String . valueOf ( userId ); String value = String . valueOf ( System . currentTimeMillis ()); this . redisTemplate . opsForHash (). put ( redisKey , hashKey , value ); return pageInfo ; }","title":"2.2.2\u3001\u7f16\u5199\u5b9e\u73b0"},{"location":"tantan/day09/#23app","text":"\u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/905","title":"2.3\u3001APP\u63a5\u53e3\u670d\u52a1"},{"location":"tantan/day09/#231userlikelistvo","text":"package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class UserLikeListVo { private Long id ; private String avatar ; private String nickname ; private String gender ; private Integer age ; private String city ; private String education ; private Integer marriage ; //\u5a5a\u59fb\u72b6\u6001\uff080\u672a\u5a5a\uff0c1\u5df2\u5a5a\uff09 private Integer matchRate ; //\u5339\u914d\u5ea6 private Boolean alreadyLove ; //\u662f\u5426\u559c\u6b22ta }","title":"2.3.1\u3001UserLikeListVo"},{"location":"tantan/day09/#232mycentercontroller","text":"//com.tanhua.server.controller.MyCenterController /** * \u4e92\u76f8\u5173\u6ce8\u3001\u6211\u5173\u6ce8\u3001\u7c89\u4e1d\u3001\u8c01\u770b\u8fc7\u6211 - \u7ffb\u9875\u5217\u8868 * * @param type 1 \u4e92\u76f8\u5173\u6ce8 2 \u6211\u5173\u6ce8 3 \u7c89\u4e1d 4 \u8c01\u770b\u8fc7\u6211 * @param page * @param pageSize * @param nickname * @return */ @GetMapping ( \"friends/{type}\" ) public ResponseEntity < PageResult > queryLikeList ( @PathVariable ( \"type\" ) String type , @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pageSize , @RequestParam ( value = \"nickname\" , required = false ) String nickname ) { try { page = Math . max ( 1 , page ); PageResult pageResult = this . myCenterService . queryLikeList ( Integer . valueOf ( type ), page , pageSize , nickname ); return ResponseEntity . ok ( pageResult ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"2.3.2\u3001MyCenterController"},{"location":"tantan/day09/#233mycenterservice","text":"//com.tanhua.server.service.MyCenterService public PageResult queryLikeList ( Integer type , Integer page , Integer pageSize , String nickname ) { PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); Long userId = UserThreadLocal . get (). getId (); List < Object > userIdList = null ; //1 \u4e92\u76f8\u5173\u6ce8 2 \u6211\u5173\u6ce8 3 \u7c89\u4e1d 4 \u8c01\u770b\u8fc7\u6211 switch ( type ){ case 1 :{ PageInfo < UserLike > pageInfo = this . userLikeApi . queryMutualLikeList ( userId , page , pageSize ); userIdList = CollUtil . getFieldValues ( pageInfo . getRecords (), \"userId\" ); break ; } case 2 :{ PageInfo < UserLike > pageInfo = this . userLikeApi . queryLikeList ( userId , page , pageSize ); userIdList = CollUtil . getFieldValues ( pageInfo . getRecords (), \"likeUserId\" ); break ; } case 3 :{ PageInfo < UserLike > pageInfo = this . userLikeApi . queryFanList ( userId , page , pageSize ); userIdList = CollUtil . getFieldValues ( pageInfo . getRecords (), \"userId\" ); break ; } case 4 :{ PageInfo < Visitors > pageInfo = this . visitorsApi . topVisitor ( userId , page , pageSize ); userIdList = CollUtil . getFieldValues ( pageInfo . getRecords (), \"visitorUserId\" ); break ; } default : return pageResult ; } if ( CollUtil . isEmpty ( userIdList )){ return pageResult ; } QueryWrapper < UserInfo > queryWrapper = new QueryWrapper <> (); queryWrapper . in ( \"user_id\" , userIdList ); if ( StrUtil . isNotEmpty ( nickname )){ queryWrapper . like ( \"nick_name\" , nickname ); } List < UserInfo > userInfoList = this . userInfoService . queryUserInfoList ( queryWrapper ); List < UserLikeListVo > userLikeListVos = new ArrayList <> (); for ( UserInfo userInfo : userInfoList ) { UserLikeListVo userLikeListVo = new UserLikeListVo (); userLikeListVo . setAge ( userInfo . getAge ()); userLikeListVo . setAvatar ( userInfo . getLogo ()); userLikeListVo . setCity ( userInfo . getCity ()); userLikeListVo . setEducation ( userInfo . getEdu ()); userLikeListVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); userLikeListVo . setId ( userInfo . getUserId ()); userLikeListVo . setMarriage ( StringUtils . equals ( userInfo . getMarriage (), \"\u5df2\u5a5a\" ) ? 1 : 0 ); userLikeListVo . setNickname ( userInfo . getNickName ()); //\u662f\u5426\u559c\u6b22 userLikeApi\u4e2d\u7684isLike\u5f00\u653e\u51fa\u6765 userLikeListVo . setAlreadyLove ( this . userLikeApi . isLike ( userId , userInfo . getUserId ())); Double score = this . recommendUserService . queryScore ( userId , userInfo . getUserId ()); userLikeListVo . setMatchRate ( Convert . toInt ( score )); userLikeListVos . add ( userLikeListVo ); } pageResult . setItems ( userLikeListVos ); return pageResult ; }","title":"2.3.3\u3001MyCenterService"},{"location":"tantan/day09/#234","text":"","title":"2.3.4\u3001\u6d4b\u8bd5"},{"location":"tantan/day09/#24","text":"\u5728\u5217\u8868\u4e2d\u53ef\u4ee5\u8fdb\u884c\u201c\u53d6\u6d88\u559c\u6b22\u201d\u64cd\u4f5c\u3002 \u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/923","title":"2.4\u3001\u53d6\u6d88\u559c\u6b22"},{"location":"tantan/day09/#241mycentercontroller","text":"//com.tanhua.server.controller.MyCenterController /** * \u53d6\u6d88\u559c\u6b22 * * @param userId * @return */ @DeleteMapping ( \"like/{uid}\" ) public ResponseEntity < Void > disLike ( @PathVariable ( \"uid\" ) Long userId ) { try { this . myCenterService . disLike ( userId ); return ResponseEntity . ok ( null ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"2.4.1\u3001MyCenterController"},{"location":"tantan/day09/#242mycenterservice","text":"//com.tanhua.server.service.MyCenterService /** * \u53d6\u6d88\u559c\u6b22 * * @param userId */ public void disLike ( Long userId ) { //\u5224\u65ad\u5f53\u524d\u7528\u6237\u4e0e\u6b64\u7528\u6237\u662f\u5426\u76f8\u4e92\u559c\u6b22 User user = UserThreadLocal . get (); Boolean mutualLike = this . userLikeApi . isMutualLike ( user . getId (), userId ); //\u53d6\u6d88\u559c\u6b22 this . userLikeApi . notLikeUser ( user . getId (), userId ); if ( mutualLike ){ //\u53d6\u6d88\u597d\u53cb\u5173\u7cfb\uff0c\u89e3\u9664\u5728\u73af\u4fe1\u5e73\u53f0\u7684\u597d\u53cb\u5173\u7cfb this . imService . removeUser ( userId ); } }","title":"2.4.2\u3001MyCenterService"},{"location":"tantan/day09/#243imservice","text":"//com.tanhua.server.service.IMService /** * \u5220\u9664\u597d\u53cb * * @param userId \u597d\u53cbid */ public void removeUser ( Long userId ) { //\u5220\u9664\u597d\u53cb\u5173\u7cfb User user = UserThreadLocal . get (); Boolean result = this . usersApi . removeUsers ( user . getId (), userId ); if ( result ){ //\u5c06\u73af\u4fe1\u5e73\u53f0\u7684\u597d\u53cb\u5173\u7cfb\u89e3\u9664 this . huanXinApi . removeUserFriend ( user . getId (), userId ); } }","title":"2.4.3\u3001IMService"},{"location":"tantan/day09/#244","text":"\u6d4b\u8bd5\u65f6\uff0c\u9700\u8981\u5c06MongoDB\u4e2d\u7684user_like\u8868\u6570\u636e\u6e05\u7a7a\u4ee5\u53ca\u5c06Redis\u4e2d\u559c\u6b22\u548c\u4e0d\u559c\u6b22\u6570\u636e\u5220\u9664\u3002 \u4f7f\u7528\u7528\u62372\u8fdb\u884c\u6d4b\u8bd5\uff0c\u73b0\u5728\u548c\u7528\u62371\u662f\u597d\u53cb\uff1a \u53d6\u6d88\u559c\u6b22\uff1a","title":"2.4.4\u3001\u6d4b\u8bd5"},{"location":"tantan/day09/#25","text":"\u5728\u67e5\u770b\u7c89\u4e1d\u5217\u8868\u4e2d\uff0c\u53ef\u4ee5\u5bf9\u7c89\u4e1d\u8fdb\u884c\u201c\u559c\u6b22\u64cd\u4f5c\u201d\u3002 \u6587\u6863\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/917","title":"2.5\u3001 \u559c\u6b22\u7c89\u4e1d"},{"location":"tantan/day09/#251mycentercontroller","text":"//com.tanhua.server.controller.MyCenterController /** * \u5173\u6ce8\u7c89\u4e1d * * @param userId * @return */ @PostMapping ( \"fans/{uid}\" ) public ResponseEntity < Void > likeFan ( @PathVariable ( \"uid\" ) Long userId ){ try { this . myCenterService . likeFan ( userId ); return ResponseEntity . ok ( null ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"2.5.1\u3001MyCenterController"},{"location":"tantan/day09/#252mycenterservice","text":"//com.tanhua.server.service.MyCenterService @Autowired private TanHuaService tanHuaService ; /** * \u559c\u6b22 * * @param userId */ public void likeFan ( Long userId ) { //\u559c\u6b22\u7528\u6237\uff0c\u5982\u679c\u7528\u6237\u662f\u76f8\u4e92\u559c\u6b22\u7684\u8bdd\u5c31\u4f1a\u6210\u4e3a\u597d\u53cb this . tanHuaService . likeUser ( userId ); }","title":"2.5.2\u3001MyCenterService"},{"location":"tantan/day09/#253","text":"","title":"2.5.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day09/#3","text":"","title":"3\u3001\u7528\u6237\u901a\u7528\u8bbe\u7f6e"},{"location":"tantan/day09/#31","text":"CREATE TABLE ` tb_settings ` ( ` id ` bigint ( 20 ) NOT NULL AUTO_INCREMENT , ` user_id ` bigint ( 20 ) DEFAULT NULL , ` like_notification ` tinyint ( 4 ) DEFAULT '1' COMMENT '\u63a8\u9001\u559c\u6b22\u901a\u77e5' , ` pinglun_notification ` tinyint ( 4 ) DEFAULT '1' COMMENT '\u63a8\u9001\u8bc4\u8bba\u901a\u77e5' , ` gonggao_notification ` tinyint ( 4 ) DEFAULT '1' COMMENT '\u63a8\u9001\u516c\u544a\u901a\u77e5' , ` created ` datetime DEFAULT NULL , ` updated ` datetime DEFAULT NULL , PRIMARY KEY ( ` id ` ) ) ENGINE = InnoDB DEFAULT CHARSET = utf8 COMMENT = '\u8bbe\u7f6e\u8868' ;","title":"3.1\u3001\u8868\u7ed3\u6784"},{"location":"tantan/day09/#32pojo","text":"my-tanhua-common\u5de5\u7a0b\uff1a package com.tanhua.common.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class Settings extends BasePojo { private Long id ; private Long userId ; private Boolean likeNotification = true ; private Boolean pinglunNotification = true ; private Boolean gonggaoNotification = true ; }","title":"3.2\u3001pojo"},{"location":"tantan/day09/#33settingsmapper","text":"package com.tanhua.common.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.common.pojo.Settings ; public interface SettingsMapper extends BaseMapper < Settings > { }","title":"3.3\u3001SettingsMapper"},{"location":"tantan/day09/#34settingsservice","text":"package com.tanhua.server.service ; import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper ; import com.tanhua.common.mapper.SettingsMapper ; import com.tanhua.common.pojo.Settings ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; @Service public class SettingsService { @Autowired private SettingsMapper settingsMapper ; /** * \u6839\u636e\u7528\u6237id\u67e5\u8be2\u914d\u7f6e * * @param userId * @return */ public Settings querySettings ( Long userId ) { QueryWrapper < Settings > queryWrapper = new QueryWrapper <> (); queryWrapper . eq ( \"user_id\" , userId ); return this . settingsMapper . selectOne ( queryWrapper ); } }","title":"3.4\u3001SettingsService"},{"location":"tantan/day09/#35","text":"\u6587\u6863\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/893","title":"3.5\u3001\u67e5\u8be2\u914d\u7f6e"},{"location":"tantan/day09/#351settingsvo","text":"package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class SettingsVo { private Long id ; //\u964c\u751f\u4eba\u95ee\u9898 private String strangerQuestion = \"\" ; //\u624b\u673a\u53f7 private String phone ; //\u63a8\u9001\u559c\u6b22\u901a\u77e5 private Boolean likeNotification = true ; //\u63a8\u9001\u8bc4\u8bba\u901a\u77e5 private Boolean pinglunNotification = true ; //\u63a8\u9001\u516c\u544a\u901a\u77e5 private Boolean gonggaoNotification = true ; }","title":"3.5.1\u3001SettingsVo"},{"location":"tantan/day09/#352mycentercontroller","text":"//com.tanhua.server.controller.MyCenterController /** * \u67e5\u8be2\u914d\u7f6e * * @return */ @GetMapping ( \"settings\" ) public ResponseEntity < SettingsVo > querySettings () { try { SettingsVo settingsVo = this . myCenterService . querySettings (); if ( null != settingsVo ) { return ResponseEntity . ok ( settingsVo ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"3.5.2\u3001MyCenterController"},{"location":"tantan/day09/#353mycenterservice","text":"//com.tanhua.server.service.MyCenterService public SettingsVo querySettings () { SettingsVo settingsVo = new SettingsVo (); User user = UserThreadLocal . get (); //\u8bbe\u7f6e\u7528\u6237\u7684\u57fa\u672c\u4fe1\u606f settingsVo . setId ( user . getId ()); settingsVo . setPhone ( user . getMobile ()); //\u67e5\u8be2\u7528\u6237\u7684\u914d\u7f6e\u6570\u636e Settings settings = this . settingsService . querySettings ( user . getId ()); if ( ObjectUtil . isNotEmpty ( settings )){ settingsVo . setGonggaoNotification ( settings . getGonggaoNotification ()); settingsVo . setLikeNotification ( settings . getLikeNotification ()); settingsVo . setPinglunNotification ( settings . getPinglunNotification ()); } //\u67e5\u8be2\u964c\u751f\u4eba\u95ee\u9898 settingsVo . setStrangerQuestion ( this . tanHuaService . queryQuestion ( user . getId ())); return settingsVo ; }","title":"3.5.3\u3001MyCenterService"},{"location":"tantan/day09/#254","text":"","title":"2.5.4\u3001\u6d4b\u8bd5"},{"location":"tantan/day09/#36","text":"\u6587\u6863\u5730\u5740\uff1ahttps://mock-java.itheima.net/project/35/interface/api/929","title":"3.6\u3001\u4fdd\u5b58\u964c\u751f\u4eba\u95ee\u9898"},{"location":"tantan/day09/#361mycentercontroller","text":"//com.tanhua.server.controller.MyCenterController /** * \u8bbe\u7f6e\u964c\u751f\u4eba\u95ee\u9898 * * @return */ @PostMapping ( \"questions\" ) public ResponseEntity < Void > saveQuestions ( @RequestBody Map < String , String > param ) { try { String content = param . get ( \"content\" ); this . myCenterService . saveQuestions ( content ); return ResponseEntity . ok ( null ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"3.6.1\u3001MyCenterController"},{"location":"tantan/day09/#362mycenterservice","text":"//com.tanhua.server.service.MyCenterService public void saveQuestions ( String content ) { User user = UserThreadLocal . get (); this . questionService . save ( user . getId (), content ); }","title":"3.6.2\u3001MyCenterService"},{"location":"tantan/day09/#363questionservice","text":"//com.tanhua.server.service.QuestionService public void save ( Long userId , String content ) { Question question = this . queryQuestion ( userId ); if ( null != question ){ question . setTxt ( content ); this . questionMapper . updateById ( question ); } else { question = new Question (); question . setUserId ( userId ); question . setTxt ( content ); question . setCreated ( new Date ()); question . setUpdated ( question . getCreated ()); this . questionMapper . insert ( question ); } }","title":"3.6.3\u3001QuestionService"},{"location":"tantan/day09/#37","text":"\u9ed1\u540d\u5355\u529f\u80fd\u53ef\u4ee5\u7528\u5728\u964c\u751f\u4eba\u6253\u62db\u547c\u65f6\uff0c\u8fdb\u884c\u5224\u65ad\uff0c\u5982\u679c\u662f\u9ed1\u540d\u5355\u7684\u5219\u4e0d\u80fd\u6253\u62db\u547c\u3002 \u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/935","title":"3.7\u3001\u9ed1\u540d\u5355\u5217\u8868"},{"location":"tantan/day09/#371","text":"CREATE TABLE ` tb_black_list ` ( ` id ` bigint ( 20 ) NOT NULL AUTO_INCREMENT , ` user_id ` bigint ( 20 ) DEFAULT NULL , ` black_user_id ` bigint ( 20 ) DEFAULT NULL , ` created ` datetime DEFAULT NULL , ` updated ` datetime DEFAULT NULL , PRIMARY KEY ( ` id ` ), KEY ` user_id ` ( ` user_id ` ) ) ENGINE = InnoDB DEFAULT CHARSET = utf8 COMMENT = '\u9ed1\u540d\u5355' ; --\u6d4b\u8bd5\u6570\u636e INSERT INTO ` tb_black_list ` ( ` id ` , ` user_id ` , ` black_user_id ` , ` created ` , ` updated ` ) VALUES ( '1' , '1' , '22' , '2019-11-01 15:47:22' , '2019-11-01 15:47:24' ); INSERT INTO ` tb_black_list ` ( ` id ` , ` user_id ` , ` black_user_id ` , ` created ` , ` updated ` ) VALUES ( '2' , '1' , '23' , '2019-11-01 15:47:39' , '2019-11-01 15:47:42' ); INSERT INTO ` tb_black_list ` ( ` id ` , ` user_id ` , ` black_user_id ` , ` created ` , ` updated ` ) VALUES ( '3' , '1' , '24' , '2019-11-01 15:47:51' , '2019-11-01 15:47:56' );","title":"3.7.1\u3001\u8868\u7ed3\u6784"},{"location":"tantan/day09/#372pojo","text":"package com.tanhua.common.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @NoArgsConstructor @AllArgsConstructor public class BlackList extends BasePojo { private Long id ; private Long userId ; private Long blackUserId ; }","title":"3.7.2\u3001pojo"},{"location":"tantan/day09/#373blacklistmapper","text":"package com.tanhua.common.mapper ; import com.baomidou.mybatisplus.core.mapper.BaseMapper ; import com.tanhua.common.pojo.BlackList ; public interface BlackListMapper extends BaseMapper < BlackList > { }","title":"3.7.3\u3001BlackListMapper"},{"location":"tantan/day09/#374blacklistservice","text":"package com.tanhua.server.service ; import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper ; import com.baomidou.mybatisplus.core.metadata.IPage ; import com.baomidou.mybatisplus.extension.plugins.pagination.Page ; import com.tanhua.common.mapper.BlackListMapper ; import com.tanhua.common.pojo.BlackList ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; @Service public class BlackListService { @Autowired private BlackListMapper blackListMapper ; public IPage < BlackList > queryBlacklist ( Long userId , Integer page , Integer pageSize ) { QueryWrapper < BlackList > wrapper = new QueryWrapper < BlackList > (); wrapper . eq ( \"user_id\" , userId ); wrapper . orderByDesc ( \"created\" ); Page < BlackList > pager = new Page <> ( page , pageSize ); return this . blackListMapper . selectPage ( pager , wrapper ); } } \u914d\u7f6e\u5206\u9875\u63d2\u4ef6\uff1a package com.tanhua.server.config ; import com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor ; import org.springframework.context.annotation.Bean ; import org.springframework.context.annotation.Configuration ; @Configuration public class MybatisPlusConfig { /** * \u5206\u9875\u63d2\u4ef6 */ @Bean public PaginationInterceptor paginationInterceptor () { return new PaginationInterceptor (); } }","title":"3.7.4\u3001BlackListService"},{"location":"tantan/day09/#375blacklistvo","text":"package com.tanhua.server.vo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; @Data @AllArgsConstructor @NoArgsConstructor public class BlackListVo { private Long id ; private String avatar ; private String nickname ; private String gender ; private Integer age ; }","title":"3.7.5\u3001BlackListVo"},{"location":"tantan/day09/#376mycentercontroller","text":"//com.tanhua.server.controller.MyCenterController /** * \u67e5\u8be2\u9ed1\u540d\u5355 * * @param page * @param pagesize * @return */ @GetMapping ( \"blacklist\" ) public ResponseEntity < PageResult > queryBlacklist ( @RequestParam ( value = \"page\" , defaultValue = \"1\" ) Integer page , @RequestParam ( value = \"pagesize\" , defaultValue = \"10\" ) Integer pagesize ) { try { PageResult pageResult = this . myCenterService . queryBlacklist ( page , pagesize ); return ResponseEntity . ok ( pageResult ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"3.7.6\u3001MyCenterController"},{"location":"tantan/day09/#377mycenterservice","text":"//com.tanhua.server.service.MyCenterService public PageResult queryBlacklist ( Integer page , Integer pageSize ) { User user = UserThreadLocal . get (); IPage < BlackList > blackListIPage = this . blackListService . queryBlacklist ( user . getId (), page , pageSize ); PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); pageResult . setCounts ( Convert . toInt ( blackListIPage . getTotal ())); pageResult . setPages ( Convert . toInt ( blackListIPage . getPages ())); List < BlackList > records = blackListIPage . getRecords (); if ( CollUtil . isEmpty ( records )){ return pageResult ; } List < Object > userIds = CollUtil . getFieldValues ( records , \"blackUserId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); List < BlackListVo > blackListVos = new ArrayList <> (); for ( UserInfo userInfo : userInfoList ) { BlackListVo blackListVo = new BlackListVo (); blackListVo . setAge ( userInfo . getAge ()); blackListVo . setAvatar ( userInfo . getLogo ()); blackListVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); blackListVo . setId ( userInfo . getUserId ()); blackListVo . setNickname ( userInfo . getNickName ()); blackListVos . add ( blackListVo ); } pageResult . setItems ( blackListVos ); return pageResult ; }","title":"3.7.7\u3001MyCenterService"},{"location":"tantan/day09/#378","text":"","title":"3.7.8\u3001\u6d4b\u8bd5"},{"location":"tantan/day09/#38","text":"\u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/941","title":"3.8\u3001\u79fb\u9664\u9ed1\u540d\u5355"},{"location":"tantan/day09/#381mycentercontroller","text":"/** * \u79fb\u9664\u9ed1\u540d\u5355 * * @return */ @DeleteMapping ( \"blacklist/{uid}\" ) public ResponseEntity < Void > delBlacklist ( @PathVariable ( \"uid\" ) Long userId ) { try { this . myCenterService . delBlacklist ( userId ); return ResponseEntity . ok ( null ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"3.8.1\u3001MyCenterController"},{"location":"tantan/day09/#382mycenterservice","text":"public void delBlacklist ( Long userId ) { User user = UserThreadLocal . get (); this . blackListService . delBlacklist ( user . getId (), userId ); }","title":"3.8.2\u3001MyCenterService"},{"location":"tantan/day09/#383blacklistservice","text":"public Boolean delBlacklist ( Long userId , Long blackUserId ) { QueryWrapper < BlackList > wrapper = new QueryWrapper < BlackList > (); wrapper . eq ( \"user_id\" , userId ). eq ( \"black_user_id\" , blackUserId ); return this . blackListMapper . delete ( wrapper ) > 0 ; }","title":"3.8.3\u3001BlackListService"},{"location":"tantan/day09/#39","text":"\u63a5\u53e3\u6587\u6863\uff1ahttps://mock-java.itheima.net/project/35/interface/api/965","title":"3.9\u3001\u66f4\u65b0\u901a\u77e5"},{"location":"tantan/day09/#391mycentercontroller","text":"//com.tanhua.server.controller.MyCenterController /** * \u66f4\u65b0\u901a\u77e5\u8bbe\u7f6e * * @param param * @return */ @PostMapping ( \"notifications/setting\" ) public ResponseEntity < Void > updateNotification ( @RequestBody Map < String , Boolean > param ) { try { Boolean likeNotification = param . get ( \"likeNotification\" ); Boolean pinglunNotification = param . get ( \"pinglunNotification\" ); Boolean gonggaoNotification = param . get ( \"gonggaoNotification\" ); this . usersService . updateNotification ( likeNotification , pinglunNotification , gonggaoNotification ); return ResponseEntity . ok ( null ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); }","title":"3.9.1\u3001MyCenterController"},{"location":"tantan/day09/#292mycenterservice","text":"//com.tanhua.server.service.MyCenterService public void updateNotification ( Boolean likeNotification , Boolean pinglunNotification , Boolean gonggaoNotification ) { User user = UserThreadLocal . get (); this . settingsService . updateNotification ( user . getId (), likeNotification , pinglunNotification , gonggaoNotification ); }","title":"2.9.2\u3001MyCenterService"},{"location":"tantan/day09/#293settingsservice","text":"//com.tanhua.server.service.SettingsService public void updateNotification ( Long userId , Boolean likeNotification , Boolean pinglunNotification , Boolean gonggaoNotification ) { QueryWrapper < Settings > queryWrapper = new QueryWrapper <> (); queryWrapper . eq ( \"user_id\" , userId ); Settings settings = this . settingsMapper . selectOne ( queryWrapper ); if ( null == settings ){ //\u5982\u679c\u6ca1\u6709\u6570\u636e\u7684\u8bdd\uff0c\u63d2\u5165\u4e00\u6761\u6570\u636e settings = new Settings (); settings . setUserId ( userId ); this . settingsMapper . insert ( settings ); } else { //\u66f4\u65b0 settings . setLikeNotification ( likeNotification ); settings . setPinglunNotification ( pinglunNotification ); settings . setGonggaoNotification ( gonggaoNotification ); this . settingsMapper . update ( settings , queryWrapper ); } }","title":"2.9.3\u3001SettingsService"},{"location":"tantan/day09/#310","text":"\u66f4\u65b0\u624b\u673a\u53f7\u7684\u903b\u8f91\u5728sso\u7cfb\u7edf\u4e2d\u5b8c\u6210\uff0c\u5176\u6d41\u7a0b\u662f\uff1a\u65e7\u624b\u673a\u53f7\u83b7\u53d6\u9a8c\u8bc1\u7801\uff0c\u9a8c\u8bc1\u7801\u6821\u9a8c\u901a\u8fc7\u540e\uff0c\u8bbe\u7f6e\u65b0\u624b\u673a\u53f7\uff0c\u6700\u540e\u4fdd\u5b58\u65b0\u7684\u624b\u673a\u53f7\u3002 \u6b65\u9aa41\uff0c\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\uff1ahttps://mock-java.itheima.net/project/35/interface/api/947 \u6b65\u9aa42\uff0c\u6821\u9a8c\u9a8c\u8bc1\u7801\uff1ahttps://mock-java.itheima.net/project/35/interface/api/953 \u6b65\u9aa43\uff0c\u4fdd\u5b58\u65b0\u624b\u673a\u53f7\uff1ahttps://mock-java.itheima.net/project/35/interface/api/959 \u914d\u7f6enginx\uff1a location /users/phone { #\u8bf7\u6c42\u8def\u5f84\u4e2d\u51e1\u662f\u4ee5/user/phone\u5f00\u5934\u7684\u8bf7\u6c42\uff0c\u8f6c\u53d1\u5230sso\u7cfb\u7edf client_max_body_size 300m ; #\u8bbe\u7f6e\u6700\u5927\u7684\u8bf7\u6c42\u4f53\u5927\u5c0f\uff0c\u89e3\u51b3\u5927\u6587\u4ef6\u4e0a\u4f20\u4e0d\u4e86\u7684\u95ee\u9898 proxy_connect_timeout 300s ; #\u4ee3\u7406\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4 proxy_send_timeout 300s ; #\u4ee3\u7406\u53d1\u9001\u6570\u636e\u7684\u8d85\u65f6\u65f6\u95f4 proxy_read_timeout 300s ; #\u4ee3\u7406\u8bfb\u53d6\u6570\u636e\u7684\u8d85\u65f6\u65f6\u95f4 proxy_pass http://127.0.0.1:18080 ; #\u8f6c\u53d1\u8bf7\u6c42 }","title":"3.10\u3001\u66f4\u65b0\u624b\u673a\u53f7"},{"location":"tantan/day09/#3101","text":"MyCenterController: //com.tanhua.sso.controller.MyCenterController /** * \u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801 * * @return */ @PostMapping ( \"phone/sendVerificationCode\" ) public ResponseEntity < Void > sendVerificationCode ( @RequestHeader ( \"Authorization\" ) String token ) { try { boolean bool = this . myCenterService . sendVerificationCode ( token ); if ( bool ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } MyCenterService: //com.tanhua.sso.service.MyCenterService package com.tanhua.sso.service ; import com.tanhua.common.pojo.User ; import com.tanhua.sso.vo.ErrorResult ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; @Service public class MyCenterService { @Autowired private UserService userService ; @Autowired private SmsService smsService ; public Boolean sendVerificationCode ( String token ) { //\u6821\u9a8ctoken User user = this . userService . queryUserByToken ( token ); if ( ObjectUtil . isEmpty ( user )){ return false ; } ErrorResult errorResult = this . smsService . sendCheckCode ( user . getMobile ()); return errorResult == null ; } }","title":"3.10.1\u3001 \u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801"},{"location":"tantan/day09/#3102","text":"MyCenterController\uff1a //com.tanhua.sso.controller.MyCenterController /** * \u6821\u9a8c\u9a8c\u8bc1\u7801 * * @param param * @param token * @return */ @PostMapping ( \"phone/checkVerificationCode\" ) public ResponseEntity < Map < String , Object >> checkVerificationCode ( @RequestBody Map < String , String > param , @RequestHeader ( \"Authorization\" ) String token ) { try { String code = param . get ( \"verificationCode\" ); Boolean bool = this . myCenterService . checkVerificationCode ( code , token ); Map < String , Object > result = new HashMap <> (); result . put ( \"verification\" , bool ); return ResponseEntity . ok ( result ); } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } MyCenterService\uff1a //com.tanhua.sso.service.MyCenterService public Boolean checkVerificationCode ( String code , String token ) { //\u6821\u9a8ctoken User user = this . userService . queryUserByToken ( token ); if ( ObjectUtil . isEmpty ( user )){ return false ; } //\u6821\u9a8c\u9a8c\u8bc1\u7801\uff0c\u5148\u67e5\u8be2redis\u4e2d\u7684\u9a8c\u8bc1\u7801 String redisKey = \"CHECK_CODE_\" + user . getMobile (); String value = this . redisTemplate . opsForValue (). get ( redisKey ); if ( StrUtil . equals ( code , value )){ //\u5c06\u9a8c\u8bc1\u7801\u5220\u9664 this . redisTemplate . delete ( redisKey ); return true ; } return false ; }","title":"3.10.2\u3001 \u6821\u9a8c\u9a8c\u8bc1\u7801"},{"location":"tantan/day09/#3103","text":"MyCenterController\uff1a //com.tanhua.sso.controller.MyCenterController /** * \u4fdd\u5b58\u65b0\u624b\u673a\u53f7 * * @return */ @PostMapping ( \"phone\" ) public ResponseEntity < Void > updatePhone ( @RequestBody Map < String , String > param , @RequestHeader ( \"Authorization\" ) String token ) { try { String newPhone = param . get ( \"phone\" ); boolean bool = this . myCenterService . updatePhone ( token , newPhone ); if ( bool ) { return ResponseEntity . ok ( null ); } } catch ( Exception e ) { e . printStackTrace (); } return ResponseEntity . status ( HttpStatus . INTERNAL_SERVER_ERROR ). build (); } MyCenterService\uff1a //com.tanhua.sso.service.MyCenterService public Boolean updatePhone ( String token , String newPhone ) { //\u6821\u9a8ctoken User user = this . userService . queryUserByToken ( token ); if ( ObjectUtil . isEmpty ( user )){ return false ; } Boolean result = this . userService . updatePhone ( user . getId (), newPhone ); if ( result ){ String redisKey = \"TANHUA_USER_MOBILE_\" + user . getId (); this . redisTemplate . delete ( redisKey ); } return result ; } UserService\uff1a //com.tanhua.sso.service.UserService public Boolean updatePhone ( Long userId , String newPhone ) { //\u5148\u67e5\u8be2\u65b0\u624b\u673a\u53f7\u662f\u5426\u5df2\u7ecf\u6ce8\u518c\uff0c\u5982\u679c\u5df2\u7ecf\u6ce8\u518c\uff0c\u5c31\u4e0d\u80fd\u4fee\u6539 QueryWrapper < User > queryWrapper = new QueryWrapper <> (); queryWrapper . eq ( \"mobile\" , newPhone ); User user = this . userMapper . selectOne ( queryWrapper ); if ( ObjectUtil . isNotEmpty ( user )){ //\u65b0\u624b\u673a\u53f7\u5df2\u7ecf\u88ab\u6ce8\u518c return false ; } user = new User (); user . setId ( userId ); user . setMobile ( newPhone ); return this . userMapper . updateById ( user ) > 0 ; }","title":"3.10.3\u3001\u4fdd\u5b58\u65b0\u624b\u673a\u53f7"},{"location":"tantan/day09/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/","text":"\u72ec\u7acb\u5b9e\u73b0\u6211\u7684\u559c\u6b22\u529f\u80fd \u72ec\u7acb\u5b9e\u73b0\u7528\u6237\u901a\u7528\u8bbe\u7f6e \u72ec\u7acb\u5b9e\u73b0\u9ed1\u540d\u5355\u529f\u80fd \u72ec\u7acb\u5b9e\u73b0\u4fee\u6539\u624b\u673a\u53f7\u529f\u80fd","title":"\u5b66\u4e60\u76ee\u6807"},{"location":"tantan/day10/","text":"\u8bfe\u7a0b\u8bf4\u660e \u00b6 \u4e86\u89e3\u63a8\u8350\u7cfb\u7edf \u5b9e\u73b0\u597d\u53cb\u7684\u63a8\u8350 \u5708\u5b50\u63a8\u8350\u529f\u80fd\u8bf4\u660e \u5708\u5b50\u63a8\u8350\u529f\u80fd\u6d41\u7a0b \u5708\u5b50\u63a8\u8350\u529f\u80fd\u7684\u5b9e\u73b0 \u5c0f\u89c6\u9891\u63a8\u8350\u529f\u80fd\u7684\u5b9e\u73b0 1\u3001\u4e86\u89e3\u63a8\u8350\u7cfb\u7edf \u00b6 1.1\u3001\u4ec0\u4e48\u662f\u63a8\u8350\u7cfb\u7edf\uff1f \u00b6 \u4e3a\u4e86\u89e3\u51b3\u4fe1\u606f\u8fc7\u8f7d\u548c\u7528\u6237\u65e0\u660e\u786e\u9700\u6c42\u7684\u95ee\u9898\uff0c\u627e\u5230\u7528\u6237\u611f\u5174\u8da3\u7684\u7269\u54c1\uff0c\u624d\u6709\u4e86\u4e2a\u6027\u5316\u63a8\u8350\u7cfb\u7edf\u3002 \u5176\u5b9e\uff0c\u89e3\u51b3\u4fe1\u606f\u8fc7\u8f7d\u7684\u95ee\u9898\uff0c\u4ee3\u8868\u6027\u7684\u89e3\u51b3\u65b9\u6848\u662f\u5206\u7c7b\u76ee\u5f55\u548c\u641c\u7d22\u5f15\u64ce\uff0c\u5982hao123\uff0c\u7535\u5546\u9996\u9875\u7684\u5206\u7c7b\u76ee\u5f55\u4ee5\u53ca\u767e\u5ea6\uff0c360\u641c\u7d22\u7b49\u3002 \u4e0d\u8fc7\u5206\u7c7b\u76ee\u5f55\u548c\u641c\u7d22\u5f15\u64ce\u53ea\u80fd\u89e3\u51b3\u7528\u6237\u4e3b\u52a8\u67e5\u627e\u4fe1\u606f\u7684\u9700\u6c42\uff0c\u5373\u7528\u6237\u77e5\u9053\u81ea\u5df1\u60f3\u8981\u4ec0\u4e48\uff0c\u5e76\u4e0d\u80fd\u89e3\u51b3\u7528\u6237\u6ca1\u7528\u660e\u786e\u9700\u6c42\u5f88\u968f\u4fbf\u7684\u95ee\u9898\u3002 \u7ecf\u5178\u8bed\u5f55\u662f\uff1a\u4f60\u60f3\u5403\u4ec0\u4e48\uff0c\u968f\u4fbf\uff01\u9762\u5bf9\u8fd9\u79cd\u5f88\u968f\u4fbf\u53c8\u5f97\u7f6a\u4e0d\u8d77\u7684\u7528\u6237\uff08\u5973\u53cb\u548c\u4e0a\u5e1d\uff09\uff0c\u53ea\u80fd \u901a\u8fc7\u5206\u6790\u7528\u6237\u7684\u5386\u53f2\u884c\u4e3a\u7ed9\u7528\u6237\u7684\u5174\u8da3\u5efa\u6a21 \uff0c\u4ece\u800c\u4e3b\u52a8\u7ed9\u7528\u6237\u63a8\u8350\u80fd\u591f\u6ee1\u8db3\u4ed6\u4eec\u5174\u8da3\u548c\u9700\u6c42\u7684\u4fe1\u606f\u3002\u6bd4\u5982\u95ee\u95ee\u5973\u53cb\u7684\u95fa\u871c\uff0c\u5979\u4e00\u822c\u4ec0\u4e48\u65f6\u5019\u559c\u6b22\u5403\u4ec0\u4e48\u3002 1.2\u3001\u7535\u5546\u662f\u63a8\u8350\u7cfb\u7edf\u7684\u5148\u884c\u8005 \u00b6 [ ] \u7535\u5b50\u5546\u52a1\u7f51\u7ad9\u662f\u4e2a\u6027\u5316\u63a8\u8350\u7cfb\u7edf\u91cd\u8981\u5730\u5e94\u7528\u7684\u9886\u57df\u4e4b\u4e00\uff0c\u4e9a\u9a6c\u900a\u5c31\u662f\u4e2a\u6027\u5316\u63a8\u8350\u7cfb\u7edf\u7684\u79ef\u6781\u5e94\u7528\u8005\u548c\u63a8\u5e7f\u8005\uff0c\u4e9a\u9a6c\u900a\u7684\u63a8\u8350\u7cfb\u7edf\u6df1\u5165\u5230\u7f51\u7ad9\u7684\u5404\u7c7b\u5546\u54c1\uff0c\u4e3a\u4e9a\u9a6c\u900a\u5e26\u6765\u4e86\u81f3\u5c1130%\u7684\u9500\u552e\u989d\u3002 [ ] \u4e0d\u5149\u662f\u7535\u5546\u7c7b\uff0c\u63a8\u8350\u7cfb\u7edf\u65e0\u5904\u4e0d\u5728\u3002QQ\uff0c\u5fae\u4fe1\u7684\u597d\u53cb\u63a8\u8350\uff1b\u65b0\u6d6a\u5fae\u535a\u7684\u4f60\u53ef\u80fd\u611f\u5174\u8da3\u7684\u4eba\uff1b\u4f18\u9177\uff0c\u571f\u8c46\u7684\u7535\u5f71\u63a8\u8350\uff1b\u8c46\u74e3\u7684\u56fe\u4e66\u63a8\u8350\uff1b\u5927\u4ece\u70b9\u8bc4\u7684\u9910\u996e\u63a8\u8350\uff1b\u8109\u8109\u7684\u540c\u4e8b\u63a8\u8350\u7b49\u3002 [ ] \u63a8\u8350\u5f15\u64ce\u7684\u9f3b\u7956\u601d\u60f3\u6e90\u6cc9\uff1ahttp://portal.acm.org/citation.cfm?id=1070751 [ ] \u4e9a\u9a6c\u900a\u6700\u65e9\u63d0\u51fa\u57fa\u4e8d\u7269\u54c1\u7684\u534f\u540c\u8fc7\u6ee4\u63a8\u8350\u7b97\u6cd5\uff1ahttp://portal.acm.org/citation.cfm?id=372071 \u4eac\u4e1c\u7684\u63a8\u8350\uff1a 1.3\u3001\u63a8\u8350\u7cfb\u7edf\u4e1a\u52a1\u6d41\u7a0b \u00b6 \u63a8\u8350\u7cfb\u7edf\u5e7f\u6cdb\u5b58\u5728\u4e8e\u5404\u7c7b\u7f51\u7ad9\u4e2d\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u5e94\u7528\u4e3a\u7528\u6237\u63d0\u4f9b\u4e2a\u6027\u5316\u7684\u63a8\u8350\u3002\u5b83\u9700\u8981\u4e00\u4e9b\u7528\u6237\u7684\u5386\u53f2\u6570\u636e\uff0c\u4e00\u822c\u7531\u4e09\u4e2a\u90e8\u5206\u7ec4\u6210\uff1a\u57fa\u7840\u6570\u636e\u3001\u63a8\u8350\u7b97\u6cd5\u7cfb\u7edf\u3001\u524d\u53f0\u5c55\u793a\u3002 \u57fa\u7840\u6570\u636e\u5305\u62ec\u5f88\u591a\u7ef4\u5ea6\uff0c\u5305\u62ec\u7528\u6237\u7684\u8bbf\u95ee\u3001\u6d4f\u89c8\u3001\u4e0b\u5355\u3001\u6536\u85cf\uff0c\u7528\u6237\u7684\u5386\u53f2\u8ba2\u5355\u4fe1\u606f\uff0c\u8bc4\u4ef7\u4fe1\u606f\u7b49\u5f88\u591a\u4fe1\u606f\uff1b \u63a8\u8350\u7b97\u6cd5\u7cfb\u7edf\u4e3b\u8981\u662f\u6839\u636e\u4e0d\u540c\u7684\u63a8\u8350\u8bc9\u6c42\u7531\u591a\u4e2a\u7b97\u6cd5\u7ec4\u6210\u7684\u63a8\u8350\u6a21\u578b\uff1b \u524d\u53f0\u5c55\u793a\u4e3b\u8981\u662f\u5bf9\u5ba2\u6237\u7aef\u7cfb\u7edf\u8fdb\u884c\u54cd\u5e94\uff0c\u8fd4\u56de\u76f8\u5173\u7684\u63a8\u8350\u4fe1\u606f\u4ee5\u4f9b\u5c55\u793a\u3002 1.4\u3001\u534f\u540c\u8fc7\u6ee4\u63a8\u8350\u7b97\u6cd5 \u00b6 \u8fc4\u4eca\u4e3a\u6b62\uff0c\u5728\u4e2a\u6027\u5316\u63a8\u8350\u7cfb\u7edf\u4e2d\uff0c\u534f\u540c\u8fc7\u6ee4\u6280\u672f\u662f\u5e94\u7528\u6700\u6210\u529f\u7684\u6280\u672f\u3002\u76ee\u524d\u56fd\u5185\u5916\u6709\u8bb8\u591a\u5927\u578b\u7f51\u7ad9\u5e94\u7528\u8fd9\u9879\u6280\u672f\u4e3a\u7528\u6237\u66f4\u52a0\u667a\u80fd\uff08\u4e2a\u6027\u5316\u3001\u5343\u4eba\u5343\u9762\uff09\u7684\u63a8\u8350\u5185\u5bb9\u3002 \u6838\u5fc3\u601d\u60f3\uff1a \u534f\u540c\u8fc7\u6ee4\u4e00\u822c\u662f\u5728\u6d77\u91cf\u7684\u7528\u6237\u4e2d\u53d1\u6398\u51fa\u4e00\u5c0f\u90e8\u5206\u548c\u4f60\u54c1\u4f4d\u6bd4\u8f83\u7c7b\u4f3c\u7684\uff0c\u5728\u534f\u540c\u8fc7\u6ee4\u4e2d\uff0c\u8fd9\u4e9b\u7528\u6237\u6210\u4e3a\u90bb\u5c45\uff0c\u7136\u540e\u6839\u636e\u4ed6\u4eec\u559c\u6b22\u7684\u5176\u4ed6\u4e1c\u897f\u7ec4\u7ec7\u6210\u4e00\u4e2a\u6392\u5e8f\u7684\u76ee\u5f54\u4f5c\u4e3a\u63a8\u8350\u7ed9\u4f60\u3002 1.4.1\u3001\u57fa\u4e8e\u7528\u6237\u7684\u63a8\u8350 UserCF \u00b6 \u5bf9\u4e8e\u7528\u6237A\uff0c\u6839\u636e\u7528\u6237\u7684\u5386\u53f2\u504f\u597d\uff0c\u8fd9\u91cc\u53ea\u8ba1\u7b97\u5f97\u5230\u4e00\u4e2a\u90bb\u5c45\u2013\u7528\u6237C\uff0c\u7136\u540e\u5c06\u7528\u6237C \u559c\u6b22\u7684\u7269\u54c1D \u63a8\u8350\u7ed9\u7528\u6237A\u3002 \u57fa\u4e8e\u7528\u6237\u7684\u534f\u540c\u8fc7\u6ee4\u7b97\u6cd5\u5148\u8ba1\u7b97\u7684\u662f\u7528\u6237\u4e0e\u7528\u6237\u7684\u76f8\u4f3c\u5ea6\uff08\u5174\u8da3\u76f8\u6295\uff0c\u7269\u4ee5\u7c7b\u805a\u4eba\u4ee5\u7fa4\u5206\uff09\uff0c\u7136\u540e\u5c06\u76f8\u4f3c\u5ea6\u6bd4\u8f83\u63a5\u8fd1\u7684\u7528\u6237A\u8d2d\u4e70\u7684\u7269\u54c1\u63a8\u8350\u7ed9\u7528\u6237B\uff0c\u4e13\u4e1a\u7684\u8bf4\u6cd5\u662f\u8be5\u7b97\u6cd5\u7528\u6700\u8fd1\u90bb\u5c45\uff08nearest-neighbor\uff09\u7b97\u6cd5\u627e\u51fa\u4e00\u4e2a\u7528\u6237\u7684\u90bb\u5c45\u96c6\u5408\uff0c\u8be5\u96c6\u5408\u7684\u7528\u6237\u548c\u8be5\u7528\u6237\u6709\u76f8\u4f3c\u7684\u559c\u597d\uff0c\u7b97\u6cd5\u6839\u636e\u90bb\u5c45\u7684\u504f\u597d\u5bf9\u8be5\u7528\u6237\u8fdb\u884c\u9884\u6d4b\u3002 1.4.2\u3001\u57fa\u4e8e\u5546\u54c1\u7684\u63a8\u8350 ItemCF \u00b6 \u57fa\u4e8eItemCF\u7684\u539f\u7406\u548c\u57fa\u4e8eUserCF\u7c7b\u4f3c\uff0c\u53ea\u662f\u5728\u8ba1\u7b97\u90bb\u5c45\u65f6\u91c7\u7528\u7269\u54c1\u672c\u8eab\uff0c\u800c\u4e0d\u662f\u4ece\u7528\u6237\u7684\u89d2\u5ea6\uff0c\u5373\u57fa\u4e8e\u7528\u6237\u5bf9\u7269\u54c1\u7684\u504f\u597d\u627e\u5230\u76f8\u4f3c\u7684\u7269\u54c1\uff0c\u7136\u540e\u6839\u636e\u7528\u6237\u7684\u5386\u53f2\u504f\u597d\uff0c\u63a8\u8350\u76f8\u4f3c\u7684\u7269\u54c1\u7ed9\u4ed6\u3002 \u4ece\u8ba1\u7b97\u7684\u89d2\u5ea6\u770b\uff0c\u5c31\u662f\u5c06\u6240\u6709\u7528\u6237\u5bf9\u67d0\u4e2a\u7269\u54c1\u7684\u504f\u597d\u4f5c\u4e3a\u4e00\u4e2a\u5411\u91cf\u6765\u8ba1\u7b97\u7269\u54c1\u4e4b\u95f4\u7684\u76f8\u4f3c\u5ea6\uff0c\u5f97\u5230\u7269\u54c1\u7684\u76f8\u4f3c\u7269\u54c1\u540e\uff0c\u6839\u636e\u7528\u6237\u5386\u53f2\u7684\u504f\u597d\u9884\u6d4b\u5f53\u524d\u7528\u6237\u8fd8\u6ca1\u6709\u8868\u793a\u504f\u597d\u7684\u7269\u54c1\uff0c\u8ba1\u7b97\u5f97\u5230\u4e00\u4e2a\u6392\u5e8f\u7684\u7269\u54c1\u5217\u8868\u4f5c\u4e3a\u63a8\u8350\u3002 \u89e3\u91ca\uff1a\u5bf9\u4e8e\u7269\u54c1A\uff0c\u6839\u636e\u6240\u6709\u7528\u6237\u7684\u5386\u53f2\u504f\u597d\uff0c\u559c\u6b22\u7269\u54c1A \u7684\u7528\u6237\u90fd\u559c\u6b22\u7269\u54c1C\uff0c\u5f97\u51fa\u7269\u54c1A \u548c\u7269\u54c1C \u6bd4\u8f83\u76f8\u4f3c\uff0c\u800c\u7528\u6237C \u559c\u6b22\u7269\u54c1A\uff0c\u90a3\u4e48\u53ef\u4ee5\u63a8\u65ad\u51fa\u7528\u6237C \u53ef\u80fd\u4e5f\u559c\u6b22\u7269\u54c1C\u3002 1.5\u3001ALS\u7b97\u6cd5 \u00b6 ALS \u662f\u4ea4\u66ff\u6700\u5c0f\u4e8c\u4e58 \uff08alternating least squares\uff09\u7684\u7b80\u79f0\u3002\u5728\u673a\u5668\u5b66\u4e60\u7684\u4e0a\u4e0b\u6587\u4e2d\uff0cALS \u7279\u6307\u4f7f\u7528\u4ea4\u66ff\u6700\u5c0f\u4e8c\u4e58\u6c42\u89e3\u7684\u4e00\u4e2a\u534f\u540c\u63a8\u8350\u7b97\u6cd5\u3002\u5b83\u901a\u8fc7\u89c2\u5bdf\u5230\u7684\u6240\u6709\u7528\u6237\u7ed9\u4ea7\u54c1\u7684\u6253\u5206\uff0c\u6765\u63a8\u65ad\u6bcf\u4e2a\u7528\u6237\u7684\u559c\u597d\u5e76\u5411\u7528\u6237\u63a8\u8350\u9002\u5408\u7684\u4ea7\u54c1\u3002\u4ece\u534f\u540c\u8fc7\u6ee4\u7684\u5206\u7c7b\u6765\u8bf4\uff0cALS\u7b97\u6cd5\u5c5e\u4e8eUser-Item CF\uff0c\u4e5f\u53eb\u505a\u6df7\u5408CF\u3002\u5b83\u540c\u65f6\u8003\u8651\u4e86User\u548cItem\u4e24\u4e2a\u65b9\u9762\u3002 \u7528\u6237\u548c\u5546\u54c1\u7684\u5173\u7cfb\uff0c\u53ef\u4ee5\u62bd\u8c61\u4e3a\u5982\u4e0b\u7684\u4e09\u5143\u7ec4\uff1a \u3002\u5176\u4e2d\uff0cRating\u662f\u7528\u6237\u5bf9\u5546\u54c1\u7684\u8bc4\u5206\uff0c\u8868\u5f81\u7528\u6237\u5bf9\u8be5\u5546\u54c1\u7684\u559c\u597d\u7a0b\u5ea6\u3002\u5982\u4e0b\uff1a 196 242 3 881250949 186 302 3 891717742 22 377 1 878887116 244 51 2 880606923 166 346 1 886397596 298 474 4 884182806 115 265 2 881171488 253 465 5 891628467 305 451 3 886324817 6 86 3 883603013 62 257 2 879372434 286 1014 5 879781125 200 222 5 876042340 210 40 3 891035994 ................ 2\u3001\u597d\u53cb\u63a8\u8350 \u00b6 \u5bf9\u4e8e\u597d\u53cb\u7684\u63a8\u8350\uff0c\u9700\u8981\u627e\u51fa\u6bcf\u4e2a\u7528\u6237\u4e4b\u95f4\u7684\u76f8\u4f3c\u6027\uff0c\u5177\u4f53\u89c4\u5219\u5982\u4e0b\uff1a \u5b57\u6bb5 \u6743\u91cd\u5206 \u5e74\u9f84\u5dee 0-2\u5c81 30\u5206 3-5 20\u5206 5-10\u5c81 10\u5206 10\u5c81\u4ee5\u4e0a 0\u5206 \u6027\u522b \u5f02\u6027 30\u5206 \u540c\u6027 0\u5206 \u4f4d\u7f6e \u540c\u57ce 20\u5206 \u4e0d\u540c 0\u5206 \u5b66\u5386 \u76f8\u540c 20\u5206 \u4e0d\u540c 0\u5206 2.1\u3001\u6d41\u7a0b \u00b6 2.2\u3001\u90e8\u7f72\u597d\u53cb\u63a8\u8350\u670d\u52a1 \u00b6 #\u62c9\u53d6\u955c\u50cf docker pull registry.cn-hangzhou.aliyuncs.com/itcast/tanhua-spark-recommend-user:1.0.1 #\u521b\u5efa\u5bb9\u5668 docker create --name tanhua-spark-recommend-user \\ --env MONGODB_HOST = 192 .168.31.81 \\ --env MONGODB_PORT = 27017 \\ --env MONGODB_USERNAME = tanhua \\ --env MONGODB_PASSWORD = l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV \\ --env MONGODB_DATABASE = tanhua \\ --env MONGODB_COLLECTION = recommend_user \\ --env JDBC_URL = \"jdbc:mysql://192.168.31.81:3306/mytanhua?useUnicode=true&characterEncoding=utf8&autoReconnect=true&allowMultiQueries=true&useSSL=false\" \\ --env JDBC_DRIVER = com.mysql.jdbc.Driver \\ --env JDBC_USER = root \\ --env JDBC_PASSWORD = root \\ --env JDBC_TABLE = tb_user_info \\ --env SCHEDULE_PERIOD = 30 \\ registry.cn-hangzhou.aliyuncs.com/itcast/tanhua-spark-recommend-user:1.0.1 #\u53c2\u6570\u8bf4\u660e #MONGODB_HOST mongodb\u670d\u52a1\u7684\u5730\u5740 #MONGODB_PORT mongodb\u670d\u52a1\u7684\u7aef\u53e3 #MONGODB_USERNAME mongodb\u670d\u52a1\u7684\u8ba4\u8bc1\u7528\u6237\u540d #MONGODB_PASSWORD mongodb\u670d\u52a1\u7684\u8ba4\u8bc1\u5bc6\u7801 #MONGODB_DATABASE mongodb\u8fde\u63a5\u7684\u6570\u636e\u5e93 #MONGODB_COLLECTION \u64cd\u4f5c\u8868 #JDBC_URL mysql\u6570\u636e\u5e93\u8fde\u63a5\u5730\u5740 #JDBC_DRIVER jdbc\u9a71\u52a8 #JDBC_USER \u6570\u636e\u5e93\u8fde\u63a5\u7528\u6237\u540d #JDBC_PASSWORD \u6570\u636e\u5e93\u8fde\u63a5\u5bc6\u7801 #JDBC_TABLE \u6570\u636e\u5e93\u8868\u540d #SCHEDULE_PERIOD \u4e0b\u6b21\u6267\u884c\u65f6\u95f4\u95f4\u9694\uff0c\u4f46\u662f\u4e3a\u5206\uff0c\u9ed8\u8ba4\u4e3a10\u5206\u949f #\u542f\u52a8\u670d\u52a1 docker start tanhua-spark-recommend-user #\u67e5\u770b\u65e5\u5fd7 docker logs -f tanhua-spark-recommend-user \u6267\u884c\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u770b\u5230MongoDB\u4e2d\u7684recommend_user\u8868\u4e2d\u6570\u636e\u5df2\u7ecf\u91cd\u65b0\u751f\u6210\u4e86\u3002 3\u3001\u5708\u5b50\u63a8\u8350 \u00b6 3.1\u3001\u529f\u80fd\u8bf4\u660e \u00b6 \u5728\u5708\u5b50\u529f\u80fd\u4e2d\uff0c\u9488\u5bf9\u4e8e\u7528\u6237\u53d1\u5e03\u7684\u52a8\u6001\u4fe1\u606f\uff0c\u7cfb\u7edf\u53ef\u4ee5\u6839\u636e\u7528\u6237\u7684\u53d1\u5e03\u3001\u6d4f\u89c8\u3001\u70b9\u8d5e\u7b49\u64cd\u4f5c\uff0c\u5bf9\u52a8\u6001\u4fe1\u606f\u505a\u8ba1\u7b97\uff0c\u7136\u540e\u5bf9\u6bcf\u4e2a\u7528\u6237\u8fdb\u884c\u4e0d\u540c\u7684\u63a8\u8350\u3002 3.2\u3001\u6d41\u7a0b\u8bf4\u660e \u00b6 \u6d41\u7a0b\u8bf4\u660e\uff1a \u7528\u6237\u5bf9\u5708\u5b50\u7684\u52a8\u6001\u64cd\u4f5c\uff0c\u5982\uff1a\u53d1\u5e03\u3001\u6d4f\u89c8\u3001\u70b9\u8d5e\u3001\u559c\u6b22\u7b49\uff0c\u5c31\u4f1a\u7ed9RocketMQ\u8fdb\u884c\u53d1\u9001\u6d88\u606f\uff1b \u63a8\u8350\u7cfb\u7edf\u63a5\u6536\u6d88\u606f\uff0c\u5e76\u4e14\u5904\u7406\u6d88\u606f\u6570\u636e\uff0c\u5904\u7406\u4e4b\u540e\u5c06\u7ed3\u679c\u6570\u636e\u5199\u5165\u5230MongoDB\u4e2d\uff1b Spark\u7cfb\u7edf\u62c9\u53d6\u6570\u636e\uff0c\u7136\u540e\u8fdb\u884c\u63a8\u8350\u8ba1\u7b97\uff1b \u8ba1\u7b97\u4e4b\u540e\u7684\u7ed3\u679c\u6570\u636e\u5199\u5165\u5230Redis\u4e2d\uff0c\u4e3a\u6bcf\u4e2a\u7528\u6237\u90fd\u8fdb\u884c\u4e2a\u6027\u5316\u63a8\u8350\uff1b 3.3\u3001\u52a8\u6001\u8ba1\u5206\u89c4\u5219 \u00b6 \u6d4f\u89c8 +1 \u70b9\u8d5e +5 \u559c\u6b22 +8 \u8bc4\u8bba + 10 \u53d1\u5e03\u52a8\u6001 \u6587\u5b57\u957f\u5ea6\uff1a50\u4ee5\u51851\u5206\uff0c50~100\u4e4b\u95f42\u5206\uff0c100\u4ee5\u4e0a3\u5206 \u56fe\u7247\u4e2a\u6570\uff1a\u6bcf\u4e2a\u56fe\u7247\u4e00\u5206 \u6838\u5fc3\u63a8\u8350\u903b\u8f91\uff1a \u63a8\u8350\u6a21\u578b\uff1a\u7528\u6237 | \u52a8\u6001 | \u8bc4\u5206 \u5176\u4e2d\uff0c\u8bc4\u5206\u662f\u7528\u6237\u5bf9\u52a8\u6001\u64cd\u4f5c\u7684\u5f97\u5206\u5408\u8ba1 \u4e3a\u4ec0\u4e48\u81ea\u5df1\u53d1\u5e03\u52a8\u6001\u8fd8\u8981\u8ba1\u5206\uff1f \u662f\u56e0\u4e3a\uff0c\u81ea\u5df1\u53d1\u5e03\u5c31\u76f8\u5f53\u4e8e\u81ea\u5df1\u5bf9\u6b64\u52a8\u6001\u4e5f\u611f\u5174\u8da3\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u76f8\u4f3c\u7684\u4eba\u4e4b\u95f4\u8fdb\u884c\u63a8\u8350\u4e86\u3002 3.4\u3001\u53d1\u9001\u6d88\u606f \u00b6 3.4.1\u3001QuanziMQService \u00b6 my-tanhua-server\u589e\u52a0\u4f9d\u8d56\uff1a <!--RocketMQ\u76f8\u5173--> <dependency> <groupId> org.apache.rocketmq </groupId> <artifactId> rocketmq-spring-boot-starter </artifactId> </dependency> <dependency> <groupId> org.apache.rocketmq </groupId> <artifactId> rocketmq-client </artifactId> </dependency> \u914d\u7f6e\u6587\u4ef6\uff1a # RocketMQ\u76f8\u5173\u914d\u7f6e rocketmq.name-server = 192.168.31.81:9876 rocketmq.producer.group = tanhua package com.tanhua.server.service ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.common.pojo.User ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.dubbo.server.api.QuanZiApi ; import com.tanhua.dubbo.server.pojo.Publish ; import lombok.extern.slf4j.Slf4j ; import org.apache.rocketmq.spring.core.RocketMQTemplate ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import java.util.HashMap ; import java.util.Map ; @Service @Slf4j public class QuanziMQService { @Autowired private RocketMQTemplate rocketMQTemplate ; @Reference ( version = \"1.0.0\" ) private QuanZiApi quanZiApi ; /** * \u53d1\u5e03\u52a8\u6001\u6d88\u606f * * @param publishId * @return */ public Boolean publishMsg ( String publishId ) { return this . sendMsg ( publishId , 1 ); } /** * \u6d4f\u89c8\u52a8\u6001\u6d88\u606f * * @param publishId * @return */ public Boolean queryPublishMsg ( String publishId ) { return this . sendMsg ( publishId , 2 ); } /** * \u70b9\u8d5e\u52a8\u6001\u6d88\u606f * * @param publishId * @return */ public Boolean likePublishMsg ( String publishId ) { return this . sendMsg ( publishId , 3 ); } /** * \u53d6\u6d88\u70b9\u8d5e\u52a8\u6001\u6d88\u606f * * @param publishId * @return */ public Boolean disLikePublishMsg ( String publishId ) { return this . sendMsg ( publishId , 6 ); } /** * \u559c\u6b22\u52a8\u6001\u6d88\u606f * * @param publishId * @return */ public Boolean lovePublishMsg ( String publishId ) { return this . sendMsg ( publishId , 4 ); } /** * \u53d6\u6d88\u559c\u6b22\u52a8\u6001\u6d88\u606f * * @param publishId * @return */ public Boolean disLovePublishMsg ( String publishId ) { return this . sendMsg ( publishId , 7 ); } /** * \u8bc4\u8bba\u52a8\u6001\u6d88\u606f * * @param publishId * @return */ public Boolean commentPublishMsg ( String publishId ) { return this . sendMsg ( publishId , 5 ); } /** * \u53d1\u9001\u5708\u5b50\u64cd\u4f5c\u76f8\u5173\u7684\u6d88\u606f * * @param publishId * @param type 1-\u53d1\u52a8\u6001\uff0c2-\u6d4f\u89c8\u52a8\u6001\uff0c 3-\u70b9\u8d5e\uff0c 4-\u559c\u6b22\uff0c 5-\u8bc4\u8bba\uff0c6-\u53d6\u6d88\u70b9\u8d5e\uff0c7-\u53d6\u6d88\u559c\u6b22 * @return */ private Boolean sendMsg ( String publishId , Integer type ) { try { User user = UserThreadLocal . get (); Publish publish = this . quanZiApi . queryPublishById ( publishId ); //\u6784\u5efa\u6d88\u606f Map < String , Object > msg = new HashMap <> (); msg . put ( \"userId\" , user . getId ()); msg . put ( \"date\" , System . currentTimeMillis ()); msg . put ( \"publishId\" , publishId ); msg . put ( \"pid\" , publish . getPid ()); msg . put ( \"type\" , type ); this . rocketMQTemplate . convertAndSend ( \"tanhua-quanzi\" , msg ); } catch ( Exception e ) { log . error ( \"\u53d1\u9001\u6d88\u606f\u5931\u8d25! publishId = \" + publishId + \", type = \" + type , e ); return false ; } return true ; } } 3.4.2\u3001\u4fee\u6539QuanZiService \u00b6 \u5728QuanZiService\u5b8c\u6210\u53d1\u9001\u6d88\u606f\u65b9\u6cd5\u8c03\u7528\u3002 package com.tanhua.server.service ; import cn.hutool.core.bean.BeanUtil ; import cn.hutool.core.collection.CollUtil ; import cn.hutool.core.convert.Convert ; import cn.hutool.core.date.DateUtil ; import cn.hutool.core.util.ObjectUtil ; import cn.hutool.core.util.StrUtil ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.common.pojo.User ; import com.tanhua.common.pojo.UserInfo ; import com.tanhua.common.service.PicUploadService ; import com.tanhua.common.utils.RelativeDateFormat ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.common.vo.PicUploadResult ; import com.tanhua.dubbo.server.api.QuanZiApi ; import com.tanhua.dubbo.server.api.VisitorsApi ; import com.tanhua.dubbo.server.pojo.Comment ; import com.tanhua.dubbo.server.pojo.Publish ; import com.tanhua.dubbo.server.pojo.Visitors ; import com.tanhua.dubbo.server.vo.PageInfo ; import com.tanhua.server.vo.CommentVo ; import com.tanhua.server.vo.PageResult ; import com.tanhua.server.vo.QuanZiVo ; import com.tanhua.server.vo.VisitorsVo ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import org.springframework.web.multipart.MultipartFile ; import java.util.* ; @Service public class QuanZiService { @Reference ( version = \"1.0.0\" ) private QuanZiApi quanZiApi ; @Reference ( version = \"1.0.0\" ) private VisitorsApi visitorsApi ; @Autowired private UserService userService ; @Autowired private UserInfoService userInfoService ; @Autowired private PicUploadService picUploadService ; @Autowired private QuanziMQService quanziMQService ; public PageResult queryPublishList ( Integer page , Integer pageSize ) { //\u5206\u6790\uff1a\u901a\u8fc7dubbo\u4e2d\u7684\u670d\u52a1\u67e5\u8be2\u7528\u6237\u7684\u597d\u53cb\u52a8\u6001 //\u901a\u8fc7mysql\u67e5\u8be2\u7528\u6237\u7684\u4fe1\u606f\uff0c\u56de\u5199\u5230\u7ed3\u679c\u5bf9\u8c61\u4e2d\uff08QuanZiVo\uff09 PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); //\u76f4\u63a5\u4eceThreadLocal\u4e2d\u83b7\u53d6\u5bf9\u8c61 User user = UserThreadLocal . get (); //\u901a\u8fc7dubbo\u67e5\u8be2\u6570\u636e PageInfo < Publish > pageInfo = this . quanZiApi . queryPublishList ( user . getId (), page , pageSize ); List < Publish > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )) { return pageResult ; } pageResult . setItems ( this . fillQuanZiVo ( records )); return pageResult ; } /** * \u586b\u5145\u7528\u6237\u4fe1\u606f * * @param userInfo * @param quanZiVo */ private void fillUserInfoToQuanZiVo ( UserInfo userInfo , QuanZiVo quanZiVo ) { BeanUtil . copyProperties ( userInfo , quanZiVo , \"id\" ); quanZiVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); quanZiVo . setTags ( StringUtils . split ( userInfo . getTags (), ',' )); //\u5f53\u524d\u7528\u6237 User user = UserThreadLocal . get (); quanZiVo . setCommentCount ( 0 ); //TODO \u8bc4\u8bba\u6570 quanZiVo . setDistance ( \"1.2\u516c\u91cc\" ); //TODO \u8ddd\u79bb quanZiVo . setHasLiked ( this . quanZiApi . queryUserIsLike ( user . getId (), quanZiVo . getId ()) ? 1 : 0 ); //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLikeCount ( Convert . toInt ( this . quanZiApi . queryLikeCount ( quanZiVo . getId ()))); //\u70b9\u8d5e\u6570 quanZiVo . setHasLoved ( this . quanZiApi . queryUserIsLove ( user . getId (), quanZiVo . getId ()) ? 1 : 0 ); //\u662f\u5426\u559c\u6b22\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLoveCount ( Convert . toInt ( this . quanZiApi . queryLoveCount ( quanZiVo . getId ()))); //\u559c\u6b22\u6570 } /** * \u6839\u636e\u67e5\u8be2\u5230\u7684publish\u96c6\u5408\u586b\u5145QuanZiVo\u5bf9\u8c61 * * @param records * @return */ private List < QuanZiVo > fillQuanZiVo ( List < Publish > records ) { List < QuanZiVo > quanZiVoList = new ArrayList <> (); records . forEach ( publish -> { QuanZiVo quanZiVo = new QuanZiVo (); quanZiVo . setId ( publish . getId (). toHexString ()); quanZiVo . setTextContent ( publish . getText ()); quanZiVo . setImageContent ( publish . getMedias (). toArray ( new String [] {})); quanZiVo . setUserId ( publish . getUserId ()); quanZiVo . setCreateDate ( RelativeDateFormat . format ( new Date ( publish . getCreated ()))); quanZiVoList . add ( quanZiVo ); }); //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIds = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); for ( QuanZiVo quanZiVo : quanZiVoList ) { //\u627e\u5230\u5bf9\u5e94\u7684\u7528\u6237\u4fe1\u606f for ( UserInfo userInfo : userInfoList ) { if ( quanZiVo . getUserId (). longValue () == userInfo . getUserId (). longValue ()) { this . fillUserInfoToQuanZiVo ( userInfo , quanZiVo ); break ; } } } return quanZiVoList ; } /** * \u53d1\u5e03\u52a8\u6001 * * @param textContent * @param location * @param latitude * @param longitude * @param multipartFile * @return */ public String savePublish ( String textContent , String location , String latitude , String longitude , MultipartFile [] multipartFile ) { //\u67e5\u8be2\u5f53\u524d\u7684\u767b\u5f55\u4fe1\u606f User user = UserThreadLocal . get (); Publish publish = new Publish (); publish . setUserId ( user . getId ()); publish . setText ( textContent ); publish . setLocationName ( location ); publish . setLatitude ( latitude ); publish . setLongitude ( longitude ); publish . setSeeType ( 1 ); List < String > picUrls = new ArrayList <> (); //\u56fe\u7247\u4e0a\u4f20 for ( MultipartFile file : multipartFile ) { PicUploadResult picUploadResult = this . picUploadService . upload ( file ); picUrls . add ( picUploadResult . getName ()); } publish . setMedias ( picUrls ); String publishId = this . quanZiApi . savePublish ( publish ); if ( StrUtil . isNotEmpty ( publishId )){ //\u53d1\u9001\u6d88\u606f this . quanziMQService . publishMsg ( publishId ); } return publishId ; } public PageResult queryRecommendPublishList ( Integer page , Integer pageSize ) { //\u5206\u6790\uff1a\u901a\u8fc7dubbo\u4e2d\u7684\u670d\u52a1\u67e5\u8be2\u7cfb\u7edf\u63a8\u8350\u52a8\u6001 //\u901a\u8fc7mysql\u67e5\u8be2\u7528\u6237\u7684\u4fe1\u606f\uff0c\u56de\u5199\u5230\u7ed3\u679c\u5bf9\u8c61\u4e2d\uff08QuanZiVo\uff09 PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); //\u76f4\u63a5\u4eceThreadLocal\u4e2d\u83b7\u53d6\u5bf9\u8c61 User user = UserThreadLocal . get (); //\u901a\u8fc7dubbo\u67e5\u8be2\u6570\u636e PageInfo < Publish > pageInfo = this . quanZiApi . queryRecommendPublishList ( user . getId (), page , pageSize ); List < Publish > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )) { return pageResult ; } pageResult . setItems ( this . fillQuanZiVo ( records )); return pageResult ; } /** * \u52a8\u6001\u70b9\u8d5e * @param publishId * @return */ public Long likeComment ( String publishId ) { User user = UserThreadLocal . get (); Boolean result = this . quanZiApi . likeComment ( user . getId (), publishId ); if ( result ) { //\u53d1\u6d88\u606f this . quanziMQService . likePublishMsg ( publishId ); //\u67e5\u8be2\u70b9\u8d5e\u6570 return this . quanZiApi . queryLikeCount ( publishId ); } return null ; } /** * \u52a8\u6001\u7684\u53d6\u6d88\u70b9\u8d5e * * @param publishId * @return */ public Long disLikeComment ( String publishId ) { User user = UserThreadLocal . get (); Boolean result = this . quanZiApi . disLikeComment ( user . getId (), publishId ); if ( result ) { //\u53d1\u6d88\u606f this . quanziMQService . disLikePublishMsg ( publishId ); //\u67e5\u8be2\u70b9\u8d5e\u6570 return this . quanZiApi . queryLikeCount ( publishId ); } return null ; } public Long loveComment ( String publishId ) { User user = UserThreadLocal . get (); //\u559c\u6b22 Boolean result = this . quanZiApi . loveComment ( user . getId (), publishId ); if ( result ){ //\u53d1\u6d88\u606f this . quanziMQService . lovePublishMsg ( publishId ); //\u67e5\u8be2\u559c\u6b22\u6570 return this . quanZiApi . queryLoveCount ( publishId ); } return null ; } public Long disLoveComment ( String publishId ) { User user = UserThreadLocal . get (); //\u53d6\u6d88\u559c\u6b22 Boolean result = this . quanZiApi . disLoveComment ( user . getId (), publishId ); if ( result ){ //\u53d1\u6d88\u606f this . quanziMQService . disLovePublishMsg ( publishId ); //\u67e5\u8be2\u559c\u6b22\u6570 return this . quanZiApi . queryLoveCount ( publishId ); } return null ; } public QuanZiVo queryById ( String publishId ) { Publish publish = this . quanZiApi . queryPublishById ( publishId ); if ( publish == null ) { return null ; } //\u53d1\u6d88\u606f this . quanziMQService . queryPublishMsg ( publishId ); return this . fillQuanZiVo ( Arrays . asList ( publish )). get ( 0 ); } /** * \u67e5\u8be2\u8bc4\u8bba\u5217\u8868 * * @param publishId * @param page * @param pageSize * @return */ public PageResult queryCommentList ( String publishId , Integer page , Integer pageSize ) { PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); User user = UserThreadLocal . get (); //\u67e5\u8be2\u8bc4\u8bba\u5217\u8868\u6570\u636e PageInfo < Comment > pageInfo = this . quanZiApi . queryCommentList ( publishId , page , pageSize ); List < Comment > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )){ return pageResult ; } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIdList = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIdList ); List < CommentVo > result = new ArrayList <> (); for ( Comment record : records ) { CommentVo commentVo = new CommentVo (); commentVo . setContent ( record . getContent ()); commentVo . setId ( record . getId (). toHexString ()); commentVo . setCreateDate ( DateUtil . format ( new Date ( record . getCreated ()), \"HH:mm\" )); //\u662f\u5426\u70b9\u8d5e commentVo . setHasLiked ( this . quanZiApi . queryUserIsLike ( user . getId (), commentVo . getId ()) ? 1 : 0 ); //\u70b9\u8d5e\u6570 commentVo . setLikeCount ( Convert . toInt ( this . quanZiApi . queryLikeCount ( commentVo . getId ()))); for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( record . getUserId (), userInfo . getUserId ())){ commentVo . setAvatar ( userInfo . getLogo ()); commentVo . setNickname ( userInfo . getNickName ()); break ; } } result . add ( commentVo ); } pageResult . setItems ( result ); return pageResult ; } /** * \u53d1\u8868\u8bc4\u8bba * @param publishId * @param content * @return */ public Boolean saveComments ( String publishId , String content ) { User user = UserThreadLocal . get (); Boolean result = this . quanZiApi . saveComment ( user . getId (), publishId , content ); if ( result ){ //\u53d1\u6d88\u606f this . quanziMQService . commentPublishMsg ( publishId ); } return result ; } public PageResult queryAlbumList ( Long userId , Integer page , Integer pageSize ) { PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); //\u67e5\u8be2\u6570\u636e PageInfo < Publish > pageInfo = this . quanZiApi . queryAlbumList ( userId , page , pageSize ); if ( CollUtil . isEmpty ( pageInfo . getRecords ())){ return pageResult ; } //\u586b\u5145\u6570\u636e pageResult . setItems ( this . fillQuanZiVo ( pageInfo . getRecords ())); return pageResult ; } public List < VisitorsVo > queryVisitorsList () { User user = UserThreadLocal . get (); List < Visitors > visitorsList = this . visitorsApi . queryMyVisitor ( user . getId ()); if ( CollUtil . isEmpty ( visitorsList )) { return Collections . emptyList (); } List < Object > userIds = CollUtil . getFieldValues ( visitorsList , \"visitorUserId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); List < VisitorsVo > visitorsVoList = new ArrayList <> (); for ( Visitors visitor : visitorsList ) { for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( visitor . getVisitorUserId (), userInfo . getUserId ())) { VisitorsVo visitorsVo = new VisitorsVo (); visitorsVo . setAge ( userInfo . getAge ()); visitorsVo . setAvatar ( userInfo . getLogo ()); visitorsVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); visitorsVo . setId ( userInfo . getUserId ()); visitorsVo . setNickname ( userInfo . getNickName ()); visitorsVo . setTags ( StringUtils . split ( userInfo . getTags (), ',' )); visitorsVo . setFateValue ( visitor . getScore (). intValue ()); visitorsVoList . add ( visitorsVo ); break ; } } } return visitorsVoList ; } } 3.5\u3001\u63a5\u6536\u6d88\u606f \u00b6 \u63a5\u6536\u6d88\u606f\u7684\u5de5\u4f5c\u9700\u8981\u65b0\u521b\u5efamy-tanhua-recommend\u5de5\u7a0b\uff0c\u5728\u6b64\u5de5\u7a0b\u4e2d\u5b8c\u6210\u76f8\u5173\u7684\u64cd\u4f5c\u3002 3.5.1\u3001\u521b\u5efamy-tanhua-recommend\u5de5\u7a0b \u00b6 <?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <parent> <artifactId> my-tanhua </artifactId> <groupId> cn.itcast.tanhua </groupId> <version> 1.0-SNAPSHOT </version> </parent> <modelVersion> 4.0.0 </modelVersion> <artifactId> my-tanhua-recommend </artifactId> <dependencies> <!--\u5f15\u5165interface\u4f9d\u8d56--> <dependency> <groupId> cn.itcast.tanhua </groupId> <artifactId> my-tanhua-dubbo-interface </artifactId> <version> 1.0-SNAPSHOT </version> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-web </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-test </artifactId> <scope> test </scope> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-redis </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-mongodb </artifactId> </dependency> <!--RocketMQ\u76f8\u5173--> <dependency> <groupId> org.apache.rocketmq </groupId> <artifactId> rocketmq-spring-boot-starter </artifactId> </dependency> <dependency> <groupId> org.apache.rocketmq </groupId> <artifactId> rocketmq-client </artifactId> </dependency> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> </dependency> <dependency> <groupId> joda-time </groupId> <artifactId> joda-time </artifactId> </dependency> <dependency> <groupId> cn.hutool </groupId> <artifactId> hutool-all </artifactId> </dependency> </dependencies> </project> 3.5.2\u3001\u914d\u7f6e\u6587\u4ef6 \u00b6 application.properties spring.application.name = itcast-rocketmq server.port = 18082 # RocketMQ\u76f8\u5173\u914d\u7f6e rocketmq.name-server = 192.168.31.81:9876 rocketmq.producer.group = tanhua # mongodb\u76f8\u5173\u914d\u7f6e spring.data.mongodb.username = tanhua spring.data.mongodb.password = l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV spring.data.mongodb.authentication-database = admin spring.data.mongodb.database = tanhua spring.data.mongodb.port = 27017 spring.data.mongodb.host = 192.168.31.81 3.5.3\u3001\u542f\u52a8\u7c7b \u00b6 package com.tanhua.recommend ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; @SpringBootApplication public class RecommendApplication { public static void main ( String [] args ) { SpringApplication . run ( RecommendApplication . class , args ); } } 3.5.4\u3001RecommendQuanZi \u00b6 \u5b58\u50a8\u5230MongoDB\u7684\u4e2d\u7684\u5b9e\u4f53\u7ed3\u6784\u3002 package com.tanhua.recommend.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.mongodb.core.mapping.Document ; @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"recommend_quanzi\" ) public class RecommendQuanZi { private ObjectId id ; private Long userId ; // \u7528\u6237id private Long publishId ; //\u52a8\u6001id\uff0c\u9700\u8981\u8f6c\u5316\u4e3aLong\u7c7b\u578b private Double score ; //\u5f97\u5206 private Long date ; //\u65f6\u95f4\u6233 } 3.5.5\u3001QuanZiMsgConsumer \u00b6 package com.tanhua.recommend.msg ; import cn.hutool.core.collection.CollUtil ; import cn.hutool.core.util.ObjectUtil ; import cn.hutool.core.util.StrUtil ; import cn.hutool.json.JSONObject ; import cn.hutool.json.JSONUtil ; import com.tanhua.dubbo.server.pojo.Publish ; import com.tanhua.recommend.pojo.RecommendQuanZi ; import lombok.extern.slf4j.Slf4j ; import org.apache.rocketmq.spring.annotation.RocketMQMessageListener ; import org.apache.rocketmq.spring.core.RocketMQListener ; import org.bson.types.ObjectId ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.stereotype.Component ; @Component @RocketMQMessageListener ( topic = \"tanhua-quanzi\" , consumerGroup = \"tanhua-quanzi-consumer\" ) @Slf4j public class QuanZiMsgConsumer implements RocketMQListener < String > { @Autowired private MongoTemplate mongoTemplate ; @Override public void onMessage ( String msg ) { try { JSONObject jsonObject = JSONUtil . parseObj ( msg ); Long userId = jsonObject . getLong ( \"userId\" ); Long date = jsonObject . getLong ( \"date\" ); String publishId = jsonObject . getStr ( \"publishId\" ); Long pid = jsonObject . getLong ( \"pid\" ); Integer type = jsonObject . getInt ( \"type\" ); RecommendQuanZi recommendQuanZi = new RecommendQuanZi (); recommendQuanZi . setUserId ( userId ); recommendQuanZi . setId ( ObjectId . get ()); recommendQuanZi . setDate ( date ); recommendQuanZi . setPublishId ( pid ); //1-\u53d1\u52a8\u6001\uff0c2-\u6d4f\u89c8\u52a8\u6001\uff0c 3-\u70b9\u8d5e\uff0c 4-\u559c\u6b22\uff0c 5-\u8bc4\u8bba\uff0c6-\u53d6\u6d88\u70b9\u8d5e\uff0c7-\u53d6\u6d88\u559c\u6b22 switch ( type ) { case 1 : { Publish publish = this . mongoTemplate . findById ( new ObjectId ( publishId ), Publish . class ); if ( ObjectUtil . isNotEmpty ( publish )) { double score = 0d ; //\u83b7\u53d6\u56fe\u7247\u6570 score += CollUtil . size ( publish . getMedias ()); //\u83b7\u53d6\u6587\u672c\u7684\u957f\u5ea6 //\u6587\u5b57\u957f\u5ea6\uff1a50\u4ee5\u51851\u5206\uff0c50~100\u4e4b\u95f42\u5206\uff0c100\u4ee5\u4e0a3\u5206 int length = StrUtil . length ( publish . getText ()); if ( length >= 0 && length < 50 ) { score += 1 ; } else if ( length < 100 ) { score += 2 ; } else { score += 3 ; } recommendQuanZi . setScore ( score ); } break ; } case 2 : { recommendQuanZi . setScore ( 1d ); break ; } case 3 : { recommendQuanZi . setScore ( 5d ); break ; } case 4 : { recommendQuanZi . setScore ( 8d ); break ; } case 5 : { recommendQuanZi . setScore ( 10 d ); break ; } case 6 : { recommendQuanZi . setScore ( - 5d ); break ; } case 7 : { recommendQuanZi . setScore ( - 8d ); break ; } default : { recommendQuanZi . setScore ( 0d ); break ; } } //\u6570\u636e\u4fdd\u5b58\u5230MongoDB\u4e2d this . mongoTemplate . save ( recommendQuanZi ); } catch ( Exception e ) { log . error ( \"\u5904\u7406\u6d88\u606f\u51fa\u9519\uff01msg = \" + msg , e ); } } } 1.7\u3001\u6d4b\u8bd5 \u00b6 \u6d4b\u8bd5\u65b9\u6cd5\uff1a\u4f7f\u7528APP\u8fdb\u884c\u64cd\u4f5c\uff0c\u53ef\u4ee5\u770b\u5230\u5728MongoDB\u4e2d\u5df2\u7ecf\u6709\u6570\u636e\u5199\u5165\u3002 4\u3001\u90e8\u7f72\u63a8\u8350\u7cfb\u7edf \u00b6 \u5728\u63a8\u8350\u7cfb\u7edf\u4e2d\uff0c\u6211\u4eec\u5c06\u57fa\u4e8e\u524d\u9762\u5199\u5165\u5230\u63a8\u8350\u8868\u4e2d\u7684\u6570\u636e\u901a\u8fc7Spark\u8fdb\u884c\u8ba1\u7b97\uff0c\u5728Spark\u8ba1\u7b97\u5b8c\u6210\u540e\u5c06\u7ed3\u679c\u5199\u5165\u5230Redis\u4e2d\uff0c\u4ee5\u4f9b\u5728\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u8fdb\u884c\u67e5\u8be2\u3002 \u63a8\u8350\u670d\u52a1\u6211\u4eec\u5c06\u57fa\u4e8edocker\u7684\u5f62\u5f0f\u8fdb\u884c\u90e8\u7f72\uff1a #\u62c9\u53d6\u955c\u50cf docker pull registry.cn-hangzhou.aliyuncs.com/itcast/tanhua-spark-quanzi:1.0 #\u521b\u5efa\u5bb9\u5668 docker create --name tanhua-spark-quanzi \\ --env MONGODB_HOST = 192 .168.31.81 \\ --env MONGODB_PORT = 27017 \\ --env MONGODB_USERNAME = tanhua \\ --env MONGODB_PASSWORD = l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV \\ --env MONGODB_DATABASE = tanhua \\ --env MONGODB_COLLECTION = recommend_quanzi \\ --env SCHEDULE_PERIOD = 10 \\ --env REDIS_NODES = \"192.168.31.81:6379,192.168.31.81:6380,192.168.31.81:6381\" \\ registry.cn-hangzhou.aliyuncs.com/itcast/tanhua-spark-quanzi:1.0 #\u53c2\u6570\u8bf4\u660e #MONGODB_HOST mongodb\u670d\u52a1\u7684\u5730\u5740 #MONGODB_PORT mongodb\u670d\u52a1\u7684\u7aef\u53e3 #MONGODB_USERNAME mongodb\u670d\u52a1\u7684\u8ba4\u8bc1\u7528\u6237\u540d #MONGODB_PASSWORD mongodb\u670d\u52a1\u7684\u8ba4\u8bc1\u5bc6\u7801 #MONGODB_DATABASE mongodb\u8fde\u63a5\u7684\u6570\u636e\u5e93 #MONGODB_COLLECTION \u64cd\u4f5c\u8868 #SCHEDULE_PERIOD \u4e0b\u6b21\u6267\u884c\u65f6\u95f4\u95f4\u9694\uff0c\u4f46\u662f\u4e3a\u5206\uff0c\u9ed8\u8ba4\u4e3a10\u5206\u949f #REDIS_NODES redis\u96c6\u7fa4\u5730\u5740\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5355\u8282\u70b9 #mongodb\u5f00\u542f\u8ba4\u8bc1\u670d\u52a1 #docker create --name mongodb --restart=always -p 27017:27017 -v mongodb:/data/db mongo:4.0.3 --auth #\u542f\u52a8\u670d\u52a1\uff0c\u542f\u52a8\u4e4b\u540e\u5c31\u4f1a\u8fdb\u884c\u6267\u884c\uff0c\u5728SCHEDULE_PERIOD\u65f6\u95f4\u540e\u518d\u6b21\u6267\u884c docker start tanhua-spark-quanzi #\u67e5\u770b\u65e5\u5fd7 docker logs -f tanhua-spark-quanzi #\u6267\u884c\u5b8c\u6210\u540e\u4f1a\u5c06\u6570\u636e\u5199\u5165\u5230redis\u4e2d \u8fdb\u5165redis\u67e5\u770b\u662f\u5426\u5df2\u7ecf\u6709\u6570\u636e\uff1a 5\u3001\u5c0f\u89c6\u9891\u63a8\u8350 \u00b6 \u5c0f\u89c6\u9891\u7684\u63a8\u8350\u548c\u52a8\u6001\u63a8\u8350\u7684\u5b9e\u73b0\u903b\u8f91\u975e\u5e38\u7684\u7c7b\u4f3c\u3002 5.1\u3001\u52a8\u6001\u8ba1\u5206\u89c4\u5219 \u00b6 \u53d1\u5e03+2 \u70b9\u8d5e +5 \u8bc4\u8bba + 10 5.2\u3001\u53d1\u9001\u6d88\u606f \u00b6 5.2.1\u3001VideoMQService \u00b6 package com.tanhua.server.service ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.common.pojo.User ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.dubbo.server.api.VideoApi ; import com.tanhua.dubbo.server.pojo.Video ; import lombok.extern.slf4j.Slf4j ; import org.apache.rocketmq.spring.core.RocketMQTemplate ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import java.util.HashMap ; import java.util.Map ; @Service @Slf4j public class VideoMQService { @Autowired private RocketMQTemplate rocketMQTemplate ; @Reference ( version = \"1.0.0\" ) private VideoApi videoApi ; /** * \u53d1\u5e03\u5c0f\u89c6\u9891\u6d88\u606f * * @return */ public Boolean videoMsg ( String videoId ) { return this . sendMsg ( videoId , 1 ); } /** * \u70b9\u8d5e\u5c0f\u89c6\u9891 * * @return */ public Boolean likeVideoMsg ( String videoId ) { return this . sendMsg ( videoId , 2 ); } /** * \u53d6\u6d88\u70b9\u8d5e\u5c0f\u89c6\u9891 * * @return */ public Boolean disLikeVideoMsg ( String videoId ) { return this . sendMsg ( videoId , 3 ); } /** * \u8bc4\u8bba\u5c0f\u89c6\u9891 * * @return */ public Boolean commentVideoMsg ( String videoId ) { return this . sendMsg ( videoId , 4 ); } /** * \u53d1\u9001\u5c0f\u89c6\u9891\u64cd\u4f5c\u76f8\u5173\u7684\u6d88\u606f * * @param videoId * @param type 1-\u53d1\u52a8\u6001\uff0c2-\u70b9\u8d5e\uff0c 3-\u53d6\u6d88\u70b9\u8d5e\uff0c4-\u8bc4\u8bba * @return */ private Boolean sendMsg ( String videoId , Integer type ) { try { User user = UserThreadLocal . get (); Video video = this . videoApi . queryVideoById ( videoId ); //\u6784\u5efa\u6d88\u606f Map < String , Object > msg = new HashMap <> (); msg . put ( \"userId\" , user . getId ()); msg . put ( \"date\" , System . currentTimeMillis ()); msg . put ( \"videoId\" , videoId ); msg . put ( \"vid\" , video . getVid ()); msg . put ( \"type\" , type ); this . rocketMQTemplate . convertAndSend ( \"tanhua-video\" , msg ); } catch ( Exception e ) { log . error ( \"\u53d1\u9001\u6d88\u606f\u5931\u8d25! videoId = \" + videoId + \", type = \" + type , e ); return false ; } return true ; } } 4.3.2\u3001VideoService \u00b6 package com.tanhua.server.service ; import cn.hutool.core.collection.CollUtil ; import cn.hutool.core.convert.Convert ; import cn.hutool.core.util.ObjectUtil ; import cn.hutool.core.util.StrUtil ; import com.alibaba.dubbo.config.annotation.Reference ; import com.github.tobato.fastdfs.domain.conn.FdfsWebServer ; import com.github.tobato.fastdfs.domain.fdfs.StorePath ; import com.github.tobato.fastdfs.service.FastFileStorageClient ; import com.tanhua.common.pojo.User ; import com.tanhua.common.pojo.UserInfo ; import com.tanhua.common.service.PicUploadService ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.common.vo.PicUploadResult ; import com.tanhua.dubbo.server.api.QuanZiApi ; import com.tanhua.dubbo.server.api.VideoApi ; import com.tanhua.dubbo.server.pojo.Video ; import com.tanhua.dubbo.server.vo.PageInfo ; import com.tanhua.server.vo.PageResult ; import com.tanhua.server.vo.VideoVo ; import lombok.extern.slf4j.Slf4j ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import org.springframework.web.multipart.MultipartFile ; import java.io.IOException ; import java.util.ArrayList ; import java.util.List ; @Service @Slf4j public class VideoService { @Reference ( version = \"1.0.0\" ) private VideoApi videoApi ; @Autowired private PicUploadService picUploadService ; @Autowired protected FastFileStorageClient storageClient ; @Autowired private FdfsWebServer fdfsWebServer ; @Autowired private UserInfoService userInfoService ; @Reference ( version = \"1.0.0\" ) private QuanZiApi quanZiApi ; @Autowired private QuanZiService quanZiService ; @Autowired private VideoMQService videoMQService ; /** * \u5c0f\u89c6\u9891\u4e0a\u4f20 * * @param picFile \u5c01\u9762\u56fe\u7247 * @param videoFile \u89c6\u9891\u6587\u4ef6 * @return */ public Boolean saveVideo ( MultipartFile picFile , MultipartFile videoFile ) { User user = UserThreadLocal . get (); Video video = new Video (); video . setUserId ( user . getId ()); video . setSeeType ( 1 ); try { //\u4e0a\u4f20\u56fe\u7247\u5230\u963f\u91cc\u4e91oss PicUploadResult uploadResult = this . picUploadService . upload ( picFile ); video . setPicUrl ( uploadResult . getName ()); //\u4e0a\u4f20\u89c6\u9891\u5230FastDFS\u4e2d StorePath storePath = this . storageClient . uploadFile ( videoFile . getInputStream (), videoFile . getSize (), StrUtil . subAfter ( videoFile . getOriginalFilename (), '.' , true ), null ); video . setVideoUrl ( fdfsWebServer . getWebServerUrl () + storePath . getFullPath ()); String videoId = this . videoApi . saveVideo ( video ); if ( StrUtil . isNotEmpty ( videoId )){ //\u53d1\u9001\u6d88\u606f this . videoMQService . videoMsg ( videoId ); } return StrUtil . isNotEmpty ( videoId ); } catch ( IOException e ) { log . error ( \"\u4e0a\u4f20\u5c0f\u89c6\u9891\u51fa\u9519~ userId = \" + user . getId () + \", file = \" + videoFile . getOriginalFilename (), e ); } return null ; } public PageResult queryVideoList ( Integer page , Integer pageSize ) { User user = UserThreadLocal . get (); PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); PageInfo < Video > pageInfo = this . videoApi . queryVideoList ( user . getId (), page , pageSize ); List < Video > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )) { return pageResult ; } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIds = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); List < VideoVo > videoVoList = new ArrayList <> (); for ( Video record : records ) { VideoVo videoVo = new VideoVo (); videoVo . setUserId ( record . getUserId ()); videoVo . setCover ( record . getPicUrl ()); videoVo . setVideoUrl ( record . getVideoUrl ()); videoVo . setId ( record . getId (). toHexString ()); videoVo . setSignature ( \"\u6211\u5c31\u662f\u6211~\" ); //TODO \u7b7e\u540d videoVo . setCommentCount ( Convert . toInt ( this . quanZiApi . queryCommentCount ( videoVo . getId ()))); //\u8bc4\u8bba\u6570 videoVo . setHasFocus ( this . videoApi . isFollowUser ( user . getId (), videoVo . getUserId ()) ? 1 : 0 ); //\u662f\u5426\u5173\u6ce8 videoVo . setHasLiked ( this . quanZiApi . queryUserIsLike ( user . getId (), videoVo . getId ()) ? 1 : 0 ); //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 videoVo . setLikeCount ( Convert . toInt ( this . quanZiApi . queryLikeCount ( videoVo . getId ()))); //\u70b9\u8d5e\u6570 //\u586b\u5145\u7528\u6237\u4fe1\u606f for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( videoVo . getUserId (), userInfo . getUserId ())) { videoVo . setNickname ( userInfo . getNickName ()); videoVo . setAvatar ( userInfo . getLogo ()); break ; } } videoVoList . add ( videoVo ); } pageResult . setItems ( videoVoList ); return pageResult ; } /** * \u70b9\u8d5e * * @param videoId * @return */ public Long likeComment ( String videoId ) { User user = UserThreadLocal . get (); Boolean result = this . quanZiApi . likeComment ( user . getId (), videoId ); if ( result ) { //\u53d1\u9001\u6d88\u606f this . videoMQService . likeVideoMsg ( videoId ); return this . quanZiApi . queryLikeCount ( videoId ); } return null ; } /** * \u53d6\u6d88\u70b9\u8d5e * * @param videoId * @return */ public Long disLikeComment ( String videoId ) { User user = UserThreadLocal . get (); Boolean result = this . quanZiApi . disLikeComment ( user . getId (), videoId ); if ( result ) { //\u53d1\u9001\u6d88\u606f this . videoMQService . disLikeVideoMsg ( videoId ); return this . quanZiApi . queryLikeCount ( videoId ); } return null ; } public Boolean saveComment ( String videoId , String content ) { Boolean result = this . quanZiService . saveComments ( videoId , content ); if ( result ){ //\u53d1\u9001\u6d88\u606f this . videoMQService . commentVideoMsg ( videoId ); } return result ; } public PageResult queryCommentList ( String videoId , Integer page , Integer pageSize ) { return this . quanZiService . queryCommentList ( videoId , page , pageSize ); } /** * \u5173\u6ce8\u7528\u6237 * * @param userId * @return */ public Boolean followUser ( Long userId ) { User user = UserThreadLocal . get (); return this . videoApi . followUser ( user . getId (), userId ); } /** * \u53d6\u6d88\u5173\u6ce8 * * @param userId * @return */ public Boolean disFollowUser ( Long userId ) { User user = UserThreadLocal . get (); return this . videoApi . disFollowUser ( user . getId (), userId ); } } 5.3\u3001\u63a5\u6536\u6d88\u606f \u00b6 5.3.1\u3001RecommendVideo \u00b6 package com.tanhua.recommend.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.mongodb.core.mapping.Document ; @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"recommend_video\" ) public class RecommendVideo { private ObjectId id ; private Long userId ; // \u7528\u6237id private Long videoId ; //\u89c6\u9891id\uff0c\u9700\u8981\u8f6c\u5316\u4e3aLong\u7c7b\u578b private Double score ; //\u5f97\u5206 private Long date ; //\u65f6\u95f4\u6233 } 5.3.2\u3001VideoMsgConsumer \u00b6 package com.tanhua.recommend.msg ; import cn.hutool.json.JSONObject ; import cn.hutool.json.JSONUtil ; import com.tanhua.recommend.pojo.RecommendVideo ; import lombok.extern.slf4j.Slf4j ; import org.apache.rocketmq.spring.annotation.RocketMQMessageListener ; import org.apache.rocketmq.spring.core.RocketMQListener ; import org.bson.types.ObjectId ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.stereotype.Component ; @Component @RocketMQMessageListener ( topic = \"tanhua-video\" , consumerGroup = \"tanhua-video-consumer\" ) @Slf4j public class VideoMsgConsumer implements RocketMQListener < String > { @Autowired private MongoTemplate mongoTemplate ; @Override public void onMessage ( String msg ) { try { JSONObject jsonObject = JSONUtil . parseObj ( msg ); Long userId = jsonObject . getLong ( \"userId\" ); Long vid = jsonObject . getLong ( \"vid\" ); Integer type = jsonObject . getInt ( \"type\" ); //1-\u53d1\u52a8\u6001\uff0c2-\u70b9\u8d5e\uff0c 3-\u53d6\u6d88\u70b9\u8d5e\uff0c4-\u8bc4\u8bba RecommendVideo recommendVideo = new RecommendVideo (); recommendVideo . setUserId ( userId ); recommendVideo . setId ( ObjectId . get ()); recommendVideo . setDate ( System . currentTimeMillis ()); recommendVideo . setVideoId ( vid ); switch ( type ) { case 1 : { recommendVideo . setScore ( 2d ); break ; } case 2 : { recommendVideo . setScore ( 5d ); break ; } case 3 : { recommendVideo . setScore ( - 5d ); break ; } case 4 : { recommendVideo . setScore ( 10 d ); break ; } default : { recommendVideo . setScore ( 0d ); break ; } } this . mongoTemplate . save ( recommendVideo ); } catch ( Exception e ) { log . error ( \"\u5904\u7406\u5c0f\u89c6\u9891\u6d88\u606f\u5931\u8d25~\" + msg , e ); } } } 5.3.3\u3001\u6d4b\u8bd5 \u00b6 \u53ef\u4ee5\u770b\u5230\uff0c\u7528\u62371\u5bf9\u4e8e\u89c6\u9891\u6709\u70b9\u8d5e\u3001\u53d6\u6d88\u70b9\u8d5e\u3001\u8bc4\u8bba\u7b49\u64cd\u4f5c\u3002 5.4\u3001\u90e8\u7f72\u63a8\u8350\u670d\u52a1 \u00b6 #\u62c9\u53d6\u955c\u50cf docker pull registry.cn-hangzhou.aliyuncs.com/itcast/tanhua-spark-video:1.0 #\u521b\u5efa\u5bb9\u5668 docker create --name tanhua-spark-video \\ --env MONGODB_HOST = 192 .168.31.81 \\ --env MONGODB_PORT = 27017 \\ --env MONGODB_USERNAME = tanhua \\ --env MONGODB_PASSWORD = l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV \\ --env MONGODB_DATABASE = tanhua \\ --env MONGODB_COLLECTION = recommend_video \\ --env SCHEDULE_PERIOD = 10 \\ --env REDIS_NODES = \"192.168.31.81:6379,192.168.31.81:6380,192.168.31.81:6381\" \\ registry.cn-hangzhou.aliyuncs.com/itcast/tanhua-spark-video:1.0 #\u542f\u52a8\u670d\u52a1 docker start tanhua-spark-video #\u67e5\u770b\u65e5\u5fd7 docker logs -f tanhua-spark-video \u6d4b\u8bd5\uff1a","title":"day10"},{"location":"tantan/day10/#_1","text":"\u4e86\u89e3\u63a8\u8350\u7cfb\u7edf \u5b9e\u73b0\u597d\u53cb\u7684\u63a8\u8350 \u5708\u5b50\u63a8\u8350\u529f\u80fd\u8bf4\u660e \u5708\u5b50\u63a8\u8350\u529f\u80fd\u6d41\u7a0b \u5708\u5b50\u63a8\u8350\u529f\u80fd\u7684\u5b9e\u73b0 \u5c0f\u89c6\u9891\u63a8\u8350\u529f\u80fd\u7684\u5b9e\u73b0","title":"\u8bfe\u7a0b\u8bf4\u660e"},{"location":"tantan/day10/#1","text":"","title":"1\u3001\u4e86\u89e3\u63a8\u8350\u7cfb\u7edf"},{"location":"tantan/day10/#11","text":"\u4e3a\u4e86\u89e3\u51b3\u4fe1\u606f\u8fc7\u8f7d\u548c\u7528\u6237\u65e0\u660e\u786e\u9700\u6c42\u7684\u95ee\u9898\uff0c\u627e\u5230\u7528\u6237\u611f\u5174\u8da3\u7684\u7269\u54c1\uff0c\u624d\u6709\u4e86\u4e2a\u6027\u5316\u63a8\u8350\u7cfb\u7edf\u3002 \u5176\u5b9e\uff0c\u89e3\u51b3\u4fe1\u606f\u8fc7\u8f7d\u7684\u95ee\u9898\uff0c\u4ee3\u8868\u6027\u7684\u89e3\u51b3\u65b9\u6848\u662f\u5206\u7c7b\u76ee\u5f55\u548c\u641c\u7d22\u5f15\u64ce\uff0c\u5982hao123\uff0c\u7535\u5546\u9996\u9875\u7684\u5206\u7c7b\u76ee\u5f55\u4ee5\u53ca\u767e\u5ea6\uff0c360\u641c\u7d22\u7b49\u3002 \u4e0d\u8fc7\u5206\u7c7b\u76ee\u5f55\u548c\u641c\u7d22\u5f15\u64ce\u53ea\u80fd\u89e3\u51b3\u7528\u6237\u4e3b\u52a8\u67e5\u627e\u4fe1\u606f\u7684\u9700\u6c42\uff0c\u5373\u7528\u6237\u77e5\u9053\u81ea\u5df1\u60f3\u8981\u4ec0\u4e48\uff0c\u5e76\u4e0d\u80fd\u89e3\u51b3\u7528\u6237\u6ca1\u7528\u660e\u786e\u9700\u6c42\u5f88\u968f\u4fbf\u7684\u95ee\u9898\u3002 \u7ecf\u5178\u8bed\u5f55\u662f\uff1a\u4f60\u60f3\u5403\u4ec0\u4e48\uff0c\u968f\u4fbf\uff01\u9762\u5bf9\u8fd9\u79cd\u5f88\u968f\u4fbf\u53c8\u5f97\u7f6a\u4e0d\u8d77\u7684\u7528\u6237\uff08\u5973\u53cb\u548c\u4e0a\u5e1d\uff09\uff0c\u53ea\u80fd \u901a\u8fc7\u5206\u6790\u7528\u6237\u7684\u5386\u53f2\u884c\u4e3a\u7ed9\u7528\u6237\u7684\u5174\u8da3\u5efa\u6a21 \uff0c\u4ece\u800c\u4e3b\u52a8\u7ed9\u7528\u6237\u63a8\u8350\u80fd\u591f\u6ee1\u8db3\u4ed6\u4eec\u5174\u8da3\u548c\u9700\u6c42\u7684\u4fe1\u606f\u3002\u6bd4\u5982\u95ee\u95ee\u5973\u53cb\u7684\u95fa\u871c\uff0c\u5979\u4e00\u822c\u4ec0\u4e48\u65f6\u5019\u559c\u6b22\u5403\u4ec0\u4e48\u3002","title":"1.1\u3001\u4ec0\u4e48\u662f\u63a8\u8350\u7cfb\u7edf\uff1f"},{"location":"tantan/day10/#12","text":"[ ] \u7535\u5b50\u5546\u52a1\u7f51\u7ad9\u662f\u4e2a\u6027\u5316\u63a8\u8350\u7cfb\u7edf\u91cd\u8981\u5730\u5e94\u7528\u7684\u9886\u57df\u4e4b\u4e00\uff0c\u4e9a\u9a6c\u900a\u5c31\u662f\u4e2a\u6027\u5316\u63a8\u8350\u7cfb\u7edf\u7684\u79ef\u6781\u5e94\u7528\u8005\u548c\u63a8\u5e7f\u8005\uff0c\u4e9a\u9a6c\u900a\u7684\u63a8\u8350\u7cfb\u7edf\u6df1\u5165\u5230\u7f51\u7ad9\u7684\u5404\u7c7b\u5546\u54c1\uff0c\u4e3a\u4e9a\u9a6c\u900a\u5e26\u6765\u4e86\u81f3\u5c1130%\u7684\u9500\u552e\u989d\u3002 [ ] \u4e0d\u5149\u662f\u7535\u5546\u7c7b\uff0c\u63a8\u8350\u7cfb\u7edf\u65e0\u5904\u4e0d\u5728\u3002QQ\uff0c\u5fae\u4fe1\u7684\u597d\u53cb\u63a8\u8350\uff1b\u65b0\u6d6a\u5fae\u535a\u7684\u4f60\u53ef\u80fd\u611f\u5174\u8da3\u7684\u4eba\uff1b\u4f18\u9177\uff0c\u571f\u8c46\u7684\u7535\u5f71\u63a8\u8350\uff1b\u8c46\u74e3\u7684\u56fe\u4e66\u63a8\u8350\uff1b\u5927\u4ece\u70b9\u8bc4\u7684\u9910\u996e\u63a8\u8350\uff1b\u8109\u8109\u7684\u540c\u4e8b\u63a8\u8350\u7b49\u3002 [ ] \u63a8\u8350\u5f15\u64ce\u7684\u9f3b\u7956\u601d\u60f3\u6e90\u6cc9\uff1ahttp://portal.acm.org/citation.cfm?id=1070751 [ ] \u4e9a\u9a6c\u900a\u6700\u65e9\u63d0\u51fa\u57fa\u4e8d\u7269\u54c1\u7684\u534f\u540c\u8fc7\u6ee4\u63a8\u8350\u7b97\u6cd5\uff1ahttp://portal.acm.org/citation.cfm?id=372071 \u4eac\u4e1c\u7684\u63a8\u8350\uff1a","title":"1.2\u3001\u7535\u5546\u662f\u63a8\u8350\u7cfb\u7edf\u7684\u5148\u884c\u8005"},{"location":"tantan/day10/#13","text":"\u63a8\u8350\u7cfb\u7edf\u5e7f\u6cdb\u5b58\u5728\u4e8e\u5404\u7c7b\u7f51\u7ad9\u4e2d\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u5e94\u7528\u4e3a\u7528\u6237\u63d0\u4f9b\u4e2a\u6027\u5316\u7684\u63a8\u8350\u3002\u5b83\u9700\u8981\u4e00\u4e9b\u7528\u6237\u7684\u5386\u53f2\u6570\u636e\uff0c\u4e00\u822c\u7531\u4e09\u4e2a\u90e8\u5206\u7ec4\u6210\uff1a\u57fa\u7840\u6570\u636e\u3001\u63a8\u8350\u7b97\u6cd5\u7cfb\u7edf\u3001\u524d\u53f0\u5c55\u793a\u3002 \u57fa\u7840\u6570\u636e\u5305\u62ec\u5f88\u591a\u7ef4\u5ea6\uff0c\u5305\u62ec\u7528\u6237\u7684\u8bbf\u95ee\u3001\u6d4f\u89c8\u3001\u4e0b\u5355\u3001\u6536\u85cf\uff0c\u7528\u6237\u7684\u5386\u53f2\u8ba2\u5355\u4fe1\u606f\uff0c\u8bc4\u4ef7\u4fe1\u606f\u7b49\u5f88\u591a\u4fe1\u606f\uff1b \u63a8\u8350\u7b97\u6cd5\u7cfb\u7edf\u4e3b\u8981\u662f\u6839\u636e\u4e0d\u540c\u7684\u63a8\u8350\u8bc9\u6c42\u7531\u591a\u4e2a\u7b97\u6cd5\u7ec4\u6210\u7684\u63a8\u8350\u6a21\u578b\uff1b \u524d\u53f0\u5c55\u793a\u4e3b\u8981\u662f\u5bf9\u5ba2\u6237\u7aef\u7cfb\u7edf\u8fdb\u884c\u54cd\u5e94\uff0c\u8fd4\u56de\u76f8\u5173\u7684\u63a8\u8350\u4fe1\u606f\u4ee5\u4f9b\u5c55\u793a\u3002","title":"1.3\u3001\u63a8\u8350\u7cfb\u7edf\u4e1a\u52a1\u6d41\u7a0b"},{"location":"tantan/day10/#14","text":"\u8fc4\u4eca\u4e3a\u6b62\uff0c\u5728\u4e2a\u6027\u5316\u63a8\u8350\u7cfb\u7edf\u4e2d\uff0c\u534f\u540c\u8fc7\u6ee4\u6280\u672f\u662f\u5e94\u7528\u6700\u6210\u529f\u7684\u6280\u672f\u3002\u76ee\u524d\u56fd\u5185\u5916\u6709\u8bb8\u591a\u5927\u578b\u7f51\u7ad9\u5e94\u7528\u8fd9\u9879\u6280\u672f\u4e3a\u7528\u6237\u66f4\u52a0\u667a\u80fd\uff08\u4e2a\u6027\u5316\u3001\u5343\u4eba\u5343\u9762\uff09\u7684\u63a8\u8350\u5185\u5bb9\u3002 \u6838\u5fc3\u601d\u60f3\uff1a \u534f\u540c\u8fc7\u6ee4\u4e00\u822c\u662f\u5728\u6d77\u91cf\u7684\u7528\u6237\u4e2d\u53d1\u6398\u51fa\u4e00\u5c0f\u90e8\u5206\u548c\u4f60\u54c1\u4f4d\u6bd4\u8f83\u7c7b\u4f3c\u7684\uff0c\u5728\u534f\u540c\u8fc7\u6ee4\u4e2d\uff0c\u8fd9\u4e9b\u7528\u6237\u6210\u4e3a\u90bb\u5c45\uff0c\u7136\u540e\u6839\u636e\u4ed6\u4eec\u559c\u6b22\u7684\u5176\u4ed6\u4e1c\u897f\u7ec4\u7ec7\u6210\u4e00\u4e2a\u6392\u5e8f\u7684\u76ee\u5f54\u4f5c\u4e3a\u63a8\u8350\u7ed9\u4f60\u3002","title":"1.4\u3001\u534f\u540c\u8fc7\u6ee4\u63a8\u8350\u7b97\u6cd5"},{"location":"tantan/day10/#141_usercf","text":"\u5bf9\u4e8e\u7528\u6237A\uff0c\u6839\u636e\u7528\u6237\u7684\u5386\u53f2\u504f\u597d\uff0c\u8fd9\u91cc\u53ea\u8ba1\u7b97\u5f97\u5230\u4e00\u4e2a\u90bb\u5c45\u2013\u7528\u6237C\uff0c\u7136\u540e\u5c06\u7528\u6237C \u559c\u6b22\u7684\u7269\u54c1D \u63a8\u8350\u7ed9\u7528\u6237A\u3002 \u57fa\u4e8e\u7528\u6237\u7684\u534f\u540c\u8fc7\u6ee4\u7b97\u6cd5\u5148\u8ba1\u7b97\u7684\u662f\u7528\u6237\u4e0e\u7528\u6237\u7684\u76f8\u4f3c\u5ea6\uff08\u5174\u8da3\u76f8\u6295\uff0c\u7269\u4ee5\u7c7b\u805a\u4eba\u4ee5\u7fa4\u5206\uff09\uff0c\u7136\u540e\u5c06\u76f8\u4f3c\u5ea6\u6bd4\u8f83\u63a5\u8fd1\u7684\u7528\u6237A\u8d2d\u4e70\u7684\u7269\u54c1\u63a8\u8350\u7ed9\u7528\u6237B\uff0c\u4e13\u4e1a\u7684\u8bf4\u6cd5\u662f\u8be5\u7b97\u6cd5\u7528\u6700\u8fd1\u90bb\u5c45\uff08nearest-neighbor\uff09\u7b97\u6cd5\u627e\u51fa\u4e00\u4e2a\u7528\u6237\u7684\u90bb\u5c45\u96c6\u5408\uff0c\u8be5\u96c6\u5408\u7684\u7528\u6237\u548c\u8be5\u7528\u6237\u6709\u76f8\u4f3c\u7684\u559c\u597d\uff0c\u7b97\u6cd5\u6839\u636e\u90bb\u5c45\u7684\u504f\u597d\u5bf9\u8be5\u7528\u6237\u8fdb\u884c\u9884\u6d4b\u3002","title":"1.4.1\u3001\u57fa\u4e8e\u7528\u6237\u7684\u63a8\u8350 UserCF"},{"location":"tantan/day10/#142_itemcf","text":"\u57fa\u4e8eItemCF\u7684\u539f\u7406\u548c\u57fa\u4e8eUserCF\u7c7b\u4f3c\uff0c\u53ea\u662f\u5728\u8ba1\u7b97\u90bb\u5c45\u65f6\u91c7\u7528\u7269\u54c1\u672c\u8eab\uff0c\u800c\u4e0d\u662f\u4ece\u7528\u6237\u7684\u89d2\u5ea6\uff0c\u5373\u57fa\u4e8e\u7528\u6237\u5bf9\u7269\u54c1\u7684\u504f\u597d\u627e\u5230\u76f8\u4f3c\u7684\u7269\u54c1\uff0c\u7136\u540e\u6839\u636e\u7528\u6237\u7684\u5386\u53f2\u504f\u597d\uff0c\u63a8\u8350\u76f8\u4f3c\u7684\u7269\u54c1\u7ed9\u4ed6\u3002 \u4ece\u8ba1\u7b97\u7684\u89d2\u5ea6\u770b\uff0c\u5c31\u662f\u5c06\u6240\u6709\u7528\u6237\u5bf9\u67d0\u4e2a\u7269\u54c1\u7684\u504f\u597d\u4f5c\u4e3a\u4e00\u4e2a\u5411\u91cf\u6765\u8ba1\u7b97\u7269\u54c1\u4e4b\u95f4\u7684\u76f8\u4f3c\u5ea6\uff0c\u5f97\u5230\u7269\u54c1\u7684\u76f8\u4f3c\u7269\u54c1\u540e\uff0c\u6839\u636e\u7528\u6237\u5386\u53f2\u7684\u504f\u597d\u9884\u6d4b\u5f53\u524d\u7528\u6237\u8fd8\u6ca1\u6709\u8868\u793a\u504f\u597d\u7684\u7269\u54c1\uff0c\u8ba1\u7b97\u5f97\u5230\u4e00\u4e2a\u6392\u5e8f\u7684\u7269\u54c1\u5217\u8868\u4f5c\u4e3a\u63a8\u8350\u3002 \u89e3\u91ca\uff1a\u5bf9\u4e8e\u7269\u54c1A\uff0c\u6839\u636e\u6240\u6709\u7528\u6237\u7684\u5386\u53f2\u504f\u597d\uff0c\u559c\u6b22\u7269\u54c1A \u7684\u7528\u6237\u90fd\u559c\u6b22\u7269\u54c1C\uff0c\u5f97\u51fa\u7269\u54c1A \u548c\u7269\u54c1C \u6bd4\u8f83\u76f8\u4f3c\uff0c\u800c\u7528\u6237C \u559c\u6b22\u7269\u54c1A\uff0c\u90a3\u4e48\u53ef\u4ee5\u63a8\u65ad\u51fa\u7528\u6237C \u53ef\u80fd\u4e5f\u559c\u6b22\u7269\u54c1C\u3002","title":"1.4.2\u3001\u57fa\u4e8e\u5546\u54c1\u7684\u63a8\u8350 ItemCF"},{"location":"tantan/day10/#15als","text":"ALS \u662f\u4ea4\u66ff\u6700\u5c0f\u4e8c\u4e58 \uff08alternating least squares\uff09\u7684\u7b80\u79f0\u3002\u5728\u673a\u5668\u5b66\u4e60\u7684\u4e0a\u4e0b\u6587\u4e2d\uff0cALS \u7279\u6307\u4f7f\u7528\u4ea4\u66ff\u6700\u5c0f\u4e8c\u4e58\u6c42\u89e3\u7684\u4e00\u4e2a\u534f\u540c\u63a8\u8350\u7b97\u6cd5\u3002\u5b83\u901a\u8fc7\u89c2\u5bdf\u5230\u7684\u6240\u6709\u7528\u6237\u7ed9\u4ea7\u54c1\u7684\u6253\u5206\uff0c\u6765\u63a8\u65ad\u6bcf\u4e2a\u7528\u6237\u7684\u559c\u597d\u5e76\u5411\u7528\u6237\u63a8\u8350\u9002\u5408\u7684\u4ea7\u54c1\u3002\u4ece\u534f\u540c\u8fc7\u6ee4\u7684\u5206\u7c7b\u6765\u8bf4\uff0cALS\u7b97\u6cd5\u5c5e\u4e8eUser-Item CF\uff0c\u4e5f\u53eb\u505a\u6df7\u5408CF\u3002\u5b83\u540c\u65f6\u8003\u8651\u4e86User\u548cItem\u4e24\u4e2a\u65b9\u9762\u3002 \u7528\u6237\u548c\u5546\u54c1\u7684\u5173\u7cfb\uff0c\u53ef\u4ee5\u62bd\u8c61\u4e3a\u5982\u4e0b\u7684\u4e09\u5143\u7ec4\uff1a \u3002\u5176\u4e2d\uff0cRating\u662f\u7528\u6237\u5bf9\u5546\u54c1\u7684\u8bc4\u5206\uff0c\u8868\u5f81\u7528\u6237\u5bf9\u8be5\u5546\u54c1\u7684\u559c\u597d\u7a0b\u5ea6\u3002\u5982\u4e0b\uff1a 196 242 3 881250949 186 302 3 891717742 22 377 1 878887116 244 51 2 880606923 166 346 1 886397596 298 474 4 884182806 115 265 2 881171488 253 465 5 891628467 305 451 3 886324817 6 86 3 883603013 62 257 2 879372434 286 1014 5 879781125 200 222 5 876042340 210 40 3 891035994 ................","title":"1.5\u3001ALS\u7b97\u6cd5"},{"location":"tantan/day10/#2","text":"\u5bf9\u4e8e\u597d\u53cb\u7684\u63a8\u8350\uff0c\u9700\u8981\u627e\u51fa\u6bcf\u4e2a\u7528\u6237\u4e4b\u95f4\u7684\u76f8\u4f3c\u6027\uff0c\u5177\u4f53\u89c4\u5219\u5982\u4e0b\uff1a \u5b57\u6bb5 \u6743\u91cd\u5206 \u5e74\u9f84\u5dee 0-2\u5c81 30\u5206 3-5 20\u5206 5-10\u5c81 10\u5206 10\u5c81\u4ee5\u4e0a 0\u5206 \u6027\u522b \u5f02\u6027 30\u5206 \u540c\u6027 0\u5206 \u4f4d\u7f6e \u540c\u57ce 20\u5206 \u4e0d\u540c 0\u5206 \u5b66\u5386 \u76f8\u540c 20\u5206 \u4e0d\u540c 0\u5206","title":"2\u3001\u597d\u53cb\u63a8\u8350"},{"location":"tantan/day10/#21","text":"","title":"2.1\u3001\u6d41\u7a0b"},{"location":"tantan/day10/#22","text":"#\u62c9\u53d6\u955c\u50cf docker pull registry.cn-hangzhou.aliyuncs.com/itcast/tanhua-spark-recommend-user:1.0.1 #\u521b\u5efa\u5bb9\u5668 docker create --name tanhua-spark-recommend-user \\ --env MONGODB_HOST = 192 .168.31.81 \\ --env MONGODB_PORT = 27017 \\ --env MONGODB_USERNAME = tanhua \\ --env MONGODB_PASSWORD = l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV \\ --env MONGODB_DATABASE = tanhua \\ --env MONGODB_COLLECTION = recommend_user \\ --env JDBC_URL = \"jdbc:mysql://192.168.31.81:3306/mytanhua?useUnicode=true&characterEncoding=utf8&autoReconnect=true&allowMultiQueries=true&useSSL=false\" \\ --env JDBC_DRIVER = com.mysql.jdbc.Driver \\ --env JDBC_USER = root \\ --env JDBC_PASSWORD = root \\ --env JDBC_TABLE = tb_user_info \\ --env SCHEDULE_PERIOD = 30 \\ registry.cn-hangzhou.aliyuncs.com/itcast/tanhua-spark-recommend-user:1.0.1 #\u53c2\u6570\u8bf4\u660e #MONGODB_HOST mongodb\u670d\u52a1\u7684\u5730\u5740 #MONGODB_PORT mongodb\u670d\u52a1\u7684\u7aef\u53e3 #MONGODB_USERNAME mongodb\u670d\u52a1\u7684\u8ba4\u8bc1\u7528\u6237\u540d #MONGODB_PASSWORD mongodb\u670d\u52a1\u7684\u8ba4\u8bc1\u5bc6\u7801 #MONGODB_DATABASE mongodb\u8fde\u63a5\u7684\u6570\u636e\u5e93 #MONGODB_COLLECTION \u64cd\u4f5c\u8868 #JDBC_URL mysql\u6570\u636e\u5e93\u8fde\u63a5\u5730\u5740 #JDBC_DRIVER jdbc\u9a71\u52a8 #JDBC_USER \u6570\u636e\u5e93\u8fde\u63a5\u7528\u6237\u540d #JDBC_PASSWORD \u6570\u636e\u5e93\u8fde\u63a5\u5bc6\u7801 #JDBC_TABLE \u6570\u636e\u5e93\u8868\u540d #SCHEDULE_PERIOD \u4e0b\u6b21\u6267\u884c\u65f6\u95f4\u95f4\u9694\uff0c\u4f46\u662f\u4e3a\u5206\uff0c\u9ed8\u8ba4\u4e3a10\u5206\u949f #\u542f\u52a8\u670d\u52a1 docker start tanhua-spark-recommend-user #\u67e5\u770b\u65e5\u5fd7 docker logs -f tanhua-spark-recommend-user \u6267\u884c\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u770b\u5230MongoDB\u4e2d\u7684recommend_user\u8868\u4e2d\u6570\u636e\u5df2\u7ecf\u91cd\u65b0\u751f\u6210\u4e86\u3002","title":"2.2\u3001\u90e8\u7f72\u597d\u53cb\u63a8\u8350\u670d\u52a1"},{"location":"tantan/day10/#3","text":"","title":"3\u3001\u5708\u5b50\u63a8\u8350"},{"location":"tantan/day10/#31","text":"\u5728\u5708\u5b50\u529f\u80fd\u4e2d\uff0c\u9488\u5bf9\u4e8e\u7528\u6237\u53d1\u5e03\u7684\u52a8\u6001\u4fe1\u606f\uff0c\u7cfb\u7edf\u53ef\u4ee5\u6839\u636e\u7528\u6237\u7684\u53d1\u5e03\u3001\u6d4f\u89c8\u3001\u70b9\u8d5e\u7b49\u64cd\u4f5c\uff0c\u5bf9\u52a8\u6001\u4fe1\u606f\u505a\u8ba1\u7b97\uff0c\u7136\u540e\u5bf9\u6bcf\u4e2a\u7528\u6237\u8fdb\u884c\u4e0d\u540c\u7684\u63a8\u8350\u3002","title":"3.1\u3001\u529f\u80fd\u8bf4\u660e"},{"location":"tantan/day10/#32","text":"\u6d41\u7a0b\u8bf4\u660e\uff1a \u7528\u6237\u5bf9\u5708\u5b50\u7684\u52a8\u6001\u64cd\u4f5c\uff0c\u5982\uff1a\u53d1\u5e03\u3001\u6d4f\u89c8\u3001\u70b9\u8d5e\u3001\u559c\u6b22\u7b49\uff0c\u5c31\u4f1a\u7ed9RocketMQ\u8fdb\u884c\u53d1\u9001\u6d88\u606f\uff1b \u63a8\u8350\u7cfb\u7edf\u63a5\u6536\u6d88\u606f\uff0c\u5e76\u4e14\u5904\u7406\u6d88\u606f\u6570\u636e\uff0c\u5904\u7406\u4e4b\u540e\u5c06\u7ed3\u679c\u6570\u636e\u5199\u5165\u5230MongoDB\u4e2d\uff1b Spark\u7cfb\u7edf\u62c9\u53d6\u6570\u636e\uff0c\u7136\u540e\u8fdb\u884c\u63a8\u8350\u8ba1\u7b97\uff1b \u8ba1\u7b97\u4e4b\u540e\u7684\u7ed3\u679c\u6570\u636e\u5199\u5165\u5230Redis\u4e2d\uff0c\u4e3a\u6bcf\u4e2a\u7528\u6237\u90fd\u8fdb\u884c\u4e2a\u6027\u5316\u63a8\u8350\uff1b","title":"3.2\u3001\u6d41\u7a0b\u8bf4\u660e"},{"location":"tantan/day10/#33","text":"\u6d4f\u89c8 +1 \u70b9\u8d5e +5 \u559c\u6b22 +8 \u8bc4\u8bba + 10 \u53d1\u5e03\u52a8\u6001 \u6587\u5b57\u957f\u5ea6\uff1a50\u4ee5\u51851\u5206\uff0c50~100\u4e4b\u95f42\u5206\uff0c100\u4ee5\u4e0a3\u5206 \u56fe\u7247\u4e2a\u6570\uff1a\u6bcf\u4e2a\u56fe\u7247\u4e00\u5206 \u6838\u5fc3\u63a8\u8350\u903b\u8f91\uff1a \u63a8\u8350\u6a21\u578b\uff1a\u7528\u6237 | \u52a8\u6001 | \u8bc4\u5206 \u5176\u4e2d\uff0c\u8bc4\u5206\u662f\u7528\u6237\u5bf9\u52a8\u6001\u64cd\u4f5c\u7684\u5f97\u5206\u5408\u8ba1 \u4e3a\u4ec0\u4e48\u81ea\u5df1\u53d1\u5e03\u52a8\u6001\u8fd8\u8981\u8ba1\u5206\uff1f \u662f\u56e0\u4e3a\uff0c\u81ea\u5df1\u53d1\u5e03\u5c31\u76f8\u5f53\u4e8e\u81ea\u5df1\u5bf9\u6b64\u52a8\u6001\u4e5f\u611f\u5174\u8da3\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u76f8\u4f3c\u7684\u4eba\u4e4b\u95f4\u8fdb\u884c\u63a8\u8350\u4e86\u3002","title":"3.3\u3001\u52a8\u6001\u8ba1\u5206\u89c4\u5219"},{"location":"tantan/day10/#34","text":"","title":"3.4\u3001\u53d1\u9001\u6d88\u606f"},{"location":"tantan/day10/#341quanzimqservice","text":"my-tanhua-server\u589e\u52a0\u4f9d\u8d56\uff1a <!--RocketMQ\u76f8\u5173--> <dependency> <groupId> org.apache.rocketmq </groupId> <artifactId> rocketmq-spring-boot-starter </artifactId> </dependency> <dependency> <groupId> org.apache.rocketmq </groupId> <artifactId> rocketmq-client </artifactId> </dependency> \u914d\u7f6e\u6587\u4ef6\uff1a # RocketMQ\u76f8\u5173\u914d\u7f6e rocketmq.name-server = 192.168.31.81:9876 rocketmq.producer.group = tanhua package com.tanhua.server.service ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.common.pojo.User ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.dubbo.server.api.QuanZiApi ; import com.tanhua.dubbo.server.pojo.Publish ; import lombok.extern.slf4j.Slf4j ; import org.apache.rocketmq.spring.core.RocketMQTemplate ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import java.util.HashMap ; import java.util.Map ; @Service @Slf4j public class QuanziMQService { @Autowired private RocketMQTemplate rocketMQTemplate ; @Reference ( version = \"1.0.0\" ) private QuanZiApi quanZiApi ; /** * \u53d1\u5e03\u52a8\u6001\u6d88\u606f * * @param publishId * @return */ public Boolean publishMsg ( String publishId ) { return this . sendMsg ( publishId , 1 ); } /** * \u6d4f\u89c8\u52a8\u6001\u6d88\u606f * * @param publishId * @return */ public Boolean queryPublishMsg ( String publishId ) { return this . sendMsg ( publishId , 2 ); } /** * \u70b9\u8d5e\u52a8\u6001\u6d88\u606f * * @param publishId * @return */ public Boolean likePublishMsg ( String publishId ) { return this . sendMsg ( publishId , 3 ); } /** * \u53d6\u6d88\u70b9\u8d5e\u52a8\u6001\u6d88\u606f * * @param publishId * @return */ public Boolean disLikePublishMsg ( String publishId ) { return this . sendMsg ( publishId , 6 ); } /** * \u559c\u6b22\u52a8\u6001\u6d88\u606f * * @param publishId * @return */ public Boolean lovePublishMsg ( String publishId ) { return this . sendMsg ( publishId , 4 ); } /** * \u53d6\u6d88\u559c\u6b22\u52a8\u6001\u6d88\u606f * * @param publishId * @return */ public Boolean disLovePublishMsg ( String publishId ) { return this . sendMsg ( publishId , 7 ); } /** * \u8bc4\u8bba\u52a8\u6001\u6d88\u606f * * @param publishId * @return */ public Boolean commentPublishMsg ( String publishId ) { return this . sendMsg ( publishId , 5 ); } /** * \u53d1\u9001\u5708\u5b50\u64cd\u4f5c\u76f8\u5173\u7684\u6d88\u606f * * @param publishId * @param type 1-\u53d1\u52a8\u6001\uff0c2-\u6d4f\u89c8\u52a8\u6001\uff0c 3-\u70b9\u8d5e\uff0c 4-\u559c\u6b22\uff0c 5-\u8bc4\u8bba\uff0c6-\u53d6\u6d88\u70b9\u8d5e\uff0c7-\u53d6\u6d88\u559c\u6b22 * @return */ private Boolean sendMsg ( String publishId , Integer type ) { try { User user = UserThreadLocal . get (); Publish publish = this . quanZiApi . queryPublishById ( publishId ); //\u6784\u5efa\u6d88\u606f Map < String , Object > msg = new HashMap <> (); msg . put ( \"userId\" , user . getId ()); msg . put ( \"date\" , System . currentTimeMillis ()); msg . put ( \"publishId\" , publishId ); msg . put ( \"pid\" , publish . getPid ()); msg . put ( \"type\" , type ); this . rocketMQTemplate . convertAndSend ( \"tanhua-quanzi\" , msg ); } catch ( Exception e ) { log . error ( \"\u53d1\u9001\u6d88\u606f\u5931\u8d25! publishId = \" + publishId + \", type = \" + type , e ); return false ; } return true ; } }","title":"3.4.1\u3001QuanziMQService"},{"location":"tantan/day10/#342quanziservice","text":"\u5728QuanZiService\u5b8c\u6210\u53d1\u9001\u6d88\u606f\u65b9\u6cd5\u8c03\u7528\u3002 package com.tanhua.server.service ; import cn.hutool.core.bean.BeanUtil ; import cn.hutool.core.collection.CollUtil ; import cn.hutool.core.convert.Convert ; import cn.hutool.core.date.DateUtil ; import cn.hutool.core.util.ObjectUtil ; import cn.hutool.core.util.StrUtil ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.common.pojo.User ; import com.tanhua.common.pojo.UserInfo ; import com.tanhua.common.service.PicUploadService ; import com.tanhua.common.utils.RelativeDateFormat ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.common.vo.PicUploadResult ; import com.tanhua.dubbo.server.api.QuanZiApi ; import com.tanhua.dubbo.server.api.VisitorsApi ; import com.tanhua.dubbo.server.pojo.Comment ; import com.tanhua.dubbo.server.pojo.Publish ; import com.tanhua.dubbo.server.pojo.Visitors ; import com.tanhua.dubbo.server.vo.PageInfo ; import com.tanhua.server.vo.CommentVo ; import com.tanhua.server.vo.PageResult ; import com.tanhua.server.vo.QuanZiVo ; import com.tanhua.server.vo.VisitorsVo ; import org.apache.commons.lang3.StringUtils ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import org.springframework.web.multipart.MultipartFile ; import java.util.* ; @Service public class QuanZiService { @Reference ( version = \"1.0.0\" ) private QuanZiApi quanZiApi ; @Reference ( version = \"1.0.0\" ) private VisitorsApi visitorsApi ; @Autowired private UserService userService ; @Autowired private UserInfoService userInfoService ; @Autowired private PicUploadService picUploadService ; @Autowired private QuanziMQService quanziMQService ; public PageResult queryPublishList ( Integer page , Integer pageSize ) { //\u5206\u6790\uff1a\u901a\u8fc7dubbo\u4e2d\u7684\u670d\u52a1\u67e5\u8be2\u7528\u6237\u7684\u597d\u53cb\u52a8\u6001 //\u901a\u8fc7mysql\u67e5\u8be2\u7528\u6237\u7684\u4fe1\u606f\uff0c\u56de\u5199\u5230\u7ed3\u679c\u5bf9\u8c61\u4e2d\uff08QuanZiVo\uff09 PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); //\u76f4\u63a5\u4eceThreadLocal\u4e2d\u83b7\u53d6\u5bf9\u8c61 User user = UserThreadLocal . get (); //\u901a\u8fc7dubbo\u67e5\u8be2\u6570\u636e PageInfo < Publish > pageInfo = this . quanZiApi . queryPublishList ( user . getId (), page , pageSize ); List < Publish > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )) { return pageResult ; } pageResult . setItems ( this . fillQuanZiVo ( records )); return pageResult ; } /** * \u586b\u5145\u7528\u6237\u4fe1\u606f * * @param userInfo * @param quanZiVo */ private void fillUserInfoToQuanZiVo ( UserInfo userInfo , QuanZiVo quanZiVo ) { BeanUtil . copyProperties ( userInfo , quanZiVo , \"id\" ); quanZiVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); quanZiVo . setTags ( StringUtils . split ( userInfo . getTags (), ',' )); //\u5f53\u524d\u7528\u6237 User user = UserThreadLocal . get (); quanZiVo . setCommentCount ( 0 ); //TODO \u8bc4\u8bba\u6570 quanZiVo . setDistance ( \"1.2\u516c\u91cc\" ); //TODO \u8ddd\u79bb quanZiVo . setHasLiked ( this . quanZiApi . queryUserIsLike ( user . getId (), quanZiVo . getId ()) ? 1 : 0 ); //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLikeCount ( Convert . toInt ( this . quanZiApi . queryLikeCount ( quanZiVo . getId ()))); //\u70b9\u8d5e\u6570 quanZiVo . setHasLoved ( this . quanZiApi . queryUserIsLove ( user . getId (), quanZiVo . getId ()) ? 1 : 0 ); //\u662f\u5426\u559c\u6b22\uff081\u662f\uff0c0\u5426\uff09 quanZiVo . setLoveCount ( Convert . toInt ( this . quanZiApi . queryLoveCount ( quanZiVo . getId ()))); //\u559c\u6b22\u6570 } /** * \u6839\u636e\u67e5\u8be2\u5230\u7684publish\u96c6\u5408\u586b\u5145QuanZiVo\u5bf9\u8c61 * * @param records * @return */ private List < QuanZiVo > fillQuanZiVo ( List < Publish > records ) { List < QuanZiVo > quanZiVoList = new ArrayList <> (); records . forEach ( publish -> { QuanZiVo quanZiVo = new QuanZiVo (); quanZiVo . setId ( publish . getId (). toHexString ()); quanZiVo . setTextContent ( publish . getText ()); quanZiVo . setImageContent ( publish . getMedias (). toArray ( new String [] {})); quanZiVo . setUserId ( publish . getUserId ()); quanZiVo . setCreateDate ( RelativeDateFormat . format ( new Date ( publish . getCreated ()))); quanZiVoList . add ( quanZiVo ); }); //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIds = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); for ( QuanZiVo quanZiVo : quanZiVoList ) { //\u627e\u5230\u5bf9\u5e94\u7684\u7528\u6237\u4fe1\u606f for ( UserInfo userInfo : userInfoList ) { if ( quanZiVo . getUserId (). longValue () == userInfo . getUserId (). longValue ()) { this . fillUserInfoToQuanZiVo ( userInfo , quanZiVo ); break ; } } } return quanZiVoList ; } /** * \u53d1\u5e03\u52a8\u6001 * * @param textContent * @param location * @param latitude * @param longitude * @param multipartFile * @return */ public String savePublish ( String textContent , String location , String latitude , String longitude , MultipartFile [] multipartFile ) { //\u67e5\u8be2\u5f53\u524d\u7684\u767b\u5f55\u4fe1\u606f User user = UserThreadLocal . get (); Publish publish = new Publish (); publish . setUserId ( user . getId ()); publish . setText ( textContent ); publish . setLocationName ( location ); publish . setLatitude ( latitude ); publish . setLongitude ( longitude ); publish . setSeeType ( 1 ); List < String > picUrls = new ArrayList <> (); //\u56fe\u7247\u4e0a\u4f20 for ( MultipartFile file : multipartFile ) { PicUploadResult picUploadResult = this . picUploadService . upload ( file ); picUrls . add ( picUploadResult . getName ()); } publish . setMedias ( picUrls ); String publishId = this . quanZiApi . savePublish ( publish ); if ( StrUtil . isNotEmpty ( publishId )){ //\u53d1\u9001\u6d88\u606f this . quanziMQService . publishMsg ( publishId ); } return publishId ; } public PageResult queryRecommendPublishList ( Integer page , Integer pageSize ) { //\u5206\u6790\uff1a\u901a\u8fc7dubbo\u4e2d\u7684\u670d\u52a1\u67e5\u8be2\u7cfb\u7edf\u63a8\u8350\u52a8\u6001 //\u901a\u8fc7mysql\u67e5\u8be2\u7528\u6237\u7684\u4fe1\u606f\uff0c\u56de\u5199\u5230\u7ed3\u679c\u5bf9\u8c61\u4e2d\uff08QuanZiVo\uff09 PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); //\u76f4\u63a5\u4eceThreadLocal\u4e2d\u83b7\u53d6\u5bf9\u8c61 User user = UserThreadLocal . get (); //\u901a\u8fc7dubbo\u67e5\u8be2\u6570\u636e PageInfo < Publish > pageInfo = this . quanZiApi . queryRecommendPublishList ( user . getId (), page , pageSize ); List < Publish > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )) { return pageResult ; } pageResult . setItems ( this . fillQuanZiVo ( records )); return pageResult ; } /** * \u52a8\u6001\u70b9\u8d5e * @param publishId * @return */ public Long likeComment ( String publishId ) { User user = UserThreadLocal . get (); Boolean result = this . quanZiApi . likeComment ( user . getId (), publishId ); if ( result ) { //\u53d1\u6d88\u606f this . quanziMQService . likePublishMsg ( publishId ); //\u67e5\u8be2\u70b9\u8d5e\u6570 return this . quanZiApi . queryLikeCount ( publishId ); } return null ; } /** * \u52a8\u6001\u7684\u53d6\u6d88\u70b9\u8d5e * * @param publishId * @return */ public Long disLikeComment ( String publishId ) { User user = UserThreadLocal . get (); Boolean result = this . quanZiApi . disLikeComment ( user . getId (), publishId ); if ( result ) { //\u53d1\u6d88\u606f this . quanziMQService . disLikePublishMsg ( publishId ); //\u67e5\u8be2\u70b9\u8d5e\u6570 return this . quanZiApi . queryLikeCount ( publishId ); } return null ; } public Long loveComment ( String publishId ) { User user = UserThreadLocal . get (); //\u559c\u6b22 Boolean result = this . quanZiApi . loveComment ( user . getId (), publishId ); if ( result ){ //\u53d1\u6d88\u606f this . quanziMQService . lovePublishMsg ( publishId ); //\u67e5\u8be2\u559c\u6b22\u6570 return this . quanZiApi . queryLoveCount ( publishId ); } return null ; } public Long disLoveComment ( String publishId ) { User user = UserThreadLocal . get (); //\u53d6\u6d88\u559c\u6b22 Boolean result = this . quanZiApi . disLoveComment ( user . getId (), publishId ); if ( result ){ //\u53d1\u6d88\u606f this . quanziMQService . disLovePublishMsg ( publishId ); //\u67e5\u8be2\u559c\u6b22\u6570 return this . quanZiApi . queryLoveCount ( publishId ); } return null ; } public QuanZiVo queryById ( String publishId ) { Publish publish = this . quanZiApi . queryPublishById ( publishId ); if ( publish == null ) { return null ; } //\u53d1\u6d88\u606f this . quanziMQService . queryPublishMsg ( publishId ); return this . fillQuanZiVo ( Arrays . asList ( publish )). get ( 0 ); } /** * \u67e5\u8be2\u8bc4\u8bba\u5217\u8868 * * @param publishId * @param page * @param pageSize * @return */ public PageResult queryCommentList ( String publishId , Integer page , Integer pageSize ) { PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); User user = UserThreadLocal . get (); //\u67e5\u8be2\u8bc4\u8bba\u5217\u8868\u6570\u636e PageInfo < Comment > pageInfo = this . quanZiApi . queryCommentList ( publishId , page , pageSize ); List < Comment > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )){ return pageResult ; } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIdList = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIdList ); List < CommentVo > result = new ArrayList <> (); for ( Comment record : records ) { CommentVo commentVo = new CommentVo (); commentVo . setContent ( record . getContent ()); commentVo . setId ( record . getId (). toHexString ()); commentVo . setCreateDate ( DateUtil . format ( new Date ( record . getCreated ()), \"HH:mm\" )); //\u662f\u5426\u70b9\u8d5e commentVo . setHasLiked ( this . quanZiApi . queryUserIsLike ( user . getId (), commentVo . getId ()) ? 1 : 0 ); //\u70b9\u8d5e\u6570 commentVo . setLikeCount ( Convert . toInt ( this . quanZiApi . queryLikeCount ( commentVo . getId ()))); for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( record . getUserId (), userInfo . getUserId ())){ commentVo . setAvatar ( userInfo . getLogo ()); commentVo . setNickname ( userInfo . getNickName ()); break ; } } result . add ( commentVo ); } pageResult . setItems ( result ); return pageResult ; } /** * \u53d1\u8868\u8bc4\u8bba * @param publishId * @param content * @return */ public Boolean saveComments ( String publishId , String content ) { User user = UserThreadLocal . get (); Boolean result = this . quanZiApi . saveComment ( user . getId (), publishId , content ); if ( result ){ //\u53d1\u6d88\u606f this . quanziMQService . commentPublishMsg ( publishId ); } return result ; } public PageResult queryAlbumList ( Long userId , Integer page , Integer pageSize ) { PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); //\u67e5\u8be2\u6570\u636e PageInfo < Publish > pageInfo = this . quanZiApi . queryAlbumList ( userId , page , pageSize ); if ( CollUtil . isEmpty ( pageInfo . getRecords ())){ return pageResult ; } //\u586b\u5145\u6570\u636e pageResult . setItems ( this . fillQuanZiVo ( pageInfo . getRecords ())); return pageResult ; } public List < VisitorsVo > queryVisitorsList () { User user = UserThreadLocal . get (); List < Visitors > visitorsList = this . visitorsApi . queryMyVisitor ( user . getId ()); if ( CollUtil . isEmpty ( visitorsList )) { return Collections . emptyList (); } List < Object > userIds = CollUtil . getFieldValues ( visitorsList , \"visitorUserId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); List < VisitorsVo > visitorsVoList = new ArrayList <> (); for ( Visitors visitor : visitorsList ) { for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( visitor . getVisitorUserId (), userInfo . getUserId ())) { VisitorsVo visitorsVo = new VisitorsVo (); visitorsVo . setAge ( userInfo . getAge ()); visitorsVo . setAvatar ( userInfo . getLogo ()); visitorsVo . setGender ( userInfo . getSex (). name (). toLowerCase ()); visitorsVo . setId ( userInfo . getUserId ()); visitorsVo . setNickname ( userInfo . getNickName ()); visitorsVo . setTags ( StringUtils . split ( userInfo . getTags (), ',' )); visitorsVo . setFateValue ( visitor . getScore (). intValue ()); visitorsVoList . add ( visitorsVo ); break ; } } } return visitorsVoList ; } }","title":"3.4.2\u3001\u4fee\u6539QuanZiService"},{"location":"tantan/day10/#35","text":"\u63a5\u6536\u6d88\u606f\u7684\u5de5\u4f5c\u9700\u8981\u65b0\u521b\u5efamy-tanhua-recommend\u5de5\u7a0b\uff0c\u5728\u6b64\u5de5\u7a0b\u4e2d\u5b8c\u6210\u76f8\u5173\u7684\u64cd\u4f5c\u3002","title":"3.5\u3001\u63a5\u6536\u6d88\u606f"},{"location":"tantan/day10/#351my-tanhua-recommend","text":"<?xml version=\"1.0\" encoding=\"UTF-8\"?> <project xmlns= \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi= \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation= \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\" > <parent> <artifactId> my-tanhua </artifactId> <groupId> cn.itcast.tanhua </groupId> <version> 1.0-SNAPSHOT </version> </parent> <modelVersion> 4.0.0 </modelVersion> <artifactId> my-tanhua-recommend </artifactId> <dependencies> <!--\u5f15\u5165interface\u4f9d\u8d56--> <dependency> <groupId> cn.itcast.tanhua </groupId> <artifactId> my-tanhua-dubbo-interface </artifactId> <version> 1.0-SNAPSHOT </version> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-web </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-test </artifactId> <scope> test </scope> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-redis </artifactId> </dependency> <dependency> <groupId> org.springframework.boot </groupId> <artifactId> spring-boot-starter-data-mongodb </artifactId> </dependency> <!--RocketMQ\u76f8\u5173--> <dependency> <groupId> org.apache.rocketmq </groupId> <artifactId> rocketmq-spring-boot-starter </artifactId> </dependency> <dependency> <groupId> org.apache.rocketmq </groupId> <artifactId> rocketmq-client </artifactId> </dependency> <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> </dependency> <dependency> <groupId> joda-time </groupId> <artifactId> joda-time </artifactId> </dependency> <dependency> <groupId> cn.hutool </groupId> <artifactId> hutool-all </artifactId> </dependency> </dependencies> </project>","title":"3.5.1\u3001\u521b\u5efamy-tanhua-recommend\u5de5\u7a0b"},{"location":"tantan/day10/#352","text":"application.properties spring.application.name = itcast-rocketmq server.port = 18082 # RocketMQ\u76f8\u5173\u914d\u7f6e rocketmq.name-server = 192.168.31.81:9876 rocketmq.producer.group = tanhua # mongodb\u76f8\u5173\u914d\u7f6e spring.data.mongodb.username = tanhua spring.data.mongodb.password = l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV spring.data.mongodb.authentication-database = admin spring.data.mongodb.database = tanhua spring.data.mongodb.port = 27017 spring.data.mongodb.host = 192.168.31.81","title":"3.5.2\u3001\u914d\u7f6e\u6587\u4ef6"},{"location":"tantan/day10/#353","text":"package com.tanhua.recommend ; import org.springframework.boot.SpringApplication ; import org.springframework.boot.autoconfigure.SpringBootApplication ; @SpringBootApplication public class RecommendApplication { public static void main ( String [] args ) { SpringApplication . run ( RecommendApplication . class , args ); } }","title":"3.5.3\u3001\u542f\u52a8\u7c7b"},{"location":"tantan/day10/#354recommendquanzi","text":"\u5b58\u50a8\u5230MongoDB\u7684\u4e2d\u7684\u5b9e\u4f53\u7ed3\u6784\u3002 package com.tanhua.recommend.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.mongodb.core.mapping.Document ; @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"recommend_quanzi\" ) public class RecommendQuanZi { private ObjectId id ; private Long userId ; // \u7528\u6237id private Long publishId ; //\u52a8\u6001id\uff0c\u9700\u8981\u8f6c\u5316\u4e3aLong\u7c7b\u578b private Double score ; //\u5f97\u5206 private Long date ; //\u65f6\u95f4\u6233 }","title":"3.5.4\u3001RecommendQuanZi"},{"location":"tantan/day10/#355quanzimsgconsumer","text":"package com.tanhua.recommend.msg ; import cn.hutool.core.collection.CollUtil ; import cn.hutool.core.util.ObjectUtil ; import cn.hutool.core.util.StrUtil ; import cn.hutool.json.JSONObject ; import cn.hutool.json.JSONUtil ; import com.tanhua.dubbo.server.pojo.Publish ; import com.tanhua.recommend.pojo.RecommendQuanZi ; import lombok.extern.slf4j.Slf4j ; import org.apache.rocketmq.spring.annotation.RocketMQMessageListener ; import org.apache.rocketmq.spring.core.RocketMQListener ; import org.bson.types.ObjectId ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.stereotype.Component ; @Component @RocketMQMessageListener ( topic = \"tanhua-quanzi\" , consumerGroup = \"tanhua-quanzi-consumer\" ) @Slf4j public class QuanZiMsgConsumer implements RocketMQListener < String > { @Autowired private MongoTemplate mongoTemplate ; @Override public void onMessage ( String msg ) { try { JSONObject jsonObject = JSONUtil . parseObj ( msg ); Long userId = jsonObject . getLong ( \"userId\" ); Long date = jsonObject . getLong ( \"date\" ); String publishId = jsonObject . getStr ( \"publishId\" ); Long pid = jsonObject . getLong ( \"pid\" ); Integer type = jsonObject . getInt ( \"type\" ); RecommendQuanZi recommendQuanZi = new RecommendQuanZi (); recommendQuanZi . setUserId ( userId ); recommendQuanZi . setId ( ObjectId . get ()); recommendQuanZi . setDate ( date ); recommendQuanZi . setPublishId ( pid ); //1-\u53d1\u52a8\u6001\uff0c2-\u6d4f\u89c8\u52a8\u6001\uff0c 3-\u70b9\u8d5e\uff0c 4-\u559c\u6b22\uff0c 5-\u8bc4\u8bba\uff0c6-\u53d6\u6d88\u70b9\u8d5e\uff0c7-\u53d6\u6d88\u559c\u6b22 switch ( type ) { case 1 : { Publish publish = this . mongoTemplate . findById ( new ObjectId ( publishId ), Publish . class ); if ( ObjectUtil . isNotEmpty ( publish )) { double score = 0d ; //\u83b7\u53d6\u56fe\u7247\u6570 score += CollUtil . size ( publish . getMedias ()); //\u83b7\u53d6\u6587\u672c\u7684\u957f\u5ea6 //\u6587\u5b57\u957f\u5ea6\uff1a50\u4ee5\u51851\u5206\uff0c50~100\u4e4b\u95f42\u5206\uff0c100\u4ee5\u4e0a3\u5206 int length = StrUtil . length ( publish . getText ()); if ( length >= 0 && length < 50 ) { score += 1 ; } else if ( length < 100 ) { score += 2 ; } else { score += 3 ; } recommendQuanZi . setScore ( score ); } break ; } case 2 : { recommendQuanZi . setScore ( 1d ); break ; } case 3 : { recommendQuanZi . setScore ( 5d ); break ; } case 4 : { recommendQuanZi . setScore ( 8d ); break ; } case 5 : { recommendQuanZi . setScore ( 10 d ); break ; } case 6 : { recommendQuanZi . setScore ( - 5d ); break ; } case 7 : { recommendQuanZi . setScore ( - 8d ); break ; } default : { recommendQuanZi . setScore ( 0d ); break ; } } //\u6570\u636e\u4fdd\u5b58\u5230MongoDB\u4e2d this . mongoTemplate . save ( recommendQuanZi ); } catch ( Exception e ) { log . error ( \"\u5904\u7406\u6d88\u606f\u51fa\u9519\uff01msg = \" + msg , e ); } } }","title":"3.5.5\u3001QuanZiMsgConsumer"},{"location":"tantan/day10/#17","text":"\u6d4b\u8bd5\u65b9\u6cd5\uff1a\u4f7f\u7528APP\u8fdb\u884c\u64cd\u4f5c\uff0c\u53ef\u4ee5\u770b\u5230\u5728MongoDB\u4e2d\u5df2\u7ecf\u6709\u6570\u636e\u5199\u5165\u3002","title":"1.7\u3001\u6d4b\u8bd5"},{"location":"tantan/day10/#4","text":"\u5728\u63a8\u8350\u7cfb\u7edf\u4e2d\uff0c\u6211\u4eec\u5c06\u57fa\u4e8e\u524d\u9762\u5199\u5165\u5230\u63a8\u8350\u8868\u4e2d\u7684\u6570\u636e\u901a\u8fc7Spark\u8fdb\u884c\u8ba1\u7b97\uff0c\u5728Spark\u8ba1\u7b97\u5b8c\u6210\u540e\u5c06\u7ed3\u679c\u5199\u5165\u5230Redis\u4e2d\uff0c\u4ee5\u4f9b\u5728\u4e1a\u52a1\u7cfb\u7edf\u4e2d\u8fdb\u884c\u67e5\u8be2\u3002 \u63a8\u8350\u670d\u52a1\u6211\u4eec\u5c06\u57fa\u4e8edocker\u7684\u5f62\u5f0f\u8fdb\u884c\u90e8\u7f72\uff1a #\u62c9\u53d6\u955c\u50cf docker pull registry.cn-hangzhou.aliyuncs.com/itcast/tanhua-spark-quanzi:1.0 #\u521b\u5efa\u5bb9\u5668 docker create --name tanhua-spark-quanzi \\ --env MONGODB_HOST = 192 .168.31.81 \\ --env MONGODB_PORT = 27017 \\ --env MONGODB_USERNAME = tanhua \\ --env MONGODB_PASSWORD = l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV \\ --env MONGODB_DATABASE = tanhua \\ --env MONGODB_COLLECTION = recommend_quanzi \\ --env SCHEDULE_PERIOD = 10 \\ --env REDIS_NODES = \"192.168.31.81:6379,192.168.31.81:6380,192.168.31.81:6381\" \\ registry.cn-hangzhou.aliyuncs.com/itcast/tanhua-spark-quanzi:1.0 #\u53c2\u6570\u8bf4\u660e #MONGODB_HOST mongodb\u670d\u52a1\u7684\u5730\u5740 #MONGODB_PORT mongodb\u670d\u52a1\u7684\u7aef\u53e3 #MONGODB_USERNAME mongodb\u670d\u52a1\u7684\u8ba4\u8bc1\u7528\u6237\u540d #MONGODB_PASSWORD mongodb\u670d\u52a1\u7684\u8ba4\u8bc1\u5bc6\u7801 #MONGODB_DATABASE mongodb\u8fde\u63a5\u7684\u6570\u636e\u5e93 #MONGODB_COLLECTION \u64cd\u4f5c\u8868 #SCHEDULE_PERIOD \u4e0b\u6b21\u6267\u884c\u65f6\u95f4\u95f4\u9694\uff0c\u4f46\u662f\u4e3a\u5206\uff0c\u9ed8\u8ba4\u4e3a10\u5206\u949f #REDIS_NODES redis\u96c6\u7fa4\u5730\u5740\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5355\u8282\u70b9 #mongodb\u5f00\u542f\u8ba4\u8bc1\u670d\u52a1 #docker create --name mongodb --restart=always -p 27017:27017 -v mongodb:/data/db mongo:4.0.3 --auth #\u542f\u52a8\u670d\u52a1\uff0c\u542f\u52a8\u4e4b\u540e\u5c31\u4f1a\u8fdb\u884c\u6267\u884c\uff0c\u5728SCHEDULE_PERIOD\u65f6\u95f4\u540e\u518d\u6b21\u6267\u884c docker start tanhua-spark-quanzi #\u67e5\u770b\u65e5\u5fd7 docker logs -f tanhua-spark-quanzi #\u6267\u884c\u5b8c\u6210\u540e\u4f1a\u5c06\u6570\u636e\u5199\u5165\u5230redis\u4e2d \u8fdb\u5165redis\u67e5\u770b\u662f\u5426\u5df2\u7ecf\u6709\u6570\u636e\uff1a","title":"4\u3001\u90e8\u7f72\u63a8\u8350\u7cfb\u7edf"},{"location":"tantan/day10/#5","text":"\u5c0f\u89c6\u9891\u7684\u63a8\u8350\u548c\u52a8\u6001\u63a8\u8350\u7684\u5b9e\u73b0\u903b\u8f91\u975e\u5e38\u7684\u7c7b\u4f3c\u3002","title":"5\u3001\u5c0f\u89c6\u9891\u63a8\u8350"},{"location":"tantan/day10/#51","text":"\u53d1\u5e03+2 \u70b9\u8d5e +5 \u8bc4\u8bba + 10","title":"5.1\u3001\u52a8\u6001\u8ba1\u5206\u89c4\u5219"},{"location":"tantan/day10/#52","text":"","title":"5.2\u3001\u53d1\u9001\u6d88\u606f"},{"location":"tantan/day10/#521videomqservice","text":"package com.tanhua.server.service ; import com.alibaba.dubbo.config.annotation.Reference ; import com.tanhua.common.pojo.User ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.dubbo.server.api.VideoApi ; import com.tanhua.dubbo.server.pojo.Video ; import lombok.extern.slf4j.Slf4j ; import org.apache.rocketmq.spring.core.RocketMQTemplate ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import java.util.HashMap ; import java.util.Map ; @Service @Slf4j public class VideoMQService { @Autowired private RocketMQTemplate rocketMQTemplate ; @Reference ( version = \"1.0.0\" ) private VideoApi videoApi ; /** * \u53d1\u5e03\u5c0f\u89c6\u9891\u6d88\u606f * * @return */ public Boolean videoMsg ( String videoId ) { return this . sendMsg ( videoId , 1 ); } /** * \u70b9\u8d5e\u5c0f\u89c6\u9891 * * @return */ public Boolean likeVideoMsg ( String videoId ) { return this . sendMsg ( videoId , 2 ); } /** * \u53d6\u6d88\u70b9\u8d5e\u5c0f\u89c6\u9891 * * @return */ public Boolean disLikeVideoMsg ( String videoId ) { return this . sendMsg ( videoId , 3 ); } /** * \u8bc4\u8bba\u5c0f\u89c6\u9891 * * @return */ public Boolean commentVideoMsg ( String videoId ) { return this . sendMsg ( videoId , 4 ); } /** * \u53d1\u9001\u5c0f\u89c6\u9891\u64cd\u4f5c\u76f8\u5173\u7684\u6d88\u606f * * @param videoId * @param type 1-\u53d1\u52a8\u6001\uff0c2-\u70b9\u8d5e\uff0c 3-\u53d6\u6d88\u70b9\u8d5e\uff0c4-\u8bc4\u8bba * @return */ private Boolean sendMsg ( String videoId , Integer type ) { try { User user = UserThreadLocal . get (); Video video = this . videoApi . queryVideoById ( videoId ); //\u6784\u5efa\u6d88\u606f Map < String , Object > msg = new HashMap <> (); msg . put ( \"userId\" , user . getId ()); msg . put ( \"date\" , System . currentTimeMillis ()); msg . put ( \"videoId\" , videoId ); msg . put ( \"vid\" , video . getVid ()); msg . put ( \"type\" , type ); this . rocketMQTemplate . convertAndSend ( \"tanhua-video\" , msg ); } catch ( Exception e ) { log . error ( \"\u53d1\u9001\u6d88\u606f\u5931\u8d25! videoId = \" + videoId + \", type = \" + type , e ); return false ; } return true ; } }","title":"5.2.1\u3001VideoMQService"},{"location":"tantan/day10/#432videoservice","text":"package com.tanhua.server.service ; import cn.hutool.core.collection.CollUtil ; import cn.hutool.core.convert.Convert ; import cn.hutool.core.util.ObjectUtil ; import cn.hutool.core.util.StrUtil ; import com.alibaba.dubbo.config.annotation.Reference ; import com.github.tobato.fastdfs.domain.conn.FdfsWebServer ; import com.github.tobato.fastdfs.domain.fdfs.StorePath ; import com.github.tobato.fastdfs.service.FastFileStorageClient ; import com.tanhua.common.pojo.User ; import com.tanhua.common.pojo.UserInfo ; import com.tanhua.common.service.PicUploadService ; import com.tanhua.common.utils.UserThreadLocal ; import com.tanhua.common.vo.PicUploadResult ; import com.tanhua.dubbo.server.api.QuanZiApi ; import com.tanhua.dubbo.server.api.VideoApi ; import com.tanhua.dubbo.server.pojo.Video ; import com.tanhua.dubbo.server.vo.PageInfo ; import com.tanhua.server.vo.PageResult ; import com.tanhua.server.vo.VideoVo ; import lombok.extern.slf4j.Slf4j ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.stereotype.Service ; import org.springframework.web.multipart.MultipartFile ; import java.io.IOException ; import java.util.ArrayList ; import java.util.List ; @Service @Slf4j public class VideoService { @Reference ( version = \"1.0.0\" ) private VideoApi videoApi ; @Autowired private PicUploadService picUploadService ; @Autowired protected FastFileStorageClient storageClient ; @Autowired private FdfsWebServer fdfsWebServer ; @Autowired private UserInfoService userInfoService ; @Reference ( version = \"1.0.0\" ) private QuanZiApi quanZiApi ; @Autowired private QuanZiService quanZiService ; @Autowired private VideoMQService videoMQService ; /** * \u5c0f\u89c6\u9891\u4e0a\u4f20 * * @param picFile \u5c01\u9762\u56fe\u7247 * @param videoFile \u89c6\u9891\u6587\u4ef6 * @return */ public Boolean saveVideo ( MultipartFile picFile , MultipartFile videoFile ) { User user = UserThreadLocal . get (); Video video = new Video (); video . setUserId ( user . getId ()); video . setSeeType ( 1 ); try { //\u4e0a\u4f20\u56fe\u7247\u5230\u963f\u91cc\u4e91oss PicUploadResult uploadResult = this . picUploadService . upload ( picFile ); video . setPicUrl ( uploadResult . getName ()); //\u4e0a\u4f20\u89c6\u9891\u5230FastDFS\u4e2d StorePath storePath = this . storageClient . uploadFile ( videoFile . getInputStream (), videoFile . getSize (), StrUtil . subAfter ( videoFile . getOriginalFilename (), '.' , true ), null ); video . setVideoUrl ( fdfsWebServer . getWebServerUrl () + storePath . getFullPath ()); String videoId = this . videoApi . saveVideo ( video ); if ( StrUtil . isNotEmpty ( videoId )){ //\u53d1\u9001\u6d88\u606f this . videoMQService . videoMsg ( videoId ); } return StrUtil . isNotEmpty ( videoId ); } catch ( IOException e ) { log . error ( \"\u4e0a\u4f20\u5c0f\u89c6\u9891\u51fa\u9519~ userId = \" + user . getId () + \", file = \" + videoFile . getOriginalFilename (), e ); } return null ; } public PageResult queryVideoList ( Integer page , Integer pageSize ) { User user = UserThreadLocal . get (); PageResult pageResult = new PageResult (); pageResult . setPage ( page ); pageResult . setPagesize ( pageSize ); PageInfo < Video > pageInfo = this . videoApi . queryVideoList ( user . getId (), page , pageSize ); List < Video > records = pageInfo . getRecords (); if ( CollUtil . isEmpty ( records )) { return pageResult ; } //\u67e5\u8be2\u7528\u6237\u4fe1\u606f List < Object > userIds = CollUtil . getFieldValues ( records , \"userId\" ); List < UserInfo > userInfoList = this . userInfoService . queryUserInfoByUserIdList ( userIds ); List < VideoVo > videoVoList = new ArrayList <> (); for ( Video record : records ) { VideoVo videoVo = new VideoVo (); videoVo . setUserId ( record . getUserId ()); videoVo . setCover ( record . getPicUrl ()); videoVo . setVideoUrl ( record . getVideoUrl ()); videoVo . setId ( record . getId (). toHexString ()); videoVo . setSignature ( \"\u6211\u5c31\u662f\u6211~\" ); //TODO \u7b7e\u540d videoVo . setCommentCount ( Convert . toInt ( this . quanZiApi . queryCommentCount ( videoVo . getId ()))); //\u8bc4\u8bba\u6570 videoVo . setHasFocus ( this . videoApi . isFollowUser ( user . getId (), videoVo . getUserId ()) ? 1 : 0 ); //\u662f\u5426\u5173\u6ce8 videoVo . setHasLiked ( this . quanZiApi . queryUserIsLike ( user . getId (), videoVo . getId ()) ? 1 : 0 ); //\u662f\u5426\u70b9\u8d5e\uff081\u662f\uff0c0\u5426\uff09 videoVo . setLikeCount ( Convert . toInt ( this . quanZiApi . queryLikeCount ( videoVo . getId ()))); //\u70b9\u8d5e\u6570 //\u586b\u5145\u7528\u6237\u4fe1\u606f for ( UserInfo userInfo : userInfoList ) { if ( ObjectUtil . equals ( videoVo . getUserId (), userInfo . getUserId ())) { videoVo . setNickname ( userInfo . getNickName ()); videoVo . setAvatar ( userInfo . getLogo ()); break ; } } videoVoList . add ( videoVo ); } pageResult . setItems ( videoVoList ); return pageResult ; } /** * \u70b9\u8d5e * * @param videoId * @return */ public Long likeComment ( String videoId ) { User user = UserThreadLocal . get (); Boolean result = this . quanZiApi . likeComment ( user . getId (), videoId ); if ( result ) { //\u53d1\u9001\u6d88\u606f this . videoMQService . likeVideoMsg ( videoId ); return this . quanZiApi . queryLikeCount ( videoId ); } return null ; } /** * \u53d6\u6d88\u70b9\u8d5e * * @param videoId * @return */ public Long disLikeComment ( String videoId ) { User user = UserThreadLocal . get (); Boolean result = this . quanZiApi . disLikeComment ( user . getId (), videoId ); if ( result ) { //\u53d1\u9001\u6d88\u606f this . videoMQService . disLikeVideoMsg ( videoId ); return this . quanZiApi . queryLikeCount ( videoId ); } return null ; } public Boolean saveComment ( String videoId , String content ) { Boolean result = this . quanZiService . saveComments ( videoId , content ); if ( result ){ //\u53d1\u9001\u6d88\u606f this . videoMQService . commentVideoMsg ( videoId ); } return result ; } public PageResult queryCommentList ( String videoId , Integer page , Integer pageSize ) { return this . quanZiService . queryCommentList ( videoId , page , pageSize ); } /** * \u5173\u6ce8\u7528\u6237 * * @param userId * @return */ public Boolean followUser ( Long userId ) { User user = UserThreadLocal . get (); return this . videoApi . followUser ( user . getId (), userId ); } /** * \u53d6\u6d88\u5173\u6ce8 * * @param userId * @return */ public Boolean disFollowUser ( Long userId ) { User user = UserThreadLocal . get (); return this . videoApi . disFollowUser ( user . getId (), userId ); } }","title":"4.3.2\u3001VideoService"},{"location":"tantan/day10/#53","text":"","title":"5.3\u3001\u63a5\u6536\u6d88\u606f"},{"location":"tantan/day10/#531recommendvideo","text":"package com.tanhua.recommend.pojo ; import lombok.AllArgsConstructor ; import lombok.Data ; import lombok.NoArgsConstructor ; import org.bson.types.ObjectId ; import org.springframework.data.mongodb.core.mapping.Document ; @Data @NoArgsConstructor @AllArgsConstructor @Document ( collection = \"recommend_video\" ) public class RecommendVideo { private ObjectId id ; private Long userId ; // \u7528\u6237id private Long videoId ; //\u89c6\u9891id\uff0c\u9700\u8981\u8f6c\u5316\u4e3aLong\u7c7b\u578b private Double score ; //\u5f97\u5206 private Long date ; //\u65f6\u95f4\u6233 }","title":"5.3.1\u3001RecommendVideo"},{"location":"tantan/day10/#532videomsgconsumer","text":"package com.tanhua.recommend.msg ; import cn.hutool.json.JSONObject ; import cn.hutool.json.JSONUtil ; import com.tanhua.recommend.pojo.RecommendVideo ; import lombok.extern.slf4j.Slf4j ; import org.apache.rocketmq.spring.annotation.RocketMQMessageListener ; import org.apache.rocketmq.spring.core.RocketMQListener ; import org.bson.types.ObjectId ; import org.springframework.beans.factory.annotation.Autowired ; import org.springframework.data.mongodb.core.MongoTemplate ; import org.springframework.stereotype.Component ; @Component @RocketMQMessageListener ( topic = \"tanhua-video\" , consumerGroup = \"tanhua-video-consumer\" ) @Slf4j public class VideoMsgConsumer implements RocketMQListener < String > { @Autowired private MongoTemplate mongoTemplate ; @Override public void onMessage ( String msg ) { try { JSONObject jsonObject = JSONUtil . parseObj ( msg ); Long userId = jsonObject . getLong ( \"userId\" ); Long vid = jsonObject . getLong ( \"vid\" ); Integer type = jsonObject . getInt ( \"type\" ); //1-\u53d1\u52a8\u6001\uff0c2-\u70b9\u8d5e\uff0c 3-\u53d6\u6d88\u70b9\u8d5e\uff0c4-\u8bc4\u8bba RecommendVideo recommendVideo = new RecommendVideo (); recommendVideo . setUserId ( userId ); recommendVideo . setId ( ObjectId . get ()); recommendVideo . setDate ( System . currentTimeMillis ()); recommendVideo . setVideoId ( vid ); switch ( type ) { case 1 : { recommendVideo . setScore ( 2d ); break ; } case 2 : { recommendVideo . setScore ( 5d ); break ; } case 3 : { recommendVideo . setScore ( - 5d ); break ; } case 4 : { recommendVideo . setScore ( 10 d ); break ; } default : { recommendVideo . setScore ( 0d ); break ; } } this . mongoTemplate . save ( recommendVideo ); } catch ( Exception e ) { log . error ( \"\u5904\u7406\u5c0f\u89c6\u9891\u6d88\u606f\u5931\u8d25~\" + msg , e ); } } }","title":"5.3.2\u3001VideoMsgConsumer"},{"location":"tantan/day10/#533","text":"\u53ef\u4ee5\u770b\u5230\uff0c\u7528\u62371\u5bf9\u4e8e\u89c6\u9891\u6709\u70b9\u8d5e\u3001\u53d6\u6d88\u70b9\u8d5e\u3001\u8bc4\u8bba\u7b49\u64cd\u4f5c\u3002","title":"5.3.3\u3001\u6d4b\u8bd5"},{"location":"tantan/day10/#54","text":"#\u62c9\u53d6\u955c\u50cf docker pull registry.cn-hangzhou.aliyuncs.com/itcast/tanhua-spark-video:1.0 #\u521b\u5efa\u5bb9\u5668 docker create --name tanhua-spark-video \\ --env MONGODB_HOST = 192 .168.31.81 \\ --env MONGODB_PORT = 27017 \\ --env MONGODB_USERNAME = tanhua \\ --env MONGODB_PASSWORD = l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV \\ --env MONGODB_DATABASE = tanhua \\ --env MONGODB_COLLECTION = recommend_video \\ --env SCHEDULE_PERIOD = 10 \\ --env REDIS_NODES = \"192.168.31.81:6379,192.168.31.81:6380,192.168.31.81:6381\" \\ registry.cn-hangzhou.aliyuncs.com/itcast/tanhua-spark-video:1.0 #\u542f\u52a8\u670d\u52a1 docker start tanhua-spark-video #\u67e5\u770b\u65e5\u5fd7 docker logs -f tanhua-spark-video \u6d4b\u8bd5\uff1a","title":"5.4\u3001\u90e8\u7f72\u63a8\u8350\u670d\u52a1"},{"location":"tantan/day10/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87/","text":"\u4e86\u89e3\u63a8\u8350\u7cfb\u7edf\u7684\u539f\u7406 \u72ec\u7acb\u90e8\u7f72\u597d\u53cb\u63a8\u8350\u670d\u52a1 \u4e86\u89e3\u5708\u5b50\u63a8\u8350\u529f\u80fd\u7684\u6d41\u7a0b \u72ec\u7acb\u5b9e\u73b0\u5708\u5b50\u4e2d\u53d1\u9001\u6d88\u606f \u72ec\u7acb\u5b9e\u73b0\u5708\u5b50\u4e2d\u63a5\u6536\u6d88\u606f \u72ec\u7acb\u90e8\u7f72\u5708\u5b50\u63a8\u8350\u670d\u52a1 \u72ec\u7acb\u90e8\u7f72\u5c0f\u89c6\u9891\u63a8\u8350\u670d\u52a1","title":"\u5b66\u4e60\u76ee\u6807"},{"location":"tantan/further/aliyun/","text":"1. \u963f\u91cc\u4e91\u77ed\u4fe1 \u00b6 1. \u6ce8\u518c\u8d26\u53f7 \u00b6 \u767e\u5ea6\u641c\u7d22\u963f\u91cc\u4e91, \u652f\u4ed8\u5b9d\u626b\u7801\u5373\u53ef(\u9700\u8981\u624b\u673a\u786e\u8ba4) 2. \u8fdb\u5165\u963f\u91cc\u4e91\u63a7\u5236\u53f0 \u00b6 3.\u7533\u8bf7\u5f00\u5934\u77ed\u4fe1\u670d\u52a1(\u79d2\u5f00) \u00b6 \u540c\u65f6,\u5145\u503c5\u6bdb\u94b1 \u5907\u7528 (\u4e5f\u53ef\u4ee5\u5145\u503c1\u6bdb,\u770b\u7ecf\u6d4e\u5b9e\u529b,\u51b2\u591a\u4e86\u6ca1\u7528) 4.\u77ed\u4fe1\u9a8c\u7b7e\u540d\u7533\u8bf7 \u00b6 5. \u77ed\u4fe1\u6a21\u677f\u7533\u8bf7 \u00b6 6\u751f\u6210\u79d8\u94a5\u53ca\u4f7f\u7528 \u00b6 7, \u53d1\u9001\u77ed\u4fe1 \u00b6 package com.tanhua.sso ; import com.aliyuncs.CommonRequest ; import com.aliyuncs.CommonResponse ; import com.aliyuncs.DefaultAcsClient ; import com.aliyuncs.IAcsClient ; import com.aliyuncs.exceptions.ClientException ; import com.aliyuncs.exceptions.ServerException ; import com.aliyuncs.http.MethodType ; import com.aliyuncs.profile.DefaultProfile ; /* pom.xml <dependency> <groupId>com.aliyun</groupId> <artifactId>aliyun-java-sdk-core</artifactId> <version>4.5.3</version> </dependency> */ public class SendSms { public static void main ( String [] args ) { DefaultProfile profile = DefaultProfile . getProfile ( \"cn-hangzhou\" , \"accessKeyId\" , \"accessSecret\" ); IAcsClient client = new DefaultAcsClient ( profile ); CommonRequest request = new CommonRequest (); request . setSysMethod ( MethodType . POST ); request . setSysDomain ( \"dysmsapi.aliyuncs.com\" ); request . setSysVersion ( \"2017-05-25\" ); request . setSysAction ( \"SendSms\" ); request . putQueryParameter ( \"RegionId\" , \"cn-hangzhou\" ); request . putQueryParameter ( \"PhoneNumbers\" , \"13288888888\" ); request . putQueryParameter ( \"SignName\" , \"\u63a2\u82b1\u5e73\u53f0\" ); request . putQueryParameter ( \"TemplateCode\" , \"SMS_204055119\" ); request . putQueryParameter ( \"TemplateParam\" , \"{\\\"code\\\":\\\"123456\\\"}\" ); try { CommonResponse response = client . getCommonResponse ( request ); System . out . println ( response . getData ()); } catch ( ServerException e ) { e . printStackTrace (); } catch ( ClientException e ) { e . printStackTrace (); } } } 8. \u9879\u76ee\u4ee3\u7801\u6539\u9020 \u00b6 SmsService.java public String sendSms ( String mobile ) { DefaultProfile profile = DefaultProfile . getProfile ( \"cn-hangzhou\" , \"<accessKeyId>\" , \"<accessSecret>\" ); IAcsClient client = new DefaultAcsClient ( profile ); CommonRequest request = new CommonRequest (); request . setSysMethod ( MethodType . POST ); request . setSysDomain ( \"dysmsapi.aliyuncs.com\" ); request . setSysVersion ( \"2017-05-25\" ); request . setSysAction ( \"SendSms\" ); request . putQueryParameter ( \"RegionId\" , \"cn-hangzhou\" ); request . putQueryParameter ( \"PhoneNumbers\" , mobile ); request . putQueryParameter ( \"SignName\" , \"\u63a2\u82b1\u5e73\u53f0\" ); request . putQueryParameter ( \"TemplateCode\" , \"SMS_204055119\" ); int code = RandomUtils . nextInt ( 100000 , 999999 ); request . putQueryParameter ( \"TemplateParam\" , \"{\\\"code\\\":\\\"123456\\\"}\" ); try { CommonResponse response = client . getCommonResponse ( request ); System . out . println ( response ); if ( response . getData () != null ){ Map < String , String > map = JSONObject . parseObject ( response . getData (), Map . class ); if ( map . get ( \"Code\" ) != null && \"OK\" . equalsIgnoreCase ( map . get ( \"Code\" ))){ return code + \"\" ; // \u5982\u679c\u53d1\u9001\u6210\u529f, \u8fd4\u56de\u9a8c\u8bc1\u7801 } } } catch ( ServerException e ) { e . printStackTrace (); } catch ( ClientException e ) { e . printStackTrace (); } return null ; } 2. \u963f\u91cc\u4e91OOS \u00b6 2.1 \u5f00\u901a\u670d\u52a1 \u00b6 2.2 \u521b\u5efa\u5b58\u50a8\u7a7a\u95f4Bucket \u00b6 2.3 \u754c\u9762\u64cd\u4f5c \u00b6 \u53ef\u4ee5\u5728\u754c\u9762\u4e0a\u64cd\u4f5c\u5220\u9664,\u66f4\u6539\u5220\u9664 2.4 \u5220\u9664 Bucket \u00b6 \u57fa\u7840\u8bbe\u7f6e-- \u6700\u4e0b\u65b9 \u5220\u9664\u5f53\u524dbucket 2.5 java \u64cd\u4f5c \u00b6 https://help.aliyun.com/document_detail/32011.html?spm=a2c4g.11186623.4.1.4f806328oUkWcJ /** * \u4e0a\u4f20 */ @Test public void testupload () throws FileNotFoundException { OSSClient ossClient = new OSSClient ( \"http://oss-cn-beijing.aliyuncs.com\" , \"LTAI4G7n11111xasfsdfvcF2nDR\" , \"zIsIdeLpUnI3xCasfasfd5ovR8Lt\" ); ossClient . putObject ( \"itcast-tanhua-hb\" , \"image/2020/01/01/00.jpg\" , new File ( \"D:\\\\arcsoft\\\\03.jpg\" )); } /** * \u5220\u9664 */ @Test public void testdelete () { OSSClient ossClient = new OSSClient ( \"http://oss-cn-beijing.aliyuncs.com\" , \"LTAI4G712312JEasfsadR\" , \"zIsIdeLpUnI3xasdfasa5ovR8Lt\" ); ossClient . deleteObject ( \"itcast-tanhua\" , \"image/2020/01/01/00.jpg\" ); } \u6ce8\u610f: \u586b\u5199\u7684\u53c2\u6570\u8981\u548c\u81ea\u5df1\u7684 bucket \u5730\u5740\u4e00\u6837","title":"day01_\u963f\u91cc\u4e91"},{"location":"tantan/further/aliyun/#1","text":"","title":"1. \u963f\u91cc\u4e91\u77ed\u4fe1"},{"location":"tantan/further/aliyun/#1_1","text":"\u767e\u5ea6\u641c\u7d22\u963f\u91cc\u4e91, \u652f\u4ed8\u5b9d\u626b\u7801\u5373\u53ef(\u9700\u8981\u624b\u673a\u786e\u8ba4)","title":"1. \u6ce8\u518c\u8d26\u53f7"},{"location":"tantan/further/aliyun/#2","text":"","title":"2. \u8fdb\u5165\u963f\u91cc\u4e91\u63a7\u5236\u53f0"},{"location":"tantan/further/aliyun/#3","text":"\u540c\u65f6,\u5145\u503c5\u6bdb\u94b1 \u5907\u7528 (\u4e5f\u53ef\u4ee5\u5145\u503c1\u6bdb,\u770b\u7ecf\u6d4e\u5b9e\u529b,\u51b2\u591a\u4e86\u6ca1\u7528)","title":"3.\u7533\u8bf7\u5f00\u5934\u77ed\u4fe1\u670d\u52a1(\u79d2\u5f00)"},{"location":"tantan/further/aliyun/#4","text":"","title":"4.\u77ed\u4fe1\u9a8c\u7b7e\u540d\u7533\u8bf7"},{"location":"tantan/further/aliyun/#5","text":"","title":"5. \u77ed\u4fe1\u6a21\u677f\u7533\u8bf7"},{"location":"tantan/further/aliyun/#6","text":"","title":"6\u751f\u6210\u79d8\u94a5\u53ca\u4f7f\u7528"},{"location":"tantan/further/aliyun/#7","text":"package com.tanhua.sso ; import com.aliyuncs.CommonRequest ; import com.aliyuncs.CommonResponse ; import com.aliyuncs.DefaultAcsClient ; import com.aliyuncs.IAcsClient ; import com.aliyuncs.exceptions.ClientException ; import com.aliyuncs.exceptions.ServerException ; import com.aliyuncs.http.MethodType ; import com.aliyuncs.profile.DefaultProfile ; /* pom.xml <dependency> <groupId>com.aliyun</groupId> <artifactId>aliyun-java-sdk-core</artifactId> <version>4.5.3</version> </dependency> */ public class SendSms { public static void main ( String [] args ) { DefaultProfile profile = DefaultProfile . getProfile ( \"cn-hangzhou\" , \"accessKeyId\" , \"accessSecret\" ); IAcsClient client = new DefaultAcsClient ( profile ); CommonRequest request = new CommonRequest (); request . setSysMethod ( MethodType . POST ); request . setSysDomain ( \"dysmsapi.aliyuncs.com\" ); request . setSysVersion ( \"2017-05-25\" ); request . setSysAction ( \"SendSms\" ); request . putQueryParameter ( \"RegionId\" , \"cn-hangzhou\" ); request . putQueryParameter ( \"PhoneNumbers\" , \"13288888888\" ); request . putQueryParameter ( \"SignName\" , \"\u63a2\u82b1\u5e73\u53f0\" ); request . putQueryParameter ( \"TemplateCode\" , \"SMS_204055119\" ); request . putQueryParameter ( \"TemplateParam\" , \"{\\\"code\\\":\\\"123456\\\"}\" ); try { CommonResponse response = client . getCommonResponse ( request ); System . out . println ( response . getData ()); } catch ( ServerException e ) { e . printStackTrace (); } catch ( ClientException e ) { e . printStackTrace (); } } }","title":"7, \u53d1\u9001\u77ed\u4fe1"},{"location":"tantan/further/aliyun/#8","text":"SmsService.java public String sendSms ( String mobile ) { DefaultProfile profile = DefaultProfile . getProfile ( \"cn-hangzhou\" , \"<accessKeyId>\" , \"<accessSecret>\" ); IAcsClient client = new DefaultAcsClient ( profile ); CommonRequest request = new CommonRequest (); request . setSysMethod ( MethodType . POST ); request . setSysDomain ( \"dysmsapi.aliyuncs.com\" ); request . setSysVersion ( \"2017-05-25\" ); request . setSysAction ( \"SendSms\" ); request . putQueryParameter ( \"RegionId\" , \"cn-hangzhou\" ); request . putQueryParameter ( \"PhoneNumbers\" , mobile ); request . putQueryParameter ( \"SignName\" , \"\u63a2\u82b1\u5e73\u53f0\" ); request . putQueryParameter ( \"TemplateCode\" , \"SMS_204055119\" ); int code = RandomUtils . nextInt ( 100000 , 999999 ); request . putQueryParameter ( \"TemplateParam\" , \"{\\\"code\\\":\\\"123456\\\"}\" ); try { CommonResponse response = client . getCommonResponse ( request ); System . out . println ( response ); if ( response . getData () != null ){ Map < String , String > map = JSONObject . parseObject ( response . getData (), Map . class ); if ( map . get ( \"Code\" ) != null && \"OK\" . equalsIgnoreCase ( map . get ( \"Code\" ))){ return code + \"\" ; // \u5982\u679c\u53d1\u9001\u6210\u529f, \u8fd4\u56de\u9a8c\u8bc1\u7801 } } } catch ( ServerException e ) { e . printStackTrace (); } catch ( ClientException e ) { e . printStackTrace (); } return null ; }","title":"8. \u9879\u76ee\u4ee3\u7801\u6539\u9020"},{"location":"tantan/further/aliyun/#2_oos","text":"","title":"2. \u963f\u91cc\u4e91OOS"},{"location":"tantan/further/aliyun/#21","text":"","title":"2.1 \u5f00\u901a\u670d\u52a1"},{"location":"tantan/further/aliyun/#22_bucket","text":"","title":"2.2 \u521b\u5efa\u5b58\u50a8\u7a7a\u95f4Bucket"},{"location":"tantan/further/aliyun/#23","text":"\u53ef\u4ee5\u5728\u754c\u9762\u4e0a\u64cd\u4f5c\u5220\u9664,\u66f4\u6539\u5220\u9664","title":"2.3 \u754c\u9762\u64cd\u4f5c"},{"location":"tantan/further/aliyun/#24_bucket","text":"\u57fa\u7840\u8bbe\u7f6e-- \u6700\u4e0b\u65b9 \u5220\u9664\u5f53\u524dbucket","title":"2.4 \u5220\u9664 Bucket"},{"location":"tantan/further/aliyun/#25_java","text":"https://help.aliyun.com/document_detail/32011.html?spm=a2c4g.11186623.4.1.4f806328oUkWcJ /** * \u4e0a\u4f20 */ @Test public void testupload () throws FileNotFoundException { OSSClient ossClient = new OSSClient ( \"http://oss-cn-beijing.aliyuncs.com\" , \"LTAI4G7n11111xasfsdfvcF2nDR\" , \"zIsIdeLpUnI3xCasfasfd5ovR8Lt\" ); ossClient . putObject ( \"itcast-tanhua-hb\" , \"image/2020/01/01/00.jpg\" , new File ( \"D:\\\\arcsoft\\\\03.jpg\" )); } /** * \u5220\u9664 */ @Test public void testdelete () { OSSClient ossClient = new OSSClient ( \"http://oss-cn-beijing.aliyuncs.com\" , \"LTAI4G712312JEasfsadR\" , \"zIsIdeLpUnI3xasdfasa5ovR8Lt\" ); ossClient . deleteObject ( \"itcast-tanhua\" , \"image/2020/01/01/00.jpg\" ); } \u6ce8\u610f: \u586b\u5199\u7684\u53c2\u6570\u8981\u548c\u81ea\u5df1\u7684 bucket \u5730\u5740\u4e00\u6837","title":"2.5 java \u64cd\u4f5c"},{"location":"tantan/further/ansy/","text":"\u5f02\u6b65 @Async \u00b6 1. @Async \u7684\u4f7f\u7528 \u00b6 Spring \u63d0\u4f9b\u4e86 \u5f02\u6b65\u6267\u884c\u7684\u4ee3\u7801\u7684\u529f\u80fd,\u80fd\u8ba9\u6211\u4eec\u4ee5\u591a\u7ebf\u7a0b\u7684\u65b9\u5f0f\u6267\u884c,\u4f46\u662fspring \u4e2d\u81ea\u5e26\u7684@Async \u6ce8\u89e3\u6267\u884c\u5f02\u6b65\u65f6\u5e76\u6ca1\u6709\u4f7f\u7528\u7ebf\u7a0b\u6c60\u7684\u6982\u5ff5, \u5bfc\u81f4\u5982\u679c\u540c\u65f6\u6267\u884c\u591a\u4e2a\u4efb\u52a1\u53ef\u80fd\u51fa\u73b0\u628a\u7cfb\u7edf\u8d44\u6e90\u8017\u5c3d\u7684\u60c5\u51b5. \u5bf9\u6b64,spingBoot \u4e00\u505a\u597d\u4e86\u4f18\u5316,\u9ed8\u8ba4\u4f7f\u7528\u7ebf\u7a0b\u6c60\u6267\u884c\u4efb\u52a1 \u5728springboot \u9879\u76ee\u4e2d\u9700\u8981\u5f02\u6b65\u6267\u884c\u7684\u4ee3\u7801\u4e0a\u52a0\u4e0a\u6ce8\u89e3 @Async,\u540c\u65f6\u5728\u542f\u52a8\u7c7b\u4e0a\u52a0\u4e0a@EnableAsync\u5373\u53ef\u5982\u4e0b @SpringBootApplication @EnableAsync public class AnsyApplication { public static void main ( String [] args ) { SpringApplication . run ( AnsyApplication . class , args ); } } @Async public void test () throws InterruptedException { Thread . sleep ( 1000 ); System . out . println ( \"\u5b50\u7ebf\u7a0b\u6267\u884c\u4e86\" ); } \u6d4b\u8bd5\u4ee3\u7801 @RunWith ( SpringRunner . class ) @SpringBootTest ( classes = AnsyApplication . class ) public class TestDemo { @Autowired AnsyService service ; @Test public void testDemo () throws Exception { service . test (); System . out . println ( \"\u4e3b\u7ebf\u7a0b\u6267\u884c\u4e86\" ); //\u963b\u585e\u5f53\u524d\u7684\u4e3b\u7ebf\u7a0b\uff0c\u7b49\u5f85\u5f02\u6b65\u6267\u884c\u7684\u7ed3\u675f Thread . sleep ( 2000 ); } 2. CompletableFuture \u00b6 \u6b64\u65f6\u4e3b\u7ebf\u7a0b\u662f\u4e0d\u77e5\u9053\u5b50\u7ebf\u7a0b\u4ec0\u4e48\u65f6\u5019\u6267\u884c\u7ed3\u675f\u7684, \u4e5f\u4e0d\u77e5\u9053\u6267\u884c\u7684\u7ed3\u679c\u662f\u4ec0\u4e48 \u5982\u679c\u60f3\u8981\u66f4\u65b9\u4fbf\u7684\u83b7\u53d6\u7ed3\u679c jdk 1.8 \u63d0\u4f9b\u4e86 CompletableFuture Service \u4ee3\u7801 \u00b6 @Service public class AnsyService { @Async public CompletableFuture < String > test2 () throws InterruptedException { Thread . sleep ( 1000 ); System . out . println ( \"\u5b50\u7ebf\u7a0b\u6267\u884c\u4e862\" + new Date () + Thread . currentThread (). getName ()); return CompletableFuture . completedFuture ( \"ok\" ); } } \u6d4b\u8bd5\u4ee3\u7801 \u00b6 @Test public void testDemo2 () throws InterruptedException { CompletableFuture < String > future = service . test2 (); future . whenComplete (( s , throwable ) -> { System . out . println ( \"\u6267\u884c\u5b8c\u6210\uff1a\" + s ); }); System . out . println ( \"\u4e3b\u7ebf\u7a0b\u6267\u884c\u4e86\" ); try { future . get (); //\u963b\u585e\u5f53\u524d\u7684\u4e3b\u7ebf\u7a0b\uff0c\u7b49\u5f85\u5f02\u6b65\u6267\u884c\u7684\u7ed3\u675f // \u6d4b\u8bd5\u65f6\u4f7f\u7528, tomcat \u4e2d\u8fd0\u884c\u7684diamante\u65e0\u9700\u52a0\u8fd9\u4e2a,\u56e0\u4e3a tomcat\u4e00\u76f4\u5728\u8fd0\u884c } catch ( Exception e ) { e . printStackTrace (); } } 3. \u7ebf\u7a0b\u6c60\u6570\u91cf \u00b6 Sprigboot \u9ed8\u8ba4\u7ebf\u7a0b\u6c60\u6570\u91cf\u662f8\u4e2a, \u6211\u4eec\u53ef\u4ee5\u4fee\u6539\u9ed8\u8ba4\u7684\u914d\u7f6e\u5c06\u5982\u4e0b\u4ee3\u7801\u653e\u5165 \u542f\u52a8\u7c7b\u4e2d\u5373\u53ef @Bean public AsyncTaskExecutor asyncTaskExecutor () { ThreadPoolTaskExecutor asyncTaskExecutor = new ThreadPoolTaskExecutor (); asyncTaskExecutor . setCorePoolSize ( 15 ); // \u8bbe\u7f6e\u7ebf\u7a0b\u6c60\u521d\u59cb\u5927\u5c0f asyncTaskExecutor . setMaxPoolSize ( 50 ); // \u8bbe\u7f6e\u7ebf\u7a0b\u6c60\u6700\u5927\u5927\u5c0f asyncTaskExecutor . initialize (); // \u4e00\u5b9a\u4e0d\u8981\u5fd8\u4e86\u8fd9\u53e5\u4ee3\u7801,\u8fdb\u884c\u521d\u59cb\u5316 return asyncTaskExecutor ; }","title":"day04_\u591a\u7ebf\u7a0b@Ansy"},{"location":"tantan/further/ansy/#async","text":"","title":"\u5f02\u6b65  @Async"},{"location":"tantan/further/ansy/#1_async","text":"Spring \u63d0\u4f9b\u4e86 \u5f02\u6b65\u6267\u884c\u7684\u4ee3\u7801\u7684\u529f\u80fd,\u80fd\u8ba9\u6211\u4eec\u4ee5\u591a\u7ebf\u7a0b\u7684\u65b9\u5f0f\u6267\u884c,\u4f46\u662fspring \u4e2d\u81ea\u5e26\u7684@Async \u6ce8\u89e3\u6267\u884c\u5f02\u6b65\u65f6\u5e76\u6ca1\u6709\u4f7f\u7528\u7ebf\u7a0b\u6c60\u7684\u6982\u5ff5, \u5bfc\u81f4\u5982\u679c\u540c\u65f6\u6267\u884c\u591a\u4e2a\u4efb\u52a1\u53ef\u80fd\u51fa\u73b0\u628a\u7cfb\u7edf\u8d44\u6e90\u8017\u5c3d\u7684\u60c5\u51b5. \u5bf9\u6b64,spingBoot \u4e00\u505a\u597d\u4e86\u4f18\u5316,\u9ed8\u8ba4\u4f7f\u7528\u7ebf\u7a0b\u6c60\u6267\u884c\u4efb\u52a1 \u5728springboot \u9879\u76ee\u4e2d\u9700\u8981\u5f02\u6b65\u6267\u884c\u7684\u4ee3\u7801\u4e0a\u52a0\u4e0a\u6ce8\u89e3 @Async,\u540c\u65f6\u5728\u542f\u52a8\u7c7b\u4e0a\u52a0\u4e0a@EnableAsync\u5373\u53ef\u5982\u4e0b @SpringBootApplication @EnableAsync public class AnsyApplication { public static void main ( String [] args ) { SpringApplication . run ( AnsyApplication . class , args ); } } @Async public void test () throws InterruptedException { Thread . sleep ( 1000 ); System . out . println ( \"\u5b50\u7ebf\u7a0b\u6267\u884c\u4e86\" ); } \u6d4b\u8bd5\u4ee3\u7801 @RunWith ( SpringRunner . class ) @SpringBootTest ( classes = AnsyApplication . class ) public class TestDemo { @Autowired AnsyService service ; @Test public void testDemo () throws Exception { service . test (); System . out . println ( \"\u4e3b\u7ebf\u7a0b\u6267\u884c\u4e86\" ); //\u963b\u585e\u5f53\u524d\u7684\u4e3b\u7ebf\u7a0b\uff0c\u7b49\u5f85\u5f02\u6b65\u6267\u884c\u7684\u7ed3\u675f Thread . sleep ( 2000 ); }","title":"1. @Async \u7684\u4f7f\u7528"},{"location":"tantan/further/ansy/#2_completablefuture","text":"\u6b64\u65f6\u4e3b\u7ebf\u7a0b\u662f\u4e0d\u77e5\u9053\u5b50\u7ebf\u7a0b\u4ec0\u4e48\u65f6\u5019\u6267\u884c\u7ed3\u675f\u7684, \u4e5f\u4e0d\u77e5\u9053\u6267\u884c\u7684\u7ed3\u679c\u662f\u4ec0\u4e48 \u5982\u679c\u60f3\u8981\u66f4\u65b9\u4fbf\u7684\u83b7\u53d6\u7ed3\u679c jdk 1.8 \u63d0\u4f9b\u4e86 CompletableFuture","title":"2. CompletableFuture"},{"location":"tantan/further/ansy/#service","text":"@Service public class AnsyService { @Async public CompletableFuture < String > test2 () throws InterruptedException { Thread . sleep ( 1000 ); System . out . println ( \"\u5b50\u7ebf\u7a0b\u6267\u884c\u4e862\" + new Date () + Thread . currentThread (). getName ()); return CompletableFuture . completedFuture ( \"ok\" ); } }","title":"Service \u4ee3\u7801"},{"location":"tantan/further/ansy/#_1","text":"@Test public void testDemo2 () throws InterruptedException { CompletableFuture < String > future = service . test2 (); future . whenComplete (( s , throwable ) -> { System . out . println ( \"\u6267\u884c\u5b8c\u6210\uff1a\" + s ); }); System . out . println ( \"\u4e3b\u7ebf\u7a0b\u6267\u884c\u4e86\" ); try { future . get (); //\u963b\u585e\u5f53\u524d\u7684\u4e3b\u7ebf\u7a0b\uff0c\u7b49\u5f85\u5f02\u6b65\u6267\u884c\u7684\u7ed3\u675f // \u6d4b\u8bd5\u65f6\u4f7f\u7528, tomcat \u4e2d\u8fd0\u884c\u7684diamante\u65e0\u9700\u52a0\u8fd9\u4e2a,\u56e0\u4e3a tomcat\u4e00\u76f4\u5728\u8fd0\u884c } catch ( Exception e ) { e . printStackTrace (); } }","title":"\u6d4b\u8bd5\u4ee3\u7801"},{"location":"tantan/further/ansy/#3","text":"Sprigboot \u9ed8\u8ba4\u7ebf\u7a0b\u6c60\u6570\u91cf\u662f8\u4e2a, \u6211\u4eec\u53ef\u4ee5\u4fee\u6539\u9ed8\u8ba4\u7684\u914d\u7f6e\u5c06\u5982\u4e0b\u4ee3\u7801\u653e\u5165 \u542f\u52a8\u7c7b\u4e2d\u5373\u53ef @Bean public AsyncTaskExecutor asyncTaskExecutor () { ThreadPoolTaskExecutor asyncTaskExecutor = new ThreadPoolTaskExecutor (); asyncTaskExecutor . setCorePoolSize ( 15 ); // \u8bbe\u7f6e\u7ebf\u7a0b\u6c60\u521d\u59cb\u5927\u5c0f asyncTaskExecutor . setMaxPoolSize ( 50 ); // \u8bbe\u7f6e\u7ebf\u7a0b\u6c60\u6700\u5927\u5927\u5c0f asyncTaskExecutor . initialize (); // \u4e00\u5b9a\u4e0d\u8981\u5fd8\u4e86\u8fd9\u53e5\u4ee3\u7801,\u8fdb\u884c\u521d\u59cb\u5316 return asyncTaskExecutor ; }","title":"3. \u7ebf\u7a0b\u6c60\u6570\u91cf"},{"location":"tantan/further/lombok/","text":"1, spring boot \u65e5\u5fd7\u529f\u80fd \u00b6 spring boot \u6574\u5408webmvc \u540e \u6211\u4eec\u53ef\u4ee5\u8c03\u6574\u65e5\u5fd7\u7684\u8f93\u5165\u7ea7\u522b application.yml # spring boot \u4e2d\u8f93\u5165\u65e5\u5fd7 logging : level : # com.itheima \u7684\u65e5\u5fd7\u7ea7\u522b\u4e3a debug com.itheima : info # org.springframework \u7684\u65e5\u5fd7\u7ea7\u522b\u4e3a info org.springframework : info UserController @ RestController public class UserController { Logger logger = LoggerFactory.getLogger(UserController.class); @RequestMapping(\"/hello\") public String hello(){ logger.debug(\"debug\"); logger.info(\"info\"); logger.warn(\"warn\"); return \"hello\"; } } 2) lombok \u00b6 \u9879\u76ee\u4e2d\u5927\u91cf\u6bcf\u4e2a\u7c7b\u90fd\u9700\u8981\u4f7f\u7528 \u5bf9\u8c61, \u540c\u65f6\u6211\u4eec\u7684 pojo \u7c7b\u4e2d\u9700\u8981 \u5927\u91cf\u7684\u56fa\u5b9a\u7684get,set,toString \u65b9\u6cd5 lombok \u63d2\u4ef6\u80fd\u591f\u7b80\u5316\u6211\u4eec\u7684\u4ee3\u7801 \u4f7f\u7528\u65b9\u5f0f \u200b 1) \u9996\u5148\u5b89\u88c5idea \u63d2\u4ef6 2) \u5728\u9879\u76ee\u4e2d\u5bfc\u5165\u5750\u6807 <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> </dependency> 3) \u4f7f\u7528 \u7136\u540e\u53ef\u4ee5\u5728Bean\u4e0a\u4f7f\u7528 \uff1a @Data \uff1a \u81ea\u52a8\u63d0\u4f9bgetter\u548csetter \u3001 hashCode \u3001 equals \u3001 toString\u7b49\u65b9\u6cd5 @Getter \uff1a \u81ea\u52a8\u63d0\u4f9bgetter\u65b9\u6cd5 @Setter \uff1a \u81ea\u52a8\u63d0\u4f9bsetter\u65b9\u6cd5 @Slf4j \uff1a \u81ea\u52a8\u5728bean\u4e2d\u63d0\u4f9blog\u53d8\u91cf \uff0c \u5176\u5b9e\u7528\u7684\u662fslf4j\u7684\u65e5\u5fd7\u529f\u80fd \u3002 @RestController @Slf4j public class UserController { @RequestMapping ( \"/hello\" ) public String hello (){ log . debug ( \"debug\" ); log . info ( \"info\" ); log . warn ( \"warn\" ); return \"hello\" ; } } @Data public class User { private int id ; private String username ; private String password ; }","title":"day01_lombok"},{"location":"tantan/further/lombok/#1_spring_boot","text":"spring boot \u6574\u5408webmvc \u540e \u6211\u4eec\u53ef\u4ee5\u8c03\u6574\u65e5\u5fd7\u7684\u8f93\u5165\u7ea7\u522b application.yml # spring boot \u4e2d\u8f93\u5165\u65e5\u5fd7 logging : level : # com.itheima \u7684\u65e5\u5fd7\u7ea7\u522b\u4e3a debug com.itheima : info # org.springframework \u7684\u65e5\u5fd7\u7ea7\u522b\u4e3a info org.springframework : info UserController @ RestController public class UserController { Logger logger = LoggerFactory.getLogger(UserController.class); @RequestMapping(\"/hello\") public String hello(){ logger.debug(\"debug\"); logger.info(\"info\"); logger.warn(\"warn\"); return \"hello\"; } }","title":"1, spring boot \u65e5\u5fd7\u529f\u80fd"},{"location":"tantan/further/lombok/#2_lombok","text":"\u9879\u76ee\u4e2d\u5927\u91cf\u6bcf\u4e2a\u7c7b\u90fd\u9700\u8981\u4f7f\u7528 \u5bf9\u8c61, \u540c\u65f6\u6211\u4eec\u7684 pojo \u7c7b\u4e2d\u9700\u8981 \u5927\u91cf\u7684\u56fa\u5b9a\u7684get,set,toString \u65b9\u6cd5 lombok \u63d2\u4ef6\u80fd\u591f\u7b80\u5316\u6211\u4eec\u7684\u4ee3\u7801 \u4f7f\u7528\u65b9\u5f0f \u200b 1) \u9996\u5148\u5b89\u88c5idea \u63d2\u4ef6 2) \u5728\u9879\u76ee\u4e2d\u5bfc\u5165\u5750\u6807 <dependency> <groupId> org.projectlombok </groupId> <artifactId> lombok </artifactId> </dependency> 3) \u4f7f\u7528 \u7136\u540e\u53ef\u4ee5\u5728Bean\u4e0a\u4f7f\u7528 \uff1a @Data \uff1a \u81ea\u52a8\u63d0\u4f9bgetter\u548csetter \u3001 hashCode \u3001 equals \u3001 toString\u7b49\u65b9\u6cd5 @Getter \uff1a \u81ea\u52a8\u63d0\u4f9bgetter\u65b9\u6cd5 @Setter \uff1a \u81ea\u52a8\u63d0\u4f9bsetter\u65b9\u6cd5 @Slf4j \uff1a \u81ea\u52a8\u5728bean\u4e2d\u63d0\u4f9blog\u53d8\u91cf \uff0c \u5176\u5b9e\u7528\u7684\u662fslf4j\u7684\u65e5\u5fd7\u529f\u80fd \u3002 @RestController @Slf4j public class UserController { @RequestMapping ( \"/hello\" ) public String hello (){ log . debug ( \"debug\" ); log . info ( \"info\" ); log . warn ( \"warn\" ); return \"hello\" ; } } @Data public class User { private int id ; private String username ; private String password ; }","title":"2) lombok"},{"location":"tantan/further/mongodb/","text":"MongoDB \u4e8b\u52a1 \u00b6 MongoDB 4.0 \u5f15\u5165\u7684\u4e8b\u52a1\u529f\u80fd\uff0c\u652f\u6301\u591a\u6587\u6863ACID\u7279\u6027\uff0c 1) \u60f3\u8981\u652f\u6301\u4e8b\u52a1,mongoDB \u5fc5\u987b\u4f7f\u7528\u96c6\u7fa4\u73af\u5883 2) \u5728\u5bb9\u5668\u4e2d\u6ce8\u518c\u4e00\u4e2a\u4e8b\u52a1\u7ba1\u7406\u5668 @Configuration public class MongoTransactionConfig { @Bean public MongoTransactionManager transactionManager ( MongoDbFactory dbFactory ) { return new MongoTransactionManager ( dbFactory ); } } 3) \u5728\u9700\u8981\u4e8b\u52a1\u63a7\u5236\u7684\u65b9\u6cd5\u4e0a\u4f7f\u7528 @Transactional \u6ce8\u89e3\u5373\u53ef","title":"day04_MongoDB"},{"location":"tantan/further/mongodb/#mongodb","text":"MongoDB 4.0 \u5f15\u5165\u7684\u4e8b\u52a1\u529f\u80fd\uff0c\u652f\u6301\u591a\u6587\u6863ACID\u7279\u6027\uff0c 1) \u60f3\u8981\u652f\u6301\u4e8b\u52a1,mongoDB \u5fc5\u987b\u4f7f\u7528\u96c6\u7fa4\u73af\u5883 2) \u5728\u5bb9\u5668\u4e2d\u6ce8\u518c\u4e00\u4e2a\u4e8b\u52a1\u7ba1\u7406\u5668 @Configuration public class MongoTransactionConfig { @Bean public MongoTransactionManager transactionManager ( MongoDbFactory dbFactory ) { return new MongoTransactionManager ( dbFactory ); } } 3) \u5728\u9700\u8981\u4e8b\u52a1\u63a7\u5236\u7684\u65b9\u6cd5\u4e0a\u4f7f\u7528 @Transactional \u6ce8\u89e3\u5373\u53ef","title":"MongoDB \u4e8b\u52a1"},{"location":"tantan/further/mybatisPlus/","text":"mybatis_plus \u8865\u5145\u77e5\u8bc6 \u00b6 1. \u679a\u4e3e \u00b6 \u6211\u4eec\u7ecf\u5e38\u51fa\u73b0\u5982\u4e0b\u573a\u666f,\u6570\u636e\u5e93\u5b58\u50a8\u7684\u6027\u522b\u4e3a\u6570\u5b57: 1 , 2 , \u800c\u6211\u4eec\u524d\u7aef\u9875\u9762\u8981\u7684\u6570\u636e\u662f ' \u7537 ' , ' \u5973 ' ,\u4e8e\u662f\u6211\u4eec\u7a0b\u5e8f\u6bcf\u6b21\u9700\u8981\u5904\u7406\u8fd9\u7c7b\u6570\u636e\u8f6c\u6362\u65f6\u6bcf\u6b21\u90fd\u9700\u8981 if else \u5224\u65ad\u8fdb\u884c\u51fa\u5177\u5904\u7406\u540e\u518d\u8fdb\u884c\u8fd4\u56de \u4e3a\u4e86\u66f4\u597d\u7684\u5b58\u50a8\u548c\u83b7\u53d6\u6b64\u7c7b\u6570\u636e mybatis_plus \u63d0\u4f9b\u4e86\u679a\u4e3e\u7279\u6027\u7684\u652f\u6301 1) \u5efa\u8868\u8bed\u53e5 CREATE TABLE ` tb_user1 ` ( ` id ` BIGINT ( 20 ) NOT NULL AUTO_INCREMENT COMMENT '\u4e3b\u952eID' , ` user_name ` VARCHAR ( 20 ) COMMENT '\u7528\u6237\u540d' , ` password ` VARCHAR ( 20 ) COMMENT '\u5bc6\u7801' , ` name ` VARCHAR ( 30 ) DEFAULT NULL COMMENT '\u59d3\u540d' , ` age ` INT ( 11 ) DEFAULT NULL COMMENT '\u5e74\u9f84' , ` sex ` INT ( 1 ) DEFAULT NULL COMMENT '\u6027\u522b' , ` email ` VARCHAR ( 50 ) DEFAULT NULL COMMENT '\u90ae\u7bb1' , created DATETIME , updated DATETIME , PRIMARY KEY ( ` id ` ) ) ENGINE = INNODB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 \u6ce8\u610f,\u679a\u4e3e\u652f\u6301\u7684\u5b57\u6bb5\u4e0d\u80fd\u662ftinyint \u7c7b\u578b, 2) \u5b9a\u4e49\u679a\u4e3e package com.itheima.mp.enums ; import com.baomidou.mybatisplus.core.enums.IEnum ; public enum SexEnum implements IEnum < Integer > { MAN ( 1 , \"\u7537\" ), WOMAN ( 2 , \"\u5973\" ), UNKNOWN ( 3 , \"\u672a\u77e5\" ); private int value ; private String desc ; SexEnum ( int value , String desc ) { this . value = value ; this . desc = desc ; } @Override public Integer getValue () { return this . value ; } @Override public String toString () { return this . desc ; } } 3) \u521b\u5efa\u5b9e\u4f53\u7c7b\u5bf9\u8c61 //@TableName(\"tb_user\") @Data public class User1 { @TableId ( type = IdType . AUTO ) private Long id ; private String userName ; private String password ; private String name ; private Integer age ; private String email ; private SexEnum sex ; //\u6027\u522b,\u8fd9\u4e2a\u5b57\u6bb5\u4f7f\u7528\u679a\u4e3e } 3) mapper /** * \u4f7f\u7528mp\u5b9a\u4e49Mapper\uff0c\u9700\u8981\u8ba9Mapper\u63a5\u53e3\u7ee7\u627f BaseMapper\u63a5\u53e3\u3002 */ @Repository public interface User1Mapper extends BaseMapper < User1 > { } 4) \u5b9a\u4e49service @Service public class User1ServiceImpl extends ServiceImpl < User1Mapper , User1 > { } 5) \u589e\u52a0\u679a\u4e3e\u5305\u626b\u63cf\u914d\u7f6e mybatis-plus : # \u6307\u5b9a\u679a\u4e3e\u6240\u5728\u7684\u5305 type-enums-package : com.itheima.mp.enums global-config : db-config : # \u8868\u540d\u524d\u7f00 table-prefix : tb_ # id\u751f\u6210\u7b56\u7565 \u6570\u636e\u5e93\u81ea\u589e id-type : auto configuration : # \u65e5\u5fd7 log-impl : org.apache.ibatis.logging.stdout.StdOutImpl 6) \u6d4b\u8bd5 @SpringBootTest @RunWith ( SpringRunner . class ) public class User1ServiceTest { @Autowired private User1ServiceImpl userService ; @Test public void testSave (){ User1 user1 = new User1 (); user1 . setName ( \"zhangsn\" ); user1 . setSex ( SexEnum . MAN ); userService . save ( user1 ); // java \u8d4b\u503c\u4e3a\u679a\u4e3e,\u63d2\u5165\u6570\u636e\u5e93\u4e3a \u6570\u5b57\u7c7b\u578b } @Test public void test (){ QueryWrapper < User1 > wrapper = new QueryWrapper <> (); wrapper . eq ( \"id\" , \"13\" ); User1 user = userService . getOne ( wrapper ); System . out . println ( user ); // \u67e5\u8be2\u540e,tostring \u65b9\u6cd5\u5f97\u5230\u7684\u662f '\u7537',\u672a\u6765\u8f6cjson \u4e5f\u662f'\u7537' } } 2. \u5b57\u6bb5\u81ea\u52a8\u8d4b\u503c \u00b6 \u200b \u6211\u4eec\u6bcf\u4e2a\u8868\u90fd\u9700\u8981\u4e00\u4e2a createdDate ,\u548cupdateDate\u5b57\u6bb5,\u6765\u8bb0\u5f55\u6570\u636e\u521b\u5efa\u65f6\u95f4\u548c\u6570\u636e\u66f4\u65b0\u65f6\u95f4, \u4f46\u662f\u6bcf\u6b21\u6211\u4eec\u5982\u679c\u90fd\u8fd9\u4e48\u8d4b\u503c,\u4ee3\u7801\u91cd\u590d\u6027\u5f88\u591a,\u800c\u4e14\u4e00\u65e6\u5fd8\u8bb0,\u8bb2\u5bfc\u81f4\u6570\u636e\u4e0d\u51c6\u786e\u95ee\u9898\u4ea7\u751f \u200b mybatis_plus \u63d0\u4f9b\u4e86\u8fd9\u7c7b\u7684\u529f\u80fd\u652f\u6301,\u65b9\u4fbf\u6211\u4eec\u7f16\u7a0b 1) \u5b9e\u4f53\u7c7b\u4e0a\u589e\u52a0\u5b57\u6bb5 created ,\u548cupdated @Data public class User1 { @TableId ( type = IdType . AUTO ) private Long id ; private String userName ; private String password ; private String name ; private Integer age ; private String email ; private SexEnum sex ; //\u6027\u522b //\u6ce8\u89e3,fill = FieldFill.INSERT \u8868\u793a\u6267\u884c\u63d2\u5165\u65f6 \u7ed9\u8be5\u5b57\u6bb5\u8d4b\u503c,\u4f46\u662f\u66f4\u65b0\u65f6\u4e0d\u4f1a\u91cd\u65b0\u8d4b\u503c @TableField ( fill = FieldFill . INSERT ) private Date created ; //\u6ce8\u89e3,fill = FieldFill.INSERT_UPDATE \u8868\u793a\u6267\u884c\u63d2\u5165,\u66f4\u65b0\u65f6\u90fd\u4f1a(\u91cd\u65b0)\u8d4b\u503c @TableField ( fill = FieldFill . INSERT_UPDATE ) private Date updated ; } 2) \u7f16\u5199Handler package com.itheima.mp.config ; import com.baomidou.mybatisplus.core.handlers.MetaObjectHandler ; import org.apache.ibatis.reflection.MetaObject ; import org.springframework.stereotype.Component ; import java.util.Date ; @Component public class MyMetaObjectHandler implements MetaObjectHandler { @Override public void insertFill ( MetaObject metaObject ) { Object created = getFieldValByName ( \"created\" , metaObject ); if ( null == created ) { //\u5b57\u6bb5\u4e3a\u7a7a\uff0c\u53ef\u4ee5\u8fdb\u884c\u586b\u5145 setFieldValByName ( \"created\" , new Date (), metaObject ); } Object updated = getFieldValByName ( \"updated\" , metaObject ); if ( null == updated ) { //\u5b57\u6bb5\u4e3a\u7a7a\uff0c\u53ef\u4ee5\u8fdb\u884c\u586b\u5145 setFieldValByName ( \"updated\" , new Date (), metaObject ); } } @Override public void updateFill ( MetaObject metaObject ) { //\u66f4\u65b0\u6570\u636e\u65f6\uff0c\u76f4\u63a5\u66f4\u65b0\u5b57\u6bb5 setFieldValByName ( \"updated\" , new Date (), metaObject ); } } 3) \u6d4b\u8bd5,\u67e5\u770b\u6570\u636e\u5e93\u4f1a\u81ea\u52a8\u8d4b\u503c @Test public void testSave (){ User1 user1 = new User1 (); user1 . setName ( \"zhangsn\" ); user1 . setSex ( SexEnum . MAN ); userService . save ( user1 ); }","title":"day01_mybatis_plus"},{"location":"tantan/further/mybatisPlus/#mybatis_plus","text":"","title":"mybatis_plus \u8865\u5145\u77e5\u8bc6"},{"location":"tantan/further/mybatisPlus/#1","text":"\u6211\u4eec\u7ecf\u5e38\u51fa\u73b0\u5982\u4e0b\u573a\u666f,\u6570\u636e\u5e93\u5b58\u50a8\u7684\u6027\u522b\u4e3a\u6570\u5b57: 1 , 2 , \u800c\u6211\u4eec\u524d\u7aef\u9875\u9762\u8981\u7684\u6570\u636e\u662f ' \u7537 ' , ' \u5973 ' ,\u4e8e\u662f\u6211\u4eec\u7a0b\u5e8f\u6bcf\u6b21\u9700\u8981\u5904\u7406\u8fd9\u7c7b\u6570\u636e\u8f6c\u6362\u65f6\u6bcf\u6b21\u90fd\u9700\u8981 if else \u5224\u65ad\u8fdb\u884c\u51fa\u5177\u5904\u7406\u540e\u518d\u8fdb\u884c\u8fd4\u56de \u4e3a\u4e86\u66f4\u597d\u7684\u5b58\u50a8\u548c\u83b7\u53d6\u6b64\u7c7b\u6570\u636e mybatis_plus \u63d0\u4f9b\u4e86\u679a\u4e3e\u7279\u6027\u7684\u652f\u6301 1) \u5efa\u8868\u8bed\u53e5 CREATE TABLE ` tb_user1 ` ( ` id ` BIGINT ( 20 ) NOT NULL AUTO_INCREMENT COMMENT '\u4e3b\u952eID' , ` user_name ` VARCHAR ( 20 ) COMMENT '\u7528\u6237\u540d' , ` password ` VARCHAR ( 20 ) COMMENT '\u5bc6\u7801' , ` name ` VARCHAR ( 30 ) DEFAULT NULL COMMENT '\u59d3\u540d' , ` age ` INT ( 11 ) DEFAULT NULL COMMENT '\u5e74\u9f84' , ` sex ` INT ( 1 ) DEFAULT NULL COMMENT '\u6027\u522b' , ` email ` VARCHAR ( 50 ) DEFAULT NULL COMMENT '\u90ae\u7bb1' , created DATETIME , updated DATETIME , PRIMARY KEY ( ` id ` ) ) ENGINE = INNODB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8 \u6ce8\u610f,\u679a\u4e3e\u652f\u6301\u7684\u5b57\u6bb5\u4e0d\u80fd\u662ftinyint \u7c7b\u578b, 2) \u5b9a\u4e49\u679a\u4e3e package com.itheima.mp.enums ; import com.baomidou.mybatisplus.core.enums.IEnum ; public enum SexEnum implements IEnum < Integer > { MAN ( 1 , \"\u7537\" ), WOMAN ( 2 , \"\u5973\" ), UNKNOWN ( 3 , \"\u672a\u77e5\" ); private int value ; private String desc ; SexEnum ( int value , String desc ) { this . value = value ; this . desc = desc ; } @Override public Integer getValue () { return this . value ; } @Override public String toString () { return this . desc ; } } 3) \u521b\u5efa\u5b9e\u4f53\u7c7b\u5bf9\u8c61 //@TableName(\"tb_user\") @Data public class User1 { @TableId ( type = IdType . AUTO ) private Long id ; private String userName ; private String password ; private String name ; private Integer age ; private String email ; private SexEnum sex ; //\u6027\u522b,\u8fd9\u4e2a\u5b57\u6bb5\u4f7f\u7528\u679a\u4e3e } 3) mapper /** * \u4f7f\u7528mp\u5b9a\u4e49Mapper\uff0c\u9700\u8981\u8ba9Mapper\u63a5\u53e3\u7ee7\u627f BaseMapper\u63a5\u53e3\u3002 */ @Repository public interface User1Mapper extends BaseMapper < User1 > { } 4) \u5b9a\u4e49service @Service public class User1ServiceImpl extends ServiceImpl < User1Mapper , User1 > { } 5) \u589e\u52a0\u679a\u4e3e\u5305\u626b\u63cf\u914d\u7f6e mybatis-plus : # \u6307\u5b9a\u679a\u4e3e\u6240\u5728\u7684\u5305 type-enums-package : com.itheima.mp.enums global-config : db-config : # \u8868\u540d\u524d\u7f00 table-prefix : tb_ # id\u751f\u6210\u7b56\u7565 \u6570\u636e\u5e93\u81ea\u589e id-type : auto configuration : # \u65e5\u5fd7 log-impl : org.apache.ibatis.logging.stdout.StdOutImpl 6) \u6d4b\u8bd5 @SpringBootTest @RunWith ( SpringRunner . class ) public class User1ServiceTest { @Autowired private User1ServiceImpl userService ; @Test public void testSave (){ User1 user1 = new User1 (); user1 . setName ( \"zhangsn\" ); user1 . setSex ( SexEnum . MAN ); userService . save ( user1 ); // java \u8d4b\u503c\u4e3a\u679a\u4e3e,\u63d2\u5165\u6570\u636e\u5e93\u4e3a \u6570\u5b57\u7c7b\u578b } @Test public void test (){ QueryWrapper < User1 > wrapper = new QueryWrapper <> (); wrapper . eq ( \"id\" , \"13\" ); User1 user = userService . getOne ( wrapper ); System . out . println ( user ); // \u67e5\u8be2\u540e,tostring \u65b9\u6cd5\u5f97\u5230\u7684\u662f '\u7537',\u672a\u6765\u8f6cjson \u4e5f\u662f'\u7537' } }","title":"1. \u679a\u4e3e"},{"location":"tantan/further/mybatisPlus/#2","text":"\u200b \u6211\u4eec\u6bcf\u4e2a\u8868\u90fd\u9700\u8981\u4e00\u4e2a createdDate ,\u548cupdateDate\u5b57\u6bb5,\u6765\u8bb0\u5f55\u6570\u636e\u521b\u5efa\u65f6\u95f4\u548c\u6570\u636e\u66f4\u65b0\u65f6\u95f4, \u4f46\u662f\u6bcf\u6b21\u6211\u4eec\u5982\u679c\u90fd\u8fd9\u4e48\u8d4b\u503c,\u4ee3\u7801\u91cd\u590d\u6027\u5f88\u591a,\u800c\u4e14\u4e00\u65e6\u5fd8\u8bb0,\u8bb2\u5bfc\u81f4\u6570\u636e\u4e0d\u51c6\u786e\u95ee\u9898\u4ea7\u751f \u200b mybatis_plus \u63d0\u4f9b\u4e86\u8fd9\u7c7b\u7684\u529f\u80fd\u652f\u6301,\u65b9\u4fbf\u6211\u4eec\u7f16\u7a0b 1) \u5b9e\u4f53\u7c7b\u4e0a\u589e\u52a0\u5b57\u6bb5 created ,\u548cupdated @Data public class User1 { @TableId ( type = IdType . AUTO ) private Long id ; private String userName ; private String password ; private String name ; private Integer age ; private String email ; private SexEnum sex ; //\u6027\u522b //\u6ce8\u89e3,fill = FieldFill.INSERT \u8868\u793a\u6267\u884c\u63d2\u5165\u65f6 \u7ed9\u8be5\u5b57\u6bb5\u8d4b\u503c,\u4f46\u662f\u66f4\u65b0\u65f6\u4e0d\u4f1a\u91cd\u65b0\u8d4b\u503c @TableField ( fill = FieldFill . INSERT ) private Date created ; //\u6ce8\u89e3,fill = FieldFill.INSERT_UPDATE \u8868\u793a\u6267\u884c\u63d2\u5165,\u66f4\u65b0\u65f6\u90fd\u4f1a(\u91cd\u65b0)\u8d4b\u503c @TableField ( fill = FieldFill . INSERT_UPDATE ) private Date updated ; } 2) \u7f16\u5199Handler package com.itheima.mp.config ; import com.baomidou.mybatisplus.core.handlers.MetaObjectHandler ; import org.apache.ibatis.reflection.MetaObject ; import org.springframework.stereotype.Component ; import java.util.Date ; @Component public class MyMetaObjectHandler implements MetaObjectHandler { @Override public void insertFill ( MetaObject metaObject ) { Object created = getFieldValByName ( \"created\" , metaObject ); if ( null == created ) { //\u5b57\u6bb5\u4e3a\u7a7a\uff0c\u53ef\u4ee5\u8fdb\u884c\u586b\u5145 setFieldValByName ( \"created\" , new Date (), metaObject ); } Object updated = getFieldValByName ( \"updated\" , metaObject ); if ( null == updated ) { //\u5b57\u6bb5\u4e3a\u7a7a\uff0c\u53ef\u4ee5\u8fdb\u884c\u586b\u5145 setFieldValByName ( \"updated\" , new Date (), metaObject ); } } @Override public void updateFill ( MetaObject metaObject ) { //\u66f4\u65b0\u6570\u636e\u65f6\uff0c\u76f4\u63a5\u66f4\u65b0\u5b57\u6bb5 setFieldValByName ( \"updated\" , new Date (), metaObject ); } } 3) \u6d4b\u8bd5,\u67e5\u770b\u6570\u636e\u5e93\u4f1a\u81ea\u52a8\u8d4b\u503c @Test public void testSave (){ User1 user1 = new User1 (); user1 . setName ( \"zhangsn\" ); user1 . setSex ( SexEnum . MAN ); userService . save ( user1 ); }","title":"2.  \u5b57\u6bb5\u81ea\u52a8\u8d4b\u503c"},{"location":"tantan/further/nginx/","text":"Nginx\u53cd\u5411\u4ee3\u7406\u4e0e\u8d1f\u8f7d\u5747\u8861 \u00b6 1 \u53cd\u5411\u4ee3\u7406 \u00b6 1.1 \u4ec0\u4e48\u662f\u53cd\u5411\u4ee3\u7406 \u00b6 \u53cd\u5411\u4ee3\u7406\uff08Reverse Proxy\uff09\u65b9\u5f0f\u662f\u6307\u4ee5 \u4ee3\u7406\u670d\u52a1\u5668 \u6765\u63a5\u53d7internet\u4e0a\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u7136\u540e\u5c06\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u5185\u90e8\u7f51\u7edc\u4e0a\u7684\u670d\u52a1\u5668\uff0c\u5e76\u5c06\u4ece\u670d\u52a1\u5668\u4e0a\u5f97\u5230\u7684\u7ed3\u679c\u8fd4\u56de\u7ed9internet\u4e0a\u8bf7\u6c42\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\uff0c\u6b64\u65f6\u4ee3\u7406\u670d\u52a1\u5668\u5bf9\u5916\u5c31\u8868\u73b0\u4e3a\u4e00\u4e2a\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\u3002 \u9996\u5148\u6211\u4eec\u5148\u7406\u89e3\u6b63\u5411\u4ee3\u7406(\u4f8b\u5982VPN )\uff0c\u5982\u4e0b\u56fe\uff1a \u200b \u6b63\u5411\u4ee3\u7406\u662f\u9488\u5bf9\u4f60\u7684\u5ba2\u6237\u7aef\uff0c\u800c\u53cd\u5411\u4ee3\u7406\u662f\u9488\u5bf9\u670d\u52a1\u5668\u7684\uff0c\u5982\u4e0b\u56fe 1.2 \u914d\u7f6e\u53cd\u5411\u4ee3\u7406-\u51c6\u5907\u5de5\u4f5c \u00b6 \uff081\uff09 \u542f\u52a8spring-boot \u9879\u76ee \u7aef\u53e3\u53f78080 \uff082\uff09 \u8bbf\u95ee localhost:8080 /hello \u53ef\u4ee5\u770b\u5230\u6d88\u606f 4.1.3 \u914d\u7f6e\u53cd\u5411\u4ee3\u7406 \u00b6 \uff081\uff09\u5728Nginx\u4e3b\u673a\u4fee\u6539 Nginx\u914d\u7f6e\u6587\u4ef6 http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80; server_name localhost; error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } location / { proxy_pass http : //127.0.0.1:8080; } } } \uff082\uff09\u91cd\u65b0\u542f\u52a8Nginx \u7136\u540e\u7528\u6d4f\u89c8\u5668\u6d4b\u8bd5\uff1alocalhost 2 \u8d1f\u8f7d\u5747\u8861 \u00b6 2.1 \u4ec0\u4e48\u662f\u8d1f\u8f7d\u5747\u8861 \u00b6 \u8d1f\u8f7d\u5747\u8861 \u5efa\u7acb\u5728\u73b0\u6709\u7f51\u7edc\u7ed3\u6784\u4e4b\u4e0a\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u79cd\u5ec9\u4ef7\u6709\u6548\u900f\u660e\u7684\u65b9\u6cd5\u6269\u5c55 \u7f51\u7edc\u8bbe\u5907 \u548c \u670d\u52a1\u5668 \u7684\u5e26\u5bbd\u3001\u589e\u52a0 \u541e\u5410\u91cf \u3001\u52a0\u5f3a\u7f51\u7edc\u6570\u636e\u5904\u7406\u80fd\u529b\u3001\u63d0\u9ad8\u7f51\u7edc\u7684\u7075\u6d3b\u6027\u548c\u53ef\u7528\u6027\u3002 \u8d1f\u8f7d\u5747\u8861\uff0c\u82f1\u6587\u540d\u79f0\u4e3aLoad Balance\uff0c\u5176\u610f\u601d\u5c31\u662f\u5206\u644a\u5230\u591a\u4e2a\u64cd\u4f5c\u5355\u5143\u4e0a\u8fdb\u884c\u6267\u884c\uff0c\u4f8b\u5982Web \u670d\u52a1\u5668 \u3001 FTP\u670d\u52a1\u5668 \u3001 \u4f01\u4e1a \u5173\u952e\u5e94\u7528\u670d\u52a1\u5668\u548c\u5176\u5b83\u5173\u952e\u4efb\u52a1\u670d\u52a1\u5668\u7b49\uff0c\u4ece\u800c\u5171\u540c\u5b8c\u6210\u5de5\u4f5c\u4efb\u52a1\u3002 2.2 \u914d\u7f6e\u8d1f\u8f7d\u5747\u8861-\u51c6\u5907\u5de5\u4f5c \u00b6 \uff081\uff09\u5c06\u521a\u624d\u7684\u5de5\u7a0b\u7684 \u4fee\u6539\u7aef\u53e3\u53f7 8081 .8082 \u5206\u522b \u542f\u52a8(\u540c\u65f6\u542f\u52a83\u4e2a\u5e94\u7528) \uff081\uff09\u4e3a\u4e86\u80fd\u591f\u533a\u5206\u662f\u8bbf\u95ee\u54ea\u4e2a\u670d\u52a1\u5668\u7684\u7f51\u7ad9\uff0c\u53ef\u4ee5\u5728\u8fd4\u56de\u6570\u636e\u4e0a\u52a0\u4e0a\u7aef\u53e3\u53f7\u533a\u5206 4.2.3 \u914d\u7f6e\u8d1f\u8f7d\u5747\u8861 \u00b6 \u4fee\u6539 Nginx\u914d\u7f6e\u6587\u4ef6\uff1a ```properties http { include mime.types; default_type application/octet-stream; sendfile on ; keepalive_timeout 65 ; upstream tanhua { server localhost : 8080 ; server localhost : 8081 ; server localhost : 8082 ; } server { listen 80 ; server_name localhost ; error_page 500 502 503 504 /50x.html ; location = /50x.html { root html ; } location / { proxy_pass http : // tanhua ; } } } ``` \u5730\u5740\u680f\u8f93\u5165localhost \u5237\u65b0\u89c2\u5bdf\u6bcf\u4e2a\u7f51\u9875\u7684\u6807\u9898\uff0c\u770b\u662f\u5426\u4e0d\u540c\u3002 \u7ecf\u8fc7\u6d4b\u8bd5\uff0c\u4e09\u53f0\u670d\u52a1\u5668\u51fa\u73b0\u7684\u6982\u7387\u5404\u4e3a33.3333333%\uff0c\u4ea4\u66ff\u663e\u793a\u3002 \u5982\u679c\u5176\u4e2d\u4e00\u53f0\u670d\u52a1\u5668\u6027\u80fd\u6bd4\u8f83\u597d\uff0c\u60f3\u8ba9\u5176\u627f\u62c5\u66f4\u591a\u7684\u538b\u529b\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u6743\u91cd\u3002 \u6bd4\u5982\u60f3\u8ba9NO.1\u51fa\u73b0\u6b21\u6570\u662f\u5176\u5b83\u670d\u52a1\u5668\u76842\u500d\uff0c\u5219\u4fee\u6539\u914d\u7f6e\u5982\u4e0b\uff1a ````properties http { include mime.types; default_type application/octet-stream; sendfile on ; keepalive_timeout 65 ; upstream tanhua { server localhost : 8080 ; server localhost : 8081 weight = 2 ; server localhost : 8082 ; } server { listen 80 ; server_name localhost ; error_page 500 502 503 504 /50x.html ; location = /50x.html { root html ; } location / { proxy_pass http : // tanhua ; } } } ````","title":"day03_nginx"},{"location":"tantan/further/nginx/#nginx","text":"","title":"Nginx\u53cd\u5411\u4ee3\u7406\u4e0e\u8d1f\u8f7d\u5747\u8861"},{"location":"tantan/further/nginx/#1","text":"","title":"1 \u53cd\u5411\u4ee3\u7406"},{"location":"tantan/further/nginx/#11","text":"\u53cd\u5411\u4ee3\u7406\uff08Reverse Proxy\uff09\u65b9\u5f0f\u662f\u6307\u4ee5 \u4ee3\u7406\u670d\u52a1\u5668 \u6765\u63a5\u53d7internet\u4e0a\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u7136\u540e\u5c06\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u5185\u90e8\u7f51\u7edc\u4e0a\u7684\u670d\u52a1\u5668\uff0c\u5e76\u5c06\u4ece\u670d\u52a1\u5668\u4e0a\u5f97\u5230\u7684\u7ed3\u679c\u8fd4\u56de\u7ed9internet\u4e0a\u8bf7\u6c42\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\uff0c\u6b64\u65f6\u4ee3\u7406\u670d\u52a1\u5668\u5bf9\u5916\u5c31\u8868\u73b0\u4e3a\u4e00\u4e2a\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\u3002 \u9996\u5148\u6211\u4eec\u5148\u7406\u89e3\u6b63\u5411\u4ee3\u7406(\u4f8b\u5982VPN )\uff0c\u5982\u4e0b\u56fe\uff1a \u200b \u6b63\u5411\u4ee3\u7406\u662f\u9488\u5bf9\u4f60\u7684\u5ba2\u6237\u7aef\uff0c\u800c\u53cd\u5411\u4ee3\u7406\u662f\u9488\u5bf9\u670d\u52a1\u5668\u7684\uff0c\u5982\u4e0b\u56fe","title":"1.1 \u4ec0\u4e48\u662f\u53cd\u5411\u4ee3\u7406"},{"location":"tantan/further/nginx/#12_-","text":"\uff081\uff09 \u542f\u52a8spring-boot \u9879\u76ee \u7aef\u53e3\u53f78080 \uff082\uff09 \u8bbf\u95ee localhost:8080 /hello \u53ef\u4ee5\u770b\u5230\u6d88\u606f","title":"1.2 \u914d\u7f6e\u53cd\u5411\u4ee3\u7406-\u51c6\u5907\u5de5\u4f5c"},{"location":"tantan/further/nginx/#413","text":"\uff081\uff09\u5728Nginx\u4e3b\u673a\u4fee\u6539 Nginx\u914d\u7f6e\u6587\u4ef6 http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80; server_name localhost; error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } location / { proxy_pass http : //127.0.0.1:8080; } } } \uff082\uff09\u91cd\u65b0\u542f\u52a8Nginx \u7136\u540e\u7528\u6d4f\u89c8\u5668\u6d4b\u8bd5\uff1alocalhost","title":"4.1.3 \u914d\u7f6e\u53cd\u5411\u4ee3\u7406"},{"location":"tantan/further/nginx/#2","text":"","title":"2 \u8d1f\u8f7d\u5747\u8861"},{"location":"tantan/further/nginx/#21","text":"\u8d1f\u8f7d\u5747\u8861 \u5efa\u7acb\u5728\u73b0\u6709\u7f51\u7edc\u7ed3\u6784\u4e4b\u4e0a\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u79cd\u5ec9\u4ef7\u6709\u6548\u900f\u660e\u7684\u65b9\u6cd5\u6269\u5c55 \u7f51\u7edc\u8bbe\u5907 \u548c \u670d\u52a1\u5668 \u7684\u5e26\u5bbd\u3001\u589e\u52a0 \u541e\u5410\u91cf \u3001\u52a0\u5f3a\u7f51\u7edc\u6570\u636e\u5904\u7406\u80fd\u529b\u3001\u63d0\u9ad8\u7f51\u7edc\u7684\u7075\u6d3b\u6027\u548c\u53ef\u7528\u6027\u3002 \u8d1f\u8f7d\u5747\u8861\uff0c\u82f1\u6587\u540d\u79f0\u4e3aLoad Balance\uff0c\u5176\u610f\u601d\u5c31\u662f\u5206\u644a\u5230\u591a\u4e2a\u64cd\u4f5c\u5355\u5143\u4e0a\u8fdb\u884c\u6267\u884c\uff0c\u4f8b\u5982Web \u670d\u52a1\u5668 \u3001 FTP\u670d\u52a1\u5668 \u3001 \u4f01\u4e1a \u5173\u952e\u5e94\u7528\u670d\u52a1\u5668\u548c\u5176\u5b83\u5173\u952e\u4efb\u52a1\u670d\u52a1\u5668\u7b49\uff0c\u4ece\u800c\u5171\u540c\u5b8c\u6210\u5de5\u4f5c\u4efb\u52a1\u3002","title":"2.1 \u4ec0\u4e48\u662f\u8d1f\u8f7d\u5747\u8861"},{"location":"tantan/further/nginx/#22_-","text":"\uff081\uff09\u5c06\u521a\u624d\u7684\u5de5\u7a0b\u7684 \u4fee\u6539\u7aef\u53e3\u53f7 8081 .8082 \u5206\u522b \u542f\u52a8(\u540c\u65f6\u542f\u52a83\u4e2a\u5e94\u7528) \uff081\uff09\u4e3a\u4e86\u80fd\u591f\u533a\u5206\u662f\u8bbf\u95ee\u54ea\u4e2a\u670d\u52a1\u5668\u7684\u7f51\u7ad9\uff0c\u53ef\u4ee5\u5728\u8fd4\u56de\u6570\u636e\u4e0a\u52a0\u4e0a\u7aef\u53e3\u53f7\u533a\u5206","title":"2.2 \u914d\u7f6e\u8d1f\u8f7d\u5747\u8861-\u51c6\u5907\u5de5\u4f5c"},{"location":"tantan/further/nginx/#423","text":"\u4fee\u6539 Nginx\u914d\u7f6e\u6587\u4ef6\uff1a ```properties http { include mime.types; default_type application/octet-stream; sendfile on ; keepalive_timeout 65 ; upstream tanhua { server localhost : 8080 ; server localhost : 8081 ; server localhost : 8082 ; } server { listen 80 ; server_name localhost ; error_page 500 502 503 504 /50x.html ; location = /50x.html { root html ; } location / { proxy_pass http : // tanhua ; } } } ``` \u5730\u5740\u680f\u8f93\u5165localhost \u5237\u65b0\u89c2\u5bdf\u6bcf\u4e2a\u7f51\u9875\u7684\u6807\u9898\uff0c\u770b\u662f\u5426\u4e0d\u540c\u3002 \u7ecf\u8fc7\u6d4b\u8bd5\uff0c\u4e09\u53f0\u670d\u52a1\u5668\u51fa\u73b0\u7684\u6982\u7387\u5404\u4e3a33.3333333%\uff0c\u4ea4\u66ff\u663e\u793a\u3002 \u5982\u679c\u5176\u4e2d\u4e00\u53f0\u670d\u52a1\u5668\u6027\u80fd\u6bd4\u8f83\u597d\uff0c\u60f3\u8ba9\u5176\u627f\u62c5\u66f4\u591a\u7684\u538b\u529b\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u6743\u91cd\u3002 \u6bd4\u5982\u60f3\u8ba9NO.1\u51fa\u73b0\u6b21\u6570\u662f\u5176\u5b83\u670d\u52a1\u5668\u76842\u500d\uff0c\u5219\u4fee\u6539\u914d\u7f6e\u5982\u4e0b\uff1a ````properties http { include mime.types; default_type application/octet-stream; sendfile on ; keepalive_timeout 65 ; upstream tanhua { server localhost : 8080 ; server localhost : 8081 weight = 2 ; server localhost : 8082 ; } server { listen 80 ; server_name localhost ; error_page 500 502 503 504 /50x.html ; location = /50x.html { root html ; } location / { proxy_pass http : // tanhua ; } } } ````","title":"4.2.3 \u914d\u7f6e\u8d1f\u8f7d\u5747\u8861"},{"location":"tantan/further/sso/","text":"SSO \u5355\u70b9\u767b\u5f55\u53cajwt \u00b6 1. \u8de8\u57df\u8ba4\u8bc1\u7684\u95ee\u9898(\u767b\u5f55) \u00b6 \u4e92\u8054\u7f51\u670d\u52a1\u79bb\u4e0d\u5f00\u7528\u6237\u8ba4\u8bc1(\u767b\u5f55)\u3002\u4e00\u822c\u6d41\u7a0b\u662f\u4e0b\u9762\u8fd9\u6837\u3002 1 \u3001 \u7528\u6237\u5411\u670d\u52a1\u5668\u53d1\u9001\u7528\u6237\u540d\u548c\u5bc6\u7801 \u3002 2 \u3001 \u670d\u52a1\u5668\u9a8c\u8bc1\u901a\u8fc7\u540e \uff0c \u5728\u5f53\u524d\u5bf9\u8bdd \uff08 session \uff09 \u91cc\u9762\u4fdd\u5b58\u76f8\u5173\u6570\u636e \uff0c \u6bd4\u5982\u7528\u6237\u89d2\u8272 \u3001 \u767b\u5f55\u65f6\u95f4\u7b49\u7b49 \u3002 3 \u3001 \u670d\u52a1\u5668\u5411\u7528\u6237\u8fd4\u56de\u4e00\u4e2a session_id \uff0c \u5199\u5165\u7528\u6237\u7684 Cookie \u3002 4 \u3001 \u7528\u6237\u968f\u540e\u7684\u6bcf\u4e00\u6b21\u8bf7\u6c42 \uff0c \u90fd\u4f1a\u901a\u8fc7 Cookie \uff0c \u5c06 session_id \u4f20\u56de\u670d\u52a1\u5668 \u3002 5 \u3001 \u670d\u52a1\u5668\u6536\u5230 session_id \uff0c \u627e\u5230\u524d\u671f\u4fdd\u5b58\u7684\u6570\u636e \uff0c \u7531\u6b64\u5f97\u77e5\u7528\u6237\u7684\u8eab\u4efd \u3002 \u8fd9\u79cd\u6a21\u5f0f\u7684\u95ee\u9898\u5728\u4e8e\uff0c\u6269\u5c55\u6027\uff08scaling\uff09\u4e0d\u597d\u3002\u5355\u673a\u5f53\u7136\u6ca1\u6709\u95ee\u9898\uff0c\u5982\u679c\u662f\u670d\u52a1\u5668\u96c6\u7fa4\uff0c\u6216\u8005\u662f\u8de8\u57df\u7684\u670d\u52a1\u5bfc\u5411\u67b6\u6784\uff0c\u5c31\u8981\u6c42 session \u6570\u636e\u5171\u4eab\uff0c\u6bcf\u53f0\u670d\u52a1\u5668\u90fd\u80fd\u591f\u8bfb\u53d6 session\u3002 \u4e3e\u4f8b\u6765\u8bf4\uff0cA \u7f51\u7ad9\u548c B \u7f51\u7ad9\u662f\u540c\u4e00\u5bb6\u516c\u53f8\u7684\u5173\u8054\u670d\u52a1\u3002\u73b0\u5728\u8981\u6c42\uff0c\u7528\u6237\u53ea\u8981\u5728\u5176\u4e2d\u4e00\u4e2a\u7f51\u7ad9\u767b\u5f55\uff0c\u518d\u8bbf\u95ee\u53e6\u4e00\u4e2a\u7f51\u7ad9\u5c31\u4f1a\u81ea\u52a8\u767b\u5f55\uff0c\u8bf7\u95ee\u600e\u4e48\u5b9e\u73b0\uff1f \u4e00\u79cd\u89e3\u51b3\u65b9\u6848\u662f session \u6570\u636e\u6301\u4e45\u5316\uff0c\u5199\u5165\u6570\u636e\u5e93\u6216\u522b\u7684\u6301\u4e45\u5c42\u3002\u5404\u79cd\u670d\u52a1\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u90fd\u5411\u6301\u4e45\u5c42\u8bf7\u6c42\u6570\u636e\u3002\u8fd9\u79cd\u65b9\u6848\u7684\u4f18\u70b9\u662f\u67b6\u6784\u6e05\u6670\uff0c\u7f3a\u70b9\u662f\u5de5\u7a0b\u91cf\u6bd4\u8f83\u5927\u3002\u53e6\u5916\uff0c\u6301\u4e45\u5c42\u4e07\u4e00\u6302\u4e86\uff0c\u5c31\u4f1a\u5355\u70b9\u5931\u8d25\u3002 \u53e6\u4e00\u79cd\u65b9\u6848\u662f\u670d\u52a1\u5668\u7d22\u6027\u4e0d\u4fdd\u5b58 session \u6570\u636e\u4e86\uff0c\u6240\u6709\u6570\u636e\u90fd\u4fdd\u5b58\u5728\u5ba2\u6237\u7aef\uff0c\u6bcf\u6b21\u8bf7\u6c42\u90fd\u53d1\u56de\u670d\u52a1\u5668\u3002JWT \u5c31\u662f\u8fd9\u79cd\u65b9\u6848\u7684\u4e00\u4e2a\u4ee3\u8868\u3002 \u53e6\u4e00\u79cd\u65b9\u6848\u662f\u670d\u52a1\u5668\u7d22\u6027\u4e0d\u4fdd\u5b58 session \u6570\u636e\u4e86\uff0c\u6240\u6709\u6570\u636e\u90fd\u4fdd\u5b58\u5728\u5ba2\u6237\u7aef\uff0c\u6bcf\u6b21\u8bf7\u6c42\u90fd\u53d1\u56de\u670d\u52a1\u5668\u3002JWT \u5c31\u662f\u8fd9\u79cd\u65b9\u6848\u7684\u4e00\u4e2a\u4ee3\u8868\u3002 2 . JWT \u7684\u539f\u7406 \u00b6 JWT \u7684\u539f\u7406\u662f\uff0c\u670d\u52a1\u5668\u8ba4\u8bc1\u4ee5\u540e\uff0c\u751f\u6210\u4e00\u4e2a JSON \u5bf9\u8c61\uff0c\u53d1\u56de\u7ed9\u7528\u6237\uff0c\u5c31\u50cf\u4e0b\u9762\u8fd9\u6837\u3002 { \"\u59d3\u540d\" : \"\u5f20\u4e09\" , \"\u89d2\u8272\" : \"\u7ba1\u7406\u5458\" , \"\u5230\u671f\u65f6\u95f4\" : \"2018\u5e747\u67081\u65e50\u70b90\u5206\" } \u4ee5\u540e\uff0c\u7528\u6237\u4e0e\u670d\u52a1\u7aef\u901a\u4fe1\u7684\u65f6\u5019\uff0c\u90fd\u8981\u53d1\u56de\u8fd9\u4e2a JSON \u5bf9\u8c61\u3002\u670d\u52a1\u5668\u5b8c\u5168\u53ea\u9760\u8fd9\u4e2a\u5bf9\u8c61\u8ba4\u5b9a\u7528\u6237\u8eab\u4efd\u3002\u4e3a\u4e86\u9632\u6b62\u7528\u6237\u7be1\u6539\u6570\u636e\uff0c\u670d\u52a1\u5668\u5728\u751f\u6210\u8fd9\u4e2a\u5bf9\u8c61\u7684\u65f6\u5019\uff0c\u4f1a\u52a0\u4e0a\u7b7e\u540d\uff08\u8be6\u89c1\u540e\u6587\uff09\u3002 \u670d\u52a1\u5668\u5c31\u4e0d\u4fdd\u5b58\u4efb\u4f55 session \u6570\u636e\u4e86\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u670d\u52a1\u5668\u53d8\u6210\u65e0\u72b6\u6001\u4e86\uff0c\u4ece\u800c\u6bd4\u8f83\u5bb9\u6613\u5b9e\u73b0\u6269\u5c55\u3002 3. JWT \u7684\u6570\u636e\u7ed3\u6784 \u00b6 \u5b9e\u9645\u7684 JWT \u5927\u6982\u5c31\u50cf\u4e0b\u9762\u8fd9\u6837\u3002 \u5b83\u662f\u4e00\u4e2a\u5f88\u957f\u7684\u5b57\u7b26\u4e32\uff0c\u4e2d\u95f4\u7528\u70b9\uff08 . \uff09\u5206\u9694\u6210\u4e09\u4e2a\u90e8\u5206\u3002\u6ce8\u610f\uff0c JWT \u7684\u4e09\u4e2a\u90e8\u5206\u4f9d\u6b21\u5982\u4e0b\u3002 Header \uff08\u5934\u90e8\uff09 Payload \uff08\u8d1f\u8f7d\uff09 Signature \uff08\u7b7e\u540d\uff09 \u5199\u6210\u4e00\u884c\uff0c\u5c31\u662f\u4e0b\u9762\u7684\u6837\u5b50\u3002 javascript Header.Payload.Signature \u4e0b\u9762\u4f9d\u6b21\u4ecb\u7ecd\u8fd9\u4e09\u4e2a\u90e8\u5206\u3002 3.1 Header \u00b6 Header \u90e8\u5206\u662f\u4e00\u4e2a JSON \u5bf9\u8c61\uff0c\u63cf\u8ff0 JWT \u7684\u5143\u6570\u636e\uff0c\u901a\u5e38\u662f\u4e0b\u9762\u7684\u6837\u5b50\u3002 javascript { \"alg\": \"HS256\", \"typ\": \"JWT\" } \u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c alg \u5c5e\u6027\u8868\u793a\u7b7e\u540d\u7684\u7b97\u6cd5\uff08algorithm\uff09\uff0c\u9ed8\u8ba4\u662f HMAC SHA256\uff08\u5199\u6210 HS256\uff09\uff1b typ \u5c5e\u6027\u8868\u793a\u8fd9\u4e2a\u4ee4\u724c\uff08token\uff09\u7684\u7c7b\u578b\uff08type\uff09\uff0cJWT \u4ee4\u724c\u7edf\u4e00\u5199\u4e3a JWT \u3002 \u6700\u540e\uff0c\u5c06\u4e0a\u9762\u7684 JSON \u5bf9\u8c61\u4f7f\u7528 Base64URL \u7b97\u6cd5\uff08\u8be6\u89c1\u540e\u6587\uff09\u8f6c\u6210\u5b57\u7b26\u4e32\u3002 3.2 Payload \u00b6 Payload \u90e8\u5206\u4e5f\u662f\u4e00\u4e2a JSON \u5bf9\u8c61\uff0c\u7528\u6765\u5b58\u653e\u5b9e\u9645\u9700\u8981\u4f20\u9012\u7684\u6570\u636e\u3002JWT \u89c4\u5b9a\u4e867\u4e2a\u5b98\u65b9\u5b57\u6bb5\uff0c\u4f9b\u9009\u7528\u3002 iss (issuer)\uff1a\u7b7e\u53d1\u4eba exp (expiration time)\uff1a\u8fc7\u671f\u65f6\u95f4 sub (subject)\uff1a\u4e3b\u9898 aud (audience)\uff1a\u53d7\u4f17 nbf (Not Before)\uff1a\u751f\u6548\u65f6\u95f4 iat (Issued At)\uff1a\u7b7e\u53d1\u65f6\u95f4 jti (JWT ID)\uff1a\u7f16\u53f7 \u9664\u4e86\u5b98\u65b9\u5b57\u6bb5\uff0c\u4f60\u8fd8\u53ef\u4ee5\u5728\u8fd9\u4e2a\u90e8\u5206\u5b9a\u4e49\u79c1\u6709\u5b57\u6bb5\uff0c\u4e0b\u9762\u5c31\u662f\u4e00\u4e2a\u4f8b\u5b50\u3002 javascript { \"sub\": \"1234567890\", \"name\": \"John Doe\", \"admin\": true } \u6ce8\u610f\uff0cJWT \u9ed8\u8ba4\u662f\u4e0d\u52a0\u5bc6\u7684\uff0c\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u8bfb\u5230\uff0c\u6240\u4ee5\u4e0d\u8981\u628a\u79d8\u5bc6\u4fe1\u606f\u653e\u5728\u8fd9\u4e2a\u90e8\u5206\u3002 \u8fd9\u4e2a JSON \u5bf9\u8c61\u4e5f\u8981\u4f7f\u7528 Base64URL \u7b97\u6cd5\u8f6c\u6210\u5b57\u7b26\u4e32\u3002 3.3 Signature \u00b6 Signature \u90e8\u5206\u662f\u5bf9\u524d\u4e24\u90e8\u5206\u7684\u7b7e\u540d\uff0c\u9632\u6b62\u6570\u636e\u7be1\u6539\u3002 \u5e95\u5c42\u539f\u7406\u5982\u4e0b \u9996\u5148\uff0c\u9700\u8981\u6307\u5b9a\u4e00\u4e2a\u5bc6\u94a5\uff08secret\uff09\u3002\u8fd9\u4e2a\u5bc6\u94a5\u53ea\u6709\u670d\u52a1\u5668\u624d\u77e5\u9053\uff0c\u4e0d\u80fd\u6cc4\u9732\u7ed9\u7528\u6237\u3002\u7136\u540e\uff0c\u4f7f\u7528 Header \u91cc\u9762\u6307\u5b9a\u7684\u7b7e\u540d\u7b97\u6cd5\uff08\u9ed8\u8ba4\u662f HMAC SHA256\uff09\uff0c\u6309\u7167\u4e0b\u9762\u7684\u516c\u5f0f\u4ea7\u751f\u7b7e\u540d\u3002 javascript HMACSHA256( base64UrlEncode(header) + \".\" + base64UrlEncode(payload), secret) \u7b97\u51fa\u7b7e\u540d\u4ee5\u540e\uff0c\u628a Header\u3001Payload\u3001Signature \u4e09\u4e2a\u90e8\u5206\u62fc\u6210\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u6bcf\u4e2a\u90e8\u5206\u4e4b\u95f4\u7528\"\u70b9\"\uff08 . \uff09\u5206\u9694\uff0c\u5c31\u53ef\u4ee5\u8fd4\u56de\u7ed9\u7528\u6237\u3002 3.4 Base64URL \u00b6 \u524d\u9762\u63d0\u5230\uff0cHeader \u548c Payload \u4e32\u578b\u5316\u7684\u7b97\u6cd5\u662f Base64URL\u3002\u8fd9\u4e2a\u7b97\u6cd5\u8ddf Base64 \u7b97\u6cd5\u57fa\u672c\u7c7b\u4f3c\uff0c\u4f46\u6709\u4e00\u4e9b\u5c0f\u7684\u4e0d\u540c\u3002 JWT \u4f5c\u4e3a\u4e00\u4e2a\u4ee4\u724c\uff08token\uff09\uff0c\u6709\u4e9b\u573a\u5408\u53ef\u80fd\u4f1a\u653e\u5230 URL\uff08\u6bd4\u5982 api.example.com/?token=xxx\uff09\u3002Base64 \u6709\u4e09\u4e2a\u5b57\u7b26 + \u3001 / \u548c = \uff0c\u5728 URL \u91cc\u9762\u6709\u7279\u6b8a\u542b\u4e49\uff0c\u6240\u4ee5\u8981\u88ab\u66ff\u6362\u6389\uff1a = \u88ab\u7701\u7565\u3001 + \u66ff\u6362\u6210 - \uff0c / \u66ff\u6362\u6210 _ \u3002\u8fd9\u5c31\u662f Base64URL \u7b97\u6cd5\u3002 4. JWT \u7684\u4f7f\u7528\u65b9\u5f0f \u00b6 \u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u5668\u8fd4\u56de\u7684 JWT\uff0c\u53ef\u4ee5\u50a8\u5b58\u5728 Cookie \u91cc\u9762\uff0c\u4e5f\u53ef\u4ee5\u50a8\u5b58\u5728 localStorage\u3002 \u6b64\u540e\uff0c\u5ba2\u6237\u7aef\u6bcf\u6b21\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\uff0c\u90fd\u8981\u5e26\u4e0a\u8fd9\u4e2a JWT\u3002\u4f60\u53ef\u4ee5\u628a\u5b83\u653e\u5728 Cookie \u91cc\u9762\u81ea\u52a8\u53d1\u9001\uff0c\u4f46\u662f\u8fd9\u6837\u4e0d\u80fd\u8de8\u57df\uff0c\u6240\u4ee5\u66f4\u597d\u7684\u505a\u6cd5\u662f\u653e\u5728 HTTP \u8bf7\u6c42\u7684\u5934\u4fe1\u606f Authorization \u5b57\u6bb5\u91cc\u9762\u3002 javascript Authorization: Bearer <token> \u53e6\u4e00\u79cd\u505a\u6cd5\u662f\uff0c\u8de8\u57df\u7684\u65f6\u5019\uff0cJWT \u5c31\u653e\u5728 POST \u8bf7\u6c42\u7684\u6570\u636e\u4f53\u91cc\u9762\u3002 5. JWT \u7684\u51e0\u4e2a\u7279\u70b9 \u00b6 \uff081\uff09JWT \u9ed8\u8ba4\u662f\u4e0d\u52a0\u5bc6\uff0c\u4f46\u4e5f\u662f\u53ef\u4ee5\u52a0\u5bc6\u7684\u3002\u751f\u6210\u539f\u59cb Token \u4ee5\u540e\uff0c\u53ef\u4ee5\u7528\u5bc6\u94a5\u518d\u52a0\u5bc6\u4e00\u6b21\u3002 \uff082\uff09JWT \u4e0d\u52a0\u5bc6\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0d\u80fd\u5c06\u79d8\u5bc6\u6570\u636e\u5199\u5165 JWT\u3002 \uff083\uff09JWT \u4e0d\u4ec5\u53ef\u4ee5\u7528\u4e8e\u8ba4\u8bc1\uff0c\u4e5f\u53ef\u4ee5\u7528\u4e8e\u4ea4\u6362\u4fe1\u606f\u3002\u6709\u6548\u4f7f\u7528 JWT\uff0c\u53ef\u4ee5\u964d\u4f4e\u670d\u52a1\u5668\u67e5\u8be2\u6570\u636e\u5e93\u7684\u6b21\u6570\u3002 \uff084\uff09JWT \u7684\u6700\u5927\u7f3a\u70b9\u662f\uff0c\u7531\u4e8e\u670d\u52a1\u5668\u4e0d\u4fdd\u5b58 session \u72b6\u6001\uff0c\u56e0\u6b64\u65e0\u6cd5\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u5e9f\u6b62\u67d0\u4e2a token\uff0c\u6216\u8005\u66f4\u6539 token \u7684\u6743\u9650\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u65e6 JWT \u7b7e\u53d1\u4e86\uff0c\u5728\u5230\u671f\u4e4b\u524d\u5c31\u4f1a\u59cb\u7ec8\u6709\u6548\uff0c\u9664\u975e\u670d\u52a1\u5668\u90e8\u7f72\u989d\u5916\u7684\u903b\u8f91\u3002 \uff085\uff09JWT \u672c\u8eab\u5305\u542b\u4e86\u8ba4\u8bc1\u4fe1\u606f\uff0c\u4e00\u65e6\u6cc4\u9732\uff0c\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u83b7\u5f97\u8be5\u4ee4\u724c\u7684\u6240\u6709\u6743\u9650\u3002\u4e3a\u4e86\u51cf\u5c11\u76d7\u7528\uff0cJWT \u7684\u6709\u6548\u671f\u5e94\u8be5\u8bbe\u7f6e\u5f97\u6bd4\u8f83\u77ed\u3002\u5bf9\u4e8e\u4e00\u4e9b\u6bd4\u8f83\u91cd\u8981\u7684\u6743\u9650\uff0c\u4f7f\u7528\u65f6\u5e94\u8be5\u518d\u6b21\u5bf9\u7528\u6237\u8fdb\u884c\u8ba4\u8bc1\u3002 \uff086\uff09\u4e3a\u4e86\u51cf\u5c11\u76d7\u7528\uff0cJWT \u4e0d\u5e94\u8be5\u4f7f\u7528 HTTP \u534f\u8bae\u660e\u7801\u4f20\u8f93\uff0c\u8981\u4f7f\u7528 HTTPS \u534f\u8bae\u4f20\u8f93\u3002 6. jwt \u7684\u4f7f\u7528 \u00b6 \u751f\u6210jwt public static void main ( String [] args ) { // \u79d8\u94a5 String secret = \"itcast\" ; // \u5b9a\u4e49 \u8377\u8f7d,\u53cajwt \u7684\u7b2c\u4e8c\u90e8\u5206\u6570\u636e Map < String , Object > claims = new HashMap < String , Object > (); claims . put ( \"mobile\" , \"12345789\" ); claims . put ( \"id\" , \"2\" ); // \u751f\u6210token String jwt = Jwts . builder () . setClaims ( claims ) //\u8bbe\u7f6e\u54cd\u5e94\u6570\u636e\u4f53 . setExpiration ( new Date ( System . currentTimeMillis () + 30 * 1000 )) // \u8d85\u65f6\u65f6\u95f4 ,30\u79d2\u540e\u5931\u6548 . signWith ( SignatureAlgorithm . HS256 , secret ) //\u8bbe\u7f6e\u52a0\u5bc6\u65b9\u6cd5\u548c\u52a0\u5bc6\u76d0 . compact (); System . out . println ( jwt ); //eyJhbGciOiJIUzI1NiJ9.eyJtb2JpbGUiOiIxMjM0NTc4OSIsImlkIjoiMiIsImV4cCI6MTYwNTg4MTkxN30.gTHkE0Eq8--r5qaFuTaWkiw20PyM0gpe8MBU5k_JDpg } jwt \u6821\u9a8c \u5982\u679c\u6821\u9a8c\u5931\u8d25\u5219 \u62a5\u9519 // jwt \u6821\u9a8c public static void main ( String [] args ) { // \u79d8\u94a5 String secret = \"itcast\" ; String jwt = \"eyJhbGciOiJIUzI1NiJ9.eyJtb2JpbGUiOiIxMjM0NTc4OSIsImlkIjoiMiIsImV4cCI6MTYwNTg4MTkxN30.gTHkE0Eq8--r5qaFuTaWkiw20PyM0gpe8MBU5k_JDpg\" ; // \u901a\u8fc7token\u89e3\u6790\u6570\u636e Map < String , Object > body = Jwts . parser () . setSigningKey ( secret ) . parseClaimsJws ( jwt ) . getBody (); System . out . println ( body ); //{mobile=12345789, id=2} } \u8bf4\u660e: jwt \u5e76\u4e0d\u662f\u5b89\u5168\u7684,\u4e0d\u8981\u5b58\u50a8\u654f\u611f\u4fe1\u606f \u4f8b\u5982\u6211\u4eec\u83b7\u5f97jwt \u7684\u4e2d\u95f4\u90e8\u5206 \u4f7f\u7528base64 \u5373\u53ef\u89e3\u5bc6 // \u89e3\u5bc6 byte [] bs = Base64 . getDecoder (). decode ( \"eyJtb2JpbGUiOiIxMjM0NTc4OSIsImlkIjoiMiIsImV4cCI6MTYwNTg4MTkxN30\" ); System . out . println ( new String ( bs ));","title":"day01_\u5355\u70b9\u767b\u5f55\u53cajwt"},{"location":"tantan/further/sso/#sso_jwt","text":"","title":"SSO \u5355\u70b9\u767b\u5f55\u53cajwt"},{"location":"tantan/further/sso/#1","text":"\u4e92\u8054\u7f51\u670d\u52a1\u79bb\u4e0d\u5f00\u7528\u6237\u8ba4\u8bc1(\u767b\u5f55)\u3002\u4e00\u822c\u6d41\u7a0b\u662f\u4e0b\u9762\u8fd9\u6837\u3002 1 \u3001 \u7528\u6237\u5411\u670d\u52a1\u5668\u53d1\u9001\u7528\u6237\u540d\u548c\u5bc6\u7801 \u3002 2 \u3001 \u670d\u52a1\u5668\u9a8c\u8bc1\u901a\u8fc7\u540e \uff0c \u5728\u5f53\u524d\u5bf9\u8bdd \uff08 session \uff09 \u91cc\u9762\u4fdd\u5b58\u76f8\u5173\u6570\u636e \uff0c \u6bd4\u5982\u7528\u6237\u89d2\u8272 \u3001 \u767b\u5f55\u65f6\u95f4\u7b49\u7b49 \u3002 3 \u3001 \u670d\u52a1\u5668\u5411\u7528\u6237\u8fd4\u56de\u4e00\u4e2a session_id \uff0c \u5199\u5165\u7528\u6237\u7684 Cookie \u3002 4 \u3001 \u7528\u6237\u968f\u540e\u7684\u6bcf\u4e00\u6b21\u8bf7\u6c42 \uff0c \u90fd\u4f1a\u901a\u8fc7 Cookie \uff0c \u5c06 session_id \u4f20\u56de\u670d\u52a1\u5668 \u3002 5 \u3001 \u670d\u52a1\u5668\u6536\u5230 session_id \uff0c \u627e\u5230\u524d\u671f\u4fdd\u5b58\u7684\u6570\u636e \uff0c \u7531\u6b64\u5f97\u77e5\u7528\u6237\u7684\u8eab\u4efd \u3002 \u8fd9\u79cd\u6a21\u5f0f\u7684\u95ee\u9898\u5728\u4e8e\uff0c\u6269\u5c55\u6027\uff08scaling\uff09\u4e0d\u597d\u3002\u5355\u673a\u5f53\u7136\u6ca1\u6709\u95ee\u9898\uff0c\u5982\u679c\u662f\u670d\u52a1\u5668\u96c6\u7fa4\uff0c\u6216\u8005\u662f\u8de8\u57df\u7684\u670d\u52a1\u5bfc\u5411\u67b6\u6784\uff0c\u5c31\u8981\u6c42 session \u6570\u636e\u5171\u4eab\uff0c\u6bcf\u53f0\u670d\u52a1\u5668\u90fd\u80fd\u591f\u8bfb\u53d6 session\u3002 \u4e3e\u4f8b\u6765\u8bf4\uff0cA \u7f51\u7ad9\u548c B \u7f51\u7ad9\u662f\u540c\u4e00\u5bb6\u516c\u53f8\u7684\u5173\u8054\u670d\u52a1\u3002\u73b0\u5728\u8981\u6c42\uff0c\u7528\u6237\u53ea\u8981\u5728\u5176\u4e2d\u4e00\u4e2a\u7f51\u7ad9\u767b\u5f55\uff0c\u518d\u8bbf\u95ee\u53e6\u4e00\u4e2a\u7f51\u7ad9\u5c31\u4f1a\u81ea\u52a8\u767b\u5f55\uff0c\u8bf7\u95ee\u600e\u4e48\u5b9e\u73b0\uff1f \u4e00\u79cd\u89e3\u51b3\u65b9\u6848\u662f session \u6570\u636e\u6301\u4e45\u5316\uff0c\u5199\u5165\u6570\u636e\u5e93\u6216\u522b\u7684\u6301\u4e45\u5c42\u3002\u5404\u79cd\u670d\u52a1\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u90fd\u5411\u6301\u4e45\u5c42\u8bf7\u6c42\u6570\u636e\u3002\u8fd9\u79cd\u65b9\u6848\u7684\u4f18\u70b9\u662f\u67b6\u6784\u6e05\u6670\uff0c\u7f3a\u70b9\u662f\u5de5\u7a0b\u91cf\u6bd4\u8f83\u5927\u3002\u53e6\u5916\uff0c\u6301\u4e45\u5c42\u4e07\u4e00\u6302\u4e86\uff0c\u5c31\u4f1a\u5355\u70b9\u5931\u8d25\u3002 \u53e6\u4e00\u79cd\u65b9\u6848\u662f\u670d\u52a1\u5668\u7d22\u6027\u4e0d\u4fdd\u5b58 session \u6570\u636e\u4e86\uff0c\u6240\u6709\u6570\u636e\u90fd\u4fdd\u5b58\u5728\u5ba2\u6237\u7aef\uff0c\u6bcf\u6b21\u8bf7\u6c42\u90fd\u53d1\u56de\u670d\u52a1\u5668\u3002JWT \u5c31\u662f\u8fd9\u79cd\u65b9\u6848\u7684\u4e00\u4e2a\u4ee3\u8868\u3002 \u53e6\u4e00\u79cd\u65b9\u6848\u662f\u670d\u52a1\u5668\u7d22\u6027\u4e0d\u4fdd\u5b58 session \u6570\u636e\u4e86\uff0c\u6240\u6709\u6570\u636e\u90fd\u4fdd\u5b58\u5728\u5ba2\u6237\u7aef\uff0c\u6bcf\u6b21\u8bf7\u6c42\u90fd\u53d1\u56de\u670d\u52a1\u5668\u3002JWT \u5c31\u662f\u8fd9\u79cd\u65b9\u6848\u7684\u4e00\u4e2a\u4ee3\u8868\u3002","title":"1. \u8de8\u57df\u8ba4\u8bc1\u7684\u95ee\u9898(\u767b\u5f55)"},{"location":"tantan/further/sso/#2_jwt","text":"JWT \u7684\u539f\u7406\u662f\uff0c\u670d\u52a1\u5668\u8ba4\u8bc1\u4ee5\u540e\uff0c\u751f\u6210\u4e00\u4e2a JSON \u5bf9\u8c61\uff0c\u53d1\u56de\u7ed9\u7528\u6237\uff0c\u5c31\u50cf\u4e0b\u9762\u8fd9\u6837\u3002 { \"\u59d3\u540d\" : \"\u5f20\u4e09\" , \"\u89d2\u8272\" : \"\u7ba1\u7406\u5458\" , \"\u5230\u671f\u65f6\u95f4\" : \"2018\u5e747\u67081\u65e50\u70b90\u5206\" } \u4ee5\u540e\uff0c\u7528\u6237\u4e0e\u670d\u52a1\u7aef\u901a\u4fe1\u7684\u65f6\u5019\uff0c\u90fd\u8981\u53d1\u56de\u8fd9\u4e2a JSON \u5bf9\u8c61\u3002\u670d\u52a1\u5668\u5b8c\u5168\u53ea\u9760\u8fd9\u4e2a\u5bf9\u8c61\u8ba4\u5b9a\u7528\u6237\u8eab\u4efd\u3002\u4e3a\u4e86\u9632\u6b62\u7528\u6237\u7be1\u6539\u6570\u636e\uff0c\u670d\u52a1\u5668\u5728\u751f\u6210\u8fd9\u4e2a\u5bf9\u8c61\u7684\u65f6\u5019\uff0c\u4f1a\u52a0\u4e0a\u7b7e\u540d\uff08\u8be6\u89c1\u540e\u6587\uff09\u3002 \u670d\u52a1\u5668\u5c31\u4e0d\u4fdd\u5b58\u4efb\u4f55 session \u6570\u636e\u4e86\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u670d\u52a1\u5668\u53d8\u6210\u65e0\u72b6\u6001\u4e86\uff0c\u4ece\u800c\u6bd4\u8f83\u5bb9\u6613\u5b9e\u73b0\u6269\u5c55\u3002","title":"2 . JWT \u7684\u539f\u7406"},{"location":"tantan/further/sso/#3_jwt","text":"\u5b9e\u9645\u7684 JWT \u5927\u6982\u5c31\u50cf\u4e0b\u9762\u8fd9\u6837\u3002 \u5b83\u662f\u4e00\u4e2a\u5f88\u957f\u7684\u5b57\u7b26\u4e32\uff0c\u4e2d\u95f4\u7528\u70b9\uff08 . \uff09\u5206\u9694\u6210\u4e09\u4e2a\u90e8\u5206\u3002\u6ce8\u610f\uff0c JWT \u7684\u4e09\u4e2a\u90e8\u5206\u4f9d\u6b21\u5982\u4e0b\u3002 Header \uff08\u5934\u90e8\uff09 Payload \uff08\u8d1f\u8f7d\uff09 Signature \uff08\u7b7e\u540d\uff09 \u5199\u6210\u4e00\u884c\uff0c\u5c31\u662f\u4e0b\u9762\u7684\u6837\u5b50\u3002 javascript Header.Payload.Signature \u4e0b\u9762\u4f9d\u6b21\u4ecb\u7ecd\u8fd9\u4e09\u4e2a\u90e8\u5206\u3002","title":"3. JWT \u7684\u6570\u636e\u7ed3\u6784"},{"location":"tantan/further/sso/#31_header","text":"Header \u90e8\u5206\u662f\u4e00\u4e2a JSON \u5bf9\u8c61\uff0c\u63cf\u8ff0 JWT \u7684\u5143\u6570\u636e\uff0c\u901a\u5e38\u662f\u4e0b\u9762\u7684\u6837\u5b50\u3002 javascript { \"alg\": \"HS256\", \"typ\": \"JWT\" } \u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c alg \u5c5e\u6027\u8868\u793a\u7b7e\u540d\u7684\u7b97\u6cd5\uff08algorithm\uff09\uff0c\u9ed8\u8ba4\u662f HMAC SHA256\uff08\u5199\u6210 HS256\uff09\uff1b typ \u5c5e\u6027\u8868\u793a\u8fd9\u4e2a\u4ee4\u724c\uff08token\uff09\u7684\u7c7b\u578b\uff08type\uff09\uff0cJWT \u4ee4\u724c\u7edf\u4e00\u5199\u4e3a JWT \u3002 \u6700\u540e\uff0c\u5c06\u4e0a\u9762\u7684 JSON \u5bf9\u8c61\u4f7f\u7528 Base64URL \u7b97\u6cd5\uff08\u8be6\u89c1\u540e\u6587\uff09\u8f6c\u6210\u5b57\u7b26\u4e32\u3002","title":"3.1 Header"},{"location":"tantan/further/sso/#32_payload","text":"Payload \u90e8\u5206\u4e5f\u662f\u4e00\u4e2a JSON \u5bf9\u8c61\uff0c\u7528\u6765\u5b58\u653e\u5b9e\u9645\u9700\u8981\u4f20\u9012\u7684\u6570\u636e\u3002JWT \u89c4\u5b9a\u4e867\u4e2a\u5b98\u65b9\u5b57\u6bb5\uff0c\u4f9b\u9009\u7528\u3002 iss (issuer)\uff1a\u7b7e\u53d1\u4eba exp (expiration time)\uff1a\u8fc7\u671f\u65f6\u95f4 sub (subject)\uff1a\u4e3b\u9898 aud (audience)\uff1a\u53d7\u4f17 nbf (Not Before)\uff1a\u751f\u6548\u65f6\u95f4 iat (Issued At)\uff1a\u7b7e\u53d1\u65f6\u95f4 jti (JWT ID)\uff1a\u7f16\u53f7 \u9664\u4e86\u5b98\u65b9\u5b57\u6bb5\uff0c\u4f60\u8fd8\u53ef\u4ee5\u5728\u8fd9\u4e2a\u90e8\u5206\u5b9a\u4e49\u79c1\u6709\u5b57\u6bb5\uff0c\u4e0b\u9762\u5c31\u662f\u4e00\u4e2a\u4f8b\u5b50\u3002 javascript { \"sub\": \"1234567890\", \"name\": \"John Doe\", \"admin\": true } \u6ce8\u610f\uff0cJWT \u9ed8\u8ba4\u662f\u4e0d\u52a0\u5bc6\u7684\uff0c\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u8bfb\u5230\uff0c\u6240\u4ee5\u4e0d\u8981\u628a\u79d8\u5bc6\u4fe1\u606f\u653e\u5728\u8fd9\u4e2a\u90e8\u5206\u3002 \u8fd9\u4e2a JSON \u5bf9\u8c61\u4e5f\u8981\u4f7f\u7528 Base64URL \u7b97\u6cd5\u8f6c\u6210\u5b57\u7b26\u4e32\u3002","title":"3.2 Payload"},{"location":"tantan/further/sso/#33_signature","text":"Signature \u90e8\u5206\u662f\u5bf9\u524d\u4e24\u90e8\u5206\u7684\u7b7e\u540d\uff0c\u9632\u6b62\u6570\u636e\u7be1\u6539\u3002 \u5e95\u5c42\u539f\u7406\u5982\u4e0b \u9996\u5148\uff0c\u9700\u8981\u6307\u5b9a\u4e00\u4e2a\u5bc6\u94a5\uff08secret\uff09\u3002\u8fd9\u4e2a\u5bc6\u94a5\u53ea\u6709\u670d\u52a1\u5668\u624d\u77e5\u9053\uff0c\u4e0d\u80fd\u6cc4\u9732\u7ed9\u7528\u6237\u3002\u7136\u540e\uff0c\u4f7f\u7528 Header \u91cc\u9762\u6307\u5b9a\u7684\u7b7e\u540d\u7b97\u6cd5\uff08\u9ed8\u8ba4\u662f HMAC SHA256\uff09\uff0c\u6309\u7167\u4e0b\u9762\u7684\u516c\u5f0f\u4ea7\u751f\u7b7e\u540d\u3002 javascript HMACSHA256( base64UrlEncode(header) + \".\" + base64UrlEncode(payload), secret) \u7b97\u51fa\u7b7e\u540d\u4ee5\u540e\uff0c\u628a Header\u3001Payload\u3001Signature \u4e09\u4e2a\u90e8\u5206\u62fc\u6210\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u6bcf\u4e2a\u90e8\u5206\u4e4b\u95f4\u7528\"\u70b9\"\uff08 . \uff09\u5206\u9694\uff0c\u5c31\u53ef\u4ee5\u8fd4\u56de\u7ed9\u7528\u6237\u3002","title":"3.3 Signature"},{"location":"tantan/further/sso/#34_base64url","text":"\u524d\u9762\u63d0\u5230\uff0cHeader \u548c Payload \u4e32\u578b\u5316\u7684\u7b97\u6cd5\u662f Base64URL\u3002\u8fd9\u4e2a\u7b97\u6cd5\u8ddf Base64 \u7b97\u6cd5\u57fa\u672c\u7c7b\u4f3c\uff0c\u4f46\u6709\u4e00\u4e9b\u5c0f\u7684\u4e0d\u540c\u3002 JWT \u4f5c\u4e3a\u4e00\u4e2a\u4ee4\u724c\uff08token\uff09\uff0c\u6709\u4e9b\u573a\u5408\u53ef\u80fd\u4f1a\u653e\u5230 URL\uff08\u6bd4\u5982 api.example.com/?token=xxx\uff09\u3002Base64 \u6709\u4e09\u4e2a\u5b57\u7b26 + \u3001 / \u548c = \uff0c\u5728 URL \u91cc\u9762\u6709\u7279\u6b8a\u542b\u4e49\uff0c\u6240\u4ee5\u8981\u88ab\u66ff\u6362\u6389\uff1a = \u88ab\u7701\u7565\u3001 + \u66ff\u6362\u6210 - \uff0c / \u66ff\u6362\u6210 _ \u3002\u8fd9\u5c31\u662f Base64URL \u7b97\u6cd5\u3002","title":"3.4 Base64URL"},{"location":"tantan/further/sso/#4_jwt","text":"\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u5668\u8fd4\u56de\u7684 JWT\uff0c\u53ef\u4ee5\u50a8\u5b58\u5728 Cookie \u91cc\u9762\uff0c\u4e5f\u53ef\u4ee5\u50a8\u5b58\u5728 localStorage\u3002 \u6b64\u540e\uff0c\u5ba2\u6237\u7aef\u6bcf\u6b21\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\uff0c\u90fd\u8981\u5e26\u4e0a\u8fd9\u4e2a JWT\u3002\u4f60\u53ef\u4ee5\u628a\u5b83\u653e\u5728 Cookie \u91cc\u9762\u81ea\u52a8\u53d1\u9001\uff0c\u4f46\u662f\u8fd9\u6837\u4e0d\u80fd\u8de8\u57df\uff0c\u6240\u4ee5\u66f4\u597d\u7684\u505a\u6cd5\u662f\u653e\u5728 HTTP \u8bf7\u6c42\u7684\u5934\u4fe1\u606f Authorization \u5b57\u6bb5\u91cc\u9762\u3002 javascript Authorization: Bearer <token> \u53e6\u4e00\u79cd\u505a\u6cd5\u662f\uff0c\u8de8\u57df\u7684\u65f6\u5019\uff0cJWT \u5c31\u653e\u5728 POST \u8bf7\u6c42\u7684\u6570\u636e\u4f53\u91cc\u9762\u3002","title":"4. JWT \u7684\u4f7f\u7528\u65b9\u5f0f"},{"location":"tantan/further/sso/#5_jwt","text":"\uff081\uff09JWT \u9ed8\u8ba4\u662f\u4e0d\u52a0\u5bc6\uff0c\u4f46\u4e5f\u662f\u53ef\u4ee5\u52a0\u5bc6\u7684\u3002\u751f\u6210\u539f\u59cb Token \u4ee5\u540e\uff0c\u53ef\u4ee5\u7528\u5bc6\u94a5\u518d\u52a0\u5bc6\u4e00\u6b21\u3002 \uff082\uff09JWT \u4e0d\u52a0\u5bc6\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0d\u80fd\u5c06\u79d8\u5bc6\u6570\u636e\u5199\u5165 JWT\u3002 \uff083\uff09JWT \u4e0d\u4ec5\u53ef\u4ee5\u7528\u4e8e\u8ba4\u8bc1\uff0c\u4e5f\u53ef\u4ee5\u7528\u4e8e\u4ea4\u6362\u4fe1\u606f\u3002\u6709\u6548\u4f7f\u7528 JWT\uff0c\u53ef\u4ee5\u964d\u4f4e\u670d\u52a1\u5668\u67e5\u8be2\u6570\u636e\u5e93\u7684\u6b21\u6570\u3002 \uff084\uff09JWT \u7684\u6700\u5927\u7f3a\u70b9\u662f\uff0c\u7531\u4e8e\u670d\u52a1\u5668\u4e0d\u4fdd\u5b58 session \u72b6\u6001\uff0c\u56e0\u6b64\u65e0\u6cd5\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u5e9f\u6b62\u67d0\u4e2a token\uff0c\u6216\u8005\u66f4\u6539 token \u7684\u6743\u9650\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u65e6 JWT \u7b7e\u53d1\u4e86\uff0c\u5728\u5230\u671f\u4e4b\u524d\u5c31\u4f1a\u59cb\u7ec8\u6709\u6548\uff0c\u9664\u975e\u670d\u52a1\u5668\u90e8\u7f72\u989d\u5916\u7684\u903b\u8f91\u3002 \uff085\uff09JWT \u672c\u8eab\u5305\u542b\u4e86\u8ba4\u8bc1\u4fe1\u606f\uff0c\u4e00\u65e6\u6cc4\u9732\uff0c\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u83b7\u5f97\u8be5\u4ee4\u724c\u7684\u6240\u6709\u6743\u9650\u3002\u4e3a\u4e86\u51cf\u5c11\u76d7\u7528\uff0cJWT \u7684\u6709\u6548\u671f\u5e94\u8be5\u8bbe\u7f6e\u5f97\u6bd4\u8f83\u77ed\u3002\u5bf9\u4e8e\u4e00\u4e9b\u6bd4\u8f83\u91cd\u8981\u7684\u6743\u9650\uff0c\u4f7f\u7528\u65f6\u5e94\u8be5\u518d\u6b21\u5bf9\u7528\u6237\u8fdb\u884c\u8ba4\u8bc1\u3002 \uff086\uff09\u4e3a\u4e86\u51cf\u5c11\u76d7\u7528\uff0cJWT \u4e0d\u5e94\u8be5\u4f7f\u7528 HTTP \u534f\u8bae\u660e\u7801\u4f20\u8f93\uff0c\u8981\u4f7f\u7528 HTTPS \u534f\u8bae\u4f20\u8f93\u3002","title":"5. JWT \u7684\u51e0\u4e2a\u7279\u70b9"},{"location":"tantan/further/sso/#6_jwt","text":"\u751f\u6210jwt public static void main ( String [] args ) { // \u79d8\u94a5 String secret = \"itcast\" ; // \u5b9a\u4e49 \u8377\u8f7d,\u53cajwt \u7684\u7b2c\u4e8c\u90e8\u5206\u6570\u636e Map < String , Object > claims = new HashMap < String , Object > (); claims . put ( \"mobile\" , \"12345789\" ); claims . put ( \"id\" , \"2\" ); // \u751f\u6210token String jwt = Jwts . builder () . setClaims ( claims ) //\u8bbe\u7f6e\u54cd\u5e94\u6570\u636e\u4f53 . setExpiration ( new Date ( System . currentTimeMillis () + 30 * 1000 )) // \u8d85\u65f6\u65f6\u95f4 ,30\u79d2\u540e\u5931\u6548 . signWith ( SignatureAlgorithm . HS256 , secret ) //\u8bbe\u7f6e\u52a0\u5bc6\u65b9\u6cd5\u548c\u52a0\u5bc6\u76d0 . compact (); System . out . println ( jwt ); //eyJhbGciOiJIUzI1NiJ9.eyJtb2JpbGUiOiIxMjM0NTc4OSIsImlkIjoiMiIsImV4cCI6MTYwNTg4MTkxN30.gTHkE0Eq8--r5qaFuTaWkiw20PyM0gpe8MBU5k_JDpg } jwt \u6821\u9a8c \u5982\u679c\u6821\u9a8c\u5931\u8d25\u5219 \u62a5\u9519 // jwt \u6821\u9a8c public static void main ( String [] args ) { // \u79d8\u94a5 String secret = \"itcast\" ; String jwt = \"eyJhbGciOiJIUzI1NiJ9.eyJtb2JpbGUiOiIxMjM0NTc4OSIsImlkIjoiMiIsImV4cCI6MTYwNTg4MTkxN30.gTHkE0Eq8--r5qaFuTaWkiw20PyM0gpe8MBU5k_JDpg\" ; // \u901a\u8fc7token\u89e3\u6790\u6570\u636e Map < String , Object > body = Jwts . parser () . setSigningKey ( secret ) . parseClaimsJws ( jwt ) . getBody (); System . out . println ( body ); //{mobile=12345789, id=2} } \u8bf4\u660e: jwt \u5e76\u4e0d\u662f\u5b89\u5168\u7684,\u4e0d\u8981\u5b58\u50a8\u654f\u611f\u4fe1\u606f \u4f8b\u5982\u6211\u4eec\u83b7\u5f97jwt \u7684\u4e2d\u95f4\u90e8\u5206 \u4f7f\u7528base64 \u5373\u53ef\u89e3\u5bc6 // \u89e3\u5bc6 byte [] bs = Base64 . getDecoder (). decode ( \"eyJtb2JpbGUiOiIxMjM0NTc4OSIsImlkIjoiMiIsImV4cCI6MTYwNTg4MTkxN30\" ); System . out . println ( new String ( bs ));","title":"6. jwt \u7684\u4f7f\u7528"},{"location":"tantan/further/threadlocal/ThreadLocal/","text":"ThreadLocal \u00b6 \u591a\u7ebf\u7a0b\u8bbf\u95ee\u540c\u4e00\u4e2a\u5171\u4eab\u53d8\u91cf\u7684\u65f6\u5019\u5bb9\u6613\u51fa\u73b0\u5e76\u53d1\u95ee\u9898,\u4e3a\u4e86\u4fdd\u8bc1\u6ca1\u6709\u5e76\u53d1\u95ee\u9898,\u6211\u4eec\u53ef\u4ee5\u8ba9\u6bcf\u4e2a\u7ebf\u7a0b\u4f7f\u7528\u81ea\u5df1\u7684\u72ec\u6709\u7684\u53d8\u91cf,\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 \u4e00\u4e2amap \u96c6\u5408,\u6765\u4fdd\u8bc1\u6bcf\u4e2a\u7ebf\u7a0b\u4f7f\u7528\u5f53\u524d\u7ebf\u7a0b\u72ec\u6709\u7684\u6570\u636e \u5728tomcat \u7f16\u7a0b\u4e2d\u4e3a\u4e86\u66f4\u65b9\u4fbf\u7684\u4f20\u9012\u6570\u636e,\u6211\u4eec\u5e0c\u671b\u628a\u6570\u636e\u653e\u5230\u4e00\u4e2a\u5de5\u5177\u7c7b\u5168\u5c40\u53d8\u91cf\u4e2d,\u8ba9\u540e\u4f7f\u7528\u7684\u65f6\u5019,\u4ece\u5de5\u5177\u7c7b\u7684\u5168\u5c40\u53d8\u91cf\u4e2d\u83b7\u53d6,\u8fd9\u6837\u6211\u4eec\u5c31\u4f1a\u5c11\u5f88\u591a\u53c2\u6570\u7684\u4f20\u9012,\u8fdb\u800c\u63d0\u5347\u5f00\u53d1\u6548\u7387 \u4f46\u662f \u591a\u7ebf\u7a0b\u8bbf\u95ee\u540c\u4e00\u4e2a\u5171\u4eab\u53d8\u91cf\u7684\u65f6\u5019\u5bb9\u6613\u51fa\u73b0\u5e76\u53d1\u95ee\u9898,\u4e3a\u4e86\u4fdd\u8bc1\u6ca1\u6709\u5e76\u53d1\u95ee\u9898,\u6211\u4eec\u53ef\u4ee5\u8ba9\u6bcf\u4e2a\u7ebf\u7a0b\u4f7f\u7528\u81ea\u5df1\u7684\u72ec\u6709\u7684\u53d8\u91cf, (\u7b28\u65b9\u6cd5)\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 \u4e00\u4e2amap \u96c6\u5408,\u6765\u4fdd\u8bc1\u6bcf\u4e2a\u7ebf\u7a0b\u4f7f\u7528\u5f53\u524d\u7ebf\u7a0b\u72ec\u6709\u7684\u6570\u636e:\u5982\u4e0b 1. \u81ea\u5b9a\u4e49Map\u96c6\u5408\u65b9\u5f0f \u00b6 public class ThreadUtil { private static final Map map = new HashMap (); // \u83b7\u53d6\u6570\u636e public static Object get ( String name ){ return map . get ( name ); } //\u8bfb\u53d6\u6570\u636e public static void set ( String key , Object obj ){ map . put ( key , obj ); } } sji //\u6570\u636e\u5b58\u653e @RestController public class HelloController { @RequestMapping ( \"/hello\" ) public String hello (){ ThreadUtil . set ( Thread . currentThread (). getName (), \"hahah\" ); System . out . println ( \"\u8bbf\u95ee1....\" ); return \"hello 8080\" ; } } // \u6570\u636e\u83b7\u53d6 @Service public class HelloService { public void test (){ System . out . println ( ThreadUtil . get ( Thread . currentThread (). getName ())); System . out . println (); } } \u4f7f\u7528\u8d77\u6765\u76f8\u5bf9\u4e0d\u662f\u5f88\u65b9\u4fbf, \u5176\u5b9e jdk \u5df2\u7ecf\u81ea\u5e26\u4e86\u4e00\u4e2a \u6bd4\u8f83\u65b9\u4fbf\u7684,\u548c\u7ebf\u7a0b\u7ed1\u5b9a\u7684 \u5bf9\u8c61 ThreadLocal 2. ThreadLocal \u00b6 public class ThreadUtil { private static final ThreadLocal thead = new ThreadLocal (); // \u83b7\u53d6\u6570\u636e public static Object get (){ return thead.get (); } //\u8bfb\u53d6\u6570\u636e public static void set ( Object obj ){ thead.set ( obj ); } } //\u6570\u636e\u5b58\u653e @RestController public class HelloController { @RequestMapping ( \"/hello\" ) public String hello (){ ThreadUtil . set ( \"hahah\" ); System . out . println ( \"\u8bbf\u95ee1....\" ); return \"hello 8080\" ; } } // \u6570\u636e\u83b7\u53d6 @Service public class HelloService { public void test (){ System . out . println ( ThreadUtil . get ()); System . out . println (); } }","title":"ThreadLocal"},{"location":"tantan/further/threadlocal/ThreadLocal/#threadlocal","text":"\u591a\u7ebf\u7a0b\u8bbf\u95ee\u540c\u4e00\u4e2a\u5171\u4eab\u53d8\u91cf\u7684\u65f6\u5019\u5bb9\u6613\u51fa\u73b0\u5e76\u53d1\u95ee\u9898,\u4e3a\u4e86\u4fdd\u8bc1\u6ca1\u6709\u5e76\u53d1\u95ee\u9898,\u6211\u4eec\u53ef\u4ee5\u8ba9\u6bcf\u4e2a\u7ebf\u7a0b\u4f7f\u7528\u81ea\u5df1\u7684\u72ec\u6709\u7684\u53d8\u91cf,\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 \u4e00\u4e2amap \u96c6\u5408,\u6765\u4fdd\u8bc1\u6bcf\u4e2a\u7ebf\u7a0b\u4f7f\u7528\u5f53\u524d\u7ebf\u7a0b\u72ec\u6709\u7684\u6570\u636e \u5728tomcat \u7f16\u7a0b\u4e2d\u4e3a\u4e86\u66f4\u65b9\u4fbf\u7684\u4f20\u9012\u6570\u636e,\u6211\u4eec\u5e0c\u671b\u628a\u6570\u636e\u653e\u5230\u4e00\u4e2a\u5de5\u5177\u7c7b\u5168\u5c40\u53d8\u91cf\u4e2d,\u8ba9\u540e\u4f7f\u7528\u7684\u65f6\u5019,\u4ece\u5de5\u5177\u7c7b\u7684\u5168\u5c40\u53d8\u91cf\u4e2d\u83b7\u53d6,\u8fd9\u6837\u6211\u4eec\u5c31\u4f1a\u5c11\u5f88\u591a\u53c2\u6570\u7684\u4f20\u9012,\u8fdb\u800c\u63d0\u5347\u5f00\u53d1\u6548\u7387 \u4f46\u662f \u591a\u7ebf\u7a0b\u8bbf\u95ee\u540c\u4e00\u4e2a\u5171\u4eab\u53d8\u91cf\u7684\u65f6\u5019\u5bb9\u6613\u51fa\u73b0\u5e76\u53d1\u95ee\u9898,\u4e3a\u4e86\u4fdd\u8bc1\u6ca1\u6709\u5e76\u53d1\u95ee\u9898,\u6211\u4eec\u53ef\u4ee5\u8ba9\u6bcf\u4e2a\u7ebf\u7a0b\u4f7f\u7528\u81ea\u5df1\u7684\u72ec\u6709\u7684\u53d8\u91cf, (\u7b28\u65b9\u6cd5)\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 \u4e00\u4e2amap \u96c6\u5408,\u6765\u4fdd\u8bc1\u6bcf\u4e2a\u7ebf\u7a0b\u4f7f\u7528\u5f53\u524d\u7ebf\u7a0b\u72ec\u6709\u7684\u6570\u636e:\u5982\u4e0b","title":"ThreadLocal"},{"location":"tantan/further/threadlocal/ThreadLocal/#1_map","text":"public class ThreadUtil { private static final Map map = new HashMap (); // \u83b7\u53d6\u6570\u636e public static Object get ( String name ){ return map . get ( name ); } //\u8bfb\u53d6\u6570\u636e public static void set ( String key , Object obj ){ map . put ( key , obj ); } } sji //\u6570\u636e\u5b58\u653e @RestController public class HelloController { @RequestMapping ( \"/hello\" ) public String hello (){ ThreadUtil . set ( Thread . currentThread (). getName (), \"hahah\" ); System . out . println ( \"\u8bbf\u95ee1....\" ); return \"hello 8080\" ; } } // \u6570\u636e\u83b7\u53d6 @Service public class HelloService { public void test (){ System . out . println ( ThreadUtil . get ( Thread . currentThread (). getName ())); System . out . println (); } } \u4f7f\u7528\u8d77\u6765\u76f8\u5bf9\u4e0d\u662f\u5f88\u65b9\u4fbf, \u5176\u5b9e jdk \u5df2\u7ecf\u81ea\u5e26\u4e86\u4e00\u4e2a \u6bd4\u8f83\u65b9\u4fbf\u7684,\u548c\u7ebf\u7a0b\u7ed1\u5b9a\u7684 \u5bf9\u8c61 ThreadLocal","title":"1. \u81ea\u5b9a\u4e49Map\u96c6\u5408\u65b9\u5f0f"},{"location":"tantan/further/threadlocal/ThreadLocal/#2_threadlocal","text":"public class ThreadUtil { private static final ThreadLocal thead = new ThreadLocal (); // \u83b7\u53d6\u6570\u636e public static Object get (){ return thead.get (); } //\u8bfb\u53d6\u6570\u636e public static void set ( Object obj ){ thead.set ( obj ); } } //\u6570\u636e\u5b58\u653e @RestController public class HelloController { @RequestMapping ( \"/hello\" ) public String hello (){ ThreadUtil . set ( \"hahah\" ); System . out . println ( \"\u8bbf\u95ee1....\" ); return \"hello 8080\" ; } } // \u6570\u636e\u83b7\u53d6 @Service public class HelloService { public void test (){ System . out . println ( ThreadUtil . get ()); System . out . println (); } }","title":"2. ThreadLocal"},{"location":"zookeeper/zk/","text":"Zookeeper \u00b6 1)\u521d\u8bc6 Zookeeper \u00b6 1.1)Zookeeper\u6982\u5ff5 \u00b6 \u2022Zookeeper \u662f Apache Hadoop \u9879\u76ee\u4e0b\u7684\u4e00\u4e2a\u5b50\u9879\u76ee\uff0c\u662f\u4e00\u4e2a\u6811\u5f62\u76ee\u5f55\u670d\u52a1\u3002 \u2022Zookeeper \u7ffb\u8bd1\u8fc7\u6765\u5c31\u662f \u52a8\u7269\u56ed\u7ba1\u7406\u5458\uff0c\u4ed6\u662f\u7528\u6765\u7ba1 Hadoop\uff08\u5927\u8c61\uff09\u3001Hive(\u871c\u8702)\u3001Pig(\u5c0f \u732a)\u7684\u7ba1\u7406\u5458\u3002\u7b80\u79f0zk \u2022Zookeeper \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7684\u3001\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u5e94\u7528\u7a0b\u5e8f\u7684\u534f\u8c03\u670d\u52a1\u3002 \u2022Zookeeper \u63d0\u4f9b\u7684\u4e3b\u8981\u529f\u80fd\u5305\u62ec\uff1a \u2022\u914d\u7f6e\u7ba1\u7406 \u2022\u5206\u5e03\u5f0f\u9501 \u2022\u96c6\u7fa4\u7ba1\u7406 2)ZooKeeper \u5b89\u88c5\u4e0e\u914d\u7f6e \u00b6 2.1) \u4e0b\u8f7d\u5b89\u88c5 \u00b6 2.1.1\u3001\u73af\u5883\u51c6\u5907 \u00b6 ZooKeeper\u670d\u52a1\u5668\u662f\u7528Java\u521b\u5efa\u7684\uff0c\u5b83\u8fd0\u884c\u5728JVM\u4e4b\u4e0a\u3002\u9700\u8981\u5b89\u88c5JDK 7\u6216\u66f4\u9ad8\u7248\u672c\u3002 2.1.2\u3001\u4e0a\u4f20 \u00b6 \u5c06\u4e0b\u8f7d\u7684ZooKeeper\u653e\u5230/opt/ZooKeeper\u76ee\u5f55\u4e0b #\u4e0a\u4f20zookeeper alt+p put f:/setup/apache-zookeeper-3.5.6-bin.tar.gz #\u6253\u5f00 opt\u76ee\u5f55 cd /opt #\u521b\u5efazooKeeper\u76ee\u5f55 mkdir zooKeeper #\u5c06zookeeper\u5b89\u88c5\u5305\u79fb\u52a8\u5230 /opt/zooKeeper mv apache-zookeeper-3.5.6-bin.tar.gz /opt/zookeeper/ 2.1.3\u3001\u89e3\u538b \u00b6 \u5c06tar\u5305\u89e3\u538b\u5230/opt/zookeeper\u76ee\u5f55\u4e0b tar -zxvf apache-ZooKeeper-3.5.6-bin.tar.gz 2.2) \u914d\u7f6e\u542f\u52a8 \u00b6 2.2.1\u3001\u914d\u7f6ezoo.cfg \u00b6 \u8fdb\u5165\u5230conf\u76ee\u5f55\u62f7\u8d1d\u4e00\u4e2azoo_sample.cfg\u5e76\u5b8c\u6210\u914d\u7f6e #\u8fdb\u5165\u5230conf\u76ee\u5f55 cd /opt/zooKeeper/apache-zooKeeper-3.5.6-bin/conf/ #\u62f7\u8d1d cp zoo_sample.cfg zoo.cfg \u4fee\u6539zoo.cfg #\u6253\u5f00\u76ee\u5f55 cd /opt/zooKeeper/ #\u521b\u5efazooKeeper\u5b58\u50a8\u76ee\u5f55 mkdir zkdata #\u4fee\u6539zoo.cfg vim /opt/zooKeeper/apache-zooKeeper-3.5.6-bin/conf/zoo.cfg \u4fee\u6539\u5b58\u50a8\u76ee\u5f55\uff1adataDir=/opt/zookeeper/zkdata 2.2.2\u3001\u542f\u52a8ZooKeeper \u00b6 cd /opt/zooKeeper/apache-zooKeeper-3.5.6-bin/bin/ #\u542f\u52a8 ./zkServer.sh start \u770b\u5230\u4e0a\u56fe\u8868\u793aZooKeeper\u6210\u529f\u542f\u52a8 3\u3001\u67e5\u770bZooKeeper\u72b6\u6001 ./zkServer.sh status zookeeper\u542f\u52a8\u6210\u529f\u3002standalone\u4ee3\u8868zk\u6ca1\u6709\u642d\u5efa\u96c6\u7fa4\uff0c\u73b0\u5728\u662f\u5355\u8282\u70b9 zookeeper\u6ca1\u6709\u542f\u52a8 \u00b6 3)ZooKeeper \u547d\u4ee4\u64cd\u4f5c \u00b6 3.1)Zookeeper\u547d\u4ee4\u64cd\u4f5c\u6570\u636e\u6a21\u578b \u00b6 \u2022ZooKeeper \u662f\u4e00\u4e2a\u6811\u5f62\u76ee\u5f55\u670d\u52a1,\u5176\u6570\u636e\u6a21\u578b\u548cUnix\u7684\u6587\u4ef6\u7cfb\u7edf\u76ee\u5f55\u6811\u5f88\u7c7b\u4f3c\uff0c\u62e5\u6709\u4e00\u4e2a\u5c42\u6b21\u5316\u7ed3\u6784\u3002 \u2022\u8fd9\u91cc\u9762\u7684\u6bcf\u4e00\u4e2a\u8282\u70b9\u90fd\u88ab\u79f0\u4e3a\uff1a ZNode\uff0c\u6bcf\u4e2a\u8282\u70b9\u4e0a\u90fd\u4f1a\u4fdd\u5b58\u81ea\u5df1\u7684\u6570\u636e\u548c\u8282\u70b9\u4fe1\u606f\u3002 \u2022 \u8282\u70b9\u53ef\u4ee5\u62e5\u6709\u5b50\u8282\u70b9\uff0c\u540c\u65f6\u4e5f\u5141\u8bb8\u5c11\u91cf\uff081MB\uff09\u6570\u636e\u5b58\u50a8\u5728\u8be5\u8282\u70b9\u4e4b\u4e0b\u3002 \u2022\u8282\u70b9\u53ef\u4ee5\u5206\u4e3a\u56db\u5927\u7c7b\uff1a \u2022PERSISTENT \u6301\u4e45\u5316\u8282\u70b9 \u2022EPHEMERAL \u4e34\u65f6\u8282\u70b9 \uff1a-e \u2022PERSISTENT_SEQUENTIAL \u6301\u4e45\u5316\u987a\u5e8f\u8282\u70b9 \uff1a-s \u2022EPHEMERAL_SEQUENTIAL \u4e34\u65f6\u987a\u5e8f\u8282\u70b9 \uff1a-es 3.2)Zookeeper\u547d\u4ee4\u64cd\u4f5c\u670d\u52a1\u7aef\u547d\u4ee4 \u00b6 \u2022\u542f\u52a8 ZooKeeper \u670d\u52a1: ./zkServer.sh start \u2022\u67e5\u770b ZooKeeper \u670d\u52a1\u72b6\u6001: ./zkServer.sh status \u2022\u505c\u6b62 ZooKeeper \u670d\u52a1: ./zkServer.sh stop \u2022\u91cd\u542f ZooKeeper \u670d\u52a1: ./zkServer.sh restart 3.3)Zookeeper\u5ba2\u6237\u7aef\u5e38\u7528\u547d\u4ee4 \u00b6 \u8fde\u63a5ZooKeeper\u670d\u52a1\u7aef ./zkCli.sh \u2013server ip:port \u65ad\u5f00\u8fde\u63a5 quit \u67e5\u770b\u547d\u4ee4\u5e2e\u52a9 help \u663e\u793a\u6307\u5b9a\u76ee\u5f55\u4e0b\u8282\u70b9 ls \u76ee\u5f55 \u521b\u5efa\u8282\u70b9 create /\u8282\u70b9path value \u83b7\u53d6\u8282\u70b9\u503c get /\u8282\u70b9path \u8bbe\u7f6e\u8282\u70b9\u503c set /\u8282\u70b9path value \u5220\u9664\u5355\u4e2a\u8282\u70b9 delete /\u8282\u70b9path \u5220\u9664\u5e26\u6709\u5b50\u8282\u70b9\u7684\u8282\u70b9 deleteall /\u8282\u70b9path 3.4)\u5ba2\u6237\u7aef\u547d\u4ee4-\u521b\u5efa\u4e34\u65f6\u6709\u5e8f\u8282\u70b9 \u00b6 \u2022\u521b\u5efa\u4e34\u65f6\u8282\u70b9 create -e /\u8282\u70b9path value \u2022\u521b\u5efa\u987a\u5e8f\u8282\u70b9 create -s /\u8282\u70b9path value \u2022\u67e5\u8be2\u8282\u70b9\u8be6\u7ec6\u4fe1\u606f ls \u2013s /\u8282\u70b9path \u2022czxid\uff1a\u8282\u70b9\u88ab\u521b\u5efa\u7684\u4e8b\u52a1ID \u2022ctime: \u521b\u5efa\u65f6\u95f4 \u2022mzxid: \u6700\u540e\u4e00\u6b21\u88ab\u66f4\u65b0\u7684\u4e8b\u52a1ID \u2022mtime: \u4fee\u6539\u65f6\u95f4 \u2022pzxid\uff1a\u5b50\u8282\u70b9\u5217\u8868\u6700\u540e\u4e00\u6b21\u88ab\u66f4\u65b0\u7684\u4e8b\u52a1ID \u2022cversion\uff1a\u5b50\u8282\u70b9\u7684\u7248\u672c\u53f7 \u2022dataversion\uff1a\u6570\u636e\u7248\u672c\u53f7 \u2022aclversion\uff1a\u6743\u9650\u7248\u672c\u53f7 \u2022ephemeralOwner\uff1a\u7528\u4e8e\u4e34\u65f6\u8282\u70b9\uff0c\u4ee3\u8868\u4e34\u65f6\u8282\u70b9\u7684\u4e8b\u52a1ID\uff0c\u5982\u679c\u4e3a\u6301\u4e45\u8282\u70b9\u5219\u4e3a0 \u2022dataLength\uff1a\u8282\u70b9\u5b58\u50a8\u7684\u6570\u636e\u7684\u957f\u5ea6 \u2022numChildren\uff1a\u5f53\u524d\u8282\u70b9\u7684\u5b50\u8282\u70b9\u4e2a\u6570 4)ZooKeeper JavaAPI \u64cd\u4f5c \u00b6 4.1)urator\u4ecb\u7ecd \u00b6 \u2022Curator \u662f Apache ZooKeeper \u7684Java\u5ba2\u6237\u7aef\u5e93\u3002 \u2022\u5e38\u89c1\u7684ZooKeeper Java API \uff1a \u2022\u539f\u751fJava API \u2022ZkClient \u2022Curator \u2022Curator \u9879\u76ee\u7684\u76ee\u6807\u662f\u7b80\u5316 ZooKeeper \u5ba2\u6237\u7aef\u7684\u4f7f\u7528\u3002 \u2022Curator \u6700\u521d\u662f Netfix \u7814\u53d1\u7684,\u540e\u6765\u6350\u732e\u4e86 Apache \u57fa\u91d1\u4f1a,\u76ee\u524d\u662f Apache \u7684\u9876\u7ea7\u9879\u76ee\u3002 \u2022\u5b98\u7f51\uff1ahttp://curator.apache.org/ 4.2)JavaAPI\u64cd\u4f5c\u5efa\u7acb\u8fde\u63a5 \u00b6 1\uff0c\u642d\u5efa\u9879\u76ee \u521b\u5efa\u9879\u76eecurator-zk \u5f15\u5165pom\u548c\u65e5\u5fd7\u6587\u4ef6 \u8d44\u6599\u6587\u4ef6\u5939\u4e0bpom.xml\u548clog4j.properties 2\u3001\u521b\u5efa\u6d4b\u8bd5\u7c7b\uff0c\u4f7f\u7528curator\u8fde\u63a5zookeeper @Before public void testConnect () { //\u91cd\u8bd5\u7b56\u7565 RetryPolicy retryPolicy = new ExponentialBackoffRetry ( 3000 , 10 ); //2.\u7b2c\u4e8c\u79cd\u65b9\u5f0f //CuratorFrameworkFactory.builder(); client = CuratorFrameworkFactory . builder () . connectString ( \"192.168.200.130:2181\" ) . sessionTimeoutMs ( 60 * 1000 ) . connectionTimeoutMs ( 15 * 1000 ) . retryPolicy ( retryPolicy ) . namespace ( \"itheima\" ) . build (); //\u5f00\u542f\u8fde\u63a5 client . start (); } 4.3)Zookeeper JavaAPI\u64cd\u4f5c-\u521b\u5efa\u8282\u70b9 \u00b6 /** * \u521b\u5efa\u8282\u70b9\uff1acreate \u6301\u4e45 \u4e34\u65f6 \u987a\u5e8f \u6570\u636e * 1. \u57fa\u672c\u521b\u5efa \uff1acreate().forPath(\"\") * 2. \u521b\u5efa\u8282\u70b9 \u5e26\u6709\u6570\u636e:create().forPath(\"\",data) * 3. \u8bbe\u7f6e\u8282\u70b9\u7684\u7c7b\u578b\uff1acreate().withMode().forPath(\"\",data) * 4. \u521b\u5efa\u591a\u7ea7\u8282\u70b9 /app1/p1 \uff1acreate().creatingParentsIfNeeded().forPath(\"\",data) */ @Test public void testCreate () throws Exception { //2. \u521b\u5efa\u8282\u70b9 \u5e26\u6709\u6570\u636e //\u5982\u679c\u521b\u5efa\u8282\u70b9\uff0c\u6ca1\u6709\u6307\u5b9a\u6570\u636e\uff0c\u5219\u9ed8\u8ba4\u5c06\u5f53\u524d\u5ba2\u6237\u7aef\u7684ip\u4f5c\u4e3a\u6570\u636e\u5b58\u50a8 String path = client . create (). forPath ( \"/app2\" , \"hehe\" . getBytes ()); System . out . println ( path ); } @Test public void testCreate2 () throws Exception { //1. \u57fa\u672c\u521b\u5efa //\u5982\u679c\u521b\u5efa\u8282\u70b9\uff0c\u6ca1\u6709\u6307\u5b9a\u6570\u636e\uff0c\u5219\u9ed8\u8ba4\u5c06\u5f53\u524d\u5ba2\u6237\u7aef\u7684ip\u4f5c\u4e3a\u6570\u636e\u5b58\u50a8 String path = client . create (). forPath ( \"/app1\" ); System . out . println ( path ); } @Test public void testCreate3 () throws Exception { //3. \u8bbe\u7f6e\u8282\u70b9\u7684\u7c7b\u578b //\u9ed8\u8ba4\u7c7b\u578b\uff1a\u6301\u4e45\u5316 String path = client . create (). withMode ( CreateMode . EPHEMERAL ). forPath ( \"/app3\" ); System . out . println ( path ); } @Test public void testCreate4 () throws Exception { //4. \u521b\u5efa\u591a\u7ea7\u8282\u70b9 /app1/p1 //creatingParentsIfNeeded():\u5982\u679c\u7236\u8282\u70b9\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\u7236\u8282\u70b9 String path = client . create (). creatingParentsIfNeeded (). forPath ( \"/app4/p1\" ); System . out . println ( path ); } 4.4)ZookeeperJavaAPI\u64cd\u4f5c-\u67e5\u8be2\u8282\u70b9 \u00b6 /** * \u67e5\u8be2\u8282\u70b9\uff1a * 1. \u67e5\u8be2\u6570\u636e\uff1aget: getData().forPath() * 2. \u67e5\u8be2\u5b50\u8282\u70b9\uff1a ls: getChildren().forPath() * 3. \u67e5\u8be2\u8282\u70b9\u72b6\u6001\u4fe1\u606f\uff1als -s:getData().storingStatIn(\u72b6\u6001\u5bf9\u8c61).forPath() */ @Test public void testGet1 () throws Exception { //1. \u67e5\u8be2\u6570\u636e\uff1aget byte [] data = client . getData (). forPath ( \"/app1\" ); System . out . println ( new String ( data )); } @Test public void testGet2 () throws Exception { // 2. \u67e5\u8be2\u5b50\u8282\u70b9\uff1a ls List < String > path = client . getChildren (). forPath ( \"/\" ); System . out . println ( path ); } @Test public void testGet3 () throws Exception { Stat status = new Stat (); System . out . println ( status ); //3. \u67e5\u8be2\u8282\u70b9\u72b6\u6001\u4fe1\u606f\uff1als -s client . getData (). storingStatIn ( status ). forPath ( \"/app1\" ); System . out . println ( status ); } 4.5)Zookeeper JavaAPI\u64cd\u4f5c-\u4fee\u6539\u8282\u70b9 \u00b6 /** * \u4fee\u6539\u6570\u636e * 1. \u57fa\u672c\u4fee\u6539\u6570\u636e\uff1asetData().forPath() * 2. \u6839\u636e\u7248\u672c\u4fee\u6539: setData().withVersion().forPath() * * version \u662f\u901a\u8fc7\u67e5\u8be2\u51fa\u6765\u7684\u3002\u76ee\u7684\u5c31\u662f\u4e3a\u4e86\u8ba9\u5176\u4ed6\u5ba2\u6237\u7aef\u6216\u8005\u7ebf\u7a0b\u4e0d\u5e72\u6270\u6211\u3002 * * @throws Exception */ @Test public void testSet () throws Exception { client . setData (). forPath ( \"/app1\" , \"itcast\" . getBytes ()); } @Test public void testSetForVersion () throws Exception { Stat status = new Stat (); //3. \u67e5\u8be2\u8282\u70b9\u72b6\u6001\u4fe1\u606f\uff1als -s client . getData (). storingStatIn ( status ). forPath ( \"/app1\" ); int version = status . getVersion (); //\u67e5\u8be2\u51fa\u6765\u7684 3 System . out . println ( version ); client . setData (). withVersion ( version ). forPath ( \"/app1\" , \"hehe\" . getBytes ()); } 4.6)Zookeeper JavaAPI\u64cd\u4f5c-\u5220\u9664\u8282\u70b9 \u00b6 /** * \u5220\u9664\u8282\u70b9\uff1a delete deleteall * 1. \u5220\u9664\u5355\u4e2a\u8282\u70b9:delete().forPath(\"/app1\"); * 2. \u5220\u9664\u5e26\u6709\u5b50\u8282\u70b9\u7684\u8282\u70b9:delete().deletingChildrenIfNeeded().forPath(\"/app1\"); * 3. \u5fc5\u987b\u6210\u529f\u7684\u5220\u9664:\u4e3a\u4e86\u9632\u6b62\u7f51\u7edc\u6296\u52a8\u3002\u672c\u8d28\u5c31\u662f\u91cd\u8bd5\u3002 client.delete().guaranteed().forPath(\"/app2\"); * 4. \u56de\u8c03\uff1ainBackground * @throws Exception */ @Test public void testDelete () throws Exception { // 1. \u5220\u9664\u5355\u4e2a\u8282\u70b9 client . delete (). forPath ( \"/app1\" ); } @Test public void testDelete2 () throws Exception { //2. \u5220\u9664\u5e26\u6709\u5b50\u8282\u70b9\u7684\u8282\u70b9 client . delete (). deletingChildrenIfNeeded (). forPath ( \"/app4\" ); } @Test public void testDelete3 () throws Exception { //3. \u5fc5\u987b\u6210\u529f\u7684\u5220\u9664 client . delete (). guaranteed (). forPath ( \"/app2\" ); } @Test public void testDelete4 () throws Exception { //4. \u56de\u8c03 client . delete (). guaranteed (). inBackground ( new BackgroundCallback (){ @Override public void processResult ( CuratorFramework client , CuratorEvent event ) throws Exception { System . out . println ( \"\u6211\u88ab\u5220\u9664\u4e86~\" ); System . out . println ( event ); } }). forPath ( \"/app1\" ); } 4.7)Zookeeper JavaAPI\u64cd\u4f5c-Watch\u76d1\u542c\u6982\u8ff0 \u00b6 \u2022ZooKeeper \u5141\u8bb8\u7528\u6237\u5728\u6307\u5b9a\u8282\u70b9\u4e0a\u6ce8\u518c\u4e00\u4e9bWatcher\uff0c\u5e76\u4e14\u5728\u4e00\u4e9b\u7279\u5b9a\u4e8b\u4ef6\u89e6\u53d1\u7684\u65f6\u5019\uff0cZooKeeper \u670d\u52a1\u7aef\u4f1a\u5c06\u4e8b\u4ef6\u901a\u77e5\u5230\u611f\u5174\u8da3\u7684\u5ba2\u6237\u7aef\u4e0a\u53bb\uff0c\u8be5\u673a\u5236\u662f ZooKeeper \u5b9e\u73b0\u5206\u5e03\u5f0f\u534f\u8c03\u670d\u52a1\u7684\u91cd\u8981\u7279\u6027\u3002 \u2022ZooKeeper \u4e2d\u5f15\u5165\u4e86Watcher\u673a\u5236\u6765\u5b9e\u73b0\u4e86\u53d1\u5e03/\u8ba2\u9605\u529f\u80fd\u80fd\uff0c\u80fd\u591f\u8ba9\u591a\u4e2a\u8ba2\u9605\u8005\u540c\u65f6\u76d1\u542c\u67d0\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5f53\u4e00\u4e2a\u5bf9\u8c61\u81ea\u8eab\u72b6\u6001\u53d8\u5316\u65f6\uff0c\u4f1a\u901a\u77e5\u6240\u6709\u8ba2\u9605\u8005\u3002 \u2022ZooKeeper \u539f\u751f\u652f\u6301\u901a\u8fc7\u6ce8\u518cWatcher\u6765\u8fdb\u884c\u4e8b\u4ef6\u76d1\u542c\uff0c\u4f46\u662f\u5176\u4f7f\u7528\u5e76\u4e0d\u662f\u7279\u522b\u65b9\u4fbf \u200b \u9700\u8981\u5f00\u53d1\u4eba\u5458\u81ea\u5df1\u53cd\u590d\u6ce8\u518cWatcher\uff0c\u6bd4\u8f83\u7e41\u7410\u3002 \u2022Curator\u5f15\u5165\u4e86 Cache \u6765\u5b9e\u73b0\u5bf9 ZooKeeper \u670d\u52a1\u7aef\u4e8b\u4ef6\u7684\u76d1\u542c\u3002 \u2022ZooKeeper\u63d0\u4f9b\u4e86\u4e09\u79cdWatcher\uff1a \u2022NodeCache : \u53ea\u662f\u76d1\u542c\u67d0\u4e00\u4e2a\u7279\u5b9a\u7684\u8282\u70b9 \u2022PathChildrenCache : \u76d1\u63a7\u4e00\u4e2aZNode\u7684\u5b50\u8282\u70b9. \u2022TreeCache : \u53ef\u4ee5\u76d1\u63a7\u6574\u4e2a\u6811\u4e0a\u7684\u6240\u6709\u8282\u70b9\uff0c\u7c7b\u4f3c\u4e8ePathChildrenCache\u548cNodeCache\u7684\u7ec4\u5408 4.8Zookeeper JavaAPI\u64cd\u4f5c-Watch\u76d1\u542c-NodeCache \u00b6 /** * \u6f14\u793a NodeCache\uff1a\u7ed9\u6307\u5b9a\u4e00\u4e2a\u8282\u70b9\u6ce8\u518c\u76d1\u542c\u5668 */ @Test public void testNodeCache () throws Exception { //1. \u521b\u5efaNodeCache\u5bf9\u8c61 final NodeCache nodeCache = new NodeCache ( client , \"/app1\" ); //2. \u6ce8\u518c\u76d1\u542c nodeCache . getListenable (). addListener ( new NodeCacheListener () { @Override public void nodeChanged () throws Exception { System . out . println ( \"\u8282\u70b9\u53d8\u5316\u4e86~\" ); //\u83b7\u53d6\u4fee\u6539\u8282\u70b9\u540e\u7684\u6570\u636e byte [] data = nodeCache . getCurrentData (). getData (); System . out . println ( new String ( data )); } }); //3. \u5f00\u542f\u76d1\u542c.\u5982\u679c\u8bbe\u7f6e\u4e3atrue\uff0c\u5219\u5f00\u542f\u76d1\u542c\u662f\uff0c\u52a0\u8f7d\u7f13\u51b2\u6570\u636e nodeCache . start ( true ); while ( true ){ } } 4.9)Zookeeper JavaAPI\u64cd\u4f5c-Watch\u76d1\u542c-PathChildrenCache \u00b6 @Test public void testPathChildrenCache () throws Exception { //1.\u521b\u5efa\u76d1\u542c\u5bf9\u8c61 PathChildrenCache pathChildrenCache = new PathChildrenCache ( client , \"/app2\" , true ); //2. \u7ed1\u5b9a\u76d1\u542c\u5668 pathChildrenCache . getListenable (). addListener ( new PathChildrenCacheListener () { @Override public void childEvent ( CuratorFramework client , PathChildrenCacheEvent event ) throws Exception { System . out . println ( \"\u5b50\u8282\u70b9\u53d8\u5316\u4e86~\" ); System . out . println ( event ); //\u76d1\u542c\u5b50\u8282\u70b9\u7684\u6570\u636e\u53d8\u66f4\uff0c\u5e76\u4e14\u62ff\u5230\u53d8\u66f4\u540e\u7684\u6570\u636e //1.\u83b7\u53d6\u7c7b\u578b PathChildrenCacheEvent . Type type = event . getType (); //2.\u5224\u65ad\u7c7b\u578b\u662f\u5426\u662fupdate if ( type . equals ( PathChildrenCacheEvent . Type . CHILD_UPDATED )){ System . out . println ( \"\u6570\u636e\u53d8\u4e86\uff01\uff01\uff01\" ); byte [] data = event . getData (). getData (); System . out . println ( new String ( data )); } } }); //3. \u5f00\u542f pathChildrenCache . start (); while ( true ){ } } 4.10)Zookeeper JavaAPI\u64cd\u4f5c-Watch\u76d1\u542c-TreeCache \u00b6 /** * \u6f14\u793a TreeCache\uff1a\u76d1\u542c\u67d0\u4e2a\u8282\u70b9\u81ea\u5df1\u548c\u6240\u6709\u5b50\u8282\u70b9\u4eec */ @Test public void testTreeCache () throws Exception { //1. \u521b\u5efa\u76d1\u542c\u5668 TreeCache treeCache = new TreeCache ( client , \"/app2\" ); //2. \u6ce8\u518c\u76d1\u542c treeCache . getListenable (). addListener ( new TreeCacheListener () { @Override public void childEvent ( CuratorFramework client , TreeCacheEvent event ) throws Exception { System . out . println ( \"\u8282\u70b9\u53d8\u5316\u4e86\" ); System . out . println ( event ); } }); //3. \u5f00\u542f treeCache . start (); while ( true ){ } } 4.11)Zookeeper\u5206\u5e03\u5f0f\u9501-\u6982\u5ff5 \u00b6 \u2022\u5728\u6211\u4eec\u8fdb\u884c\u5355\u673a\u5e94\u7528\u5f00\u53d1\uff0c\u6d89\u53ca\u5e76\u53d1\u540c\u6b65\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5f80\u5f80\u91c7\u7528synchronized\u6216\u8005Lock\u7684\u65b9\u5f0f\u6765\u89e3\u51b3\u591a\u7ebf\u7a0b\u95f4\u7684\u4ee3\u7801\u540c\u6b65\u95ee\u9898\uff0c\u8fd9\u65f6\u591a\u7ebf\u7a0b\u7684\u8fd0\u884c\u90fd\u662f\u5728\u540c\u4e00\u4e2aJVM\u4e4b\u4e0b\uff0c\u6ca1\u6709\u4efb\u4f55\u95ee\u9898\u3002 \u2022\u4f46\u5f53\u6211\u4eec\u7684\u5e94\u7528\u662f\u5206\u5e03\u5f0f\u96c6\u7fa4\u5de5\u4f5c\u7684\u60c5\u51b5\u4e0b\uff0c\u5c5e\u4e8e\u591aJVM\u4e0b\u7684\u5de5\u4f5c\u73af\u5883\uff0c\u8de8JVM\u4e4b\u95f4\u5df2\u7ecf\u65e0\u6cd5\u901a\u8fc7\u591a\u7ebf\u7a0b\u7684\u9501\u89e3\u51b3\u540c\u6b65\u95ee\u9898\u3002 \u2022\u90a3\u4e48\u5c31\u9700\u8981\u4e00\u79cd\u66f4\u52a0\u9ad8\u7ea7\u7684\u9501\u673a\u5236\uff0c\u6765\u5904\u7406\u79cd\u8de8\u673a\u5668\u7684\u8fdb\u7a0b\u4e4b\u95f4\u7684\u6570\u636e\u540c\u6b65\u95ee\u9898\u2014\u2014\u8fd9\u5c31\u662f\u5206\u5e03\u5f0f\u9501\u3002 4.12)Zookeeper \u5206\u5e03\u5f0f\u9501-zookeeper\u5206\u5e03\u5f0f\u9501\u539f\u7406 \u00b6 \u2022\u6838\u5fc3\u601d\u60f3\uff1a\u5f53\u5ba2\u6237\u7aef\u8981\u83b7\u53d6\u9501\uff0c\u5219\u521b\u5efa\u8282\u70b9\uff0c\u4f7f\u7528\u5b8c\u9501\uff0c\u5219\u5220\u9664\u8be5\u8282\u70b9\u3002 1.\u5ba2\u6237\u7aef\u83b7\u53d6\u9501\u65f6\uff0c\u5728lock\u8282\u70b9\u4e0b\u521b\u5efa\u4e34\u65f6\u987a\u5e8f\u8282\u70b9\u3002 2.\u7136\u540e\u83b7\u53d6lock\u4e0b\u9762\u7684\u6240\u6709\u5b50\u8282\u70b9\uff0c\u5ba2\u6237\u7aef\u83b7\u53d6\u5230\u6240\u6709\u7684\u5b50\u8282\u70b9\u4e4b\u540e\uff0c\u5982\u679c\u53d1\u73b0\u81ea\u5df1\u521b\u5efa\u7684\u5b50\u8282\u70b9\u5e8f\u53f7\u6700\u5c0f\uff0c\u90a3\u4e48\u5c31\u8ba4\u4e3a\u8be5\u5ba2\u6237\u7aef\u83b7\u53d6\u5230\u4e86\u9501\u3002\u4f7f\u7528\u5b8c\u9501\u540e\uff0c\u5c06\u8be5\u8282\u70b9\u5220\u9664\u3002 3.\u5982\u679c\u53d1\u73b0\u81ea\u5df1\u521b\u5efa\u7684\u8282\u70b9\u5e76\u975elock\u6240\u6709\u5b50\u8282\u70b9\u4e2d\u6700\u5c0f\u7684\uff0c\u8bf4\u660e\u81ea\u5df1\u8fd8\u6ca1\u6709\u83b7\u53d6\u5230\u9501\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u9700\u8981\u627e\u5230\u6bd4\u81ea\u5df1\u5c0f\u7684\u90a3\u4e2a\u8282\u70b9\uff0c\u540c\u65f6\u5bf9\u5176\u6ce8\u518c\u4e8b\u4ef6\u76d1\u542c\u5668\uff0c\u76d1\u542c\u5220\u9664\u4e8b\u4ef6\u3002 4.\u5982\u679c\u53d1\u73b0\u6bd4\u81ea\u5df1\u5c0f\u7684\u90a3\u4e2a\u8282\u70b9\u88ab\u5220\u9664\uff0c\u5219\u5ba2\u6237\u7aef\u7684 \u200b Watcher\u4f1a\u6536\u5230\u76f8\u5e94\u901a\u77e5\uff0c\u6b64\u65f6\u518d\u6b21\u5224\u65ad\u81ea\u5df1\u521b\u5efa\u7684\u8282\u70b9 \u200b \u662f\u5426\u662flock\u5b50\u8282\u70b9\u4e2d\u5e8f\u53f7\u6700\u5c0f\u7684\uff0c\u5982\u679c\u662f\u5219\u83b7\u53d6\u5230\u4e86\u9501\uff0c \u200b \u5982\u679c\u4e0d\u662f\u5219\u91cd\u590d\u4ee5\u4e0a\u6b65\u9aa4\u7ee7\u7eed\u83b7\u53d6\u5230\u6bd4\u81ea\u5df1\u5c0f\u7684\u4e00\u4e2a\u8282\u70b9 \u200b \u5e76\u6ce8\u518c\u76d1\u542c\u3002 4.13)Zookeeper \u5206\u5e03\u5f0f\u9501-\u6a21\u62df12306\u552e\u7968\u6848\u4f8b \u00b6 Curator\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501API \u5728Curator\u4e2d\u6709\u4e94\u79cd\u9501\u65b9\u6848\uff1a InterProcessSemaphoreMutex\uff1a\u5206\u5e03\u5f0f\u6392\u5b83\u9501\uff08\u975e\u53ef\u91cd\u5165\u9501\uff09 InterProcessMutex\uff1a\u5206\u5e03\u5f0f\u53ef\u91cd\u5165\u6392\u5b83\u9501 InterProcessReadWriteLock\uff1a\u5206\u5e03\u5f0f\u8bfb\u5199\u9501 InterProcessMultiLock\uff1a\u5c06\u591a\u4e2a\u9501\u4f5c\u4e3a\u5355\u4e2a\u5b9e\u4f53\u7ba1\u7406\u7684\u5bb9\u5668 InterProcessSemaphoreV2\uff1a\u5171\u4eab\u4fe1\u53f7\u91cf 1,\u521b\u5efa\u7ebf\u7a0b\u8fdb\u884c\u52a0\u9501\u8bbe\u7f6e public class Ticket12306 implements Runnable { private int tickets = 10 ; //\u6570\u636e\u5e93\u7684\u7968\u6570 private InterProcessMutex lock ; @Override public void run () { while ( true ){ //\u83b7\u53d6\u9501 try { lock . acquire ( 3 , TimeUnit . SECONDS ); if ( tickets > 0 ){ System . out . println ( Thread . currentThread () + \":\" + tickets ); Thread . sleep ( 100 ); tickets -- ; } } catch ( Exception e ) { e . printStackTrace (); } finally { //\u91ca\u653e\u9501 try { lock . release (); } catch ( Exception e ) { e . printStackTrace (); } } } } } 2,\u521b\u5efa\u8fde\u63a5\uff0c\u5e76\u4e14\u521d\u59cb\u5316\u9501 public Ticket12306 (){ //\u91cd\u8bd5\u7b56\u7565 RetryPolicy retryPolicy = new ExponentialBackoffRetry ( 3000 , 10 ); //2.\u7b2c\u4e8c\u79cd\u65b9\u5f0f //CuratorFrameworkFactory.builder(); CuratorFramework client = CuratorFrameworkFactory . builder () . connectString ( \"192.168.149.135:2181\" ) . sessionTimeoutMs ( 60 * 1000 ) . connectionTimeoutMs ( 15 * 1000 ) . retryPolicy ( retryPolicy ) . build (); //\u5f00\u542f\u8fde\u63a5 client . start (); lock = new InterProcessMutex ( client , \"/lock\" ); } 3,\u8fd0\u884c\u591a\u4e2a\u7ebf\u7a0b\u8fdb\u884c\u6d4b\u8bd5 public class LockTest { public static void main ( String [] args ) { Ticket12306 ticket12306 = new Ticket12306 (); //\u521b\u5efa\u5ba2\u6237\u7aef Thread t1 = new Thread ( ticket12306 , \"\u643a\u7a0b\" ); Thread t2 = new Thread ( ticket12306 , \"\u98de\u732a\" ); t1 . start (); t2 . start (); } } 5)ZooKeeper \u96c6\u7fa4\u642d\u5efa \u00b6 5.1)Zookeeper \u96c6\u7fa4\u4ecb\u7ecd \u00b6 Leader\u9009\u4e3e\uff1a \u2022Serverid\uff1a\u670d\u52a1\u5668ID \u6bd4\u5982\u6709\u4e09\u53f0\u670d\u52a1\u5668\uff0c\u7f16\u53f7\u5206\u522b\u662f1,2,3\u3002 \u7f16\u53f7\u8d8a\u5927\u5728\u9009\u62e9\u7b97\u6cd5\u4e2d\u7684\u6743\u91cd\u8d8a\u5927\u3002 \u2022Zxid\uff1a\u6570\u636eID \u670d\u52a1\u5668\u4e2d\u5b58\u653e\u7684\u6700\u5927\u6570\u636eID.\u503c\u8d8a\u5927\u8bf4\u660e\u6570\u636e \u8d8a\u65b0\uff0c\u5728\u9009\u4e3e\u7b97\u6cd5\u4e2d\u6570\u636e\u8d8a\u65b0\u6743\u91cd\u8d8a\u5927\u3002 \u2022\u5728Leader\u9009\u4e3e\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u67d0\u53f0ZooKeeper \u200b \u83b7\u5f97\u4e86\u8d85\u8fc7\u534a\u6570\u7684\u9009\u7968\uff0c \u200b \u5219\u6b64ZooKeeper\u5c31\u53ef\u4ee5\u6210\u4e3aLeader\u4e86\u3002 5.2)\u642d\u5efa\u8981\u6c42 \u00b6 \u771f\u5b9e\u7684\u96c6\u7fa4\u662f\u9700\u8981\u90e8\u7f72\u5728\u4e0d\u540c\u7684\u670d\u52a1\u5668\u4e0a\u7684\uff0c\u4f46\u662f\u5728\u6211\u4eec\u6d4b\u8bd5\u65f6\u540c\u65f6\u542f\u52a8\u5f88\u591a\u4e2a\u865a\u62df\u673a\u5185\u5b58\u4f1a\u5403\u4e0d\u6d88\uff0c\u6240\u4ee5\u6211\u4eec\u901a\u5e38\u4f1a\u642d\u5efa \u4f2a\u96c6\u7fa4 \uff0c\u4e5f\u5c31\u662f\u628a\u6240\u6709\u7684\u670d\u52a1\u90fd\u642d\u5efa\u5728\u4e00\u53f0\u865a\u62df\u673a\u4e0a\uff0c\u7528\u7aef\u53e3\u8fdb\u884c\u533a\u5206\u3002 \u6211\u4eec\u8fd9\u91cc\u8981\u6c42\u642d\u5efa\u4e00\u4e2a\u4e09\u4e2a\u8282\u70b9\u7684Zookeeper\u96c6\u7fa4\uff08\u4f2a\u96c6\u7fa4\uff09\u3002 5.3)\u51c6\u5907\u5de5\u4f5c \u00b6 \u91cd\u65b0\u90e8\u7f72\u4e00\u53f0\u865a\u62df\u673a\u4f5c\u4e3a\u6211\u4eec\u642d\u5efa\u96c6\u7fa4\u7684\u6d4b\u8bd5\u670d\u52a1\u5668\u3002 \uff081\uff09\u5b89\u88c5JDK \u3010\u6b64\u6b65\u9aa4\u7701\u7565\u3011\u3002 \uff082\uff09Zookeeper\u538b\u7f29\u5305\u4e0a\u4f20\u5230\u670d\u52a1\u5668 \uff083\uff09\u5c06Zookeeper\u89e3\u538b \uff0c\u5efa\u7acb/usr/local/zookeeper-cluster\u76ee\u5f55\uff0c\u5c06\u89e3\u538b\u540e\u7684Zookeeper\u590d\u5236\u5230\u4ee5\u4e0b\u4e09\u4e2a\u76ee\u5f55 /usr/local/zookeeper-cluster/zookeeper-1 /usr/local/zookeeper-cluster/zookeeper-2 /usr/local/zookeeper-cluster/zookeeper-3 [ root@localhost ~ ] # mkdir /usr/local/zookeeper-cluster [ root@localhost ~ ] # cp -r apache-zookeeper-3.5.6-bin /usr/local/zookeeper-cluster/zookeeper-1 [ root@localhost ~ ] # cp -r apache-zookeeper-3.5.6-bin /usr/local/zookeeper-cluster/zookeeper-2 [ root@localhost ~ ] # cp -r apache-zookeeper-3.5.6-bin /usr/local/zookeeper-cluster/zookeeper-3 \uff084\uff09\u521b\u5efadata\u76ee\u5f55 \uff0c\u5e76\u4e14\u5c06 conf\u4e0bzoo_sample.cfg \u6587\u4ef6\u6539\u540d\u4e3a zoo.cfg mkdir /usr/local/zookeeper-cluster/zookeeper-1/data mkdir /usr/local/zookeeper-cluster/zookeeper-2/data mkdir /usr/local/zookeeper-cluster/zookeeper-3/data mv /usr/local/zookeeper-cluster/zookeeper-1/conf/zoo_sample.cfg /usr/local/zookeeper-cluster/zookeeper-1/conf/zoo.cfg mv /usr/local/zookeeper-cluster/zookeeper-2/conf/zoo_sample.cfg /usr/local/zookeeper-cluster/zookeeper-2/conf/zoo.cfg mv /usr/local/zookeeper-cluster/zookeeper-3/conf/zoo_sample.cfg /usr/local/zookeeper-cluster/zookeeper-3/conf/zoo.cfg \uff085\uff09 \u914d\u7f6e\u6bcf\u4e00\u4e2aZookeeper \u7684dataDir \u548c clientPort \u5206\u522b\u4e3a2181 2182 2183 \u4fee\u6539/usr/local/zookeeper-cluster/zookeeper-1/conf/zoo.cfg vim /usr/local/zookeeper-cluster/zookeeper-1/conf/zoo.cfg clientPort = 2181 dataDir = /usr/local/zookeeper-cluster/zookeeper-1/data \u4fee\u6539/usr/local/zookeeper-cluster/zookeeper-2/conf/zoo.cfg vim /usr/local/zookeeper-cluster/zookeeper-2/conf/zoo.cfg clientPort = 2182 dataDir = /usr/local/zookeeper-cluster/zookeeper-2/data \u4fee\u6539/usr/local/zookeeper-cluster/zookeeper-3/conf/zoo.cfg vim /usr/local/zookeeper-cluster/zookeeper-3/conf/zoo.cfg clientPort = 2183 dataDir = /usr/local/zookeeper-cluster/zookeeper-3/data 5.4)\u914d\u7f6e\u96c6\u7fa4 \u00b6 \uff081\uff09\u5728\u6bcf\u4e2azookeeper\u7684 data \u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a myid \u6587\u4ef6\uff0c\u5185\u5bb9\u5206\u522b\u662f1\u30012\u30013 \u3002\u8fd9\u4e2a\u6587\u4ef6\u5c31\u662f\u8bb0\u5f55\u6bcf\u4e2a\u670d\u52a1\u5668\u7684ID echo 1 >/usr/local/zookeeper-cluster/zookeeper-1/data/myid echo 2 >/usr/local/zookeeper-cluster/zookeeper-2/data/myid echo 3 >/usr/local/zookeeper-cluster/zookeeper-3/data/myid \uff082\uff09\u5728\u6bcf\u4e00\u4e2azookeeper \u7684 zoo.cfg\u914d\u7f6e\u5ba2\u6237\u7aef\u8bbf\u95ee\u7aef\u53e3\uff08clientPort\uff09\u548c\u96c6\u7fa4\u670d\u52a1\u5668IP\u5217\u8868\u3002 \u96c6\u7fa4\u670d\u52a1\u5668IP\u5217\u8868\u5982\u4e0b vim /usr/local/zookeeper-cluster/zookeeper-1/conf/zoo.cfg vim /usr/local/zookeeper-cluster/zookeeper-2/conf/zoo.cfg vim /usr/local/zookeeper-cluster/zookeeper-3/conf/zoo.cfg server.1 = 192 .168.149.135:2881:3881 server.2 = 192 .168.149.135:2882:3882 server.3 = 192 .168.149.135:2883:3883 \u89e3\u91ca\uff1aserver.\u670d\u52a1\u5668ID=\u670d\u52a1\u5668IP\u5730\u5740\uff1a\u670d\u52a1\u5668\u4e4b\u95f4\u901a\u4fe1\u7aef\u53e3\uff1a\u670d\u52a1\u5668\u4e4b\u95f4\u6295\u7968\u9009\u4e3e\u7aef\u53e3 5.5)\u542f\u52a8\u96c6\u7fa4 \u00b6 \u542f\u52a8\u96c6\u7fa4\u5c31\u662f\u5206\u522b\u542f\u52a8\u6bcf\u4e2a\u5b9e\u4f8b\u3002 /usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh start /usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh start /usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh start \u542f\u52a8\u540e\u6211\u4eec\u67e5\u8be2\u4e00\u4e0b\u6bcf\u4e2a\u5b9e\u4f8b\u7684\u8fd0\u884c\u72b6\u6001 /usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh status /usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status /usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh status \u5148\u67e5\u8be2\u7b2c\u4e00\u4e2a\u670d\u52a1 Mode\u4e3afollower\u8868\u793a\u662f \u8ddf\u968f\u8005 \uff08\u4ece\uff09 \u518d\u67e5\u8be2\u7b2c\u4e8c\u4e2a\u670d\u52a1Mod \u4e3aleader\u8868\u793a\u662f \u9886\u5bfc\u8005 \uff08\u4e3b\uff09 \u67e5\u8be2\u7b2c\u4e09\u4e2a\u4e3a\u8ddf\u968f\u8005\uff08\u4ece\uff09 5.6)\u6a21\u62df\u96c6\u7fa4\u5f02\u5e38 \u00b6 \uff081\uff09\u9996\u5148\u6211\u4eec\u5148\u6d4b\u8bd5\u5982\u679c\u662f\u4ece\u670d\u52a1\u5668\u6302\u6389\uff0c\u4f1a\u600e\u4e48\u6837 \u628a3\u53f7\u670d\u52a1\u5668\u505c\u6389\uff0c\u89c2\u5bdf1\u53f7\u548c2\u53f7\uff0c\u53d1\u73b0\u72b6\u6001\u5e76\u6ca1\u6709\u53d8\u5316 /usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh stop /usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh status /usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status \u7531\u6b64\u5f97\u51fa\u7ed3\u8bba\uff0c3\u4e2a\u8282\u70b9\u7684\u96c6\u7fa4\uff0c\u4ece\u670d\u52a1\u5668\u6302\u6389\uff0c\u96c6\u7fa4\u6b63\u5e38 \uff082\uff09\u6211\u4eec\u518d\u628a1\u53f7\u670d\u52a1\u5668\uff08\u4ece\u670d\u52a1\u5668\uff09\u4e5f\u505c\u6389\uff0c\u67e5\u770b2\u53f7\uff08\u4e3b\u670d\u52a1\u5668\uff09\u7684\u72b6\u6001\uff0c\u53d1\u73b0\u5df2\u7ecf\u505c\u6b62\u8fd0\u884c\u4e86\u3002 /usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh stop /usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status \u7531\u6b64\u5f97\u51fa\u7ed3\u8bba\uff0c3\u4e2a\u8282\u70b9\u7684\u96c6\u7fa4\uff0c2\u4e2a\u4ece\u670d\u52a1\u5668\u90fd\u6302\u6389\uff0c\u4e3b\u670d\u52a1\u5668\u4e5f\u65e0\u6cd5\u8fd0\u884c\u3002\u56e0\u4e3a\u53ef\u8fd0\u884c\u7684\u673a\u5668\u6ca1\u6709\u8d85\u8fc7\u96c6\u7fa4\u603b\u6570\u91cf\u7684\u534a\u6570\u3002 \uff083\uff09\u6211\u4eec\u518d\u6b21\u628a1\u53f7\u670d\u52a1\u5668\u542f\u52a8\u8d77\u6765\uff0c\u53d1\u73b02\u53f7\u670d\u52a1\u5668\u53c8\u5f00\u59cb\u6b63\u5e38\u5de5\u4f5c\u4e86\u3002\u800c\u4e14\u4f9d\u7136\u662f\u9886\u5bfc\u8005\u3002 /usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh start /usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status \uff084\uff09\u6211\u4eec\u628a3\u53f7\u670d\u52a1\u5668\u4e5f\u542f\u52a8\u8d77\u6765\uff0c\u628a2\u53f7\u670d\u52a1\u5668\u505c\u6389,\u505c\u6389\u540e\u89c2\u5bdf1\u53f7\u548c3\u53f7\u7684\u72b6\u6001\u3002 /usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh start /usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh stop /usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh status /usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh status \u53d1\u73b0\u65b0\u7684leader\u4ea7\u751f\u4e86~ \u7531\u6b64\u6211\u4eec\u5f97\u51fa\u7ed3\u8bba\uff0c\u5f53\u96c6\u7fa4\u4e2d\u7684\u4e3b\u670d\u52a1\u5668\u6302\u4e86\uff0c\u96c6\u7fa4\u4e2d\u7684\u5176\u4ed6\u670d\u52a1\u5668\u4f1a\u81ea\u52a8\u8fdb\u884c\u9009\u4e3e\u72b6\u6001\uff0c\u7136\u540e\u4ea7\u751f\u65b0\u5f97leader \uff085\uff09\u6211\u4eec\u518d\u6b21\u6d4b\u8bd5\uff0c\u5f53\u6211\u4eec\u628a2\u53f7\u670d\u52a1\u5668\u91cd\u65b0\u542f\u52a8\u8d77\u6765\u542f\u52a8\u540e\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f2\u53f7\u670d\u52a1\u5668\u4f1a\u518d\u6b21\u6210\u4e3a\u65b0\u7684\u9886\u5bfc\u5417\uff1f\u6211\u4eec\u770b\u7ed3\u679c /usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh start /usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status /usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh status \u6211\u4eec\u4f1a\u53d1\u73b0\uff0c2\u53f7\u670d\u52a1\u5668\u542f\u52a8\u540e\u4f9d\u7136\u662f\u8ddf\u968f\u8005\uff08\u4ece\u670d\u52a1\u5668\uff09\uff0c3\u53f7\u670d\u52a1\u5668\u4f9d\u7136\u662f\u9886\u5bfc\u8005\uff08\u4e3b\u670d\u52a1\u5668\uff09\uff0c\u6ca1\u6709\u64bc\u52a83\u53f7\u670d\u52a1\u5668\u7684\u9886\u5bfc\u5730\u4f4d\u3002 \u7531\u6b64\u6211\u4eec\u5f97\u51fa\u7ed3\u8bba\uff0c\u5f53\u9886\u5bfc\u8005\u4ea7\u751f\u540e\uff0c\u518d\u6b21\u6709\u65b0\u670d\u52a1\u5668\u52a0\u5165\u96c6\u7fa4\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5230\u73b0\u4efb\u9886\u5bfc\u8005\u3002 6)Zookeeper \u6838\u5fc3\u7406\u8bba \u00b6 Zookeepe\u96c6\u7fa4\u89d2\u8272 \u5728ZooKeeper\u96c6\u7fa4\u670d\u4e2d\u52a1\u4e2d\u6709\u4e09\u4e2a\u89d2\u8272\uff1a \u2022Leader \u9886\u5bfc\u8005 \uff1a \u200b 1. \u5904\u7406\u4e8b\u52a1\u8bf7\u6c42 \u200b 2. \u96c6\u7fa4\u5185\u90e8\u5404\u670d\u52a1\u5668\u7684\u8c03\u5ea6\u8005 \u2022Follower \u8ddf\u968f\u8005 \uff1a \u200b 1. \u5904\u7406\u5ba2\u6237\u7aef\u975e\u4e8b\u52a1\u8bf7\u6c42\uff0c\u8f6c\u53d1\u4e8b\u52a1\u8bf7\u6c42\u7ed9Leader\u670d\u52a1\u5668 \u200b 2. \u53c2\u4e0eLeader\u9009\u4e3e\u6295\u7968 \u2022Observer \u89c2\u5bdf\u8005\uff1a 1. \u5904\u7406\u5ba2\u6237\u7aef\u975e\u4e8b\u52a1\u8bf7\u6c42 \uff0c \u8f6c\u53d1\u4e8b\u52a1\u8bf7\u6c42\u7ed9Leader\u670d\u52a1\u5668","title":"\u9879\u76ee\u4e00\u524d\u7f6e\u8bfe-Zookeeper"},{"location":"zookeeper/zk/#zookeeper","text":"","title":"Zookeeper"},{"location":"zookeeper/zk/#1_zookeeper","text":"","title":"1)\u521d\u8bc6 Zookeeper"},{"location":"zookeeper/zk/#11zookeeper","text":"\u2022Zookeeper \u662f Apache Hadoop \u9879\u76ee\u4e0b\u7684\u4e00\u4e2a\u5b50\u9879\u76ee\uff0c\u662f\u4e00\u4e2a\u6811\u5f62\u76ee\u5f55\u670d\u52a1\u3002 \u2022Zookeeper \u7ffb\u8bd1\u8fc7\u6765\u5c31\u662f \u52a8\u7269\u56ed\u7ba1\u7406\u5458\uff0c\u4ed6\u662f\u7528\u6765\u7ba1 Hadoop\uff08\u5927\u8c61\uff09\u3001Hive(\u871c\u8702)\u3001Pig(\u5c0f \u732a)\u7684\u7ba1\u7406\u5458\u3002\u7b80\u79f0zk \u2022Zookeeper \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7684\u3001\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u5e94\u7528\u7a0b\u5e8f\u7684\u534f\u8c03\u670d\u52a1\u3002 \u2022Zookeeper \u63d0\u4f9b\u7684\u4e3b\u8981\u529f\u80fd\u5305\u62ec\uff1a \u2022\u914d\u7f6e\u7ba1\u7406 \u2022\u5206\u5e03\u5f0f\u9501 \u2022\u96c6\u7fa4\u7ba1\u7406","title":"1.1)Zookeeper\u6982\u5ff5"},{"location":"zookeeper/zk/#2zookeeper","text":"","title":"2)ZooKeeper \u5b89\u88c5\u4e0e\u914d\u7f6e"},{"location":"zookeeper/zk/#21","text":"","title":"2.1) \u4e0b\u8f7d\u5b89\u88c5"},{"location":"zookeeper/zk/#211","text":"ZooKeeper\u670d\u52a1\u5668\u662f\u7528Java\u521b\u5efa\u7684\uff0c\u5b83\u8fd0\u884c\u5728JVM\u4e4b\u4e0a\u3002\u9700\u8981\u5b89\u88c5JDK 7\u6216\u66f4\u9ad8\u7248\u672c\u3002","title":"2.1.1\u3001\u73af\u5883\u51c6\u5907"},{"location":"zookeeper/zk/#212","text":"\u5c06\u4e0b\u8f7d\u7684ZooKeeper\u653e\u5230/opt/ZooKeeper\u76ee\u5f55\u4e0b #\u4e0a\u4f20zookeeper alt+p put f:/setup/apache-zookeeper-3.5.6-bin.tar.gz #\u6253\u5f00 opt\u76ee\u5f55 cd /opt #\u521b\u5efazooKeeper\u76ee\u5f55 mkdir zooKeeper #\u5c06zookeeper\u5b89\u88c5\u5305\u79fb\u52a8\u5230 /opt/zooKeeper mv apache-zookeeper-3.5.6-bin.tar.gz /opt/zookeeper/","title":"2.1.2\u3001\u4e0a\u4f20"},{"location":"zookeeper/zk/#213","text":"\u5c06tar\u5305\u89e3\u538b\u5230/opt/zookeeper\u76ee\u5f55\u4e0b tar -zxvf apache-ZooKeeper-3.5.6-bin.tar.gz","title":"2.1.3\u3001\u89e3\u538b"},{"location":"zookeeper/zk/#22","text":"","title":"2.2) \u914d\u7f6e\u542f\u52a8"},{"location":"zookeeper/zk/#221zoocfg","text":"\u8fdb\u5165\u5230conf\u76ee\u5f55\u62f7\u8d1d\u4e00\u4e2azoo_sample.cfg\u5e76\u5b8c\u6210\u914d\u7f6e #\u8fdb\u5165\u5230conf\u76ee\u5f55 cd /opt/zooKeeper/apache-zooKeeper-3.5.6-bin/conf/ #\u62f7\u8d1d cp zoo_sample.cfg zoo.cfg \u4fee\u6539zoo.cfg #\u6253\u5f00\u76ee\u5f55 cd /opt/zooKeeper/ #\u521b\u5efazooKeeper\u5b58\u50a8\u76ee\u5f55 mkdir zkdata #\u4fee\u6539zoo.cfg vim /opt/zooKeeper/apache-zooKeeper-3.5.6-bin/conf/zoo.cfg \u4fee\u6539\u5b58\u50a8\u76ee\u5f55\uff1adataDir=/opt/zookeeper/zkdata","title":"2.2.1\u3001\u914d\u7f6ezoo.cfg"},{"location":"zookeeper/zk/#222zookeeper","text":"cd /opt/zooKeeper/apache-zooKeeper-3.5.6-bin/bin/ #\u542f\u52a8 ./zkServer.sh start \u770b\u5230\u4e0a\u56fe\u8868\u793aZooKeeper\u6210\u529f\u542f\u52a8 3\u3001\u67e5\u770bZooKeeper\u72b6\u6001 ./zkServer.sh status zookeeper\u542f\u52a8\u6210\u529f\u3002standalone\u4ee3\u8868zk\u6ca1\u6709\u642d\u5efa\u96c6\u7fa4\uff0c\u73b0\u5728\u662f\u5355\u8282\u70b9 zookeeper\u6ca1\u6709\u542f\u52a8","title":"2.2.2\u3001\u542f\u52a8ZooKeeper"},{"location":"zookeeper/zk/#_1","text":"","title":""},{"location":"zookeeper/zk/#3zookeeper","text":"","title":"3)ZooKeeper \u547d\u4ee4\u64cd\u4f5c"},{"location":"zookeeper/zk/#31zookeeper","text":"\u2022ZooKeeper \u662f\u4e00\u4e2a\u6811\u5f62\u76ee\u5f55\u670d\u52a1,\u5176\u6570\u636e\u6a21\u578b\u548cUnix\u7684\u6587\u4ef6\u7cfb\u7edf\u76ee\u5f55\u6811\u5f88\u7c7b\u4f3c\uff0c\u62e5\u6709\u4e00\u4e2a\u5c42\u6b21\u5316\u7ed3\u6784\u3002 \u2022\u8fd9\u91cc\u9762\u7684\u6bcf\u4e00\u4e2a\u8282\u70b9\u90fd\u88ab\u79f0\u4e3a\uff1a ZNode\uff0c\u6bcf\u4e2a\u8282\u70b9\u4e0a\u90fd\u4f1a\u4fdd\u5b58\u81ea\u5df1\u7684\u6570\u636e\u548c\u8282\u70b9\u4fe1\u606f\u3002 \u2022 \u8282\u70b9\u53ef\u4ee5\u62e5\u6709\u5b50\u8282\u70b9\uff0c\u540c\u65f6\u4e5f\u5141\u8bb8\u5c11\u91cf\uff081MB\uff09\u6570\u636e\u5b58\u50a8\u5728\u8be5\u8282\u70b9\u4e4b\u4e0b\u3002 \u2022\u8282\u70b9\u53ef\u4ee5\u5206\u4e3a\u56db\u5927\u7c7b\uff1a \u2022PERSISTENT \u6301\u4e45\u5316\u8282\u70b9 \u2022EPHEMERAL \u4e34\u65f6\u8282\u70b9 \uff1a-e \u2022PERSISTENT_SEQUENTIAL \u6301\u4e45\u5316\u987a\u5e8f\u8282\u70b9 \uff1a-s \u2022EPHEMERAL_SEQUENTIAL \u4e34\u65f6\u987a\u5e8f\u8282\u70b9 \uff1a-es","title":"3.1)Zookeeper\u547d\u4ee4\u64cd\u4f5c\u6570\u636e\u6a21\u578b"},{"location":"zookeeper/zk/#32zookeeper","text":"\u2022\u542f\u52a8 ZooKeeper \u670d\u52a1: ./zkServer.sh start \u2022\u67e5\u770b ZooKeeper \u670d\u52a1\u72b6\u6001: ./zkServer.sh status \u2022\u505c\u6b62 ZooKeeper \u670d\u52a1: ./zkServer.sh stop \u2022\u91cd\u542f ZooKeeper \u670d\u52a1: ./zkServer.sh restart","title":"3.2)Zookeeper\u547d\u4ee4\u64cd\u4f5c\u670d\u52a1\u7aef\u547d\u4ee4"},{"location":"zookeeper/zk/#33zookeeper","text":"\u8fde\u63a5ZooKeeper\u670d\u52a1\u7aef ./zkCli.sh \u2013server ip:port \u65ad\u5f00\u8fde\u63a5 quit \u67e5\u770b\u547d\u4ee4\u5e2e\u52a9 help \u663e\u793a\u6307\u5b9a\u76ee\u5f55\u4e0b\u8282\u70b9 ls \u76ee\u5f55 \u521b\u5efa\u8282\u70b9 create /\u8282\u70b9path value \u83b7\u53d6\u8282\u70b9\u503c get /\u8282\u70b9path \u8bbe\u7f6e\u8282\u70b9\u503c set /\u8282\u70b9path value \u5220\u9664\u5355\u4e2a\u8282\u70b9 delete /\u8282\u70b9path \u5220\u9664\u5e26\u6709\u5b50\u8282\u70b9\u7684\u8282\u70b9 deleteall /\u8282\u70b9path","title":"3.3)Zookeeper\u5ba2\u6237\u7aef\u5e38\u7528\u547d\u4ee4"},{"location":"zookeeper/zk/#34-","text":"\u2022\u521b\u5efa\u4e34\u65f6\u8282\u70b9 create -e /\u8282\u70b9path value \u2022\u521b\u5efa\u987a\u5e8f\u8282\u70b9 create -s /\u8282\u70b9path value \u2022\u67e5\u8be2\u8282\u70b9\u8be6\u7ec6\u4fe1\u606f ls \u2013s /\u8282\u70b9path \u2022czxid\uff1a\u8282\u70b9\u88ab\u521b\u5efa\u7684\u4e8b\u52a1ID \u2022ctime: \u521b\u5efa\u65f6\u95f4 \u2022mzxid: \u6700\u540e\u4e00\u6b21\u88ab\u66f4\u65b0\u7684\u4e8b\u52a1ID \u2022mtime: \u4fee\u6539\u65f6\u95f4 \u2022pzxid\uff1a\u5b50\u8282\u70b9\u5217\u8868\u6700\u540e\u4e00\u6b21\u88ab\u66f4\u65b0\u7684\u4e8b\u52a1ID \u2022cversion\uff1a\u5b50\u8282\u70b9\u7684\u7248\u672c\u53f7 \u2022dataversion\uff1a\u6570\u636e\u7248\u672c\u53f7 \u2022aclversion\uff1a\u6743\u9650\u7248\u672c\u53f7 \u2022ephemeralOwner\uff1a\u7528\u4e8e\u4e34\u65f6\u8282\u70b9\uff0c\u4ee3\u8868\u4e34\u65f6\u8282\u70b9\u7684\u4e8b\u52a1ID\uff0c\u5982\u679c\u4e3a\u6301\u4e45\u8282\u70b9\u5219\u4e3a0 \u2022dataLength\uff1a\u8282\u70b9\u5b58\u50a8\u7684\u6570\u636e\u7684\u957f\u5ea6 \u2022numChildren\uff1a\u5f53\u524d\u8282\u70b9\u7684\u5b50\u8282\u70b9\u4e2a\u6570","title":"3.4)\u5ba2\u6237\u7aef\u547d\u4ee4-\u521b\u5efa\u4e34\u65f6\u6709\u5e8f\u8282\u70b9"},{"location":"zookeeper/zk/#4zookeeper_javaapi","text":"","title":"4)ZooKeeper JavaAPI \u64cd\u4f5c"},{"location":"zookeeper/zk/#41urator","text":"\u2022Curator \u662f Apache ZooKeeper \u7684Java\u5ba2\u6237\u7aef\u5e93\u3002 \u2022\u5e38\u89c1\u7684ZooKeeper Java API \uff1a \u2022\u539f\u751fJava API \u2022ZkClient \u2022Curator \u2022Curator \u9879\u76ee\u7684\u76ee\u6807\u662f\u7b80\u5316 ZooKeeper \u5ba2\u6237\u7aef\u7684\u4f7f\u7528\u3002 \u2022Curator \u6700\u521d\u662f Netfix \u7814\u53d1\u7684,\u540e\u6765\u6350\u732e\u4e86 Apache \u57fa\u91d1\u4f1a,\u76ee\u524d\u662f Apache \u7684\u9876\u7ea7\u9879\u76ee\u3002 \u2022\u5b98\u7f51\uff1ahttp://curator.apache.org/","title":"4.1)urator\u4ecb\u7ecd"},{"location":"zookeeper/zk/#42javaapi","text":"1\uff0c\u642d\u5efa\u9879\u76ee \u521b\u5efa\u9879\u76eecurator-zk \u5f15\u5165pom\u548c\u65e5\u5fd7\u6587\u4ef6 \u8d44\u6599\u6587\u4ef6\u5939\u4e0bpom.xml\u548clog4j.properties 2\u3001\u521b\u5efa\u6d4b\u8bd5\u7c7b\uff0c\u4f7f\u7528curator\u8fde\u63a5zookeeper @Before public void testConnect () { //\u91cd\u8bd5\u7b56\u7565 RetryPolicy retryPolicy = new ExponentialBackoffRetry ( 3000 , 10 ); //2.\u7b2c\u4e8c\u79cd\u65b9\u5f0f //CuratorFrameworkFactory.builder(); client = CuratorFrameworkFactory . builder () . connectString ( \"192.168.200.130:2181\" ) . sessionTimeoutMs ( 60 * 1000 ) . connectionTimeoutMs ( 15 * 1000 ) . retryPolicy ( retryPolicy ) . namespace ( \"itheima\" ) . build (); //\u5f00\u542f\u8fde\u63a5 client . start (); }","title":"4.2)JavaAPI\u64cd\u4f5c\u5efa\u7acb\u8fde\u63a5"},{"location":"zookeeper/zk/#43zookeeper_javaapi-","text":"/** * \u521b\u5efa\u8282\u70b9\uff1acreate \u6301\u4e45 \u4e34\u65f6 \u987a\u5e8f \u6570\u636e * 1. \u57fa\u672c\u521b\u5efa \uff1acreate().forPath(\"\") * 2. \u521b\u5efa\u8282\u70b9 \u5e26\u6709\u6570\u636e:create().forPath(\"\",data) * 3. \u8bbe\u7f6e\u8282\u70b9\u7684\u7c7b\u578b\uff1acreate().withMode().forPath(\"\",data) * 4. \u521b\u5efa\u591a\u7ea7\u8282\u70b9 /app1/p1 \uff1acreate().creatingParentsIfNeeded().forPath(\"\",data) */ @Test public void testCreate () throws Exception { //2. \u521b\u5efa\u8282\u70b9 \u5e26\u6709\u6570\u636e //\u5982\u679c\u521b\u5efa\u8282\u70b9\uff0c\u6ca1\u6709\u6307\u5b9a\u6570\u636e\uff0c\u5219\u9ed8\u8ba4\u5c06\u5f53\u524d\u5ba2\u6237\u7aef\u7684ip\u4f5c\u4e3a\u6570\u636e\u5b58\u50a8 String path = client . create (). forPath ( \"/app2\" , \"hehe\" . getBytes ()); System . out . println ( path ); } @Test public void testCreate2 () throws Exception { //1. \u57fa\u672c\u521b\u5efa //\u5982\u679c\u521b\u5efa\u8282\u70b9\uff0c\u6ca1\u6709\u6307\u5b9a\u6570\u636e\uff0c\u5219\u9ed8\u8ba4\u5c06\u5f53\u524d\u5ba2\u6237\u7aef\u7684ip\u4f5c\u4e3a\u6570\u636e\u5b58\u50a8 String path = client . create (). forPath ( \"/app1\" ); System . out . println ( path ); } @Test public void testCreate3 () throws Exception { //3. \u8bbe\u7f6e\u8282\u70b9\u7684\u7c7b\u578b //\u9ed8\u8ba4\u7c7b\u578b\uff1a\u6301\u4e45\u5316 String path = client . create (). withMode ( CreateMode . EPHEMERAL ). forPath ( \"/app3\" ); System . out . println ( path ); } @Test public void testCreate4 () throws Exception { //4. \u521b\u5efa\u591a\u7ea7\u8282\u70b9 /app1/p1 //creatingParentsIfNeeded():\u5982\u679c\u7236\u8282\u70b9\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\u7236\u8282\u70b9 String path = client . create (). creatingParentsIfNeeded (). forPath ( \"/app4/p1\" ); System . out . println ( path ); }","title":"4.3)Zookeeper JavaAPI\u64cd\u4f5c-\u521b\u5efa\u8282\u70b9"},{"location":"zookeeper/zk/#44zookeeperjavaapi-","text":"/** * \u67e5\u8be2\u8282\u70b9\uff1a * 1. \u67e5\u8be2\u6570\u636e\uff1aget: getData().forPath() * 2. \u67e5\u8be2\u5b50\u8282\u70b9\uff1a ls: getChildren().forPath() * 3. \u67e5\u8be2\u8282\u70b9\u72b6\u6001\u4fe1\u606f\uff1als -s:getData().storingStatIn(\u72b6\u6001\u5bf9\u8c61).forPath() */ @Test public void testGet1 () throws Exception { //1. \u67e5\u8be2\u6570\u636e\uff1aget byte [] data = client . getData (). forPath ( \"/app1\" ); System . out . println ( new String ( data )); } @Test public void testGet2 () throws Exception { // 2. \u67e5\u8be2\u5b50\u8282\u70b9\uff1a ls List < String > path = client . getChildren (). forPath ( \"/\" ); System . out . println ( path ); } @Test public void testGet3 () throws Exception { Stat status = new Stat (); System . out . println ( status ); //3. \u67e5\u8be2\u8282\u70b9\u72b6\u6001\u4fe1\u606f\uff1als -s client . getData (). storingStatIn ( status ). forPath ( \"/app1\" ); System . out . println ( status ); }","title":"4.4)ZookeeperJavaAPI\u64cd\u4f5c-\u67e5\u8be2\u8282\u70b9"},{"location":"zookeeper/zk/#45zookeeper_javaapi-","text":"/** * \u4fee\u6539\u6570\u636e * 1. \u57fa\u672c\u4fee\u6539\u6570\u636e\uff1asetData().forPath() * 2. \u6839\u636e\u7248\u672c\u4fee\u6539: setData().withVersion().forPath() * * version \u662f\u901a\u8fc7\u67e5\u8be2\u51fa\u6765\u7684\u3002\u76ee\u7684\u5c31\u662f\u4e3a\u4e86\u8ba9\u5176\u4ed6\u5ba2\u6237\u7aef\u6216\u8005\u7ebf\u7a0b\u4e0d\u5e72\u6270\u6211\u3002 * * @throws Exception */ @Test public void testSet () throws Exception { client . setData (). forPath ( \"/app1\" , \"itcast\" . getBytes ()); } @Test public void testSetForVersion () throws Exception { Stat status = new Stat (); //3. \u67e5\u8be2\u8282\u70b9\u72b6\u6001\u4fe1\u606f\uff1als -s client . getData (). storingStatIn ( status ). forPath ( \"/app1\" ); int version = status . getVersion (); //\u67e5\u8be2\u51fa\u6765\u7684 3 System . out . println ( version ); client . setData (). withVersion ( version ). forPath ( \"/app1\" , \"hehe\" . getBytes ()); }","title":"4.5)Zookeeper JavaAPI\u64cd\u4f5c-\u4fee\u6539\u8282\u70b9"},{"location":"zookeeper/zk/#46zookeeper_javaapi-","text":"/** * \u5220\u9664\u8282\u70b9\uff1a delete deleteall * 1. \u5220\u9664\u5355\u4e2a\u8282\u70b9:delete().forPath(\"/app1\"); * 2. \u5220\u9664\u5e26\u6709\u5b50\u8282\u70b9\u7684\u8282\u70b9:delete().deletingChildrenIfNeeded().forPath(\"/app1\"); * 3. \u5fc5\u987b\u6210\u529f\u7684\u5220\u9664:\u4e3a\u4e86\u9632\u6b62\u7f51\u7edc\u6296\u52a8\u3002\u672c\u8d28\u5c31\u662f\u91cd\u8bd5\u3002 client.delete().guaranteed().forPath(\"/app2\"); * 4. \u56de\u8c03\uff1ainBackground * @throws Exception */ @Test public void testDelete () throws Exception { // 1. \u5220\u9664\u5355\u4e2a\u8282\u70b9 client . delete (). forPath ( \"/app1\" ); } @Test public void testDelete2 () throws Exception { //2. \u5220\u9664\u5e26\u6709\u5b50\u8282\u70b9\u7684\u8282\u70b9 client . delete (). deletingChildrenIfNeeded (). forPath ( \"/app4\" ); } @Test public void testDelete3 () throws Exception { //3. \u5fc5\u987b\u6210\u529f\u7684\u5220\u9664 client . delete (). guaranteed (). forPath ( \"/app2\" ); } @Test public void testDelete4 () throws Exception { //4. \u56de\u8c03 client . delete (). guaranteed (). inBackground ( new BackgroundCallback (){ @Override public void processResult ( CuratorFramework client , CuratorEvent event ) throws Exception { System . out . println ( \"\u6211\u88ab\u5220\u9664\u4e86~\" ); System . out . println ( event ); } }). forPath ( \"/app1\" ); }","title":"4.6)Zookeeper JavaAPI\u64cd\u4f5c-\u5220\u9664\u8282\u70b9"},{"location":"zookeeper/zk/#47zookeeper_javaapi-watch","text":"\u2022ZooKeeper \u5141\u8bb8\u7528\u6237\u5728\u6307\u5b9a\u8282\u70b9\u4e0a\u6ce8\u518c\u4e00\u4e9bWatcher\uff0c\u5e76\u4e14\u5728\u4e00\u4e9b\u7279\u5b9a\u4e8b\u4ef6\u89e6\u53d1\u7684\u65f6\u5019\uff0cZooKeeper \u670d\u52a1\u7aef\u4f1a\u5c06\u4e8b\u4ef6\u901a\u77e5\u5230\u611f\u5174\u8da3\u7684\u5ba2\u6237\u7aef\u4e0a\u53bb\uff0c\u8be5\u673a\u5236\u662f ZooKeeper \u5b9e\u73b0\u5206\u5e03\u5f0f\u534f\u8c03\u670d\u52a1\u7684\u91cd\u8981\u7279\u6027\u3002 \u2022ZooKeeper \u4e2d\u5f15\u5165\u4e86Watcher\u673a\u5236\u6765\u5b9e\u73b0\u4e86\u53d1\u5e03/\u8ba2\u9605\u529f\u80fd\u80fd\uff0c\u80fd\u591f\u8ba9\u591a\u4e2a\u8ba2\u9605\u8005\u540c\u65f6\u76d1\u542c\u67d0\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5f53\u4e00\u4e2a\u5bf9\u8c61\u81ea\u8eab\u72b6\u6001\u53d8\u5316\u65f6\uff0c\u4f1a\u901a\u77e5\u6240\u6709\u8ba2\u9605\u8005\u3002 \u2022ZooKeeper \u539f\u751f\u652f\u6301\u901a\u8fc7\u6ce8\u518cWatcher\u6765\u8fdb\u884c\u4e8b\u4ef6\u76d1\u542c\uff0c\u4f46\u662f\u5176\u4f7f\u7528\u5e76\u4e0d\u662f\u7279\u522b\u65b9\u4fbf \u200b \u9700\u8981\u5f00\u53d1\u4eba\u5458\u81ea\u5df1\u53cd\u590d\u6ce8\u518cWatcher\uff0c\u6bd4\u8f83\u7e41\u7410\u3002 \u2022Curator\u5f15\u5165\u4e86 Cache \u6765\u5b9e\u73b0\u5bf9 ZooKeeper \u670d\u52a1\u7aef\u4e8b\u4ef6\u7684\u76d1\u542c\u3002 \u2022ZooKeeper\u63d0\u4f9b\u4e86\u4e09\u79cdWatcher\uff1a \u2022NodeCache : \u53ea\u662f\u76d1\u542c\u67d0\u4e00\u4e2a\u7279\u5b9a\u7684\u8282\u70b9 \u2022PathChildrenCache : \u76d1\u63a7\u4e00\u4e2aZNode\u7684\u5b50\u8282\u70b9. \u2022TreeCache : \u53ef\u4ee5\u76d1\u63a7\u6574\u4e2a\u6811\u4e0a\u7684\u6240\u6709\u8282\u70b9\uff0c\u7c7b\u4f3c\u4e8ePathChildrenCache\u548cNodeCache\u7684\u7ec4\u5408","title":"4.7)Zookeeper JavaAPI\u64cd\u4f5c-Watch\u76d1\u542c\u6982\u8ff0"},{"location":"zookeeper/zk/#48zookeeper_javaapi-watch-nodecache","text":"/** * \u6f14\u793a NodeCache\uff1a\u7ed9\u6307\u5b9a\u4e00\u4e2a\u8282\u70b9\u6ce8\u518c\u76d1\u542c\u5668 */ @Test public void testNodeCache () throws Exception { //1. \u521b\u5efaNodeCache\u5bf9\u8c61 final NodeCache nodeCache = new NodeCache ( client , \"/app1\" ); //2. \u6ce8\u518c\u76d1\u542c nodeCache . getListenable (). addListener ( new NodeCacheListener () { @Override public void nodeChanged () throws Exception { System . out . println ( \"\u8282\u70b9\u53d8\u5316\u4e86~\" ); //\u83b7\u53d6\u4fee\u6539\u8282\u70b9\u540e\u7684\u6570\u636e byte [] data = nodeCache . getCurrentData (). getData (); System . out . println ( new String ( data )); } }); //3. \u5f00\u542f\u76d1\u542c.\u5982\u679c\u8bbe\u7f6e\u4e3atrue\uff0c\u5219\u5f00\u542f\u76d1\u542c\u662f\uff0c\u52a0\u8f7d\u7f13\u51b2\u6570\u636e nodeCache . start ( true ); while ( true ){ } }","title":"4.8Zookeeper JavaAPI\u64cd\u4f5c-Watch\u76d1\u542c-NodeCache"},{"location":"zookeeper/zk/#49zookeeper_javaapi-watch-pathchildrencache","text":"@Test public void testPathChildrenCache () throws Exception { //1.\u521b\u5efa\u76d1\u542c\u5bf9\u8c61 PathChildrenCache pathChildrenCache = new PathChildrenCache ( client , \"/app2\" , true ); //2. \u7ed1\u5b9a\u76d1\u542c\u5668 pathChildrenCache . getListenable (). addListener ( new PathChildrenCacheListener () { @Override public void childEvent ( CuratorFramework client , PathChildrenCacheEvent event ) throws Exception { System . out . println ( \"\u5b50\u8282\u70b9\u53d8\u5316\u4e86~\" ); System . out . println ( event ); //\u76d1\u542c\u5b50\u8282\u70b9\u7684\u6570\u636e\u53d8\u66f4\uff0c\u5e76\u4e14\u62ff\u5230\u53d8\u66f4\u540e\u7684\u6570\u636e //1.\u83b7\u53d6\u7c7b\u578b PathChildrenCacheEvent . Type type = event . getType (); //2.\u5224\u65ad\u7c7b\u578b\u662f\u5426\u662fupdate if ( type . equals ( PathChildrenCacheEvent . Type . CHILD_UPDATED )){ System . out . println ( \"\u6570\u636e\u53d8\u4e86\uff01\uff01\uff01\" ); byte [] data = event . getData (). getData (); System . out . println ( new String ( data )); } } }); //3. \u5f00\u542f pathChildrenCache . start (); while ( true ){ } }","title":"4.9)Zookeeper JavaAPI\u64cd\u4f5c-Watch\u76d1\u542c-PathChildrenCache"},{"location":"zookeeper/zk/#410zookeeper_javaapi-watch-treecache","text":"/** * \u6f14\u793a TreeCache\uff1a\u76d1\u542c\u67d0\u4e2a\u8282\u70b9\u81ea\u5df1\u548c\u6240\u6709\u5b50\u8282\u70b9\u4eec */ @Test public void testTreeCache () throws Exception { //1. \u521b\u5efa\u76d1\u542c\u5668 TreeCache treeCache = new TreeCache ( client , \"/app2\" ); //2. \u6ce8\u518c\u76d1\u542c treeCache . getListenable (). addListener ( new TreeCacheListener () { @Override public void childEvent ( CuratorFramework client , TreeCacheEvent event ) throws Exception { System . out . println ( \"\u8282\u70b9\u53d8\u5316\u4e86\" ); System . out . println ( event ); } }); //3. \u5f00\u542f treeCache . start (); while ( true ){ } }","title":"4.10)Zookeeper JavaAPI\u64cd\u4f5c-Watch\u76d1\u542c-TreeCache"},{"location":"zookeeper/zk/#411zookeeper-","text":"\u2022\u5728\u6211\u4eec\u8fdb\u884c\u5355\u673a\u5e94\u7528\u5f00\u53d1\uff0c\u6d89\u53ca\u5e76\u53d1\u540c\u6b65\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5f80\u5f80\u91c7\u7528synchronized\u6216\u8005Lock\u7684\u65b9\u5f0f\u6765\u89e3\u51b3\u591a\u7ebf\u7a0b\u95f4\u7684\u4ee3\u7801\u540c\u6b65\u95ee\u9898\uff0c\u8fd9\u65f6\u591a\u7ebf\u7a0b\u7684\u8fd0\u884c\u90fd\u662f\u5728\u540c\u4e00\u4e2aJVM\u4e4b\u4e0b\uff0c\u6ca1\u6709\u4efb\u4f55\u95ee\u9898\u3002 \u2022\u4f46\u5f53\u6211\u4eec\u7684\u5e94\u7528\u662f\u5206\u5e03\u5f0f\u96c6\u7fa4\u5de5\u4f5c\u7684\u60c5\u51b5\u4e0b\uff0c\u5c5e\u4e8e\u591aJVM\u4e0b\u7684\u5de5\u4f5c\u73af\u5883\uff0c\u8de8JVM\u4e4b\u95f4\u5df2\u7ecf\u65e0\u6cd5\u901a\u8fc7\u591a\u7ebf\u7a0b\u7684\u9501\u89e3\u51b3\u540c\u6b65\u95ee\u9898\u3002 \u2022\u90a3\u4e48\u5c31\u9700\u8981\u4e00\u79cd\u66f4\u52a0\u9ad8\u7ea7\u7684\u9501\u673a\u5236\uff0c\u6765\u5904\u7406\u79cd\u8de8\u673a\u5668\u7684\u8fdb\u7a0b\u4e4b\u95f4\u7684\u6570\u636e\u540c\u6b65\u95ee\u9898\u2014\u2014\u8fd9\u5c31\u662f\u5206\u5e03\u5f0f\u9501\u3002","title":"4.11)Zookeeper\u5206\u5e03\u5f0f\u9501-\u6982\u5ff5"},{"location":"zookeeper/zk/#412zookeeper_-zookeeper","text":"\u2022\u6838\u5fc3\u601d\u60f3\uff1a\u5f53\u5ba2\u6237\u7aef\u8981\u83b7\u53d6\u9501\uff0c\u5219\u521b\u5efa\u8282\u70b9\uff0c\u4f7f\u7528\u5b8c\u9501\uff0c\u5219\u5220\u9664\u8be5\u8282\u70b9\u3002 1.\u5ba2\u6237\u7aef\u83b7\u53d6\u9501\u65f6\uff0c\u5728lock\u8282\u70b9\u4e0b\u521b\u5efa\u4e34\u65f6\u987a\u5e8f\u8282\u70b9\u3002 2.\u7136\u540e\u83b7\u53d6lock\u4e0b\u9762\u7684\u6240\u6709\u5b50\u8282\u70b9\uff0c\u5ba2\u6237\u7aef\u83b7\u53d6\u5230\u6240\u6709\u7684\u5b50\u8282\u70b9\u4e4b\u540e\uff0c\u5982\u679c\u53d1\u73b0\u81ea\u5df1\u521b\u5efa\u7684\u5b50\u8282\u70b9\u5e8f\u53f7\u6700\u5c0f\uff0c\u90a3\u4e48\u5c31\u8ba4\u4e3a\u8be5\u5ba2\u6237\u7aef\u83b7\u53d6\u5230\u4e86\u9501\u3002\u4f7f\u7528\u5b8c\u9501\u540e\uff0c\u5c06\u8be5\u8282\u70b9\u5220\u9664\u3002 3.\u5982\u679c\u53d1\u73b0\u81ea\u5df1\u521b\u5efa\u7684\u8282\u70b9\u5e76\u975elock\u6240\u6709\u5b50\u8282\u70b9\u4e2d\u6700\u5c0f\u7684\uff0c\u8bf4\u660e\u81ea\u5df1\u8fd8\u6ca1\u6709\u83b7\u53d6\u5230\u9501\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u9700\u8981\u627e\u5230\u6bd4\u81ea\u5df1\u5c0f\u7684\u90a3\u4e2a\u8282\u70b9\uff0c\u540c\u65f6\u5bf9\u5176\u6ce8\u518c\u4e8b\u4ef6\u76d1\u542c\u5668\uff0c\u76d1\u542c\u5220\u9664\u4e8b\u4ef6\u3002 4.\u5982\u679c\u53d1\u73b0\u6bd4\u81ea\u5df1\u5c0f\u7684\u90a3\u4e2a\u8282\u70b9\u88ab\u5220\u9664\uff0c\u5219\u5ba2\u6237\u7aef\u7684 \u200b Watcher\u4f1a\u6536\u5230\u76f8\u5e94\u901a\u77e5\uff0c\u6b64\u65f6\u518d\u6b21\u5224\u65ad\u81ea\u5df1\u521b\u5efa\u7684\u8282\u70b9 \u200b \u662f\u5426\u662flock\u5b50\u8282\u70b9\u4e2d\u5e8f\u53f7\u6700\u5c0f\u7684\uff0c\u5982\u679c\u662f\u5219\u83b7\u53d6\u5230\u4e86\u9501\uff0c \u200b \u5982\u679c\u4e0d\u662f\u5219\u91cd\u590d\u4ee5\u4e0a\u6b65\u9aa4\u7ee7\u7eed\u83b7\u53d6\u5230\u6bd4\u81ea\u5df1\u5c0f\u7684\u4e00\u4e2a\u8282\u70b9 \u200b \u5e76\u6ce8\u518c\u76d1\u542c\u3002","title":"4.12)Zookeeper \u5206\u5e03\u5f0f\u9501-zookeeper\u5206\u5e03\u5f0f\u9501\u539f\u7406"},{"location":"zookeeper/zk/#413zookeeper_-12306","text":"Curator\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501API \u5728Curator\u4e2d\u6709\u4e94\u79cd\u9501\u65b9\u6848\uff1a InterProcessSemaphoreMutex\uff1a\u5206\u5e03\u5f0f\u6392\u5b83\u9501\uff08\u975e\u53ef\u91cd\u5165\u9501\uff09 InterProcessMutex\uff1a\u5206\u5e03\u5f0f\u53ef\u91cd\u5165\u6392\u5b83\u9501 InterProcessReadWriteLock\uff1a\u5206\u5e03\u5f0f\u8bfb\u5199\u9501 InterProcessMultiLock\uff1a\u5c06\u591a\u4e2a\u9501\u4f5c\u4e3a\u5355\u4e2a\u5b9e\u4f53\u7ba1\u7406\u7684\u5bb9\u5668 InterProcessSemaphoreV2\uff1a\u5171\u4eab\u4fe1\u53f7\u91cf 1,\u521b\u5efa\u7ebf\u7a0b\u8fdb\u884c\u52a0\u9501\u8bbe\u7f6e public class Ticket12306 implements Runnable { private int tickets = 10 ; //\u6570\u636e\u5e93\u7684\u7968\u6570 private InterProcessMutex lock ; @Override public void run () { while ( true ){ //\u83b7\u53d6\u9501 try { lock . acquire ( 3 , TimeUnit . SECONDS ); if ( tickets > 0 ){ System . out . println ( Thread . currentThread () + \":\" + tickets ); Thread . sleep ( 100 ); tickets -- ; } } catch ( Exception e ) { e . printStackTrace (); } finally { //\u91ca\u653e\u9501 try { lock . release (); } catch ( Exception e ) { e . printStackTrace (); } } } } } 2,\u521b\u5efa\u8fde\u63a5\uff0c\u5e76\u4e14\u521d\u59cb\u5316\u9501 public Ticket12306 (){ //\u91cd\u8bd5\u7b56\u7565 RetryPolicy retryPolicy = new ExponentialBackoffRetry ( 3000 , 10 ); //2.\u7b2c\u4e8c\u79cd\u65b9\u5f0f //CuratorFrameworkFactory.builder(); CuratorFramework client = CuratorFrameworkFactory . builder () . connectString ( \"192.168.149.135:2181\" ) . sessionTimeoutMs ( 60 * 1000 ) . connectionTimeoutMs ( 15 * 1000 ) . retryPolicy ( retryPolicy ) . build (); //\u5f00\u542f\u8fde\u63a5 client . start (); lock = new InterProcessMutex ( client , \"/lock\" ); } 3,\u8fd0\u884c\u591a\u4e2a\u7ebf\u7a0b\u8fdb\u884c\u6d4b\u8bd5 public class LockTest { public static void main ( String [] args ) { Ticket12306 ticket12306 = new Ticket12306 (); //\u521b\u5efa\u5ba2\u6237\u7aef Thread t1 = new Thread ( ticket12306 , \"\u643a\u7a0b\" ); Thread t2 = new Thread ( ticket12306 , \"\u98de\u732a\" ); t1 . start (); t2 . start (); } }","title":"4.13)Zookeeper \u5206\u5e03\u5f0f\u9501-\u6a21\u62df12306\u552e\u7968\u6848\u4f8b"},{"location":"zookeeper/zk/#5zookeeper","text":"","title":"5)ZooKeeper \u96c6\u7fa4\u642d\u5efa"},{"location":"zookeeper/zk/#51zookeeper","text":"Leader\u9009\u4e3e\uff1a \u2022Serverid\uff1a\u670d\u52a1\u5668ID \u6bd4\u5982\u6709\u4e09\u53f0\u670d\u52a1\u5668\uff0c\u7f16\u53f7\u5206\u522b\u662f1,2,3\u3002 \u7f16\u53f7\u8d8a\u5927\u5728\u9009\u62e9\u7b97\u6cd5\u4e2d\u7684\u6743\u91cd\u8d8a\u5927\u3002 \u2022Zxid\uff1a\u6570\u636eID \u670d\u52a1\u5668\u4e2d\u5b58\u653e\u7684\u6700\u5927\u6570\u636eID.\u503c\u8d8a\u5927\u8bf4\u660e\u6570\u636e \u8d8a\u65b0\uff0c\u5728\u9009\u4e3e\u7b97\u6cd5\u4e2d\u6570\u636e\u8d8a\u65b0\u6743\u91cd\u8d8a\u5927\u3002 \u2022\u5728Leader\u9009\u4e3e\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u67d0\u53f0ZooKeeper \u200b \u83b7\u5f97\u4e86\u8d85\u8fc7\u534a\u6570\u7684\u9009\u7968\uff0c \u200b \u5219\u6b64ZooKeeper\u5c31\u53ef\u4ee5\u6210\u4e3aLeader\u4e86\u3002","title":"5.1)Zookeeper\u96c6\u7fa4\u4ecb\u7ecd"},{"location":"zookeeper/zk/#52","text":"\u771f\u5b9e\u7684\u96c6\u7fa4\u662f\u9700\u8981\u90e8\u7f72\u5728\u4e0d\u540c\u7684\u670d\u52a1\u5668\u4e0a\u7684\uff0c\u4f46\u662f\u5728\u6211\u4eec\u6d4b\u8bd5\u65f6\u540c\u65f6\u542f\u52a8\u5f88\u591a\u4e2a\u865a\u62df\u673a\u5185\u5b58\u4f1a\u5403\u4e0d\u6d88\uff0c\u6240\u4ee5\u6211\u4eec\u901a\u5e38\u4f1a\u642d\u5efa \u4f2a\u96c6\u7fa4 \uff0c\u4e5f\u5c31\u662f\u628a\u6240\u6709\u7684\u670d\u52a1\u90fd\u642d\u5efa\u5728\u4e00\u53f0\u865a\u62df\u673a\u4e0a\uff0c\u7528\u7aef\u53e3\u8fdb\u884c\u533a\u5206\u3002 \u6211\u4eec\u8fd9\u91cc\u8981\u6c42\u642d\u5efa\u4e00\u4e2a\u4e09\u4e2a\u8282\u70b9\u7684Zookeeper\u96c6\u7fa4\uff08\u4f2a\u96c6\u7fa4\uff09\u3002","title":"5.2)\u642d\u5efa\u8981\u6c42"},{"location":"zookeeper/zk/#53","text":"\u91cd\u65b0\u90e8\u7f72\u4e00\u53f0\u865a\u62df\u673a\u4f5c\u4e3a\u6211\u4eec\u642d\u5efa\u96c6\u7fa4\u7684\u6d4b\u8bd5\u670d\u52a1\u5668\u3002 \uff081\uff09\u5b89\u88c5JDK \u3010\u6b64\u6b65\u9aa4\u7701\u7565\u3011\u3002 \uff082\uff09Zookeeper\u538b\u7f29\u5305\u4e0a\u4f20\u5230\u670d\u52a1\u5668 \uff083\uff09\u5c06Zookeeper\u89e3\u538b \uff0c\u5efa\u7acb/usr/local/zookeeper-cluster\u76ee\u5f55\uff0c\u5c06\u89e3\u538b\u540e\u7684Zookeeper\u590d\u5236\u5230\u4ee5\u4e0b\u4e09\u4e2a\u76ee\u5f55 /usr/local/zookeeper-cluster/zookeeper-1 /usr/local/zookeeper-cluster/zookeeper-2 /usr/local/zookeeper-cluster/zookeeper-3 [ root@localhost ~ ] # mkdir /usr/local/zookeeper-cluster [ root@localhost ~ ] # cp -r apache-zookeeper-3.5.6-bin /usr/local/zookeeper-cluster/zookeeper-1 [ root@localhost ~ ] # cp -r apache-zookeeper-3.5.6-bin /usr/local/zookeeper-cluster/zookeeper-2 [ root@localhost ~ ] # cp -r apache-zookeeper-3.5.6-bin /usr/local/zookeeper-cluster/zookeeper-3 \uff084\uff09\u521b\u5efadata\u76ee\u5f55 \uff0c\u5e76\u4e14\u5c06 conf\u4e0bzoo_sample.cfg \u6587\u4ef6\u6539\u540d\u4e3a zoo.cfg mkdir /usr/local/zookeeper-cluster/zookeeper-1/data mkdir /usr/local/zookeeper-cluster/zookeeper-2/data mkdir /usr/local/zookeeper-cluster/zookeeper-3/data mv /usr/local/zookeeper-cluster/zookeeper-1/conf/zoo_sample.cfg /usr/local/zookeeper-cluster/zookeeper-1/conf/zoo.cfg mv /usr/local/zookeeper-cluster/zookeeper-2/conf/zoo_sample.cfg /usr/local/zookeeper-cluster/zookeeper-2/conf/zoo.cfg mv /usr/local/zookeeper-cluster/zookeeper-3/conf/zoo_sample.cfg /usr/local/zookeeper-cluster/zookeeper-3/conf/zoo.cfg \uff085\uff09 \u914d\u7f6e\u6bcf\u4e00\u4e2aZookeeper \u7684dataDir \u548c clientPort \u5206\u522b\u4e3a2181 2182 2183 \u4fee\u6539/usr/local/zookeeper-cluster/zookeeper-1/conf/zoo.cfg vim /usr/local/zookeeper-cluster/zookeeper-1/conf/zoo.cfg clientPort = 2181 dataDir = /usr/local/zookeeper-cluster/zookeeper-1/data \u4fee\u6539/usr/local/zookeeper-cluster/zookeeper-2/conf/zoo.cfg vim /usr/local/zookeeper-cluster/zookeeper-2/conf/zoo.cfg clientPort = 2182 dataDir = /usr/local/zookeeper-cluster/zookeeper-2/data \u4fee\u6539/usr/local/zookeeper-cluster/zookeeper-3/conf/zoo.cfg vim /usr/local/zookeeper-cluster/zookeeper-3/conf/zoo.cfg clientPort = 2183 dataDir = /usr/local/zookeeper-cluster/zookeeper-3/data","title":"5.3)\u51c6\u5907\u5de5\u4f5c"},{"location":"zookeeper/zk/#54","text":"\uff081\uff09\u5728\u6bcf\u4e2azookeeper\u7684 data \u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a myid \u6587\u4ef6\uff0c\u5185\u5bb9\u5206\u522b\u662f1\u30012\u30013 \u3002\u8fd9\u4e2a\u6587\u4ef6\u5c31\u662f\u8bb0\u5f55\u6bcf\u4e2a\u670d\u52a1\u5668\u7684ID echo 1 >/usr/local/zookeeper-cluster/zookeeper-1/data/myid echo 2 >/usr/local/zookeeper-cluster/zookeeper-2/data/myid echo 3 >/usr/local/zookeeper-cluster/zookeeper-3/data/myid \uff082\uff09\u5728\u6bcf\u4e00\u4e2azookeeper \u7684 zoo.cfg\u914d\u7f6e\u5ba2\u6237\u7aef\u8bbf\u95ee\u7aef\u53e3\uff08clientPort\uff09\u548c\u96c6\u7fa4\u670d\u52a1\u5668IP\u5217\u8868\u3002 \u96c6\u7fa4\u670d\u52a1\u5668IP\u5217\u8868\u5982\u4e0b vim /usr/local/zookeeper-cluster/zookeeper-1/conf/zoo.cfg vim /usr/local/zookeeper-cluster/zookeeper-2/conf/zoo.cfg vim /usr/local/zookeeper-cluster/zookeeper-3/conf/zoo.cfg server.1 = 192 .168.149.135:2881:3881 server.2 = 192 .168.149.135:2882:3882 server.3 = 192 .168.149.135:2883:3883 \u89e3\u91ca\uff1aserver.\u670d\u52a1\u5668ID=\u670d\u52a1\u5668IP\u5730\u5740\uff1a\u670d\u52a1\u5668\u4e4b\u95f4\u901a\u4fe1\u7aef\u53e3\uff1a\u670d\u52a1\u5668\u4e4b\u95f4\u6295\u7968\u9009\u4e3e\u7aef\u53e3","title":"5.4)\u914d\u7f6e\u96c6\u7fa4"},{"location":"zookeeper/zk/#55","text":"\u542f\u52a8\u96c6\u7fa4\u5c31\u662f\u5206\u522b\u542f\u52a8\u6bcf\u4e2a\u5b9e\u4f8b\u3002 /usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh start /usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh start /usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh start \u542f\u52a8\u540e\u6211\u4eec\u67e5\u8be2\u4e00\u4e0b\u6bcf\u4e2a\u5b9e\u4f8b\u7684\u8fd0\u884c\u72b6\u6001 /usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh status /usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status /usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh status \u5148\u67e5\u8be2\u7b2c\u4e00\u4e2a\u670d\u52a1 Mode\u4e3afollower\u8868\u793a\u662f \u8ddf\u968f\u8005 \uff08\u4ece\uff09 \u518d\u67e5\u8be2\u7b2c\u4e8c\u4e2a\u670d\u52a1Mod \u4e3aleader\u8868\u793a\u662f \u9886\u5bfc\u8005 \uff08\u4e3b\uff09 \u67e5\u8be2\u7b2c\u4e09\u4e2a\u4e3a\u8ddf\u968f\u8005\uff08\u4ece\uff09","title":"5.5)\u542f\u52a8\u96c6\u7fa4"},{"location":"zookeeper/zk/#56","text":"\uff081\uff09\u9996\u5148\u6211\u4eec\u5148\u6d4b\u8bd5\u5982\u679c\u662f\u4ece\u670d\u52a1\u5668\u6302\u6389\uff0c\u4f1a\u600e\u4e48\u6837 \u628a3\u53f7\u670d\u52a1\u5668\u505c\u6389\uff0c\u89c2\u5bdf1\u53f7\u548c2\u53f7\uff0c\u53d1\u73b0\u72b6\u6001\u5e76\u6ca1\u6709\u53d8\u5316 /usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh stop /usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh status /usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status \u7531\u6b64\u5f97\u51fa\u7ed3\u8bba\uff0c3\u4e2a\u8282\u70b9\u7684\u96c6\u7fa4\uff0c\u4ece\u670d\u52a1\u5668\u6302\u6389\uff0c\u96c6\u7fa4\u6b63\u5e38 \uff082\uff09\u6211\u4eec\u518d\u628a1\u53f7\u670d\u52a1\u5668\uff08\u4ece\u670d\u52a1\u5668\uff09\u4e5f\u505c\u6389\uff0c\u67e5\u770b2\u53f7\uff08\u4e3b\u670d\u52a1\u5668\uff09\u7684\u72b6\u6001\uff0c\u53d1\u73b0\u5df2\u7ecf\u505c\u6b62\u8fd0\u884c\u4e86\u3002 /usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh stop /usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status \u7531\u6b64\u5f97\u51fa\u7ed3\u8bba\uff0c3\u4e2a\u8282\u70b9\u7684\u96c6\u7fa4\uff0c2\u4e2a\u4ece\u670d\u52a1\u5668\u90fd\u6302\u6389\uff0c\u4e3b\u670d\u52a1\u5668\u4e5f\u65e0\u6cd5\u8fd0\u884c\u3002\u56e0\u4e3a\u53ef\u8fd0\u884c\u7684\u673a\u5668\u6ca1\u6709\u8d85\u8fc7\u96c6\u7fa4\u603b\u6570\u91cf\u7684\u534a\u6570\u3002 \uff083\uff09\u6211\u4eec\u518d\u6b21\u628a1\u53f7\u670d\u52a1\u5668\u542f\u52a8\u8d77\u6765\uff0c\u53d1\u73b02\u53f7\u670d\u52a1\u5668\u53c8\u5f00\u59cb\u6b63\u5e38\u5de5\u4f5c\u4e86\u3002\u800c\u4e14\u4f9d\u7136\u662f\u9886\u5bfc\u8005\u3002 /usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh start /usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status \uff084\uff09\u6211\u4eec\u628a3\u53f7\u670d\u52a1\u5668\u4e5f\u542f\u52a8\u8d77\u6765\uff0c\u628a2\u53f7\u670d\u52a1\u5668\u505c\u6389,\u505c\u6389\u540e\u89c2\u5bdf1\u53f7\u548c3\u53f7\u7684\u72b6\u6001\u3002 /usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh start /usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh stop /usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh status /usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh status \u53d1\u73b0\u65b0\u7684leader\u4ea7\u751f\u4e86~ \u7531\u6b64\u6211\u4eec\u5f97\u51fa\u7ed3\u8bba\uff0c\u5f53\u96c6\u7fa4\u4e2d\u7684\u4e3b\u670d\u52a1\u5668\u6302\u4e86\uff0c\u96c6\u7fa4\u4e2d\u7684\u5176\u4ed6\u670d\u52a1\u5668\u4f1a\u81ea\u52a8\u8fdb\u884c\u9009\u4e3e\u72b6\u6001\uff0c\u7136\u540e\u4ea7\u751f\u65b0\u5f97leader \uff085\uff09\u6211\u4eec\u518d\u6b21\u6d4b\u8bd5\uff0c\u5f53\u6211\u4eec\u628a2\u53f7\u670d\u52a1\u5668\u91cd\u65b0\u542f\u52a8\u8d77\u6765\u542f\u52a8\u540e\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f2\u53f7\u670d\u52a1\u5668\u4f1a\u518d\u6b21\u6210\u4e3a\u65b0\u7684\u9886\u5bfc\u5417\uff1f\u6211\u4eec\u770b\u7ed3\u679c /usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh start /usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status /usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh status \u6211\u4eec\u4f1a\u53d1\u73b0\uff0c2\u53f7\u670d\u52a1\u5668\u542f\u52a8\u540e\u4f9d\u7136\u662f\u8ddf\u968f\u8005\uff08\u4ece\u670d\u52a1\u5668\uff09\uff0c3\u53f7\u670d\u52a1\u5668\u4f9d\u7136\u662f\u9886\u5bfc\u8005\uff08\u4e3b\u670d\u52a1\u5668\uff09\uff0c\u6ca1\u6709\u64bc\u52a83\u53f7\u670d\u52a1\u5668\u7684\u9886\u5bfc\u5730\u4f4d\u3002 \u7531\u6b64\u6211\u4eec\u5f97\u51fa\u7ed3\u8bba\uff0c\u5f53\u9886\u5bfc\u8005\u4ea7\u751f\u540e\uff0c\u518d\u6b21\u6709\u65b0\u670d\u52a1\u5668\u52a0\u5165\u96c6\u7fa4\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5230\u73b0\u4efb\u9886\u5bfc\u8005\u3002","title":"5.6)\u6a21\u62df\u96c6\u7fa4\u5f02\u5e38"},{"location":"zookeeper/zk/#6zookeeper","text":"Zookeepe\u96c6\u7fa4\u89d2\u8272 \u5728ZooKeeper\u96c6\u7fa4\u670d\u4e2d\u52a1\u4e2d\u6709\u4e09\u4e2a\u89d2\u8272\uff1a \u2022Leader \u9886\u5bfc\u8005 \uff1a \u200b 1. \u5904\u7406\u4e8b\u52a1\u8bf7\u6c42 \u200b 2. \u96c6\u7fa4\u5185\u90e8\u5404\u670d\u52a1\u5668\u7684\u8c03\u5ea6\u8005 \u2022Follower \u8ddf\u968f\u8005 \uff1a \u200b 1. \u5904\u7406\u5ba2\u6237\u7aef\u975e\u4e8b\u52a1\u8bf7\u6c42\uff0c\u8f6c\u53d1\u4e8b\u52a1\u8bf7\u6c42\u7ed9Leader\u670d\u52a1\u5668 \u200b 2. \u53c2\u4e0eLeader\u9009\u4e3e\u6295\u7968 \u2022Observer \u89c2\u5bdf\u8005\uff1a 1. \u5904\u7406\u5ba2\u6237\u7aef\u975e\u4e8b\u52a1\u8bf7\u6c42 \uff0c \u8f6c\u53d1\u4e8b\u52a1\u8bf7\u6c42\u7ed9Leader\u670d\u52a1\u5668","title":"6)Zookeeper \u6838\u5fc3\u7406\u8bba"}]}