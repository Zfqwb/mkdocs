
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="MkDocs Material Boilerplate (Starter Kit) - Deploy documentation to hosting platforms (Netlify, GitHub Pages, GitLab Pages, and AWS Amplify Console) with Docker, pipenv, and GitHub Actions.">
      
      
      
        <meta name="author" content="nitto">
      
      
        <link rel="canonical" href="https://nitto.netlify.app/tantan/day08/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.1, mkdocs-material-7.1.9">
    
    
      
        <title>day08 - Nitto Java Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.ca7ac06f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.f1a3b89f.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
      <link rel="manifest" href="../../manifest.json" crossorigin="use-credentials">
    
    
      <link rel="stylesheet" href="../../assets/css/custom.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Nitto Java Docs" class="md-header__button md-logo" aria-label="Nitto Java Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Nitto Java Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              day08
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/Zfqwb/mkdocs/" title="前往 GitHub 仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Nitto Java Docs" class="md-nav__button md-logo" aria-label="Nitto Java Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Nitto Java Docs
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/Zfqwb/mkdocs/" title="前往 GitHub 仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/" class="md-nav__link">
        Mysql
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../jquery/" class="md-nav__link">
        JQuery
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../ajax/" class="md-nav__link">
        AJAX
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        Redis
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Redis" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Redis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../redis/day01/" class="md-nav__link">
        day01
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../redis/day02/" class="md-nav__link">
        day02
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        Docker
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Docker" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/1/" class="md-nav__link">
        初识 Docker
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/2/" class="md-nav__link">
        docker命令
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/3/" class="md-nav__link">
        docker容器的数据卷
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/4/" class="md-nav__link">
        docker部署容器
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/5/" class="md-nav__link">
        Docerfile
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/6/" class="md-nav__link">
        服务编排
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/7/" class="md-nav__link">
        私有仓库
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../MongoDB/MongoDB/" class="md-nav__link">
        MongoDB
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" checked>
      
      <label class="md-nav__link" for="__nav_8">
        项目一-探花交友
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="项目一-探花交友" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          项目一-探花交友
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../day01/" class="md-nav__link">
        day01
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../day02/" class="md-nav__link">
        day02
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../day03/" class="md-nav__link">
        day03
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../day04/" class="md-nav__link">
        day04
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../day05/" class="md-nav__link">
        day05
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../day06/" class="md-nav__link">
        day06
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../day07/" class="md-nav__link">
        day07
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          day08
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        day08
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    课程说明
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1、上报地理位置
  </a>
  
    <nav class="md-nav" aria-label="1、上报地理位置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11dubbo" class="md-nav__link">
    1.1、dubbo服务
  </a>
  
    <nav class="md-nav" aria-label="1.1、dubbo服务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111" class="md-nav__link">
    1.1.1、创建工程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112pojo" class="md-nav__link">
    1.1.2、定义pojo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#113dubbo" class="md-nav__link">
    1.1.3、定义dubbo接口
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#114" class="md-nav__link">
    1.1.4、编写实现
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#115" class="md-nav__link">
    1.1.5、单元测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12app" class="md-nav__link">
    1.2、APP接口
  </a>
  
    <nav class="md-nav" aria-label="1.2、APP接口">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121baiducontroller" class="md-nav__link">
    1.2.1、BaiduController
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122baiduservice" class="md-nav__link">
    1.2.2、BaiduService
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    1.3、测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2、搜附近
  </a>
  
    <nav class="md-nav" aria-label="2、搜附近">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21dubbo" class="md-nav__link">
    2.1、dubbo服务
  </a>
  
    <nav class="md-nav" aria-label="2.1、dubbo服务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211" class="md-nav__link">
    2.1.1、定义接口方法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212" class="md-nav__link">
    2.1.2、编写实现
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213" class="md-nav__link">
    2.1.3、单元测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22app" class="md-nav__link">
    2.2、APP接口服务
  </a>
  
    <nav class="md-nav" aria-label="2.2、APP接口服务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221nearuservo" class="md-nav__link">
    2.2.1、NearUserVo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222tanhuacontroller" class="md-nav__link">
    2.2.2、TanHuaController
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223tanhuaservice" class="md-nav__link">
    2.2.3、TanHuaService
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#224" class="md-nav__link">
    2.2.4、测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3、探花
  </a>
  
    <nav class="md-nav" aria-label="3、探花">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31dubbo" class="md-nav__link">
    3.1、喜欢的dubbo服务
  </a>
  
    <nav class="md-nav" aria-label="3.1、喜欢的dubbo服务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#311" class="md-nav__link">
    3.1.1、实体对象
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#312" class="md-nav__link">
    3.1.2、定义接口
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#313" class="md-nav__link">
    3.1.3、编写实现
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#314" class="md-nav__link">
    3.1.4、单元测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32dubbo" class="md-nav__link">
    3.2、查询推荐列表dubbo服务
  </a>
  
    <nav class="md-nav" aria-label="3.2、查询推荐列表dubbo服务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#321" class="md-nav__link">
    3.2.1、定义接口
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#322" class="md-nav__link">
    3.2.2、编写实现
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#323" class="md-nav__link">
    3.2.3、单元测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33app" class="md-nav__link">
    3.3、查询推荐列表APP接口实现
  </a>
  
    <nav class="md-nav" aria-label="3.3、查询推荐列表APP接口实现">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#331tanhuacontroller" class="md-nav__link">
    3.3.1、TanHuaController
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#332tanhuaservice" class="md-nav__link">
    3.3.2、TanHuaService
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#333" class="md-nav__link">
    3.3.3、测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    3.4、左滑右滑
  </a>
  
    <nav class="md-nav" aria-label="3.4、左滑右滑">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#341tanhuacontroller" class="md-nav__link">
    3.4.1、TanHuaController
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#342tanhuaservice" class="md-nav__link">
    3.4.2、TanHuaService
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#343" class="md-nav__link">
    3.4.3、测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4、用户资料
  </a>
  
    <nav class="md-nav" aria-label="4、用户资料">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    4.1、基本信息
  </a>
  
    <nav class="md-nav" aria-label="4.1、基本信息">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#441" class="md-nav__link">
    4.4.1、接口信息
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#442mycentercontroller" class="md-nav__link">
    4.4.2、MyCenterController
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#443mycenterservice" class="md-nav__link">
    4.4.3、MyCenterService
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#444userinfoservice" class="md-nav__link">
    4.4.4、UserInfoService
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#445bug" class="md-nav__link">
    4.4.5、bug修复
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    4.2、更新头像
  </a>
  
    <nav class="md-nav" aria-label="4.2、更新头像">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#422mycentercontroller" class="md-nav__link">
    4.2.2、MyCenterController
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../day09/" class="md-nav__link">
        day09
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../day10/" class="md-nav__link">
        day10
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_11" type="checkbox" id="__nav_8_11" >
      
      <label class="md-nav__link" for="__nav_8_11">
        补充资料
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="补充资料" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_11">
          <span class="md-nav__icon md-icon"></span>
          补充资料
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../further/lombok/" class="md-nav__link">
        day01_lombok
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../further/mybatisPlus/" class="md-nav__link">
        day01_mybatis_plus
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../further/aliyun/" class="md-nav__link">
        day01_阿里云
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../further/sso/" class="md-nav__link">
        day01_单点登录及jwt
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../further/nginx/" class="md-nav__link">
        day03_nginx
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../further/threadlocal/README.md" class="md-nav__link">
        day03_ThreadLocal
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../further/mongodb/" class="md-nav__link">
        day04_MongoDB
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../further/ansy/" class="md-nav__link">
        day04_多线程@Ansy
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      <label class="md-nav__link" for="__nav_9">
        项目二-黑马头条
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="项目二-黑马头条" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          项目二-黑马头条
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../hmtt/day01/" class="md-nav__link">
        day01
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../hmtt/day02/" class="md-nav__link">
        day02
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../hmtt/day03/" class="md-nav__link">
        day03
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../hmtt/day04/" class="md-nav__link">
        day04
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../hmtt/day05/" class="md-nav__link">
        day05
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../hmtt/day06/" class="md-nav__link">
        day06
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../hmtt/day07/" class="md-nav__link">
        day07
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../hmtt/day08/" class="md-nav__link">
        day08
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../hmtt/day09/" class="md-nav__link">
        day09
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../hmtt/day10/" class="md-nav__link">
        day10
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../hmtt/day11/" class="md-nav__link">
        day11
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../hmtt/day12/" class="md-nav__link">
        day12
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../hmtt/day13/" class="md-nav__link">
        day13
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../hmtt/day14/" class="md-nav__link">
        day14
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../hmtt/day15/" class="md-nav__link">
        day15
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      <label class="md-nav__link" for="__nav_10">
        面试
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="面试" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          面试
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../interview/e.g.1.0.0/" class="md-nav__link">
        e.g.1.0.0
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    课程说明
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1、上报地理位置
  </a>
  
    <nav class="md-nav" aria-label="1、上报地理位置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11dubbo" class="md-nav__link">
    1.1、dubbo服务
  </a>
  
    <nav class="md-nav" aria-label="1.1、dubbo服务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111" class="md-nav__link">
    1.1.1、创建工程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112pojo" class="md-nav__link">
    1.1.2、定义pojo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#113dubbo" class="md-nav__link">
    1.1.3、定义dubbo接口
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#114" class="md-nav__link">
    1.1.4、编写实现
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#115" class="md-nav__link">
    1.1.5、单元测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12app" class="md-nav__link">
    1.2、APP接口
  </a>
  
    <nav class="md-nav" aria-label="1.2、APP接口">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#121baiducontroller" class="md-nav__link">
    1.2.1、BaiduController
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#122baiduservice" class="md-nav__link">
    1.2.2、BaiduService
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13" class="md-nav__link">
    1.3、测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2、搜附近
  </a>
  
    <nav class="md-nav" aria-label="2、搜附近">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21dubbo" class="md-nav__link">
    2.1、dubbo服务
  </a>
  
    <nav class="md-nav" aria-label="2.1、dubbo服务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211" class="md-nav__link">
    2.1.1、定义接口方法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212" class="md-nav__link">
    2.1.2、编写实现
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213" class="md-nav__link">
    2.1.3、单元测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22app" class="md-nav__link">
    2.2、APP接口服务
  </a>
  
    <nav class="md-nav" aria-label="2.2、APP接口服务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221nearuservo" class="md-nav__link">
    2.2.1、NearUserVo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222tanhuacontroller" class="md-nav__link">
    2.2.2、TanHuaController
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223tanhuaservice" class="md-nav__link">
    2.2.3、TanHuaService
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#224" class="md-nav__link">
    2.2.4、测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3、探花
  </a>
  
    <nav class="md-nav" aria-label="3、探花">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31dubbo" class="md-nav__link">
    3.1、喜欢的dubbo服务
  </a>
  
    <nav class="md-nav" aria-label="3.1、喜欢的dubbo服务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#311" class="md-nav__link">
    3.1.1、实体对象
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#312" class="md-nav__link">
    3.1.2、定义接口
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#313" class="md-nav__link">
    3.1.3、编写实现
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#314" class="md-nav__link">
    3.1.4、单元测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32dubbo" class="md-nav__link">
    3.2、查询推荐列表dubbo服务
  </a>
  
    <nav class="md-nav" aria-label="3.2、查询推荐列表dubbo服务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#321" class="md-nav__link">
    3.2.1、定义接口
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#322" class="md-nav__link">
    3.2.2、编写实现
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#323" class="md-nav__link">
    3.2.3、单元测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33app" class="md-nav__link">
    3.3、查询推荐列表APP接口实现
  </a>
  
    <nav class="md-nav" aria-label="3.3、查询推荐列表APP接口实现">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#331tanhuacontroller" class="md-nav__link">
    3.3.1、TanHuaController
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#332tanhuaservice" class="md-nav__link">
    3.3.2、TanHuaService
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#333" class="md-nav__link">
    3.3.3、测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    3.4、左滑右滑
  </a>
  
    <nav class="md-nav" aria-label="3.4、左滑右滑">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#341tanhuacontroller" class="md-nav__link">
    3.4.1、TanHuaController
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#342tanhuaservice" class="md-nav__link">
    3.4.2、TanHuaService
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#343" class="md-nav__link">
    3.4.3、测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4、用户资料
  </a>
  
    <nav class="md-nav" aria-label="4、用户资料">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    4.1、基本信息
  </a>
  
    <nav class="md-nav" aria-label="4.1、基本信息">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#441" class="md-nav__link">
    4.4.1、接口信息
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#442mycentercontroller" class="md-nav__link">
    4.4.2、MyCenterController
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#443mycenterservice" class="md-nav__link">
    4.4.3、MyCenterService
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#444userinfoservice" class="md-nav__link">
    4.4.4、UserInfoService
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#445bug" class="md-nav__link">
    4.4.5、bug修复
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    4.2、更新头像
  </a>
  
    <nav class="md-nav" aria-label="4.2、更新头像">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#422mycentercontroller" class="md-nav__link">
    4.2.2、MyCenterController
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/Zfqwb/mkdocs/edit/main/docs_sample/tantan/day08/README.md" title="编辑此页" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  <h1>day08</h1>
                
                <h2 id="_1">课程说明<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<ul>
<li>上报地位位置</li>
<li>实现搜附近功能</li>
<li>实现探花功能</li>
<li>用户基本信息维护</li>
</ul>
<h2 id="1">1、上报地理位置<a class="headerlink" href="#1" title="Permanent link">&para;</a></h2>
<p>当客户端检测用户的地理位置，当变化大于500米时或每隔5分钟，向服务端上报地理位置。</p>
<p>用户的地理位置存储到Elasticsearch中，需要使用环境提供的ES集群，如下：</p>
<p><img alt="image-20210108104814073" src="assets/image-20210108104814073.png" /></p>
<h3 id="11dubbo">1.1、dubbo服务<a class="headerlink" href="#11dubbo" title="Permanent link">&para;</a></h3>
<p>用户地理位置的服务独立一个新的工程来实现，名字为：my-tanhua-dubbo-es。</p>
<h4 id="111">1.1.1、创建工程<a class="headerlink" href="#111" title="Permanent link">&para;</a></h4>
<p>pom.ml文件如下：</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
         <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>my-tanhua-dubbo<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>cn.itcast.tanhua<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;artifactId&gt;</span>my-tanhua-dubbo-es<span class="nt">&lt;/artifactId&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="c">&lt;!--引入interface依赖--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>cn.itcast.tanhua<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>my-tanhua-dubbo-interface<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-elasticsearch<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!--dubbo的springboot支持--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.alibaba.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>dubbo-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!--dubbo框架--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>dubbo<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!--zk依赖--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.apache.zookeeper<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>zookeeper<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.github.sgroschupf<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>zkclient<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>io.netty<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>netty-all<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>cn.hutool<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>hutool-all<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></div>

<p>application.properties文件：</p>
<div class="codehilite"><pre><span></span><code><span class="c"># Spring boot application</span>
<span class="na">spring.application.name</span> <span class="o">=</span> <span class="s">itcast-tanhua-dubbo-es</span>

<span class="c"># dubbo 扫描包配置</span>
<span class="na">dubbo.scan.basePackages</span> <span class="o">=</span> <span class="s">com.tanhua.dubbo.es</span>
<span class="na">dubbo.application.name</span> <span class="o">=</span> <span class="s">dubbo-provider-es</span>

<span class="c">#dubbo 对外暴露的端口信息</span>
<span class="na">dubbo.protocol.name</span> <span class="o">=</span> <span class="s">dubbo</span>
<span class="na">dubbo.protocol.port</span> <span class="o">=</span> <span class="s">20882</span>

<span class="c">#dubbo注册中心的配置</span>
<span class="na">dubbo.registry.address</span> <span class="o">=</span> <span class="s">zookeeper://192.168.31.81:2181</span>
<span class="na">dubbo.registry.client</span> <span class="o">=</span> <span class="s">zkclient</span>
<span class="na">dubbo.registry.timeout</span> <span class="o">=</span> <span class="s">60000 </span>

<span class="c">#ES集群配置</span>
<span class="na">spring.data.elasticsearch.cluster-name</span><span class="o">=</span><span class="s">es-tanhua-cluster</span>
<span class="na">spring.data.elasticsearch.cluster-nodes</span><span class="o">=</span><span class="s">192.168.31.81:9300,192.168.31.81:9301,192.168.31.81:9302</span>
</code></pre></div>

<p>启动类：</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.tanhua.dubbo.es</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration</span><span class="p">;</span>

<span class="nd">@SpringBootApplication</span><span class="p">(</span><span class="n">exclude</span> <span class="o">=</span> <span class="p">{</span><span class="n">MongoAutoConfiguration</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">MongoDataAutoConfiguration</span><span class="p">.</span><span class="na">class</span><span class="p">})</span> <span class="c1">//排除mongo的自动配置</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ESApplication</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">ESApplication</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="112pojo">1.1.2、定义pojo<a class="headerlink" href="#112pojo" title="Permanent link">&para;</a></h4>
<p>在my-tanhua-dubbo-interface中创建：</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.tanhua.dubbo.server.pojo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">lombok.AllArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">lombok.NoArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.elasticsearch.common.geo.GeoPoint</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.annotation.Id</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.elasticsearch.annotations.Document</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.elasticsearch.annotations.Field</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.elasticsearch.annotations.FieldType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.elasticsearch.annotations.GeoPointField</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@Document</span><span class="p">(</span><span class="n">indexName</span> <span class="o">=</span> <span class="s">&quot;tanhua&quot;</span><span class="p">,</span> <span class="n">type</span> <span class="o">=</span> <span class="s">&quot;user_location&quot;</span><span class="p">,</span> <span class="n">shards</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">replicas</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserLocation</span> <span class="p">{</span>

    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">userId</span><span class="p">;</span> <span class="c1">//用户id</span>
    <span class="nd">@GeoPointField</span>
    <span class="kd">private</span> <span class="n">GeoPoint</span> <span class="n">location</span><span class="p">;</span> <span class="c1">//lon:经度 lat:纬度</span>

    <span class="nd">@Field</span><span class="p">(</span><span class="n">type</span> <span class="o">=</span> <span class="n">FieldType</span><span class="p">.</span><span class="na">Keyword</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">address</span><span class="p">;</span> <span class="c1">//位置描述</span>

    <span class="nd">@Field</span><span class="p">(</span><span class="n">type</span> <span class="o">=</span> <span class="n">FieldType</span><span class="p">.</span><span class="na">Long</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">created</span><span class="p">;</span> <span class="c1">//创建时间</span>

    <span class="nd">@Field</span><span class="p">(</span><span class="n">type</span> <span class="o">=</span> <span class="n">FieldType</span><span class="p">.</span><span class="na">Long</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">updated</span><span class="p">;</span> <span class="c1">//更新时间</span>

    <span class="nd">@Field</span><span class="p">(</span><span class="n">type</span> <span class="o">=</span> <span class="n">FieldType</span><span class="p">.</span><span class="na">Long</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">lastUpdated</span><span class="p">;</span> <span class="c1">//上次更新时间</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.tanhua.dubbo.server.vo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">cn.hutool.core.bean.BeanUtil</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.tanhua.dubbo.server.pojo.UserLocation</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">lombok.AllArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">lombok.NoArgsConstructor</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserLocationVo</span> <span class="kd">implements</span> <span class="n">java</span><span class="p">.</span><span class="na">io</span><span class="p">.</span><span class="na">Serializable</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">4133419501260037769L</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">Long</span> <span class="n">userId</span><span class="p">;</span> <span class="c1">//用户id</span>
    <span class="kd">private</span> <span class="n">Double</span> <span class="n">longitude</span><span class="p">;</span> <span class="c1">//经度</span>
    <span class="kd">private</span> <span class="n">Double</span> <span class="n">latitude</span><span class="p">;</span> <span class="c1">//维度</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">address</span><span class="p">;</span> <span class="c1">//位置描述</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">created</span><span class="p">;</span> <span class="c1">//创建时间</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">updated</span><span class="p">;</span> <span class="c1">//更新时间</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">lastUpdated</span><span class="p">;</span> <span class="c1">//上次更新时间</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">UserLocationVo</span> <span class="nf">format</span><span class="p">(</span><span class="n">UserLocation</span> <span class="n">userLocation</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">UserLocationVo</span> <span class="n">userLocationVo</span> <span class="o">=</span> <span class="n">BeanUtil</span><span class="p">.</span><span class="na">toBean</span><span class="p">(</span><span class="n">userLocation</span><span class="p">,</span> <span class="n">UserLocationVo</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
        <span class="n">userLocationVo</span><span class="p">.</span><span class="na">setLongitude</span><span class="p">(</span><span class="n">userLocation</span><span class="p">.</span><span class="na">getLocation</span><span class="p">().</span><span class="na">getLon</span><span class="p">());</span>
        <span class="n">userLocationVo</span><span class="p">.</span><span class="na">setLatitude</span><span class="p">(</span><span class="n">userLocation</span><span class="p">.</span><span class="na">getLocation</span><span class="p">().</span><span class="na">getLat</span><span class="p">());</span>
        <span class="k">return</span> <span class="n">userLocationVo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">UserLocationVo</span><span class="o">&gt;</span> <span class="nf">formatToList</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">UserLocation</span><span class="o">&gt;</span> <span class="n">userLocations</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">UserLocationVo</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">UserLocation</span> <span class="n">userLocation</span> <span class="p">:</span> <span class="n">userLocations</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">list</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="n">userLocation</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">list</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<blockquote>
<p><strong>由于UserLocation不能序列化，所以要再定义UserLocationVo进行返回数据。</strong></p>
</blockquote>
<p>在my-tanhua-dubbo-interface中添加依赖：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-elasticsearch<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>cn.hutool<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>hutool-all<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>

<h4 id="113dubbo">1.1.3、定义dubbo接口<a class="headerlink" href="#113dubbo" title="Permanent link">&para;</a></h4>
<p>在my-tanhua-dubbo-interface工程中。</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.tanhua.dubbo.server.api</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserLocationApi</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * 更新用户地理位置</span>
<span class="cm">     *</span>
<span class="cm">     * @param userId 用户id</span>
<span class="cm">     * @param longitude 经度</span>
<span class="cm">     * @param latitude 纬度</span>
<span class="cm">     * @param address 地址名称</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="n">Boolean</span> <span class="nf">updateUserLocation</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">,</span> <span class="n">Double</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">Double</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">String</span> <span class="n">address</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div>

<h4 id="114">1.1.4、编写实现<a class="headerlink" href="#114" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.tanhua.dubbo.es.api</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">cn.hutool.core.util.ObjectUtil</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.alibaba.dubbo.config.annotation.Service</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.tanhua.dubbo.server.api.UserLocationApi</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.tanhua.dubbo.server.pojo.UserLocation</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.elasticsearch.action.update.UpdateRequest</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.elasticsearch.common.geo.GeoPoint</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.elasticsearch.core.ElasticsearchTemplate</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.elasticsearch.core.query.*</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.annotation.PostConstruct</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="p">;</span>

<span class="nd">@Service</span><span class="p">(</span><span class="n">version</span> <span class="o">=</span> <span class="s">&quot;1.0.0&quot;</span><span class="p">)</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserLocationApiImpl</span> <span class="kd">implements</span> <span class="n">UserLocationApi</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ElasticsearchTemplate</span> <span class="n">elasticsearchTemplate</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * 初始化索引库</span>
<span class="cm">     *</span>
<span class="cm">     */</span>
    <span class="nd">@PostConstruct</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initIndex</span><span class="p">(){</span>
        <span class="c1">//判断索引库是否存在，如果不存在，需要创建</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="na">elasticsearchTemplate</span><span class="p">.</span><span class="na">indexExists</span><span class="p">(</span><span class="s">&quot;tanhua&quot;</span><span class="p">)){</span>
            <span class="k">this</span><span class="p">.</span><span class="na">elasticsearchTemplate</span><span class="p">.</span><span class="na">createIndex</span><span class="p">(</span><span class="n">UserLocation</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">//判断表是否存在，如果不存在，需要创建</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="na">elasticsearchTemplate</span><span class="p">.</span><span class="na">typeExists</span><span class="p">(</span><span class="s">&quot;tanhua&quot;</span><span class="p">,</span> <span class="s">&quot;user_location&quot;</span><span class="p">)){</span>
            <span class="k">this</span><span class="p">.</span><span class="na">elasticsearchTemplate</span><span class="p">.</span><span class="na">putMapping</span><span class="p">(</span><span class="n">UserLocation</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Boolean</span> <span class="nf">updateUserLocation</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">,</span> <span class="n">Double</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">Double</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">String</span> <span class="n">address</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//查询个人的地理位置数据，如果不存在，需要新增，如果是存在数据，更新数据</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="n">GetQuery</span> <span class="n">getQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GetQuery</span><span class="p">();</span>
            <span class="n">getQuery</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">userId</span><span class="p">));</span>
            <span class="n">UserLocation</span> <span class="n">userLocation</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">elasticsearchTemplate</span><span class="p">.</span><span class="na">queryForObject</span><span class="p">(</span><span class="n">getQuery</span><span class="p">,</span> <span class="n">UserLocation</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">ObjectUtil</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">userLocation</span><span class="p">)){</span>
                <span class="c1">//新增数据</span>
                <span class="n">userLocation</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UserLocation</span><span class="p">();</span>
                <span class="n">userLocation</span><span class="p">.</span><span class="na">setUserId</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>
                <span class="n">userLocation</span><span class="p">.</span><span class="na">setAddress</span><span class="p">(</span><span class="n">address</span><span class="p">);</span>
                <span class="n">userLocation</span><span class="p">.</span><span class="na">setCreated</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>
                <span class="n">userLocation</span><span class="p">.</span><span class="na">setUpdated</span><span class="p">(</span><span class="n">userLocation</span><span class="p">.</span><span class="na">getCreated</span><span class="p">());</span>
                <span class="n">userLocation</span><span class="p">.</span><span class="na">setLastUpdated</span><span class="p">(</span><span class="n">userLocation</span><span class="p">.</span><span class="na">getCreated</span><span class="p">());</span>
                <span class="n">userLocation</span><span class="p">.</span><span class="na">setLocation</span><span class="p">(</span><span class="k">new</span> <span class="n">GeoPoint</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">));</span>

                <span class="n">IndexQuery</span> <span class="n">indexQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IndexQueryBuilder</span><span class="p">().</span><span class="na">withObject</span><span class="p">(</span><span class="n">userLocation</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>

                <span class="c1">//保存数据到ES中</span>
                <span class="k">this</span><span class="p">.</span><span class="na">elasticsearchTemplate</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="n">indexQuery</span><span class="p">);</span>
            <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
                <span class="c1">//更新数据</span>

                <span class="c1">//更新的字段</span>
                <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
                <span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;location&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="n">GeoPoint</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">));</span>
                <span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;updated&quot;</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>
                <span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;lastUpdated&quot;</span><span class="p">,</span> <span class="n">userLocation</span><span class="p">.</span><span class="na">getUpdated</span><span class="p">());</span>
                <span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;address&quot;</span><span class="p">,</span> <span class="n">address</span><span class="p">);</span>

                <span class="n">UpdateRequest</span> <span class="n">updateRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UpdateRequest</span><span class="p">();</span>
                <span class="n">updateRequest</span><span class="p">.</span><span class="na">doc</span><span class="p">(</span><span class="n">map</span><span class="p">);</span>

                <span class="n">UpdateQuery</span> <span class="n">updateQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UpdateQueryBuilder</span><span class="p">()</span>
                        <span class="p">.</span><span class="na">withId</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">userId</span><span class="p">))</span>
                        <span class="p">.</span><span class="na">withClass</span><span class="p">(</span><span class="n">UserLocation</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
                        <span class="p">.</span><span class="na">withUpdateRequest</span><span class="p">(</span><span class="n">updateRequest</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>

                <span class="c1">//更新数据</span>
                <span class="k">this</span><span class="p">.</span><span class="na">elasticsearchTemplate</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">updateQuery</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;更新地理位置失败~ userId = &quot;</span> <span class="o">+</span> <span class="n">userId</span> <span class="o">+</span> <span class="s">&quot;, longitude = &quot;</span> <span class="o">+</span> <span class="n">longitude</span> <span class="o">+</span> <span class="s">&quot;, latitude = &quot;</span> <span class="o">+</span> <span class="n">latitude</span> <span class="o">+</span> <span class="s">&quot;, address = &quot;</span> <span class="o">+</span> <span class="n">address</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="115">1.1.5、单元测试<a class="headerlink" href="#115" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.tanhua.dubbo.es</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.tanhua.dubbo.server.api.UserLocationApi</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.tanhua.dubbo.server.vo.PageInfo</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.tanhua.dubbo.server.vo.UserLocationVo</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringRunner</span><span class="p">;</span>

<span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@SpringBootTest</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestUserLocationApi</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">UserLocationApi</span> <span class="n">userLocationApi</span><span class="p">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testUpdateUserLocation</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">userLocationApi</span><span class="p">.</span><span class="na">updateUserLocation</span><span class="p">(</span><span class="mi">1L</span><span class="p">,</span> <span class="mf">121.512253</span><span class="p">,</span> <span class="mf">31.24094</span><span class="p">,</span> <span class="s">&quot;金茂大厦&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">userLocationApi</span><span class="p">.</span><span class="na">updateUserLocation</span><span class="p">(</span><span class="mi">2L</span><span class="p">,</span> <span class="mf">121.506377</span><span class="p">,</span> <span class="mf">31.245105</span><span class="p">,</span> <span class="s">&quot;东方明珠广播电视塔&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">userLocationApi</span><span class="p">.</span><span class="na">updateUserLocation</span><span class="p">(</span><span class="mi">10L</span><span class="p">,</span> <span class="mf">121.508815</span><span class="p">,</span> <span class="mf">31.243844</span><span class="p">,</span> <span class="s">&quot;陆家嘴地铁站&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">userLocationApi</span><span class="p">.</span><span class="na">updateUserLocation</span><span class="p">(</span><span class="mi">12L</span><span class="p">,</span> <span class="mf">121.511999</span><span class="p">,</span> <span class="mf">31.239185</span><span class="p">,</span> <span class="s">&quot;上海中心大厦&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">userLocationApi</span><span class="p">.</span><span class="na">updateUserLocation</span><span class="p">(</span><span class="mi">25L</span><span class="p">,</span> <span class="mf">121.493444</span><span class="p">,</span> <span class="mf">31.240513</span><span class="p">,</span> <span class="s">&quot;上海市公安局&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">userLocationApi</span><span class="p">.</span><span class="na">updateUserLocation</span><span class="p">(</span><span class="mi">27L</span><span class="p">,</span> <span class="mf">121.494108</span><span class="p">,</span> <span class="mf">31.247011</span><span class="p">,</span> <span class="s">&quot;上海外滩美术馆&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">userLocationApi</span><span class="p">.</span><span class="na">updateUserLocation</span><span class="p">(</span><span class="mi">30L</span><span class="p">,</span> <span class="mf">121.462452</span><span class="p">,</span> <span class="mf">31.253463</span><span class="p">,</span> <span class="s">&quot;上海火车站&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">userLocationApi</span><span class="p">.</span><span class="na">updateUserLocation</span><span class="p">(</span><span class="mi">32L</span><span class="p">,</span> <span class="mf">121.81509</span><span class="p">,</span> <span class="mf">31.157478</span><span class="p">,</span> <span class="s">&quot;上海浦东国际机场&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">userLocationApi</span><span class="p">.</span><span class="na">updateUserLocation</span><span class="p">(</span><span class="mi">34L</span><span class="p">,</span> <span class="mf">121.327908</span><span class="p">,</span> <span class="mf">31.20033</span><span class="p">,</span> <span class="s">&quot;虹桥火车站&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">userLocationApi</span><span class="p">.</span><span class="na">updateUserLocation</span><span class="p">(</span><span class="mi">38L</span><span class="p">,</span> <span class="mf">121.490155</span><span class="p">,</span> <span class="mf">31.277476</span><span class="p">,</span> <span class="s">&quot;鲁迅公园&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">userLocationApi</span><span class="p">.</span><span class="na">updateUserLocation</span><span class="p">(</span><span class="mi">40L</span><span class="p">,</span> <span class="mf">121.425511</span><span class="p">,</span> <span class="mf">31.227831</span><span class="p">,</span> <span class="s">&quot;中山公园&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">userLocationApi</span><span class="p">.</span><span class="na">updateUserLocation</span><span class="p">(</span><span class="mi">43L</span><span class="p">,</span> <span class="mf">121.594194</span><span class="p">,</span> <span class="mf">31.207786</span><span class="p">,</span> <span class="s">&quot;张江高科&quot;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>

<h3 id="12app">1.2、APP接口<a class="headerlink" href="#12app" title="Permanent link">&para;</a></h3>
<p>接口文档：https://mock-java.itheima.net/project/35/interface/api/557</p>
<h4 id="121baiducontroller">1.2.1、BaiduController<a class="headerlink" href="#121baiducontroller" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.tanhua.server.controller</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.tanhua.server.service.BaiduService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.ResponseEntity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestBody</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="p">;</span>

<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;baidu&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BaiduController</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">BaiduService</span> <span class="n">baiduService</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * 更新位置</span>
<span class="cm">     *</span>
<span class="cm">     * @param param</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;location&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">updateLocation</span><span class="p">(</span><span class="nd">@RequestBody</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">param</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">Double</span> <span class="n">longitude</span> <span class="o">=</span> <span class="n">Double</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">param</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;longitude&quot;</span><span class="p">).</span><span class="na">toString</span><span class="p">());</span>
            <span class="n">Double</span> <span class="n">latitude</span> <span class="o">=</span> <span class="n">Double</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">param</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;latitude&quot;</span><span class="p">).</span><span class="na">toString</span><span class="p">());</span>
            <span class="n">String</span> <span class="n">address</span> <span class="o">=</span> <span class="n">param</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;addrStr&quot;</span><span class="p">).</span><span class="na">toString</span><span class="p">();</span>

            <span class="n">Boolean</span> <span class="n">bool</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">baiduService</span><span class="p">.</span><span class="na">updateLocation</span><span class="p">(</span><span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">address</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">bool</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">ResponseEntity</span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="122baiduservice">1.2.2、BaiduService<a class="headerlink" href="#122baiduservice" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.tanhua.server.service</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.alibaba.dubbo.config.annotation.Reference</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.tanhua.common.pojo.User</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.tanhua.common.utils.UserThreadLocal</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.tanhua.dubbo.server.api.UserLocationApi</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>

<span class="nd">@Service</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BaiduService</span> <span class="p">{</span>

    <span class="nd">@Reference</span><span class="p">(</span><span class="n">version</span> <span class="o">=</span> <span class="s">&quot;1.0.0&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">UserLocationApi</span> <span class="n">userLocationApi</span><span class="p">;</span>

    <span class="kd">public</span> <span class="n">Boolean</span> <span class="nf">updateLocation</span><span class="p">(</span><span class="n">Double</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">Double</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">String</span> <span class="n">address</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">UserThreadLocal</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">userLocationApi</span><span class="p">.</span><span class="na">updateUserLocation</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">address</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;更新地理位置失败~ userId = &quot;</span> <span class="o">+</span> <span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;, longitude = &quot;</span> <span class="o">+</span> <span class="n">longitude</span> <span class="o">+</span> <span class="s">&quot;, latitude = &quot;</span> <span class="o">+</span> <span class="n">latitude</span> <span class="o">+</span> <span class="s">&quot;, address = &quot;</span> <span class="o">+</span> <span class="n">address</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>

<h3 id="13">1.3、测试<a class="headerlink" href="#13" title="Permanent link">&para;</a></h3>
<p><img alt="image-20210107230457781" src="assets/image-20210107230457781.png" /></p>
<h2 id="2">2、搜附近<a class="headerlink" href="#2" title="Permanent link">&para;</a></h2>
<p>在首页中点击“搜附近”可以搜索附近的好友，效果如下：</p>
<p><img alt="1571966080530" src="assets/1571966080530.png" /></p>
<p>实现思路：根据当前用户的位置，查询附近范围内的用户。范围是可以设置的。</p>
<h3 id="21dubbo">2.1、dubbo服务<a class="headerlink" href="#21dubbo" title="Permanent link">&para;</a></h3>
<h4 id="211">2.1.1、定义接口方法<a class="headerlink" href="#211" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">//com.tanhua.dubbo.server.api.UserLocationApi</span>

    <span class="cm">/**</span>
<span class="cm">     * 查询用户地理位置</span>
<span class="cm">     *</span>
<span class="cm">     * @param userId</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="n">UserLocationVo</span> <span class="nf">queryByUserId</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">);</span>

    <span class="cm">/**</span>
<span class="cm">     * 根据位置搜索</span>
<span class="cm">     *</span>
<span class="cm">     * @param longitude 经度</span>
<span class="cm">     * @param latitude  纬度</span>
<span class="cm">     * @param distance  距离(米)</span>
<span class="cm">     * @param page      页数</span>
<span class="cm">     * @param pageSize  页面大小</span>
<span class="cm">     */</span>
    <span class="n">PageInfo</span><span class="o">&lt;</span><span class="n">UserLocationVo</span><span class="o">&gt;</span> <span class="nf">queryUserFromLocation</span><span class="p">(</span><span class="n">Double</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">Double</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">Double</span> <span class="n">distance</span><span class="p">,</span> <span class="n">Integer</span> <span class="n">page</span><span class="p">,</span> <span class="n">Integer</span> <span class="n">pageSize</span><span class="p">);</span>
</code></pre></div>

<h4 id="212">2.1.2、编写实现<a class="headerlink" href="#212" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">//com.tanhua.dubbo.es.api.UserLocationApiImpl</span>

    <span class="cm">/**</span>
<span class="cm">     * 查询用户的位置信息</span>
<span class="cm">     *</span>
<span class="cm">     * @param userId</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">UserLocationVo</span> <span class="nf">queryByUserId</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">GetQuery</span> <span class="n">getQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GetQuery</span><span class="p">();</span>
        <span class="n">getQuery</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">userId</span><span class="p">));</span>
        <span class="n">UserLocation</span> <span class="n">userLocation</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">elasticsearchTemplate</span><span class="p">.</span><span class="na">queryForObject</span><span class="p">(</span><span class="n">getQuery</span><span class="p">,</span> <span class="n">UserLocation</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ObjectUtil</span><span class="p">.</span><span class="na">isNotEmpty</span><span class="p">(</span><span class="n">userLocation</span><span class="p">)){</span>
            <span class="k">return</span> <span class="n">UserLocationVo</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">userLocation</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 根据位置搜索</span>
<span class="cm">     *</span>
<span class="cm">     * @param longitude 经度</span>
<span class="cm">     * @param latitude  纬度</span>
<span class="cm">     * @param distance  距离(米)</span>
<span class="cm">     * @param page      页数</span>
<span class="cm">     * @param pageSize  页面大小</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">PageInfo</span><span class="o">&lt;</span><span class="n">UserLocationVo</span><span class="o">&gt;</span> <span class="nf">queryUserFromLocation</span><span class="p">(</span><span class="n">Double</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">Double</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">Double</span> <span class="n">distance</span><span class="p">,</span> <span class="n">Integer</span> <span class="n">page</span><span class="p">,</span> <span class="n">Integer</span> <span class="n">pageSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">PageInfo</span><span class="o">&lt;</span><span class="n">UserLocationVo</span><span class="o">&gt;</span> <span class="n">pageInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PageInfo</span><span class="o">&lt;&gt;</span><span class="p">();</span>
        <span class="n">pageInfo</span><span class="p">.</span><span class="na">setPageNum</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
        <span class="n">pageInfo</span><span class="p">.</span><span class="na">setPageSize</span><span class="p">(</span><span class="n">pageSize</span><span class="p">);</span>

        <span class="n">String</span> <span class="n">fieldName</span> <span class="o">=</span> <span class="s">&quot;location&quot;</span><span class="p">;</span>

        <span class="c1">//实现了SearchQuery接口，构造分页、排序</span>
        <span class="n">NativeSearchQueryBuilder</span> <span class="n">searchQueryBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NativeSearchQueryBuilder</span><span class="p">();</span>

        <span class="c1">//分页</span>
        <span class="n">PageRequest</span> <span class="n">pageRequest</span> <span class="o">=</span> <span class="n">PageRequest</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pageSize</span><span class="p">);</span>
        <span class="n">searchQueryBuilder</span><span class="p">.</span><span class="na">withPageable</span><span class="p">(</span><span class="n">pageRequest</span><span class="p">);</span>

        <span class="n">BoolQueryBuilder</span> <span class="n">boolQueryBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BoolQueryBuilder</span><span class="p">();</span>

        <span class="c1">//以一个点为中心，指定范围查询</span>
        <span class="n">GeoDistanceQueryBuilder</span> <span class="n">geoDistanceQueryBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GeoDistanceQueryBuilder</span><span class="p">(</span><span class="n">fieldName</span><span class="p">);</span>
        <span class="c1">//中心点</span>
        <span class="n">geoDistanceQueryBuilder</span><span class="p">.</span><span class="na">point</span><span class="p">(</span><span class="k">new</span> <span class="n">GeoPoint</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">));</span>
        <span class="c1">//距离（画圆的半径）单位：公里</span>
        <span class="n">geoDistanceQueryBuilder</span><span class="p">.</span><span class="na">distance</span><span class="p">(</span><span class="n">distance</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">DistanceUnit</span><span class="p">.</span><span class="na">KILOMETERS</span><span class="p">);</span>

        <span class="n">boolQueryBuilder</span><span class="p">.</span><span class="na">must</span><span class="p">(</span><span class="n">geoDistanceQueryBuilder</span><span class="p">);</span>
        <span class="n">searchQueryBuilder</span><span class="p">.</span><span class="na">withQuery</span><span class="p">(</span><span class="n">boolQueryBuilder</span><span class="p">);</span>

        <span class="c1">//排序，由近到远排序</span>
        <span class="n">GeoDistanceSortBuilder</span> <span class="n">geoDistanceSortBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GeoDistanceSortBuilder</span><span class="p">(</span><span class="n">fieldName</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">);</span>
        <span class="n">geoDistanceSortBuilder</span><span class="p">.</span><span class="na">order</span><span class="p">(</span><span class="n">SortOrder</span><span class="p">.</span><span class="na">ASC</span><span class="p">);</span> <span class="c1">//正序排序</span>
        <span class="n">geoDistanceSortBuilder</span><span class="p">.</span><span class="na">unit</span><span class="p">(</span><span class="n">DistanceUnit</span><span class="p">.</span><span class="na">KILOMETERS</span><span class="p">);</span> <span class="c1">//设置单位</span>
        <span class="n">searchQueryBuilder</span><span class="p">.</span><span class="na">withSort</span><span class="p">(</span><span class="n">geoDistanceSortBuilder</span><span class="p">);</span>

        <span class="n">AggregatedPage</span><span class="o">&lt;</span><span class="n">UserLocation</span><span class="o">&gt;</span> <span class="n">aggregatedPage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">elasticsearchTemplate</span><span class="p">.</span><span class="na">queryForPage</span><span class="p">(</span><span class="n">searchQueryBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">(),</span> <span class="n">UserLocation</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">CollUtil</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">aggregatedPage</span><span class="p">.</span><span class="na">getContent</span><span class="p">())){</span>
            <span class="k">return</span> <span class="n">pageInfo</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">pageInfo</span><span class="p">.</span><span class="na">setRecords</span><span class="p">(</span><span class="n">UserLocationVo</span><span class="p">.</span><span class="na">formatToList</span><span class="p">(</span><span class="n">aggregatedPage</span><span class="p">.</span><span class="na">getContent</span><span class="p">()));</span>

        <span class="k">return</span> <span class="n">pageInfo</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div>

<h4 id="213">2.1.3、单元测试<a class="headerlink" href="#213" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">//com.tanhua.dubbo.es.TestUserLocationApi</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQueryByUserId</span><span class="p">(){</span>
        <span class="n">UserLocationVo</span> <span class="n">userLocationVo</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">userLocationApi</span><span class="p">.</span><span class="na">queryByUserId</span><span class="p">(</span><span class="mi">1L</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">userLocationVo</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQueryUserFromLocation</span><span class="p">(){</span>
        <span class="n">UserLocationVo</span> <span class="n">userLocationVo</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">userLocationApi</span><span class="p">.</span><span class="na">queryByUserId</span><span class="p">(</span><span class="mi">1L</span><span class="p">);</span>
        <span class="n">PageInfo</span><span class="o">&lt;</span><span class="n">UserLocationVo</span><span class="o">&gt;</span> <span class="n">pageInfo</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">userLocationApi</span>
                <span class="p">.</span><span class="na">queryUserFromLocation</span><span class="p">(</span><span class="n">userLocationVo</span><span class="p">.</span><span class="na">getLongitude</span><span class="p">(),</span>
                        <span class="n">userLocationVo</span><span class="p">.</span><span class="na">getLatitude</span><span class="p">(),</span> <span class="mi">5000</span><span class="n">d</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
        <span class="n">pageInfo</span><span class="p">.</span><span class="na">getRecords</span><span class="p">().</span><span class="na">forEach</span><span class="p">(</span><span class="n">vo</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">vo</span><span class="p">));</span>
    <span class="p">}</span>
</code></pre></div>

<h3 id="22app">2.2、APP接口服务<a class="headerlink" href="#22app" title="Permanent link">&para;</a></h3>
<p>文档地址：https://mock-java.itheima.net/project/35/interface/api/611</p>
<h4 id="221nearuservo">2.2.1、NearUserVo<a class="headerlink" href="#221nearuservo" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.tanhua.server.vo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">lombok.AllArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">lombok.NoArgsConstructor</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NearUserVo</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="n">Long</span> <span class="n">userId</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">avatar</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">nickname</span><span class="p">;</span>

<span class="p">}</span>
</code></pre></div>

<h4 id="222tanhuacontroller">2.2.2、TanHuaController<a class="headerlink" href="#222tanhuacontroller" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">//com.tanhua.server.controller.TanHuaController</span>

    <span class="cm">/**</span>
<span class="cm">     * 搜附近</span>
<span class="cm">     *</span>
<span class="cm">     * @param gender</span>
<span class="cm">     * @param distance</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;search&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">NearUserVo</span><span class="o">&gt;&gt;</span> <span class="nf">queryNearUser</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;gender&quot;</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span> <span class="n">String</span> <span class="n">gender</span><span class="p">,</span>
                                                          <span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;distance&quot;</span><span class="p">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">&quot;2000&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">distance</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">NearUserVo</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">tanHuaService</span><span class="p">.</span><span class="na">queryNearUser</span><span class="p">(</span><span class="n">gender</span><span class="p">,</span> <span class="n">distance</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">list</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ResponseEntity</span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
    <span class="p">}</span>
</code></pre></div>

<h4 id="223tanhuaservice">2.2.3、TanHuaService<a class="headerlink" href="#223tanhuaservice" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">//com.tanhua.server.service.TanHuaService</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">NearUserVo</span><span class="o">&gt;</span> <span class="nf">queryNearUser</span><span class="p">(</span><span class="n">String</span> <span class="n">gender</span><span class="p">,</span> <span class="n">String</span> <span class="n">distance</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//查询当前用户的位置</span>
        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">UserThreadLocal</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
        <span class="n">UserLocationVo</span> <span class="n">userLocationVo</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">userLocationApi</span><span class="p">.</span><span class="na">queryByUserId</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ObjectUtil</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">userLocationVo</span><span class="p">)){</span>
            <span class="k">return</span> <span class="n">ListUtil</span><span class="p">.</span><span class="na">empty</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="n">PageInfo</span><span class="o">&lt;</span><span class="n">UserLocationVo</span><span class="o">&gt;</span> <span class="n">pageInfo</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">userLocationApi</span><span class="p">.</span><span class="na">queryUserFromLocation</span><span class="p">(</span><span class="n">userLocationVo</span><span class="p">.</span><span class="na">getLongitude</span><span class="p">(),</span>
                <span class="n">userLocationVo</span><span class="p">.</span><span class="na">getLatitude</span><span class="p">(),</span>
                <span class="n">Convert</span><span class="p">.</span><span class="na">toDouble</span><span class="p">(</span><span class="n">distance</span><span class="p">),</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="mi">50</span>
        <span class="p">);</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">UserLocationVo</span><span class="o">&gt;</span> <span class="n">records</span> <span class="o">=</span> <span class="n">pageInfo</span><span class="p">.</span><span class="na">getRecords</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">CollUtil</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">records</span><span class="p">)){</span>
            <span class="k">return</span> <span class="n">ListUtil</span><span class="p">.</span><span class="na">empty</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">//构造筛选条件</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">userIdList</span> <span class="o">=</span> <span class="n">CollUtil</span><span class="p">.</span><span class="na">getFieldValues</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="s">&quot;userId&quot;</span><span class="p">);</span>
        <span class="n">QueryWrapper</span><span class="o">&lt;</span><span class="n">UserInfo</span><span class="o">&gt;</span> <span class="n">queryWrapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueryWrapper</span><span class="o">&lt;&gt;</span><span class="p">();</span>
        <span class="n">queryWrapper</span><span class="p">.</span><span class="na">in</span><span class="p">(</span><span class="s">&quot;user_id&quot;</span><span class="p">,</span> <span class="n">userIdList</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">StrUtil</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">gender</span><span class="p">,</span> <span class="s">&quot;man&quot;</span><span class="p">)){</span>
            <span class="n">queryWrapper</span><span class="p">.</span><span class="na">eq</span><span class="p">(</span><span class="s">&quot;sex&quot;</span><span class="p">,</span> <span class="n">SexEnum</span><span class="p">.</span><span class="na">MAN</span><span class="p">);</span>
        <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">StrUtil</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">gender</span><span class="p">,</span> <span class="s">&quot;woman&quot;</span><span class="p">)){</span>
            <span class="n">queryWrapper</span><span class="p">.</span><span class="na">eq</span><span class="p">(</span><span class="s">&quot;sex&quot;</span><span class="p">,</span> <span class="n">SexEnum</span><span class="p">.</span><span class="na">WOMAN</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">UserInfo</span><span class="o">&gt;</span> <span class="n">userInfoList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">userInfoService</span><span class="p">.</span><span class="na">queryUserInfoList</span><span class="p">(</span><span class="n">queryWrapper</span><span class="p">);</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">NearUserVo</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">UserLocationVo</span> <span class="n">locationVo</span> <span class="p">:</span> <span class="n">records</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//排除自己</span>
            <span class="k">if</span><span class="p">(</span><span class="n">ObjectUtil</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">locationVo</span><span class="p">.</span><span class="na">getUserId</span><span class="p">(),</span> <span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">())){</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">for</span> <span class="p">(</span><span class="n">UserInfo</span> <span class="n">userInfo</span> <span class="p">:</span> <span class="n">userInfoList</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">ObjectUtil</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">locationVo</span><span class="p">.</span><span class="na">getUserId</span><span class="p">(),</span> <span class="n">userInfo</span><span class="p">.</span><span class="na">getUserId</span><span class="p">())){</span>

                    <span class="n">NearUserVo</span> <span class="n">nearUserVo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NearUserVo</span><span class="p">();</span>
                    <span class="n">nearUserVo</span><span class="p">.</span><span class="na">setUserId</span><span class="p">(</span><span class="n">userInfo</span><span class="p">.</span><span class="na">getUserId</span><span class="p">());</span>
                    <span class="n">nearUserVo</span><span class="p">.</span><span class="na">setAvatar</span><span class="p">(</span><span class="n">userInfo</span><span class="p">.</span><span class="na">getLogo</span><span class="p">());</span>
                    <span class="n">nearUserVo</span><span class="p">.</span><span class="na">setNickname</span><span class="p">(</span><span class="n">userInfo</span><span class="p">.</span><span class="na">getNickName</span><span class="p">());</span>
                    <span class="n">result</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">nearUserVo</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div>

<h4 id="224">2.2.4、测试<a class="headerlink" href="#224" title="Permanent link">&para;</a></h4>
<p><img alt="image-20210114102844696" src="assets/image-20210114102844696.png" /></p>
<h2 id="3">3、探花<a class="headerlink" href="#3" title="Permanent link">&para;</a></h2>
<p>探花功能是将推荐的好友随机的通过卡片的形式展现出来，用户可以选择左滑、右滑操作，左滑：“不喜欢”，右滑：“喜欢”。</p>
<p>喜欢：如果双方喜欢，那么就会成为好友。</p>
<p><img alt="1572105631737" src="assets/1572105631737.png" /></p>
<p>如果已经喜欢或不喜欢的用户在列表中不再显示。</p>
<h3 id="31dubbo">3.1、喜欢的dubbo服务<a class="headerlink" href="#31dubbo" title="Permanent link">&para;</a></h3>
<p>用户的喜欢与不喜欢列表需要保存在redis中，为了防止redis中的数据丢失，同时需要将数据保存到mongodb进行持久化保存。</p>
<h4 id="311">3.1.1、实体对象<a class="headerlink" href="#311" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.tanhua.dubbo.server.pojo</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">lombok.AllArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">lombok.NoArgsConstructor</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.bson.types.ObjectId</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.mongodb.core.index.Indexed</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.mongodb.core.mapping.Document</span><span class="p">;</span>

<span class="nd">@Data</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@Document</span><span class="p">(</span><span class="n">collection</span> <span class="o">=</span> <span class="s">&quot;user_like&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserLike</span> <span class="kd">implements</span> <span class="n">java</span><span class="p">.</span><span class="na">io</span><span class="p">.</span><span class="na">Serializable</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">6739966698394686523L</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">ObjectId</span> <span class="n">id</span><span class="p">;</span>
    <span class="nd">@Indexed</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">userId</span><span class="p">;</span> <span class="c1">//用户id，自己</span>
    <span class="nd">@Indexed</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">likeUserId</span><span class="p">;</span> <span class="c1">//喜欢的用户id，对方</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">created</span><span class="p">;</span> <span class="c1">//创建时间</span>

<span class="p">}</span>
</code></pre></div>

<h4 id="312">3.1.2、定义接口<a class="headerlink" href="#312" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.tanhua.dubbo.server.api</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserLikeApi</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * 喜欢</span>
<span class="cm">     *</span>
<span class="cm">     * @param userId</span>
<span class="cm">     * @param likeUserId</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="n">Boolean</span> <span class="nf">likeUser</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">,</span> <span class="n">Long</span> <span class="n">likeUserId</span><span class="p">);</span>

    <span class="cm">/**</span>
<span class="cm">     * 不喜欢</span>
<span class="cm">     *</span>
<span class="cm">     * @param userId</span>
<span class="cm">     * @param likeUserId</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="n">Boolean</span> <span class="nf">notLikeUser</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">,</span> <span class="n">Long</span> <span class="n">likeUserId</span><span class="p">);</span>


    <span class="cm">/**</span>
<span class="cm">     * 是否相互喜欢</span>
<span class="cm">     *</span>
<span class="cm">     * @param userId</span>
<span class="cm">     * @param likeUserId</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="n">Boolean</span> <span class="nf">isMutualLike</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">,</span> <span class="n">Long</span> <span class="n">likeUserId</span><span class="p">);</span>


    <span class="cm">/**</span>
<span class="cm">     * 查询喜欢列表</span>
<span class="cm">     *</span>
<span class="cm">     * @param userId</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="nf">queryLikeList</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">);</span>

    <span class="cm">/**</span>
<span class="cm">     * 查询不喜欢列表</span>
<span class="cm">     *</span>
<span class="cm">     * @param userId</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="nf">queryNotLikeList</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div>

<h4 id="313">3.1.3、编写实现<a class="headerlink" href="#313" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.tanhua.dubbo.server.api</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">cn.hutool.core.collection.CollUtil</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">cn.hutool.core.collection.ListUtil</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">cn.hutool.core.convert.Convert</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.alibaba.dubbo.config.annotation.Service</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.tanhua.dubbo.server.pojo.UserLike</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.bson.types.ObjectId</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.mongodb.core.MongoTemplate</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.mongodb.core.query.Criteria</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.mongodb.core.query.Query</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.redis.core.RedisTemplate</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="p">;</span>

<span class="nd">@Service</span><span class="p">(</span><span class="n">version</span> <span class="o">=</span> <span class="s">&quot;1.0.0&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserLikeApiImpl</span> <span class="kd">implements</span> <span class="n">UserLikeApi</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">MongoTemplate</span> <span class="n">mongoTemplate</span><span class="p">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">redisTemplate</span><span class="p">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">LIKE_REDIS_KEY_PREFIX</span> <span class="o">=</span> <span class="s">&quot;USER_LIKE_&quot;</span><span class="p">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">NOT_LIKE_REDIS_KEY_PREFIX</span> <span class="o">=</span> <span class="s">&quot;USER_NOT_LIKE_&quot;</span><span class="p">;</span>


    <span class="cm">/**</span>
<span class="cm">     * 喜欢</span>
<span class="cm">     *</span>
<span class="cm">     * @param userId</span>
<span class="cm">     * @param likeUserId</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Boolean</span> <span class="nf">likeUser</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">,</span> <span class="n">Long</span> <span class="n">likeUserId</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//判断该用户是否已经喜欢，如果已经喜欢就返回</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">isLike</span><span class="p">(</span><span class="n">userId</span><span class="p">,</span> <span class="n">likeUserId</span><span class="p">)){</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">UserLike</span> <span class="n">userLike</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UserLike</span><span class="p">();</span>
        <span class="n">userLike</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="n">ObjectId</span><span class="p">.</span><span class="na">get</span><span class="p">());</span>
        <span class="n">userLike</span><span class="p">.</span><span class="na">setUserId</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>
        <span class="n">userLike</span><span class="p">.</span><span class="na">setLikeUserId</span><span class="p">(</span><span class="n">likeUserId</span><span class="p">);</span>
        <span class="n">userLike</span><span class="p">.</span><span class="na">setCreated</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>

        <span class="c1">//将数据存储到MongoDB</span>
        <span class="k">this</span><span class="p">.</span><span class="na">mongoTemplate</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">userLike</span><span class="p">);</span>

        <span class="c1">//用户的喜欢数据保存到redis</span>
        <span class="c1">//用户1：key -&gt; USER_LIKE_1 , value -&gt; 2, &quot;1&quot;</span>
        <span class="c1">//用户1：key -&gt; USER_LIKE_1 , value -&gt; 3, &quot;1&quot;</span>
        <span class="c1">//用户2：key -&gt; USER_LIKE_2 , value -&gt; 4, &quot;1&quot;</span>
        <span class="n">String</span> <span class="n">redisKey</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">getLikeRedisKey</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>
        <span class="n">String</span> <span class="n">hashKey</span> <span class="o">=</span> <span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">likeUserId</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">redisTemplate</span><span class="p">.</span><span class="na">opsForHash</span><span class="p">().</span><span class="na">put</span><span class="p">(</span><span class="n">redisKey</span><span class="p">,</span> <span class="n">hashKey</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">);</span>

        <span class="c1">//判断，喜欢的用户是否在不喜欢的列表中，如果在，就需要删除数据</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">isNotLike</span><span class="p">(</span><span class="n">userId</span><span class="p">,</span> <span class="n">likeUserId</span><span class="p">)){</span>
            <span class="n">redisKey</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">getNotLikeRedisKey</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="na">redisTemplate</span><span class="p">.</span><span class="na">opsForHash</span><span class="p">().</span><span class="na">delete</span><span class="p">(</span><span class="n">redisKey</span><span class="p">,</span> <span class="n">hashKey</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 获取喜欢数据的redis key</span>
<span class="cm">     *</span>
<span class="cm">     * @param userId</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="nf">getLikeRedisKey</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">){</span>
        <span class="k">return</span> <span class="n">LIKE_REDIS_KEY_PREFIX</span> <span class="o">+</span> <span class="n">userId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 获取不喜欢数据的redis key</span>
<span class="cm">     *</span>
<span class="cm">     * @param userId</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="nf">getNotLikeRedisKey</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">){</span>
        <span class="k">return</span> <span class="n">NOT_LIKE_REDIS_KEY_PREFIX</span> <span class="o">+</span> <span class="n">userId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 是否喜欢</span>
<span class="cm">     *</span>
<span class="cm">     * @param userId</span>
<span class="cm">     * @param likeUserId</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="n">Boolean</span> <span class="nf">isLike</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">,</span> <span class="n">Long</span> <span class="n">likeUserId</span><span class="p">){</span>
        <span class="n">String</span> <span class="n">redisKey</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">getLikeRedisKey</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>
        <span class="n">String</span> <span class="n">hashKey</span> <span class="o">=</span> <span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">likeUserId</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">redisTemplate</span><span class="p">.</span><span class="na">opsForHash</span><span class="p">().</span><span class="na">hasKey</span><span class="p">(</span><span class="n">redisKey</span><span class="p">,</span> <span class="n">hashKey</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 是否不喜欢</span>
<span class="cm">     *</span>
<span class="cm">     * @param userId</span>
<span class="cm">     * @param likeUserId</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="n">Boolean</span> <span class="nf">isNotLike</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">,</span> <span class="n">Long</span> <span class="n">likeUserId</span><span class="p">){</span>
        <span class="n">String</span> <span class="n">redisKey</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">getNotLikeRedisKey</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>
        <span class="n">String</span> <span class="n">hashKey</span> <span class="o">=</span> <span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">likeUserId</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">redisTemplate</span><span class="p">.</span><span class="na">opsForHash</span><span class="p">().</span><span class="na">hasKey</span><span class="p">(</span><span class="n">redisKey</span><span class="p">,</span> <span class="n">hashKey</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Boolean</span> <span class="nf">notLikeUser</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">,</span> <span class="n">Long</span> <span class="n">likeUserId</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//判断用户是否已经不喜欢，如果已经不喜欢，就返回</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">isNotLike</span><span class="p">(</span><span class="n">userId</span><span class="p">,</span> <span class="n">likeUserId</span><span class="p">)){</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">//将用户保存到不喜欢列表中</span>
        <span class="n">String</span> <span class="n">redisKey</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">getNotLikeRedisKey</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>
        <span class="n">String</span> <span class="n">hashKey</span> <span class="o">=</span> <span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">likeUserId</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">redisTemplate</span><span class="p">.</span><span class="na">opsForHash</span><span class="p">().</span><span class="na">put</span><span class="p">(</span><span class="n">redisKey</span><span class="p">,</span> <span class="n">hashKey</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">);</span>

        <span class="c1">//判断用户是否在喜欢列表中，如果存在的话，需要删除数据</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">isLike</span><span class="p">(</span><span class="n">userId</span><span class="p">,</span> <span class="n">likeUserId</span><span class="p">)){</span>
            <span class="c1">//删除MongoDB数据</span>
            <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">.</span><span class="na">query</span><span class="p">(</span><span class="n">Criteria</span>
                    <span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="s">&quot;userId&quot;</span><span class="p">).</span><span class="na">is</span><span class="p">(</span><span class="n">userId</span><span class="p">)</span>
                    <span class="p">.</span><span class="na">and</span><span class="p">(</span><span class="s">&quot;likeUserId&quot;</span><span class="p">).</span><span class="na">is</span><span class="p">(</span><span class="n">likeUserId</span><span class="p">)</span>
            <span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="na">mongoTemplate</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">UserLike</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

            <span class="c1">//删除redis中的数据</span>
            <span class="n">redisKey</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">getLikeRedisKey</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="na">redisTemplate</span><span class="p">.</span><span class="na">opsForHash</span><span class="p">().</span><span class="na">delete</span><span class="p">(</span><span class="n">redisKey</span><span class="p">,</span> <span class="n">hashKey</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Boolean</span> <span class="nf">isMutualLike</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">,</span> <span class="n">Long</span> <span class="n">likeUserId</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">isLike</span><span class="p">(</span><span class="n">userId</span><span class="p">,</span> <span class="n">likeUserId</span><span class="p">)</span>
                <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="na">isLike</span><span class="p">(</span><span class="n">likeUserId</span><span class="p">,</span> <span class="n">userId</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="nf">queryLikeList</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 查询redis</span>
        <span class="n">String</span> <span class="n">redisKey</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">getLikeRedisKey</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">keys</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">redisTemplate</span><span class="p">.</span><span class="na">opsForHash</span><span class="p">().</span><span class="na">keys</span><span class="p">(</span><span class="n">redisKey</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">CollUtil</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">keys</span><span class="p">)){</span>
            <span class="k">return</span> <span class="n">ListUtil</span><span class="p">.</span><span class="na">empty</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">keys</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
        <span class="n">keys</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">o</span> <span class="o">-&gt;</span> <span class="n">result</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">Convert</span><span class="p">.</span><span class="na">toLong</span><span class="p">(</span><span class="n">o</span><span class="p">)));</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="nf">queryNotLikeList</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 查询redis</span>
        <span class="n">String</span> <span class="n">redisKey</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">getNotLikeRedisKey</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">keys</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">redisTemplate</span><span class="p">.</span><span class="na">opsForHash</span><span class="p">().</span><span class="na">keys</span><span class="p">(</span><span class="n">redisKey</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">CollUtil</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">keys</span><span class="p">)){</span>
            <span class="k">return</span> <span class="n">ListUtil</span><span class="p">.</span><span class="na">empty</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">keys</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
        <span class="n">keys</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">o</span> <span class="o">-&gt;</span> <span class="n">result</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">Convert</span><span class="p">.</span><span class="na">toLong</span><span class="p">(</span><span class="n">o</span><span class="p">)));</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="314">3.1.4、单元测试<a class="headerlink" href="#314" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.tanhua.dubbo.server.api</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringRunner</span><span class="p">;</span>

<span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@SpringBootTest</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestUserLikeApi</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">UserLikeApi</span> <span class="n">userLikeApi</span><span class="p">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testUserLike</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">userLikeApi</span><span class="p">.</span><span class="na">likeUser</span><span class="p">(</span><span class="mi">1L</span><span class="p">,</span> <span class="mi">2L</span><span class="p">));</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">userLikeApi</span><span class="p">.</span><span class="na">likeUser</span><span class="p">(</span><span class="mi">1L</span><span class="p">,</span> <span class="mi">3L</span><span class="p">));</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">userLikeApi</span><span class="p">.</span><span class="na">likeUser</span><span class="p">(</span><span class="mi">1L</span><span class="p">,</span> <span class="mi">4L</span><span class="p">));</span>

        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">userLikeApi</span><span class="p">.</span><span class="na">notLikeUser</span><span class="p">(</span><span class="mi">1L</span><span class="p">,</span> <span class="mi">5L</span><span class="p">));</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">userLikeApi</span><span class="p">.</span><span class="na">notLikeUser</span><span class="p">(</span><span class="mi">1L</span><span class="p">,</span> <span class="mi">6L</span><span class="p">));</span>

        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">userLikeApi</span><span class="p">.</span><span class="na">likeUser</span><span class="p">(</span><span class="mi">1L</span><span class="p">,</span> <span class="mi">5L</span><span class="p">));</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">userLikeApi</span><span class="p">.</span><span class="na">notLikeUser</span><span class="p">(</span><span class="mi">1L</span><span class="p">,</span> <span class="mi">2L</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQueryList</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="na">userLikeApi</span><span class="p">.</span><span class="na">queryLikeList</span><span class="p">(</span><span class="mi">1L</span><span class="p">).</span><span class="na">forEach</span><span class="p">(</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;-------&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">userLikeApi</span><span class="p">.</span><span class="na">queryNotLikeList</span><span class="p">(</span><span class="mi">1L</span><span class="p">).</span><span class="na">forEach</span><span class="p">(</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="32dubbo">3.2、查询推荐列表dubbo服务<a class="headerlink" href="#32dubbo" title="Permanent link">&para;</a></h3>
<h4 id="321">3.2.1、定义接口<a class="headerlink" href="#321" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">//com.tanhua.dubbo.server.api.RecommendUserApi</span>

<span class="cm">/**</span>
<span class="cm"> * 查询探花列表，查询时需要排除不喜欢列表用户</span>
<span class="cm"> *</span>
<span class="cm"> * @param userId</span>
<span class="cm"> * @param count</span>
<span class="cm"> * @return</span>
<span class="cm"> */</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">RecommendUser</span><span class="o">&gt;</span> <span class="nf">queryCardList</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">,</span> <span class="n">Integer</span> <span class="n">count</span><span class="p">);</span>
</code></pre></div>

<h4 id="322">3.2.2、编写实现<a class="headerlink" href="#322" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">//com.tanhua.dubbo.server.api.RecommendUserApiImpl</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">RecommendUser</span><span class="o">&gt;</span> <span class="nf">queryCardList</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">,</span> <span class="n">Integer</span> <span class="n">count</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//设置分页以及排序，按照得分倒序排序</span>
        <span class="n">PageRequest</span> <span class="n">pageRequest</span> <span class="o">=</span> <span class="n">PageRequest</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">Sort</span><span class="p">.</span><span class="na">by</span><span class="p">(</span><span class="n">Sort</span><span class="p">.</span><span class="na">Order</span><span class="p">.</span><span class="na">desc</span><span class="p">(</span><span class="s">&quot;score&quot;</span><span class="p">)));</span>

        <span class="c1">//排除已喜欢或不喜欢的用户</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">userIds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
        <span class="c1">//查询喜欢列表</span>
        <span class="n">userIds</span><span class="p">.</span><span class="na">addAll</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">userLikeApi</span><span class="p">.</span><span class="na">queryLikeList</span><span class="p">(</span><span class="n">userId</span><span class="p">));</span>

        <span class="c1">//查询不喜欢列表</span>
        <span class="n">userIds</span><span class="p">.</span><span class="na">addAll</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">userLikeApi</span><span class="p">.</span><span class="na">queryNotLikeList</span><span class="p">(</span><span class="n">userId</span><span class="p">));</span>

        <span class="c1">//构造查询条件</span>
        <span class="n">Criteria</span> <span class="n">criteria</span> <span class="o">=</span> <span class="n">Criteria</span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="s">&quot;toUserId&quot;</span><span class="p">).</span><span class="na">is</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">CollUtil</span><span class="p">.</span><span class="na">isNotEmpty</span><span class="p">(</span><span class="n">userIds</span><span class="p">)){</span>
            <span class="c1">//加入到查询条件中，排除这些用户</span>
            <span class="n">criteria</span><span class="p">.</span><span class="na">andOperator</span><span class="p">(</span><span class="n">Criteria</span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="s">&quot;userId&quot;</span><span class="p">).</span><span class="na">nin</span><span class="p">(</span><span class="n">userIds</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">.</span><span class="na">query</span><span class="p">(</span><span class="n">criteria</span><span class="p">).</span><span class="na">with</span><span class="p">(</span><span class="n">pageRequest</span><span class="p">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">RecommendUser</span><span class="o">&gt;</span> <span class="n">recommendUserList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">mongoTemplate</span><span class="p">.</span><span class="na">find</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">RecommendUser</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">recommendUserList</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div>

<h4 id="323">3.2.3、单元测试<a class="headerlink" href="#323" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">//com.tanhua.dubbo.server.api.TestRecommendUserApi</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQueryCardList</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="na">recommendUserApi</span><span class="p">.</span><span class="na">queryCardList</span><span class="p">(</span><span class="mi">2L</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
            <span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">recommendUser</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">recommendUser</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="33app">3.3、查询推荐列表APP接口实现<a class="headerlink" href="#33app" title="Permanent link">&para;</a></h3>
<p>接口文档：https://mock-java.itheima.net/project/35/interface/api/593</p>
<h4 id="331tanhuacontroller">3.3.1、TanHuaController<a class="headerlink" href="#331tanhuacontroller" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>    <span class="cm">/**</span>
<span class="cm">     * 探花</span>
<span class="cm">     *</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;cards&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">TodayBest</span><span class="o">&gt;&gt;</span> <span class="nf">queryCardsList</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">TodayBest</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">tanHuaService</span><span class="p">.</span><span class="na">queryCardsList</span><span class="p">();</span>
            <span class="k">return</span> <span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">list</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ResponseEntity</span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
    <span class="p">}</span>
</code></pre></div>

<h4 id="332tanhuaservice">3.3.2、TanHuaService<a class="headerlink" href="#332tanhuaservice" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c">#默认推荐列表</span>
<span class="na">tanhua.default.recommend.users</span><span class="o">=</span><span class="s">2,3,8,10,18,20,24,29,27,32,36,37,56,64,75,88</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * 查询推荐卡片列表，从推荐列表中随机选取10个用户</span>
<span class="cm"> *</span>
<span class="cm"> * @return</span>
<span class="cm"> */</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">TodayBest</span><span class="o">&gt;</span> <span class="nf">queryCardsList</span><span class="p">()</span> <span class="p">{</span>

        <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">UserThreadLocal</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
        <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>

        <span class="c1">//查询到的50条数据，并不是用来直接展现，需要从这50条数据中随机返回一些数据</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">RecommendUser</span><span class="o">&gt;</span> <span class="n">recommendUserList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">recommendUserService</span><span class="p">.</span><span class="na">queryCardList</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span> <span class="n">count</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">CollUtil</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">recommendUserList</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">recommendUserList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
            <span class="c1">//默认推荐列表</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">StrUtil</span><span class="p">.</span><span class="na">split</span><span class="p">(</span><span class="n">defaultRecommendUsers</span><span class="p">,</span> <span class="sc">&#39;,&#39;</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">String</span> <span class="n">userId</span> <span class="p">:</span> <span class="n">list</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">RecommendUser</span> <span class="n">recommendUser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RecommendUser</span><span class="p">();</span>

                <span class="n">recommendUser</span><span class="p">.</span><span class="na">setToUserId</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
                <span class="n">recommendUser</span><span class="p">.</span><span class="na">setUserId</span><span class="p">(</span><span class="n">Convert</span><span class="p">.</span><span class="na">toLong</span><span class="p">(</span><span class="n">userId</span><span class="p">));</span>
                <span class="n">recommendUserList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">recommendUser</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">//计算展现的数量，默认展现10个</span>
        <span class="kt">int</span> <span class="n">showCount</span> <span class="o">=</span> <span class="n">Math</span><span class="p">.</span><span class="na">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">recommendUserList</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">RecommendUser</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">showCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//TODO 可能重复</span>
            <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">RandomUtil</span><span class="p">.</span><span class="na">randomInt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">recommendUserList</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
            <span class="n">RecommendUser</span> <span class="n">recommendUser</span> <span class="o">=</span> <span class="n">recommendUserList</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
            <span class="n">result</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">recommendUser</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">userIdList</span> <span class="o">=</span> <span class="n">CollUtil</span><span class="p">.</span><span class="na">getFieldValues</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s">&quot;userId&quot;</span><span class="p">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">UserInfo</span><span class="o">&gt;</span> <span class="n">userInfoList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">userInfoService</span><span class="p">.</span><span class="na">queryUserInfoByUserIdList</span><span class="p">(</span><span class="n">userIdList</span><span class="p">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">TodayBest</span><span class="o">&gt;</span> <span class="n">todayBests</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">UserInfo</span> <span class="n">userInfo</span> <span class="p">:</span> <span class="n">userInfoList</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">TodayBest</span> <span class="n">todayBest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TodayBest</span><span class="p">();</span>
            <span class="n">todayBest</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="n">userInfo</span><span class="p">.</span><span class="na">getUserId</span><span class="p">());</span>
            <span class="n">todayBest</span><span class="p">.</span><span class="na">setAge</span><span class="p">(</span><span class="n">userInfo</span><span class="p">.</span><span class="na">getAge</span><span class="p">());</span>
            <span class="n">todayBest</span><span class="p">.</span><span class="na">setAvatar</span><span class="p">(</span><span class="n">userInfo</span><span class="p">.</span><span class="na">getLogo</span><span class="p">());</span>
            <span class="n">todayBest</span><span class="p">.</span><span class="na">setGender</span><span class="p">(</span><span class="n">userInfo</span><span class="p">.</span><span class="na">getSex</span><span class="p">().</span><span class="na">name</span><span class="p">().</span><span class="na">toLowerCase</span><span class="p">());</span>
            <span class="n">todayBest</span><span class="p">.</span><span class="na">setNickname</span><span class="p">(</span><span class="n">userInfo</span><span class="p">.</span><span class="na">getNickName</span><span class="p">());</span>
            <span class="n">todayBest</span><span class="p">.</span><span class="na">setTags</span><span class="p">(</span><span class="n">Convert</span><span class="p">.</span><span class="na">toStrArray</span><span class="p">(</span><span class="n">StrUtil</span><span class="p">.</span><span class="na">split</span><span class="p">(</span><span class="n">userInfo</span><span class="p">.</span><span class="na">getTags</span><span class="p">(),</span> <span class="sc">&#39;,&#39;</span><span class="p">)));</span>
            <span class="n">todayBest</span><span class="p">.</span><span class="na">setFateValue</span><span class="p">(</span><span class="mi">0</span><span class="n">L</span><span class="p">);</span>

            <span class="n">todayBests</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">todayBest</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">todayBests</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div>

<h4 id="333">3.3.3、测试<a class="headerlink" href="#333" title="Permanent link">&para;</a></h4>
<p><img alt="image-20210114162852839" src="assets/image-20210114162852839.png" /></p>
<p><img alt="image-20210114162907596" src="assets/image-20210114162907596.png" /></p>
<p>效果：</p>
<p><img alt="image-20210114163241129" src="assets/image-20210114163241129.png" /></p>
<h3 id="34">3.4、左滑右滑<a class="headerlink" href="#34" title="Permanent link">&para;</a></h3>
<p>左滑：“不喜欢”，右滑：“喜欢”，如果双方喜欢，那么就会成为好友。</p>
<p>喜欢的接口文档：https://mock-java.itheima.net/project/35/interface/api/599</p>
<p>不喜欢的接口文档：https://mock-java.itheima.net/project/35/interface/api/605</p>
<h4 id="341tanhuacontroller">3.4.1、TanHuaController<a class="headerlink" href="#341tanhuacontroller" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * 喜欢</span>
<span class="cm"> *</span>
<span class="cm"> * @param likeUserId</span>
<span class="cm"> * @return</span>
<span class="cm"> */</span>
<span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;{id}/love&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">likeUser</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">Long</span> <span class="n">likeUserId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">tanHuaService</span><span class="p">.</span><span class="na">likeUser</span><span class="p">(</span><span class="n">likeUserId</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ResponseEntity</span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * 不喜欢</span>
<span class="cm"> *</span>
<span class="cm"> * @param likeUserId</span>
<span class="cm"> * @return</span>
<span class="cm"> */</span>
<span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;{id}/unlove&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">notLikeUser</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">Long</span> <span class="n">likeUserId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">tanHuaService</span><span class="p">.</span><span class="na">notLikeUser</span><span class="p">(</span><span class="n">likeUserId</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ResponseEntity</span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="342tanhuaservice">3.4.2、TanHuaService<a class="headerlink" href="#342tanhuaservice" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">//com.tanhua.server.service.TanHuaService</span>

<span class="kd">public</span> <span class="n">Boolean</span> <span class="nf">likeUser</span><span class="p">(</span><span class="n">Long</span> <span class="n">likeUserId</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">UserThreadLocal</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
    <span class="n">Boolean</span> <span class="n">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">userLikeApi</span><span class="p">.</span><span class="na">likeUser</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span> <span class="n">likeUserId</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">userLikeApi</span><span class="p">.</span><span class="na">isMutualLike</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span> <span class="n">likeUserId</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">//相互喜欢成为好友</span>
        <span class="k">this</span><span class="p">.</span><span class="na">imService</span><span class="p">.</span><span class="na">contactUser</span><span class="p">(</span><span class="n">likeUserId</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="n">Boolean</span> <span class="nf">notLikeUser</span><span class="p">(</span><span class="n">Long</span> <span class="n">likeUserId</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">UserThreadLocal</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">userLikeApi</span><span class="p">.</span><span class="na">notLikeUser</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span> <span class="n">likeUserId</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="343">3.4.3、测试<a class="headerlink" href="#343" title="Permanent link">&para;</a></h4>
<p><img alt="image-20210114165501156" src="assets/image-20210114165501156.png" /></p>
<p><img alt="image-20210114165651535" src="assets/image-20210114165651535.png" /></p>
<p>user_like表，可以看到已经相互喜欢了：</p>
<p><img alt="image-20210114165721204" src="assets/image-20210114165721204.png" /></p>
<p>tanhua_users表，可以看到相互是好友了：</p>
<p><img alt="image-20210114170129360" src="assets/image-20210114170129360.png" /></p>
<p>环信平台：</p>
<p><img alt="image-20210114170153850" src="assets/image-20210114170153850.png" /></p>
<h2 id="4">4、用户资料<a class="headerlink" href="#4" title="Permanent link">&para;</a></h2>
<p>在我的中心模块中，可以对个人信息做修改。</p>
<p><img alt="image-20210114203734594" src="assets/image-20210114203734594.png" /></p>
<h3 id="41">4.1、基本信息<a class="headerlink" href="#41" title="Permanent link">&para;</a></h3>
<p>在前面实现的查询个人信息接口中，已经返回个人基本数据，所以可以直接展现出个人信息，下面只需要进行实现数据的保存即可。</p>
<h4 id="441">4.4.1、接口信息<a class="headerlink" href="#441" title="Permanent link">&para;</a></h4>
<p>接口地址：https://mock-java.itheima.net/project/35/interface/api/887</p>
<p><img alt="image-20210114204120298" src="assets/image-20210114204120298.png" /></p>
<p>请求参数：</p>
<h4 id="_2"><img alt="image-20210114204151930" src="assets/image-20210114204151930.png" /><a class="headerlink" href="#_2" title="Permanent link">&para;</a></h4>
<h4 id="442mycentercontroller">4.4.2、MyCenterController<a class="headerlink" href="#442mycentercontroller" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">//com.tanhua.server.controller.MyCenterController</span>

<span class="cm">/**</span>
<span class="cm"> * 更新用户信息</span>
<span class="cm"> *</span>
<span class="cm"> * @param userInfoVo</span>
<span class="cm"> * @return</span>
<span class="cm"> */</span>
<span class="nd">@PutMapping</span>
<span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">updateUserInfo</span><span class="p">(</span><span class="nd">@RequestBody</span> <span class="n">UserInfoVo</span> <span class="n">userInfoVo</span><span class="p">){</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">Boolean</span> <span class="n">bool</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">myCenterService</span><span class="p">.</span><span class="na">updateUserInfo</span><span class="p">(</span><span class="n">userInfoVo</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">bool</span><span class="p">){</span>
            <span class="k">return</span> <span class="n">ResponseEntity</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ResponseEntity</span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="443mycenterservice">4.4.3、MyCenterService<a class="headerlink" href="#443mycenterservice" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">//com.tanhua.server.service.MyCenterService</span>

<span class="kd">public</span> <span class="n">Boolean</span> <span class="nf">updateUserInfo</span><span class="p">(</span><span class="n">UserInfoVo</span> <span class="n">userInfoVo</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">UserThreadLocal</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
    <span class="n">UserInfo</span> <span class="n">userInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UserInfo</span><span class="p">();</span>
    <span class="n">userInfo</span><span class="p">.</span><span class="na">setUserId</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
    <span class="n">userInfo</span><span class="p">.</span><span class="na">setAge</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">userInfoVo</span><span class="p">.</span><span class="na">getAge</span><span class="p">()));</span>
    <span class="n">userInfo</span><span class="p">.</span><span class="na">setSex</span><span class="p">(</span><span class="n">StringUtils</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">userInfoVo</span><span class="p">.</span><span class="na">getGender</span><span class="p">(),</span> <span class="s">&quot;man&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="n">SexEnum</span><span class="p">.</span><span class="na">MAN</span> <span class="p">:</span> <span class="n">SexEnum</span><span class="p">.</span><span class="na">WOMAN</span><span class="p">);</span>
    <span class="n">userInfo</span><span class="p">.</span><span class="na">setBirthday</span><span class="p">(</span><span class="n">userInfoVo</span><span class="p">.</span><span class="na">getBirthday</span><span class="p">());</span>
    <span class="n">userInfo</span><span class="p">.</span><span class="na">setCity</span><span class="p">(</span><span class="n">userInfoVo</span><span class="p">.</span><span class="na">getCity</span><span class="p">());</span>
    <span class="n">userInfo</span><span class="p">.</span><span class="na">setEdu</span><span class="p">(</span><span class="n">userInfoVo</span><span class="p">.</span><span class="na">getEducation</span><span class="p">());</span>
    <span class="n">userInfo</span><span class="p">.</span><span class="na">setIncome</span><span class="p">(</span><span class="n">StringUtils</span><span class="p">.</span><span class="na">replaceAll</span><span class="p">(</span><span class="n">userInfoVo</span><span class="p">.</span><span class="na">getIncome</span><span class="p">(),</span> <span class="s">&quot;K&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">));</span>
    <span class="n">userInfo</span><span class="p">.</span><span class="na">setIndustry</span><span class="p">(</span><span class="n">userInfoVo</span><span class="p">.</span><span class="na">getProfession</span><span class="p">());</span>
    <span class="n">userInfo</span><span class="p">.</span><span class="na">setMarriage</span><span class="p">(</span><span class="n">userInfoVo</span><span class="p">.</span><span class="na">getMarriage</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="s">&quot;已婚&quot;</span> <span class="p">:</span> <span class="s">&quot;未婚&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">userInfoService</span><span class="p">.</span><span class="na">updateUserInfoByUserId</span><span class="p">(</span><span class="n">userInfo</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="444userinfoservice">4.4.4、UserInfoService<a class="headerlink" href="#444userinfoservice" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">//com.tanhua.server.service.UserInfoService</span>

<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">updateUserInfoByUserId</span><span class="p">(</span><span class="n">UserInfo</span> <span class="n">userInfo</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">QueryWrapper</span><span class="o">&lt;</span><span class="n">UserInfo</span><span class="o">&gt;</span> <span class="n">queryWrapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueryWrapper</span><span class="o">&lt;&gt;</span><span class="p">();</span>
    <span class="n">queryWrapper</span><span class="p">.</span><span class="na">eq</span><span class="p">(</span><span class="s">&quot;user_id&quot;</span><span class="p">,</span> <span class="n">userInfo</span><span class="p">.</span><span class="na">getUserId</span><span class="p">());</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">userInfoMapper</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">userInfo</span><span class="p">,</span> <span class="n">queryWrapper</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="445bug">4.4.5、bug修复<a class="headerlink" href="#445bug" title="Permanent link">&para;</a></h4>
<p>在之前的查询个人信息中接口中，返回数据中的性别数据有误，需要返回man或woman。</p>
<p>如下：</p>
<div class="codehilite"><pre><span></span><code><span class="c1">//com.tanhua.server.service.MyCenterService</span>

    <span class="kd">public</span> <span class="n">UserInfoVo</span> <span class="nf">queryUserInfoByUserId</span><span class="p">(</span><span class="n">Long</span> <span class="n">userId</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ObjectUtil</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">userId</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">//如果查询id为null，就表示查询当前用户信息</span>
            <span class="n">userId</span> <span class="o">=</span> <span class="n">UserThreadLocal</span><span class="p">.</span><span class="na">get</span><span class="p">().</span><span class="na">getId</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="c1">//查询用户信息</span>
        <span class="n">UserInfo</span> <span class="n">userInfo</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">userInfoService</span><span class="p">.</span><span class="na">queryUserInfoByUserId</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ObjectUtil</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">userInfo</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">UserInfoVo</span> <span class="n">userInfoVo</span> <span class="o">=</span> <span class="n">BeanUtil</span><span class="p">.</span><span class="na">copyProperties</span><span class="p">(</span><span class="n">userInfo</span><span class="p">,</span> <span class="n">UserInfoVo</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="s">&quot;marriage&quot;</span><span class="p">);</span>
        <span class="n">userInfoVo</span><span class="p">.</span><span class="na">setGender</span><span class="p">(</span><span class="n">userInfo</span><span class="p">.</span><span class="na">getSex</span><span class="p">().</span><span class="na">getValue</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="s">&quot;man&quot;</span> <span class="p">:</span> <span class="s">&quot;women&quot;</span><span class="p">);</span>
        <span class="n">userInfoVo</span><span class="p">.</span><span class="na">setMarriage</span><span class="p">(</span><span class="n">StrUtil</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;已婚&quot;</span><span class="p">,</span> <span class="n">userInfo</span><span class="p">.</span><span class="na">getMarriage</span><span class="p">())</span> <span class="o">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">userInfoVo</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div>

<h3 id="42">4.2、更新头像<a class="headerlink" href="#42" title="Permanent link">&para;</a></h3>
<p>上传头像使用sso中的上传逻辑即可，只是路径不同，所以我们只需要修改nginx配置和在sso中定义Controller即可。</p>
<p>接口文档：https://mock-java.itheima.net/project/35/interface/api/881 </p>
<div class="codehilite"><pre><span></span><code><span class="c1">#user  nobody;</span>
worker_processes  <span class="m">1</span><span class="p">;</span>

<span class="c1">#error_log  logs/error.log;</span>
<span class="c1">#error_log  logs/error.log  notice;</span>
<span class="c1">#error_log  logs/error.log  info;</span>

<span class="c1">#pid        logs/nginx.pid;</span>


events <span class="o">{</span>
    worker_connections  <span class="m">1024</span><span class="p">;</span>
<span class="o">}</span>


http <span class="o">{</span>
    include       mime.types<span class="p">;</span>
    default_type  application/octet-stream<span class="p">;</span>

    <span class="c1">#log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
    <span class="c1">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
    <span class="c1">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>

    <span class="c1">#access_log  logs/access.log  main;</span>

    sendfile        on<span class="p">;</span>
    <span class="c1">#tcp_nopush     on;</span>

    <span class="c1">#keepalive_timeout  0;</span>
    keepalive_timeout  <span class="m">65</span><span class="p">;</span>

    <span class="c1">#gzip  on;</span>

    server <span class="o">{</span>
        listen       <span class="m">80</span><span class="p">;</span>
        server_name  localhost<span class="p">;</span>

        <span class="c1">#charset koi8-r;</span>

        <span class="c1">#access_log  logs/host.access.log  main;</span>

        <span class="c1">#error_page  404              /404.html;</span>

        <span class="c1"># redirect server error pages to the static page /50x.html</span>
        <span class="c1">#</span>
        error_page   <span class="m">500</span> <span class="m">502</span> <span class="m">503</span> <span class="m">504</span>  /50x.html<span class="p">;</span>
        <span class="nv">location</span> <span class="o">=</span> /50x.html <span class="o">{</span>
            root   html<span class="p">;</span>
        <span class="o">}</span>

        location /user/ <span class="o">{</span>  <span class="c1">#请求路径中凡是以/user/开头的请求，转发到sso系统</span>
            client_max_body_size  300m<span class="p">;</span>  <span class="c1">#设置最大的请求体大小，解决大文件上传不了的问题</span>
            proxy_connect_timeout 300s<span class="p">;</span>  <span class="c1">#代理连接超时时间</span>
            proxy_send_timeout 300s<span class="p">;</span>  <span class="c1">#代理发送数据的超时时间</span>
            proxy_read_timeout 300s<span class="p">;</span>  <span class="c1">#代理读取数据的超时时间</span>
            proxy_pass   http://127.0.0.1:18080<span class="p">;</span>  <span class="c1">#转发请求</span>
        <span class="o">}</span>

        location /users/header <span class="o">{</span>  <span class="c1">#请求路径中凡是以/user/header开头的请求，转发到sso系统</span>
            client_max_body_size  300m<span class="p">;</span>  <span class="c1">#设置最大的请求体大小，解决大文件上传不了的问题</span>
            proxy_connect_timeout 300s<span class="p">;</span>  <span class="c1">#代理连接超时时间</span>
            proxy_send_timeout 300s<span class="p">;</span>  <span class="c1">#代理发送数据的超时时间</span>
            proxy_read_timeout 300s<span class="p">;</span>  <span class="c1">#代理读取数据的超时时间</span>
            proxy_pass   http://127.0.0.1:18080<span class="p">;</span>  <span class="c1">#转发请求</span>
        <span class="o">}</span>

        location / <span class="o">{</span>   <span class="c1">#上面未匹配到的在这里处理</span>
            client_max_body_size  300m<span class="p">;</span>
            proxy_connect_timeout 300s<span class="p">;</span>
            proxy_send_timeout 300s<span class="p">;</span>
            proxy_read_timeout 300s<span class="p">;</span>
                proxy_pass   http://127.0.0.1:18081<span class="p">;</span>  <span class="c1">#转发请求到server系统</span>
            <span class="o">}</span>
        <span class="o">}</span>

<span class="o">}</span>
</code></pre></div>

<h4 id="422mycentercontroller">4.2.2、MyCenterController<a class="headerlink" href="#422mycentercontroller" title="Permanent link">&para;</a></h4>
<p>在sso工程中定义MyCenterController。</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.tanhua.sso.controller</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.tanhua.sso.vo.ErrorResult</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.ResponseEntity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="p">;</span>

<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;users&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyCenterController</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">UserInfoController</span> <span class="n">userInfoController</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * 上传头像</span>
<span class="cm">     *</span>
<span class="cm">     * @param file</span>
<span class="cm">     * @param token</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;header&quot;</span><span class="p">)</span>
    <span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="nf">saveLogo</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="p">(</span><span class="s">&quot;headPhoto&quot;</span><span class="p">)</span> <span class="n">MultipartFile</span> <span class="n">file</span><span class="p">,</span> <span class="nd">@RequestHeader</span><span class="p">(</span><span class="s">&quot;Authorization&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">token</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">userInfoController</span><span class="p">.</span><span class="na">saveUserLogo</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">token</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../day07/" class="md-footer__link md-footer__link--prev" aria-label="上一页: day07" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              day07
            </div>
          </div>
        </a>
      
      
        
        <a href="../day09/" class="md-footer__link md-footer__link--next" aria-label="下一页: day09" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              day09
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2019 peaceiris
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/peaceiris" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/piris314en" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["tabs"], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.477d984a.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.82b56eb2.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>